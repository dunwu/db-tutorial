(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[]]);!function(n){function e(e){for(var a,r,l=e[0],o=e[1],c=e[2],u=0,m=[];u<l.length;u++)r=l[u],Object.prototype.hasOwnProperty.call(s,r)&&s[r]&&m.push(s[r][0]),s[r]=0;for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(n[a]=o[a]);for(d&&d(e);m.length;)m.shift()();return i.push.apply(i,c||[]),t()}function t(){for(var n,e=0;e<i.length;e++){for(var t=i[e],a=!0,l=1;l<t.length;l++){var o=t[l];0!==s[o]&&(a=!1)}a&&(i.splice(e--,1),n=r(r.s=t[0]))}return n}var a={},s={1:0},i=[];function r(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}r.e=function(n){var e=[],t=s[n];if(0!==t)if(t)e.push(t[2]);else{var a=new Promise((function(e,a){t=s[n]=[e,a]}));e.push(t[2]=a);var i,l=document.createElement("script");l.charset="utf-8",l.timeout=120,r.nc&&l.setAttribute("nonce",r.nc),l.src=function(n){return r.p+"assets/js/"+({}[n]||n)+"."+{2:"aded268b",3:"82108019",4:"884deeca",5:"42f2cdb7",6:"5a5b4e54",7:"913bec54",8:"103b4774",9:"386bfe3a",10:"551ab278",11:"c049b6a2",12:"92d587d6",13:"a7b35fa5",14:"9ec959b5",15:"e7943372",16:"c6ad7b26",17:"39500ebd",18:"29949979",19:"78f879b8",20:"3ce14df7",21:"9d311c7c",22:"90234550",23:"12cf9e2d",24:"5b436e46",25:"8f2dc7d9",26:"61665ff4",27:"dfc7cc88",28:"a6286a66",29:"bfa8c106",30:"c93b7a2e",31:"d48aab81",32:"33f8bb7c",33:"eb3b622d",34:"1ba1a06c",35:"24e4fee8",36:"dc61504e",37:"f1c9c729",38:"5024023f",39:"30ed016e",40:"6a6327f0",41:"3767f4d8",42:"14a20b0f",43:"b059081c",44:"73f724d9",45:"68f2ab27",46:"aed8a61f",47:"3bbf2366",48:"81688356",49:"1d366c93",50:"ee6f08b7",51:"47835d9d",52:"b0cab79c",53:"106440a2",54:"340ab690",55:"00623de9",56:"9f086601",57:"f5ad5f3f",58:"14827368",59:"c41f57d6",60:"314534c0",61:"1ea5e4b7",62:"8b52e8fc",63:"d2fa8325",64:"ea2577e7",65:"563da2bb",66:"34eb51bd",67:"ab57f04f",68:"15b6f540",69:"54590de4",70:"40a2cea2",71:"3ce50922",72:"b9c022e9",73:"fba94661",74:"998d6c2f",75:"6efb68b0",76:"57273256",77:"3ddffb5b",78:"8fde3d74",79:"7a472c31",80:"4c55c65f",81:"cbdb67b8",82:"9c14d852",83:"a3d7d272",84:"6994dacc",85:"aca8d788",86:"00671865",87:"9076c4e8",88:"bbe68dab",89:"e2173071",90:"429162f2",91:"6ecc7c85",92:"efe42934",93:"69562766",94:"04aebfbc",95:"fe7cfce4",96:"674475d6",97:"8a7b73f2",98:"bf85add1"}[n]+".js"}(n);var o=new Error;i=function(e){l.onerror=l.onload=null,clearTimeout(c);var t=s[n];if(0!==t){if(t){var a=e&&("load"===e.type?"missing":e.type),i=e&&e.target&&e.target.src;o.message="Loading chunk "+n+" failed.\n("+a+": "+i+")",o.name="ChunkLoadError",o.type=a,o.request=i,t[1](o)}s[n]=void 0}};var c=setTimeout((function(){i({type:"timeout",target:l})}),12e4);l.onerror=l.onload=i,document.head.appendChild(l)}return Promise.all(e)},r.m=n,r.c=a,r.d=function(n,e,t){r.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:t})},r.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r.t=function(n,e){if(1&e&&(n=r(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var a in n)r.d(t,a,function(e){return n[e]}.bind(null,a));return t},r.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return r.d(e,"a",e),e},r.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},r.p="/db-tutorial/",r.oe=function(n){throw console.error(n),n};var l=window.webpackJsonp=window.webpackJsonp||[],o=l.push.bind(l);l.push=e,l=l.slice();for(var c=0;c<l.length;c++)e(l[c]);var d=o;i.push([107,0]),t()}([function(n,e,t){"use strict";var a=function(n){return n&&n.Math===Math&&n};n.exports=a("object"==typeof globalThis&&globalThis)||a("object"==typeof window&&window)||a("object"==typeof self&&self)||a("object"==typeof global&&global)||a("object"==typeof this&&this)||function(){return this}()||Function("return this")()},function(n,e,t){"use strict";var a="object"==typeof document&&document.all;n.exports=void 0===a&&void 0!==a?function(n){return"function"==typeof n||n===a}:function(n){return"function"==typeof n}},function(n,e,t){"use strict";var a=t(27),s=Function.prototype,i=s.call,r=a&&s.bind.bind(i,i);n.exports=a?r:function(n){return function(){return i.apply(n,arguments)}}},function(n,e,t){"use strict";n.exports=function(n){try{return!!n()}catch(n){return!0}}},function(n,e,t){"use strict";function a(n,e,t,a,s,i,r,l){var o,c="function"==typeof n?n.options:n;if(e&&(c.render=e,c.staticRenderFns=t,c._compiled=!0),a&&(c.functional=!0),i&&(c._scopeId="data-v-"+i),r?(o=function(n){(n=n||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(n=__VUE_SSR_CONTEXT__),s&&s.call(this,n),n&&n._registeredComponents&&n._registeredComponents.add(r)},c._ssrRegister=o):s&&(o=l?function(){s.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:s),o)if(c.functional){c._injectStyles=o;var d=c.render;c.render=function(n,e){return o.call(e),d(n,e)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,o):[o]}return{exports:n,options:c}}t.d(e,"a",(function(){return a}))},function(n,e,t){"use strict";var a=t(3);n.exports=!a((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(n,e){var t=Array.isArray;n.exports=t},function(n,e,t){"use strict";var a=t(1);n.exports=function(n){return"object"==typeof n?null!==n:a(n)}},function(n,e,t){var a=t(70),s="object"==typeof self&&self&&self.Object===Object&&self,i=a||s||Function("return this")();n.exports=i},function(n,e,t){"use strict";var a=t(2),s=t(32),i=a({}.hasOwnProperty);n.exports=Object.hasOwn||function(n,e){return i(s(n),e)}},function(n,e,t){var a=t(166),s=t(169);n.exports=function(n,e){var t=s(n,e);return a(t)?t:void 0}},function(n,e,t){"use strict";t.d(e,"e",(function(){return a})),t.d(e,"b",(function(){return i})),t.d(e,"j",(function(){return r})),t.d(e,"g",(function(){return o})),t.d(e,"h",(function(){return c})),t.d(e,"i",(function(){return d})),t.d(e,"c",(function(){return u})),t.d(e,"f",(function(){return m})),t.d(e,"l",(function(){return p})),t.d(e,"m",(function(){return h})),t.d(e,"d",(function(){return f})),t.d(e,"k",(function(){return b})),t.d(e,"n",(function(){return y})),t.d(e,"a",(function(){return _}));t(16);const a=/#.*$/,s=/\.(md|html)$/,i=/\/$/,r=/^[a-z]+:/i;function l(n){return decodeURI(n).replace(a,"").replace(s,"")}function o(n){return r.test(n)}function c(n){return/^mailto:/.test(n)}function d(n){return/^tel:/.test(n)}function u(n){if(o(n))return n;if(!n)return"404";const e=n.match(a),t=e?e[0]:"",s=l(n);return i.test(s)?n:s+".html"+t}function m(n,e){const t=n.hash,s=function(n){const e=n&&n.match(a);if(e)return e[0]}(e);if(s&&t!==s)return!1;return l(n.path)===l(e)}function p(n,e,t){if(o(e))return{type:"external",path:e};t&&(e=function(n,e,t){const a=n.charAt(0);if("/"===a)return n;if("?"===a||"#"===a)return e+n;const s=e.split("/");t&&s[s.length-1]||s.pop();const i=n.replace(/^\//,"").split("/");for(let n=0;n<i.length;n++){const e=i[n];".."===e?s.pop():"."!==e&&s.push(e)}""!==s[0]&&s.unshift("");return s.join("/")}(e,t));const a=l(e);for(let e=0;e<n.length;e++)if(l(n[e].regularPath)===a)return Object.assign({},n[e],{type:"page",path:u(n[e].path)});return console.error(`[vuepress] No matching page found for sidebar item "${e}"`),{}}function h(n,e,t,a){const{pages:s,themeConfig:i}=t,r=a&&i.locales&&i.locales[a]||i;if("auto"===(n.frontmatter.sidebar||r.sidebar||i.sidebar))return g(n);const l=r.sidebar||i.sidebar;if(l){const{base:t,config:a}=function(n,e){if(Array.isArray(e))return{base:"/",config:e};for(const a in e)if(0===(t=n,/(\.html|\/)$/.test(t)?t:t+"/").indexOf(encodeURI(a)))return{base:a,config:e[a]};var t;return{}}(e,l);return"auto"===a?g(n):a?a.map(n=>function n(e,t,a,s=1){if("string"==typeof e)return p(t,e,a);if(Array.isArray(e))return Object.assign(p(t,e[0],a),{title:e[1]});{s>3&&console.error("[vuepress] detected a too deep nested sidebar group.");const i=e.children||[];return 0===i.length&&e.path?Object.assign(p(t,e.path,a),{title:e.title}):{type:"group",path:e.path,title:e.title,sidebarDepth:e.sidebarDepth,initialOpenGroupIndex:e.initialOpenGroupIndex,children:i.map(e=>n(e,t,a,s+1)),collapsable:!1!==e.collapsable}}}(n,s,t)):[]}return[]}function g(n){const e=f(n.headers||[]);return[{type:"group",collapsable:!1,title:n.title,path:null,children:e.map(e=>({type:"auto",title:e.title,basePath:n.path,path:n.path+"#"+e.slug,children:e.children||[]}))}]}function f(n){let e;return(n=n.map(n=>Object.assign({},n))).forEach(n=>{2===n.level?e=n:e&&(e.children||(e.children=[])).push(n)}),n.filter(n=>2===n.level)}function b(n){return Object.assign(n,{type:n.items&&n.items.length?"links":"link"})}function y(n){return Object.prototype.toString.call(n).match(/\[object (.*?)\]/)[1].toLowerCase()}function v(n){let e=n.frontmatter.date||n.lastUpdated||new Date,t=new Date(e);return"Invalid Date"==t&&e&&(t=new Date(e.replace(/-/g,"/"))),t.getTime()}function _(n,e){return v(e)-v(n)}},function(n,e){n.exports=function(n){return null!=n&&"object"==typeof n}},function(n,e,t){var a=t(15),s=t(151),i=t(152),r=a?a.toStringTag:void 0;n.exports=function(n){return null==n?void 0===n?"[object Undefined]":"[object Null]":r&&r in Object(n)?s(n):i(n)}},function(n,e,t){"use strict";var a=t(5),s=t(17),i=t(35);n.exports=a?function(n,e,t){return s.f(n,e,i(1,t))}:function(n,e,t){return n[e]=t,n}},function(n,e,t){var a=t(8).Symbol;n.exports=a},function(n,e,t){"use strict";var a=t(26),s=t(32),i=t(33),r=t(145),l=t(147);a({target:"Array",proto:!0,arity:1,forced:t(3)((function(){return 4294967297!==[].push.call({length:4294967296},1)}))||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(n){return n instanceof TypeError}}()},{push:function(n){var e=s(this),t=i(e),a=arguments.length;l(t+a);for(var o=0;o<a;o++)e[t]=arguments[o],t++;return r(e,t),t}})},function(n,e,t){"use strict";var a=t(5),s=t(65),i=t(102),r=t(48),l=t(55),o=TypeError,c=Object.defineProperty,d=Object.getOwnPropertyDescriptor;e.f=a?i?function(n,e,t){if(r(n),e=l(e),r(t),"function"==typeof n&&"prototype"===e&&"value"in t&&"writable"in t&&!t.writable){var a=d(n,e);a&&a.writable&&(n[e]=t.value,t={configurable:"configurable"in t?t.configurable:a.configurable,enumerable:"enumerable"in t?t.enumerable:a.enumerable,writable:!1})}return c(n,e,t)}:c:function(n,e,t){if(r(n),e=l(e),r(t),s)try{return c(n,e,t)}catch(n){}if("get"in t||"set"in t)throw new o("Accessors not supported");return"value"in t&&(n[e]=t.value),n}},function(n,e,t){"use strict";var a=t(2),s=a({}.toString),i=a("".slice);n.exports=function(n){return i(s(n),8,-1)}},function(n,e,t){var a=t(156),s=t(157),i=t(158),r=t(159),l=t(160);function o(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var a=n[e];this.set(a[0],a[1])}}o.prototype.clear=a,o.prototype.delete=s,o.prototype.get=i,o.prototype.has=r,o.prototype.set=l,n.exports=o},function(n,e,t){var a=t(72);n.exports=function(n,e){for(var t=n.length;t--;)if(a(n[t][0],e))return t;return-1}},function(n,e,t){var a=t(10)(Object,"create");n.exports=a},function(n,e,t){var a=t(178);n.exports=function(n,e){var t=n.__data__;return a(e)?t["string"==typeof e?"string":"hash"]:t.map}},function(n,e,t){var a=t(46);n.exports=function(n){if("string"==typeof n||a(n))return n;var e=n+"";return"0"==e&&1/n==-1/0?"-0":e}},function(n,e,t){var a,s;
/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */void 0===(s="function"==typeof(a=function(){var n,e,t={version:"0.2.0"},a=t.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};function s(n,e,t){return n<e?e:n>t?t:n}function i(n){return 100*(-1+n)}t.configure=function(n){var e,t;for(e in n)void 0!==(t=n[e])&&n.hasOwnProperty(e)&&(a[e]=t);return this},t.status=null,t.set=function(n){var e=t.isStarted();n=s(n,a.minimum,1),t.status=1===n?null:n;var o=t.render(!e),c=o.querySelector(a.barSelector),d=a.speed,u=a.easing;return o.offsetWidth,r((function(e){""===a.positionUsing&&(a.positionUsing=t.getPositioningCSS()),l(c,function(n,e,t){var s;return(s="translate3d"===a.positionUsing?{transform:"translate3d("+i(n)+"%,0,0)"}:"translate"===a.positionUsing?{transform:"translate("+i(n)+"%,0)"}:{"margin-left":i(n)+"%"}).transition="all "+e+"ms "+t,s}(n,d,u)),1===n?(l(o,{transition:"none",opacity:1}),o.offsetWidth,setTimeout((function(){l(o,{transition:"all "+d+"ms linear",opacity:0}),setTimeout((function(){t.remove(),e()}),d)}),d)):setTimeout(e,d)})),this},t.isStarted=function(){return"number"==typeof t.status},t.start=function(){t.status||t.set(0);var n=function(){setTimeout((function(){t.status&&(t.trickle(),n())}),a.trickleSpeed)};return a.trickle&&n(),this},t.done=function(n){return n||t.status?t.inc(.3+.5*Math.random()).set(1):this},t.inc=function(n){var e=t.status;return e?("number"!=typeof n&&(n=(1-e)*s(Math.random()*e,.1,.95)),e=s(e+n,0,.994),t.set(e)):t.start()},t.trickle=function(){return t.inc(Math.random()*a.trickleRate)},n=0,e=0,t.promise=function(a){return a&&"resolved"!==a.state()?(0===e&&t.start(),n++,e++,a.always((function(){0==--e?(n=0,t.done()):t.set((n-e)/n)})),this):this},t.render=function(n){if(t.isRendered())return document.getElementById("nprogress");c(document.documentElement,"nprogress-busy");var e=document.createElement("div");e.id="nprogress",e.innerHTML=a.template;var s,r=e.querySelector(a.barSelector),o=n?"-100":i(t.status||0),d=document.querySelector(a.parent);return l(r,{transition:"all 0 linear",transform:"translate3d("+o+"%,0,0)"}),a.showSpinner||(s=e.querySelector(a.spinnerSelector))&&m(s),d!=document.body&&c(d,"nprogress-custom-parent"),d.appendChild(e),e},t.remove=function(){d(document.documentElement,"nprogress-busy"),d(document.querySelector(a.parent),"nprogress-custom-parent");var n=document.getElementById("nprogress");n&&m(n)},t.isRendered=function(){return!!document.getElementById("nprogress")},t.getPositioningCSS=function(){var n=document.body.style,e="WebkitTransform"in n?"Webkit":"MozTransform"in n?"Moz":"msTransform"in n?"ms":"OTransform"in n?"O":"";return e+"Perspective"in n?"translate3d":e+"Transform"in n?"translate":"margin"};var r=function(){var n=[];function e(){var t=n.shift();t&&t(e)}return function(t){n.push(t),1==n.length&&e()}}(),l=function(){var n=["Webkit","O","Moz","ms"],e={};function t(t){return t=t.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,(function(n,e){return e.toUpperCase()})),e[t]||(e[t]=function(e){var t=document.body.style;if(e in t)return e;for(var a,s=n.length,i=e.charAt(0).toUpperCase()+e.slice(1);s--;)if((a=n[s]+i)in t)return a;return e}(t))}function a(n,e,a){e=t(e),n.style[e]=a}return function(n,e){var t,s,i=arguments;if(2==i.length)for(t in e)void 0!==(s=e[t])&&e.hasOwnProperty(t)&&a(n,t,s);else a(n,i[1],i[2])}}();function o(n,e){return("string"==typeof n?n:u(n)).indexOf(" "+e+" ")>=0}function c(n,e){var t=u(n),a=t+e;o(t,e)||(n.className=a.substring(1))}function d(n,e){var t,a=u(n);o(n,e)&&(t=a.replace(" "+e+" "," "),n.className=t.substring(1,t.length-1))}function u(n){return(" "+(n.className||"")+" ").replace(/\s+/gi," ")}function m(n){n&&n.parentNode&&n.parentNode.removeChild(n)}return t})?a.call(e,t,e,n):a)||(n.exports=s)},function(n){n.exports=JSON.parse('{"name":"vuepress-plugin-comment","version":"0.7.3","description":"Comment plugin in vuepress, such as Gitalk, Valine...","main":"index.js","scripts":{"test":"echo \\"Error: no test specified\\" && exit 1"},"repository":{"type":"git","url":"git+ssh://git@github.com/dongyuanxin/vuepress-plugin-comment.git"},"keywords":["vuepress","comment","plugin","vue","gitalk","valine"],"author":"dongyuanxin","license":"MIT","bugs":{"url":"https://github.com/dongyuanxin/vuepress-plugin-comment/issues"},"homepage":"https://github.com/dongyuanxin/vuepress-plugin-comment#readme","dependencies":{"ejs":"^2.6.1","gitalk":"^1.5.0","gitalk-fix":"^1.5.2","i":"^0.3.6","npm":"^6.9.0","valine":"^1.3.9"}}')},function(n,e,t){"use strict";var a=t(0),s=t(53).f,i=t(14),r=t(98),l=t(38),o=t(66),c=t(125);n.exports=function(n,e){var t,d,u,m,p,h=n.target,g=n.global,f=n.stat;if(t=g?a:f?a[h]||l(h,{}):a[h]&&a[h].prototype)for(d in e){if(m=e[d],u=n.dontCallGetSet?(p=s(t,d))&&p.value:t[d],!c(g?d:h+(f?".":"#")+d,n.forced)&&void 0!==u){if(typeof m==typeof u)continue;o(m,u)}(n.sham||u&&u.sham)&&i(m,"sham",!0),r(t,d,m,n)}}},function(n,e,t){"use strict";var a=t(3);n.exports=!a((function(){var n=function(){}.bind();return"function"!=typeof n||n.hasOwnProperty("prototype")}))},function(n,e,t){"use strict";var a=t(49),s=t(36);n.exports=function(n){return a(s(n))}},function(n,e,t){"use strict";var a=t(0),s=t(1),i=function(n){return s(n)?n:void 0};n.exports=function(n,e){return arguments.length<2?i(a[n]):a[n]&&a[n][e]}},function(n,e,t){"use strict";var a=t(1),s=t(112),i=TypeError;n.exports=function(n){if(a(n))return n;throw new i(s(n)+" is not a function")}},function(n,e,t){"use strict";var a=t(0),s=t(62),i=t(9),r=t(64),l=t(59),o=t(58),c=a.Symbol,d=s("wks"),u=o?c.for||c:c&&c.withoutSetter||r;n.exports=function(n){return i(d,n)||(d[n]=l&&i(c,n)?c[n]:u("Symbol."+n)),d[n]}},function(n,e,t){"use strict";var a=t(36),s=Object;n.exports=function(n){return s(a(n))}},function(n,e,t){"use strict";var a=t(123);n.exports=function(n){return a(n.length)}},function(n,e,t){"use strict";var a=t(27),s=Function.prototype.call;n.exports=a?s.bind(s):function(){return s.apply(s,arguments)}},function(n,e,t){"use strict";n.exports=function(n,e){return{enumerable:!(1&n),configurable:!(2&n),writable:!(4&n),value:e}}},function(n,e,t){"use strict";var a=t(54),s=TypeError;n.exports=function(n){if(a(n))throw new s("Can't call method on "+n);return n}},function(n,e,t){"use strict";var a=t(63),s=t(0),i=t(38),r=n.exports=s["__core-js_shared__"]||i("__core-js_shared__",{});(r.versions||(r.versions=[])).push({version:"3.38.1",mode:a?"pure":"global",copyright:"Â© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.38.1/LICENSE",source:"https://github.com/zloirock/core-js"})},function(n,e,t){"use strict";var a=t(0),s=Object.defineProperty;n.exports=function(n,e){try{s(a,n,{value:e,configurable:!0,writable:!0})}catch(t){a[n]=e}return e}},function(n,e,t){var a=t(150),s=t(12),i=Object.prototype,r=i.hasOwnProperty,l=i.propertyIsEnumerable,o=a(function(){return arguments}())?a:function(n){return s(n)&&r.call(n,"callee")&&!l.call(n,"callee")};n.exports=o},function(n,e,t){var a=t(10)(t(8),"Map");n.exports=a},function(n,e){n.exports=function(n){var e=typeof n;return null!=n&&("object"==e||"function"==e)}},function(n,e,t){var a=t(170),s=t(177),i=t(179),r=t(180),l=t(181);function o(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var a=n[e];this.set(a[0],a[1])}}o.prototype.clear=a,o.prototype.delete=s,o.prototype.get=i,o.prototype.has=r,o.prototype.set=l,n.exports=o},function(n,e){n.exports=function(n){var e=-1,t=Array(n.size);return n.forEach((function(n){t[++e]=n})),t}},function(n,e){n.exports=function(n){return"number"==typeof n&&n>-1&&n%1==0&&n<=9007199254740991}},function(n,e,t){var a=t(6),s=t(46),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,r=/^\w*$/;n.exports=function(n,e){if(a(n))return!1;var t=typeof n;return!("number"!=t&&"symbol"!=t&&"boolean"!=t&&null!=n&&!s(n))||(r.test(n)||!i.test(n)||null!=e&&n in Object(e))}},function(n,e,t){var a=t(13),s=t(12);n.exports=function(n){return"symbol"==typeof n||s(n)&&"[object Symbol]"==a(n)}},function(n,e){n.exports=function(n){return n}},function(n,e,t){"use strict";var a=t(7),s=String,i=TypeError;n.exports=function(n){if(a(n))return n;throw new i(s(n)+" is not an object")}},function(n,e,t){"use strict";var a=t(2),s=t(3),i=t(18),r=Object,l=a("".split);n.exports=s((function(){return!r("z").propertyIsEnumerable(0)}))?function(n){return"String"===i(n)?l(n,""):r(n)}:r},function(n,e,t){"use strict";n.exports={}},function(n,e){n.exports=function(n){return n.webpackPolyfill||(n.deprecate=function(){},n.paths=[],n.children||(n.children=[]),Object.defineProperty(n,"loaded",{enumerable:!0,get:function(){return n.l}}),Object.defineProperty(n,"id",{enumerable:!0,get:function(){return n.i}}),n.webpackPolyfill=1),n}},function(n,e){var t=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,i=/^0o[0-7]+$/i,r=parseInt,l="object"==typeof global&&global&&global.Object===Object&&global,o="object"==typeof self&&self&&self.Object===Object&&self,c=l||o||Function("return this")(),d=Object.prototype.toString,u=Math.max,m=Math.min,p=function(){return c.Date.now()};function h(n){var e=typeof n;return!!n&&("object"==e||"function"==e)}function g(n){if("number"==typeof n)return n;if(function(n){return"symbol"==typeof n||function(n){return!!n&&"object"==typeof n}(n)&&"[object Symbol]"==d.call(n)}(n))return NaN;if(h(n)){var e="function"==typeof n.valueOf?n.valueOf():n;n=h(e)?e+"":e}if("string"!=typeof n)return 0===n?n:+n;n=n.replace(t,"");var l=s.test(n);return l||i.test(n)?r(n.slice(2),l?2:8):a.test(n)?NaN:+n}n.exports=function(n,e,t){var a,s,i,r,l,o,c=0,d=!1,f=!1,b=!0;if("function"!=typeof n)throw new TypeError("Expected a function");function y(e){var t=a,i=s;return a=s=void 0,c=e,r=n.apply(i,t)}function v(n){return c=n,l=setTimeout(E,e),d?y(n):r}function _(n){var t=n-o;return void 0===o||t>=e||t<0||f&&n-c>=i}function E(){var n=p();if(_(n))return x(n);l=setTimeout(E,function(n){var t=e-(n-o);return f?m(t,i-(n-c)):t}(n))}function x(n){return l=void 0,b&&a?y(n):(a=s=void 0,r)}function T(){var n=p(),t=_(n);if(a=arguments,s=this,o=n,t){if(void 0===l)return v(o);if(f)return l=setTimeout(E,e),y(o)}return void 0===l&&(l=setTimeout(E,e)),r}return e=g(e)||0,h(t)&&(d=!!t.leading,i=(f="maxWait"in t)?u(g(t.maxWait)||0,e):i,b="trailing"in t?!!t.trailing:b),T.cancel=function(){void 0!==l&&clearTimeout(l),c=0,a=o=s=l=void 0},T.flush=function(){return void 0===l?r:x(p())},T}},function(n,e,t){"use strict";var a=t(5),s=t(34),i=t(109),r=t(35),l=t(28),o=t(55),c=t(9),d=t(65),u=Object.getOwnPropertyDescriptor;e.f=a?u:function(n,e){if(n=l(n),e=o(e),d)try{return u(n,e)}catch(n){}if(c(n,e))return r(!s(i.f,n,e),n[e])}},function(n,e,t){"use strict";n.exports=function(n){return null==n}},function(n,e,t){"use strict";var a=t(110),s=t(56);n.exports=function(n){var e=a(n,"string");return s(e)?e:e+""}},function(n,e,t){"use strict";var a=t(29),s=t(1),i=t(57),r=t(58),l=Object;n.exports=r?function(n){return"symbol"==typeof n}:function(n){var e=a("Symbol");return s(e)&&i(e.prototype,l(n))}},function(n,e,t){"use strict";var a=t(2);n.exports=a({}.isPrototypeOf)},function(n,e,t){"use strict";var a=t(59);n.exports=a&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(n,e,t){"use strict";var a=t(60),s=t(3),i=t(0).String;n.exports=!!Object.getOwnPropertySymbols&&!s((function(){var n=Symbol("symbol detection");return!i(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&a&&a<41}))},function(n,e,t){"use strict";var a,s,i=t(0),r=t(61),l=i.process,o=i.Deno,c=l&&l.versions||o&&o.version,d=c&&c.v8;d&&(s=(a=d.split("."))[0]>0&&a[0]<4?1:+(a[0]+a[1])),!s&&r&&(!(a=r.match(/Edge\/(\d+)/))||a[1]>=74)&&(a=r.match(/Chrome\/(\d+)/))&&(s=+a[1]),n.exports=s},function(n,e,t){"use strict";var a=t(0).navigator,s=a&&a.userAgent;n.exports=s?String(s):""},function(n,e,t){"use strict";var a=t(37);n.exports=function(n,e){return a[n]||(a[n]=e||{})}},function(n,e,t){"use strict";n.exports=!1},function(n,e,t){"use strict";var a=t(2),s=0,i=Math.random(),r=a(1..toString);n.exports=function(n){return"Symbol("+(void 0===n?"":n)+")_"+r(++s+i,36)}},function(n,e,t){"use strict";var a=t(5),s=t(3),i=t(101);n.exports=!a&&!s((function(){return 7!==Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}))},function(n,e,t){"use strict";var a=t(9),s=t(118),i=t(53),r=t(17);n.exports=function(n,e,t){for(var l=s(e),o=r.f,c=i.f,d=0;d<l.length;d++){var u=l[d];a(n,u)||t&&a(t,u)||o(n,u,c(e,u))}}},function(n,e,t){"use strict";var a=t(122);n.exports=function(n){var e=+n;return e!=e||0===e?0:a(e)}},function(n,e,t){"use strict";var a=t(133),s=t(7),i=t(36),r=t(134);n.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var n,e=!1,t={};try{(n=a(Object.prototype,"__proto__","set"))(t,[]),e=t instanceof Array}catch(n){}return function(t,a){return i(t),r(a),s(t)?(e?n(t,a):t.__proto__=a,t):t}}():void 0)},function(n,e){n.exports=function(n,e){for(var t=-1,a=e.length,s=n.length;++t<a;)n[s+t]=e[t];return n}},function(n,e){var t="object"==typeof global&&global&&global.Object===Object&&global;n.exports=t},function(n,e,t){var a=t(19),s=t(161),i=t(162),r=t(163),l=t(164),o=t(165);function c(n){var e=this.__data__=new a(n);this.size=e.size}c.prototype.clear=s,c.prototype.delete=i,c.prototype.get=r,c.prototype.has=l,c.prototype.set=o,n.exports=c},function(n,e){n.exports=function(n,e){return n===e||n!=n&&e!=e}},function(n,e,t){var a=t(13),s=t(41);n.exports=function(n){if(!s(n))return!1;var e=a(n);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}},function(n,e){var t=Function.prototype.toString;n.exports=function(n){if(null!=n){try{return t.call(n)}catch(n){}try{return n+""}catch(n){}}return""}},function(n,e,t){var a=t(182),s=t(12);n.exports=function n(e,t,i,r,l){return e===t||(null==e||null==t||!s(e)&&!s(t)?e!=e&&t!=t:a(e,t,i,r,n,l))}},function(n,e,t){var a=t(77),s=t(185),i=t(78);n.exports=function(n,e,t,r,l,o){var c=1&t,d=n.length,u=e.length;if(d!=u&&!(c&&u>d))return!1;var m=o.get(n),p=o.get(e);if(m&&p)return m==e&&p==n;var h=-1,g=!0,f=2&t?new a:void 0;for(o.set(n,e),o.set(e,n);++h<d;){var b=n[h],y=e[h];if(r)var v=c?r(y,b,h,e,n,o):r(b,y,h,n,e,o);if(void 0!==v){if(v)continue;g=!1;break}if(f){if(!s(e,(function(n,e){if(!i(f,e)&&(b===n||l(b,n,t,r,o)))return f.push(e)}))){g=!1;break}}else if(b!==y&&!l(b,y,t,r,o)){g=!1;break}}return o.delete(n),o.delete(e),g}},function(n,e,t){var a=t(42),s=t(183),i=t(184);function r(n){var e=-1,t=null==n?0:n.length;for(this.__data__=new a;++e<t;)this.add(n[e])}r.prototype.add=r.prototype.push=s,r.prototype.has=i,n.exports=r},function(n,e){n.exports=function(n,e){return n.has(e)}},function(n,e,t){var a=t(195),s=t(201),i=t(83);n.exports=function(n){return i(n)?a(n):s(n)}},function(n,e,t){(function(n){var a=t(8),s=t(197),i=e&&!e.nodeType&&e,r=i&&"object"==typeof n&&n&&!n.nodeType&&n,l=r&&r.exports===i?a.Buffer:void 0,o=(l?l.isBuffer:void 0)||s;n.exports=o}).call(this,t(51)(n))},function(n,e){var t=/^(?:0|[1-9]\d*)$/;n.exports=function(n,e){var a=typeof n;return!!(e=null==e?9007199254740991:e)&&("number"==a||"symbol"!=a&&t.test(n))&&n>-1&&n%1==0&&n<e}},function(n,e,t){var a=t(198),s=t(199),i=t(200),r=i&&i.isTypedArray,l=r?s(r):a;n.exports=l},function(n,e,t){var a=t(73),s=t(44);n.exports=function(n){return null!=n&&s(n.length)&&!a(n)}},function(n,e,t){var a=t(10)(t(8),"Set");n.exports=a},function(n,e,t){var a=t(41);n.exports=function(n){return n==n&&!a(n)}},function(n,e){n.exports=function(n,e){return function(t){return null!=t&&(t[n]===e&&(void 0!==e||n in Object(t)))}}},function(n,e,t){var a=t(88),s=t(23);n.exports=function(n,e){for(var t=0,i=(e=a(e,n)).length;null!=n&&t<i;)n=n[s(e[t++])];return t&&t==i?n:void 0}},function(n,e,t){var a=t(6),s=t(45),i=t(212),r=t(215);n.exports=function(n,e){return a(n)?n:s(n,e)?[n]:i(r(n))}},function(n,e,t){},function(n,e,t){},function(n,e,t){},function(n,e,t){},function(n,e,t){var a=t(148),s=t(153),i=t(224),r=t(232),l=t(241),o=t(106),c=i((function(n){var e=o(n);return l(e)&&(e=void 0),r(a(n,1,l,!0),s(e,2))}));n.exports=c},function(n,e,t){"use strict";
/*!
 * escape-html
 * Copyright(c) 2012-2013 TJ Holowaychuk
 * Copyright(c) 2015 Andreas Lubbe
 * Copyright(c) 2015 Tiancheng "Timothy" Gu
 * MIT Licensed
 */var a=/["'&<>]/;n.exports=function(n){var e,t=""+n,s=a.exec(t);if(!s)return t;var i="",r=0,l=0;for(r=s.index;r<t.length;r++){switch(t.charCodeAt(r)){case 34:e="&quot;";break;case 38:e="&amp;";break;case 39:e="&#39;";break;case 60:e="&lt;";break;case 62:e="&gt;";break;default:continue}l!==r&&(i+=t.substring(l,r)),l=r+1,i+=e}return l!==r?i+t.substring(l,r):i}},function(n,e,t){"use strict";
/**
 * @file Embedded JavaScript templating engine. {@link http://ejs.co}
 * @author Matthew Eernisse <mde@fleegix.org>
 * @author Tiancheng "Timothy" Gu <timothygu99@gmail.com>
 * @project EJS
 * @license {@link http://www.apache.org/licenses/LICENSE-2.0 Apache License, Version 2.0}
 */var a=t(248),s=t(249),i=t(250),r=!1,l=t(251).version,o=["delimiter","scope","context","debug","compileDebug","client","_with","rmWhitespace","strict","filename","async"],c=o.concat("cache"),d=/^\uFEFF/;function u(n,t){var s,i,r=t.views,l=/^[A-Za-z]+:\\|^\//.exec(n);if(l&&l.length)s=e.resolveInclude(n.replace(/^\/*/,""),t.root||"/",!0);else if(t.filename&&(i=e.resolveInclude(n,t.filename),a.existsSync(i)&&(s=i)),s||Array.isArray(r)&&r.some((function(t){return i=e.resolveInclude(n,t,!0),a.existsSync(i)}))&&(s=i),!s)throw new Error('Could not find the include file "'+t.escapeFunction(n)+'"');return s}function m(n,t){var a,s=n.filename,i=arguments.length>1;if(n.cache){if(!s)throw new Error("cache option requires a filename");if(a=e.cache.get(s))return a;i||(t=h(s).toString().replace(d,""))}else if(!i){if(!s)throw new Error("Internal EJS error: no file name or template provided");t=h(s).toString().replace(d,"")}return a=e.compile(t,n),n.cache&&e.cache.set(s,a),a}function p(n,t,a){var s;if(!a){if("function"==typeof e.promiseImpl)return new e.promiseImpl((function(e,a){try{e(s=m(n)(t))}catch(n){a(n)}}));throw new Error("Please provide a callback function")}try{s=m(n)(t)}catch(n){return a(n)}a(null,s)}function h(n){return e.fileLoader(n)}function g(n,e,t,a,s){var i=e.split("\n"),r=Math.max(a-3,0),l=Math.min(i.length,a+3),o=s(t),c=i.slice(r,l).map((function(n,e){var t=e+r+1;return(t==a?" >> ":"    ")+t+"| "+n})).join("\n");throw n.path=o,n.message=(o||"ejs")+":"+a+"\n"+c+"\n\n"+n.message,n}function f(n){return n.replace(/;(\s*$)/,"$1")}function b(n,t){t=t||{};var a={};this.templateText=n,this.mode=null,this.truncate=!1,this.currentLine=1,this.source="",this.dependencies=[],a.client=t.client||!1,a.escapeFunction=t.escape||t.escapeFunction||i.escapeXML,a.compileDebug=!1!==t.compileDebug,a.debug=!!t.debug,a.filename=t.filename,a.openDelimiter=t.openDelimiter||e.openDelimiter||"<",a.closeDelimiter=t.closeDelimiter||e.closeDelimiter||">",a.delimiter=t.delimiter||e.delimiter||"%",a.strict=t.strict||!1,a.context=t.context,a.cache=t.cache||!1,a.rmWhitespace=t.rmWhitespace,a.root=t.root,a.outputFunctionName=t.outputFunctionName,a.localsName=t.localsName||e.localsName||"locals",a.views=t.views,a.async=t.async,a.destructuredLocals=t.destructuredLocals,a.legacyInclude=void 0===t.legacyInclude||!!t.legacyInclude,a.strict?a._with=!1:a._with=void 0===t._with||t._with,this.opts=a,this.regex=this.createRegex()}e.cache=i.cache,e.fileLoader=a.readFileSync,e.localsName="locals",e.promiseImpl=new Function("return this;")().Promise,e.resolveInclude=function(n,e,t){var a=s.dirname,i=s.extname,r=(0,s.resolve)(t?e:a(e),n);return i(n)||(r+=".ejs"),r},e.compile=function(n,e){return e&&e.scope&&(r||(console.warn("`scope` option is deprecated and will be removed in EJS 3"),r=!0),e.context||(e.context=e.scope),delete e.scope),new b(n,e).compile()},e.render=function(n,e,t){var a=e||{},s=t||{};return 2==arguments.length&&i.shallowCopyFromList(s,a,o),m(s,n)(a)},e.renderFile=function(){var n,e,t,a=Array.prototype.slice.call(arguments),s=a.shift(),r={filename:s};return"function"==typeof arguments[arguments.length-1]&&(n=a.pop()),a.length?(e=a.shift(),a.length?i.shallowCopy(r,a.pop()):(e.settings&&(e.settings.views&&(r.views=e.settings.views),e.settings["view cache"]&&(r.cache=!0),(t=e.settings["view options"])&&i.shallowCopy(r,t)),i.shallowCopyFromList(r,e,c)),r.filename=s):e={},p(r,e,n)},e.Template=b,e.clearCache=function(){e.cache.reset()},b.modes={EVAL:"eval",ESCAPED:"escaped",RAW:"raw",COMMENT:"comment",LITERAL:"literal"},b.prototype={createRegex:function(){var n="(<%%|%%>|<%=|<%-|<%_|<%#|<%|%>|-%>|_%>)",e=i.escapeRegExpChars(this.opts.delimiter),t=i.escapeRegExpChars(this.opts.openDelimiter),a=i.escapeRegExpChars(this.opts.closeDelimiter);return n=n.replace(/%/g,e).replace(/</g,t).replace(/>/g,a),new RegExp(n)},compile:function(){var n,e,t,a=this.opts,r="",l="",o=a.escapeFunction;if(!this.source){if(this.generateSource(),r+='  var __output = "";\n  function __append(s) { if (s !== undefined && s !== null) __output += s }\n',a.outputFunctionName&&(r+="  var "+a.outputFunctionName+" = __append;\n"),a.destructuredLocals&&a.destructuredLocals.length){for(var c="  var __locals = ("+a.localsName+" || {}),\n",d=0;d<a.destructuredLocals.length;d++){var p=a.destructuredLocals[d];d>0&&(c+=",\n  "),c+=p+" = __locals."+p}r+=c+";\n"}!1!==a._with&&(r+="  with ("+a.localsName+" || {}) {\n",l+="  }\n"),l+="  return __output;\n",this.source=r+this.source+l}n=a.compileDebug?"var __line = 1\n  , __lines = "+JSON.stringify(this.templateText)+"\n  , __filename = "+(a.filename?JSON.stringify(a.filename):"undefined")+";\ntry {\n"+this.source+"} catch (e) {\n  rethrow(e, __lines, __filename, __line, escapeFn);\n}\n":this.source,a.client&&(n="escapeFn = escapeFn || "+o.toString()+";\n"+n,a.compileDebug&&(n="rethrow = rethrow || "+g.toString()+";\n"+n)),a.strict&&(n='"use strict";\n'+n),a.debug&&console.log(n),a.compileDebug&&a.filename&&(n=n+"\n//# sourceURL="+a.filename+"\n");try{if(a.async)try{t=new Function("return (async function(){}).constructor;")()}catch(n){throw n instanceof SyntaxError?new Error("This environment does not support async/await"):n}else t=Function;e=new t(a.localsName+", escapeFn, include, rethrow",n)}catch(n){throw n instanceof SyntaxError&&(a.filename&&(n.message+=" in "+a.filename),n.message+=" while compiling ejs\n\n",n.message+="If the above error is not helpful, you may want to try EJS-Lint:\n",n.message+="https://github.com/RyanZim/EJS-Lint",a.async||(n.message+="\n",n.message+="Or, if you meant to create an async function, pass `async: true` as an option.")),n}var h=a.client?e:function(n){return e.apply(a.context,[n||{},o,function(e,t){var s=i.shallowCopy({},n);return t&&(s=i.shallowCopy(s,t)),function(n,e){var t=i.shallowCopy({},e);return t.filename=u(n,t),m(t)}(e,a)(s)},g])};if(h.dependencies=this.dependencies,a.filename&&"function"==typeof Object.defineProperty){var f=a.filename,b=s.basename(f,s.extname(f));try{Object.defineProperty(h,"name",{value:b,writable:!1,enumerable:!1,configurable:!0})}catch(n){}}return h},generateSource:function(){var n=this.opts;n.rmWhitespace&&(this.templateText=this.templateText.replace(/[\r\n]+/g,"\n").replace(/^\s+|\s+$/gm,"")),this.templateText=this.templateText.replace(/[ \t]*<%_/gm,"<%_").replace(/_%>[ \t]*/gm,"_%>");var t=this,a=this.parseTemplateText(),s=this.opts.delimiter,r=this.opts.openDelimiter,l=this.opts.closeDelimiter;a&&a.length&&a.forEach((function(o,c){var m,p,g,f,y,v;if(0===o.indexOf(r+s)&&0!==o.indexOf(r+s+s)&&(p=a[c+2])!=s+l&&p!="-"+s+l&&p!="_"+s+l)throw new Error('Could not find matching close tag for "'+o+'".');if(n.legacyInclude&&(g=o.match(/^\s*include\s+(\S+)/))&&(m=a[c-1])&&(m==r+s||m==r+s+"-"||m==r+s+"_"))return f=i.shallowCopy({},t.opts),y=function(n,e){var t,a,s=i.shallowCopy({},e);a=h(t=u(n,s)).toString().replace(d,""),s.filename=t;var r=new b(a,s);return r.generateSource(),{source:r.source,filename:t,template:a}}(g[1],f),v=t.opts.compileDebug?"    ; (function(){\n      var __line = 1\n      , __lines = "+JSON.stringify(y.template)+"\n      , __filename = "+JSON.stringify(y.filename)+";\n      try {\n"+y.source+"      } catch (e) {\n        rethrow(e, __lines, __filename, __line, escapeFn);\n      }\n    ; }).call(this)\n":"    ; (function(){\n"+y.source+"    ; }).call(this)\n",t.source+=v,void t.dependencies.push(e.resolveInclude(g[1],f.filename));t.scanLine(o)}))},parseTemplateText:function(){for(var n,e=this.templateText,t=this.regex,a=t.exec(e),s=[];a;)0!==(n=a.index)&&(s.push(e.substring(0,n)),e=e.slice(n)),s.push(a[0]),e=e.slice(a[0].length),a=t.exec(e);return e&&s.push(e),s},_addOutput:function(n){if(this.truncate&&(n=n.replace(/^(?:\r\n|\r|\n)/,""),this.truncate=!1),!n)return n;n=(n=(n=(n=n.replace(/\\/g,"\\\\")).replace(/\n/g,"\\n")).replace(/\r/g,"\\r")).replace(/"/g,'\\"'),this.source+='    ; __append("'+n+'")\n'},scanLine:function(n){var e,t=this.opts.delimiter,a=this.opts.openDelimiter,s=this.opts.closeDelimiter;switch(e=n.split("\n").length-1,n){case a+t:case a+t+"_":this.mode=b.modes.EVAL;break;case a+t+"=":this.mode=b.modes.ESCAPED;break;case a+t+"-":this.mode=b.modes.RAW;break;case a+t+"#":this.mode=b.modes.COMMENT;break;case a+t+t:this.mode=b.modes.LITERAL,this.source+='    ; __append("'+n.replace(a+t+t,a+t)+'")\n';break;case t+t+s:this.mode=b.modes.LITERAL,this.source+='    ; __append("'+n.replace(t+t+s,t+s)+'")\n';break;case t+s:case"-"+t+s:case"_"+t+s:this.mode==b.modes.LITERAL&&this._addOutput(n),this.mode=null,this.truncate=0===n.indexOf("-")||0===n.indexOf("_");break;default:if(this.mode){switch(this.mode){case b.modes.EVAL:case b.modes.ESCAPED:case b.modes.RAW:n.lastIndexOf("//")>n.lastIndexOf("\n")&&(n+="\n")}switch(this.mode){case b.modes.EVAL:this.source+="    ; "+n+"\n";break;case b.modes.ESCAPED:this.source+="    ; __append(escapeFn("+f(n)+"))\n";break;case b.modes.RAW:this.source+="    ; __append("+f(n)+")\n";break;case b.modes.COMMENT:break;case b.modes.LITERAL:this._addOutput(n)}}else this._addOutput(n)}this.opts.compileDebug&&e&&(this.currentLine+=e,this.source+="    ; __line = "+this.currentLine+"\n")}},e.escapeXML=i.escapeXML,e.__express=e.renderFile,e.VERSION=l,e.name="ejs","undefined"!=typeof window&&(window.ejs=e)},function(n,e,t){"use strict";t.r(e);var a={name:"CodeBlock",props:{title:{type:String,required:!0},active:{type:Boolean,default:!1}}},s=(t(244),t(4)),i=Object(s.a)(a,(function(){return(0,this._self._c)("div",{staticClass:"theme-code-block",class:{"theme-code-block__active":this.active}},[this._t("default")],2)}),[],!1,null,"4f1e9d0c",null);e.default=i.exports},function(n,e,t){"use strict";t.r(e);var a={name:"CodeGroup",data:()=>({codeTabs:[],activeCodeTabIndex:-1}),watch:{activeCodeTabIndex(n){this.codeTabs.forEach(n=>{n.elm.classList.remove("theme-code-block__active")}),this.codeTabs[n].elm.classList.add("theme-code-block__active")}},mounted(){this.codeTabs=(this.$slots.default||[]).filter(n=>Boolean(n.componentOptions)).map((n,e)=>(""===n.componentOptions.propsData.active&&(this.activeCodeTabIndex=e),{title:n.componentOptions.propsData.title,elm:n.elm})),-1===this.activeCodeTabIndex&&this.codeTabs.length>0&&(this.activeCodeTabIndex=0)},methods:{changeCodeTab(n){this.activeCodeTabIndex=n}}},s=(t(245),t(4)),i=Object(s.a)(a,(function(){var n=this,e=n._self._c;return e("div",{staticClass:"theme-code-group"},[e("div",{staticClass:"theme-code-group__nav"},[e("ul",{staticClass:"theme-code-group__ul"},n._l(n.codeTabs,(function(t,a){return e("li",{key:t.title,staticClass:"theme-code-group__li"},[e("button",{staticClass:"theme-code-group__nav-tab",class:{"theme-code-group__nav-tab-active":a===n.activeCodeTabIndex},on:{click:function(e){return n.changeCodeTab(a)}}},[n._v("\n            "+n._s(t.title)+"\n          ")])])})),0)]),n._v(" "),n._t("default"),n._v(" "),n.codeTabs.length<1?e("pre",{staticClass:"pre-blank"},[n._v("// Make sure to add code blocks to your code group")]):n._e()],2)}),[],!1,null,"2f5f1757",null);e.default=i.exports},function(n,e,t){"use strict";var a=t(1),s=t(17),i=t(103),r=t(38);n.exports=function(n,e,t,l){l||(l={});var o=l.enumerable,c=void 0!==l.name?l.name:e;if(a(t)&&i(t,c,l),l.global)o?n[e]=t:r(e,t);else{try{l.unsafe?n[e]&&(o=!0):delete n[e]}catch(n){}o?n[e]=t:s.f(n,e,{value:t,enumerable:!1,configurable:!l.nonConfigurable,writable:!l.nonWritable})}return n}},function(n,e,t){"use strict";n.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(n,e,t){"use strict";var a=t(139),s=String;n.exports=function(n){if("Symbol"===a(n))throw new TypeError("Cannot convert a Symbol value to a string");return s(n)}},function(n,e,t){"use strict";var a=t(0),s=t(7),i=a.document,r=s(i)&&s(i.createElement);n.exports=function(n){return r?i.createElement(n):{}}},function(n,e,t){"use strict";var a=t(5),s=t(3);n.exports=a&&s((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},function(n,e,t){"use strict";var a=t(2),s=t(3),i=t(1),r=t(9),l=t(5),o=t(114).CONFIGURABLE,c=t(115),d=t(116),u=d.enforce,m=d.get,p=String,h=Object.defineProperty,g=a("".slice),f=a("".replace),b=a([].join),y=l&&!s((function(){return 8!==h((function(){}),"length",{value:8}).length})),v=String(String).split("String"),_=n.exports=function(n,e,t){"Symbol("===g(p(e),0,7)&&(e="["+f(p(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),t&&t.getter&&(e="get "+e),t&&t.setter&&(e="set "+e),(!r(n,"name")||o&&n.name!==e)&&(l?h(n,"name",{value:e,configurable:!0}):n.name=e),y&&t&&r(t,"arity")&&n.length!==t.arity&&h(n,"length",{value:t.arity});try{t&&r(t,"constructor")&&t.constructor?l&&h(n,"prototype",{writable:!1}):n.prototype&&(n.prototype=void 0)}catch(n){}var a=u(n);return r(a,"source")||(a.source=b(v,"string"==typeof e?e:"")),n};Function.prototype.toString=_((function(){return i(this)&&m(this).source||c(this)}),"toString")},function(n,e,t){"use strict";var a=t(62),s=t(64),i=a("keys");n.exports=function(n){return i[n]||(i[n]=s(n))}},function(n,e,t){"use strict";var a=t(2),s=t(9),i=t(28),r=t(120).indexOf,l=t(50),o=a([].push);n.exports=function(n,e){var t,a=i(n),c=0,d=[];for(t in a)!s(l,t)&&s(a,t)&&o(d,t);for(;e.length>c;)s(a,t=e[c++])&&(~r(d,t)||o(d,t));return d}},function(n,e){n.exports=function(n){var e=null==n?0:n.length;return e?n[e-1]:void 0}},function(n,e,t){n.exports=t(254)},function(n,e,t){"use strict";var a=t(26),s=t(126).left,i=t(127),r=t(60);a({target:"Array",proto:!0,forced:!t(128)&&r>79&&r<83||!i("reduce")},{reduce:function(n){var e=arguments.length;return s(this,n,e,e>1?arguments[1]:void 0)}})},function(n,e,t){"use strict";var a={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,i=s&&!a.call({1:2},1);e.f=i?function(n){var e=s(this,n);return!!e&&e.enumerable}:a},function(n,e,t){"use strict";var a=t(34),s=t(7),i=t(56),r=t(111),l=t(113),o=t(31),c=TypeError,d=o("toPrimitive");n.exports=function(n,e){if(!s(n)||i(n))return n;var t,o=r(n,d);if(o){if(void 0===e&&(e="default"),t=a(o,n,e),!s(t)||i(t))return t;throw new c("Can't convert object to primitive value")}return void 0===e&&(e="number"),l(n,e)}},function(n,e,t){"use strict";var a=t(30),s=t(54);n.exports=function(n,e){var t=n[e];return s(t)?void 0:a(t)}},function(n,e,t){"use strict";var a=String;n.exports=function(n){try{return a(n)}catch(n){return"Object"}}},function(n,e,t){"use strict";var a=t(34),s=t(1),i=t(7),r=TypeError;n.exports=function(n,e){var t,l;if("string"===e&&s(t=n.toString)&&!i(l=a(t,n)))return l;if(s(t=n.valueOf)&&!i(l=a(t,n)))return l;if("string"!==e&&s(t=n.toString)&&!i(l=a(t,n)))return l;throw new r("Can't convert object to primitive value")}},function(n,e,t){"use strict";var a=t(5),s=t(9),i=Function.prototype,r=a&&Object.getOwnPropertyDescriptor,l=s(i,"name"),o=l&&"something"===function(){}.name,c=l&&(!a||a&&r(i,"name").configurable);n.exports={EXISTS:l,PROPER:o,CONFIGURABLE:c}},function(n,e,t){"use strict";var a=t(2),s=t(1),i=t(37),r=a(Function.toString);s(i.inspectSource)||(i.inspectSource=function(n){return r(n)}),n.exports=i.inspectSource},function(n,e,t){"use strict";var a,s,i,r=t(117),l=t(0),o=t(7),c=t(14),d=t(9),u=t(37),m=t(104),p=t(50),h=l.TypeError,g=l.WeakMap;if(r||u.state){var f=u.state||(u.state=new g);f.get=f.get,f.has=f.has,f.set=f.set,a=function(n,e){if(f.has(n))throw new h("Object already initialized");return e.facade=n,f.set(n,e),e},s=function(n){return f.get(n)||{}},i=function(n){return f.has(n)}}else{var b=m("state");p[b]=!0,a=function(n,e){if(d(n,b))throw new h("Object already initialized");return e.facade=n,c(n,b,e),e},s=function(n){return d(n,b)?n[b]:{}},i=function(n){return d(n,b)}}n.exports={set:a,get:s,has:i,enforce:function(n){return i(n)?s(n):a(n,{})},getterFor:function(n){return function(e){var t;if(!o(e)||(t=s(e)).type!==n)throw new h("Incompatible receiver, "+n+" required");return t}}}},function(n,e,t){"use strict";var a=t(0),s=t(1),i=a.WeakMap;n.exports=s(i)&&/native code/.test(String(i))},function(n,e,t){"use strict";var a=t(29),s=t(2),i=t(119),r=t(124),l=t(48),o=s([].concat);n.exports=a("Reflect","ownKeys")||function(n){var e=i.f(l(n)),t=r.f;return t?o(e,t(n)):e}},function(n,e,t){"use strict";var a=t(105),s=t(99).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(n){return a(n,s)}},function(n,e,t){"use strict";var a=t(28),s=t(121),i=t(33),r=function(n){return function(e,t,r){var l=a(e),o=i(l);if(0===o)return!n&&-1;var c,d=s(r,o);if(n&&t!=t){for(;o>d;)if((c=l[d++])!=c)return!0}else for(;o>d;d++)if((n||d in l)&&l[d]===t)return n||d||0;return!n&&-1}};n.exports={includes:r(!0),indexOf:r(!1)}},function(n,e,t){"use strict";var a=t(67),s=Math.max,i=Math.min;n.exports=function(n,e){var t=a(n);return t<0?s(t+e,0):i(t,e)}},function(n,e,t){"use strict";var a=Math.ceil,s=Math.floor;n.exports=Math.trunc||function(n){var e=+n;return(e>0?s:a)(e)}},function(n,e,t){"use strict";var a=t(67),s=Math.min;n.exports=function(n){var e=a(n);return e>0?s(e,9007199254740991):0}},function(n,e,t){"use strict";e.f=Object.getOwnPropertySymbols},function(n,e,t){"use strict";var a=t(3),s=t(1),i=/#|\.prototype\./,r=function(n,e){var t=o[l(n)];return t===d||t!==c&&(s(e)?a(e):!!e)},l=r.normalize=function(n){return String(n).replace(i,".").toLowerCase()},o=r.data={},c=r.NATIVE="N",d=r.POLYFILL="P";n.exports=r},function(n,e,t){"use strict";var a=t(30),s=t(32),i=t(49),r=t(33),l=TypeError,o="Reduce of empty array with no initial value",c=function(n){return function(e,t,c,d){var u=s(e),m=i(u),p=r(u);if(a(t),0===p&&c<2)throw new l(o);var h=n?p-1:0,g=n?-1:1;if(c<2)for(;;){if(h in m){d=m[h],h+=g;break}if(h+=g,n?h<0:p<=h)throw new l(o)}for(;n?h>=0:p>h;h+=g)h in m&&(d=t(d,m[h],h,u));return d}};n.exports={left:c(!1),right:c(!0)}},function(n,e,t){"use strict";var a=t(3);n.exports=function(n,e){var t=[][n];return!!t&&a((function(){t.call(null,e||function(){return 1},1)}))}},function(n,e,t){"use strict";var a=t(129);n.exports="NODE"===a},function(n,e,t){"use strict";var a=t(0),s=t(61),i=t(18),r=function(n){return s.slice(0,n.length)===n};n.exports=r("Bun/")?"BUN":r("Cloudflare-Workers")?"CLOUDFLARE":r("Deno/")?"DENO":r("Node.js/")?"NODE":a.Bun&&"string"==typeof Bun.version?"BUN":a.Deno&&"object"==typeof Deno.version?"DENO":"process"===i(a.process)?"NODE":a.window&&a.document?"BROWSER":"REST"},function(n,e,t){"use strict";var a=t(26),s=t(0),i=t(131),r=t(132),l=s.WebAssembly,o=7!==new Error("e",{cause:7}).cause,c=function(n,e){var t={};t[n]=r(n,e,o),a({global:!0,constructor:!0,arity:1,forced:o},t)},d=function(n,e){if(l&&l[n]){var t={};t[n]=r("WebAssembly."+n,e,o),a({target:"WebAssembly",stat:!0,constructor:!0,arity:1,forced:o},t)}};c("Error",(function(n){return function(e){return i(n,this,arguments)}})),c("EvalError",(function(n){return function(e){return i(n,this,arguments)}})),c("RangeError",(function(n){return function(e){return i(n,this,arguments)}})),c("ReferenceError",(function(n){return function(e){return i(n,this,arguments)}})),c("SyntaxError",(function(n){return function(e){return i(n,this,arguments)}})),c("TypeError",(function(n){return function(e){return i(n,this,arguments)}})),c("URIError",(function(n){return function(e){return i(n,this,arguments)}})),d("CompileError",(function(n){return function(e){return i(n,this,arguments)}})),d("LinkError",(function(n){return function(e){return i(n,this,arguments)}})),d("RuntimeError",(function(n){return function(e){return i(n,this,arguments)}}))},function(n,e,t){"use strict";var a=t(27),s=Function.prototype,i=s.apply,r=s.call;n.exports="object"==typeof Reflect&&Reflect.apply||(a?r.bind(i):function(){return r.apply(i,arguments)})},function(n,e,t){"use strict";var a=t(29),s=t(9),i=t(14),r=t(57),l=t(68),o=t(66),c=t(136),d=t(137),u=t(138),m=t(141),p=t(142),h=t(5),g=t(63);n.exports=function(n,e,t,f){var b=f?2:1,y=n.split("."),v=y[y.length-1],_=a.apply(null,y);if(_){var E=_.prototype;if(!g&&s(E,"cause")&&delete E.cause,!t)return _;var x=a("Error"),T=e((function(n,e){var t=u(f?e:n,void 0),a=f?new _(n):new _;return void 0!==t&&i(a,"message",t),p(a,T,a.stack,2),this&&r(E,this)&&d(a,this,T),arguments.length>b&&m(a,arguments[b]),a}));if(T.prototype=E,"Error"!==v?l?l(T,x):o(T,x,{name:!0}):h&&"stackTraceLimit"in _&&(c(T,_,"stackTraceLimit"),c(T,_,"prepareStackTrace")),o(T,_),!g)try{E.name!==v&&i(E,"name",v),E.constructor=T}catch(n){}return T}}},function(n,e,t){"use strict";var a=t(2),s=t(30);n.exports=function(n,e,t){try{return a(s(Object.getOwnPropertyDescriptor(n,e)[t]))}catch(n){}}},function(n,e,t){"use strict";var a=t(135),s=String,i=TypeError;n.exports=function(n){if(a(n))return n;throw new i("Can't set "+s(n)+" as a prototype")}},function(n,e,t){"use strict";var a=t(7);n.exports=function(n){return a(n)||null===n}},function(n,e,t){"use strict";var a=t(17).f;n.exports=function(n,e,t){t in n||a(n,t,{configurable:!0,get:function(){return e[t]},set:function(n){e[t]=n}})}},function(n,e,t){"use strict";var a=t(1),s=t(7),i=t(68);n.exports=function(n,e,t){var r,l;return i&&a(r=e.constructor)&&r!==t&&s(l=r.prototype)&&l!==t.prototype&&i(n,l),n}},function(n,e,t){"use strict";var a=t(100);n.exports=function(n,e){return void 0===n?arguments.length<2?"":e:a(n)}},function(n,e,t){"use strict";var a=t(140),s=t(1),i=t(18),r=t(31)("toStringTag"),l=Object,o="Arguments"===i(function(){return arguments}());n.exports=a?i:function(n){var e,t,a;return void 0===n?"Undefined":null===n?"Null":"string"==typeof(t=function(n,e){try{return n[e]}catch(n){}}(e=l(n),r))?t:o?i(e):"Object"===(a=i(e))&&s(e.callee)?"Arguments":a}},function(n,e,t){"use strict";var a={};a[t(31)("toStringTag")]="z",n.exports="[object z]"===String(a)},function(n,e,t){"use strict";var a=t(7),s=t(14);n.exports=function(n,e){a(e)&&"cause"in e&&s(n,"cause",e.cause)}},function(n,e,t){"use strict";var a=t(14),s=t(143),i=t(144),r=Error.captureStackTrace;n.exports=function(n,e,t,l){i&&(r?r(n,e):a(n,"stack",s(t,l)))}},function(n,e,t){"use strict";var a=t(2),s=Error,i=a("".replace),r=String(new s("zxcasd").stack),l=/\n\s*at [^:]*:[^\n]*/,o=l.test(r);n.exports=function(n,e){if(o&&"string"==typeof n&&!s.prepareStackTrace)for(;e--;)n=i(n,l,"");return n}},function(n,e,t){"use strict";var a=t(3),s=t(35);n.exports=!a((function(){var n=new Error("a");return!("stack"in n)||(Object.defineProperty(n,"stack",s(1,7)),7!==n.stack)}))},function(n,e,t){"use strict";var a=t(5),s=t(146),i=TypeError,r=Object.getOwnPropertyDescriptor,l=a&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(n){return n instanceof TypeError}}();n.exports=l?function(n,e){if(s(n)&&!r(n,"length").writable)throw new i("Cannot set read only .length");return n.length=e}:function(n,e){return n.length=e}},function(n,e,t){"use strict";var a=t(18);n.exports=Array.isArray||function(n){return"Array"===a(n)}},function(n,e,t){"use strict";var a=TypeError;n.exports=function(n){if(n>9007199254740991)throw a("Maximum allowed index exceeded");return n}},function(n,e,t){var a=t(69),s=t(149);n.exports=function n(e,t,i,r,l){var o=-1,c=e.length;for(i||(i=s),l||(l=[]);++o<c;){var d=e[o];t>0&&i(d)?t>1?n(d,t-1,i,r,l):a(l,d):r||(l[l.length]=d)}return l}},function(n,e,t){var a=t(15),s=t(39),i=t(6),r=a?a.isConcatSpreadable:void 0;n.exports=function(n){return i(n)||s(n)||!!(r&&n&&n[r])}},function(n,e,t){var a=t(13),s=t(12);n.exports=function(n){return s(n)&&"[object Arguments]"==a(n)}},function(n,e,t){var a=t(15),s=Object.prototype,i=s.hasOwnProperty,r=s.toString,l=a?a.toStringTag:void 0;n.exports=function(n){var e=i.call(n,l),t=n[l];try{n[l]=void 0;var a=!0}catch(n){}var s=r.call(n);return a&&(e?n[l]=t:delete n[l]),s}},function(n,e){var t=Object.prototype.toString;n.exports=function(n){return t.call(n)}},function(n,e,t){var a=t(154),s=t(210),i=t(47),r=t(6),l=t(221);n.exports=function(n){return"function"==typeof n?n:null==n?i:"object"==typeof n?r(n)?s(n[0],n[1]):a(n):l(n)}},function(n,e,t){var a=t(155),s=t(209),i=t(86);n.exports=function(n){var e=s(n);return 1==e.length&&e[0][2]?i(e[0][0],e[0][1]):function(t){return t===n||a(t,n,e)}}},function(n,e,t){var a=t(71),s=t(75);n.exports=function(n,e,t,i){var r=t.length,l=r,o=!i;if(null==n)return!l;for(n=Object(n);r--;){var c=t[r];if(o&&c[2]?c[1]!==n[c[0]]:!(c[0]in n))return!1}for(;++r<l;){var d=(c=t[r])[0],u=n[d],m=c[1];if(o&&c[2]){if(void 0===u&&!(d in n))return!1}else{var p=new a;if(i)var h=i(u,m,d,n,e,p);if(!(void 0===h?s(m,u,3,i,p):h))return!1}}return!0}},function(n,e){n.exports=function(){this.__data__=[],this.size=0}},function(n,e,t){var a=t(20),s=Array.prototype.splice;n.exports=function(n){var e=this.__data__,t=a(e,n);return!(t<0)&&(t==e.length-1?e.pop():s.call(e,t,1),--this.size,!0)}},function(n,e,t){var a=t(20);n.exports=function(n){var e=this.__data__,t=a(e,n);return t<0?void 0:e[t][1]}},function(n,e,t){var a=t(20);n.exports=function(n){return a(this.__data__,n)>-1}},function(n,e,t){var a=t(20);n.exports=function(n,e){var t=this.__data__,s=a(t,n);return s<0?(++this.size,t.push([n,e])):t[s][1]=e,this}},function(n,e,t){var a=t(19);n.exports=function(){this.__data__=new a,this.size=0}},function(n,e){n.exports=function(n){var e=this.__data__,t=e.delete(n);return this.size=e.size,t}},function(n,e){n.exports=function(n){return this.__data__.get(n)}},function(n,e){n.exports=function(n){return this.__data__.has(n)}},function(n,e,t){var a=t(19),s=t(40),i=t(42);n.exports=function(n,e){var t=this.__data__;if(t instanceof a){var r=t.__data__;if(!s||r.length<199)return r.push([n,e]),this.size=++t.size,this;t=this.__data__=new i(r)}return t.set(n,e),this.size=t.size,this}},function(n,e,t){var a=t(73),s=t(167),i=t(41),r=t(74),l=/^\[object .+?Constructor\]$/,o=Function.prototype,c=Object.prototype,d=o.toString,u=c.hasOwnProperty,m=RegExp("^"+d.call(u).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");n.exports=function(n){return!(!i(n)||s(n))&&(a(n)?m:l).test(r(n))}},function(n,e,t){var a,s=t(168),i=(a=/[^.]+$/.exec(s&&s.keys&&s.keys.IE_PROTO||""))?"Symbol(src)_1."+a:"";n.exports=function(n){return!!i&&i in n}},function(n,e,t){var a=t(8)["__core-js_shared__"];n.exports=a},function(n,e){n.exports=function(n,e){return null==n?void 0:n[e]}},function(n,e,t){var a=t(171),s=t(19),i=t(40);n.exports=function(){this.size=0,this.__data__={hash:new a,map:new(i||s),string:new a}}},function(n,e,t){var a=t(172),s=t(173),i=t(174),r=t(175),l=t(176);function o(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var a=n[e];this.set(a[0],a[1])}}o.prototype.clear=a,o.prototype.delete=s,o.prototype.get=i,o.prototype.has=r,o.prototype.set=l,n.exports=o},function(n,e,t){var a=t(21);n.exports=function(){this.__data__=a?a(null):{},this.size=0}},function(n,e){n.exports=function(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}},function(n,e,t){var a=t(21),s=Object.prototype.hasOwnProperty;n.exports=function(n){var e=this.__data__;if(a){var t=e[n];return"__lodash_hash_undefined__"===t?void 0:t}return s.call(e,n)?e[n]:void 0}},function(n,e,t){var a=t(21),s=Object.prototype.hasOwnProperty;n.exports=function(n){var e=this.__data__;return a?void 0!==e[n]:s.call(e,n)}},function(n,e,t){var a=t(21);n.exports=function(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=a&&void 0===e?"__lodash_hash_undefined__":e,this}},function(n,e,t){var a=t(22);n.exports=function(n){var e=a(this,n).delete(n);return this.size-=e?1:0,e}},function(n,e){n.exports=function(n){var e=typeof n;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==n:null===n}},function(n,e,t){var a=t(22);n.exports=function(n){return a(this,n).get(n)}},function(n,e,t){var a=t(22);n.exports=function(n){return a(this,n).has(n)}},function(n,e,t){var a=t(22);n.exports=function(n,e){var t=a(this,n),s=t.size;return t.set(n,e),this.size+=t.size==s?0:1,this}},function(n,e,t){var a=t(71),s=t(76),i=t(186),r=t(189),l=t(205),o=t(6),c=t(80),d=t(82),u="[object Object]",m=Object.prototype.hasOwnProperty;n.exports=function(n,e,t,p,h,g){var f=o(n),b=o(e),y=f?"[object Array]":l(n),v=b?"[object Array]":l(e),_=(y="[object Arguments]"==y?u:y)==u,E=(v="[object Arguments]"==v?u:v)==u,x=y==v;if(x&&c(n)){if(!c(e))return!1;f=!0,_=!1}if(x&&!_)return g||(g=new a),f||d(n)?s(n,e,t,p,h,g):i(n,e,y,t,p,h,g);if(!(1&t)){var T=_&&m.call(n,"__wrapped__"),w=E&&m.call(e,"__wrapped__");if(T||w){var k=T?n.value():n,I=w?e.value():e;return g||(g=new a),h(k,I,t,p,g)}}return!!x&&(g||(g=new a),r(n,e,t,p,h,g))}},function(n,e){n.exports=function(n){return this.__data__.set(n,"__lodash_hash_undefined__"),this}},function(n,e){n.exports=function(n){return this.__data__.has(n)}},function(n,e){n.exports=function(n,e){for(var t=-1,a=null==n?0:n.length;++t<a;)if(e(n[t],t,n))return!0;return!1}},function(n,e,t){var a=t(15),s=t(187),i=t(72),r=t(76),l=t(188),o=t(43),c=a?a.prototype:void 0,d=c?c.valueOf:void 0;n.exports=function(n,e,t,a,c,u,m){switch(t){case"[object DataView]":if(n.byteLength!=e.byteLength||n.byteOffset!=e.byteOffset)return!1;n=n.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(n.byteLength!=e.byteLength||!u(new s(n),new s(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return i(+n,+e);case"[object Error]":return n.name==e.name&&n.message==e.message;case"[object RegExp]":case"[object String]":return n==e+"";case"[object Map]":var p=l;case"[object Set]":var h=1&a;if(p||(p=o),n.size!=e.size&&!h)return!1;var g=m.get(n);if(g)return g==e;a|=2,m.set(n,e);var f=r(p(n),p(e),a,c,u,m);return m.delete(n),f;case"[object Symbol]":if(d)return d.call(n)==d.call(e)}return!1}},function(n,e,t){var a=t(8).Uint8Array;n.exports=a},function(n,e){n.exports=function(n){var e=-1,t=Array(n.size);return n.forEach((function(n,a){t[++e]=[a,n]})),t}},function(n,e,t){var a=t(190),s=Object.prototype.hasOwnProperty;n.exports=function(n,e,t,i,r,l){var o=1&t,c=a(n),d=c.length;if(d!=a(e).length&&!o)return!1;for(var u=d;u--;){var m=c[u];if(!(o?m in e:s.call(e,m)))return!1}var p=l.get(n),h=l.get(e);if(p&&h)return p==e&&h==n;var g=!0;l.set(n,e),l.set(e,n);for(var f=o;++u<d;){var b=n[m=c[u]],y=e[m];if(i)var v=o?i(y,b,m,e,n,l):i(b,y,m,n,e,l);if(!(void 0===v?b===y||r(b,y,t,i,l):v)){g=!1;break}f||(f="constructor"==m)}if(g&&!f){var _=n.constructor,E=e.constructor;_==E||!("constructor"in n)||!("constructor"in e)||"function"==typeof _&&_ instanceof _&&"function"==typeof E&&E instanceof E||(g=!1)}return l.delete(n),l.delete(e),g}},function(n,e,t){var a=t(191),s=t(192),i=t(79);n.exports=function(n){return a(n,i,s)}},function(n,e,t){var a=t(69),s=t(6);n.exports=function(n,e,t){var i=e(n);return s(n)?i:a(i,t(n))}},function(n,e,t){var a=t(193),s=t(194),i=Object.prototype.propertyIsEnumerable,r=Object.getOwnPropertySymbols,l=r?function(n){return null==n?[]:(n=Object(n),a(r(n),(function(e){return i.call(n,e)})))}:s;n.exports=l},function(n,e){n.exports=function(n,e){for(var t=-1,a=null==n?0:n.length,s=0,i=[];++t<a;){var r=n[t];e(r,t,n)&&(i[s++]=r)}return i}},function(n,e){n.exports=function(){return[]}},function(n,e,t){var a=t(196),s=t(39),i=t(6),r=t(80),l=t(81),o=t(82),c=Object.prototype.hasOwnProperty;n.exports=function(n,e){var t=i(n),d=!t&&s(n),u=!t&&!d&&r(n),m=!t&&!d&&!u&&o(n),p=t||d||u||m,h=p?a(n.length,String):[],g=h.length;for(var f in n)!e&&!c.call(n,f)||p&&("length"==f||u&&("offset"==f||"parent"==f)||m&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||l(f,g))||h.push(f);return h}},function(n,e){n.exports=function(n,e){for(var t=-1,a=Array(n);++t<n;)a[t]=e(t);return a}},function(n,e){n.exports=function(){return!1}},function(n,e,t){var a=t(13),s=t(44),i=t(12),r={};r["[object Float32Array]"]=r["[object Float64Array]"]=r["[object Int8Array]"]=r["[object Int16Array]"]=r["[object Int32Array]"]=r["[object Uint8Array]"]=r["[object Uint8ClampedArray]"]=r["[object Uint16Array]"]=r["[object Uint32Array]"]=!0,r["[object Arguments]"]=r["[object Array]"]=r["[object ArrayBuffer]"]=r["[object Boolean]"]=r["[object DataView]"]=r["[object Date]"]=r["[object Error]"]=r["[object Function]"]=r["[object Map]"]=r["[object Number]"]=r["[object Object]"]=r["[object RegExp]"]=r["[object Set]"]=r["[object String]"]=r["[object WeakMap]"]=!1,n.exports=function(n){return i(n)&&s(n.length)&&!!r[a(n)]}},function(n,e){n.exports=function(n){return function(e){return n(e)}}},function(n,e,t){(function(n){var a=t(70),s=e&&!e.nodeType&&e,i=s&&"object"==typeof n&&n&&!n.nodeType&&n,r=i&&i.exports===s&&a.process,l=function(){try{var n=i&&i.require&&i.require("util").types;return n||r&&r.binding&&r.binding("util")}catch(n){}}();n.exports=l}).call(this,t(51)(n))},function(n,e,t){var a=t(202),s=t(203),i=Object.prototype.hasOwnProperty;n.exports=function(n){if(!a(n))return s(n);var e=[];for(var t in Object(n))i.call(n,t)&&"constructor"!=t&&e.push(t);return e}},function(n,e){var t=Object.prototype;n.exports=function(n){var e=n&&n.constructor;return n===("function"==typeof e&&e.prototype||t)}},function(n,e,t){var a=t(204)(Object.keys,Object);n.exports=a},function(n,e){n.exports=function(n,e){return function(t){return n(e(t))}}},function(n,e,t){var a=t(206),s=t(40),i=t(207),r=t(84),l=t(208),o=t(13),c=t(74),d=c(a),u=c(s),m=c(i),p=c(r),h=c(l),g=o;(a&&"[object DataView]"!=g(new a(new ArrayBuffer(1)))||s&&"[object Map]"!=g(new s)||i&&"[object Promise]"!=g(i.resolve())||r&&"[object Set]"!=g(new r)||l&&"[object WeakMap]"!=g(new l))&&(g=function(n){var e=o(n),t="[object Object]"==e?n.constructor:void 0,a=t?c(t):"";if(a)switch(a){case d:return"[object DataView]";case u:return"[object Map]";case m:return"[object Promise]";case p:return"[object Set]";case h:return"[object WeakMap]"}return e}),n.exports=g},function(n,e,t){var a=t(10)(t(8),"DataView");n.exports=a},function(n,e,t){var a=t(10)(t(8),"Promise");n.exports=a},function(n,e,t){var a=t(10)(t(8),"WeakMap");n.exports=a},function(n,e,t){var a=t(85),s=t(79);n.exports=function(n){for(var e=s(n),t=e.length;t--;){var i=e[t],r=n[i];e[t]=[i,r,a(r)]}return e}},function(n,e,t){var a=t(75),s=t(211),i=t(218),r=t(45),l=t(85),o=t(86),c=t(23);n.exports=function(n,e){return r(n)&&l(e)?o(c(n),e):function(t){var r=s(t,n);return void 0===r&&r===e?i(t,n):a(e,r,3)}}},function(n,e,t){var a=t(87);n.exports=function(n,e,t){var s=null==n?void 0:a(n,e);return void 0===s?t:s}},function(n,e,t){var a=t(213),s=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,i=/\\(\\)?/g,r=a((function(n){var e=[];return 46===n.charCodeAt(0)&&e.push(""),n.replace(s,(function(n,t,a,s){e.push(a?s.replace(i,"$1"):t||n)})),e}));n.exports=r},function(n,e,t){var a=t(214);n.exports=function(n){var e=a(n,(function(n){return 500===t.size&&t.clear(),n})),t=e.cache;return e}},function(n,e,t){var a=t(42);function s(n,e){if("function"!=typeof n||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var t=function(){var a=arguments,s=e?e.apply(this,a):a[0],i=t.cache;if(i.has(s))return i.get(s);var r=n.apply(this,a);return t.cache=i.set(s,r)||i,r};return t.cache=new(s.Cache||a),t}s.Cache=a,n.exports=s},function(n,e,t){var a=t(216);n.exports=function(n){return null==n?"":a(n)}},function(n,e,t){var a=t(15),s=t(217),i=t(6),r=t(46),l=a?a.prototype:void 0,o=l?l.toString:void 0;n.exports=function n(e){if("string"==typeof e)return e;if(i(e))return s(e,n)+"";if(r(e))return o?o.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},function(n,e){n.exports=function(n,e){for(var t=-1,a=null==n?0:n.length,s=Array(a);++t<a;)s[t]=e(n[t],t,n);return s}},function(n,e,t){var a=t(219),s=t(220);n.exports=function(n,e){return null!=n&&s(n,e,a)}},function(n,e){n.exports=function(n,e){return null!=n&&e in Object(n)}},function(n,e,t){var a=t(88),s=t(39),i=t(6),r=t(81),l=t(44),o=t(23);n.exports=function(n,e,t){for(var c=-1,d=(e=a(e,n)).length,u=!1;++c<d;){var m=o(e[c]);if(!(u=null!=n&&t(n,m)))break;n=n[m]}return u||++c!=d?u:!!(d=null==n?0:n.length)&&l(d)&&r(m,d)&&(i(n)||s(n))}},function(n,e,t){var a=t(222),s=t(223),i=t(45),r=t(23);n.exports=function(n){return i(n)?a(r(n)):s(n)}},function(n,e){n.exports=function(n){return function(e){return null==e?void 0:e[n]}}},function(n,e,t){var a=t(87);n.exports=function(n){return function(e){return a(e,n)}}},function(n,e,t){var a=t(47),s=t(225),i=t(227);n.exports=function(n,e){return i(s(n,e,a),n+"")}},function(n,e,t){var a=t(226),s=Math.max;n.exports=function(n,e,t){return e=s(void 0===e?n.length-1:e,0),function(){for(var i=arguments,r=-1,l=s(i.length-e,0),o=Array(l);++r<l;)o[r]=i[e+r];r=-1;for(var c=Array(e+1);++r<e;)c[r]=i[r];return c[e]=t(o),a(n,this,c)}}},function(n,e){n.exports=function(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}},function(n,e,t){var a=t(228),s=t(231)(a);n.exports=s},function(n,e,t){var a=t(229),s=t(230),i=t(47),r=s?function(n,e){return s(n,"toString",{configurable:!0,enumerable:!1,value:a(e),writable:!0})}:i;n.exports=r},function(n,e){n.exports=function(n){return function(){return n}}},function(n,e,t){var a=t(10),s=function(){try{var n=a(Object,"defineProperty");return n({},"",{}),n}catch(n){}}();n.exports=s},function(n,e){var t=Date.now;n.exports=function(n){var e=0,a=0;return function(){var s=t(),i=16-(s-a);if(a=s,i>0){if(++e>=800)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}},function(n,e,t){var a=t(77),s=t(233),i=t(238),r=t(78),l=t(239),o=t(43);n.exports=function(n,e,t){var c=-1,d=s,u=n.length,m=!0,p=[],h=p;if(t)m=!1,d=i;else if(u>=200){var g=e?null:l(n);if(g)return o(g);m=!1,d=r,h=new a}else h=e?[]:p;n:for(;++c<u;){var f=n[c],b=e?e(f):f;if(f=t||0!==f?f:0,m&&b==b){for(var y=h.length;y--;)if(h[y]===b)continue n;e&&h.push(b),p.push(f)}else d(h,b,t)||(h!==p&&h.push(b),p.push(f))}return p}},function(n,e,t){var a=t(234);n.exports=function(n,e){return!!(null==n?0:n.length)&&a(n,e,0)>-1}},function(n,e,t){var a=t(235),s=t(236),i=t(237);n.exports=function(n,e,t){return e==e?i(n,e,t):a(n,s,t)}},function(n,e){n.exports=function(n,e,t,a){for(var s=n.length,i=t+(a?1:-1);a?i--:++i<s;)if(e(n[i],i,n))return i;return-1}},function(n,e){n.exports=function(n){return n!=n}},function(n,e){n.exports=function(n,e,t){for(var a=t-1,s=n.length;++a<s;)if(n[a]===e)return a;return-1}},function(n,e){n.exports=function(n,e,t){for(var a=-1,s=null==n?0:n.length;++a<s;)if(t(e,n[a]))return!0;return!1}},function(n,e,t){var a=t(84),s=t(240),i=t(43),r=a&&1/i(new a([,-0]))[1]==1/0?function(n){return new a(n)}:s;n.exports=r},function(n,e){n.exports=function(){}},function(n,e,t){var a=t(83),s=t(12);n.exports=function(n){return s(n)&&a(n)}},function(n,e,t){},function(n,e,t){},function(n,e,t){"use strict";t(89)},function(n,e,t){"use strict";t(90)},function(n,e,t){},function(n,e,t){},function(n,e){},function(n,e){function t(n,e){for(var t=0,a=n.length-1;a>=0;a--){var s=n[a];"."===s?n.splice(a,1):".."===s?(n.splice(a,1),t++):t&&(n.splice(a,1),t--)}if(e)for(;t--;t)n.unshift("..");return n}function a(n,e){if(n.filter)return n.filter(e);for(var t=[],a=0;a<n.length;a++)e(n[a],a,n)&&t.push(n[a]);return t}e.resolve=function(){for(var n="",e=!1,s=arguments.length-1;s>=-1&&!e;s--){var i=s>=0?arguments[s]:process.cwd();if("string"!=typeof i)throw new TypeError("Arguments to path.resolve must be strings");i&&(n=i+"/"+n,e="/"===i.charAt(0))}return(e?"/":"")+(n=t(a(n.split("/"),(function(n){return!!n})),!e).join("/"))||"."},e.normalize=function(n){var i=e.isAbsolute(n),r="/"===s(n,-1);return(n=t(a(n.split("/"),(function(n){return!!n})),!i).join("/"))||i||(n="."),n&&r&&(n+="/"),(i?"/":"")+n},e.isAbsolute=function(n){return"/"===n.charAt(0)},e.join=function(){var n=Array.prototype.slice.call(arguments,0);return e.normalize(a(n,(function(n,e){if("string"!=typeof n)throw new TypeError("Arguments to path.join must be strings");return n})).join("/"))},e.relative=function(n,t){function a(n){for(var e=0;e<n.length&&""===n[e];e++);for(var t=n.length-1;t>=0&&""===n[t];t--);return e>t?[]:n.slice(e,t-e+1)}n=e.resolve(n).substr(1),t=e.resolve(t).substr(1);for(var s=a(n.split("/")),i=a(t.split("/")),r=Math.min(s.length,i.length),l=r,o=0;o<r;o++)if(s[o]!==i[o]){l=o;break}var c=[];for(o=l;o<s.length;o++)c.push("..");return(c=c.concat(i.slice(l))).join("/")},e.sep="/",e.delimiter=":",e.dirname=function(n){if("string"!=typeof n&&(n+=""),0===n.length)return".";for(var e=n.charCodeAt(0),t=47===e,a=-1,s=!0,i=n.length-1;i>=1;--i)if(47===(e=n.charCodeAt(i))){if(!s){a=i;break}}else s=!1;return-1===a?t?"/":".":t&&1===a?"/":n.slice(0,a)},e.basename=function(n,e){var t=function(n){"string"!=typeof n&&(n+="");var e,t=0,a=-1,s=!0;for(e=n.length-1;e>=0;--e)if(47===n.charCodeAt(e)){if(!s){t=e+1;break}}else-1===a&&(s=!1,a=e+1);return-1===a?"":n.slice(t,a)}(n);return e&&t.substr(-1*e.length)===e&&(t=t.substr(0,t.length-e.length)),t},e.extname=function(n){"string"!=typeof n&&(n+="");for(var e=-1,t=0,a=-1,s=!0,i=0,r=n.length-1;r>=0;--r){var l=n.charCodeAt(r);if(47!==l)-1===a&&(s=!1,a=r+1),46===l?-1===e?e=r:1!==i&&(i=1):-1!==e&&(i=-1);else if(!s){t=r+1;break}}return-1===e||-1===a||0===i||1===i&&e===a-1&&e===t+1?"":n.slice(e,a)};var s="b"==="ab".substr(-1)?function(n,e,t){return n.substr(e,t)}:function(n,e,t){return e<0&&(e=n.length+e),n.substr(e,t)}},function(n,e,t){"use strict";var a=/[|\\{}()[\]^$+*?.]/g;e.escapeRegExpChars=function(n){return n?String(n).replace(a,"\\$&"):""};var s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},i=/[&<>'"]/g;function r(n){return s[n]||n}e.escapeXML=function(n){return null==n?"":String(n).replace(i,r)},e.escapeXML.toString=function(){return Function.prototype.toString.call(this)+';\nvar _ENCODE_HTML_RULES = {\n      "&": "&amp;"\n    , "<": "&lt;"\n    , ">": "&gt;"\n    , \'"\': "&#34;"\n    , "\'": "&#39;"\n    }\n  , _MATCH_HTML = /[&<>\'"]/g;\nfunction encode_char(c) {\n  return _ENCODE_HTML_RULES[c] || c;\n};\n'},e.shallowCopy=function(n,e){for(var t in e=e||{})n[t]=e[t];return n},e.shallowCopyFromList=function(n,e,t){for(var a=0;a<t.length;a++){var s=t[a];void 0!==e[s]&&(n[s]=e[s])}return n},e.cache={_data:{},set:function(n,e){this._data[n]=e},get:function(n){return this._data[n]},remove:function(n){delete this._data[n]},reset:function(){this._data={}}}},function(n){n.exports=JSON.parse('{"name":"ejs","description":"Embedded JavaScript templates","keywords":["template","engine","ejs"],"version":"2.7.4","author":"Matthew Eernisse <mde@fleegix.org> (http://fleegix.org)","license":"Apache-2.0","main":"./lib/ejs.js","repository":{"type":"git","url":"git://github.com/mde/ejs.git"},"bugs":"https://github.com/mde/ejs/issues","homepage":"https://github.com/mde/ejs","dependencies":{},"devDependencies":{"browserify":"^13.1.1","eslint":"^4.14.0","git-directory-deploy":"^1.5.1","jake":"^10.3.1","jsdoc":"^3.4.0","lru-cache":"^4.0.1","mocha":"^5.0.5","uglify-js":"^3.3.16"},"engines":{"node":">=0.10.0"},"scripts":{"test":"mocha","postinstall":"node ./postinstall.js"}}')},function(n,e,t){"use strict";t(91)},function(n,e,t){"use strict";t(92)},function(n,e,t){"use strict";t.r(e);
/*!
 * Vue.js v2.7.16
 * (c) 2014-2023 Evan You
 * Released under the MIT License.
 */
var a=Object.freeze({}),s=Array.isArray;function i(n){return null==n}function r(n){return null!=n}function l(n){return!0===n}function o(n){return"string"==typeof n||"number"==typeof n||"symbol"==typeof n||"boolean"==typeof n}function c(n){return"function"==typeof n}function d(n){return null!==n&&"object"==typeof n}var u=Object.prototype.toString;function m(n){return"[object Object]"===u.call(n)}function p(n){return"[object RegExp]"===u.call(n)}function h(n){var e=parseFloat(String(n));return e>=0&&Math.floor(e)===e&&isFinite(n)}function g(n){return r(n)&&"function"==typeof n.then&&"function"==typeof n.catch}function f(n){return null==n?"":Array.isArray(n)||m(n)&&n.toString===u?JSON.stringify(n,b,2):String(n)}function b(n,e){return e&&e.__v_isRef?e.value:e}function y(n){var e=parseFloat(n);return isNaN(e)?n:e}function v(n,e){for(var t=Object.create(null),a=n.split(","),s=0;s<a.length;s++)t[a[s]]=!0;return e?function(n){return t[n.toLowerCase()]}:function(n){return t[n]}}v("slot,component",!0);var _=v("key,ref,slot,slot-scope,is");function E(n,e){var t=n.length;if(t){if(e===n[t-1])return void(n.length=t-1);var a=n.indexOf(e);if(a>-1)return n.splice(a,1)}}var x=Object.prototype.hasOwnProperty;function T(n,e){return x.call(n,e)}function w(n){var e=Object.create(null);return function(t){return e[t]||(e[t]=n(t))}}var k=/-(\w)/g,I=w((function(n){return n.replace(k,(function(n,e){return e?e.toUpperCase():""}))})),S=w((function(n){return n.charAt(0).toUpperCase()+n.slice(1)})),q=/\B([A-Z])/g,R=w((function(n){return n.replace(q,"-$1").toLowerCase()}));var A=Function.prototype.bind?function(n,e){return n.bind(e)}:function(n,e){function t(t){var a=arguments.length;return a?a>1?n.apply(e,arguments):n.call(e,t):n.call(e)}return t._length=n.length,t};function B(n,e){e=e||0;for(var t=n.length-e,a=new Array(t);t--;)a[t]=n[t+e];return a}function L(n,e){for(var t in e)n[t]=e[t];return n}function z(n){for(var e={},t=0;t<n.length;t++)n[t]&&L(e,n[t]);return e}function D(n,e,t){}var M=function(n,e,t){return!1},C=function(n){return n};function O(n,e){if(n===e)return!0;var t=d(n),a=d(e);if(!t||!a)return!t&&!a&&String(n)===String(e);try{var s=Array.isArray(n),i=Array.isArray(e);if(s&&i)return n.length===e.length&&n.every((function(n,t){return O(n,e[t])}));if(n instanceof Date&&e instanceof Date)return n.getTime()===e.getTime();if(s||i)return!1;var r=Object.keys(n),l=Object.keys(e);return r.length===l.length&&r.every((function(t){return O(n[t],e[t])}))}catch(n){return!1}}function N(n,e){for(var t=0;t<n.length;t++)if(O(n[t],e))return t;return-1}function P(n){var e=!1;return function(){e||(e=!0,n.apply(this,arguments))}}function j(n,e){return n===e?0===n&&1/n!=1/e:n==n||e==e}var F=["component","directive","filter"],H=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured","serverPrefetch","renderTracked","renderTriggered"],U={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:M,isReservedAttr:M,isUnknownElement:M,getTagNamespace:D,parsePlatformTagName:C,mustUseProp:M,async:!0,_lifecycleHooks:H},$=/a-zA-Z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD/;function Q(n){var e=(n+"").charCodeAt(0);return 36===e||95===e}function G(n,e,t,a){Object.defineProperty(n,e,{value:t,enumerable:!!a,writable:!0,configurable:!0})}var K=new RegExp("[^".concat($.source,".$_\\d]"));var V="__proto__"in{},W="undefined"!=typeof window,J=W&&window.navigator.userAgent.toLowerCase(),X=J&&/msie|trident/.test(J),Y=J&&J.indexOf("msie 9.0")>0,Z=J&&J.indexOf("edge/")>0;J&&J.indexOf("android");var nn=J&&/iphone|ipad|ipod|ios/.test(J);J&&/chrome\/\d+/.test(J),J&&/phantomjs/.test(J);var en,tn=J&&J.match(/firefox\/(\d+)/),an={}.watch,sn=!1;if(W)try{var rn={};Object.defineProperty(rn,"passive",{get:function(){sn=!0}}),window.addEventListener("test-passive",null,rn)}catch(n){}var ln=function(){return void 0===en&&(en=!W&&"undefined"!=typeof global&&(global.process&&"server"===global.process.env.VUE_ENV)),en},on=W&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function cn(n){return"function"==typeof n&&/native code/.test(n.toString())}var dn,un="undefined"!=typeof Symbol&&cn(Symbol)&&"undefined"!=typeof Reflect&&cn(Reflect.ownKeys);dn="undefined"!=typeof Set&&cn(Set)?Set:function(){function n(){this.set=Object.create(null)}return n.prototype.has=function(n){return!0===this.set[n]},n.prototype.add=function(n){this.set[n]=!0},n.prototype.clear=function(){this.set=Object.create(null)},n}();var mn=null;function pn(n){void 0===n&&(n=null),n||mn&&mn._scope.off(),mn=n,n&&n._scope.on()}var hn=function(){function n(n,e,t,a,s,i,r,l){this.tag=n,this.data=e,this.children=t,this.text=a,this.elm=s,this.ns=void 0,this.context=i,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=e&&e.key,this.componentOptions=r,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=l,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1}return Object.defineProperty(n.prototype,"child",{get:function(){return this.componentInstance},enumerable:!1,configurable:!0}),n}(),gn=function(n){void 0===n&&(n="");var e=new hn;return e.text=n,e.isComment=!0,e};function fn(n){return new hn(void 0,void 0,void 0,String(n))}function bn(n){var e=new hn(n.tag,n.data,n.children&&n.children.slice(),n.text,n.elm,n.context,n.componentOptions,n.asyncFactory);return e.ns=n.ns,e.isStatic=n.isStatic,e.key=n.key,e.isComment=n.isComment,e.fnContext=n.fnContext,e.fnOptions=n.fnOptions,e.fnScopeId=n.fnScopeId,e.asyncMeta=n.asyncMeta,e.isCloned=!0,e}"function"==typeof SuppressedError&&SuppressedError;var yn=0,vn=[],_n=function(){function n(){this._pending=!1,this.id=yn++,this.subs=[]}return n.prototype.addSub=function(n){this.subs.push(n)},n.prototype.removeSub=function(n){this.subs[this.subs.indexOf(n)]=null,this._pending||(this._pending=!0,vn.push(this))},n.prototype.depend=function(e){n.target&&n.target.addDep(this)},n.prototype.notify=function(n){var e=this.subs.filter((function(n){return n}));for(var t=0,a=e.length;t<a;t++){0,e[t].update()}},n}();_n.target=null;var En=[];function xn(n){En.push(n),_n.target=n}function Tn(){En.pop(),_n.target=En[En.length-1]}var wn=Array.prototype,kn=Object.create(wn);["push","pop","shift","unshift","splice","sort","reverse"].forEach((function(n){var e=wn[n];G(kn,n,(function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];var s,i=e.apply(this,t),r=this.__ob__;switch(n){case"push":case"unshift":s=t;break;case"splice":s=t.slice(2)}return s&&r.observeArray(s),r.dep.notify(),i}))}));var In=Object.getOwnPropertyNames(kn),Sn={},qn=!0;function Rn(n){qn=n}var An={notify:D,depend:D,addSub:D,removeSub:D},Bn=function(){function n(n,e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),this.value=n,this.shallow=e,this.mock=t,this.dep=t?An:new _n,this.vmCount=0,G(n,"__ob__",this),s(n)){if(!t)if(V)n.__proto__=kn;else for(var a=0,i=In.length;a<i;a++){G(n,l=In[a],kn[l])}e||this.observeArray(n)}else{var r=Object.keys(n);for(a=0;a<r.length;a++){var l;zn(n,l=r[a],Sn,void 0,e,t)}}}return n.prototype.observeArray=function(n){for(var e=0,t=n.length;e<t;e++)Ln(n[e],!1,this.mock)},n}();function Ln(n,e,t){return n&&T(n,"__ob__")&&n.__ob__ instanceof Bn?n.__ob__:!qn||!t&&ln()||!s(n)&&!m(n)||!Object.isExtensible(n)||n.__v_skip||jn(n)||n instanceof hn?void 0:new Bn(n,e,t)}function zn(n,e,t,a,i,r,l){void 0===l&&(l=!1);var o=new _n,c=Object.getOwnPropertyDescriptor(n,e);if(!c||!1!==c.configurable){var d=c&&c.get,u=c&&c.set;d&&!u||t!==Sn&&2!==arguments.length||(t=n[e]);var m=i?t&&t.__ob__:Ln(t,!1,r);return Object.defineProperty(n,e,{enumerable:!0,configurable:!0,get:function(){var e=d?d.call(n):t;return _n.target&&(o.depend(),m&&(m.dep.depend(),s(e)&&Cn(e))),jn(e)&&!i?e.value:e},set:function(e){var a=d?d.call(n):t;if(j(a,e)){if(u)u.call(n,e);else{if(d)return;if(!i&&jn(a)&&!jn(e))return void(a.value=e);t=e}m=i?e&&e.__ob__:Ln(e,!1,r),o.notify()}}}),o}}function Dn(n,e,t){if(!Pn(n)){var a=n.__ob__;return s(n)&&h(e)?(n.length=Math.max(n.length,e),n.splice(e,1,t),a&&!a.shallow&&a.mock&&Ln(t,!1,!0),t):e in n&&!(e in Object.prototype)?(n[e]=t,t):n._isVue||a&&a.vmCount?t:a?(zn(a.value,e,t,void 0,a.shallow,a.mock),a.dep.notify(),t):(n[e]=t,t)}}function Mn(n,e){if(s(n)&&h(e))n.splice(e,1);else{var t=n.__ob__;n._isVue||t&&t.vmCount||Pn(n)||T(n,e)&&(delete n[e],t&&t.dep.notify())}}function Cn(n){for(var e=void 0,t=0,a=n.length;t<a;t++)(e=n[t])&&e.__ob__&&e.__ob__.dep.depend(),s(e)&&Cn(e)}function On(n){return Nn(n,!0),G(n,"__v_isShallow",!0),n}function Nn(n,e){if(!Pn(n)){Ln(n,e,ln());0}}function Pn(n){return!(!n||!n.__v_isReadonly)}function jn(n){return!(!n||!0!==n.__v_isRef)}function Fn(n,e,t){Object.defineProperty(n,t,{enumerable:!0,configurable:!0,get:function(){var n=e[t];if(jn(n))return n.value;var a=n&&n.__ob__;return a&&a.dep.depend(),n},set:function(n){var a=e[t];jn(a)&&!jn(n)?a.value=n:e[t]=n}})}"".concat("watcher"," callback"),"".concat("watcher"," getter"),"".concat("watcher"," cleanup");var Hn;var Un=function(){function n(n){void 0===n&&(n=!1),this.detached=n,this.active=!0,this.effects=[],this.cleanups=[],this.parent=Hn,!n&&Hn&&(this.index=(Hn.scopes||(Hn.scopes=[])).push(this)-1)}return n.prototype.run=function(n){if(this.active){var e=Hn;try{return Hn=this,n()}finally{Hn=e}}else 0},n.prototype.on=function(){Hn=this},n.prototype.off=function(){Hn=this.parent},n.prototype.stop=function(n){if(this.active){var e=void 0,t=void 0;for(e=0,t=this.effects.length;e<t;e++)this.effects[e].teardown();for(e=0,t=this.cleanups.length;e<t;e++)this.cleanups[e]();if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].stop(!0);if(!this.detached&&this.parent&&!n){var a=this.parent.scopes.pop();a&&a!==this&&(this.parent.scopes[this.index]=a,a.index=this.index)}this.parent=void 0,this.active=!1}},n}();function $n(n){var e=n._provided,t=n.$parent&&n.$parent._provided;return t===e?n._provided=Object.create(t):e}var Qn=w((function(n){var e="&"===n.charAt(0),t="~"===(n=e?n.slice(1):n).charAt(0),a="!"===(n=t?n.slice(1):n).charAt(0);return{name:n=a?n.slice(1):n,once:t,capture:a,passive:e}}));function Gn(n,e){function t(){var n=t.fns;if(!s(n))return qe(n,null,arguments,e,"v-on handler");for(var a=n.slice(),i=0;i<a.length;i++)qe(a[i],null,arguments,e,"v-on handler")}return t.fns=n,t}function Kn(n,e,t,a,s,r){var o,c,d,u;for(o in n)c=n[o],d=e[o],u=Qn(o),i(c)||(i(d)?(i(c.fns)&&(c=n[o]=Gn(c,r)),l(u.once)&&(c=n[o]=s(u.name,c,u.capture)),t(u.name,c,u.capture,u.passive,u.params)):c!==d&&(d.fns=c,n[o]=d));for(o in e)i(n[o])&&a((u=Qn(o)).name,e[o],u.capture)}function Vn(n,e,t){var a;n instanceof hn&&(n=n.data.hook||(n.data.hook={}));var s=n[e];function o(){t.apply(this,arguments),E(a.fns,o)}i(s)?a=Gn([o]):r(s.fns)&&l(s.merged)?(a=s).fns.push(o):a=Gn([s,o]),a.merged=!0,n[e]=a}function Wn(n,e,t,a,s){if(r(e)){if(T(e,t))return n[t]=e[t],s||delete e[t],!0;if(T(e,a))return n[t]=e[a],s||delete e[a],!0}return!1}function Jn(n){return o(n)?[fn(n)]:s(n)?function n(e,t){var a,c,d,u,m=[];for(a=0;a<e.length;a++)i(c=e[a])||"boolean"==typeof c||(d=m.length-1,u=m[d],s(c)?c.length>0&&(Xn((c=n(c,"".concat(t||"","_").concat(a)))[0])&&Xn(u)&&(m[d]=fn(u.text+c[0].text),c.shift()),m.push.apply(m,c)):o(c)?Xn(u)?m[d]=fn(u.text+c):""!==c&&m.push(fn(c)):Xn(c)&&Xn(u)?m[d]=fn(u.text+c.text):(l(e._isVList)&&r(c.tag)&&i(c.key)&&r(t)&&(c.key="__vlist".concat(t,"_").concat(a,"__")),m.push(c)));return m}(n):void 0}function Xn(n){return r(n)&&r(n.text)&&!1===n.isComment}function Yn(n,e){var t,a,i,l,o=null;if(s(n)||"string"==typeof n)for(o=new Array(n.length),t=0,a=n.length;t<a;t++)o[t]=e(n[t],t);else if("number"==typeof n)for(o=new Array(n),t=0;t<n;t++)o[t]=e(t+1,t);else if(d(n))if(un&&n[Symbol.iterator]){o=[];for(var c=n[Symbol.iterator](),u=c.next();!u.done;)o.push(e(u.value,o.length)),u=c.next()}else for(i=Object.keys(n),o=new Array(i.length),t=0,a=i.length;t<a;t++)l=i[t],o[t]=e(n[l],l,t);return r(o)||(o=[]),o._isVList=!0,o}function Zn(n,e,t,a){var s,i=this.$scopedSlots[n];i?(t=t||{},a&&(t=L(L({},a),t)),s=i(t)||(c(e)?e():e)):s=this.$slots[n]||(c(e)?e():e);var r=t&&t.slot;return r?this.$createElement("template",{slot:r},s):s}function ne(n){return Bt(this.$options,"filters",n,!0)||C}function ee(n,e){return s(n)?-1===n.indexOf(e):n!==e}function te(n,e,t,a,s){var i=U.keyCodes[e]||t;return s&&a&&!U.keyCodes[e]?ee(s,a):i?ee(i,n):a?R(a)!==e:void 0===n}function ae(n,e,t,a,i){if(t)if(d(t)){s(t)&&(t=z(t));var r=void 0,l=function(s){if("class"===s||"style"===s||_(s))r=n;else{var l=n.attrs&&n.attrs.type;r=a||U.mustUseProp(e,l,s)?n.domProps||(n.domProps={}):n.attrs||(n.attrs={})}var o=I(s),c=R(s);o in r||c in r||(r[s]=t[s],i&&((n.on||(n.on={}))["update:".concat(s)]=function(n){t[s]=n}))};for(var o in t)l(o)}else;return n}function se(n,e){var t=this._staticTrees||(this._staticTrees=[]),a=t[n];return a&&!e||re(a=t[n]=this.$options.staticRenderFns[n].call(this._renderProxy,this._c,this),"__static__".concat(n),!1),a}function ie(n,e,t){return re(n,"__once__".concat(e).concat(t?"_".concat(t):""),!0),n}function re(n,e,t){if(s(n))for(var a=0;a<n.length;a++)n[a]&&"string"!=typeof n[a]&&le(n[a],"".concat(e,"_").concat(a),t);else le(n,e,t)}function le(n,e,t){n.isStatic=!0,n.key=e,n.isOnce=t}function oe(n,e){if(e)if(m(e)){var t=n.on=n.on?L({},n.on):{};for(var a in e){var s=t[a],i=e[a];t[a]=s?[].concat(s,i):i}}else;return n}function ce(n,e,t,a){e=e||{$stable:!t};for(var i=0;i<n.length;i++){var r=n[i];s(r)?ce(r,e,t):r&&(r.proxy&&(r.fn.proxy=!0),e[r.key]=r.fn)}return a&&(e.$key=a),e}function de(n,e){for(var t=0;t<e.length;t+=2){var a=e[t];"string"==typeof a&&a&&(n[e[t]]=e[t+1])}return n}function ue(n,e){return"string"==typeof n?e+n:n}function me(n){n._o=ie,n._n=y,n._s=f,n._l=Yn,n._t=Zn,n._q=O,n._i=N,n._m=se,n._f=ne,n._k=te,n._b=ae,n._v=fn,n._e=gn,n._u=ce,n._g=oe,n._d=de,n._p=ue}function pe(n,e){if(!n||!n.length)return{};for(var t={},a=0,s=n.length;a<s;a++){var i=n[a],r=i.data;if(r&&r.attrs&&r.attrs.slot&&delete r.attrs.slot,i.context!==e&&i.fnContext!==e||!r||null==r.slot)(t.default||(t.default=[])).push(i);else{var l=r.slot,o=t[l]||(t[l]=[]);"template"===i.tag?o.push.apply(o,i.children||[]):o.push(i)}}for(var c in t)t[c].every(he)&&delete t[c];return t}function he(n){return n.isComment&&!n.asyncFactory||" "===n.text}function ge(n){return n.isComment&&n.asyncFactory}function fe(n,e,t,s){var i,r=Object.keys(t).length>0,l=e?!!e.$stable:!r,o=e&&e.$key;if(e){if(e._normalized)return e._normalized;if(l&&s&&s!==a&&o===s.$key&&!r&&!s.$hasNormal)return s;for(var c in i={},e)e[c]&&"$"!==c[0]&&(i[c]=be(n,t,c,e[c]))}else i={};for(var d in t)d in i||(i[d]=ye(t,d));return e&&Object.isExtensible(e)&&(e._normalized=i),G(i,"$stable",l),G(i,"$key",o),G(i,"$hasNormal",r),i}function be(n,e,t,a){var i=function(){var e=mn;pn(n);var t=arguments.length?a.apply(null,arguments):a({}),i=(t=t&&"object"==typeof t&&!s(t)?[t]:Jn(t))&&t[0];return pn(e),t&&(!i||1===t.length&&i.isComment&&!ge(i))?void 0:t};return a.proxy&&Object.defineProperty(e,t,{get:i,enumerable:!0,configurable:!0}),i}function ye(n,e){return function(){return n[e]}}function ve(n){return{get attrs(){if(!n._attrsProxy){var e=n._attrsProxy={};G(e,"_v_attr_proxy",!0),_e(e,n.$attrs,a,n,"$attrs")}return n._attrsProxy},get listeners(){n._listenersProxy||_e(n._listenersProxy={},n.$listeners,a,n,"$listeners");return n._listenersProxy},get slots(){return function(n){n._slotsProxy||xe(n._slotsProxy={},n.$scopedSlots);return n._slotsProxy}(n)},emit:A(n.$emit,n),expose:function(e){e&&Object.keys(e).forEach((function(t){return Fn(n,e,t)}))}}}function _e(n,e,t,a,s){var i=!1;for(var r in e)r in n?e[r]!==t[r]&&(i=!0):(i=!0,Ee(n,r,a,s));for(var r in n)r in e||(i=!0,delete n[r]);return i}function Ee(n,e,t,a){Object.defineProperty(n,e,{enumerable:!0,configurable:!0,get:function(){return t[a][e]}})}function xe(n,e){for(var t in e)n[t]=e[t];for(var t in n)t in e||delete n[t]}var Te=null;function we(n,e){return(n.__esModule||un&&"Module"===n[Symbol.toStringTag])&&(n=n.default),d(n)?e.extend(n):n}function ke(n){if(s(n))for(var e=0;e<n.length;e++){var t=n[e];if(r(t)&&(r(t.componentOptions)||ge(t)))return t}}function Ie(n,e,t,a,u,m){return(s(t)||o(t))&&(u=a,a=t,t=void 0),l(m)&&(u=2),function(n,e,t,a,o){if(r(t)&&r(t.__ob__))return gn();r(t)&&r(t.is)&&(e=t.is);if(!e)return gn();0;s(a)&&c(a[0])&&((t=t||{}).scopedSlots={default:a[0]},a.length=0);2===o?a=Jn(a):1===o&&(a=function(n){for(var e=0;e<n.length;e++)if(s(n[e]))return Array.prototype.concat.apply([],n);return n}(a));var u,m;if("string"==typeof e){var p=void 0;m=n.$vnode&&n.$vnode.ns||U.getTagNamespace(e),u=U.isReservedTag(e)?new hn(U.parsePlatformTagName(e),t,a,void 0,void 0,n):t&&t.pre||!r(p=Bt(n.$options,"components",e))?new hn(e,t,a,void 0,void 0,n):Et(p,t,n,a,e)}else u=Et(e,t,n,a);return s(u)?u:r(u)?(r(m)&&function n(e,t,a){e.ns=t,"foreignObject"===e.tag&&(t=void 0,a=!0);if(r(e.children))for(var s=0,o=e.children.length;s<o;s++){var c=e.children[s];r(c.tag)&&(i(c.ns)||l(a)&&"svg"!==c.tag)&&n(c,t,a)}}(u,m),r(t)&&function(n){d(n.style)&&Ue(n.style);d(n.class)&&Ue(n.class)}(t),u):gn()}(n,e,t,a,u)}function Se(n,e,t){xn();try{if(e)for(var a=e;a=a.$parent;){var s=a.$options.errorCaptured;if(s)for(var i=0;i<s.length;i++)try{if(!1===s[i].call(a,n,e,t))return}catch(n){Re(n,a,"errorCaptured hook")}}Re(n,e,t)}finally{Tn()}}function qe(n,e,t,a,s){var i;try{(i=t?n.apply(e,t):n.call(e))&&!i._isVue&&g(i)&&!i._handled&&(i.catch((function(n){return Se(n,a,s+" (Promise/async)")})),i._handled=!0)}catch(n){Se(n,a,s)}return i}function Re(n,e,t){if(U.errorHandler)try{return U.errorHandler.call(null,n,e,t)}catch(e){e!==n&&Ae(e,null,"config.errorHandler")}Ae(n,e,t)}function Ae(n,e,t){if(!W||"undefined"==typeof console)throw n;console.error(n)}var Be,Le=!1,ze=[],De=!1;function Me(){De=!1;var n=ze.slice(0);ze.length=0;for(var e=0;e<n.length;e++)n[e]()}if("undefined"!=typeof Promise&&cn(Promise)){var Ce=Promise.resolve();Be=function(){Ce.then(Me),nn&&setTimeout(D)},Le=!0}else if(X||"undefined"==typeof MutationObserver||!cn(MutationObserver)&&"[object MutationObserverConstructor]"!==MutationObserver.toString())Be="undefined"!=typeof setImmediate&&cn(setImmediate)?function(){setImmediate(Me)}:function(){setTimeout(Me,0)};else{var Oe=1,Ne=new MutationObserver(Me),Pe=document.createTextNode(String(Oe));Ne.observe(Pe,{characterData:!0}),Be=function(){Oe=(Oe+1)%2,Pe.data=String(Oe)},Le=!0}function je(n,e){var t;if(ze.push((function(){if(n)try{n.call(e)}catch(n){Se(n,e,"nextTick")}else t&&t(e)})),De||(De=!0,Be()),!n&&"undefined"!=typeof Promise)return new Promise((function(n){t=n}))}function Fe(n){return function(e,t){if(void 0===t&&(t=mn),t)return function(n,e,t){var a=n.$options;a[e]=St(a[e],t)}(t,n,e)}}Fe("beforeMount"),Fe("mounted"),Fe("beforeUpdate"),Fe("updated"),Fe("beforeDestroy"),Fe("destroyed"),Fe("activated"),Fe("deactivated"),Fe("serverPrefetch"),Fe("renderTracked"),Fe("renderTriggered"),Fe("errorCaptured");var He=new dn;function Ue(n){return function n(e,t){var a,i,r=s(e);if(!r&&!d(e)||e.__v_skip||Object.isFrozen(e)||e instanceof hn)return;if(e.__ob__){var l=e.__ob__.dep.id;if(t.has(l))return;t.add(l)}if(r)for(a=e.length;a--;)n(e[a],t);else if(jn(e))n(e.value,t);else for(i=Object.keys(e),a=i.length;a--;)n(e[i[a]],t)}(n,He),He.clear(),n}var $e,Qe=0,Ge=function(){function n(n,e,t,a,s){var i,r;i=this,void 0===(r=Hn&&!Hn._vm?Hn:n?n._scope:void 0)&&(r=Hn),r&&r.active&&r.effects.push(i),(this.vm=n)&&s&&(n._watcher=this),a?(this.deep=!!a.deep,this.user=!!a.user,this.lazy=!!a.lazy,this.sync=!!a.sync,this.before=a.before):this.deep=this.user=this.lazy=this.sync=!1,this.cb=t,this.id=++Qe,this.active=!0,this.post=!1,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new dn,this.newDepIds=new dn,this.expression="",c(e)?this.getter=e:(this.getter=function(n){if(!K.test(n)){var e=n.split(".");return function(n){for(var t=0;t<e.length;t++){if(!n)return;n=n[e[t]]}return n}}}(e),this.getter||(this.getter=D)),this.value=this.lazy?void 0:this.get()}return n.prototype.get=function(){var n;xn(this);var e=this.vm;try{n=this.getter.call(e,e)}catch(n){if(!this.user)throw n;Se(n,e,'getter for watcher "'.concat(this.expression,'"'))}finally{this.deep&&Ue(n),Tn(),this.cleanupDeps()}return n},n.prototype.addDep=function(n){var e=n.id;this.newDepIds.has(e)||(this.newDepIds.add(e),this.newDeps.push(n),this.depIds.has(e)||n.addSub(this))},n.prototype.cleanupDeps=function(){for(var n=this.deps.length;n--;){var e=this.deps[n];this.newDepIds.has(e.id)||e.removeSub(this)}var t=this.depIds;this.depIds=this.newDepIds,this.newDepIds=t,this.newDepIds.clear(),t=this.deps,this.deps=this.newDeps,this.newDeps=t,this.newDeps.length=0},n.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():pt(this)},n.prototype.run=function(){if(this.active){var n=this.get();if(n!==this.value||d(n)||this.deep){var e=this.value;if(this.value=n,this.user){var t='callback for watcher "'.concat(this.expression,'"');qe(this.cb,this.vm,[n,e],this.vm,t)}else this.cb.call(this.vm,n,e)}}},n.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},n.prototype.depend=function(){for(var n=this.deps.length;n--;)this.deps[n].depend()},n.prototype.teardown=function(){if(this.vm&&!this.vm._isBeingDestroyed&&E(this.vm._scope.effects,this),this.active){for(var n=this.deps.length;n--;)this.deps[n].removeSub(this);this.active=!1,this.onStop&&this.onStop()}},n}();function Ke(n,e){$e.$on(n,e)}function Ve(n,e){$e.$off(n,e)}function We(n,e){var t=$e;return function a(){var s=e.apply(null,arguments);null!==s&&t.$off(n,a)}}function Je(n,e,t){$e=n,Kn(e,t||{},Ke,Ve,We,n),$e=void 0}var Xe=null;function Ye(n){var e=Xe;return Xe=n,function(){Xe=e}}function Ze(n){for(;n&&(n=n.$parent);)if(n._inactive)return!0;return!1}function nt(n,e){if(e){if(n._directInactive=!1,Ze(n))return}else if(n._directInactive)return;if(n._inactive||null===n._inactive){n._inactive=!1;for(var t=0;t<n.$children.length;t++)nt(n.$children[t]);et(n,"activated")}}function et(n,e,t,a){void 0===a&&(a=!0),xn();var s=mn,i=Hn;a&&pn(n);var r=n.$options[e],l="".concat(e," hook");if(r)for(var o=0,c=r.length;o<c;o++)qe(r[o],n,t||null,n,l);n._hasHookEvent&&n.$emit("hook:"+e),a&&(pn(s),i&&i.on()),Tn()}var tt=[],at=[],st={},it=!1,rt=!1,lt=0;var ot=0,ct=Date.now;if(W&&!X){var dt=window.performance;dt&&"function"==typeof dt.now&&ct()>document.createEvent("Event").timeStamp&&(ct=function(){return dt.now()})}var ut=function(n,e){if(n.post){if(!e.post)return 1}else if(e.post)return-1;return n.id-e.id};function mt(){var n,e;for(ot=ct(),rt=!0,tt.sort(ut),lt=0;lt<tt.length;lt++)(n=tt[lt]).before&&n.before(),e=n.id,st[e]=null,n.run();var t=at.slice(),a=tt.slice();lt=tt.length=at.length=0,st={},it=rt=!1,function(n){for(var e=0;e<n.length;e++)n[e]._inactive=!0,nt(n[e],!0)}(t),function(n){var e=n.length;for(;e--;){var t=n[e],a=t.vm;a&&a._watcher===t&&a._isMounted&&!a._isDestroyed&&et(a,"updated")}}(a),function(){for(var n=0;n<vn.length;n++){var e=vn[n];e.subs=e.subs.filter((function(n){return n})),e._pending=!1}vn.length=0}(),on&&U.devtools&&on.emit("flush")}function pt(n){var e=n.id;if(null==st[e]&&(n!==_n.target||!n.noRecurse)){if(st[e]=!0,rt){for(var t=tt.length-1;t>lt&&tt[t].id>n.id;)t--;tt.splice(t+1,0,n)}else tt.push(n);it||(it=!0,je(mt))}}function ht(n,e){if(n){for(var t=Object.create(null),a=un?Reflect.ownKeys(n):Object.keys(n),s=0;s<a.length;s++){var i=a[s];if("__ob__"!==i){var r=n[i].from;if(r in e._provided)t[i]=e._provided[r];else if("default"in n[i]){var l=n[i].default;t[i]=c(l)?l.call(e):l}else 0}}return t}}function gt(n,e,t,i,r){var o,c=this,d=r.options;T(i,"_uid")?(o=Object.create(i))._original=i:(o=i,i=i._original);var u=l(d._compiled),m=!u;this.data=n,this.props=e,this.children=t,this.parent=i,this.listeners=n.on||a,this.injections=ht(d.inject,i),this.slots=function(){return c.$slots||fe(i,n.scopedSlots,c.$slots=pe(t,i)),c.$slots},Object.defineProperty(this,"scopedSlots",{enumerable:!0,get:function(){return fe(i,n.scopedSlots,this.slots())}}),u&&(this.$options=d,this.$slots=this.slots(),this.$scopedSlots=fe(i,n.scopedSlots,this.$slots)),d._scopeId?this._c=function(n,e,t,a){var r=Ie(o,n,e,t,a,m);return r&&!s(r)&&(r.fnScopeId=d._scopeId,r.fnContext=i),r}:this._c=function(n,e,t,a){return Ie(o,n,e,t,a,m)}}function ft(n,e,t,a,s){var i=bn(n);return i.fnContext=t,i.fnOptions=a,e.slot&&((i.data||(i.data={})).slot=e.slot),i}function bt(n,e){for(var t in e)n[I(t)]=e[t]}function yt(n){return n.name||n.__name||n._componentTag}me(gt.prototype);var vt={init:function(n,e){if(n.componentInstance&&!n.componentInstance._isDestroyed&&n.data.keepAlive){var t=n;vt.prepatch(t,t)}else{(n.componentInstance=function(n,e){var t={_isComponent:!0,_parentVnode:n,parent:e},a=n.data.inlineTemplate;r(a)&&(t.render=a.render,t.staticRenderFns=a.staticRenderFns);return new n.componentOptions.Ctor(t)}(n,Xe)).$mount(e?n.elm:void 0,e)}},prepatch:function(n,e){var t=e.componentOptions;!function(n,e,t,s,i){var r=s.data.scopedSlots,l=n.$scopedSlots,o=!!(r&&!r.$stable||l!==a&&!l.$stable||r&&n.$scopedSlots.$key!==r.$key||!r&&n.$scopedSlots.$key),c=!!(i||n.$options._renderChildren||o),d=n.$vnode;n.$options._parentVnode=s,n.$vnode=s,n._vnode&&(n._vnode.parent=s),n.$options._renderChildren=i;var u=s.data.attrs||a;n._attrsProxy&&_e(n._attrsProxy,u,d.data&&d.data.attrs||a,n,"$attrs")&&(c=!0),n.$attrs=u,t=t||a;var m=n.$options._parentListeners;if(n._listenersProxy&&_e(n._listenersProxy,t,m||a,n,"$listeners"),n.$listeners=n.$options._parentListeners=t,Je(n,t,m),e&&n.$options.props){Rn(!1);for(var p=n._props,h=n.$options._propKeys||[],g=0;g<h.length;g++){var f=h[g],b=n.$options.props;p[f]=Lt(f,b,e,n)}Rn(!0),n.$options.propsData=e}c&&(n.$slots=pe(i,s.context),n.$forceUpdate())}(e.componentInstance=n.componentInstance,t.propsData,t.listeners,e,t.children)},insert:function(n){var e,t=n.context,a=n.componentInstance;a._isMounted||(a._isMounted=!0,et(a,"mounted")),n.data.keepAlive&&(t._isMounted?((e=a)._inactive=!1,at.push(e)):nt(a,!0))},destroy:function(n){var e=n.componentInstance;e._isDestroyed||(n.data.keepAlive?function n(e,t){if(!(t&&(e._directInactive=!0,Ze(e))||e._inactive)){e._inactive=!0;for(var a=0;a<e.$children.length;a++)n(e.$children[a]);et(e,"deactivated")}}(e,!0):e.$destroy())}},_t=Object.keys(vt);function Et(n,e,t,o,c){if(!i(n)){var u=t.$options._base;if(d(n)&&(n=u.extend(n)),"function"==typeof n){var m;if(i(n.cid)&&void 0===(n=function(n,e){if(l(n.error)&&r(n.errorComp))return n.errorComp;if(r(n.resolved))return n.resolved;var t=Te;if(t&&r(n.owners)&&-1===n.owners.indexOf(t)&&n.owners.push(t),l(n.loading)&&r(n.loadingComp))return n.loadingComp;if(t&&!r(n.owners)){var a=n.owners=[t],s=!0,o=null,c=null;t.$on("hook:destroyed",(function(){return E(a,t)}));var u=function(n){for(var e=0,t=a.length;e<t;e++)a[e].$forceUpdate();n&&(a.length=0,null!==o&&(clearTimeout(o),o=null),null!==c&&(clearTimeout(c),c=null))},m=P((function(t){n.resolved=we(t,e),s?a.length=0:u(!0)})),p=P((function(e){r(n.errorComp)&&(n.error=!0,u(!0))})),h=n(m,p);return d(h)&&(g(h)?i(n.resolved)&&h.then(m,p):g(h.component)&&(h.component.then(m,p),r(h.error)&&(n.errorComp=we(h.error,e)),r(h.loading)&&(n.loadingComp=we(h.loading,e),0===h.delay?n.loading=!0:o=setTimeout((function(){o=null,i(n.resolved)&&i(n.error)&&(n.loading=!0,u(!1))}),h.delay||200)),r(h.timeout)&&(c=setTimeout((function(){c=null,i(n.resolved)&&p(null)}),h.timeout)))),s=!1,n.loading?n.loadingComp:n.resolved}}(m=n,u)))return function(n,e,t,a,s){var i=gn();return i.asyncFactory=n,i.asyncMeta={data:e,context:t,children:a,tag:s},i}(m,e,t,o,c);e=e||{},Gt(n),r(e.model)&&function(n,e){var t=n.model&&n.model.prop||"value",a=n.model&&n.model.event||"input";(e.attrs||(e.attrs={}))[t]=e.model.value;var i=e.on||(e.on={}),l=i[a],o=e.model.callback;r(l)?(s(l)?-1===l.indexOf(o):l!==o)&&(i[a]=[o].concat(l)):i[a]=o}(n.options,e);var p=function(n,e,t){var a=e.options.props;if(!i(a)){var s={},l=n.attrs,o=n.props;if(r(l)||r(o))for(var c in a){var d=R(c);Wn(s,o,c,d,!0)||Wn(s,l,c,d,!1)}return s}}(e,n);if(l(n.options.functional))return function(n,e,t,i,l){var o=n.options,c={},d=o.props;if(r(d))for(var u in d)c[u]=Lt(u,d,e||a);else r(t.attrs)&&bt(c,t.attrs),r(t.props)&&bt(c,t.props);var m=new gt(t,c,l,i,n),p=o.render.call(null,m._c,m);if(p instanceof hn)return ft(p,t,m.parent,o,m);if(s(p)){for(var h=Jn(p)||[],g=new Array(h.length),f=0;f<h.length;f++)g[f]=ft(h[f],t,m.parent,o,m);return g}}(n,p,e,t,o);var h=e.on;if(e.on=e.nativeOn,l(n.options.abstract)){var f=e.slot;e={},f&&(e.slot=f)}!function(n){for(var e=n.hook||(n.hook={}),t=0;t<_t.length;t++){var a=_t[t],s=e[a],i=vt[a];s===i||s&&s._merged||(e[a]=s?xt(i,s):i)}}(e);var b=yt(n.options)||c;return new hn("vue-component-".concat(n.cid).concat(b?"-".concat(b):""),e,void 0,void 0,void 0,t,{Ctor:n,propsData:p,listeners:h,tag:c,children:o},m)}}}function xt(n,e){var t=function(t,a){n(t,a),e(t,a)};return t._merged=!0,t}var Tt=D,wt=U.optionMergeStrategies;function kt(n,e,t){if(void 0===t&&(t=!0),!e)return n;for(var a,s,i,r=un?Reflect.ownKeys(e):Object.keys(e),l=0;l<r.length;l++)"__ob__"!==(a=r[l])&&(s=n[a],i=e[a],t&&T(n,a)?s!==i&&m(s)&&m(i)&&kt(s,i):Dn(n,a,i));return n}function It(n,e,t){return t?function(){var a=c(e)?e.call(t,t):e,s=c(n)?n.call(t,t):n;return a?kt(a,s):s}:e?n?function(){return kt(c(e)?e.call(this,this):e,c(n)?n.call(this,this):n)}:e:n}function St(n,e){var t=e?n?n.concat(e):s(e)?e:[e]:n;return t?function(n){for(var e=[],t=0;t<n.length;t++)-1===e.indexOf(n[t])&&e.push(n[t]);return e}(t):t}function qt(n,e,t,a){var s=Object.create(n||null);return e?L(s,e):s}wt.data=function(n,e,t){return t?It(n,e,t):e&&"function"!=typeof e?n:It(n,e)},H.forEach((function(n){wt[n]=St})),F.forEach((function(n){wt[n+"s"]=qt})),wt.watch=function(n,e,t,a){if(n===an&&(n=void 0),e===an&&(e=void 0),!e)return Object.create(n||null);if(!n)return e;var i={};for(var r in L(i,n),e){var l=i[r],o=e[r];l&&!s(l)&&(l=[l]),i[r]=l?l.concat(o):s(o)?o:[o]}return i},wt.props=wt.methods=wt.inject=wt.computed=function(n,e,t,a){if(!n)return e;var s=Object.create(null);return L(s,n),e&&L(s,e),s},wt.provide=function(n,e){return n?function(){var t=Object.create(null);return kt(t,c(n)?n.call(this):n),e&&kt(t,c(e)?e.call(this):e,!1),t}:e};var Rt=function(n,e){return void 0===e?n:e};function At(n,e,t){if(c(e)&&(e=e.options),function(n,e){var t=n.props;if(t){var a,i,r={};if(s(t))for(a=t.length;a--;)"string"==typeof(i=t[a])&&(r[I(i)]={type:null});else if(m(t))for(var l in t)i=t[l],r[I(l)]=m(i)?i:{type:i};else 0;n.props=r}}(e),function(n,e){var t=n.inject;if(t){var a=n.inject={};if(s(t))for(var i=0;i<t.length;i++)a[t[i]]={from:t[i]};else if(m(t))for(var r in t){var l=t[r];a[r]=m(l)?L({from:r},l):{from:l}}else 0}}(e),function(n){var e=n.directives;if(e)for(var t in e){var a=e[t];c(a)&&(e[t]={bind:a,update:a})}}(e),!e._base&&(e.extends&&(n=At(n,e.extends,t)),e.mixins))for(var a=0,i=e.mixins.length;a<i;a++)n=At(n,e.mixins[a],t);var r,l={};for(r in n)o(r);for(r in e)T(n,r)||o(r);function o(a){var s=wt[a]||Rt;l[a]=s(n[a],e[a],t,a)}return l}function Bt(n,e,t,a){if("string"==typeof t){var s=n[e];if(T(s,t))return s[t];var i=I(t);if(T(s,i))return s[i];var r=S(i);return T(s,r)?s[r]:s[t]||s[i]||s[r]}}function Lt(n,e,t,a){var s=e[n],i=!T(t,n),r=t[n],l=Ct(Boolean,s.type);if(l>-1)if(i&&!T(s,"default"))r=!1;else if(""===r||r===R(n)){var o=Ct(String,s.type);(o<0||l<o)&&(r=!0)}if(void 0===r){r=function(n,e,t){if(!T(e,"default"))return;var a=e.default;0;if(n&&n.$options.propsData&&void 0===n.$options.propsData[t]&&void 0!==n._props[t])return n._props[t];return c(a)&&"Function"!==Dt(e.type)?a.call(n):a}(a,s,n);var d=qn;Rn(!0),Ln(r),Rn(d)}return r}var zt=/^\s*function (\w+)/;function Dt(n){var e=n&&n.toString().match(zt);return e?e[1]:""}function Mt(n,e){return Dt(n)===Dt(e)}function Ct(n,e){if(!s(e))return Mt(e,n)?0:-1;for(var t=0,a=e.length;t<a;t++)if(Mt(e[t],n))return t;return-1}var Ot={enumerable:!0,configurable:!0,get:D,set:D};function Nt(n,e,t){Ot.get=function(){return this[e][t]},Ot.set=function(n){this[e][t]=n},Object.defineProperty(n,t,Ot)}function Pt(n){var e=n.$options;if(e.props&&function(n,e){var t=n.$options.propsData||{},a=n._props=On({}),s=n.$options._propKeys=[];n.$parent&&Rn(!1);var i=function(i){s.push(i);var r=Lt(i,e,t,n);zn(a,i,r,void 0,!0),i in n||Nt(n,"_props",i)};for(var r in e)i(r);Rn(!0)}(n,e.props),function(n){var e=n.$options,t=e.setup;if(t){var a=n._setupContext=ve(n);pn(n),xn();var s=qe(t,null,[n._props||On({}),a],n,"setup");if(Tn(),pn(),c(s))e.render=s;else if(d(s))if(n._setupState=s,s.__sfc){var i=n._setupProxy={};for(var r in s)"__sfc"!==r&&Fn(i,s,r)}else for(var r in s)Q(r)||Fn(n,s,r);else 0}}(n),e.methods&&function(n,e){n.$options.props;for(var t in e)n[t]="function"!=typeof e[t]?D:A(e[t],n)}(n,e.methods),e.data)!function(n){var e=n.$options.data;m(e=n._data=c(e)?function(n,e){xn();try{return n.call(e,e)}catch(n){return Se(n,e,"data()"),{}}finally{Tn()}}(e,n):e||{})||(e={});var t=Object.keys(e),a=n.$options.props,s=(n.$options.methods,t.length);for(;s--;){var i=t[s];0,a&&T(a,i)||Q(i)||Nt(n,"_data",i)}var r=Ln(e);r&&r.vmCount++}(n);else{var t=Ln(n._data={});t&&t.vmCount++}e.computed&&function(n,e){var t=n._computedWatchers=Object.create(null),a=ln();for(var s in e){var i=e[s],r=c(i)?i:i.get;0,a||(t[s]=new Ge(n,r||D,D,jt)),s in n||Ft(n,s,i)}}(n,e.computed),e.watch&&e.watch!==an&&function(n,e){for(var t in e){var a=e[t];if(s(a))for(var i=0;i<a.length;i++)$t(n,t,a[i]);else $t(n,t,a)}}(n,e.watch)}var jt={lazy:!0};function Ft(n,e,t){var a=!ln();c(t)?(Ot.get=a?Ht(e):Ut(t),Ot.set=D):(Ot.get=t.get?a&&!1!==t.cache?Ht(e):Ut(t.get):D,Ot.set=t.set||D),Object.defineProperty(n,e,Ot)}function Ht(n){return function(){var e=this._computedWatchers&&this._computedWatchers[n];if(e)return e.dirty&&e.evaluate(),_n.target&&e.depend(),e.value}}function Ut(n){return function(){return n.call(this,this)}}function $t(n,e,t,a){return m(t)&&(a=t,t=t.handler),"string"==typeof t&&(t=n[t]),n.$watch(e,t,a)}var Qt=0;function Gt(n){var e=n.options;if(n.super){var t=Gt(n.super);if(t!==n.superOptions){n.superOptions=t;var a=function(n){var e,t=n.options,a=n.sealedOptions;for(var s in t)t[s]!==a[s]&&(e||(e={}),e[s]=t[s]);return e}(n);a&&L(n.extendOptions,a),(e=n.options=At(t,n.extendOptions)).name&&(e.components[e.name]=n)}}return e}function Kt(n){this._init(n)}function Vt(n){n.cid=0;var e=1;n.extend=function(n){n=n||{};var t=this,a=t.cid,s=n._Ctor||(n._Ctor={});if(s[a])return s[a];var i=yt(n)||yt(t.options);var r=function(n){this._init(n)};return(r.prototype=Object.create(t.prototype)).constructor=r,r.cid=e++,r.options=At(t.options,n),r.super=t,r.options.props&&function(n){var e=n.options.props;for(var t in e)Nt(n.prototype,"_props",t)}(r),r.options.computed&&function(n){var e=n.options.computed;for(var t in e)Ft(n.prototype,t,e[t])}(r),r.extend=t.extend,r.mixin=t.mixin,r.use=t.use,F.forEach((function(n){r[n]=t[n]})),i&&(r.options.components[i]=r),r.superOptions=t.options,r.extendOptions=n,r.sealedOptions=L({},r.options),s[a]=r,r}}function Wt(n){return n&&(yt(n.Ctor.options)||n.tag)}function Jt(n,e){return s(n)?n.indexOf(e)>-1:"string"==typeof n?n.split(",").indexOf(e)>-1:!!p(n)&&n.test(e)}function Xt(n,e){var t=n.cache,a=n.keys,s=n._vnode,i=n.$vnode;for(var r in t){var l=t[r];if(l){var o=l.name;o&&!e(o)&&Yt(t,r,a,s)}}i.componentOptions.children=void 0}function Yt(n,e,t,a){var s=n[e];!s||a&&s.tag===a.tag||s.componentInstance.$destroy(),n[e]=null,E(t,e)}!function(n){n.prototype._init=function(n){var e=this;e._uid=Qt++,e._isVue=!0,e.__v_skip=!0,e._scope=new Un(!0),e._scope.parent=void 0,e._scope._vm=!0,n&&n._isComponent?function(n,e){var t=n.$options=Object.create(n.constructor.options),a=e._parentVnode;t.parent=e.parent,t._parentVnode=a;var s=a.componentOptions;t.propsData=s.propsData,t._parentListeners=s.listeners,t._renderChildren=s.children,t._componentTag=s.tag,e.render&&(t.render=e.render,t.staticRenderFns=e.staticRenderFns)}(e,n):e.$options=At(Gt(e.constructor),n||{},e),e._renderProxy=e,e._self=e,function(n){var e=n.$options,t=e.parent;if(t&&!e.abstract){for(;t.$options.abstract&&t.$parent;)t=t.$parent;t.$children.push(n)}n.$parent=t,n.$root=t?t.$root:n,n.$children=[],n.$refs={},n._provided=t?t._provided:Object.create(null),n._watcher=null,n._inactive=null,n._directInactive=!1,n._isMounted=!1,n._isDestroyed=!1,n._isBeingDestroyed=!1}(e),function(n){n._events=Object.create(null),n._hasHookEvent=!1;var e=n.$options._parentListeners;e&&Je(n,e)}(e),function(n){n._vnode=null,n._staticTrees=null;var e=n.$options,t=n.$vnode=e._parentVnode,s=t&&t.context;n.$slots=pe(e._renderChildren,s),n.$scopedSlots=t?fe(n.$parent,t.data.scopedSlots,n.$slots):a,n._c=function(e,t,a,s){return Ie(n,e,t,a,s,!1)},n.$createElement=function(e,t,a,s){return Ie(n,e,t,a,s,!0)};var i=t&&t.data;zn(n,"$attrs",i&&i.attrs||a,null,!0),zn(n,"$listeners",e._parentListeners||a,null,!0)}(e),et(e,"beforeCreate",void 0,!1),function(n){var e=ht(n.$options.inject,n);e&&(Rn(!1),Object.keys(e).forEach((function(t){zn(n,t,e[t])})),Rn(!0))}(e),Pt(e),function(n){var e=n.$options.provide;if(e){var t=c(e)?e.call(n):e;if(!d(t))return;for(var a=$n(n),s=un?Reflect.ownKeys(t):Object.keys(t),i=0;i<s.length;i++){var r=s[i];Object.defineProperty(a,r,Object.getOwnPropertyDescriptor(t,r))}}}(e),et(e,"created"),e.$options.el&&e.$mount(e.$options.el)}}(Kt),function(n){var e={get:function(){return this._data}},t={get:function(){return this._props}};Object.defineProperty(n.prototype,"$data",e),Object.defineProperty(n.prototype,"$props",t),n.prototype.$set=Dn,n.prototype.$delete=Mn,n.prototype.$watch=function(n,e,t){if(m(e))return $t(this,n,e,t);(t=t||{}).user=!0;var a=new Ge(this,n,e,t);if(t.immediate){var s='callback for immediate watcher "'.concat(a.expression,'"');xn(),qe(e,this,[a.value],this,s),Tn()}return function(){a.teardown()}}}(Kt),function(n){var e=/^hook:/;n.prototype.$on=function(n,t){var a=this;if(s(n))for(var i=0,r=n.length;i<r;i++)a.$on(n[i],t);else(a._events[n]||(a._events[n]=[])).push(t),e.test(n)&&(a._hasHookEvent=!0);return a},n.prototype.$once=function(n,e){var t=this;function a(){t.$off(n,a),e.apply(t,arguments)}return a.fn=e,t.$on(n,a),t},n.prototype.$off=function(n,e){var t=this;if(!arguments.length)return t._events=Object.create(null),t;if(s(n)){for(var a=0,i=n.length;a<i;a++)t.$off(n[a],e);return t}var r,l=t._events[n];if(!l)return t;if(!e)return t._events[n]=null,t;for(var o=l.length;o--;)if((r=l[o])===e||r.fn===e){l.splice(o,1);break}return t},n.prototype.$emit=function(n){var e=this,t=e._events[n];if(t){t=t.length>1?B(t):t;for(var a=B(arguments,1),s='event handler for "'.concat(n,'"'),i=0,r=t.length;i<r;i++)qe(t[i],e,a,e,s)}return e}}(Kt),function(n){n.prototype._update=function(n,e){var t=this,a=t.$el,s=t._vnode,i=Ye(t);t._vnode=n,t.$el=s?t.__patch__(s,n):t.__patch__(t.$el,n,e,!1),i(),a&&(a.__vue__=null),t.$el&&(t.$el.__vue__=t);for(var r=t;r&&r.$vnode&&r.$parent&&r.$vnode===r.$parent._vnode;)r.$parent.$el=r.$el,r=r.$parent},n.prototype.$forceUpdate=function(){this._watcher&&this._watcher.update()},n.prototype.$destroy=function(){var n=this;if(!n._isBeingDestroyed){et(n,"beforeDestroy"),n._isBeingDestroyed=!0;var e=n.$parent;!e||e._isBeingDestroyed||n.$options.abstract||E(e.$children,n),n._scope.stop(),n._data.__ob__&&n._data.__ob__.vmCount--,n._isDestroyed=!0,n.__patch__(n._vnode,null),et(n,"destroyed"),n.$off(),n.$el&&(n.$el.__vue__=null),n.$vnode&&(n.$vnode.parent=null)}}}(Kt),function(n){me(n.prototype),n.prototype.$nextTick=function(n){return je(n,this)},n.prototype._render=function(){var n=this,e=n.$options,t=e.render,a=e._parentVnode;a&&n._isMounted&&(n.$scopedSlots=fe(n.$parent,a.data.scopedSlots,n.$slots,n.$scopedSlots),n._slotsProxy&&xe(n._slotsProxy,n.$scopedSlots)),n.$vnode=a;var i,r=mn,l=Te;try{pn(n),Te=n,i=t.call(n._renderProxy,n.$createElement)}catch(e){Se(e,n,"render"),i=n._vnode}finally{Te=l,pn(r)}return s(i)&&1===i.length&&(i=i[0]),i instanceof hn||(i=gn()),i.parent=a,i}}(Kt);var Zt=[String,RegExp,Array],na={KeepAlive:{name:"keep-alive",abstract:!0,props:{include:Zt,exclude:Zt,max:[String,Number]},methods:{cacheVNode:function(){var n=this.cache,e=this.keys,t=this.vnodeToCache,a=this.keyToCache;if(t){var s=t.tag,i=t.componentInstance,r=t.componentOptions;n[a]={name:Wt(r),tag:s,componentInstance:i},e.push(a),this.max&&e.length>parseInt(this.max)&&Yt(n,e[0],e,this._vnode),this.vnodeToCache=null}}},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){for(var n in this.cache)Yt(this.cache,n,this.keys)},mounted:function(){var n=this;this.cacheVNode(),this.$watch("include",(function(e){Xt(n,(function(n){return Jt(e,n)}))})),this.$watch("exclude",(function(e){Xt(n,(function(n){return!Jt(e,n)}))}))},updated:function(){this.cacheVNode()},render:function(){var n=this.$slots.default,e=ke(n),t=e&&e.componentOptions;if(t){var a=Wt(t),s=this.include,i=this.exclude;if(s&&(!a||!Jt(s,a))||i&&a&&Jt(i,a))return e;var r=this.cache,l=this.keys,o=null==e.key?t.Ctor.cid+(t.tag?"::".concat(t.tag):""):e.key;r[o]?(e.componentInstance=r[o].componentInstance,E(l,o),l.push(o)):(this.vnodeToCache=e,this.keyToCache=o),e.data.keepAlive=!0}return e||n&&n[0]}}};!function(n){var e={get:function(){return U}};Object.defineProperty(n,"config",e),n.util={warn:Tt,extend:L,mergeOptions:At,defineReactive:zn},n.set=Dn,n.delete=Mn,n.nextTick=je,n.observable=function(n){return Ln(n),n},n.options=Object.create(null),F.forEach((function(e){n.options[e+"s"]=Object.create(null)})),n.options._base=n,L(n.options.components,na),function(n){n.use=function(n){var e=this._installedPlugins||(this._installedPlugins=[]);if(e.indexOf(n)>-1)return this;var t=B(arguments,1);return t.unshift(this),c(n.install)?n.install.apply(n,t):c(n)&&n.apply(null,t),e.push(n),this}}(n),function(n){n.mixin=function(n){return this.options=At(this.options,n),this}}(n),Vt(n),function(n){F.forEach((function(e){n[e]=function(n,t){return t?("component"===e&&m(t)&&(t.name=t.name||n,t=this.options._base.extend(t)),"directive"===e&&c(t)&&(t={bind:t,update:t}),this.options[e+"s"][n]=t,t):this.options[e+"s"][n]}}))}(n)}(Kt),Object.defineProperty(Kt.prototype,"$isServer",{get:ln}),Object.defineProperty(Kt.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}}),Object.defineProperty(Kt,"FunctionalRenderContext",{value:gt}),Kt.version="2.7.16";var ea=v("style,class"),ta=v("input,textarea,option,select,progress"),aa=v("contenteditable,draggable,spellcheck"),sa=v("events,caret,typing,plaintext-only"),ia=v("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,truespeed,typemustmatch,visible"),ra="http://www.w3.org/1999/xlink",la=function(n){return":"===n.charAt(5)&&"xlink"===n.slice(0,5)},oa=function(n){return la(n)?n.slice(6,n.length):""},ca=function(n){return null==n||!1===n};function da(n){for(var e=n.data,t=n,a=n;r(a.componentInstance);)(a=a.componentInstance._vnode)&&a.data&&(e=ua(a.data,e));for(;r(t=t.parent);)t&&t.data&&(e=ua(e,t.data));return function(n,e){if(r(n)||r(e))return ma(n,pa(e));return""}(e.staticClass,e.class)}function ua(n,e){return{staticClass:ma(n.staticClass,e.staticClass),class:r(n.class)?[n.class,e.class]:e.class}}function ma(n,e){return n?e?n+" "+e:n:e||""}function pa(n){return Array.isArray(n)?function(n){for(var e,t="",a=0,s=n.length;a<s;a++)r(e=pa(n[a]))&&""!==e&&(t&&(t+=" "),t+=e);return t}(n):d(n)?function(n){var e="";for(var t in n)n[t]&&(e&&(e+=" "),e+=t);return e}(n):"string"==typeof n?n:""}var ha={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},ga=v("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),fa=v("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignobject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),ba=function(n){return ga(n)||fa(n)};var ya=Object.create(null);var va=v("text,number,password,search,email,tel,url");var _a=Object.freeze({__proto__:null,createElement:function(n,e){var t=document.createElement(n);return"select"!==n||e.data&&e.data.attrs&&void 0!==e.data.attrs.multiple&&t.setAttribute("multiple","multiple"),t},createElementNS:function(n,e){return document.createElementNS(ha[n],e)},createTextNode:function(n){return document.createTextNode(n)},createComment:function(n){return document.createComment(n)},insertBefore:function(n,e,t){n.insertBefore(e,t)},removeChild:function(n,e){n.removeChild(e)},appendChild:function(n,e){n.appendChild(e)},parentNode:function(n){return n.parentNode},nextSibling:function(n){return n.nextSibling},tagName:function(n){return n.tagName},setTextContent:function(n,e){n.textContent=e},setStyleScope:function(n,e){n.setAttribute(e,"")}}),Ea={create:function(n,e){xa(e)},update:function(n,e){n.data.ref!==e.data.ref&&(xa(n,!0),xa(e))},destroy:function(n){xa(n,!0)}};function xa(n,e){var t=n.data.ref;if(r(t)){var a=n.context,i=n.componentInstance||n.elm,l=e?null:i,o=e?void 0:i;if(c(t))qe(t,a,[l],a,"template ref function");else{var d=n.data.refInFor,u="string"==typeof t||"number"==typeof t,m=jn(t),p=a.$refs;if(u||m)if(d){var h=u?p[t]:t.value;e?s(h)&&E(h,i):s(h)?h.includes(i)||h.push(i):u?(p[t]=[i],Ta(a,t,p[t])):t.value=[i]}else if(u){if(e&&p[t]!==i)return;p[t]=o,Ta(a,t,l)}else if(m){if(e&&t.value!==i)return;t.value=l}else 0}}}function Ta(n,e,t){var a=n._setupState;a&&T(a,e)&&(jn(a[e])?a[e].value=t:a[e]=t)}var wa=new hn("",{},[]),ka=["create","activate","update","remove","destroy"];function Ia(n,e){return n.key===e.key&&n.asyncFactory===e.asyncFactory&&(n.tag===e.tag&&n.isComment===e.isComment&&r(n.data)===r(e.data)&&function(n,e){if("input"!==n.tag)return!0;var t,a=r(t=n.data)&&r(t=t.attrs)&&t.type,s=r(t=e.data)&&r(t=t.attrs)&&t.type;return a===s||va(a)&&va(s)}(n,e)||l(n.isAsyncPlaceholder)&&i(e.asyncFactory.error))}function Sa(n,e,t){var a,s,i={};for(a=e;a<=t;++a)r(s=n[a].key)&&(i[s]=a);return i}var qa={create:Ra,update:Ra,destroy:function(n){Ra(n,wa)}};function Ra(n,e){(n.data.directives||e.data.directives)&&function(n,e){var t,a,s,i=n===wa,r=e===wa,l=Ba(n.data.directives,n.context),o=Ba(e.data.directives,e.context),c=[],d=[];for(t in o)a=l[t],s=o[t],a?(s.oldValue=a.value,s.oldArg=a.arg,za(s,"update",e,n),s.def&&s.def.componentUpdated&&d.push(s)):(za(s,"bind",e,n),s.def&&s.def.inserted&&c.push(s));if(c.length){var u=function(){for(var t=0;t<c.length;t++)za(c[t],"inserted",e,n)};i?Vn(e,"insert",u):u()}d.length&&Vn(e,"postpatch",(function(){for(var t=0;t<d.length;t++)za(d[t],"componentUpdated",e,n)}));if(!i)for(t in l)o[t]||za(l[t],"unbind",n,n,r)}(n,e)}var Aa=Object.create(null);function Ba(n,e){var t,a,s=Object.create(null);if(!n)return s;for(t=0;t<n.length;t++){if((a=n[t]).modifiers||(a.modifiers=Aa),s[La(a)]=a,e._setupState&&e._setupState.__sfc){var i=a.def||Bt(e,"_setupState","v-"+a.name);a.def="function"==typeof i?{bind:i,update:i}:i}a.def=a.def||Bt(e.$options,"directives",a.name)}return s}function La(n){return n.rawName||"".concat(n.name,".").concat(Object.keys(n.modifiers||{}).join("."))}function za(n,e,t,a,s){var i=n.def&&n.def[e];if(i)try{i(t.elm,n,t,a,s)}catch(a){Se(a,t.context,"directive ".concat(n.name," ").concat(e," hook"))}}var Da=[Ea,qa];function Ma(n,e){var t=e.componentOptions;if(!(r(t)&&!1===t.Ctor.options.inheritAttrs||i(n.data.attrs)&&i(e.data.attrs))){var a,s,o=e.elm,c=n.data.attrs||{},d=e.data.attrs||{};for(a in(r(d.__ob__)||l(d._v_attr_proxy))&&(d=e.data.attrs=L({},d)),d)s=d[a],c[a]!==s&&Ca(o,a,s,e.data.pre);for(a in(X||Z)&&d.value!==c.value&&Ca(o,"value",d.value),c)i(d[a])&&(la(a)?o.removeAttributeNS(ra,oa(a)):aa(a)||o.removeAttribute(a))}}function Ca(n,e,t,a){a||n.tagName.indexOf("-")>-1?Oa(n,e,t):ia(e)?ca(t)?n.removeAttribute(e):(t="allowfullscreen"===e&&"EMBED"===n.tagName?"true":e,n.setAttribute(e,t)):aa(e)?n.setAttribute(e,function(n,e){return ca(e)||"false"===e?"false":"contenteditable"===n&&sa(e)?e:"true"}(e,t)):la(e)?ca(t)?n.removeAttributeNS(ra,oa(e)):n.setAttributeNS(ra,e,t):Oa(n,e,t)}function Oa(n,e,t){if(ca(t))n.removeAttribute(e);else{if(X&&!Y&&"TEXTAREA"===n.tagName&&"placeholder"===e&&""!==t&&!n.__ieph){var a=function(e){e.stopImmediatePropagation(),n.removeEventListener("input",a)};n.addEventListener("input",a),n.__ieph=!0}n.setAttribute(e,t)}}var Na={create:Ma,update:Ma};function Pa(n,e){var t=e.elm,a=e.data,s=n.data;if(!(i(a.staticClass)&&i(a.class)&&(i(s)||i(s.staticClass)&&i(s.class)))){var l=da(e),o=t._transitionClasses;r(o)&&(l=ma(l,pa(o))),l!==t._prevClass&&(t.setAttribute("class",l),t._prevClass=l)}}var ja,Fa={create:Pa,update:Pa};function Ha(n,e,t){var a=ja;return function s(){var i=e.apply(null,arguments);null!==i&&Qa(n,s,t,a)}}var Ua=Le&&!(tn&&Number(tn[1])<=53);function $a(n,e,t,a){if(Ua){var s=ot,i=e;e=i._wrapper=function(n){if(n.target===n.currentTarget||n.timeStamp>=s||n.timeStamp<=0||n.target.ownerDocument!==document)return i.apply(this,arguments)}}ja.addEventListener(n,e,sn?{capture:t,passive:a}:t)}function Qa(n,e,t,a){(a||ja).removeEventListener(n,e._wrapper||e,t)}function Ga(n,e){if(!i(n.data.on)||!i(e.data.on)){var t=e.data.on||{},a=n.data.on||{};ja=e.elm||n.elm,function(n){if(r(n.__r)){var e=X?"change":"input";n[e]=[].concat(n.__r,n[e]||[]),delete n.__r}r(n.__c)&&(n.change=[].concat(n.__c,n.change||[]),delete n.__c)}(t),Kn(t,a,$a,Qa,Ha,e.context),ja=void 0}}var Ka,Va={create:Ga,update:Ga,destroy:function(n){return Ga(n,wa)}};function Wa(n,e){if(!i(n.data.domProps)||!i(e.data.domProps)){var t,a,s=e.elm,o=n.data.domProps||{},c=e.data.domProps||{};for(t in(r(c.__ob__)||l(c._v_attr_proxy))&&(c=e.data.domProps=L({},c)),o)t in c||(s[t]="");for(t in c){if(a=c[t],"textContent"===t||"innerHTML"===t){if(e.children&&(e.children.length=0),a===o[t])continue;1===s.childNodes.length&&s.removeChild(s.childNodes[0])}if("value"===t&&"PROGRESS"!==s.tagName){s._value=a;var d=i(a)?"":String(a);Ja(s,d)&&(s.value=d)}else if("innerHTML"===t&&fa(s.tagName)&&i(s.innerHTML)){(Ka=Ka||document.createElement("div")).innerHTML="<svg>".concat(a,"</svg>");for(var u=Ka.firstChild;s.firstChild;)s.removeChild(s.firstChild);for(;u.firstChild;)s.appendChild(u.firstChild)}else if(a!==o[t])try{s[t]=a}catch(n){}}}}function Ja(n,e){return!n.composing&&("OPTION"===n.tagName||function(n,e){var t=!0;try{t=document.activeElement!==n}catch(n){}return t&&n.value!==e}(n,e)||function(n,e){var t=n.value,a=n._vModifiers;if(r(a)){if(a.number)return y(t)!==y(e);if(a.trim)return t.trim()!==e.trim()}return t!==e}(n,e))}var Xa={create:Wa,update:Wa},Ya=w((function(n){var e={},t=/:(.+)/;return n.split(/;(?![^(]*\))/g).forEach((function(n){if(n){var a=n.split(t);a.length>1&&(e[a[0].trim()]=a[1].trim())}})),e}));function Za(n){var e=ns(n.style);return n.staticStyle?L(n.staticStyle,e):e}function ns(n){return Array.isArray(n)?z(n):"string"==typeof n?Ya(n):n}var es,ts=/^--/,as=/\s*!important$/,ss=function(n,e,t){if(ts.test(e))n.style.setProperty(e,t);else if(as.test(t))n.style.setProperty(R(e),t.replace(as,""),"important");else{var a=rs(e);if(Array.isArray(t))for(var s=0,i=t.length;s<i;s++)n.style[a]=t[s];else n.style[a]=t}},is=["Webkit","Moz","ms"],rs=w((function(n){if(es=es||document.createElement("div").style,"filter"!==(n=I(n))&&n in es)return n;for(var e=n.charAt(0).toUpperCase()+n.slice(1),t=0;t<is.length;t++){var a=is[t]+e;if(a in es)return a}}));function ls(n,e){var t=e.data,a=n.data;if(!(i(t.staticStyle)&&i(t.style)&&i(a.staticStyle)&&i(a.style))){var s,l,o=e.elm,c=a.staticStyle,d=a.normalizedStyle||a.style||{},u=c||d,m=ns(e.data.style)||{};e.data.normalizedStyle=r(m.__ob__)?L({},m):m;var p=function(n,e){var t,a={};if(e)for(var s=n;s.componentInstance;)(s=s.componentInstance._vnode)&&s.data&&(t=Za(s.data))&&L(a,t);(t=Za(n.data))&&L(a,t);for(var i=n;i=i.parent;)i.data&&(t=Za(i.data))&&L(a,t);return a}(e,!0);for(l in u)i(p[l])&&ss(o,l,"");for(l in p)s=p[l],ss(o,l,null==s?"":s)}}var os={create:ls,update:ls},cs=/\s+/;function ds(n,e){if(e&&(e=e.trim()))if(n.classList)e.indexOf(" ")>-1?e.split(cs).forEach((function(e){return n.classList.add(e)})):n.classList.add(e);else{var t=" ".concat(n.getAttribute("class")||""," ");t.indexOf(" "+e+" ")<0&&n.setAttribute("class",(t+e).trim())}}function us(n,e){if(e&&(e=e.trim()))if(n.classList)e.indexOf(" ")>-1?e.split(cs).forEach((function(e){return n.classList.remove(e)})):n.classList.remove(e),n.classList.length||n.removeAttribute("class");else{for(var t=" ".concat(n.getAttribute("class")||""," "),a=" "+e+" ";t.indexOf(a)>=0;)t=t.replace(a," ");(t=t.trim())?n.setAttribute("class",t):n.removeAttribute("class")}}function ms(n){if(n){if("object"==typeof n){var e={};return!1!==n.css&&L(e,ps(n.name||"v")),L(e,n),e}return"string"==typeof n?ps(n):void 0}}var ps=w((function(n){return{enterClass:"".concat(n,"-enter"),enterToClass:"".concat(n,"-enter-to"),enterActiveClass:"".concat(n,"-enter-active"),leaveClass:"".concat(n,"-leave"),leaveToClass:"".concat(n,"-leave-to"),leaveActiveClass:"".concat(n,"-leave-active")}})),hs=W&&!Y,gs="transition",fs="transitionend",bs="animation",ys="animationend";hs&&(void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend&&(gs="WebkitTransition",fs="webkitTransitionEnd"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend&&(bs="WebkitAnimation",ys="webkitAnimationEnd"));var vs=W?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(n){return n()};function _s(n){vs((function(){vs(n)}))}function Es(n,e){var t=n._transitionClasses||(n._transitionClasses=[]);t.indexOf(e)<0&&(t.push(e),ds(n,e))}function xs(n,e){n._transitionClasses&&E(n._transitionClasses,e),us(n,e)}function Ts(n,e,t){var a=ks(n,e),s=a.type,i=a.timeout,r=a.propCount;if(!s)return t();var l="transition"===s?fs:ys,o=0,c=function(){n.removeEventListener(l,d),t()},d=function(e){e.target===n&&++o>=r&&c()};setTimeout((function(){o<r&&c()}),i+1),n.addEventListener(l,d)}var ws=/\b(transform|all)(,|$)/;function ks(n,e){var t,a=window.getComputedStyle(n),s=(a[gs+"Delay"]||"").split(", "),i=(a[gs+"Duration"]||"").split(", "),r=Is(s,i),l=(a[bs+"Delay"]||"").split(", "),o=(a[bs+"Duration"]||"").split(", "),c=Is(l,o),d=0,u=0;return"transition"===e?r>0&&(t="transition",d=r,u=i.length):"animation"===e?c>0&&(t="animation",d=c,u=o.length):u=(t=(d=Math.max(r,c))>0?r>c?"transition":"animation":null)?"transition"===t?i.length:o.length:0,{type:t,timeout:d,propCount:u,hasTransform:"transition"===t&&ws.test(a[gs+"Property"])}}function Is(n,e){for(;n.length<e.length;)n=n.concat(n);return Math.max.apply(null,e.map((function(e,t){return Ss(e)+Ss(n[t])})))}function Ss(n){return 1e3*Number(n.slice(0,-1).replace(",","."))}function qs(n,e){var t=n.elm;r(t._leaveCb)&&(t._leaveCb.cancelled=!0,t._leaveCb());var a=ms(n.data.transition);if(!i(a)&&!r(t._enterCb)&&1===t.nodeType){for(var s=a.css,l=a.type,o=a.enterClass,u=a.enterToClass,m=a.enterActiveClass,p=a.appearClass,h=a.appearToClass,g=a.appearActiveClass,f=a.beforeEnter,b=a.enter,v=a.afterEnter,_=a.enterCancelled,E=a.beforeAppear,x=a.appear,T=a.afterAppear,w=a.appearCancelled,k=a.duration,I=Xe,S=Xe.$vnode;S&&S.parent;)I=S.context,S=S.parent;var q=!I._isMounted||!n.isRootInsert;if(!q||x||""===x){var R=q&&p?p:o,A=q&&g?g:m,B=q&&h?h:u,L=q&&E||f,z=q&&c(x)?x:b,D=q&&T||v,M=q&&w||_,C=y(d(k)?k.enter:k);0;var O=!1!==s&&!Y,N=Bs(z),j=t._enterCb=P((function(){O&&(xs(t,B),xs(t,A)),j.cancelled?(O&&xs(t,R),M&&M(t)):D&&D(t),t._enterCb=null}));n.data.show||Vn(n,"insert",(function(){var e=t.parentNode,a=e&&e._pending&&e._pending[n.key];a&&a.tag===n.tag&&a.elm._leaveCb&&a.elm._leaveCb(),z&&z(t,j)})),L&&L(t),O&&(Es(t,R),Es(t,A),_s((function(){xs(t,R),j.cancelled||(Es(t,B),N||(As(C)?setTimeout(j,C):Ts(t,l,j)))}))),n.data.show&&(e&&e(),z&&z(t,j)),O||N||j()}}}function Rs(n,e){var t=n.elm;r(t._enterCb)&&(t._enterCb.cancelled=!0,t._enterCb());var a=ms(n.data.transition);if(i(a)||1!==t.nodeType)return e();if(!r(t._leaveCb)){var s=a.css,l=a.type,o=a.leaveClass,c=a.leaveToClass,u=a.leaveActiveClass,m=a.beforeLeave,p=a.leave,h=a.afterLeave,g=a.leaveCancelled,f=a.delayLeave,b=a.duration,v=!1!==s&&!Y,_=Bs(p),E=y(d(b)?b.leave:b);0;var x=t._leaveCb=P((function(){t.parentNode&&t.parentNode._pending&&(t.parentNode._pending[n.key]=null),v&&(xs(t,c),xs(t,u)),x.cancelled?(v&&xs(t,o),g&&g(t)):(e(),h&&h(t)),t._leaveCb=null}));f?f(T):T()}function T(){x.cancelled||(!n.data.show&&t.parentNode&&((t.parentNode._pending||(t.parentNode._pending={}))[n.key]=n),m&&m(t),v&&(Es(t,o),Es(t,u),_s((function(){xs(t,o),x.cancelled||(Es(t,c),_||(As(E)?setTimeout(x,E):Ts(t,l,x)))}))),p&&p(t,x),v||_||x())}}function As(n){return"number"==typeof n&&!isNaN(n)}function Bs(n){if(i(n))return!1;var e=n.fns;return r(e)?Bs(Array.isArray(e)?e[0]:e):(n._length||n.length)>1}function Ls(n,e){!0!==e.data.show&&qs(e)}var zs=function(n){var e,t,a={},c=n.modules,d=n.nodeOps;for(e=0;e<ka.length;++e)for(a[ka[e]]=[],t=0;t<c.length;++t)r(c[t][ka[e]])&&a[ka[e]].push(c[t][ka[e]]);function u(n){var e=d.parentNode(n);r(e)&&d.removeChild(e,n)}function m(n,e,t,s,i,o,c){if(r(n.elm)&&r(o)&&(n=o[c]=bn(n)),n.isRootInsert=!i,!function(n,e,t,s){var i=n.data;if(r(i)){var o=r(n.componentInstance)&&i.keepAlive;if(r(i=i.hook)&&r(i=i.init)&&i(n,!1),r(n.componentInstance))return p(n,e),h(t,n.elm,s),l(o)&&function(n,e,t,s){var i,l=n;for(;l.componentInstance;)if(l=l.componentInstance._vnode,r(i=l.data)&&r(i=i.transition)){for(i=0;i<a.activate.length;++i)a.activate[i](wa,l);e.push(l);break}h(t,n.elm,s)}(n,e,t,s),!0}}(n,e,t,s)){var u=n.data,m=n.children,f=n.tag;r(f)?(n.elm=n.ns?d.createElementNS(n.ns,f):d.createElement(f,n),y(n),g(n,m,e),r(u)&&b(n,e),h(t,n.elm,s)):l(n.isComment)?(n.elm=d.createComment(n.text),h(t,n.elm,s)):(n.elm=d.createTextNode(n.text),h(t,n.elm,s))}}function p(n,e){r(n.data.pendingInsert)&&(e.push.apply(e,n.data.pendingInsert),n.data.pendingInsert=null),n.elm=n.componentInstance.$el,f(n)?(b(n,e),y(n)):(xa(n),e.push(n))}function h(n,e,t){r(n)&&(r(t)?d.parentNode(t)===n&&d.insertBefore(n,e,t):d.appendChild(n,e))}function g(n,e,t){if(s(e)){0;for(var a=0;a<e.length;++a)m(e[a],t,n.elm,null,!0,e,a)}else o(n.text)&&d.appendChild(n.elm,d.createTextNode(String(n.text)))}function f(n){for(;n.componentInstance;)n=n.componentInstance._vnode;return r(n.tag)}function b(n,t){for(var s=0;s<a.create.length;++s)a.create[s](wa,n);r(e=n.data.hook)&&(r(e.create)&&e.create(wa,n),r(e.insert)&&t.push(n))}function y(n){var e;if(r(e=n.fnScopeId))d.setStyleScope(n.elm,e);else for(var t=n;t;)r(e=t.context)&&r(e=e.$options._scopeId)&&d.setStyleScope(n.elm,e),t=t.parent;r(e=Xe)&&e!==n.context&&e!==n.fnContext&&r(e=e.$options._scopeId)&&d.setStyleScope(n.elm,e)}function _(n,e,t,a,s,i){for(;a<=s;++a)m(t[a],i,n,e,!1,t,a)}function E(n){var e,t,s=n.data;if(r(s))for(r(e=s.hook)&&r(e=e.destroy)&&e(n),e=0;e<a.destroy.length;++e)a.destroy[e](n);if(r(e=n.children))for(t=0;t<n.children.length;++t)E(n.children[t])}function x(n,e,t){for(;e<=t;++e){var a=n[e];r(a)&&(r(a.tag)?(T(a),E(a)):u(a.elm))}}function T(n,e){if(r(e)||r(n.data)){var t,s=a.remove.length+1;for(r(e)?e.listeners+=s:e=function(n,e){function t(){0==--t.listeners&&u(n)}return t.listeners=e,t}(n.elm,s),r(t=n.componentInstance)&&r(t=t._vnode)&&r(t.data)&&T(t,e),t=0;t<a.remove.length;++t)a.remove[t](n,e);r(t=n.data.hook)&&r(t=t.remove)?t(n,e):e()}else u(n.elm)}function w(n,e,t,a){for(var s=t;s<a;s++){var i=e[s];if(r(i)&&Ia(n,i))return s}}function k(n,e,t,s,o,c){if(n!==e){r(e.elm)&&r(s)&&(e=s[o]=bn(e));var u=e.elm=n.elm;if(l(n.isAsyncPlaceholder))r(e.asyncFactory.resolved)?q(n.elm,e,t):e.isAsyncPlaceholder=!0;else if(l(e.isStatic)&&l(n.isStatic)&&e.key===n.key&&(l(e.isCloned)||l(e.isOnce)))e.componentInstance=n.componentInstance;else{var p,h=e.data;r(h)&&r(p=h.hook)&&r(p=p.prepatch)&&p(n,e);var g=n.children,b=e.children;if(r(h)&&f(e)){for(p=0;p<a.update.length;++p)a.update[p](n,e);r(p=h.hook)&&r(p=p.update)&&p(n,e)}i(e.text)?r(g)&&r(b)?g!==b&&function(n,e,t,a,s){var l,o,c,u=0,p=0,h=e.length-1,g=e[0],f=e[h],b=t.length-1,y=t[0],v=t[b],E=!s;for(0;u<=h&&p<=b;)i(g)?g=e[++u]:i(f)?f=e[--h]:Ia(g,y)?(k(g,y,a,t,p),g=e[++u],y=t[++p]):Ia(f,v)?(k(f,v,a,t,b),f=e[--h],v=t[--b]):Ia(g,v)?(k(g,v,a,t,b),E&&d.insertBefore(n,g.elm,d.nextSibling(f.elm)),g=e[++u],v=t[--b]):Ia(f,y)?(k(f,y,a,t,p),E&&d.insertBefore(n,f.elm,g.elm),f=e[--h],y=t[++p]):(i(l)&&(l=Sa(e,u,h)),i(o=r(y.key)?l[y.key]:w(y,e,u,h))?m(y,a,n,g.elm,!1,t,p):Ia(c=e[o],y)?(k(c,y,a,t,p),e[o]=void 0,E&&d.insertBefore(n,c.elm,g.elm)):m(y,a,n,g.elm,!1,t,p),y=t[++p]);u>h?_(n,i(t[b+1])?null:t[b+1].elm,t,p,b,a):p>b&&x(e,u,h)}(u,g,b,t,c):r(b)?(r(n.text)&&d.setTextContent(u,""),_(u,null,b,0,b.length-1,t)):r(g)?x(g,0,g.length-1):r(n.text)&&d.setTextContent(u,""):n.text!==e.text&&d.setTextContent(u,e.text),r(h)&&r(p=h.hook)&&r(p=p.postpatch)&&p(n,e)}}}function I(n,e,t){if(l(t)&&r(n.parent))n.parent.data.pendingInsert=e;else for(var a=0;a<e.length;++a)e[a].data.hook.insert(e[a])}var S=v("attrs,class,staticClass,staticStyle,key");function q(n,e,t,a){var s,i=e.tag,o=e.data,c=e.children;if(a=a||o&&o.pre,e.elm=n,l(e.isComment)&&r(e.asyncFactory))return e.isAsyncPlaceholder=!0,!0;if(r(o)&&(r(s=o.hook)&&r(s=s.init)&&s(e,!0),r(s=e.componentInstance)))return p(e,t),!0;if(r(i)){if(r(c))if(n.hasChildNodes())if(r(s=o)&&r(s=s.domProps)&&r(s=s.innerHTML)){if(s!==n.innerHTML)return!1}else{for(var d=!0,u=n.firstChild,m=0;m<c.length;m++){if(!u||!q(u,c[m],t,a)){d=!1;break}u=u.nextSibling}if(!d||u)return!1}else g(e,c,t);if(r(o)){var h=!1;for(var f in o)if(!S(f)){h=!0,b(e,t);break}!h&&o.class&&Ue(o.class)}}else n.data!==e.text&&(n.data=e.text);return!0}return function(n,e,t,s){if(!i(e)){var o,c=!1,u=[];if(i(n))c=!0,m(e,u);else{var p=r(n.nodeType);if(!p&&Ia(n,e))k(n,e,u,null,null,s);else{if(p){if(1===n.nodeType&&n.hasAttribute("data-server-rendered")&&(n.removeAttribute("data-server-rendered"),t=!0),l(t)&&q(n,e,u))return I(e,u,!0),n;o=n,n=new hn(d.tagName(o).toLowerCase(),{},[],void 0,o)}var h=n.elm,g=d.parentNode(h);if(m(e,u,h._leaveCb?null:g,d.nextSibling(h)),r(e.parent))for(var b=e.parent,y=f(e);b;){for(var v=0;v<a.destroy.length;++v)a.destroy[v](b);if(b.elm=e.elm,y){for(var _=0;_<a.create.length;++_)a.create[_](wa,b);var T=b.data.hook.insert;if(T.merged)for(var w=T.fns.slice(1),S=0;S<w.length;S++)w[S]()}else xa(b);b=b.parent}r(g)?x([n],0,0):r(n.tag)&&E(n)}}return I(e,u,c),e.elm}r(n)&&E(n)}}({nodeOps:_a,modules:[Na,Fa,Va,Xa,os,W?{create:Ls,activate:Ls,remove:function(n,e){!0!==n.data.show?Rs(n,e):e()}}:{}].concat(Da)});Y&&document.addEventListener("selectionchange",(function(){var n=document.activeElement;n&&n.vmodel&&Fs(n,"input")}));var Ds={inserted:function(n,e,t,a){"select"===t.tag?(a.elm&&!a.elm._vOptions?Vn(t,"postpatch",(function(){Ds.componentUpdated(n,e,t)})):Ms(n,e,t.context),n._vOptions=[].map.call(n.options,Ns)):("textarea"===t.tag||va(n.type))&&(n._vModifiers=e.modifiers,e.modifiers.lazy||(n.addEventListener("compositionstart",Ps),n.addEventListener("compositionend",js),n.addEventListener("change",js),Y&&(n.vmodel=!0)))},componentUpdated:function(n,e,t){if("select"===t.tag){Ms(n,e,t.context);var a=n._vOptions,s=n._vOptions=[].map.call(n.options,Ns);if(s.some((function(n,e){return!O(n,a[e])})))(n.multiple?e.value.some((function(n){return Os(n,s)})):e.value!==e.oldValue&&Os(e.value,s))&&Fs(n,"change")}}};function Ms(n,e,t){Cs(n,e,t),(X||Z)&&setTimeout((function(){Cs(n,e,t)}),0)}function Cs(n,e,t){var a=e.value,s=n.multiple;if(!s||Array.isArray(a)){for(var i,r,l=0,o=n.options.length;l<o;l++)if(r=n.options[l],s)i=N(a,Ns(r))>-1,r.selected!==i&&(r.selected=i);else if(O(Ns(r),a))return void(n.selectedIndex!==l&&(n.selectedIndex=l));s||(n.selectedIndex=-1)}}function Os(n,e){return e.every((function(e){return!O(e,n)}))}function Ns(n){return"_value"in n?n._value:n.value}function Ps(n){n.target.composing=!0}function js(n){n.target.composing&&(n.target.composing=!1,Fs(n.target,"input"))}function Fs(n,e){var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!0),n.dispatchEvent(t)}function Hs(n){return!n.componentInstance||n.data&&n.data.transition?n:Hs(n.componentInstance._vnode)}var Us={model:Ds,show:{bind:function(n,e,t){var a=e.value,s=(t=Hs(t)).data&&t.data.transition,i=n.__vOriginalDisplay="none"===n.style.display?"":n.style.display;a&&s?(t.data.show=!0,qs(t,(function(){n.style.display=i}))):n.style.display=a?i:"none"},update:function(n,e,t){var a=e.value;!a!=!e.oldValue&&((t=Hs(t)).data&&t.data.transition?(t.data.show=!0,a?qs(t,(function(){n.style.display=n.__vOriginalDisplay})):Rs(t,(function(){n.style.display="none"}))):n.style.display=a?n.__vOriginalDisplay:"none")},unbind:function(n,e,t,a,s){s||(n.style.display=n.__vOriginalDisplay)}}},$s={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function Qs(n){var e=n&&n.componentOptions;return e&&e.Ctor.options.abstract?Qs(ke(e.children)):n}function Gs(n){var e={},t=n.$options;for(var a in t.propsData)e[a]=n[a];var s=t._parentListeners;for(var a in s)e[I(a)]=s[a];return e}function Ks(n,e){if(/\d-keep-alive$/.test(e.tag))return n("keep-alive",{props:e.componentOptions.propsData})}var Vs=function(n){return n.tag||ge(n)},Ws=function(n){return"show"===n.name},Js={name:"transition",props:$s,abstract:!0,render:function(n){var e=this,t=this.$slots.default;if(t&&(t=t.filter(Vs)).length){0;var a=this.mode;0;var s=t[0];if(function(n){for(;n=n.parent;)if(n.data.transition)return!0}(this.$vnode))return s;var i=Qs(s);if(!i)return s;if(this._leaving)return Ks(n,s);var r="__transition-".concat(this._uid,"-");i.key=null==i.key?i.isComment?r+"comment":r+i.tag:o(i.key)?0===String(i.key).indexOf(r)?i.key:r+i.key:i.key;var l=(i.data||(i.data={})).transition=Gs(this),c=this._vnode,d=Qs(c);if(i.data.directives&&i.data.directives.some(Ws)&&(i.data.show=!0),d&&d.data&&!function(n,e){return e.key===n.key&&e.tag===n.tag}(i,d)&&!ge(d)&&(!d.componentInstance||!d.componentInstance._vnode.isComment)){var u=d.data.transition=L({},l);if("out-in"===a)return this._leaving=!0,Vn(u,"afterLeave",(function(){e._leaving=!1,e.$forceUpdate()})),Ks(n,s);if("in-out"===a){if(ge(i))return c;var m,p=function(){m()};Vn(l,"afterEnter",p),Vn(l,"enterCancelled",p),Vn(u,"delayLeave",(function(n){m=n}))}}return s}}},Xs=L({tag:String,moveClass:String},$s);function Ys(n){n.elm._moveCb&&n.elm._moveCb(),n.elm._enterCb&&n.elm._enterCb()}function Zs(n){n.data.newPos=n.elm.getBoundingClientRect()}function ni(n){var e=n.data.pos,t=n.data.newPos,a=e.left-t.left,s=e.top-t.top;if(a||s){n.data.moved=!0;var i=n.elm.style;i.transform=i.WebkitTransform="translate(".concat(a,"px,").concat(s,"px)"),i.transitionDuration="0s"}}delete Xs.mode;var ei={Transition:Js,TransitionGroup:{props:Xs,beforeMount:function(){var n=this,e=this._update;this._update=function(t,a){var s=Ye(n);n.__patch__(n._vnode,n.kept,!1,!0),n._vnode=n.kept,s(),e.call(n,t,a)}},render:function(n){for(var e=this.tag||this.$vnode.data.tag||"span",t=Object.create(null),a=this.prevChildren=this.children,s=this.$slots.default||[],i=this.children=[],r=Gs(this),l=0;l<s.length;l++){if((d=s[l]).tag)if(null!=d.key&&0!==String(d.key).indexOf("__vlist"))i.push(d),t[d.key]=d,(d.data||(d.data={})).transition=r;else;}if(a){var o=[],c=[];for(l=0;l<a.length;l++){var d;(d=a[l]).data.transition=r,d.data.pos=d.elm.getBoundingClientRect(),t[d.key]?o.push(d):c.push(d)}this.kept=n(e,null,o),this.removed=c}return n(e,null,i)},updated:function(){var n=this.prevChildren,e=this.moveClass||(this.name||"v")+"-move";n.length&&this.hasMove(n[0].elm,e)&&(n.forEach(Ys),n.forEach(Zs),n.forEach(ni),this._reflow=document.body.offsetHeight,n.forEach((function(n){if(n.data.moved){var t=n.elm,a=t.style;Es(t,e),a.transform=a.WebkitTransform=a.transitionDuration="",t.addEventListener(fs,t._moveCb=function n(a){a&&a.target!==t||a&&!/transform$/.test(a.propertyName)||(t.removeEventListener(fs,n),t._moveCb=null,xs(t,e))})}})))},methods:{hasMove:function(n,e){if(!hs)return!1;if(this._hasMove)return this._hasMove;var t=n.cloneNode();n._transitionClasses&&n._transitionClasses.forEach((function(n){us(t,n)})),ds(t,e),t.style.display="none",this.$el.appendChild(t);var a=ks(t);return this.$el.removeChild(t),this._hasMove=a.hasTransform}}}};function ti(n,e){for(var t in e)n[t]=e[t];return n}Kt.config.mustUseProp=function(n,e,t){return"value"===t&&ta(n)&&"button"!==e||"selected"===t&&"option"===n||"checked"===t&&"input"===n||"muted"===t&&"video"===n},Kt.config.isReservedTag=ba,Kt.config.isReservedAttr=ea,Kt.config.getTagNamespace=function(n){return fa(n)?"svg":"math"===n?"math":void 0},Kt.config.isUnknownElement=function(n){if(!W)return!0;if(ba(n))return!1;if(n=n.toLowerCase(),null!=ya[n])return ya[n];var e=document.createElement(n);return n.indexOf("-")>-1?ya[n]=e.constructor===window.HTMLUnknownElement||e.constructor===window.HTMLElement:ya[n]=/HTMLUnknownElement/.test(e.toString())},L(Kt.options.directives,Us),L(Kt.options.components,ei),Kt.prototype.__patch__=W?zs:D,Kt.prototype.$mount=function(n,e){return function(n,e,t){var a;n.$el=e,n.$options.render||(n.$options.render=gn),et(n,"beforeMount"),a=function(){n._update(n._render(),t)},new Ge(n,a,D,{before:function(){n._isMounted&&!n._isDestroyed&&et(n,"beforeUpdate")}},!0),t=!1;var s=n._preWatchers;if(s)for(var i=0;i<s.length;i++)s[i].run();return null==n.$vnode&&(n._isMounted=!0,et(n,"mounted")),n}(this,n=n&&W?function(n){if("string"==typeof n){var e=document.querySelector(n);return e||document.createElement("div")}return n}(n):void 0,e)},W&&setTimeout((function(){U.devtools&&on&&on.emit("init",Kt)}),0);var ai=/[!'()*]/g,si=function(n){return"%"+n.charCodeAt(0).toString(16)},ii=/%2C/g,ri=function(n){return encodeURIComponent(n).replace(ai,si).replace(ii,",")};function li(n){try{return decodeURIComponent(n)}catch(n){0}return n}var oi=function(n){return null==n||"object"==typeof n?n:String(n)};function ci(n){var e={};return(n=n.trim().replace(/^(\?|#|&)/,""))?(n.split("&").forEach((function(n){var t=n.replace(/\+/g," ").split("="),a=li(t.shift()),s=t.length>0?li(t.join("=")):null;void 0===e[a]?e[a]=s:Array.isArray(e[a])?e[a].push(s):e[a]=[e[a],s]})),e):e}function di(n){var e=n?Object.keys(n).map((function(e){var t=n[e];if(void 0===t)return"";if(null===t)return ri(e);if(Array.isArray(t)){var a=[];return t.forEach((function(n){void 0!==n&&(null===n?a.push(ri(e)):a.push(ri(e)+"="+ri(n)))})),a.join("&")}return ri(e)+"="+ri(t)})).filter((function(n){return n.length>0})).join("&"):null;return e?"?"+e:""}var ui=/\/?$/;function mi(n,e,t,a){var s=a&&a.options.stringifyQuery,i=e.query||{};try{i=pi(i)}catch(n){}var r={name:e.name||n&&n.name,meta:n&&n.meta||{},path:e.path||"/",hash:e.hash||"",query:i,params:e.params||{},fullPath:fi(e,s),matched:n?gi(n):[]};return t&&(r.redirectedFrom=fi(t,s)),Object.freeze(r)}function pi(n){if(Array.isArray(n))return n.map(pi);if(n&&"object"==typeof n){var e={};for(var t in n)e[t]=pi(n[t]);return e}return n}var hi=mi(null,{path:"/"});function gi(n){for(var e=[];n;)e.unshift(n),n=n.parent;return e}function fi(n,e){var t=n.path,a=n.query;void 0===a&&(a={});var s=n.hash;return void 0===s&&(s=""),(t||"/")+(e||di)(a)+s}function bi(n,e,t){return e===hi?n===e:!!e&&(n.path&&e.path?n.path.replace(ui,"")===e.path.replace(ui,"")&&(t||n.hash===e.hash&&yi(n.query,e.query)):!(!n.name||!e.name)&&(n.name===e.name&&(t||n.hash===e.hash&&yi(n.query,e.query)&&yi(n.params,e.params))))}function yi(n,e){if(void 0===n&&(n={}),void 0===e&&(e={}),!n||!e)return n===e;var t=Object.keys(n).sort(),a=Object.keys(e).sort();return t.length===a.length&&t.every((function(t,s){var i=n[t];if(a[s]!==t)return!1;var r=e[t];return null==i||null==r?i===r:"object"==typeof i&&"object"==typeof r?yi(i,r):String(i)===String(r)}))}function vi(n){for(var e=0;e<n.matched.length;e++){var t=n.matched[e];for(var a in t.instances){var s=t.instances[a],i=t.enteredCbs[a];if(s&&i){delete t.enteredCbs[a];for(var r=0;r<i.length;r++)s._isBeingDestroyed||i[r](s)}}}}var _i={name:"RouterView",functional:!0,props:{name:{type:String,default:"default"}},render:function(n,e){var t=e.props,a=e.children,s=e.parent,i=e.data;i.routerView=!0;for(var r=s.$createElement,l=t.name,o=s.$route,c=s._routerViewCache||(s._routerViewCache={}),d=0,u=!1;s&&s._routerRoot!==s;){var m=s.$vnode?s.$vnode.data:{};m.routerView&&d++,m.keepAlive&&s._directInactive&&s._inactive&&(u=!0),s=s.$parent}if(i.routerViewDepth=d,u){var p=c[l],h=p&&p.component;return h?(p.configProps&&Ei(h,i,p.route,p.configProps),r(h,i,a)):r()}var g=o.matched[d],f=g&&g.components[l];if(!g||!f)return c[l]=null,r();c[l]={component:f},i.registerRouteInstance=function(n,e){var t=g.instances[l];(e&&t!==n||!e&&t===n)&&(g.instances[l]=e)},(i.hook||(i.hook={})).prepatch=function(n,e){g.instances[l]=e.componentInstance},i.hook.init=function(n){n.data.keepAlive&&n.componentInstance&&n.componentInstance!==g.instances[l]&&(g.instances[l]=n.componentInstance),vi(o)};var b=g.props&&g.props[l];return b&&(ti(c[l],{route:o,configProps:b}),Ei(f,i,o,b)),r(f,i,a)}};function Ei(n,e,t,a){var s=e.props=function(n,e){switch(typeof e){case"undefined":return;case"object":return e;case"function":return e(n);case"boolean":return e?n.params:void 0;default:0}}(t,a);if(s){s=e.props=ti({},s);var i=e.attrs=e.attrs||{};for(var r in s)n.props&&r in n.props||(i[r]=s[r],delete s[r])}}function xi(n,e,t){var a=n.charAt(0);if("/"===a)return n;if("?"===a||"#"===a)return e+n;var s=e.split("/");t&&s[s.length-1]||s.pop();for(var i=n.replace(/^\//,"").split("/"),r=0;r<i.length;r++){var l=i[r];".."===l?s.pop():"."!==l&&s.push(l)}return""!==s[0]&&s.unshift(""),s.join("/")}function Ti(n){return n.replace(/\/(?:\s*\/)+/g,"/")}var wi=Array.isArray||function(n){return"[object Array]"==Object.prototype.toString.call(n)},ki=Pi,Ii=Bi,Si=function(n,e){return zi(Bi(n,e),e)},qi=zi,Ri=Ni,Ai=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function Bi(n,e){for(var t,a=[],s=0,i=0,r="",l=e&&e.delimiter||"/";null!=(t=Ai.exec(n));){var o=t[0],c=t[1],d=t.index;if(r+=n.slice(i,d),i=d+o.length,c)r+=c[1];else{var u=n[i],m=t[2],p=t[3],h=t[4],g=t[5],f=t[6],b=t[7];r&&(a.push(r),r="");var y=null!=m&&null!=u&&u!==m,v="+"===f||"*"===f,_="?"===f||"*"===f,E=t[2]||l,x=h||g;a.push({name:p||s++,prefix:m||"",delimiter:E,optional:_,repeat:v,partial:y,asterisk:!!b,pattern:x?Mi(x):b?".*":"[^"+Di(E)+"]+?"})}}return i<n.length&&(r+=n.substr(i)),r&&a.push(r),a}function Li(n){return encodeURI(n).replace(/[\/?#]/g,(function(n){return"%"+n.charCodeAt(0).toString(16).toUpperCase()}))}function zi(n,e){for(var t=new Array(n.length),a=0;a<n.length;a++)"object"==typeof n[a]&&(t[a]=new RegExp("^(?:"+n[a].pattern+")$",Oi(e)));return function(e,a){for(var s="",i=e||{},r=(a||{}).pretty?Li:encodeURIComponent,l=0;l<n.length;l++){var o=n[l];if("string"!=typeof o){var c,d=i[o.name];if(null==d){if(o.optional){o.partial&&(s+=o.prefix);continue}throw new TypeError('Expected "'+o.name+'" to be defined')}if(wi(d)){if(!o.repeat)throw new TypeError('Expected "'+o.name+'" to not repeat, but received `'+JSON.stringify(d)+"`");if(0===d.length){if(o.optional)continue;throw new TypeError('Expected "'+o.name+'" to not be empty')}for(var u=0;u<d.length;u++){if(c=r(d[u]),!t[l].test(c))throw new TypeError('Expected all "'+o.name+'" to match "'+o.pattern+'", but received `'+JSON.stringify(c)+"`");s+=(0===u?o.prefix:o.delimiter)+c}}else{if(c=o.asterisk?encodeURI(d).replace(/[?#]/g,(function(n){return"%"+n.charCodeAt(0).toString(16).toUpperCase()})):r(d),!t[l].test(c))throw new TypeError('Expected "'+o.name+'" to match "'+o.pattern+'", but received "'+c+'"');s+=o.prefix+c}}else s+=o}return s}}function Di(n){return n.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function Mi(n){return n.replace(/([=!:$\/()])/g,"\\$1")}function Ci(n,e){return n.keys=e,n}function Oi(n){return n&&n.sensitive?"":"i"}function Ni(n,e,t){wi(e)||(t=e||t,e=[]);for(var a=(t=t||{}).strict,s=!1!==t.end,i="",r=0;r<n.length;r++){var l=n[r];if("string"==typeof l)i+=Di(l);else{var o=Di(l.prefix),c="(?:"+l.pattern+")";e.push(l),l.repeat&&(c+="(?:"+o+c+")*"),i+=c=l.optional?l.partial?o+"("+c+")?":"(?:"+o+"("+c+"))?":o+"("+c+")"}}var d=Di(t.delimiter||"/"),u=i.slice(-d.length)===d;return a||(i=(u?i.slice(0,-d.length):i)+"(?:"+d+"(?=$))?"),i+=s?"$":a&&u?"":"(?="+d+"|$)",Ci(new RegExp("^"+i,Oi(t)),e)}function Pi(n,e,t){return wi(e)||(t=e||t,e=[]),t=t||{},n instanceof RegExp?function(n,e){var t=n.source.match(/\((?!\?)/g);if(t)for(var a=0;a<t.length;a++)e.push({name:a,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return Ci(n,e)}(n,e):wi(n)?function(n,e,t){for(var a=[],s=0;s<n.length;s++)a.push(Pi(n[s],e,t).source);return Ci(new RegExp("(?:"+a.join("|")+")",Oi(t)),e)}(n,e,t):function(n,e,t){return Ni(Bi(n,t),e,t)}(n,e,t)}ki.parse=Ii,ki.compile=Si,ki.tokensToFunction=qi,ki.tokensToRegExp=Ri;var ji=Object.create(null);function Fi(n,e,t){e=e||{};try{var a=ji[n]||(ji[n]=ki.compile(n));return"string"==typeof e.pathMatch&&(e[0]=e.pathMatch),a(e,{pretty:!0})}catch(n){return""}finally{delete e[0]}}function Hi(n,e,t,a){var s="string"==typeof n?{path:n}:n;if(s._normalized)return s;if(s.name){var i=(s=ti({},n)).params;return i&&"object"==typeof i&&(s.params=ti({},i)),s}if(!s.path&&s.params&&e){(s=ti({},s))._normalized=!0;var r=ti(ti({},e.params),s.params);if(e.name)s.name=e.name,s.params=r;else if(e.matched.length){var l=e.matched[e.matched.length-1].path;s.path=Fi(l,r,e.path)}else 0;return s}var o=function(n){var e="",t="",a=n.indexOf("#");a>=0&&(e=n.slice(a),n=n.slice(0,a));var s=n.indexOf("?");return s>=0&&(t=n.slice(s+1),n=n.slice(0,s)),{path:n,query:t,hash:e}}(s.path||""),c=e&&e.path||"/",d=o.path?xi(o.path,c,t||s.append):c,u=function(n,e,t){void 0===e&&(e={});var a,s=t||ci;try{a=s(n||"")}catch(n){a={}}for(var i in e){var r=e[i];a[i]=Array.isArray(r)?r.map(oi):oi(r)}return a}(o.query,s.query,a&&a.options.parseQuery),m=s.hash||o.hash;return m&&"#"!==m.charAt(0)&&(m="#"+m),{_normalized:!0,path:d,query:u,hash:m}}var Ui,$i=function(){},Qi={name:"RouterLink",props:{to:{type:[String,Object],required:!0},tag:{type:String,default:"a"},custom:Boolean,exact:Boolean,exactPath:Boolean,append:Boolean,replace:Boolean,activeClass:String,exactActiveClass:String,ariaCurrentValue:{type:String,default:"page"},event:{type:[String,Array],default:"click"}},render:function(n){var e=this,t=this.$router,a=this.$route,s=t.resolve(this.to,a,this.append),i=s.location,r=s.route,l=s.href,o={},c=t.options.linkActiveClass,d=t.options.linkExactActiveClass,u=null==c?"router-link-active":c,m=null==d?"router-link-exact-active":d,p=null==this.activeClass?u:this.activeClass,h=null==this.exactActiveClass?m:this.exactActiveClass,g=r.redirectedFrom?mi(null,Hi(r.redirectedFrom),null,t):r;o[h]=bi(a,g,this.exactPath),o[p]=this.exact||this.exactPath?o[h]:function(n,e){return 0===n.path.replace(ui,"/").indexOf(e.path.replace(ui,"/"))&&(!e.hash||n.hash===e.hash)&&function(n,e){for(var t in e)if(!(t in n))return!1;return!0}(n.query,e.query)}(a,g);var f=o[h]?this.ariaCurrentValue:null,b=function(n){Gi(n)&&(e.replace?t.replace(i,$i):t.push(i,$i))},y={click:Gi};Array.isArray(this.event)?this.event.forEach((function(n){y[n]=b})):y[this.event]=b;var v={class:o},_=!this.$scopedSlots.$hasNormal&&this.$scopedSlots.default&&this.$scopedSlots.default({href:l,route:r,navigate:b,isActive:o[p],isExactActive:o[h]});if(_){if(1===_.length)return _[0];if(_.length>1||!_.length)return 0===_.length?n():n("span",{},_)}if("a"===this.tag)v.on=y,v.attrs={href:l,"aria-current":f};else{var E=function n(e){var t;if(e)for(var a=0;a<e.length;a++){if("a"===(t=e[a]).tag)return t;if(t.children&&(t=n(t.children)))return t}}(this.$slots.default);if(E){E.isStatic=!1;var x=E.data=ti({},E.data);for(var T in x.on=x.on||{},x.on){var w=x.on[T];T in y&&(x.on[T]=Array.isArray(w)?w:[w])}for(var k in y)k in x.on?x.on[k].push(y[k]):x.on[k]=b;var I=E.data.attrs=ti({},E.data.attrs);I.href=l,I["aria-current"]=f}else v.on=y}return n(this.tag,v,this.$slots.default)}};function Gi(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey||n.defaultPrevented||void 0!==n.button&&0!==n.button)){if(n.currentTarget&&n.currentTarget.getAttribute){var e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}var Ki="undefined"!=typeof window;function Vi(n,e,t,a,s){var i=e||[],r=t||Object.create(null),l=a||Object.create(null);n.forEach((function(n){!function n(e,t,a,s,i,r){var l=s.path,o=s.name;0;var c=s.pathToRegexpOptions||{},d=function(n,e,t){t||(n=n.replace(/\/$/,""));if("/"===n[0])return n;if(null==e)return n;return Ti(e.path+"/"+n)}(l,i,c.strict);"boolean"==typeof s.caseSensitive&&(c.sensitive=s.caseSensitive);var u={path:d,regex:Wi(d,c),components:s.components||{default:s.component},alias:s.alias?"string"==typeof s.alias?[s.alias]:s.alias:[],instances:{},enteredCbs:{},name:o,parent:i,matchAs:r,redirect:s.redirect,beforeEnter:s.beforeEnter,meta:s.meta||{},props:null==s.props?{}:s.components?s.props:{default:s.props}};s.children&&s.children.forEach((function(s){var i=r?Ti(r+"/"+s.path):void 0;n(e,t,a,s,u,i)}));t[u.path]||(e.push(u.path),t[u.path]=u);if(void 0!==s.alias)for(var m=Array.isArray(s.alias)?s.alias:[s.alias],p=0;p<m.length;++p){0;var h={path:m[p],children:s.children};n(e,t,a,h,i,u.path||"/")}o&&(a[o]||(a[o]=u))}(i,r,l,n,s)}));for(var o=0,c=i.length;o<c;o++)"*"===i[o]&&(i.push(i.splice(o,1)[0]),c--,o--);return{pathList:i,pathMap:r,nameMap:l}}function Wi(n,e){return ki(n,[],e)}function Ji(n,e){var t=Vi(n),a=t.pathList,s=t.pathMap,i=t.nameMap;function r(n,t,r){var l=Hi(n,t,!1,e),c=l.name;if(c){var d=i[c];if(!d)return o(null,l);var u=d.regex.keys.filter((function(n){return!n.optional})).map((function(n){return n.name}));if("object"!=typeof l.params&&(l.params={}),t&&"object"==typeof t.params)for(var m in t.params)!(m in l.params)&&u.indexOf(m)>-1&&(l.params[m]=t.params[m]);return l.path=Fi(d.path,l.params),o(d,l,r)}if(l.path){l.params={};for(var p=0;p<a.length;p++){var h=a[p],g=s[h];if(Xi(g.regex,l.path,l.params))return o(g,l,r)}}return o(null,l)}function l(n,t){var a=n.redirect,s="function"==typeof a?a(mi(n,t,null,e)):a;if("string"==typeof s&&(s={path:s}),!s||"object"!=typeof s)return o(null,t);var l=s,c=l.name,d=l.path,u=t.query,m=t.hash,p=t.params;if(u=l.hasOwnProperty("query")?l.query:u,m=l.hasOwnProperty("hash")?l.hash:m,p=l.hasOwnProperty("params")?l.params:p,c){i[c];return r({_normalized:!0,name:c,query:u,hash:m,params:p},void 0,t)}if(d){var h=function(n,e){return xi(n,e.parent?e.parent.path:"/",!0)}(d,n);return r({_normalized:!0,path:Fi(h,p),query:u,hash:m},void 0,t)}return o(null,t)}function o(n,t,a){return n&&n.redirect?l(n,a||t):n&&n.matchAs?function(n,e,t){var a=r({_normalized:!0,path:Fi(t,e.params)});if(a){var s=a.matched,i=s[s.length-1];return e.params=a.params,o(i,e)}return o(null,e)}(0,t,n.matchAs):mi(n,t,a,e)}return{match:r,addRoute:function(n,e){var t="object"!=typeof n?i[n]:void 0;Vi([e||n],a,s,i,t),t&&t.alias.length&&Vi(t.alias.map((function(n){return{path:n,children:[e]}})),a,s,i,t)},getRoutes:function(){return a.map((function(n){return s[n]}))},addRoutes:function(n){Vi(n,a,s,i)}}}function Xi(n,e,t){var a=e.match(n);if(!a)return!1;if(!t)return!0;for(var s=1,i=a.length;s<i;++s){var r=n.keys[s-1];r&&(t[r.name||"pathMatch"]="string"==typeof a[s]?li(a[s]):a[s])}return!0}var Yi=Ki&&window.performance&&window.performance.now?window.performance:Date;function Zi(){return Yi.now().toFixed(3)}var nr=Zi();function er(){return nr}function tr(n){return nr=n}var ar=Object.create(null);function sr(){"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual");var n=window.location.protocol+"//"+window.location.host,e=window.location.href.replace(n,""),t=ti({},window.history.state);return t.key=er(),window.history.replaceState(t,"",e),window.addEventListener("popstate",lr),function(){window.removeEventListener("popstate",lr)}}function ir(n,e,t,a){if(n.app){var s=n.options.scrollBehavior;s&&n.app.$nextTick((function(){var i=function(){var n=er();if(n)return ar[n]}(),r=s.call(n,e,t,a?i:null);r&&("function"==typeof r.then?r.then((function(n){mr(n,i)})).catch((function(n){0})):mr(r,i))}))}}function rr(){var n=er();n&&(ar[n]={x:window.pageXOffset,y:window.pageYOffset})}function lr(n){rr(),n.state&&n.state.key&&tr(n.state.key)}function or(n){return dr(n.x)||dr(n.y)}function cr(n){return{x:dr(n.x)?n.x:window.pageXOffset,y:dr(n.y)?n.y:window.pageYOffset}}function dr(n){return"number"==typeof n}var ur=/^#\d/;function mr(n,e){var t,a="object"==typeof n;if(a&&"string"==typeof n.selector){var s=ur.test(n.selector)?document.getElementById(n.selector.slice(1)):document.querySelector(n.selector);if(s){var i=n.offset&&"object"==typeof n.offset?n.offset:{};e=function(n,e){var t=document.documentElement.getBoundingClientRect(),a=n.getBoundingClientRect();return{x:a.left-t.left-e.x,y:a.top-t.top-e.y}}(s,i={x:dr((t=i).x)?t.x:0,y:dr(t.y)?t.y:0})}else or(n)&&(e=cr(n))}else a&&or(n)&&(e=cr(n));e&&("scrollBehavior"in document.documentElement.style?window.scrollTo({left:e.x,top:e.y,behavior:n.behavior}):window.scrollTo(e.x,e.y))}var pr,hr=Ki&&((-1===(pr=window.navigator.userAgent).indexOf("Android 2.")&&-1===pr.indexOf("Android 4.0")||-1===pr.indexOf("Mobile Safari")||-1!==pr.indexOf("Chrome")||-1!==pr.indexOf("Windows Phone"))&&window.history&&"function"==typeof window.history.pushState);function gr(n,e){rr();var t=window.history;try{if(e){var a=ti({},t.state);a.key=er(),t.replaceState(a,"",n)}else t.pushState({key:tr(Zi())},"",n)}catch(t){window.location[e?"replace":"assign"](n)}}function fr(n){gr(n,!0)}var br={redirected:2,aborted:4,cancelled:8,duplicated:16};function yr(n,e){return _r(n,e,br.redirected,'Redirected when going from "'+n.fullPath+'" to "'+function(n){if("string"==typeof n)return n;if("path"in n)return n.path;var e={};return Er.forEach((function(t){t in n&&(e[t]=n[t])})),JSON.stringify(e,null,2)}(e)+'" via a navigation guard.')}function vr(n,e){return _r(n,e,br.cancelled,'Navigation cancelled from "'+n.fullPath+'" to "'+e.fullPath+'" with a new navigation.')}function _r(n,e,t,a){var s=new Error(a);return s._isRouter=!0,s.from=n,s.to=e,s.type=t,s}var Er=["params","query","hash"];function xr(n){return Object.prototype.toString.call(n).indexOf("Error")>-1}function Tr(n,e){return xr(n)&&n._isRouter&&(null==e||n.type===e)}function wr(n,e,t){var a=function(s){s>=n.length?t():n[s]?e(n[s],(function(){a(s+1)})):a(s+1)};a(0)}function kr(n){return function(e,t,a){var s=!1,i=0,r=null;Ir(n,(function(n,e,t,l){if("function"==typeof n&&void 0===n.cid){s=!0,i++;var o,c=Rr((function(e){var s;((s=e).__esModule||qr&&"Module"===s[Symbol.toStringTag])&&(e=e.default),n.resolved="function"==typeof e?e:Ui.extend(e),t.components[l]=e,--i<=0&&a()})),d=Rr((function(n){var e="Failed to resolve async component "+l+": "+n;r||(r=xr(n)?n:new Error(e),a(r))}));try{o=n(c,d)}catch(n){d(n)}if(o)if("function"==typeof o.then)o.then(c,d);else{var u=o.component;u&&"function"==typeof u.then&&u.then(c,d)}}})),s||a()}}function Ir(n,e){return Sr(n.map((function(n){return Object.keys(n.components).map((function(t){return e(n.components[t],n.instances[t],n,t)}))})))}function Sr(n){return Array.prototype.concat.apply([],n)}var qr="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;function Rr(n){var e=!1;return function(){for(var t=[],a=arguments.length;a--;)t[a]=arguments[a];if(!e)return e=!0,n.apply(this,t)}}var Ar=function(n,e){this.router=n,this.base=function(n){if(!n)if(Ki){var e=document.querySelector("base");n=(n=e&&e.getAttribute("href")||"/").replace(/^https?:\/\/[^\/]+/,"")}else n="/";"/"!==n.charAt(0)&&(n="/"+n);return n.replace(/\/$/,"")}(e),this.current=hi,this.pending=null,this.ready=!1,this.readyCbs=[],this.readyErrorCbs=[],this.errorCbs=[],this.listeners=[]};function Br(n,e,t,a){var s=Ir(n,(function(n,a,s,i){var r=function(n,e){"function"!=typeof n&&(n=Ui.extend(n));return n.options[e]}(n,e);if(r)return Array.isArray(r)?r.map((function(n){return t(n,a,s,i)})):t(r,a,s,i)}));return Sr(a?s.reverse():s)}function Lr(n,e){if(e)return function(){return n.apply(e,arguments)}}Ar.prototype.listen=function(n){this.cb=n},Ar.prototype.onReady=function(n,e){this.ready?n():(this.readyCbs.push(n),e&&this.readyErrorCbs.push(e))},Ar.prototype.onError=function(n){this.errorCbs.push(n)},Ar.prototype.transitionTo=function(n,e,t){var a,s=this;try{a=this.router.match(n,this.current)}catch(n){throw this.errorCbs.forEach((function(e){e(n)})),n}var i=this.current;this.confirmTransition(a,(function(){s.updateRoute(a),e&&e(a),s.ensureURL(),s.router.afterHooks.forEach((function(n){n&&n(a,i)})),s.ready||(s.ready=!0,s.readyCbs.forEach((function(n){n(a)})))}),(function(n){t&&t(n),n&&!s.ready&&(Tr(n,br.redirected)&&i===hi||(s.ready=!0,s.readyErrorCbs.forEach((function(e){e(n)}))))}))},Ar.prototype.confirmTransition=function(n,e,t){var a=this,s=this.current;this.pending=n;var i,r,l=function(n){!Tr(n)&&xr(n)&&(a.errorCbs.length?a.errorCbs.forEach((function(e){e(n)})):console.error(n)),t&&t(n)},o=n.matched.length-1,c=s.matched.length-1;if(bi(n,s)&&o===c&&n.matched[o]===s.matched[c])return this.ensureURL(),n.hash&&ir(this.router,s,n,!1),l(((r=_r(i=s,n,br.duplicated,'Avoided redundant navigation to current location: "'+i.fullPath+'".')).name="NavigationDuplicated",r));var d=function(n,e){var t,a=Math.max(n.length,e.length);for(t=0;t<a&&n[t]===e[t];t++);return{updated:e.slice(0,t),activated:e.slice(t),deactivated:n.slice(t)}}(this.current.matched,n.matched),u=d.updated,m=d.deactivated,p=d.activated,h=[].concat(function(n){return Br(n,"beforeRouteLeave",Lr,!0)}(m),this.router.beforeHooks,function(n){return Br(n,"beforeRouteUpdate",Lr)}(u),p.map((function(n){return n.beforeEnter})),kr(p)),g=function(e,t){if(a.pending!==n)return l(vr(s,n));try{e(n,s,(function(e){!1===e?(a.ensureURL(!0),l(function(n,e){return _r(n,e,br.aborted,'Navigation aborted from "'+n.fullPath+'" to "'+e.fullPath+'" via a navigation guard.')}(s,n))):xr(e)?(a.ensureURL(!0),l(e)):"string"==typeof e||"object"==typeof e&&("string"==typeof e.path||"string"==typeof e.name)?(l(yr(s,n)),"object"==typeof e&&e.replace?a.replace(e):a.push(e)):t(e)}))}catch(n){l(n)}};wr(h,g,(function(){wr(function(n){return Br(n,"beforeRouteEnter",(function(n,e,t,a){return function(n,e,t){return function(a,s,i){return n(a,s,(function(n){"function"==typeof n&&(e.enteredCbs[t]||(e.enteredCbs[t]=[]),e.enteredCbs[t].push(n)),i(n)}))}}(n,t,a)}))}(p).concat(a.router.resolveHooks),g,(function(){if(a.pending!==n)return l(vr(s,n));a.pending=null,e(n),a.router.app&&a.router.app.$nextTick((function(){vi(n)}))}))}))},Ar.prototype.updateRoute=function(n){this.current=n,this.cb&&this.cb(n)},Ar.prototype.setupListeners=function(){},Ar.prototype.teardown=function(){this.listeners.forEach((function(n){n()})),this.listeners=[],this.current=hi,this.pending=null};var zr=function(n){function e(e,t){n.call(this,e,t),this._startLocation=Dr(this.base)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var n=this;if(!(this.listeners.length>0)){var e=this.router,t=e.options.scrollBehavior,a=hr&&t;a&&this.listeners.push(sr());var s=function(){var t=n.current,s=Dr(n.base);n.current===hi&&s===n._startLocation||n.transitionTo(s,(function(n){a&&ir(e,n,t,!0)}))};window.addEventListener("popstate",s),this.listeners.push((function(){window.removeEventListener("popstate",s)}))}},e.prototype.go=function(n){window.history.go(n)},e.prototype.push=function(n,e,t){var a=this,s=this.current;this.transitionTo(n,(function(n){gr(Ti(a.base+n.fullPath)),ir(a.router,n,s,!1),e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var a=this,s=this.current;this.transitionTo(n,(function(n){fr(Ti(a.base+n.fullPath)),ir(a.router,n,s,!1),e&&e(n)}),t)},e.prototype.ensureURL=function(n){if(Dr(this.base)!==this.current.fullPath){var e=Ti(this.base+this.current.fullPath);n?gr(e):fr(e)}},e.prototype.getCurrentLocation=function(){return Dr(this.base)},e}(Ar);function Dr(n){var e=window.location.pathname,t=e.toLowerCase(),a=n.toLowerCase();return!n||t!==a&&0!==t.indexOf(Ti(a+"/"))||(e=e.slice(n.length)),(e||"/")+window.location.search+window.location.hash}var Mr=function(n){function e(e,t,a){n.call(this,e,t),a&&function(n){var e=Dr(n);if(!/^\/#/.test(e))return window.location.replace(Ti(n+"/#"+e)),!0}(this.base)||Cr()}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var n=this;if(!(this.listeners.length>0)){var e=this.router.options.scrollBehavior,t=hr&&e;t&&this.listeners.push(sr());var a=function(){var e=n.current;Cr()&&n.transitionTo(Or(),(function(a){t&&ir(n.router,a,e,!0),hr||jr(a.fullPath)}))},s=hr?"popstate":"hashchange";window.addEventListener(s,a),this.listeners.push((function(){window.removeEventListener(s,a)}))}},e.prototype.push=function(n,e,t){var a=this,s=this.current;this.transitionTo(n,(function(n){Pr(n.fullPath),ir(a.router,n,s,!1),e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var a=this,s=this.current;this.transitionTo(n,(function(n){jr(n.fullPath),ir(a.router,n,s,!1),e&&e(n)}),t)},e.prototype.go=function(n){window.history.go(n)},e.prototype.ensureURL=function(n){var e=this.current.fullPath;Or()!==e&&(n?Pr(e):jr(e))},e.prototype.getCurrentLocation=function(){return Or()},e}(Ar);function Cr(){var n=Or();return"/"===n.charAt(0)||(jr("/"+n),!1)}function Or(){var n=window.location.href,e=n.indexOf("#");return e<0?"":n=n.slice(e+1)}function Nr(n){var e=window.location.href,t=e.indexOf("#");return(t>=0?e.slice(0,t):e)+"#"+n}function Pr(n){hr?gr(Nr(n)):window.location.hash=n}function jr(n){hr?fr(Nr(n)):window.location.replace(Nr(n))}var Fr=function(n){function e(e,t){n.call(this,e,t),this.stack=[],this.index=-1}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.push=function(n,e,t){var a=this;this.transitionTo(n,(function(n){a.stack=a.stack.slice(0,a.index+1).concat(n),a.index++,e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var a=this;this.transitionTo(n,(function(n){a.stack=a.stack.slice(0,a.index).concat(n),e&&e(n)}),t)},e.prototype.go=function(n){var e=this,t=this.index+n;if(!(t<0||t>=this.stack.length)){var a=this.stack[t];this.confirmTransition(a,(function(){var n=e.current;e.index=t,e.updateRoute(a),e.router.afterHooks.forEach((function(e){e&&e(a,n)}))}),(function(n){Tr(n,br.duplicated)&&(e.index=t)}))}},e.prototype.getCurrentLocation=function(){var n=this.stack[this.stack.length-1];return n?n.fullPath:"/"},e.prototype.ensureURL=function(){},e}(Ar),Hr=function(n){void 0===n&&(n={}),this.app=null,this.apps=[],this.options=n,this.beforeHooks=[],this.resolveHooks=[],this.afterHooks=[],this.matcher=Ji(n.routes||[],this);var e=n.mode||"hash";switch(this.fallback="history"===e&&!hr&&!1!==n.fallback,this.fallback&&(e="hash"),Ki||(e="abstract"),this.mode=e,e){case"history":this.history=new zr(this,n.base);break;case"hash":this.history=new Mr(this,n.base,this.fallback);break;case"abstract":this.history=new Fr(this,n.base);break;default:0}},Ur={currentRoute:{configurable:!0}};Hr.prototype.match=function(n,e,t){return this.matcher.match(n,e,t)},Ur.currentRoute.get=function(){return this.history&&this.history.current},Hr.prototype.init=function(n){var e=this;if(this.apps.push(n),n.$once("hook:destroyed",(function(){var t=e.apps.indexOf(n);t>-1&&e.apps.splice(t,1),e.app===n&&(e.app=e.apps[0]||null),e.app||e.history.teardown()})),!this.app){this.app=n;var t=this.history;if(t instanceof zr||t instanceof Mr){var a=function(n){t.setupListeners(),function(n){var a=t.current,s=e.options.scrollBehavior;hr&&s&&"fullPath"in n&&ir(e,n,a,!1)}(n)};t.transitionTo(t.getCurrentLocation(),a,a)}t.listen((function(n){e.apps.forEach((function(e){e._route=n}))}))}},Hr.prototype.beforeEach=function(n){return Qr(this.beforeHooks,n)},Hr.prototype.beforeResolve=function(n){return Qr(this.resolveHooks,n)},Hr.prototype.afterEach=function(n){return Qr(this.afterHooks,n)},Hr.prototype.onReady=function(n,e){this.history.onReady(n,e)},Hr.prototype.onError=function(n){this.history.onError(n)},Hr.prototype.push=function(n,e,t){var a=this;if(!e&&!t&&"undefined"!=typeof Promise)return new Promise((function(e,t){a.history.push(n,e,t)}));this.history.push(n,e,t)},Hr.prototype.replace=function(n,e,t){var a=this;if(!e&&!t&&"undefined"!=typeof Promise)return new Promise((function(e,t){a.history.replace(n,e,t)}));this.history.replace(n,e,t)},Hr.prototype.go=function(n){this.history.go(n)},Hr.prototype.back=function(){this.go(-1)},Hr.prototype.forward=function(){this.go(1)},Hr.prototype.getMatchedComponents=function(n){var e=n?n.matched?n:this.resolve(n).route:this.currentRoute;return e?[].concat.apply([],e.matched.map((function(n){return Object.keys(n.components).map((function(e){return n.components[e]}))}))):[]},Hr.prototype.resolve=function(n,e,t){var a=Hi(n,e=e||this.history.current,t,this),s=this.match(a,e),i=s.redirectedFrom||s.fullPath;return{location:a,route:s,href:function(n,e,t){var a="hash"===t?"#"+e:e;return n?Ti(n+"/"+a):a}(this.history.base,i,this.mode),normalizedTo:a,resolved:s}},Hr.prototype.getRoutes=function(){return this.matcher.getRoutes()},Hr.prototype.addRoute=function(n,e){this.matcher.addRoute(n,e),this.history.current!==hi&&this.history.transitionTo(this.history.getCurrentLocation())},Hr.prototype.addRoutes=function(n){this.matcher.addRoutes(n),this.history.current!==hi&&this.history.transitionTo(this.history.getCurrentLocation())},Object.defineProperties(Hr.prototype,Ur);var $r=Hr;function Qr(n,e){return n.push(e),function(){var t=n.indexOf(e);t>-1&&n.splice(t,1)}}Hr.install=function n(e){if(!n.installed||Ui!==e){n.installed=!0,Ui=e;var t=function(n){return void 0!==n},a=function(n,e){var a=n.$options._parentVnode;t(a)&&t(a=a.data)&&t(a=a.registerRouteInstance)&&a(n,e)};e.mixin({beforeCreate:function(){t(this.$options.router)?(this._routerRoot=this,this._router=this.$options.router,this._router.init(this),e.util.defineReactive(this,"_route",this._router.history.current)):this._routerRoot=this.$parent&&this.$parent._routerRoot||this,a(this,this)},destroyed:function(){a(this)}}),Object.defineProperty(e.prototype,"$router",{get:function(){return this._routerRoot._router}}),Object.defineProperty(e.prototype,"$route",{get:function(){return this._routerRoot._route}}),e.component("RouterView",_i),e.component("RouterLink",Qi);var s=e.config.optionMergeStrategies;s.beforeRouteEnter=s.beforeRouteLeave=s.beforeRouteUpdate=s.created}},Hr.version="3.6.5",Hr.isNavigationFailure=Tr,Hr.NavigationFailureType=br,Hr.START_LOCATION=hi,Ki&&window.Vue&&window.Vue.use(Hr);t(108);t(130),t(16);var Gr={NotFound:()=>Promise.all([t.e(0),t.e(4)]).then(t.bind(null,343)),Layout:()=>Promise.all([t.e(0),t.e(2)]).then(t.bind(null,342))},Kr={"v-01aea2f9":()=>t.e(5).then(t.bind(null,344)),"v-2f525dc4":()=>t.e(6).then(t.bind(null,345)),"v-909a48e0":()=>t.e(8).then(t.bind(null,346)),"v-e3ca250c":()=>t.e(9).then(t.bind(null,347)),"v-4c53fba0":()=>t.e(7).then(t.bind(null,348)),"v-1a0fef38":()=>t.e(10).then(t.bind(null,349)),"v-208168d6":()=>t.e(11).then(t.bind(null,350)),"v-0fc408a8":()=>t.e(13).then(t.bind(null,351)),"v-099fc77f":()=>t.e(12).then(t.bind(null,352)),"v-cf9e4d54":()=>t.e(14).then(t.bind(null,353)),"v-49d5bdfa":()=>t.e(15).then(t.bind(null,354)),"v-0752b95e":()=>t.e(17).then(t.bind(null,355)),"v-3b295fba":()=>t.e(16).then(t.bind(null,356)),"v-b19bf61e":()=>t.e(18).then(t.bind(null,357)),"v-e2f7f754":()=>t.e(19).then(t.bind(null,358)),"v-41343aac":()=>t.e(21).then(t.bind(null,359)),"v-413ab35d":()=>t.e(20).then(t.bind(null,360)),"v-54c62a9f":()=>t.e(22).then(t.bind(null,361)),"v-6d5ab7d6":()=>t.e(23).then(t.bind(null,362)),"v-4ef63c90":()=>t.e(24).then(t.bind(null,363)),"v-4954d596":()=>t.e(26).then(t.bind(null,364)),"v-076936e6":()=>t.e(25).then(t.bind(null,365)),"v-74c83129":()=>t.e(27).then(t.bind(null,366)),"v-5a900e2a":()=>t.e(28).then(t.bind(null,367)),"v-7b0ce341":()=>t.e(29).then(t.bind(null,368)),"v-28fda0bf":()=>t.e(30).then(t.bind(null,369)),"v-62392692":()=>t.e(33).then(t.bind(null,370)),"v-44b09ccb":()=>t.e(32).then(t.bind(null,371)),"v-19684eb4":()=>t.e(31).then(t.bind(null,372)),"v-0f37026c":()=>t.e(35).then(t.bind(null,373)),"v-62ac19f1":()=>t.e(34).then(t.bind(null,374)),"v-f8f28ef4":()=>t.e(36).then(t.bind(null,375)),"v-925d1ece":()=>t.e(37).then(t.bind(null,376)),"v-2d5a6152":()=>t.e(38).then(t.bind(null,377)),"v-2310a086":()=>t.e(39).then(t.bind(null,378)),"v-0b02d45b":()=>t.e(40).then(t.bind(null,379)),"v-1211efa8":()=>t.e(41).then(t.bind(null,380)),"v-74c8571a":()=>t.e(42).then(t.bind(null,381)),"v-d98adcc4":()=>t.e(43).then(t.bind(null,382)),"v-cd3bd61e":()=>t.e(44).then(t.bind(null,383)),"v-2a8b7fae":()=>t.e(45).then(t.bind(null,384)),"v-a0623b42":()=>t.e(46).then(t.bind(null,385)),"v-80c82fb0":()=>t.e(47).then(t.bind(null,386)),"v-26fbb292":()=>t.e(48).then(t.bind(null,387)),"v-18f5009d":()=>t.e(49).then(t.bind(null,388)),"v-2ccee58b":()=>t.e(51).then(t.bind(null,389)),"v-671a08c2":()=>t.e(53).then(t.bind(null,390)),"v-5ed748af":()=>t.e(52).then(t.bind(null,391)),"v-5b5c3224":()=>t.e(50).then(t.bind(null,392)),"v-3aca0c7e":()=>t.e(55).then(t.bind(null,393)),"v-d46acfd6":()=>t.e(54).then(t.bind(null,394)),"v-644c6036":()=>t.e(56).then(t.bind(null,395)),"v-53db1c34":()=>t.e(57).then(t.bind(null,396)),"v-5bd38cef":()=>t.e(58).then(t.bind(null,397)),"v-458ab807":()=>t.e(60).then(t.bind(null,398)),"v-8b6e004c":()=>t.e(59).then(t.bind(null,399)),"v-2bc9cd70":()=>t.e(61).then(t.bind(null,400)),"v-a7ca3eb4":()=>t.e(62).then(t.bind(null,401)),"v-735c9d66":()=>t.e(63).then(t.bind(null,402)),"v-6479bc9f":()=>t.e(64).then(t.bind(null,403)),"v-2cf1626a":()=>t.e(65).then(t.bind(null,404)),"v-1c459100":()=>t.e(66).then(t.bind(null,405)),"v-04b75150":()=>t.e(67).then(t.bind(null,406)),"v-41d7fd45":()=>t.e(68).then(t.bind(null,407)),"v-83a32830":()=>t.e(69).then(t.bind(null,408)),"v-a1e79a52":()=>t.e(71).then(t.bind(null,409)),"v-0f15ab6e":()=>t.e(70).then(t.bind(null,410)),"v-f6b5c434":()=>t.e(72).then(t.bind(null,411)),"v-957680f8":()=>t.e(73).then(t.bind(null,412)),"v-2ac3b3cb":()=>t.e(74).then(t.bind(null,413)),"v-665de124":()=>t.e(76).then(t.bind(null,414)),"v-164e75b2":()=>t.e(75).then(t.bind(null,415)),"v-9a8c12f8":()=>t.e(77).then(t.bind(null,416)),"v-3c818a28":()=>t.e(78).then(t.bind(null,417)),"v-7c0bbdd0":()=>t.e(79).then(t.bind(null,418)),"v-2a07dc5d":()=>t.e(80).then(t.bind(null,419)),"v-717638d6":()=>t.e(81).then(t.bind(null,420)),"v-2c1e440a":()=>t.e(82).then(t.bind(null,421)),"v-ec0e4a94":()=>t.e(84).then(t.bind(null,422)),"v-15d3f40c":()=>t.e(85).then(t.bind(null,423)),"v-778f3185":()=>t.e(83).then(t.bind(null,424)),"v-6550ec14":()=>t.e(86).then(t.bind(null,425)),"v-8ad847d4":()=>t.e(88).then(t.bind(null,426)),"v-db66b0d8":()=>t.e(87).then(t.bind(null,427)),"v-0d48f15b":()=>t.e(90).then(t.bind(null,428)),"v-72683126":()=>t.e(91).then(t.bind(null,429)),"v-2afcea96":()=>t.e(89).then(t.bind(null,430)),"v-03067a49":()=>t.e(93).then(t.bind(null,431)),"v-be824b2e":()=>t.e(94).then(t.bind(null,432)),"v-c7c85e2e":()=>t.e(92).then(t.bind(null,433)),"v-91a7d35c":()=>t.e(95).then(t.bind(null,434))};function Vr(n){const e=Object.create(null);return function(t){return e[t]||(e[t]=n(t))}}const Wr=/-(\w)/g,Jr=Vr(n=>n.replace(Wr,(n,e)=>e?e.toUpperCase():"")),Xr=/\B([A-Z])/g,Yr=Vr(n=>n.replace(Xr,"-$1").toLowerCase()),Zr=Vr(n=>n.charAt(0).toUpperCase()+n.slice(1));function nl(n,e){if(!e)return;if(n(e))return n(e);return e.includes("-")?n(Zr(Jr(e))):n(Zr(e))||n(Yr(e))}const el=Object.assign({},Gr,Kr),tl=n=>el[n],al=n=>Kr[n],sl=n=>Gr[n],il=n=>Kt.component(n);function rl(n){return nl(al,n)}function ll(n){return nl(sl,n)}function ol(n){return nl(tl,n)}function cl(n){return nl(il,n)}function dl(...n){return Promise.all(n.filter(n=>n).map(async n=>{if(!cl(n)&&ol(n)){const e=await ol(n)();Kt.component(n,e.default)}}))}function ul(n,e){"undefined"!=typeof window&&window.__VUEPRESS__&&(window.__VUEPRESS__[n]=e)}var ml=t(93),pl=t.n(ml),hl=t(94),gl=t.n(hl),fl={created(){if(this.siteMeta=this.$site.headTags.filter(([n])=>"meta"===n).map(([n,e])=>e),this.$ssrContext){const e=this.getMergedMetaTags();this.$ssrContext.title=this.$title,this.$ssrContext.lang=this.$lang,this.$ssrContext.pageMeta=(n=e)?n.map(n=>{let e="<meta";return Object.keys(n).forEach(t=>{e+=` ${t}="${gl()(n[t])}"`}),e+">"}).join("\n    "):"",this.$ssrContext.canonicalLink=yl(this.$canonicalUrl)}var n},mounted(){this.currentMetaTags=[...document.querySelectorAll("meta")],this.updateMeta(),this.updateCanonicalLink()},methods:{updateMeta(){document.title=this.$title,document.documentElement.lang=this.$lang;const n=this.getMergedMetaTags();this.currentMetaTags=vl(n,this.currentMetaTags)},getMergedMetaTags(){const n=this.$page.frontmatter.meta||[];return pl()([{name:"description",content:this.$description}],n,this.siteMeta,_l)},updateCanonicalLink(){bl(),this.$canonicalUrl&&document.head.insertAdjacentHTML("beforeend",yl(this.$canonicalUrl))}},watch:{$page(){this.updateMeta(),this.updateCanonicalLink()}},beforeDestroy(){vl(null,this.currentMetaTags),bl()}};function bl(){const n=document.querySelector("link[rel='canonical']");n&&n.remove()}function yl(n=""){return n?`<link href="${n}" rel="canonical" />`:""}function vl(n,e){if(e&&[...e].filter(n=>n.parentNode===document.head).forEach(n=>document.head.removeChild(n)),n)return n.map(n=>{const e=document.createElement("meta");return Object.keys(n).forEach(t=>{e.setAttribute(t,n[t])}),document.head.appendChild(e),e})}function _l(n){for(const e of["name","property","itemprop"])if(n.hasOwnProperty(e))return n[e]+e;return JSON.stringify(n)}var El=t(52),xl={mounted(){window.addEventListener("scroll",this.onScroll)},methods:{onScroll:t.n(El)()((function(){this.setActiveHash()}),300),setActiveHash(){const n=[].slice.call(document.querySelectorAll(".sidebar-link")),e=[].slice.call(document.querySelectorAll(".header-anchor")).filter(e=>n.some(n=>n.hash===e.hash)),t=Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop),a=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),s=window.innerHeight+t;for(let n=0;n<e.length;n++){const i=e[n],r=e[n+1],l=0===n&&0===t||t>=i.parentElement.offsetTop+10&&(!r||t<r.parentElement.offsetTop-10),o=decodeURIComponent(this.$route.hash);if(l&&o!==decodeURIComponent(i.hash)){const t=i;if(s===a)for(let t=n+1;t<e.length;t++)if(o===decodeURIComponent(e[t].hash))return;return this.$vuepress.$set("disableScrollBehavior",!0),void this.$router.replace(decodeURIComponent(t.hash),()=>{this.$nextTick(()=>{this.$vuepress.$set("disableScrollBehavior",!1)})})}}}},beforeDestroy(){window.removeEventListener("scroll",this.onScroll)}},Tl=t(24),wl=t.n(Tl),kl={mounted(){wl.a.configure({showSpinner:!1}),this.$router.beforeEach((n,e,t)=>{n.path===e.path||Kt.component(n.name)||wl.a.start(),t()}),this.$router.afterEach(()=>{wl.a.done(),this.isSidebarOpen=!1})}};t(242),t(243);class Il{constructor(){this.containerEl=document.getElementById("message-container"),this.containerEl||(this.containerEl=document.createElement("div"),this.containerEl.id="message-container",document.body.appendChild(this.containerEl))}show({text:n="",duration:e=3e3}){let t=document.createElement("div");t.className="message move-in",t.innerHTML=`\n      <i style="fill: #06a35a;font-size: 14px;display:inline-flex;align-items: center;">\n        <svg style="fill: #06a35a;font-size: 14px;" t="1572421810237" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2323" width="16" height="16"><path d="M822.811993 824.617989c-83.075838 81.99224-188.546032 124.613757-316.049383 127.86455-122.085362-3.250794-223.943563-45.87231-305.935802-127.86455s-124.613757-184.21164-127.86455-305.935802c3.250794-127.503351 45.87231-232.973545 127.86455-316.049383 81.99224-83.075838 184.21164-126.058554 305.935802-129.309347 127.503351 3.250794 232.973545 46.23351 316.049383 129.309347 83.075838 83.075838 126.058554 188.546032 129.309347 316.049383C949.231746 640.406349 905.887831 742.62575 822.811993 824.617989zM432.716755 684.111464c3.973192 3.973192 8.307584 5.779189 13.364374 6.140388 5.05679 0.361199 9.752381-1.444797 13.364374-5.417989l292.571429-287.514638c3.973192-3.973192 5.779189-8.307584 5.779189-13.364374 0-5.05679-1.805996-9.752381-5.779189-13.364374l1.805996 1.805996c-3.973192-3.973192-8.668783-5.779189-14.086772-6.140388-5.417989-0.361199-10.47478 1.444797-14.809171 5.417989l-264.397884 220.33157c-3.973192 3.250794-8.668783 4.695591-14.447972 4.695591-5.779189 0-10.835979-1.444797-15.53157-3.973192l-94.273016-72.962257c-4.334392-3.250794-9.391182-4.334392-14.447972-3.973192s-9.391182 3.250794-12.641975 7.585185l-2.889594 3.973192c-3.250794 4.334392-4.334392 9.391182-3.973192 14.809171 0.722399 5.417989 2.528395 10.11358 5.779189 14.086772L432.716755 684.111464z" p-id="2324"></path></svg>\n      </i>\n      <div class="text">${n}</div>\n    `,this.containerEl.appendChild(t),e>0&&setTimeout(()=>{this.close(t)},e)}close(n){n.className=n.className.replace("move-in",""),n.className+="move-out",n.addEventListener("animationend",()=>{n.remove()})}}var Sl={mounted(){!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||this.updateCopy()},updated(){!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||this.updateCopy()},methods:{updateCopy(){setTimeout(()=>{(['div[class*="language-"] pre','div[class*="aside-code"] aside']instanceof Array||Array.isArray(['div[class*="language-"] pre','div[class*="aside-code"] aside']))&&['div[class*="language-"] pre','div[class*="aside-code"] aside'].forEach(n=>{document.querySelectorAll(n).forEach(this.generateCopyButton)})},1e3)},generateCopyButton(n){if(n.classList.contains("codecopy-enabled"))return;const e=document.createElement("i");e.className="code-copy",e.innerHTML='<svg  style="color:#aaa;font-size:14px" t="1572422231464" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3201" width="14" height="14"><path d="M866.461538 39.384615H354.461538c-43.323077 0-78.769231 35.446154-78.76923 78.769231v39.384616h472.615384c43.323077 0 78.769231 35.446154 78.769231 78.76923v551.384616h39.384615c43.323077 0 78.769231-35.446154 78.769231-78.769231V118.153846c0-43.323077-35.446154-78.769231-78.769231-78.769231z m-118.153846 275.692308c0-43.323077-35.446154-78.769231-78.76923-78.769231H157.538462c-43.323077 0-78.769231 35.446154-78.769231 78.769231v590.769231c0 43.323077 35.446154 78.769231 78.769231 78.769231h512c43.323077 0 78.769231-35.446154 78.76923-78.769231V315.076923z m-354.461538 137.846154c0 11.815385-7.876923 19.692308-19.692308 19.692308h-157.538461c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h157.538461c11.815385 0 19.692308 7.876923 19.692308 19.692308v39.384615z m157.538461 315.076923c0 11.815385-7.876923 19.692308-19.692307 19.692308H216.615385c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h315.076923c11.815385 0 19.692308 7.876923 19.692307 19.692308v39.384615z m78.769231-157.538462c0 11.815385-7.876923 19.692308-19.692308 19.692308H216.615385c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h393.846153c11.815385 0 19.692308 7.876923 19.692308 19.692308v39.384615z" p-id="3202"></path></svg>',e.title="Copy to clipboard",e.addEventListener("click",()=>{this.copyToClipboard(n.innerText)}),n.appendChild(e),n.classList.add("codecopy-enabled")},copyToClipboard(n){const e=document.createElement("textarea");e.value=n,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e);const t=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);e.select(),document.execCommand("copy");(new Il).show({text:"å¤å¶æå",duration:1e3}),document.body.removeChild(e),t&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(t))}}};!function(n,e){void 0===e&&(e={});var t=e.insertAt;if(n&&"undefined"!=typeof document){var a=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css","top"===t&&a.firstChild?a.insertBefore(s,a.firstChild):a.appendChild(s),s.styleSheet?s.styleSheet.cssText=n:s.appendChild(document.createTextNode(n))}}("@media (max-width: 1000px) {\n  .vuepress-plugin-demo-block__h_code {\n    display: none;\n  }\n  .vuepress-plugin-demo-block__app {\n    margin-left: auto !important;\n    margin-right: auto !important;\n  }\n}\n.vuepress-plugin-demo-block__wrapper {\n  margin-top: 10px;\n  border: 1px solid #ebebeb;\n  border-radius: 4px;\n  transition: all 0.2s;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display {\n  height: 400px;\n  display: flex;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display .vuepress-plugin-demo-block__app {\n  width: 300px;\n  border: 1px solid #ebebeb;\n  box-shadow: 1px 1px 3px #ebebeb;\n  margin-right: 5px;\n  overflow: auto;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display .vuepress-plugin-demo-block__h_code {\n  flex: 1;\n  overflow: auto;\n  height: 100%;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display .vuepress-plugin-demo-block__h_code > pre {\n  overflow: visible;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__display {\n  max-height: 400px;\n  overflow: auto;\n}\n.vuepress-plugin-demo-block__wrapper div {\n  box-sizing: border-box;\n}\n.vuepress-plugin-demo-block__wrapper:hover {\n  box-shadow: 0 0 11px rgba(33, 33, 33, 0.2);\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__code {\n  overflow: hidden;\n  height: 0;\n  padding: 0 !important;\n  background-color: #282c34;\n  border-radius: 0 !important;\n  transition: height 0.5s;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__code pre {\n  margin: 0 !important;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__display {\n  padding: 20px;\n  border-bottom: 1px solid #ebebeb;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer {\n  position: relative;\n  text-align: center;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer.vuepress-plugin-demo-block__show-link .vuepress-plugin-demo-block__jsfiddle,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer.vuepress-plugin-demo-block__show-link .vuepress-plugin-demo-block__codepen {\n  opacity: 1;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer.vuepress-plugin-demo-block__show-link .vuepress-plugin-demo-block__expand::before {\n  border-top: none;\n  border-right: 6px solid transparent;\n  border-bottom: 6px solid #ccc;\n  border-left: 6px solid transparent;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__jsfiddle,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__codepen,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__expand span,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__expand {\n  opacity: 1;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__expand::before {\n  border-top-color: #3eaf7c !important;\n  border-bottom-color: #3eaf7c !important;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover svg {\n  fill: #3eaf7c !important;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__expand-text {\n  transition: all 0.5s;\n  opacity: 0;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer form:nth-last-child(2) {\n  right: 50px;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer form:last-child {\n  right: 10px;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button {\n  border-color: transparent;\n  background-color: transparent;\n  font-size: 14px;\n  color: #3eaf7c;\n  cursor: pointer;\n  outline: none;\n  margin: 0;\n  width: 46px;\n  position: relative;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button:hover::before {\n  content: attr(data-tip);\n  white-space: nowrap;\n  position: absolute;\n  top: -30px;\n  left: 50%;\n  color: #eee;\n  line-height: 1;\n  z-index: 1000;\n  border-radius: 4px;\n  padding: 6px;\n  -webkit-transform: translateX(-50%);\n          transform: translateX(-50%);\n  background-color: rgba(0, 0, 0, 0.8);\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button:hover::after {\n  content: '' !important;\n  display: block;\n  position: absolute;\n  left: 50%;\n  top: -5px;\n  -webkit-transform: translateX(-50%);\n          transform: translateX(-50%);\n  border: 5px solid transparent;\n  border-top-color: rgba(0, 0, 0, 0.8);\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button svg {\n  width: 34px;\n  height: 20px;\n  fill: #ccc;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__jsfiddle,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__codepen {\n  position: absolute;\n  top: 10px;\n  transition: all 0.5s;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__expand {\n  position: relative;\n  width: 100px;\n  height: 40px;\n  margin: 0;\n  color: #3eaf7c;\n  font-size: 14px;\n  background-color: transparent;\n  border-color: transparent;\n  outline: none;\n  transition: all 0.5s;\n  cursor: pointer;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__expand::before {\n  content: \"\";\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 0;\n  height: 0;\n  border-top: 6px solid #ccc;\n  border-right: 6px solid transparent;\n  border-left: 6px solid transparent;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n}\n");var ql={jsLib:[],cssLib:[],jsfiddle:!0,codepen:!0,codepenLayout:"left",codepenJsProcessor:"babel",codepenEditors:"101",horizontal:!1,vue:"https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js",react:"https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js",reactDOM:"https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"},Rl={},Al=function(n){return'<div id="app">\n'.concat(n,"\n</div>")},Bl=function(n){return window.$VUEPRESS_DEMO_BLOCK&&void 0!==window.$VUEPRESS_DEMO_BLOCK[n]?window.$VUEPRESS_DEMO_BLOCK[n]:ql[n]},Ll=function n(e,t,a){var s=document.createElement(e);return t&&Object.keys(t).forEach((function(n){if(n.indexOf("data"))s[n]=t[n];else{var e=n.replace("data","");s.dataset[e]=t[n]}})),a&&a.forEach((function(e){var t=e.tag,a=e.attrs,i=e.children;s.appendChild(n(t,a,i))})),s},zl=function(n,e,t){var a,s=(a=n.querySelectorAll(".".concat(e)),Array.prototype.slice.call(a));return 1!==s.length||t?s:s[0]},Dl=function(n,e){var t,a,s=n.match(/<style>([\s\S]+)<\/style>/),i=n.match(/<template>([\s\S]+)<\/template>/),r=n.match(/<script>([\s\S]+)<\/script>/),l={css:s&&s[1].replace(/^\n|\n$/g,""),html:i&&i[1].replace(/^\n|\n$/g,""),js:r&&r[1].replace(/^\n|\n$/g,""),jsLib:e.jsLib||[],cssLib:e.cssLib||[]};l.htmlTpl=Al(l.html),l.jsTpl=(t=l.js,a=t.replace(/export\s+default\s*?\{\n*/,"").replace(/\n*\}\s*$/,"").trim(),"new Vue({\n  el: '#app',\n  ".concat(a,"\n})")),l.script=function(n,e){var t=n.split(/export\s+default/),a="(function() {".concat(t[0]," ; return ").concat(t[1],"})()"),s=window.Babel?window.Babel.transform(a,{presets:["es2015"]}).code:a,i=[eval][0](s);return i.template=e,i}(l.js,l.html);var o=Bl("vue");return l.jsLib.unshift(o),l},Ml=function(n,e){var t,a=n.match(/<style>([\s\S]+)<\/style>/),s=n.match(/<html>([\s\S]+)<\/html>/),i=n.match(/<script>([\s\S]+)<\/script>/),r={css:a&&a[1].replace(/^\n|\n$/g,""),html:s&&s[1].replace(/^\n|\n$/g,""),js:i&&i[1].replace(/^\n|\n$/g,""),jsLib:e.jsLib||[],cssLib:e.cssLib||[]};return r.htmlTpl=r.html,r.jsTpl=r.js,r.script=(t=r.js,window.Babel?window.Babel.transform(t,{presets:["es2015"]}).code:t),r},Cl=function(n){return n=n.replace("export default ","").replace(/App\.__style__(\s*)=(\s*)`([\s\S]*)?`/,""),n+='ReactDOM.render(React.createElement(App), document.getElementById("app"))'};function Ol(){var n=zl(document,"vuepress-plugin-demo-block__wrapper",!0);n.length?n.forEach((function(n){if("true"!==n.dataset.created){n.style.display="block";var e=zl(n,"vuepress-plugin-demo-block__code"),t=zl(n,"vuepress-plugin-demo-block__display"),a=zl(n,"vuepress-plugin-demo-block__footer"),s=zl(t,"vuepress-plugin-demo-block__app"),i=decodeURIComponent(n.dataset.code),r=decodeURIComponent(n.dataset.config),l=decodeURIComponent(n.dataset.type);r=r?JSON.parse(r):{};var o=e.querySelector("div").clientHeight,c="react"===l?function(n,e){var t=(0,window.Babel.transform)(n,{presets:["es2015","react"]}).code,a="(function(exports){var module={};module.exports=exports;".concat(t,";return module.exports.__esModule?module.exports.default:module.exports;})({})"),s=new Function("return ".concat(a))(),i={js:s,css:s.__style__||"",jsLib:e.jsLib||[],cssLib:e.cssLib||[],jsTpl:Cl(n),htmlTpl:Al("")},r=Bl("react"),l=Bl("reactDOM");return i.jsLib.unshift(r,l),i}(i,r):"vanilla"===l?Ml(i,r):Dl(i,r),d=Ll("button",{className:"".concat("vuepress-plugin-demo-block__expand")});if(a.appendChild(d),d.addEventListener("click",Nl.bind(null,d,o,e,a)),Bl("jsfiddle")&&a.appendChild(function(n){var e=n.css,t=n.htmlTpl,a=n.jsTpl,s=n.jsLib,i=n.cssLib,r=s.concat(i).concat(Bl("cssLib")).concat(Bl("jsLib")).join(",");return Ll("form",{className:"vuepress-plugin-demo-block__jsfiddle",target:"_blank",action:"https://jsfiddle.net/api/post/library/pure/",method:"post"},[{tag:"input",attrs:{type:"hidden",name:"css",value:e}},{tag:"input",attrs:{type:"hidden",name:"html",value:t}},{tag:"input",attrs:{type:"hidden",name:"js",value:a}},{tag:"input",attrs:{type:"hidden",name:"panel_js",value:3}},{tag:"input",attrs:{type:"hidden",name:"wrap",value:1}},{tag:"input",attrs:{type:"hidden",name:"resources",value:r}},{tag:"button",attrs:{type:"submit",className:"vuepress-plugin-demo-block__button",innerHTML:'<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1547088289967" class="icon" style="" viewBox="0 0 1170 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1952" xmlns:xlink="http://www.w3.org/1999/xlink" width="228.515625" height="200"><defs><style type="text/css"></style></defs><path d="M1028.571429 441.142857q63.428571 26.285714 102.571428 83.142857T1170.285714 650.857143q0 93.714286-67.428571 160.285714T940 877.714286q-2.285714 0-6.571429-0.285715t-6-0.285714H232q-97.142857-5.714286-164.571429-71.714286T0 645.142857q0-62.857143 31.428571-116t84-84q-6.857143-22.285714-6.857142-46.857143 0-65.714286 46.857142-112t113.714286-46.285714q54.285714 0 98.285714 33.142857 42.857143-88 127.142858-141.714286t186.571428-53.714285q94.857143 0 174.857143 46T982.571429 248.571429t46.571428 172q0 3.428571-0.285714 10.285714t-0.285714 10.285714zM267.428571 593.142857q0 69.714286 48 110.285714t118.857143 40.571429q78.285714 0 137.142857-56.571429-9.142857-11.428571-27.142857-32.285714T519.428571 626.285714q-38.285714 37.142857-82.285714 37.142857-31.428571 0-53.428571-19.142857T361.714286 594.285714q0-30.285714 22-49.714285t52.285714-19.428572q25.142857 0 48.285714 12t41.714286 31.428572 37.142857 42.857142 39.428572 46.857143 44 42.857143 55.428571 31.428572 69.428571 12q69.142857 0 116.857143-40.857143T936 594.857143q0-69.142857-48-109.714286t-118.285714-40.571428q-81.714286 0-137.714286 55.428571l53.142857 61.714286q37.714286-36.571429 81.142857-36.571429 29.714286 0 52.571429 18.857143t22.857143 48q0 32.571429-21.142857 52.285714t-53.714286 19.714286q-24.571429 0-47.142857-12t-41.142857-31.428571-37.428572-42.857143-39.714286-46.857143-44.285714-42.857143-55.142857-31.428571T434.285714 444.571429q-69.714286 0-118.285714 40.285714T267.428571 593.142857z" p-id="1953"></path></svg>',datatip:"JSFiddle"}}])}(c)),Bl("codepen")&&a.appendChild(function(n){var e=n.css,t=n.htmlTpl,a=n.jsTpl,s=n.jsLib,i=n.cssLib,r=JSON.stringify({css:e,html:t,js:a,js_external:s.concat(Bl("jsLib")).join(";"),css_external:i.concat(Bl("cssLib")).join(";"),layout:Bl("codepenLayout"),js_pre_processor:Bl("codepenJsProcessor"),editors:Bl("codepenEditors")});return Ll("form",{className:"vuepress-plugin-demo-block__codepen",target:"_blank",action:"https://codepen.io/pen/define",method:"post"},[{tag:"input",attrs:{type:"hidden",name:"data",value:r}},{tag:"button",attrs:{type:"submit",innerHTML:'<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1547088271207" class="icon" style="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1737" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style type="text/css"></style></defs><path d="M123.428571 668l344.571429 229.714286v-205.142857L277.142857 565.142857z m-35.428571-82.285714l110.285714-73.714286-110.285714-73.714286v147.428572z m468 312l344.571429-229.714286-153.714286-102.857143-190.857143 127.428572v205.142857z m-44-281.714286l155.428571-104-155.428571-104-155.428571 104zM277.142857 458.857143l190.857143-127.428572V126.285714L123.428571 356z m548.571429 53.142857l110.285714 73.714286V438.285714z m-78.857143-53.142857l153.714286-102.857143-344.571429-229.714286v205.142857z m277.142857-102.857143v312q0 23.428571-19.428571 36.571429l-468 312q-12 7.428571-24.571429 7.428571t-24.571429-7.428571L19.428571 704.571429q-19.428571-13.142857-19.428571-36.571429V356q0-23.428571 19.428571-36.571429L487.428571 7.428571q12-7.428571 24.571429-7.428571t24.571429 7.428571l468 312q19.428571 13.142857 19.428571 36.571429z" p-id="1738"></path></svg>',className:"vuepress-plugin-demo-block__button",datatip:"Codepen"}}])}(c)),void 0!==r.horizontal?r.horizontal:Bl("horizontal")){n.classList.add("vuepress-plugin-demo-block__horizontal");var u=e.firstChild.cloneNode(!0);u.classList.add("vuepress-plugin-demo-block__h_code"),t.appendChild(u)}if(c.css&&function(n){if(!Rl[n]){var e=Ll("style",{innerHTML:n});document.body.appendChild(e),Rl[n]=!0}}(c.css),"react"===l)ReactDOM.render(React.createElement(c.js),s);else if("vue"===l){var m=(new(Vue.extend(c.script))).$mount();s.appendChild(m.$el)}else"vanilla"===l&&(s.innerHTML=c.html,new Function("return (function(){".concat(c.script,"})()"))());n.dataset.created="true"}})):setTimeout((function(n){Ol()}),300)}function Nl(n,e,t,a){var s="1"!==n.dataset.isExpand;t.style.height=s?"".concat(e,"px"):0,s?a.classList.add("vuepress-plugin-demo-block__show-link"):a.classList.remove("vuepress-plugin-demo-block__show-link"),n.dataset.isExpand=s?"1":"0"}var Pl={mounted:function(){window.$VUEPRESS_DEMO_BLOCK={jsfiddle:!1,codepen:!0,horizontal:!1},Ol()},updated:function(){Ol()}},jl="auto",Fl="zoom-in",Hl="zoom-out",Ul="grab",$l="move";function Ql(n,e,t){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s={passive:!1};a?n.addEventListener(e,t,s):n.removeEventListener(e,t,s)}function Gl(n,e){if(n){var t=new Image;t.onload=function(){e&&e(t)},t.src=n}}function Kl(n){return n.dataset.original?n.dataset.original:"A"===n.parentNode.tagName?n.parentNode.getAttribute("href"):null}function Vl(n,e,t){!function(n){var e=Wl,t=Jl;if(n.transition){var a=n.transition;delete n.transition,n[e]=a}if(n.transform){var s=n.transform;delete n.transform,n[t]=s}}(e);var a=n.style,s={};for(var i in e)t&&(s[i]=a[i]||""),a[i]=e[i];return s}var Wl="transition",Jl="transform",Xl="transform",Yl="transitionend";var Zl=function(){},no={enableGrab:!0,preloadImage:!1,closeOnWindowResize:!0,transitionDuration:.4,transitionTimingFunction:"cubic-bezier(0.4, 0, 0, 1)",bgColor:"rgb(255, 255, 255)",bgOpacity:1,scaleBase:1,scaleExtra:.5,scrollThreshold:40,zIndex:998,customSize:null,onOpen:Zl,onClose:Zl,onGrab:Zl,onMove:Zl,onRelease:Zl,onBeforeOpen:Zl,onBeforeClose:Zl,onBeforeGrab:Zl,onBeforeRelease:Zl,onImageLoading:Zl,onImageLoaded:Zl},eo={init:function(n){var e,t;e=this,t=n,Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach((function(n){e[n]=e[n].bind(t)}))},click:function(n){if(n.preventDefault(),ao(n))return window.open(this.target.srcOriginal||n.currentTarget.src,"_blank");this.shown?this.released?this.close():this.release():this.open(n.currentTarget)},scroll:function(){var n=document.documentElement||document.body.parentNode||document.body,e=window.pageXOffset||n.scrollLeft,t=window.pageYOffset||n.scrollTop;null===this.lastScrollPosition&&(this.lastScrollPosition={x:e,y:t});var a=this.lastScrollPosition.x-e,s=this.lastScrollPosition.y-t,i=this.options.scrollThreshold;(Math.abs(s)>=i||Math.abs(a)>=i)&&(this.lastScrollPosition=null,this.close())},keydown:function(n){(function(n){return"Escape"===(n.key||n.code)||27===n.keyCode})(n)&&(this.released?this.close():this.release(this.close))},mousedown:function(n){if(to(n)&&!ao(n)){n.preventDefault();var e=n.clientX,t=n.clientY;this.pressTimer=setTimeout(function(){this.grab(e,t)}.bind(this),200)}},mousemove:function(n){this.released||this.move(n.clientX,n.clientY)},mouseup:function(n){to(n)&&!ao(n)&&(clearTimeout(this.pressTimer),this.released?this.close():this.release())},touchstart:function(n){n.preventDefault();var e=n.touches[0],t=e.clientX,a=e.clientY;this.pressTimer=setTimeout(function(){this.grab(t,a)}.bind(this),200)},touchmove:function(n){if(!this.released){var e=n.touches[0],t=e.clientX,a=e.clientY;this.move(t,a)}},touchend:function(n){(function(n){n.targetTouches.length})(n)||(clearTimeout(this.pressTimer),this.released?this.close():this.release())},clickOverlay:function(){this.close()},resizeWindow:function(){this.close()}};function to(n){return 0===n.button}function ao(n){return n.metaKey||n.ctrlKey}var so={init:function(n){this.el=document.createElement("div"),this.instance=n,this.parent=document.body,Vl(this.el,{position:"fixed",top:0,left:0,right:0,bottom:0,opacity:0}),this.updateStyle(n.options),Ql(this.el,"click",n.handler.clickOverlay.bind(n))},updateStyle:function(n){Vl(this.el,{zIndex:n.zIndex,backgroundColor:n.bgColor,transition:"opacity\n        "+n.transitionDuration+"s\n        "+n.transitionTimingFunction})},insert:function(){this.parent.appendChild(this.el)},remove:function(){this.parent.removeChild(this.el)},fadeIn:function(){this.el.offsetWidth,this.el.style.opacity=this.instance.options.bgOpacity},fadeOut:function(){this.el.style.opacity=0}},io="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ro=function(){function n(n,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}}return function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}}(),lo=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(n[a]=t[a])}return n},oo={init:function(n,e){this.el=n,this.instance=e,this.srcThumbnail=this.el.getAttribute("src"),this.srcset=this.el.getAttribute("srcset"),this.srcOriginal=Kl(this.el),this.rect=this.el.getBoundingClientRect(),this.translate=null,this.scale=null,this.styleOpen=null,this.styleClose=null},zoomIn:function(){var n=this.instance.options,e=n.zIndex,t=n.enableGrab,a=n.transitionDuration,s=n.transitionTimingFunction;this.translate=this.calculateTranslate(),this.scale=this.calculateScale(),this.styleOpen={position:"relative",zIndex:e+1,cursor:t?Ul:Hl,transition:Xl+"\n        "+a+"s\n        "+s,transform:"translate3d("+this.translate.x+"px, "+this.translate.y+"px, 0px)\n        scale("+this.scale.x+","+this.scale.y+")",height:this.rect.height+"px",width:this.rect.width+"px"},this.el.offsetWidth,this.styleClose=Vl(this.el,this.styleOpen,!0)},zoomOut:function(){this.el.offsetWidth,Vl(this.el,{transform:"none"})},grab:function(n,e,t){var a=co(),s=a.x-n,i=a.y-e;Vl(this.el,{cursor:$l,transform:"translate3d(\n        "+(this.translate.x+s)+"px, "+(this.translate.y+i)+"px, 0px)\n        scale("+(this.scale.x+t)+","+(this.scale.y+t)+")"})},move:function(n,e,t){var a=co(),s=a.x-n,i=a.y-e;Vl(this.el,{transition:Xl,transform:"translate3d(\n        "+(this.translate.x+s)+"px, "+(this.translate.y+i)+"px, 0px)\n        scale("+(this.scale.x+t)+","+(this.scale.y+t)+")"})},restoreCloseStyle:function(){Vl(this.el,this.styleClose)},restoreOpenStyle:function(){Vl(this.el,this.styleOpen)},upgradeSource:function(){if(this.srcOriginal){var n=this.el.parentNode;this.srcset&&this.el.removeAttribute("srcset");var e=this.el.cloneNode(!1);e.setAttribute("src",this.srcOriginal),e.style.position="fixed",e.style.visibility="hidden",n.appendChild(e),setTimeout(function(){this.el.setAttribute("src",this.srcOriginal),n.removeChild(e)}.bind(this),50)}},downgradeSource:function(){this.srcOriginal&&(this.srcset&&this.el.setAttribute("srcset",this.srcset),this.el.setAttribute("src",this.srcThumbnail))},calculateTranslate:function(){var n=co(),e=this.rect.left+this.rect.width/2,t=this.rect.top+this.rect.height/2;return{x:n.x-e,y:n.y-t}},calculateScale:function(){var n=this.el.dataset,e=n.zoomingHeight,t=n.zoomingWidth,a=this.instance.options,s=a.customSize,i=a.scaleBase;if(!s&&e&&t)return{x:t/this.rect.width,y:e/this.rect.height};if(s&&"object"===(void 0===s?"undefined":io(s)))return{x:s.width/this.rect.width,y:s.height/this.rect.height};var r=this.rect.width/2,l=this.rect.height/2,o=co(),c={x:o.x-r,y:o.y-l},d=c.x/r,u=c.y/l,m=i+Math.min(d,u);if(s&&"string"==typeof s){var p=t||this.el.naturalWidth,h=e||this.el.naturalHeight,g=parseFloat(s)*p/(100*this.rect.width),f=parseFloat(s)*h/(100*this.rect.height);if(m>g||m>f)return{x:g,y:f}}return{x:m,y:m}}};function co(){var n=document.documentElement;return{x:Math.min(n.clientWidth,window.innerWidth)/2,y:Math.min(n.clientHeight,window.innerHeight)/2}}function uo(n,e,t){["mousedown","mousemove","mouseup","touchstart","touchmove","touchend"].forEach((function(a){Ql(n,a,e[a],t)}))}var mo=function(){function n(e){!function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.target=Object.create(oo),this.overlay=Object.create(so),this.handler=Object.create(eo),this.body=document.body,this.shown=!1,this.lock=!1,this.released=!0,this.lastScrollPosition=null,this.pressTimer=null,this.options=lo({},no,e),this.overlay.init(this),this.handler.init(this)}return ro(n,[{key:"listen",value:function(n){if("string"==typeof n)for(var e=document.querySelectorAll(n),t=e.length;t--;)this.listen(e[t]);else"IMG"===n.tagName&&(n.style.cursor=Fl,Ql(n,"click",this.handler.click),this.options.preloadImage&&Gl(Kl(n)));return this}},{key:"config",value:function(n){return n?(lo(this.options,n),this.overlay.updateStyle(this.options),this):this.options}},{key:"open",value:function(n){var e=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options.onOpen;if(!this.shown&&!this.lock){var a="string"==typeof n?document.querySelector(n):n;if("IMG"===a.tagName){if(this.options.onBeforeOpen(a),this.target.init(a,this),!this.options.preloadImage){var s=this.target.srcOriginal;null!=s&&(this.options.onImageLoading(a),Gl(s,this.options.onImageLoaded))}this.shown=!0,this.lock=!0,this.target.zoomIn(),this.overlay.insert(),this.overlay.fadeIn(),Ql(document,"scroll",this.handler.scroll),Ql(document,"keydown",this.handler.keydown),this.options.closeOnWindowResize&&Ql(window,"resize",this.handler.resizeWindow);var i=function n(){Ql(a,Yl,n,!1),e.lock=!1,e.target.upgradeSource(),e.options.enableGrab&&uo(document,e.handler,!0),t(a)};return Ql(a,Yl,i),this}}}},{key:"close",value:function(){var n=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.onClose;if(this.shown&&!this.lock){var t=this.target.el;this.options.onBeforeClose(t),this.lock=!0,this.body.style.cursor=jl,this.overlay.fadeOut(),this.target.zoomOut(),Ql(document,"scroll",this.handler.scroll,!1),Ql(document,"keydown",this.handler.keydown,!1),this.options.closeOnWindowResize&&Ql(window,"resize",this.handler.resizeWindow,!1);var a=function a(){Ql(t,Yl,a,!1),n.shown=!1,n.lock=!1,n.target.downgradeSource(),n.options.enableGrab&&uo(document,n.handler,!1),n.target.restoreCloseStyle(),n.overlay.remove(),e(t)};return Ql(t,Yl,a),this}}},{key:"grab",value:function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.scaleExtra,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.options.onGrab;if(this.shown&&!this.lock){var s=this.target.el;this.options.onBeforeGrab(s),this.released=!1,this.target.grab(n,e,t);var i=function n(){Ql(s,Yl,n,!1),a(s)};return Ql(s,Yl,i),this}}},{key:"move",value:function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.scaleExtra,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.options.onMove;if(this.shown&&!this.lock){this.released=!1,this.body.style.cursor=$l,this.target.move(n,e,t);var s=this.target.el,i=function n(){Ql(s,Yl,n,!1),a(s)};return Ql(s,Yl,i),this}}},{key:"release",value:function(){var n=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.onRelease;if(this.shown&&!this.lock){var t=this.target.el;this.options.onBeforeRelease(t),this.lock=!0,this.body.style.cursor=jl,this.target.restoreOpenStyle();var a=function a(){Ql(t,Yl,a,!1),n.lock=!1,n.released=!0,e(t)};return Ql(t,Yl,a),this}}}]),n}();const po=JSON.parse('{"bgColor":"rgba(0,0,0,0.6)"}'),ho=Number("500");class go{constructor(){this.instance=new mo(po)}update(n=".theme-vdoing-content img:not(.no-zoom)"){"undefined"!=typeof window&&this.instance.listen(n)}updateDelay(n=".theme-vdoing-content img:not(.no-zoom)",e=ho){setTimeout(()=>this.update(n),e)}}var fo=[fl,xl,kl,Sl,Pl,{watch:{"$page.path"(){void 0!==this.$vuepress.zooming&&this.$vuepress.zooming.updateDelay()}},mounted(){this.$vuepress.zooming=new go,this.$vuepress.zooming.updateDelay()}}],bo={name:"GlobalLayout",computed:{layout(){const n=this.getLayout();return ul("layout",n),Kt.component(n)}},methods:{getLayout(){if(this.$page.path){const n=this.$page.frontmatter.layout;return n&&(this.$vuepress.getLayoutAsyncComponent(n)||this.$vuepress.getVueComponent(n))?n:"Layout"}return"NotFound"}}},yo=t(4),vo=Object(yo.a)(bo,(function(){return(0,this._self._c)(this.layout,{tag:"component"})}),[],!1,null,null,null).exports;!function(n,e,t){switch(e){case"components":n[e]||(n[e]={}),Object.assign(n[e],t);break;case"mixins":n[e]||(n[e]=[]),n[e].push(...t);break;default:throw new Error("Unknown option name.")}}(vo,"mixins",fo);const _o=[{name:"v-01aea2f9",path:"/pages/0e1012/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-01aea2f9").then(t)}},{path:"/pages/0e1012/index.html",redirect:"/pages/0e1012/"},{path:"/12.æ°æ®åº/01.æ°æ®åºç»¼å/01.Nosqlææ¯éå.html",redirect:"/pages/0e1012/"},{name:"v-2f525dc4",path:"/pages/d7cd88/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-2f525dc4").then(t)}},{path:"/pages/d7cd88/index.html",redirect:"/pages/d7cd88/"},{path:"/12.æ°æ®åº/01.æ°æ®åºç»¼å/02.æ°æ®ç»æä¸æ°æ®åºç´¢å¼.html",redirect:"/pages/d7cd88/"},{name:"v-909a48e0",path:"/pages/5ed2a2/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-909a48e0").then(t)}},{path:"/pages/5ed2a2/index.html",redirect:"/pages/5ed2a2/"},{path:"/12.æ°æ®åº/02.æ°æ®åºä¸­é´ä»¶/01.Shardingsphere/01.ShardingSphereç®ä».html",redirect:"/pages/5ed2a2/"},{name:"v-e3ca250c",path:"/pages/8448de/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-e3ca250c").then(t)}},{path:"/pages/8448de/index.html",redirect:"/pages/8448de/"},{path:"/12.æ°æ®åº/02.æ°æ®åºä¸­é´ä»¶/01.Shardingsphere/02.ShardingSphereJdbc.html",redirect:"/pages/8448de/"},{name:"v-4c53fba0",path:"/pages/3c3c45/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-4c53fba0").then(t)}},{path:"/pages/3c3c45/index.html",redirect:"/pages/3c3c45/"},{path:"/12.æ°æ®åº/01.æ°æ®åºç»¼å/",redirect:"/pages/3c3c45/"},{name:"v-1a0fef38",path:"/pages/e2648c/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-1a0fef38").then(t)}},{path:"/pages/e2648c/index.html",redirect:"/pages/e2648c/"},{path:"/12.æ°æ®åº/02.æ°æ®åºä¸­é´ä»¶/02.Flyway.html",redirect:"/pages/e2648c/"},{name:"v-208168d6",path:"/pages/addb05/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-208168d6").then(t)}},{path:"/pages/addb05/index.html",redirect:"/pages/addb05/"},{path:"/12.æ°æ®åº/02.æ°æ®åºä¸­é´ä»¶/",redirect:"/pages/addb05/"},{name:"v-0fc408a8",path:"/pages/b71c9e/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-0fc408a8").then(t)}},{path:"/pages/b71c9e/index.html",redirect:"/pages/b71c9e/"},{path:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/01.ç»¼å/02.SQLè¯­æ³åºç¡ç¹æ§.html",redirect:"/pages/b71c9e/"},{name:"v-099fc77f",path:"/pages/9bb28f/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-099fc77f").then(t)}},{path:"/pages/9bb28f/index.html",redirect:"/pages/9bb28f/"},{path:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/01.ç»¼å/01.å³ç³»åæ°æ®åºé¢è¯.html",redirect:"/pages/9bb28f/"},{name:"v-cf9e4d54",path:"/pages/1ae1ca/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-cf9e4d54").then(t)}},{path:"/pages/1ae1ca/index.html",redirect:"/pages/1ae1ca/"},{path:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/01.ç»¼å/03.SQLè¯­æ³é«çº§ç¹æ§.html",redirect:"/pages/1ae1ca/"},{name:"v-49d5bdfa",path:"/pages/55e9a7/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-49d5bdfa").then(t)}},{path:"/pages/55e9a7/index.html",redirect:"/pages/55e9a7/"},{path:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/01.ç»¼å/03.æ©å±SQL.html",redirect:"/pages/55e9a7/"},{name:"v-0752b95e",path:"/pages/22f2e3/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-0752b95e").then(t)}},{path:"/pages/22f2e3/index.html",redirect:"/pages/22f2e3/"},{path:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/01.ç»¼å/",redirect:"/pages/22f2e3/"},{name:"v-3b295fba",path:"/pages/e438a7/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-3b295fba").then(t)}},{path:"/pages/e438a7/index.html",redirect:"/pages/e438a7/"},{path:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/01.ç»¼å/99.SqlCheatSheet.html",redirect:"/pages/e438a7/"},{name:"v-b19bf61e",path:"/pages/5fe0f3/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-b19bf61e").then(t)}},{path:"/pages/5fe0f3/index.html",redirect:"/pages/5fe0f3/"},{path:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/02.Mysql/01.Mysqlåºç¨æå.html",redirect:"/pages/5fe0f3/"},{name:"v-e2f7f754",path:"/pages/8262aa/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-e2f7f754").then(t)}},{path:"/pages/8262aa/index.html",redirect:"/pages/8262aa/"},{path:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/02.Mysql/02.MySQLå·¥ä½æµ.html",redirect:"/pages/8262aa/"},{name:"v-41343aac",path:"/pages/f1f151/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-41343aac").then(t)}},{path:"/pages/f1f151/index.html",redirect:"/pages/f1f151/"},{path:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/02.Mysql/04.Mysqlé.html",redirect:"/pages/f1f151/"},{name:"v-413ab35d",path:"/pages/00b04d/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-413ab35d").then(t)}},{path:"/pages/00b04d/index.html",redirect:"/pages/00b04d/"},{path:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/02.Mysql/03.Mysqläºå¡.html",redirect:"/pages/00b04d/"},{name:"v-54c62a9f",path:"/pages/fcb19c/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-54c62a9f").then(t)}},{path:"/pages/fcb19c/index.html",redirect:"/pages/fcb19c/"},{path:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/02.Mysql/05.Mysqlç´¢å¼.html",redirect:"/pages/fcb19c/"},{name:"v-6d5ab7d6",path:"/pages/396816/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-6d5ab7d6").then(t)}},{path:"/pages/396816/index.html",redirect:"/pages/396816/"},{path:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/02.Mysql/06.Mysqlæ§è½ä¼å.html",redirect:"/pages/396816/"},{name:"v-4ef63c90",path:"/pages/e33b92/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-4ef63c90").then(t)}},{path:"/pages/e33b92/index.html",redirect:"/pages/e33b92/"},{path:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/02.Mysql/20.Mysqlè¿ç»´.html",redirect:"/pages/e33b92/"},{name:"v-4954d596",path:"/pages/7b0caf/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-4954d596").then(t)}},{path:"/pages/7b0caf/index.html",redirect:"/pages/7b0caf/"},{path:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/02.Mysql/99.Mysqlå¸¸è§é®é¢.html",redirect:"/pages/7b0caf/"},{name:"v-076936e6",path:"/pages/5da42d/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-076936e6").then(t)}},{path:"/pages/5da42d/index.html",redirect:"/pages/5da42d/"},{path:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/02.Mysql/21.Mysqléç½®.html",redirect:"/pages/5da42d/"},{name:"v-74c83129",path:"/pages/a5b63b/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-74c83129").then(t)}},{path:"/pages/a5b63b/index.html",redirect:"/pages/a5b63b/"},{path:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/02.Mysql/",redirect:"/pages/a5b63b/"},{name:"v-5a900e2a",path:"/pages/52609d/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-5a900e2a").then(t)}},{path:"/pages/52609d/index.html",redirect:"/pages/52609d/"},{path:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/99.å¶ä»/01.PostgreSQL.html",redirect:"/pages/52609d/"},{name:"v-7b0ce341",path:"/pages/f27c0c/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-7b0ce341").then(t)}},{path:"/pages/f27c0c/index.html",redirect:"/pages/f27c0c/"},{path:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/99.å¶ä»/02.H2.html",redirect:"/pages/f27c0c/"},{name:"v-28fda0bf",path:"/pages/bdcd7e/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-28fda0bf").then(t)}},{path:"/pages/bdcd7e/index.html",redirect:"/pages/bdcd7e/"},{path:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/99.å¶ä»/03.Sqlite.html",redirect:"/pages/bdcd7e/"},{name:"v-62392692",path:"/pages/3288f3/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-62392692").then(t)}},{path:"/pages/3288f3/index.html",redirect:"/pages/3288f3/"},{path:"/12.æ°æ®åº/04.ææ¡£æ°æ®åº/01.MongoDB/01.MongoDBåºç¨æå.html",redirect:"/pages/3288f3/"},{name:"v-44b09ccb",path:"/pages/bb43eb/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-44b09ccb").then(t)}},{path:"/pages/bb43eb/index.html",redirect:"/pages/bb43eb/"},{path:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/",redirect:"/pages/bb43eb/"},{name:"v-19684eb4",path:"/pages/ca9888/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-19684eb4").then(t)}},{path:"/pages/ca9888/index.html",redirect:"/pages/ca9888/"},{path:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/99.å¶ä»/",redirect:"/pages/ca9888/"},{name:"v-0f37026c",path:"/pages/75daa5/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-0f37026c").then(t)}},{path:"/pages/75daa5/index.html",redirect:"/pages/75daa5/"},{path:"/12.æ°æ®åº/04.ææ¡£æ°æ®åº/01.MongoDB/03.MongoDBçèåæä½.html",redirect:"/pages/75daa5/"},{name:"v-62ac19f1",path:"/pages/7efbac/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-62ac19f1").then(t)}},{path:"/pages/7efbac/index.html",redirect:"/pages/7efbac/"},{path:"/12.æ°æ®åº/04.ææ¡£æ°æ®åº/01.MongoDB/02.MongoDBçCRUDæä½.html",redirect:"/pages/7efbac/"},{name:"v-f8f28ef4",path:"/pages/4574fe/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-f8f28ef4").then(t)}},{path:"/pages/4574fe/index.html",redirect:"/pages/4574fe/"},{path:"/12.æ°æ®åº/04.ææ¡£æ°æ®åº/01.MongoDB/04.MongoDBäºå¡.html",redirect:"/pages/4574fe/"},{name:"v-925d1ece",path:"/pages/562f99/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-925d1ece").then(t)}},{path:"/pages/562f99/index.html",redirect:"/pages/562f99/"},{path:"/12.æ°æ®åº/04.ææ¡£æ°æ®åº/01.MongoDB/05.MongoDBå»ºæ¨¡.html",redirect:"/pages/562f99/"},{name:"v-2d5a6152",path:"/pages/88c7d3/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-2d5a6152").then(t)}},{path:"/pages/88c7d3/index.html",redirect:"/pages/88c7d3/"},{path:"/12.æ°æ®åº/04.ææ¡£æ°æ®åº/01.MongoDB/06.MongoDBå»ºæ¨¡ç¤ºä¾.html",redirect:"/pages/88c7d3/"},{name:"v-2310a086",path:"/pages/10c674/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-2310a086").then(t)}},{path:"/pages/10c674/index.html",redirect:"/pages/10c674/"},{path:"/12.æ°æ®åº/04.ææ¡£æ°æ®åº/01.MongoDB/07.MongoDBç´¢å¼.html",redirect:"/pages/10c674/"},{name:"v-0b02d45b",path:"/pages/505407/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-0b02d45b").then(t)}},{path:"/pages/505407/index.html",redirect:"/pages/505407/"},{path:"/12.æ°æ®åº/04.ææ¡£æ°æ®åº/01.MongoDB/08.MongoDBå¤å¶.html",redirect:"/pages/505407/"},{name:"v-1211efa8",path:"/pages/ad08f5/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-1211efa8").then(t)}},{path:"/pages/ad08f5/index.html",redirect:"/pages/ad08f5/"},{path:"/12.æ°æ®åº/04.ææ¡£æ°æ®åº/01.MongoDB/09.MongoDBåç.html",redirect:"/pages/ad08f5/"},{name:"v-74c8571a",path:"/pages/5e3c30/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-74c8571a").then(t)}},{path:"/pages/5e3c30/index.html",redirect:"/pages/5e3c30/"},{path:"/12.æ°æ®åº/04.ææ¡£æ°æ®åº/01.MongoDB/20.MongoDBè¿ç»´.html",redirect:"/pages/5e3c30/"},{name:"v-d98adcc4",path:"/pages/b1a116/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-d98adcc4").then(t)}},{path:"/pages/b1a116/index.html",redirect:"/pages/b1a116/"},{path:"/12.æ°æ®åº/04.ææ¡£æ°æ®åº/01.MongoDB/",redirect:"/pages/b1a116/"},{name:"v-cd3bd61e",path:"/pages/451b73/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-cd3bd61e").then(t)}},{path:"/pages/451b73/index.html",redirect:"/pages/451b73/"},{path:"/12.æ°æ®åº/05.KVæ°æ®åº/01.Redis/01.Redisé¢è¯æ»ç».html",redirect:"/pages/451b73/"},{name:"v-2a8b7fae",path:"/pages/94e9d6/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-2a8b7fae").then(t)}},{path:"/pages/94e9d6/index.html",redirect:"/pages/94e9d6/"},{path:"/12.æ°æ®åº/05.KVæ°æ®åº/01.Redis/02.Redisåºç¨æå.html",redirect:"/pages/94e9d6/"},{name:"v-a0623b42",path:"/pages/ed757c/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-a0623b42").then(t)}},{path:"/pages/ed757c/index.html",redirect:"/pages/ed757c/"},{path:"/12.æ°æ®åº/05.KVæ°æ®åº/01.Redis/03.Redisæ°æ®ç±»åååºç¨.html",redirect:"/pages/ed757c/"},{name:"v-80c82fb0",path:"/pages/4de901/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-80c82fb0").then(t)}},{path:"/pages/4de901/index.html",redirect:"/pages/4de901/"},{path:"/12.æ°æ®åº/05.KVæ°æ®åº/01.Redis/04.Redisæä¹å.html",redirect:"/pages/4de901/"},{name:"v-26fbb292",path:"/pages/379cd8/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-26fbb292").then(t)}},{path:"/pages/379cd8/index.html",redirect:"/pages/379cd8/"},{path:"/12.æ°æ®åº/05.KVæ°æ®åº/01.Redis/05.Rediså¤å¶.html",redirect:"/pages/379cd8/"},{name:"v-18f5009d",path:"/pages/615afe/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-18f5009d").then(t)}},{path:"/pages/615afe/index.html",redirect:"/pages/615afe/"},{path:"/12.æ°æ®åº/05.KVæ°æ®åº/01.Redis/06.Rediså¨åµ.html",redirect:"/pages/615afe/"},{name:"v-2ccee58b",path:"/pages/1fc9c4/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-2ccee58b").then(t)}},{path:"/pages/1fc9c4/index.html",redirect:"/pages/1fc9c4/"},{path:"/12.æ°æ®åº/05.KVæ°æ®åº/01.Redis/08.Rediså®æ.html",redirect:"/pages/1fc9c4/"},{name:"v-671a08c2",path:"/pages/fe3808/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-671a08c2").then(t)}},{path:"/pages/fe3808/index.html",redirect:"/pages/fe3808/"},{path:"/12.æ°æ®åº/05.KVæ°æ®åº/01.Redis/",redirect:"/pages/fe3808/"},{name:"v-5ed748af",path:"/pages/537098/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-5ed748af").then(t)}},{path:"/pages/537098/index.html",redirect:"/pages/537098/"},{path:"/12.æ°æ®åº/05.KVæ°æ®åº/01.Redis/20.Redisè¿ç»´.html",redirect:"/pages/537098/"},{name:"v-5b5c3224",path:"/pages/77dfbe/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-5b5c3224").then(t)}},{path:"/pages/77dfbe/index.html",redirect:"/pages/77dfbe/"},{path:"/12.æ°æ®åº/05.KVæ°æ®åº/01.Redis/07.Rediséç¾¤.html",redirect:"/pages/77dfbe/"},{name:"v-3aca0c7e",path:"/pages/c8cfeb/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-3aca0c7e").then(t)}},{path:"/pages/c8cfeb/index.html",redirect:"/pages/c8cfeb/"},{path:"/12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/02.HBaseæ°æ®æ¨¡å.html",redirect:"/pages/c8cfeb/"},{name:"v-d46acfd6",path:"/pages/7ab03c/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-d46acfd6").then(t)}},{path:"/pages/7ab03c/index.html",redirect:"/pages/7ab03c/"},{path:"/12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/01.HBaseå¿«éå¥é¨.html",redirect:"/pages/7ab03c/"},{name:"v-644c6036",path:"/pages/a69528/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-644c6036").then(t)}},{path:"/pages/a69528/index.html",redirect:"/pages/a69528/"},{path:"/12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/03.HBaseSchemaè®¾è®¡.html",redirect:"/pages/a69528/"},{name:"v-53db1c34",path:"/pages/62f8d9/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-53db1c34").then(t)}},{path:"/pages/62f8d9/index.html",redirect:"/pages/62f8d9/"},{path:"/12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/04.HBaseæ¶æ.html",redirect:"/pages/62f8d9/"},{name:"v-5bd38cef",path:"/pages/a8cad3/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-5bd38cef").then(t)}},{path:"/pages/a8cad3/index.html",redirect:"/pages/a8cad3/"},{path:"/12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/10.HBaseJavaApiåºç¡ç¹æ§.html",redirect:"/pages/a8cad3/"},{name:"v-458ab807",path:"/pages/5f1bc3/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-458ab807").then(t)}},{path:"/pages/5f1bc3/index.html",redirect:"/pages/5f1bc3/"},{path:"/12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/12.HBaseJavaApié«çº§ç¹æ§ä¹åå¤çå¨.html",redirect:"/pages/5f1bc3/"},{name:"v-8b6e004c",path:"/pages/a3347e/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-8b6e004c").then(t)}},{path:"/pages/a3347e/index.html",redirect:"/pages/a3347e/"},{path:"/12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/11.HBaseJavaApié«çº§ç¹æ§ä¹è¿æ»¤å¨.html",redirect:"/pages/a3347e/"},{name:"v-2bc9cd70",path:"/pages/ce5ca0/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-2bc9cd70").then(t)}},{path:"/pages/ce5ca0/index.html",redirect:"/pages/ce5ca0/"},{path:"/12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/13.HBaseJavaApiå¶ä»é«çº§ç¹æ§.html",redirect:"/pages/ce5ca0/"},{name:"v-a7ca3eb4",path:"/pages/b59ba2/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-a7ca3eb4").then(t)}},{path:"/pages/b59ba2/index.html",redirect:"/pages/b59ba2/"},{path:"/12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/14.HBaseJavaApiç®¡çåè½.html",redirect:"/pages/b59ba2/"},{name:"v-735c9d66",path:"/pages/f808fc/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-735c9d66").then(t)}},{path:"/pages/f808fc/index.html",redirect:"/pages/f808fc/"},{path:"/12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/21.HBaseè¿ç»´.html",redirect:"/pages/f808fc/"},{name:"v-6479bc9f",path:"/pages/263c40/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-6479bc9f").then(t)}},{path:"/pages/263c40/index.html",redirect:"/pages/263c40/"},{path:"/12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/22.HBaseå½ä»¤.html",redirect:"/pages/263c40/"},{name:"v-2cf1626a",path:"/pages/417be6/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-2cf1626a").then(t)}},{path:"/pages/417be6/index.html",redirect:"/pages/417be6/"},{path:"/12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/",redirect:"/pages/417be6/"},{name:"v-1c459100",path:"/pages/ca3ca5/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-1c459100").then(t)}},{path:"/pages/ca3ca5/index.html",redirect:"/pages/ca3ca5/"},{path:"/12.æ°æ®åº/06.åå¼æ°æ®åº/02.Cassandra.html",redirect:"/pages/ca3ca5/"},{name:"v-04b75150",path:"/pages/0cb563/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-04b75150").then(t)}},{path:"/pages/0cb563/index.html",redirect:"/pages/0cb563/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/01.Elasticsearché¢è¯æ»ç».html",redirect:"/pages/0cb563/"},{name:"v-41d7fd45",path:"/pages/98c3a5/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-41d7fd45").then(t)}},{path:"/pages/98c3a5/index.html",redirect:"/pages/98c3a5/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/02.Elasticsearchå¿«éå¥é¨.html",redirect:"/pages/98c3a5/"},{name:"v-83a32830",path:"/pages/0fb506/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-83a32830").then(t)}},{path:"/pages/0fb506/index.html",redirect:"/pages/0fb506/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/03.Elasticsearchç®ä».html",redirect:"/pages/0fb506/"},{name:"v-a1e79a52",path:"/pages/d1bae4/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-a1e79a52").then(t)}},{path:"/pages/d1bae4/index.html",redirect:"/pages/d1bae4/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/05.Elasticsearchæ å°.html",redirect:"/pages/d1bae4/"},{name:"v-0f15ab6e",path:"/pages/293175/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-0f15ab6e").then(t)}},{path:"/pages/293175/index.html",redirect:"/pages/293175/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/04.Elasticsearchç´¢å¼.html",redirect:"/pages/293175/"},{name:"v-f6b5c434",path:"/pages/83bd15/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-f6b5c434").then(t)}},{path:"/pages/83bd15/index.html",redirect:"/pages/83bd15/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/05.Elasticsearchæ¥è¯¢.html",redirect:"/pages/83bd15/"},{name:"v-957680f8",path:"/pages/e1b769/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-957680f8").then(t)}},{path:"/pages/e1b769/index.html",redirect:"/pages/e1b769/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/06.Elasticsearché«äº®.html",redirect:"/pages/e1b769/"},{name:"v-2ac3b3cb",path:"/pages/24baff/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-2ac3b3cb").then(t)}},{path:"/pages/24baff/index.html",redirect:"/pages/24baff/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/07.Elasticsearchæåº.html",redirect:"/pages/24baff/"},{name:"v-665de124",path:"/pages/a5a001/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-665de124").then(t)}},{path:"/pages/a5a001/index.html",redirect:"/pages/a5a001/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/09.Elasticsearchåæå¨.html",redirect:"/pages/a5a001/"},{name:"v-164e75b2",path:"/pages/f89f66/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-164e75b2").then(t)}},{path:"/pages/f89f66/index.html",redirect:"/pages/f89f66/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/08.Elasticsearchèå.html",redirect:"/pages/f89f66/"},{name:"v-9a8c12f8",path:"/pages/2d95ce/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-9a8c12f8").then(t)}},{path:"/pages/2d95ce/index.html",redirect:"/pages/2d95ce/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/10.Elasticsearchæ§è½ä¼å.html",redirect:"/pages/2d95ce/"},{name:"v-3c818a28",path:"/pages/4b1907/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-3c818a28").then(t)}},{path:"/pages/4b1907/index.html",redirect:"/pages/4b1907/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/11.ElasticsearchRestApi.html",redirect:"/pages/4b1907/"},{name:"v-7c0bbdd0",path:"/pages/201e43/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-7c0bbdd0").then(t)}},{path:"/pages/201e43/index.html",redirect:"/pages/201e43/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/12.ElasticsearchHighLevelRestJavaApi.html",redirect:"/pages/201e43/"},{name:"v-2a07dc5d",path:"/pages/9a2546/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-2a07dc5d").then(t)}},{path:"/pages/9a2546/index.html",redirect:"/pages/9a2546/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/13.Elasticsearchéç¾¤ååç.html",redirect:"/pages/9a2546/"},{name:"v-717638d6",path:"/pages/fdaf15/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-717638d6").then(t)}},{path:"/pages/fdaf15/index.html",redirect:"/pages/fdaf15/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/20.Elasticsearchè¿ç»´.html",redirect:"/pages/fdaf15/"},{name:"v-2c1e440a",path:"/pages/74675e/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-2c1e440a").then(t)}},{path:"/pages/74675e/index.html",redirect:"/pages/74675e/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/",redirect:"/pages/74675e/"},{name:"v-ec0e4a94",path:"/pages/b7f079/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-ec0e4a94").then(t)}},{path:"/pages/b7f079/index.html",redirect:"/pages/b7f079/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/02.Elastic/02.Elasticææ¯æ ä¹Filebeat.html",redirect:"/pages/b7f079/"},{name:"v-15d3f40c",path:"/pages/7c067f/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-15d3f40c").then(t)}},{path:"/pages/7c067f/index.html",redirect:"/pages/7c067f/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/02.Elastic/03.Filebeatè¿ç»´.html",redirect:"/pages/7c067f/"},{name:"v-778f3185",path:"/pages/553160/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-778f3185").then(t)}},{path:"/pages/553160/index.html",redirect:"/pages/553160/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/02.Elastic/01.Elasticå¿«éå¥é¨.html",redirect:"/pages/553160/"},{name:"v-6550ec14",path:"/pages/002159/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-6550ec14").then(t)}},{path:"/pages/002159/index.html",redirect:"/pages/002159/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/02.Elastic/04.Elasticææ¯æ ä¹Kibana.html",redirect:"/pages/002159/"},{name:"v-8ad847d4",path:"/pages/55ce99/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-8ad847d4").then(t)}},{path:"/pages/55ce99/index.html",redirect:"/pages/55ce99/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/02.Elastic/06.Elasticææ¯æ ä¹Logstash.html",redirect:"/pages/55ce99/"},{name:"v-db66b0d8",path:"/pages/fc47af/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-db66b0d8").then(t)}},{path:"/pages/fc47af/index.html",redirect:"/pages/fc47af/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/02.Elastic/05.Kibanaè¿ç»´.html",redirect:"/pages/fc47af/"},{name:"v-0d48f15b",path:"/pages/7bf7f7/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-0d48f15b").then(t)}},{path:"/pages/7bf7f7/index.html",redirect:"/pages/7bf7f7/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/02.Elastic/",redirect:"/pages/7bf7f7/"},{name:"v-72683126",path:"/pages/012488/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-72683126").then(t)}},{path:"/pages/012488/index.html",redirect:"/pages/012488/"},{path:"/12.æ°æ®åº/",redirect:"/pages/012488/"},{name:"v-2afcea96",path:"/pages/92df30/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-2afcea96").then(t)}},{path:"/pages/92df30/index.html",redirect:"/pages/92df30/"},{path:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/02.Elastic/07.Logstashè¿ç»´.html",redirect:"/pages/92df30/"},{name:"v-03067a49",path:"/categories/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-03067a49").then(t)}},{path:"/categories/index.html",redirect:"/categories/"},{path:"/@pages/categoriesPage.html",redirect:"/categories/"},{name:"v-be824b2e",path:"/tags/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-be824b2e").then(t)}},{path:"/tags/index.html",redirect:"/tags/"},{path:"/@pages/tagsPage.html",redirect:"/tags/"},{name:"v-c7c85e2e",path:"/archives/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-c7c85e2e").then(t)}},{path:"/archives/index.html",redirect:"/archives/"},{path:"/@pages/archivesPage.html",redirect:"/archives/"},{name:"v-91a7d35c",path:"/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-91a7d35c").then(t)}},{path:"/index.html",redirect:"/"},{path:"*",component:vo}],Eo={title:"DB-TUTORIAL",description:"â db-tutorial æ¯ä¸ä¸ªæ°æ®åºæç¨ã",base:"/db-tutorial/",headTags:[["link",{rel:"icon",href:"/db-tutorial/img/favicon.ico"}],["meta",{name:"keywords",content:"vuepress,theme,blog,vdoing"}],["meta",{name:"theme-color",content:"#11a8cd"}],["meta",{name:"wwads-cn-verify",content:"mxqWx62nfQQ9ocT4e5DzISHzOWyF4s"}],["script",{src:"https://cdn.wwads.cn/js/makemoney.js",type:"text/javascript"}]],pages:[{title:"Nosqlææ¯éå",frontmatter:{title:"Nosqlææ¯éå",date:"2020-02-09T02:18:58.000Z",categories:["æ°æ®åº","æ°æ®åºç»¼å"],tags:["æ°æ®åº","ç»¼å","Nosql"],permalink:"/pages/0e1012/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/01.%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%BC%E5%90%88/01.Nosql%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B.html",relativePath:"12.æ°æ®åº/01.æ°æ®åºç»¼å/01.Nosqlææ¯éå.md",key:"v-01aea2f9",path:"/pages/0e1012/",headers:[{level:2,title:"ä¸ãNosql ç®ä»",slug:"ä¸ãnosql-ç®ä»",normalizedTitle:"ä¸ãnosql ç®ä»",charIndex:19},{level:2,title:"äºãåå¼æ°æ®åº",slug:"äºãåå¼æ°æ®åº",normalizedTitle:"äºãåå¼æ°æ®åº",charIndex:1155},{level:3,title:"åå¼æ°æ®åºåç",slug:"åå¼æ°æ®åºåç",normalizedTitle:"åå¼æ°æ®åºåç",charIndex:1316},{level:3,title:"åå¼æ°æ®åºäº§å",slug:"åå¼æ°æ®åºäº§å",normalizedTitle:"åå¼æ°æ®åºäº§å",charIndex:1485},{level:3,title:"åå¼æ°æ®åºç¹æ§",slug:"åå¼æ°æ®åºç¹æ§",normalizedTitle:"åå¼æ°æ®åºç¹æ§",charIndex:1807},{level:3,title:"åå¼æ°æ®åºä½¿ç¨åºæ¯",slug:"åå¼æ°æ®åºä½¿ç¨åºæ¯",normalizedTitle:"åå¼æ°æ®åºä½¿ç¨åºæ¯",charIndex:2495},{level:2,title:"ä¸ãK-V æ°æ®åº",slug:"ä¸ãk-v-æ°æ®åº",normalizedTitle:"ä¸ãk-v æ°æ®åº",charIndex:2885},{level:3,title:"K-V æ°æ®åºäº§å",slug:"k-v-æ°æ®åºäº§å",normalizedTitle:"k-v æ°æ®åºäº§å",charIndex:3043},{level:3,title:"K-V æ°æ®åºç¹æ§",slug:"k-v-æ°æ®åºç¹æ§",normalizedTitle:"k-v æ°æ®åºç¹æ§",charIndex:3713},{level:3,title:"K-V æ°æ®åºä½¿ç¨åºæ¯",slug:"k-v-æ°æ®åºä½¿ç¨åºæ¯",normalizedTitle:"k-v æ°æ®åºä½¿ç¨åºæ¯",charIndex:4154},{level:2,title:"åãææ¡£æ°æ®åº",slug:"åãææ¡£æ°æ®åº",normalizedTitle:"åãææ¡£æ°æ®åº",charIndex:4383},{level:3,title:"ææ¡£æ°æ®åºäº§å",slug:"ææ¡£æ°æ®åºäº§å",normalizedTitle:"ææ¡£æ°æ®åºäº§å",charIndex:4598},{level:3,title:"ææ¡£æ°æ®åºç¹æ§",slug:"ææ¡£æ°æ®åºç¹æ§",normalizedTitle:"ææ¡£æ°æ®åºç¹æ§",charIndex:4957},{level:3,title:"ææ¡£æ°æ®åºä½¿ç¨åºæ¯",slug:"ææ¡£æ°æ®åºä½¿ç¨åºæ¯",normalizedTitle:"ææ¡£æ°æ®åºä½¿ç¨åºæ¯",charIndex:5447},{level:2,title:"äºãå¨ææç´¢å¼æ",slug:"äºãå¨ææç´¢å¼æ",normalizedTitle:"äºãå¨ææç´¢å¼æ",charIndex:5620},{level:3,title:"æç´¢å¼æåç",slug:"æç´¢å¼æåç",normalizedTitle:"æç´¢å¼æåç",charIndex:5814},{level:3,title:"æç´¢å¼æäº§å",slug:"æç´¢å¼æäº§å",normalizedTitle:"æç´¢å¼æäº§å",charIndex:6029},{level:3,title:"æç´¢å¼æç¹æ§",slug:"æç´¢å¼æç¹æ§",normalizedTitle:"æç´¢å¼æç¹æ§",charIndex:6422},{level:3,title:"æç´¢å¼æåºæ¯",slug:"æç´¢å¼æåºæ¯",normalizedTitle:"æç´¢å¼æåºæ¯",charIndex:6848},{level:2,title:"å­ãå¾æ°æ®åº",slug:"å­ãå¾æ°æ®åº",normalizedTitle:"å­ãå¾æ°æ®åº",charIndex:6979},{level:3,title:"å¾æ°æ®åºäº§å",slug:"å¾æ°æ®åºäº§å",normalizedTitle:"å¾æ°æ®åºäº§å",charIndex:7123},{level:3,title:"å¾æ°æ®åºç¹æ§",slug:"å¾æ°æ®åºç¹æ§",normalizedTitle:"å¾æ°æ®åºç¹æ§",charIndex:7592},{level:3,title:"å¾æ°æ®åºåºæ¯",slug:"å¾æ°æ®åºåºæ¯",normalizedTitle:"å¾æ°æ®åºåºæ¯",charIndex:8339},{level:2,title:"ä¸ãæ»ç»",slug:"ä¸ãæ»ç»",normalizedTitle:"ä¸ãæ»ç»",charIndex:8504},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:8990}],headersStr:"ä¸ãNosql ç®ä» äºãåå¼æ°æ®åº åå¼æ°æ®åºåç åå¼æ°æ®åºäº§å åå¼æ°æ®åºç¹æ§ åå¼æ°æ®åºä½¿ç¨åºæ¯ ä¸ãK-V æ°æ®åº K-V æ°æ®åºäº§å K-V æ°æ®åºç¹æ§ K-V æ°æ®åºä½¿ç¨åºæ¯ åãææ¡£æ°æ®åº ææ¡£æ°æ®åºäº§å ææ¡£æ°æ®åºç¹æ§ ææ¡£æ°æ®åºä½¿ç¨åºæ¯ äºãå¨ææç´¢å¼æ æç´¢å¼æåç æç´¢å¼æäº§å æç´¢å¼æç¹æ§ æç´¢å¼æåºæ¯ å­ãå¾æ°æ®åº å¾æ°æ®åºäº§å å¾æ°æ®åºç¹æ§ å¾æ°æ®åºåºæ¯ ä¸ãæ»ç» åèèµæ",content:'# Nosql ææ¯éå\n\n\n\n\n# ä¸ãNosql ç®ä»\n\nä¼ ç»çå³ç³»åæ°æ®åºå­å¨ä»¥ä¸ç¼ºç¹ï¼\n\n * å¤§æ°æ®åºæ¯ä¸ I/O è¾é« - å ä¸ºæ°æ®æ¯æè¡å­å¨ï¼å³ä½¿åªéå¯¹å¶ä¸­æä¸åè¿è¡è¿ç®ï¼å³ç³»åæ°æ®åºä¹ä¼å°æ´è¡æ°æ®ä»å­å¨è®¾å¤ä¸­è¯»å¥åå­ï¼å¯¼è´ I/O è¾é«ã\n * å­å¨çæ¯è¡è®°å½ï¼æ æ³å­å¨æ°æ®ç»æã\n * è¡¨ç»æ schema æ©å±ä¸æ¹ä¾¿ - å¦è¦éè¦ä¿®æ¹è¡¨ç»æï¼éè¦æ§è¡æ§è¡ DDL(data definition language)ï¼è¯­å¥ä¿®æ¹ï¼ä¿®æ¹æé´ä¼å¯¼è´éè¡¨ï¼é¨åæå¡ä¸å¯ç¨ã\n * å¨ææç´¢åè½è¾å¼± - å³ç³»åæ°æ®åºä¸åªè½å¤è¿è¡å­å­ç¬¦ä¸²çå¹éæ¥è¯¢ï¼å½è¡¨çæ°æ®éæ¸åå¤§çæ¶åï¼LIKE æ¥è¯¢çå¹éä¼éå¸¸æ¢ï¼å³ä½¿å¨æç´¢å¼çæåµä¸ãåµä¸å³ç³»åæ°æ®åºä¹ä¸åºè¯¥å¯¹ææ¬å­æ®µè¿è¡ç´¢å¼ã\n * å­å¨åå¤çå¤æå³ç³»åæ°æ®åè½è¾å¼± - è®¸å¤åºç¨ç¨åºéè¦äºè§£åå¯¼èªé«åº¦è¿æ¥æ°æ®ä¹é´çå³ç³»ï¼æè½å¯ç¨ç¤¾äº¤åºç¨ç¨åºãæ¨èå¼æãæ¬ºè¯æ£æµãç¥è¯å¾è°±ãçå½ç§å­¦å IT/ç½ç»ç­ç¨ä¾ãç¶èä¼ ç»çå³ç³»æ°æ®åºå¹¶ä¸åäºå¤çæ°æ®ç¹ä¹é´çå³ç³»ãå®ä»¬çè¡¨æ ¼æ°æ®æ¨¡ååä¸¥æ ¼çæ¨¡å¼ä½¿å®ä»¬å¾é¾æ·»å æ°çæä¸åç§ç±»çå³èä¿¡æ¯ã\n\néçå¤§æ°æ®æ¶ä»£çå°æ¥ï¼è¶æ¥è¶å¤çç½ç«ãåºç¨ç³»ç»éè¦æ¯ææµ·éæ°æ®å­å¨ï¼é«å¹¶åè¯·æ±ãé«å¯ç¨ãé«å¯æ©å±æ§ç­ç¹æ§è¦æ±ãä¼ ç»çå³ç³»åæ°æ®åºå¨åºä»è¿äºè°æ´å·²ç»æ¾å¾åä¸ä»å¿ï¼æ´é²äºè®¸å¤è½ä»¥åæçé®é¢ãç±æ­¤ï¼åç§åæ ·ç NoSQLï¼Not Only SQLï¼æ°æ®åºä½ä¸ºä¼ ç»å³ç³»åæ°æ®çä¸ä¸ªæåè¡¥åå¾å°è¿çåå±ã\n\n\n\nNoSQLï¼æ³æéå³ç³»åçæ°æ®åºï¼å¯ä»¥çè§£ä¸º SQL çä¸ä¸ªæåè¡¥åã\n\nå¨ NoSQL è®¸å¤æ¹é¢æ§è½å¤§å¤§ä¼äºéå³ç³»åæ°æ®åºçåæ¶ï¼å¾å¾ä¹ä¼´éä¸äºç¹æ§çç¼ºå¤±ï¼æ¯è¾å¸¸è§çï¼æ¯äºå¡åºäºå¡åè½çç¼ºå¤±ã æ°æ®åºäºå¡æ­£ç¡®æ§è¡çåä¸ªåºæ¬è¦ç´ ï¼ACID å¦ä¸ï¼\n\n    åç§°                æè¿°\nA   Atomicity (åå­æ§)   ä¸ä¸ªäºå¡ä¸­çæææä½ï¼è¦ä¹å¨é¨å®æï¼è¦ä¹å¨é¨ä¸å®æï¼ä¸ä¼å¨ä¸­é´æä¸ªç¯èç»æã\n                      äºå¡å¨æ§è¡è¿ç¨ä¸­åçéè¯¯ï¼ä¼è¢«åæ»å°äºå¡å¼å§åçç¶æï¼å°±åè¿ä¸ªäºå¡ä»æ¥æ²¡ææ§è¡è¿ä¸æ ·ã\nC   Consistency ä¸è´æ§   å¨äºå¡å¼å§ä¹ååäºå¡ç»æä»¥åï¼æ°æ®çæ°æ®çä¸è´æ§çº¦ææ²¡æè¢«ç ´åã\nI   Isolation éç¦»æ§     æ°æ®åºåè®¸å¤ä¸ªå¹¶åäºå¡åæ¶å¯¹æ°æ®è¿è¡è¯»ååä¿®æ¹çè½åãéç¦»æ§å¯ä»¥é²æ­¢å¤ä¸ªäºå¡å¹¶åæ§è¡æ¶ç±äºäº¤åæ§è¡èå¯¼è´æ°æ®çä¸ä¸è´ã\nD   Durability æä¹æ§    äºå¡å¤çç»æåï¼å¯¹æ°æ®çä¿®æ¹å°±æ¯æ°¸ä¹çï¼å³ä¾¿ç³»ç»æéä¹ä¸ä¼ä¸¢å¤±ã\n\nä¸é¢ä»ç» 5 å¤§ç±» NoSQL æ°æ®éå¯¹ä¼ ç»å³ç³»åæ°æ®åºçç¼ºç¹æä¾çè§£å³æ¹æ¡ï¼\n\n\n# äºãåå¼æ°æ®åº\n\nåå¼æ°æ®åºæ¯ä»¥åç¸å³å­å¨æ¶æè¿è¡æ°æ®å­å¨çæ°æ®åºï¼ä¸»è¦éåäºæ¹éæ°æ®å¤çåå³æ¶æ¥è¯¢ã\n\nç¸å¯¹åºçæ¯è¡å¼æ°æ®åºï¼æ°æ®ä»¥è¡ç¸å³çå­å¨ä½ç³»æ¶æè¿è¡ç©ºé´åéï¼ä¸»è¦éåäºå°æ¹éçæ°æ®å¤çï¼å¸¸ç¨äºèæºäºå¡åæ°æ®å¤çã\n\nåºäºåå¼æ°æ®åºçååå­å¨ç¹æ§ï¼å¯ä»¥è§£å³æäºç¹å®åºæ¯ä¸å³ç³»åæ°æ®åº I/O è¾é«çé®é¢ã\n\n\n# åå¼æ°æ®åºåç\n\nä¼ ç»å³ç³»åæ°æ®åºæ¯æç§è¡æ¥å­å¨æ°æ®åºï¼ç§°ä¸ºâè¡å¼æ°æ®åºâï¼èåå¼æ°æ®åºæ¯æç§åæ¥å­å¨æ°æ®ã\n\nå°è¡¨æ¾å¥å­å¨ç³»ç»ä¸­æä¸¤ç§æ¹æ³ï¼èæä»¬ç»å¤§é¨åæ¯éç¨è¡å­å¨çã è¡å­å¨æ³æ¯å°åè¡æ¾å¥è¿ç»­çç©çä½ç½®ï¼è¿å¾åä¼ ç»çè®°å½åæä»¶ç³»ç»ã åå­å¨æ³æ¯å°æ°æ®æç§åå­å¨å°æ°æ®åºä¸­ï¼ä¸è¡å­å¨ç±»ä¼¼ï¼ä¸å¾æ¯ä¸¤ç§å­å¨æ¹æ³çå¾å½¢åè§£éï¼\n\n\n\n\n# åå¼æ°æ®åºäº§å\n\n * HBase\n   \n   \n   \n   HBase æ¯ä¸ä¸ªå¼æºçéå³ç³»ååå¸å¼æ°æ®åºï¼NoSQLï¼ï¼å®åèäºè°·æ­ç BigTable å»ºæ¨¡ï¼å®ç°çç¼ç¨è¯­è¨ä¸º Javaãå®æ¯ Apache è½¯ä»¶åºéä¼ç Hadoop é¡¹ç®çä¸é¨åï¼è¿è¡äº HDFS æä»¶ç³»ç»ä¹ä¸ï¼ä¸º Hadoop æä¾ç±»ä¼¼äº BigTable è§æ¨¡çæå¡ãå æ­¤ï¼å®å¯ä»¥å®¹éå°å­å¨æµ·éç¨ççæ°æ®ã\n\n * BigTable\n   \n   \n   \n   BigTable æ¯ä¸ç§åç¼©çãé«æ§è½çãé«å¯æ©å±æ§çï¼åºäº Google æä»¶ç³»ç»ï¼Google File Systemï¼GFSï¼çæ°æ®å­å¨ç³»ç»ï¼ç¨äºå­å¨å¤§è§æ¨¡ç»æåæ°æ®ï¼éç¨äºäºç«¯è®¡ç®ã\n\n\n# åå¼æ°æ®åºç¹æ§\n\nä¼ç¹å¦ä¸ï¼\n\n * é«æçå¨å­ç©ºé´å©ç¨ç\n\nåå¼æ°æ®åºç±äºå¶éå¯¹ä¸ååçæ°æ®ç¹å¾èåæçä¸åç®æ³ï¼ä½¿å¶å¾å¾ææ¯è¡å¼æ°æ®åºé«çå¤çåç¼©çï¼æ®éçè¡å¼æ°æ®åºä¸è¬åç¼©çå¨ 3ï¼1 å° 5ï¼1 å·¦å³ï¼èåå¼æ°æ®åºçåç¼©çä¸è¬å¨ 8ï¼1 å° 30ï¼1 å·¦å³ã æ¯è¾å¸¸è§çï¼éè¿å­å¸è¡¨åç¼©æ°æ®ï¼ ä¸é¢ä¸­ææ¯é£å¼ è¡¨æ¬æ¥çæ ·å­ãç»è¿å­å¸è¡¨è¿è¡æ°æ®åç¼©åï¼è¡¨ä¸­çå­ç¬¦ä¸²æé½åææ°å­äºãæ­£å ä¸ºæ¯ä¸ªå­ç¬¦ä¸²å¨å­å¸è¡¨éåªåºç°ä¸æ¬¡äºï¼æä»¥è¾¾å°äºåç¼©çç®ç(æç¹åè§èååéè§èå Normalize å Denomalize)\n\n\n\n * æ¥è¯¢æçé«\n\nè¯»åå¤æ¡æ°æ®çåä¸åæçé«ï¼å ä¸ºè¿äºåé½æ¯å­å¨å¨ä¸èµ·çï¼ä¸æ¬¡ç£çæä½å¯ä»¥æ°æ®çæå®åå¨é¨è¯»åå°åå­ä¸­ã ä¸å¾éè¿ä¸æ¡æ¥è¯¢çæ§è¡è¿ç¨è¯´æåå¼å­å¨(ä»¥åæ°æ®åç¼©)çä¼ç¹\n\n\n\næ§è¡æ­¥éª¤å¦ä¸ï¼\ni. å»å­å¸è¡¨éæ¾å°å­ç¬¦ä¸²å¯¹åºæ°å­(åªè¿è¡ä¸æ¬¡å­ç¬¦ä¸²æ¯è¾)ã\nii. ç¨æ°å­å»åè¡¨éå¹éï¼å¹éä¸çä½ç½®è®¾ä¸º1ã\niii. æä¸ååçå¹éç»æè¿è¡ä½è¿ç®å¾å°ç¬¦åæææ¡ä»¶çè®°å½ä¸æ ã\niv. ä½¿ç¨è¿ä¸ªä¸æ ç»è£åºæç»çç»æéã\nå¤å¶ä»£ç \n\n\n * éååèåæä½\n * éåå¤§éçæ°æ®èä¸æ¯å°æ°æ®\n\nç¼ºç¹å¦ä¸ï¼\n\n * ä¸éåæ«æå°éæ°æ®\n * ä¸éåéæºçæ´æ°\n * ä¸éååå«æå é¤åæ´æ°çå®æ¶æä½\n * åè¡çæ°æ®æ¯ ACID çï¼å¤è¡çäºå¡æ¶ï¼ä¸æ¯æäºå¡çæ­£å¸¸åæ»ï¼æ¯æ I(Isolation)éç¦»æ§(äºå¡ä¸²è¡æäº¤)ï¼D(Durability)æä¹æ§ï¼ä¸è½ä¿è¯ A(Atomicity)åå­æ§ï¼ C(Consistency)ä¸è´æ§\n\n\n# åå¼æ°æ®åºä½¿ç¨åºæ¯\n\nä»¥ HBase ä¸ºä¾è¯´æï¼\n\n * å¤§æ°æ®é ï¼100s TB çº§æ°æ®ï¼ ä¸æå¿«ééæºè®¿é®çéæ±ãå¢é¿éæ æ³é¢ä¼°çåºç¨ï¼éè¦è¿è¡ä¼éçæ°æ®æ©å±ç HBase æ¯æå¨çº¿æ©å±ï¼å³ä½¿å¨ä¸æ®µæ¶é´åæ°æ®éåäºå·å¼å¢é¿ï¼ä¹å¯ä»¥éè¿ HBase æ¨ªåæ©å±æ¥æ»¡è¶³åè½ã\n * åå¯éååºç¨ï¼æ¯å¤©åå¥éå·¨å¤§ï¼èç¸å¯¹è¯»æ°éè¾å°çåºç¨ æ¯å¦ IM çåå²æ¶æ¯ï¼æ¸¸æçæ¥å¿ç­ç­\n * ä¸éè¦å¤ææ¥è¯¢æ¡ä»¶æ¥æ¥è¯¢æ°æ®çåºç¨ HBase åªæ¯æåºäº rowkey çæ¥è¯¢ï¼å¯¹äº HBase æ¥è¯´ï¼åæ¡è®°å½æèå°èå´çæ¥è¯¢æ¯å¯ä»¥æ¥åçï¼å¤§èå´çæ¥è¯¢ç±äºåå¸å¼çåå ï¼å¯è½å¨æ§è½ä¸æç¹å½±åï¼HBase ä¸éç¨äºæ joinï¼å¤çº§ç´¢å¼ï¼è¡¨å³ç³»å¤æçæ°æ®æ¨¡åã\n * å¯¹æ§è½åå¯é æ§è¦æ±éå¸¸é«çåºç¨ï¼ç±äº HBase æ¬èº«æ²¡æåç¹æéï¼å¯ç¨æ§éå¸¸é«ã\n * å­å¨ç»æåååç»æåçæ°æ®ã\n\n\n# ä¸ãK-V æ°æ®åº\n\nK-V æ°æ®åºæçæ¯ä½¿ç¨é®å¼(key-value)å­å¨çæ°æ®åºï¼å¶æ°æ®æç§é®å¼å¯¹çå½¢å¼è¿è¡ç»ç»ãç´¢å¼åå­å¨ã\n\nKV å­å¨éå¸¸éåå­å¨ä¸æ¶åè¿å¤æ°æ®å³ç³»ä¸å¡å³ç³»çæ°æ®ï¼åæ¶è½ææåå°è¯»åç£ççæ¬¡æ°ï¼æ¯ SQL æ°æ®åºå­å¨æ¥ææ´å¥½çè¯»åæ§è½ï¼è½å¤è§£å³å³ç³»åæ°æ®åºæ æ³å­å¨æ°æ®ç»æçé®é¢ã\n\n\n# K-V æ°æ®åºäº§å\n\n * Redis\n   \n   \n   \n   Redis æ¯ä¸ä¸ªä½¿ç¨ ANSI C ç¼åçå¼æºãæ¯æç½ç»ãåºäºåå­ãå¯éæä¹æ§çé®å¼å¯¹å­å¨æ°æ®åºãä» 2015 å¹´ 6 æå¼å§ï¼Redis çå¼åç± Redis Labs èµå©ï¼è 2013 å¹´ 5 æè³ 2015 å¹´ 6 ææé´ï¼å¶å¼åç± Pivotal èµå©ãå¨ 2013 å¹´ 5 æä¹åï¼å¶å¼åç± VMware èµå©ãæ ¹æ®æåº¦æè¡ç½ç« DB-Engines.com çæ°æ®æ¾ç¤ºï¼Redis æ¯ææµè¡çé®å¼å¯¹å­å¨æ°æ®åºã\n\n * Cassandra\n   \n   \n   \n   Apache Cassandraï¼ç¤¾åºåä¸è¬ç®ç§°ä¸º C*ï¼æ¯ä¸å¥å¼æºåå¸å¼ NoSQL æ°æ®åºç³»ç»ãå®æåç± Facebook å¼åï¼ç¨äºå¨å­æ¶ä»¶ç®±ç­ç®åæ ¼å¼æ°æ®ï¼é Google BigTable çæ°æ®æ¨¡åä¸ Amazon Dynamo çå®å¨åå¸å¼æ¶æäºä¸èº«ãFacebook äº 2008 å° Cassandra å¼æºï¼æ­¤åï¼ç±äº Cassandra è¯å¥½çå¯æ©å±æ§åæ§è½ï¼è¢« Apple, Comcast,Instagram, Spotify, eBay, Rackspace, Netflix ç­ç¥åç½ç«æéç¨ï¼æä¸ºäºä¸ç§æµè¡çåå¸å¼ç»æåæ°æ®å­å¨æ¹æ¡ã\n\n * LevelDB\n   \n   \n   \n   LevelDB æ¯ä¸ä¸ªç± Google å¬å¸æç åçé®ï¼å¼å¯¹ï¼Key/Value Pairï¼åµå¥å¼æ°æ®åºç®¡çç³»ç»ç¼ç¨åºï¼ ä»¥å¼æºç BSD è®¸å¯è¯åå¸ã\n\n\n# K-V æ°æ®åºç¹æ§\n\nä»¥ Redis ä¸ºä¾ï¼\n\nä¼ç¹å¦ä¸ï¼\n\n * æ§è½æé« - Redis è½æ¯æè¶è¿ 10W ç TPSã\n * ä¸°å¯çæ°æ®ç±»å - Redis æ¯æåæ¬ Stringï¼Hashï¼Listï¼Setï¼Sorted Setï¼Bitmap å hyperloglogã\n * ä¸°å¯çç¹æ§ - Redis è¿æ¯æ publish/subscribeãéç¥ãkey è¿æç­ç­ç¹æ§ã\n\nç¼ºç¹å¦ä¸ï¼ éå¯¹ ACIDï¼Redis äºå¡ä¸è½æ¯æåå­æ§åæä¹æ§(A å D)ï¼åªæ¯æéç¦»æ§åä¸è´æ§(I å C) ç¹å«è¯´æä¸ä¸ï¼è¿éæè¯´çæ æ³ä¿è¯åå­æ§ï¼æ¯éå¯¹ Redis çäºå¡æä½ï¼å ä¸ºäºå¡æ¯ä¸æ¯æåæ»ï¼roll backï¼ï¼èå ä¸º Redis çåçº¿ç¨æ¨¡åï¼Redis çæ®éæä½æ¯åå­æ§çã\n\nå¤§é¨åä¸å¡ä¸éè¦ä¸¥æ ¼éµå¾ª ACID ååï¼ä¾å¦æ¸¸æå®æ¶æè¡æ¦ï¼ç²ä¸å³æ³¨ç­åºæ¯ï¼å³ä½¿é¨åæ°æ®æä¹åå¤±è´¥ï¼å¶å®ä¸å¡å½±åä¹éå¸¸å°ãå æ­¤å¨è®¾è®¡æ¹æ¡æ¶ï¼éè¦æ ¹æ®ä¸å¡ç¹å¾åè¦æ±æ¥åéæ©\n\n\n# K-V æ°æ®åºä½¿ç¨åºæ¯\n\n * éç¨åºæ¯ - å¨å­ç¨æ·ä¿¡æ¯(æ¯å¦ä¼è¯)ãéç½®æä»¶ãåæ°ãè´­ç©è½¦ç­ç­ãè¿äºä¿¡æ¯ä¸è¬é½å IDï¼é®ï¼æé©ã\n\n * ä¸éç¨åºæ¯\n   \n   * éè¦éè¿å¼æ¥æ¥è¯¢ï¼èä¸æ¯é®æ¥æ¥è¯¢ãKey-Value æ°æ®åºä¸­æ ¹æ¬æ²¡æéè¿å¼æ¥è¯¢çéå¾ã\n   * éè¦å¨å­æ°æ®ä¹é´çå³ç³»ãå¨ Key-Value æ°æ®åºä¸­ä¸è½éè¿ä¸¤ä¸ªæä»¥ä¸çé®æ¥å³èæ°æ®\n   * éè¦äºå¡çæ¯æãå¨ Key-Value æ°æ®åºä¸­æéäº§çæ¶ä¸å¯ä»¥è¿è¡åæ»ã\n\n\n# åãææ¡£æ°æ®åº\n\nææ¡£æ°æ®åºï¼ä¹ç§°ä¸ºææ¡£åæ°æ®åºï¼æ¯æ¨å¨å°åç»æåæ°æ®å­å¨ä¸ºææ¡£çä¸ç§æ°æ®åºï¼å®å¯ä»¥è§£å³å³ç³»åæ°æ®åºè¡¨ç»æ schema æ©å±ä¸æ¹ä¾¿çé®é¢ãææ¡£æ°æ®åºéå¸¸ä»¥ JSON æ XML æ ¼å¼å­å¨æ°æ®ã\n\nç±äºææ¡£æ°æ®åºç no-schema ç¹æ§ï¼å¯ä»¥å­å¨åè¯»åä»»ææ°æ®ãç±äºä½¿ç¨çæ°æ®æ ¼å¼æ¯ JSON æè XMLï¼æ éå¨ä½¿ç¨åå®ä¹å­æ®µï¼è¯»åä¸ä¸ª JSON ä¸­ä¸å­å¨çå­æ®µä¹ä¸ä¼å¯¼è´ SQL é£æ ·çè¯­æ³éè¯¯ã\n\n\n# ææ¡£æ°æ®åºäº§å\n\n * MongoDB\n   \n   \n   \n   MongoDBæ¯ä¸ç§é¢åææ¡£çæ°æ®åºç®¡çç³»ç»ï¼ç± C++ æ°åèæï¼ä»¥æ­¤æ¥è§£å³åºç¨ç¨åºå¼åç¤¾åºä¸­çå¤§éç°å®é®é¢ã2007 å¹´ 10 æï¼MongoDB ç± 10gen å¢éæåå±ã2009 å¹´ 2 æé¦åº¦æ¨åºã\n\n * CouchDB\n   \n   \n   \n   Apache CouchDB æ¯ä¸ä¸ªå¼æºæ°æ®åºï¼ä¸æ³¨äºæç¨æ§åæä¸º"å®å¨æ¥æ± web çæ°æ®åº"ãå®æ¯ä¸ä¸ªä½¿ç¨ JSON ä½ä¸ºå­å¨æ ¼å¼ï¼JavaScript ä½ä¸ºæ¥è¯¢è¯­è¨ï¼MapReduce å HTTP ä½ä¸º API ç NoSQL æ°æ®åºãå¶ä¸­ä¸ä¸ªæ¾èçåè½å°±æ¯å¤ä¸»å¤å¶ãCouchDB çç¬¬ä¸ä¸ªçæ¬åå¸å¨ 2005 å¹´ï¼å¨ 2008 å¹´æä¸ºäº Apache çé¡¹ç®ã\n\n\n# ææ¡£æ°æ®åºç¹æ§\n\nä»¥ MongoDB ä¸ºä¾è¿è¡è¯´æ\n\nä¼ç¹å¦ä¸ï¼\n\n * å®¹æå­å¨å¤ææ°æ®ç»æ - JSON æ¯ä¸ç§å¼ºå¤§çæè¿°è¯­è¨ï¼è½å¤æè¿°å¤æçæ°æ®ç»æã\n * å®¹æåæ´æ°æ®ç»æ - æ éåå³ç³»åæ°æ®åºä¸æ ·åæ§è¡ DDL è¯­å¥ä¿®æ¹è¡¨ç»æï¼ç¨åºä»£ç ç´æ¥è¯»åå³å¯ã\n * å®¹æå¼å®¹åå²æ°æ® - å¯¹äºåå²æ°æ®ï¼å³ä½¿æ²¡ææ°å¢çå­æ®µï¼ä¹ä¸ä¼å¯¼è´éè¯¯ï¼åªä¼è¿åç©ºå¼ï¼æ­¤æ¶ä»£ç å¼å®¹å¤çå³å¯ã\n\nç¼ºç¹å¦ä¸ï¼\n\n * é¨åæ¯æäºå¡\n   * Atomicity(åå­æ§) ä»æ¯æåè¡/ææ¡£çº§åå­æ§ï¼ä¸æ¯æå¤è¡ãå¤ææ¡£ãå¤è¯­å¥åå­æ§ã\n   * Isolation(éç¦»æ§) éç¦»çº§å«ä»æ¯æå·²æäº¤è¯»ï¼Read committedï¼çº§å«ï¼å¯è½å¯¼è´ä¸å¯éå¤è¯»ï¼å¹»è¯»çé®é¢ã\n * ä¸æ¯æå¤ææ¥è¯¢ - ä¾å¦ join æ¥è¯¢ï¼å¦æéè¦ join æ¥è¯¢ï¼éè¦å¤æ¬¡æä½æ°æ®åºã\n\nMongonDB è¿æ¯æ¯æå¤ææ¡£äºå¡ç Consistency(ä¸è´æ§)å Durability(æä¹æ§)\n\nè½ç¶å®æ¹å®£å¸ MongoDB å°å¨ 4.0 çæ¬ä¸­æ­£å¼æ¨åºå¤ææ¡£ ACID äºå¡æ¯æï¼æåè½å°æåµè¿æå¾è§è¯ã\n\n\n# ææ¡£æ°æ®åºä½¿ç¨åºæ¯\n\néç¨åºæ¯ï¼\n\n * å¤§æ°æ®éï¼ä¸æªæ¥æ°æ®å¢é¿å¾å¿«\n * è¡¨ç»æä¸æç¡®ï¼ä¸å­æ®µå¨ä¸æ­å¢å ï¼ä¾å¦åå®¹ç®¡çç³»ç»ï¼ä¿¡æ¯ç®¡çç³»ç»\n\nä¸éç¨åºæ¯ï¼\n\n * æ¯æäºå¡ - å¨ä¸åçææ¡£ä¸éè¦æ·»å äºå¡ãDocument-Oriented æ°æ®åºå¹¶ä¸æ¯æææ¡£é´çäºå¡\n * æ¯æå¤ææ¥è¯¢ - å¤ä¸ªææ¡£ç´æ¥éè¦å¤ææ¥è¯¢ï¼ä¾å¦ join\n\n\n# äºãå¨ææç´¢å¼æ\n\nä¼ ç»å³ç³»åæ°æ®åºä¸»è¦éè¿ç´¢å¼æ¥è¾¾å°å¿«éæ¥è¯¢çç®çï¼å¨å¨ææç´¢çä¸å¡ä¸ï¼ç´¢å¼ä¹æ è½ä¸ºåï¼ä¸»è¦ä½ç°å¨ï¼\n\n * å¨ææç´¢çæ¡ä»¶å¯ä»¥éææåç»åï¼å¦æéè¿ç´¢å¼æ¥æ»¡è¶³ï¼åç´¢å¼çæ°ééå¸¸å¤\n * å¨ææç´¢çæ¨¡ç³å¹éæ¹å¼ï¼ç´¢å¼æ æ³æ»¡è¶³ï¼åªè½ç¨ LIKE æ¥è¯¢ï¼è LIKE æ¥è¯¢æ¯æ´è¡¨æ«æï¼æçéå¸¸ä½\n\nèå¨ææç´¢å¼æçåºç°ï¼æ­£æ¯è§£å³å³ç³»åæ°æ®åºå¨ææç´¢åè½è¾å¼±çé®é¢ã\n\n\n# æç´¢å¼æåç\n\nå¨ææç´¢å¼æçææ¯åçç§°ä¸º åæç´¢å¼ï¼inverted indexï¼ï¼æ¯ä¸ç§ç´¢å¼æ¹æ³ï¼å¶åºæ¬åçæ¯å»ºç«åè¯å°ææ¡£çç´¢å¼ãä¸ä¹ç¸å¯¹æ¯ï¼æ¯âæ­£æç´¢å¼âï¼å¶åºæ¬åçæ¯å»ºç«ææ¡£å°åè¯çç´¢å¼ã\n\nç°å¨æå¦ä¸ææ¡£éåï¼\n\n\n\næ­£æç´¢å¼å¾å°ç´¢å¼å¦ä¸ï¼\n\n\n\nå¯è§ï¼æ­£æç´¢å¼éç¨äºæ ¹æ®ææ¡£åç§°æ¥è¯¢ææ¡£åå®¹\n\nç®åçåæç´¢å¼å¦ä¸ï¼\n\n\n\nå¸¦æåè¯é¢çä¿¡æ¯çåæç´¢å¼å¦ä¸ï¼\n\n\n\nå¯è§ï¼åæç´¢å¼éç¨äºæ ¹æ®å³é®è¯æ¥æ¥è¯¢ææ¡£åå®¹\n\n\n# æç´¢å¼æäº§å\n\n * Elasticsearch\n   \n   \n   \n   Elasticsearch æ¯ä¸ä¸ªåºäº Lucene çæç´¢å¼æãå®æä¾äºä¸ä¸ªåå¸å¼ï¼å¤ç§æ· -è½å¤å¨ææç´¢ä¸åå¨æº HTTP Web çé¢åæ æ¶æ JSON æä»¶ãElasticsearch æ¯ç¨ Java å¼åçï¼å¹¶æ ¹æ® Apache License çæ¡æ¬¾ä½ä¸ºå¼æºåå¸ãæ ¹æ® DB-Engines æåï¼Elasticsearch æ¯æåæ¬¢è¿çä¼ä¸æç´¢å¼æï¼åé¢æ¯åºäº Lucene ç Apache Solrã\n\n * Solr\n   \n   \n   \n   Solr æ¯ Apache Lucene é¡¹ç®çå¼æºä¼ä¸æç´¢å¹³å°ãå¶ä¸»è¦åè½åæ¬å¨ææ£ç´¢ãå½ä¸­æ ç¤ºãåé¢æç´¢ãå¨æèç±»ãæ°æ®åºéæï¼ä»¥åå¯ææ¬ï¼å¦ WordãPDFï¼çå¤çãSolr æ¯é«åº¦å¯æ©å±çï¼å¹¶æä¾äºåå¸å¼æç´¢åç´¢å¼å¤å¶\n\n\n# æç´¢å¼æç¹æ§\n\nä»¥ Elasticsearch ä¸ºä¾ï¼ ä¼ç¹å¦ä¸ï¼\n\n * æ¥è¯¢æçé« - å¯¹æµ·éæ°æ®è¿è¡è¿å®æ¶çå¤ç\n * å¯æ©å±æ§ - åºäºéç¾¤ç¯å¢å¯ä»¥æ¹ä¾¿æ¨ªåæ©å±ï¼å¯ä»¥æ¿è½½ PB çº§æ°æ®\n * é«å¯ç¨ - Elasticsearch éç¾¤å¼¹æ§-ä»ä»¬å°åç°æ°çæå¤±è´¥çèç¹ï¼éç»åéæ°å¹³è¡¡æ°æ®ï¼ç¡®ä¿æ°æ®æ¯å®å¨çåå¯è®¿é®ç\n\nç¼ºç¹å¦ä¸ï¼\n\n * é¨åæ¯æäºå¡ - åä¸ææ¡£çæ°æ®æ¯ ACID çï¼åå«å¤ä¸ªææ¡£çäºå¡æ¶ä¸æ¯æäºå¡çæ­£å¸¸åæ»ï¼æ¯æ I(Isolation)éç¦»æ§ï¼åºäºä¹è§éæºå¶çï¼ï¼D(Durability)æä¹æ§ï¼ä¸æ¯æ A(Atomicity)åå­æ§ï¼C(Consistency)ä¸è´æ§\n * å¯¹ç±»ä¼¼æ°æ®åºä¸­éè¿å¤é®çå¤æçå¤è¡¨å³èæä½æ¯æè¾å¼±ã\n * è¯»åæä¸å®å»¶æ¶ï¼åå¥çæ°æ®ï¼æå¿« 1s ä¸­è½è¢«æ£ç´¢å°\n * æ´æ°æ§è½è¾ä½ï¼åºå±å®ç°æ¯åå æ°æ®ï¼åæå¥æ°æ°æ®\n * åå­å ç¨å¤§ï¼å ä¸º Lucene å°ç´¢å¼é¨åå è½½å°åå­ä¸­\n\n\n# æç´¢å¼æåºæ¯\n\néç¨åºæ¯å¦ä¸ï¼\n\n * æç´¢å¼æåæ°æ®åæå¼æ - å¨ææ£ç´¢ï¼ç»æåæ£ç´¢ï¼æ°æ®åæ\n * å¯¹æµ·éæ°æ®è¿è¡è¿å®æ¶çå¤ç - å¯ä»¥å°æµ·éæ°æ®åæ£å°å¤å°æå¡å¨ä¸å»å­å¨åæ£ç´¢\n\nä¸éç¨åºæ¯å¦ä¸ï¼\n\n * æ°æ®éè¦é¢ç¹æ´æ°\n * éè¦å¤æå³èæ¥è¯¢\n\n\n# å­ãå¾æ°æ®åº\n\n\n\nå¾å½¢æ°æ®åºåºç¨å¾è®ºå­å¨å®ä½ä¹é´çå³ç³»ä¿¡æ¯ãæå¸¸è§ä¾å­å°±æ¯ç¤¾ä¼ç½ç»ä¸­äººä¸äººä¹é´çå³ç³»ãå³ç³»åæ°æ®åºç¨äºå­å¨âå³ç³»åâæ°æ®çææå¹¶ä¸å¥½ï¼å¶æ¥è¯¢å¤æãç¼æ¢ãè¶åºé¢æï¼èå¾å½¢æ°æ®åºçç¬ç¹è®¾è®¡æ°æ°å¼¥è¡¥äºè¿ä¸ªç¼ºé·ï¼è§£å³å³ç³»åæ°æ®åºå­å¨åå¤çå¤æå³ç³»åæ°æ®åè½è¾å¼±çé®é¢ã\n\n\n# å¾æ°æ®åºäº§å\n\n * Neo4j\n   \n   \n   \n   Neo4j æ¯ç± Neo4jï¼Incãå¼åçå¾å½¢æ°æ®åºç®¡çç³»ç»ãç±å¶å¼åäººåæè¿°ä¸ºå·æåçå¾å­å¨åå¤ççç¬¦å ACID çäºå¡æ°æ®åºï¼æ ¹æ® DB-Engines æåï¼ Neo4j æ¯ææµè¡çå¾å½¢æ°æ®åºã\n\n * ArangoDB\n   \n   \n   \n   ArangoDB æ¯ç± triAGENS GmbH å¼åçåçå¤æ¨¡åæ°æ®åºç³»ç»ãæ°æ®åºç³»ç»æ¯æä¸ä¸ªéè¦çæ°æ®æ¨¡åï¼é®/å¼ï¼ææ¡£ï¼å¾å½¢ï¼ï¼å¶ä¸­åå«ä¸ä¸ªæ°æ®åºæ ¸å¿åç»ä¸æ¥è¯¢è¯­è¨ AQLï¼ArangoDB æ¥è¯¢è¯­è¨ï¼ãæ¥è¯¢è¯­è¨æ¯å£°ææ§çï¼åè®¸å¨åä¸ªæ¥è¯¢ä¸­ç»åä¸åçæ°æ®è®¿é®æ¨¡å¼ãArangoDB æ¯ä¸ä¸ª NoSQL æ°æ®åºç³»ç»ï¼ä½ AQL å¨å¾å¤æ¹é¢ä¸ SQL ç±»ä¼¼ã\n\n * Titan\n   \n   \n   \n   Titan æ¯ä¸ä¸ªå¯æ©å±çå¾å½¢æ°æ®åºï¼éå¯¹å­å¨åæ¥è¯¢åå«åå¸å¨å¤æºç¾¤éä¸­çæ°ç¾äº¿ä¸ªé¡¶ç¹åè¾¹ç¼çå¾å½¢è¿è¡äºä¼åãTitan æ¯ä¸ä¸ªäºå¡æ§æ°æ®åºï¼å¯ä»¥æ¯ææ°åä¸ªå¹¶åç¨æ·å®æ¶æ§è¡å¤æçå¾å½¢éåã\n\n\n# å¾æ°æ®åºç¹æ§\n\nä»¥ Neo4j ä¸ºä¾ï¼\n\nNeo4j ä½¿ç¨æ°æ®ç»æä¸­å¾ï¼graphï¼çæ¦å¿µæ¥è¿è¡å»ºæ¨¡ã Neo4j ä¸­ä¸¤ä¸ªæåºæ¬çæ¦å¿µæ¯èç¹åè¾¹ãèç¹è¡¨ç¤ºå®ä½ï¼è¾¹åè¡¨ç¤ºå®ä½ä¹é´çå³ç³»ãèç¹åè¾¹é½å¯ä»¥æèªå·±çå±æ§ãä¸åå®ä½éè¿åç§ä¸åçå³ç³»å³èèµ·æ¥ï¼å½¢æå¤æçå¯¹è±¡å¾ã\n\néå¯¹å³ç³»æ°æ®ï¼2 ç§ 2 æ°æ®åºçå­å¨ç»æä¸åï¼\n\n\n\nNeo4j ä¸­ï¼å­å¨èç¹æ¶ä½¿ç¨äºâindex-free adjacencyâï¼å³æ¯ä¸ªèç¹é½ææåå¶é»å±èç¹çæéï¼å¯ä»¥è®©æä»¬å¨ O(1)çæ¶é´åæ¾å°é»å±èç¹ãå¦å¤ï¼æç§å®æ¹çè¯´æ³ï¼å¨ Neo4j ä¸­è¾¹æ¯æéè¦ç,æ¯âfirst-class entitiesâï¼æä»¥åç¬å­å¨ï¼è¿æå©äºå¨å¾éåçæ¶åæé«éåº¦ï¼ä¹å¯ä»¥å¾æ¹ä¾¿å°ä»¥ä»»ä½æ¹åè¿è¡éå\n\n\n\nå¦ä¸ä¼ç¹ï¼\n\n * é«æ§è½ - å¾çéåæ¯å¾æ°æ®ç»ææå·æçç¬ç¹ç®æ³ï¼å³ä»ä¸ä¸ªèç¹å¼å§ï¼æ ¹æ®å¶è¿æ¥çå³ç³»ï¼å¯ä»¥å¿«éåæ¹ä¾¿å°æ¾åºå®çé»è¿èç¹ãè¿ç§æ¥æ¾æ°æ®çæ¹æ³å¹¶ä¸åæ°æ®éçå¤§å°æå½±åï¼å ä¸ºé»è¿æ¥è¯¢å§ç»æ¥æ¾çæ¯æéçå±é¨æ°æ®ï¼ä¸ä¼å¯¹æ´ä¸ªæ°æ®åºè¿è¡æç´¢\n * è®¾è®¡ççµæ´»æ§ - æ°æ®ç»æçèªç¶ä¼¸å±ç¹æ§åå¶éç»æåçæ°æ®æ ¼å¼ï¼è®©å¾æ°æ®åºè®¾è®¡å¯ä»¥å·æå¾å¤§çä¼¸ç¼©æ§åçµæ´»æ§ãå ä¸ºéçéæ±çååèå¢å çèç¹ãå³ç³»åå¶å±æ§å¹¶ä¸ä¼å½±åå°åæ¥æ°æ®çæ­£å¸¸ä½¿ç¨\n * å¼åçææ·æ§ - ç´è§æäºçæ°æ®æ¨¡åï¼ä»éæ±çè®¨è®ºå¼å§ï¼å°ç¨åºå¼ååå®ç°ï¼ä»¥åæç»ä¿å­å¨æ°æ®åºä¸­çæ ·å­ï¼å®çæ¨¡æ ·ä¼¼ä¹æ²¡æä»ä¹ååï¼çè³å¯ä»¥è¯´æ¬æ¥å°±æ¯ä¸æ¨¡ä¸æ ·ç\n * å®å¨æ¯æ ACID - ä¸åå«ç NoSQL æ°æ®åº Neo4j è¿å·æå®å¨äºå¡ç®¡çç¹æ§ï¼å®å¨æ¯æ ACID äºå¡ç®¡ç\n\nç¼ºç¹å¦ä¸ï¼\n\n * å­å¨æ¯æèç¹ï¼å³ç³»åå±æ§çæ°éçéå¶ã\n * ä¸æ¯ææåã\n\n\n# å¾æ°æ®åºåºæ¯\n\néç¨åºæ¯å¦ä¸ï¼\n\n * å³ç³»æ§å¼ºçæ°æ®ä¸­ï¼å¦ç¤¾äº¤ç½ç»\n * æ¨èå¼æãå¦ææä»¬å°æ°æ®ä»¥å¾çå½¢å¼è¡¨ç°ï¼é£ä¹å°ä¼éå¸¸æçäºæ¨èçå¶å®\n\nä¸éç¨åºæ¯å¦ä¸ï¼\n\n * è®°å½å¤§éåºäºäºä»¶çæ°æ®ï¼ä¾å¦æ¥å¿æ¡ç®æä¼ æå¨æ°æ®ï¼\n * å¯¹å¤§è§æ¨¡åå¸å¼æ°æ®è¿è¡å¤ç\n * ä¿å­å¨å³ç³»åæ°æ®åºä¸­çç»æåæ°æ®\n * äºè¿å¶æ°æ®å­å¨\n\n\n# ä¸ãæ»ç»\n\nå³ç³»åæ°æ®åºå NoSQL æ°æ®åºçéåï¼å¾å¾éè¦èèå ä¸ªææ ï¼\n\n * æ°æ®é\n * å¹¶åé\n * å®æ¶æ§\n * ä¸è´æ§è¦æ±\n * è¯»ååå¸åç±»å\n * å®å¨æ§\n * è¿ç»´ææ¬\n\nå¸¸è§è½¯ä»¶ç³»ç»æ°æ®åºéååèå¦ä¸ï¼\n\n * ä¸­åå°ç®¡çåç³»ç» - å¦è¿è¥ç³»ç»ï¼æ°æ®éå°ï¼å¹¶åéå°ï¼é¦éå³ç³»åæ°æ®åºã\n * å¤§æµéç³»ç» - å¦çµåååé¡µï¼åå°èèéå³ç³»åæ°æ®åºï¼åå°èèéåå­åæ°æ®åºã\n * æ¥å¿åç³»ç» - åå§æ°æ®èèéåå¼æ°æ®åºï¼æ¥å¿æç´¢èèéæç´¢å¼æã\n * æç´¢åç³»ç» - ä¾å¦ç«åæç´¢ï¼ééç¨æç´¢ï¼å¦ååæç´¢ï¼åå°èèéå³ç³»åæ°æ®åºï¼åå°èèéæç´¢å¼æã\n * äºå¡åç³»ç» - å¦åºå­ï¼äº¤æï¼è®°è´¦ï¼èèéå³ç³»åæ°æ®åº+K-V æ°æ®åºï¼ä½ä¸ºç¼å­ï¼+åå¸å¼äºå¡ã\n * ç¦»çº¿è®¡ç® - å¦å¤§éæ°æ®åæï¼èèéåå¼æ°æ®åºæå³ç³»åæ°æ®ã\n * å®æ¶è®¡ç® - å¦å®æ¶çæ§ï¼å¯ä»¥èèéåå­åæ°æ®åºæèåå¼æ°æ®åºã\n\nè®¾è®¡å®è·µä¸­ï¼è¦åºäºéæ±ãä¸å¡é©±å¨æ¶æï¼æ è®ºéç¨ RDB/NoSQL/DRDB,ä¸å®æ¯ä»¥éæ±ä¸ºå¯¼åï¼æç»æ°æ®å­å¨æ¹æ¡å¿ç¶æ¯åç§æè¡¡çç»¼åæ§è®¾è®¡\n\n\n# åèèµæ\n\n * NoSQL è¿æ¯ SQL ï¼è¿ä¸ç¯è®²æ¸æ¥',normalizedContent:'# nosql ææ¯éå\n\n\n\n\n# ä¸ãnosql ç®ä»\n\nä¼ ç»çå³ç³»åæ°æ®åºå­å¨ä»¥ä¸ç¼ºç¹ï¼\n\n * å¤§æ°æ®åºæ¯ä¸ i/o è¾é« - å ä¸ºæ°æ®æ¯æè¡å­å¨ï¼å³ä½¿åªéå¯¹å¶ä¸­æä¸åè¿è¡è¿ç®ï¼å³ç³»åæ°æ®åºä¹ä¼å°æ´è¡æ°æ®ä»å­å¨è®¾å¤ä¸­è¯»å¥åå­ï¼å¯¼è´ i/o è¾é«ã\n * å­å¨çæ¯è¡è®°å½ï¼æ æ³å­å¨æ°æ®ç»æã\n * è¡¨ç»æ schema æ©å±ä¸æ¹ä¾¿ - å¦è¦éè¦ä¿®æ¹è¡¨ç»æï¼éè¦æ§è¡æ§è¡ ddl(data definition language)ï¼è¯­å¥ä¿®æ¹ï¼ä¿®æ¹æé´ä¼å¯¼è´éè¡¨ï¼é¨åæå¡ä¸å¯ç¨ã\n * å¨ææç´¢åè½è¾å¼± - å³ç³»åæ°æ®åºä¸åªè½å¤è¿è¡å­å­ç¬¦ä¸²çå¹éæ¥è¯¢ï¼å½è¡¨çæ°æ®éæ¸åå¤§çæ¶åï¼like æ¥è¯¢çå¹éä¼éå¸¸æ¢ï¼å³ä½¿å¨æç´¢å¼çæåµä¸ãåµä¸å³ç³»åæ°æ®åºä¹ä¸åºè¯¥å¯¹ææ¬å­æ®µè¿è¡ç´¢å¼ã\n * å­å¨åå¤çå¤æå³ç³»åæ°æ®åè½è¾å¼± - è®¸å¤åºç¨ç¨åºéè¦äºè§£åå¯¼èªé«åº¦è¿æ¥æ°æ®ä¹é´çå³ç³»ï¼æè½å¯ç¨ç¤¾äº¤åºç¨ç¨åºãæ¨èå¼æãæ¬ºè¯æ£æµãç¥è¯å¾è°±ãçå½ç§å­¦å it/ç½ç»ç­ç¨ä¾ãç¶èä¼ ç»çå³ç³»æ°æ®åºå¹¶ä¸åäºå¤çæ°æ®ç¹ä¹é´çå³ç³»ãå®ä»¬çè¡¨æ ¼æ°æ®æ¨¡ååä¸¥æ ¼çæ¨¡å¼ä½¿å®ä»¬å¾é¾æ·»å æ°çæä¸åç§ç±»çå³èä¿¡æ¯ã\n\néçå¤§æ°æ®æ¶ä»£çå°æ¥ï¼è¶æ¥è¶å¤çç½ç«ãåºç¨ç³»ç»éè¦æ¯ææµ·éæ°æ®å­å¨ï¼é«å¹¶åè¯·æ±ãé«å¯ç¨ãé«å¯æ©å±æ§ç­ç¹æ§è¦æ±ãä¼ ç»çå³ç³»åæ°æ®åºå¨åºä»è¿äºè°æ´å·²ç»æ¾å¾åä¸ä»å¿ï¼æ´é²äºè®¸å¤è½ä»¥åæçé®é¢ãç±æ­¤ï¼åç§åæ ·ç nosqlï¼not only sqlï¼æ°æ®åºä½ä¸ºä¼ ç»å³ç³»åæ°æ®çä¸ä¸ªæåè¡¥åå¾å°è¿çåå±ã\n\n\n\nnosqlï¼æ³æéå³ç³»åçæ°æ®åºï¼å¯ä»¥çè§£ä¸º sql çä¸ä¸ªæåè¡¥åã\n\nå¨ nosql è®¸å¤æ¹é¢æ§è½å¤§å¤§ä¼äºéå³ç³»åæ°æ®åºçåæ¶ï¼å¾å¾ä¹ä¼´éä¸äºç¹æ§çç¼ºå¤±ï¼æ¯è¾å¸¸è§çï¼æ¯äºå¡åºäºå¡åè½çç¼ºå¤±ã æ°æ®åºäºå¡æ­£ç¡®æ§è¡çåä¸ªåºæ¬è¦ç´ ï¼acid å¦ä¸ï¼\n\n    åç§°                æè¿°\na   atomicity (åå­æ§)   ä¸ä¸ªäºå¡ä¸­çæææä½ï¼è¦ä¹å¨é¨å®æï¼è¦ä¹å¨é¨ä¸å®æï¼ä¸ä¼å¨ä¸­é´æä¸ªç¯èç»æã\n                      äºå¡å¨æ§è¡è¿ç¨ä¸­åçéè¯¯ï¼ä¼è¢«åæ»å°äºå¡å¼å§åçç¶æï¼å°±åè¿ä¸ªäºå¡ä»æ¥æ²¡ææ§è¡è¿ä¸æ ·ã\nc   consistency ä¸è´æ§   å¨äºå¡å¼å§ä¹ååäºå¡ç»æä»¥åï¼æ°æ®çæ°æ®çä¸è´æ§çº¦ææ²¡æè¢«ç ´åã\ni   isolation éç¦»æ§     æ°æ®åºåè®¸å¤ä¸ªå¹¶åäºå¡åæ¶å¯¹æ°æ®è¿è¡è¯»ååä¿®æ¹çè½åãéç¦»æ§å¯ä»¥é²æ­¢å¤ä¸ªäºå¡å¹¶åæ§è¡æ¶ç±äºäº¤åæ§è¡èå¯¼è´æ°æ®çä¸ä¸è´ã\nd   durability æä¹æ§    äºå¡å¤çç»æåï¼å¯¹æ°æ®çä¿®æ¹å°±æ¯æ°¸ä¹çï¼å³ä¾¿ç³»ç»æéä¹ä¸ä¼ä¸¢å¤±ã\n\nä¸é¢ä»ç» 5 å¤§ç±» nosql æ°æ®éå¯¹ä¼ ç»å³ç³»åæ°æ®åºçç¼ºç¹æä¾çè§£å³æ¹æ¡ï¼\n\n\n# äºãåå¼æ°æ®åº\n\nåå¼æ°æ®åºæ¯ä»¥åç¸å³å­å¨æ¶æè¿è¡æ°æ®å­å¨çæ°æ®åºï¼ä¸»è¦éåäºæ¹éæ°æ®å¤çåå³æ¶æ¥è¯¢ã\n\nç¸å¯¹åºçæ¯è¡å¼æ°æ®åºï¼æ°æ®ä»¥è¡ç¸å³çå­å¨ä½ç³»æ¶æè¿è¡ç©ºé´åéï¼ä¸»è¦éåäºå°æ¹éçæ°æ®å¤çï¼å¸¸ç¨äºèæºäºå¡åæ°æ®å¤çã\n\nåºäºåå¼æ°æ®åºçååå­å¨ç¹æ§ï¼å¯ä»¥è§£å³æäºç¹å®åºæ¯ä¸å³ç³»åæ°æ®åº i/o è¾é«çé®é¢ã\n\n\n# åå¼æ°æ®åºåç\n\nä¼ ç»å³ç³»åæ°æ®åºæ¯æç§è¡æ¥å­å¨æ°æ®åºï¼ç§°ä¸ºâè¡å¼æ°æ®åºâï¼èåå¼æ°æ®åºæ¯æç§åæ¥å­å¨æ°æ®ã\n\nå°è¡¨æ¾å¥å­å¨ç³»ç»ä¸­æä¸¤ç§æ¹æ³ï¼èæä»¬ç»å¤§é¨åæ¯éç¨è¡å­å¨çã è¡å­å¨æ³æ¯å°åè¡æ¾å¥è¿ç»­çç©çä½ç½®ï¼è¿å¾åä¼ ç»çè®°å½åæä»¶ç³»ç»ã åå­å¨æ³æ¯å°æ°æ®æç§åå­å¨å°æ°æ®åºä¸­ï¼ä¸è¡å­å¨ç±»ä¼¼ï¼ä¸å¾æ¯ä¸¤ç§å­å¨æ¹æ³çå¾å½¢åè§£éï¼\n\n\n\n\n# åå¼æ°æ®åºäº§å\n\n * hbase\n   \n   \n   \n   hbase æ¯ä¸ä¸ªå¼æºçéå³ç³»ååå¸å¼æ°æ®åºï¼nosqlï¼ï¼å®åèäºè°·æ­ç bigtable å»ºæ¨¡ï¼å®ç°çç¼ç¨è¯­è¨ä¸º javaãå®æ¯ apache è½¯ä»¶åºéä¼ç hadoop é¡¹ç®çä¸é¨åï¼è¿è¡äº hdfs æä»¶ç³»ç»ä¹ä¸ï¼ä¸º hadoop æä¾ç±»ä¼¼äº bigtable è§æ¨¡çæå¡ãå æ­¤ï¼å®å¯ä»¥å®¹éå°å­å¨æµ·éç¨ççæ°æ®ã\n\n * bigtable\n   \n   \n   \n   bigtable æ¯ä¸ç§åç¼©çãé«æ§è½çãé«å¯æ©å±æ§çï¼åºäº google æä»¶ç³»ç»ï¼google file systemï¼gfsï¼çæ°æ®å­å¨ç³»ç»ï¼ç¨äºå­å¨å¤§è§æ¨¡ç»æåæ°æ®ï¼éç¨äºäºç«¯è®¡ç®ã\n\n\n# åå¼æ°æ®åºç¹æ§\n\nä¼ç¹å¦ä¸ï¼\n\n * é«æçå¨å­ç©ºé´å©ç¨ç\n\nåå¼æ°æ®åºç±äºå¶éå¯¹ä¸ååçæ°æ®ç¹å¾èåæçä¸åç®æ³ï¼ä½¿å¶å¾å¾ææ¯è¡å¼æ°æ®åºé«çå¤çåç¼©çï¼æ®éçè¡å¼æ°æ®åºä¸è¬åç¼©çå¨ 3ï¼1 å° 5ï¼1 å·¦å³ï¼èåå¼æ°æ®åºçåç¼©çä¸è¬å¨ 8ï¼1 å° 30ï¼1 å·¦å³ã æ¯è¾å¸¸è§çï¼éè¿å­å¸è¡¨åç¼©æ°æ®ï¼ ä¸é¢ä¸­ææ¯é£å¼ è¡¨æ¬æ¥çæ ·å­ãç»è¿å­å¸è¡¨è¿è¡æ°æ®åç¼©åï¼è¡¨ä¸­çå­ç¬¦ä¸²æé½åææ°å­äºãæ­£å ä¸ºæ¯ä¸ªå­ç¬¦ä¸²å¨å­å¸è¡¨éåªåºç°ä¸æ¬¡äºï¼æä»¥è¾¾å°äºåç¼©çç®ç(æç¹åè§èååéè§èå normalize å denomalize)\n\n\n\n * æ¥è¯¢æçé«\n\nè¯»åå¤æ¡æ°æ®çåä¸åæçé«ï¼å ä¸ºè¿äºåé½æ¯å­å¨å¨ä¸èµ·çï¼ä¸æ¬¡ç£çæä½å¯ä»¥æ°æ®çæå®åå¨é¨è¯»åå°åå­ä¸­ã ä¸å¾éè¿ä¸æ¡æ¥è¯¢çæ§è¡è¿ç¨è¯´æåå¼å­å¨(ä»¥åæ°æ®åç¼©)çä¼ç¹\n\n\n\næ§è¡æ­¥éª¤å¦ä¸ï¼\ni. å»å­å¸è¡¨éæ¾å°å­ç¬¦ä¸²å¯¹åºæ°å­(åªè¿è¡ä¸æ¬¡å­ç¬¦ä¸²æ¯è¾)ã\nii. ç¨æ°å­å»åè¡¨éå¹éï¼å¹éä¸çä½ç½®è®¾ä¸º1ã\niii. æä¸ååçå¹éç»æè¿è¡ä½è¿ç®å¾å°ç¬¦åæææ¡ä»¶çè®°å½ä¸æ ã\niv. ä½¿ç¨è¿ä¸ªä¸æ ç»è£åºæç»çç»æéã\nå¤å¶ä»£ç \n\n\n * éååèåæä½\n * éåå¤§éçæ°æ®èä¸æ¯å°æ°æ®\n\nç¼ºç¹å¦ä¸ï¼\n\n * ä¸éåæ«æå°éæ°æ®\n * ä¸éåéæºçæ´æ°\n * ä¸éååå«æå é¤åæ´æ°çå®æ¶æä½\n * åè¡çæ°æ®æ¯ acid çï¼å¤è¡çäºå¡æ¶ï¼ä¸æ¯æäºå¡çæ­£å¸¸åæ»ï¼æ¯æ i(isolation)éç¦»æ§(äºå¡ä¸²è¡æäº¤)ï¼d(durability)æä¹æ§ï¼ä¸è½ä¿è¯ a(atomicity)åå­æ§ï¼ c(consistency)ä¸è´æ§\n\n\n# åå¼æ°æ®åºä½¿ç¨åºæ¯\n\nä»¥ hbase ä¸ºä¾è¯´æï¼\n\n * å¤§æ°æ®é ï¼100s tb çº§æ°æ®ï¼ ä¸æå¿«ééæºè®¿é®çéæ±ãå¢é¿éæ æ³é¢ä¼°çåºç¨ï¼éè¦è¿è¡ä¼éçæ°æ®æ©å±ç hbase æ¯æå¨çº¿æ©å±ï¼å³ä½¿å¨ä¸æ®µæ¶é´åæ°æ®éåäºå·å¼å¢é¿ï¼ä¹å¯ä»¥éè¿ hbase æ¨ªåæ©å±æ¥æ»¡è¶³åè½ã\n * åå¯éååºç¨ï¼æ¯å¤©åå¥éå·¨å¤§ï¼èç¸å¯¹è¯»æ°éè¾å°çåºç¨ æ¯å¦ im çåå²æ¶æ¯ï¼æ¸¸æçæ¥å¿ç­ç­\n * ä¸éè¦å¤ææ¥è¯¢æ¡ä»¶æ¥æ¥è¯¢æ°æ®çåºç¨ hbase åªæ¯æåºäº rowkey çæ¥è¯¢ï¼å¯¹äº hbase æ¥è¯´ï¼åæ¡è®°å½æèå°èå´çæ¥è¯¢æ¯å¯ä»¥æ¥åçï¼å¤§èå´çæ¥è¯¢ç±äºåå¸å¼çåå ï¼å¯è½å¨æ§è½ä¸æç¹å½±åï¼hbase ä¸éç¨äºæ joinï¼å¤çº§ç´¢å¼ï¼è¡¨å³ç³»å¤æçæ°æ®æ¨¡åã\n * å¯¹æ§è½åå¯é æ§è¦æ±éå¸¸é«çåºç¨ï¼ç±äº hbase æ¬èº«æ²¡æåç¹æéï¼å¯ç¨æ§éå¸¸é«ã\n * å­å¨ç»æåååç»æåçæ°æ®ã\n\n\n# ä¸ãk-v æ°æ®åº\n\nk-v æ°æ®åºæçæ¯ä½¿ç¨é®å¼(key-value)å­å¨çæ°æ®åºï¼å¶æ°æ®æç§é®å¼å¯¹çå½¢å¼è¿è¡ç»ç»ãç´¢å¼åå­å¨ã\n\nkv å­å¨éå¸¸éåå­å¨ä¸æ¶åè¿å¤æ°æ®å³ç³»ä¸å¡å³ç³»çæ°æ®ï¼åæ¶è½ææåå°è¯»åç£ççæ¬¡æ°ï¼æ¯ sql æ°æ®åºå­å¨æ¥ææ´å¥½çè¯»åæ§è½ï¼è½å¤è§£å³å³ç³»åæ°æ®åºæ æ³å­å¨æ°æ®ç»æçé®é¢ã\n\n\n# k-v æ°æ®åºäº§å\n\n * redis\n   \n   \n   \n   redis æ¯ä¸ä¸ªä½¿ç¨ ansi c ç¼åçå¼æºãæ¯æç½ç»ãåºäºåå­ãå¯éæä¹æ§çé®å¼å¯¹å­å¨æ°æ®åºãä» 2015 å¹´ 6 æå¼å§ï¼redis çå¼åç± redis labs èµå©ï¼è 2013 å¹´ 5 æè³ 2015 å¹´ 6 ææé´ï¼å¶å¼åç± pivotal èµå©ãå¨ 2013 å¹´ 5 æä¹åï¼å¶å¼åç± vmware èµå©ãæ ¹æ®æåº¦æè¡ç½ç« db-engines.com çæ°æ®æ¾ç¤ºï¼redis æ¯ææµè¡çé®å¼å¯¹å­å¨æ°æ®åºã\n\n * cassandra\n   \n   \n   \n   apache cassandraï¼ç¤¾åºåä¸è¬ç®ç§°ä¸º c*ï¼æ¯ä¸å¥å¼æºåå¸å¼ nosql æ°æ®åºç³»ç»ãå®æåç± facebook å¼åï¼ç¨äºå¨å­æ¶ä»¶ç®±ç­ç®åæ ¼å¼æ°æ®ï¼é google bigtable çæ°æ®æ¨¡åä¸ amazon dynamo çå®å¨åå¸å¼æ¶æäºä¸èº«ãfacebook äº 2008 å° cassandra å¼æºï¼æ­¤åï¼ç±äº cassandra è¯å¥½çå¯æ©å±æ§åæ§è½ï¼è¢« apple, comcast,instagram, spotify, ebay, rackspace, netflix ç­ç¥åç½ç«æéç¨ï¼æä¸ºäºä¸ç§æµè¡çåå¸å¼ç»æåæ°æ®å­å¨æ¹æ¡ã\n\n * leveldb\n   \n   \n   \n   leveldb æ¯ä¸ä¸ªç± google å¬å¸æç åçé®ï¼å¼å¯¹ï¼key/value pairï¼åµå¥å¼æ°æ®åºç®¡çç³»ç»ç¼ç¨åºï¼ ä»¥å¼æºç bsd è®¸å¯è¯åå¸ã\n\n\n# k-v æ°æ®åºç¹æ§\n\nä»¥ redis ä¸ºä¾ï¼\n\nä¼ç¹å¦ä¸ï¼\n\n * æ§è½æé« - redis è½æ¯æè¶è¿ 10w ç tpsã\n * ä¸°å¯çæ°æ®ç±»å - redis æ¯æåæ¬ stringï¼hashï¼listï¼setï¼sorted setï¼bitmap å hyperloglogã\n * ä¸°å¯çç¹æ§ - redis è¿æ¯æ publish/subscribeãéç¥ãkey è¿æç­ç­ç¹æ§ã\n\nç¼ºç¹å¦ä¸ï¼ éå¯¹ acidï¼redis äºå¡ä¸è½æ¯æåå­æ§åæä¹æ§(a å d)ï¼åªæ¯æéç¦»æ§åä¸è´æ§(i å c) ç¹å«è¯´æä¸ä¸ï¼è¿éæè¯´çæ æ³ä¿è¯åå­æ§ï¼æ¯éå¯¹ redis çäºå¡æä½ï¼å ä¸ºäºå¡æ¯ä¸æ¯æåæ»ï¼roll backï¼ï¼èå ä¸º redis çåçº¿ç¨æ¨¡åï¼redis çæ®éæä½æ¯åå­æ§çã\n\nå¤§é¨åä¸å¡ä¸éè¦ä¸¥æ ¼éµå¾ª acid ååï¼ä¾å¦æ¸¸æå®æ¶æè¡æ¦ï¼ç²ä¸å³æ³¨ç­åºæ¯ï¼å³ä½¿é¨åæ°æ®æä¹åå¤±è´¥ï¼å¶å®ä¸å¡å½±åä¹éå¸¸å°ãå æ­¤å¨è®¾è®¡æ¹æ¡æ¶ï¼éè¦æ ¹æ®ä¸å¡ç¹å¾åè¦æ±æ¥åéæ©\n\n\n# k-v æ°æ®åºä½¿ç¨åºæ¯\n\n * éç¨åºæ¯ - å¨å­ç¨æ·ä¿¡æ¯(æ¯å¦ä¼è¯)ãéç½®æä»¶ãåæ°ãè´­ç©è½¦ç­ç­ãè¿äºä¿¡æ¯ä¸è¬é½å idï¼é®ï¼æé©ã\n\n * ä¸éç¨åºæ¯\n   \n   * éè¦éè¿å¼æ¥æ¥è¯¢ï¼èä¸æ¯é®æ¥æ¥è¯¢ãkey-value æ°æ®åºä¸­æ ¹æ¬æ²¡æéè¿å¼æ¥è¯¢çéå¾ã\n   * éè¦å¨å­æ°æ®ä¹é´çå³ç³»ãå¨ key-value æ°æ®åºä¸­ä¸è½éè¿ä¸¤ä¸ªæä»¥ä¸çé®æ¥å³èæ°æ®\n   * éè¦äºå¡çæ¯æãå¨ key-value æ°æ®åºä¸­æéäº§çæ¶ä¸å¯ä»¥è¿è¡åæ»ã\n\n\n# åãææ¡£æ°æ®åº\n\nææ¡£æ°æ®åºï¼ä¹ç§°ä¸ºææ¡£åæ°æ®åºï¼æ¯æ¨å¨å°åç»æåæ°æ®å­å¨ä¸ºææ¡£çä¸ç§æ°æ®åºï¼å®å¯ä»¥è§£å³å³ç³»åæ°æ®åºè¡¨ç»æ schema æ©å±ä¸æ¹ä¾¿çé®é¢ãææ¡£æ°æ®åºéå¸¸ä»¥ json æ xml æ ¼å¼å­å¨æ°æ®ã\n\nç±äºææ¡£æ°æ®åºç no-schema ç¹æ§ï¼å¯ä»¥å­å¨åè¯»åä»»ææ°æ®ãç±äºä½¿ç¨çæ°æ®æ ¼å¼æ¯ json æè xmlï¼æ éå¨ä½¿ç¨åå®ä¹å­æ®µï¼è¯»åä¸ä¸ª json ä¸­ä¸å­å¨çå­æ®µä¹ä¸ä¼å¯¼è´ sql é£æ ·çè¯­æ³éè¯¯ã\n\n\n# ææ¡£æ°æ®åºäº§å\n\n * mongodb\n   \n   \n   \n   mongodbæ¯ä¸ç§é¢åææ¡£çæ°æ®åºç®¡çç³»ç»ï¼ç± c++ æ°åèæï¼ä»¥æ­¤æ¥è§£å³åºç¨ç¨åºå¼åç¤¾åºä¸­çå¤§éç°å®é®é¢ã2007 å¹´ 10 æï¼mongodb ç± 10gen å¢éæåå±ã2009 å¹´ 2 æé¦åº¦æ¨åºã\n\n * couchdb\n   \n   \n   \n   apache couchdb æ¯ä¸ä¸ªå¼æºæ°æ®åºï¼ä¸æ³¨äºæç¨æ§åæä¸º"å®å¨æ¥æ± web çæ°æ®åº"ãå®æ¯ä¸ä¸ªä½¿ç¨ json ä½ä¸ºå­å¨æ ¼å¼ï¼javascript ä½ä¸ºæ¥è¯¢è¯­è¨ï¼mapreduce å http ä½ä¸º api ç nosql æ°æ®åºãå¶ä¸­ä¸ä¸ªæ¾èçåè½å°±æ¯å¤ä¸»å¤å¶ãcouchdb çç¬¬ä¸ä¸ªçæ¬åå¸å¨ 2005 å¹´ï¼å¨ 2008 å¹´æä¸ºäº apache çé¡¹ç®ã\n\n\n# ææ¡£æ°æ®åºç¹æ§\n\nä»¥ mongodb ä¸ºä¾è¿è¡è¯´æ\n\nä¼ç¹å¦ä¸ï¼\n\n * å®¹æå­å¨å¤ææ°æ®ç»æ - json æ¯ä¸ç§å¼ºå¤§çæè¿°è¯­è¨ï¼è½å¤æè¿°å¤æçæ°æ®ç»æã\n * å®¹æåæ´æ°æ®ç»æ - æ éåå³ç³»åæ°æ®åºä¸æ ·åæ§è¡ ddl è¯­å¥ä¿®æ¹è¡¨ç»æï¼ç¨åºä»£ç ç´æ¥è¯»åå³å¯ã\n * å®¹æå¼å®¹åå²æ°æ® - å¯¹äºåå²æ°æ®ï¼å³ä½¿æ²¡ææ°å¢çå­æ®µï¼ä¹ä¸ä¼å¯¼è´éè¯¯ï¼åªä¼è¿åç©ºå¼ï¼æ­¤æ¶ä»£ç å¼å®¹å¤çå³å¯ã\n\nç¼ºç¹å¦ä¸ï¼\n\n * é¨åæ¯æäºå¡\n   * atomicity(åå­æ§) ä»æ¯æåè¡/ææ¡£çº§åå­æ§ï¼ä¸æ¯æå¤è¡ãå¤ææ¡£ãå¤è¯­å¥åå­æ§ã\n   * isolation(éç¦»æ§) éç¦»çº§å«ä»æ¯æå·²æäº¤è¯»ï¼read committedï¼çº§å«ï¼å¯è½å¯¼è´ä¸å¯éå¤è¯»ï¼å¹»è¯»çé®é¢ã\n * ä¸æ¯æå¤ææ¥è¯¢ - ä¾å¦ join æ¥è¯¢ï¼å¦æéè¦ join æ¥è¯¢ï¼éè¦å¤æ¬¡æä½æ°æ®åºã\n\nmongondb è¿æ¯æ¯æå¤ææ¡£äºå¡ç consistency(ä¸è´æ§)å durability(æä¹æ§)\n\nè½ç¶å®æ¹å®£å¸ mongodb å°å¨ 4.0 çæ¬ä¸­æ­£å¼æ¨åºå¤ææ¡£ acid äºå¡æ¯æï¼æåè½å°æåµè¿æå¾è§è¯ã\n\n\n# ææ¡£æ°æ®åºä½¿ç¨åºæ¯\n\néç¨åºæ¯ï¼\n\n * å¤§æ°æ®éï¼ä¸æªæ¥æ°æ®å¢é¿å¾å¿«\n * è¡¨ç»æä¸æç¡®ï¼ä¸å­æ®µå¨ä¸æ­å¢å ï¼ä¾å¦åå®¹ç®¡çç³»ç»ï¼ä¿¡æ¯ç®¡çç³»ç»\n\nä¸éç¨åºæ¯ï¼\n\n * æ¯æäºå¡ - å¨ä¸åçææ¡£ä¸éè¦æ·»å äºå¡ãdocument-oriented æ°æ®åºå¹¶ä¸æ¯æææ¡£é´çäºå¡\n * æ¯æå¤ææ¥è¯¢ - å¤ä¸ªææ¡£ç´æ¥éè¦å¤ææ¥è¯¢ï¼ä¾å¦ join\n\n\n# äºãå¨ææç´¢å¼æ\n\nä¼ ç»å³ç³»åæ°æ®åºä¸»è¦éè¿ç´¢å¼æ¥è¾¾å°å¿«éæ¥è¯¢çç®çï¼å¨å¨ææç´¢çä¸å¡ä¸ï¼ç´¢å¼ä¹æ è½ä¸ºåï¼ä¸»è¦ä½ç°å¨ï¼\n\n * å¨ææç´¢çæ¡ä»¶å¯ä»¥éææåç»åï¼å¦æéè¿ç´¢å¼æ¥æ»¡è¶³ï¼åç´¢å¼çæ°ééå¸¸å¤\n * å¨ææç´¢çæ¨¡ç³å¹éæ¹å¼ï¼ç´¢å¼æ æ³æ»¡è¶³ï¼åªè½ç¨ like æ¥è¯¢ï¼è like æ¥è¯¢æ¯æ´è¡¨æ«æï¼æçéå¸¸ä½\n\nèå¨ææç´¢å¼æçåºç°ï¼æ­£æ¯è§£å³å³ç³»åæ°æ®åºå¨ææç´¢åè½è¾å¼±çé®é¢ã\n\n\n# æç´¢å¼æåç\n\nå¨ææç´¢å¼æçææ¯åçç§°ä¸º åæç´¢å¼ï¼inverted indexï¼ï¼æ¯ä¸ç§ç´¢å¼æ¹æ³ï¼å¶åºæ¬åçæ¯å»ºç«åè¯å°ææ¡£çç´¢å¼ãä¸ä¹ç¸å¯¹æ¯ï¼æ¯âæ­£æç´¢å¼âï¼å¶åºæ¬åçæ¯å»ºç«ææ¡£å°åè¯çç´¢å¼ã\n\nç°å¨æå¦ä¸ææ¡£éåï¼\n\n\n\næ­£æç´¢å¼å¾å°ç´¢å¼å¦ä¸ï¼\n\n\n\nå¯è§ï¼æ­£æç´¢å¼éç¨äºæ ¹æ®ææ¡£åç§°æ¥è¯¢ææ¡£åå®¹\n\nç®åçåæç´¢å¼å¦ä¸ï¼\n\n\n\nå¸¦æåè¯é¢çä¿¡æ¯çåæç´¢å¼å¦ä¸ï¼\n\n\n\nå¯è§ï¼åæç´¢å¼éç¨äºæ ¹æ®å³é®è¯æ¥æ¥è¯¢ææ¡£åå®¹\n\n\n# æç´¢å¼æäº§å\n\n * elasticsearch\n   \n   \n   \n   elasticsearch æ¯ä¸ä¸ªåºäº lucene çæç´¢å¼æãå®æä¾äºä¸ä¸ªåå¸å¼ï¼å¤ç§æ· -è½å¤å¨ææç´¢ä¸åå¨æº http web çé¢åæ æ¶æ json æä»¶ãelasticsearch æ¯ç¨ java å¼åçï¼å¹¶æ ¹æ® apache license çæ¡æ¬¾ä½ä¸ºå¼æºåå¸ãæ ¹æ® db-engines æåï¼elasticsearch æ¯æåæ¬¢è¿çä¼ä¸æç´¢å¼æï¼åé¢æ¯åºäº lucene ç apache solrã\n\n * solr\n   \n   \n   \n   solr æ¯ apache lucene é¡¹ç®çå¼æºä¼ä¸æç´¢å¹³å°ãå¶ä¸»è¦åè½åæ¬å¨ææ£ç´¢ãå½ä¸­æ ç¤ºãåé¢æç´¢ãå¨æèç±»ãæ°æ®åºéæï¼ä»¥åå¯ææ¬ï¼å¦ wordãpdfï¼çå¤çãsolr æ¯é«åº¦å¯æ©å±çï¼å¹¶æä¾äºåå¸å¼æç´¢åç´¢å¼å¤å¶\n\n\n# æç´¢å¼æç¹æ§\n\nä»¥ elasticsearch ä¸ºä¾ï¼ ä¼ç¹å¦ä¸ï¼\n\n * æ¥è¯¢æçé« - å¯¹æµ·éæ°æ®è¿è¡è¿å®æ¶çå¤ç\n * å¯æ©å±æ§ - åºäºéç¾¤ç¯å¢å¯ä»¥æ¹ä¾¿æ¨ªåæ©å±ï¼å¯ä»¥æ¿è½½ pb çº§æ°æ®\n * é«å¯ç¨ - elasticsearch éç¾¤å¼¹æ§-ä»ä»¬å°åç°æ°çæå¤±è´¥çèç¹ï¼éç»åéæ°å¹³è¡¡æ°æ®ï¼ç¡®ä¿æ°æ®æ¯å®å¨çåå¯è®¿é®ç\n\nç¼ºç¹å¦ä¸ï¼\n\n * é¨åæ¯æäºå¡ - åä¸ææ¡£çæ°æ®æ¯ acid çï¼åå«å¤ä¸ªææ¡£çäºå¡æ¶ä¸æ¯æäºå¡çæ­£å¸¸åæ»ï¼æ¯æ i(isolation)éç¦»æ§ï¼åºäºä¹è§éæºå¶çï¼ï¼d(durability)æä¹æ§ï¼ä¸æ¯æ a(atomicity)åå­æ§ï¼c(consistency)ä¸è´æ§\n * å¯¹ç±»ä¼¼æ°æ®åºä¸­éè¿å¤é®çå¤æçå¤è¡¨å³èæä½æ¯æè¾å¼±ã\n * è¯»åæä¸å®å»¶æ¶ï¼åå¥çæ°æ®ï¼æå¿« 1s ä¸­è½è¢«æ£ç´¢å°\n * æ´æ°æ§è½è¾ä½ï¼åºå±å®ç°æ¯åå æ°æ®ï¼åæå¥æ°æ°æ®\n * åå­å ç¨å¤§ï¼å ä¸º lucene å°ç´¢å¼é¨åå è½½å°åå­ä¸­\n\n\n# æç´¢å¼æåºæ¯\n\néç¨åºæ¯å¦ä¸ï¼\n\n * æç´¢å¼æåæ°æ®åæå¼æ - å¨ææ£ç´¢ï¼ç»æåæ£ç´¢ï¼æ°æ®åæ\n * å¯¹æµ·éæ°æ®è¿è¡è¿å®æ¶çå¤ç - å¯ä»¥å°æµ·éæ°æ®åæ£å°å¤å°æå¡å¨ä¸å»å­å¨åæ£ç´¢\n\nä¸éç¨åºæ¯å¦ä¸ï¼\n\n * æ°æ®éè¦é¢ç¹æ´æ°\n * éè¦å¤æå³èæ¥è¯¢\n\n\n# å­ãå¾æ°æ®åº\n\n\n\nå¾å½¢æ°æ®åºåºç¨å¾è®ºå­å¨å®ä½ä¹é´çå³ç³»ä¿¡æ¯ãæå¸¸è§ä¾å­å°±æ¯ç¤¾ä¼ç½ç»ä¸­äººä¸äººä¹é´çå³ç³»ãå³ç³»åæ°æ®åºç¨äºå­å¨âå³ç³»åâæ°æ®çææå¹¶ä¸å¥½ï¼å¶æ¥è¯¢å¤æãç¼æ¢ãè¶åºé¢æï¼èå¾å½¢æ°æ®åºçç¬ç¹è®¾è®¡æ°æ°å¼¥è¡¥äºè¿ä¸ªç¼ºé·ï¼è§£å³å³ç³»åæ°æ®åºå­å¨åå¤çå¤æå³ç³»åæ°æ®åè½è¾å¼±çé®é¢ã\n\n\n# å¾æ°æ®åºäº§å\n\n * neo4j\n   \n   \n   \n   neo4j æ¯ç± neo4jï¼incãå¼åçå¾å½¢æ°æ®åºç®¡çç³»ç»ãç±å¶å¼åäººåæè¿°ä¸ºå·æåçå¾å­å¨åå¤ççç¬¦å acid çäºå¡æ°æ®åºï¼æ ¹æ® db-engines æåï¼ neo4j æ¯ææµè¡çå¾å½¢æ°æ®åºã\n\n * arangodb\n   \n   \n   \n   arangodb æ¯ç± triagens gmbh å¼åçåçå¤æ¨¡åæ°æ®åºç³»ç»ãæ°æ®åºç³»ç»æ¯æä¸ä¸ªéè¦çæ°æ®æ¨¡åï¼é®/å¼ï¼ææ¡£ï¼å¾å½¢ï¼ï¼å¶ä¸­åå«ä¸ä¸ªæ°æ®åºæ ¸å¿åç»ä¸æ¥è¯¢è¯­è¨ aqlï¼arangodb æ¥è¯¢è¯­è¨ï¼ãæ¥è¯¢è¯­è¨æ¯å£°ææ§çï¼åè®¸å¨åä¸ªæ¥è¯¢ä¸­ç»åä¸åçæ°æ®è®¿é®æ¨¡å¼ãarangodb æ¯ä¸ä¸ª nosql æ°æ®åºç³»ç»ï¼ä½ aql å¨å¾å¤æ¹é¢ä¸ sql ç±»ä¼¼ã\n\n * titan\n   \n   \n   \n   titan æ¯ä¸ä¸ªå¯æ©å±çå¾å½¢æ°æ®åºï¼éå¯¹å­å¨åæ¥è¯¢åå«åå¸å¨å¤æºç¾¤éä¸­çæ°ç¾äº¿ä¸ªé¡¶ç¹åè¾¹ç¼çå¾å½¢è¿è¡äºä¼åãtitan æ¯ä¸ä¸ªäºå¡æ§æ°æ®åºï¼å¯ä»¥æ¯ææ°åä¸ªå¹¶åç¨æ·å®æ¶æ§è¡å¤æçå¾å½¢éåã\n\n\n# å¾æ°æ®åºç¹æ§\n\nä»¥ neo4j ä¸ºä¾ï¼\n\nneo4j ä½¿ç¨æ°æ®ç»æä¸­å¾ï¼graphï¼çæ¦å¿µæ¥è¿è¡å»ºæ¨¡ã neo4j ä¸­ä¸¤ä¸ªæåºæ¬çæ¦å¿µæ¯èç¹åè¾¹ãèç¹è¡¨ç¤ºå®ä½ï¼è¾¹åè¡¨ç¤ºå®ä½ä¹é´çå³ç³»ãèç¹åè¾¹é½å¯ä»¥æèªå·±çå±æ§ãä¸åå®ä½éè¿åç§ä¸åçå³ç³»å³èèµ·æ¥ï¼å½¢æå¤æçå¯¹è±¡å¾ã\n\néå¯¹å³ç³»æ°æ®ï¼2 ç§ 2 æ°æ®åºçå­å¨ç»æä¸åï¼\n\n\n\nneo4j ä¸­ï¼å­å¨èç¹æ¶ä½¿ç¨äºâindex-free adjacencyâï¼å³æ¯ä¸ªèç¹é½ææåå¶é»å±èç¹çæéï¼å¯ä»¥è®©æä»¬å¨ o(1)çæ¶é´åæ¾å°é»å±èç¹ãå¦å¤ï¼æç§å®æ¹çè¯´æ³ï¼å¨ neo4j ä¸­è¾¹æ¯æéè¦ç,æ¯âfirst-class entitiesâï¼æä»¥åç¬å­å¨ï¼è¿æå©äºå¨å¾éåçæ¶åæé«éåº¦ï¼ä¹å¯ä»¥å¾æ¹ä¾¿å°ä»¥ä»»ä½æ¹åè¿è¡éå\n\n\n\nå¦ä¸ä¼ç¹ï¼\n\n * é«æ§è½ - å¾çéåæ¯å¾æ°æ®ç»ææå·æçç¬ç¹ç®æ³ï¼å³ä»ä¸ä¸ªèç¹å¼å§ï¼æ ¹æ®å¶è¿æ¥çå³ç³»ï¼å¯ä»¥å¿«éåæ¹ä¾¿å°æ¾åºå®çé»è¿èç¹ãè¿ç§æ¥æ¾æ°æ®çæ¹æ³å¹¶ä¸åæ°æ®éçå¤§å°æå½±åï¼å ä¸ºé»è¿æ¥è¯¢å§ç»æ¥æ¾çæ¯æéçå±é¨æ°æ®ï¼ä¸ä¼å¯¹æ´ä¸ªæ°æ®åºè¿è¡æç´¢\n * è®¾è®¡ççµæ´»æ§ - æ°æ®ç»æçèªç¶ä¼¸å±ç¹æ§åå¶éç»æåçæ°æ®æ ¼å¼ï¼è®©å¾æ°æ®åºè®¾è®¡å¯ä»¥å·æå¾å¤§çä¼¸ç¼©æ§åçµæ´»æ§ãå ä¸ºéçéæ±çååèå¢å çèç¹ãå³ç³»åå¶å±æ§å¹¶ä¸ä¼å½±åå°åæ¥æ°æ®çæ­£å¸¸ä½¿ç¨\n * å¼åçææ·æ§ - ç´è§æäºçæ°æ®æ¨¡åï¼ä»éæ±çè®¨è®ºå¼å§ï¼å°ç¨åºå¼ååå®ç°ï¼ä»¥åæç»ä¿å­å¨æ°æ®åºä¸­çæ ·å­ï¼å®çæ¨¡æ ·ä¼¼ä¹æ²¡æä»ä¹ååï¼çè³å¯ä»¥è¯´æ¬æ¥å°±æ¯ä¸æ¨¡ä¸æ ·ç\n * å®å¨æ¯æ acid - ä¸åå«ç nosql æ°æ®åº neo4j è¿å·æå®å¨äºå¡ç®¡çç¹æ§ï¼å®å¨æ¯æ acid äºå¡ç®¡ç\n\nç¼ºç¹å¦ä¸ï¼\n\n * å­å¨æ¯æèç¹ï¼å³ç³»åå±æ§çæ°éçéå¶ã\n * ä¸æ¯ææåã\n\n\n# å¾æ°æ®åºåºæ¯\n\néç¨åºæ¯å¦ä¸ï¼\n\n * å³ç³»æ§å¼ºçæ°æ®ä¸­ï¼å¦ç¤¾äº¤ç½ç»\n * æ¨èå¼æãå¦ææä»¬å°æ°æ®ä»¥å¾çå½¢å¼è¡¨ç°ï¼é£ä¹å°ä¼éå¸¸æçäºæ¨èçå¶å®\n\nä¸éç¨åºæ¯å¦ä¸ï¼\n\n * è®°å½å¤§éåºäºäºä»¶çæ°æ®ï¼ä¾å¦æ¥å¿æ¡ç®æä¼ æå¨æ°æ®ï¼\n * å¯¹å¤§è§æ¨¡åå¸å¼æ°æ®è¿è¡å¤ç\n * ä¿å­å¨å³ç³»åæ°æ®åºä¸­çç»æåæ°æ®\n * äºè¿å¶æ°æ®å­å¨\n\n\n# ä¸ãæ»ç»\n\nå³ç³»åæ°æ®åºå nosql æ°æ®åºçéåï¼å¾å¾éè¦èèå ä¸ªææ ï¼\n\n * æ°æ®é\n * å¹¶åé\n * å®æ¶æ§\n * ä¸è´æ§è¦æ±\n * è¯»ååå¸åç±»å\n * å®å¨æ§\n * è¿ç»´ææ¬\n\nå¸¸è§è½¯ä»¶ç³»ç»æ°æ®åºéååèå¦ä¸ï¼\n\n * ä¸­åå°ç®¡çåç³»ç» - å¦è¿è¥ç³»ç»ï¼æ°æ®éå°ï¼å¹¶åéå°ï¼é¦éå³ç³»åæ°æ®åºã\n * å¤§æµéç³»ç» - å¦çµåååé¡µï¼åå°èèéå³ç³»åæ°æ®åºï¼åå°èèéåå­åæ°æ®åºã\n * æ¥å¿åç³»ç» - åå§æ°æ®èèéåå¼æ°æ®åºï¼æ¥å¿æç´¢èèéæç´¢å¼æã\n * æç´¢åç³»ç» - ä¾å¦ç«åæç´¢ï¼ééç¨æç´¢ï¼å¦ååæç´¢ï¼åå°èèéå³ç³»åæ°æ®åºï¼åå°èèéæç´¢å¼æã\n * äºå¡åç³»ç» - å¦åºå­ï¼äº¤æï¼è®°è´¦ï¼èèéå³ç³»åæ°æ®åº+k-v æ°æ®åºï¼ä½ä¸ºç¼å­ï¼+åå¸å¼äºå¡ã\n * ç¦»çº¿è®¡ç® - å¦å¤§éæ°æ®åæï¼èèéåå¼æ°æ®åºæå³ç³»åæ°æ®ã\n * å®æ¶è®¡ç® - å¦å®æ¶çæ§ï¼å¯ä»¥èèéåå­åæ°æ®åºæèåå¼æ°æ®åºã\n\nè®¾è®¡å®è·µä¸­ï¼è¦åºäºéæ±ãä¸å¡é©±å¨æ¶æï¼æ è®ºéç¨ rdb/nosql/drdb,ä¸å®æ¯ä»¥éæ±ä¸ºå¯¼åï¼æç»æ°æ®å­å¨æ¹æ¡å¿ç¶æ¯åç§æè¡¡çç»¼åæ§è®¾è®¡\n\n\n# åèèµæ\n\n * nosql è¿æ¯ sql ï¼è¿ä¸ç¯è®²æ¸æ¥',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"æ°æ®ç»æä¸æ°æ®åºç´¢å¼",frontmatter:{title:"æ°æ®ç»æä¸æ°æ®åºç´¢å¼",date:"2022-03-27T23:39:10.000Z",categories:["æ°æ®åº","æ°æ®åºç»¼å"],tags:["æ°æ®åº","ç»¼å","æ°æ®ç»æ","ç´¢å¼"],permalink:"/pages/d7cd88/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/01.%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%BC%E5%90%88/02.%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95.html",relativePath:"12.æ°æ®åº/01.æ°æ®åºç»¼å/02.æ°æ®ç»æä¸æ°æ®åºç´¢å¼.md",key:"v-2f525dc4",path:"/pages/d7cd88/",headers:[{level:2,title:"å¼è¨",slug:"å¼è¨",normalizedTitle:"å¼è¨",charIndex:52},{level:2,title:"æ°ç»åé¾è¡¨",slug:"æ°ç»åé¾è¡¨",normalizedTitle:"æ°ç»åé¾è¡¨",charIndex:660},{level:2,title:"åå¸ç´¢å¼",slug:"åå¸ç´¢å¼",normalizedTitle:"åå¸ç´¢å¼",charIndex:1314},{level:2,title:"B-Tree ç´¢å¼",slug:"b-tree-ç´¢å¼",normalizedTitle:"b-tree ç´¢å¼",charIndex:2193},{level:3,title:"äºåæç´¢æ ",slug:"äºåæç´¢æ ",normalizedTitle:"äºåæç´¢æ ",charIndex:2517},{level:3,title:"B+Tree ç´¢å¼",slug:"b-tree-ç´¢å¼-2",normalizedTitle:"b+tree ç´¢å¼",charIndex:2921},{level:2,title:"LSM æ ",slug:"lsm-æ ",normalizedTitle:"lsm æ ",charIndex:39},{level:2,title:"åæç´¢å¼",slug:"åæç´¢å¼",normalizedTitle:"åæç´¢å¼",charIndex:6740},{level:2,title:"ç´¢å¼çç»´æ¤",slug:"ç´¢å¼çç»´æ¤",normalizedTitle:"ç´¢å¼çç»´æ¤",charIndex:6936},{level:3,title:"åå»ºç´¢å¼",slug:"åå»ºç´¢å¼",normalizedTitle:"åå»ºç´¢å¼",charIndex:6946},{level:3,title:"æ´æ°ç´¢å¼",slug:"æ´æ°ç´¢å¼",normalizedTitle:"æ´æ°ç´¢å¼",charIndex:582},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:7478}],headersStr:"å¼è¨ æ°ç»åé¾è¡¨ åå¸ç´¢å¼ B-Tree ç´¢å¼ äºåæç´¢æ  B+Tree ç´¢å¼ LSM æ  åæç´¢å¼ ç´¢å¼çç»´æ¤ åå»ºç´¢å¼ æ´æ°ç´¢å¼ åèèµæ",content:"# æ°æ®ç»æä¸æ°æ®åºç´¢å¼\n\n> å³é®è¯ï¼é¾è¡¨ãæ°ç»ãæ£åè¡¨ãçº¢é»æ ãB+ æ ãLSM æ ãè·³è¡¨\n\n\n# å¼è¨\n\næ°æ®åºæ¯âæç§ æ°æ®ç»æ æ¥ç»ç»ãå­å¨åç®¡çæ°æ®çä»åºâãæ¯ä¸ä¸ªé¿æå­å¨å¨è®¡ç®æºåçãæç»ç»çãå¯å±äº«çãç»ä¸ç®¡ççå¤§éæ°æ®çéåã\n\nââä¸é¢è¿å¥å®ä¹å¯¹æ°æ®åºçå®ä¹æ¥èªç¾åº¦ç¾ç§ãéè¿è¿ä¸ªå®ä¹ï¼æä»¬ä¹è½ææ¾çåºæ°æ®ç»ææ¯å®ç°æ°æ®åºçåºç³ã\n\nä»æ¬è´¨æ¥çï¼æ°æ®åºåªè´è´£ä¸¤ä»¶äºï¼è¯»æ°æ®ãåæ°æ®ï¼èæ°æ®ç»æç ç©¶çæ¯å¦ä½åçç»ç»æ°æ®ï¼å°½å¯è½æåè¯»ãåæ°æ®çæçï¼è¿æ°å¥½æ¯æ°æ®åºçæ ¸å¿é®é¢ãå æ­¤ï¼æ°æ®ç»æä¸æ°æ®åºè¿ä¸¤ä¸ªé¢åæéå¸¸å¤çäº¤éãå¶ä¸­ï¼æ°æ®åºç´¢å¼æè½ä½ç°äºèçç´§å¯å³èã\n\nç´¢å¼æ¯æ°æ®åºä¸ºäºæé«æ¥æ¾æççä¸ç§æ°æ®ç»æãç´¢å¼åºäºåå§æ°æ®è¡çèæ¥ï¼å®çä¸»è¦ä½ç¨æ¯ç¼©å°æ£ç´¢çæ°æ®èå´ï¼æåæ¥è¯¢æ§è½ãéä¿æ¥è¯´ï¼ç´¢å¼å¨æ°æ®åºä¸­çä½ç¨å°±åæ¯ä¸æ¬ä¹¦çç®å½ç´¢å¼ãç´¢å¼å¯¹äºè¯å¥½çæ§è½éå¸¸å³é®ï¼å¨æ°æ®éå°ä¸è´è½½è¾ä½æ¶ï¼ä¸æ°å½çç´¢å¼å¯¹äºæ§è½çå½±åå¯è½è¿ä¸ææ¾ï¼ä½éçæ°æ®ééæ¸å¢å¤§ï¼æ§è½åä¼æ¥å§ä¸éãå æ­¤ï¼ç´¢å¼ä¼ååºè¯¥æ¯æ¥è¯¢æ§è½ä¼åçæææææ®µã\n\nå¾å¤æ°æ®åºåè®¸åç¬æ·»å åå é¤ç´¢å¼ï¼èä¸å½±åæ°æ®åºçåå®¹ï¼å®åªä¼å½±åæ¥è¯¢æ§è½ãç»´æ¤é¢å¤çç»æå¿å¿ä¼å¼å¥å¼éï¼ç¹å«æ¯å¨æ°æ°æ®åå¥æ¶ãå¯¹äºåå¥ï¼å®å¾é¾è¶è¿ç®åå°è¿½å æä»¶æ¹å¼çæ§è½ï¼å ä¸ºé£å·²ç»æ¯æç®åçåæä½äºãç±äºæ¯æ¬¡åæ°æ®æ¶ï¼éè¦æ´æ°ç´¢å¼ï¼å æ­¤ä»»ä½ç±»åçç´¢å¼éå¸¸é½ä¼éä½åçéåº¦ã\n\næ¬æä»¥ä¸äºå¸¸è§çæ°æ®åºä¸ºä¾ï¼åæå®ä»¬çç´¢å¼éç¨äºä»ä¹æ ·çæ°æ®ç»æï¼æä»ä¹å©å¼ï¼ä¸ºä½å¦æ­¤è®¾è®¡ã\n\n\n# æ°ç»åé¾è¡¨\n\næ°ç»åé¾è¡¨åå«ä»£è¡¨äºè¿ç»­ç©ºé´åä¸è¿ç»­ç©ºé´çå­å¨æ¹å¼ï¼å®ä»¬æ¯çº¿æ§è¡¨ï¼Linear Listï¼çå¸åä»£è¡¨ãå¶ä»ææçæ°æ®ç»æï¼æ¯å¦æ ãéåãäºåæ ãB+ æ ç­ï¼å®éä¸é½æ¯è¿ä¸¤èçç»ååååã\n\næ°ç»ç¨è¿ç»­çåå­ç©ºé´æ¥å­å¨æ°æ®ãæ°ç»æ¯æéæºè®¿é®ï¼æ ¹æ®ä¸æ éæºè®¿é®çæ¶é´å¤æåº¦ä¸º O(1)ãä½è¿å¹¶ä¸ä»£è¡¨æ°ç»çæ¥æ¾æ¶é´å¤æåº¦ä¹æ¯ O(1)ã\n\n * å¯¹äºæ åºæ°ç»ï¼åªè½é¡ºåºæ¥æ¾ï¼å¶æ¶é´å¤æåº¦ä¸º O(n)ã\n * å¯¹äºæåºæ°ç»ï¼å¯ä»¥åºç¨äºåæ¥æ¾æ³ï¼å¶æ¶é´å¤æåº¦ä¸º O(log n)ã\n\nå¨æåºæ°ç»ä¸åºç¨äºåæ¥æ¾æ³å¦æ­¤é«æï¼ä¸ºä»ä¹å ä¹æ²¡ææ°æ®åºç´æ¥ä½¿ç¨æ°ç»ä½ä¸ºç´¢å¼ï¼è¿æ¯å ä¸ºå®çéå¶æ¡ä»¶ï¼æ°æ®æåºââä¸ºäºä¿è¯æ°æ®æåºï¼æ¯æ¬¡æ·»å ãå é¤æ°ç»æ°æ®æ¶ï¼é½å¿é¡»è¦è¿è¡æ°æ®è°æ´ï¼æ¥ä¿è¯å¶æåºï¼è æ°ç»çæå¥/å é¤æä½ï¼æ¶é´å¤æåº¦ä¸º O(n)ãæ­¤å¤ï¼ç±äºæ°ç»ç©ºé´å¤§å°åºå®ï¼æ¯æ¬¡æ©å®¹åªè½éç¨å¤å¶æ°ç»çæ¹å¼ãæ°ç»çè¿äºç¹æ§ï¼å³å®äºå®ä¸éåç¨äºæ°æ®é¢ç¹ååçåºç¨åºæ¯ã\n\n\n\né¾è¡¨ç¨ä¸è¿ç»­çåå­ç©ºé´æ¥å­å¨æ°æ®ï¼å¹¶éè¿ä¸ä¸ªæéæé¡ºåºå°è¿äºç©ºé´ä¸²èµ·æ¥ï¼å½¢æä¸æ¡é¾ã\n\nåºå«äºæ°ç»ï¼é¾è¡¨ä¸­çåç´ ä¸æ¯å­å¨å¨åå­ä¸­è¿ç»­çä¸çåºåï¼é¾è¡¨ä¸­çæ°æ®å­å¨å¨æ¯ä¸ä¸ªç§°ä¹ä¸ºãç»ç¹ãå¤ååºåéï¼å¨æ¯ä¸ä¸ªç»ç¹é¤äºå­å¨æ°æ®ä»¥å¤ï¼è¿ä¿å­äºå°ä¸ä¸ä¸ªèç¹çæéï¼Pointerï¼ãç±äºä¸å¿æé¡ºåºå­å¨ï¼é¾è¡¨çæå¥/å é¤æä½ï¼æ¶é´å¤æåº¦ä¸º O(1)ï¼ä½æ¯ï¼é¾è¡¨åªæ¯æé¡ºåºè®¿é®ï¼å¶ æ¥æ¾æ¶é´å¤æåº¦ä¸º O(n)ãå¶ä½æçæ¥æ¾æ¹å¼ï¼å³å®äºé¾è¡¨ä¸éåä½ä¸ºç´¢å¼ã\n\n\n\n\n# åå¸ç´¢å¼\n\nåå¸è¡¨æ¯ä¸ç§ä»¥é® - å¼ï¼key-valueï¼å¯¹å½¢å¼å­å¨æ°æ®çç»æï¼æä»¬åªè¦è¾å¥å¾æ¥æ¾çå¼å³ keyï¼å°±å¯ä»¥æ¾å°å¶å¯¹åºçå¼å³ Valueã\n\nåå¸è¡¨ ä½¿ç¨ åå¸å½æ° ç»ç»æ°æ®ï¼ä»¥æ¯æå¿«éæå¥åæç´¢çæ°æ®ç»æãåå¸è¡¨çæ¬è´¨æ¯ä¸ä¸ªæ°ç»ï¼å¶æè·¯æ¯ï¼ä½¿ç¨ Hash å½æ°å° Key è½¬æ¢ä¸ºæ°ç»ä¸æ ï¼å©ç¨æ°ç»çéæºè®¿é®ç¹æ§ï¼ä½¿å¾æä»¬è½å¨ O(1) çæ¶é´ä»£ä»·åå®ææ£ç´¢ã\n\n\n\næä¸¤ç§ä¸åç±»åçåå¸è¡¨ï¼åå¸éå å åå¸æ å°ã\n\n * åå¸éå æ¯éåæ°æ®ç»æçå®ç°ä¹ä¸ï¼ç¨äºå­å¨ééå¤å¼ã\n * åå¸æ å° æ¯æ å° æ°æ®ç»æçå®ç°ä¹ä¸ï¼ç¨äºå­å¨é®å¼å¯¹ã\n\nåå¸ç´¢å¼åºäºåå¸è¡¨å®ç°ï¼åªéç¨äºç­å¼æ¥è¯¢ãå¯¹äºæ¯ä¸è¡æ°æ®ï¼åå¸ç´¢å¼é½ä¼å°ææçç´¢å¼åè®¡ç®ä¸ä¸ªåå¸ç ï¼hashcodeï¼ï¼åå¸ç æ¯ä¸ä¸ªè¾å°çå¼ãåå¸ç´¢å¼å°ææçåå¸ç å­å¨å¨ç´¢å¼ä¸­ï¼åæ¶å¨åå¸è¡¨ä¸­ä¿å­æåæ¯ä¸ªæ°æ®è¡çæéã\n\nâ åå¸ç´¢å¼çä¼ç¹ï¼\n\n * å ä¸ºç´¢å¼æ°æ®ç»æç´§åï¼æä»¥æ¥è¯¢éåº¦éå¸¸å¿«ã\n\nâ åå¸ç´¢å¼çç¼ºç¹ï¼\n\n * åå¸ç´¢å¼å¼åå«åå¸å¼åè¡æéï¼èä¸å­å¨å­æ®µå¼ï¼æä»¥ä¸è½ä½¿ç¨ç´¢å¼ä¸­çå¼æ¥é¿åè¯»åè¡ãä¸è¿ï¼è®¿é®åå­ä¸­çè¡çéåº¦å¾å¿«ï¼æä»¥å¤§é¨åæåµä¸è¿ä¸ç¹å¯¹æ§è½å½±åä¸å¤§ã\n * åå¸ç´¢å¼æ°æ®ä¸æ¯æç§ç´¢å¼å¼é¡ºåºå­å¨çï¼æä»¥æ æ³ç¨äºæåºã\n * åå¸ç´¢å¼ä¸æ¯æé¨åç´¢å¼å¹éæ¥æ¾ï¼å ä¸ºåå¸ç´¢å¼æ¶ä½¿ç¨ç´¢å¼åçå¨é¨åå®¹æ¥è¿è¡åå¸è®¡ç®çãå¦ï¼å¨æ°æ®å (A,B) ä¸å»ºç«åå¸ç´¢å¼ï¼å¦ææ¥è¯¢åªææ°æ®å Aï¼æ æ³ä½¿ç¨è¯¥ç´¢å¼ã\n * åå¸ç´¢å¼åªæ¯æç­å¼æ¯è¾æ¥è¯¢ï¼åæ¬ =ãIN()ã<=>ï¼ä¸æ¯æä»»ä½èå´æ¥è¯¢ï¼å¦ WHERE price > 100ã\n * åå¸ç´¢å¼æå¯è½åºç°åå¸å²çª\n   * åºç°åå¸å²çªæ¶ï¼å¿é¡»éåé¾è¡¨ä¸­ææçè¡æéï¼éè¡æ¯è¾ï¼ç´å°æ¾å°ç¬¦åæ¡ä»¶çè¡ã\n   * å¦æåå¸å²çªå¤çè¯ï¼ç»´æ¤ç´¢å¼çä»£ä»·ä¼å¾é«ã\n\n> å ä¸ºç§ç§éå¶ï¼æä»¥åå¸ç´¢å¼åªéç¨äºç¹å®çåºåãèä¸æ¦ä½¿ç¨åå¸ç´¢å¼ï¼åå®å¸¦æ¥çæ§è½æåä¼éå¸¸æ¾èãä¾å¦ï¼Mysql ä¸­ç Memory å­å¨å¼æå°±æ¾ç¤ºçæ¯æåå¸ç´¢å¼ã\n\n\n# B-Tree ç´¢å¼\n\néå¸¸æä»¬æè¯´ç B æ ç´¢å¼æ¯æ B-Tree ç´¢å¼ï¼å®æ¯ç®åå³ç³»åæ°æ®åºä¸­æ¥æ¾æ°æ®æä¸ºå¸¸ç¨åææçç´¢å¼ï¼å¤§å¤æ°å­å¨å¼æé½æ¯æè¿ç§ç´¢å¼ãä½¿ç¨ B-Tree è¿ä¸ªæ¯è¯­ï¼æ¯å ä¸º MySQL å¨ CREATE TABLE æå¶å®è¯­å¥ä¸­ä½¿ç¨äºè¿ä¸ªå³é®å­ï¼ä½å®éä¸ä¸åçå­å¨å¼æå¯è½ä½¿ç¨ä¸åçæ°æ®ç»æï¼æ¯å¦ InnoDB ä½¿ç¨çæ¯ B+Treeç´¢å¼ï¼è MyISAM ä½¿ç¨çæ¯ B-Treeç´¢å¼ã\n\nB-Tree ç´¢å¼ä¸­ç B æ¯æ balanceï¼æä¸ºå¹³è¡¡ãéè¦æ³¨æçæ¯ï¼B-Tree ç´¢å¼å¹¶ä¸è½æ¾å°ä¸ä¸ªç»å®é®å¼çå·ä½è¡ï¼å®æ¾å°çåªæ¯è¢«æ¥æ¾æ°æ®è¡æå¨çé¡µï¼æ¥çæ°æ®åºä¼æé¡µè¯»å¥å°åå­ï¼åå¨åå­ä¸­è¿è¡æ¥æ¾ï¼æåå¾å°è¦æ¥æ¾çæ°æ®ã\n\n\n# äºåæç´¢æ \n\näºåæç´¢æ çç¹ç¹æ¯ï¼æ¯ä¸ªèç¹çå·¦å¿å­å°äºç¶èç¹ï¼ç¶èç¹åå°äºå³å¿å­ãå¶æ¥è¯¢æ¶é´å¤æåº¦æ¯ O(log n)ã\n\nå½ç¶ä¸ºäºç»´æ O(log n) çæ¥è¯¢å¤æåº¦ï¼ä½ å°±éè¦ä¿æè¿æ£µæ æ¯å¹³è¡¡äºåæ ãä¸ºäºåè¿ä¸ªä¿è¯ï¼æ´æ°çæ¶é´å¤æåº¦ä¹æ¯ O(log n)ã\n\néçæ°æ®åºä¸­æ°æ®çå¢å ï¼ç´¢å¼æ¬èº«å¤§å°éä¹å¢å ï¼ä¸å¯è½å¨é¨å­å¨å¨åå­ä¸­ï¼å æ­¤ç´¢å¼å¾å¾ä»¥ç´¢å¼æä»¶çå½¢å¼å­å¨çç£çä¸ãè¿æ ·çè¯ï¼ç´¢å¼æ¥æ¾è¿ç¨ä¸­å°±è¦äº§çç£ç I/O æ¶èï¼ç¸å¯¹äºåå­å­åï¼I/O å­åçæ¶èè¦é«å ä¸ªæ°éçº§ãå¯ä»¥æ³è±¡ä¸ä¸ä¸æ£µå ç¾ä¸èç¹çäºåæ çæ·±åº¦æ¯å¤å°ï¼å¦æå°è¿ä¹å¤§æ·±åº¦çä¸é¢äºåæ æ¾ç£çä¸ï¼æ¯è¯»åä¸ä¸ªèç¹ï¼éè¦ä¸æ¬¡ç£çç I/O è¯»åï¼æ´ä¸ªæ¥æ¾çèæ¶æ¾ç¶æ¯ä¸è½å¤æ¥åçãé£ä¹å¦ä½åå°æ¥æ¾è¿ç¨ä¸­ç I/O å­åæ¬¡æ°ï¼\n\nä¸ç§è¡ä¹ææçè§£å³æ¹æ³æ¯åå°æ çæ·±åº¦ï¼å°äºåæ åä¸º N åæ ï¼å¤è·¯æç´¢æ ï¼ï¼è B+ æ å°±æ¯ä¸ç§å¤è·¯æç´¢æ ã\n\n\n# B+Tree ç´¢å¼\n\nB+ æ ç´¢å¼éç¨äºå¨é®å¼æ¥æ¾ãé®å¼èå´æ¥æ¾åé®åç¼æ¥æ¾ï¼å¶ä¸­é®åç¼æ¥æ¾åªéç¨äºæå·¦åç¼æ¥æ¾ã\n\nçè§£ B+Treeï¼åªéè¦çè§£å¶æéè¦çä¸¤ä¸ªç¹å¾å³å¯ï¼\n\n * ç¬¬ä¸ï¼ææçå³é®å­ï¼å¯ä»¥çè§£ä¸ºæ°æ®ï¼é½å­å¨å¨å¶å­èç¹ï¼éå¶å­èç¹å¹¶ä¸å­å¨çæ­£çæ°æ®ï¼ææè®°å½èç¹é½æ¯æé®å¼å¤§å°é¡ºåºå­æ¾å¨åä¸å±å¶å­èç¹ä¸ã\n * å¶æ¬¡ï¼ææçå¶å­èç¹ç±æéè¿æ¥ãå¦ä¸å¾ä¸ºç®åäºçB+Treeã\n\n\n\næ ¹æ®å¶å­èç¹çåå®¹ï¼ç´¢å¼ç±»ååä¸ºä¸»é®ç´¢å¼åéä¸»é®ç´¢å¼ã\n\n * èç°ç´¢å¼ï¼clusteredï¼ï¼åç§°ä¸ºä¸»é®ç´¢å¼ï¼å¶å¶å­èç¹å­çæ¯æ´è¡æ°æ®ãå ä¸ºæ æ³åæ¶ææ°æ®è¡å­æ¾å¨ä¸¤ä¸ªä¸åçå°æ¹ï¼æä»¥ä¸ä¸ªè¡¨åªè½æä¸ä¸ªèç°ç´¢å¼ãInnoDB çèç°ç´¢å¼å®éæ¯å¨åä¸ä¸ªç»æä¸­ä¿å­äº B æ çç´¢å¼åæ°æ®è¡ã\n * éä¸»é®ç´¢å¼çå¶å­èç¹åå®¹æ¯ä¸»é®çå¼ãå¨ InnoDB éï¼éä¸»é®ç´¢å¼ä¹è¢«ç§°ä¸ºäºçº§ç´¢å¼ï¼secondaryï¼ãæ°æ®å­å¨å¨ä¸ä¸ªä½ç½®ï¼ç´¢å¼å­å¨å¨å¦ä¸ä¸ªä½ç½®ï¼ç´¢å¼ä¸­åå«æåæ°æ®å­å¨ä½ç½®çæéãå¯ä»¥æå¤ä¸ªï¼å°äº 249 ä¸ªã\n\nèç°è¡¨ç¤ºæ°æ®è¡åç¸é»çé®å¼ç´§åå°å­å¨å¨ä¸èµ·ï¼å ä¸ºæ°æ®ç´§åï¼æä»¥è®¿é®å¿«ãå ä¸ºæ æ³åæ¶ææ°æ®è¡å­æ¾å¨ä¸¤ä¸ªä¸åçå°æ¹ï¼æä»¥ä¸ä¸ªè¡¨åªè½æä¸ä¸ªèç°ç´¢å¼ã\n\nèç°ç´¢å¼åéèç°ç´¢å¼çæ¥è¯¢æä»ä¹åºå«\n\n * å¦æè¯­å¥æ¯ select * from T where ID=500ï¼å³èç°ç´¢å¼æ¥è¯¢æ¹å¼ï¼ååªéè¦æç´¢ ID è¿æ£µ B+ æ ï¼\n * å¦æè¯­å¥æ¯ select * from T where k=5ï¼å³éèç°ç´¢å¼æ¥è¯¢æ¹å¼ï¼åéè¦åæç´¢ k ç´¢å¼æ ï¼å¾å° ID çå¼ä¸º 500ï¼åå° ID ç´¢å¼æ æç´¢ä¸æ¬¡ãè¿ä¸ªè¿ç¨ç§°ä¸ºåè¡¨ã\n\nä¹å°±æ¯è¯´ï¼åºäºéèç°ç´¢å¼çæ¥è¯¢éè¦å¤æ«æä¸æ£µç´¢å¼æ ãå æ­¤ï¼æä»¬å¨åºç¨ä¸­åºè¯¥å°½éä½¿ç¨ä¸»é®æ¥è¯¢ã\n\næ¾ç¶ï¼ä¸»é®é¿åº¦è¶å°ï¼éèç°ç´¢å¼çå¶å­èç¹å°±è¶å°ï¼éèç°ç´¢å¼å ç¨çç©ºé´ä¹å°±è¶å°ã\n\nèªå¢ä¸»é®æ¯æèªå¢åä¸å®ä¹çä¸»é®ï¼å¨å»ºè¡¨è¯­å¥ä¸­ä¸è¬æ¯è¿ä¹å®ä¹çï¼ NOT NULL PRIMARY KEY AUTO_INCREMENTãä»æ§è½åå­å¨ç©ºé´æ¹é¢èéï¼èªå¢ä¸»é®å¾å¾æ¯æ´åççéæ©ãææ²¡æä»ä¹åºæ¯éåç¨ä¸å¡å­æ®µç´æ¥åä¸»é®çå¢ï¼è¿æ¯æçãæ¯å¦ï¼æäºä¸å¡çåºæ¯éæ±æ¯è¿æ ·çï¼\n\n * åªæä¸ä¸ªç´¢å¼ï¼\n * è¯¥ç´¢å¼å¿é¡»æ¯å¯ä¸ç´¢å¼ã\n\nç±äºæ²¡æå¶ä»ç´¢å¼ï¼æä»¥ä¹å°±ä¸ç¨èèå¶ä»ç´¢å¼çå¶å­èç¹å¤§å°çé®é¢ãè¿æ¶åæä»¬å°±è¦ä¼åèèä¸ä¸æ®µæå°çâå°½éä½¿ç¨ä¸»é®æ¥è¯¢âååï¼ç´æ¥å°è¿ä¸ªç´¢å¼è®¾ç½®ä¸ºä¸»é®ï¼å¯ä»¥é¿åæ¯æ¬¡æ¥è¯¢éè¦æç´¢ä¸¤æ£µæ ã\n\n----------------------------------------\n\nåå­æ¯åå¯¼ä½åä»¶ãå¯¹äºåå­èè¨ï¼åªè¦ç»åºäºåå­å°åï¼æä»¬å°±å¯ä»¥ç´æ¥è®¿é®è¯¥å°åååºæ°æ®ãè¿ä¸ªè¿ç¨å·æé«æçéæºè®¿é®ç¹æ§ï¼å æ­¤åå­ä¹å«éæºè®¿é®å­å¨å¨ï¼Random Access Memoryï¼å³ RAMï¼ãåå­çè®¿é®éåº¦å¾å¿«ï¼ä½æ¯ä»·æ ¼ç¸å¯¹è¾æè´µï¼å æ­¤ä¸è¬çè®¡ç®æºåå­ç©ºé´é½ç¸å¯¹è¾å°ã\n\nèç£çæ¯æºæ¢°å¨ä»¶ãç£çè®¿é®æ°æ®æ¶ï¼éè¦ç­ç£çççæè½¬å°ç£å¤´ä¸ï¼æè½è¯»åç¸åºçæ°æ®ãå°½ç®¡ç£ççæè½¬éåº¦å¾å¿«ï¼ä½æ¯ååå­çéæºè®¿é®ç¸æ¯ï¼æ§è½å·®è·éå¸¸å¤§ãä¸è¬æ¥è¯´ï¼å¦ææ¯éæºè¯»åï¼ä¼æ 10 ä¸å° 100 ä¸åå·¦å³çå·®è·ãä½å¦ææ¯é¡ºåºè®¿é®å¤§æ¹éæ°æ®çè¯ï¼ç£ççæ§è½ååå­å°±æ¯ä¸ä¸ªæ°éçº§çã\n\nç£ççæå°è¯»ååä½æ¯æåºï¼è¾æ©æçç£çä¸ä¸ªæåºæ¯ 512 å­èãéçç£çææ¯çåå±ï¼ç®åå¸¸è§çç£çæåºæ¯ 4K ä¸ªå­èãæä½ç³»ç»ä¸æ¬¡ä¼è¯»åå¤ä¸ªæåºï¼æä»¥æä½ç³»ç»çæå°è¯»ååä½æ¯åï¼Blockï¼ï¼ä¹å«ä½ç°ï¼Clusterï¼ãå½æä»¬è¦ä»ç£çä¸­è¯»åä¸ä¸ªæ°æ®æ¶ï¼æä½ç³»ç»ä¼ä¸æ¬¡æ§å°æ´ä¸ªåé½è¯»åºæ¥ãå æ­¤ï¼å¯¹äºå¤§æ¹éçé¡ºåºè¯»åæ¥è¯´ï¼ç£ççæçä¼æ¯éæºè¯»åé«è®¸å¤ã\n\nåè®¾æä¸ä¸ªæåºæ°ç»å­å¨å¨ç¡¬çä¸­ï¼å¦æå®è¶³å¤å¤§ï¼é£ä¹å®ä¼å­å¨å¨å¤ä¸ªåä¸­ãå½æä»¬è¦å¯¹è¿ä¸ªæ°ç»ä½¿ç¨äºåæ¥æ¾æ¶ï¼éè¦åæ¾å°ä¸­é´åç´ æå¨çåï¼å°è¿ä¸ªåä»ç£çä¸­è¯»å°åå­éï¼ç¶åå¨åå­ä¸­è¿è¡äºåæ¥æ¾ãå¦æä¸ä¸æ­¥è¦è¯»çåç´ å¨å¶ä»åä¸­ï¼åéè¦åå°ç¸åºåä»ç£çä¸­è¯»å¥åå­ãç´å°æ¥è¯¢ç»æï¼è¿ä¸ªè¿ç¨å¯è½ä¼å¤æ¬¡è®¿é®ç£çãæä»¬å¯ä»¥çå°ï¼è¿æ ·çæ£ç´¢æ§è½éå¸¸ä½ã\n\nç±äºç£çç¸å¯¹äºåå­èè¨è®¿é®éåº¦å®å¨å¤ªæ¢ï¼å æ­¤ï¼å¯¹äºç£çä¸æ°æ®çé«ææ£ç´¢ï¼æä»¬æä¸ä¸ªæå¶éè¦çååï¼å¯¹ç£ççè®¿é®æ¬¡æ°è¦å°½å¯è½çå°ï¼\n\nå°ç´¢å¼åæ°æ®åç¦»å°±æ¯ä¸ç§å¸¸è§çè®¾è®¡æè·¯ãå¨æ°æ®é¢ç¹ååçåºæ¯ä¸­ï¼æåºæ°ç»å¹¶ä¸æ¯ä¸ä¸ªæå¥½çéæ©ï¼äºåæ£ç´¢æ æèåå¸è¡¨å¾å¾æ´ææ®éæ§ãä½æ¯ï¼åå¸è¡¨ç±äºç¼ºä¹èå´æ£ç´¢çè½åï¼å¨ä¸äºåºåä¹ä¸éç¨ãå æ­¤ï¼äºåæ£ç´¢æ è¿ç§æ å½¢ç»ææ¯è®¸å¤å¸¸è§æ£ç´¢ç³»ç»çå®æ½æ¹æ¡ã\n\néçç´¢å¼æ°æ®è¶æ¥è¶å¤§ï¼ç´å°æ æ³å®å¨å è½½å°åå­ä¸­ï¼è¿æ¯éè¦å°ç´¢å¼æ°æ®ä¹å­å¥ç£çä¸­ãB+ æ ç»åºäºå°æ å½¢ç´¢å¼çææèç¹é½å­å¨ç£çä¸çé«ææ£ç´¢æ¹æ¡ãæä½ç³»ç»å¯¹ç£çæ°æ®çè®¿é®æ¯ä»¥åä¸ºåä½çãå æ­¤ï¼å¦ææä»¬æ³å°æ åç´¢å¼çä¸ä¸ªèç¹ä»ç£çä¸­è¯»åºï¼å³ä½¿è¯¥èç¹çæ°æ®éå¾å°ï¼æ¯å¦è¯´åªæå ä¸ªå­èï¼ï¼ä½ç£çä¾ç¶ä¼å°æ´ä¸ªåçæ°æ®å¨é¨è¯»åºæ¥ï¼èä¸æ¯åªè¯»è¿ä¸å°é¨åæ°æ®ï¼è¿ä¼è®©ææè¯»åæçå¾ä½ãB+ æ çä¸ä¸ªå³é®è®¾è®¡ï¼å°±æ¯è®©ä¸ä¸ªèç¹çå¤§å°ç­äºä¸ä¸ªåçå¤§å°ãèç¹åå­å¨çæ°æ®ï¼ä¸æ¯ä¸ä¸ªåç´ ï¼èæ¯ä¸ä¸ªå¯ä»¥è£ m ä¸ªåç´ çæåºæ°ç»ãè¿æ ·ä¸æ¥ï¼æä»¬å°±å¯ä»¥å°ç£çä¸æ¬¡è¯»åçæ°æ®å¨é¨å©ç¨èµ·æ¥ï¼ä½¿å¾è¯»åæçæå¤§åã\n\nB+ æ è¿æå¦ä¸ä¸ªè®¾è®¡ï¼å°±æ¯å°ææçèç¹åä¸ºåé¨èç¹åå¶å­èç¹ãåé¨èç¹ä»å­å¨ key åç»´ææ å½¢ç»æçæéï¼å¹¶ä¸å­å¨ key å¯¹åºçæ°æ®ï¼æ è®ºæ¯å·ä½æ°æ®è¿æ¯æä»¶ä½ç½®ä¿¡æ¯ï¼ãè¿æ ·åé¨èç¹å°±è½å­å¨æ´å¤çç´¢å¼æ°æ®ï¼æä»¬ä¹å°±å¯ä»¥ä½¿ç¨æå°çåé¨èç¹ï¼å°æææ°æ®ç»ç»èµ·æ¥äºãèå¶å­èç¹ä»å­å¨ key åå¯¹åºæ°æ®ï¼ä¸å­å¨ç»´ææ å½¢ç»æçæéãéè¿è¿æ ·çè®¾è®¡ï¼B+ æ å°±è½åå°èç¹çç©ºé´å©ç¨çæå¤§åãæ­¤å¤ï¼B+ æ è¿å°åä¸å±çææèç¹ä¸²æäºæåºçååé¾è¡¨ï¼è¿æ ·ä¸æ¥ï¼B+ æ å°±åæ¶å·å¤äºè¯å¥½çèå´æ¥è¯¢è½ååçµæ´»è°æ´çè½åäºã\n\nå æ­¤ï¼B+ æ æ¯ä¸æ£µå®å¨å¹³è¡¡ç m é¶å¤åæ ãæè°ç m é¶ï¼æçæ¯æ¯ä¸ªèç¹æå¤æ m ä¸ªå­èç¹ï¼å¹¶ä¸æ¯ä¸ªèç¹éé½å­äºä¸ä¸ªç´§åçå¯åå« m ä¸ªåç´ çæ°ç»ã\n\nå³ä½¿æ¯å¤æç B+ æ ï¼æä»¬å°å®æè§£å¼æ¥ï¼å¶å®ä¹æ¯ç±ç®åçæ°ç»ãé¾è¡¨åæ ç»æçï¼èä¸ B+ æ çæ£ç´¢è¿ç¨å¶å®ä¹æ¯äºåæ¥æ¾ãå æ­¤ï¼å¦æ B+ æ å®å¨å è½½å¨åå­ä¸­çè¯ï¼å®çæ£ç´¢æçå¶å®å¹¶ä¸ä¼æ¯æåºæ°ç»æèäºåæ£ç´¢æ æ´ é«ï¼ä¹è¿æ¯äºåæ¥æ¾ç log(n) çæçãå¹¶ä¸ï¼å®è¿æ¯æ°ç»åäºåæ£ç´¢æ æ´å å¤æï¼è¿ä¼å¸¦æ¥é¢å¤çå¼éã\n\nå¦å¤ï¼è¿ä¸èè¿æä¸ä¸ªå¾éè¦çè®¾è®¡ææ³éè¦ä½ ææ¡ï¼é£å°±æ¯å°ç´¢å¼åæ°æ®åç¦»ãéè¿è¿æ ·çæ¹å¼ï¼æä»¬è½å°ç´¢å¼çæ°ç»å¤§å°ä¿æå¨ä¸ä¸ªè¾å°çèå´åï¼è®©å®è½å è½½å¨åå­ä¸­ãå¨è®¸å¤å¤§è§æ¨¡ç³»ç»ä¸­ï¼é½æ¯ä½¿ç¨è¿ä¸ªè®¾è®¡ææ³æ¥ç²¾ç®ç´¢å¼çãèä¸ï¼B+ æ çåé¨èç¹åå¶å­èç¹çåºåï¼å¶å®ä¹æ¯ç´¢å¼åæ°æ®åç¦»çä¸æ¬¡å®è·µã\n\nMySQL ä¸­ç B+ æ å®ç°å¶å®æä¸¤ç§ï¼ä¸ç§æ¯ MyISAM å¼æï¼å¦ä¸ç§æ¯ InnoDB å¼æãå®ä»¬çæ ¸å¿åºå«å°±å¨äºï¼æ°æ®åç´¢å¼æ¯å¦æ¯åç¦»çã\n\nå¨ MyISAM å¼æä¸­ï¼B+ æ çå¶å­èç¹ä»å­å¨äºæ°æ®çä½ç½®æéï¼è¿æ¯ä¸ç§ç´¢å¼åæ°æ®åç¦»çè®¾è®¡æ¹æ¡ï¼å«ä½éèéç´¢å¼ãå¦æè¦ä¿è¯ MyISAM çæ°æ®ä¸è´æ§ï¼é£æä»¬éè¦å¨è¡¨çº§å«ä¸è¿è¡å éå¤çã\n\nå¨ InnoDB ä¸­ï¼B+ æ çå¶å­èç¹ç´æ¥å­å¨äºå·ä½æ°æ®ï¼è¿æ¯ä¸ç§ç´¢å¼åæ°æ®ä¸ä½çæ¹æ¡ãå«ä½èéç´¢å¼ãç±äºæ°æ®ç´æ¥å°±å­å¨ç´¢å¼çå¶å­èç¹ä¸­ï¼å æ­¤ InnoDB ä¸éè¦ç»å¨è¡¨å éæ¥ä¿è¯ä¸è´æ§ï¼å®åªéè¦æ¯æè¡çº§çéå°±å¯ä»¥äºã\n\n\n# LSM æ \n\nB+ æ çæ°æ®é½å­å¨å¨å¶å­èç¹ä¸­ï¼èå¶å­èç¹ä¸è¬é½å­å¨å¨ç£çä¸­ãå æ­¤ï¼æ¯æ¬¡æå¥çæ°æ°æ®é½éè¦éæºåå¥ç£çï¼èéæºåå¥çæ§è½éå¸¸æ¢ãå¦ææ¯ä¸ä¸ªæ¥å¿ç³»ç»ï¼æ¯ç§éè¦åå¥ä¸åæ¡çè³ä¸ä¸æ¡æ°æ®ï¼è¿æ ·çç£çæä½ä»£ä»·ä¼ä½¿å¾ç³»ç»æ§è½æ¥å§ä¸éï¼çè³æ æ³ä½¿ç¨ã\n\næä½ç³»ç»å¯¹ç£ççè¯»åæ¯ä»¥åä¸ºåä½çï¼æä»¬è½å¦ä»¥åä¸ºåä½åå¥ï¼èä¸æ¯æ¯æ¬¡æå¥ä¸ä¸ªæ°æ®é½è¦éæºåå¥ç£çå¢ï¼è¿æ ·æ¯ä¸æ¯å°±å¯ä»¥å¤§å¹åº¦åå°åå¥æä½äºå¢ï¼è§£å³æ¹æ¡å°±æ¯ï¼LSM æ ï¼Log Structured Merge Treesï¼ã\n\nLSM æ å°±æ¯æ ¹æ®è¿ä¸ªæè·¯è®¾è®¡äºè¿æ ·ä¸ä¸ªæºå¶ï¼å½æ°æ®åå¥æ¶ï¼å»¶è¿åç£çï¼å°æ°æ®åå­æ¾å¨åå­ä¸­çæ éï¼è¿è¡å¸¸è§çå­å¨åæ¥è¯¢ãå½åå­ä¸­çæ æç»­åå¤§è¾¾å°éå¼æ¶ï¼åæ¹éå°ä»¥åä¸ºåä½åå¥ç£ççæ ä¸­ãå æ­¤ï¼LSM æ è³å°éè¦ç±ä¸¤æ£µæ ç»æï¼ä¸æ£µæ¯å­å¨å¨åå­ä¸­è¾å°ç C0 æ ï¼å¦ä¸æ£µæ¯å­å¨å¨ç£çä¸­è¾å¤§ç C1 æ ã\n\nLSM æ å·æä»¥ä¸ 3 ä¸ªç¹ç¹ï¼\n\n 1. å°ç´¢å¼åä¸ºåå­åç£çä¸¤é¨åï¼å¹¶å¨åå­è¾¾å°éå¼æ¶å¯å¨æ åå¹¶ï¼Merge Treesï¼ï¼\n 2. ç¨æ¹éåå¥ä»£æ¿éæºåå¥ï¼å¹¶ä¸ç¨é¢åæ¥å¿ WAL ææ¯ï¼Write AheadLogï¼é¢åæ¥å¿ææ¯ï¼ä¿è¯åå­æ°æ®ï¼å¨ç³»ç»å´©æºåå¯ä»¥è¢«æ¢å¤ï¼\n 3. æ°æ®éåç±»ä¼¼æ¥å¿è¿½å åçæ¹å¼åå¥ï¼Log Structuredï¼ç£çï¼ä»¥é¡ºåºåçæ¹å¼æé«å å¥æçã\n\nLSM æ çè¿äºç¹ç¹ï¼ä½¿å¾å®ç¸å¯¹äº B+ æ ï¼å¨åå¥æ§è½ä¸æå¤§å¹æåãæä»¥ï¼è®¸å¤ NoSQL ç³»ç»é½ä½¿ç¨ LSM æ ä½ä¸ºæ£ç´¢å¼æï¼èä¸è¿å¯¹ LSM æ è¿è¡äºä¼åä»¥æåæ£ç´¢æ§è½ã\n\n\n# åæç´¢å¼\n\nåæç´¢å¼çæ ¸å¿å¶å®å¹¶ä¸å¤æï¼å®çå·ä½å®ç°å¶å®æ¯åå¸è¡¨ï¼åªæ¯å®ä¸æ¯å°ææ¡£ ID æèé¢ç®ä½ä¸º keyï¼èæ¯åè¿æ¥ï¼éè¿å°åå®¹æèå±æ§ä½ä¸º key æ¥å­å¨å¯¹åºçææ¡£åè¡¨ï¼ä½¿å¾æä»¬è½å¨ O(1) çæ¶é´ä»£ä»·åå®ææ¥è¯¢ã\n\nå°½ç®¡åçå¹¶ä¸å¤æï¼ä½æ¯åæç´¢å¼æ¯è®¸å¤æ£ç´¢å¼æçæ ¸å¿ãæ¯å¦è¯´ï¼æ°æ®åºçå¨æç´¢å¼åè½ãæç´¢å¼æçç´¢å¼ãå¹¿åå¼æåæ¨èå¼æï¼é½ä½¿ç¨äºåæç´¢å¼ææ¯æ¥å®ç°æ£ç´¢åè½ã\n\n\n# ç´¢å¼çç»´æ¤\n\n\n# åå»ºç´¢å¼\n\n * æ°æ®åç¼©ï¼ä¸ä¸ªæ¯å°½å¯è½å°å°æ°æ®å è½½å°åå­ä¸­ï¼å ä¸ºåå­çæ£ç´¢æçå¤§å¤§é«äºç£çãé£ä¸ºäºå°æ°æ®æ´å¤å°å è½½å°åå­ä¸­ï¼ç´¢å¼åç¼©æ¯ä¸ä¸ªéè¦çç ç©¶æ¹åã\n * åæ¯å¤çï¼å¦ä¸ä¸ªæ¯å°å¤§æ°æ®éåææå¤ä¸ªå°æ°æ®éåæ¥å¤çãè¿å¶å®å°±æ¯åå¸å¼ç³»ç»çæ ¸å¿ææ³ã\n\n\n# æ´æ°ç´¢å¼\n\nï¼1ï¼Double Bufferï¼åç¼å²ï¼æºå¶\n\nå°±æ¯å¨åå­ä¸­åæ¶ä¿å­ä¸¤ä»½ä¸æ ·çç´¢å¼ï¼ä¸ä¸ªæ¯ç´¢å¼ Aï¼ä¸ä¸ªæ¯ç´¢å¼ Bãä¸¤ä¸ªç´¢å¼ä¿æä¸ä¸ªè¯»ãä¸ä¸ªåï¼å¹¶ä¸æ¥ååæ¢ï¼æç»å®æé«æ§è½çç´¢å¼æ´æ°ã\n\nä¼ç¹ï¼ç®åé«æ\n\nç¼ºç¹ï¼è¾¾å°ä¸å®æ°æ®éçº§åï¼ä¼å¸¦æ¥ç¿»åçåå­å¼éï¼çè³æäºç´¢å¼å­å¨å¨ç£çä¸çæåµä¸ï¼æ´æ¯æ æ³ä½¿ç¨æ­¤æºå¶ã\n\nï¼2ï¼å¨éç´¢å¼åå¢éç´¢å¼\n\nå°æ°æ¥æ¶å°çæ°æ®åç¬å»ºç«ä¸ä¸ªå¯ä»¥å­å¨åå­ä¸­çåæç´¢å¼ï¼ä¹å°±æ¯å¢éç´¢å¼ãå½æ¥è¯¢åççæ¶åï¼æä»¬ä¼åæ¶æ¥è¯¢å¨éç´¢å¼åå¢éç´¢å¼ï¼å°åå¹¶çç»æä½ä¸ºæ»çç»æè¾åºã\n\nå ä¸ºå¢éç´¢å¼ç¸å¯¹å¨éç´¢å¼èè¨ä¼å°å¾å¤ï¼åå­èµæºæ¶èå¨å¯æ¿åèå´ï¼æä»¥æä»¬å¯ä»¥ä½¿ç¨ Double Buffer æºå¶ å¯¹å¢éç´¢å¼è¿è¡ç´¢å¼æ´æ°ãè¿æ ·ä¸æ¥ï¼å¢éç´¢å¼å°±å¯ä»¥åå°æ éè®¿é®ãèå¨éç´¢å¼æ¬èº«å°±æ¯åªè¯»çï¼ä¹ä¸éè¦å éãå æ­¤ï¼æ´ä¸ªæ£ç´¢è¿ç¨é½å¯ä»¥åå°æ éè®¿é®ï¼ä¹å°±æé«äºç³»ç»çæ£ç´¢æçã\n\n\n# åèèµæ\n\n * ãæ°æ®å¯éååºç¨ç³»ç»è®¾è®¡ã\n * æ°æ®ç»æä¸ç®æ³ä¹ç¾\n * æ£ç´¢ææ¯æ ¸å¿ 20 è®²\n * Data Structures for Databases\n * Data Structures and Algorithms for Big Databases",normalizedContent:"# æ°æ®ç»æä¸æ°æ®åºç´¢å¼\n\n> å³é®è¯ï¼é¾è¡¨ãæ°ç»ãæ£åè¡¨ãçº¢é»æ ãb+ æ ãlsm æ ãè·³è¡¨\n\n\n# å¼è¨\n\næ°æ®åºæ¯âæç§ æ°æ®ç»æ æ¥ç»ç»ãå­å¨åç®¡çæ°æ®çä»åºâãæ¯ä¸ä¸ªé¿æå­å¨å¨è®¡ç®æºåçãæç»ç»çãå¯å±äº«çãç»ä¸ç®¡ççå¤§éæ°æ®çéåã\n\nââä¸é¢è¿å¥å®ä¹å¯¹æ°æ®åºçå®ä¹æ¥èªç¾åº¦ç¾ç§ãéè¿è¿ä¸ªå®ä¹ï¼æä»¬ä¹è½ææ¾çåºæ°æ®ç»ææ¯å®ç°æ°æ®åºçåºç³ã\n\nä»æ¬è´¨æ¥çï¼æ°æ®åºåªè´è´£ä¸¤ä»¶äºï¼è¯»æ°æ®ãåæ°æ®ï¼èæ°æ®ç»æç ç©¶çæ¯å¦ä½åçç»ç»æ°æ®ï¼å°½å¯è½æåè¯»ãåæ°æ®çæçï¼è¿æ°å¥½æ¯æ°æ®åºçæ ¸å¿é®é¢ãå æ­¤ï¼æ°æ®ç»æä¸æ°æ®åºè¿ä¸¤ä¸ªé¢åæéå¸¸å¤çäº¤éãå¶ä¸­ï¼æ°æ®åºç´¢å¼æè½ä½ç°äºèçç´§å¯å³èã\n\nç´¢å¼æ¯æ°æ®åºä¸ºäºæé«æ¥æ¾æççä¸ç§æ°æ®ç»æãç´¢å¼åºäºåå§æ°æ®è¡çèæ¥ï¼å®çä¸»è¦ä½ç¨æ¯ç¼©å°æ£ç´¢çæ°æ®èå´ï¼æåæ¥è¯¢æ§è½ãéä¿æ¥è¯´ï¼ç´¢å¼å¨æ°æ®åºä¸­çä½ç¨å°±åæ¯ä¸æ¬ä¹¦çç®å½ç´¢å¼ãç´¢å¼å¯¹äºè¯å¥½çæ§è½éå¸¸å³é®ï¼å¨æ°æ®éå°ä¸è´è½½è¾ä½æ¶ï¼ä¸æ°å½çç´¢å¼å¯¹äºæ§è½çå½±åå¯è½è¿ä¸ææ¾ï¼ä½éçæ°æ®ééæ¸å¢å¤§ï¼æ§è½åä¼æ¥å§ä¸éãå æ­¤ï¼ç´¢å¼ä¼ååºè¯¥æ¯æ¥è¯¢æ§è½ä¼åçæææææ®µã\n\nå¾å¤æ°æ®åºåè®¸åç¬æ·»å åå é¤ç´¢å¼ï¼èä¸å½±åæ°æ®åºçåå®¹ï¼å®åªä¼å½±åæ¥è¯¢æ§è½ãç»´æ¤é¢å¤çç»æå¿å¿ä¼å¼å¥å¼éï¼ç¹å«æ¯å¨æ°æ°æ®åå¥æ¶ãå¯¹äºåå¥ï¼å®å¾é¾è¶è¿ç®åå°è¿½å æä»¶æ¹å¼çæ§è½ï¼å ä¸ºé£å·²ç»æ¯æç®åçåæä½äºãç±äºæ¯æ¬¡åæ°æ®æ¶ï¼éè¦æ´æ°ç´¢å¼ï¼å æ­¤ä»»ä½ç±»åçç´¢å¼éå¸¸é½ä¼éä½åçéåº¦ã\n\næ¬æä»¥ä¸äºå¸¸è§çæ°æ®åºä¸ºä¾ï¼åæå®ä»¬çç´¢å¼éç¨äºä»ä¹æ ·çæ°æ®ç»æï¼æä»ä¹å©å¼ï¼ä¸ºä½å¦æ­¤è®¾è®¡ã\n\n\n# æ°ç»åé¾è¡¨\n\næ°ç»åé¾è¡¨åå«ä»£è¡¨äºè¿ç»­ç©ºé´åä¸è¿ç»­ç©ºé´çå­å¨æ¹å¼ï¼å®ä»¬æ¯çº¿æ§è¡¨ï¼linear listï¼çå¸åä»£è¡¨ãå¶ä»ææçæ°æ®ç»æï¼æ¯å¦æ ãéåãäºåæ ãb+ æ ç­ï¼å®éä¸é½æ¯è¿ä¸¤èçç»ååååã\n\næ°ç»ç¨è¿ç»­çåå­ç©ºé´æ¥å­å¨æ°æ®ãæ°ç»æ¯æéæºè®¿é®ï¼æ ¹æ®ä¸æ éæºè®¿é®çæ¶é´å¤æåº¦ä¸º o(1)ãä½è¿å¹¶ä¸ä»£è¡¨æ°ç»çæ¥æ¾æ¶é´å¤æåº¦ä¹æ¯ o(1)ã\n\n * å¯¹äºæ åºæ°ç»ï¼åªè½é¡ºåºæ¥æ¾ï¼å¶æ¶é´å¤æåº¦ä¸º o(n)ã\n * å¯¹äºæåºæ°ç»ï¼å¯ä»¥åºç¨äºåæ¥æ¾æ³ï¼å¶æ¶é´å¤æåº¦ä¸º o(log n)ã\n\nå¨æåºæ°ç»ä¸åºç¨äºåæ¥æ¾æ³å¦æ­¤é«æï¼ä¸ºä»ä¹å ä¹æ²¡ææ°æ®åºç´æ¥ä½¿ç¨æ°ç»ä½ä¸ºç´¢å¼ï¼è¿æ¯å ä¸ºå®çéå¶æ¡ä»¶ï¼æ°æ®æåºââä¸ºäºä¿è¯æ°æ®æåºï¼æ¯æ¬¡æ·»å ãå é¤æ°ç»æ°æ®æ¶ï¼é½å¿é¡»è¦è¿è¡æ°æ®è°æ´ï¼æ¥ä¿è¯å¶æåºï¼è æ°ç»çæå¥/å é¤æä½ï¼æ¶é´å¤æåº¦ä¸º o(n)ãæ­¤å¤ï¼ç±äºæ°ç»ç©ºé´å¤§å°åºå®ï¼æ¯æ¬¡æ©å®¹åªè½éç¨å¤å¶æ°ç»çæ¹å¼ãæ°ç»çè¿äºç¹æ§ï¼å³å®äºå®ä¸éåç¨äºæ°æ®é¢ç¹ååçåºç¨åºæ¯ã\n\n\n\né¾è¡¨ç¨ä¸è¿ç»­çåå­ç©ºé´æ¥å­å¨æ°æ®ï¼å¹¶éè¿ä¸ä¸ªæéæé¡ºåºå°è¿äºç©ºé´ä¸²èµ·æ¥ï¼å½¢æä¸æ¡é¾ã\n\nåºå«äºæ°ç»ï¼é¾è¡¨ä¸­çåç´ ä¸æ¯å­å¨å¨åå­ä¸­è¿ç»­çä¸çåºåï¼é¾è¡¨ä¸­çæ°æ®å­å¨å¨æ¯ä¸ä¸ªç§°ä¹ä¸ºãç»ç¹ãå¤ååºåéï¼å¨æ¯ä¸ä¸ªç»ç¹é¤äºå­å¨æ°æ®ä»¥å¤ï¼è¿ä¿å­äºå°ä¸ä¸ä¸ªèç¹çæéï¼pointerï¼ãç±äºä¸å¿æé¡ºåºå­å¨ï¼é¾è¡¨çæå¥/å é¤æä½ï¼æ¶é´å¤æåº¦ä¸º o(1)ï¼ä½æ¯ï¼é¾è¡¨åªæ¯æé¡ºåºè®¿é®ï¼å¶ æ¥æ¾æ¶é´å¤æåº¦ä¸º o(n)ãå¶ä½æçæ¥æ¾æ¹å¼ï¼å³å®äºé¾è¡¨ä¸éåä½ä¸ºç´¢å¼ã\n\n\n\n\n# åå¸ç´¢å¼\n\nåå¸è¡¨æ¯ä¸ç§ä»¥é® - å¼ï¼key-valueï¼å¯¹å½¢å¼å­å¨æ°æ®çç»æï¼æä»¬åªè¦è¾å¥å¾æ¥æ¾çå¼å³ keyï¼å°±å¯ä»¥æ¾å°å¶å¯¹åºçå¼å³ valueã\n\nåå¸è¡¨ ä½¿ç¨ åå¸å½æ° ç»ç»æ°æ®ï¼ä»¥æ¯æå¿«éæå¥åæç´¢çæ°æ®ç»æãåå¸è¡¨çæ¬è´¨æ¯ä¸ä¸ªæ°ç»ï¼å¶æè·¯æ¯ï¼ä½¿ç¨ hash å½æ°å° key è½¬æ¢ä¸ºæ°ç»ä¸æ ï¼å©ç¨æ°ç»çéæºè®¿é®ç¹æ§ï¼ä½¿å¾æä»¬è½å¨ o(1) çæ¶é´ä»£ä»·åå®ææ£ç´¢ã\n\n\n\næä¸¤ç§ä¸åç±»åçåå¸è¡¨ï¼åå¸éå å åå¸æ å°ã\n\n * åå¸éå æ¯éåæ°æ®ç»æçå®ç°ä¹ä¸ï¼ç¨äºå­å¨ééå¤å¼ã\n * åå¸æ å° æ¯æ å° æ°æ®ç»æçå®ç°ä¹ä¸ï¼ç¨äºå­å¨é®å¼å¯¹ã\n\nåå¸ç´¢å¼åºäºåå¸è¡¨å®ç°ï¼åªéç¨äºç­å¼æ¥è¯¢ãå¯¹äºæ¯ä¸è¡æ°æ®ï¼åå¸ç´¢å¼é½ä¼å°ææçç´¢å¼åè®¡ç®ä¸ä¸ªåå¸ç ï¼hashcodeï¼ï¼åå¸ç æ¯ä¸ä¸ªè¾å°çå¼ãåå¸ç´¢å¼å°ææçåå¸ç å­å¨å¨ç´¢å¼ä¸­ï¼åæ¶å¨åå¸è¡¨ä¸­ä¿å­æåæ¯ä¸ªæ°æ®è¡çæéã\n\nâ åå¸ç´¢å¼çä¼ç¹ï¼\n\n * å ä¸ºç´¢å¼æ°æ®ç»æç´§åï¼æä»¥æ¥è¯¢éåº¦éå¸¸å¿«ã\n\nâ åå¸ç´¢å¼çç¼ºç¹ï¼\n\n * åå¸ç´¢å¼å¼åå«åå¸å¼åè¡æéï¼èä¸å­å¨å­æ®µå¼ï¼æä»¥ä¸è½ä½¿ç¨ç´¢å¼ä¸­çå¼æ¥é¿åè¯»åè¡ãä¸è¿ï¼è®¿é®åå­ä¸­çè¡çéåº¦å¾å¿«ï¼æä»¥å¤§é¨åæåµä¸è¿ä¸ç¹å¯¹æ§è½å½±åä¸å¤§ã\n * åå¸ç´¢å¼æ°æ®ä¸æ¯æç§ç´¢å¼å¼é¡ºåºå­å¨çï¼æä»¥æ æ³ç¨äºæåºã\n * åå¸ç´¢å¼ä¸æ¯æé¨åç´¢å¼å¹éæ¥æ¾ï¼å ä¸ºåå¸ç´¢å¼æ¶ä½¿ç¨ç´¢å¼åçå¨é¨åå®¹æ¥è¿è¡åå¸è®¡ç®çãå¦ï¼å¨æ°æ®å (a,b) ä¸å»ºç«åå¸ç´¢å¼ï¼å¦ææ¥è¯¢åªææ°æ®å aï¼æ æ³ä½¿ç¨è¯¥ç´¢å¼ã\n * åå¸ç´¢å¼åªæ¯æç­å¼æ¯è¾æ¥è¯¢ï¼åæ¬ =ãin()ã<=>ï¼ä¸æ¯æä»»ä½èå´æ¥è¯¢ï¼å¦ where price > 100ã\n * åå¸ç´¢å¼æå¯è½åºç°åå¸å²çª\n   * åºç°åå¸å²çªæ¶ï¼å¿é¡»éåé¾è¡¨ä¸­ææçè¡æéï¼éè¡æ¯è¾ï¼ç´å°æ¾å°ç¬¦åæ¡ä»¶çè¡ã\n   * å¦æåå¸å²çªå¤çè¯ï¼ç»´æ¤ç´¢å¼çä»£ä»·ä¼å¾é«ã\n\n> å ä¸ºç§ç§éå¶ï¼æä»¥åå¸ç´¢å¼åªéç¨äºç¹å®çåºåãèä¸æ¦ä½¿ç¨åå¸ç´¢å¼ï¼åå®å¸¦æ¥çæ§è½æåä¼éå¸¸æ¾èãä¾å¦ï¼mysql ä¸­ç memory å­å¨å¼æå°±æ¾ç¤ºçæ¯æåå¸ç´¢å¼ã\n\n\n# b-tree ç´¢å¼\n\néå¸¸æä»¬æè¯´ç b æ ç´¢å¼æ¯æ b-tree ç´¢å¼ï¼å®æ¯ç®åå³ç³»åæ°æ®åºä¸­æ¥æ¾æ°æ®æä¸ºå¸¸ç¨åææçç´¢å¼ï¼å¤§å¤æ°å­å¨å¼æé½æ¯æè¿ç§ç´¢å¼ãä½¿ç¨ b-tree è¿ä¸ªæ¯è¯­ï¼æ¯å ä¸º mysql å¨ create table æå¶å®è¯­å¥ä¸­ä½¿ç¨äºè¿ä¸ªå³é®å­ï¼ä½å®éä¸ä¸åçå­å¨å¼æå¯è½ä½¿ç¨ä¸åçæ°æ®ç»æï¼æ¯å¦ innodb ä½¿ç¨çæ¯ b+treeç´¢å¼ï¼è myisam ä½¿ç¨çæ¯ b-treeç´¢å¼ã\n\nb-tree ç´¢å¼ä¸­ç b æ¯æ balanceï¼æä¸ºå¹³è¡¡ãéè¦æ³¨æçæ¯ï¼b-tree ç´¢å¼å¹¶ä¸è½æ¾å°ä¸ä¸ªç»å®é®å¼çå·ä½è¡ï¼å®æ¾å°çåªæ¯è¢«æ¥æ¾æ°æ®è¡æå¨çé¡µï¼æ¥çæ°æ®åºä¼æé¡µè¯»å¥å°åå­ï¼åå¨åå­ä¸­è¿è¡æ¥æ¾ï¼æåå¾å°è¦æ¥æ¾çæ°æ®ã\n\n\n# äºåæç´¢æ \n\näºåæç´¢æ çç¹ç¹æ¯ï¼æ¯ä¸ªèç¹çå·¦å¿å­å°äºç¶èç¹ï¼ç¶èç¹åå°äºå³å¿å­ãå¶æ¥è¯¢æ¶é´å¤æåº¦æ¯ o(log n)ã\n\nå½ç¶ä¸ºäºç»´æ o(log n) çæ¥è¯¢å¤æåº¦ï¼ä½ å°±éè¦ä¿æè¿æ£µæ æ¯å¹³è¡¡äºåæ ãä¸ºäºåè¿ä¸ªä¿è¯ï¼æ´æ°çæ¶é´å¤æåº¦ä¹æ¯ o(log n)ã\n\néçæ°æ®åºä¸­æ°æ®çå¢å ï¼ç´¢å¼æ¬èº«å¤§å°éä¹å¢å ï¼ä¸å¯è½å¨é¨å­å¨å¨åå­ä¸­ï¼å æ­¤ç´¢å¼å¾å¾ä»¥ç´¢å¼æä»¶çå½¢å¼å­å¨çç£çä¸ãè¿æ ·çè¯ï¼ç´¢å¼æ¥æ¾è¿ç¨ä¸­å°±è¦äº§çç£ç i/o æ¶èï¼ç¸å¯¹äºåå­å­åï¼i/o å­åçæ¶èè¦é«å ä¸ªæ°éçº§ãå¯ä»¥æ³è±¡ä¸ä¸ä¸æ£µå ç¾ä¸èç¹çäºåæ çæ·±åº¦æ¯å¤å°ï¼å¦æå°è¿ä¹å¤§æ·±åº¦çä¸é¢äºåæ æ¾ç£çä¸ï¼æ¯è¯»åä¸ä¸ªèç¹ï¼éè¦ä¸æ¬¡ç£çç i/o è¯»åï¼æ´ä¸ªæ¥æ¾çèæ¶æ¾ç¶æ¯ä¸è½å¤æ¥åçãé£ä¹å¦ä½åå°æ¥æ¾è¿ç¨ä¸­ç i/o å­åæ¬¡æ°ï¼\n\nä¸ç§è¡ä¹ææçè§£å³æ¹æ³æ¯åå°æ çæ·±åº¦ï¼å°äºåæ åä¸º n åæ ï¼å¤è·¯æç´¢æ ï¼ï¼è b+ æ å°±æ¯ä¸ç§å¤è·¯æç´¢æ ã\n\n\n# b+tree ç´¢å¼\n\nb+ æ ç´¢å¼éç¨äºå¨é®å¼æ¥æ¾ãé®å¼èå´æ¥æ¾åé®åç¼æ¥æ¾ï¼å¶ä¸­é®åç¼æ¥æ¾åªéç¨äºæå·¦åç¼æ¥æ¾ã\n\nçè§£ b+treeï¼åªéè¦çè§£å¶æéè¦çä¸¤ä¸ªç¹å¾å³å¯ï¼\n\n * ç¬¬ä¸ï¼ææçå³é®å­ï¼å¯ä»¥çè§£ä¸ºæ°æ®ï¼é½å­å¨å¨å¶å­èç¹ï¼éå¶å­èç¹å¹¶ä¸å­å¨çæ­£çæ°æ®ï¼ææè®°å½èç¹é½æ¯æé®å¼å¤§å°é¡ºåºå­æ¾å¨åä¸å±å¶å­èç¹ä¸ã\n * å¶æ¬¡ï¼ææçå¶å­èç¹ç±æéè¿æ¥ãå¦ä¸å¾ä¸ºç®åäºçb+treeã\n\n\n\næ ¹æ®å¶å­èç¹çåå®¹ï¼ç´¢å¼ç±»ååä¸ºä¸»é®ç´¢å¼åéä¸»é®ç´¢å¼ã\n\n * èç°ç´¢å¼ï¼clusteredï¼ï¼åç§°ä¸ºä¸»é®ç´¢å¼ï¼å¶å¶å­èç¹å­çæ¯æ´è¡æ°æ®ãå ä¸ºæ æ³åæ¶ææ°æ®è¡å­æ¾å¨ä¸¤ä¸ªä¸åçå°æ¹ï¼æä»¥ä¸ä¸ªè¡¨åªè½æä¸ä¸ªèç°ç´¢å¼ãinnodb çèç°ç´¢å¼å®éæ¯å¨åä¸ä¸ªç»æä¸­ä¿å­äº b æ çç´¢å¼åæ°æ®è¡ã\n * éä¸»é®ç´¢å¼çå¶å­èç¹åå®¹æ¯ä¸»é®çå¼ãå¨ innodb éï¼éä¸»é®ç´¢å¼ä¹è¢«ç§°ä¸ºäºçº§ç´¢å¼ï¼secondaryï¼ãæ°æ®å­å¨å¨ä¸ä¸ªä½ç½®ï¼ç´¢å¼å­å¨å¨å¦ä¸ä¸ªä½ç½®ï¼ç´¢å¼ä¸­åå«æåæ°æ®å­å¨ä½ç½®çæéãå¯ä»¥æå¤ä¸ªï¼å°äº 249 ä¸ªã\n\nèç°è¡¨ç¤ºæ°æ®è¡åç¸é»çé®å¼ç´§åå°å­å¨å¨ä¸èµ·ï¼å ä¸ºæ°æ®ç´§åï¼æä»¥è®¿é®å¿«ãå ä¸ºæ æ³åæ¶ææ°æ®è¡å­æ¾å¨ä¸¤ä¸ªä¸åçå°æ¹ï¼æä»¥ä¸ä¸ªè¡¨åªè½æä¸ä¸ªèç°ç´¢å¼ã\n\nèç°ç´¢å¼åéèç°ç´¢å¼çæ¥è¯¢æä»ä¹åºå«\n\n * å¦æè¯­å¥æ¯ select * from t where id=500ï¼å³èç°ç´¢å¼æ¥è¯¢æ¹å¼ï¼ååªéè¦æç´¢ id è¿æ£µ b+ æ ï¼\n * å¦æè¯­å¥æ¯ select * from t where k=5ï¼å³éèç°ç´¢å¼æ¥è¯¢æ¹å¼ï¼åéè¦åæç´¢ k ç´¢å¼æ ï¼å¾å° id çå¼ä¸º 500ï¼åå° id ç´¢å¼æ æç´¢ä¸æ¬¡ãè¿ä¸ªè¿ç¨ç§°ä¸ºåè¡¨ã\n\nä¹å°±æ¯è¯´ï¼åºäºéèç°ç´¢å¼çæ¥è¯¢éè¦å¤æ«æä¸æ£µç´¢å¼æ ãå æ­¤ï¼æä»¬å¨åºç¨ä¸­åºè¯¥å°½éä½¿ç¨ä¸»é®æ¥è¯¢ã\n\næ¾ç¶ï¼ä¸»é®é¿åº¦è¶å°ï¼éèç°ç´¢å¼çå¶å­èç¹å°±è¶å°ï¼éèç°ç´¢å¼å ç¨çç©ºé´ä¹å°±è¶å°ã\n\nèªå¢ä¸»é®æ¯æèªå¢åä¸å®ä¹çä¸»é®ï¼å¨å»ºè¡¨è¯­å¥ä¸­ä¸è¬æ¯è¿ä¹å®ä¹çï¼ not null primary key auto_incrementãä»æ§è½åå­å¨ç©ºé´æ¹é¢èéï¼èªå¢ä¸»é®å¾å¾æ¯æ´åççéæ©ãææ²¡æä»ä¹åºæ¯éåç¨ä¸å¡å­æ®µç´æ¥åä¸»é®çå¢ï¼è¿æ¯æçãæ¯å¦ï¼æäºä¸å¡çåºæ¯éæ±æ¯è¿æ ·çï¼\n\n * åªæä¸ä¸ªç´¢å¼ï¼\n * è¯¥ç´¢å¼å¿é¡»æ¯å¯ä¸ç´¢å¼ã\n\nç±äºæ²¡æå¶ä»ç´¢å¼ï¼æä»¥ä¹å°±ä¸ç¨èèå¶ä»ç´¢å¼çå¶å­èç¹å¤§å°çé®é¢ãè¿æ¶åæä»¬å°±è¦ä¼åèèä¸ä¸æ®µæå°çâå°½éä½¿ç¨ä¸»é®æ¥è¯¢âååï¼ç´æ¥å°è¿ä¸ªç´¢å¼è®¾ç½®ä¸ºä¸»é®ï¼å¯ä»¥é¿åæ¯æ¬¡æ¥è¯¢éè¦æç´¢ä¸¤æ£µæ ã\n\n----------------------------------------\n\nåå­æ¯åå¯¼ä½åä»¶ãå¯¹äºåå­èè¨ï¼åªè¦ç»åºäºåå­å°åï¼æä»¬å°±å¯ä»¥ç´æ¥è®¿é®è¯¥å°åååºæ°æ®ãè¿ä¸ªè¿ç¨å·æé«æçéæºè®¿é®ç¹æ§ï¼å æ­¤åå­ä¹å«éæºè®¿é®å­å¨å¨ï¼random access memoryï¼å³ ramï¼ãåå­çè®¿é®éåº¦å¾å¿«ï¼ä½æ¯ä»·æ ¼ç¸å¯¹è¾æè´µï¼å æ­¤ä¸è¬çè®¡ç®æºåå­ç©ºé´é½ç¸å¯¹è¾å°ã\n\nèç£çæ¯æºæ¢°å¨ä»¶ãç£çè®¿é®æ°æ®æ¶ï¼éè¦ç­ç£çççæè½¬å°ç£å¤´ä¸ï¼æè½è¯»åç¸åºçæ°æ®ãå°½ç®¡ç£ççæè½¬éåº¦å¾å¿«ï¼ä½æ¯ååå­çéæºè®¿é®ç¸æ¯ï¼æ§è½å·®è·éå¸¸å¤§ãä¸è¬æ¥è¯´ï¼å¦ææ¯éæºè¯»åï¼ä¼æ 10 ä¸å° 100 ä¸åå·¦å³çå·®è·ãä½å¦ææ¯é¡ºåºè®¿é®å¤§æ¹éæ°æ®çè¯ï¼ç£ççæ§è½ååå­å°±æ¯ä¸ä¸ªæ°éçº§çã\n\nç£ççæå°è¯»ååä½æ¯æåºï¼è¾æ©æçç£çä¸ä¸ªæåºæ¯ 512 å­èãéçç£çææ¯çåå±ï¼ç®åå¸¸è§çç£çæåºæ¯ 4k ä¸ªå­èãæä½ç³»ç»ä¸æ¬¡ä¼è¯»åå¤ä¸ªæåºï¼æä»¥æä½ç³»ç»çæå°è¯»ååä½æ¯åï¼blockï¼ï¼ä¹å«ä½ç°ï¼clusterï¼ãå½æä»¬è¦ä»ç£çä¸­è¯»åä¸ä¸ªæ°æ®æ¶ï¼æä½ç³»ç»ä¼ä¸æ¬¡æ§å°æ´ä¸ªåé½è¯»åºæ¥ãå æ­¤ï¼å¯¹äºå¤§æ¹éçé¡ºåºè¯»åæ¥è¯´ï¼ç£ççæçä¼æ¯éæºè¯»åé«è®¸å¤ã\n\nåè®¾æä¸ä¸ªæåºæ°ç»å­å¨å¨ç¡¬çä¸­ï¼å¦æå®è¶³å¤å¤§ï¼é£ä¹å®ä¼å­å¨å¨å¤ä¸ªåä¸­ãå½æä»¬è¦å¯¹è¿ä¸ªæ°ç»ä½¿ç¨äºåæ¥æ¾æ¶ï¼éè¦åæ¾å°ä¸­é´åç´ æå¨çåï¼å°è¿ä¸ªåä»ç£çä¸­è¯»å°åå­éï¼ç¶åå¨åå­ä¸­è¿è¡äºåæ¥æ¾ãå¦æä¸ä¸æ­¥è¦è¯»çåç´ å¨å¶ä»åä¸­ï¼åéè¦åå°ç¸åºåä»ç£çä¸­è¯»å¥åå­ãç´å°æ¥è¯¢ç»æï¼è¿ä¸ªè¿ç¨å¯è½ä¼å¤æ¬¡è®¿é®ç£çãæä»¬å¯ä»¥çå°ï¼è¿æ ·çæ£ç´¢æ§è½éå¸¸ä½ã\n\nç±äºç£çç¸å¯¹äºåå­èè¨è®¿é®éåº¦å®å¨å¤ªæ¢ï¼å æ­¤ï¼å¯¹äºç£çä¸æ°æ®çé«ææ£ç´¢ï¼æä»¬æä¸ä¸ªæå¶éè¦çååï¼å¯¹ç£ççè®¿é®æ¬¡æ°è¦å°½å¯è½çå°ï¼\n\nå°ç´¢å¼åæ°æ®åç¦»å°±æ¯ä¸ç§å¸¸è§çè®¾è®¡æè·¯ãå¨æ°æ®é¢ç¹ååçåºæ¯ä¸­ï¼æåºæ°ç»å¹¶ä¸æ¯ä¸ä¸ªæå¥½çéæ©ï¼äºåæ£ç´¢æ æèåå¸è¡¨å¾å¾æ´ææ®éæ§ãä½æ¯ï¼åå¸è¡¨ç±äºç¼ºä¹èå´æ£ç´¢çè½åï¼å¨ä¸äºåºåä¹ä¸éç¨ãå æ­¤ï¼äºåæ£ç´¢æ è¿ç§æ å½¢ç»ææ¯è®¸å¤å¸¸è§æ£ç´¢ç³»ç»çå®æ½æ¹æ¡ã\n\néçç´¢å¼æ°æ®è¶æ¥è¶å¤§ï¼ç´å°æ æ³å®å¨å è½½å°åå­ä¸­ï¼è¿æ¯éè¦å°ç´¢å¼æ°æ®ä¹å­å¥ç£çä¸­ãb+ æ ç»åºäºå°æ å½¢ç´¢å¼çææèç¹é½å­å¨ç£çä¸çé«ææ£ç´¢æ¹æ¡ãæä½ç³»ç»å¯¹ç£çæ°æ®çè®¿é®æ¯ä»¥åä¸ºåä½çãå æ­¤ï¼å¦ææä»¬æ³å°æ åç´¢å¼çä¸ä¸ªèç¹ä»ç£çä¸­è¯»åºï¼å³ä½¿è¯¥èç¹çæ°æ®éå¾å°ï¼æ¯å¦è¯´åªæå ä¸ªå­èï¼ï¼ä½ç£çä¾ç¶ä¼å°æ´ä¸ªåçæ°æ®å¨é¨è¯»åºæ¥ï¼èä¸æ¯åªè¯»è¿ä¸å°é¨åæ°æ®ï¼è¿ä¼è®©ææè¯»åæçå¾ä½ãb+ æ çä¸ä¸ªå³é®è®¾è®¡ï¼å°±æ¯è®©ä¸ä¸ªèç¹çå¤§å°ç­äºä¸ä¸ªåçå¤§å°ãèç¹åå­å¨çæ°æ®ï¼ä¸æ¯ä¸ä¸ªåç´ ï¼èæ¯ä¸ä¸ªå¯ä»¥è£ m ä¸ªåç´ çæåºæ°ç»ãè¿æ ·ä¸æ¥ï¼æä»¬å°±å¯ä»¥å°ç£çä¸æ¬¡è¯»åçæ°æ®å¨é¨å©ç¨èµ·æ¥ï¼ä½¿å¾è¯»åæçæå¤§åã\n\nb+ æ è¿æå¦ä¸ä¸ªè®¾è®¡ï¼å°±æ¯å°ææçèç¹åä¸ºåé¨èç¹åå¶å­èç¹ãåé¨èç¹ä»å­å¨ key åç»´ææ å½¢ç»æçæéï¼å¹¶ä¸å­å¨ key å¯¹åºçæ°æ®ï¼æ è®ºæ¯å·ä½æ°æ®è¿æ¯æä»¶ä½ç½®ä¿¡æ¯ï¼ãè¿æ ·åé¨èç¹å°±è½å­å¨æ´å¤çç´¢å¼æ°æ®ï¼æä»¬ä¹å°±å¯ä»¥ä½¿ç¨æå°çåé¨èç¹ï¼å°æææ°æ®ç»ç»èµ·æ¥äºãèå¶å­èç¹ä»å­å¨ key åå¯¹åºæ°æ®ï¼ä¸å­å¨ç»´ææ å½¢ç»æçæéãéè¿è¿æ ·çè®¾è®¡ï¼b+ æ å°±è½åå°èç¹çç©ºé´å©ç¨çæå¤§åãæ­¤å¤ï¼b+ æ è¿å°åä¸å±çææèç¹ä¸²æäºæåºçååé¾è¡¨ï¼è¿æ ·ä¸æ¥ï¼b+ æ å°±åæ¶å·å¤äºè¯å¥½çèå´æ¥è¯¢è½ååçµæ´»è°æ´çè½åäºã\n\nå æ­¤ï¼b+ æ æ¯ä¸æ£µå®å¨å¹³è¡¡ç m é¶å¤åæ ãæè°ç m é¶ï¼æçæ¯æ¯ä¸ªèç¹æå¤æ m ä¸ªå­èç¹ï¼å¹¶ä¸æ¯ä¸ªèç¹éé½å­äºä¸ä¸ªç´§åçå¯åå« m ä¸ªåç´ çæ°ç»ã\n\nå³ä½¿æ¯å¤æç b+ æ ï¼æä»¬å°å®æè§£å¼æ¥ï¼å¶å®ä¹æ¯ç±ç®åçæ°ç»ãé¾è¡¨åæ ç»æçï¼èä¸ b+ æ çæ£ç´¢è¿ç¨å¶å®ä¹æ¯äºåæ¥æ¾ãå æ­¤ï¼å¦æ b+ æ å®å¨å è½½å¨åå­ä¸­çè¯ï¼å®çæ£ç´¢æçå¶å®å¹¶ä¸ä¼æ¯æåºæ°ç»æèäºåæ£ç´¢æ æ´ é«ï¼ä¹è¿æ¯äºåæ¥æ¾ç log(n) çæçãå¹¶ä¸ï¼å®è¿æ¯æ°ç»åäºåæ£ç´¢æ æ´å å¤æï¼è¿ä¼å¸¦æ¥é¢å¤çå¼éã\n\nå¦å¤ï¼è¿ä¸èè¿æä¸ä¸ªå¾éè¦çè®¾è®¡ææ³éè¦ä½ ææ¡ï¼é£å°±æ¯å°ç´¢å¼åæ°æ®åç¦»ãéè¿è¿æ ·çæ¹å¼ï¼æä»¬è½å°ç´¢å¼çæ°ç»å¤§å°ä¿æå¨ä¸ä¸ªè¾å°çèå´åï¼è®©å®è½å è½½å¨åå­ä¸­ãå¨è®¸å¤å¤§è§æ¨¡ç³»ç»ä¸­ï¼é½æ¯ä½¿ç¨è¿ä¸ªè®¾è®¡ææ³æ¥ç²¾ç®ç´¢å¼çãèä¸ï¼b+ æ çåé¨èç¹åå¶å­èç¹çåºåï¼å¶å®ä¹æ¯ç´¢å¼åæ°æ®åç¦»çä¸æ¬¡å®è·µã\n\nmysql ä¸­ç b+ æ å®ç°å¶å®æä¸¤ç§ï¼ä¸ç§æ¯ myisam å¼æï¼å¦ä¸ç§æ¯ innodb å¼æãå®ä»¬çæ ¸å¿åºå«å°±å¨äºï¼æ°æ®åç´¢å¼æ¯å¦æ¯åç¦»çã\n\nå¨ myisam å¼æä¸­ï¼b+ æ çå¶å­èç¹ä»å­å¨äºæ°æ®çä½ç½®æéï¼è¿æ¯ä¸ç§ç´¢å¼åæ°æ®åç¦»çè®¾è®¡æ¹æ¡ï¼å«ä½éèéç´¢å¼ãå¦æè¦ä¿è¯ myisam çæ°æ®ä¸è´æ§ï¼é£æä»¬éè¦å¨è¡¨çº§å«ä¸è¿è¡å éå¤çã\n\nå¨ innodb ä¸­ï¼b+ æ çå¶å­èç¹ç´æ¥å­å¨äºå·ä½æ°æ®ï¼è¿æ¯ä¸ç§ç´¢å¼åæ°æ®ä¸ä½çæ¹æ¡ãå«ä½èéç´¢å¼ãç±äºæ°æ®ç´æ¥å°±å­å¨ç´¢å¼çå¶å­èç¹ä¸­ï¼å æ­¤ innodb ä¸éè¦ç»å¨è¡¨å éæ¥ä¿è¯ä¸è´æ§ï¼å®åªéè¦æ¯æè¡çº§çéå°±å¯ä»¥äºã\n\n\n# lsm æ \n\nb+ æ çæ°æ®é½å­å¨å¨å¶å­èç¹ä¸­ï¼èå¶å­èç¹ä¸è¬é½å­å¨å¨ç£çä¸­ãå æ­¤ï¼æ¯æ¬¡æå¥çæ°æ°æ®é½éè¦éæºåå¥ç£çï¼èéæºåå¥çæ§è½éå¸¸æ¢ãå¦ææ¯ä¸ä¸ªæ¥å¿ç³»ç»ï¼æ¯ç§éè¦åå¥ä¸åæ¡çè³ä¸ä¸æ¡æ°æ®ï¼è¿æ ·çç£çæä½ä»£ä»·ä¼ä½¿å¾ç³»ç»æ§è½æ¥å§ä¸éï¼çè³æ æ³ä½¿ç¨ã\n\næä½ç³»ç»å¯¹ç£ççè¯»åæ¯ä»¥åä¸ºåä½çï¼æä»¬è½å¦ä»¥åä¸ºåä½åå¥ï¼èä¸æ¯æ¯æ¬¡æå¥ä¸ä¸ªæ°æ®é½è¦éæºåå¥ç£çå¢ï¼è¿æ ·æ¯ä¸æ¯å°±å¯ä»¥å¤§å¹åº¦åå°åå¥æä½äºå¢ï¼è§£å³æ¹æ¡å°±æ¯ï¼lsm æ ï¼log structured merge treesï¼ã\n\nlsm æ å°±æ¯æ ¹æ®è¿ä¸ªæè·¯è®¾è®¡äºè¿æ ·ä¸ä¸ªæºå¶ï¼å½æ°æ®åå¥æ¶ï¼å»¶è¿åç£çï¼å°æ°æ®åå­æ¾å¨åå­ä¸­çæ éï¼è¿è¡å¸¸è§çå­å¨åæ¥è¯¢ãå½åå­ä¸­çæ æç»­åå¤§è¾¾å°éå¼æ¶ï¼åæ¹éå°ä»¥åä¸ºåä½åå¥ç£ççæ ä¸­ãå æ­¤ï¼lsm æ è³å°éè¦ç±ä¸¤æ£µæ ç»æï¼ä¸æ£µæ¯å­å¨å¨åå­ä¸­è¾å°ç c0 æ ï¼å¦ä¸æ£µæ¯å­å¨å¨ç£çä¸­è¾å¤§ç c1 æ ã\n\nlsm æ å·æä»¥ä¸ 3 ä¸ªç¹ç¹ï¼\n\n 1. å°ç´¢å¼åä¸ºåå­åç£çä¸¤é¨åï¼å¹¶å¨åå­è¾¾å°éå¼æ¶å¯å¨æ åå¹¶ï¼merge treesï¼ï¼\n 2. ç¨æ¹éåå¥ä»£æ¿éæºåå¥ï¼å¹¶ä¸ç¨é¢åæ¥å¿ wal ææ¯ï¼write aheadlogï¼é¢åæ¥å¿ææ¯ï¼ä¿è¯åå­æ°æ®ï¼å¨ç³»ç»å´©æºåå¯ä»¥è¢«æ¢å¤ï¼\n 3. æ°æ®éåç±»ä¼¼æ¥å¿è¿½å åçæ¹å¼åå¥ï¼log structuredï¼ç£çï¼ä»¥é¡ºåºåçæ¹å¼æé«å å¥æçã\n\nlsm æ çè¿äºç¹ç¹ï¼ä½¿å¾å®ç¸å¯¹äº b+ æ ï¼å¨åå¥æ§è½ä¸æå¤§å¹æåãæä»¥ï¼è®¸å¤ nosql ç³»ç»é½ä½¿ç¨ lsm æ ä½ä¸ºæ£ç´¢å¼æï¼èä¸è¿å¯¹ lsm æ è¿è¡äºä¼åä»¥æåæ£ç´¢æ§è½ã\n\n\n# åæç´¢å¼\n\nåæç´¢å¼çæ ¸å¿å¶å®å¹¶ä¸å¤æï¼å®çå·ä½å®ç°å¶å®æ¯åå¸è¡¨ï¼åªæ¯å®ä¸æ¯å°ææ¡£ id æèé¢ç®ä½ä¸º keyï¼èæ¯åè¿æ¥ï¼éè¿å°åå®¹æèå±æ§ä½ä¸º key æ¥å­å¨å¯¹åºçææ¡£åè¡¨ï¼ä½¿å¾æä»¬è½å¨ o(1) çæ¶é´ä»£ä»·åå®ææ¥è¯¢ã\n\nå°½ç®¡åçå¹¶ä¸å¤æï¼ä½æ¯åæç´¢å¼æ¯è®¸å¤æ£ç´¢å¼æçæ ¸å¿ãæ¯å¦è¯´ï¼æ°æ®åºçå¨æç´¢å¼åè½ãæç´¢å¼æçç´¢å¼ãå¹¿åå¼æåæ¨èå¼æï¼é½ä½¿ç¨äºåæç´¢å¼ææ¯æ¥å®ç°æ£ç´¢åè½ã\n\n\n# ç´¢å¼çç»´æ¤\n\n\n# åå»ºç´¢å¼\n\n * æ°æ®åç¼©ï¼ä¸ä¸ªæ¯å°½å¯è½å°å°æ°æ®å è½½å°åå­ä¸­ï¼å ä¸ºåå­çæ£ç´¢æçå¤§å¤§é«äºç£çãé£ä¸ºäºå°æ°æ®æ´å¤å°å è½½å°åå­ä¸­ï¼ç´¢å¼åç¼©æ¯ä¸ä¸ªéè¦çç ç©¶æ¹åã\n * åæ¯å¤çï¼å¦ä¸ä¸ªæ¯å°å¤§æ°æ®éåææå¤ä¸ªå°æ°æ®éåæ¥å¤çãè¿å¶å®å°±æ¯åå¸å¼ç³»ç»çæ ¸å¿ææ³ã\n\n\n# æ´æ°ç´¢å¼\n\nï¼1ï¼double bufferï¼åç¼å²ï¼æºå¶\n\nå°±æ¯å¨åå­ä¸­åæ¶ä¿å­ä¸¤ä»½ä¸æ ·çç´¢å¼ï¼ä¸ä¸ªæ¯ç´¢å¼ aï¼ä¸ä¸ªæ¯ç´¢å¼ bãä¸¤ä¸ªç´¢å¼ä¿æä¸ä¸ªè¯»ãä¸ä¸ªåï¼å¹¶ä¸æ¥ååæ¢ï¼æç»å®æé«æ§è½çç´¢å¼æ´æ°ã\n\nä¼ç¹ï¼ç®åé«æ\n\nç¼ºç¹ï¼è¾¾å°ä¸å®æ°æ®éçº§åï¼ä¼å¸¦æ¥ç¿»åçåå­å¼éï¼çè³æäºç´¢å¼å­å¨å¨ç£çä¸çæåµä¸ï¼æ´æ¯æ æ³ä½¿ç¨æ­¤æºå¶ã\n\nï¼2ï¼å¨éç´¢å¼åå¢éç´¢å¼\n\nå°æ°æ¥æ¶å°çæ°æ®åç¬å»ºç«ä¸ä¸ªå¯ä»¥å­å¨åå­ä¸­çåæç´¢å¼ï¼ä¹å°±æ¯å¢éç´¢å¼ãå½æ¥è¯¢åççæ¶åï¼æä»¬ä¼åæ¶æ¥è¯¢å¨éç´¢å¼åå¢éç´¢å¼ï¼å°åå¹¶çç»æä½ä¸ºæ»çç»æè¾åºã\n\nå ä¸ºå¢éç´¢å¼ç¸å¯¹å¨éç´¢å¼èè¨ä¼å°å¾å¤ï¼åå­èµæºæ¶èå¨å¯æ¿åèå´ï¼æä»¥æä»¬å¯ä»¥ä½¿ç¨ double buffer æºå¶ å¯¹å¢éç´¢å¼è¿è¡ç´¢å¼æ´æ°ãè¿æ ·ä¸æ¥ï¼å¢éç´¢å¼å°±å¯ä»¥åå°æ éè®¿é®ãèå¨éç´¢å¼æ¬èº«å°±æ¯åªè¯»çï¼ä¹ä¸éè¦å éãå æ­¤ï¼æ´ä¸ªæ£ç´¢è¿ç¨é½å¯ä»¥åå°æ éè®¿é®ï¼ä¹å°±æé«äºç³»ç»çæ£ç´¢æçã\n\n\n# åèèµæ\n\n * ãæ°æ®å¯éååºç¨ç³»ç»è®¾è®¡ã\n * æ°æ®ç»æä¸ç®æ³ä¹ç¾\n * æ£ç´¢ææ¯æ ¸å¿ 20 è®²\n * data structures for databases\n * data structures and algorithms for big databases",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"ShardingSphere ç®ä»",frontmatter:{title:"ShardingSphere ç®ä»",date:"2020-10-08T20:30:30.000Z",categories:["æ°æ®åº","æ°æ®åºä¸­é´ä»¶","Shardingsphere"],tags:["æ°æ®åº","ä¸­é´ä»¶","ååºåè¡¨"],permalink:"/pages/5ed2a2/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/02.%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%97%B4%E4%BB%B6/01.Shardingsphere/01.ShardingSphere%E7%AE%80%E4%BB%8B.html",relativePath:"12.æ°æ®åº/02.æ°æ®åºä¸­é´ä»¶/01.Shardingsphere/01.ShardingSphereç®ä».md",key:"v-909a48e0",path:"/pages/5ed2a2/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:17},{level:3,title:"ShardingSphere ç»ä»¶",slug:"shardingsphere-ç»ä»¶",normalizedTitle:"shardingsphere ç»ä»¶",charIndex:31},{level:4,title:"ShardingSphere-JDBC",slug:"shardingsphere-jdbc",normalizedTitle:"shardingsphere-jdbc",charIndex:230},{level:4,title:"Sharding-Proxy",slug:"sharding-proxy",normalizedTitle:"sharding-proxy",charIndex:108},{level:4,title:"Sharding-Sidecarï¼TODOï¼",slug:"sharding-sidecar-todo",normalizedTitle:"sharding-sidecarï¼todoï¼",charIndex:875},{level:4,title:"æ··åæ¶æ",slug:"æ··åæ¶æ",normalizedTitle:"æ··åæ¶æ",charIndex:1555},{level:3,title:"åè½åè¡¨",slug:"åè½åè¡¨",normalizedTitle:"åè½åè¡¨",charIndex:1846},{level:4,title:"æ°æ®åç",slug:"æ°æ®åç",normalizedTitle:"æ°æ®åç",charIndex:171},{level:4,title:"åå¸å¼äºå¡",slug:"åå¸å¼äºå¡",normalizedTitle:"åå¸å¼äºå¡",charIndex:176},{level:4,title:"æ°æ®åºæ²»ç",slug:"æ°æ®åºæ²»ç",normalizedTitle:"æ°æ®åºæ²»ç",charIndex:182},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:1994}],headersStr:"ç®ä» ShardingSphere ç»ä»¶ ShardingSphere-JDBC Sharding-Proxy Sharding-Sidecarï¼TODOï¼ æ··åæ¶æ åè½åè¡¨ æ°æ®åç åå¸å¼äºå¡ æ°æ®åºæ²»ç åèèµæ",content:"# ShardingSphere ç®ä»\n\n\n# ç®ä»\n\n\n# ShardingSphere ç»ä»¶\n\nShardingSphere æ¯ä¸å¥å¼æºçåå¸å¼æ°æ®åºä¸­é´ä»¶è§£å³æ¹æ¡ç»æççæåï¼å®ç± Sharding-JDBCãSharding-Proxy å Sharding-Sidecarï¼è®¡åä¸­ï¼è¿ 3 æ¬¾ç¸äºç¬ç«çäº§åç»æã ä»ä»¬åæä¾æ ååçæ°æ®åçãåå¸å¼äºå¡åæ°æ®åºæ²»çåè½ï¼å¯éç¨äºå¦ Java åæãå¼æè¯­è¨ãäºåçç­åç§å¤æ ·åçåºç¨åºæ¯ã\n\n\n\n# ShardingSphere-JDBC\n\nå®ä½ä¸ºè½»éçº§ Java æ¡æ¶ï¼å¨ Java ç JDBC å±æä¾çé¢å¤æå¡ã å®ä½¿ç¨å®¢æ·ç«¯ç´è¿æ°æ®åºï¼ä»¥ jar åå½¢å¼æä¾æå¡ï¼æ éé¢å¤é¨ç½²åä¾èµï¼å¯çè§£ä¸ºå¢å¼ºçç JDBC é©±å¨ï¼å®å¨å¼å®¹ JDBC ååç§ ORM æ¡æ¶ã\n\n * éç¨äºä»»ä½åºäº JDBC ç ORM æ¡æ¶ï¼å¦ï¼JPA, Hibernate, Mybatis, Spring JDBC Template æç´æ¥ä½¿ç¨ JDBCã\n * æ¯æä»»ä½ç¬¬ä¸æ¹çæ°æ®åºè¿æ¥æ± ï¼å¦ï¼DBCP, C3P0, BoneCP, Druid, HikariCP ç­ã\n * æ¯æä»»æå®ç° JDBC è§èçæ°æ®åºï¼ç®åæ¯æ MySQLï¼Oracleï¼SQLServerï¼PostgreSQL ä»¥åä»»ä½éµå¾ª SQL92 æ åçæ°æ®åºã\n\n\n\n# Sharding-Proxy\n\nå®ä½ä¸ºéæåçæ°æ®åºä»£çç«¯ï¼æä¾å°è£äºæ°æ®åºäºè¿å¶åè®®çæå¡ç«¯çæ¬ï¼ç¨äºå®æå¯¹å¼æè¯­è¨çæ¯æã ç®åæä¾ MySQL å PostgreSQL çæ¬ï¼å®å¯ä»¥ä½¿ç¨ä»»ä½å¼å®¹ MySQL/PostgreSQL åè®®çè®¿é®å®¢æ·ç«¯(å¦ï¼MySQL Command Client, MySQL Workbench, Navicat ç­)æä½æ°æ®ï¼å¯¹ DBA æ´å åå¥½ã\n\n * ååºç¨ç¨åºå®å¨éæï¼å¯ç´æ¥å½å MySQL/PostgreSQL ä½¿ç¨ã\n * éç¨äºä»»ä½å¼å®¹ MySQL/PostgreSQL åè®®ççå®¢æ·ç«¯ã\n\n\n\n# Sharding-Sidecarï¼TODOï¼\n\nå®ä½ä¸º Kubernetes çäºåçæ°æ®åºä»£çï¼ä»¥ Sidecar çå½¢å¼ä»£çææå¯¹æ°æ®åºçè®¿é®ã éè¿æ ä¸­å¿ãé¶ä¾µå¥çæ¹æ¡æä¾ä¸æ°æ®åºäº¤äºççå®åå±ï¼å³ Database Meshï¼åå¯ç§°æ°æ®åºç½æ ¼ã\n\nDatabase Mesh çå³æ³¨éç¹å¨äºå¦ä½å°åå¸å¼çæ°æ®è®¿é®åºç¨ä¸æ°æ®åºææºä¸²èèµ·æ¥ï¼å®æ´å å³æ³¨çæ¯äº¤äºï¼æ¯å°æä¹±æ ç« çåºç¨ä¸æ°æ®åºä¹é´çäº¤äºè¿è¡ææå°æ¢³çã ä½¿ç¨ Database Meshï¼è®¿é®æ°æ®åºçåºç¨åæ°æ®åºç»å°å½¢æä¸ä¸ªå·¨å¤§çç½æ ¼ä½ç³»ï¼åºç¨åæ°æ®åºåªéå¨ç½æ ¼ä½ç³»ä¸­å¯¹å·å¥åº§å³å¯ï¼å®ä»¬é½æ¯è¢«å®åå±ææ²»ççå¯¹è±¡ã\n\n\n\nSHARDING-JDBC   SHARDING-PROXY   SHARDING-SIDECAR   \næ°æ®åº             ä»»æ               MySQL              MySQL\nè¿æ¥æ¶èæ°           é«                ä½                  é«\nå¼æè¯­è¨            ä» Java           ä»»æ                 ä»»æ\næ§è½              æèä½              æèç¥é«               æèä½\næ ä¸­å¿å            æ¯                å¦                  æ¯\néæå¥å£            æ                 æ                  æ \n\n# æ··åæ¶æ\n\nShardingSphere-JDBC éç¨æ ä¸­å¿åæ¶æï¼éç¨äº Java å¼åçé«æ§è½çè½»éçº§ OLTP åºç¨ï¼ShardingSphere-Proxy æä¾éæå¥å£ä»¥åå¼æè¯­è¨çæ¯æï¼éç¨äº OLAP åºç¨ä»¥åå¯¹åçæ°æ®åºè¿è¡ç®¡çåè¿ç»´çåºæ¯ã\n\nApache ShardingSphere æ¯å¤æ¥å¥ç«¯å±åç»æççæåã éè¿æ··åä½¿ç¨ ShardingSphere-JDBC å ShardingSphere-Proxyï¼å¹¶éç¨åä¸æ³¨åä¸­å¿ç»ä¸éç½®åçç­ç¥ï¼è½å¤çµæ´»çæ­å»ºéç¨äºåç§åºæ¯çåºç¨ç³»ç»ï¼ä½¿å¾æ¶æå¸æ´å èªç±å°è°æ´éåä¸å½åä¸å¡çæä½³ç³»ç»æ¶æã\n\n\n\n\n# åè½åè¡¨\n\n# æ°æ®åç\n\n * ååº & åè¡¨\n * è¯»ååç¦»\n * åçç­ç¥å®å¶å\n * æ ä¸­å¿ååå¸å¼ä¸»é®\n\n# åå¸å¼äºå¡\n\n * æ ååäºå¡æ¥å£\n * XA å¼ºä¸è´äºå¡\n * ææ§äºå¡\n\n# æ°æ®åºæ²»ç\n\n * åå¸å¼æ²»ç\n * å¼¹æ§ä¼¸ç¼©\n * å¯è§åé¾è·¯è¿½è¸ª\n * æ°æ®å å¯\n\n\n# åèèµæ\n\n * shardingsphere Github\n * shardingsphere å®æ¹ææ¡£",normalizedContent:"# shardingsphere ç®ä»\n\n\n# ç®ä»\n\n\n# shardingsphere ç»ä»¶\n\nshardingsphere æ¯ä¸å¥å¼æºçåå¸å¼æ°æ®åºä¸­é´ä»¶è§£å³æ¹æ¡ç»æççæåï¼å®ç± sharding-jdbcãsharding-proxy å sharding-sidecarï¼è®¡åä¸­ï¼è¿ 3 æ¬¾ç¸äºç¬ç«çäº§åç»æã ä»ä»¬åæä¾æ ååçæ°æ®åçãåå¸å¼äºå¡åæ°æ®åºæ²»çåè½ï¼å¯éç¨äºå¦ java åæãå¼æè¯­è¨ãäºåçç­åç§å¤æ ·åçåºç¨åºæ¯ã\n\n\n\n# shardingsphere-jdbc\n\nå®ä½ä¸ºè½»éçº§ java æ¡æ¶ï¼å¨ java ç jdbc å±æä¾çé¢å¤æå¡ã å®ä½¿ç¨å®¢æ·ç«¯ç´è¿æ°æ®åºï¼ä»¥ jar åå½¢å¼æä¾æå¡ï¼æ éé¢å¤é¨ç½²åä¾èµï¼å¯çè§£ä¸ºå¢å¼ºçç jdbc é©±å¨ï¼å®å¨å¼å®¹ jdbc ååç§ orm æ¡æ¶ã\n\n * éç¨äºä»»ä½åºäº jdbc ç orm æ¡æ¶ï¼å¦ï¼jpa, hibernate, mybatis, spring jdbc template æç´æ¥ä½¿ç¨ jdbcã\n * æ¯æä»»ä½ç¬¬ä¸æ¹çæ°æ®åºè¿æ¥æ± ï¼å¦ï¼dbcp, c3p0, bonecp, druid, hikaricp ç­ã\n * æ¯æä»»æå®ç° jdbc è§èçæ°æ®åºï¼ç®åæ¯æ mysqlï¼oracleï¼sqlserverï¼postgresql ä»¥åä»»ä½éµå¾ª sql92 æ åçæ°æ®åºã\n\n\n\n# sharding-proxy\n\nå®ä½ä¸ºéæåçæ°æ®åºä»£çç«¯ï¼æä¾å°è£äºæ°æ®åºäºè¿å¶åè®®çæå¡ç«¯çæ¬ï¼ç¨äºå®æå¯¹å¼æè¯­è¨çæ¯æã ç®åæä¾ mysql å postgresql çæ¬ï¼å®å¯ä»¥ä½¿ç¨ä»»ä½å¼å®¹ mysql/postgresql åè®®çè®¿é®å®¢æ·ç«¯(å¦ï¼mysql command client, mysql workbench, navicat ç­)æä½æ°æ®ï¼å¯¹ dba æ´å åå¥½ã\n\n * ååºç¨ç¨åºå®å¨éæï¼å¯ç´æ¥å½å mysql/postgresql ä½¿ç¨ã\n * éç¨äºä»»ä½å¼å®¹ mysql/postgresql åè®®ççå®¢æ·ç«¯ã\n\n\n\n# sharding-sidecarï¼todoï¼\n\nå®ä½ä¸º kubernetes çäºåçæ°æ®åºä»£çï¼ä»¥ sidecar çå½¢å¼ä»£çææå¯¹æ°æ®åºçè®¿é®ã éè¿æ ä¸­å¿ãé¶ä¾µå¥çæ¹æ¡æä¾ä¸æ°æ®åºäº¤äºççå®åå±ï¼å³ database meshï¼åå¯ç§°æ°æ®åºç½æ ¼ã\n\ndatabase mesh çå³æ³¨éç¹å¨äºå¦ä½å°åå¸å¼çæ°æ®è®¿é®åºç¨ä¸æ°æ®åºææºä¸²èèµ·æ¥ï¼å®æ´å å³æ³¨çæ¯äº¤äºï¼æ¯å°æä¹±æ ç« çåºç¨ä¸æ°æ®åºä¹é´çäº¤äºè¿è¡ææå°æ¢³çã ä½¿ç¨ database meshï¼è®¿é®æ°æ®åºçåºç¨åæ°æ®åºç»å°å½¢æä¸ä¸ªå·¨å¤§çç½æ ¼ä½ç³»ï¼åºç¨åæ°æ®åºåªéå¨ç½æ ¼ä½ç³»ä¸­å¯¹å·å¥åº§å³å¯ï¼å®ä»¬é½æ¯è¢«å®åå±ææ²»ççå¯¹è±¡ã\n\n\n\nsharding-jdbc   sharding-proxy   sharding-sidecar   \næ°æ®åº             ä»»æ               mysql              mysql\nè¿æ¥æ¶èæ°           é«                ä½                  é«\nå¼æè¯­è¨            ä» java           ä»»æ                 ä»»æ\næ§è½              æèä½              æèç¥é«               æèä½\næ ä¸­å¿å            æ¯                å¦                  æ¯\néæå¥å£            æ                 æ                  æ \n\n# æ··åæ¶æ\n\nshardingsphere-jdbc éç¨æ ä¸­å¿åæ¶æï¼éç¨äº java å¼åçé«æ§è½çè½»éçº§ oltp åºç¨ï¼shardingsphere-proxy æä¾éæå¥å£ä»¥åå¼æè¯­è¨çæ¯æï¼éç¨äº olap åºç¨ä»¥åå¯¹åçæ°æ®åºè¿è¡ç®¡çåè¿ç»´çåºæ¯ã\n\napache shardingsphere æ¯å¤æ¥å¥ç«¯å±åç»æççæåã éè¿æ··åä½¿ç¨ shardingsphere-jdbc å shardingsphere-proxyï¼å¹¶éç¨åä¸æ³¨åä¸­å¿ç»ä¸éç½®åçç­ç¥ï¼è½å¤çµæ´»çæ­å»ºéç¨äºåç§åºæ¯çåºç¨ç³»ç»ï¼ä½¿å¾æ¶æå¸æ´å èªç±å°è°æ´éåä¸å½åä¸å¡çæä½³ç³»ç»æ¶æã\n\n\n\n\n# åè½åè¡¨\n\n# æ°æ®åç\n\n * ååº & åè¡¨\n * è¯»ååç¦»\n * åçç­ç¥å®å¶å\n * æ ä¸­å¿ååå¸å¼ä¸»é®\n\n# åå¸å¼äºå¡\n\n * æ ååäºå¡æ¥å£\n * xa å¼ºä¸è´äºå¡\n * ææ§äºå¡\n\n# æ°æ®åºæ²»ç\n\n * åå¸å¼æ²»ç\n * å¼¹æ§ä¼¸ç¼©\n * å¯è§åé¾è·¯è¿½è¸ª\n * æ°æ®å å¯\n\n\n# åèèµæ\n\n * shardingsphere github\n * shardingsphere å®æ¹ææ¡£",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"ShardingSphere Jdbc",frontmatter:{title:"ShardingSphere Jdbc",date:"2020-12-28T00:01:28.000Z",categories:["æ°æ®åº","æ°æ®åºä¸­é´ä»¶","Shardingsphere"],tags:["æ°æ®åº","ä¸­é´ä»¶","ååºåè¡¨"],permalink:"/pages/8448de/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/02.%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%97%B4%E4%BB%B6/01.Shardingsphere/02.ShardingSphereJdbc.html",relativePath:"12.æ°æ®åº/02.æ°æ®åºä¸­é´ä»¶/01.Shardingsphere/02.ShardingSphereJdbc.md",key:"v-e3ca250c",path:"/pages/8448de/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:26},{level:2,title:"å¿«éå¥é¨",slug:"å¿«éå¥é¨",normalizedTitle:"å¿«éå¥é¨",charIndex:397},{level:3,title:"å¼å¥ maven ä¾èµ",slug:"å¼å¥-maven-ä¾èµ",normalizedTitle:"å¼å¥ maven ä¾èµ",charIndex:406},{level:3,title:"è§åéç½®",slug:"è§åéç½®",normalizedTitle:"è§åéç½®",charIndex:647},{level:3,title:"åå»ºæ°æ®æº",slug:"åå»ºæ°æ®æº",normalizedTitle:"åå»ºæ°æ®æº",charIndex:767},{level:2,title:"æ¦å¿µååè½",slug:"æ¦å¿µååè½",normalizedTitle:"æ¦å¿µååè½",charIndex:1041},{level:3,title:"åç´åç",slug:"åç´åç",normalizedTitle:"åç´åç",charIndex:1646},{level:3,title:"æ°´å¹³åç",slug:"æ°´å¹³åç",normalizedTitle:"æ°´å¹³åç",charIndex:1651},{level:3,title:"æ°æ®åçå¸¦æ¥çé®é¢",slug:"æ°æ®åçå¸¦æ¥çé®é¢",normalizedTitle:"æ°æ®åçå¸¦æ¥çé®é¢",charIndex:2157},{level:2,title:"ShardingSphere åæ ¸åæ",slug:"shardingsphere-åæ ¸åæ",normalizedTitle:"shardingsphere åæ ¸åæ",charIndex:2419},{level:3,title:"è§£æå¼æ",slug:"è§£æå¼æ",normalizedTitle:"è§£æå¼æ",charIndex:2914},{level:4,title:"æ½è±¡è¯­æ³æ ",slug:"æ½è±¡è¯­æ³æ ",normalizedTitle:"æ½è±¡è¯­æ³æ ",charIndex:2922},{level:4,title:"SQL è§£æå¼æ",slug:"sql-è§£æå¼æ",normalizedTitle:"sql è§£æå¼æ",charIndex:3502},{level:3,title:"è·¯ç±å¼æ",slug:"è·¯ç±å¼æ",normalizedTitle:"è·¯ç±å¼æ",charIndex:4289},{level:3,title:"æ¹åå¼æ",slug:"æ¹åå¼æ",normalizedTitle:"æ¹åå¼æ",charIndex:4298},{level:3,title:"æ§è¡å¼æ",slug:"æ§è¡å¼æ",normalizedTitle:"æ§è¡å¼æ",charIndex:4307},{level:3,title:"å½å¹¶å¼æ",slug:"å½å¹¶å¼æ",normalizedTitle:"å½å¹¶å¼æ",charIndex:4316}],headersStr:"ç®ä» å¿«éå¥é¨ å¼å¥ maven ä¾èµ è§åéç½® åå»ºæ°æ®æº æ¦å¿µååè½ åç´åç æ°´å¹³åç æ°æ®åçå¸¦æ¥çé®é¢ ShardingSphere åæ ¸åæ è§£æå¼æ æ½è±¡è¯­æ³æ  SQL è§£æå¼æ è·¯ç±å¼æ æ¹åå¼æ æ§è¡å¼æ å½å¹¶å¼æ",content:"# ShardingSphere Jdbc\n\n\n# ç®ä»\n\nshardingsphere-jdbc å®ä½ä¸ºè½»éçº§ Java æ¡æ¶ï¼å¨ Java ç JDBC å±æä¾çé¢å¤æå¡ã å®ä½¿ç¨å®¢æ·ç«¯ç´è¿æ°æ®åºï¼ä»¥ jar åå½¢å¼æä¾æå¡ï¼æ éé¢å¤é¨ç½²åä¾èµï¼å¯çè§£ä¸ºå¢å¼ºçç JDBC é©±å¨ï¼å®å¨å¼å®¹ JDBC ååç§ ORM æ¡æ¶ã\n\n * éç¨äºä»»ä½åºäº JDBC ç ORM æ¡æ¶ï¼å¦ï¼JPA, Hibernate, Mybatis, Spring JDBC Template æç´æ¥ä½¿ç¨ JDBCã\n * æ¯æä»»ä½ç¬¬ä¸æ¹çæ°æ®åºè¿æ¥æ± ï¼å¦ï¼DBCP, C3P0, BoneCP, Druid, HikariCP ç­ã\n * æ¯æä»»æå®ç° JDBC è§èçæ°æ®åºï¼ç®åæ¯æ MySQLï¼Oracleï¼SQLServerï¼PostgreSQL ä»¥åä»»ä½éµå¾ª SQL92 æ åçæ°æ®åºã\n\n\n\n\n# å¿«éå¥é¨\n\n\n# å¼å¥ maven ä¾èµ\n\n<dependency>\n    <groupId>org.apache.shardingsphere</groupId>\n    <artifactId>shardingsphere-jdbc-core</artifactId>\n    <version>${latest.release.version}</version>\n</dependency>\n\n\næ³¨æï¼è¯·å° ${latest.release.version} æ´æ¹ä¸ºå®éççæ¬å·ã\n\n\n# è§åéç½®\n\nShardingSphere-JDBC å¯ä»¥éè¿ Javaï¼YAMLï¼Spring å½åç©ºé´å Spring Boot Starter è¿ 4 ç§æ¹å¼è¿è¡éç½®ï¼å¼åèå¯æ ¹æ®åºæ¯éæ©éåçéç½®æ¹å¼ã è¯¦æè¯·åè§éç½®æåã\n\n\n# åå»ºæ°æ®æº\n\néè¿ ShardingSphereDataSourceFactory å·¥ååè§åéç½®å¯¹è±¡è·å ShardingSphereDataSourceã è¯¥å¯¹è±¡å®ç°èª JDBC çæ å DataSource æ¥å£ï¼å¯ç¨äºåç JDBC å¼åï¼æä½¿ç¨ JPA, MyBatis ç­ ORM ç±»åºã\n\nDataSource dataSource = ShardingSphereDataSourceFactory.createDataSource(dataSourceMap, configurations, properties);\n\n\n\n# æ¦å¿µååè½\n\nåä¸æ°æ®èç¹é¾äºæ»¡è¶³äºèç½çæµ·éæ°æ®åºæ¯ã\n\nä»æ§è½æ¹é¢æ¥è¯´ï¼ç±äºå³ç³»åæ°æ®åºå¤§å¤éç¨ B+ æ ç±»åçç´¢å¼ï¼å¨æ°æ®éè¶è¿éå¼çæåµä¸ï¼ç´¢å¼æ·±åº¦çå¢å ä¹å°ä½¿å¾ç£çè®¿é®ç IO æ¬¡æ°å¢å ï¼è¿èå¯¼è´æ¥è¯¢æ§è½çä¸éï¼åæ¶ï¼é«å¹¶åè®¿é®è¯·æ±ä¹ä½¿å¾éä¸­å¼æ°æ®åºæä¸ºç³»ç»çæå¤§ç¶é¢ã\n\nå¨ä¼ ç»çå³ç³»åæ°æ®åºæ æ³æ»¡è¶³äºèç½åºæ¯éè¦çæåµä¸ï¼å°æ°æ®å­å¨è³åçæ¯æåå¸å¼ç NoSQL çå°è¯è¶æ¥è¶å¤ã ä½ NoSQL å¯¹ SQL çä¸å¼å®¹æ§ä»¥åçæåçä¸å®åï¼ä½¿å¾å®ä»¬å¨ä¸å³ç³»åæ°æ®åºçåå¼ä¸­å§ç»æ æ³å®æè´å½ä¸å»ï¼èå³ç³»åæ°æ®åºçå°ä½å´ä¾ç¶ä¸å¯æ¼å¨ã\n\næ°æ®åçææç§æä¸ªç»´åº¦å°å­æ¾å¨åä¸æ°æ®åºä¸­çæ°æ®åæ£å°å­æ¾è³å¤ä¸ªæ°æ®åºæè¡¨ä¸­ä»¥è¾¾å°æåæ§è½ç¶é¢ä»¥åå¯ç¨æ§çææãæ°æ®åççææææ®µæ¯å¯¹å³ç³»åæ°æ®åºè¿è¡ååºååè¡¨ãååºååè¡¨åå¯ä»¥ææçé¿åç±æ°æ®éè¶è¿å¯æ¿åéå¼èäº§ççæ¥è¯¢ç¶é¢ã é¤æ­¤ä¹å¤ï¼ååºè¿è½å¤ç¨äºææçåæ£å¯¹æ°æ®åºåç¹çè®¿é®éï¼åè¡¨è½ç¶æ æ³ç¼è§£æ°æ®åºååï¼ä½å´è½å¤æä¾å°½éå°åå¸å¼äºå¡è½¬åä¸ºæ¬å°äºå¡çå¯è½ï¼ä¸æ¦æ¶åå°è·¨åºçæ´æ°æä½ï¼åå¸å¼äºå¡å¾å¾ä¼ä½¿é®é¢åå¾å¤æã ä½¿ç¨å¤ä¸»å¤ä»çåçæ¹å¼ï¼å¯ä»¥ææçé¿åæ°æ®åç¹ï¼ä»èæåæ°æ®æ¶æçå¯ç¨æ§ã\n\néè¿ååºååè¡¨è¿è¡æ°æ®çæåæ¥ä½¿å¾åä¸ªè¡¨çæ°æ®éä¿æå¨éå¼ä»¥ä¸ï¼ä»¥åå¯¹æµéè¿è¡çå¯¼åºå¯¹é«è®¿é®éï¼æ¯åºå¯¹é«å¹¶ååæµ·éæ°æ®ç³»ç»çææææ®µã æ°æ®åççæåæ¹å¼ååä¸ºåç´åçåæ°´å¹³åçã\n\n\n# åç´åç\n\næç§ä¸å¡æåçæ¹å¼ç§°ä¸ºåç´åçï¼åç§°ä¸ºçºµåæåï¼å®çæ ¸å¿çå¿µæ¯ä¸åºä¸ç¨ã å¨æåä¹åï¼ä¸ä¸ªæ°æ®åºç±å¤ä¸ªæ°æ®è¡¨ææï¼æ¯ä¸ªè¡¨å¯¹åºçä¸åçä¸å¡ãèæåä¹åï¼åæ¯æç§ä¸å¡å°è¡¨è¿è¡å½ç±»ï¼åå¸å°ä¸åçæ°æ®åºä¸­ï¼ä»èå°åååæ£è³ä¸åçæ°æ®åºã ä¸å¾å±ç¤ºäºæ ¹æ®ä¸å¡éè¦ï¼å°ç¨æ·è¡¨åè®¢åè¡¨åç´åçå°ä¸åçæ°æ®åºçæ¹æ¡ã\n\n\n\nåç´åçå¾å¾éè¦å¯¹æ¶æåè®¾è®¡è¿è¡è°æ´ãéå¸¸æ¥è®²ï¼æ¯æ¥ä¸ååºå¯¹äºèç½ä¸å¡éæ±å¿«éååçï¼èä¸ï¼å®ä¹å¹¶æ æ³çæ­£çè§£å³åç¹ç¶é¢ã åç´æåå¯ä»¥ç¼è§£æ°æ®éåè®¿é®éå¸¦æ¥çé®é¢ï¼ä½æ æ³æ ¹æ²»ãå¦æåç´æåä¹åï¼è¡¨ä¸­çæ°æ®éä¾ç¶è¶è¿åèç¹æè½æ¿è½½çéå¼ï¼åéè¦æ°´å¹³åçæ¥è¿ä¸æ­¥å¤çã\n\n\n# æ°´å¹³åç\n\næ°´å¹³åçåç§°ä¸ºæ¨ªåæåã ç¸å¯¹äºåç´åçï¼å®ä¸åå°æ°æ®æ ¹æ®ä¸å¡é»è¾åç±»ï¼èæ¯éè¿æä¸ªå­æ®µï¼ææå ä¸ªå­æ®µï¼ï¼æ ¹æ®æç§è§åå°æ°æ®åæ£è³å¤ä¸ªåºæè¡¨ä¸­ï¼æ¯ä¸ªåçä»åå«æ°æ®çä¸é¨åã ä¾å¦ï¼æ ¹æ®ä¸»é®åçï¼å¶æ°ä¸»é®çè®°å½æ¾å¥ 0 åºï¼æè¡¨ï¼ï¼å¥æ°ä¸»é®çè®°å½æ¾å¥ 1 åºï¼æè¡¨ï¼ï¼å¦ä¸å¾æç¤ºã\n\n\n\næ°´å¹³åçä»çè®ºä¸çªç ´äºåæºæ°æ®éå¤ççç¶é¢ï¼å¹¶ä¸æ©å±ç¸å¯¹èªç±ï¼æ¯ååºåè¡¨çæ åè§£å³æ¹æ¡ã\n\n\n# æ°æ®åçå¸¦æ¥çé®é¢\n\n * æ°æ®è·¯ç±ï¼éè¦ç¥éæ°æ®éè¦ä»åªä¸ªå·ä½çæ°æ®åºçåè¡¨ä¸­è·åã\n * SQL ä¸å¼å®¹ï¼åè¡¨å¯¼è´è¡¨åç§°çä¿®æ¹ï¼æèåé¡µãæåºãèåãåç»ç­æä½çä¸æ­£ç¡®å¤çã\n * è·¨åºäºå¡ï¼åçéç¨åè¡¨ï¼å¯ä»¥å¨éä½åè¡¨æ°æ®éçæåµä¸ï¼å°½éä½¿ç¨æ¬å°äºå¡ï¼åäºä½¿ç¨ååºä¸åè¡¨å¯ææé¿ååå¸å¼äºå¡å¸¦æ¥çéº»ç¦ã å¨ä¸è½é¿åè·¨åºäºå¡çåºæ¯ï¼æäºä¸å¡ä»ç¶éè¦ä¿æäºå¡çä¸è´æ§ã èåºäº XA çåå¸å¼äºå¡ç±äºå¨å¹¶ååº¦é«çåºæ¯ä¸­æ§è½æ æ³æ»¡è¶³éè¦ï¼å¹¶æªè¢«äºèç½å·¨å¤´å¤§è§æ¨¡ä½¿ç¨ï¼ä»ä»¬å¤§å¤éç¨æç»ä¸è´æ§çææ§äºå¡ä»£æ¿å¼ºä¸è´äºå¡ã\n\n\n# ShardingSphere åæ ¸åæ\n\nShardingSphere ç 3 ä¸ªäº§åçæ°æ®åçä¸»è¦æµç¨æ¯å®å¨ä¸è´çã æ ¸å¿ç± SQL è§£æ => æ§è¡å¨ä¼å => SQL è·¯ç± => SQL æ¹å => SQL æ§è¡ => ç»æå½å¹¶çæµç¨ç»æã\n\n\n\n * QL è§£æï¼åä¸ºè¯æ³è§£æåè¯­æ³è§£æã åéè¿è¯æ³è§£æå¨å° SQL æåä¸ºä¸ä¸ªä¸ªä¸å¯ååçåè¯ãåä½¿ç¨è¯­æ³è§£æå¨å¯¹ SQL è¿è¡çè§£ï¼å¹¶æç»æç¼åºè§£æä¸ä¸æã è§£æä¸ä¸æåæ¬è¡¨ãéæ©é¡¹ãæåºé¡¹ãåç»é¡¹ãèåå½æ°ãåé¡µä¿¡æ¯ãæ¥è¯¢æ¡ä»¶ä»¥åå¯è½éè¦ä¿®æ¹çå ä½ç¬¦çæ è®°ã\n * æ§è¡å¨ä¼åï¼åå¹¶åä¼ååçæ¡ä»¶ï¼å¦ OR ç­ã\n * SQL è·¯ç±ï¼æ ¹æ®è§£æä¸ä¸æå¹éç¨æ·éç½®çåçç­ç¥ï¼å¹¶çæè·¯ç±è·¯å¾ãç®åæ¯æåçè·¯ç±åå¹¿æ­è·¯ç±ã\n * SQL æ¹åï¼å° SQL æ¹åä¸ºå¨çå®æ°æ®åºä¸­å¯ä»¥æ­£ç¡®æ§è¡çè¯­å¥ãSQL æ¹ååä¸ºæ­£ç¡®æ§æ¹ååä¼åæ¹åã\n * SQL æ§è¡ï¼éè¿å¤çº¿ç¨æ§è¡å¨å¼æ­¥æ§è¡ã\n * ç»æå½å¹¶ï¼å°å¤ä¸ªæ§è¡ç»æéå½å¹¶ä»¥ä¾¿äºéè¿ç»ä¸ç JDBC æ¥å£è¾åºãç»æå½å¹¶åæ¬æµå¼å½å¹¶ãåå­å½å¹¶åä½¿ç¨è£é¥°æ¨¡å¼çè¿½å å½å¹¶è¿å ç§æ¹å¼ã\n\n\n# è§£æå¼æ\n\n# æ½è±¡è¯­æ³æ \n\nè§£æè¿ç¨åä¸ºè¯æ³è§£æåè¯­æ³è§£æã è¯æ³è§£æå¨ç¨äºå° SQL æè§£ä¸ºä¸å¯ååçåå­ç¬¦å·ï¼ç§°ä¸º Tokenãå¹¶æ ¹æ®ä¸åæ°æ®åºæ¹è¨ææä¾çå­å¸ï¼å°å¶å½ç±»ä¸ºå³é®å­ï¼è¡¨è¾¾å¼ï¼å­é¢éåæä½ç¬¦ã åä½¿ç¨è¯­æ³è§£æå¨å° SQL è½¬æ¢ä¸ºæ½è±¡è¯­æ³æ ã\n\nä¾å¦ï¼ä»¥ä¸ SQLï¼\n\nSELECT id, name FROM t_user WHERE status = 'ACTIVE' AND age > 18\n\n\nè§£æä¹åçä¸ºæ½è±¡è¯­æ³æ è§ä¸å¾ã\n\n\n\nä¸ºäºä¾¿äºçè§£ï¼æ½è±¡è¯­æ³æ ä¸­çå³é®å­ç Token ç¨ç»¿è²è¡¨ç¤ºï¼åéç Token ç¨çº¢è²è¡¨ç¤ºï¼ç°è²è¡¨ç¤ºéè¦è¿ä¸æ­¥æåã\n\næåï¼éè¿å¯¹æ½è±¡è¯­æ³æ çéåå»æç¼åçæéçä¸ä¸æï¼å¹¶æ è®°æå¯è½éè¦æ¹åçä½ç½®ã ä¾åçä½¿ç¨çè§£æä¸ä¸æåå«æ¥è¯¢éæ©é¡¹ï¼Select Itemsï¼ãè¡¨ä¿¡æ¯ï¼Tableï¼ãåçæ¡ä»¶ï¼Sharding Conditionï¼ãèªå¢ä¸»é®ä¿¡æ¯ï¼Auto increment Primary Keyï¼ãæåºä¿¡æ¯ï¼Order Byï¼ãåç»ä¿¡æ¯ï¼Group Byï¼ä»¥ååé¡µä¿¡æ¯ï¼LimitãRownumãTopï¼ã SQL çä¸æ¬¡è§£æè¿ç¨æ¯ä¸å¯éçï¼ä¸ä¸ªä¸ª Token æ SQL åæ¬çé¡ºåºä¾æ¬¡è¿è¡è§£æï¼æ§è½å¾é«ã èèå°åç§æ°æ®åº SQL æ¹è¨çå¼åï¼å¨è§£ææ¨¡åæä¾äºåç±»æ°æ®åºç SQL æ¹è¨å­å¸ã\n\n# SQL è§£æå¼æ\n\nSQL è§£æä½ä¸ºååºåè¡¨ç±»äº§åçæ ¸å¿ï¼å¶æ§è½åå¼å®¹æ§æ¯æéè¦çè¡¡éææ ã ShardingSphere ç SQL è§£æå¨ç»åäº 3 ä»£äº§åçæ´æ°è¿­ä»£ã\n\nç¬¬ä¸ä»£ SQL è§£æå¨ä¸ºäºè¿½æ±æ§è½ä¸å¿«éå®ç°ï¼å¨ 1.4.x ä¹åççæ¬ä½¿ç¨ Druid ä½ä¸º SQL è§£æå¨ãç»å®éæµè¯ï¼å®çæ§è½è¿è¶å¶å®è§£æå¨ã\n\nç¬¬äºä»£ SQL è§£æå¨ä» 1.5.x çæ¬å¼å§ï¼ShardingSphere éç¨å®å¨èªç ç SQL è§£æå¼æã ç±äºç®çä¸åï¼ShardingSphere å¹¶ä¸éè¦å° SQL è½¬ä¸ºä¸é¢å®å¨çæ½è±¡è¯­æ³æ ï¼ä¹æ ééè¿è®¿é®å¨æ¨¡å¼è¿è¡äºæ¬¡éåãå®éç¨å¯¹ SQL åçè§£çæ¹å¼ï¼ä»æç¼æ°æ®åçéè¦å³æ³¨çä¸ä¸æï¼å æ­¤ SQL è§£æçæ§è½åå¼å®¹æ§å¾å°äºè¿ä¸æ­¥çæé«ã\n\nç¬¬ä¸ä»£ SQL è§£æå¨åä» 3.0.x çæ¬å¼å§ï¼ShardingSphere å°è¯ä½¿ç¨ ANTLR ä½ä¸º SQL è§£æçå¼æï¼å¹¶è®¡åæ ¹æ® DDL -> TCL -> DAL â> DCL -> DML â>DQL è¿ä¸ªé¡ºåºï¼ä¾æ¬¡æ¿æ¢åæçè§£æå¼æï¼ç®åä»å¤äºæ¿æ¢è¿­ä»£ä¸­ã ä½¿ç¨ ANTLR çåå æ¯å¸æ ShardingSphere çè§£æå¼æè½å¤æ´å¥½çå¯¹ SQL è¿è¡å¼å®¹ãå¯¹äºå¤æçè¡¨è¾¾å¼ãéå½ãå­æ¥è¯¢ç­è¯­å¥ï¼è½ç¶ ShardingSphere çåçæ ¸å¿å¹¶ä¸å³æ³¨ï¼ä½æ¯ä¼å½±åå¯¹äº SQL çè§£çåå¥½åº¦ã ç»è¿å®ä¾æµè¯ï¼ANTLR è§£æ SQL çæ§è½æ¯èªç ç SQL è§£æå¼ææ¢ 3-10 åå·¦å³ãä¸ºäºå¼¥è¡¥è¿ä¸å·®è·ï¼ShardingSphere å°ä½¿ç¨ PreparedStatement ç SQL è§£æçè¯­æ³æ æ¾å¥ç¼å­ã å æ­¤å»ºè®®éç¨ PreparedStatement è¿ç§ SQL é¢ç¼è¯çæ¹å¼æåæ§è½ã\n\nç¬¬ä¸ä»£ SQL è§£æå¼æçæ´ä½ç»æååå¦ä¸å¾æç¤ºã\n\n\n\n\n# è·¯ç±å¼æ\n\n\n# æ¹åå¼æ\n\n\n# æ§è¡å¼æ\n\n\n# å½å¹¶å¼æ",normalizedContent:"# shardingsphere jdbc\n\n\n# ç®ä»\n\nshardingsphere-jdbc å®ä½ä¸ºè½»éçº§ java æ¡æ¶ï¼å¨ java ç jdbc å±æä¾çé¢å¤æå¡ã å®ä½¿ç¨å®¢æ·ç«¯ç´è¿æ°æ®åºï¼ä»¥ jar åå½¢å¼æä¾æå¡ï¼æ éé¢å¤é¨ç½²åä¾èµï¼å¯çè§£ä¸ºå¢å¼ºçç jdbc é©±å¨ï¼å®å¨å¼å®¹ jdbc ååç§ orm æ¡æ¶ã\n\n * éç¨äºä»»ä½åºäº jdbc ç orm æ¡æ¶ï¼å¦ï¼jpa, hibernate, mybatis, spring jdbc template æç´æ¥ä½¿ç¨ jdbcã\n * æ¯æä»»ä½ç¬¬ä¸æ¹çæ°æ®åºè¿æ¥æ± ï¼å¦ï¼dbcp, c3p0, bonecp, druid, hikaricp ç­ã\n * æ¯æä»»æå®ç° jdbc è§èçæ°æ®åºï¼ç®åæ¯æ mysqlï¼oracleï¼sqlserverï¼postgresql ä»¥åä»»ä½éµå¾ª sql92 æ åçæ°æ®åºã\n\n\n\n\n# å¿«éå¥é¨\n\n\n# å¼å¥ maven ä¾èµ\n\n<dependency>\n    <groupid>org.apache.shardingsphere</groupid>\n    <artifactid>shardingsphere-jdbc-core</artifactid>\n    <version>${latest.release.version}</version>\n</dependency>\n\n\næ³¨æï¼è¯·å° ${latest.release.version} æ´æ¹ä¸ºå®éççæ¬å·ã\n\n\n# è§åéç½®\n\nshardingsphere-jdbc å¯ä»¥éè¿ javaï¼yamlï¼spring å½åç©ºé´å spring boot starter è¿ 4 ç§æ¹å¼è¿è¡éç½®ï¼å¼åèå¯æ ¹æ®åºæ¯éæ©éåçéç½®æ¹å¼ã è¯¦æè¯·åè§éç½®æåã\n\n\n# åå»ºæ°æ®æº\n\néè¿ shardingspheredatasourcefactory å·¥ååè§åéç½®å¯¹è±¡è·å shardingspheredatasourceã è¯¥å¯¹è±¡å®ç°èª jdbc çæ å datasource æ¥å£ï¼å¯ç¨äºåç jdbc å¼åï¼æä½¿ç¨ jpa, mybatis ç­ orm ç±»åºã\n\ndatasource datasource = shardingspheredatasourcefactory.createdatasource(datasourcemap, configurations, properties);\n\n\n\n# æ¦å¿µååè½\n\nåä¸æ°æ®èç¹é¾äºæ»¡è¶³äºèç½çæµ·éæ°æ®åºæ¯ã\n\nä»æ§è½æ¹é¢æ¥è¯´ï¼ç±äºå³ç³»åæ°æ®åºå¤§å¤éç¨ b+ æ ç±»åçç´¢å¼ï¼å¨æ°æ®éè¶è¿éå¼çæåµä¸ï¼ç´¢å¼æ·±åº¦çå¢å ä¹å°ä½¿å¾ç£çè®¿é®ç io æ¬¡æ°å¢å ï¼è¿èå¯¼è´æ¥è¯¢æ§è½çä¸éï¼åæ¶ï¼é«å¹¶åè®¿é®è¯·æ±ä¹ä½¿å¾éä¸­å¼æ°æ®åºæä¸ºç³»ç»çæå¤§ç¶é¢ã\n\nå¨ä¼ ç»çå³ç³»åæ°æ®åºæ æ³æ»¡è¶³äºèç½åºæ¯éè¦çæåµä¸ï¼å°æ°æ®å­å¨è³åçæ¯æåå¸å¼ç nosql çå°è¯è¶æ¥è¶å¤ã ä½ nosql å¯¹ sql çä¸å¼å®¹æ§ä»¥åçæåçä¸å®åï¼ä½¿å¾å®ä»¬å¨ä¸å³ç³»åæ°æ®åºçåå¼ä¸­å§ç»æ æ³å®æè´å½ä¸å»ï¼èå³ç³»åæ°æ®åºçå°ä½å´ä¾ç¶ä¸å¯æ¼å¨ã\n\næ°æ®åçææç§æä¸ªç»´åº¦å°å­æ¾å¨åä¸æ°æ®åºä¸­çæ°æ®åæ£å°å­æ¾è³å¤ä¸ªæ°æ®åºæè¡¨ä¸­ä»¥è¾¾å°æåæ§è½ç¶é¢ä»¥åå¯ç¨æ§çææãæ°æ®åççææææ®µæ¯å¯¹å³ç³»åæ°æ®åºè¿è¡ååºååè¡¨ãååºååè¡¨åå¯ä»¥ææçé¿åç±æ°æ®éè¶è¿å¯æ¿åéå¼èäº§ççæ¥è¯¢ç¶é¢ã é¤æ­¤ä¹å¤ï¼ååºè¿è½å¤ç¨äºææçåæ£å¯¹æ°æ®åºåç¹çè®¿é®éï¼åè¡¨è½ç¶æ æ³ç¼è§£æ°æ®åºååï¼ä½å´è½å¤æä¾å°½éå°åå¸å¼äºå¡è½¬åä¸ºæ¬å°äºå¡çå¯è½ï¼ä¸æ¦æ¶åå°è·¨åºçæ´æ°æä½ï¼åå¸å¼äºå¡å¾å¾ä¼ä½¿é®é¢åå¾å¤æã ä½¿ç¨å¤ä¸»å¤ä»çåçæ¹å¼ï¼å¯ä»¥ææçé¿åæ°æ®åç¹ï¼ä»èæåæ°æ®æ¶æçå¯ç¨æ§ã\n\néè¿ååºååè¡¨è¿è¡æ°æ®çæåæ¥ä½¿å¾åä¸ªè¡¨çæ°æ®éä¿æå¨éå¼ä»¥ä¸ï¼ä»¥åå¯¹æµéè¿è¡çå¯¼åºå¯¹é«è®¿é®éï¼æ¯åºå¯¹é«å¹¶ååæµ·éæ°æ®ç³»ç»çææææ®µã æ°æ®åççæåæ¹å¼ååä¸ºåç´åçåæ°´å¹³åçã\n\n\n# åç´åç\n\næç§ä¸å¡æåçæ¹å¼ç§°ä¸ºåç´åçï¼åç§°ä¸ºçºµåæåï¼å®çæ ¸å¿çå¿µæ¯ä¸åºä¸ç¨ã å¨æåä¹åï¼ä¸ä¸ªæ°æ®åºç±å¤ä¸ªæ°æ®è¡¨ææï¼æ¯ä¸ªè¡¨å¯¹åºçä¸åçä¸å¡ãèæåä¹åï¼åæ¯æç§ä¸å¡å°è¡¨è¿è¡å½ç±»ï¼åå¸å°ä¸åçæ°æ®åºä¸­ï¼ä»èå°åååæ£è³ä¸åçæ°æ®åºã ä¸å¾å±ç¤ºäºæ ¹æ®ä¸å¡éè¦ï¼å°ç¨æ·è¡¨åè®¢åè¡¨åç´åçå°ä¸åçæ°æ®åºçæ¹æ¡ã\n\n\n\nåç´åçå¾å¾éè¦å¯¹æ¶æåè®¾è®¡è¿è¡è°æ´ãéå¸¸æ¥è®²ï¼æ¯æ¥ä¸ååºå¯¹äºèç½ä¸å¡éæ±å¿«éååçï¼èä¸ï¼å®ä¹å¹¶æ æ³çæ­£çè§£å³åç¹ç¶é¢ã åç´æåå¯ä»¥ç¼è§£æ°æ®éåè®¿é®éå¸¦æ¥çé®é¢ï¼ä½æ æ³æ ¹æ²»ãå¦æåç´æåä¹åï¼è¡¨ä¸­çæ°æ®éä¾ç¶è¶è¿åèç¹æè½æ¿è½½çéå¼ï¼åéè¦æ°´å¹³åçæ¥è¿ä¸æ­¥å¤çã\n\n\n# æ°´å¹³åç\n\næ°´å¹³åçåç§°ä¸ºæ¨ªåæåã ç¸å¯¹äºåç´åçï¼å®ä¸åå°æ°æ®æ ¹æ®ä¸å¡é»è¾åç±»ï¼èæ¯éè¿æä¸ªå­æ®µï¼ææå ä¸ªå­æ®µï¼ï¼æ ¹æ®æç§è§åå°æ°æ®åæ£è³å¤ä¸ªåºæè¡¨ä¸­ï¼æ¯ä¸ªåçä»åå«æ°æ®çä¸é¨åã ä¾å¦ï¼æ ¹æ®ä¸»é®åçï¼å¶æ°ä¸»é®çè®°å½æ¾å¥ 0 åºï¼æè¡¨ï¼ï¼å¥æ°ä¸»é®çè®°å½æ¾å¥ 1 åºï¼æè¡¨ï¼ï¼å¦ä¸å¾æç¤ºã\n\n\n\næ°´å¹³åçä»çè®ºä¸çªç ´äºåæºæ°æ®éå¤ççç¶é¢ï¼å¹¶ä¸æ©å±ç¸å¯¹èªç±ï¼æ¯ååºåè¡¨çæ åè§£å³æ¹æ¡ã\n\n\n# æ°æ®åçå¸¦æ¥çé®é¢\n\n * æ°æ®è·¯ç±ï¼éè¦ç¥éæ°æ®éè¦ä»åªä¸ªå·ä½çæ°æ®åºçåè¡¨ä¸­è·åã\n * sql ä¸å¼å®¹ï¼åè¡¨å¯¼è´è¡¨åç§°çä¿®æ¹ï¼æèåé¡µãæåºãèåãåç»ç­æä½çä¸æ­£ç¡®å¤çã\n * è·¨åºäºå¡ï¼åçéç¨åè¡¨ï¼å¯ä»¥å¨éä½åè¡¨æ°æ®éçæåµä¸ï¼å°½éä½¿ç¨æ¬å°äºå¡ï¼åäºä½¿ç¨ååºä¸åè¡¨å¯ææé¿ååå¸å¼äºå¡å¸¦æ¥çéº»ç¦ã å¨ä¸è½é¿åè·¨åºäºå¡çåºæ¯ï¼æäºä¸å¡ä»ç¶éè¦ä¿æäºå¡çä¸è´æ§ã èåºäº xa çåå¸å¼äºå¡ç±äºå¨å¹¶ååº¦é«çåºæ¯ä¸­æ§è½æ æ³æ»¡è¶³éè¦ï¼å¹¶æªè¢«äºèç½å·¨å¤´å¤§è§æ¨¡ä½¿ç¨ï¼ä»ä»¬å¤§å¤éç¨æç»ä¸è´æ§çææ§äºå¡ä»£æ¿å¼ºä¸è´äºå¡ã\n\n\n# shardingsphere åæ ¸åæ\n\nshardingsphere ç 3 ä¸ªäº§åçæ°æ®åçä¸»è¦æµç¨æ¯å®å¨ä¸è´çã æ ¸å¿ç± sql è§£æ => æ§è¡å¨ä¼å => sql è·¯ç± => sql æ¹å => sql æ§è¡ => ç»æå½å¹¶çæµç¨ç»æã\n\n\n\n * ql è§£æï¼åä¸ºè¯æ³è§£æåè¯­æ³è§£æã åéè¿è¯æ³è§£æå¨å° sql æåä¸ºä¸ä¸ªä¸ªä¸å¯ååçåè¯ãåä½¿ç¨è¯­æ³è§£æå¨å¯¹ sql è¿è¡çè§£ï¼å¹¶æç»æç¼åºè§£æä¸ä¸æã è§£æä¸ä¸æåæ¬è¡¨ãéæ©é¡¹ãæåºé¡¹ãåç»é¡¹ãèåå½æ°ãåé¡µä¿¡æ¯ãæ¥è¯¢æ¡ä»¶ä»¥åå¯è½éè¦ä¿®æ¹çå ä½ç¬¦çæ è®°ã\n * æ§è¡å¨ä¼åï¼åå¹¶åä¼ååçæ¡ä»¶ï¼å¦ or ç­ã\n * sql è·¯ç±ï¼æ ¹æ®è§£æä¸ä¸æå¹éç¨æ·éç½®çåçç­ç¥ï¼å¹¶çæè·¯ç±è·¯å¾ãç®åæ¯æåçè·¯ç±åå¹¿æ­è·¯ç±ã\n * sql æ¹åï¼å° sql æ¹åä¸ºå¨çå®æ°æ®åºä¸­å¯ä»¥æ­£ç¡®æ§è¡çè¯­å¥ãsql æ¹ååä¸ºæ­£ç¡®æ§æ¹ååä¼åæ¹åã\n * sql æ§è¡ï¼éè¿å¤çº¿ç¨æ§è¡å¨å¼æ­¥æ§è¡ã\n * ç»æå½å¹¶ï¼å°å¤ä¸ªæ§è¡ç»æéå½å¹¶ä»¥ä¾¿äºéè¿ç»ä¸ç jdbc æ¥å£è¾åºãç»æå½å¹¶åæ¬æµå¼å½å¹¶ãåå­å½å¹¶åä½¿ç¨è£é¥°æ¨¡å¼çè¿½å å½å¹¶è¿å ç§æ¹å¼ã\n\n\n# è§£æå¼æ\n\n# æ½è±¡è¯­æ³æ \n\nè§£æè¿ç¨åä¸ºè¯æ³è§£æåè¯­æ³è§£æã è¯æ³è§£æå¨ç¨äºå° sql æè§£ä¸ºä¸å¯ååçåå­ç¬¦å·ï¼ç§°ä¸º tokenãå¹¶æ ¹æ®ä¸åæ°æ®åºæ¹è¨ææä¾çå­å¸ï¼å°å¶å½ç±»ä¸ºå³é®å­ï¼è¡¨è¾¾å¼ï¼å­é¢éåæä½ç¬¦ã åä½¿ç¨è¯­æ³è§£æå¨å° sql è½¬æ¢ä¸ºæ½è±¡è¯­æ³æ ã\n\nä¾å¦ï¼ä»¥ä¸ sqlï¼\n\nselect id, name from t_user where status = 'active' and age > 18\n\n\nè§£æä¹åçä¸ºæ½è±¡è¯­æ³æ è§ä¸å¾ã\n\n\n\nä¸ºäºä¾¿äºçè§£ï¼æ½è±¡è¯­æ³æ ä¸­çå³é®å­ç token ç¨ç»¿è²è¡¨ç¤ºï¼åéç token ç¨çº¢è²è¡¨ç¤ºï¼ç°è²è¡¨ç¤ºéè¦è¿ä¸æ­¥æåã\n\næåï¼éè¿å¯¹æ½è±¡è¯­æ³æ çéåå»æç¼åçæéçä¸ä¸æï¼å¹¶æ è®°æå¯è½éè¦æ¹åçä½ç½®ã ä¾åçä½¿ç¨çè§£æä¸ä¸æåå«æ¥è¯¢éæ©é¡¹ï¼select itemsï¼ãè¡¨ä¿¡æ¯ï¼tableï¼ãåçæ¡ä»¶ï¼sharding conditionï¼ãèªå¢ä¸»é®ä¿¡æ¯ï¼auto increment primary keyï¼ãæåºä¿¡æ¯ï¼order byï¼ãåç»ä¿¡æ¯ï¼group byï¼ä»¥ååé¡µä¿¡æ¯ï¼limitãrownumãtopï¼ã sql çä¸æ¬¡è§£æè¿ç¨æ¯ä¸å¯éçï¼ä¸ä¸ªä¸ª token æ sql åæ¬çé¡ºåºä¾æ¬¡è¿è¡è§£æï¼æ§è½å¾é«ã èèå°åç§æ°æ®åº sql æ¹è¨çå¼åï¼å¨è§£ææ¨¡åæä¾äºåç±»æ°æ®åºç sql æ¹è¨å­å¸ã\n\n# sql è§£æå¼æ\n\nsql è§£æä½ä¸ºååºåè¡¨ç±»äº§åçæ ¸å¿ï¼å¶æ§è½åå¼å®¹æ§æ¯æéè¦çè¡¡éææ ã shardingsphere ç sql è§£æå¨ç»åäº 3 ä»£äº§åçæ´æ°è¿­ä»£ã\n\nç¬¬ä¸ä»£ sql è§£æå¨ä¸ºäºè¿½æ±æ§è½ä¸å¿«éå®ç°ï¼å¨ 1.4.x ä¹åççæ¬ä½¿ç¨ druid ä½ä¸º sql è§£æå¨ãç»å®éæµè¯ï¼å®çæ§è½è¿è¶å¶å®è§£æå¨ã\n\nç¬¬äºä»£ sql è§£æå¨ä» 1.5.x çæ¬å¼å§ï¼shardingsphere éç¨å®å¨èªç ç sql è§£æå¼æã ç±äºç®çä¸åï¼shardingsphere å¹¶ä¸éè¦å° sql è½¬ä¸ºä¸é¢å®å¨çæ½è±¡è¯­æ³æ ï¼ä¹æ ééè¿è®¿é®å¨æ¨¡å¼è¿è¡äºæ¬¡éåãå®éç¨å¯¹ sql åçè§£çæ¹å¼ï¼ä»æç¼æ°æ®åçéè¦å³æ³¨çä¸ä¸æï¼å æ­¤ sql è§£æçæ§è½åå¼å®¹æ§å¾å°äºè¿ä¸æ­¥çæé«ã\n\nç¬¬ä¸ä»£ sql è§£æå¨åä» 3.0.x çæ¬å¼å§ï¼shardingsphere å°è¯ä½¿ç¨ antlr ä½ä¸º sql è§£æçå¼æï¼å¹¶è®¡åæ ¹æ® ddl -> tcl -> dal â> dcl -> dml â>dql è¿ä¸ªé¡ºåºï¼ä¾æ¬¡æ¿æ¢åæçè§£æå¼æï¼ç®åä»å¤äºæ¿æ¢è¿­ä»£ä¸­ã ä½¿ç¨ antlr çåå æ¯å¸æ shardingsphere çè§£æå¼æè½å¤æ´å¥½çå¯¹ sql è¿è¡å¼å®¹ãå¯¹äºå¤æçè¡¨è¾¾å¼ãéå½ãå­æ¥è¯¢ç­è¯­å¥ï¼è½ç¶ shardingsphere çåçæ ¸å¿å¹¶ä¸å³æ³¨ï¼ä½æ¯ä¼å½±åå¯¹äº sql çè§£çåå¥½åº¦ã ç»è¿å®ä¾æµè¯ï¼antlr è§£æ sql çæ§è½æ¯èªç ç sql è§£æå¼ææ¢ 3-10 åå·¦å³ãä¸ºäºå¼¥è¡¥è¿ä¸å·®è·ï¼shardingsphere å°ä½¿ç¨ preparedstatement ç sql è§£æçè¯­æ³æ æ¾å¥ç¼å­ã å æ­¤å»ºè®®éç¨ preparedstatement è¿ç§ sql é¢ç¼è¯çæ¹å¼æåæ§è½ã\n\nç¬¬ä¸ä»£ sql è§£æå¼æçæ´ä½ç»æååå¦ä¸å¾æç¤ºã\n\n\n\n\n# è·¯ç±å¼æ\n\n\n# æ¹åå¼æ\n\n\n# æ§è¡å¼æ\n\n\n# å½å¹¶å¼æ",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"æ°æ®åºç»¼å",frontmatter:{title:"æ°æ®åºç»¼å",date:"2022-04-11T16:52:35.000Z",categories:["æ°æ®åº","æ°æ®åºç»¼å"],tags:["æ°æ®åº","ç»¼å"],permalink:"/pages/3c3c45/",hidden:!0},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/01.%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%BC%E5%90%88/",relativePath:"12.æ°æ®åº/01.æ°æ®åºç»¼å/README.md",key:"v-4c53fba0",path:"/pages/3c3c45/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:12},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:51},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:61}],headersStr:"ð åå®¹ ð èµæ ðª ä¼ é",content:"# æ°æ®åºç»¼å\n\n\n# ð åå®¹\n\n * Nosql ææ¯éå\n * æ°æ®ç»æä¸æ°æ®åºç´¢å¼\n\n\n# ð èµæ\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç IT ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",normalizedContent:"# æ°æ®åºç»¼å\n\n\n# ð åå®¹\n\n * nosql ææ¯éå\n * æ°æ®ç»æä¸æ°æ®åºç´¢å¼\n\n\n# ð èµæ\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç it ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"çæ¬ç®¡çä¸­é´ä»¶ Flyway",frontmatter:{title:"çæ¬ç®¡çä¸­é´ä»¶ Flyway",date:"2019-08-22T09:02:39.000Z",categories:["æ°æ®åº","æ°æ®åºä¸­é´ä»¶"],tags:["æ°æ®åº","ä¸­é´ä»¶","çæ¬ç®¡ç"],permalink:"/pages/e2648c/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/02.%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%97%B4%E4%BB%B6/02.Flyway.html",relativePath:"12.æ°æ®åº/02.æ°æ®åºä¸­é´ä»¶/02.Flyway.md",key:"v-1a0fef38",path:"/pages/e2648c/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:42},{level:3,title:"ä»ä¹æ¯ Flyway",slug:"ä»ä¹æ¯-flyway",normalizedTitle:"ä»ä¹æ¯ flyway",charIndex:49},{level:3,title:"ä¸ºä»ä¹è¦ä½¿ç¨æ°æ®è¿ç§»",slug:"ä¸ºä»ä¹è¦ä½¿ç¨æ°æ®è¿ç§»",normalizedTitle:"ä¸ºä»ä¹è¦ä½¿ç¨æ°æ®è¿ç§»",charIndex:87},{level:3,title:"Flyway å¦ä½å·¥ä½ï¼",slug:"flyway-å¦ä½å·¥ä½",normalizedTitle:"flyway å¦ä½å·¥ä½ï¼",charIndex:599},{level:2,title:"å¿«éä¸æ",slug:"å¿«éä¸æ",normalizedTitle:"å¿«éä¸æ",charIndex:1123},{level:3,title:"å½ä»¤è¡",slug:"å½ä»¤è¡",normalizedTitle:"å½ä»¤è¡",charIndex:1151},{level:3,title:"JAVA API",slug:"java-api",normalizedTitle:"java api",charIndex:1158},{level:3,title:"Maven",slug:"maven",normalizedTitle:"maven",charIndex:1170},{level:3,title:"Gradle",slug:"gradle",normalizedTitle:"gradle",charIndex:1179},{level:2,title:"å¥é¨ç¯",slug:"å¥é¨ç¯",normalizedTitle:"å¥é¨ç¯",charIndex:5358},{level:3,title:"æ¦å¿µ",slug:"æ¦å¿µ",normalizedTitle:"æ¦å¿µ",charIndex:5366},{level:4,title:"Migrations",slug:"migrations",normalizedTitle:"migrations",charIndex:5372},{level:5,title:"Versioned migrations",slug:"versioned-migrations",normalizedTitle:"versioned migrations",charIndex:5439},{level:5,title:"Undo migrations",slug:"undo-migrations",normalizedTitle:"undo migrations",charIndex:6025},{level:5,title:"Repeatable migrations",slug:"repeatable-migrations",normalizedTitle:"repeatable migrations",charIndex:5462},{level:5,title:"åºäº SQL ç migrations",slug:"åºäº-sql-ç-migrations",normalizedTitle:"åºäº sql ç migrations",charIndex:6563},{level:5,title:"åºäº JAVA ç migrations",slug:"åºäº-java-ç-migrations",normalizedTitle:"åºäº java ç migrations",charIndex:7073},{level:4,title:"Callbacks",slug:"callbacks",normalizedTitle:"callbacks",charIndex:7529},{level:5,title:"SQL Callbacks",slug:"sql-callbacks",normalizedTitle:"sql callbacks",charIndex:7736},{level:5,title:"JAVA Callbacks",slug:"java-callbacks",normalizedTitle:"java callbacks",charIndex:8083},{level:4,title:"Error Handlers",slug:"error-handlers",normalizedTitle:"error handlers",charIndex:8571},{level:4,title:"Dry Runs",slug:"dry-runs",normalizedTitle:"dry runs",charIndex:8607},{level:3,title:"å½ä»¤",slug:"å½ä»¤",normalizedTitle:"å½ä»¤",charIndex:1151},{level:3,title:"æ¯æçæ°æ®åº",slug:"æ¯æçæ°æ®åº",normalizedTitle:"æ¯æçæ°æ®åº",charIndex:8744},{level:2,title:"èµæ",slug:"èµæ",normalizedTitle:"èµæ",charIndex:8921},{level:2,title:"ðª ä¼ éé¨",slug:"ä¼ éé¨",normalizedTitle:"ðª ä¼ éé¨",charIndex:8947}],headersStr:"ç®ä» ä»ä¹æ¯ Flyway ä¸ºä»ä¹è¦ä½¿ç¨æ°æ®è¿ç§» Flyway å¦ä½å·¥ä½ï¼ å¿«éä¸æ å½ä»¤è¡ JAVA API Maven Gradle å¥é¨ç¯ æ¦å¿µ Migrations Versioned migrations Undo migrations Repeatable migrations åºäº SQL ç migrations åºäº JAVA ç migrations Callbacks SQL Callbacks JAVA Callbacks Error Handlers Dry Runs å½ä»¤ æ¯æçæ°æ®åº èµæ ðª ä¼ éé¨",content:'# çæ¬ç®¡çä¸­é´ä»¶ Flyway\n\n> Flyway æ¯ä¸ä¸ªæ°æ®è¿ç§»å·¥å·ã\n\n\n# ç®ä»\n\n\n# ä»ä¹æ¯ Flyway\n\nFlyway æ¯ä¸ä¸ªå¼æºçæ°æ®åºè¿ç§»å·¥å·ã\n\n\n# ä¸ºä»ä¹è¦ä½¿ç¨æ°æ®è¿ç§»\n\nä¸ºäºè¯´ææ°æ®è¿ç§»çä½ç¨ï¼æä»¬æ¥ä¸¾ä¸ä¸ªç¤ºä¾ï¼\n\nï¼1ï¼åè®¾ï¼æä¸ä¸ªå«å Shiny çé¡¹ç®ï¼å®çæ¶ææ¯ä¸ä¸ªå«å Shiny Soft ç App è¿æ¥å«å Shiny DB çæ°æ®åºã\n\nï¼2ï¼å¯¹äºå¤§å¤æ°é¡¹ç®èè¨ï¼æç®åçæç»­éæåºæ¯å¦ä¸æç¤ºï¼\n\n\n\nè¿æå³çï¼æä»¬ä¸ä»ä»è¦å¤çä¸ä»½ç¯å¢ä¸­çä¿®æ¹ï¼ç±æ­¤ä¼å¼å¥ä¸äºçæ¬å²çªé®é¢ï¼\n\nå¨ä»£ç ä¾§ï¼å³åºç¨è½¯ä»¶ï¼ççæ¬é®é¢æ¯è¾å®¹æè§£å³ï¼\n\n * ææ¹ä¾¿ççæ¬æ§å¶å·¥å·\n * æå¯å¤ç¨çæå»ºåæç»­éæ\n * è§èçåå¸åé¨ç½²è¿ç¨\n\né£ä¹ï¼æ°æ®åºå±é¢ççæ¬é®é¢å¦ä½è§£å³å¢ï¼\n\nç®åä»ç¶æ²¡ææ¹ä¾¿çæ°æ®åºçæ¬å·¥å·ãè®¸å¤é¡¹ç®ä»ä½¿ç¨ sql èæ¬æ¥è§£å³çæ¬å²çªï¼çè³æ¯éå°å²çªé®é¢æ¶ææ³èµ·ç¨ sql è¯­å¥å»è§£å³ã\n\nç±æ­¤ï¼å¼åä¸äºé®é¢ï¼\n\n * æºå¨ä¸çæ°æ®åºæ¯ä»ä¹ç¶æï¼\n * èæ¬å°åºçææ²¡æï¼\n * çäº§ç¯å¢ä¿®å¤çé®é¢æ¯å¦ä¹å¨æµè¯ç¯å¢ä¿®å¤äºï¼\n * å¦ä½å»ºç«ä¸ä¸ªæ°çæ°æ®åºå®ä¾ï¼\n\næ°æ®è¿ç§»å°±æ¯ç¨æ¥æå®è¿äºæ··ä¹±çé®é¢ï¼\n\n * éè¿èç¨¿éå»ºä¸ä¸ªæ°æ®åºã\n * å¨ä»»ä½æ¶åé½å¯ä»¥æ¸æ¥çäºè§£æ°æ®åºçç¶æã\n * ä»¥ä¸ç§æç¡®çæ¹å¼å°æ°æ®åºä»å½åçæ¬è¿ç§»å°ä¸ä¸ªæ°çæ¬ã\n\n\n# Flyway å¦ä½å·¥ä½ï¼\n\næç®åçåºæ¯æ¯æå® Flyway è¿ç§»å°ä¸ä¸ªç©ºçæ°æ®åºã\n\n\n\nFlyway ä¼å°è¯æ¥æ¾å®ç schema åå²è¡¨ï¼å¦ææ°æ®åºæ¯ç©ºçï¼Flyway å°±ä¸åæ¥æ¾ï¼èæ¯ç´æ¥åå»ºæ°æ®åºã\n\nç°åä½ å°±æäºä¸ä¸ªä»åå«ä¸å¼ ç©ºè¡¨çæ°æ®åºï¼é»è®¤æåµä¸ï¼è¿å¼ è¡¨å« flyway_schema_historyã\n\n\n\nè¿å¼ è¡¨å°è¢«ç¨äºè¿½è¸ªæ°æ®åºçç¶æã\n\nç¶åï¼Flyway å°å¼å§æ«ææä»¶ç³»ç»æåºç¨ classpath ä¸­ç migrationsãè¿äº migrations å¯ä»¥æ¯ sql æ javaã\n\nè¿äº migrations å°æ ¹æ®ä»ä»¬ççæ¬å·è¿è¡æåºã\n\n\n\nä»»æ migration åºç¨åï¼schema åå²è¡¨å°æ´æ°ãå½åæ°æ®ååå§ç¶ææ¿æ¢åï¼å¯ä»¥ç§°ä¹ä¸ºï¼è¿ç§»å°æ°çæ¬ã\n\nFlyway ä¸æ¦æ«æäºæä»¶ç³»ç»æåºç¨ classpath ä¸ç migrationsï¼è¿äº migrations ä¼æ£æ¥ schema åå²è¡¨ãå¦æå®ä»¬ççæ¬å·ä½äºæç­äºå½åççæ¬ï¼å°è¢«å¿½ç¥ãä¿çä¸æ¥ç migrations æ¯ç­å¾ç migrationsï¼ææä½æ²¡æåºç¨ã\n\n\n\nmigrations å°æ ¹æ®çæ¬å·æåºå¹¶æåºæ§è¡ã\n\n\n\n\n# å¿«éä¸æ\n\nFlyway æ 4 ç§ä½¿ç¨æ¹å¼ï¼\n\n * å½ä»¤è¡\n * JAVA API\n * Maven\n * Gradle\n\n\n# å½ä»¤è¡\n\néç¨äºé Java ç¨æ·ï¼æ éæå»ºã\n\n> flyway migrate -url=... -user=... -password=...\n\n\nï¼1ï¼ä¸è½½è§£å\n\nè¿å¥å®æ¹ä¸è½½é¡µé¢ï¼éæ©åéçæ¬ï¼ä¸è½½å¹¶è§£åå°æ¬å°ã\n\nï¼2ï¼éç½® flyway\n\nç¼è¾ /conf/flyway.confï¼\n\nflyway.url=jdbc:h2:file:./foobardb\nflyway.user=SA\nflyway.password=\n\n\nï¼3ï¼åå»ºç¬¬ä¸ä¸ª migration\n\nå¨ /sql ç®å½ä¸åå»º V1__Create_person_table.sql æä»¶ï¼åå®¹å¦ä¸ï¼\n\ncreate table PERSON (\n    ID int not null,\n    NAME varchar(100) not null\n);\n\n\nï¼4ï¼è¿ç§»æ°æ®åº\n\nè¿è¡ Flyway æ¥è¿ç§»æ°æ®åºï¼\n\nflyway-5.1.4> flyway migrate\n\n\nè¿è¡æ­£å¸¸çæåµä¸ï¼åºè¯¥å¯ä»¥çå°å¦ä¸ç»æï¼\n\nDatabase: jdbc:h2:file:./foobardb (H2 1.4)\nSuccessfully validated 1 migration (execution time 00:00.008s)\nCreating Schema History table: "PUBLIC"."flyway_schema_history"\nCurrent version of schema "PUBLIC": << Empty Schema >>\nMigrating schema "PUBLIC" to version 1 - Create person table\nSuccessfully applied 1 migration to schema "PUBLIC" (execution time 00:00.033s)\n\n\nï¼5ï¼æ·»å ç¬¬äºä¸ª migration\n\nå¨ /sql ç®å½ä¸åå»º V2__Add_people.sql æä»¶ï¼åå®¹å¦ä¸ï¼\n\ninsert into PERSON (ID, NAME) values (1, \'Axel\');\ninsert into PERSON (ID, NAME) values (2, \'Mr. Foo\');\ninsert into PERSON (ID, NAME) values (3, \'Ms. Bar\');\n\n\nè¿è¡ Flyway\n\nflyway-5.1.4> flyway migrate\n\n\nè¿è¡æ­£å¸¸çæåµä¸ï¼åºè¯¥å¯ä»¥çå°å¦ä¸ç»æï¼\n\nDatabase: jdbc:h2:file:./foobardb (H2 1.4)\nSuccessfully validated 2 migrations (execution time 00:00.018s)\nCurrent version of schema "PUBLIC": 1\nMigrating schema "PUBLIC" to version 2 - Add people\nSuccessfully applied 1 migration to schema "PUBLIC" (execution time 00:00.016s)\n\n\n\n# JAVA API\n\nï¼1ï¼åå¤\n\n * Java8+\n * Maven 3.x\n\nï¼2ï¼æ·»å ä¾èµ\n\nå¨ pom.xml ä¸­æ·»å ä¾èµï¼\n\n<project ...>\n    ...\n    <dependencies>\n        <dependency>\n            <groupId>org.flywaydb</groupId>\n            <artifactId>flyway-core</artifactId>\n            <version>5.1.4</version>\n        </dependency>\n        <dependency>\n            <groupId>com.h2database</groupId>\n            <artifactId>h2</artifactId>\n            <version>1.3.170</version>\n        </dependency>\n        ...\n    </dependencies>\n    ...\n</project>\n\n\nï¼3ï¼éæ Flyway\n\næ·»å  App.java æä»¶ï¼åå®¹å¦ä¸ï¼\n\nimport org.flywaydb.core.Flyway;\n\npublic class App {\n    public static void main(String[] args) {\n        // Create the Flyway instance\n        Flyway flyway = new Flyway();\n\n        // Point it to the database\n        flyway.setDataSource("jdbc:h2:file:./target/foobar", "sa", null);\n\n        // Start the migration\n        flyway.migrate();\n    }\n}\n\n\nï¼4ï¼åå»ºç¬¬ä¸ä¸ª migration\n\næ·»å  src/main/resources/db/migration/V1__Create_person_table.sql æä»¶ï¼åå®¹å¦ä¸ï¼\n\ncreate table PERSON (\n    ID int not null,\n    NAME varchar(100) not null\n);\n\n\nï¼5ï¼æ§è¡ç¨åº\n\næ§è¡ App#mainï¼\n\nè¿è¡æ­£å¸¸çæåµä¸ï¼åºè¯¥å¯ä»¥çå°å¦ä¸ç»æï¼\n\nINFO: Creating schema history table: "PUBLIC"."flyway_schema_history"\nINFO: Current version of schema "PUBLIC": << Empty Schema >>\nINFO: Migrating schema "PUBLIC" to version 1 - Create person table\nINFO: Successfully applied 1 migration to schema "PUBLIC" (execution time 00:00.062s).\n\n\nï¼6ï¼æ·»å ç¬¬äºä¸ª migration\n\næ·»å  src/main/resources/db/migration/V2__Add_people.sql æä»¶ï¼åå®¹å¦ä¸ï¼\n\ninsert into PERSON (ID, NAME) values (1, \'Axel\');\ninsert into PERSON (ID, NAME) values (2, \'Mr. Foo\');\ninsert into PERSON (ID, NAME) values (3, \'Ms. Bar\');\n\n\nè¿è¡æ­£å¸¸çæåµä¸ï¼åºè¯¥å¯ä»¥çå°å¦ä¸ç»æï¼\n\nINFO: Current version of schema "PUBLIC": 1\nINFO: Migrating schema "PUBLIC" to version 2 - Add people\nINFO: Successfully applied 1 migration to schema "PUBLIC" (execution time 00:00.090s).\n\n\n\n# Maven\n\nä¸ Java API æ¹å¼å¤§ä½ç¸åï¼åºå«å¨ éæ Flyway æ­¥éª¤ï¼\n\nMaven æ¹å¼ä½¿ç¨æä»¶æ¥éæ Flywayï¼\n\n<project xmlns="...">\n    ...\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.flywaydb</groupId>\n                <artifactId>flyway-maven-plugin</artifactId>\n                <version>5.1.4</version>\n                <configuration>\n                    <url>jdbc:h2:file:./target/foobar</url>\n                    <user>sa</user>\n                </configuration>\n                <dependencies>\n                    <dependency>\n                        <groupId>com.h2database</groupId>\n                        <artifactId>h2</artifactId>\n                        <version>1.4.191</version>\n                    </dependency>\n                </dependencies>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n\n\nå ä¸ºç¨çæ¯æä»¶ï¼æä»¥æ§è¡æ¹å¼ä¸åæ¯è¿è¡ Java ç±»ï¼èæ¯æ§è¡ maven æä»¶ï¼\n\n> mvn flyway:migrate\n\n\n> ð åèï¼ç¤ºä¾æºç \n\n\n# Gradle\n\næ¬äººä¸ç¨ Gradleï¼ç¥ã\n\n\n# å¥é¨ç¯\n\n\n# æ¦å¿µ\n\n# Migrations\n\nå¨ Flyway ä¸­ï¼å¯¹äºæ°æ®åºçä»»ä½æ¹åé½ç§°ä¹ä¸º Migrationsã\n\nMigrations å¯ä»¥åä¸º Versioned migrations å Repeatable migrationsã\n\nVersioned migrations æ 2 ç§å½¢å¼ï¼regular å undoã\n\nVersioned migrations å Repeatable migrations é½å¯ä»¥ä½¿ç¨ SQL æ JAVA æ¥ç¼åã\n\n# Versioned migrations\n\nç±ä¸ä¸ªçæ¬å·ï¼versionï¼ãä¸æ®µæè¿°ï¼descriptionï¼ãä¸ä¸ªæ ¡éªï¼checksumï¼ç»æãçæ¬å·å¿é¡»æ¯æä¸çãVersioned migrations åªè½æé¡ºåºæ§è¡ä¸æ¬¡ã\n\nä¸è¬ç¨äºï¼\n\n * å¢å æ¹ tables/indexes/foreign keys/enums/UDTsã\n * å¼ç¨æ°æ®æ´æ°\n * ç¨æ·æ°æ®æ ¡æ­£\n\nRegular ç¤ºä¾ï¼\n\nCREATE TABLE car (\n    id INT NOT NULL PRIMARY KEY,\n    license_plate VARCHAR NOT NULL,\n    color VARCHAR NOT NULL\n);\n\nALTER TABLE owner ADD driver_license_id VARCHAR;\n\nINSERT INTO brand (name) VALUES (\'DeLorean\');\n\n\n# Undo migrations\n\n> æ³¨ï¼ä»ä¸ä¸çæ¯æ\n\nUndo Versioned Migrations è´è´£æ¤é Regular Versioned migrations çå½±åã\n\nUndo ç¤ºä¾ï¼\n\nDELETE FROM brand WHERE name=\'DeLorean\';\n\nALTER TABLE owner DROP driver_license_id;\n\nDROP TABLE car;\n\n\n# Repeatable migrations\n\nç±ä¸æ®µæè¿°ï¼descriptionï¼ãä¸ä¸ªæ ¡éªï¼checksumï¼ç»æãVersioned migrations æ¯æ¬¡æ§è¡åï¼æ ¡éªï¼checksumï¼ä¼æ´æ°ã\n\nRepeatable migrations ç¨äºç®¡çå¯ä»¥éè¿ä¸ä¸ªæä»¶æ¥ç»´æ¤çæ¬æ§å¶çæ°æ®åºå¯¹è±¡ã\n\nä¸è¬ç¨äºï¼\n\n * åå»ºï¼éå»ºï¼views/procedures/functions/packages ç­ã\n * å¤§éå¼ç¨æ°æ®éæ°æå¥\n\nç¤ºä¾ï¼\n\nCREATE OR REPLACE VIEW blue_cars AS\n    SELECT id, license_plate FROM cars WHERE color=\'blue\';\n\n\n# åºäº SQL ç migrations\n\nmigrations æå¸¸ç¨çç¼åå½¢å¼å°±æ¯ SQLã\n\nåºäº SQL ç migrations ä¸è¬ç¨äºï¼\n\n * DDL åæ´ï¼éå¯¹ TABLES,VIEWS,TRIGGERS,SEQUENCES ç­ç CREATE/ALTER/DROP æä½ï¼\n * ç®åçå¼ç¨æ°æ®åæ´ï¼å¼ç¨æ°æ®è¡¨ä¸­ç CRUDï¼\n * ç®åçå¤§éæ°æ®åæ´ï¼å¸¸è§æ°æ®è¡¨ä¸­ç CRUDï¼\n\nå½åè§å\n\nä¸ºäºè¢« Flyway èªå¨è¯å«ï¼SQL migrations çæä»¶å½åå¿é¡»éµå¾ªè§å®çæ¨¡å¼ï¼\n\n\n\n * Prefix - V ä»£è¡¨ versioned migrations (å¯éç½®), U ä»£è¡¨ undo migrations (å¯éç½®)ã R ä»£è¡¨ repeatable migrations (å¯éç½®)\n * Version - çæ¬å·éè¿.(ç¹)æ_(ä¸åçº¿)åé (repeatable migrations ä¸éè¦)\n * Separator - __ (ä¸¤ä¸ªä¸åçº¿) (å¯éç½®)\n * Description - ä¸åçº¿æç©ºæ ¼åéçåè¯\n * Suffix - .sql (å¯éç½®)\n\n# åºäº JAVA ç migrations\n\nåºäº JAVA ç migrations éç¨äºä½¿ç¨ SQL ä¸å®¹æè¡¨è¾¾çåºæ¯ï¼\n\n * BLOB å CLOB åæ´\n * å¤§éæ°æ®çé«çº§åæ´ï¼éæ°è®¡ç®ãé«çº§æ ¼å¼åæ´ï¼\n\nå½åè§å\n\nä¸ºäºè¢« Flyway èªå¨è¯å«ï¼JAVA migrations çæä»¶å½åå¿é¡»éµå¾ªè§å®çæ¨¡å¼ï¼\n\n\n\n * Prefix - V ä»£è¡¨ versioned migrations (å¯éç½®), U ä»£è¡¨ undo migrations (å¯éç½®)ã R ä»£è¡¨ repeatable migrations (å¯éç½®)\n * Version - çæ¬å·éè¿.(ç¹)æ_(ä¸åçº¿)åé (repeatable migrations ä¸éè¦)\n * Separator - __ (ä¸¤ä¸ªä¸åçº¿) (å¯éç½®)\n * Description - ä¸åçº¿æç©ºæ ¼åéçåè¯\n\n> ð æ´å¤ç»èè¯·åèï¼https://flywaydb.org/documentation/migrations\n\n# Callbacks\n\n> æ³¨ï¼é¨å events ä»ä¸ä¸çæ¯æã\n\nå°½ç®¡ Migrations å¯è½å·²ç»æ»¡è¶³ç»å¤§é¨ååºæ¯çéè¦ï¼ä½æ¯æäºæåµä¸éè¦ä½ ä¸éåä¸éçæ§è¡ç¸åçè¡ä¸ºãè¿å¯è½ä¼éæ°ç¼è¯å­å¨è¿ç¨ï¼æ´æ°è§å¾ä»¥åè®¸å¤å¶ä»ç±»åçå¼éã\n\nå ä¸ºä»¥ä¸åå ï¼Flyway æä¾äº Callbacksï¼ç¨äºå¨ Migrations çå½å¨æä¸­æ·»å é©å­ã\n\nCallbacks å¯ä»¥ç¨ SQL æ JAVA æ¥å®ç°ã\n\n# SQL Callbacks\n\nSQL Callbacks çå½åè§åä¸ºï¼event å + SQL migrationã\n\nå¦ï¼ beforeMigrate.sql, beforeEachMigrate.sql, afterEachMigrate.sql ç­ã\n\nSQL Callbacks ä¹å¯ä»¥åå«æè¿°ï¼descriptionï¼ãè¿ç§æåµä¸ï¼SQL Callbacks æä»¶å = event å + åéç¬¦ + æè¿° + åç¼ãä¾ï¼beforeRepair__vacuum.sql\n\nå½åä¸ä¸ª event æå¤ä¸ª SQL callbacksï¼å°æç§å®ä»¬æè¿°ï¼descriptionï¼çé¡ºåºæ§è¡ã\n\n> æ³¨ï¼ Flyway ä¹æ¯æä½ éç½®ç sqlMigrationSuffixesã\n\n# JAVA Callbacks\n\n> å½ SQL Callbacks ä¸å¤æ¹ä¾¿æ¶ï¼æåºèè JAVA Callbacksã\n\nJAVA Callbacks æ 3 ç§å½¢å¼ï¼\n\n 1. åºäº Java ç Migrations - å®ç° JdbcMigrationãSpringJdbcMigrationãMigrationInfoProviderãMigrationChecksumProviderãConfigurationAwareãFlywayConfiguration\n 2. åºäº Java ç Callbacks - å®ç° org.flywaydb.core.api.callback æ¥å£ã\n 3. èªå®ä¹ Migration resolvers å executors - å®ç° MigrationResolverãMigrationExecutorãConfigurationAwareãFlywayConfiguration æ¥å£ã\n\n> ð æ´å¤ç»èè¯·åèï¼https://flywaydb.org/documentation/callbacks\n\n# Error Handlers\n\n> æ³¨ï¼ä»ä¸ä¸çæ¯æã\n\nï¼ç¥ï¼\n\n# Dry Runs\n\n> æ³¨ï¼ä»ä¸ä¸çæ¯æã\n\nï¼ç¥ï¼\n\n\n# å½ä»¤\n\nFlyway çåè½ä¸»è¦å´ç»ç 7 ä¸ªåºæ¬å½ä»¤ï¼MigrateãCleanãInfoãValidateãUndoãBaseline å Repairã\n\næ³¨ï¼åå½ä»¤çä½¿ç¨æ¹æ³ç»èè¯·æ¥éå®æ¹ææ¡£ã\n\n\n# æ¯æçæ°æ®åº\n\n * Oracle\n * SQL Server\n * DB2\n * MySQL\n * MariaDB\n * PostgreSQL\n * Redshift\n * CockroachDB\n * SAP HANA\n * Sybase ASE\n * Informix\n * H2\n * HSQLDB\n * Derby\n * SQLite\n\n\n# èµæ\n\n| Github | å®æ¹ææ¡£ |\n\n\n# ðª ä¼ éé¨\n\n| éæçåå®¢ | db-tutorial é¦é¡µ |',normalizedContent:'# çæ¬ç®¡çä¸­é´ä»¶ flyway\n\n> flyway æ¯ä¸ä¸ªæ°æ®è¿ç§»å·¥å·ã\n\n\n# ç®ä»\n\n\n# ä»ä¹æ¯ flyway\n\nflyway æ¯ä¸ä¸ªå¼æºçæ°æ®åºè¿ç§»å·¥å·ã\n\n\n# ä¸ºä»ä¹è¦ä½¿ç¨æ°æ®è¿ç§»\n\nä¸ºäºè¯´ææ°æ®è¿ç§»çä½ç¨ï¼æä»¬æ¥ä¸¾ä¸ä¸ªç¤ºä¾ï¼\n\nï¼1ï¼åè®¾ï¼æä¸ä¸ªå«å shiny çé¡¹ç®ï¼å®çæ¶ææ¯ä¸ä¸ªå«å shiny soft ç app è¿æ¥å«å shiny db çæ°æ®åºã\n\nï¼2ï¼å¯¹äºå¤§å¤æ°é¡¹ç®èè¨ï¼æç®åçæç»­éæåºæ¯å¦ä¸æç¤ºï¼\n\n\n\nè¿æå³çï¼æä»¬ä¸ä»ä»è¦å¤çä¸ä»½ç¯å¢ä¸­çä¿®æ¹ï¼ç±æ­¤ä¼å¼å¥ä¸äºçæ¬å²çªé®é¢ï¼\n\nå¨ä»£ç ä¾§ï¼å³åºç¨è½¯ä»¶ï¼ççæ¬é®é¢æ¯è¾å®¹æè§£å³ï¼\n\n * ææ¹ä¾¿ççæ¬æ§å¶å·¥å·\n * æå¯å¤ç¨çæå»ºåæç»­éæ\n * è§èçåå¸åé¨ç½²è¿ç¨\n\né£ä¹ï¼æ°æ®åºå±é¢ççæ¬é®é¢å¦ä½è§£å³å¢ï¼\n\nç®åä»ç¶æ²¡ææ¹ä¾¿çæ°æ®åºçæ¬å·¥å·ãè®¸å¤é¡¹ç®ä»ä½¿ç¨ sql èæ¬æ¥è§£å³çæ¬å²çªï¼çè³æ¯éå°å²çªé®é¢æ¶ææ³èµ·ç¨ sql è¯­å¥å»è§£å³ã\n\nç±æ­¤ï¼å¼åä¸äºé®é¢ï¼\n\n * æºå¨ä¸çæ°æ®åºæ¯ä»ä¹ç¶æï¼\n * èæ¬å°åºçææ²¡æï¼\n * çäº§ç¯å¢ä¿®å¤çé®é¢æ¯å¦ä¹å¨æµè¯ç¯å¢ä¿®å¤äºï¼\n * å¦ä½å»ºç«ä¸ä¸ªæ°çæ°æ®åºå®ä¾ï¼\n\næ°æ®è¿ç§»å°±æ¯ç¨æ¥æå®è¿äºæ··ä¹±çé®é¢ï¼\n\n * éè¿èç¨¿éå»ºä¸ä¸ªæ°æ®åºã\n * å¨ä»»ä½æ¶åé½å¯ä»¥æ¸æ¥çäºè§£æ°æ®åºçç¶æã\n * ä»¥ä¸ç§æç¡®çæ¹å¼å°æ°æ®åºä»å½åçæ¬è¿ç§»å°ä¸ä¸ªæ°çæ¬ã\n\n\n# flyway å¦ä½å·¥ä½ï¼\n\næç®åçåºæ¯æ¯æå® flyway è¿ç§»å°ä¸ä¸ªç©ºçæ°æ®åºã\n\n\n\nflyway ä¼å°è¯æ¥æ¾å®ç schema åå²è¡¨ï¼å¦ææ°æ®åºæ¯ç©ºçï¼flyway å°±ä¸åæ¥æ¾ï¼èæ¯ç´æ¥åå»ºæ°æ®åºã\n\nç°åä½ å°±æäºä¸ä¸ªä»åå«ä¸å¼ ç©ºè¡¨çæ°æ®åºï¼é»è®¤æåµä¸ï¼è¿å¼ è¡¨å« flyway_schema_historyã\n\n\n\nè¿å¼ è¡¨å°è¢«ç¨äºè¿½è¸ªæ°æ®åºçç¶æã\n\nç¶åï¼flyway å°å¼å§æ«ææä»¶ç³»ç»æåºç¨ classpath ä¸­ç migrationsãè¿äº migrations å¯ä»¥æ¯ sql æ javaã\n\nè¿äº migrations å°æ ¹æ®ä»ä»¬ççæ¬å·è¿è¡æåºã\n\n\n\nä»»æ migration åºç¨åï¼schema åå²è¡¨å°æ´æ°ãå½åæ°æ®ååå§ç¶ææ¿æ¢åï¼å¯ä»¥ç§°ä¹ä¸ºï¼è¿ç§»å°æ°çæ¬ã\n\nflyway ä¸æ¦æ«æäºæä»¶ç³»ç»æåºç¨ classpath ä¸ç migrationsï¼è¿äº migrations ä¼æ£æ¥ schema åå²è¡¨ãå¦æå®ä»¬ççæ¬å·ä½äºæç­äºå½åççæ¬ï¼å°è¢«å¿½ç¥ãä¿çä¸æ¥ç migrations æ¯ç­å¾ç migrationsï¼ææä½æ²¡æåºç¨ã\n\n\n\nmigrations å°æ ¹æ®çæ¬å·æåºå¹¶æåºæ§è¡ã\n\n\n\n\n# å¿«éä¸æ\n\nflyway æ 4 ç§ä½¿ç¨æ¹å¼ï¼\n\n * å½ä»¤è¡\n * java api\n * maven\n * gradle\n\n\n# å½ä»¤è¡\n\néç¨äºé java ç¨æ·ï¼æ éæå»ºã\n\n> flyway migrate -url=... -user=... -password=...\n\n\nï¼1ï¼ä¸è½½è§£å\n\nè¿å¥å®æ¹ä¸è½½é¡µé¢ï¼éæ©åéçæ¬ï¼ä¸è½½å¹¶è§£åå°æ¬å°ã\n\nï¼2ï¼éç½® flyway\n\nç¼è¾ /conf/flyway.confï¼\n\nflyway.url=jdbc:h2:file:./foobardb\nflyway.user=sa\nflyway.password=\n\n\nï¼3ï¼åå»ºç¬¬ä¸ä¸ª migration\n\nå¨ /sql ç®å½ä¸åå»º v1__create_person_table.sql æä»¶ï¼åå®¹å¦ä¸ï¼\n\ncreate table person (\n    id int not null,\n    name varchar(100) not null\n);\n\n\nï¼4ï¼è¿ç§»æ°æ®åº\n\nè¿è¡ flyway æ¥è¿ç§»æ°æ®åºï¼\n\nflyway-5.1.4> flyway migrate\n\n\nè¿è¡æ­£å¸¸çæåµä¸ï¼åºè¯¥å¯ä»¥çå°å¦ä¸ç»æï¼\n\ndatabase: jdbc:h2:file:./foobardb (h2 1.4)\nsuccessfully validated 1 migration (execution time 00:00.008s)\ncreating schema history table: "public"."flyway_schema_history"\ncurrent version of schema "public": << empty schema >>\nmigrating schema "public" to version 1 - create person table\nsuccessfully applied 1 migration to schema "public" (execution time 00:00.033s)\n\n\nï¼5ï¼æ·»å ç¬¬äºä¸ª migration\n\nå¨ /sql ç®å½ä¸åå»º v2__add_people.sql æä»¶ï¼åå®¹å¦ä¸ï¼\n\ninsert into person (id, name) values (1, \'axel\');\ninsert into person (id, name) values (2, \'mr. foo\');\ninsert into person (id, name) values (3, \'ms. bar\');\n\n\nè¿è¡ flyway\n\nflyway-5.1.4> flyway migrate\n\n\nè¿è¡æ­£å¸¸çæåµä¸ï¼åºè¯¥å¯ä»¥çå°å¦ä¸ç»æï¼\n\ndatabase: jdbc:h2:file:./foobardb (h2 1.4)\nsuccessfully validated 2 migrations (execution time 00:00.018s)\ncurrent version of schema "public": 1\nmigrating schema "public" to version 2 - add people\nsuccessfully applied 1 migration to schema "public" (execution time 00:00.016s)\n\n\n\n# java api\n\nï¼1ï¼åå¤\n\n * java8+\n * maven 3.x\n\nï¼2ï¼æ·»å ä¾èµ\n\nå¨ pom.xml ä¸­æ·»å ä¾èµï¼\n\n<project ...>\n    ...\n    <dependencies>\n        <dependency>\n            <groupid>org.flywaydb</groupid>\n            <artifactid>flyway-core</artifactid>\n            <version>5.1.4</version>\n        </dependency>\n        <dependency>\n            <groupid>com.h2database</groupid>\n            <artifactid>h2</artifactid>\n            <version>1.3.170</version>\n        </dependency>\n        ...\n    </dependencies>\n    ...\n</project>\n\n\nï¼3ï¼éæ flyway\n\næ·»å  app.java æä»¶ï¼åå®¹å¦ä¸ï¼\n\nimport org.flywaydb.core.flyway;\n\npublic class app {\n    public static void main(string[] args) {\n        // create the flyway instance\n        flyway flyway = new flyway();\n\n        // point it to the database\n        flyway.setdatasource("jdbc:h2:file:./target/foobar", "sa", null);\n\n        // start the migration\n        flyway.migrate();\n    }\n}\n\n\nï¼4ï¼åå»ºç¬¬ä¸ä¸ª migration\n\næ·»å  src/main/resources/db/migration/v1__create_person_table.sql æä»¶ï¼åå®¹å¦ä¸ï¼\n\ncreate table person (\n    id int not null,\n    name varchar(100) not null\n);\n\n\nï¼5ï¼æ§è¡ç¨åº\n\næ§è¡ app#mainï¼\n\nè¿è¡æ­£å¸¸çæåµä¸ï¼åºè¯¥å¯ä»¥çå°å¦ä¸ç»æï¼\n\ninfo: creating schema history table: "public"."flyway_schema_history"\ninfo: current version of schema "public": << empty schema >>\ninfo: migrating schema "public" to version 1 - create person table\ninfo: successfully applied 1 migration to schema "public" (execution time 00:00.062s).\n\n\nï¼6ï¼æ·»å ç¬¬äºä¸ª migration\n\næ·»å  src/main/resources/db/migration/v2__add_people.sql æä»¶ï¼åå®¹å¦ä¸ï¼\n\ninsert into person (id, name) values (1, \'axel\');\ninsert into person (id, name) values (2, \'mr. foo\');\ninsert into person (id, name) values (3, \'ms. bar\');\n\n\nè¿è¡æ­£å¸¸çæåµä¸ï¼åºè¯¥å¯ä»¥çå°å¦ä¸ç»æï¼\n\ninfo: current version of schema "public": 1\ninfo: migrating schema "public" to version 2 - add people\ninfo: successfully applied 1 migration to schema "public" (execution time 00:00.090s).\n\n\n\n# maven\n\nä¸ java api æ¹å¼å¤§ä½ç¸åï¼åºå«å¨ éæ flyway æ­¥éª¤ï¼\n\nmaven æ¹å¼ä½¿ç¨æä»¶æ¥éæ flywayï¼\n\n<project xmlns="...">\n    ...\n    <build>\n        <plugins>\n            <plugin>\n                <groupid>org.flywaydb</groupid>\n                <artifactid>flyway-maven-plugin</artifactid>\n                <version>5.1.4</version>\n                <configuration>\n                    <url>jdbc:h2:file:./target/foobar</url>\n                    <user>sa</user>\n                </configuration>\n                <dependencies>\n                    <dependency>\n                        <groupid>com.h2database</groupid>\n                        <artifactid>h2</artifactid>\n                        <version>1.4.191</version>\n                    </dependency>\n                </dependencies>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n\n\nå ä¸ºç¨çæ¯æä»¶ï¼æä»¥æ§è¡æ¹å¼ä¸åæ¯è¿è¡ java ç±»ï¼èæ¯æ§è¡ maven æä»¶ï¼\n\n> mvn flyway:migrate\n\n\n> ð åèï¼ç¤ºä¾æºç \n\n\n# gradle\n\næ¬äººä¸ç¨ gradleï¼ç¥ã\n\n\n# å¥é¨ç¯\n\n\n# æ¦å¿µ\n\n# migrations\n\nå¨ flyway ä¸­ï¼å¯¹äºæ°æ®åºçä»»ä½æ¹åé½ç§°ä¹ä¸º migrationsã\n\nmigrations å¯ä»¥åä¸º versioned migrations å repeatable migrationsã\n\nversioned migrations æ 2 ç§å½¢å¼ï¼regular å undoã\n\nversioned migrations å repeatable migrations é½å¯ä»¥ä½¿ç¨ sql æ java æ¥ç¼åã\n\n# versioned migrations\n\nç±ä¸ä¸ªçæ¬å·ï¼versionï¼ãä¸æ®µæè¿°ï¼descriptionï¼ãä¸ä¸ªæ ¡éªï¼checksumï¼ç»æãçæ¬å·å¿é¡»æ¯æä¸çãversioned migrations åªè½æé¡ºåºæ§è¡ä¸æ¬¡ã\n\nä¸è¬ç¨äºï¼\n\n * å¢å æ¹ tables/indexes/foreign keys/enums/udtsã\n * å¼ç¨æ°æ®æ´æ°\n * ç¨æ·æ°æ®æ ¡æ­£\n\nregular ç¤ºä¾ï¼\n\ncreate table car (\n    id int not null primary key,\n    license_plate varchar not null,\n    color varchar not null\n);\n\nalter table owner add driver_license_id varchar;\n\ninsert into brand (name) values (\'delorean\');\n\n\n# undo migrations\n\n> æ³¨ï¼ä»ä¸ä¸çæ¯æ\n\nundo versioned migrations è´è´£æ¤é regular versioned migrations çå½±åã\n\nundo ç¤ºä¾ï¼\n\ndelete from brand where name=\'delorean\';\n\nalter table owner drop driver_license_id;\n\ndrop table car;\n\n\n# repeatable migrations\n\nç±ä¸æ®µæè¿°ï¼descriptionï¼ãä¸ä¸ªæ ¡éªï¼checksumï¼ç»æãversioned migrations æ¯æ¬¡æ§è¡åï¼æ ¡éªï¼checksumï¼ä¼æ´æ°ã\n\nrepeatable migrations ç¨äºç®¡çå¯ä»¥éè¿ä¸ä¸ªæä»¶æ¥ç»´æ¤çæ¬æ§å¶çæ°æ®åºå¯¹è±¡ã\n\nä¸è¬ç¨äºï¼\n\n * åå»ºï¼éå»ºï¼views/procedures/functions/packages ç­ã\n * å¤§éå¼ç¨æ°æ®éæ°æå¥\n\nç¤ºä¾ï¼\n\ncreate or replace view blue_cars as\n    select id, license_plate from cars where color=\'blue\';\n\n\n# åºäº sql ç migrations\n\nmigrations æå¸¸ç¨çç¼åå½¢å¼å°±æ¯ sqlã\n\nåºäº sql ç migrations ä¸è¬ç¨äºï¼\n\n * ddl åæ´ï¼éå¯¹ tables,views,triggers,sequences ç­ç create/alter/drop æä½ï¼\n * ç®åçå¼ç¨æ°æ®åæ´ï¼å¼ç¨æ°æ®è¡¨ä¸­ç crudï¼\n * ç®åçå¤§éæ°æ®åæ´ï¼å¸¸è§æ°æ®è¡¨ä¸­ç crudï¼\n\nå½åè§å\n\nä¸ºäºè¢« flyway èªå¨è¯å«ï¼sql migrations çæä»¶å½åå¿é¡»éµå¾ªè§å®çæ¨¡å¼ï¼\n\n\n\n * prefix - v ä»£è¡¨ versioned migrations (å¯éç½®), u ä»£è¡¨ undo migrations (å¯éç½®)ã r ä»£è¡¨ repeatable migrations (å¯éç½®)\n * version - çæ¬å·éè¿.(ç¹)æ_(ä¸åçº¿)åé (repeatable migrations ä¸éè¦)\n * separator - __ (ä¸¤ä¸ªä¸åçº¿) (å¯éç½®)\n * description - ä¸åçº¿æç©ºæ ¼åéçåè¯\n * suffix - .sql (å¯éç½®)\n\n# åºäº java ç migrations\n\nåºäº java ç migrations éç¨äºä½¿ç¨ sql ä¸å®¹æè¡¨è¾¾çåºæ¯ï¼\n\n * blob å clob åæ´\n * å¤§éæ°æ®çé«çº§åæ´ï¼éæ°è®¡ç®ãé«çº§æ ¼å¼åæ´ï¼\n\nå½åè§å\n\nä¸ºäºè¢« flyway èªå¨è¯å«ï¼java migrations çæä»¶å½åå¿é¡»éµå¾ªè§å®çæ¨¡å¼ï¼\n\n\n\n * prefix - v ä»£è¡¨ versioned migrations (å¯éç½®), u ä»£è¡¨ undo migrations (å¯éç½®)ã r ä»£è¡¨ repeatable migrations (å¯éç½®)\n * version - çæ¬å·éè¿.(ç¹)æ_(ä¸åçº¿)åé (repeatable migrations ä¸éè¦)\n * separator - __ (ä¸¤ä¸ªä¸åçº¿) (å¯éç½®)\n * description - ä¸åçº¿æç©ºæ ¼åéçåè¯\n\n> ð æ´å¤ç»èè¯·åèï¼https://flywaydb.org/documentation/migrations\n\n# callbacks\n\n> æ³¨ï¼é¨å events ä»ä¸ä¸çæ¯æã\n\nå°½ç®¡ migrations å¯è½å·²ç»æ»¡è¶³ç»å¤§é¨ååºæ¯çéè¦ï¼ä½æ¯æäºæåµä¸éè¦ä½ ä¸éåä¸éçæ§è¡ç¸åçè¡ä¸ºãè¿å¯è½ä¼éæ°ç¼è¯å­å¨è¿ç¨ï¼æ´æ°è§å¾ä»¥åè®¸å¤å¶ä»ç±»åçå¼éã\n\nå ä¸ºä»¥ä¸åå ï¼flyway æä¾äº callbacksï¼ç¨äºå¨ migrations çå½å¨æä¸­æ·»å é©å­ã\n\ncallbacks å¯ä»¥ç¨ sql æ java æ¥å®ç°ã\n\n# sql callbacks\n\nsql callbacks çå½åè§åä¸ºï¼event å + sql migrationã\n\nå¦ï¼ beforemigrate.sql, beforeeachmigrate.sql, aftereachmigrate.sql ç­ã\n\nsql callbacks ä¹å¯ä»¥åå«æè¿°ï¼descriptionï¼ãè¿ç§æåµä¸ï¼sql callbacks æä»¶å = event å + åéç¬¦ + æè¿° + åç¼ãä¾ï¼beforerepair__vacuum.sql\n\nå½åä¸ä¸ª event æå¤ä¸ª sql callbacksï¼å°æç§å®ä»¬æè¿°ï¼descriptionï¼çé¡ºåºæ§è¡ã\n\n> æ³¨ï¼ flyway ä¹æ¯æä½ éç½®ç sqlmigrationsuffixesã\n\n# java callbacks\n\n> å½ sql callbacks ä¸å¤æ¹ä¾¿æ¶ï¼æåºèè java callbacksã\n\njava callbacks æ 3 ç§å½¢å¼ï¼\n\n 1. åºäº java ç migrations - å®ç° jdbcmigrationãspringjdbcmigrationãmigrationinfoproviderãmigrationchecksumproviderãconfigurationawareãflywayconfiguration\n 2. åºäº java ç callbacks - å®ç° org.flywaydb.core.api.callback æ¥å£ã\n 3. èªå®ä¹ migration resolvers å executors - å®ç° migrationresolverãmigrationexecutorãconfigurationawareãflywayconfiguration æ¥å£ã\n\n> ð æ´å¤ç»èè¯·åèï¼https://flywaydb.org/documentation/callbacks\n\n# error handlers\n\n> æ³¨ï¼ä»ä¸ä¸çæ¯æã\n\nï¼ç¥ï¼\n\n# dry runs\n\n> æ³¨ï¼ä»ä¸ä¸çæ¯æã\n\nï¼ç¥ï¼\n\n\n# å½ä»¤\n\nflyway çåè½ä¸»è¦å´ç»ç 7 ä¸ªåºæ¬å½ä»¤ï¼migrateãcleanãinfoãvalidateãundoãbaseline å repairã\n\næ³¨ï¼åå½ä»¤çä½¿ç¨æ¹æ³ç»èè¯·æ¥éå®æ¹ææ¡£ã\n\n\n# æ¯æçæ°æ®åº\n\n * oracle\n * sql server\n * db2\n * mysql\n * mariadb\n * postgresql\n * redshift\n * cockroachdb\n * sap hana\n * sybase ase\n * informix\n * h2\n * hsqldb\n * derby\n * sqlite\n\n\n# èµæ\n\n| github | å®æ¹ææ¡£ |\n\n\n# ðª ä¼ éé¨\n\n| éæçåå®¢ | db-tutorial é¦é¡µ |',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"æ°æ®åºä¸­é´ä»¶åä»£ç",frontmatter:{title:"æ°æ®åºä¸­é´ä»¶åä»£ç",date:"2022-04-11T16:52:35.000Z",categories:["æ°æ®åº","æ°æ®åºä¸­é´ä»¶"],tags:["æ°æ®åº","ä¸­é´ä»¶"],permalink:"/pages/addb05/",hidden:!0},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/02.%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%97%B4%E4%BB%B6/",relativePath:"12.æ°æ®åº/02.æ°æ®åºä¸­é´ä»¶/README.md",key:"v-208168d6",path:"/pages/addb05/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:16},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:89},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:311}],headersStr:"ð åå®¹ ð èµæ ðª ä¼ é",content:"# æ°æ®åºä¸­é´ä»¶åä»£ç\n\n\n# ð åå®¹\n\n * ShardingSphere ç®ä»\n * ShardingSphere Jdbc\n * çæ¬ç®¡çä¸­é´ä»¶ Flyway\n\n\n# ð èµæ\n\n * Seata - åå¸å¼äºå¡ä¸­é´ä»¶ã\n * ShardingSphere - å³ç³»åæ°æ®åºè¯»ååç¦»ãååºåè¡¨ä¸­é´ä»¶ã\n * Flyway - å³ç³»åæ°æ®åºçæ¬ç®¡çä¸­é´ä»¶ã\n * Canal - åºäº MySQL ç binlogï¼æä¾å¢éæ°æ®è®¢éåæ¶è´¹ã\n * Twemproxy - Twitter å¼æºçä¸ä¸ª Redis å Memcache çä¸­é´ä»£çæå¡ã\n * Codis - Redis åå¸å¼éç¾¤æ¹æ¡ã\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç IT ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",normalizedContent:"# æ°æ®åºä¸­é´ä»¶åä»£ç\n\n\n# ð åå®¹\n\n * shardingsphere ç®ä»\n * shardingsphere jdbc\n * çæ¬ç®¡çä¸­é´ä»¶ flyway\n\n\n# ð èµæ\n\n * seata - åå¸å¼äºå¡ä¸­é´ä»¶ã\n * shardingsphere - å³ç³»åæ°æ®åºè¯»ååç¦»ãååºåè¡¨ä¸­é´ä»¶ã\n * flyway - å³ç³»åæ°æ®åºçæ¬ç®¡çä¸­é´ä»¶ã\n * canal - åºäº mysql ç binlogï¼æä¾å¢éæ°æ®è®¢éåæ¶è´¹ã\n * twemproxy - twitter å¼æºçä¸ä¸ª redis å memcache çä¸­é´ä»£çæå¡ã\n * codis - redis åå¸å¼éç¾¤æ¹æ¡ã\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç it ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"SQL è¯­æ³åºç¡ç¹æ§",frontmatter:{title:"SQL è¯­æ³åºç¡ç¹æ§",date:"2018-06-15T16:07:17.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","ç»¼å"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","SQL"],permalink:"/pages/b71c9e/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/01.%E7%BB%BC%E5%90%88/02.SQL%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%E7%89%B9%E6%80%A7.html",relativePath:"12.æ°æ®åº/03.å³ç³»åæ°æ®åº/01.ç»¼å/02.SQLè¯­æ³åºç¡ç¹æ§.md",key:"v-0fc408a8",path:"/pages/b71c9e/",headers:[{level:2,title:"SQL ç®ä»",slug:"sql-ç®ä»",normalizedTitle:"sql ç®ä»",charIndex:106},{level:3,title:"æ°æ®åºæ¯è¯­",slug:"æ°æ®åºæ¯è¯­",normalizedTitle:"æ°æ®åºæ¯è¯­",charIndex:117},{level:3,title:"SQL è¯­æ³",slug:"sql-è¯­æ³",normalizedTitle:"sql è¯­æ³",charIndex:2},{level:4,title:"SQL è¯­æ³ç»æ",slug:"sql-è¯­æ³ç»æ",normalizedTitle:"sql è¯­æ³ç»æ",charIndex:523},{level:4,title:"SQL è¯­æ³è¦ç¹",slug:"sql-è¯­æ³è¦ç¹",normalizedTitle:"sql è¯­æ³è¦ç¹",charIndex:782},{level:4,title:"SQL åç±»",slug:"sql-åç±»",normalizedTitle:"sql åç±»",charIndex:1174},{level:4,title:"æ°æ®å®ä¹è¯­è¨ï¼DDLï¼",slug:"æ°æ®å®ä¹è¯­è¨-ddl",normalizedTitle:"æ°æ®å®ä¹è¯­è¨ï¼ddlï¼",charIndex:1184},{level:4,title:"æ°æ®æçºµè¯­è¨ï¼DMLï¼",slug:"æ°æ®æçºµè¯­è¨-dml",normalizedTitle:"æ°æ®æçºµè¯­è¨ï¼dmlï¼",charIndex:1318},{level:4,title:"äºå¡æ§å¶è¯­è¨ï¼TCLï¼",slug:"äºå¡æ§å¶è¯­è¨-tcl",normalizedTitle:"äºå¡æ§å¶è¯­è¨ï¼tclï¼",charIndex:1531},{level:4,title:"æ°æ®æ§å¶è¯­è¨ï¼DCLï¼",slug:"æ°æ®æ§å¶è¯­è¨-dcl",normalizedTitle:"æ°æ®æ§å¶è¯­è¨ï¼dclï¼",charIndex:1667},{level:2,title:"å¢å æ¹æ¥ï¼CRUDï¼",slug:"å¢å æ¹æ¥-crud",normalizedTitle:"å¢å æ¹æ¥ï¼crudï¼",charIndex:2011},{level:3,title:"æå¥æ°æ®",slug:"æå¥æ°æ®",normalizedTitle:"æå¥æ°æ®",charIndex:2057},{level:4,title:"æå¥å®æ´çè¡",slug:"æå¥å®æ´çè¡",normalizedTitle:"æå¥å®æ´çè¡",charIndex:2097},{level:4,title:"æå¥è¡çä¸é¨å",slug:"æå¥è¡çä¸é¨å",normalizedTitle:"æå¥è¡çä¸é¨å",charIndex:2171},{level:4,title:"æå¥æ¥è¯¢åºæ¥çæ°æ®",slug:"æå¥æ¥è¯¢åºæ¥çæ°æ®",normalizedTitle:"æå¥æ¥è¯¢åºæ¥çæ°æ®",charIndex:2271},{level:3,title:"æ´æ°æ°æ®",slug:"æ´æ°æ°æ®",normalizedTitle:"æ´æ°æ°æ®",charIndex:2340},{level:3,title:"å é¤æ°æ®",slug:"å é¤æ°æ®",normalizedTitle:"å é¤æ°æ®",charIndex:2453},{level:4,title:"å é¤è¡¨ä¸­çæå®æ°æ®",slug:"å é¤è¡¨ä¸­çæå®æ°æ®",normalizedTitle:"å é¤è¡¨ä¸­çæå®æ°æ®",charIndex:2523},{level:4,title:"æ¸ç©ºè¡¨ä¸­çæ°æ®",slug:"æ¸ç©ºè¡¨ä¸­çæ°æ®",normalizedTitle:"æ¸ç©ºè¡¨ä¸­çæ°æ®",charIndex:2581},{level:3,title:"æ¥è¯¢æ°æ®",slug:"æ¥è¯¢æ°æ®",normalizedTitle:"æ¥è¯¢æ°æ®",charIndex:2616},{level:4,title:"æ¥è¯¢åå",slug:"æ¥è¯¢åå",normalizedTitle:"æ¥è¯¢åå",charIndex:2796},{level:4,title:"æ¥è¯¢å¤å",slug:"æ¥è¯¢å¤å",normalizedTitle:"æ¥è¯¢å¤å",charIndex:2838},{level:4,title:"æ¥è¯¢ææå",slug:"æ¥è¯¢ææå",normalizedTitle:"æ¥è¯¢ææå",charIndex:2901},{level:4,title:"æ¥è¯¢ä¸åçå¼",slug:"æ¥è¯¢ä¸åçå¼",normalizedTitle:"æ¥è¯¢ä¸åçå¼",charIndex:2936},{level:4,title:"éå¶æ¥è¯¢æ°é",slug:"éå¶æ¥è¯¢æ°é",normalizedTitle:"éå¶æ¥è¯¢æ°é",charIndex:2987},{level:2,title:"è¿æ»¤æ°æ®ï¼WHEREï¼",slug:"è¿æ»¤æ°æ®-where",normalizedTitle:"è¿æ»¤æ°æ®ï¼whereï¼",charIndex:3128},{level:3,title:"WHERE å­å¥",slug:"where-å­å¥",normalizedTitle:"where å­å¥",charIndex:3283},{level:3,title:"æ¯è¾æä½ç¬¦",slug:"æ¯è¾æä½ç¬¦",normalizedTitle:"æ¯è¾æä½ç¬¦",charIndex:4225},{level:3,title:"èå´æä½ç¬¦",slug:"èå´æä½ç¬¦",normalizedTitle:"èå´æä½ç¬¦",charIndex:4332},{level:3,title:"é»è¾æä½ç¬¦",slug:"é»è¾æä½ç¬¦",normalizedTitle:"é»è¾æä½ç¬¦",charIndex:4626},{level:3,title:"ééç¬¦",slug:"ééç¬¦",normalizedTitle:"ééç¬¦",charIndex:5096},{level:2,title:"æåºï¼ORDER BYï¼",slug:"æåº-order-by",normalizedTitle:"æåºï¼order byï¼",charIndex:5557},{level:2,title:"æ°æ®å®ä¹ï¼CREATEãALTERãDROPï¼",slug:"æ°æ®å®ä¹-createãalterãdrop",normalizedTitle:"æ°æ®å®ä¹ï¼createãalterãdropï¼",charIndex:5753},{level:3,title:"æ°æ®åºï¼DATABASEï¼",slug:"æ°æ®åº-database",normalizedTitle:"æ°æ®åºï¼databaseï¼",charIndex:5821},{level:4,title:"åå»ºæ°æ®åº",slug:"åå»ºæ°æ®åº",normalizedTitle:"åå»ºæ°æ®åº",charIndex:5838},{level:4,title:"å é¤æ°æ®åº",slug:"å é¤æ°æ®åº",normalizedTitle:"å é¤æ°æ®åº",charIndex:5892},{level:4,title:"éæ©æ°æ®åº",slug:"éæ©æ°æ®åº",normalizedTitle:"éæ©æ°æ®åº",charIndex:5940},{level:3,title:"æ°æ®è¡¨ï¼TABLEï¼",slug:"æ°æ®è¡¨-table",normalizedTitle:"æ°æ®è¡¨ï¼tableï¼",charIndex:5969},{level:4,title:"å é¤æ°æ®è¡¨",slug:"å é¤æ°æ®è¡¨",normalizedTitle:"å é¤æ°æ®è¡¨",charIndex:5983},{level:4,title:"åå»ºæ°æ®è¡¨",slug:"åå»ºæ°æ®è¡¨",normalizedTitle:"åå»ºæ°æ®è¡¨",charIndex:6052},{level:4,title:"ä¿®æ¹æ°æ®è¡¨",slug:"ä¿®æ¹æ°æ®è¡¨",normalizedTitle:"ä¿®æ¹æ°æ®è¡¨",charIndex:6432},{level:5,title:"æ·»å å",slug:"æ·»å å",normalizedTitle:"æ·»å å",charIndex:6441},{level:5,title:"å é¤å",slug:"å é¤å",normalizedTitle:"å é¤å",charIndex:6483},{level:5,title:"ä¿®æ¹å",slug:"ä¿®æ¹å",normalizedTitle:"ä¿®æ¹å",charIndex:6526},{level:3,title:"è§å¾ï¼VIEWï¼",slug:"è§å¾-view",normalizedTitle:"è§å¾ï¼viewï¼",charIndex:6582},{level:4,title:"åå»ºè§å¾",slug:"åå»ºè§å¾",normalizedTitle:"åå»ºè§å¾",charIndex:6759},{level:4,title:"å é¤è§å¾",slug:"å é¤è§å¾",normalizedTitle:"å é¤è§å¾",charIndex:6846},{level:3,title:"ç´¢å¼ï¼INDEXï¼",slug:"ç´¢å¼-index",normalizedTitle:"ç´¢å¼ï¼indexï¼",charIndex:6885},{level:4,title:"åå»ºç´¢å¼",slug:"åå»ºç´¢å¼",normalizedTitle:"åå»ºç´¢å¼",charIndex:7010},{level:4,title:"åå»ºå¯ä¸ç´¢å¼",slug:"åå»ºå¯ä¸ç´¢å¼",normalizedTitle:"åå»ºå¯ä¸ç´¢å¼",charIndex:7106},{level:4,title:"å é¤ç´¢å¼",slug:"å é¤ç´¢å¼",normalizedTitle:"å é¤ç´¢å¼",charIndex:7175},{level:4,title:"æ·»å ä¸»é®",slug:"æ·»å ä¸»é®",normalizedTitle:"æ·»å ä¸»é®",charIndex:7267},{level:4,title:"å é¤ä¸»é®",slug:"å é¤ä¸»é®",normalizedTitle:"å é¤ä¸»é®",charIndex:7316},{level:3,title:"çº¦æ",slug:"çº¦æ",normalizedTitle:"çº¦æ",charIndex:7362},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:8184}],headersStr:"SQL ç®ä» æ°æ®åºæ¯è¯­ SQL è¯­æ³ SQL è¯­æ³ç»æ SQL è¯­æ³è¦ç¹ SQL åç±» æ°æ®å®ä¹è¯­è¨ï¼DDLï¼ æ°æ®æçºµè¯­è¨ï¼DMLï¼ äºå¡æ§å¶è¯­è¨ï¼TCLï¼ æ°æ®æ§å¶è¯­è¨ï¼DCLï¼ å¢å æ¹æ¥ï¼CRUDï¼ æå¥æ°æ® æå¥å®æ´çè¡ æå¥è¡çä¸é¨å æå¥æ¥è¯¢åºæ¥çæ°æ® æ´æ°æ°æ® å é¤æ°æ® å é¤è¡¨ä¸­çæå®æ°æ® æ¸ç©ºè¡¨ä¸­çæ°æ® æ¥è¯¢æ°æ® æ¥è¯¢åå æ¥è¯¢å¤å æ¥è¯¢ææå æ¥è¯¢ä¸åçå¼ éå¶æ¥è¯¢æ°é è¿æ»¤æ°æ®ï¼WHEREï¼ WHERE å­å¥ æ¯è¾æä½ç¬¦ èå´æä½ç¬¦ é»è¾æä½ç¬¦ ééç¬¦ æåºï¼ORDER BYï¼ æ°æ®å®ä¹ï¼CREATEãALTERãDROPï¼ æ°æ®åºï¼DATABASEï¼ åå»ºæ°æ®åº å é¤æ°æ®åº éæ©æ°æ®åº æ°æ®è¡¨ï¼TABLEï¼ å é¤æ°æ®è¡¨ åå»ºæ°æ®è¡¨ ä¿®æ¹æ°æ®è¡¨ æ·»å å å é¤å ä¿®æ¹å è§å¾ï¼VIEWï¼ åå»ºè§å¾ å é¤è§å¾ ç´¢å¼ï¼INDEXï¼ åå»ºç´¢å¼ åå»ºå¯ä¸ç´¢å¼ å é¤ç´¢å¼ æ·»å ä¸»é® å é¤ä¸»é® çº¦æ åèèµæ",content:"# SQL è¯­æ³åºç¡ç¹æ§\n\n> æ¬æéå¯¹å³ç³»åæ°æ®åºçåºæ¬è¯­æ³ãéäºç¯å¹ï¼æ¬æä¾§éè¯´æç¨æ³ï¼ä¸ä¼å±å¼è®²è§£ç¹æ§ãåçã\n> \n> æ¬æè¯­æ³ä¸»è¦éå¯¹ Mysqlï¼ä½å¤§é¨åçè¯­æ³å¯¹å¶ä»å³ç³»åæ°æ®åºä¹éç¨ã\n\n\n\n\n# SQL ç®ä»\n\n\n# æ°æ®åºæ¯è¯­\n\n * æ°æ®åºï¼databaseï¼ - ä¿å­æç»ç»çæ°æ®çå®¹å¨ï¼éå¸¸æ¯ä¸ä¸ªæä»¶æä¸ç»æä»¶ï¼ã\n * æ°æ®è¡¨ï¼tableï¼ - æç§ç¹å®ç±»åæ°æ®çç»æåæ¸åã\n * æ¨¡å¼ï¼schemaï¼ - å³äºæ°æ®åºåè¡¨çå¸å±åç¹æ§çä¿¡æ¯ãæ¨¡å¼å®ä¹äºæ°æ®å¨è¡¨ä¸­å¦ä½å­å¨ï¼åå«å­å¨ä»ä¹æ ·çæ°æ®ï¼æ°æ®å¦ä½åè§£ï¼åé¨åä¿¡æ¯å¦ä½å½åç­ä¿¡æ¯ãæ°æ®åºåè¡¨é½ææ¨¡å¼ã\n * åï¼columnï¼ - è¡¨ä¸­çä¸ä¸ªå­æ®µãææè¡¨é½æ¯ç±ä¸ä¸ªæå¤ä¸ªåç»æçã\n * è¡ï¼rowï¼ - è¡¨ä¸­çä¸ä¸ªè®°å½ã\n * ä¸»é®ï¼primary keyï¼ - ä¸åï¼æä¸ç»åï¼ï¼å¶å¼è½å¤å¯ä¸æ è¯è¡¨ä¸­æ¯ä¸è¡ã\n\n\n# SQL è¯­æ³\n\n> SQLï¼Structured Query Language)ï¼æ å SQL ç± ANSI æ åå§åä¼ç®¡çï¼ä»èç§°ä¸º ANSI SQLãåä¸ª DBMS é½æèªå·±çå®ç°ï¼å¦ PL/SQLãTransact-SQL ç­ã\n\n# SQL è¯­æ³ç»æ\n\n\n\nSQL è¯­æ³ç»æåæ¬ï¼\n\n * å­å¥ - æ¯è¯­å¥åæ¥è¯¢çç»ææåãï¼å¨æäºæåµä¸ï¼è¿äºé½æ¯å¯éçãï¼\n * è¡¨è¾¾å¼ - å¯ä»¥äº§çä»»ä½æ éå¼ï¼æç±ååè¡çæ°æ®åºè¡¨\n * è°è¯ - ç»éè¦è¯ä¼°ç SQL ä¸å¼é»è¾ï¼3VLï¼ï¼true/false/unknownï¼æå¸å°çå¼æå®æ¡ä»¶ï¼å¹¶éå¶è¯­å¥åæ¥è¯¢çææï¼ææ¹åç¨åºæµç¨ã\n * æ¥è¯¢ - åºäºç¹å®æ¡ä»¶æ£ç´¢æ°æ®ãè¿æ¯ SQL çä¸ä¸ªéè¦ç»æé¨åã\n * è¯­å¥ - å¯ä»¥æä¹å°å½±åçº²è¦åæ°æ®ï¼ä¹å¯ä»¥æ§å¶æ°æ®åºäºå¡ãç¨åºæµç¨ãè¿æ¥ãä¼è¯æè¯æ­ã\n\n# SQL è¯­æ³è¦ç¹\n\n * SQL è¯­å¥ä¸åºåå¤§å°åï¼ä½æ¯æ°æ®åºè¡¨åãåååå¼æ¯å¦åºåï¼ä¾èµäºå·ä½ç DBMS ä»¥åéç½®ã\n\nä¾å¦ï¼SELECT ä¸ select ãSelect æ¯ç¸åçã\n\n * å¤æ¡ SQL è¯­å¥å¿é¡»ä»¥åå·ï¼;ï¼åéã\n\n * å¤ç SQL è¯­å¥æ¶ï¼ææç©ºæ ¼é½è¢«å¿½ç¥ãSQL è¯­å¥å¯ä»¥åæä¸è¡ï¼ä¹å¯ä»¥ååä¸ºå¤è¡ã\n\n-- ä¸è¡ SQL è¯­å¥\nUPDATE user SET username='robot', password='robot' WHERE username = 'root';\n\n-- å¤è¡ SQL è¯­å¥\nUPDATE user\nSET username='robot', password='robot'\nWHERE username = 'root';\n\n\n * SQL æ¯æä¸ç§æ³¨é\n\n## æ³¨é1\n-- æ³¨é2\n/* æ³¨é3 */\n\n\n# SQL åç±»\n\n# æ°æ®å®ä¹è¯­è¨ï¼DDLï¼\n\næ°æ®å®ä¹è¯­è¨ï¼Data Definition Languageï¼DDLï¼æ¯ SQL è¯­è¨éä¸­è´è´£æ°æ®ç»æå®ä¹ä¸æ°æ®åºå¯¹è±¡å®ä¹çè¯­è¨ã\n\nDDL çä¸»è¦åè½æ¯å®ä¹æ°æ®åºå¯¹è±¡ã\n\nDDL çæ ¸å¿æä»¤æ¯ CREATEãALTERãDROPã\n\n# æ°æ®æçºµè¯­è¨ï¼DMLï¼\n\næ°æ®æçºµè¯­è¨ï¼Data Manipulation Language, DMLï¼æ¯ç¨äºæ°æ®åºæä½ï¼å¯¹æ°æ®åºå¶ä¸­çå¯¹è±¡åæ°æ®è¿è¡è®¿é®å·¥ä½çç¼ç¨è¯­å¥ã\n\nDML çä¸»è¦åè½æ¯ è®¿é®æ°æ®ï¼å æ­¤å¶è¯­æ³é½æ¯ä»¥è¯»åæ°æ®åºä¸ºä¸»ã\n\nDML çæ ¸å¿æä»¤æ¯ INSERTãUPDATEãDELETEãSELECTãè¿åä¸ªæä»¤åç§° CRUD(Create, Read, Update, Delete)ï¼å³å¢å æ¹æ¥ã\n\n# äºå¡æ§å¶è¯­è¨ï¼TCLï¼\n\näºå¡æ§å¶è¯­è¨ (Transaction Control Language, TCL) ç¨äºç®¡çæ°æ®åºä¸­çäºå¡ãè¿äºç¨äºç®¡çç± DML è¯­å¥æåçæ´æ¹ãå®è¿åè®¸å°è¯­å¥åç»ä¸ºé»è¾äºå¡ã\n\nTCL çæ ¸å¿æä»¤æ¯ COMMITãROLLBACKã\n\n# æ°æ®æ§å¶è¯­è¨ï¼DCLï¼\n\næ°æ®æ§å¶è¯­è¨ (Data Control Language, DCL) æ¯ä¸ç§å¯å¯¹æ°æ®è®¿é®æè¿è¡æ§å¶çæä»¤ï¼å®å¯ä»¥æ§å¶ç¹å®ç¨æ·è´¦æ·å¯¹æ°æ®è¡¨ãæ¥çè¡¨ãé¢å­ç¨åºãç¨æ·èªå®ä¹å½æ°ç­æ°æ®åºå¯¹è±¡çæ§å¶æã\n\nDCL çæ ¸å¿æä»¤æ¯ GRANTãREVOKEã\n\nDCL ä»¥æ§å¶ç¨æ·çè®¿é®æéä¸ºä¸»ï¼å æ­¤å¶æä»¤ä½æ³å¹¶ä¸å¤æï¼å¯å©ç¨ DCL æ§å¶çæéæï¼CONNECTãSELECTãINSERTãUPDATEãDELETEãEXECUTEãUSAGEãREFERENCESã\n\næ ¹æ®ä¸åç DBMS ä»¥åä¸åçå®å¨æ§å®ä½ï¼å¶æ¯æçæéæ§å¶ä¹ææä¸åã\n\n----------------------------------------\n\nï¼ä»¥ä¸ä¸º DML è¯­å¥ç¨æ³ï¼\n\n\n# å¢å æ¹æ¥ï¼CRUDï¼\n\nå¢å æ¹æ¥ï¼åç§°ä¸º CRUDï¼æ¯æ°æ®åºåºæ¬æä½ä¸­çåºæ¬æä½ã\n\n\n# æå¥æ°æ®\n\n>  * INSERT INTO è¯­å¥ç¨äºåè¡¨ä¸­æå¥æ°è®°å½ã\n\n# æå¥å®æ´çè¡\n\nINSERT INTO user\nVALUES (10, 'root', 'root', 'xxxx@163.com');\n\n\n# æå¥è¡çä¸é¨å\n\nINSERT INTO user(username, password, email)\nVALUES ('admin', 'admin', 'xxxx@163.com');\n\n\n# æå¥æ¥è¯¢åºæ¥çæ°æ®\n\nINSERT INTO user(username)\nSELECT name\nFROM account;\n\n\n\n# æ´æ°æ°æ®\n\n>  * UPDATE è¯­å¥ç¨äºæ´æ°è¡¨ä¸­çè®°å½ã\n\nUPDATE user\nSET username='robot', password='robot'\nWHERE username = 'root';\n\n\n\n# å é¤æ°æ®\n\n>  * DELETE è¯­å¥ç¨äºå é¤è¡¨ä¸­çè®°å½ã\n>  * TRUNCATE TABLE å¯ä»¥æ¸ç©ºè¡¨ï¼ä¹å°±æ¯å é¤ææè¡ã\n\n# å é¤è¡¨ä¸­çæå®æ°æ®\n\nDELETE FROM user WHERE username = 'robot';\n\n\n# æ¸ç©ºè¡¨ä¸­çæ°æ®\n\nTRUNCATE TABLE user;\n\n\n\n# æ¥è¯¢æ°æ®\n\n>  * SELECT è¯­å¥ç¨äºä»æ°æ®åºä¸­æ¥è¯¢æ°æ®ã\n>  * DISTINCT ç¨äºè¿åå¯ä¸ä¸åçå¼ãå®ä½ç¨äºææåï¼ä¹å°±æ¯è¯´ææåçå¼é½ç¸åæç®ç¸åã\n>  * LIMIT éå¶è¿åçè¡æ°ãå¯ä»¥æä¸¤ä¸ªåæ°ï¼ç¬¬ä¸ä¸ªåæ°ä¸ºèµ·å§è¡ï¼ä» 0 å¼å§ï¼ç¬¬äºä¸ªåæ°ä¸ºè¿åçæ»è¡æ°ã\n>    * ASC ï¼ååºï¼é»è®¤ï¼\n>    * DESC ï¼éåº\n\n# æ¥è¯¢åå\n\nSELECT prod_name FROM products;\n\n\n# æ¥è¯¢å¤å\n\nSELECT prod_id, prod_name, prod_price FROM products;\n\n\n# æ¥è¯¢ææå\n\nSELECT * FROM products;\n\n\n# æ¥è¯¢ä¸åçå¼\n\nSELECT DISTINCT vend_id FROM products;\n\n\n# éå¶æ¥è¯¢æ°é\n\n-- è¿åå 5 è¡\nSELECT * FROM products LIMIT 5;\nSELECT * FROM products LIMIT 0, 5;\n-- è¿åç¬¬ 3 ~ 5 è¡\nSELECT * FROM products LIMIT 2, 3;\n\n\n\n# è¿æ»¤æ°æ®ï¼WHEREï¼\n\nå­æ¥è¯¢æ¯åµå¥å¨è¾å¤§æ¥è¯¢ä¸­ç SQL æ¥è¯¢ãå­æ¥è¯¢ä¹ç§°ä¸ºåé¨æ¥è¯¢æåé¨éæ©ï¼èåå«å­æ¥è¯¢çè¯­å¥ä¹ç§°ä¸ºå¤é¨æ¥è¯¢æå¤é¨éæ©ã\n\n * å­æ¥è¯¢å¯ä»¥åµå¥å¨ SELECTï¼INSERTï¼UPDATE æ DELETE è¯­å¥åæå¦ä¸ä¸ªå­æ¥è¯¢ä¸­ã\n\n * å­æ¥è¯¢éå¸¸ä¼å¨å¦ä¸ä¸ª SELECT è¯­å¥ç WHERE å­å¥ä¸­æ·»å ã\n\n * æ¨å¯ä»¥ä½¿ç¨æ¯è¾è¿ç®ç¬¦ï¼å¦ >ï¼<ï¼æ =ãæ¯è¾è¿ç®ç¬¦ä¹å¯ä»¥æ¯å¤è¡è¿ç®ç¬¦ï¼å¦ INï¼ANY æ ALLã\n\n * å­æ¥è¯¢å¿é¡»è¢«åæ¬å· () æ¬èµ·æ¥ã\n\n * åé¨æ¥è¯¢é¦åå¨å¶ç¶æ¥è¯¢ä¹åæ§è¡ï¼ä»¥ä¾¿å¯ä»¥å°åé¨æ¥è¯¢çç»æä¼ éç»å¤é¨æ¥è¯¢ãæ§è¡è¿ç¨å¯ä»¥åèä¸å¾ï¼\n   \n   \n\nå­æ¥è¯¢çå­æ¥è¯¢\n\nSELECT cust_name, cust_contact\nFROM customers\nWHERE cust_id IN (SELECT cust_id\n                  FROM orders\n                  WHERE order_num IN (SELECT order_num\n                                      FROM orderitems\n                                      WHERE prod_id = 'RGAN01'));\n\n\n\n# WHERE å­å¥\n\nå¨ SQL è¯­å¥ä¸­ï¼æ°æ®æ ¹æ® WHERE å­å¥ä¸­æå®çæç´¢æ¡ä»¶è¿è¡è¿æ»¤ã\n\nWHERE å­å¥çåºæ¬æ ¼å¼å¦ä¸ï¼\n\nSELECT â¦â¦(åå) FROM â¦â¦(è¡¨å) WHERE â¦â¦(å­å¥æ¡ä»¶)\n\n\nWHERE å­å¥ç¨äºè¿æ»¤è®°å½ï¼å³ç¼©å°è®¿é®æ°æ®çèå´ãWHERE åè·ä¸ä¸ªè¿å true æ false çæ¡ä»¶ã\n\nWHERE å¯ä»¥ä¸ SELECTï¼UPDATE å DELETE ä¸èµ·ä½¿ç¨ã\n\nSELECT è¯­å¥ä¸­ç WHERE å­å¥\n\nSELECT * FROM Customers\nWHERE cust_name = 'Kids Place';\n\n\nUPDATE è¯­å¥ä¸­ç WHERE å­å¥\n\nUPDATE Customers\nSET cust_name = 'Jack Jones'\nWHERE cust_name = 'Kids Place';\n\n\nDELETE è¯­å¥ä¸­ç WHERE å­å¥\n\nDELETE FROM Customers\nWHERE cust_name = 'Kids Place';\n\n\nå¯ä»¥å¨ WHERE å­å¥ä¸­ä½¿ç¨çæä½ç¬¦ï¼\n\n\n# æ¯è¾æä½ç¬¦\n\nè¿ç®ç¬¦   æè¿°\n=     ç­äº\n<>    ä¸ç­äºãæ³¨éï¼å¨ SQL çä¸äºçæ¬ä¸­ï¼è¯¥æä½ç¬¦å¯è¢«åæ !=\n>     å¤§äº\n<     å°äº\n>=    å¤§äºç­äº\n<=    å°äºç­äº\n\n\n# èå´æä½ç¬¦\n\nè¿ç®ç¬¦       æè¿°\nBETWEEN   å¨æä¸ªèå´å\nIN        æå®éå¯¹æä¸ªåçå¤ä¸ªå¯è½å¼\n\n * IN æä½ç¬¦å¨ WHERE å­å¥ä¸­ä½¿ç¨ï¼ä½ç¨æ¯å¨æå®çå ä¸ªç¹å®å¼ä¸­ä»»éä¸ä¸ªå¼ã\n\n * BETWEEN æä½ç¬¦å¨ WHERE å­å¥ä¸­ä½¿ç¨ï¼ä½ç¨æ¯éåä»äºæä¸ªèå´åçå¼ã\n\nIN ç¤ºä¾\n\nSELECT *\nFROM products\nWHERE vend_id IN ('DLL01', 'BRS01');\n\n\nBETWEEN ç¤ºä¾\n\nSELECT *\nFROM products\nWHERE prod_price BETWEEN 3 AND 5;\n\n\n\n# é»è¾æä½ç¬¦\n\nè¿ç®ç¬¦   æè¿°\nAND   å¹¶ä¸ï¼ä¸ï¼\nOR    æèï¼æï¼\nNOT   å¦å®ï¼éï¼\n\nANDãORãNOT æ¯ç¨äºå¯¹è¿æ»¤æ¡ä»¶çé»è¾å¤çæä»¤ã\n\n * AND ä¼åçº§é«äº ORï¼ä¸ºäºæç¡®å¤çé¡ºåºï¼å¯ä»¥ä½¿ç¨ ()ãAND æä½ç¬¦è¡¨ç¤ºå·¦å³æ¡ä»¶é½è¦æ»¡è¶³ã\n\n * OR æä½ç¬¦è¡¨ç¤ºå·¦å³æ¡ä»¶æ»¡è¶³ä»»æä¸ä¸ªå³å¯ã\n\n * NOT æä½ç¬¦ç¨äºå¦å®ä¸ä¸ªæ¡ä»¶ã\n\nAND ç¤ºä¾\n\nSELECT prod_id, prod_name, prod_price\nFROM products\nWHERE vend_id = 'DLL01' AND prod_price <= 4;\n\n\nOR ç¤ºä¾\n\nSELECT prod_id, prod_name, prod_price\nFROM products\nWHERE vend_id = 'DLL01' OR vend_id = 'BRS01';\n\n\nNOT ç¤ºä¾\n\nSELECT *\nFROM products\nWHERE prod_price NOT BETWEEN 3 AND 5;\n\n\n\n# ééç¬¦\n\nè¿ç®ç¬¦    æè¿°\nLIKE   æç´¢æç§æ¨¡å¼\n%      è¡¨ç¤ºä»»æå­ç¬¦åºç°ä»»ææ¬¡æ°\n_      è¡¨ç¤ºä»»æå­ç¬¦åºç°ä¸æ¬¡\n[]     å¿é¡»å¹éæå®ä½ç½®çä¸ä¸ªå­ç¬¦\n\nLIKE æä½ç¬¦å¨ WHERE å­å¥ä¸­ä½¿ç¨ï¼ä½ç¨æ¯ç¡®å®å­ç¬¦ä¸²æ¯å¦å¹éæ¨¡å¼ãåªæå­æ®µæ¯ææ¬å¼æ¶æä½¿ç¨ LIKEã\n\nLIKE æ¯æä»¥ä¸ééç¬¦å¹ééé¡¹ï¼\n\n * % è¡¨ç¤ºä»»ä½å­ç¬¦åºç°ä»»ææ¬¡æ°ã\n * _ è¡¨ç¤ºä»»ä½å­ç¬¦åºç°ä¸æ¬¡ã\n * [] å¿é¡»å¹éæå®ä½ç½®çä¸ä¸ªå­ç¬¦ã\n\n> æ³¨æï¼ä¸è¦æ»¥ç¨ééç¬¦ï¼ééç¬¦ä½äºå¼å¤´å¤å¹éä¼éå¸¸æ¢ã\n\n% ç¤ºä¾ï¼\n\nSELECT prod_id, prod_name, prod_price\nFROM products\nWHERE prod_name LIKE '%bean bag%';\n\n\n_ ç¤ºä¾ï¼\n\nSELECT prod_id, prod_name, prod_price\nFROM products\nWHERE prod_name LIKE '__ inch teddy bear';\n\n\n * \n\n\n# æåºï¼ORDER BYï¼\n\n> ORDER BY ç¨äºå¯¹ç»æéè¿è¡æåºã\n\nORDER BY æä¸¤ç§æåºæ¨¡å¼ï¼\n\n * ASC ï¼ååºï¼é»è®¤ï¼\n * DESC ï¼éåº\n\nå¯ä»¥æå¤ä¸ªåè¿è¡æåºï¼å¹¶ä¸ä¸ºæ¯ä¸ªåæå®ä¸åçæåºæ¹å¼ã\n\næå®å¤ä¸ªåçæåºç¤ºä¾ï¼\n\nSELECT * FROM products\nORDER BY prod_price DESC, prod_name ASC;\n\n\n\n# æ°æ®å®ä¹ï¼CREATEãALTERãDROPï¼\n\n> DDL çä¸»è¦åè½æ¯å®ä¹æ°æ®åºå¯¹è±¡ï¼å¦ï¼æ°æ®åºãæ°æ®è¡¨ãè§å¾ãç´¢å¼ç­ï¼ã\n\n\n# æ°æ®åºï¼DATABASEï¼\n\n# åå»ºæ°æ®åº\n\nCREATE DATABASE IF NOT EXISTS db_tutorial;\n\n\n# å é¤æ°æ®åº\n\nDROP DATABASE IF EXISTS db_tutorial;\n\n\n# éæ©æ°æ®åº\n\nUSE db_tutorial;\n\n\n\n# æ°æ®è¡¨ï¼TABLEï¼\n\n# å é¤æ°æ®è¡¨\n\nDROP TABLE IF EXISTS user;\nDROP TABLE IF EXISTS vip_user;\n\n\n# åå»ºæ°æ®è¡¨\n\næ®éåå»º\n\nCREATE TABLE user (\n    id       INT(10) UNSIGNED NOT NULL COMMENT 'Id',\n    username VARCHAR(64)      NOT NULL DEFAULT 'default' COMMENT 'ç¨æ·å',\n    password VARCHAR(64)      NOT NULL DEFAULT 'default' COMMENT 'å¯ç ',\n    email    VARCHAR(64)      NOT NULL DEFAULT 'default' COMMENT 'é®ç®±'\n) COMMENT ='ç¨æ·è¡¨';\n\n\næ ¹æ®å·²æçè¡¨åå»ºæ°è¡¨\n\nCREATE TABLE vip_user AS\nSELECT *\nFROM user;\n\n\n# ä¿®æ¹æ°æ®è¡¨\n\n# æ·»å å\n\nALTER TABLE user\nADD age int(3);\n\n\n# å é¤å\n\nALTER TABLE user\nDROP COLUMN age;\n\n\n# ä¿®æ¹å\n\nALTER TABLE `user`\nMODIFY COLUMN age tinyint;\n\n\n\n# è§å¾ï¼VIEWï¼\n\n> è§å¾æ¯åºäº SQL è¯­å¥çç»æéçå¯è§åçè¡¨ãè§å¾æ¯èæçè¡¨ï¼æ¬èº«ä¸å­å¨æ°æ®ï¼ä¹å°±ä¸è½å¯¹å¶è¿è¡ç´¢å¼æä½ãå¯¹è§å¾çæä½åå¯¹æ®éè¡¨çæä½ä¸æ ·ã\n\nè§å¾çä½ç¨ï¼\n\n * ç®åå¤æç SQL æä½ï¼æ¯å¦å¤æçè¿æ¥ã\n * åªä½¿ç¨å®éè¡¨çä¸é¨åæ°æ®ã\n * éè¿åªç»ç¨æ·è®¿é®è§å¾çæéï¼ä¿è¯æ°æ®çå®å¨æ§ã\n * æ´æ¹æ°æ®æ ¼å¼åè¡¨ç¤ºã\n\n# åå»ºè§å¾\n\nCREATE VIEW top_10_user_view AS\nSELECT id, username\nFROM user\nWHERE id < 10;\n\n\n# å é¤è§å¾\n\nDROP VIEW top_10_user_view;\n\n\n\n# ç´¢å¼ï¼INDEXï¼\n\n> éè¿ç´¢å¼å¯ä»¥æ´å å¿«éé«æå°æ¥è¯¢æ°æ®ãç¨æ·æ æ³çå°ç´¢å¼ï¼å®ä»¬åªè½è¢«ç¨æ¥å éæ¥è¯¢ã\n\næ´æ°ä¸ä¸ªåå«ç´¢å¼çè¡¨éè¦æ¯æ´æ°ä¸ä¸ªæ²¡æç´¢å¼çè¡¨è±è´¹æ´å¤çæ¶é´ï¼è¿æ¯ç±äºç´¢å¼æ¬èº«ä¹éè¦æ´æ°ãå æ­¤ï¼çæ³çåæ³æ¯ä»ä»å¨å¸¸å¸¸è¢«æç´¢çåï¼ä»¥åè¡¨ï¼ä¸é¢åå»ºç´¢å¼ã\n\nå¯ä¸ç´¢å¼ï¼å¯ä¸ç´¢å¼è¡¨ææ­¤ç´¢å¼çæ¯ä¸ä¸ªç´¢å¼å¼åªå¯¹åºå¯ä¸çæ°æ®è®°å½ã\n\n# åå»ºç´¢å¼\n\nCREATE INDEX idx_email\n    ON user(email);\n\n\n# åå»ºå¯ä¸ç´¢å¼\n\nCREATE UNIQUE INDEX uniq_username\n    ON user(username);\n\n\n# å é¤ç´¢å¼\n\nALTER TABLE user\nDROP INDEX idx_email;\nALTER TABLE user\nDROP INDEX uniq_username;\n\n\n# æ·»å ä¸»é®\n\nALTER TABLE user\nADD PRIMARY KEY (id);\n\n\n# å é¤ä¸»é®\n\nALTER TABLE user\nDROP PRIMARY KEY;\n\n\n\n# çº¦æ\n\n> SQL çº¦æç¨äºè§å®è¡¨ä¸­çæ°æ®è§åã\n\n * å¦æå­å¨è¿åçº¦æçæ°æ®è¡ä¸ºï¼è¡ä¸ºä¼è¢«çº¦æç»æ­¢ã\n * çº¦æå¯ä»¥å¨åå»ºè¡¨æ¶è§å®ï¼éè¿ CREATE TABLE è¯­å¥ï¼ï¼æèå¨è¡¨åå»ºä¹åè§å®ï¼éè¿ ALTER TABLE è¯­å¥ï¼ã\n * çº¦æç±»å\n   * NOT NULL - æç¤ºæåä¸è½å­å¨ NULL å¼ã\n   * UNIQUE - ä¿è¯æåçæ¯è¡å¿é¡»æå¯ä¸çå¼ã\n   * PRIMARY KEY - NOT NULL å UNIQUE çç»åãç¡®ä¿æåï¼æä¸¤ä¸ªåå¤ä¸ªåçç»åï¼æå¯ä¸æ è¯ï¼æå©äºæ´å®¹ææ´å¿«éå°æ¾å°è¡¨ä¸­çä¸ä¸ªç¹å®çè®°å½ã\n   * FOREIGN KEY - ä¿è¯ä¸ä¸ªè¡¨ä¸­çæ°æ®å¹éå¦ä¸ä¸ªè¡¨ä¸­çå¼çåç§å®æ´æ§ã\n   * CHECK - ä¿è¯åä¸­çå¼ç¬¦åæå®çæ¡ä»¶ã\n   * DEFAULT - è§å®æ²¡æç»åèµå¼æ¶çé»è®¤å¼ã\n\nåå»ºè¡¨æ¶ä½¿ç¨çº¦ææ¡ä»¶ï¼\n\nCREATE TABLE Users (\n  Id INT(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'èªå¢Id',\n  Username VARCHAR(64) NOT NULL UNIQUE DEFAULT 'default' COMMENT 'ç¨æ·å',\n  Password VARCHAR(64) NOT NULL DEFAULT 'default' COMMENT 'å¯ç ',\n  Email VARCHAR(64) NOT NULL DEFAULT 'default' COMMENT 'é®ç®±å°å',\n  Enabled TINYINT(4) DEFAULT NULL COMMENT 'æ¯å¦ææ',\n  PRIMARY KEY (Id)\n) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COMMENT='ç¨æ·è¡¨';\n\n\n\n# åèèµæ\n\n * ãSQL å¿ç¥å¿ä¼ã\n * ãæµå¥æ·±åºãMySQL ä¸­äºå¡çå®ç°\n * MySQL çå­¦ä¹ --è§¦åå¨\n * ç»´åºç¾ç§è¯æ¡ - SQL\n * https://www.sitesbay.com/sql/index\n * SQL Subqueries\n * Quick breakdown of the types of joins\n * SQL UNION\n * SQL database security\n * Mysql ä¸­çå­å¨è¿ç¨",normalizedContent:"# sql è¯­æ³åºç¡ç¹æ§\n\n> æ¬æéå¯¹å³ç³»åæ°æ®åºçåºæ¬è¯­æ³ãéäºç¯å¹ï¼æ¬æä¾§éè¯´æç¨æ³ï¼ä¸ä¼å±å¼è®²è§£ç¹æ§ãåçã\n> \n> æ¬æè¯­æ³ä¸»è¦éå¯¹ mysqlï¼ä½å¤§é¨åçè¯­æ³å¯¹å¶ä»å³ç³»åæ°æ®åºä¹éç¨ã\n\n\n\n\n# sql ç®ä»\n\n\n# æ°æ®åºæ¯è¯­\n\n * æ°æ®åºï¼databaseï¼ - ä¿å­æç»ç»çæ°æ®çå®¹å¨ï¼éå¸¸æ¯ä¸ä¸ªæä»¶æä¸ç»æä»¶ï¼ã\n * æ°æ®è¡¨ï¼tableï¼ - æç§ç¹å®ç±»åæ°æ®çç»æåæ¸åã\n * æ¨¡å¼ï¼schemaï¼ - å³äºæ°æ®åºåè¡¨çå¸å±åç¹æ§çä¿¡æ¯ãæ¨¡å¼å®ä¹äºæ°æ®å¨è¡¨ä¸­å¦ä½å­å¨ï¼åå«å­å¨ä»ä¹æ ·çæ°æ®ï¼æ°æ®å¦ä½åè§£ï¼åé¨åä¿¡æ¯å¦ä½å½åç­ä¿¡æ¯ãæ°æ®åºåè¡¨é½ææ¨¡å¼ã\n * åï¼columnï¼ - è¡¨ä¸­çä¸ä¸ªå­æ®µãææè¡¨é½æ¯ç±ä¸ä¸ªæå¤ä¸ªåç»æçã\n * è¡ï¼rowï¼ - è¡¨ä¸­çä¸ä¸ªè®°å½ã\n * ä¸»é®ï¼primary keyï¼ - ä¸åï¼æä¸ç»åï¼ï¼å¶å¼è½å¤å¯ä¸æ è¯è¡¨ä¸­æ¯ä¸è¡ã\n\n\n# sql è¯­æ³\n\n> sqlï¼structured query language)ï¼æ å sql ç± ansi æ åå§åä¼ç®¡çï¼ä»èç§°ä¸º ansi sqlãåä¸ª dbms é½æèªå·±çå®ç°ï¼å¦ pl/sqlãtransact-sql ç­ã\n\n# sql è¯­æ³ç»æ\n\n\n\nsql è¯­æ³ç»æåæ¬ï¼\n\n * å­å¥ - æ¯è¯­å¥åæ¥è¯¢çç»ææåãï¼å¨æäºæåµä¸ï¼è¿äºé½æ¯å¯éçãï¼\n * è¡¨è¾¾å¼ - å¯ä»¥äº§çä»»ä½æ éå¼ï¼æç±ååè¡çæ°æ®åºè¡¨\n * è°è¯ - ç»éè¦è¯ä¼°ç sql ä¸å¼é»è¾ï¼3vlï¼ï¼true/false/unknownï¼æå¸å°çå¼æå®æ¡ä»¶ï¼å¹¶éå¶è¯­å¥åæ¥è¯¢çææï¼ææ¹åç¨åºæµç¨ã\n * æ¥è¯¢ - åºäºç¹å®æ¡ä»¶æ£ç´¢æ°æ®ãè¿æ¯ sql çä¸ä¸ªéè¦ç»æé¨åã\n * è¯­å¥ - å¯ä»¥æä¹å°å½±åçº²è¦åæ°æ®ï¼ä¹å¯ä»¥æ§å¶æ°æ®åºäºå¡ãç¨åºæµç¨ãè¿æ¥ãä¼è¯æè¯æ­ã\n\n# sql è¯­æ³è¦ç¹\n\n * sql è¯­å¥ä¸åºåå¤§å°åï¼ä½æ¯æ°æ®åºè¡¨åãåååå¼æ¯å¦åºåï¼ä¾èµäºå·ä½ç dbms ä»¥åéç½®ã\n\nä¾å¦ï¼select ä¸ select ãselect æ¯ç¸åçã\n\n * å¤æ¡ sql è¯­å¥å¿é¡»ä»¥åå·ï¼;ï¼åéã\n\n * å¤ç sql è¯­å¥æ¶ï¼ææç©ºæ ¼é½è¢«å¿½ç¥ãsql è¯­å¥å¯ä»¥åæä¸è¡ï¼ä¹å¯ä»¥ååä¸ºå¤è¡ã\n\n-- ä¸è¡ sql è¯­å¥\nupdate user set username='robot', password='robot' where username = 'root';\n\n-- å¤è¡ sql è¯­å¥\nupdate user\nset username='robot', password='robot'\nwhere username = 'root';\n\n\n * sql æ¯æä¸ç§æ³¨é\n\n## æ³¨é1\n-- æ³¨é2\n/* æ³¨é3 */\n\n\n# sql åç±»\n\n# æ°æ®å®ä¹è¯­è¨ï¼ddlï¼\n\næ°æ®å®ä¹è¯­è¨ï¼data definition languageï¼ddlï¼æ¯ sql è¯­è¨éä¸­è´è´£æ°æ®ç»æå®ä¹ä¸æ°æ®åºå¯¹è±¡å®ä¹çè¯­è¨ã\n\nddl çä¸»è¦åè½æ¯å®ä¹æ°æ®åºå¯¹è±¡ã\n\nddl çæ ¸å¿æä»¤æ¯ createãalterãdropã\n\n# æ°æ®æçºµè¯­è¨ï¼dmlï¼\n\næ°æ®æçºµè¯­è¨ï¼data manipulation language, dmlï¼æ¯ç¨äºæ°æ®åºæä½ï¼å¯¹æ°æ®åºå¶ä¸­çå¯¹è±¡åæ°æ®è¿è¡è®¿é®å·¥ä½çç¼ç¨è¯­å¥ã\n\ndml çä¸»è¦åè½æ¯ è®¿é®æ°æ®ï¼å æ­¤å¶è¯­æ³é½æ¯ä»¥è¯»åæ°æ®åºä¸ºä¸»ã\n\ndml çæ ¸å¿æä»¤æ¯ insertãupdateãdeleteãselectãè¿åä¸ªæä»¤åç§° crud(create, read, update, delete)ï¼å³å¢å æ¹æ¥ã\n\n# äºå¡æ§å¶è¯­è¨ï¼tclï¼\n\näºå¡æ§å¶è¯­è¨ (transaction control language, tcl) ç¨äºç®¡çæ°æ®åºä¸­çäºå¡ãè¿äºç¨äºç®¡çç± dml è¯­å¥æåçæ´æ¹ãå®è¿åè®¸å°è¯­å¥åç»ä¸ºé»è¾äºå¡ã\n\ntcl çæ ¸å¿æä»¤æ¯ commitãrollbackã\n\n# æ°æ®æ§å¶è¯­è¨ï¼dclï¼\n\næ°æ®æ§å¶è¯­è¨ (data control language, dcl) æ¯ä¸ç§å¯å¯¹æ°æ®è®¿é®æè¿è¡æ§å¶çæä»¤ï¼å®å¯ä»¥æ§å¶ç¹å®ç¨æ·è´¦æ·å¯¹æ°æ®è¡¨ãæ¥çè¡¨ãé¢å­ç¨åºãç¨æ·èªå®ä¹å½æ°ç­æ°æ®åºå¯¹è±¡çæ§å¶æã\n\ndcl çæ ¸å¿æä»¤æ¯ grantãrevokeã\n\ndcl ä»¥æ§å¶ç¨æ·çè®¿é®æéä¸ºä¸»ï¼å æ­¤å¶æä»¤ä½æ³å¹¶ä¸å¤æï¼å¯å©ç¨ dcl æ§å¶çæéæï¼connectãselectãinsertãupdateãdeleteãexecuteãusageãreferencesã\n\næ ¹æ®ä¸åç dbms ä»¥åä¸åçå®å¨æ§å®ä½ï¼å¶æ¯æçæéæ§å¶ä¹ææä¸åã\n\n----------------------------------------\n\nï¼ä»¥ä¸ä¸º dml è¯­å¥ç¨æ³ï¼\n\n\n# å¢å æ¹æ¥ï¼crudï¼\n\nå¢å æ¹æ¥ï¼åç§°ä¸º crudï¼æ¯æ°æ®åºåºæ¬æä½ä¸­çåºæ¬æä½ã\n\n\n# æå¥æ°æ®\n\n>  * insert into è¯­å¥ç¨äºåè¡¨ä¸­æå¥æ°è®°å½ã\n\n# æå¥å®æ´çè¡\n\ninsert into user\nvalues (10, 'root', 'root', 'xxxx@163.com');\n\n\n# æå¥è¡çä¸é¨å\n\ninsert into user(username, password, email)\nvalues ('admin', 'admin', 'xxxx@163.com');\n\n\n# æå¥æ¥è¯¢åºæ¥çæ°æ®\n\ninsert into user(username)\nselect name\nfrom account;\n\n\n\n# æ´æ°æ°æ®\n\n>  * update è¯­å¥ç¨äºæ´æ°è¡¨ä¸­çè®°å½ã\n\nupdate user\nset username='robot', password='robot'\nwhere username = 'root';\n\n\n\n# å é¤æ°æ®\n\n>  * delete è¯­å¥ç¨äºå é¤è¡¨ä¸­çè®°å½ã\n>  * truncate table å¯ä»¥æ¸ç©ºè¡¨ï¼ä¹å°±æ¯å é¤ææè¡ã\n\n# å é¤è¡¨ä¸­çæå®æ°æ®\n\ndelete from user where username = 'robot';\n\n\n# æ¸ç©ºè¡¨ä¸­çæ°æ®\n\ntruncate table user;\n\n\n\n# æ¥è¯¢æ°æ®\n\n>  * select è¯­å¥ç¨äºä»æ°æ®åºä¸­æ¥è¯¢æ°æ®ã\n>  * distinct ç¨äºè¿åå¯ä¸ä¸åçå¼ãå®ä½ç¨äºææåï¼ä¹å°±æ¯è¯´ææåçå¼é½ç¸åæç®ç¸åã\n>  * limit éå¶è¿åçè¡æ°ãå¯ä»¥æä¸¤ä¸ªåæ°ï¼ç¬¬ä¸ä¸ªåæ°ä¸ºèµ·å§è¡ï¼ä» 0 å¼å§ï¼ç¬¬äºä¸ªåæ°ä¸ºè¿åçæ»è¡æ°ã\n>    * asc ï¼ååºï¼é»è®¤ï¼\n>    * desc ï¼éåº\n\n# æ¥è¯¢åå\n\nselect prod_name from products;\n\n\n# æ¥è¯¢å¤å\n\nselect prod_id, prod_name, prod_price from products;\n\n\n# æ¥è¯¢ææå\n\nselect * from products;\n\n\n# æ¥è¯¢ä¸åçå¼\n\nselect distinct vend_id from products;\n\n\n# éå¶æ¥è¯¢æ°é\n\n-- è¿åå 5 è¡\nselect * from products limit 5;\nselect * from products limit 0, 5;\n-- è¿åç¬¬ 3 ~ 5 è¡\nselect * from products limit 2, 3;\n\n\n\n# è¿æ»¤æ°æ®ï¼whereï¼\n\nå­æ¥è¯¢æ¯åµå¥å¨è¾å¤§æ¥è¯¢ä¸­ç sql æ¥è¯¢ãå­æ¥è¯¢ä¹ç§°ä¸ºåé¨æ¥è¯¢æåé¨éæ©ï¼èåå«å­æ¥è¯¢çè¯­å¥ä¹ç§°ä¸ºå¤é¨æ¥è¯¢æå¤é¨éæ©ã\n\n * å­æ¥è¯¢å¯ä»¥åµå¥å¨ selectï¼insertï¼update æ delete è¯­å¥åæå¦ä¸ä¸ªå­æ¥è¯¢ä¸­ã\n\n * å­æ¥è¯¢éå¸¸ä¼å¨å¦ä¸ä¸ª select è¯­å¥ç where å­å¥ä¸­æ·»å ã\n\n * æ¨å¯ä»¥ä½¿ç¨æ¯è¾è¿ç®ç¬¦ï¼å¦ >ï¼<ï¼æ =ãæ¯è¾è¿ç®ç¬¦ä¹å¯ä»¥æ¯å¤è¡è¿ç®ç¬¦ï¼å¦ inï¼any æ allã\n\n * å­æ¥è¯¢å¿é¡»è¢«åæ¬å· () æ¬èµ·æ¥ã\n\n * åé¨æ¥è¯¢é¦åå¨å¶ç¶æ¥è¯¢ä¹åæ§è¡ï¼ä»¥ä¾¿å¯ä»¥å°åé¨æ¥è¯¢çç»æä¼ éç»å¤é¨æ¥è¯¢ãæ§è¡è¿ç¨å¯ä»¥åèä¸å¾ï¼\n   \n   \n\nå­æ¥è¯¢çå­æ¥è¯¢\n\nselect cust_name, cust_contact\nfrom customers\nwhere cust_id in (select cust_id\n                  from orders\n                  where order_num in (select order_num\n                                      from orderitems\n                                      where prod_id = 'rgan01'));\n\n\n\n# where å­å¥\n\nå¨ sql è¯­å¥ä¸­ï¼æ°æ®æ ¹æ® where å­å¥ä¸­æå®çæç´¢æ¡ä»¶è¿è¡è¿æ»¤ã\n\nwhere å­å¥çåºæ¬æ ¼å¼å¦ä¸ï¼\n\nselect â¦â¦(åå) from â¦â¦(è¡¨å) where â¦â¦(å­å¥æ¡ä»¶)\n\n\nwhere å­å¥ç¨äºè¿æ»¤è®°å½ï¼å³ç¼©å°è®¿é®æ°æ®çèå´ãwhere åè·ä¸ä¸ªè¿å true æ false çæ¡ä»¶ã\n\nwhere å¯ä»¥ä¸ selectï¼update å delete ä¸èµ·ä½¿ç¨ã\n\nselect è¯­å¥ä¸­ç where å­å¥\n\nselect * from customers\nwhere cust_name = 'kids place';\n\n\nupdate è¯­å¥ä¸­ç where å­å¥\n\nupdate customers\nset cust_name = 'jack jones'\nwhere cust_name = 'kids place';\n\n\ndelete è¯­å¥ä¸­ç where å­å¥\n\ndelete from customers\nwhere cust_name = 'kids place';\n\n\nå¯ä»¥å¨ where å­å¥ä¸­ä½¿ç¨çæä½ç¬¦ï¼\n\n\n# æ¯è¾æä½ç¬¦\n\nè¿ç®ç¬¦   æè¿°\n=     ç­äº\n<>    ä¸ç­äºãæ³¨éï¼å¨ sql çä¸äºçæ¬ä¸­ï¼è¯¥æä½ç¬¦å¯è¢«åæ !=\n>     å¤§äº\n<     å°äº\n>=    å¤§äºç­äº\n<=    å°äºç­äº\n\n\n# èå´æä½ç¬¦\n\nè¿ç®ç¬¦       æè¿°\nbetween   å¨æä¸ªèå´å\nin        æå®éå¯¹æä¸ªåçå¤ä¸ªå¯è½å¼\n\n * in æä½ç¬¦å¨ where å­å¥ä¸­ä½¿ç¨ï¼ä½ç¨æ¯å¨æå®çå ä¸ªç¹å®å¼ä¸­ä»»éä¸ä¸ªå¼ã\n\n * between æä½ç¬¦å¨ where å­å¥ä¸­ä½¿ç¨ï¼ä½ç¨æ¯éåä»äºæä¸ªèå´åçå¼ã\n\nin ç¤ºä¾\n\nselect *\nfrom products\nwhere vend_id in ('dll01', 'brs01');\n\n\nbetween ç¤ºä¾\n\nselect *\nfrom products\nwhere prod_price between 3 and 5;\n\n\n\n# é»è¾æä½ç¬¦\n\nè¿ç®ç¬¦   æè¿°\nand   å¹¶ä¸ï¼ä¸ï¼\nor    æèï¼æï¼\nnot   å¦å®ï¼éï¼\n\nandãorãnot æ¯ç¨äºå¯¹è¿æ»¤æ¡ä»¶çé»è¾å¤çæä»¤ã\n\n * and ä¼åçº§é«äº orï¼ä¸ºäºæç¡®å¤çé¡ºåºï¼å¯ä»¥ä½¿ç¨ ()ãand æä½ç¬¦è¡¨ç¤ºå·¦å³æ¡ä»¶é½è¦æ»¡è¶³ã\n\n * or æä½ç¬¦è¡¨ç¤ºå·¦å³æ¡ä»¶æ»¡è¶³ä»»æä¸ä¸ªå³å¯ã\n\n * not æä½ç¬¦ç¨äºå¦å®ä¸ä¸ªæ¡ä»¶ã\n\nand ç¤ºä¾\n\nselect prod_id, prod_name, prod_price\nfrom products\nwhere vend_id = 'dll01' and prod_price <= 4;\n\n\nor ç¤ºä¾\n\nselect prod_id, prod_name, prod_price\nfrom products\nwhere vend_id = 'dll01' or vend_id = 'brs01';\n\n\nnot ç¤ºä¾\n\nselect *\nfrom products\nwhere prod_price not between 3 and 5;\n\n\n\n# ééç¬¦\n\nè¿ç®ç¬¦    æè¿°\nlike   æç´¢æç§æ¨¡å¼\n%      è¡¨ç¤ºä»»æå­ç¬¦åºç°ä»»ææ¬¡æ°\n_      è¡¨ç¤ºä»»æå­ç¬¦åºç°ä¸æ¬¡\n[]     å¿é¡»å¹éæå®ä½ç½®çä¸ä¸ªå­ç¬¦\n\nlike æä½ç¬¦å¨ where å­å¥ä¸­ä½¿ç¨ï¼ä½ç¨æ¯ç¡®å®å­ç¬¦ä¸²æ¯å¦å¹éæ¨¡å¼ãåªæå­æ®µæ¯ææ¬å¼æ¶æä½¿ç¨ likeã\n\nlike æ¯æä»¥ä¸ééç¬¦å¹ééé¡¹ï¼\n\n * % è¡¨ç¤ºä»»ä½å­ç¬¦åºç°ä»»ææ¬¡æ°ã\n * _ è¡¨ç¤ºä»»ä½å­ç¬¦åºç°ä¸æ¬¡ã\n * [] å¿é¡»å¹éæå®ä½ç½®çä¸ä¸ªå­ç¬¦ã\n\n> æ³¨æï¼ä¸è¦æ»¥ç¨ééç¬¦ï¼ééç¬¦ä½äºå¼å¤´å¤å¹éä¼éå¸¸æ¢ã\n\n% ç¤ºä¾ï¼\n\nselect prod_id, prod_name, prod_price\nfrom products\nwhere prod_name like '%bean bag%';\n\n\n_ ç¤ºä¾ï¼\n\nselect prod_id, prod_name, prod_price\nfrom products\nwhere prod_name like '__ inch teddy bear';\n\n\n * \n\n\n# æåºï¼order byï¼\n\n> order by ç¨äºå¯¹ç»æéè¿è¡æåºã\n\norder by æä¸¤ç§æåºæ¨¡å¼ï¼\n\n * asc ï¼ååºï¼é»è®¤ï¼\n * desc ï¼éåº\n\nå¯ä»¥æå¤ä¸ªåè¿è¡æåºï¼å¹¶ä¸ä¸ºæ¯ä¸ªåæå®ä¸åçæåºæ¹å¼ã\n\næå®å¤ä¸ªåçæåºç¤ºä¾ï¼\n\nselect * from products\norder by prod_price desc, prod_name asc;\n\n\n\n# æ°æ®å®ä¹ï¼createãalterãdropï¼\n\n> ddl çä¸»è¦åè½æ¯å®ä¹æ°æ®åºå¯¹è±¡ï¼å¦ï¼æ°æ®åºãæ°æ®è¡¨ãè§å¾ãç´¢å¼ç­ï¼ã\n\n\n# æ°æ®åºï¼databaseï¼\n\n# åå»ºæ°æ®åº\n\ncreate database if not exists db_tutorial;\n\n\n# å é¤æ°æ®åº\n\ndrop database if exists db_tutorial;\n\n\n# éæ©æ°æ®åº\n\nuse db_tutorial;\n\n\n\n# æ°æ®è¡¨ï¼tableï¼\n\n# å é¤æ°æ®è¡¨\n\ndrop table if exists user;\ndrop table if exists vip_user;\n\n\n# åå»ºæ°æ®è¡¨\n\næ®éåå»º\n\ncreate table user (\n    id       int(10) unsigned not null comment 'id',\n    username varchar(64)      not null default 'default' comment 'ç¨æ·å',\n    password varchar(64)      not null default 'default' comment 'å¯ç ',\n    email    varchar(64)      not null default 'default' comment 'é®ç®±'\n) comment ='ç¨æ·è¡¨';\n\n\næ ¹æ®å·²æçè¡¨åå»ºæ°è¡¨\n\ncreate table vip_user as\nselect *\nfrom user;\n\n\n# ä¿®æ¹æ°æ®è¡¨\n\n# æ·»å å\n\nalter table user\nadd age int(3);\n\n\n# å é¤å\n\nalter table user\ndrop column age;\n\n\n# ä¿®æ¹å\n\nalter table `user`\nmodify column age tinyint;\n\n\n\n# è§å¾ï¼viewï¼\n\n> è§å¾æ¯åºäº sql è¯­å¥çç»æéçå¯è§åçè¡¨ãè§å¾æ¯èæçè¡¨ï¼æ¬èº«ä¸å­å¨æ°æ®ï¼ä¹å°±ä¸è½å¯¹å¶è¿è¡ç´¢å¼æä½ãå¯¹è§å¾çæä½åå¯¹æ®éè¡¨çæä½ä¸æ ·ã\n\nè§å¾çä½ç¨ï¼\n\n * ç®åå¤æç sql æä½ï¼æ¯å¦å¤æçè¿æ¥ã\n * åªä½¿ç¨å®éè¡¨çä¸é¨åæ°æ®ã\n * éè¿åªç»ç¨æ·è®¿é®è§å¾çæéï¼ä¿è¯æ°æ®çå®å¨æ§ã\n * æ´æ¹æ°æ®æ ¼å¼åè¡¨ç¤ºã\n\n# åå»ºè§å¾\n\ncreate view top_10_user_view as\nselect id, username\nfrom user\nwhere id < 10;\n\n\n# å é¤è§å¾\n\ndrop view top_10_user_view;\n\n\n\n# ç´¢å¼ï¼indexï¼\n\n> éè¿ç´¢å¼å¯ä»¥æ´å å¿«éé«æå°æ¥è¯¢æ°æ®ãç¨æ·æ æ³çå°ç´¢å¼ï¼å®ä»¬åªè½è¢«ç¨æ¥å éæ¥è¯¢ã\n\næ´æ°ä¸ä¸ªåå«ç´¢å¼çè¡¨éè¦æ¯æ´æ°ä¸ä¸ªæ²¡æç´¢å¼çè¡¨è±è´¹æ´å¤çæ¶é´ï¼è¿æ¯ç±äºç´¢å¼æ¬èº«ä¹éè¦æ´æ°ãå æ­¤ï¼çæ³çåæ³æ¯ä»ä»å¨å¸¸å¸¸è¢«æç´¢çåï¼ä»¥åè¡¨ï¼ä¸é¢åå»ºç´¢å¼ã\n\nå¯ä¸ç´¢å¼ï¼å¯ä¸ç´¢å¼è¡¨ææ­¤ç´¢å¼çæ¯ä¸ä¸ªç´¢å¼å¼åªå¯¹åºå¯ä¸çæ°æ®è®°å½ã\n\n# åå»ºç´¢å¼\n\ncreate index idx_email\n    on user(email);\n\n\n# åå»ºå¯ä¸ç´¢å¼\n\ncreate unique index uniq_username\n    on user(username);\n\n\n# å é¤ç´¢å¼\n\nalter table user\ndrop index idx_email;\nalter table user\ndrop index uniq_username;\n\n\n# æ·»å ä¸»é®\n\nalter table user\nadd primary key (id);\n\n\n# å é¤ä¸»é®\n\nalter table user\ndrop primary key;\n\n\n\n# çº¦æ\n\n> sql çº¦æç¨äºè§å®è¡¨ä¸­çæ°æ®è§åã\n\n * å¦æå­å¨è¿åçº¦æçæ°æ®è¡ä¸ºï¼è¡ä¸ºä¼è¢«çº¦æç»æ­¢ã\n * çº¦æå¯ä»¥å¨åå»ºè¡¨æ¶è§å®ï¼éè¿ create table è¯­å¥ï¼ï¼æèå¨è¡¨åå»ºä¹åè§å®ï¼éè¿ alter table è¯­å¥ï¼ã\n * çº¦æç±»å\n   * not null - æç¤ºæåä¸è½å­å¨ null å¼ã\n   * unique - ä¿è¯æåçæ¯è¡å¿é¡»æå¯ä¸çå¼ã\n   * primary key - not null å unique çç»åãç¡®ä¿æåï¼æä¸¤ä¸ªåå¤ä¸ªåçç»åï¼æå¯ä¸æ è¯ï¼æå©äºæ´å®¹ææ´å¿«éå°æ¾å°è¡¨ä¸­çä¸ä¸ªç¹å®çè®°å½ã\n   * foreign key - ä¿è¯ä¸ä¸ªè¡¨ä¸­çæ°æ®å¹éå¦ä¸ä¸ªè¡¨ä¸­çå¼çåç§å®æ´æ§ã\n   * check - ä¿è¯åä¸­çå¼ç¬¦åæå®çæ¡ä»¶ã\n   * default - è§å®æ²¡æç»åèµå¼æ¶çé»è®¤å¼ã\n\nåå»ºè¡¨æ¶ä½¿ç¨çº¦ææ¡ä»¶ï¼\n\ncreate table users (\n  id int(10) unsigned not null auto_increment comment 'èªå¢id',\n  username varchar(64) not null unique default 'default' comment 'ç¨æ·å',\n  password varchar(64) not null default 'default' comment 'å¯ç ',\n  email varchar(64) not null default 'default' comment 'é®ç®±å°å',\n  enabled tinyint(4) default null comment 'æ¯å¦ææ',\n  primary key (id)\n) engine=innodb auto_increment=2 default charset=utf8mb4 comment='ç¨æ·è¡¨';\n\n\n\n# åèèµæ\n\n * ãsql å¿ç¥å¿ä¼ã\n * ãæµå¥æ·±åºãmysql ä¸­äºå¡çå®ç°\n * mysql çå­¦ä¹ --è§¦åå¨\n * ç»´åºç¾ç§è¯æ¡ - sql\n * https://www.sitesbay.com/sql/index\n * sql subqueries\n * quick breakdown of the types of joins\n * sql union\n * sql database security\n * mysql ä¸­çå­å¨è¿ç¨",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"å³ç³»åæ°æ®åºé¢è¯",frontmatter:{title:"å³ç³»åæ°æ®åºé¢è¯",date:"2020-01-15T23:21:02.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","ç»¼å"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","é¢è¯"],permalink:"/pages/9bb28f/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/01.%E7%BB%BC%E5%90%88/01.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E9%9D%A2%E8%AF%95.html",relativePath:"12.æ°æ®åº/03.å³ç³»åæ°æ®åº/01.ç»¼å/01.å³ç³»åæ°æ®åºé¢è¯.md",key:"v-099fc77f",path:"/pages/9bb28f/",headers:[{level:2,title:"ç´¢å¼åçº¦æ",slug:"ç´¢å¼åçº¦æ",normalizedTitle:"ç´¢å¼åçº¦æ",charIndex:15},{level:3,title:"ä»ä¹æ¯ç´¢å¼",slug:"ä»ä¹æ¯ç´¢å¼",normalizedTitle:"ä»ä¹æ¯ç´¢å¼",charIndex:25},{level:3,title:"ç´¢å¼çä¼ç¼ºç¹",slug:"ç´¢å¼çä¼ç¼ºç¹",normalizedTitle:"ç´¢å¼çä¼ç¼ºç¹",charIndex:79},{level:3,title:"ä½æ¶ä½¿ç¨ç´¢å¼",slug:"ä½æ¶ä½¿ç¨ç´¢å¼",normalizedTitle:"ä½æ¶ä½¿ç¨ç´¢å¼",charIndex:460},{level:3,title:"ç´¢å¼çç±»å",slug:"ç´¢å¼çç±»å",normalizedTitle:"ç´¢å¼çç±»å",charIndex:767},{level:3,title:"ç´¢å¼çæ°æ®ç»æ",slug:"ç´¢å¼çæ°æ®ç»æ",normalizedTitle:"ç´¢å¼çæ°æ®ç»æ",charIndex:1209},{level:4,title:"B æ ",slug:"b-æ ",normalizedTitle:"b æ ",charIndex:1237},{level:4,title:"B+ æ ",slug:"b-æ -2",normalizedTitle:"b+ æ ",charIndex:1241},{level:4,title:"B æ  vs. B+ æ ",slug:"b-æ -vs-b-æ ",normalizedTitle:"b æ  vs. b+ æ ",charIndex:2196},{level:4,title:"Hash",slug:"hash",normalizedTitle:"hash",charIndex:2454},{level:3,title:"ç´¢å¼ç­ç¥",slug:"ç´¢å¼ç­ç¥",normalizedTitle:"ç´¢å¼ç­ç¥",charIndex:2820},{level:4,title:"ç´¢å¼åºæ¬åå",slug:"ç´¢å¼åºæ¬åå",normalizedTitle:"ç´¢å¼åºæ¬åå",charIndex:2828},{level:4,title:"ç¬ç«çå",slug:"ç¬ç«çå",normalizedTitle:"ç¬ç«çå",charIndex:2945},{level:4,title:"åç¼ç´¢å¼åç´¢å¼éæ©æ§",slug:"åç¼ç´¢å¼åç´¢å¼éæ©æ§",normalizedTitle:"åç¼ç´¢å¼åç´¢å¼éæ©æ§",charIndex:3143},{level:4,title:"å¤åç´¢å¼",slug:"å¤åç´¢å¼",normalizedTitle:"å¤åç´¢å¼",charIndex:3631},{level:4,title:"èç°ç´¢å¼",slug:"èç°ç´¢å¼",normalizedTitle:"èç°ç´¢å¼",charIndex:3828},{level:4,title:"è¦çç´¢å¼",slug:"è¦çç´¢å¼",normalizedTitle:"è¦çç´¢å¼",charIndex:4023},{level:4,title:"ä½¿ç¨ç´¢å¼æ«ææ¥åæåº",slug:"ä½¿ç¨ç´¢å¼æ«ææ¥åæåº",normalizedTitle:"ä½¿ç¨ç´¢å¼æ«ææ¥åæåº",charIndex:4210},{level:4,title:"æå·¦åç¼å¹éåå",slug:"æå·¦åç¼å¹éåå",normalizedTitle:"æå·¦åç¼å¹éåå",charIndex:4299},{level:4,title:"= å in å¯ä»¥ä¹±åº",slug:"å-in-å¯ä»¥ä¹±åº",normalizedTitle:"= å in å¯ä»¥ä¹±åº",charIndex:4652},{level:3,title:"çº¦æ",slug:"çº¦æ",normalizedTitle:"çº¦æ",charIndex:18},{level:2,title:"å¹¶åæ§å¶",slug:"å¹¶åæ§å¶",normalizedTitle:"å¹¶åæ§å¶",charIndex:5185},{level:3,title:"ä¹è§éåæ²è§é",slug:"ä¹è§éåæ²è§é",normalizedTitle:"ä¹è§éåæ²è§é",charIndex:5194},{level:3,title:"è¡çº§éåè¡¨çº§é",slug:"è¡çº§éåè¡¨çº§é",normalizedTitle:"è¡çº§éåè¡¨çº§é",charIndex:5521},{level:3,title:"è¯»åé",slug:"è¯»åé",normalizedTitle:"è¯»åé",charIndex:5898},{level:3,title:"æåé",slug:"æåé",normalizedTitle:"æåé",charIndex:6114},{level:3,title:"MVCC",slug:"mvcc",normalizedTitle:"mvcc",charIndex:6267},{level:3,title:"Next-key é",slug:"next-key-é",normalizedTitle:"next-key é",charIndex:6710},{level:2,title:"äºå¡",slug:"äºå¡",normalizedTitle:"äºå¡",charIndex:5252},{level:3,title:"ACID",slug:"acid",normalizedTitle:"acid",charIndex:7504},{level:3,title:"å¹¶åä¸è´æ§é®é¢",slug:"å¹¶åä¸è´æ§é®é¢",normalizedTitle:"å¹¶åä¸è´æ§é®é¢",charIndex:7773},{level:3,title:"äºå¡éç¦»",slug:"äºå¡éç¦»",normalizedTitle:"äºå¡éç¦»",charIndex:8229},{level:3,title:"åå¸å¼äºå¡",slug:"åå¸å¼äºå¡",normalizedTitle:"åå¸å¼äºå¡",charIndex:8593},{level:4,title:"ä¸¤é¶æ®µæäº¤",slug:"ä¸¤é¶æ®µæäº¤",normalizedTitle:"ä¸¤é¶æ®µæäº¤",charIndex:8728},{level:4,title:"ææ§äºå¡",slug:"ææ§äºå¡",normalizedTitle:"ææ§äºå¡",charIndex:8973},{level:4,title:"äºå¡æ¹æ¡å¯¹æ¯",slug:"äºå¡æ¹æ¡å¯¹æ¯",normalizedTitle:"äºå¡æ¹æ¡å¯¹æ¯",charIndex:9409},{level:2,title:"ååºåè¡¨",slug:"ååºåè¡¨",normalizedTitle:"ååºåè¡¨",charIndex:9639},{level:3,title:"ä»ä¹æ¯ååºåè¡¨",slug:"ä»ä¹æ¯ååºåè¡¨",normalizedTitle:"ä»ä¹æ¯ååºåè¡¨",charIndex:9648},{level:4,title:"åç´åå",slug:"åç´åå",normalizedTitle:"åç´åå",charIndex:9822},{level:4,title:"æ°´å¹³æå",slug:"æ°´å¹³æå",normalizedTitle:"æ°´å¹³æå",charIndex:9678},{level:4,title:"ååºåè¡¨çä¼ç¹",slug:"ååºåè¡¨çä¼ç¹",normalizedTitle:"ååºåè¡¨çä¼ç¹",charIndex:10400},{level:4,title:"ååºåè¡¨ç­ç¥",slug:"ååºåè¡¨ç­ç¥",normalizedTitle:"ååºåè¡¨ç­ç¥",charIndex:10601},{level:3,title:"ååºåè¡¨ä¸­é´ä»¶",slug:"ååºåè¡¨ä¸­é´ä»¶",normalizedTitle:"ååºåè¡¨ä¸­é´ä»¶",charIndex:10873},{level:4,title:"å¸¸è§çååºåè¡¨ä¸­é´ä»¶",slug:"å¸¸è§çååºåè¡¨ä¸­é´ä»¶",normalizedTitle:"å¸¸è§çååºåè¡¨ä¸­é´ä»¶",charIndex:10981},{level:4,title:"ååºåè¡¨ä¸­é´ä»¶ææ¯éå",slug:"ååºåè¡¨ä¸­é´ä»¶ææ¯éå",normalizedTitle:"ååºåè¡¨ä¸­é´ä»¶ææ¯éå",charIndex:11770},{level:3,title:"ååºåè¡¨çé®é¢",slug:"ååºåè¡¨çé®é¢",normalizedTitle:"ååºåè¡¨çé®é¢",charIndex:12277},{level:4,title:"åå¸å¼äºå¡",slug:"åå¸å¼äºå¡-2",normalizedTitle:"åå¸å¼äºå¡",charIndex:8593},{level:4,title:"è·¨èç¹ Join",slug:"è·¨èç¹-join",normalizedTitle:"è·¨èç¹ join",charIndex:12577},{level:4,title:"è·¨èç¹ç count,order by,group by ä»¥åèåå½æ°",slug:"è·¨èç¹ç-count-order-by-group-by-ä»¥åèåå½æ°",normalizedTitle:"è·¨èç¹ç count,order by,group by ä»¥åèåå½æ°",charIndex:12705},{level:4,title:"åå¸å¼ ID",slug:"åå¸å¼-id",normalizedTitle:"åå¸å¼ id",charIndex:10858},{level:4,title:"æ°æ®è¿ç§»ï¼å®¹éè§åï¼æ©å®¹ç­é®é¢",slug:"æ°æ®è¿ç§»-å®¹éè§å-æ©å®¹ç­é®é¢",normalizedTitle:"æ°æ®è¿ç§»ï¼å®¹éè§åï¼æ©å®¹ç­é®é¢",charIndex:13352},{level:2,title:"éç¾¤",slug:"éç¾¤",normalizedTitle:"éç¾¤",charIndex:10276},{level:3,title:"å¤å¶æºå¶",slug:"å¤å¶æºå¶",normalizedTitle:"å¤å¶æºå¶",charIndex:13643},{level:3,title:"è¯»ååç¦»",slug:"è¯»ååç¦»",normalizedTitle:"è¯»ååç¦»",charIndex:11177},{level:2,title:"æ°æ®åºä¼å",slug:"æ°æ®åºä¼å",normalizedTitle:"æ°æ®åºä¼å",charIndex:14137},{level:3,title:"SQL ä¼å",slug:"sql-ä¼å",normalizedTitle:"sql ä¼å",charIndex:14156},{level:4,title:"æ§è¡è®¡å",slug:"æ§è¡è®¡å",normalizedTitle:"æ§è¡è®¡å",charIndex:14305},{level:4,title:"è®¿é®æ°æ®ä¼å",slug:"è®¿é®æ°æ®ä¼å",normalizedTitle:"è®¿é®æ°æ®ä¼å",charIndex:14537},{level:4,title:"éææ¥è¯¢æ¹å¼",slug:"éææ¥è¯¢æ¹å¼",normalizedTitle:"éææ¥è¯¢æ¹å¼",charIndex:14793},{level:5,title:"ååæ¥è¯¢",slug:"ååæ¥è¯¢",normalizedTitle:"ååæ¥è¯¢",charIndex:14803},{level:5,title:"åè§£å³èæ¥è¯¢",slug:"åè§£å³èæ¥è¯¢",normalizedTitle:"åè§£å³èæ¥è¯¢",charIndex:15112},{level:4,title:"SQL è¯­å¥ç»è",slug:"sql-è¯­å¥ç»è",normalizedTitle:"sql è¯­å¥ç»è",charIndex:15703},{level:5,title:"éæ©æææççè¡¨åé¡ºåº",slug:"éæ©æææççè¡¨åé¡ºåº",normalizedTitle:"éæ©æææççè¡¨åé¡ºåº",charIndex:15715},{level:5,title:"WHERE å­å¥ä¸­çè¿æ¥é¡ºåº",slug:"where-å­å¥ä¸­çè¿æ¥é¡ºåº",normalizedTitle:"where å­å¥ä¸­çè¿æ¥é¡ºåº",charIndex:16178},{level:5,title:"SELECT å­å¥ä¸­é¿åä½¿ç¨ * å·",slug:"select-å­å¥ä¸­é¿åä½¿ç¨-å·",normalizedTitle:"select å­å¥ä¸­é¿åä½¿ç¨ * å·",charIndex:16435},{level:5,title:"ç¨ TRUNCATE æ¿ä»£ DELETE",slug:"ç¨-truncate-æ¿ä»£-delete",normalizedTitle:"ç¨ truncate æ¿ä»£ delete",charIndex:16590},{level:5,title:"ä½¿ç¨åé¨å½æ°æé« SQL æç",slug:"ä½¿ç¨åé¨å½æ°æé«-sql-æç",normalizedTitle:"ä½¿ç¨åé¨å½æ°æé« sql æç",charIndex:16700},{level:5,title:"ä½¿ç¨è¡¨æåçå«å",slug:"ä½¿ç¨è¡¨æåçå«å",normalizedTitle:"ä½¿ç¨è¡¨æåçå«å",charIndex:16788},{level:5,title:"SQL å³é®å­å¤§å",slug:"sql-å³é®å­å¤§å",normalizedTitle:"sql å³é®å­å¤§å",charIndex:16855},{level:5,title:"ç¨ >= æ¿ä»£ >",slug:"ç¨-æ¿ä»£",normalizedTitle:"ç¨ &gt;= æ¿ä»£ &gt;",charIndex:null},{level:5,title:"ç¨ IN æ¿ä»£ OR",slug:"ç¨-in-æ¿ä»£-or",normalizedTitle:"ç¨ in æ¿ä»£ or",charIndex:17095},{level:5,title:"æ»æ¯ä½¿ç¨ç´¢å¼çç¬¬ä¸ä¸ªå",slug:"æ»æ¯ä½¿ç¨ç´¢å¼çç¬¬ä¸ä¸ªå",normalizedTitle:"æ»æ¯ä½¿ç¨ç´¢å¼çç¬¬ä¸ä¸ªå",charIndex:17242},{level:5,title:"SQL å³é®å­å°½éå¤§å",slug:"sql-å³é®å­å°½éå¤§å",normalizedTitle:"sql å³é®å­å°½éå¤§å",charIndex:17474},{level:3,title:"ç»æä¼å",slug:"ç»æä¼å",normalizedTitle:"ç»æä¼å",charIndex:14163},{level:4,title:"æ°æ®ç±»åä¼ååå",slug:"æ°æ®ç±»åä¼ååå",normalizedTitle:"æ°æ®ç±»åä¼ååå",charIndex:17631},{level:4,title:"èå¼ååèå¼",slug:"èå¼ååèå¼",normalizedTitle:"èå¼ååèå¼",charIndex:17576},{level:3,title:"éç½®ä¼å",slug:"éç½®ä¼å",normalizedTitle:"éç½®ä¼å",charIndex:14168},{level:3,title:"ç¡¬ä»¶ä¼å",slug:"ç¡¬ä»¶ä¼å",normalizedTitle:"ç¡¬ä»¶ä¼å",charIndex:14173},{level:2,title:"æ°æ®åºçè®º",slug:"æ°æ®åºçè®º",normalizedTitle:"æ°æ®åºçè®º",charIndex:18199},{level:3,title:"å½æ°ä¾èµ",slug:"å½æ°ä¾èµ",normalizedTitle:"å½æ°ä¾èµ",charIndex:18209},{level:3,title:"å¼å¸¸",slug:"å¼å¸¸",normalizedTitle:"å¼å¸¸",charIndex:18419},{level:3,title:"èå¼",slug:"èå¼",normalizedTitle:"èå¼",charIndex:17576},{level:4,title:"ç¬¬ä¸èå¼ (1NF)",slug:"ç¬¬ä¸èå¼-1nf",normalizedTitle:"ç¬¬ä¸èå¼ (1nf)",charIndex:18999},{level:4,title:"ç¬¬äºèå¼ (2NF)",slug:"ç¬¬äºèå¼-2nf",normalizedTitle:"ç¬¬äºèå¼ (2nf)",charIndex:19021},{level:4,title:"ç¬¬ä¸èå¼ (3NF)",slug:"ç¬¬ä¸èå¼-3nf",normalizedTitle:"ç¬¬ä¸èå¼ (3nf)",charIndex:19806},{level:2,title:"å­å¨å¼æ",slug:"å­å¨å¼æ",normalizedTitle:"å­å¨å¼æ",charIndex:4103},{level:3,title:"InnoDB vs. MyISAM",slug:"innodb-vs-myisam",normalizedTitle:"innodb vs. myisam",charIndex:20318},{level:2,title:"æ°æ®åºæ¯è¾",slug:"æ°æ®åºæ¯è¾",normalizedTitle:"æ°æ®åºæ¯è¾",charIndex:20687},{level:3,title:"å¸¸è§æ°æ®åºæ¯è¾",slug:"å¸¸è§æ°æ®åºæ¯è¾",normalizedTitle:"å¸¸è§æ°æ®åºæ¯è¾",charIndex:20697},{level:3,title:"Oracle vs. Mysql",slug:"oracle-vs-mysql",normalizedTitle:"oracle vs. mysql",charIndex:21103},{level:4,title:"æ°æ®åºå¯¹è±¡å·®å¼",slug:"æ°æ®åºå¯¹è±¡å·®å¼",normalizedTitle:"æ°æ®åºå¯¹è±¡å·®å¼",charIndex:21179},{level:4,title:"SQL å·®å¼",slug:"sql-å·®å¼",normalizedTitle:"sql å·®å¼",charIndex:21346},{level:4,title:"äºå¡å·®å¼",slug:"äºå¡å·®å¼",normalizedTitle:"äºå¡å·®å¼",charIndex:21740},{level:3,title:"æ°æ®ç±»åæ¯è¾",slug:"æ°æ®ç±»åæ¯è¾",normalizedTitle:"æ°æ®ç±»åæ¯è¾",charIndex:21975},{level:2,title:"SQL FAQ",slug:"sql-faq",normalizedTitle:"sql faq",charIndex:22640},{level:3,title:"SELECT COUNT(*)ãSELECT COUNT(1) å SELECT COUNT(å·ä½å­æ®µ) æ§è½æå·®å«åï¼",slug:"select-count-ãselect-count-1-å-select-count-å·ä½å­æ®µ-æ§è½æå·®å«å",normalizedTitle:"select count(*)ãselect count(1) å select count(å·ä½å­æ®µ) æ§è½æå·®å«åï¼",charIndex:22652},{level:3,title:"ORDER BY æ¯å¯¹åçç»æåºè¿æ¯å¯¹åç»ä¸­çè®°å½æåºå¢ï¼",slug:"order-by-æ¯å¯¹åçç»æåºè¿æ¯å¯¹åç»ä¸­çè®°å½æåºå¢",normalizedTitle:"order by æ¯å¯¹åçç»æåºè¿æ¯å¯¹åç»ä¸­çè®°å½æåºå¢ï¼",charIndex:23607},{level:3,title:"SELECT è¯­å¥åé¨çæ§è¡æ­¥éª¤",slug:"select-è¯­å¥åé¨çæ§è¡æ­¥éª¤",normalizedTitle:"select è¯­å¥åé¨çæ§è¡æ­¥éª¤",charIndex:23746},{level:3,title:"è§£åªç§æåµä¸åºè¯¥ä½¿ç¨ EXISTSï¼åªç§æåµåºè¯¥ç¨ IN",slug:"è§£åªç§æåµä¸åºè¯¥ä½¿ç¨-exists-åªç§æåµåºè¯¥ç¨-in",normalizedTitle:"è§£åªç§æåµä¸åºè¯¥ä½¿ç¨ existsï¼åªç§æåµåºè¯¥ç¨ in",charIndex:23983},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:24467}],headersStr:"ç´¢å¼åçº¦æ ä»ä¹æ¯ç´¢å¼ ç´¢å¼çä¼ç¼ºç¹ ä½æ¶ä½¿ç¨ç´¢å¼ ç´¢å¼çç±»å ç´¢å¼çæ°æ®ç»æ B æ  B+ æ  B æ  vs. B+ æ  Hash ç´¢å¼ç­ç¥ ç´¢å¼åºæ¬åå ç¬ç«çå åç¼ç´¢å¼åç´¢å¼éæ©æ§ å¤åç´¢å¼ èç°ç´¢å¼ è¦çç´¢å¼ ä½¿ç¨ç´¢å¼æ«ææ¥åæåº æå·¦åç¼å¹éåå = å in å¯ä»¥ä¹±åº çº¦æ å¹¶åæ§å¶ ä¹è§éåæ²è§é è¡çº§éåè¡¨çº§é è¯»åé æåé MVCC Next-key é äºå¡ ACID å¹¶åä¸è´æ§é®é¢ äºå¡éç¦» åå¸å¼äºå¡ ä¸¤é¶æ®µæäº¤ ææ§äºå¡ äºå¡æ¹æ¡å¯¹æ¯ ååºåè¡¨ ä»ä¹æ¯ååºåè¡¨ åç´åå æ°´å¹³æå ååºåè¡¨çä¼ç¹ ååºåè¡¨ç­ç¥ ååºåè¡¨ä¸­é´ä»¶ å¸¸è§çååºåè¡¨ä¸­é´ä»¶ ååºåè¡¨ä¸­é´ä»¶ææ¯éå ååºåè¡¨çé®é¢ åå¸å¼äºå¡ è·¨èç¹ Join è·¨èç¹ç count,order by,group by ä»¥åèåå½æ° åå¸å¼ ID æ°æ®è¿ç§»ï¼å®¹éè§åï¼æ©å®¹ç­é®é¢ éç¾¤ å¤å¶æºå¶ è¯»ååç¦» æ°æ®åºä¼å SQL ä¼å æ§è¡è®¡å è®¿é®æ°æ®ä¼å éææ¥è¯¢æ¹å¼ ååæ¥è¯¢ åè§£å³èæ¥è¯¢ SQL è¯­å¥ç»è éæ©æææççè¡¨åé¡ºåº WHERE å­å¥ä¸­çè¿æ¥é¡ºåº SELECT å­å¥ä¸­é¿åä½¿ç¨ * å· ç¨ TRUNCATE æ¿ä»£ DELETE ä½¿ç¨åé¨å½æ°æé« SQL æç ä½¿ç¨è¡¨æåçå«å SQL å³é®å­å¤§å ç¨ >= æ¿ä»£ > ç¨ IN æ¿ä»£ OR æ»æ¯ä½¿ç¨ç´¢å¼çç¬¬ä¸ä¸ªå SQL å³é®å­å°½éå¤§å ç»æä¼å æ°æ®ç±»åä¼ååå èå¼ååèå¼ éç½®ä¼å ç¡¬ä»¶ä¼å æ°æ®åºçè®º å½æ°ä¾èµ å¼å¸¸ èå¼ ç¬¬ä¸èå¼ (1NF) ç¬¬äºèå¼ (2NF) ç¬¬ä¸èå¼ (3NF) å­å¨å¼æ InnoDB vs. MyISAM æ°æ®åºæ¯è¾ å¸¸è§æ°æ®åºæ¯è¾ Oracle vs. Mysql æ°æ®åºå¯¹è±¡å·®å¼ SQL å·®å¼ äºå¡å·®å¼ æ°æ®ç±»åæ¯è¾ SQL FAQ SELECT COUNT(*)ãSELECT COUNT(1) å SELECT COUNT(å·ä½å­æ®µ) æ§è½æå·®å«åï¼ ORDER BY æ¯å¯¹åçç»æåºè¿æ¯å¯¹åç»ä¸­çè®°å½æåºå¢ï¼ SELECT è¯­å¥åé¨çæ§è¡æ­¥éª¤ è§£åªç§æåµä¸åºè¯¥ä½¿ç¨ EXISTSï¼åªç§æåµåºè¯¥ç¨ IN åèèµæ",content:"# å³ç³»åæ°æ®åºé¢è¯\n\n\n# ç´¢å¼åçº¦æ\n\n\n# ä»ä¹æ¯ç´¢å¼\n\nç´¢å¼æ¯å¯¹æ°æ®åºè¡¨ä¸­ä¸æå¤ä¸ªåçå¼è¿è¡æåºçç»æï¼æ¯å¸®å©æ°æ®åºé«ææ¥è¯¢æ°æ®çæ°æ®ç»æã\n\n\n# ç´¢å¼çä¼ç¼ºç¹\n\nâ ç´¢å¼çä¼ç¹ï¼\n\n * ç´¢å¼å¤§å¤§åå°äºæå¡å¨éè¦æ«æçæ°æ®éï¼ä»èå å¿«æ£ç´¢éåº¦ã\n * æ¯æè¡çº§éçæ°æ®åºï¼å¦ InnoDB ä¼å¨è®¿é®è¡çæ¶åå éãä½¿ç¨ç´¢å¼å¯ä»¥åå°è®¿é®çè¡æ°ï¼ä»èåå°éçç«äºï¼æé«å¹¶åã\n * ç´¢å¼å¯ä»¥å¸®å©æå¡å¨é¿åæåºåä¸´æ¶è¡¨ã\n * ç´¢å¼å¯ä»¥å°éæº I/O åä¸ºé¡ºåº I/Oã\n * å¯ä¸ç´¢å¼å¯ä»¥ç¡®ä¿æ¯ä¸è¡æ°æ®çå¯ä¸æ§ï¼éè¿ä½¿ç¨ç´¢å¼ï¼å¯ä»¥å¨æ¥è¯¢çè¿ç¨ä¸­ä½¿ç¨ä¼åéèå¨ï¼æé«ç³»ç»çæ§è½ã\n\nâ ç´¢å¼çç¼ºç¹ï¼\n\n * åå»ºåç»´æ¤ç´¢å¼è¦èè´¹æ¶é´ï¼è¿ä¼éçæ°æ®éçå¢å èå¢å ã\n * ç´¢å¼éè¦å ç¨é¢å¤çç©çç©ºé´ï¼é¤äºæ°æ®è¡¨å æ°æ®ç©ºé´ä¹å¤ï¼æ¯ä¸ä¸ªç´¢å¼è¿è¦å ä¸å®çç©çç©ºé´ï¼å¦æè¦å»ºç«ç»åç´¢å¼é£ä¹éè¦çç©ºé´å°±ä¼æ´å¤§ã\n * åæä½ï¼INSERT/UPDATE/DELETEï¼æ¶å¾å¯è½éè¦æ´æ°ç´¢å¼ï¼å¯¼è´æ°æ®åºçåæä½æ§è½éä½ã\n\n\n# ä½æ¶ä½¿ç¨ç´¢å¼\n\nç´¢å¼è½å¤è½»æå°æ¥è¯¢æ§è½æåå ä¸ªæ°éçº§ã\n\nâ ä»ä¹æåµéç¨ç´¢å¼ï¼\n\n * è¡¨ç»å¸¸è¿è¡ SELECT æä½ï¼\n * è¡¨çæ°æ®éæ¯è¾å¤§ï¼\n * ååç»å¸¸åºç°å¨ WHERE æè¿æ¥ï¼JOINï¼æ¡ä»¶ä¸­\n\nâ ä»ä¹æåµä¸éç¨ç´¢å¼ï¼\n\n * é¢ç¹åæä½ï¼ INSERT/UPDATE/DELETE ï¼- éè¦æ´æ°ç´¢å¼ç©ºé´ï¼\n * éå¸¸å°çè¡¨ - å¯¹äºéå¸¸å°çè¡¨ï¼å¤§é¨åæåµä¸ç®åçå¨è¡¨æ«ææ´é«æã\n * ååä¸ç»å¸¸åºç°å¨ WHERE æè¿æ¥ï¼JOINï¼æ¡ä»¶ä¸­ - ç´¢å¼å°±ä¼ç»å¸¸ä¸å½ä¸­ï¼æ²¡ææä¹ï¼è¿å¢å ç©ºé´å¼éã\n * å¯¹äºç¹å¤§åè¡¨ï¼å»ºç«åä½¿ç¨ç´¢å¼çä»£ä»·å°éä¹å¢é¿ãå¯ä»¥èèä½¿ç¨ååºææ¯æ Nosqlã\n\n\n# ç´¢å¼çç±»å\n\nä¸»æµçå³ç³»åæ°æ®åºä¸è¬é½æ¯æä»¥ä¸ç´¢å¼ç±»åï¼\n\nä»é»è¾ç±»åä¸ååï¼å³ä¸è¬åå»ºè¡¨æ¶è®¾ç½®çç´¢å¼ç±»åï¼ï¼\n\n * å¯ä¸ç´¢å¼ï¼UNIQUEï¼ï¼ç´¢å¼åçå¼å¿é¡»å¯ä¸ï¼ä½åè®¸æç©ºå¼ãå¦ææ¯ç»åç´¢å¼ï¼ååå¼çç»åå¿é¡»å¯ä¸ã\n * ä¸»é®ç´¢å¼ï¼PRIMARYï¼ï¼ä¸ç§ç¹æ®çå¯ä¸ç´¢å¼ï¼ä¸ä¸ªè¡¨åªè½æä¸ä¸ªä¸»é®ï¼ä¸åè®¸æç©ºå¼ãä¸è¬æ¯å¨å»ºè¡¨çæ¶ååæ¶åå»ºä¸»é®ç´¢å¼ã\n * æ®éç´¢å¼ï¼INDEXï¼ï¼æåºæ¬çç´¢å¼ï¼æ²¡æä»»ä½éå¶ã\n * ç»åç´¢å¼ï¼å¤ä¸ªå­æ®µä¸åå»ºçç´¢å¼ï¼åªæå¨æ¥è¯¢æ¡ä»¶ä¸­ä½¿ç¨äºåå»ºç´¢å¼æ¶çç¬¬ä¸ä¸ªå­æ®µï¼ç´¢å¼æä¼è¢«ä½¿ç¨ãä½¿ç¨ç»åç´¢å¼æ¶éµå¾ªæå·¦åç¼éåã\n\nä»ç©çå­å¨ä¸ååï¼\n\n * èéç´¢å¼(Clustered)ï¼è¡¨ä¸­åè¡çç©çé¡ºåºä¸é®å¼çé»è¾ï¼ç´¢å¼ï¼é¡ºåºç¸åï¼æ¯ä¸ªè¡¨åªè½æä¸ä¸ªã\n * éèéç´¢å¼(Non-clustered)ï¼éèéç´¢å¼æå®è¡¨çé»è¾é¡ºåºï¼ä¹å¯ä»¥è§ä¸ºäºçº§ç´¢å¼ãæ°æ®å­å¨å¨ä¸ä¸ªä½ç½®ï¼ç´¢å¼å­å¨å¨å¦ä¸ä¸ªä½ç½®ï¼ç´¢å¼ä¸­åå«æåæ°æ®å­å¨ä½ç½®çæéãå¯ä»¥æå¤ä¸ªï¼å°äº 249 ä¸ªã\n\n\n# ç´¢å¼çæ°æ®ç»æ\n\nä¸»æµæ°æ®åºçç´¢å¼ä¸è¬ä½¿ç¨çæ°æ®ç»æä¸ºï¼B æ ãB+ æ ã\n\n# B æ \n\nä¸æ£µ M é¶ç B-Tree æ»¡è¶³ä»¥ä¸æ¡ä»¶ï¼\n\n * æ¯ä¸ªç»ç¹è³å¤æ M ä¸ªå­©å­ï¼\n * é¤æ ¹ç»ç¹åå¶ç»ç¹å¤ï¼å¶å®æ¯ä¸ªç»ç¹è³å°æ M/2 ä¸ªå­©å­ï¼\n * æ ¹ç»ç¹è³å°æä¸¤ä¸ªå­©å­ï¼é¤éè¯¥æ ä»åå«ä¸ä¸ªç»ç¹ï¼ï¼\n * ææå¶ç»ç¹å¨åä¸å±ï¼å¶ç»ç¹ä¸åå«ä»»ä½å³é®å­ä¿¡æ¯ï¼\n * æ K ä¸ªå³é®å­çéå¶ç»ç¹æ°å¥½åå« K+1 ä¸ªå­©å­ï¼\n\nå¯¹äºä»»æç»ç¹ï¼å¶åé¨çå³é®å­ Key æ¯ååºæåçãæ¯ä¸ªèç¹ä¸­é½åå«äº dataã\n\n\n\nå¯¹äºæ¯ä¸ªç»ç¹ï¼ä¸»è¦åå«ä¸ä¸ªå³é®å­æ°ç» Key[]ï¼ä¸ä¸ªæéæ°ç»ï¼æåå¿å­ï¼Son[]ã\n\nå¨ B-Tree åï¼æ¥æ¾çæµç¨æ¯ï¼\n\n 1. ä½¿ç¨é¡ºåºæ¥æ¾ï¼æ°ç»é¿åº¦è¾ç­æ¶ï¼ææåæ¥æ¾æ¹æ³æ¥æ¾ Key[] æ°ç»ï¼è¥æ¾å°å³é®å­ Kï¼åè¿åè¯¥ç»ç¹çå°åå K å¨ Key[] ä¸­çä½ç½®ï¼\n 2. å¦åï¼å¯ç¡®å® K å¨æä¸ª Key[i] å Key[i+1] ä¹é´ï¼åä» Son[i] ææçå­ç»ç¹ç»§ç»­æ¥æ¾ï¼ç´å°å¨æç»ç¹ä¸­æ¥æ¾æåï¼\n 3. æç´è³æ¾å°å¶ç»ç¹ä¸å¶ç»ç¹ä¸­çæ¥æ¾ä»ä¸æåæ¶ï¼æ¥æ¾è¿ç¨å¤±è´¥ã\n\n# B+ æ \n\nB+Tree æ¯ B-Tree çåç§ï¼\n\n * æ¯ä¸ªèç¹çæéä¸éä¸º 2d èä¸æ¯ 2d+1ï¼d ä¸ºèç¹çåºåº¦ï¼ã\n * éå¶å­èç¹ä¸å­å¨ dataï¼åªå­å¨ keyï¼å¶å­èç¹ä¸å­å¨æéã\n\n\n\nç±äºå¹¶ä¸æ¯ææèç¹é½å·æç¸åçåï¼å æ­¤ B+Tree ä¸­å¶èç¹ååèç¹ä¸è¬å¤§å°ä¸åãè¿ç¹ä¸ B-Tree ä¸åï¼è½ç¶ B-Tree ä¸­ä¸åèç¹å­æ¾ç key åæéå¯è½æ°éä¸ä¸è´ï¼ä½æ¯æ¯ä¸ªèç¹çååä¸éæ¯ä¸è´çï¼æä»¥å¨å®ç°ä¸­ B-Tree å¾å¾å¯¹æ¯ä¸ªèç¹ç³è¯·åç­å¤§å°çç©ºé´ã\n\nå¸¦æé¡ºåºè®¿é®æéç B+Tree\n\nä¸è¬å¨æ°æ®åºç³»ç»ææä»¶ç³»ç»ä¸­ä½¿ç¨ç B+Tree ç»æé½å¨ç»å¸ B+Tree çåºç¡ä¸è¿è¡äºä¼åï¼å¢å äºé¡ºåºè®¿é®æéã\n\n\n\nå¨ B+Tree çæ¯ä¸ªå¶å­èç¹å¢å ä¸ä¸ªæåç¸é»å¶å­èç¹çæéï¼å°±å½¢æäºå¸¦æé¡ºåºè®¿é®æéç B+Treeã\n\nè¿ä¸ªä¼åçç®çæ¯ä¸ºäºæé«åºé´è®¿é®çæ§è½ï¼ä¾å¦ä¸å¾ä¸­å¦æè¦æ¥è¯¢ key ä¸ºä» 18 å° 49 çæææ°æ®è®°å½ï¼å½æ¾å° 18 åï¼åªéé¡ºçèç¹åæéé¡ºåºéåå°±å¯ä»¥ä¸æ¬¡æ§è®¿é®å°æææ°æ®èç¹ï¼æå¤§æå°äºåºé´æ¥è¯¢æçã\n\n# B æ  vs. B+ æ \n\n * B+ æ æ´éåå¤é¨å­å¨(ä¸è¬æç£çå­å¨)ï¼ç±äºåèç¹(éå¶å­èç¹)ä¸å­å¨ dataï¼æä»¥ä¸ä¸ªèç¹å¯ä»¥å­å¨æ´å¤çåèç¹ï¼æ¯ä¸ªèç¹è½ç´¢å¼çèå´æ´å¤§æ´ç²¾ç¡®ãä¹å°±æ¯è¯´ä½¿ç¨ B+ æ åæ¬¡ç£ç IO çä¿¡æ¯éç¸æ¯è¾ B æ æ´å¤§ï¼IO æçæ´é«ã\n * Mysql æ¯å³ç³»åæ°æ®åºï¼ç»å¸¸ä¼æç§åºé´æ¥è®¿é®æä¸ªç´¢å¼åï¼B+ æ çå¶å­èç¹é´æé¡ºåºå»ºç«äºé¾æéï¼å å¼ºäºåºé´è®¿é®æ§ï¼æä»¥ B+ æ å¯¹ç´¢å¼åä¸çåºé´èå´æ¥è¯¢å¾åå¥½ãè B æ æ¯ä¸ªèç¹ç key å data å¨ä¸èµ·ï¼æ æ³è¿è¡åºé´æ¥æ¾ã\n\n# Hash\n\n> Hash ç´¢å¼åªæç²¾ç¡®å¹éç´¢å¼ææåçæ¥è¯¢æææã\n\nå¯¹äºæ¯ä¸è¡æ°æ®ï¼å¯¹ææçç´¢å¼åè®¡ç®ä¸ä¸ª hashcodeãåå¸ç´¢å¼å°ææç hashcode å­å¨å¨ç´¢å¼ä¸­ï¼åæ¶å¨ Hash è¡¨ä¸­ä¿å­æåæ¯ä¸ªæ°æ®è¡çæéã\n\nåå¸ç»æç´¢å¼çä¼ç¹ï¼\n\n * å ä¸ºç´¢å¼æ°æ®ç»æç´§åï¼æä»¥æ¥è¯¢éåº¦éå¸¸å¿«ã\n\nåå¸ç»æç´¢å¼çç¼ºç¹ï¼\n\n * åå¸ç´¢å¼æ°æ®ä¸æ¯æç§ç´¢å¼å¼é¡ºåºå­å¨çï¼æä»¥æ æ³ç¨äºæåºã\n * åå¸ç´¢å¼ä¸æ¯æé¨åç´¢å¼å¹éæ¥æ¾ãå¦ï¼å¨æ°æ®å (A,B) ä¸å»ºç«åå¸ç´¢å¼ï¼å¦ææ¥è¯¢åªææ°æ®å Aï¼æ æ³ä½¿ç¨è¯¥ç´¢å¼ã\n * åå¸ç´¢å¼åªæ¯æç­å¼æ¯è¾æ¥è¯¢ï¼ä¸æ¯æä»»ä½èå´æ¥è¯¢ï¼å¦ WHERE price > 100ã\n * åå¸ç´¢å¼æå¯è½åºç°åå¸å²çªï¼åºç°åå¸å²çªæ¶ï¼å¿é¡»éåé¾è¡¨ä¸­ææçè¡æéï¼éè¡æ¯è¾ï¼ç´å°æ¾å°ç¬¦åæ¡ä»¶çè¡ã\n\n\n# ç´¢å¼ç­ç¥\n\n# ç´¢å¼åºæ¬åå\n\n * ç´¢å¼ä¸æ¯è¶å¤è¶å¥½ï¼ä¸è¦ä¸ºææåé½åå»ºç´¢å¼ã\n * è¦å°½éé¿ååä½åéå¤ç´¢å¼ï¼\n * è¦èèå é¤æªä½¿ç¨çç´¢å¼ï¼\n * å°½éçæ©å±ç´¢å¼ï¼ä¸è¦æ°å»ºç´¢å¼ï¼\n * é¢ç¹ä½ä¸º WHERE è¿æ»¤æ¡ä»¶çååºè¯¥èèæ·»å ç´¢å¼\n\n# ç¬ç«çå\n\nå¦ææ¥è¯¢ä¸­çåä¸æ¯ç¬ç«çåï¼åæ°æ®åºä¸ä¼ä½¿ç¨ç´¢å¼ã\n\nâç¬ç«çåâ æ¯æç´¢å¼åä¸è½æ¯è¡¨è¾¾å¼çä¸é¨åï¼ä¹ä¸è½æ¯å½æ°çåæ°ã\n\nâ éè¯¯ç¤ºä¾ï¼\n\nSELECT actor_id FROM actor WHERE actor_id + 1 = 5;\nSELECT ... WHERE TO_DAYS(current_date) - TO_DAYS(date_col) <= 10;\n\n\n# åç¼ç´¢å¼åç´¢å¼éæ©æ§\n\nææ¶åéè¦ç´¢å¼å¾é¿çå­ç¬¦åï¼è¿ä¼è®©ç´¢å¼åå¾å¤§ä¸æ¢ã\n\nè§£å³æ¹æ³æ¯ï¼å¯ä»¥ç´¢å¼å¼å§çé¨åå­ç¬¦ï¼è¿æ ·å¯ä»¥å¤§å¤§èçº¦ç´¢å¼ç©ºé´ï¼ä»èæé«ç´¢å¼æçãä½è¿æ ·ä¹ä¼éä½ç´¢å¼çéæ©æ§ã\n\nç´¢å¼çéæ©æ§æ¯æï¼ä¸éå¤çç´¢å¼å¼åæ°æ®è¡¨è®°å½æ»æ°çæ¯å¼ãæå¤§å¼ä¸º 1ï¼æ­¤æ¶æ¯ä¸ªè®°å½é½æå¯ä¸çç´¢å¼ä¸å¶å¯¹åºãéæ©æ§è¶é«ï¼æ¥è¯¢æçä¹è¶é«ã\n\nå¯¹äº BLOB/TEXT/VARCHAR è¿ç§ææ¬ç±»åçåï¼å¿é¡»ä½¿ç¨åç¼ç´¢å¼ï¼å ä¸ºæ°æ®åºå¾å¾ä¸åè®¸ç´¢å¼è¿äºåçå®æ´é¿åº¦ã\n\nè¦éæ©è¶³å¤é¿çåç¼ä»¥ä¿è¯è¾é«çéæ©æ§ï¼åæ¶åä¸è½å¤ªé¿ï¼èçº¦ç©ºé´ï¼ã\n\nâ ä½æç¤ºä¾ï¼\n\nSELECT COUNT(*) AS cnt, city FROM sakila.city_demo\nGROUP BY city ORDER BY cnt DESC LIMIT 10;\n\n\nâ é«æç¤ºä¾ï¼\n\nSELECT COUNT(*) AS cnt, LEFT(city, 3) AS pref FROM sakila.city_demo\nGROUP BY city ORDER BY cnt DESC LIMIT 10;\n\n\n# å¤åç´¢å¼\n\nä¸è¦ä¸ºæ¯ä¸ªåé½åå»ºç¬ç«ç´¢å¼ã\n\nå°éæ©æ§é«çåæåºæ°å¤§çåä¼åæå¨å¤åç´¢å¼æååãä½ææ¶ï¼ä¹éè¦èè WHERE å­å¥ä¸­çæåºãåç»åèå´æ¡ä»¶ç­å ç´ ï¼è¿äºå ç´ ä¹ä¼å¯¹æ¥è¯¢æ§è½é æè¾å¤§å½±åã\n\nä¸¾ä¾æ¥è¯´ï¼æä¸å¼  user è¡¨ï¼å¶ä¸­å« name, sex, age ä¸ä¸ªåï¼å¦æå°è¿ä¸èç»åä¸ºå¤åç´¢å¼ï¼åºè¯¥ç¨ä»ä¹æ ·çé¡ºåºå¢ï¼ä»éæ©æ§é«çè§åº¦æ¥çï¼name > age > sexã\n\n# èç°ç´¢å¼\n\nèç°ç´¢å¼ä¸æ¯ä¸ç§åç¬çç´¢å¼ç±»åï¼èæ¯ä¸ç§æ°æ®å­å¨æ¹å¼ãå·ä½ç»èä¾èµäºå®ç°æ¹å¼ãå¦ InnoDB çèç°ç´¢å¼å®éæ¯å¨åä¸ä¸ªç»æä¸­ä¿å­äº B æ çç´¢å¼åæ°æ®è¡ã\n\nèç°è¡¨ç¤ºæ°æ®è¡åç¸é»çé®å¼ç´§åå°å­å¨å¨ä¸èµ·ï¼å ä¸ºæ°æ®ç´§åï¼æä»¥è®¿é®å¿«ãå ä¸ºæ æ³åæ¶ææ°æ®è¡å­æ¾å¨ä¸¤ä¸ªä¸åçå°æ¹ï¼æä»¥ä¸ä¸ªè¡¨åªè½æä¸ä¸ªèç°ç´¢å¼ã\n\nè¥æ²¡æå®ä¹ä¸»é®ï¼InnoDB ä¼éå¼å®ä¹ä¸ä¸ªä¸»é®æ¥ä½ä¸ºèç°ç´¢å¼ã\n\n# è¦çç´¢å¼\n\nç´¢å¼åå«ææéè¦æ¥è¯¢çå­æ®µçå¼ã\n\nå·æä»¥ä¸ä¼ç¹ï¼\n\n * å ä¸ºç´¢å¼æ¡ç®éå¸¸è¿å°äºæ°æ®è¡çå¤§å°ï¼æä»¥è¥åªè¯»åç´¢å¼ï¼è½å¤§å¤§åå°æ°æ®è®¿é®éã\n * ä¸äºå­å¨å¼æï¼ä¾å¦ MyISAMï¼å¨åå­ä¸­åªç¼å­ç´¢å¼ï¼èæ°æ®ä¾èµäºæä½ç³»ç»æ¥ç¼å­ãå æ­¤ï¼åªè®¿é®ç´¢å¼å¯ä»¥ä¸ä½¿ç¨ç³»ç»è°ç¨ï¼éå¸¸æ¯è¾è´¹æ¶ï¼ã\n * å¯¹äº InnoDB å¼æï¼è¥è¾å©ç´¢å¼è½å¤è¦çæ¥è¯¢ï¼åæ éè®¿é®ä¸»ç´¢å¼ã\n\n# ä½¿ç¨ç´¢å¼æ«ææ¥åæåº\n\nMysql æä¸¤ç§æ¹å¼å¯ä»¥çææåºç»æï¼éè¿æåºæä½ï¼æèæç´¢å¼é¡ºåºæ«æã\n\nç´¢å¼æå¥½æ¢æ»¡è¶³æåºï¼åç¨äºæ¥æ¾è¡ãè¿æ ·ï¼å°±å¯ä»¥ä½¿ç¨ç´¢å¼æ¥å¯¹ç»ææåºã\n\n# æå·¦åç¼å¹éåå\n\nMySQL ä¼ä¸ç´åå³å¹éç´å°éå°èå´æ¥è¯¢ (>,<,BETWEEN,LIKE) å°±åæ­¢å¹éã\n\n * ç´¢å¼å¯ä»¥ç®åå¦ä¸ä¸ªå(a)ï¼ä¹å¯ä»¥å¤æå¦å¤ä¸ªå(a, b, c, d)ï¼å³èåç´¢å¼ã\n * å¦ææ¯èåç´¢å¼ï¼é£ä¹ key ä¹ç±å¤ä¸ªåç»æï¼åæ¶ï¼ç´¢å¼åªè½ç¨äºæ¥æ¾ key æ¯å¦å­å¨ï¼ç¸ç­ï¼ï¼éå°èå´æ¥è¯¢(>ã<ãbetweenãlike å·¦å¹é)ç­å°±ä¸è½è¿ä¸æ­¥å¹éäºï¼åç»­éåä¸ºçº¿æ§æ¥æ¾ã\n * å æ­¤ï¼åçæåé¡ºåºå³å®äºå¯å½ä¸­ç´¢å¼çåæ°ã\n\nä¾å­ï¼\n\n * å¦æç´¢å¼(a, b, c, d)ï¼æ¥è¯¢æ¡ä»¶ a = 1 and b = 2 and c > 3 and d = 4ï¼åä¼å¨æ¯ä¸ªèç¹ä¾æ¬¡å½ä¸­ aãbãcï¼æ æ³å½ä¸­ dã(å¾ç®åï¼ç´¢å¼å½ä¸­åªè½æ¯ç¸ç­çæåµï¼ä¸è½æ¯èå´å¹é)\n\n# = å in å¯ä»¥ä¹±åº\n\nä¸éè¦èè=ãin ç­çé¡ºåºï¼Mysql ä¼èªå¨ä¼åè¿äºæ¡ä»¶çé¡ºåºï¼ä»¥å¹éå°½å¯è½å¤çç´¢å¼åã\n\nä¾å­ï¼å¦æç´¢å¼(a, b, c, d)ï¼æ¥è¯¢æ¡ä»¶ c > 3 and b = 2 and a = 1 and d < 4 ä¸ a = 1 and c > 3 and b = 2 and d < 4 ç­é¡ºåºé½æ¯å¯ä»¥çï¼MySQL ä¼èªå¨ä¼åä¸º a = 1 and b = 2 and c > 3 and d < 4ï¼ä¾æ¬¡å½ä¸­ aãbãcã\n\n\n# çº¦æ\n\næ°æ®åºçº¦æï¼CONSTRAINTï¼æåªäºï¼\n\n * NOT NULL - ç¨äºæ§å¶å­æ®µçåå®¹ä¸å®ä¸è½ä¸ºç©ºï¼NULLï¼ã\n * UNIQUE - å­æ®µåå®¹ä¸è½éå¤ï¼ä¸ä¸ªè¡¨åè®¸æå¤ä¸ª Unique çº¦æã\n * PRIMARY KEY - æ°æ®è¡¨ä¸­å¯¹å¨å­æ°æ®å¯¹è±¡äºä»¥å¯ä¸åå®æ´æ è¯çæ°æ®åæå±æ§çç»åï¼å®å¨ä¸ä¸ªè¡¨ä¸­åªåè®¸æä¸ä¸ªãä¸»é®çåå¼ä¸è½ä¸ºç©ºå¼ï¼Nullï¼ã\n * FOREIGN KEY - å¨ä¸ä¸ªè¡¨ä¸­å­å¨çå¦ä¸ä¸ªè¡¨çä¸»é®ç§°æ­¤è¡¨çå¤é®ãç¨äºé¢é²ç ´åè¡¨ä¹é´è¿æ¥çå¨ä½ï¼ä¹è½é²æ­¢éæ³æ°æ®æå¥å¤é®åï¼å ä¸ºå®å¿é¡»æ¯å®æåçé£ä¸ªè¡¨ä¸­çå¼ä¹ä¸ã\n * CHECK - ç¨äºæ§å¶å­æ®µçå¼èå´ã\n\n\n# å¹¶åæ§å¶\n\n\n# ä¹è§éåæ²è§é\n\n>  * æ°æ®åºçä¹è§éåæ²è§éæ¯ä»ä¹ï¼\n>  * æ°æ®åºçä¹è§éåæ²è§éå¦ä½å®ç°ï¼\n\nç¡®ä¿å¨å¤ä¸ªäºå¡åæ¶å­åæ°æ®åºä¸­åä¸æ°æ®æ¶ä¸ç ´åäºå¡çéç¦»æ§åç»ä¸æ§ä»¥åæ°æ®åºçç»ä¸æ§ï¼ä¹è§éåæ²è§éæ¯å¹¶åæ§å¶ä¸»è¦éç¨çææ¯ææ®µã\n\n * æ²è§é - åå®ä¼åçå¹¶åå²çªï¼å±è½ä¸åå¯è½è¿åæ°æ®å®æ´æ§çæä½\n   * å¨æ¥è¯¢å®æ°æ®çæ¶åå°±æäºå¡éèµ·æ¥ï¼ç´å°æäº¤äºå¡ï¼COMMITï¼\n   * å®ç°æ¹å¼ï¼ä½¿ç¨æ°æ®åºä¸­çéæºå¶\n * ä¹è§é - åè®¾ä¸ä¼åçå¹¶åå²çªï¼åªå¨æäº¤æä½æ¶æ£æ¥æ¯å¦è¿åæ°æ®å®æ´æ§ã\n   * å¨ä¿®æ¹æ°æ®çæ¶åæäºå¡éèµ·æ¥ï¼éè¿ version çæ¹å¼æ¥è¿è¡éå®\n   * å®ç°æ¹å¼ï¼ä½¿ç¨ version çæ¬æèæ¶é´æ³\n\n\n# è¡çº§éåè¡¨çº§é\n\n>  * ä»ä¹æ¯è¡çº§éåè¡¨çº§éï¼\n>  * ä»ä¹æ¶åç¨è¡çº§éï¼ä»ä¹æ¶åç¨è¡¨çº§éï¼\n\nä»æ°æ®åºçéç²åº¦æ¥çï¼MySQL ä¸­æä¾äºä¸¤ç§å°éç²åº¦ï¼è¡çº§éåè¡¨çº§éã\n\n * è¡¨çº§éï¼table lockï¼ - éå®æ´å¼ è¡¨ãç¨æ·å¯¹è¡¨è¿è¡åæä½åï¼éè¦åè·å¾åéï¼è¿ä¼é»å¡å¶ä»ç¨æ·å¯¹è¯¥è¡¨çææè¯»åæä½ãåªææ²¡æåéæ¶ï¼å¶ä»ç¨æ·æè½è·å¾è¯»éï¼è¯»éä¹é´ä¸ä¼ç¸äºé»å¡ã\n * è¡çº§éï¼row lockï¼ - ä»å¯¹æå®çè¡è®°å½è¿è¡å éï¼è¿æ ·å¶å®è¿ç¨è¿æ¯å¯ä»¥å¯¹åä¸ä¸ªè¡¨ä¸­çå¶å®è®°å½è¿è¡æä½ã\n\näºèéè¦æè¡¡ï¼\n\n * éå®çæ°æ®éè¶å°ï¼éç«äºçåçé¢çå°±è¶å°ï¼ç³»ç»çå¹¶åç¨åº¦å°±è¶é«ã\n * éç²åº¦è¶å°ï¼ç³»ç»å¼éå°±è¶å¤§ã\n\nå¨ InnoDB ä¸­ï¼è¡éæ¯éè¿ç»ç´¢å¼ä¸çç´¢å¼é¡¹å éæ¥å®ç°çãå¦ææ²¡æç´¢å¼ï¼InnoDB å°ä¼éè¿éèçèç°ç´¢å¼æ¥å¯¹è®°å½å éã\n\n\n# è¯»åé\n\n>  * ä»ä¹æ¯è¯»åéï¼\n\n * ç¬äº«éï¼Exclusiveï¼ï¼ç®åä¸º X éï¼åç§°åéãä½¿ç¨æ¹å¼ï¼SELECT ... FOR UPDATE;\n * å±äº«éï¼Sharedï¼ï¼ç®åä¸º S éï¼åç§°è¯»éãä½¿ç¨æ¹å¼ï¼SELECT ... LOCK IN SHARE MODE;\n\nåéåè¯»éçå³ç³»ï¼ç®è¨ä¹ï¼ç¬äº«éå­å¨ï¼å¶ä»äºå¡å°±ä¸è½åä»»ä½æä½ã\n\nInnoDB ä¸çè¡éãé´ééãnext-key éç»ç»å±äºç¬äº«éã\n\n\n# æåé\n\n>  * ä»ä¹æ¯æåéï¼\n>  * æåéæä»ä¹ç¨ï¼\n\næåéçä½ç¨æ¯ï¼å½å­å¨è¡¨çº§éåè¡çº§éçæåµä¸ï¼å¿é¡»åç³è¯·æåéï¼è¡¨çº§éï¼ä½ä¸æ¯ççå éï¼ï¼åè·åè¡çº§éãä½¿ç¨æåéï¼Intention Locksï¼å¯ä»¥æ´å®¹æå°æ¯æå¤ç²åº¦å°éã\n\næåéæ¯ InnoDB èªå¨å çï¼ä¸éè¦ç¨æ·å¹²é¢ã\n\n\n# MVCC\n\n> ä»ä¹æ¯ MVCCï¼\n> \n> MVCC æä»ä¹ç¨ï¼è§£å³äºä»ä¹é®é¢ï¼\n> \n> MVCC çåçæ¯ä»ä¹ï¼\n\nå¤çæ¬å¹¶åæ§å¶ï¼Multi-Version Concurrency Control, MVCCï¼æ¯ InnoDB å­å¨å¼æå®ç°éç¦»çº§å«çä¸ç§å·ä½æ¹å¼ï¼ç¨äºå®ç°æäº¤è¯»åå¯éå¤è¯»è¿ä¸¤ç§éç¦»çº§å«ãèæªæäº¤è¯»éç¦»çº§å«æ»æ¯è¯»åææ°çæ°æ®è¡ï¼è¦æ±å¾ä½ï¼æ éä½¿ç¨ MVCCãå¯ä¸²è¡åéç¦»çº§å«éè¦å¯¹ææè¯»åçè¡é½å éï¼åçº¯ä½¿ç¨ MVCC æ æ³å®ç°ã\n\nMVCC çææ³æ¯ï¼\n\n * ä¿å­æ°æ®å¨æä¸ªæ¶é´ç¹çå¿«ç§ãåæä½ï¼DELETEãINSERTãUPDATEï¼æ´æ°ææ°ççæ¬å¿«ç§ï¼èè¯»æä½å»è¯»æ§çæ¬å¿«ç§ï¼æ²¡æäºæ¥å³ç³»ï¼è¿ä¸ç¹å CopyOnWrite ç±»ä¼¼ã\n * èè¯»åä¸å¯éå¤è¯»ææ ¹æ¬çåå æ¯äºå¡è¯»åå°å¶å®äºå¡æªæäº¤çä¿®æ¹ãå¨äºå¡è¿è¡è¯»åæä½æ¶ï¼ä¸ºäºè§£å³èè¯»åä¸å¯éå¤è¯»é®é¢ï¼MVCC è§å®åªè½è¯»åå·²ç»æäº¤çå¿«ç§ãå½ç¶ä¸ä¸ªäºå¡å¯ä»¥è¯»åèªèº«æªæäº¤çå¿«ç§ï¼è¿ä¸ç®æ¯èè¯»ã\n\n\n# Next-key é\n\nNext-Key éæ¯ MySQL ç InnoDB å­å¨å¼æçä¸ç§éå®ç°ã\n\nMVCC ä¸è½è§£å³å¹»è¯»é®é¢ï¼Next-Key éå°±æ¯ä¸ºäºè§£å³å¹»è¯»é®é¢ãå¨å¯éå¤è¯»ï¼REPEATABLE READï¼éç¦»çº§å«ä¸ï¼ä½¿ç¨ MVCC + Next-Key é å¯ä»¥è§£å³å¹»è¯»é®é¢ã\n\nå¦å¤ï¼æ ¹æ®éå¯¹ SQL è¯­å¥æ£ç´¢æ¡ä»¶çä¸åï¼å éåæä»¥ä¸ä¸ç§æå½¢éè¦æä»¬ææ¡ã\n\n * Record Lock - è¡éå¯¹ç´¢å¼é¡¹å éï¼è¥æ²¡æç´¢å¼åä½¿ç¨è¡¨éã\n * Gap Lock - å¯¹ç´¢å¼é¡¹ä¹é´çé´éå éãéå®ç´¢å¼ä¹é´çé´éï¼ä½æ¯ä¸åå«ç´¢å¼æ¬èº«ãä¾å¦å½ä¸ä¸ªäºå¡æ§è¡ä»¥ä¸è¯­å¥ï¼å¶å®äºå¡å°±ä¸è½å¨ t.c ä¸­æå¥ 15ãSELECT c FROM t WHERE c BETWEEN 10 and 20 FOR UPDATE;\n * Next-key lock -å®æ¯ Record Lock å Gap Lock çç»åï¼ä¸ä»éå®ä¸ä¸ªè®°å½ä¸çç´¢å¼ï¼ä¹éå®ç´¢å¼ä¹é´çé´éãå®éå®ä¸ä¸ªåå¼åé­åºé´ã\n\nç´¢å¼åä¸ºä¸»é®ç´¢å¼åéä¸»é®ç´¢å¼ä¸¤ç§ï¼å¦æä¸æ¡ SQL è¯­å¥æä½äºä¸»é®ç´¢å¼ï¼MySQL å°±ä¼éå®è¿æ¡ä¸»é®ç´¢å¼ï¼å¦æä¸æ¡è¯­å¥æä½äºéä¸»é®ç´¢å¼ï¼MySQL ä¼åéå®è¯¥éä¸»é®ç´¢å¼ï¼åéå®ç¸å³çä¸»é®ç´¢å¼ãå¨ UPDATEãDELETE æä½æ¶ï¼MySQL ä¸ä»éå® WHERE æ¡ä»¶æ«æè¿çææç´¢å¼è®°å½ï¼èä¸ä¼éå®ç¸é»çé®å¼ï¼å³æè°ç next-key lockã\n\nå½ä¸¤ä¸ªäºå¡åæ¶æ§è¡ï¼ä¸ä¸ªéä½äºä¸»é®ç´¢å¼ï¼å¨ç­å¾å¶ä»ç¸å³ç´¢å¼ãå¦ä¸ä¸ªéå®äºéä¸»é®ç´¢å¼ï¼å¨ç­å¾ä¸»é®ç´¢å¼ãè¿æ ·å°±ä¼åçæ­»éãåçæ­»éåï¼InnoDB ä¸è¬é½å¯ä»¥æ£æµå°ï¼å¹¶ä½¿ä¸ä¸ªäºå¡éæ¾éåéï¼å¦ä¸ä¸ªè·åéå®æäºå¡ã\n\n\n# äºå¡\n\n> äºå¡ç®åæ¥è¯´ï¼ä¸ä¸ª Session ä¸­æè¿è¡ææçæä½ï¼è¦ä¹åæ¶æåï¼è¦ä¹åæ¶å¤±è´¥ãå·ä½æ¥è¯´ï¼äºå¡æçæ¯æ»¡è¶³ ACID ç¹æ§çä¸ç»æä½ï¼å¯ä»¥éè¿ Commit æäº¤ä¸ä¸ªäºå¡ï¼ä¹å¯ä»¥ä½¿ç¨ Rollback è¿è¡åæ»ã\n\n\n\n\n# ACID\n\nACID â æ°æ®åºäºå¡æ­£ç¡®æ§è¡çåä¸ªåºæ¬è¦ç´ ï¼\n\n * åå­æ§ï¼Atomicityï¼\n * ä¸è´æ§ï¼Consistencyï¼\n * éç¦»æ§ï¼Isolationï¼\n * æä¹æ§ï¼Durabilityï¼\n\nä¸ä¸ªæ¯æäºå¡ï¼Transactionï¼ä¸­çæ°æ®åºç³»ç»ï¼å¿éè¦å·æè¿åç§ç¹æ§ï¼å¦åå¨äºå¡è¿ç¨ï¼Transaction processingï¼å½ä¸­æ æ³ä¿è¯æ°æ®çæ­£ç¡®æ§ï¼äº¤æè¿ç¨æå¯è½è¾¾ä¸å°äº¤æã\n\n\n\n\n# å¹¶åä¸è´æ§é®é¢\n\nå¨å¹¶åç¯å¢ä¸ï¼äºå¡çéç¦»æ§å¾é¾ä¿è¯ï¼å æ­¤ä¼åºç°å¾å¤å¹¶åä¸è´æ§é®é¢ã\n\n * ä¸¢å¤±ä¿®æ¹\n\nT1 å T2 ä¸¤ä¸ªäºå¡é½å¯¹ä¸ä¸ªæ°æ®è¿è¡ä¿®æ¹ï¼T1 åä¿®æ¹ï¼T2 éåä¿®æ¹ï¼T2 çä¿®æ¹è¦çäº T1 çä¿®æ¹ã\n\n\n\n * èè¯»\n\nT1 ä¿®æ¹ä¸ä¸ªæ°æ®ï¼T2 éåè¯»åè¿ä¸ªæ°æ®ãå¦æ T1 æ¤éäºè¿æ¬¡ä¿®æ¹ï¼é£ä¹ T2 è¯»åçæ°æ®æ¯èæ°æ®ã\n\n\n\n * ä¸å¯éå¤è¯»\n\nT2 è¯»åä¸ä¸ªæ°æ®ï¼T1 å¯¹è¯¥æ°æ®åäºä¿®æ¹ãå¦æ T2 åæ¬¡è¯»åè¿ä¸ªæ°æ®ï¼æ­¤æ¶è¯»åçç»æåç¬¬ä¸æ¬¡è¯»åçç»æä¸åã\n\n\n\n * å¹»è¯»\n\nT1 è¯»åæä¸ªèå´çæ°æ®ï¼T2 å¨è¿ä¸ªèå´åæå¥æ°çæ°æ®ï¼T1 åæ¬¡è¯»åè¿ä¸ªèå´çæ°æ®ï¼æ­¤æ¶è¯»åçç»æååç¬¬ä¸æ¬¡è¯»åçç»æä¸åã\n\n\n\nå¹¶åä¸è´æ§è§£å³æ¹æ¡ï¼\n\näº§çå¹¶åä¸ä¸è´æ§é®é¢ä¸»è¦åå æ¯ç ´åäºäºå¡çéç¦»æ§ï¼è§£å³æ¹æ³æ¯éè¿å¹¶åæ§å¶æ¥ä¿è¯éç¦»æ§ã\n\nå¹¶åæ§å¶å¯ä»¥éè¿å°éæ¥å®ç°ï¼ä½æ¯å°éæä½éè¦ç¨æ·èªå·±æ§å¶ï¼ç¸å½å¤æãæ°æ®åºç®¡çç³»ç»æä¾äºäºå¡çéç¦»çº§å«ï¼è®©ç¨æ·ä»¥ä¸ç§æ´è½»æ¾çæ¹å¼å¤çå¹¶åä¸è´æ§é®é¢ã\n\n\n# äºå¡éç¦»\n\næ°æ®åºéç¦»çº§å«ï¼\n\n * æªæäº¤è¯»ï¼READ UNCOMMITTEDï¼ - äºå¡ä¸­çä¿®æ¹ï¼å³ä½¿æ²¡ææäº¤ï¼å¯¹å¶å®äºå¡ä¹æ¯å¯è§çã\n * æäº¤è¯»ï¼READ COMMITTEDï¼ - ä¸ä¸ªäºå¡åªè½è¯»åå·²ç»æäº¤çäºå¡æåçä¿®æ¹ãæ¢å¥è¯è¯´ï¼ä¸ä¸ªäºå¡æåçä¿®æ¹å¨æäº¤ä¹åå¯¹å¶å®äºå¡æ¯ä¸å¯è§çã\n * éå¤è¯»ï¼REPEATABLE READï¼ - ä¿è¯å¨åä¸ä¸ªäºå¡ä¸­å¤æ¬¡è¯»ååæ ·æ°æ®çç»ææ¯ä¸æ ·çã\n * ä¸²è¡åï¼SERIALIXABLEï¼ - å¼ºå¶äºå¡ä¸²è¡æ§è¡ã\n\næ°æ®åºéç¦»çº§å«è§£å³çé®é¢ï¼\n\néç¦»çº§å«   èè¯»   ä¸å¯éå¤è¯»   å¹»è¯»\næªæäº¤è¯»   â    â       â\næäº¤è¯»    âï¸   â       â\nå¯éå¤è¯»   âï¸   âï¸      â\nå¯ä¸²è¡å   âï¸   âï¸      âï¸\n\n\n# åå¸å¼äºå¡\n\nå¨åä¸æ°æ®èç¹ä¸­ï¼äºå¡ä»éäºå¯¹åä¸æ°æ®åºèµæºçè®¿é®æ§å¶ï¼ç§°ä¹ä¸º æ¬å°äºå¡ãå ä¹ææçæççå³ç³»åæ°æ®åºé½æä¾äºå¯¹æ¬å°äºå¡çåçæ¯æã\n\nåå¸å¼äºå¡ æ¯æäºå¡çåä¸èãæ¯æäºå¡çæå¡å¨ãèµæºæå¡å¨ä»¥åäºå¡ç®¡çå¨åå«ä½äºä¸åçåå¸å¼ç³»ç»çä¸åèç¹ä¹ä¸ã\n\n# ä¸¤é¶æ®µæäº¤\n\nä¸¤é¶æ®µæäº¤ï¼XAï¼å¯¹ä¸å¡ä¾µå¥å¾å°ã å®æå¤§çä¼å¿å°±æ¯å¯¹ä½¿ç¨æ¹éæï¼ç¨æ·å¯ä»¥åä½¿ç¨æ¬å°äºå¡ä¸æ ·ä½¿ç¨åºäº XA åè®®çåå¸å¼äºå¡ã XA åè®®è½å¤ä¸¥æ ¼ä¿éäºå¡ ACID ç¹æ§ã\n\nä¸¥æ ¼ä¿éäºå¡ ACID ç¹æ§æ¯ä¸æåååã äºå¡æ§è¡å¨è¿ç¨ä¸­éè¦å°æéèµæºå¨é¨éå®ï¼å®æ´å éç¨äºæ§è¡æ¶é´ç¡®å®çç­äºå¡ã å¯¹äºé¿äºå¡æ¥è¯´ï¼æ´ä¸ªäºå¡è¿è¡æé´å¯¹æ°æ®çç¬å ï¼å°å¯¼è´å¯¹ç­ç¹æ°æ®ä¾èµçä¸å¡ç³»ç»å¹¶åæ§è½è¡°éææ¾ã å æ­¤ï¼å¨é«å¹¶åçæ§è½è³ä¸åºæ¯ä¸­ï¼åºäº XA åè®®çåå¸å¼äºå¡å¹¶ä¸æ¯æä½³éæ©ã\n\n# ææ§äºå¡\n\nå¦æå°å®ç°äºACID çäºå¡è¦ç´ çäºå¡ç§°ä¸ºåæ§äºå¡çè¯ï¼é£ä¹åºäºBASEäºå¡è¦ç´ çäºå¡åç§°ä¸ºææ§äºå¡ã BASEæ¯åºæ¬å¯ç¨ãææ§ç¶æåæç»ä¸è´æ§è¿ä¸ä¸ªè¦ç´ çç¼©åã\n\n * åºæ¬å¯ç¨ï¼Basically Availableï¼ä¿è¯åå¸å¼äºå¡åä¸æ¹ä¸ä¸å®åæ¶å¨çº¿ã\n * ææ§ç¶æï¼Soft stateï¼ååè®¸ç³»ç»ç¶ææ´æ°æä¸å®çå»¶æ¶ï¼è¿ä¸ªå»¶æ¶å¯¹å®¢æ·æ¥è¯´ä¸ä¸å®è½å¤å¯è§ã\n * èæç»ä¸è´æ§ï¼Eventually consistentï¼éå¸¸æ¯éè¿æ¶æ¯ä¼ éçæ¹å¼ä¿è¯ç³»ç»çæç»ä¸è´æ§ã\n\nå¨ACIDäºå¡ä¸­å¯¹éç¦»æ§çè¦æ±å¾é«ï¼å¨äºå¡æ§è¡è¿ç¨ä¸­ï¼å¿é¡»å°ææçèµæºéå®ã ææ§äºå¡ççå¿µåæ¯éè¿ä¸å¡é»è¾å°äºæ¥éæä½ä»èµæºå±é¢ä¸ç§»è³ä¸å¡å±é¢ãéè¿æ¾å®½å¯¹å¼ºä¸è´æ§è¦æ±ï¼æ¥æ¢åç³»ç»ååéçæåã\n\nåºäºACIDçå¼ºä¸è´æ§äºå¡ååºäºBASEçæç»ä¸è´æ§äºå¡é½ä¸æ¯é¶å¼¹ï¼åªæå¨æéåçåºæ¯ä¸­æè½åæ¥å®ä»¬çæå¤§é¿å¤ã å¯éè¿ä¸è¡¨è¯¦ç»å¯¹æ¯å®ä»¬ä¹é´çåºå«ï¼ä»¥å¸®å©å¼åèè¿è¡ææ¯éåã\n\n# äºå¡æ¹æ¡å¯¹æ¯\n\n       æ¬å°äºå¡       ä¸¤ï¼ä¸ï¼é¶æ®µäºå¡    ææ§äºå¡\nä¸å¡æ¹é    æ           æ            å®ç°ç¸å³æ¥å£\nä¸è´æ§    ä¸æ¯æ        æ¯æ          æç»ä¸è´\néç¦»æ§    ä¸æ¯æ        æ¯æ          ä¸å¡æ¹ä¿è¯\nå¹¶åæ§è½   æ å½±å        ä¸¥éè¡°é        ç¥å¾®è¡°é\néååºæ¯   ä¸å¡æ¹å¤çä¸ä¸è´   ç­äºå¡ & ä½å¹¶å   é¿äºå¡ & é«å¹¶å\n\n\n# ååºåè¡¨\n\n\n# ä»ä¹æ¯ååºåè¡¨\n\n> ä»ä¹æ¯ååºåè¡¨ï¼ä»ä¹æ¯åç´æåï¼ä»ä¹æ¯æ°´å¹³æåï¼ä»ä¹æ¯ Shardingï¼\n> \n> ååºåè¡¨æ¯ä¸ºäºè§£å³ä»ä¹é®é¢ï¼\n> \n> ååºåè¡¨æä»ä¹ä¼ç¹ï¼\n> \n> ååºåè¡¨æä»ä¹ç­ç¥ï¼\n\nååºåè¡¨çåºæ¬ææ³å°±æ¯ï¼æåæ¬å®æ´çæ°æ®ååæå¤ä¸ªé¨åï¼æ¾å°ä¸åçæ°æ®åºæè¡¨ä¸ã\n\nååºåè¡¨ä¸å®æ¯ä¸ºäºæ¯æ é«å¹¶åãæ°æ®éå¤§ä¸¤ä¸ªé®é¢çã\n\n# åç´åå\n\n> åç´ååï¼æ¯ æä¸ä¸ªæå¾å¤å­æ®µçè¡¨ç»æåæå¤ä¸ªè¡¨ï¼æèæ¯å¤ä¸ªåºä¸å»ãä¸è¬æ¥è¯´ï¼ä¼ å°è¾å°çãè®¿é®é¢çè¾é«çå­æ®µæ¾å°ä¸ä¸ªè¡¨éå»ï¼ç¶å å°è¾å¤çãè®¿é®é¢çè¾ä½çå­æ®µæ¾å°å¦å¤ä¸ä¸ªè¡¨éå»ãå ä¸ºæ°æ®åºæ¯æç¼å­çï¼è®¿é®é¢çé«çè¡å­æ®µè¶å°ï¼å°±å¯ä»¥å¨ç¼å­éç¼å­æ´å¤çè¡ï¼æ§è½å°±è¶å¥½ãè¿ä¸ªä¸è¬å¨è¡¨å±é¢åçè¾å¤ä¸äºã\n\n\n\nä¸è¬æ¥è¯´ï¼æ»¡è¶³ä¸é¢çæ¡ä»¶å°±å¯ä»¥èèæ©å®¹äºï¼\n\n * Mysql ååºè¶è¿ 5000 ä¸æ¡è®°å½ï¼Oracle ååºè¶è¿ 1 äº¿æ¡è®°å½ï¼DB ååå°±å¾å¤§ã\n * ååºè¶è¿æ¯ç§ 2000 ä¸ªå¹¶åæ¶ï¼èä¸ä¸ªå¥åº·çååºæå¥½ä¿æå¨æ¯ç§ 1000 ä¸ªå¹¶åå·¦å³ï¼ä¸è¦å¤ªå¤§ã\n\nå¨æ°æ®åºçå±é¢ä½¿ç¨åç´ååå°ææ°æ®åºä¸­è¡¨çå¯éç¨åº¦é¨ç½²å°ä¸åçåºä¸­ï¼ä¾å¦å°åæ¥ççµåæ°æ®åºåç´ååæååæ°æ®åºãç¨æ·æ°æ®åºç­ã\n\n# æ°´å¹³æå\n\n> æ°´å¹³æå åç§°ä¸º Shardingï¼å®æ¯å°åä¸ä¸ªè¡¨ä¸­çè®°å½æåå°å¤ä¸ªç»æç¸åçè¡¨ä¸­ãå½ åè¡¨æ°æ®éå¤ªå¤§ æ¶ï¼ä¼æå¤§å½±å SQL æ§è¡çæ§è½ ãåè¡¨æ¯å°åæ¥ä¸å¼ è¡¨çæ°æ®åå¸å°æ°æ®åºéç¾¤çä¸åèç¹ä¸ï¼ä»èç¼è§£åç¹çååã\n\n\n\nä¸è¬æ¥è¯´ï¼åè¡¨æ 200 ä¸æ¡æ°æ® çæ¶åï¼æ§è½å°±ä¼ç¸å¯¹å·®ä¸äºäºï¼éè¦èèåè¡¨äºãä½æ¯ï¼è¿ä¹è¦è§å·ä½æåµèå®ï¼å¯è½æ¯ 100 ä¸æ¡ï¼ä¹å¯è½æ¯ 500 ä¸æ¡ï¼SQL è¶å¤æï¼å°±æå¥½è®©åè¡¨è¡æ°è¶å°ã\n\n# ååºåè¡¨çä¼ç¹\n\n#          ååºåè¡¨å              ååºåè¡¨å\nå¹¶åæ¯ææåµ     åæºé¨ç½²ï¼æä¸ä½é«å¹¶å        ä»åæºå°å¤æºï¼è½æ¿åçå¹¶åå¢å äºå¤å\nç£çä½¿ç¨æåµ     åæºç£çå®¹éå ä¹ææ»¡         æåä¸ºå¤ä¸ªåºï¼æ°æ®åºæå¡å¨ç£çä½¿ç¨çå¤§å¤§éä½\nSQL æ§è¡æ§è½   åè¡¨æ°æ®éå¤ªå¤§ï¼SQL è¶è·è¶æ¢   åè¡¨æ°æ®éåå°ï¼SQL æ§è¡æçææ¾æå\n\n# ååºåè¡¨ç­ç¥\n\n * åå¸åæ¨¡ï¼hash(key) % N æ id % N\n   * ä¼ç¹ï¼å¯ä»¥å¹³ååéæ¯ä¸ªåºçæ°æ®éåè¯·æ±ååï¼è´è½½åè¡¡ï¼ã\n   * ç¼ºç¹ï¼æ©å®¹éº»ç¦ï¼éè¦æ°æ®è¿ç§»ã\n * èå´ï¼å¯ä»¥æç§ ID ææ¶é´ååèå´ã\n   * ä¼ç¹ï¼æ©å®¹ç®åã\n   * ç¼ºç¹ï¼è¿ç§ç­ç¥å®¹æäº§çç­ç¹é®é¢ã\n * æ å°è¡¨ï¼ä½¿ç¨åç¬çä¸ä¸ªæ°æ®åºæ¥å­å¨æ å°å³ç³»ã\n   * ç¼ºç¹ï¼å­å¨æ å°å³ç³»çæ°æ®åºä¹å¯è½æä¸ºæ§è½ç¶é¢ï¼ä¸ä¸æ¦å®æºï¼ååºåè¡¨çæ°æ®åºå°±æ æ³å·¥ä½ãæä»¥ä¸å»ºè®®ä½¿ç¨è¿ç§ç­ç¥ã\n   * ä¼ç¹ï¼æ©å®¹ç®åï¼å¯ä»¥è§£å³åå¸å¼ ID é®é¢ã\n\n\n# ååºåè¡¨ä¸­é´ä»¶\n\n> â å¸¸è§é®é¢ï¼\n> \n>  * ä½ ç¨è¿åªäºååºåè¡¨ä¸­é´ä»¶ï¼ç®åä»ç»ä¸ä¸ï¼\n> \n>  * ä¸åçååºåè¡¨ä¸­é´ä»¶åèªæä»ä¹ç¹æ§ï¼æä»ä¹ä¼ç¼ºç¹ï¼\n> \n>  * ååºåè¡¨ä¸­é´ä»¶ææ¯å¦ä½éåï¼\n\n# å¸¸è§çååºåè¡¨ä¸­é´ä»¶\n\n * Cobar - é¿é b2b å¢éå¼ååå¼æºçï¼å±äº proxy å±æ¹æ¡ï¼å°±æ¯ä»äºåºç¨æå¡å¨åæ°æ®åºæå¡å¨ä¹é´ãåºç¨ç¨åºéè¿ JDBC é©±å¨è®¿é® cobar éç¾¤ï¼cobar æ ¹æ® SQL åååºè§åå¯¹ SQL ååè§£ï¼ç¶åååå° MySQL éç¾¤ä¸åçæ°æ®åºå®ä¾ä¸æ§è¡ãæ©äºå¹´è¿å¯ä»¥ç¨ï¼ä½æ¯æè¿å å¹´é½æ²¡æ´æ°äºï¼åºæ¬æ²¡å¥äººç¨ï¼å·®ä¸å¤ç®æ¯è¢«æå¼çç¶æå§ãèä¸ä¸æ¯æè¯»ååç¦»ãå­å¨è¿ç¨ãè·¨åº join ååé¡µç­æä½ã\n * TDDL - æ·å®å¢éå¼åçï¼å±äº client å±æ¹æ¡ãæ¯æåºæ¬ç crud è¯­æ³åè¯»ååç¦»ï¼ä½ä¸æ¯æ joinãå¤è¡¨æ¥è¯¢ç­è¯­æ³ãç®åä½¿ç¨çä¹ä¸å¤ï¼å ä¸ºè¿ä¾èµæ·å®ç diamond éç½®ç®¡çç³»ç»ã\n * Atlas - 360 å¼æºçï¼å±äº proxy å±æ¹æ¡ï¼ä»¥åæ¯æä¸äºå¬å¸å¨ç¨çï¼ä½æ¯ç¡®å®æä¸ä¸ªå¾å¤§çé®é¢å°±æ¯ç¤¾åºææ°çç»´æ¤é½å¨ 5 å¹´åäºãæä»¥ï¼ç°å¨ç¨çå¬å¸åºæ¬ä¹å¾å°äºã\n * sharding-jdbc - å½å½å¼æºçï¼å±äº client å±æ¹æ¡ãç¡®å®ä¹åç¨çè¿æ¯è¾å¤ä¸äºï¼å ä¸º SQL è¯­æ³æ¯æä¹æ¯è¾å¤ï¼æ²¡æå¤ªå¤éå¶ï¼èä¸ç®åæ¨åºå°äº 2.0 çæ¬ï¼æ¯æååºåè¡¨ãè¯»ååç¦»ãåå¸å¼ id çæãææ§äºå¡ï¼æå¤§åªåéè¾¾åäºå¡ãTCC äºå¡ï¼ãèä¸ç¡®å®ä¹åä½¿ç¨çå¬å¸ä¼æ¯è¾å¤ä¸äºï¼è¿ä¸ªå¨å®ç½æç»è®°ä½¿ç¨çå¬å¸ï¼å¯ä»¥çå°ä» 2017 å¹´ä¸ç´å°ç°å¨ï¼æ¯æä¸å°å¬å¸å¨ç¨çï¼ï¼ç®åç¤¾åºä¹è¿ä¸ç´å¨å¼ååç»´æ¤ï¼è¿ç®æ¯æ¯è¾æ´»è·ï¼ä¸ªäººè®¤ä¸ºç®æ¯ä¸ä¸ªç°å¨ä¹å¯ä»¥éæ©çæ¹æ¡ã\n * Mycat - åºäº cobar æ¹é çï¼å±äº proxy å±æ¹æ¡ï¼æ¯æçåè½éå¸¸å®åï¼èä¸ç®ååºè¯¥æ¯éå¸¸ç«çèä¸ä¸æ­æµè¡çæ°æ®åºä¸­é´ä»¶ï¼ç¤¾åºå¾æ´»è·ï¼ä¹æä¸äºå¬å¸å¼å§å¨ç¨äºãä½æ¯ç¡®å®ç¸æ¯äº sharding jdbc æ¥è¯´ï¼å¹´è½»ä¸äºï¼ç»åçé¤ç¼å°ä¸äºã\n\n# ååºåè¡¨ä¸­é´ä»¶ææ¯éå\n\nå»ºè®®ä½¿ç¨çæ¯ sharding-jdbc å mycatã\n\n * sharding-jdbc è¿ç§ client å±æ¹æ¡çä¼ç¹å¨äºä¸ç¨é¨ç½²ï¼è¿ç»´ææ¬ä½ï¼ä¸éè¦ä»£çå±çäºæ¬¡è½¬åè¯·æ±ï¼æ§è½å¾é«ï¼ä½æ¯å¦æéå°åçº§å¥çéè¦åä¸ªç³»ç»é½éæ°åçº§çæ¬ååå¸ï¼åä¸ªç³»ç»é½éè¦è¦å sharding-jdbc çä¾èµãå¶æ¬è´¨ä¸éè¿éç½®å¤æ°æ®æºï¼ç¶åæ ¹æ®è®¾å®çååºåè¡¨ç­ç¥ï¼è®¡ç®è·¯ç±ï¼å°è¯·æ±åéå°è®¡ç®å¾å°çèç¹ä¸ã\n\n * Mycat è¿ç§ proxy å±æ¹æ¡çç¼ºç¹å¨äºéè¦é¨ç½²ï¼èªå·±è¿ç»´ä¸å¥ä¸­é´ä»¶ï¼è¿ç»´ææ¬é«ï¼ä½æ¯å¥½å¤å¨äºå¯¹äºåä¸ªé¡¹ç®æ¯éæçï¼å¦æéå°åçº§ä¹ç±»çé½æ¯èªå·±ä¸­é´ä»¶é£éæå°±è¡äºã\n\néå¸¸æ¥è¯´ï¼è¿ä¸¤ä¸ªæ¹æ¡å¶å®é½å¯ä»¥éç¨ï¼ä½æ¯æä¸ªäººå»ºè®®ä¸­å°åå¬å¸éç¨ sharding-jdbcï¼client å±æ¹æ¡è½»ä¾¿ï¼èä¸ç»´æ¤ææ¬ä½ï¼ä¸éè¦é¢å¤å¢æ´¾äººæï¼èä¸ä¸­å°åå¬å¸ç³»ç»å¤æåº¦ä¼ä½ä¸äºï¼é¡¹ç®ä¹æ²¡é£ä¹å¤ï¼ä½æ¯ä¸­å¤§åå¬å¸æå¥½è¿æ¯éç¨ mycat è¿ç±» proxy å±æ¹æ¡ï¼å ä¸ºå¯è½å¤§å¬å¸ç³»ç»åé¡¹ç®éå¸¸å¤ï¼å¢éå¾å¤§ï¼äººååè¶³ï¼é£ä¹æå¥½æ¯ä¸é¨å¼ä¸ªäººæ¥ç ç©¶åç»´æ¤ mycatï¼ç¶åå¤§éé¡¹ç®ç´æ¥éæä½¿ç¨å³å¯ã\n\n\n# ååºåè¡¨çé®é¢\n\n>  * ååºåè¡¨çå¸¸è§é®é¢æåªäºï¼\n> \n>  * ä½ æ¯å¦ä½è§£å³ååºåè¡¨çé®é¢çï¼\n> \n> ä¸æä¸ä¸è®²è§£å¸¸è§ååºåè¡¨çé®é¢åè§£å³æ¹æ¡ã\n\n# åå¸å¼äºå¡\n\næ¹æ¡ä¸ï¼ä½¿ç¨æ°æ®åºäºå¡\n\n * ä¼ç¹ï¼äº¤ç±æ°æ®åºç®¡çï¼ç®åææ\n * ç¼ºç¹ï¼æ§è½ä»£ä»·é«ï¼ç¹å«æ¯ shard è¶æ¥è¶å¤æ¶\n\næ¹æ¡äºï¼ç±åºç¨ç¨åºåæ°æ®åºå±åæ§å¶\n\n * åçï¼å°ä¸ä¸ªè·¨å¤ä¸ªæ°æ®åºçåå¸å¼äºå¡åææå¤ä¸ªä»å¤äºåä¸ªæ°æ®åºä¸é¢çå°äºå¡ï¼å¹¶éè¿åºç¨ç¨åºæ¥æ»æ§åä¸ªå°äºå¡ã\n * ä¼ç¹ï¼æ§è½ä¸æä¼å¿\n * ç¼ºç¹ï¼éè¦åºç¨ç¨åºå¨äºå¡æ§å¶ä¸åçµæ´»è®¾è®¡ãå¦æä½¿ç¨äº spring çäºå¡ç®¡çï¼æ¹å¨èµ·æ¥ä¼é¢ä¸´ä¸å®çå°é¾ã\n\n# è·¨èç¹ Join\n\nåªè¦æ¯è¿è¡ååï¼è·¨èç¹ Join çé®é¢æ¯ä¸å¯é¿åçãä½æ¯è¯å¥½çè®¾è®¡åååå´å¯ä»¥åå°æ­¤ç±»æåµçåçãè§£å³è¿ä¸é®é¢çæ®éåæ³æ¯åä¸¤æ¬¡æ¥è¯¢å®ç°ãå¨ç¬¬ä¸æ¬¡æ¥è¯¢çç»æéä¸­æ¾åºå³èæ°æ®ç idï¼æ ¹æ®è¿äº id åèµ·ç¬¬äºæ¬¡è¯·æ±å¾å°å³èæ°æ®ã\n\n# è·¨èç¹ç count,order by,group by ä»¥åèåå½æ°\n\nè¿äºæ¯ä¸ç±»é®é¢ï¼å ä¸ºå®ä»¬é½éè¦åºäºå¨é¨æ°æ®éåè¿è¡è®¡ç®ãå¤æ°çä»£çé½ä¸ä¼èªå¨å¤çåå¹¶å·¥ä½ã\n\nè§£å³æ¹æ¡ï¼ä¸è§£å³è·¨èç¹ join é®é¢çç±»ä¼¼ï¼åå«å¨åä¸ªèç¹ä¸å¾å°ç»æåå¨åºç¨ç¨åºç«¯è¿è¡åå¹¶ãå join ä¸åçæ¯æ¯ä¸ªèç¹çæ¥è¯¢å¯ä»¥å¹¶è¡æ§è¡ï¼å æ­¤å¾å¤æ¶åå®çéåº¦è¦æ¯åä¸å¤§è¡¨å¿«å¾å¤ãä½å¦æç»æéå¾å¤§ï¼å¯¹åºç¨ç¨åºåå­çæ¶èæ¯ä¸ä¸ªé®é¢ã\n\nä¸å¡è§åº¦ä¸çè§£å³æ¹æ¡ï¼\n\n * å¦ææ¯å¨åå°åºç¨æä¾åé¡µï¼åéå®ç¨æ·åªè½çåé¢ n é¡µï¼è¿ä¸ªéå¶å¨ä¸å¡ä¸ä¹æ¯åççï¼ä¸è¬çåé¢çåé¡µæä¹ä¸å¤§ï¼å¦æä¸å®è¦çï¼å¯ä»¥è¦æ±ç¨æ·ç¼©å°èå´éæ°æ¥è¯¢ï¼ã\n * å¦ææ¯åå°æ¹å¤çä»»å¡è¦æ±åæ¹è·åæ°æ®ï¼åå¯ä»¥å å¤§ page sizeï¼æ¯å¦æ¯æ¬¡è·å 5000 æ¡è®°å½ï¼ææåå°åé¡µæ°ï¼å½ç¶ç¦»çº¿è®¿é®ä¸è¬èµ°å¤åºï¼é¿åå²å»ä¸»åºï¼ã\n * ååºè®¾è®¡æ¶ï¼ä¸è¬è¿æéå¥å¤§æ°æ®å¹³å°æ±æ»ææååºçè®°å½ï¼æäºåé¡µæ¥è¯¢å¯ä»¥èèèµ°å¤§æ°æ®å¹³å°ã\n\n# åå¸å¼ ID\n\nä¸æ¦æ°æ®åºè¢«ååå°å¤ä¸ªç©çèç¹ä¸ï¼æä»¬å°ä¸è½åä¾èµæ°æ®åºèªèº«çä¸»é®çææºå¶ãä¸æ¹é¢ï¼æä¸ªååºæ°æ®åºèªçæç ID æ æ³ä¿è¯å¨å¨å±ä¸æ¯å¯ä¸çï¼å¦ä¸æ¹é¢ï¼åºç¨ç¨åºå¨æå¥æ°æ®ä¹åéè¦åè·å¾ IDï¼ä»¥ä¾¿è¿è¡ SQL è·¯ç±ã\n\nä¸äºå¸¸è§çä¸»é®çæç­ç¥ï¼\n\n * ä½¿ç¨å¨å±å¯ä¸ IDï¼GUIDã\n * ä¸ºæ¯ä¸ªåçæå®ä¸ä¸ª ID èå´ã\n * åå¸å¼ ID çæå¨ (å¦ Twitter ç Snowflake ç®æ³)ã\n\n# æ°æ®è¿ç§»ï¼å®¹éè§åï¼æ©å®¹ç­é®é¢\n\næ¥èªæ·å®ç»¼åä¸å¡å¹³å°å¢éï¼å®å©ç¨å¯¹ 2 çåæ°åä½å·æååå¼å®¹çç¹æ§ï¼å¦å¯¹ 4 åä½å¾ 1 çæ°å¯¹ 2 åä½ä¹æ¯ 1ï¼æ¥åéæ°æ®ï¼é¿åäºè¡çº§å«çæ°æ®è¿ç§»ï¼ä½æ¯ä¾ç¶éè¦è¿è¡è¡¨çº§å«çè¿ç§»ï¼åæ¶å¯¹æ©å®¹è§æ¨¡ååè¡¨æ°éé½æéå¶ãæ»å¾æ¥è¯´ï¼è¿äºæ¹æ¡é½ä¸æ¯ååççæ³ï¼å¤å¤å°å°é½å­å¨ä¸äºç¼ºç¹ï¼è¿ä¹ä»ä¸ä¸ªä¾§é¢åæ åºäº Sharding æ©å®¹çé¾åº¦ã\n\n\n# éç¾¤\n\n> è¿ä¸ªä¸é¢éè¦æ ¹æ®çæåªä¸ªæ°æ®åºèå®ï¼ä½æ¯ä¸»æµãæççæ°æ®åºé½ä¼å®ç°ä¸äºåºæ¬åè½ï¼åªæ¯å®ç°æ¹å¼ãç­ç¥ä¸ææå·®å¼ãç±äºæ¬äººè¾ä¸ºçæ Mysqlï¼æä»¥ä¸é¢ä¸»è¦ä»ç» Mysql ç³»ç»æ¶æé®é¢ã\n\n\n# å¤å¶æºå¶\n\nMysql æ¯æä¸¤ç§å¤å¶ï¼åºäºè¡çå¤å¶ååºäºè¯­å¥çå¤å¶ã\n\nè¿ä¸¤ç§æ¹å¼é½æ¯å¨ä¸»åºä¸è®°å½äºè¿å¶æ¥å¿ï¼binlogï¼ï¼ç¶åå¨ä»åºä¸ä»¥å¼æ­¥æ¹å¼æ´æ°ä¸»åºä¸çæ¥å¿è®°å½ãè¿æå³çï¼å¤å¶è¿ç¨å­å¨æ¶å»¶ï¼è¿æ®µæ¶é´åï¼ä¸»ä»æ°æ®å¯è½ä¸ä¸è´ï¼å³æç»ä¸è´æ§ï¼ã\n\nä¸»è¦æ¶åä¸ä¸ªçº¿ç¨ï¼binlog çº¿ç¨ãI/O çº¿ç¨å SQL çº¿ç¨ã\n\n * binlog çº¿ç¨ ï¼è´è´£å°ä¸»æå¡å¨ä¸çæ°æ®æ´æ¹åå¥äºè¿å¶æä»¶ï¼binlogï¼ä¸­ã\n * I/O çº¿ç¨ ï¼è´è´£ä»ä¸»æå¡å¨ä¸è¯»åäºè¿å¶æ¥å¿æä»¶ï¼å¹¶åå¥ä»æå¡å¨çæ¥å¿ä¸­ã\n * SQL çº¿ç¨ ï¼è´è´£è¯»åæ¥å¿å¹¶æ§è¡ SQL è¯­å¥ä»¥æ´æ°æ°æ®ã\n\n\n\n\n# è¯»ååç¦»\n\nä¸»æå¡å¨ç¨æ¥å¤çåæä½ä»¥åå®æ¶æ§è¦æ±æ¯è¾é«çè¯»æä½ï¼èä»æå¡å¨ç¨æ¥å¤çè¯»æä½ã\n\nè¯»ååç¦»å¸¸ç¨ä»£çæ¹å¼æ¥å®ç°ï¼ä»£çæå¡å¨æ¥æ¶åºç¨å±ä¼ æ¥çè¯»åè¯·æ±ï¼ç¶åå³å®è½¬åå°åªä¸ªæå¡å¨ã\n\nMySQL è¯»ååç¦»è½æé«æ§è½çåå å¨äºï¼\n\n * ä¸»ä»æå¡å¨è´è´£åèªçè¯»ååï¼æå¤§ç¨åº¦ç¼è§£äºéçäºç¨ï¼\n * ä»æå¡å¨å¯ä»¥éç½® MyISAM å¼æï¼æåæ¥è¯¢æ§è½ä»¥åèçº¦ç³»ç»å¼éï¼\n * å¢å åä½ï¼æé«å¯ç¨æ§ã\n\n\n\n\n# æ°æ®åºä¼å\n\næ°æ®åºä¼åçè·¯çº¿ä¸è¬ä¸ºï¼SQL ä¼åãç»æä¼åãéç½®ä¼åãç¡¬ä»¶ä¼åãåä¸¤ä¸ªæ¹åä¸è¬æ¯æ®éå¼åçèéç¹ï¼èåä¸¤ä¸ªæ¹åä¸è¬æ¯ DBA çèéç¹ã\n\n\n# SQL ä¼å\n\n> SQL ä¼åæ¯æ°æ®åºä¼åçæå¸¸è§ãæåçº§ææ®µã\n> \n> å¨æ§è¡ SQL è¯­å¥ï¼è¯­å¥ä¸­å­æ®µçé¡ºåºãæ¥è¯¢ç­ç¥ç­é½å¯è½ä¼å½±åå° SQL çæ§è¡æ§è½ã\n\n# æ§è¡è®¡å\n\nå¦ä½æ£éªä¿®æ¹åç SQL ç¡®å®æä¼åææï¼è¿å°±éè¦ç¨å°æ§è¡è®¡åï¼EXPLAINï¼ã\n\nä½¿ç¨æ§è¡è®¡å EXPLAIN ç¨æ¥åæ SELECT æ¥è¯¢æçï¼å¼åäººåå¯ä»¥éè¿åæ EXPLAIN ç»ææ¥ä¼åæ¥è¯¢è¯­å¥ã\n\næ¯è¾éè¦çå­æ®µæï¼\n\n * select_type - æ¥è¯¢ç±»åï¼æç®åæ¥è¯¢ãèåæ¥è¯¢ãå­æ¥è¯¢ç­\n * key - ä½¿ç¨çç´¢å¼\n * rows - æ«æçè¡æ°\n\n> æ´å¤åå®¹è¯·åèï¼MySQL æ§è½ä¼åç¥å¨ Explain ä½¿ç¨åæ\n\n# è®¿é®æ°æ®ä¼å\n\nåå°è¯·æ±çæ°æ®éï¼\n\n * åªè¿åå¿è¦çå - ä¸è¦æ¥è¯¢ä¸éè¦çåï¼å°½éé¿åä½¿ç¨ SELECT * è¯­å¥ã\n * åªè¿åå¿è¦çè¡ - ä½¿ç¨ WHERE è¯­å¥è¿è¡æ¥è¯¢è¿æ»¤ï¼ææ¶åä¹éè¦ä½¿ç¨ LIMIT è¯­å¥æ¥éå¶è¿åçæ°æ®ã\n * ç¼å­éå¤æ¥è¯¢çæ°æ® - ä½¿ç¨ç¼å­å¯ä»¥é¿åå¨æ°æ®åºä¸­è¿è¡æ¥è¯¢ï¼ç¹å«è¦æ¥è¯¢çæ°æ®ç»å¸¸è¢«éå¤æ¥è¯¢ï¼ç¼å­å¯ä»¥å¸¦æ¥çæ¥è¯¢æ§è½æåå°ä¼æ¯éå¸¸ææ¾çã\n\nåå°æå¡å¨ç«¯æ«æçè¡æ°ï¼\n\n * æææçæ¹å¼æ¯ä½¿ç¨ç´¢å¼æ¥è¦çæ¥è¯¢ï¼å³ WHERE åçè¿æ»¤æ¥è¯¢å­æ®µæå¥½æ¯ç´¢å¼å­æ®µï¼ã\n\n# éææ¥è¯¢æ¹å¼\n\n# ååæ¥è¯¢\n\nä¸ä¸ªå¤§æ¥è¯¢å¦æä¸æ¬¡æ§æ§è¡çè¯ï¼å¯è½ä¸æ¬¡éä½å¾å¤æ°æ®ãå æ»¡æ´ä¸ªäºå¡æ¥å¿ãèå°½ç³»ç»èµæºãé»å¡å¾å¤å°çä½éè¦çæ¥è¯¢ã\n\nDELEFT FROM messages WHERE create < DATE_SUB(NOW(), INTERVAL 3 MONTH);\n\n\nrows_affected = 0\ndo {\n    rows_affected = do_query(\n    \"DELETE FROM messages WHERE create  < DATE_SUB(NOW(), INTERVAL 3 MONTH) LIMIT 10000\")\n} while rows_affected > 0\n\n\n# åè§£å³èæ¥è¯¢\n\nå°ä¸ä¸ªå¤§è¿æ¥æ¥è¯¢ï¼JOINï¼åè§£æå¯¹æ¯ä¸ä¸ªè¡¨è¿è¡ä¸æ¬¡åè¡¨æ¥è¯¢ï¼ç¶åå°ç»æå¨åºç¨ç¨åºä¸­è¿è¡å³èï¼è¿æ ·åçå¥½å¤æï¼\n\n * ç¼å­æ´é«æãå¯¹äºè¿æ¥æ¥è¯¢ï¼å¦æå¶ä¸­ä¸ä¸ªè¡¨åçååï¼é£ä¹æ´ä¸ªæ¥è¯¢ç¼å­å°±æ æ³ä½¿ç¨ãèåè§£åçå¤ä¸ªæ¥è¯¢ï¼å³ä½¿å¶ä¸­ä¸ä¸ªè¡¨åçååï¼å¯¹å¶å®è¡¨çæ¥è¯¢ç¼å­ä¾ç¶å¯ä»¥ä½¿ç¨ã\n * åè§£æå¤ä¸ªåè¡¨æ¥è¯¢ï¼è¿äºåè¡¨æ¥è¯¢çç¼å­ç»ææ´å¯è½è¢«å¶å®æ¥è¯¢ä½¿ç¨å°ï¼ä»èåå°åä½è®°å½çæ¥è¯¢ã\n * åå°éç«äºï¼\n * å¨åºç¨å±è¿è¡è¿æ¥ï¼å¯ä»¥æ´å®¹æå¯¹æ°æ®åºè¿è¡æåï¼ä»èæ´å®¹æåå°é«æ§è½åå¯æ©å±ã\n * æ¥è¯¢æ¬èº«æçä¹å¯è½ä¼æææåãä¾å¦ä¸é¢çä¾å­ä¸­ï¼ä½¿ç¨ IN() ä»£æ¿è¿æ¥æ¥è¯¢ï¼å¯ä»¥è®© MySQL æç§ ID é¡ºåºè¿è¡æ¥è¯¢ï¼è¿å¯è½æ¯éæºçè¿æ¥è¦æ´é«æã\n\nSELECT * FROM tag\nJOIN tag_post ON tag_post.tag_id=tag.id\nJOIN post ON tag_post.post_id=post.id\nWHERE tag.tag='mysql';\nSELECT * FROM tag WHERE tag='mysql';\nSELECT * FROM tag_post WHERE tag_id=1234;\nSELECT * FROM post WHERE post.id IN (123,456,567,9098,8904);\n\n\n# SQL è¯­å¥ç»è\n\n# éæ©æææççè¡¨åé¡ºåº\n\næ°æ®åºæç§ä»å³å°å·¦çé¡ºåºå¤ç FROM å­å¥ä¸­çè¡¨åï¼FROM å­å¥ä¸­åå¨æåçè¡¨å°è¢«æåå¤çã\n\nå¨ FROM å­å¥ä¸­åå«å¤ä¸ªè¡¨çæåµä¸ï¼\n\n * å¦æå¤ä¸ªè¡¨æ¯å®å¨æ å³ç³»çè¯ï¼å°è®°å½åååæå°çè¡¨ï¼åå¨æåï¼ç¶åä¾æ¬¡ç±»æ¨ãä¹å°±æ¯è¯´ï¼éæ©è®°å½æ¡æ°æå°çè¡¨æ¾å¨æåã\n\nå¦ææ 3 ä¸ªä»¥ä¸çè¡¨è¿æ¥æ¥è¯¢ï¼\n\n * å¦æå¤ä¸ªè¡¨æ¯æå³ç³»çè¯ï¼å°å¼ç¨æå¤çè¡¨ï¼æ¾å¨æåï¼ç¶åä¾æ¬¡ç±»æ¨ãä¹å°±æ¯è¯´ï¼è¢«å¶ä»è¡¨æå¼ç¨çè¡¨æ¾å¨æåã\n\nä¾å¦ï¼æ¥è¯¢åå·¥çç¼å·ï¼å§åï¼å·¥èµï¼å·¥èµç­çº§ï¼é¨é¨å\n\nemp è¡¨è¢«å¼ç¨å¾æå¤ï¼è®°å½æ°ä¹æ¯æå¤ï¼å æ­¤æ¾å¨ form å­å¥çæåé¢\n\nselect emp.empno,emp.ename,emp.sal,salgrade.grade,dept.dname\nfrom salgrade,dept,emp\nwhere (emp.deptno = dept.deptno) and (emp.sal between salgrade.losal and salgrade.hisal)\n\n\n# WHERE å­å¥ä¸­çè¿æ¥é¡ºåº\n\næ°æ®åºæç§ä»å³å°å·¦çé¡ºåºè§£æ WHERE å­å¥ã\n\nå æ­¤ï¼è¡¨ä¹é´çè¿æ¥å¿é¡»åå¨å¶ä» WHERE æ¡ä»¶çå·¦è¾¹ï¼é£äºå¯ä»¥è¿æ»¤ææå¤§æ°éè®°å½çæ¡ä»¶å¿é¡»åå¨ WHERE å­å¥çä¹å³ã\n\nemp.sal å¯ä»¥è¿æ»¤å¤æ¡è®°å½ï¼åå¨ WHERE å­å¥çæå³è¾¹\n\nselect emp.empno,emp.ename,emp.sal,dept.dname\nfrom dept,emp\nwhere (emp.deptno = dept.deptno) and (emp.sal > 1500)\n\n\n# SELECT å­å¥ä¸­é¿åä½¿ç¨ * å·\n\næä»¬å½æ¶å­¦ä¹ çæ¶åï¼â*â å·æ¯å¯ä»¥è·åè¡¨ä¸­å¨é¨çå­æ®µæ°æ®çã\n\n * ä½æ¯å®è¦éè¿æ¥è¯¢æ°æ®å­å¸å®æçï¼è¿æå³çå°èè´¹æ´å¤çæ¶é´\n * ä½¿ç¨*å·ååºæ¥ç SQL è¯­å¥ä¹ä¸å¤ç´è§ã\n\n----------------------------------------\n\n# ç¨ TRUNCATE æ¿ä»£ DELETE\n\nå¦æéè¦æ¸ç©ºææè¡¨è®°å½ï¼ä½¿ç¨ TRUNCATE æ¯ DELETE æ§è¡æçé«ï¼\n\nDELETE æ¯ä¸æ¡ä¸æ¡è®°å½çå é¤ï¼è Truncate æ¯å°æ´ä¸ªè¡¨å é¤ï¼ä»ä¿çè¡¨ç»æ\n\n# ä½¿ç¨åé¨å½æ°æé« SQL æç\n\nä¾å¦ä½¿ç¨ mysql ç concat() å½æ°ä¼æ¯ä½¿ç¨ || æ¼æ¥éåº¦å¿«ï¼å ä¸º concat() å½æ°å·²ç»è¢« mysql ä¼åè¿äºã\n\n# ä½¿ç¨è¡¨æåçå«å\n\nå¦æè¡¨æåçåç§°å¤ªé¿äºï¼ä½¿ç¨ä¸äºç®ç­çå«åä¹è½ç¨å¾®æé«ä¸äº SQL çæ§è½ãæ¯ç«è¦æ«æçå­ç¬¦é¿åº¦å°±åå°äºã\n\n# SQL å³é®å­å¤§å\n\næä»¬å¨ç¼å SQL çæ¶åï¼å®æ¹æ¨èçæ¯ä½¿ç¨å¤§åæ¥åå³é®å­ï¼å ä¸º Oracle æå¡å¨æ»æ¯åå°å°åå­æ¯è½¬æå¤§ååï¼ææ§è¡\n\n# ç¨ >= æ¿ä»£ >\n\nâ ä½ææ¹å¼ï¼\n\n-- é¦åå®ä½å°DEPTNO=3çè®°å½å¹¶ä¸æ«æå°ç¬¬ä¸ä¸ªDEPTå¤§äº3çè®°å½\nSELECT * FROM EMP WHERE DEPTNO > 3\n\n\nâ é«ææ¹å¼ï¼\n\n-- ç´æ¥è·³å°ç¬¬ä¸ä¸ªDEPTç­äº4çè®°å½\nSELECT * FROM EMP WHERE DEPTNO >= 4\n\n\n# ç¨ IN æ¿ä»£ OR\n\nâ ä½ææ¹å¼ï¼\n\nselect * from emp where sal = 1500 or sal = 3000 or sal = 800;\n\n\nâ é«ææ¹å¼ï¼\n\nselect * from emp where sal in (1500,3000,800);\n\n\n# æ»æ¯ä½¿ç¨ç´¢å¼çç¬¬ä¸ä¸ªå\n\nå¦æç´¢å¼æ¯å»ºç«å¨å¤ä¸ªåä¸ï¼åªæå¨å®çç¬¬ä¸ä¸ªåè¢« WHERE å­å¥å¼ç¨æ¶ï¼ä¼åå¨æä¼éæ©ä½¿ç¨è¯¥ç´¢å¼ã å½åªå¼ç¨ç´¢å¼çç¬¬äºä¸ªåæ¶ï¼ä¸å¼ç¨ç´¢å¼çç¬¬ä¸ä¸ªåæ¶ï¼ä¼åå¨ä½¿ç¨äºå¨è¡¨æ«æèå¿½ç¥äºç´¢å¼\n\ncreate index emp_sal_job_idex\non emp(sal,job);\n----------------------------------\nselect *\nfrom emp\nwhere job != 'SALES';\n\n\n# SQL å³é®å­å°½éå¤§å\n\nSQL å³é®å­å°½éå¤§åï¼å¦ï¼Oracle é»è®¤ä¼å° SQL è¯­å¥ä¸­çå³é®å­è½¬ä¸ºå¤§ååå¨æ§è¡ã\n\n\n# ç»æä¼å\n\næ°æ®åºç»æä¼åå¯ä»¥ä»ä»¥ä¸æ¹åçæï¼\n\n * æ°æ®ç±»åä¼å\n * èå¼ååèå¼ä¼å\n * ç´¢å¼ä¼å - ç»èè¯·çç´¢å¼åçº¦æç« è\n * ååºåè¡¨ - ç»èè¯·çååºåè¡¨ç« è\n\n# æ°æ®ç±»åä¼ååå\n\n * æ´å°çéå¸¸æ´å¥½\n * ç®åå°±å¥½ï¼å¦æ´åæ¯å­ç¬¦åæä½ä»£ä»·ä½\n * å°½éé¿å NULL\n\n# èå¼ååèå¼\n\nèå¼ååèå¼åæå©å¼ï¼éè¦æ ¹æ®å®éæåµæè¡¡ã\n\nèå¼åçç®æ æ¯å°½ååå°åä½åï¼èçç©ºé´ã\n\n * èå¼åçä¼ç¹æ¯ï¼\n   \n   * åå°åä½åï¼è¦åçæ°æ®å°±å°ï¼åæä½çæ§è½æé«ï¼\n   * æ£ç´¢åæ°æ®æ¶ï¼DISTINCT æ GROUP BY æä½åå°ã\n\n * èå¼åçç¼ºç¹æ¯ï¼å¢å å³èæ¥è¯¢ã\n\nåèå¼åçç®æ æ¯éå½å¢å åä½åï¼ä»¥é¿åå³èæ¥è¯¢ã\n\nåèå¼åçç¼ºç¹æ¯ï¼\n\n * åä½åå¢å¤ï¼ç©ºé´åå¤§ï¼åæä½æ§è½ä¸éï¼\n * æ£ç´¢åæ°æ®æ¶ï¼DISTINCT æ GROUP BY æä½åå¤ï¼\n\n\n# éç½®ä¼å\n\n> éç½®ä¼åä¸»è¦æ¯éå¯¹ Mysql æå¡å¨ï¼ä¾å¦ï¼max_connectionsãmax_heap_table_sizeãopen_files_limitãmax_allowed_packet ç­ç­ã\n> \n> å¨ä¸åç¯å¢ï¼ä¸ååºæ¯ä¸ï¼åºè¯¥éæä½¿ç¨åççéç½®ãè¿ç§ä¼åæ¯è¾èéª Mysql è¿ç»´ç»éªï¼ä¸è¬æ¯ DBA çèéï¼æ®éå¼åæ¥è§¦çè¾å°ã\n> \n> Mysql éç½®è¯´æè¯·åèï¼Mysql æå¡å¨éç½®è¯´æ\n\n\n# ç¡¬ä»¶ä¼å\n\næ°æ®åºæ©å®¹ãä½¿ç¨é«éè®¾å¤ç­ç­ãæ ¸å¿å°±æ¯ä¸ä¸ªå­ï¼é±ã\n\n\n# æ°æ®åºçè®º\n\n\n# å½æ°ä¾èµ\n\nè®° A->B è¡¨ç¤º A å½æ°å³å® Bï¼ä¹å¯ä»¥è¯´ B å½æ°ä¾èµäº Aã\n\nå¦æ {A1ï¼A2ï¼... ï¼An} æ¯å³ç³»çä¸ä¸ªæå¤ä¸ªå±æ§çéåï¼è¯¥éåå½æ°å³å®äºå³ç³»çå¶å®ææå±æ§å¹¶ä¸æ¯æå°çï¼é£ä¹è¯¥éåå°±ç§°ä¸ºé®ç ã\n\nå¯¹äº A->Bï¼å¦æè½æ¾å° A ççå­é A'ï¼ä½¿å¾ A'-> Bï¼é£ä¹ A->B å°±æ¯é¨åå½æ°ä¾èµï¼å¦åå°±æ¯å®å¨å½æ°ä¾èµï¼\n\nå¯¹äº A->Bï¼B->Cï¼å A->C æ¯ä¸ä¸ªä¼ éä¾èµã\n\n\n# å¼å¸¸\n\nä»¥ä¸çå­¦çè¯¾ç¨å³ç³»çå½æ°ä¾èµä¸º Sno, Cname -> Sname, Sdept, Mname, Gradeï¼é®ç ä¸º {Sno, Cname}ãä¹å°±æ¯è¯´ï¼ç¡®å®å­¦çåè¯¾ç¨ä¹åï¼å°±è½ç¡®å®å¶å®ä¿¡æ¯ã\n\nSNO   SNAME   SDEPT   MNAME   CNAME   GRADE\n1     å­¦ç-1    å­¦é¢-1    é¢é¿-1    è¯¾ç¨-1    90\n2     å­¦ç-2    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-2    80\n2     å­¦ç-2    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-1    100\n3     å­¦ç-3    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-2    95\n\nä¸ç¬¦åèå¼çå³ç³»ï¼ä¼äº§çå¾å¤å¼å¸¸ï¼ä¸»è¦æä»¥ä¸åç§å¼å¸¸ï¼\n\n * åä½æ°æ®ï¼ä¾å¦ å­¦ç-2 åºç°äºä¸¤æ¬¡ã\n * ä¿®æ¹å¼å¸¸ï¼ä¿®æ¹äºä¸ä¸ªè®°å½ä¸­çä¿¡æ¯ï¼ä½æ¯å¦ä¸ä¸ªè®°å½ä¸­ç¸åçä¿¡æ¯å´æ²¡æè¢«ä¿®æ¹ã\n * å é¤å¼å¸¸ï¼å é¤ä¸ä¸ªä¿¡æ¯ï¼é£ä¹ä¹ä¼ä¸¢å¤±å¶å®ä¿¡æ¯ãä¾å¦å¦æå é¤äº è¯¾ç¨-1ï¼éè¦å é¤ç¬¬ä¸è¡åç¬¬ä¸è¡ï¼é£ä¹ å­¦ç-1 çä¿¡æ¯å°±ä¼ä¸¢å¤±ã\n * æå¥å¼å¸¸ï¼ä¾å¦æ³è¦æå¥ä¸ä¸ªå­¦ççä¿¡æ¯ï¼å¦æè¿ä¸ªå­¦çè¿æ²¡éè¯¾ï¼é£ä¹å°±æ æ³æå¥ã\n\n\n# èå¼\n\nèå¼çè®ºæ¯ä¸ºäºè§£å³ä»¥ä¸æå°åç§å¼å¸¸ã\n\né«çº§å«èå¼çä¾èµäºä½çº§å«çèå¼ï¼1NF æ¯æä½çº§å«çèå¼ã\n\n\n\n# ç¬¬ä¸èå¼ (1NF)\n\nå±æ§ä¸å¯åã\n\n# ç¬¬äºèå¼ (2NF)\n\n * æ¯ä¸ªéä¸»å±æ§å®å¨å½æ°ä¾èµäºé®ç ã\n\n * å¯ä»¥éè¿åè§£æ¥æ»¡è¶³ã\n\nåè§£å\n\nSNO   SNAME   SDEPT   MNAME   CNAME   GRADE\n1     å­¦ç-1    å­¦é¢-1    é¢é¿-1    è¯¾ç¨-1    90\n2     å­¦ç-2    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-2    80\n2     å­¦ç-2    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-1    100\n3     å­¦ç-3    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-2    95\n\nä»¥ä¸å­¦çè¯¾ç¨å³ç³»ä¸­ï¼{Sno, Cname} ä¸ºé®ç ï¼æå¦ä¸å½æ°ä¾èµï¼\n\n * Sno -> Sname, Sdept\n * Sdept -> Mname\n * Sno, Cname-> Grade\n\nGrade å®å¨å½æ°ä¾èµäºé®ç ï¼å®æ²¡æä»»ä½åä½æ°æ®ï¼æ¯ä¸ªå­¦ççæ¯é¨è¯¾é½æç¹å®çæç»©ã\n\nSname, Sdept å Mname é½é¨åä¾èµäºé®ç ï¼å½ä¸ä¸ªå­¦çéä¿®äºå¤é¨è¯¾æ¶ï¼è¿äºæ°æ®å°±ä¼åºç°å¤æ¬¡ï¼é æå¤§éåä½æ°æ®ã\n\nåè§£å\n\nå³ç³»-1\n\nSNO   SNAME   SDEPT   MNAME\n1     å­¦ç-1    å­¦é¢-1    é¢é¿-1\n2     å­¦ç-2    å­¦é¢-2    é¢é¿-2\n3     å­¦ç-3    å­¦é¢-2    é¢é¿-2\n\næä»¥ä¸å½æ°ä¾èµï¼\n\n * Sno -> Sname, Sdept, Mname\n * Sdept -> Mname\n\nå³ç³»-2\n\nSNO   CNAME   GRADE\n1     è¯¾ç¨-1    90\n2     è¯¾ç¨-2    80\n2     è¯¾ç¨-1    100\n3     è¯¾ç¨-2    95\n\næä»¥ä¸å½æ°ä¾èµï¼\n\n * Sno, Cname -> Grade\n\n# ç¬¬ä¸èå¼ (3NF)\n\n * éä¸»å±æ§ä¸ä¼ éä¾èµäºé®ç ã\n\nä¸é¢ç å³ç³»-1 ä¸­å­å¨ä»¥ä¸ä¼ éä¾èµï¼Sno -> Sdept -> Mnameï¼å¯ä»¥è¿è¡ä»¥ä¸åè§£ï¼\n\nå³ç³»-11\n\nSNO   SNAME   SDEPT\n1     å­¦ç-1    å­¦é¢-1\n2     å­¦ç-2    å­¦é¢-2\n3     å­¦ç-3    å­¦é¢-2\n\nå³ç³»-12\n\nSDEPT   MNAME\nå­¦é¢-1    é¢é¿-1\nå­¦é¢-2    é¢é¿-2\n\n\n# å­å¨å¼æ\n\nMysql æå¤ç§å­å¨å¼æï¼ä¸åçå­å¨å¼æä¿å­æ°æ®åç´¢å¼çæ¹å¼æ¯ä¸åçï¼ä½è¡¨çå®ä¹åæ¯å¨ Mysql æå¡å±ç»ä¸å¤ççã\n\nç®ååä¸¾å ä¸ªå­å¨å¼æï¼\n\n * InnoDB - Mysql çé»è®¤äºå¡åå­å¨å¼æï¼å¹¶æä¾äºè¡çº§éåå¤é®ççº¦æãæ§è½ä¸éä¸æ¯æèªå¨æéæ¢å¤ã\n * MyISAM - Mysql 5.1 çæ¬åçé»è®¤å­å¨å¼æãç¹æ§ä¸°å¯ä½ä¸æ¯æäºå¡ï¼ä¹ä¸æ¯æè¡çº§éåå¤é®ï¼ä¹æ²¡ææéæ¢å¤åè½ã\n * CSV - å¯ä»¥å° CSV æä»¶ä½ä¸º Mysql çè¡¨æ¥å¤çï¼ä½è¿ç§è¡¨ä¸æ¯æç´¢å¼ã\n * MEMORY ãææçæ°æ®é½å¨åå­ä¸­ï¼æ°æ®çå¤çéåº¦å¿«ï¼ä½æ¯å®å¨æ§ä¸é«ã\n\n\n# InnoDB vs. MyISAM\n\nInnoDB å MyISAM æ¯ç®åä½¿ç¨çæå¤çä¸¤ç§ Mysql å­å¨å¼æã\n\n * æ°æ®ç»ææ¯è¾ï¼\n   * InnoDB å MyISAM çç´¢å¼æ°æ®ç»æé½æ¯ B+ æ ã\n   * MyIASM ç B+ æ ä¸­å­å¨çåå®¹å®éä¸æ¯å®éæ°æ®çå°åå¼ãä¹å°±æ¯è¯´å®çç´¢å¼åå®éæ°æ®æ¯åå¼çï¼åªä¸è¿ä½¿ç¨ç´¢å¼æåäºå®éæ°æ®ãè¿ç§ç´¢å¼çæ¨¡å¼è¢«ç§°ä¸ºéèéç´¢å¼ã\n   * InnoDB ç B+ æ ä¸­å­å¨çåå®¹æ¯å®éçæ°æ®ï¼è¿ç§ç´¢å¼æè¢«ç§°ä¸ºèéç´¢å¼ã\n * äºå¡æ¯ææ¯è¾ï¼\n   * InnoDB æ¯æäºå¡ï¼å¹¶æä¾äºè¡çº§éåå¤é®ççº¦æã\n   * MyIASM ä¸æ¯æäºå¡ï¼ä¹ä¸æ¯æè¡çº§éåå¤é®ã\n * æéæ¢å¤æ¯è¾ï¼\n   * InnoDB æ¯ææéæ¢å¤ã\n   * MyISAM ä¸æ¯ææéæ¢å¤ã\n\n\n# æ°æ®åºæ¯è¾\n\n\n# å¸¸è§æ°æ®åºæ¯è¾\n\n * Oracle - ä¹è´çåçåä¸æ°æ®åºãåè½å¼ºå¤§ãç¨³å®ãæå¤§çç¼ºç¹å°±æ¯è´¹é±ã\n * Mysql - æ¾ç»æ¯äºèç½å¬å¸çæç±ï¼ä½èªå¨ Mysql è¢« Oracle å¬å¸æ¶è´­åï¼å¥½æ¥å­å¯è½ä¸å»ä¸å¤è¿ãå¾å¤å¬å¸æå¼æºé¡¹ç®å·²ç»éæ¸å¯»æ¾å¶ä»çå¼æºäº§åæ¥æ¿ä»£ Mysqlã\n * MariaDB - å¼æºå³ç³»åæ°æ®åºã MySQL ççæ­£å¼æºçåè¡çæ¬ï¼ç± Mysql é¨åæ ¸å¿äººååå»ºãå¯ä½ä¸º Mysql çæ¿ä»£äº§åã\n * PostgreSQL - å¼æºå³ç³»åæ°æ®åºãå MySQL çå·¥ä½æ¹å¼éå¸¸ç¸ä¼¼ï¼ç¤¾åºæ¯æåå¾å¾å¥½ãå¯ä½ä¸º Mysql çæ¿ä»£äº§åã\n * SQLite - å¼æºçè½»éçº§æ°æ®åºï¼ç§»å¨ç«¯å¸¸å¸¸ä½¿ç¨ã\n * H2 - åå­æ°æ®åºï¼ä¸è¬ç¨ä½å¼åãæµè¯ç¯å¢æ°æ®åºã\n * SQL Server - å¾®è½¯ Windows çæç³»ç»çæ°æ®åºãææ³ï¼Java ç¨åºååºè¯¥æ²¡äººç¨å§ã\n\n\n# Oracle vs. Mysql\n\nç®åä¸ºæ­¢ï¼Java é¢åç¨çæå¤çå³ç³»åæ°æ®åºï¼åºè¯¥è¿æ¯ Oracle å Mysqlï¼æä»¥è¿éåä¸ä¸æ¯è¾ã\n\n# æ°æ®åºå¯¹è±¡å·®å¼\n\nå¨ Mysql ä¸­ï¼ä¸ä¸ªç¨æ·å¯ä»¥åå»ºå¤ä¸ªåºã\n\nèå¨ Oracle ä¸­ï¼Oracle æå¡å¨æ¯ç±ä¸¤é¨åç»æ\n\n * æ°æ®åºå®ä¾ãçè§£ä¸ºå¯¹è±¡ï¼çä¸è§çã\n * æ°æ®åºãçè§£ä¸ºç±»ï¼çå¾è§çã\n\nä¸ä¸ªæ°æ®åºå®ä¾å¯æ¥æå¤ä¸ªç¨æ·ï¼ä¸ä¸ªç¨æ·é»è®¤æ¥æä¸ä¸ªè¡¨ç©ºé´ã\n\nè¡¨ç©ºé´æ¯å­å¨æä»¬æ°æ®åºè¡¨çå°æ¹ï¼è¡¨ç©ºé´åå¯ä»¥æå¤ä¸ªæä»¶ã\n\n# SQL å·®å¼\n\nï¼1ï¼ä¸»é®éå¢\n\nMysql å¯ä»¥è®¾ç½® AUTO_INCREMENT çº¦ææ¥æå®ä¸»é®ä¸ºèªå¢åºåã\n\nOracle éè¦éè¿ CREATE SEQUENCE åå»ºåºåã\n\nï¼2ï¼åé¡µæ¥è¯¢\n\nMysql åé¡µåºäº SELECT ... FROM ... LIMIT ... å®æï¼è¾ç®åã\n\nselect * from help_category order by parent_category_id limit 10,5;\n\n\nOracle åé¡µåºäº SELECT ... FROM (SELECT ROWNUM ...) WHERE ... å®æï¼è¾å¤æã\n\nselect * from\n(select rownum rr,a.* from (select * from emp order by sal) a )\nwhere rr>5 and rr<=10;\n\n\n# äºå¡å·®å¼\n\n * auto commit\n   * Mysql äºå¡æ¯ autocommit æ¨¡å¼ï¼å³èªå¨æäº¤äºå¡ï¼\n   * Oracle äºå¡éè¦æå¨ COMMITã\n * äºå¡éç¦»çº§å«\n   * Mysql é»è®¤çäºå¡éç¦»çº§å«æ¯å¯éå¤è¯»ï¼REPEATABLE READï¼\n   * Oracle æ¯æè¯»å·²æäº¤ï¼READ COMMITTEDï¼åä¸²è¡åï¼SERIALIZABLEï¼ ä¸¤ç§äºå¡éç¦»çº§å«ï¼é»è®¤äºå¡éç¦»çº§å«æ¯è¯»å·²æäº¤ï¼READ COMMITTEDï¼\n\n\n# æ°æ®ç±»åæ¯è¾\n\n> ä¸åæ°æ®åºä¸­ï¼å¯¹æ°æ®ç±»åçæ¯ææ¯ä¸ä¸æ ·çã\n> \n> å³ä½¿å­å¨åä¸ç§æ°æ®ç±»åï¼ä¹å¯è½å­å¨åç§°ä¸åãæå¤§å°ä¸åç­é®é¢ã\n> \n> å æ­¤ï¼å¯¹äºæ°æ®ç±»åçæ¯æè¯¦æå¿é¡»åèåæ°æ®åºçå®æ¹ææ¡£ã\n\nä¸é¢åä¸¾ä¸äºå¸¸è§æ°æ®ç±»åå¯¹æ¯ï¼\n\næ°æ®ç±»å                ORACLE             MYSQL         POSTGRESQL\nboolean             Byte               N/A           Boolean\ninteger             Number             Int Integer   Int Integer\nfloat               Number             Float         Numeric\ncurrency            N/A                N/A           Money\nstring (fixed)      Char               Char          Char\nstring (variable)   Varchar Varchar2   Varchar       Varchar\nbinary object       Long Raw           Blob Text     Binary Varbinary\n\n> æ°æ®ç±»åå¯¹æ¯è¡¨æèª SQL éç¨æ°æ®ç±»åãSQL ç¨äºåç§æ°æ®åºçæ°æ®ç±»å\n\n\n# SQL FAQ\n\n\n# SELECT COUNT(*)ãSELECT COUNT(1) å SELECT COUNT(å·ä½å­æ®µ) æ§è½æå·®å«åï¼\n\nå¨ MySQL InnoDB å­å¨å¼æä¸­ï¼COUNT(*) å COUNT(1) é½æ¯å¯¹ææç»æè¿è¡ COUNTãå æ­¤COUNT(*)åCOUNT(1)æ¬è´¨ä¸å¹¶æ²¡æåºå«ï¼æ§è¡çå¤æåº¦é½æ¯ O(N)ï¼ä¹å°±æ¯éç¨å¨è¡¨æ«æï¼è¿è¡å¾ªç¯ + è®¡æ°çæ¹å¼è¿è¡ç»è®¡ã\n\nå¦ææ¯ MySQL MyISAM å­å¨å¼æï¼ç»è®¡æ°æ®è¡¨çè¡æ°åªéè¦O(1)çå¤æåº¦ï¼è¿æ¯å ä¸ºæ¯å¼  MyISAM çæ°æ®è¡¨é½æä¸ä¸ª meta ä¿¡æ¯å­å¨äºrow_countå¼ï¼èä¸è´æ§åç±è¡¨çº§éæ¥ä¿è¯ãå ä¸º InnoDB æ¯æäºå¡ï¼éç¨è¡çº§éå MVCC æºå¶ï¼æä»¥æ æ³å MyISAM ä¸æ ·ï¼åªç»´æ¤ä¸ä¸ªrow_countåéï¼å æ­¤éè¦éç¨æ«æå¨è¡¨ï¼è¿è¡å¾ªç¯ + è®¡æ°çæ¹å¼æ¥å®æç»è®¡ã\n\néè¦æ³¨æçæ¯ï¼å¨å®éæ§è¡ä¸­ï¼COUNT(*)åCOUNT(1)çæ§è¡æ¶é´å¯è½ç¥æå·®å«ï¼ä¸è¿ä½ è¿æ¯å¯ä»¥æå®ä¿©çæ§è¡æççææ¯ç¸ç­çã\n\nå¦å¤å¨ InnoDB å¼æä¸­ï¼å¦æéç¨COUNT(*)åCOUNT(1)æ¥ç»è®¡æ°æ®è¡æ°ï¼è¦å°½ééç¨äºçº§ç´¢å¼ãå ä¸ºä¸»é®éç¨çç´¢å¼æ¯èç°ç´¢å¼ï¼èç°ç´¢å¼åå«çä¿¡æ¯å¤ï¼ææ¾ä¼å¤§äºäºçº§ç´¢å¼ï¼éèç°ç´¢å¼ï¼ãå¯¹äºCOUNT(*)åCOUNT(1)æ¥è¯´ï¼å®ä»¬ä¸éè¦æ¥æ¾å·ä½çè¡ï¼åªæ¯ç»è®¡è¡æ°ï¼ç³»ç»ä¼èªå¨éç¨å ç¨ç©ºé´æ´å°çäºçº§ç´¢å¼æ¥è¿è¡ç»è®¡ã\n\nç¶èå¦ææ³è¦æ¥æ¾å·ä½çè¡ï¼é£ä¹éç¨ä¸»é®ç´¢å¼çæçæ´é«ãå¦ææå¤ä¸ªäºçº§ç´¢å¼ï¼ä¼ä½¿ç¨ key_len å°çäºçº§ç´¢å¼è¿è¡æ«æãå½æ²¡æäºçº§ç´¢å¼çæ¶åï¼æä¼éç¨ä¸»é®ç´¢å¼æ¥è¿è¡ç»è®¡ã\n\nè¿éææ»ç»ä¸ä¸ï¼\n\n 1. ä¸è¬æåµä¸ï¼ä¸èæ§è¡çæçä¸º COUNT(*)= COUNT(1)> COUNT(å­æ®µ)ãæä»¬å°½éä½¿ç¨COUNT(*)ï¼å½ç¶å¦æä½ è¦ç»è®¡çæ¯æä¸ªå­æ®µçéç©ºæ°æ®è¡æ°ï¼åå¦å½å«è®ºï¼æ¯ç«æ¯è¾æ§è¡æççåææ¯ç»æä¸æ ·æå¯ä»¥ã\n 2. å¦æè¦ç»è®¡COUNT(*)ï¼å°½éå¨æ°æ®è¡¨ä¸å»ºç«äºçº§ç´¢å¼ï¼ç³»ç»ä¼èªå¨éç¨key_lenå°çäºçº§ç´¢å¼è¿è¡æ«æï¼è¿æ ·å½æä»¬ä½¿ç¨SELECT COUNT(*)çæ¶åæçå°±ä¼æåï¼ææ¶åå¯ä»¥æåå åçè³æ´é«ã\n\n> ââæèªæå®¢æ¶é´ - SQL å¿ç¥å¿ä¼\n\n\n# ORDER BY æ¯å¯¹åçç»æåºè¿æ¯å¯¹åç»ä¸­çè®°å½æåºå¢ï¼\n\nORDER BY å°±æ¯å¯¹è®°å½è¿è¡æåºãå¦æä½ å¨ ORDER BY åé¢ç¨å°äº GROUP BYï¼å®éä¸è¿æ¯ä¸ç§åç»çèåæ¹å¼ï¼å·²ç»æä¸ç»çæ°æ®èåæä¸ºäºä¸æ¡è®°å½ï¼åè¿è¡æåºçæ¶åï¼ç¸å½äºå¯¹åçç»è¿è¡äºæåºã\n\n\n# SELECT è¯­å¥åé¨çæ§è¡æ­¥éª¤\n\nä¸æ¡å®æ´ç SELECT è¯­å¥åé¨çæ§è¡é¡ºåºæ¯è¿æ ·çï¼\n\n 1. FROM å­å¥ç»è£æ°æ®ï¼åæ¬éè¿ ON è¿è¡è¿æ¥ï¼ï¼\n 2. WHERE å­å¥è¿è¡æ¡ä»¶ç­éï¼\n 3. GROUP BY åç» ï¼\n 4. ä½¿ç¨èéå½æ°è¿è¡è®¡ç®ï¼\n 5. HAVING ç­éåç»ï¼\n 6. è®¡ç®ææçè¡¨è¾¾å¼ï¼\n 7. SELECT çå­æ®µï¼\n 8. ORDER BY æåºï¼\n 9. LIMIT ç­éã\n\n> ââæèªæå®¢æ¶é´ - SQL å¿ç¥å¿ä¼\n\n\n# è§£åªç§æåµä¸åºè¯¥ä½¿ç¨ EXISTSï¼åªç§æåµåºè¯¥ç¨ IN\n\nç´¢å¼æ¯ä¸ªåæï¼å¶å®éæ©ä¸å¦è¿æ¯è¦çè¡¨çå¤§å°ãä½ å¯ä»¥å°éæ©çæ åçè§£ä¸ºå°è¡¨é©±å¨å¤§è¡¨ãå¨è¿ç§æ¹å¼ä¸æçæ¯æé«çã\n\næ¯å¦ä¸é¢è¿æ ·ï¼\n\n SELECT * FROM A WHERE cc IN (SELECT cc FROM B)\n SELECT * FROM A WHERE EXISTS (SELECT cc FROM B WHERE B.cc=A.cc)\n\n\nå½ A å°äº B æ¶ï¼ç¨ EXISTSãå ä¸º EXISTS çå®ç°ï¼ç¸å½äºå¤è¡¨å¾ªç¯ï¼å®ç°çé»è¾ç±»ä¼¼äºï¼\n\n for i in A\n     for j in B\n         if j.cc == i.cc then ...\n\n\nå½ B å°äº A æ¶ç¨ INï¼å ä¸ºå®ç°çé»è¾ç±»ä¼¼äºï¼\n\n for i in B\n     for j in A\n         if j.cc == i.cc then ...\n\n\nåªä¸ªè¡¨å°å°±ç¨åªä¸ªè¡¨æ¥é©±å¨ï¼A è¡¨å°å°±ç¨ EXISTSï¼B è¡¨å°å°±ç¨ INã\n\n> ââæèªæå®¢æ¶é´ - SQL å¿ç¥å¿ä¼\n\n\n# åèèµæ\n\n * æ°æ®åºé¢è¯é¢(å¼åèå¿ç)\n * æ°æ®åºç³»ç»åç\n * æ°æ®åºä¸¤å¤§ç¥å¨ãç´¢å¼åéã\n * ååºåè¡¨éè¦èèçé®é¢åæ¹æ¡\n * æ°æ®åºååºåè¡¨(sharding)ç³»å(äº) å¨å±ä¸»é®çæç­ç¥\n * ä¸ç§æ¯æèªç±è§åæ é¡»æ°æ®è¿ç§»åä¿®æ¹è·¯ç±ä»£ç ç Sharding æ©å®¹æ¹æ¡\n * ShardingSphere åå¸å¼äºå¡\n * mysql å oracle çåºå«\n * RUNOOB SQL æç¨\n * å¦ææäººé®ä½ æ°æ®åºçåçï¼å«ä»çè¿ç¯æç« ",normalizedContent:"# å³ç³»åæ°æ®åºé¢è¯\n\n\n# ç´¢å¼åçº¦æ\n\n\n# ä»ä¹æ¯ç´¢å¼\n\nç´¢å¼æ¯å¯¹æ°æ®åºè¡¨ä¸­ä¸æå¤ä¸ªåçå¼è¿è¡æåºçç»æï¼æ¯å¸®å©æ°æ®åºé«ææ¥è¯¢æ°æ®çæ°æ®ç»æã\n\n\n# ç´¢å¼çä¼ç¼ºç¹\n\nâ ç´¢å¼çä¼ç¹ï¼\n\n * ç´¢å¼å¤§å¤§åå°äºæå¡å¨éè¦æ«æçæ°æ®éï¼ä»èå å¿«æ£ç´¢éåº¦ã\n * æ¯æè¡çº§éçæ°æ®åºï¼å¦ innodb ä¼å¨è®¿é®è¡çæ¶åå éãä½¿ç¨ç´¢å¼å¯ä»¥åå°è®¿é®çè¡æ°ï¼ä»èåå°éçç«äºï¼æé«å¹¶åã\n * ç´¢å¼å¯ä»¥å¸®å©æå¡å¨é¿åæåºåä¸´æ¶è¡¨ã\n * ç´¢å¼å¯ä»¥å°éæº i/o åä¸ºé¡ºåº i/oã\n * å¯ä¸ç´¢å¼å¯ä»¥ç¡®ä¿æ¯ä¸è¡æ°æ®çå¯ä¸æ§ï¼éè¿ä½¿ç¨ç´¢å¼ï¼å¯ä»¥å¨æ¥è¯¢çè¿ç¨ä¸­ä½¿ç¨ä¼åéèå¨ï¼æé«ç³»ç»çæ§è½ã\n\nâ ç´¢å¼çç¼ºç¹ï¼\n\n * åå»ºåç»´æ¤ç´¢å¼è¦èè´¹æ¶é´ï¼è¿ä¼éçæ°æ®éçå¢å èå¢å ã\n * ç´¢å¼éè¦å ç¨é¢å¤çç©çç©ºé´ï¼é¤äºæ°æ®è¡¨å æ°æ®ç©ºé´ä¹å¤ï¼æ¯ä¸ä¸ªç´¢å¼è¿è¦å ä¸å®çç©çç©ºé´ï¼å¦æè¦å»ºç«ç»åç´¢å¼é£ä¹éè¦çç©ºé´å°±ä¼æ´å¤§ã\n * åæä½ï¼insert/update/deleteï¼æ¶å¾å¯è½éè¦æ´æ°ç´¢å¼ï¼å¯¼è´æ°æ®åºçåæä½æ§è½éä½ã\n\n\n# ä½æ¶ä½¿ç¨ç´¢å¼\n\nç´¢å¼è½å¤è½»æå°æ¥è¯¢æ§è½æåå ä¸ªæ°éçº§ã\n\nâ ä»ä¹æåµéç¨ç´¢å¼ï¼\n\n * è¡¨ç»å¸¸è¿è¡ select æä½ï¼\n * è¡¨çæ°æ®éæ¯è¾å¤§ï¼\n * ååç»å¸¸åºç°å¨ where æè¿æ¥ï¼joinï¼æ¡ä»¶ä¸­\n\nâ ä»ä¹æåµä¸éç¨ç´¢å¼ï¼\n\n * é¢ç¹åæä½ï¼ insert/update/delete ï¼- éè¦æ´æ°ç´¢å¼ç©ºé´ï¼\n * éå¸¸å°çè¡¨ - å¯¹äºéå¸¸å°çè¡¨ï¼å¤§é¨åæåµä¸ç®åçå¨è¡¨æ«ææ´é«æã\n * ååä¸ç»å¸¸åºç°å¨ where æè¿æ¥ï¼joinï¼æ¡ä»¶ä¸­ - ç´¢å¼å°±ä¼ç»å¸¸ä¸å½ä¸­ï¼æ²¡ææä¹ï¼è¿å¢å ç©ºé´å¼éã\n * å¯¹äºç¹å¤§åè¡¨ï¼å»ºç«åä½¿ç¨ç´¢å¼çä»£ä»·å°éä¹å¢é¿ãå¯ä»¥èèä½¿ç¨ååºææ¯æ nosqlã\n\n\n# ç´¢å¼çç±»å\n\nä¸»æµçå³ç³»åæ°æ®åºä¸è¬é½æ¯æä»¥ä¸ç´¢å¼ç±»åï¼\n\nä»é»è¾ç±»åä¸ååï¼å³ä¸è¬åå»ºè¡¨æ¶è®¾ç½®çç´¢å¼ç±»åï¼ï¼\n\n * å¯ä¸ç´¢å¼ï¼uniqueï¼ï¼ç´¢å¼åçå¼å¿é¡»å¯ä¸ï¼ä½åè®¸æç©ºå¼ãå¦ææ¯ç»åç´¢å¼ï¼ååå¼çç»åå¿é¡»å¯ä¸ã\n * ä¸»é®ç´¢å¼ï¼primaryï¼ï¼ä¸ç§ç¹æ®çå¯ä¸ç´¢å¼ï¼ä¸ä¸ªè¡¨åªè½æä¸ä¸ªä¸»é®ï¼ä¸åè®¸æç©ºå¼ãä¸è¬æ¯å¨å»ºè¡¨çæ¶ååæ¶åå»ºä¸»é®ç´¢å¼ã\n * æ®éç´¢å¼ï¼indexï¼ï¼æåºæ¬çç´¢å¼ï¼æ²¡æä»»ä½éå¶ã\n * ç»åç´¢å¼ï¼å¤ä¸ªå­æ®µä¸åå»ºçç´¢å¼ï¼åªæå¨æ¥è¯¢æ¡ä»¶ä¸­ä½¿ç¨äºåå»ºç´¢å¼æ¶çç¬¬ä¸ä¸ªå­æ®µï¼ç´¢å¼æä¼è¢«ä½¿ç¨ãä½¿ç¨ç»åç´¢å¼æ¶éµå¾ªæå·¦åç¼éåã\n\nä»ç©çå­å¨ä¸ååï¼\n\n * èéç´¢å¼(clustered)ï¼è¡¨ä¸­åè¡çç©çé¡ºåºä¸é®å¼çé»è¾ï¼ç´¢å¼ï¼é¡ºåºç¸åï¼æ¯ä¸ªè¡¨åªè½æä¸ä¸ªã\n * éèéç´¢å¼(non-clustered)ï¼éèéç´¢å¼æå®è¡¨çé»è¾é¡ºåºï¼ä¹å¯ä»¥è§ä¸ºäºçº§ç´¢å¼ãæ°æ®å­å¨å¨ä¸ä¸ªä½ç½®ï¼ç´¢å¼å­å¨å¨å¦ä¸ä¸ªä½ç½®ï¼ç´¢å¼ä¸­åå«æåæ°æ®å­å¨ä½ç½®çæéãå¯ä»¥æå¤ä¸ªï¼å°äº 249 ä¸ªã\n\n\n# ç´¢å¼çæ°æ®ç»æ\n\nä¸»æµæ°æ®åºçç´¢å¼ä¸è¬ä½¿ç¨çæ°æ®ç»æä¸ºï¼b æ ãb+ æ ã\n\n# b æ \n\nä¸æ£µ m é¶ç b-tree æ»¡è¶³ä»¥ä¸æ¡ä»¶ï¼\n\n * æ¯ä¸ªç»ç¹è³å¤æ m ä¸ªå­©å­ï¼\n * é¤æ ¹ç»ç¹åå¶ç»ç¹å¤ï¼å¶å®æ¯ä¸ªç»ç¹è³å°æ m/2 ä¸ªå­©å­ï¼\n * æ ¹ç»ç¹è³å°æä¸¤ä¸ªå­©å­ï¼é¤éè¯¥æ ä»åå«ä¸ä¸ªç»ç¹ï¼ï¼\n * ææå¶ç»ç¹å¨åä¸å±ï¼å¶ç»ç¹ä¸åå«ä»»ä½å³é®å­ä¿¡æ¯ï¼\n * æ k ä¸ªå³é®å­çéå¶ç»ç¹æ°å¥½åå« k+1 ä¸ªå­©å­ï¼\n\nå¯¹äºä»»æç»ç¹ï¼å¶åé¨çå³é®å­ key æ¯ååºæåçãæ¯ä¸ªèç¹ä¸­é½åå«äº dataã\n\n\n\nå¯¹äºæ¯ä¸ªç»ç¹ï¼ä¸»è¦åå«ä¸ä¸ªå³é®å­æ°ç» key[]ï¼ä¸ä¸ªæéæ°ç»ï¼æåå¿å­ï¼son[]ã\n\nå¨ b-tree åï¼æ¥æ¾çæµç¨æ¯ï¼\n\n 1. ä½¿ç¨é¡ºåºæ¥æ¾ï¼æ°ç»é¿åº¦è¾ç­æ¶ï¼ææåæ¥æ¾æ¹æ³æ¥æ¾ key[] æ°ç»ï¼è¥æ¾å°å³é®å­ kï¼åè¿åè¯¥ç»ç¹çå°åå k å¨ key[] ä¸­çä½ç½®ï¼\n 2. å¦åï¼å¯ç¡®å® k å¨æä¸ª key[i] å key[i+1] ä¹é´ï¼åä» son[i] ææçå­ç»ç¹ç»§ç»­æ¥æ¾ï¼ç´å°å¨æç»ç¹ä¸­æ¥æ¾æåï¼\n 3. æç´è³æ¾å°å¶ç»ç¹ä¸å¶ç»ç¹ä¸­çæ¥æ¾ä»ä¸æåæ¶ï¼æ¥æ¾è¿ç¨å¤±è´¥ã\n\n# b+ æ \n\nb+tree æ¯ b-tree çåç§ï¼\n\n * æ¯ä¸ªèç¹çæéä¸éä¸º 2d èä¸æ¯ 2d+1ï¼d ä¸ºèç¹çåºåº¦ï¼ã\n * éå¶å­èç¹ä¸å­å¨ dataï¼åªå­å¨ keyï¼å¶å­èç¹ä¸å­å¨æéã\n\n\n\nç±äºå¹¶ä¸æ¯ææèç¹é½å·æç¸åçåï¼å æ­¤ b+tree ä¸­å¶èç¹ååèç¹ä¸è¬å¤§å°ä¸åãè¿ç¹ä¸ b-tree ä¸åï¼è½ç¶ b-tree ä¸­ä¸åèç¹å­æ¾ç key åæéå¯è½æ°éä¸ä¸è´ï¼ä½æ¯æ¯ä¸ªèç¹çååä¸éæ¯ä¸è´çï¼æä»¥å¨å®ç°ä¸­ b-tree å¾å¾å¯¹æ¯ä¸ªèç¹ç³è¯·åç­å¤§å°çç©ºé´ã\n\nå¸¦æé¡ºåºè®¿é®æéç b+tree\n\nä¸è¬å¨æ°æ®åºç³»ç»ææä»¶ç³»ç»ä¸­ä½¿ç¨ç b+tree ç»æé½å¨ç»å¸ b+tree çåºç¡ä¸è¿è¡äºä¼åï¼å¢å äºé¡ºåºè®¿é®æéã\n\n\n\nå¨ b+tree çæ¯ä¸ªå¶å­èç¹å¢å ä¸ä¸ªæåç¸é»å¶å­èç¹çæéï¼å°±å½¢æäºå¸¦æé¡ºåºè®¿é®æéç b+treeã\n\nè¿ä¸ªä¼åçç®çæ¯ä¸ºäºæé«åºé´è®¿é®çæ§è½ï¼ä¾å¦ä¸å¾ä¸­å¦æè¦æ¥è¯¢ key ä¸ºä» 18 å° 49 çæææ°æ®è®°å½ï¼å½æ¾å° 18 åï¼åªéé¡ºçèç¹åæéé¡ºåºéåå°±å¯ä»¥ä¸æ¬¡æ§è®¿é®å°æææ°æ®èç¹ï¼æå¤§æå°äºåºé´æ¥è¯¢æçã\n\n# b æ  vs. b+ æ \n\n * b+ æ æ´éåå¤é¨å­å¨(ä¸è¬æç£çå­å¨)ï¼ç±äºåèç¹(éå¶å­èç¹)ä¸å­å¨ dataï¼æä»¥ä¸ä¸ªèç¹å¯ä»¥å­å¨æ´å¤çåèç¹ï¼æ¯ä¸ªèç¹è½ç´¢å¼çèå´æ´å¤§æ´ç²¾ç¡®ãä¹å°±æ¯è¯´ä½¿ç¨ b+ æ åæ¬¡ç£ç io çä¿¡æ¯éç¸æ¯è¾ b æ æ´å¤§ï¼io æçæ´é«ã\n * mysql æ¯å³ç³»åæ°æ®åºï¼ç»å¸¸ä¼æç§åºé´æ¥è®¿é®æä¸ªç´¢å¼åï¼b+ æ çå¶å­èç¹é´æé¡ºåºå»ºç«äºé¾æéï¼å å¼ºäºåºé´è®¿é®æ§ï¼æä»¥ b+ æ å¯¹ç´¢å¼åä¸çåºé´èå´æ¥è¯¢å¾åå¥½ãè b æ æ¯ä¸ªèç¹ç key å data å¨ä¸èµ·ï¼æ æ³è¿è¡åºé´æ¥æ¾ã\n\n# hash\n\n> hash ç´¢å¼åªæç²¾ç¡®å¹éç´¢å¼ææåçæ¥è¯¢æææã\n\nå¯¹äºæ¯ä¸è¡æ°æ®ï¼å¯¹ææçç´¢å¼åè®¡ç®ä¸ä¸ª hashcodeãåå¸ç´¢å¼å°ææç hashcode å­å¨å¨ç´¢å¼ä¸­ï¼åæ¶å¨ hash è¡¨ä¸­ä¿å­æåæ¯ä¸ªæ°æ®è¡çæéã\n\nåå¸ç»æç´¢å¼çä¼ç¹ï¼\n\n * å ä¸ºç´¢å¼æ°æ®ç»æç´§åï¼æä»¥æ¥è¯¢éåº¦éå¸¸å¿«ã\n\nåå¸ç»æç´¢å¼çç¼ºç¹ï¼\n\n * åå¸ç´¢å¼æ°æ®ä¸æ¯æç§ç´¢å¼å¼é¡ºåºå­å¨çï¼æä»¥æ æ³ç¨äºæåºã\n * åå¸ç´¢å¼ä¸æ¯æé¨åç´¢å¼å¹éæ¥æ¾ãå¦ï¼å¨æ°æ®å (a,b) ä¸å»ºç«åå¸ç´¢å¼ï¼å¦ææ¥è¯¢åªææ°æ®å aï¼æ æ³ä½¿ç¨è¯¥ç´¢å¼ã\n * åå¸ç´¢å¼åªæ¯æç­å¼æ¯è¾æ¥è¯¢ï¼ä¸æ¯æä»»ä½èå´æ¥è¯¢ï¼å¦ where price > 100ã\n * åå¸ç´¢å¼æå¯è½åºç°åå¸å²çªï¼åºç°åå¸å²çªæ¶ï¼å¿é¡»éåé¾è¡¨ä¸­ææçè¡æéï¼éè¡æ¯è¾ï¼ç´å°æ¾å°ç¬¦åæ¡ä»¶çè¡ã\n\n\n# ç´¢å¼ç­ç¥\n\n# ç´¢å¼åºæ¬åå\n\n * ç´¢å¼ä¸æ¯è¶å¤è¶å¥½ï¼ä¸è¦ä¸ºææåé½åå»ºç´¢å¼ã\n * è¦å°½éé¿ååä½åéå¤ç´¢å¼ï¼\n * è¦èèå é¤æªä½¿ç¨çç´¢å¼ï¼\n * å°½éçæ©å±ç´¢å¼ï¼ä¸è¦æ°å»ºç´¢å¼ï¼\n * é¢ç¹ä½ä¸º where è¿æ»¤æ¡ä»¶çååºè¯¥èèæ·»å ç´¢å¼\n\n# ç¬ç«çå\n\nå¦ææ¥è¯¢ä¸­çåä¸æ¯ç¬ç«çåï¼åæ°æ®åºä¸ä¼ä½¿ç¨ç´¢å¼ã\n\nâç¬ç«çåâ æ¯æç´¢å¼åä¸è½æ¯è¡¨è¾¾å¼çä¸é¨åï¼ä¹ä¸è½æ¯å½æ°çåæ°ã\n\nâ éè¯¯ç¤ºä¾ï¼\n\nselect actor_id from actor where actor_id + 1 = 5;\nselect ... where to_days(current_date) - to_days(date_col) <= 10;\n\n\n# åç¼ç´¢å¼åç´¢å¼éæ©æ§\n\nææ¶åéè¦ç´¢å¼å¾é¿çå­ç¬¦åï¼è¿ä¼è®©ç´¢å¼åå¾å¤§ä¸æ¢ã\n\nè§£å³æ¹æ³æ¯ï¼å¯ä»¥ç´¢å¼å¼å§çé¨åå­ç¬¦ï¼è¿æ ·å¯ä»¥å¤§å¤§èçº¦ç´¢å¼ç©ºé´ï¼ä»èæé«ç´¢å¼æçãä½è¿æ ·ä¹ä¼éä½ç´¢å¼çéæ©æ§ã\n\nç´¢å¼çéæ©æ§æ¯æï¼ä¸éå¤çç´¢å¼å¼åæ°æ®è¡¨è®°å½æ»æ°çæ¯å¼ãæå¤§å¼ä¸º 1ï¼æ­¤æ¶æ¯ä¸ªè®°å½é½æå¯ä¸çç´¢å¼ä¸å¶å¯¹åºãéæ©æ§è¶é«ï¼æ¥è¯¢æçä¹è¶é«ã\n\nå¯¹äº blob/text/varchar è¿ç§ææ¬ç±»åçåï¼å¿é¡»ä½¿ç¨åç¼ç´¢å¼ï¼å ä¸ºæ°æ®åºå¾å¾ä¸åè®¸ç´¢å¼è¿äºåçå®æ´é¿åº¦ã\n\nè¦éæ©è¶³å¤é¿çåç¼ä»¥ä¿è¯è¾é«çéæ©æ§ï¼åæ¶åä¸è½å¤ªé¿ï¼èçº¦ç©ºé´ï¼ã\n\nâ ä½æç¤ºä¾ï¼\n\nselect count(*) as cnt, city from sakila.city_demo\ngroup by city order by cnt desc limit 10;\n\n\nâ é«æç¤ºä¾ï¼\n\nselect count(*) as cnt, left(city, 3) as pref from sakila.city_demo\ngroup by city order by cnt desc limit 10;\n\n\n# å¤åç´¢å¼\n\nä¸è¦ä¸ºæ¯ä¸ªåé½åå»ºç¬ç«ç´¢å¼ã\n\nå°éæ©æ§é«çåæåºæ°å¤§çåä¼åæå¨å¤åç´¢å¼æååãä½ææ¶ï¼ä¹éè¦èè where å­å¥ä¸­çæåºãåç»åèå´æ¡ä»¶ç­å ç´ ï¼è¿äºå ç´ ä¹ä¼å¯¹æ¥è¯¢æ§è½é æè¾å¤§å½±åã\n\nä¸¾ä¾æ¥è¯´ï¼æä¸å¼  user è¡¨ï¼å¶ä¸­å« name, sex, age ä¸ä¸ªåï¼å¦æå°è¿ä¸èç»åä¸ºå¤åç´¢å¼ï¼åºè¯¥ç¨ä»ä¹æ ·çé¡ºåºå¢ï¼ä»éæ©æ§é«çè§åº¦æ¥çï¼name > age > sexã\n\n# èç°ç´¢å¼\n\nèç°ç´¢å¼ä¸æ¯ä¸ç§åç¬çç´¢å¼ç±»åï¼èæ¯ä¸ç§æ°æ®å­å¨æ¹å¼ãå·ä½ç»èä¾èµäºå®ç°æ¹å¼ãå¦ innodb çèç°ç´¢å¼å®éæ¯å¨åä¸ä¸ªç»æä¸­ä¿å­äº b æ çç´¢å¼åæ°æ®è¡ã\n\nèç°è¡¨ç¤ºæ°æ®è¡åç¸é»çé®å¼ç´§åå°å­å¨å¨ä¸èµ·ï¼å ä¸ºæ°æ®ç´§åï¼æä»¥è®¿é®å¿«ãå ä¸ºæ æ³åæ¶ææ°æ®è¡å­æ¾å¨ä¸¤ä¸ªä¸åçå°æ¹ï¼æä»¥ä¸ä¸ªè¡¨åªè½æä¸ä¸ªèç°ç´¢å¼ã\n\nè¥æ²¡æå®ä¹ä¸»é®ï¼innodb ä¼éå¼å®ä¹ä¸ä¸ªä¸»é®æ¥ä½ä¸ºèç°ç´¢å¼ã\n\n# è¦çç´¢å¼\n\nç´¢å¼åå«ææéè¦æ¥è¯¢çå­æ®µçå¼ã\n\nå·æä»¥ä¸ä¼ç¹ï¼\n\n * å ä¸ºç´¢å¼æ¡ç®éå¸¸è¿å°äºæ°æ®è¡çå¤§å°ï¼æä»¥è¥åªè¯»åç´¢å¼ï¼è½å¤§å¤§åå°æ°æ®è®¿é®éã\n * ä¸äºå­å¨å¼æï¼ä¾å¦ myisamï¼å¨åå­ä¸­åªç¼å­ç´¢å¼ï¼èæ°æ®ä¾èµäºæä½ç³»ç»æ¥ç¼å­ãå æ­¤ï¼åªè®¿é®ç´¢å¼å¯ä»¥ä¸ä½¿ç¨ç³»ç»è°ç¨ï¼éå¸¸æ¯è¾è´¹æ¶ï¼ã\n * å¯¹äº innodb å¼æï¼è¥è¾å©ç´¢å¼è½å¤è¦çæ¥è¯¢ï¼åæ éè®¿é®ä¸»ç´¢å¼ã\n\n# ä½¿ç¨ç´¢å¼æ«ææ¥åæåº\n\nmysql æä¸¤ç§æ¹å¼å¯ä»¥çææåºç»æï¼éè¿æåºæä½ï¼æèæç´¢å¼é¡ºåºæ«æã\n\nç´¢å¼æå¥½æ¢æ»¡è¶³æåºï¼åç¨äºæ¥æ¾è¡ãè¿æ ·ï¼å°±å¯ä»¥ä½¿ç¨ç´¢å¼æ¥å¯¹ç»ææåºã\n\n# æå·¦åç¼å¹éåå\n\nmysql ä¼ä¸ç´åå³å¹éç´å°éå°èå´æ¥è¯¢ (>,<,between,like) å°±åæ­¢å¹éã\n\n * ç´¢å¼å¯ä»¥ç®åå¦ä¸ä¸ªå(a)ï¼ä¹å¯ä»¥å¤æå¦å¤ä¸ªå(a, b, c, d)ï¼å³èåç´¢å¼ã\n * å¦ææ¯èåç´¢å¼ï¼é£ä¹ key ä¹ç±å¤ä¸ªåç»æï¼åæ¶ï¼ç´¢å¼åªè½ç¨äºæ¥æ¾ key æ¯å¦å­å¨ï¼ç¸ç­ï¼ï¼éå°èå´æ¥è¯¢(>ã<ãbetweenãlike å·¦å¹é)ç­å°±ä¸è½è¿ä¸æ­¥å¹éäºï¼åç»­éåä¸ºçº¿æ§æ¥æ¾ã\n * å æ­¤ï¼åçæåé¡ºåºå³å®äºå¯å½ä¸­ç´¢å¼çåæ°ã\n\nä¾å­ï¼\n\n * å¦æç´¢å¼(a, b, c, d)ï¼æ¥è¯¢æ¡ä»¶ a = 1 and b = 2 and c > 3 and d = 4ï¼åä¼å¨æ¯ä¸ªèç¹ä¾æ¬¡å½ä¸­ aãbãcï¼æ æ³å½ä¸­ dã(å¾ç®åï¼ç´¢å¼å½ä¸­åªè½æ¯ç¸ç­çæåµï¼ä¸è½æ¯èå´å¹é)\n\n# = å in å¯ä»¥ä¹±åº\n\nä¸éè¦èè=ãin ç­çé¡ºåºï¼mysql ä¼èªå¨ä¼åè¿äºæ¡ä»¶çé¡ºåºï¼ä»¥å¹éå°½å¯è½å¤çç´¢å¼åã\n\nä¾å­ï¼å¦æç´¢å¼(a, b, c, d)ï¼æ¥è¯¢æ¡ä»¶ c > 3 and b = 2 and a = 1 and d < 4 ä¸ a = 1 and c > 3 and b = 2 and d < 4 ç­é¡ºåºé½æ¯å¯ä»¥çï¼mysql ä¼èªå¨ä¼åä¸º a = 1 and b = 2 and c > 3 and d < 4ï¼ä¾æ¬¡å½ä¸­ aãbãcã\n\n\n# çº¦æ\n\næ°æ®åºçº¦æï¼constraintï¼æåªäºï¼\n\n * not null - ç¨äºæ§å¶å­æ®µçåå®¹ä¸å®ä¸è½ä¸ºç©ºï¼nullï¼ã\n * unique - å­æ®µåå®¹ä¸è½éå¤ï¼ä¸ä¸ªè¡¨åè®¸æå¤ä¸ª unique çº¦æã\n * primary key - æ°æ®è¡¨ä¸­å¯¹å¨å­æ°æ®å¯¹è±¡äºä»¥å¯ä¸åå®æ´æ è¯çæ°æ®åæå±æ§çç»åï¼å®å¨ä¸ä¸ªè¡¨ä¸­åªåè®¸æä¸ä¸ªãä¸»é®çåå¼ä¸è½ä¸ºç©ºå¼ï¼nullï¼ã\n * foreign key - å¨ä¸ä¸ªè¡¨ä¸­å­å¨çå¦ä¸ä¸ªè¡¨çä¸»é®ç§°æ­¤è¡¨çå¤é®ãç¨äºé¢é²ç ´åè¡¨ä¹é´è¿æ¥çå¨ä½ï¼ä¹è½é²æ­¢éæ³æ°æ®æå¥å¤é®åï¼å ä¸ºå®å¿é¡»æ¯å®æåçé£ä¸ªè¡¨ä¸­çå¼ä¹ä¸ã\n * check - ç¨äºæ§å¶å­æ®µçå¼èå´ã\n\n\n# å¹¶åæ§å¶\n\n\n# ä¹è§éåæ²è§é\n\n>  * æ°æ®åºçä¹è§éåæ²è§éæ¯ä»ä¹ï¼\n>  * æ°æ®åºçä¹è§éåæ²è§éå¦ä½å®ç°ï¼\n\nç¡®ä¿å¨å¤ä¸ªäºå¡åæ¶å­åæ°æ®åºä¸­åä¸æ°æ®æ¶ä¸ç ´åäºå¡çéç¦»æ§åç»ä¸æ§ä»¥åæ°æ®åºçç»ä¸æ§ï¼ä¹è§éåæ²è§éæ¯å¹¶åæ§å¶ä¸»è¦éç¨çææ¯ææ®µã\n\n * æ²è§é - åå®ä¼åçå¹¶åå²çªï¼å±è½ä¸åå¯è½è¿åæ°æ®å®æ´æ§çæä½\n   * å¨æ¥è¯¢å®æ°æ®çæ¶åå°±æäºå¡éèµ·æ¥ï¼ç´å°æäº¤äºå¡ï¼commitï¼\n   * å®ç°æ¹å¼ï¼ä½¿ç¨æ°æ®åºä¸­çéæºå¶\n * ä¹è§é - åè®¾ä¸ä¼åçå¹¶åå²çªï¼åªå¨æäº¤æä½æ¶æ£æ¥æ¯å¦è¿åæ°æ®å®æ´æ§ã\n   * å¨ä¿®æ¹æ°æ®çæ¶åæäºå¡éèµ·æ¥ï¼éè¿ version çæ¹å¼æ¥è¿è¡éå®\n   * å®ç°æ¹å¼ï¼ä½¿ç¨ version çæ¬æèæ¶é´æ³\n\n\n# è¡çº§éåè¡¨çº§é\n\n>  * ä»ä¹æ¯è¡çº§éåè¡¨çº§éï¼\n>  * ä»ä¹æ¶åç¨è¡çº§éï¼ä»ä¹æ¶åç¨è¡¨çº§éï¼\n\nä»æ°æ®åºçéç²åº¦æ¥çï¼mysql ä¸­æä¾äºä¸¤ç§å°éç²åº¦ï¼è¡çº§éåè¡¨çº§éã\n\n * è¡¨çº§éï¼table lockï¼ - éå®æ´å¼ è¡¨ãç¨æ·å¯¹è¡¨è¿è¡åæä½åï¼éè¦åè·å¾åéï¼è¿ä¼é»å¡å¶ä»ç¨æ·å¯¹è¯¥è¡¨çææè¯»åæä½ãåªææ²¡æåéæ¶ï¼å¶ä»ç¨æ·æè½è·å¾è¯»éï¼è¯»éä¹é´ä¸ä¼ç¸äºé»å¡ã\n * è¡çº§éï¼row lockï¼ - ä»å¯¹æå®çè¡è®°å½è¿è¡å éï¼è¿æ ·å¶å®è¿ç¨è¿æ¯å¯ä»¥å¯¹åä¸ä¸ªè¡¨ä¸­çå¶å®è®°å½è¿è¡æä½ã\n\näºèéè¦æè¡¡ï¼\n\n * éå®çæ°æ®éè¶å°ï¼éç«äºçåçé¢çå°±è¶å°ï¼ç³»ç»çå¹¶åç¨åº¦å°±è¶é«ã\n * éç²åº¦è¶å°ï¼ç³»ç»å¼éå°±è¶å¤§ã\n\nå¨ innodb ä¸­ï¼è¡éæ¯éè¿ç»ç´¢å¼ä¸çç´¢å¼é¡¹å éæ¥å®ç°çãå¦ææ²¡æç´¢å¼ï¼innodb å°ä¼éè¿éèçèç°ç´¢å¼æ¥å¯¹è®°å½å éã\n\n\n# è¯»åé\n\n>  * ä»ä¹æ¯è¯»åéï¼\n\n * ç¬äº«éï¼exclusiveï¼ï¼ç®åä¸º x éï¼åç§°åéãä½¿ç¨æ¹å¼ï¼select ... for update;\n * å±äº«éï¼sharedï¼ï¼ç®åä¸º s éï¼åç§°è¯»éãä½¿ç¨æ¹å¼ï¼select ... lock in share mode;\n\nåéåè¯»éçå³ç³»ï¼ç®è¨ä¹ï¼ç¬äº«éå­å¨ï¼å¶ä»äºå¡å°±ä¸è½åä»»ä½æä½ã\n\ninnodb ä¸çè¡éãé´ééãnext-key éç»ç»å±äºç¬äº«éã\n\n\n# æåé\n\n>  * ä»ä¹æ¯æåéï¼\n>  * æåéæä»ä¹ç¨ï¼\n\næåéçä½ç¨æ¯ï¼å½å­å¨è¡¨çº§éåè¡çº§éçæåµä¸ï¼å¿é¡»åç³è¯·æåéï¼è¡¨çº§éï¼ä½ä¸æ¯ççå éï¼ï¼åè·åè¡çº§éãä½¿ç¨æåéï¼intention locksï¼å¯ä»¥æ´å®¹æå°æ¯æå¤ç²åº¦å°éã\n\næåéæ¯ innodb èªå¨å çï¼ä¸éè¦ç¨æ·å¹²é¢ã\n\n\n# mvcc\n\n> ä»ä¹æ¯ mvccï¼\n> \n> mvcc æä»ä¹ç¨ï¼è§£å³äºä»ä¹é®é¢ï¼\n> \n> mvcc çåçæ¯ä»ä¹ï¼\n\nå¤çæ¬å¹¶åæ§å¶ï¼multi-version concurrency control, mvccï¼æ¯ innodb å­å¨å¼æå®ç°éç¦»çº§å«çä¸ç§å·ä½æ¹å¼ï¼ç¨äºå®ç°æäº¤è¯»åå¯éå¤è¯»è¿ä¸¤ç§éç¦»çº§å«ãèæªæäº¤è¯»éç¦»çº§å«æ»æ¯è¯»åææ°çæ°æ®è¡ï¼è¦æ±å¾ä½ï¼æ éä½¿ç¨ mvccãå¯ä¸²è¡åéç¦»çº§å«éè¦å¯¹ææè¯»åçè¡é½å éï¼åçº¯ä½¿ç¨ mvcc æ æ³å®ç°ã\n\nmvcc çææ³æ¯ï¼\n\n * ä¿å­æ°æ®å¨æä¸ªæ¶é´ç¹çå¿«ç§ãåæä½ï¼deleteãinsertãupdateï¼æ´æ°ææ°ççæ¬å¿«ç§ï¼èè¯»æä½å»è¯»æ§çæ¬å¿«ç§ï¼æ²¡æäºæ¥å³ç³»ï¼è¿ä¸ç¹å copyonwrite ç±»ä¼¼ã\n * èè¯»åä¸å¯éå¤è¯»ææ ¹æ¬çåå æ¯äºå¡è¯»åå°å¶å®äºå¡æªæäº¤çä¿®æ¹ãå¨äºå¡è¿è¡è¯»åæä½æ¶ï¼ä¸ºäºè§£å³èè¯»åä¸å¯éå¤è¯»é®é¢ï¼mvcc è§å®åªè½è¯»åå·²ç»æäº¤çå¿«ç§ãå½ç¶ä¸ä¸ªäºå¡å¯ä»¥è¯»åèªèº«æªæäº¤çå¿«ç§ï¼è¿ä¸ç®æ¯èè¯»ã\n\n\n# next-key é\n\nnext-key éæ¯ mysql ç innodb å­å¨å¼æçä¸ç§éå®ç°ã\n\nmvcc ä¸è½è§£å³å¹»è¯»é®é¢ï¼next-key éå°±æ¯ä¸ºäºè§£å³å¹»è¯»é®é¢ãå¨å¯éå¤è¯»ï¼repeatable readï¼éç¦»çº§å«ä¸ï¼ä½¿ç¨ mvcc + next-key é å¯ä»¥è§£å³å¹»è¯»é®é¢ã\n\nå¦å¤ï¼æ ¹æ®éå¯¹ sql è¯­å¥æ£ç´¢æ¡ä»¶çä¸åï¼å éåæä»¥ä¸ä¸ç§æå½¢éè¦æä»¬ææ¡ã\n\n * record lock - è¡éå¯¹ç´¢å¼é¡¹å éï¼è¥æ²¡æç´¢å¼åä½¿ç¨è¡¨éã\n * gap lock - å¯¹ç´¢å¼é¡¹ä¹é´çé´éå éãéå®ç´¢å¼ä¹é´çé´éï¼ä½æ¯ä¸åå«ç´¢å¼æ¬èº«ãä¾å¦å½ä¸ä¸ªäºå¡æ§è¡ä»¥ä¸è¯­å¥ï¼å¶å®äºå¡å°±ä¸è½å¨ t.c ä¸­æå¥ 15ãselect c from t where c between 10 and 20 for update;\n * next-key lock -å®æ¯ record lock å gap lock çç»åï¼ä¸ä»éå®ä¸ä¸ªè®°å½ä¸çç´¢å¼ï¼ä¹éå®ç´¢å¼ä¹é´çé´éãå®éå®ä¸ä¸ªåå¼åé­åºé´ã\n\nç´¢å¼åä¸ºä¸»é®ç´¢å¼åéä¸»é®ç´¢å¼ä¸¤ç§ï¼å¦æä¸æ¡ sql è¯­å¥æä½äºä¸»é®ç´¢å¼ï¼mysql å°±ä¼éå®è¿æ¡ä¸»é®ç´¢å¼ï¼å¦æä¸æ¡è¯­å¥æä½äºéä¸»é®ç´¢å¼ï¼mysql ä¼åéå®è¯¥éä¸»é®ç´¢å¼ï¼åéå®ç¸å³çä¸»é®ç´¢å¼ãå¨ updateãdelete æä½æ¶ï¼mysql ä¸ä»éå® where æ¡ä»¶æ«æè¿çææç´¢å¼è®°å½ï¼èä¸ä¼éå®ç¸é»çé®å¼ï¼å³æè°ç next-key lockã\n\nå½ä¸¤ä¸ªäºå¡åæ¶æ§è¡ï¼ä¸ä¸ªéä½äºä¸»é®ç´¢å¼ï¼å¨ç­å¾å¶ä»ç¸å³ç´¢å¼ãå¦ä¸ä¸ªéå®äºéä¸»é®ç´¢å¼ï¼å¨ç­å¾ä¸»é®ç´¢å¼ãè¿æ ·å°±ä¼åçæ­»éãåçæ­»éåï¼innodb ä¸è¬é½å¯ä»¥æ£æµå°ï¼å¹¶ä½¿ä¸ä¸ªäºå¡éæ¾éåéï¼å¦ä¸ä¸ªè·åéå®æäºå¡ã\n\n\n# äºå¡\n\n> äºå¡ç®åæ¥è¯´ï¼ä¸ä¸ª session ä¸­æè¿è¡ææçæä½ï¼è¦ä¹åæ¶æåï¼è¦ä¹åæ¶å¤±è´¥ãå·ä½æ¥è¯´ï¼äºå¡æçæ¯æ»¡è¶³ acid ç¹æ§çä¸ç»æä½ï¼å¯ä»¥éè¿ commit æäº¤ä¸ä¸ªäºå¡ï¼ä¹å¯ä»¥ä½¿ç¨ rollback è¿è¡åæ»ã\n\n\n\n\n# acid\n\nacid â æ°æ®åºäºå¡æ­£ç¡®æ§è¡çåä¸ªåºæ¬è¦ç´ ï¼\n\n * åå­æ§ï¼atomicityï¼\n * ä¸è´æ§ï¼consistencyï¼\n * éç¦»æ§ï¼isolationï¼\n * æä¹æ§ï¼durabilityï¼\n\nä¸ä¸ªæ¯æäºå¡ï¼transactionï¼ä¸­çæ°æ®åºç³»ç»ï¼å¿éè¦å·æè¿åç§ç¹æ§ï¼å¦åå¨äºå¡è¿ç¨ï¼transaction processingï¼å½ä¸­æ æ³ä¿è¯æ°æ®çæ­£ç¡®æ§ï¼äº¤æè¿ç¨æå¯è½è¾¾ä¸å°äº¤æã\n\n\n\n\n# å¹¶åä¸è´æ§é®é¢\n\nå¨å¹¶åç¯å¢ä¸ï¼äºå¡çéç¦»æ§å¾é¾ä¿è¯ï¼å æ­¤ä¼åºç°å¾å¤å¹¶åä¸è´æ§é®é¢ã\n\n * ä¸¢å¤±ä¿®æ¹\n\nt1 å t2 ä¸¤ä¸ªäºå¡é½å¯¹ä¸ä¸ªæ°æ®è¿è¡ä¿®æ¹ï¼t1 åä¿®æ¹ï¼t2 éåä¿®æ¹ï¼t2 çä¿®æ¹è¦çäº t1 çä¿®æ¹ã\n\n\n\n * èè¯»\n\nt1 ä¿®æ¹ä¸ä¸ªæ°æ®ï¼t2 éåè¯»åè¿ä¸ªæ°æ®ãå¦æ t1 æ¤éäºè¿æ¬¡ä¿®æ¹ï¼é£ä¹ t2 è¯»åçæ°æ®æ¯èæ°æ®ã\n\n\n\n * ä¸å¯éå¤è¯»\n\nt2 è¯»åä¸ä¸ªæ°æ®ï¼t1 å¯¹è¯¥æ°æ®åäºä¿®æ¹ãå¦æ t2 åæ¬¡è¯»åè¿ä¸ªæ°æ®ï¼æ­¤æ¶è¯»åçç»æåç¬¬ä¸æ¬¡è¯»åçç»æä¸åã\n\n\n\n * å¹»è¯»\n\nt1 è¯»åæä¸ªèå´çæ°æ®ï¼t2 å¨è¿ä¸ªèå´åæå¥æ°çæ°æ®ï¼t1 åæ¬¡è¯»åè¿ä¸ªèå´çæ°æ®ï¼æ­¤æ¶è¯»åçç»æååç¬¬ä¸æ¬¡è¯»åçç»æä¸åã\n\n\n\nå¹¶åä¸è´æ§è§£å³æ¹æ¡ï¼\n\näº§çå¹¶åä¸ä¸è´æ§é®é¢ä¸»è¦åå æ¯ç ´åäºäºå¡çéç¦»æ§ï¼è§£å³æ¹æ³æ¯éè¿å¹¶åæ§å¶æ¥ä¿è¯éç¦»æ§ã\n\nå¹¶åæ§å¶å¯ä»¥éè¿å°éæ¥å®ç°ï¼ä½æ¯å°éæä½éè¦ç¨æ·èªå·±æ§å¶ï¼ç¸å½å¤æãæ°æ®åºç®¡çç³»ç»æä¾äºäºå¡çéç¦»çº§å«ï¼è®©ç¨æ·ä»¥ä¸ç§æ´è½»æ¾çæ¹å¼å¤çå¹¶åä¸è´æ§é®é¢ã\n\n\n# äºå¡éç¦»\n\næ°æ®åºéç¦»çº§å«ï¼\n\n * æªæäº¤è¯»ï¼read uncommittedï¼ - äºå¡ä¸­çä¿®æ¹ï¼å³ä½¿æ²¡ææäº¤ï¼å¯¹å¶å®äºå¡ä¹æ¯å¯è§çã\n * æäº¤è¯»ï¼read committedï¼ - ä¸ä¸ªäºå¡åªè½è¯»åå·²ç»æäº¤çäºå¡æåçä¿®æ¹ãæ¢å¥è¯è¯´ï¼ä¸ä¸ªäºå¡æåçä¿®æ¹å¨æäº¤ä¹åå¯¹å¶å®äºå¡æ¯ä¸å¯è§çã\n * éå¤è¯»ï¼repeatable readï¼ - ä¿è¯å¨åä¸ä¸ªäºå¡ä¸­å¤æ¬¡è¯»ååæ ·æ°æ®çç»ææ¯ä¸æ ·çã\n * ä¸²è¡åï¼serialixableï¼ - å¼ºå¶äºå¡ä¸²è¡æ§è¡ã\n\næ°æ®åºéç¦»çº§å«è§£å³çé®é¢ï¼\n\néç¦»çº§å«   èè¯»   ä¸å¯éå¤è¯»   å¹»è¯»\næªæäº¤è¯»   â    â       â\næäº¤è¯»    âï¸   â       â\nå¯éå¤è¯»   âï¸   âï¸      â\nå¯ä¸²è¡å   âï¸   âï¸      âï¸\n\n\n# åå¸å¼äºå¡\n\nå¨åä¸æ°æ®èç¹ä¸­ï¼äºå¡ä»éäºå¯¹åä¸æ°æ®åºèµæºçè®¿é®æ§å¶ï¼ç§°ä¹ä¸º æ¬å°äºå¡ãå ä¹ææçæççå³ç³»åæ°æ®åºé½æä¾äºå¯¹æ¬å°äºå¡çåçæ¯æã\n\nåå¸å¼äºå¡ æ¯æäºå¡çåä¸èãæ¯æäºå¡çæå¡å¨ãèµæºæå¡å¨ä»¥åäºå¡ç®¡çå¨åå«ä½äºä¸åçåå¸å¼ç³»ç»çä¸åèç¹ä¹ä¸ã\n\n# ä¸¤é¶æ®µæäº¤\n\nä¸¤é¶æ®µæäº¤ï¼xaï¼å¯¹ä¸å¡ä¾µå¥å¾å°ã å®æå¤§çä¼å¿å°±æ¯å¯¹ä½¿ç¨æ¹éæï¼ç¨æ·å¯ä»¥åä½¿ç¨æ¬å°äºå¡ä¸æ ·ä½¿ç¨åºäº xa åè®®çåå¸å¼äºå¡ã xa åè®®è½å¤ä¸¥æ ¼ä¿éäºå¡ acid ç¹æ§ã\n\nä¸¥æ ¼ä¿éäºå¡ acid ç¹æ§æ¯ä¸æåååã äºå¡æ§è¡å¨è¿ç¨ä¸­éè¦å°æéèµæºå¨é¨éå®ï¼å®æ´å éç¨äºæ§è¡æ¶é´ç¡®å®çç­äºå¡ã å¯¹äºé¿äºå¡æ¥è¯´ï¼æ´ä¸ªäºå¡è¿è¡æé´å¯¹æ°æ®çç¬å ï¼å°å¯¼è´å¯¹ç­ç¹æ°æ®ä¾èµçä¸å¡ç³»ç»å¹¶åæ§è½è¡°éææ¾ã å æ­¤ï¼å¨é«å¹¶åçæ§è½è³ä¸åºæ¯ä¸­ï¼åºäº xa åè®®çåå¸å¼äºå¡å¹¶ä¸æ¯æä½³éæ©ã\n\n# ææ§äºå¡\n\nå¦æå°å®ç°äºacid çäºå¡è¦ç´ çäºå¡ç§°ä¸ºåæ§äºå¡çè¯ï¼é£ä¹åºäºbaseäºå¡è¦ç´ çäºå¡åç§°ä¸ºææ§äºå¡ã baseæ¯åºæ¬å¯ç¨ãææ§ç¶æåæç»ä¸è´æ§è¿ä¸ä¸ªè¦ç´ çç¼©åã\n\n * åºæ¬å¯ç¨ï¼basically availableï¼ä¿è¯åå¸å¼äºå¡åä¸æ¹ä¸ä¸å®åæ¶å¨çº¿ã\n * ææ§ç¶æï¼soft stateï¼ååè®¸ç³»ç»ç¶ææ´æ°æä¸å®çå»¶æ¶ï¼è¿ä¸ªå»¶æ¶å¯¹å®¢æ·æ¥è¯´ä¸ä¸å®è½å¤å¯è§ã\n * èæç»ä¸è´æ§ï¼eventually consistentï¼éå¸¸æ¯éè¿æ¶æ¯ä¼ éçæ¹å¼ä¿è¯ç³»ç»çæç»ä¸è´æ§ã\n\nå¨acidäºå¡ä¸­å¯¹éç¦»æ§çè¦æ±å¾é«ï¼å¨äºå¡æ§è¡è¿ç¨ä¸­ï¼å¿é¡»å°ææçèµæºéå®ã ææ§äºå¡ççå¿µåæ¯éè¿ä¸å¡é»è¾å°äºæ¥éæä½ä»èµæºå±é¢ä¸ç§»è³ä¸å¡å±é¢ãéè¿æ¾å®½å¯¹å¼ºä¸è´æ§è¦æ±ï¼æ¥æ¢åç³»ç»ååéçæåã\n\nåºäºacidçå¼ºä¸è´æ§äºå¡ååºäºbaseçæç»ä¸è´æ§äºå¡é½ä¸æ¯é¶å¼¹ï¼åªæå¨æéåçåºæ¯ä¸­æè½åæ¥å®ä»¬çæå¤§é¿å¤ã å¯éè¿ä¸è¡¨è¯¦ç»å¯¹æ¯å®ä»¬ä¹é´çåºå«ï¼ä»¥å¸®å©å¼åèè¿è¡ææ¯éåã\n\n# äºå¡æ¹æ¡å¯¹æ¯\n\n       æ¬å°äºå¡       ä¸¤ï¼ä¸ï¼é¶æ®µäºå¡    ææ§äºå¡\nä¸å¡æ¹é    æ           æ            å®ç°ç¸å³æ¥å£\nä¸è´æ§    ä¸æ¯æ        æ¯æ          æç»ä¸è´\néç¦»æ§    ä¸æ¯æ        æ¯æ          ä¸å¡æ¹ä¿è¯\nå¹¶åæ§è½   æ å½±å        ä¸¥éè¡°é        ç¥å¾®è¡°é\néååºæ¯   ä¸å¡æ¹å¤çä¸ä¸è´   ç­äºå¡ & ä½å¹¶å   é¿äºå¡ & é«å¹¶å\n\n\n# ååºåè¡¨\n\n\n# ä»ä¹æ¯ååºåè¡¨\n\n> ä»ä¹æ¯ååºåè¡¨ï¼ä»ä¹æ¯åç´æåï¼ä»ä¹æ¯æ°´å¹³æåï¼ä»ä¹æ¯ shardingï¼\n> \n> ååºåè¡¨æ¯ä¸ºäºè§£å³ä»ä¹é®é¢ï¼\n> \n> ååºåè¡¨æä»ä¹ä¼ç¹ï¼\n> \n> ååºåè¡¨æä»ä¹ç­ç¥ï¼\n\nååºåè¡¨çåºæ¬ææ³å°±æ¯ï¼æåæ¬å®æ´çæ°æ®ååæå¤ä¸ªé¨åï¼æ¾å°ä¸åçæ°æ®åºæè¡¨ä¸ã\n\nååºåè¡¨ä¸å®æ¯ä¸ºäºæ¯æ é«å¹¶åãæ°æ®éå¤§ä¸¤ä¸ªé®é¢çã\n\n# åç´åå\n\n> åç´ååï¼æ¯ æä¸ä¸ªæå¾å¤å­æ®µçè¡¨ç»æåæå¤ä¸ªè¡¨ï¼æèæ¯å¤ä¸ªåºä¸å»ãä¸è¬æ¥è¯´ï¼ä¼ å°è¾å°çãè®¿é®é¢çè¾é«çå­æ®µæ¾å°ä¸ä¸ªè¡¨éå»ï¼ç¶å å°è¾å¤çãè®¿é®é¢çè¾ä½çå­æ®µæ¾å°å¦å¤ä¸ä¸ªè¡¨éå»ãå ä¸ºæ°æ®åºæ¯æç¼å­çï¼è®¿é®é¢çé«çè¡å­æ®µè¶å°ï¼å°±å¯ä»¥å¨ç¼å­éç¼å­æ´å¤çè¡ï¼æ§è½å°±è¶å¥½ãè¿ä¸ªä¸è¬å¨è¡¨å±é¢åçè¾å¤ä¸äºã\n\n\n\nä¸è¬æ¥è¯´ï¼æ»¡è¶³ä¸é¢çæ¡ä»¶å°±å¯ä»¥èèæ©å®¹äºï¼\n\n * mysql ååºè¶è¿ 5000 ä¸æ¡è®°å½ï¼oracle ååºè¶è¿ 1 äº¿æ¡è®°å½ï¼db ååå°±å¾å¤§ã\n * ååºè¶è¿æ¯ç§ 2000 ä¸ªå¹¶åæ¶ï¼èä¸ä¸ªå¥åº·çååºæå¥½ä¿æå¨æ¯ç§ 1000 ä¸ªå¹¶åå·¦å³ï¼ä¸è¦å¤ªå¤§ã\n\nå¨æ°æ®åºçå±é¢ä½¿ç¨åç´ååå°ææ°æ®åºä¸­è¡¨çå¯éç¨åº¦é¨ç½²å°ä¸åçåºä¸­ï¼ä¾å¦å°åæ¥ççµåæ°æ®åºåç´ååæååæ°æ®åºãç¨æ·æ°æ®åºç­ã\n\n# æ°´å¹³æå\n\n> æ°´å¹³æå åç§°ä¸º shardingï¼å®æ¯å°åä¸ä¸ªè¡¨ä¸­çè®°å½æåå°å¤ä¸ªç»æç¸åçè¡¨ä¸­ãå½ åè¡¨æ°æ®éå¤ªå¤§ æ¶ï¼ä¼æå¤§å½±å sql æ§è¡çæ§è½ ãåè¡¨æ¯å°åæ¥ä¸å¼ è¡¨çæ°æ®åå¸å°æ°æ®åºéç¾¤çä¸åèç¹ä¸ï¼ä»èç¼è§£åç¹çååã\n\n\n\nä¸è¬æ¥è¯´ï¼åè¡¨æ 200 ä¸æ¡æ°æ® çæ¶åï¼æ§è½å°±ä¼ç¸å¯¹å·®ä¸äºäºï¼éè¦èèåè¡¨äºãä½æ¯ï¼è¿ä¹è¦è§å·ä½æåµèå®ï¼å¯è½æ¯ 100 ä¸æ¡ï¼ä¹å¯è½æ¯ 500 ä¸æ¡ï¼sql è¶å¤æï¼å°±æå¥½è®©åè¡¨è¡æ°è¶å°ã\n\n# ååºåè¡¨çä¼ç¹\n\n#          ååºåè¡¨å              ååºåè¡¨å\nå¹¶åæ¯ææåµ     åæºé¨ç½²ï¼æä¸ä½é«å¹¶å        ä»åæºå°å¤æºï¼è½æ¿åçå¹¶åå¢å äºå¤å\nç£çä½¿ç¨æåµ     åæºç£çå®¹éå ä¹ææ»¡         æåä¸ºå¤ä¸ªåºï¼æ°æ®åºæå¡å¨ç£çä½¿ç¨çå¤§å¤§éä½\nsql æ§è¡æ§è½   åè¡¨æ°æ®éå¤ªå¤§ï¼sql è¶è·è¶æ¢   åè¡¨æ°æ®éåå°ï¼sql æ§è¡æçææ¾æå\n\n# ååºåè¡¨ç­ç¥\n\n * åå¸åæ¨¡ï¼hash(key) % n æ id % n\n   * ä¼ç¹ï¼å¯ä»¥å¹³ååéæ¯ä¸ªåºçæ°æ®éåè¯·æ±ååï¼è´è½½åè¡¡ï¼ã\n   * ç¼ºç¹ï¼æ©å®¹éº»ç¦ï¼éè¦æ°æ®è¿ç§»ã\n * èå´ï¼å¯ä»¥æç§ id ææ¶é´ååèå´ã\n   * ä¼ç¹ï¼æ©å®¹ç®åã\n   * ç¼ºç¹ï¼è¿ç§ç­ç¥å®¹æäº§çç­ç¹é®é¢ã\n * æ å°è¡¨ï¼ä½¿ç¨åç¬çä¸ä¸ªæ°æ®åºæ¥å­å¨æ å°å³ç³»ã\n   * ç¼ºç¹ï¼å­å¨æ å°å³ç³»çæ°æ®åºä¹å¯è½æä¸ºæ§è½ç¶é¢ï¼ä¸ä¸æ¦å®æºï¼ååºåè¡¨çæ°æ®åºå°±æ æ³å·¥ä½ãæä»¥ä¸å»ºè®®ä½¿ç¨è¿ç§ç­ç¥ã\n   * ä¼ç¹ï¼æ©å®¹ç®åï¼å¯ä»¥è§£å³åå¸å¼ id é®é¢ã\n\n\n# ååºåè¡¨ä¸­é´ä»¶\n\n> â å¸¸è§é®é¢ï¼\n> \n>  * ä½ ç¨è¿åªäºååºåè¡¨ä¸­é´ä»¶ï¼ç®åä»ç»ä¸ä¸ï¼\n> \n>  * ä¸åçååºåè¡¨ä¸­é´ä»¶åèªæä»ä¹ç¹æ§ï¼æä»ä¹ä¼ç¼ºç¹ï¼\n> \n>  * ååºåè¡¨ä¸­é´ä»¶ææ¯å¦ä½éåï¼\n\n# å¸¸è§çååºåè¡¨ä¸­é´ä»¶\n\n * cobar - é¿é b2b å¢éå¼ååå¼æºçï¼å±äº proxy å±æ¹æ¡ï¼å°±æ¯ä»äºåºç¨æå¡å¨åæ°æ®åºæå¡å¨ä¹é´ãåºç¨ç¨åºéè¿ jdbc é©±å¨è®¿é® cobar éç¾¤ï¼cobar æ ¹æ® sql åååºè§åå¯¹ sql ååè§£ï¼ç¶åååå° mysql éç¾¤ä¸åçæ°æ®åºå®ä¾ä¸æ§è¡ãæ©äºå¹´è¿å¯ä»¥ç¨ï¼ä½æ¯æè¿å å¹´é½æ²¡æ´æ°äºï¼åºæ¬æ²¡å¥äººç¨ï¼å·®ä¸å¤ç®æ¯è¢«æå¼çç¶æå§ãèä¸ä¸æ¯æè¯»ååç¦»ãå­å¨è¿ç¨ãè·¨åº join ååé¡µç­æä½ã\n * tddl - æ·å®å¢éå¼åçï¼å±äº client å±æ¹æ¡ãæ¯æåºæ¬ç crud è¯­æ³åè¯»ååç¦»ï¼ä½ä¸æ¯æ joinãå¤è¡¨æ¥è¯¢ç­è¯­æ³ãç®åä½¿ç¨çä¹ä¸å¤ï¼å ä¸ºè¿ä¾èµæ·å®ç diamond éç½®ç®¡çç³»ç»ã\n * atlas - 360 å¼æºçï¼å±äº proxy å±æ¹æ¡ï¼ä»¥åæ¯æä¸äºå¬å¸å¨ç¨çï¼ä½æ¯ç¡®å®æä¸ä¸ªå¾å¤§çé®é¢å°±æ¯ç¤¾åºææ°çç»´æ¤é½å¨ 5 å¹´åäºãæä»¥ï¼ç°å¨ç¨çå¬å¸åºæ¬ä¹å¾å°äºã\n * sharding-jdbc - å½å½å¼æºçï¼å±äº client å±æ¹æ¡ãç¡®å®ä¹åç¨çè¿æ¯è¾å¤ä¸äºï¼å ä¸º sql è¯­æ³æ¯æä¹æ¯è¾å¤ï¼æ²¡æå¤ªå¤éå¶ï¼èä¸ç®åæ¨åºå°äº 2.0 çæ¬ï¼æ¯æååºåè¡¨ãè¯»ååç¦»ãåå¸å¼ id çæãææ§äºå¡ï¼æå¤§åªåéè¾¾åäºå¡ãtcc äºå¡ï¼ãèä¸ç¡®å®ä¹åä½¿ç¨çå¬å¸ä¼æ¯è¾å¤ä¸äºï¼è¿ä¸ªå¨å®ç½æç»è®°ä½¿ç¨çå¬å¸ï¼å¯ä»¥çå°ä» 2017 å¹´ä¸ç´å°ç°å¨ï¼æ¯æä¸å°å¬å¸å¨ç¨çï¼ï¼ç®åç¤¾åºä¹è¿ä¸ç´å¨å¼ååç»´æ¤ï¼è¿ç®æ¯æ¯è¾æ´»è·ï¼ä¸ªäººè®¤ä¸ºç®æ¯ä¸ä¸ªç°å¨ä¹å¯ä»¥éæ©çæ¹æ¡ã\n * mycat - åºäº cobar æ¹é çï¼å±äº proxy å±æ¹æ¡ï¼æ¯æçåè½éå¸¸å®åï¼èä¸ç®ååºè¯¥æ¯éå¸¸ç«çèä¸ä¸æ­æµè¡çæ°æ®åºä¸­é´ä»¶ï¼ç¤¾åºå¾æ´»è·ï¼ä¹æä¸äºå¬å¸å¼å§å¨ç¨äºãä½æ¯ç¡®å®ç¸æ¯äº sharding jdbc æ¥è¯´ï¼å¹´è½»ä¸äºï¼ç»åçé¤ç¼å°ä¸äºã\n\n# ååºåè¡¨ä¸­é´ä»¶ææ¯éå\n\nå»ºè®®ä½¿ç¨çæ¯ sharding-jdbc å mycatã\n\n * sharding-jdbc è¿ç§ client å±æ¹æ¡çä¼ç¹å¨äºä¸ç¨é¨ç½²ï¼è¿ç»´ææ¬ä½ï¼ä¸éè¦ä»£çå±çäºæ¬¡è½¬åè¯·æ±ï¼æ§è½å¾é«ï¼ä½æ¯å¦æéå°åçº§å¥çéè¦åä¸ªç³»ç»é½éæ°åçº§çæ¬ååå¸ï¼åä¸ªç³»ç»é½éè¦è¦å sharding-jdbc çä¾èµãå¶æ¬è´¨ä¸éè¿éç½®å¤æ°æ®æºï¼ç¶åæ ¹æ®è®¾å®çååºåè¡¨ç­ç¥ï¼è®¡ç®è·¯ç±ï¼å°è¯·æ±åéå°è®¡ç®å¾å°çèç¹ä¸ã\n\n * mycat è¿ç§ proxy å±æ¹æ¡çç¼ºç¹å¨äºéè¦é¨ç½²ï¼èªå·±è¿ç»´ä¸å¥ä¸­é´ä»¶ï¼è¿ç»´ææ¬é«ï¼ä½æ¯å¥½å¤å¨äºå¯¹äºåä¸ªé¡¹ç®æ¯éæçï¼å¦æéå°åçº§ä¹ç±»çé½æ¯èªå·±ä¸­é´ä»¶é£éæå°±è¡äºã\n\néå¸¸æ¥è¯´ï¼è¿ä¸¤ä¸ªæ¹æ¡å¶å®é½å¯ä»¥éç¨ï¼ä½æ¯æä¸ªäººå»ºè®®ä¸­å°åå¬å¸éç¨ sharding-jdbcï¼client å±æ¹æ¡è½»ä¾¿ï¼èä¸ç»´æ¤ææ¬ä½ï¼ä¸éè¦é¢å¤å¢æ´¾äººæï¼èä¸ä¸­å°åå¬å¸ç³»ç»å¤æåº¦ä¼ä½ä¸äºï¼é¡¹ç®ä¹æ²¡é£ä¹å¤ï¼ä½æ¯ä¸­å¤§åå¬å¸æå¥½è¿æ¯éç¨ mycat è¿ç±» proxy å±æ¹æ¡ï¼å ä¸ºå¯è½å¤§å¬å¸ç³»ç»åé¡¹ç®éå¸¸å¤ï¼å¢éå¾å¤§ï¼äººååè¶³ï¼é£ä¹æå¥½æ¯ä¸é¨å¼ä¸ªäººæ¥ç ç©¶åç»´æ¤ mycatï¼ç¶åå¤§éé¡¹ç®ç´æ¥éæä½¿ç¨å³å¯ã\n\n\n# ååºåè¡¨çé®é¢\n\n>  * ååºåè¡¨çå¸¸è§é®é¢æåªäºï¼\n> \n>  * ä½ æ¯å¦ä½è§£å³ååºåè¡¨çé®é¢çï¼\n> \n> ä¸æä¸ä¸è®²è§£å¸¸è§ååºåè¡¨çé®é¢åè§£å³æ¹æ¡ã\n\n# åå¸å¼äºå¡\n\næ¹æ¡ä¸ï¼ä½¿ç¨æ°æ®åºäºå¡\n\n * ä¼ç¹ï¼äº¤ç±æ°æ®åºç®¡çï¼ç®åææ\n * ç¼ºç¹ï¼æ§è½ä»£ä»·é«ï¼ç¹å«æ¯ shard è¶æ¥è¶å¤æ¶\n\næ¹æ¡äºï¼ç±åºç¨ç¨åºåæ°æ®åºå±åæ§å¶\n\n * åçï¼å°ä¸ä¸ªè·¨å¤ä¸ªæ°æ®åºçåå¸å¼äºå¡åææå¤ä¸ªä»å¤äºåä¸ªæ°æ®åºä¸é¢çå°äºå¡ï¼å¹¶éè¿åºç¨ç¨åºæ¥æ»æ§åä¸ªå°äºå¡ã\n * ä¼ç¹ï¼æ§è½ä¸æä¼å¿\n * ç¼ºç¹ï¼éè¦åºç¨ç¨åºå¨äºå¡æ§å¶ä¸åçµæ´»è®¾è®¡ãå¦æä½¿ç¨äº spring çäºå¡ç®¡çï¼æ¹å¨èµ·æ¥ä¼é¢ä¸´ä¸å®çå°é¾ã\n\n# è·¨èç¹ join\n\nåªè¦æ¯è¿è¡ååï¼è·¨èç¹ join çé®é¢æ¯ä¸å¯é¿åçãä½æ¯è¯å¥½çè®¾è®¡åååå´å¯ä»¥åå°æ­¤ç±»æåµçåçãè§£å³è¿ä¸é®é¢çæ®éåæ³æ¯åä¸¤æ¬¡æ¥è¯¢å®ç°ãå¨ç¬¬ä¸æ¬¡æ¥è¯¢çç»æéä¸­æ¾åºå³èæ°æ®ç idï¼æ ¹æ®è¿äº id åèµ·ç¬¬äºæ¬¡è¯·æ±å¾å°å³èæ°æ®ã\n\n# è·¨èç¹ç count,order by,group by ä»¥åèåå½æ°\n\nè¿äºæ¯ä¸ç±»é®é¢ï¼å ä¸ºå®ä»¬é½éè¦åºäºå¨é¨æ°æ®éåè¿è¡è®¡ç®ãå¤æ°çä»£çé½ä¸ä¼èªå¨å¤çåå¹¶å·¥ä½ã\n\nè§£å³æ¹æ¡ï¼ä¸è§£å³è·¨èç¹ join é®é¢çç±»ä¼¼ï¼åå«å¨åä¸ªèç¹ä¸å¾å°ç»æåå¨åºç¨ç¨åºç«¯è¿è¡åå¹¶ãå join ä¸åçæ¯æ¯ä¸ªèç¹çæ¥è¯¢å¯ä»¥å¹¶è¡æ§è¡ï¼å æ­¤å¾å¤æ¶åå®çéåº¦è¦æ¯åä¸å¤§è¡¨å¿«å¾å¤ãä½å¦æç»æéå¾å¤§ï¼å¯¹åºç¨ç¨åºåå­çæ¶èæ¯ä¸ä¸ªé®é¢ã\n\nä¸å¡è§åº¦ä¸çè§£å³æ¹æ¡ï¼\n\n * å¦ææ¯å¨åå°åºç¨æä¾åé¡µï¼åéå®ç¨æ·åªè½çåé¢ n é¡µï¼è¿ä¸ªéå¶å¨ä¸å¡ä¸ä¹æ¯åççï¼ä¸è¬çåé¢çåé¡µæä¹ä¸å¤§ï¼å¦æä¸å®è¦çï¼å¯ä»¥è¦æ±ç¨æ·ç¼©å°èå´éæ°æ¥è¯¢ï¼ã\n * å¦ææ¯åå°æ¹å¤çä»»å¡è¦æ±åæ¹è·åæ°æ®ï¼åå¯ä»¥å å¤§ page sizeï¼æ¯å¦æ¯æ¬¡è·å 5000 æ¡è®°å½ï¼ææåå°åé¡µæ°ï¼å½ç¶ç¦»çº¿è®¿é®ä¸è¬èµ°å¤åºï¼é¿åå²å»ä¸»åºï¼ã\n * ååºè®¾è®¡æ¶ï¼ä¸è¬è¿æéå¥å¤§æ°æ®å¹³å°æ±æ»ææååºçè®°å½ï¼æäºåé¡µæ¥è¯¢å¯ä»¥èèèµ°å¤§æ°æ®å¹³å°ã\n\n# åå¸å¼ id\n\nä¸æ¦æ°æ®åºè¢«ååå°å¤ä¸ªç©çèç¹ä¸ï¼æä»¬å°ä¸è½åä¾èµæ°æ®åºèªèº«çä¸»é®çææºå¶ãä¸æ¹é¢ï¼æä¸ªååºæ°æ®åºèªçæç id æ æ³ä¿è¯å¨å¨å±ä¸æ¯å¯ä¸çï¼å¦ä¸æ¹é¢ï¼åºç¨ç¨åºå¨æå¥æ°æ®ä¹åéè¦åè·å¾ idï¼ä»¥ä¾¿è¿è¡ sql è·¯ç±ã\n\nä¸äºå¸¸è§çä¸»é®çæç­ç¥ï¼\n\n * ä½¿ç¨å¨å±å¯ä¸ idï¼guidã\n * ä¸ºæ¯ä¸ªåçæå®ä¸ä¸ª id èå´ã\n * åå¸å¼ id çæå¨ (å¦ twitter ç snowflake ç®æ³)ã\n\n# æ°æ®è¿ç§»ï¼å®¹éè§åï¼æ©å®¹ç­é®é¢\n\næ¥èªæ·å®ç»¼åä¸å¡å¹³å°å¢éï¼å®å©ç¨å¯¹ 2 çåæ°åä½å·æååå¼å®¹çç¹æ§ï¼å¦å¯¹ 4 åä½å¾ 1 çæ°å¯¹ 2 åä½ä¹æ¯ 1ï¼æ¥åéæ°æ®ï¼é¿åäºè¡çº§å«çæ°æ®è¿ç§»ï¼ä½æ¯ä¾ç¶éè¦è¿è¡è¡¨çº§å«çè¿ç§»ï¼åæ¶å¯¹æ©å®¹è§æ¨¡ååè¡¨æ°éé½æéå¶ãæ»å¾æ¥è¯´ï¼è¿äºæ¹æ¡é½ä¸æ¯ååççæ³ï¼å¤å¤å°å°é½å­å¨ä¸äºç¼ºç¹ï¼è¿ä¹ä»ä¸ä¸ªä¾§é¢åæ åºäº sharding æ©å®¹çé¾åº¦ã\n\n\n# éç¾¤\n\n> è¿ä¸ªä¸é¢éè¦æ ¹æ®çæåªä¸ªæ°æ®åºèå®ï¼ä½æ¯ä¸»æµãæççæ°æ®åºé½ä¼å®ç°ä¸äºåºæ¬åè½ï¼åªæ¯å®ç°æ¹å¼ãç­ç¥ä¸ææå·®å¼ãç±äºæ¬äººè¾ä¸ºçæ mysqlï¼æä»¥ä¸é¢ä¸»è¦ä»ç» mysql ç³»ç»æ¶æé®é¢ã\n\n\n# å¤å¶æºå¶\n\nmysql æ¯æä¸¤ç§å¤å¶ï¼åºäºè¡çå¤å¶ååºäºè¯­å¥çå¤å¶ã\n\nè¿ä¸¤ç§æ¹å¼é½æ¯å¨ä¸»åºä¸è®°å½äºè¿å¶æ¥å¿ï¼binlogï¼ï¼ç¶åå¨ä»åºä¸ä»¥å¼æ­¥æ¹å¼æ´æ°ä¸»åºä¸çæ¥å¿è®°å½ãè¿æå³çï¼å¤å¶è¿ç¨å­å¨æ¶å»¶ï¼è¿æ®µæ¶é´åï¼ä¸»ä»æ°æ®å¯è½ä¸ä¸è´ï¼å³æç»ä¸è´æ§ï¼ã\n\nä¸»è¦æ¶åä¸ä¸ªçº¿ç¨ï¼binlog çº¿ç¨ãi/o çº¿ç¨å sql çº¿ç¨ã\n\n * binlog çº¿ç¨ ï¼è´è´£å°ä¸»æå¡å¨ä¸çæ°æ®æ´æ¹åå¥äºè¿å¶æä»¶ï¼binlogï¼ä¸­ã\n * i/o çº¿ç¨ ï¼è´è´£ä»ä¸»æå¡å¨ä¸è¯»åäºè¿å¶æ¥å¿æä»¶ï¼å¹¶åå¥ä»æå¡å¨çæ¥å¿ä¸­ã\n * sql çº¿ç¨ ï¼è´è´£è¯»åæ¥å¿å¹¶æ§è¡ sql è¯­å¥ä»¥æ´æ°æ°æ®ã\n\n\n\n\n# è¯»ååç¦»\n\nä¸»æå¡å¨ç¨æ¥å¤çåæä½ä»¥åå®æ¶æ§è¦æ±æ¯è¾é«çè¯»æä½ï¼èä»æå¡å¨ç¨æ¥å¤çè¯»æä½ã\n\nè¯»ååç¦»å¸¸ç¨ä»£çæ¹å¼æ¥å®ç°ï¼ä»£çæå¡å¨æ¥æ¶åºç¨å±ä¼ æ¥çè¯»åè¯·æ±ï¼ç¶åå³å®è½¬åå°åªä¸ªæå¡å¨ã\n\nmysql è¯»ååç¦»è½æé«æ§è½çåå å¨äºï¼\n\n * ä¸»ä»æå¡å¨è´è´£åèªçè¯»ååï¼æå¤§ç¨åº¦ç¼è§£äºéçäºç¨ï¼\n * ä»æå¡å¨å¯ä»¥éç½® myisam å¼æï¼æåæ¥è¯¢æ§è½ä»¥åèçº¦ç³»ç»å¼éï¼\n * å¢å åä½ï¼æé«å¯ç¨æ§ã\n\n\n\n\n# æ°æ®åºä¼å\n\næ°æ®åºä¼åçè·¯çº¿ä¸è¬ä¸ºï¼sql ä¼åãç»æä¼åãéç½®ä¼åãç¡¬ä»¶ä¼åãåä¸¤ä¸ªæ¹åä¸è¬æ¯æ®éå¼åçèéç¹ï¼èåä¸¤ä¸ªæ¹åä¸è¬æ¯ dba çèéç¹ã\n\n\n# sql ä¼å\n\n> sql ä¼åæ¯æ°æ®åºä¼åçæå¸¸è§ãæåçº§ææ®µã\n> \n> å¨æ§è¡ sql è¯­å¥ï¼è¯­å¥ä¸­å­æ®µçé¡ºåºãæ¥è¯¢ç­ç¥ç­é½å¯è½ä¼å½±åå° sql çæ§è¡æ§è½ã\n\n# æ§è¡è®¡å\n\nå¦ä½æ£éªä¿®æ¹åç sql ç¡®å®æä¼åææï¼è¿å°±éè¦ç¨å°æ§è¡è®¡åï¼explainï¼ã\n\nä½¿ç¨æ§è¡è®¡å explain ç¨æ¥åæ select æ¥è¯¢æçï¼å¼åäººåå¯ä»¥éè¿åæ explain ç»ææ¥ä¼åæ¥è¯¢è¯­å¥ã\n\næ¯è¾éè¦çå­æ®µæï¼\n\n * select_type - æ¥è¯¢ç±»åï¼æç®åæ¥è¯¢ãèåæ¥è¯¢ãå­æ¥è¯¢ç­\n * key - ä½¿ç¨çç´¢å¼\n * rows - æ«æçè¡æ°\n\n> æ´å¤åå®¹è¯·åèï¼mysql æ§è½ä¼åç¥å¨ explain ä½¿ç¨åæ\n\n# è®¿é®æ°æ®ä¼å\n\nåå°è¯·æ±çæ°æ®éï¼\n\n * åªè¿åå¿è¦çå - ä¸è¦æ¥è¯¢ä¸éè¦çåï¼å°½éé¿åä½¿ç¨ select * è¯­å¥ã\n * åªè¿åå¿è¦çè¡ - ä½¿ç¨ where è¯­å¥è¿è¡æ¥è¯¢è¿æ»¤ï¼ææ¶åä¹éè¦ä½¿ç¨ limit è¯­å¥æ¥éå¶è¿åçæ°æ®ã\n * ç¼å­éå¤æ¥è¯¢çæ°æ® - ä½¿ç¨ç¼å­å¯ä»¥é¿åå¨æ°æ®åºä¸­è¿è¡æ¥è¯¢ï¼ç¹å«è¦æ¥è¯¢çæ°æ®ç»å¸¸è¢«éå¤æ¥è¯¢ï¼ç¼å­å¯ä»¥å¸¦æ¥çæ¥è¯¢æ§è½æåå°ä¼æ¯éå¸¸ææ¾çã\n\nåå°æå¡å¨ç«¯æ«æçè¡æ°ï¼\n\n * æææçæ¹å¼æ¯ä½¿ç¨ç´¢å¼æ¥è¦çæ¥è¯¢ï¼å³ where åçè¿æ»¤æ¥è¯¢å­æ®µæå¥½æ¯ç´¢å¼å­æ®µï¼ã\n\n# éææ¥è¯¢æ¹å¼\n\n# ååæ¥è¯¢\n\nä¸ä¸ªå¤§æ¥è¯¢å¦æä¸æ¬¡æ§æ§è¡çè¯ï¼å¯è½ä¸æ¬¡éä½å¾å¤æ°æ®ãå æ»¡æ´ä¸ªäºå¡æ¥å¿ãèå°½ç³»ç»èµæºãé»å¡å¾å¤å°çä½éè¦çæ¥è¯¢ã\n\ndeleft from messages where create < date_sub(now(), interval 3 month);\n\n\nrows_affected = 0\ndo {\n    rows_affected = do_query(\n    \"delete from messages where create  < date_sub(now(), interval 3 month) limit 10000\")\n} while rows_affected > 0\n\n\n# åè§£å³èæ¥è¯¢\n\nå°ä¸ä¸ªå¤§è¿æ¥æ¥è¯¢ï¼joinï¼åè§£æå¯¹æ¯ä¸ä¸ªè¡¨è¿è¡ä¸æ¬¡åè¡¨æ¥è¯¢ï¼ç¶åå°ç»æå¨åºç¨ç¨åºä¸­è¿è¡å³èï¼è¿æ ·åçå¥½å¤æï¼\n\n * ç¼å­æ´é«æãå¯¹äºè¿æ¥æ¥è¯¢ï¼å¦æå¶ä¸­ä¸ä¸ªè¡¨åçååï¼é£ä¹æ´ä¸ªæ¥è¯¢ç¼å­å°±æ æ³ä½¿ç¨ãèåè§£åçå¤ä¸ªæ¥è¯¢ï¼å³ä½¿å¶ä¸­ä¸ä¸ªè¡¨åçååï¼å¯¹å¶å®è¡¨çæ¥è¯¢ç¼å­ä¾ç¶å¯ä»¥ä½¿ç¨ã\n * åè§£æå¤ä¸ªåè¡¨æ¥è¯¢ï¼è¿äºåè¡¨æ¥è¯¢çç¼å­ç»ææ´å¯è½è¢«å¶å®æ¥è¯¢ä½¿ç¨å°ï¼ä»èåå°åä½è®°å½çæ¥è¯¢ã\n * åå°éç«äºï¼\n * å¨åºç¨å±è¿è¡è¿æ¥ï¼å¯ä»¥æ´å®¹æå¯¹æ°æ®åºè¿è¡æåï¼ä»èæ´å®¹æåå°é«æ§è½åå¯æ©å±ã\n * æ¥è¯¢æ¬èº«æçä¹å¯è½ä¼æææåãä¾å¦ä¸é¢çä¾å­ä¸­ï¼ä½¿ç¨ in() ä»£æ¿è¿æ¥æ¥è¯¢ï¼å¯ä»¥è®© mysql æç§ id é¡ºåºè¿è¡æ¥è¯¢ï¼è¿å¯è½æ¯éæºçè¿æ¥è¦æ´é«æã\n\nselect * from tag\njoin tag_post on tag_post.tag_id=tag.id\njoin post on tag_post.post_id=post.id\nwhere tag.tag='mysql';\nselect * from tag where tag='mysql';\nselect * from tag_post where tag_id=1234;\nselect * from post where post.id in (123,456,567,9098,8904);\n\n\n# sql è¯­å¥ç»è\n\n# éæ©æææççè¡¨åé¡ºåº\n\næ°æ®åºæç§ä»å³å°å·¦çé¡ºåºå¤ç from å­å¥ä¸­çè¡¨åï¼from å­å¥ä¸­åå¨æåçè¡¨å°è¢«æåå¤çã\n\nå¨ from å­å¥ä¸­åå«å¤ä¸ªè¡¨çæåµä¸ï¼\n\n * å¦æå¤ä¸ªè¡¨æ¯å®å¨æ å³ç³»çè¯ï¼å°è®°å½åååæå°çè¡¨ï¼åå¨æåï¼ç¶åä¾æ¬¡ç±»æ¨ãä¹å°±æ¯è¯´ï¼éæ©è®°å½æ¡æ°æå°çè¡¨æ¾å¨æåã\n\nå¦ææ 3 ä¸ªä»¥ä¸çè¡¨è¿æ¥æ¥è¯¢ï¼\n\n * å¦æå¤ä¸ªè¡¨æ¯æå³ç³»çè¯ï¼å°å¼ç¨æå¤çè¡¨ï¼æ¾å¨æåï¼ç¶åä¾æ¬¡ç±»æ¨ãä¹å°±æ¯è¯´ï¼è¢«å¶ä»è¡¨æå¼ç¨çè¡¨æ¾å¨æåã\n\nä¾å¦ï¼æ¥è¯¢åå·¥çç¼å·ï¼å§åï¼å·¥èµï¼å·¥èµç­çº§ï¼é¨é¨å\n\nemp è¡¨è¢«å¼ç¨å¾æå¤ï¼è®°å½æ°ä¹æ¯æå¤ï¼å æ­¤æ¾å¨ form å­å¥çæåé¢\n\nselect emp.empno,emp.ename,emp.sal,salgrade.grade,dept.dname\nfrom salgrade,dept,emp\nwhere (emp.deptno = dept.deptno) and (emp.sal between salgrade.losal and salgrade.hisal)\n\n\n# where å­å¥ä¸­çè¿æ¥é¡ºåº\n\næ°æ®åºæç§ä»å³å°å·¦çé¡ºåºè§£æ where å­å¥ã\n\nå æ­¤ï¼è¡¨ä¹é´çè¿æ¥å¿é¡»åå¨å¶ä» where æ¡ä»¶çå·¦è¾¹ï¼é£äºå¯ä»¥è¿æ»¤ææå¤§æ°éè®°å½çæ¡ä»¶å¿é¡»åå¨ where å­å¥çä¹å³ã\n\nemp.sal å¯ä»¥è¿æ»¤å¤æ¡è®°å½ï¼åå¨ where å­å¥çæå³è¾¹\n\nselect emp.empno,emp.ename,emp.sal,dept.dname\nfrom dept,emp\nwhere (emp.deptno = dept.deptno) and (emp.sal > 1500)\n\n\n# select å­å¥ä¸­é¿åä½¿ç¨ * å·\n\næä»¬å½æ¶å­¦ä¹ çæ¶åï¼â*â å·æ¯å¯ä»¥è·åè¡¨ä¸­å¨é¨çå­æ®µæ°æ®çã\n\n * ä½æ¯å®è¦éè¿æ¥è¯¢æ°æ®å­å¸å®æçï¼è¿æå³çå°èè´¹æ´å¤çæ¶é´\n * ä½¿ç¨*å·ååºæ¥ç sql è¯­å¥ä¹ä¸å¤ç´è§ã\n\n----------------------------------------\n\n# ç¨ truncate æ¿ä»£ delete\n\nå¦æéè¦æ¸ç©ºææè¡¨è®°å½ï¼ä½¿ç¨ truncate æ¯ delete æ§è¡æçé«ï¼\n\ndelete æ¯ä¸æ¡ä¸æ¡è®°å½çå é¤ï¼è truncate æ¯å°æ´ä¸ªè¡¨å é¤ï¼ä»ä¿çè¡¨ç»æ\n\n# ä½¿ç¨åé¨å½æ°æé« sql æç\n\nä¾å¦ä½¿ç¨ mysql ç concat() å½æ°ä¼æ¯ä½¿ç¨ || æ¼æ¥éåº¦å¿«ï¼å ä¸º concat() å½æ°å·²ç»è¢« mysql ä¼åè¿äºã\n\n# ä½¿ç¨è¡¨æåçå«å\n\nå¦æè¡¨æåçåç§°å¤ªé¿äºï¼ä½¿ç¨ä¸äºç®ç­çå«åä¹è½ç¨å¾®æé«ä¸äº sql çæ§è½ãæ¯ç«è¦æ«æçå­ç¬¦é¿åº¦å°±åå°äºã\n\n# sql å³é®å­å¤§å\n\næä»¬å¨ç¼å sql çæ¶åï¼å®æ¹æ¨èçæ¯ä½¿ç¨å¤§åæ¥åå³é®å­ï¼å ä¸º oracle æå¡å¨æ»æ¯åå°å°åå­æ¯è½¬æå¤§ååï¼ææ§è¡\n\n# ç¨ >= æ¿ä»£ >\n\nâ ä½ææ¹å¼ï¼\n\n-- é¦åå®ä½å°deptno=3çè®°å½å¹¶ä¸æ«æå°ç¬¬ä¸ä¸ªdeptå¤§äº3çè®°å½\nselect * from emp where deptno > 3\n\n\nâ é«ææ¹å¼ï¼\n\n-- ç´æ¥è·³å°ç¬¬ä¸ä¸ªdeptç­äº4çè®°å½\nselect * from emp where deptno >= 4\n\n\n# ç¨ in æ¿ä»£ or\n\nâ ä½ææ¹å¼ï¼\n\nselect * from emp where sal = 1500 or sal = 3000 or sal = 800;\n\n\nâ é«ææ¹å¼ï¼\n\nselect * from emp where sal in (1500,3000,800);\n\n\n# æ»æ¯ä½¿ç¨ç´¢å¼çç¬¬ä¸ä¸ªå\n\nå¦æç´¢å¼æ¯å»ºç«å¨å¤ä¸ªåä¸ï¼åªæå¨å®çç¬¬ä¸ä¸ªåè¢« where å­å¥å¼ç¨æ¶ï¼ä¼åå¨æä¼éæ©ä½¿ç¨è¯¥ç´¢å¼ã å½åªå¼ç¨ç´¢å¼çç¬¬äºä¸ªåæ¶ï¼ä¸å¼ç¨ç´¢å¼çç¬¬ä¸ä¸ªåæ¶ï¼ä¼åå¨ä½¿ç¨äºå¨è¡¨æ«æèå¿½ç¥äºç´¢å¼\n\ncreate index emp_sal_job_idex\non emp(sal,job);\n----------------------------------\nselect *\nfrom emp\nwhere job != 'sales';\n\n\n# sql å³é®å­å°½éå¤§å\n\nsql å³é®å­å°½éå¤§åï¼å¦ï¼oracle é»è®¤ä¼å° sql è¯­å¥ä¸­çå³é®å­è½¬ä¸ºå¤§ååå¨æ§è¡ã\n\n\n# ç»æä¼å\n\næ°æ®åºç»æä¼åå¯ä»¥ä»ä»¥ä¸æ¹åçæï¼\n\n * æ°æ®ç±»åä¼å\n * èå¼ååèå¼ä¼å\n * ç´¢å¼ä¼å - ç»èè¯·çç´¢å¼åçº¦æç« è\n * ååºåè¡¨ - ç»èè¯·çååºåè¡¨ç« è\n\n# æ°æ®ç±»åä¼ååå\n\n * æ´å°çéå¸¸æ´å¥½\n * ç®åå°±å¥½ï¼å¦æ´åæ¯å­ç¬¦åæä½ä»£ä»·ä½\n * å°½éé¿å null\n\n# èå¼ååèå¼\n\nèå¼ååèå¼åæå©å¼ï¼éè¦æ ¹æ®å®éæåµæè¡¡ã\n\nèå¼åçç®æ æ¯å°½ååå°åä½åï¼èçç©ºé´ã\n\n * èå¼åçä¼ç¹æ¯ï¼\n   \n   * åå°åä½åï¼è¦åçæ°æ®å°±å°ï¼åæä½çæ§è½æé«ï¼\n   * æ£ç´¢åæ°æ®æ¶ï¼distinct æ group by æä½åå°ã\n\n * èå¼åçç¼ºç¹æ¯ï¼å¢å å³èæ¥è¯¢ã\n\nåèå¼åçç®æ æ¯éå½å¢å åä½åï¼ä»¥é¿åå³èæ¥è¯¢ã\n\nåèå¼åçç¼ºç¹æ¯ï¼\n\n * åä½åå¢å¤ï¼ç©ºé´åå¤§ï¼åæä½æ§è½ä¸éï¼\n * æ£ç´¢åæ°æ®æ¶ï¼distinct æ group by æä½åå¤ï¼\n\n\n# éç½®ä¼å\n\n> éç½®ä¼åä¸»è¦æ¯éå¯¹ mysql æå¡å¨ï¼ä¾å¦ï¼max_connectionsãmax_heap_table_sizeãopen_files_limitãmax_allowed_packet ç­ç­ã\n> \n> å¨ä¸åç¯å¢ï¼ä¸ååºæ¯ä¸ï¼åºè¯¥éæä½¿ç¨åççéç½®ãè¿ç§ä¼åæ¯è¾èéª mysql è¿ç»´ç»éªï¼ä¸è¬æ¯ dba çèéï¼æ®éå¼åæ¥è§¦çè¾å°ã\n> \n> mysql éç½®è¯´æè¯·åèï¼mysql æå¡å¨éç½®è¯´æ\n\n\n# ç¡¬ä»¶ä¼å\n\næ°æ®åºæ©å®¹ãä½¿ç¨é«éè®¾å¤ç­ç­ãæ ¸å¿å°±æ¯ä¸ä¸ªå­ï¼é±ã\n\n\n# æ°æ®åºçè®º\n\n\n# å½æ°ä¾èµ\n\nè®° a->b è¡¨ç¤º a å½æ°å³å® bï¼ä¹å¯ä»¥è¯´ b å½æ°ä¾èµäº aã\n\nå¦æ {a1ï¼a2ï¼... ï¼an} æ¯å³ç³»çä¸ä¸ªæå¤ä¸ªå±æ§çéåï¼è¯¥éåå½æ°å³å®äºå³ç³»çå¶å®ææå±æ§å¹¶ä¸æ¯æå°çï¼é£ä¹è¯¥éåå°±ç§°ä¸ºé®ç ã\n\nå¯¹äº a->bï¼å¦æè½æ¾å° a ççå­é a'ï¼ä½¿å¾ a'-> bï¼é£ä¹ a->b å°±æ¯é¨åå½æ°ä¾èµï¼å¦åå°±æ¯å®å¨å½æ°ä¾èµï¼\n\nå¯¹äº a->bï¼b->cï¼å a->c æ¯ä¸ä¸ªä¼ éä¾èµã\n\n\n# å¼å¸¸\n\nä»¥ä¸çå­¦çè¯¾ç¨å³ç³»çå½æ°ä¾èµä¸º sno, cname -> sname, sdept, mname, gradeï¼é®ç ä¸º {sno, cname}ãä¹å°±æ¯è¯´ï¼ç¡®å®å­¦çåè¯¾ç¨ä¹åï¼å°±è½ç¡®å®å¶å®ä¿¡æ¯ã\n\nsno   sname   sdept   mname   cname   grade\n1     å­¦ç-1    å­¦é¢-1    é¢é¿-1    è¯¾ç¨-1    90\n2     å­¦ç-2    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-2    80\n2     å­¦ç-2    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-1    100\n3     å­¦ç-3    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-2    95\n\nä¸ç¬¦åèå¼çå³ç³»ï¼ä¼äº§çå¾å¤å¼å¸¸ï¼ä¸»è¦æä»¥ä¸åç§å¼å¸¸ï¼\n\n * åä½æ°æ®ï¼ä¾å¦ å­¦ç-2 åºç°äºä¸¤æ¬¡ã\n * ä¿®æ¹å¼å¸¸ï¼ä¿®æ¹äºä¸ä¸ªè®°å½ä¸­çä¿¡æ¯ï¼ä½æ¯å¦ä¸ä¸ªè®°å½ä¸­ç¸åçä¿¡æ¯å´æ²¡æè¢«ä¿®æ¹ã\n * å é¤å¼å¸¸ï¼å é¤ä¸ä¸ªä¿¡æ¯ï¼é£ä¹ä¹ä¼ä¸¢å¤±å¶å®ä¿¡æ¯ãä¾å¦å¦æå é¤äº è¯¾ç¨-1ï¼éè¦å é¤ç¬¬ä¸è¡åç¬¬ä¸è¡ï¼é£ä¹ å­¦ç-1 çä¿¡æ¯å°±ä¼ä¸¢å¤±ã\n * æå¥å¼å¸¸ï¼ä¾å¦æ³è¦æå¥ä¸ä¸ªå­¦ççä¿¡æ¯ï¼å¦æè¿ä¸ªå­¦çè¿æ²¡éè¯¾ï¼é£ä¹å°±æ æ³æå¥ã\n\n\n# èå¼\n\nèå¼çè®ºæ¯ä¸ºäºè§£å³ä»¥ä¸æå°åç§å¼å¸¸ã\n\né«çº§å«èå¼çä¾èµäºä½çº§å«çèå¼ï¼1nf æ¯æä½çº§å«çèå¼ã\n\n\n\n# ç¬¬ä¸èå¼ (1nf)\n\nå±æ§ä¸å¯åã\n\n# ç¬¬äºèå¼ (2nf)\n\n * æ¯ä¸ªéä¸»å±æ§å®å¨å½æ°ä¾èµäºé®ç ã\n\n * å¯ä»¥éè¿åè§£æ¥æ»¡è¶³ã\n\nåè§£å\n\nsno   sname   sdept   mname   cname   grade\n1     å­¦ç-1    å­¦é¢-1    é¢é¿-1    è¯¾ç¨-1    90\n2     å­¦ç-2    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-2    80\n2     å­¦ç-2    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-1    100\n3     å­¦ç-3    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-2    95\n\nä»¥ä¸å­¦çè¯¾ç¨å³ç³»ä¸­ï¼{sno, cname} ä¸ºé®ç ï¼æå¦ä¸å½æ°ä¾èµï¼\n\n * sno -> sname, sdept\n * sdept -> mname\n * sno, cname-> grade\n\ngrade å®å¨å½æ°ä¾èµäºé®ç ï¼å®æ²¡æä»»ä½åä½æ°æ®ï¼æ¯ä¸ªå­¦ççæ¯é¨è¯¾é½æç¹å®çæç»©ã\n\nsname, sdept å mname é½é¨åä¾èµäºé®ç ï¼å½ä¸ä¸ªå­¦çéä¿®äºå¤é¨è¯¾æ¶ï¼è¿äºæ°æ®å°±ä¼åºç°å¤æ¬¡ï¼é æå¤§éåä½æ°æ®ã\n\nåè§£å\n\nå³ç³»-1\n\nsno   sname   sdept   mname\n1     å­¦ç-1    å­¦é¢-1    é¢é¿-1\n2     å­¦ç-2    å­¦é¢-2    é¢é¿-2\n3     å­¦ç-3    å­¦é¢-2    é¢é¿-2\n\næä»¥ä¸å½æ°ä¾èµï¼\n\n * sno -> sname, sdept, mname\n * sdept -> mname\n\nå³ç³»-2\n\nsno   cname   grade\n1     è¯¾ç¨-1    90\n2     è¯¾ç¨-2    80\n2     è¯¾ç¨-1    100\n3     è¯¾ç¨-2    95\n\næä»¥ä¸å½æ°ä¾èµï¼\n\n * sno, cname -> grade\n\n# ç¬¬ä¸èå¼ (3nf)\n\n * éä¸»å±æ§ä¸ä¼ éä¾èµäºé®ç ã\n\nä¸é¢ç å³ç³»-1 ä¸­å­å¨ä»¥ä¸ä¼ éä¾èµï¼sno -> sdept -> mnameï¼å¯ä»¥è¿è¡ä»¥ä¸åè§£ï¼\n\nå³ç³»-11\n\nsno   sname   sdept\n1     å­¦ç-1    å­¦é¢-1\n2     å­¦ç-2    å­¦é¢-2\n3     å­¦ç-3    å­¦é¢-2\n\nå³ç³»-12\n\nsdept   mname\nå­¦é¢-1    é¢é¿-1\nå­¦é¢-2    é¢é¿-2\n\n\n# å­å¨å¼æ\n\nmysql æå¤ç§å­å¨å¼æï¼ä¸åçå­å¨å¼æä¿å­æ°æ®åç´¢å¼çæ¹å¼æ¯ä¸åçï¼ä½è¡¨çå®ä¹åæ¯å¨ mysql æå¡å±ç»ä¸å¤ççã\n\nç®ååä¸¾å ä¸ªå­å¨å¼æï¼\n\n * innodb - mysql çé»è®¤äºå¡åå­å¨å¼æï¼å¹¶æä¾äºè¡çº§éåå¤é®ççº¦æãæ§è½ä¸éä¸æ¯æèªå¨æéæ¢å¤ã\n * myisam - mysql 5.1 çæ¬åçé»è®¤å­å¨å¼æãç¹æ§ä¸°å¯ä½ä¸æ¯æäºå¡ï¼ä¹ä¸æ¯æè¡çº§éåå¤é®ï¼ä¹æ²¡ææéæ¢å¤åè½ã\n * csv - å¯ä»¥å° csv æä»¶ä½ä¸º mysql çè¡¨æ¥å¤çï¼ä½è¿ç§è¡¨ä¸æ¯æç´¢å¼ã\n * memory ãææçæ°æ®é½å¨åå­ä¸­ï¼æ°æ®çå¤çéåº¦å¿«ï¼ä½æ¯å®å¨æ§ä¸é«ã\n\n\n# innodb vs. myisam\n\ninnodb å myisam æ¯ç®åä½¿ç¨çæå¤çä¸¤ç§ mysql å­å¨å¼æã\n\n * æ°æ®ç»ææ¯è¾ï¼\n   * innodb å myisam çç´¢å¼æ°æ®ç»æé½æ¯ b+ æ ã\n   * myiasm ç b+ æ ä¸­å­å¨çåå®¹å®éä¸æ¯å®éæ°æ®çå°åå¼ãä¹å°±æ¯è¯´å®çç´¢å¼åå®éæ°æ®æ¯åå¼çï¼åªä¸è¿ä½¿ç¨ç´¢å¼æåäºå®éæ°æ®ãè¿ç§ç´¢å¼çæ¨¡å¼è¢«ç§°ä¸ºéèéç´¢å¼ã\n   * innodb ç b+ æ ä¸­å­å¨çåå®¹æ¯å®éçæ°æ®ï¼è¿ç§ç´¢å¼æè¢«ç§°ä¸ºèéç´¢å¼ã\n * äºå¡æ¯ææ¯è¾ï¼\n   * innodb æ¯æäºå¡ï¼å¹¶æä¾äºè¡çº§éåå¤é®ççº¦æã\n   * myiasm ä¸æ¯æäºå¡ï¼ä¹ä¸æ¯æè¡çº§éåå¤é®ã\n * æéæ¢å¤æ¯è¾ï¼\n   * innodb æ¯ææéæ¢å¤ã\n   * myisam ä¸æ¯ææéæ¢å¤ã\n\n\n# æ°æ®åºæ¯è¾\n\n\n# å¸¸è§æ°æ®åºæ¯è¾\n\n * oracle - ä¹è´çåçåä¸æ°æ®åºãåè½å¼ºå¤§ãç¨³å®ãæå¤§çç¼ºç¹å°±æ¯è´¹é±ã\n * mysql - æ¾ç»æ¯äºèç½å¬å¸çæç±ï¼ä½èªå¨ mysql è¢« oracle å¬å¸æ¶è´­åï¼å¥½æ¥å­å¯è½ä¸å»ä¸å¤è¿ãå¾å¤å¬å¸æå¼æºé¡¹ç®å·²ç»éæ¸å¯»æ¾å¶ä»çå¼æºäº§åæ¥æ¿ä»£ mysqlã\n * mariadb - å¼æºå³ç³»åæ°æ®åºã mysql ççæ­£å¼æºçåè¡çæ¬ï¼ç± mysql é¨åæ ¸å¿äººååå»ºãå¯ä½ä¸º mysql çæ¿ä»£äº§åã\n * postgresql - å¼æºå³ç³»åæ°æ®åºãå mysql çå·¥ä½æ¹å¼éå¸¸ç¸ä¼¼ï¼ç¤¾åºæ¯æåå¾å¾å¥½ãå¯ä½ä¸º mysql çæ¿ä»£äº§åã\n * sqlite - å¼æºçè½»éçº§æ°æ®åºï¼ç§»å¨ç«¯å¸¸å¸¸ä½¿ç¨ã\n * h2 - åå­æ°æ®åºï¼ä¸è¬ç¨ä½å¼åãæµè¯ç¯å¢æ°æ®åºã\n * sql server - å¾®è½¯ windows çæç³»ç»çæ°æ®åºãææ³ï¼java ç¨åºååºè¯¥æ²¡äººç¨å§ã\n\n\n# oracle vs. mysql\n\nç®åä¸ºæ­¢ï¼java é¢åç¨çæå¤çå³ç³»åæ°æ®åºï¼åºè¯¥è¿æ¯ oracle å mysqlï¼æä»¥è¿éåä¸ä¸æ¯è¾ã\n\n# æ°æ®åºå¯¹è±¡å·®å¼\n\nå¨ mysql ä¸­ï¼ä¸ä¸ªç¨æ·å¯ä»¥åå»ºå¤ä¸ªåºã\n\nèå¨ oracle ä¸­ï¼oracle æå¡å¨æ¯ç±ä¸¤é¨åç»æ\n\n * æ°æ®åºå®ä¾ãçè§£ä¸ºå¯¹è±¡ï¼çä¸è§çã\n * æ°æ®åºãçè§£ä¸ºç±»ï¼çå¾è§çã\n\nä¸ä¸ªæ°æ®åºå®ä¾å¯æ¥æå¤ä¸ªç¨æ·ï¼ä¸ä¸ªç¨æ·é»è®¤æ¥æä¸ä¸ªè¡¨ç©ºé´ã\n\nè¡¨ç©ºé´æ¯å­å¨æä»¬æ°æ®åºè¡¨çå°æ¹ï¼è¡¨ç©ºé´åå¯ä»¥æå¤ä¸ªæä»¶ã\n\n# sql å·®å¼\n\nï¼1ï¼ä¸»é®éå¢\n\nmysql å¯ä»¥è®¾ç½® auto_increment çº¦ææ¥æå®ä¸»é®ä¸ºèªå¢åºåã\n\noracle éè¦éè¿ create sequence åå»ºåºåã\n\nï¼2ï¼åé¡µæ¥è¯¢\n\nmysql åé¡µåºäº select ... from ... limit ... å®æï¼è¾ç®åã\n\nselect * from help_category order by parent_category_id limit 10,5;\n\n\noracle åé¡µåºäº select ... from (select rownum ...) where ... å®æï¼è¾å¤æã\n\nselect * from\n(select rownum rr,a.* from (select * from emp order by sal) a )\nwhere rr>5 and rr<=10;\n\n\n# äºå¡å·®å¼\n\n * auto commit\n   * mysql äºå¡æ¯ autocommit æ¨¡å¼ï¼å³èªå¨æäº¤äºå¡ï¼\n   * oracle äºå¡éè¦æå¨ commitã\n * äºå¡éç¦»çº§å«\n   * mysql é»è®¤çäºå¡éç¦»çº§å«æ¯å¯éå¤è¯»ï¼repeatable readï¼\n   * oracle æ¯æè¯»å·²æäº¤ï¼read committedï¼åä¸²è¡åï¼serializableï¼ ä¸¤ç§äºå¡éç¦»çº§å«ï¼é»è®¤äºå¡éç¦»çº§å«æ¯è¯»å·²æäº¤ï¼read committedï¼\n\n\n# æ°æ®ç±»åæ¯è¾\n\n> ä¸åæ°æ®åºä¸­ï¼å¯¹æ°æ®ç±»åçæ¯ææ¯ä¸ä¸æ ·çã\n> \n> å³ä½¿å­å¨åä¸ç§æ°æ®ç±»åï¼ä¹å¯è½å­å¨åç§°ä¸åãæå¤§å°ä¸åç­é®é¢ã\n> \n> å æ­¤ï¼å¯¹äºæ°æ®ç±»åçæ¯æè¯¦æå¿é¡»åèåæ°æ®åºçå®æ¹ææ¡£ã\n\nä¸é¢åä¸¾ä¸äºå¸¸è§æ°æ®ç±»åå¯¹æ¯ï¼\n\næ°æ®ç±»å                oracle             mysql         postgresql\nboolean             byte               n/a           boolean\ninteger             number             int integer   int integer\nfloat               number             float         numeric\ncurrency            n/a                n/a           money\nstring (fixed)      char               char          char\nstring (variable)   varchar varchar2   varchar       varchar\nbinary object       long raw           blob text     binary varbinary\n\n> æ°æ®ç±»åå¯¹æ¯è¡¨æèª sql éç¨æ°æ®ç±»åãsql ç¨äºåç§æ°æ®åºçæ°æ®ç±»å\n\n\n# sql faq\n\n\n# select count(*)ãselect count(1) å select count(å·ä½å­æ®µ) æ§è½æå·®å«åï¼\n\nå¨ mysql innodb å­å¨å¼æä¸­ï¼count(*) å count(1) é½æ¯å¯¹ææç»æè¿è¡ countãå æ­¤count(*)åcount(1)æ¬è´¨ä¸å¹¶æ²¡æåºå«ï¼æ§è¡çå¤æåº¦é½æ¯ o(n)ï¼ä¹å°±æ¯éç¨å¨è¡¨æ«æï¼è¿è¡å¾ªç¯ + è®¡æ°çæ¹å¼è¿è¡ç»è®¡ã\n\nå¦ææ¯ mysql myisam å­å¨å¼æï¼ç»è®¡æ°æ®è¡¨çè¡æ°åªéè¦o(1)çå¤æåº¦ï¼è¿æ¯å ä¸ºæ¯å¼  myisam çæ°æ®è¡¨é½æä¸ä¸ª meta ä¿¡æ¯å­å¨äºrow_countå¼ï¼èä¸è´æ§åç±è¡¨çº§éæ¥ä¿è¯ãå ä¸º innodb æ¯æäºå¡ï¼éç¨è¡çº§éå mvcc æºå¶ï¼æä»¥æ æ³å myisam ä¸æ ·ï¼åªç»´æ¤ä¸ä¸ªrow_countåéï¼å æ­¤éè¦éç¨æ«æå¨è¡¨ï¼è¿è¡å¾ªç¯ + è®¡æ°çæ¹å¼æ¥å®æç»è®¡ã\n\néè¦æ³¨æçæ¯ï¼å¨å®éæ§è¡ä¸­ï¼count(*)åcount(1)çæ§è¡æ¶é´å¯è½ç¥æå·®å«ï¼ä¸è¿ä½ è¿æ¯å¯ä»¥æå®ä¿©çæ§è¡æççææ¯ç¸ç­çã\n\nå¦å¤å¨ innodb å¼æä¸­ï¼å¦æéç¨count(*)åcount(1)æ¥ç»è®¡æ°æ®è¡æ°ï¼è¦å°½ééç¨äºçº§ç´¢å¼ãå ä¸ºä¸»é®éç¨çç´¢å¼æ¯èç°ç´¢å¼ï¼èç°ç´¢å¼åå«çä¿¡æ¯å¤ï¼ææ¾ä¼å¤§äºäºçº§ç´¢å¼ï¼éèç°ç´¢å¼ï¼ãå¯¹äºcount(*)åcount(1)æ¥è¯´ï¼å®ä»¬ä¸éè¦æ¥æ¾å·ä½çè¡ï¼åªæ¯ç»è®¡è¡æ°ï¼ç³»ç»ä¼èªå¨éç¨å ç¨ç©ºé´æ´å°çäºçº§ç´¢å¼æ¥è¿è¡ç»è®¡ã\n\nç¶èå¦ææ³è¦æ¥æ¾å·ä½çè¡ï¼é£ä¹éç¨ä¸»é®ç´¢å¼çæçæ´é«ãå¦ææå¤ä¸ªäºçº§ç´¢å¼ï¼ä¼ä½¿ç¨ key_len å°çäºçº§ç´¢å¼è¿è¡æ«æãå½æ²¡æäºçº§ç´¢å¼çæ¶åï¼æä¼éç¨ä¸»é®ç´¢å¼æ¥è¿è¡ç»è®¡ã\n\nè¿éææ»ç»ä¸ä¸ï¼\n\n 1. ä¸è¬æåµä¸ï¼ä¸èæ§è¡çæçä¸º count(*)= count(1)> count(å­æ®µ)ãæä»¬å°½éä½¿ç¨count(*)ï¼å½ç¶å¦æä½ è¦ç»è®¡çæ¯æä¸ªå­æ®µçéç©ºæ°æ®è¡æ°ï¼åå¦å½å«è®ºï¼æ¯ç«æ¯è¾æ§è¡æççåææ¯ç»æä¸æ ·æå¯ä»¥ã\n 2. å¦æè¦ç»è®¡count(*)ï¼å°½éå¨æ°æ®è¡¨ä¸å»ºç«äºçº§ç´¢å¼ï¼ç³»ç»ä¼èªå¨éç¨key_lenå°çäºçº§ç´¢å¼è¿è¡æ«æï¼è¿æ ·å½æä»¬ä½¿ç¨select count(*)çæ¶åæçå°±ä¼æåï¼ææ¶åå¯ä»¥æåå åçè³æ´é«ã\n\n> ââæèªæå®¢æ¶é´ - sql å¿ç¥å¿ä¼\n\n\n# order by æ¯å¯¹åçç»æåºè¿æ¯å¯¹åç»ä¸­çè®°å½æåºå¢ï¼\n\norder by å°±æ¯å¯¹è®°å½è¿è¡æåºãå¦æä½ å¨ order by åé¢ç¨å°äº group byï¼å®éä¸è¿æ¯ä¸ç§åç»çèåæ¹å¼ï¼å·²ç»æä¸ç»çæ°æ®èåæä¸ºäºä¸æ¡è®°å½ï¼åè¿è¡æåºçæ¶åï¼ç¸å½äºå¯¹åçç»è¿è¡äºæåºã\n\n\n# select è¯­å¥åé¨çæ§è¡æ­¥éª¤\n\nä¸æ¡å®æ´ç select è¯­å¥åé¨çæ§è¡é¡ºåºæ¯è¿æ ·çï¼\n\n 1. from å­å¥ç»è£æ°æ®ï¼åæ¬éè¿ on è¿è¡è¿æ¥ï¼ï¼\n 2. where å­å¥è¿è¡æ¡ä»¶ç­éï¼\n 3. group by åç» ï¼\n 4. ä½¿ç¨èéå½æ°è¿è¡è®¡ç®ï¼\n 5. having ç­éåç»ï¼\n 6. è®¡ç®ææçè¡¨è¾¾å¼ï¼\n 7. select çå­æ®µï¼\n 8. order by æåºï¼\n 9. limit ç­éã\n\n> ââæèªæå®¢æ¶é´ - sql å¿ç¥å¿ä¼\n\n\n# è§£åªç§æåµä¸åºè¯¥ä½¿ç¨ existsï¼åªç§æåµåºè¯¥ç¨ in\n\nç´¢å¼æ¯ä¸ªåæï¼å¶å®éæ©ä¸å¦è¿æ¯è¦çè¡¨çå¤§å°ãä½ å¯ä»¥å°éæ©çæ åçè§£ä¸ºå°è¡¨é©±å¨å¤§è¡¨ãå¨è¿ç§æ¹å¼ä¸æçæ¯æé«çã\n\næ¯å¦ä¸é¢è¿æ ·ï¼\n\n select * from a where cc in (select cc from b)\n select * from a where exists (select cc from b where b.cc=a.cc)\n\n\nå½ a å°äº b æ¶ï¼ç¨ existsãå ä¸º exists çå®ç°ï¼ç¸å½äºå¤è¡¨å¾ªç¯ï¼å®ç°çé»è¾ç±»ä¼¼äºï¼\n\n for i in a\n     for j in b\n         if j.cc == i.cc then ...\n\n\nå½ b å°äº a æ¶ç¨ inï¼å ä¸ºå®ç°çé»è¾ç±»ä¼¼äºï¼\n\n for i in b\n     for j in a\n         if j.cc == i.cc then ...\n\n\nåªä¸ªè¡¨å°å°±ç¨åªä¸ªè¡¨æ¥é©±å¨ï¼a è¡¨å°å°±ç¨ existsï¼b è¡¨å°å°±ç¨ inã\n\n> ââæèªæå®¢æ¶é´ - sql å¿ç¥å¿ä¼\n\n\n# åèèµæ\n\n * æ°æ®åºé¢è¯é¢(å¼åèå¿ç)\n * æ°æ®åºç³»ç»åç\n * æ°æ®åºä¸¤å¤§ç¥å¨ãç´¢å¼åéã\n * ååºåè¡¨éè¦èèçé®é¢åæ¹æ¡\n * æ°æ®åºååºåè¡¨(sharding)ç³»å(äº) å¨å±ä¸»é®çæç­ç¥\n * ä¸ç§æ¯æèªç±è§åæ é¡»æ°æ®è¿ç§»åä¿®æ¹è·¯ç±ä»£ç ç sharding æ©å®¹æ¹æ¡\n * shardingsphere åå¸å¼äºå¡\n * mysql å oracle çåºå«\n * runoob sql æç¨\n * å¦ææäººé®ä½ æ°æ®åºçåçï¼å«ä»çè¿ç¯æç« ",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"SQL è¯­æ³é«çº§ç¹æ§",frontmatter:{title:"SQL è¯­æ³é«çº§ç¹æ§",date:"2022-04-27T22:13:55.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","ç»¼å"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","SQL"],permalink:"/pages/1ae1ca/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/01.%E7%BB%BC%E5%90%88/03.SQL%E8%AF%AD%E6%B3%95%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7.html",relativePath:"12.æ°æ®åº/03.å³ç³»åæ°æ®åº/01.ç»¼å/03.SQLè¯­æ³é«çº§ç¹æ§.md",key:"v-cf9e4d54",path:"/pages/1ae1ca/",headers:[{level:2,title:"è¿æ¥åç»å",slug:"è¿æ¥åç»å",normalizedTitle:"è¿æ¥åç»å",charIndex:106},{level:3,title:"è¿æ¥ï¼JOINï¼",slug:"è¿æ¥-join",normalizedTitle:"è¿æ¥ï¼joinï¼",charIndex:116},{level:4,title:"åè¿æ¥ï¼INNER JOINï¼",slug:"åè¿æ¥-inner-join",normalizedTitle:"åè¿æ¥ï¼inner joinï¼",charIndex:300},{level:5,title:"èªè¿æ¥ï¼=ï¼",slug:"èªè¿æ¥",normalizedTitle:"èªè¿æ¥ï¼=ï¼",charIndex:481},{level:5,title:"èªç¶è¿æ¥ï¼NATURAL JOINï¼",slug:"èªç¶è¿æ¥-natural-join",normalizedTitle:"èªç¶è¿æ¥ï¼natural joinï¼",charIndex:700},{level:4,title:"å¤è¿æ¥ï¼OUTER JOINï¼",slug:"å¤è¿æ¥-outer-join",normalizedTitle:"å¤è¿æ¥ï¼outer joinï¼",charIndex:822},{level:5,title:"å·¦è¿æ¥ï¼LEFT JOINï¼",slug:"å·¦è¿æ¥-left-join",normalizedTitle:"å·¦è¿æ¥ï¼left joinï¼",charIndex:921},{level:5,title:"å³è¿æ¥ï¼RIGHT JOINï¼",slug:"å³è¿æ¥-right-join",normalizedTitle:"å³è¿æ¥ï¼right joinï¼",charIndex:1074},{level:3,title:"ç»åï¼UNIONï¼",slug:"ç»å-union",normalizedTitle:"ç»åï¼unionï¼",charIndex:1230},{level:3,title:"JOIN vs UNION",slug:"join-vs-union",normalizedTitle:"join vs union",charIndex:1708},{level:2,title:"å½æ°",slug:"å½æ°",normalizedTitle:"å½æ°",charIndex:1838},{level:3,title:"ææ¬å¤ç",slug:"ææ¬å¤ç",normalizedTitle:"ææ¬å¤ç",charIndex:1895},{level:3,title:"æ¥æåæ¶é´å¤ç",slug:"æ¥æåæ¶é´å¤ç",normalizedTitle:"æ¥æåæ¶é´å¤ç",charIndex:2163},{level:3,title:"æ°å¼å¤ç",slug:"æ°å¼å¤ç",normalizedTitle:"æ°å¼å¤ç",charIndex:2748},{level:3,title:"æ±æ»",slug:"æ±æ»",normalizedTitle:"æ±æ»",charIndex:2882},{level:2,title:"åç»",slug:"åç»",normalizedTitle:"åç»",charIndex:3097},{level:3,title:"GROUP BY",slug:"group-by",normalizedTitle:"group by",charIndex:3104},{level:3,title:"HAVING",slug:"having",normalizedTitle:"having",charIndex:3487},{level:2,title:"äºå¡",slug:"äºå¡",normalizedTitle:"äºå¡",charIndex:3873},{level:3,title:"ACID",slug:"acid",normalizedTitle:"acid",charIndex:4671},{level:3,title:"äºå¡éç¦»çº§å«",slug:"äºå¡éç¦»çº§å«",normalizedTitle:"äºå¡éç¦»çº§å«",charIndex:4680},{level:2,title:"æéæ§å¶",slug:"æéæ§å¶",normalizedTitle:"æéæ§å¶",charIndex:4749},{level:3,title:"åå»ºè´¦æ·",slug:"åå»ºè´¦æ·",normalizedTitle:"åå»ºè´¦æ·",charIndex:5032},{level:3,title:"ä¿®æ¹è´¦æ·å",slug:"ä¿®æ¹è´¦æ·å",normalizedTitle:"ä¿®æ¹è´¦æ·å",charIndex:5090},{level:3,title:"å é¤è´¦æ·",slug:"å é¤è´¦æ·",normalizedTitle:"å é¤è´¦æ·",charIndex:5172},{level:3,title:"æ¥çæé",slug:"æ¥çæé",normalizedTitle:"æ¥çæé",charIndex:5201},{level:3,title:"æäºæé",slug:"æäºæé",normalizedTitle:"æäºæé",charIndex:5236},{level:3,title:"å é¤æé",slug:"å é¤æé",normalizedTitle:"å é¤æé",charIndex:5286},{level:3,title:"æ´æ¹å¯ç ",slug:"æ´æ¹å¯ç ",normalizedTitle:"æ´æ¹å¯ç ",charIndex:5339},{level:2,title:"å­å¨è¿ç¨",slug:"å­å¨è¿ç¨",normalizedTitle:"å­å¨è¿ç¨",charIndex:4894},{level:3,title:"ä½¿ç¨å­å¨è¿ç¨",slug:"ä½¿ç¨å­å¨è¿ç¨",normalizedTitle:"ä½¿ç¨å­å¨è¿ç¨",charIndex:5653},{level:3,title:"å­å¨è¿ç¨çå©å¼",slug:"å­å¨è¿ç¨çå©å¼",normalizedTitle:"å­å¨è¿ç¨çå©å¼",charIndex:6488},{level:3,title:"è§¦åå¨",slug:"è§¦åå¨",normalizedTitle:"è§¦åå¨",charIndex:7020},{level:4,title:"è§¦åå¨ç¹æ§",slug:"è§¦åå¨ç¹æ§",normalizedTitle:"è§¦åå¨ç¹æ§",charIndex:7115},{level:4,title:"è§¦åå¨æä»¤",slug:"è§¦åå¨æä»¤",normalizedTitle:"è§¦åå¨æä»¤",charIndex:7871},{level:2,title:"æ¸¸æ ",slug:"æ¸¸æ ",normalizedTitle:"æ¸¸æ ",charIndex:8660},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:9712}],headersStr:"è¿æ¥åç»å è¿æ¥ï¼JOINï¼ åè¿æ¥ï¼INNER JOINï¼ èªè¿æ¥ï¼=ï¼ èªç¶è¿æ¥ï¼NATURAL JOINï¼ å¤è¿æ¥ï¼OUTER JOINï¼ å·¦è¿æ¥ï¼LEFT JOINï¼ å³è¿æ¥ï¼RIGHT JOINï¼ ç»åï¼UNIONï¼ JOIN vs UNION å½æ° ææ¬å¤ç æ¥æåæ¶é´å¤ç æ°å¼å¤ç æ±æ» åç» GROUP BY HAVING äºå¡ ACID äºå¡éç¦»çº§å« æéæ§å¶ åå»ºè´¦æ· ä¿®æ¹è´¦æ·å å é¤è´¦æ· æ¥çæé æäºæé å é¤æé æ´æ¹å¯ç  å­å¨è¿ç¨ ä½¿ç¨å­å¨è¿ç¨ å­å¨è¿ç¨çå©å¼ è§¦åå¨ è§¦åå¨ç¹æ§ è§¦åå¨æä»¤ æ¸¸æ  åèèµæ",content:"# SQL è¯­æ³é«çº§ç¹æ§\n\n> æ¬æéå¯¹å³ç³»åæ°æ®åºçåºæ¬è¯­æ³ãéäºç¯å¹ï¼æ¬æä¾§éè¯´æç¨æ³ï¼ä¸ä¼å±å¼è®²è§£ç¹æ§ãåçã\n> \n> æ¬æè¯­æ³ä¸»è¦éå¯¹ Mysqlï¼ä½å¤§é¨åçè¯­æ³å¯¹å¶ä»å³ç³»åæ°æ®åºä¹éç¨ã\n\n\n\n\n# è¿æ¥åç»å\n\n\n# è¿æ¥ï¼JOINï¼\n\n> è¿æ¥ç¨äºè¿æ¥å¤ä¸ªè¡¨ï¼ä½¿ç¨ JOIN å³é®å­ï¼å¹¶ä¸æ¡ä»¶è¯­å¥ä½¿ç¨ ON èä¸æ¯ WHEREã\n\nå¦æä¸ä¸ª JOIN è³å°æä¸ä¸ªå¬å±å­æ®µå¹¶ä¸å®ä»¬ä¹é´å­å¨å³ç³»ï¼åè¯¥ JOIN å¯ä»¥å¨ä¸¤ä¸ªæå¤ä¸ªè¡¨ä¸å·¥ä½ã\n\nJOIN ä¿æåºè¡¨ï¼ç»æåæ°æ®ï¼ä¸åãè¿æ¥å¯ä»¥æ¿æ¢å­æ¥è¯¢ï¼å¹¶ä¸æ¯å­æ¥è¯¢çæçä¸è¬ä¼æ´å¿«ã\n\nJOIN æä¸¤ç§è¿æ¥ç±»åï¼åè¿æ¥åå¤è¿æ¥ã\n\n\n\n# åè¿æ¥ï¼INNER JOINï¼\n\nåè¿æ¥åç§°ç­å¼è¿æ¥ï¼ä½¿ç¨ INNER JOIN å³é®å­ãå¨æ²¡ææ¡ä»¶è¯­å¥çæåµä¸è¿åç¬å¡å°ç§¯ã\n\nSELECT vend_name, prod_name, prod_price\nFROM vendors INNER JOIN products\nON vendors.vend_id = products.vend_id;\n\n\n# èªè¿æ¥ï¼=ï¼\n\nèªè¿æ¥å¯ä»¥çæåè¿æ¥çä¸ç§ï¼åªæ¯è¿æ¥çè¡¨æ¯èªèº«èå·²ãèªç¶è¿æ¥æ¯æåååéè¿ = è¿æ¥èµ·æ¥çï¼åååå¯ä»¥æå¤ä¸ªã\n\nSELECT c1.cust_id, c1.cust_name, c1.cust_contact\nFROM customers c1, customers c2\nWHERE c1.cust_name = c2.cust_name\nAND c2.cust_contact = 'Jim Jones';\n\n\n# èªç¶è¿æ¥ï¼NATURAL JOINï¼\n\nåè¿æ¥æä¾è¿æ¥çåï¼èèªç¶è¿æ¥èªå¨è¿æ¥ææåååãèªç¶è¿æ¥ä½¿ç¨ NATURAL JOIN å³é®å­ã\n\nSELECT *\nFROM Products\nNATURAL JOIN Customers;\n\n\n# å¤è¿æ¥ï¼OUTER JOINï¼\n\nå¤è¿æ¥è¿åä¸ä¸ªè¡¨ä¸­çææè¡ï¼å¹¶ä¸ä»è¿åæ¥èªæ­¤è¡¨ä¸­æ»¡è¶³è¿æ¥æ¡ä»¶çé£äºè¡ï¼å³ä¸¤ä¸ªè¡¨ä¸­çåæ¯ç¸ç­çãå¤è¿æ¥åä¸ºå·¦å¤è¿æ¥ãå³å¤è¿æ¥ãå¨å¤è¿æ¥ï¼Mysql ä¸æ¯æï¼ã\n\n# å·¦è¿æ¥ï¼LEFT JOINï¼\n\nå·¦å¤è¿æ¥å°±æ¯ä¿çå·¦è¡¨æ²¡æå³èçè¡ã\n\nSELECT customers.cust_id, orders.order_num\nFROM customers LEFT JOIN orders\nON customers.cust_id = orders.cust_id;\n\n\n# å³è¿æ¥ï¼RIGHT JOINï¼\n\nå³å¤è¿æ¥å°±æ¯ä¿çå³è¡¨æ²¡æå³èçè¡ã\n\nSELECT customers.cust_id, orders.order_num\nFROM customers RIGHT JOIN orders\nON customers.cust_id = orders.cust_id;\n\n\n\n# ç»åï¼UNIONï¼\n\n> UNION è¿ç®ç¬¦å°ä¸¤ä¸ªææ´å¤æ¥è¯¢çç»æç»åèµ·æ¥ï¼å¹¶çæä¸ä¸ªç»æéï¼å¶ä¸­åå«æ¥èª UNION ä¸­åä¸æ¥è¯¢çæåè¡ã\n\nUNION åºæ¬è§åï¼\n\n * æææ¥è¯¢çåæ°ååé¡ºåºå¿é¡»ç¸åã\n * æ¯ä¸ªæ¥è¯¢ä¸­æ¶åè¡¨çåçæ°æ®ç±»åå¿é¡»ç¸åæå¼å®¹ã\n * éå¸¸è¿åçåååèªç¬¬ä¸ä¸ªæ¥è¯¢ã\n\né»è®¤ä¼å»é¤ç¸åè¡ï¼å¦æéè¦ä¿çç¸åè¡ï¼ä½¿ç¨ UNION ALLã\n\nåªè½åå«ä¸ä¸ª ORDER BY å­å¥ï¼å¹¶ä¸å¿é¡»ä½äºè¯­å¥çæåã\n\nåºç¨åºæ¯ï¼\n\n * å¨ä¸ä¸ªæ¥è¯¢ä¸­ä»ä¸åçè¡¨è¿åç»ææ°æ®ã\n * å¯¹ä¸ä¸ªè¡¨æ§è¡å¤ä¸ªæ¥è¯¢ï¼æä¸ä¸ªæ¥è¯¢è¿åæ°æ®ã\n\nç»åæ¥è¯¢ç¤ºä¾ï¼\n\nSELECT cust_name, cust_contact, cust_email\nFROM customers\nWHERE cust_state IN ('IL', 'IN', 'MI')\nUNION\nSELECT cust_name, cust_contact, cust_email\nFROM customers\nWHERE cust_name = 'Fun4All';\n\n\n\n# JOIN vs UNION\n\n * JOIN ä¸­è¿æ¥è¡¨çåå¯è½ä¸åï¼ä½å¨ UNION ä¸­ï¼æææ¥è¯¢çåæ°ååé¡ºåºå¿é¡»ç¸åã\n * UNION å°æ¥è¯¢ä¹åçè¡æ¾å¨ä¸èµ·ï¼åç´æ¾ç½®ï¼ï¼ä½ JOIN å°æ¥è¯¢ä¹åçåæ¾å¨ä¸èµ·ï¼æ°´å¹³æ¾ç½®ï¼ï¼å³å®ææä¸ä¸ªç¬å¡å°ç§¯ã\n\n\n# å½æ°\n\n> ð æ³¨æï¼ä¸åæ°æ®åºçå½æ°å¾å¾åä¸ç¸åï¼å æ­¤ä¸å¯ç§»æ¤ãæ¬èä¸»è¦ä»¥ Mysql çå½æ°ä¸ºä¾ã\n\n\n# ææ¬å¤ç\n\nå½æ°                è¯´æ\nLEFT()ãRIGHT()    å·¦è¾¹æèå³è¾¹çå­ç¬¦\nLOWER()ãUPPER()   è½¬æ¢ä¸ºå°åæèå¤§å\nLTRIM()ãRTIM()    å»é¤å·¦è¾¹æèå³è¾¹çç©ºæ ¼\nLENGTH()          é¿åº¦\nSOUNDEX()         è½¬æ¢ä¸ºè¯­é³å¼\n\nå¶ä¸­ï¼ SOUNDEX() å¯ä»¥å°ä¸ä¸ªå­ç¬¦ä¸²è½¬æ¢ä¸ºæè¿°å¶è¯­é³è¡¨ç¤ºçå­æ¯æ°å­æ¨¡å¼ã\n\nSELECT *\nFROM mytable\nWHERE SOUNDEX(col1) = SOUNDEX('apple')\n\n\n\n# æ¥æåæ¶é´å¤ç\n\n * æ¥ææ ¼å¼ï¼YYYY-MM-DD\n * æ¶é´æ ¼å¼ï¼HH:MM:SS\n\nå½ æ°             è¯´ æ\nAddDate()       å¢å ä¸ä¸ªæ¥æï¼å¤©ãå¨ç­ï¼\nAddTime()       å¢å ä¸ä¸ªæ¶é´ï¼æ¶ãåç­ï¼\nCurDate()       è¿åå½åæ¥æ\nCurTime()       è¿åå½åæ¶é´\nDate()          è¿åæ¥ææ¶é´çæ¥æé¨å\nDateDiff()      è®¡ç®ä¸¤ä¸ªæ¥æä¹å·®\nDate_Add()      é«åº¦çµæ´»çæ¥æè¿ç®å½æ°\nDate_Format()   è¿åä¸ä¸ªæ ¼å¼åçæ¥æææ¶é´ä¸²\nDay()           è¿åä¸ä¸ªæ¥æçå¤©æ°é¨å\nDayOfWeek()     å¯¹äºä¸ä¸ªæ¥æï¼è¿åå¯¹åºçææå \nHour()          è¿åä¸ä¸ªæ¶é´çå°æ¶é¨å\nMinute()        è¿åä¸ä¸ªæ¶é´çåéé¨å\nMonth()         è¿åä¸ä¸ªæ¥æçæä»½é¨å\nNow()           è¿åå½åæ¥æåæ¶é´\nSecond()        è¿åä¸ä¸ªæ¶é´çç§é¨å\nTime()          è¿åä¸ä¸ªæ¥ææ¶é´çæ¶é´é¨å\nYear()          è¿åä¸ä¸ªæ¥æçå¹´ä»½é¨å\n\nmysql> SELECT NOW();\n\n\n2018-4-14 20:25:11\n\n\n\n# æ°å¼å¤ç\n\nå½æ°       è¯´æ\nSIN()    æ­£å¼¦\nCOS()    ä½å¼¦\nTAN()    æ­£å\nABS()    ç»å¯¹å¼\nSQRT()   å¹³æ¹æ ¹\nMOD()    ä½æ°\nEXP()    ææ°\nPI()     åå¨ç\nRAND()   éæºæ°\n\n\n# æ±æ»\n\nå½ æ°       è¯´ æ\nAVG()     è¿åæåçå¹³åå¼\nCOUNT()   è¿åæåçè¡æ°\nMAX()     è¿åæåçæå¤§å¼\nMIN()     è¿åæåçæå°å¼\nSUM()     è¿åæåå¼ä¹å\n\nAVG() ä¼å¿½ç¥ NULL è¡ã\n\nä½¿ç¨ DISTINCT å¯ä»¥è®©æ±æ»å½æ°å¼æ±æ»ä¸åçå¼ã\n\nSELECT AVG(DISTINCT col1) AS avg_col\nFROM mytable\n\n\n\n# åç»\n\n\n# GROUP BY\n\n> GROUP BY å­å¥å°è®°å½åç»å°æ±æ»è¡ä¸­ï¼GROUP BY ä¸ºæ¯ä¸ªç»è¿åä¸ä¸ªè®°å½ã\n\nGROUP BY å¯ä»¥æä¸åæå¤åè¿è¡åç»ã\n\nGROUP BY éå¸¸è¿æ¶åèåå½æ°ï¼COUNTï¼MAXï¼SUMï¼AVG ç­ã\n\nGROUP BY æåç»å­æ®µè¿è¡æåºåï¼ORDER BY å¯ä»¥ä»¥æ±æ»å­æ®µæ¥è¿è¡æåºã\n\nåç»ç¤ºä¾ï¼\n\nSELECT cust_name, COUNT(cust_address) AS addr_num\nFROM Customers GROUP BY cust_name;\n\n\nåç»åæåºç¤ºä¾ï¼\n\nSELECT cust_name, COUNT(cust_address) AS addr_num\nFROM Customers GROUP BY cust_name\nORDER BY cust_name DESC;\n\n\n\n# HAVING\n\n> HAVING ç¨äºå¯¹æ±æ»ç GROUP BY ç»æè¿è¡è¿æ»¤ãHAVING è¦æ±å­å¨ä¸ä¸ª GROUP BY å­å¥ã\n\nWHERE å HAVING å¯ä»¥å¨ç¸åçæ¥è¯¢ä¸­ã\n\nHAVING vs WHEREï¼\n\n * WHERE å HAVING é½æ¯ç¨äºè¿æ»¤ã\n * HAVING éç¨äºæ±æ»çç»è®°å½ï¼è WHERE éç¨äºåä¸ªè®°å½ã\n\nä½¿ç¨ WHERE å HAVING è¿æ»¤æ°æ®ç¤ºä¾ï¼\n\nSELECT cust_name, COUNT(*) AS num\nFROM Customers\nWHERE cust_email IS NOT NULL\nGROUP BY cust_name\nHAVING COUNT(*) >= 1;\n\n\n----------------------------------------\n\nï¼ä»¥ä¸ä¸º DDL è¯­å¥ç¨æ³ï¼\n\n\n# äºå¡\n\nä¸è½åé SELECT è¯­å¥ï¼åé SELECT è¯­å¥ä¹æ²¡æä¹ï¼ä¹ä¸è½åé CREATE å DROP è¯­å¥ã\n\nMySQL é»è®¤éç¨éå¼æäº¤ç­ç¥ï¼autocommitï¼ï¼æ¯æ§è¡ä¸æ¡è¯­å¥å°±æè¿æ¡è¯­å¥å½æä¸ä¸ªäºå¡ç¶åè¿è¡æäº¤ãå½åºç° START TRANSACTION è¯­å¥æ¶ï¼ä¼å³é­éå¼æäº¤ï¼å½ COMMIT æ ROLLBACK è¯­å¥æ§è¡åï¼äºå¡ä¼èªå¨å³é­ï¼éæ°æ¢å¤éå¼æäº¤ã\n\néè¿ set autocommit=0 å¯ä»¥åæ¶èªå¨æäº¤ï¼ç´å° set autocommit=1 æä¼æäº¤ï¼autocommit æ è®°æ¯éå¯¹æ¯ä¸ªè¿æ¥èä¸æ¯éå¯¹æå¡å¨çã\n\näºå¡å¤çæä»¤ï¼\n\n * START TRANSACTION - æä»¤ç¨äºæ è®°äºå¡çèµ·å§ç¹ã\n * SAVEPOINT - æä»¤ç¨äºåå»ºä¿çç¹ã\n * ROLLBACK TO - æä»¤ç¨äºåæ»å°æå®çä¿çç¹ï¼å¦ææ²¡æè®¾ç½®ä¿çç¹ï¼ååéå° START TRANSACTION è¯­å¥å¤ã\n * COMMIT - æäº¤äºå¡ã\n * RELEASE SAVEPOINTï¼å é¤æä¸ªä¿å­ç¹ã\n * SET TRANSACTIONï¼è®¾ç½®äºå¡çéç¦»çº§å«ã\n\näºå¡å¤çç¤ºä¾ï¼\n\n-- å¼å§äºå¡\nSTART TRANSACTION;\n\n-- æå¥æä½ A\nINSERT INTO `user`\nVALUES (1, 'root1', 'root1', 'xxxx@163.com');\n\n-- åå»ºä¿çç¹ updateA\nSAVEPOINT updateA;\n\n-- æå¥æä½ B\nINSERT INTO `user`\nVALUES (2, 'root2', 'root2', 'xxxx@163.com');\n\n-- åæ»å°ä¿çç¹ updateA\nROLLBACK TO updateA;\n\n-- æäº¤äºå¡ï¼åªææä½ A çæ\nCOMMIT;\n\n\n\n# ACID\n\n\n# äºå¡éç¦»çº§å«\n\n----------------------------------------\n\nï¼ä»¥ä¸ä¸º DCL è¯­å¥ç¨æ³ï¼\n\n\n# æéæ§å¶\n\nGRANT å REVOKE å¯å¨å ä¸ªå±æ¬¡ä¸æ§å¶è®¿é®æéï¼\n\n * æ´ä¸ªæå¡å¨ï¼ä½¿ç¨ GRANT ALL å REVOKE ALLï¼\n * æ´ä¸ªæ°æ®åºï¼ä½¿ç¨ ON database.*ï¼\n * ç¹å®çè¡¨ï¼ä½¿ç¨ ON database.tableï¼\n * ç¹å®çåï¼\n * ç¹å®çå­å¨è¿ç¨ã\n\næ°åå»ºçè´¦æ·æ²¡æä»»ä½æéã\n\nè´¦æ·ç¨ username@host çå½¢å¼å®ä¹ï¼username@% ä½¿ç¨çæ¯é»è®¤ä¸»æºåã\n\nMySQL çè´¦æ·ä¿¡æ¯ä¿å­å¨ mysql è¿ä¸ªæ°æ®åºä¸­ã\n\nUSE mysql;\nSELECT user FROM user;\n\n\n\n# åå»ºè´¦æ·\n\nCREATE USER myuser IDENTIFIED BY 'mypassword';\n\n\n\n# ä¿®æ¹è´¦æ·å\n\nUPDATE user SET user='newuser' WHERE user='myuser';\nFLUSH PRIVILEGES;\n\n\n\n# å é¤è´¦æ·\n\nDROP USER myuser;\n\n\n\n# æ¥çæé\n\nSHOW GRANTS FOR myuser;\n\n\n\n# æäºæé\n\nGRANT SELECT, INSERT ON *.* TO myuser;\n\n\n\n# å é¤æé\n\nREVOKE SELECT, INSERT ON *.* FROM myuser;\n\n\n\n# æ´æ¹å¯ç \n\nSET PASSWORD FOR myuser = 'mypass';\n\n\n\n# å­å¨è¿ç¨\n\nå­å¨è¿ç¨çè±ææ¯ Stored Procedureãå®å¯ä»¥è§ä¸ºä¸ç» SQL è¯­å¥çæ¹å¤çãä¸æ¦å­å¨è¿ç¨è¢«åå»ºåºæ¥ï¼ä½¿ç¨å®å°±åä½¿ç¨å½æ°ä¸æ ·ç®åï¼æä»¬ç´æ¥éè¿è°ç¨å­å¨è¿ç¨åå³å¯ã\n\nå®ä¹å­å¨è¿ç¨çè¯­æ³æ ¼å¼ï¼\n\nCREATE PROCEDURE å­å¨è¿ç¨åç§° ([åæ°åè¡¨])\nBEGIN\n    éè¦æ§è¡çè¯­å¥\nEND\n\n\nå­å¨è¿ç¨å®ä¹è¯­å¥ç±»åï¼\n\n * CREATE PROCEDURE ç¨äºåå»ºå­å¨è¿ç¨\n * DROP PROCEDURE ç¨äºå é¤å­å¨è¿ç¨\n * ALTER PROCEDURE ç¨äºä¿®æ¹å­å¨è¿ç¨\n\n\n# ä½¿ç¨å­å¨è¿ç¨\n\nåå»ºå­å¨è¿ç¨çè¦ç¹ï¼\n\n * DELIMITER ç¨äºå®ä¹è¯­å¥çç»æç¬¦\n * å­å¨è¿ç¨ç 3 ç§åæ°ç±»åï¼\n   * INï¼å­å¨è¿ç¨çå¥å\n   * OUTï¼å­å¨è¿ç¨çåºå\n   * INPUTï¼æ¢æ¯å­å¨è¿ç¨çå¥åï¼ä¹æ¯å­å¨è¿ç¨çåºå\n * æµæ§å¶è¯­å¥ï¼\n   * BEGINâ¦ENDï¼BEGINâ¦END ä¸­é´åå«äºå¤ä¸ªè¯­å¥ï¼æ¯ä¸ªè¯­å¥é½ä»¥ï¼;ï¼å·ä¸ºç»æç¬¦ã\n   * DECLAREï¼DECLARE ç¨æ¥å£°æåéï¼ä½¿ç¨çä½ç½®å¨äº BEGINâ¦END è¯­å¥ä¸­é´ï¼èä¸éè¦å¨å¶ä»è¯­å¥ä½¿ç¨ä¹åè¿è¡åéçå£°æã\n   * SETï¼èµå¼è¯­å¥ï¼ç¨äºå¯¹åéè¿è¡èµå¼ã\n   * SELECTâ¦INTOï¼æä»æ°æ®è¡¨ä¸­æ¥è¯¢çç»æå­æ¾å°åéä¸­ï¼ä¹å°±æ¯ä¸ºåéèµå¼ãæ¯æ¬¡åªè½ç»ä¸ä¸ªåéèµå¼ï¼ä¸æ¯æéåçæä½ã\n   * IFâ¦THENâ¦ENDIFï¼æ¡ä»¶å¤æ­è¯­å¥ï¼å¯ä»¥å¨ IFâ¦THENâ¦ENDIF ä¸­ä½¿ç¨ ELSE å ELSEIF æ¥è¿è¡æ¡ä»¶å¤æ­ã\n   * CASEï¼CASE è¯­å¥ç¨äºå¤æ¡ä»¶çåæ¯å¤æ­ã\n\nåå»ºå­å¨è¿ç¨ç¤ºä¾ï¼\n\nDROP PROCEDURE IF EXISTS `proc_adder`;\nDELIMITER ;;\nCREATE DEFINER=`root`@`localhost` PROCEDURE `proc_adder`(IN a int, IN b int, OUT sum int)\nBEGIN\n    DECLARE c int;\n    if a is null then set a = 0;\n    end if;\n\n    if b is null then set b = 0;\n    end if;\n\n    set sum  = a + b;\nEND\n;;\nDELIMITER ;\n\n\nä½¿ç¨å­å¨è¿ç¨ç¤ºä¾ï¼\n\nset @b=5;\ncall proc_adder(2,@b,@s);\nselect @s as sum;\n\n\n\n# å­å¨è¿ç¨çå©å¼\n\nå­å¨è¿ç¨çä¼ç¹ï¼\n\n * æ§è¡æçé«ï¼ä¸æ¬¡ç¼è¯å¤æ¬¡ä½¿ç¨ã\n * å®å¨æ§å¼ºï¼å¨è®¾å®å­å¨è¿ç¨çæ¶åå¯ä»¥è®¾ç½®å¯¹ç¨æ·çä½¿ç¨æéï¼è¿æ ·å°±åè§å¾ä¸æ ·å·æè¾å¼ºçå®å¨æ§ã\n * å¯å¤ç¨ï¼å°ä»£ç å°è£ï¼å¯ä»¥æé«ä»£ç å¤ç¨ã\n * æ§è½å¥½\n   * ç±äºæ¯é¢åç¼è¯ï¼å æ­¤å·æå¾é«çæ§è½ã\n   * ä¸ä¸ªå­å¨è¿ç¨æ¿ä»£å¤§é T_SQL è¯­å¥ ï¼å¯ä»¥éä½ç½ç»éä¿¡éï¼æé«éä¿¡éçã\n\nå­å¨è¿ç¨çç¼ºç¹ï¼\n\n * å¯ç§»æ¤æ§å·®ï¼å­å¨è¿ç¨ä¸è½è·¨æ°æ®åºç§»æ¤ãç±äºä¸åæ°æ®åºçå­å¨è¿ç¨è¯­æ³å ä¹é½ä¸ä¸æ ·ï¼ååé¾ä»¥ç»´æ¤ï¼ä¸éç¨ï¼ã\n * è°è¯å°é¾ï¼åªæå°æ° DBMS æ¯æå­å¨è¿ç¨çè°è¯ãå¯¹äºå¤æçå­å¨è¿ç¨æ¥è¯´ï¼å¼ååç»´æ¤é½ä¸å®¹æã\n * çæ¬ç®¡çå°é¾ï¼æ¯å¦æ°æ®è¡¨ç´¢å¼åçååäºï¼å¯è½ä¼å¯¼è´å­å¨è¿ç¨å¤±æãæä»¬å¨å¼åè½¯ä»¶çæ¶åå¾å¾éè¦è¿è¡çæ¬ç®¡çï¼ä½æ¯å­å¨è¿ç¨æ¬èº«æ²¡æçæ¬æ§å¶ï¼çæ¬è¿­ä»£æ´æ°çæ¶åå¾éº»ç¦ã\n * ä¸éåé«å¹¶åçåºæ¯ï¼é«å¹¶åçåºæ¯éè¦åå°æ°æ®åºçååï¼ææ¶æ°æ®åºä¼éç¨ååºåè¡¨çæ¹å¼ï¼èä¸å¯¹å¯æ©å±æ§è¦æ±å¾é«ï¼å¨è¿ç§æåµä¸ï¼å­å¨è¿ç¨ä¼åå¾é¾ä»¥ç»´æ¤ï¼å¢å æ°æ®åºçååï¼æ¾ç¶å°±ä¸éç¨äºã\n\n> ç»¼ä¸ï¼å­å¨è¿ç¨çä¼ç¼ºç¹é½éå¸¸çªåºï¼æ¯å¦ä½¿ç¨ä¸å®è¦æéï¼éè¦æ ¹æ®å·ä½åºç¨åºæ¯æ¥æè¡¡ã\n\n\n# è§¦åå¨\n\n> è§¦åå¨å¯ä»¥è§ä¸ºä¸ç§ç¹æ®çå­å¨è¿ç¨ã\n> \n> è§¦åå¨æ¯ä¸ç§ä¸è¡¨æä½æå³çæ°æ®åºå¯¹è±¡ï¼å½è§¦åå¨æå¨è¡¨ä¸åºç°æå®äºä»¶æ¶ï¼å°è°ç¨è¯¥å¯¹è±¡ï¼å³è¡¨çæä½äºä»¶è§¦åè¡¨ä¸çè§¦åå¨çæ§è¡ã\n\n# è§¦åå¨ç¹æ§\n\nå¯ä»¥ä½¿ç¨è§¦åå¨æ¥è¿è¡å®¡è®¡è·è¸ªï¼æä¿®æ¹è®°å½å°å¦å¤ä¸å¼ è¡¨ä¸­ã\n\nMySQL ä¸åè®¸å¨è§¦åå¨ä¸­ä½¿ç¨ CALL è¯­å¥ ï¼ä¹å°±æ¯ä¸è½è°ç¨å­å¨è¿ç¨ã\n\nBEGIN å END\n\nå½è§¦åå¨çè§¦åæ¡ä»¶æ»¡è¶³æ¶ï¼å°ä¼æ§è¡ BEGIN å END ä¹é´çè§¦åå¨æ§è¡å¨ä½ã\n\n> ð æ³¨æï¼å¨ MySQL ä¸­ï¼åå· ; æ¯è¯­å¥ç»æçæ è¯ç¬¦ï¼éå°åå·è¡¨ç¤ºè¯¥æ®µè¯­å¥å·²ç»ç»æï¼MySQL å¯ä»¥å¼å§æ§è¡äºãå æ­¤ï¼è§£éå¨éå°è§¦åå¨æ§è¡å¨ä½ä¸­çåå·åå°±å¼å§æ§è¡ï¼ç¶åä¼æ¥éï¼å ä¸ºæ²¡ææ¾å°å BEGIN å¹éç ENDã\n> \n> è¿æ¶å°±ä¼ç¨å° DELIMITER å½ä»¤ï¼DELIMITER æ¯å®çç¬¦ï¼åéç¬¦çææï¼ãå®æ¯ä¸æ¡å½ä»¤ï¼ä¸éè¦è¯­å¥ç»ææ è¯ï¼è¯­æ³ä¸ºï¼DELIMITER new_delemiterãnew_delemiter å¯ä»¥è®¾ä¸º 1 ä¸ªæå¤ä¸ªé¿åº¦çç¬¦å·ï¼é»è®¤çæ¯åå· ;ï¼æä»¬å¯ä»¥æå®ä¿®æ¹ä¸ºå¶ä»ç¬¦å·ï¼å¦ $ - DELIMITER $ ãå¨è¿ä¹åçè¯­å¥ï¼ä»¥åå·ç»æï¼è§£éå¨ä¸ä¼æä»ä¹ååºï¼åªæéå°äº $ï¼æè®¤ä¸ºæ¯è¯­å¥ç»æãæ³¨æï¼ä½¿ç¨å®ä¹åï¼æä»¬è¿åºè¯¥è®°å¾æå®ç»ä¿®æ¹åæ¥ã\n\nNEW å OLD\n\n * MySQL ä¸­å®ä¹äº NEW å OLD å³é®å­ï¼ç¨æ¥è¡¨ç¤ºè§¦åå¨çæå¨è¡¨ä¸­ï¼è§¦åäºè§¦åå¨çé£ä¸è¡æ°æ®ã\n * å¨ INSERT åè§¦åå¨ä¸­ï¼NEW ç¨æ¥è¡¨ç¤ºå°è¦ï¼BEFOREï¼æå·²ç»ï¼AFTERï¼æå¥çæ°æ°æ®ï¼\n * å¨ UPDATE åè§¦åå¨ä¸­ï¼OLD ç¨æ¥è¡¨ç¤ºå°è¦æå·²ç»è¢«ä¿®æ¹çåæ°æ®ï¼NEW ç¨æ¥è¡¨ç¤ºå°è¦æå·²ç»ä¿®æ¹ä¸ºçæ°æ°æ®ï¼\n * å¨ DELETE åè§¦åå¨ä¸­ï¼OLD ç¨æ¥è¡¨ç¤ºå°è¦æå·²ç»è¢«å é¤çåæ°æ®ï¼\n * ä½¿ç¨æ¹æ³ï¼ NEW.columnName ï¼columnName ä¸ºç¸åºæ°æ®è¡¨æä¸ååï¼\n\n# è§¦åå¨æä»¤\n\n> æç¤ºï¼ä¸ºäºçè§£è§¦åå¨çè¦ç¹ï¼æå¿è¦åäºè§£ä¸ä¸åå»ºè§¦åå¨çæä»¤ã\n\nCREATE TRIGGER æä»¤ç¨äºåå»ºè§¦åå¨ã\n\nè¯­æ³ï¼\n\nCREATE TRIGGER trigger_name\ntrigger_time\ntrigger_event\nON table_name\nFOR EACH ROW\nBEGIN\n  trigger_statements\nEND;\n\n\nè¯´æï¼\n\n * trigger_nameï¼è§¦åå¨å\n * trigger_time: è§¦åå¨çè§¦åæ¶æºãåå¼ä¸º BEFORE æ AFTERã\n * trigger_event: è§¦åå¨ççå¬äºä»¶ãåå¼ä¸º INSERTãUPDATE æ DELETEã\n * table_name: è§¦åå¨ççå¬ç®æ ãæå®å¨åªå¼ è¡¨ä¸å»ºç«è§¦åå¨ã\n * FOR EACH ROW: è¡çº§çè§ï¼Mysql åºå®åæ³ï¼å¶ä» DBMS ä¸åã\n * trigger_statements: è§¦åå¨æ§è¡å¨ä½ãæ¯ä¸æ¡æå¤æ¡ SQL è¯­å¥çåè¡¨ï¼åè¡¨åçæ¯æ¡è¯­å¥é½å¿é¡»ç¨åå· ; æ¥ç»å°¾ã\n\nåå»ºè§¦åå¨ç¤ºä¾ï¼\n\nDELIMITER $\nCREATE TRIGGER `trigger_insert_user`\nAFTER INSERT ON `user`\nFOR EACH ROW\nBEGIN\n    INSERT INTO `user_history`(user_id, operate_type, operate_time)\n    VALUES (NEW.id, 'add a user',  now());\nEND $\nDELIMITER ;\n\n\næ¥çè§¦åå¨ç¤ºä¾ï¼\n\nSHOW TRIGGERS;\n\n\nå é¤è§¦åå¨ç¤ºä¾ï¼\n\nDROP TRIGGER IF EXISTS trigger_insert_user;\n\n\n\n# æ¸¸æ \n\n> æ¸¸æ ï¼CURSORï¼æ¯ä¸ä¸ªå­å¨å¨ DBMS æå¡å¨ä¸çæ°æ®åºæ¥è¯¢ï¼å®ä¸æ¯ä¸æ¡ SELECT è¯­å¥ï¼èæ¯è¢«è¯¥è¯­å¥æ£ç´¢åºæ¥çç»æéãå¨å­å¨è¿ç¨ä¸­ä½¿ç¨æ¸¸æ å¯ä»¥å¯¹ä¸ä¸ªç»æéè¿è¡ç§»å¨éåã\n\næ¸¸æ ä¸»è¦ç¨äºäº¤äºå¼åºç¨ï¼å¶ä¸­ç¨æ·éè¦å¯¹æ°æ®éä¸­çä»»æè¡è¿è¡æµè§åä¿®æ¹ã\n\nä½¿ç¨æ¸¸æ çæ­¥éª¤ï¼\n\n 1. å®ä¹æ¸¸æ ï¼éè¿ DECLARE cursor_name CURSOR FOR <è¯­å¥> å®ä¹æ¸¸æ ãè¿ä¸ªè¿ç¨æ²¡æå®éæ£ç´¢åºæ°æ®ã\n 2. æå¼æ¸¸æ ï¼éè¿ OPEN cursor_name æå¼æ¸¸æ ã\n 3. ååºæ°æ®ï¼éè¿ FETCH cursor_name INTO var_name ... è·åæ°æ®ã\n 4. å³é­æ¸¸æ ï¼éè¿ CLOSE cursor_name å³é­æ¸¸æ ã\n 5. éæ¾æ¸¸æ ï¼éè¿ DEALLOCATE PREPARE éæ¾æ¸¸æ ã\n\næ¸¸æ ä½¿ç¨ç¤ºä¾ï¼\n\nDELIMITER $\nCREATE PROCEDURE getTotal()\nBEGIN\n    DECLARE total INT;\n    -- åå»ºæ¥æ¶æ¸¸æ æ°æ®çåé\n    DECLARE sid INT;\n    DECLARE sname VARCHAR(10);\n    -- åå»ºæ»æ°åé\n    DECLARE sage INT;\n    -- åå»ºç»ææ å¿åé\n    DECLARE done INT DEFAULT false;\n    -- åå»ºæ¸¸æ \n    DECLARE cur CURSOR FOR SELECT id,name,age from cursor_table where age>30;\n    -- æå®æ¸¸æ å¾ªç¯ç»ææ¶çè¿åå¼\n    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = true;\n    SET total = 0;\n    OPEN cur;\n    FETCH cur INTO sid, sname, sage;\n    WHILE(NOT done)\n    DO\n        SET total = total + 1;\n        FETCH cur INTO sid, sname, sage;\n    END WHILE;\n\n    CLOSE cur;\n    SELECT total;\nEND $\nDELIMITER ;\n\n-- è°ç¨å­å¨è¿ç¨\ncall getTotal();\n\n\n\n# åèèµæ\n\n * ãSQL å¿ç¥å¿ä¼ã\n * ãæµå¥æ·±åºãMySQL ä¸­äºå¡çå®ç°\n * MySQL çå­¦ä¹ --è§¦åå¨\n * ç»´åºç¾ç§è¯æ¡ - SQL\n * https://www.sitesbay.com/sql/index\n * SQL Subqueries\n * Quick breakdown of the types of joins\n * SQL UNION\n * SQL database security\n * Mysql ä¸­çå­å¨è¿ç¨",normalizedContent:"# sql è¯­æ³é«çº§ç¹æ§\n\n> æ¬æéå¯¹å³ç³»åæ°æ®åºçåºæ¬è¯­æ³ãéäºç¯å¹ï¼æ¬æä¾§éè¯´æç¨æ³ï¼ä¸ä¼å±å¼è®²è§£ç¹æ§ãåçã\n> \n> æ¬æè¯­æ³ä¸»è¦éå¯¹ mysqlï¼ä½å¤§é¨åçè¯­æ³å¯¹å¶ä»å³ç³»åæ°æ®åºä¹éç¨ã\n\n\n\n\n# è¿æ¥åç»å\n\n\n# è¿æ¥ï¼joinï¼\n\n> è¿æ¥ç¨äºè¿æ¥å¤ä¸ªè¡¨ï¼ä½¿ç¨ join å³é®å­ï¼å¹¶ä¸æ¡ä»¶è¯­å¥ä½¿ç¨ on èä¸æ¯ whereã\n\nå¦æä¸ä¸ª join è³å°æä¸ä¸ªå¬å±å­æ®µå¹¶ä¸å®ä»¬ä¹é´å­å¨å³ç³»ï¼åè¯¥ join å¯ä»¥å¨ä¸¤ä¸ªæå¤ä¸ªè¡¨ä¸å·¥ä½ã\n\njoin ä¿æåºè¡¨ï¼ç»æåæ°æ®ï¼ä¸åãè¿æ¥å¯ä»¥æ¿æ¢å­æ¥è¯¢ï¼å¹¶ä¸æ¯å­æ¥è¯¢çæçä¸è¬ä¼æ´å¿«ã\n\njoin æä¸¤ç§è¿æ¥ç±»åï¼åè¿æ¥åå¤è¿æ¥ã\n\n\n\n# åè¿æ¥ï¼inner joinï¼\n\nåè¿æ¥åç§°ç­å¼è¿æ¥ï¼ä½¿ç¨ inner join å³é®å­ãå¨æ²¡ææ¡ä»¶è¯­å¥çæåµä¸è¿åç¬å¡å°ç§¯ã\n\nselect vend_name, prod_name, prod_price\nfrom vendors inner join products\non vendors.vend_id = products.vend_id;\n\n\n# èªè¿æ¥ï¼=ï¼\n\nèªè¿æ¥å¯ä»¥çæåè¿æ¥çä¸ç§ï¼åªæ¯è¿æ¥çè¡¨æ¯èªèº«èå·²ãèªç¶è¿æ¥æ¯æåååéè¿ = è¿æ¥èµ·æ¥çï¼åååå¯ä»¥æå¤ä¸ªã\n\nselect c1.cust_id, c1.cust_name, c1.cust_contact\nfrom customers c1, customers c2\nwhere c1.cust_name = c2.cust_name\nand c2.cust_contact = 'jim jones';\n\n\n# èªç¶è¿æ¥ï¼natural joinï¼\n\nåè¿æ¥æä¾è¿æ¥çåï¼èèªç¶è¿æ¥èªå¨è¿æ¥ææåååãèªç¶è¿æ¥ä½¿ç¨ natural join å³é®å­ã\n\nselect *\nfrom products\nnatural join customers;\n\n\n# å¤è¿æ¥ï¼outer joinï¼\n\nå¤è¿æ¥è¿åä¸ä¸ªè¡¨ä¸­çææè¡ï¼å¹¶ä¸ä»è¿åæ¥èªæ­¤è¡¨ä¸­æ»¡è¶³è¿æ¥æ¡ä»¶çé£äºè¡ï¼å³ä¸¤ä¸ªè¡¨ä¸­çåæ¯ç¸ç­çãå¤è¿æ¥åä¸ºå·¦å¤è¿æ¥ãå³å¤è¿æ¥ãå¨å¤è¿æ¥ï¼mysql ä¸æ¯æï¼ã\n\n# å·¦è¿æ¥ï¼left joinï¼\n\nå·¦å¤è¿æ¥å°±æ¯ä¿çå·¦è¡¨æ²¡æå³èçè¡ã\n\nselect customers.cust_id, orders.order_num\nfrom customers left join orders\non customers.cust_id = orders.cust_id;\n\n\n# å³è¿æ¥ï¼right joinï¼\n\nå³å¤è¿æ¥å°±æ¯ä¿çå³è¡¨æ²¡æå³èçè¡ã\n\nselect customers.cust_id, orders.order_num\nfrom customers right join orders\non customers.cust_id = orders.cust_id;\n\n\n\n# ç»åï¼unionï¼\n\n> union è¿ç®ç¬¦å°ä¸¤ä¸ªææ´å¤æ¥è¯¢çç»æç»åèµ·æ¥ï¼å¹¶çæä¸ä¸ªç»æéï¼å¶ä¸­åå«æ¥èª union ä¸­åä¸æ¥è¯¢çæåè¡ã\n\nunion åºæ¬è§åï¼\n\n * æææ¥è¯¢çåæ°ååé¡ºåºå¿é¡»ç¸åã\n * æ¯ä¸ªæ¥è¯¢ä¸­æ¶åè¡¨çåçæ°æ®ç±»åå¿é¡»ç¸åæå¼å®¹ã\n * éå¸¸è¿åçåååèªç¬¬ä¸ä¸ªæ¥è¯¢ã\n\né»è®¤ä¼å»é¤ç¸åè¡ï¼å¦æéè¦ä¿çç¸åè¡ï¼ä½¿ç¨ union allã\n\nåªè½åå«ä¸ä¸ª order by å­å¥ï¼å¹¶ä¸å¿é¡»ä½äºè¯­å¥çæåã\n\nåºç¨åºæ¯ï¼\n\n * å¨ä¸ä¸ªæ¥è¯¢ä¸­ä»ä¸åçè¡¨è¿åç»ææ°æ®ã\n * å¯¹ä¸ä¸ªè¡¨æ§è¡å¤ä¸ªæ¥è¯¢ï¼æä¸ä¸ªæ¥è¯¢è¿åæ°æ®ã\n\nç»åæ¥è¯¢ç¤ºä¾ï¼\n\nselect cust_name, cust_contact, cust_email\nfrom customers\nwhere cust_state in ('il', 'in', 'mi')\nunion\nselect cust_name, cust_contact, cust_email\nfrom customers\nwhere cust_name = 'fun4all';\n\n\n\n# join vs union\n\n * join ä¸­è¿æ¥è¡¨çåå¯è½ä¸åï¼ä½å¨ union ä¸­ï¼æææ¥è¯¢çåæ°ååé¡ºåºå¿é¡»ç¸åã\n * union å°æ¥è¯¢ä¹åçè¡æ¾å¨ä¸èµ·ï¼åç´æ¾ç½®ï¼ï¼ä½ join å°æ¥è¯¢ä¹åçåæ¾å¨ä¸èµ·ï¼æ°´å¹³æ¾ç½®ï¼ï¼å³å®ææä¸ä¸ªç¬å¡å°ç§¯ã\n\n\n# å½æ°\n\n> ð æ³¨æï¼ä¸åæ°æ®åºçå½æ°å¾å¾åä¸ç¸åï¼å æ­¤ä¸å¯ç§»æ¤ãæ¬èä¸»è¦ä»¥ mysql çå½æ°ä¸ºä¾ã\n\n\n# ææ¬å¤ç\n\nå½æ°                è¯´æ\nleft()ãright()    å·¦è¾¹æèå³è¾¹çå­ç¬¦\nlower()ãupper()   è½¬æ¢ä¸ºå°åæèå¤§å\nltrim()ãrtim()    å»é¤å·¦è¾¹æèå³è¾¹çç©ºæ ¼\nlength()          é¿åº¦\nsoundex()         è½¬æ¢ä¸ºè¯­é³å¼\n\nå¶ä¸­ï¼ soundex() å¯ä»¥å°ä¸ä¸ªå­ç¬¦ä¸²è½¬æ¢ä¸ºæè¿°å¶è¯­é³è¡¨ç¤ºçå­æ¯æ°å­æ¨¡å¼ã\n\nselect *\nfrom mytable\nwhere soundex(col1) = soundex('apple')\n\n\n\n# æ¥æåæ¶é´å¤ç\n\n * æ¥ææ ¼å¼ï¼yyyy-mm-dd\n * æ¶é´æ ¼å¼ï¼hh:mm:ss\n\nå½ æ°             è¯´ æ\nadddate()       å¢å ä¸ä¸ªæ¥æï¼å¤©ãå¨ç­ï¼\naddtime()       å¢å ä¸ä¸ªæ¶é´ï¼æ¶ãåç­ï¼\ncurdate()       è¿åå½åæ¥æ\ncurtime()       è¿åå½åæ¶é´\ndate()          è¿åæ¥ææ¶é´çæ¥æé¨å\ndatediff()      è®¡ç®ä¸¤ä¸ªæ¥æä¹å·®\ndate_add()      é«åº¦çµæ´»çæ¥æè¿ç®å½æ°\ndate_format()   è¿åä¸ä¸ªæ ¼å¼åçæ¥æææ¶é´ä¸²\nday()           è¿åä¸ä¸ªæ¥æçå¤©æ°é¨å\ndayofweek()     å¯¹äºä¸ä¸ªæ¥æï¼è¿åå¯¹åºçææå \nhour()          è¿åä¸ä¸ªæ¶é´çå°æ¶é¨å\nminute()        è¿åä¸ä¸ªæ¶é´çåéé¨å\nmonth()         è¿åä¸ä¸ªæ¥æçæä»½é¨å\nnow()           è¿åå½åæ¥æåæ¶é´\nsecond()        è¿åä¸ä¸ªæ¶é´çç§é¨å\ntime()          è¿åä¸ä¸ªæ¥ææ¶é´çæ¶é´é¨å\nyear()          è¿åä¸ä¸ªæ¥æçå¹´ä»½é¨å\n\nmysql> select now();\n\n\n2018-4-14 20:25:11\n\n\n\n# æ°å¼å¤ç\n\nå½æ°       è¯´æ\nsin()    æ­£å¼¦\ncos()    ä½å¼¦\ntan()    æ­£å\nabs()    ç»å¯¹å¼\nsqrt()   å¹³æ¹æ ¹\nmod()    ä½æ°\nexp()    ææ°\npi()     åå¨ç\nrand()   éæºæ°\n\n\n# æ±æ»\n\nå½ æ°       è¯´ æ\navg()     è¿åæåçå¹³åå¼\ncount()   è¿åæåçè¡æ°\nmax()     è¿åæåçæå¤§å¼\nmin()     è¿åæåçæå°å¼\nsum()     è¿åæåå¼ä¹å\n\navg() ä¼å¿½ç¥ null è¡ã\n\nä½¿ç¨ distinct å¯ä»¥è®©æ±æ»å½æ°å¼æ±æ»ä¸åçå¼ã\n\nselect avg(distinct col1) as avg_col\nfrom mytable\n\n\n\n# åç»\n\n\n# group by\n\n> group by å­å¥å°è®°å½åç»å°æ±æ»è¡ä¸­ï¼group by ä¸ºæ¯ä¸ªç»è¿åä¸ä¸ªè®°å½ã\n\ngroup by å¯ä»¥æä¸åæå¤åè¿è¡åç»ã\n\ngroup by éå¸¸è¿æ¶åèåå½æ°ï¼countï¼maxï¼sumï¼avg ç­ã\n\ngroup by æåç»å­æ®µè¿è¡æåºåï¼order by å¯ä»¥ä»¥æ±æ»å­æ®µæ¥è¿è¡æåºã\n\nåç»ç¤ºä¾ï¼\n\nselect cust_name, count(cust_address) as addr_num\nfrom customers group by cust_name;\n\n\nåç»åæåºç¤ºä¾ï¼\n\nselect cust_name, count(cust_address) as addr_num\nfrom customers group by cust_name\norder by cust_name desc;\n\n\n\n# having\n\n> having ç¨äºå¯¹æ±æ»ç group by ç»æè¿è¡è¿æ»¤ãhaving è¦æ±å­å¨ä¸ä¸ª group by å­å¥ã\n\nwhere å having å¯ä»¥å¨ç¸åçæ¥è¯¢ä¸­ã\n\nhaving vs whereï¼\n\n * where å having é½æ¯ç¨äºè¿æ»¤ã\n * having éç¨äºæ±æ»çç»è®°å½ï¼è where éç¨äºåä¸ªè®°å½ã\n\nä½¿ç¨ where å having è¿æ»¤æ°æ®ç¤ºä¾ï¼\n\nselect cust_name, count(*) as num\nfrom customers\nwhere cust_email is not null\ngroup by cust_name\nhaving count(*) >= 1;\n\n\n----------------------------------------\n\nï¼ä»¥ä¸ä¸º ddl è¯­å¥ç¨æ³ï¼\n\n\n# äºå¡\n\nä¸è½åé select è¯­å¥ï¼åé select è¯­å¥ä¹æ²¡æä¹ï¼ä¹ä¸è½åé create å drop è¯­å¥ã\n\nmysql é»è®¤éç¨éå¼æäº¤ç­ç¥ï¼autocommitï¼ï¼æ¯æ§è¡ä¸æ¡è¯­å¥å°±æè¿æ¡è¯­å¥å½æä¸ä¸ªäºå¡ç¶åè¿è¡æäº¤ãå½åºç° start transaction è¯­å¥æ¶ï¼ä¼å³é­éå¼æäº¤ï¼å½ commit æ rollback è¯­å¥æ§è¡åï¼äºå¡ä¼èªå¨å³é­ï¼éæ°æ¢å¤éå¼æäº¤ã\n\néè¿ set autocommit=0 å¯ä»¥åæ¶èªå¨æäº¤ï¼ç´å° set autocommit=1 æä¼æäº¤ï¼autocommit æ è®°æ¯éå¯¹æ¯ä¸ªè¿æ¥èä¸æ¯éå¯¹æå¡å¨çã\n\näºå¡å¤çæä»¤ï¼\n\n * start transaction - æä»¤ç¨äºæ è®°äºå¡çèµ·å§ç¹ã\n * savepoint - æä»¤ç¨äºåå»ºä¿çç¹ã\n * rollback to - æä»¤ç¨äºåæ»å°æå®çä¿çç¹ï¼å¦ææ²¡æè®¾ç½®ä¿çç¹ï¼ååéå° start transaction è¯­å¥å¤ã\n * commit - æäº¤äºå¡ã\n * release savepointï¼å é¤æä¸ªä¿å­ç¹ã\n * set transactionï¼è®¾ç½®äºå¡çéç¦»çº§å«ã\n\näºå¡å¤çç¤ºä¾ï¼\n\n-- å¼å§äºå¡\nstart transaction;\n\n-- æå¥æä½ a\ninsert into `user`\nvalues (1, 'root1', 'root1', 'xxxx@163.com');\n\n-- åå»ºä¿çç¹ updatea\nsavepoint updatea;\n\n-- æå¥æä½ b\ninsert into `user`\nvalues (2, 'root2', 'root2', 'xxxx@163.com');\n\n-- åæ»å°ä¿çç¹ updatea\nrollback to updatea;\n\n-- æäº¤äºå¡ï¼åªææä½ a çæ\ncommit;\n\n\n\n# acid\n\n\n# äºå¡éç¦»çº§å«\n\n----------------------------------------\n\nï¼ä»¥ä¸ä¸º dcl è¯­å¥ç¨æ³ï¼\n\n\n# æéæ§å¶\n\ngrant å revoke å¯å¨å ä¸ªå±æ¬¡ä¸æ§å¶è®¿é®æéï¼\n\n * æ´ä¸ªæå¡å¨ï¼ä½¿ç¨ grant all å revoke allï¼\n * æ´ä¸ªæ°æ®åºï¼ä½¿ç¨ on database.*ï¼\n * ç¹å®çè¡¨ï¼ä½¿ç¨ on database.tableï¼\n * ç¹å®çåï¼\n * ç¹å®çå­å¨è¿ç¨ã\n\næ°åå»ºçè´¦æ·æ²¡æä»»ä½æéã\n\nè´¦æ·ç¨ username@host çå½¢å¼å®ä¹ï¼username@% ä½¿ç¨çæ¯é»è®¤ä¸»æºåã\n\nmysql çè´¦æ·ä¿¡æ¯ä¿å­å¨ mysql è¿ä¸ªæ°æ®åºä¸­ã\n\nuse mysql;\nselect user from user;\n\n\n\n# åå»ºè´¦æ·\n\ncreate user myuser identified by 'mypassword';\n\n\n\n# ä¿®æ¹è´¦æ·å\n\nupdate user set user='newuser' where user='myuser';\nflush privileges;\n\n\n\n# å é¤è´¦æ·\n\ndrop user myuser;\n\n\n\n# æ¥çæé\n\nshow grants for myuser;\n\n\n\n# æäºæé\n\ngrant select, insert on *.* to myuser;\n\n\n\n# å é¤æé\n\nrevoke select, insert on *.* from myuser;\n\n\n\n# æ´æ¹å¯ç \n\nset password for myuser = 'mypass';\n\n\n\n# å­å¨è¿ç¨\n\nå­å¨è¿ç¨çè±ææ¯ stored procedureãå®å¯ä»¥è§ä¸ºä¸ç» sql è¯­å¥çæ¹å¤çãä¸æ¦å­å¨è¿ç¨è¢«åå»ºåºæ¥ï¼ä½¿ç¨å®å°±åä½¿ç¨å½æ°ä¸æ ·ç®åï¼æä»¬ç´æ¥éè¿è°ç¨å­å¨è¿ç¨åå³å¯ã\n\nå®ä¹å­å¨è¿ç¨çè¯­æ³æ ¼å¼ï¼\n\ncreate procedure å­å¨è¿ç¨åç§° ([åæ°åè¡¨])\nbegin\n    éè¦æ§è¡çè¯­å¥\nend\n\n\nå­å¨è¿ç¨å®ä¹è¯­å¥ç±»åï¼\n\n * create procedure ç¨äºåå»ºå­å¨è¿ç¨\n * drop procedure ç¨äºå é¤å­å¨è¿ç¨\n * alter procedure ç¨äºä¿®æ¹å­å¨è¿ç¨\n\n\n# ä½¿ç¨å­å¨è¿ç¨\n\nåå»ºå­å¨è¿ç¨çè¦ç¹ï¼\n\n * delimiter ç¨äºå®ä¹è¯­å¥çç»æç¬¦\n * å­å¨è¿ç¨ç 3 ç§åæ°ç±»åï¼\n   * inï¼å­å¨è¿ç¨çå¥å\n   * outï¼å­å¨è¿ç¨çåºå\n   * inputï¼æ¢æ¯å­å¨è¿ç¨çå¥åï¼ä¹æ¯å­å¨è¿ç¨çåºå\n * æµæ§å¶è¯­å¥ï¼\n   * beginâ¦endï¼beginâ¦end ä¸­é´åå«äºå¤ä¸ªè¯­å¥ï¼æ¯ä¸ªè¯­å¥é½ä»¥ï¼;ï¼å·ä¸ºç»æç¬¦ã\n   * declareï¼declare ç¨æ¥å£°æåéï¼ä½¿ç¨çä½ç½®å¨äº beginâ¦end è¯­å¥ä¸­é´ï¼èä¸éè¦å¨å¶ä»è¯­å¥ä½¿ç¨ä¹åè¿è¡åéçå£°æã\n   * setï¼èµå¼è¯­å¥ï¼ç¨äºå¯¹åéè¿è¡èµå¼ã\n   * selectâ¦intoï¼æä»æ°æ®è¡¨ä¸­æ¥è¯¢çç»æå­æ¾å°åéä¸­ï¼ä¹å°±æ¯ä¸ºåéèµå¼ãæ¯æ¬¡åªè½ç»ä¸ä¸ªåéèµå¼ï¼ä¸æ¯æéåçæä½ã\n   * ifâ¦thenâ¦endifï¼æ¡ä»¶å¤æ­è¯­å¥ï¼å¯ä»¥å¨ ifâ¦thenâ¦endif ä¸­ä½¿ç¨ else å elseif æ¥è¿è¡æ¡ä»¶å¤æ­ã\n   * caseï¼case è¯­å¥ç¨äºå¤æ¡ä»¶çåæ¯å¤æ­ã\n\nåå»ºå­å¨è¿ç¨ç¤ºä¾ï¼\n\ndrop procedure if exists `proc_adder`;\ndelimiter ;;\ncreate definer=`root`@`localhost` procedure `proc_adder`(in a int, in b int, out sum int)\nbegin\n    declare c int;\n    if a is null then set a = 0;\n    end if;\n\n    if b is null then set b = 0;\n    end if;\n\n    set sum  = a + b;\nend\n;;\ndelimiter ;\n\n\nä½¿ç¨å­å¨è¿ç¨ç¤ºä¾ï¼\n\nset @b=5;\ncall proc_adder(2,@b,@s);\nselect @s as sum;\n\n\n\n# å­å¨è¿ç¨çå©å¼\n\nå­å¨è¿ç¨çä¼ç¹ï¼\n\n * æ§è¡æçé«ï¼ä¸æ¬¡ç¼è¯å¤æ¬¡ä½¿ç¨ã\n * å®å¨æ§å¼ºï¼å¨è®¾å®å­å¨è¿ç¨çæ¶åå¯ä»¥è®¾ç½®å¯¹ç¨æ·çä½¿ç¨æéï¼è¿æ ·å°±åè§å¾ä¸æ ·å·æè¾å¼ºçå®å¨æ§ã\n * å¯å¤ç¨ï¼å°ä»£ç å°è£ï¼å¯ä»¥æé«ä»£ç å¤ç¨ã\n * æ§è½å¥½\n   * ç±äºæ¯é¢åç¼è¯ï¼å æ­¤å·æå¾é«çæ§è½ã\n   * ä¸ä¸ªå­å¨è¿ç¨æ¿ä»£å¤§é t_sql è¯­å¥ ï¼å¯ä»¥éä½ç½ç»éä¿¡éï¼æé«éä¿¡éçã\n\nå­å¨è¿ç¨çç¼ºç¹ï¼\n\n * å¯ç§»æ¤æ§å·®ï¼å­å¨è¿ç¨ä¸è½è·¨æ°æ®åºç§»æ¤ãç±äºä¸åæ°æ®åºçå­å¨è¿ç¨è¯­æ³å ä¹é½ä¸ä¸æ ·ï¼ååé¾ä»¥ç»´æ¤ï¼ä¸éç¨ï¼ã\n * è°è¯å°é¾ï¼åªæå°æ° dbms æ¯æå­å¨è¿ç¨çè°è¯ãå¯¹äºå¤æçå­å¨è¿ç¨æ¥è¯´ï¼å¼ååç»´æ¤é½ä¸å®¹æã\n * çæ¬ç®¡çå°é¾ï¼æ¯å¦æ°æ®è¡¨ç´¢å¼åçååäºï¼å¯è½ä¼å¯¼è´å­å¨è¿ç¨å¤±æãæä»¬å¨å¼åè½¯ä»¶çæ¶åå¾å¾éè¦è¿è¡çæ¬ç®¡çï¼ä½æ¯å­å¨è¿ç¨æ¬èº«æ²¡æçæ¬æ§å¶ï¼çæ¬è¿­ä»£æ´æ°çæ¶åå¾éº»ç¦ã\n * ä¸éåé«å¹¶åçåºæ¯ï¼é«å¹¶åçåºæ¯éè¦åå°æ°æ®åºçååï¼ææ¶æ°æ®åºä¼éç¨ååºåè¡¨çæ¹å¼ï¼èä¸å¯¹å¯æ©å±æ§è¦æ±å¾é«ï¼å¨è¿ç§æåµä¸ï¼å­å¨è¿ç¨ä¼åå¾é¾ä»¥ç»´æ¤ï¼å¢å æ°æ®åºçååï¼æ¾ç¶å°±ä¸éç¨äºã\n\n> ç»¼ä¸ï¼å­å¨è¿ç¨çä¼ç¼ºç¹é½éå¸¸çªåºï¼æ¯å¦ä½¿ç¨ä¸å®è¦æéï¼éè¦æ ¹æ®å·ä½åºç¨åºæ¯æ¥æè¡¡ã\n\n\n# è§¦åå¨\n\n> è§¦åå¨å¯ä»¥è§ä¸ºä¸ç§ç¹æ®çå­å¨è¿ç¨ã\n> \n> è§¦åå¨æ¯ä¸ç§ä¸è¡¨æä½æå³çæ°æ®åºå¯¹è±¡ï¼å½è§¦åå¨æå¨è¡¨ä¸åºç°æå®äºä»¶æ¶ï¼å°è°ç¨è¯¥å¯¹è±¡ï¼å³è¡¨çæä½äºä»¶è§¦åè¡¨ä¸çè§¦åå¨çæ§è¡ã\n\n# è§¦åå¨ç¹æ§\n\nå¯ä»¥ä½¿ç¨è§¦åå¨æ¥è¿è¡å®¡è®¡è·è¸ªï¼æä¿®æ¹è®°å½å°å¦å¤ä¸å¼ è¡¨ä¸­ã\n\nmysql ä¸åè®¸å¨è§¦åå¨ä¸­ä½¿ç¨ call è¯­å¥ ï¼ä¹å°±æ¯ä¸è½è°ç¨å­å¨è¿ç¨ã\n\nbegin å end\n\nå½è§¦åå¨çè§¦åæ¡ä»¶æ»¡è¶³æ¶ï¼å°ä¼æ§è¡ begin å end ä¹é´çè§¦åå¨æ§è¡å¨ä½ã\n\n> ð æ³¨æï¼å¨ mysql ä¸­ï¼åå· ; æ¯è¯­å¥ç»æçæ è¯ç¬¦ï¼éå°åå·è¡¨ç¤ºè¯¥æ®µè¯­å¥å·²ç»ç»æï¼mysql å¯ä»¥å¼å§æ§è¡äºãå æ­¤ï¼è§£éå¨éå°è§¦åå¨æ§è¡å¨ä½ä¸­çåå·åå°±å¼å§æ§è¡ï¼ç¶åä¼æ¥éï¼å ä¸ºæ²¡ææ¾å°å begin å¹éç endã\n> \n> è¿æ¶å°±ä¼ç¨å° delimiter å½ä»¤ï¼delimiter æ¯å®çç¬¦ï¼åéç¬¦çææï¼ãå®æ¯ä¸æ¡å½ä»¤ï¼ä¸éè¦è¯­å¥ç»ææ è¯ï¼è¯­æ³ä¸ºï¼delimiter new_delemiterãnew_delemiter å¯ä»¥è®¾ä¸º 1 ä¸ªæå¤ä¸ªé¿åº¦çç¬¦å·ï¼é»è®¤çæ¯åå· ;ï¼æä»¬å¯ä»¥æå®ä¿®æ¹ä¸ºå¶ä»ç¬¦å·ï¼å¦ $ - delimiter $ ãå¨è¿ä¹åçè¯­å¥ï¼ä»¥åå·ç»æï¼è§£éå¨ä¸ä¼æä»ä¹ååºï¼åªæéå°äº $ï¼æè®¤ä¸ºæ¯è¯­å¥ç»æãæ³¨æï¼ä½¿ç¨å®ä¹åï¼æä»¬è¿åºè¯¥è®°å¾æå®ç»ä¿®æ¹åæ¥ã\n\nnew å old\n\n * mysql ä¸­å®ä¹äº new å old å³é®å­ï¼ç¨æ¥è¡¨ç¤ºè§¦åå¨çæå¨è¡¨ä¸­ï¼è§¦åäºè§¦åå¨çé£ä¸è¡æ°æ®ã\n * å¨ insert åè§¦åå¨ä¸­ï¼new ç¨æ¥è¡¨ç¤ºå°è¦ï¼beforeï¼æå·²ç»ï¼afterï¼æå¥çæ°æ°æ®ï¼\n * å¨ update åè§¦åå¨ä¸­ï¼old ç¨æ¥è¡¨ç¤ºå°è¦æå·²ç»è¢«ä¿®æ¹çåæ°æ®ï¼new ç¨æ¥è¡¨ç¤ºå°è¦æå·²ç»ä¿®æ¹ä¸ºçæ°æ°æ®ï¼\n * å¨ delete åè§¦åå¨ä¸­ï¼old ç¨æ¥è¡¨ç¤ºå°è¦æå·²ç»è¢«å é¤çåæ°æ®ï¼\n * ä½¿ç¨æ¹æ³ï¼ new.columnname ï¼columnname ä¸ºç¸åºæ°æ®è¡¨æä¸ååï¼\n\n# è§¦åå¨æä»¤\n\n> æç¤ºï¼ä¸ºäºçè§£è§¦åå¨çè¦ç¹ï¼æå¿è¦åäºè§£ä¸ä¸åå»ºè§¦åå¨çæä»¤ã\n\ncreate trigger æä»¤ç¨äºåå»ºè§¦åå¨ã\n\nè¯­æ³ï¼\n\ncreate trigger trigger_name\ntrigger_time\ntrigger_event\non table_name\nfor each row\nbegin\n  trigger_statements\nend;\n\n\nè¯´æï¼\n\n * trigger_nameï¼è§¦åå¨å\n * trigger_time: è§¦åå¨çè§¦åæ¶æºãåå¼ä¸º before æ afterã\n * trigger_event: è§¦åå¨ççå¬äºä»¶ãåå¼ä¸º insertãupdate æ deleteã\n * table_name: è§¦åå¨ççå¬ç®æ ãæå®å¨åªå¼ è¡¨ä¸å»ºç«è§¦åå¨ã\n * for each row: è¡çº§çè§ï¼mysql åºå®åæ³ï¼å¶ä» dbms ä¸åã\n * trigger_statements: è§¦åå¨æ§è¡å¨ä½ãæ¯ä¸æ¡æå¤æ¡ sql è¯­å¥çåè¡¨ï¼åè¡¨åçæ¯æ¡è¯­å¥é½å¿é¡»ç¨åå· ; æ¥ç»å°¾ã\n\nåå»ºè§¦åå¨ç¤ºä¾ï¼\n\ndelimiter $\ncreate trigger `trigger_insert_user`\nafter insert on `user`\nfor each row\nbegin\n    insert into `user_history`(user_id, operate_type, operate_time)\n    values (new.id, 'add a user',  now());\nend $\ndelimiter ;\n\n\næ¥çè§¦åå¨ç¤ºä¾ï¼\n\nshow triggers;\n\n\nå é¤è§¦åå¨ç¤ºä¾ï¼\n\ndrop trigger if exists trigger_insert_user;\n\n\n\n# æ¸¸æ \n\n> æ¸¸æ ï¼cursorï¼æ¯ä¸ä¸ªå­å¨å¨ dbms æå¡å¨ä¸çæ°æ®åºæ¥è¯¢ï¼å®ä¸æ¯ä¸æ¡ select è¯­å¥ï¼èæ¯è¢«è¯¥è¯­å¥æ£ç´¢åºæ¥çç»æéãå¨å­å¨è¿ç¨ä¸­ä½¿ç¨æ¸¸æ å¯ä»¥å¯¹ä¸ä¸ªç»æéè¿è¡ç§»å¨éåã\n\næ¸¸æ ä¸»è¦ç¨äºäº¤äºå¼åºç¨ï¼å¶ä¸­ç¨æ·éè¦å¯¹æ°æ®éä¸­çä»»æè¡è¿è¡æµè§åä¿®æ¹ã\n\nä½¿ç¨æ¸¸æ çæ­¥éª¤ï¼\n\n 1. å®ä¹æ¸¸æ ï¼éè¿ declare cursor_name cursor for <è¯­å¥> å®ä¹æ¸¸æ ãè¿ä¸ªè¿ç¨æ²¡æå®éæ£ç´¢åºæ°æ®ã\n 2. æå¼æ¸¸æ ï¼éè¿ open cursor_name æå¼æ¸¸æ ã\n 3. ååºæ°æ®ï¼éè¿ fetch cursor_name into var_name ... è·åæ°æ®ã\n 4. å³é­æ¸¸æ ï¼éè¿ close cursor_name å³é­æ¸¸æ ã\n 5. éæ¾æ¸¸æ ï¼éè¿ deallocate prepare éæ¾æ¸¸æ ã\n\næ¸¸æ ä½¿ç¨ç¤ºä¾ï¼\n\ndelimiter $\ncreate procedure gettotal()\nbegin\n    declare total int;\n    -- åå»ºæ¥æ¶æ¸¸æ æ°æ®çåé\n    declare sid int;\n    declare sname varchar(10);\n    -- åå»ºæ»æ°åé\n    declare sage int;\n    -- åå»ºç»ææ å¿åé\n    declare done int default false;\n    -- åå»ºæ¸¸æ \n    declare cur cursor for select id,name,age from cursor_table where age>30;\n    -- æå®æ¸¸æ å¾ªç¯ç»ææ¶çè¿åå¼\n    declare continue handler for not found set done = true;\n    set total = 0;\n    open cur;\n    fetch cur into sid, sname, sage;\n    while(not done)\n    do\n        set total = total + 1;\n        fetch cur into sid, sname, sage;\n    end while;\n\n    close cur;\n    select total;\nend $\ndelimiter ;\n\n-- è°ç¨å­å¨è¿ç¨\ncall gettotal();\n\n\n\n# åèèµæ\n\n * ãsql å¿ç¥å¿ä¼ã\n * ãæµå¥æ·±åºãmysql ä¸­äºå¡çå®ç°\n * mysql çå­¦ä¹ --è§¦åå¨\n * ç»´åºç¾ç§è¯æ¡ - sql\n * https://www.sitesbay.com/sql/index\n * sql subqueries\n * quick breakdown of the types of joins\n * sql union\n * sql database security\n * mysql ä¸­çå­å¨è¿ç¨",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"æ©å± SQL",frontmatter:{title:"æ©å± SQL",date:"2020-10-10T19:03:05.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","ç»¼å"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","SQL"],permalink:"/pages/55e9a7/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/01.%E7%BB%BC%E5%90%88/03.%E6%89%A9%E5%B1%95SQL.html",relativePath:"12.æ°æ®åº/03.å³ç³»åæ°æ®åº/01.ç»¼å/03.æ©å±SQL.md",key:"v-49d5bdfa",path:"/pages/55e9a7/",headers:[{level:2,title:"æ°æ®åº",slug:"æ°æ®åº",normalizedTitle:"æ°æ®åº",charIndex:13},{level:2,title:"è¡¨",slug:"è¡¨",normalizedTitle:"è¡¨",charIndex:21},{level:3,title:"æ¥çè¡¨çåºæ¬ä¿¡æ¯",slug:"æ¥çè¡¨çåºæ¬ä¿¡æ¯",normalizedTitle:"æ¥çè¡¨çåºæ¬ä¿¡æ¯",charIndex:27},{level:3,title:"æ¥çè¡¨çåä¿¡æ¯",slug:"æ¥çè¡¨çåä¿¡æ¯",normalizedTitle:"æ¥çè¡¨çåä¿¡æ¯",charIndex:135},{level:3,title:"å¦ä½æ¹éå é¤å¤§éæ°æ®",slug:"å¦ä½æ¹éå é¤å¤§éæ°æ®",normalizedTitle:"å¦ä½æ¹éå é¤å¤§éæ°æ®",charIndex:243},{level:3,title:"ä¿®æ¹è¡¨çç¼ç æ ¼å¼",slug:"ä¿®æ¹è¡¨çç¼ç æ ¼å¼",normalizedTitle:"ä¿®æ¹è¡¨çç¼ç æ ¼å¼",charIndex:635},{level:2,title:"å¶ä»",slug:"å¶ä»",normalizedTitle:"å¶ä»",charIndex:816},{level:3,title:"æ¾ç¤ºåªäºçº¿ç¨æ­£å¨è¿è¡",slug:"æ¾ç¤ºåªäºçº¿ç¨æ­£å¨è¿è¡",normalizedTitle:"æ¾ç¤ºåªäºçº¿ç¨æ­£å¨è¿è¡",charIndex:823},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:1734}],headersStr:"æ°æ®åº è¡¨ æ¥çè¡¨çåºæ¬ä¿¡æ¯ æ¥çè¡¨çåä¿¡æ¯ å¦ä½æ¹éå é¤å¤§éæ°æ® ä¿®æ¹è¡¨çç¼ç æ ¼å¼ å¶ä» æ¾ç¤ºåªäºçº¿ç¨æ­£å¨è¿è¡ åèèµæ",content:"# æ©å± SQL\n\n\n# æ°æ®åº\n\n\n# è¡¨\n\n\n# æ¥çè¡¨çåºæ¬ä¿¡æ¯\n\nSELECT * FROM information_schema.tables\nWHERE table_schema = 'test' AND table_name = 'user';\n\n\n\n# æ¥çè¡¨çåä¿¡æ¯\n\nSELECT * FROM information_schema.columns\nWHERE table_schema = 'test' AND table_name = 'user';\n\n\n\n# å¦ä½æ¹éå é¤å¤§éæ°æ®\n\nå¦æè¦æ ¹æ®æ¶é´èå´æ¹éå é¤å¤§éæ°æ®ï¼æç®åçè¯­å¥å¦ä¸ï¼\n\ndelete from orders\nwhere timestamp < SUBDATE(CURDATE(),INTERVAL 3 month);\n\n\nä¸é¢çè¯­å¥ï¼å¤§æ¦çæ§è¡ä¼æ¥éï¼æç¤ºå é¤å¤±è´¥ï¼å ä¸ºéè¦å é¤çæ°æ®éå¤ªå¤§äºï¼æä»¥éè¦åæ¹å é¤ã\n\nå¯ä»¥åéè¿ä¸æ¬¡æ¥è¯¢ï¼æ¾å°ç¬¦åæ¡ä»¶çåå²è®¢åä¸­æå¤§çé£ä¸ªè®¢å IDï¼ç¶åå¨å é¤è¯­å¥ä¸­æå é¤çæ¡ä»¶è½¬æ¢ææä¸»é®å é¤ã\n\nselect max(id) from orders\nwhere timestamp < SUBDATE(CURDATE(),INTERVAL 3 month);\n\n-- åæ¹å é¤ï¼? å¡«ä¸ä¸æ¡è¯­å¥æ¥å°çæå¤§ ID\ndelete from orders\nwhere id <= ?\norder by id limit 1000;\n\n\n\n# ä¿®æ¹è¡¨çç¼ç æ ¼å¼\n\nutf8mb4 ç¼ç æ¯ utf8 ç¼ç çè¶éï¼å¼å®¹ utf8ï¼å¹¶ä¸è½å­å¨ 4 å­èçè¡¨æå­ç¬¦ãå¦æè¡¨çç¼ç æå®ä¸º utf8ï¼å¨ä¿å­ emoji å­æ®µæ¶ä¼æ¥éã\n\nALTER TABLE <tableName> CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;\n\n\n\n# å¶ä»\n\n\n# æ¾ç¤ºåªäºçº¿ç¨æ­£å¨è¿è¡\n\nmysql> show processlist;\n+----+-----------------+-----------------+------+---------+-------+------------------------+------------------+\n| Id | User            | Host            | db   | Command | Time  | State                  | Info             |\n+----+-----------------+-----------------+------+---------+-------+------------------------+------------------+\n|  5 | event_scheduler | localhost       | NULL | Daemon  | 40230 | Waiting on empty queue | NULL             |\n| 10 | root            | localhost:10120 | NULL | Query   |     0 | init                   | show processlist |\n+----+-----------------+-----------------+------+---------+-------+------------------------+------------------+\n2 rows in set (0.00 sec)\n\n\nMysql è¿æ¥å®æåï¼å¦æä½ æ²¡æåç»­çå¨ä½ï¼è¿ä¸ªè¿æ¥å°±å¤äºç©ºé²ç¶æï¼ä½ å¯ä»¥å¨ show processlist å½ä»¤ä¸­çå°å®ãå¶ä¸­ç Command åæ¾ç¤ºä¸ºâSleepâçè¿ä¸è¡ï¼å°±è¡¨ç¤ºç°å¨ç³»ç»éé¢æä¸ä¸ªç©ºé²è¿æ¥ãå®¢æ·ç«¯å¦æå¤ªé¿æ¶é´æ²¡å¨éï¼è¿æ¥å¨å°±ä¼èªå¨å°å®æ­å¼ãè¿ä¸ªæ¶é´æ¯ç±åæ° wait_timeout æ§å¶çï¼é»è®¤å¼æ¯ 8 å°æ¶ã\n\n\n# åèèµæ\n\n * ãSQL å¿ç¥å¿ä¼ã",normalizedContent:"# æ©å± sql\n\n\n# æ°æ®åº\n\n\n# è¡¨\n\n\n# æ¥çè¡¨çåºæ¬ä¿¡æ¯\n\nselect * from information_schema.tables\nwhere table_schema = 'test' and table_name = 'user';\n\n\n\n# æ¥çè¡¨çåä¿¡æ¯\n\nselect * from information_schema.columns\nwhere table_schema = 'test' and table_name = 'user';\n\n\n\n# å¦ä½æ¹éå é¤å¤§éæ°æ®\n\nå¦æè¦æ ¹æ®æ¶é´èå´æ¹éå é¤å¤§éæ°æ®ï¼æç®åçè¯­å¥å¦ä¸ï¼\n\ndelete from orders\nwhere timestamp < subdate(curdate(),interval 3 month);\n\n\nä¸é¢çè¯­å¥ï¼å¤§æ¦çæ§è¡ä¼æ¥éï¼æç¤ºå é¤å¤±è´¥ï¼å ä¸ºéè¦å é¤çæ°æ®éå¤ªå¤§äºï¼æä»¥éè¦åæ¹å é¤ã\n\nå¯ä»¥åéè¿ä¸æ¬¡æ¥è¯¢ï¼æ¾å°ç¬¦åæ¡ä»¶çåå²è®¢åä¸­æå¤§çé£ä¸ªè®¢å idï¼ç¶åå¨å é¤è¯­å¥ä¸­æå é¤çæ¡ä»¶è½¬æ¢ææä¸»é®å é¤ã\n\nselect max(id) from orders\nwhere timestamp < subdate(curdate(),interval 3 month);\n\n-- åæ¹å é¤ï¼? å¡«ä¸ä¸æ¡è¯­å¥æ¥å°çæå¤§ id\ndelete from orders\nwhere id <= ?\norder by id limit 1000;\n\n\n\n# ä¿®æ¹è¡¨çç¼ç æ ¼å¼\n\nutf8mb4 ç¼ç æ¯ utf8 ç¼ç çè¶éï¼å¼å®¹ utf8ï¼å¹¶ä¸è½å­å¨ 4 å­èçè¡¨æå­ç¬¦ãå¦æè¡¨çç¼ç æå®ä¸º utf8ï¼å¨ä¿å­ emoji å­æ®µæ¶ä¼æ¥éã\n\nalter table <tablename> convert to character set utf8mb4 collate utf8mb4_general_ci;\n\n\n\n# å¶ä»\n\n\n# æ¾ç¤ºåªäºçº¿ç¨æ­£å¨è¿è¡\n\nmysql> show processlist;\n+----+-----------------+-----------------+------+---------+-------+------------------------+------------------+\n| id | user            | host            | db   | command | time  | state                  | info             |\n+----+-----------------+-----------------+------+---------+-------+------------------------+------------------+\n|  5 | event_scheduler | localhost       | null | daemon  | 40230 | waiting on empty queue | null             |\n| 10 | root            | localhost:10120 | null | query   |     0 | init                   | show processlist |\n+----+-----------------+-----------------+------+---------+-------+------------------------+------------------+\n2 rows in set (0.00 sec)\n\n\nmysql è¿æ¥å®æåï¼å¦æä½ æ²¡æåç»­çå¨ä½ï¼è¿ä¸ªè¿æ¥å°±å¤äºç©ºé²ç¶æï¼ä½ å¯ä»¥å¨ show processlist å½ä»¤ä¸­çå°å®ãå¶ä¸­ç command åæ¾ç¤ºä¸ºâsleepâçè¿ä¸è¡ï¼å°±è¡¨ç¤ºç°å¨ç³»ç»éé¢æä¸ä¸ªç©ºé²è¿æ¥ãå®¢æ·ç«¯å¦æå¤ªé¿æ¶é´æ²¡å¨éï¼è¿æ¥å¨å°±ä¼èªå¨å°å®æ­å¼ãè¿ä¸ªæ¶é´æ¯ç±åæ° wait_timeout æ§å¶çï¼é»è®¤å¼æ¯ 8 å°æ¶ã\n\n\n# åèèµæ\n\n * ãsql å¿ç¥å¿ä¼ã",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"å³ç³»åæ°æ®åºç»¼åç¥è¯",frontmatter:{title:"å³ç³»åæ°æ®åºç»¼åç¥è¯",date:"2020-07-16T11:14:07.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","ç»¼å"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº"],permalink:"/pages/22f2e3/",hidden:!0},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/01.%E7%BB%BC%E5%90%88/",relativePath:"12.æ°æ®åº/03.å³ç³»åæ°æ®åº/01.ç»¼å/README.md",key:"v-0752b95e",path:"/pages/22f2e3/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:17},{level:3,title:"å³ç³»åæ°æ®åºé¢è¯æ»ç» ð¯",slug:"å³ç³»åæ°æ®åºé¢è¯æ»ç»-ð¯",normalizedTitle:"å³ç³»åæ°æ®åºé¢è¯æ»ç» ð¯",charIndex:27},{level:3,title:"SQL è¯­æ³åºç¡ç¹æ§",slug:"sql-è¯­æ³åºç¡ç¹æ§",normalizedTitle:"sql è¯­æ³åºç¡ç¹æ§",charIndex:45},{level:3,title:"SQL è¯­æ³é«çº§ç¹æ§",slug:"sql-è¯­æ³é«çº§ç¹æ§",normalizedTitle:"sql è¯­æ³é«çº§ç¹æ§",charIndex:60},{level:3,title:"æ©å± SQL",slug:"æ©å±-sql",normalizedTitle:"æ©å± sql",charIndex:75},{level:3,title:"SQL Cheat Sheet",slug:"sql-cheat-sheet",normalizedTitle:"sql cheat sheet",charIndex:86},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:106},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:326}],headersStr:"ð åå®¹ å³ç³»åæ°æ®åºé¢è¯æ»ç» ð¯ SQL è¯­æ³åºç¡ç¹æ§ SQL è¯­æ³é«çº§ç¹æ§ æ©å± SQL SQL Cheat Sheet ð èµæ ðª ä¼ é",content:"# å³ç³»åæ°æ®åºç»¼åç¥è¯\n\n\n# ð åå®¹\n\n\n# å³ç³»åæ°æ®åºé¢è¯æ»ç» ð¯\n\n\n# SQL è¯­æ³åºç¡ç¹æ§\n\n\n# SQL è¯­æ³é«çº§ç¹æ§\n\n\n# æ©å± SQL\n\n\n# SQL Cheat Sheet\n\n\n# ð èµæ\n\n * å®æ¹\n   * Mysql å®ç½\n   * Mysql å®æ¹ææ¡£\n   * Mysql å®æ¹ææ¡£ä¹å½ä»¤è¡å®¢æ·ç«¯\n * ä¹¦ç±\n   * ãé«æ§è½ MySQLã - Mysql ç»å¸\n   * ãSQL å¿ç¥å¿ä¼ã - SQL å¥é¨\n * æç¨\n   * runoob.com MySQL æç¨ - å¥é¨çº§ SQL æç¨\n   * mysql-tutorial\n * æ´å¤èµæº\n   * awesome-mysql\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç IT ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",normalizedContent:"# å³ç³»åæ°æ®åºç»¼åç¥è¯\n\n\n# ð åå®¹\n\n\n# å³ç³»åæ°æ®åºé¢è¯æ»ç» ð¯\n\n\n# sql è¯­æ³åºç¡ç¹æ§\n\n\n# sql è¯­æ³é«çº§ç¹æ§\n\n\n# æ©å± sql\n\n\n# sql cheat sheet\n\n\n# ð èµæ\n\n * å®æ¹\n   * mysql å®ç½\n   * mysql å®æ¹ææ¡£\n   * mysql å®æ¹ææ¡£ä¹å½ä»¤è¡å®¢æ·ç«¯\n * ä¹¦ç±\n   * ãé«æ§è½ mysqlã - mysql ç»å¸\n   * ãsql å¿ç¥å¿ä¼ã - sql å¥é¨\n * æç¨\n   * runoob.com mysql æç¨ - å¥é¨çº§ sql æç¨\n   * mysql-tutorial\n * æ´å¤èµæº\n   * awesome-mysql\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç it ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"SQL Cheat Sheet",frontmatter:{title:"SQL Cheat Sheet",date:"2022-07-16T14:17:08.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","ç»¼å"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","SQL"],permalink:"/pages/e438a7/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/01.%E7%BB%BC%E5%90%88/99.SqlCheatSheet.html",relativePath:"12.æ°æ®åº/03.å³ç³»åæ°æ®åº/01.ç»¼å/99.SqlCheatSheet.md",key:"v-3b295fba",path:"/pages/e438a7/",headers:[{level:2,title:"æ¥æ¾æ°æ®çæ¥è¯¢",slug:"æ¥æ¾æ°æ®çæ¥è¯¢",normalizedTitle:"æ¥æ¾æ°æ®çæ¥è¯¢",charIndex:22},{level:3,title:"SELECT: ç¨äºä»æ°æ®åºä¸­éæ©æ°æ®",slug:"select-ç¨äºä»æ°æ®åºä¸­éæ©æ°æ®",normalizedTitle:"select: ç¨äºä»æ°æ®åºä¸­éæ©æ°æ®",charIndex:34},{level:3,title:"DISTINCT: ç¨äºè¿æ»¤æéå¤çå¼å¹¶è¿åæå®åçè¡",slug:"distinct-ç¨äºè¿æ»¤æéå¤çå¼å¹¶è¿åæå®åçè¡",normalizedTitle:"distinct: ç¨äºè¿æ»¤æéå¤çå¼å¹¶è¿åæå®åçè¡",charIndex:88},{level:3,title:"WHERE: ç¨äºè¿æ»¤è®°å½/è¡",slug:"where-ç¨äºè¿æ»¤è®°å½-è¡",normalizedTitle:"where: ç¨äºè¿æ»¤è®°å½/è¡",charIndex:153},{level:3,title:"ORDER BY: ç¨äºç»æéçæåºï¼ååºï¼ASCï¼æèéåºï¼DESCï¼",slug:"order-by-ç¨äºç»æéçæåº-ååº-asc-æèéåº-desc",normalizedTitle:"order by: ç¨äºç»æéçæåºï¼ååºï¼ascï¼æèéåºï¼descï¼",charIndex:576},{level:3,title:"SELECT TOP: ç¨äºæå®ä»è¡¨é¡¶é¨è¿åçè®°å½æ°",slug:"select-top-ç¨äºæå®ä»è¡¨é¡¶é¨è¿åçè®°å½æ°",normalizedTitle:"select top: ç¨äºæå®ä»è¡¨é¡¶é¨è¿åçè®°å½æ°",charIndex:777},{level:3,title:"LIKE: ç¨äºæç´¢åä¸­çç¹å®æ¨¡å¼ï¼WHERE å­å¥ä¸­ä½¿ç¨çè¿ç®ç¬¦",slug:"like-ç¨äºæç´¢åä¸­çç¹å®æ¨¡å¼-where-å­å¥ä¸­ä½¿ç¨çè¿ç®ç¬¦",normalizedTitle:"like: ç¨äºæç´¢åä¸­çç¹å®æ¨¡å¼ï¼where å­å¥ä¸­ä½¿ç¨çè¿ç®ç¬¦",charIndex:1049},{level:3,title:"IN: ç¨äºå¨ WHERE å­å¥ä¸­æå®å¤ä¸ªå¼çè¿ç®ç¬¦",slug:"in-ç¨äºå¨-where-å­å¥ä¸­æå®å¤ä¸ªå¼çè¿ç®ç¬¦",normalizedTitle:"in: ç¨äºå¨ where å­å¥ä¸­æå®å¤ä¸ªå¼çè¿ç®ç¬¦",charIndex:1425},{level:3,title:"BETWEEN: ç¨äºè¿æ»¤ç»å®èå´çå¼çè¿ç®ç¬¦",slug:"between-ç¨äºè¿æ»¤ç»å®èå´çå¼çè¿ç®ç¬¦",normalizedTitle:"between: ç¨äºè¿æ»¤ç»å®èå´çå¼çè¿ç®ç¬¦",charIndex:1644},{level:3,title:"NULL: ä»£è¡¨ä¸ä¸ªå­æ®µæ²¡æå¼",slug:"null-ä»£è¡¨ä¸ä¸ªå­æ®µæ²¡æå¼",normalizedTitle:"null: ä»£è¡¨ä¸ä¸ªå­æ®µæ²¡æå¼",charIndex:1954},{level:3,title:"AS: ç¨äºç»è¡¨æèååéå«å",slug:"as-ç¨äºç»è¡¨æèååéå«å",normalizedTitle:"as: ç¨äºç»è¡¨æèååéå«å",charIndex:2089},{level:3,title:"UNION: ç¨äºç»åä¸¤ä¸ªæèå¤ä¸ª SELECT è¯­å¥çç»æéçè¿ç®ç¬¦",slug:"union-ç¨äºç»åä¸¤ä¸ªæèå¤ä¸ª-select-è¯­å¥çç»æéçè¿ç®ç¬¦",normalizedTitle:"union: ç¨äºç»åä¸¤ä¸ªæèå¤ä¸ª select è¯­å¥çç»æéçè¿ç®ç¬¦",charIndex:2357},{level:3,title:"ANY|ALL: ç¨äºæ£æ¥ WHERE æ HAVING å­å¥ä¸­ä½¿ç¨çå­æ¥è¯¢æ¡ä»¶çè¿ç®ç¬¦",slug:"any-all-ç¨äºæ£æ¥-where-æ-having-å­å¥ä¸­ä½¿ç¨çå­æ¥è¯¢æ¡ä»¶çè¿ç®ç¬¦",normalizedTitle:"any|all: ç¨äºæ£æ¥ where æ having å­å¥ä¸­ä½¿ç¨çå­æ¥è¯¢æ¡ä»¶çè¿ç®ç¬¦",charIndex:2577},{level:3,title:"GROUP BY: éå¸¸ä¸èåå½æ°ï¼COUNTï¼MAXï¼MINï¼SUMï¼AVGï¼ä¸èµ·ä½¿ç¨ï¼ç¨äºå°ç»æéåç»ä¸ºä¸åæå¤å",slug:"group-by-éå¸¸ä¸èåå½æ°-count-max-min-sum-avg-ä¸èµ·ä½¿ç¨-ç¨äºå°ç»æéåç»ä¸ºä¸åæå¤å",normalizedTitle:"group by: éå¸¸ä¸èåå½æ°ï¼countï¼maxï¼minï¼sumï¼avgï¼ä¸èµ·ä½¿ç¨ï¼ç¨äºå°ç»æéåç»ä¸ºä¸åæå¤å",charIndex:2815},{level:3,title:"HAVING: HAVING å­å¥æå® SELECT è¯­å¥åºä»è¿åèåå¼æ»¡è¶³æå®æ¡ä»¶çè¡ãå®è¢«æ·»å å° SQL è¯­è¨ä¸­ï¼å ä¸º WHERE å³é®å­ä¸è½ä¸èåå½æ°ä¸èµ·ä½¿ç¨ã",slug:"having-having-å­å¥æå®-select-è¯­å¥åºä»è¿åèåå¼æ»¡è¶³æå®æ¡ä»¶çè¡ãå®è¢«æ·»å å°-sql-è¯­è¨ä¸­-å ä¸º-where-å³é®å­ä¸è½ä¸èåå½æ°ä¸èµ·ä½¿ç¨ã",normalizedTitle:"having: having å­å¥æå® select è¯­å¥åºä»è¿åèåå¼æ»¡è¶³æå®æ¡ä»¶çè¡ãå®è¢«æ·»å å° sql è¯­è¨ä¸­ï¼å ä¸º where å³é®å­ä¸è½ä¸èåå½æ°ä¸èµ·ä½¿ç¨ã",charIndex:3013},{level:2,title:"ä¿®æ¹æ°æ®çæ¥è¯¢",slug:"ä¿®æ¹æ°æ®çæ¥è¯¢",normalizedTitle:"ä¿®æ¹æ°æ®çæ¥è¯¢",charIndex:3211},{level:3,title:"INSERT INTO: ç¨äºå¨è¡¨ä¸­æå¥æ°è®°å½/è¡",slug:"insert-into-ç¨äºå¨è¡¨ä¸­æå¥æ°è®°å½-è¡",normalizedTitle:"insert into: ç¨äºå¨è¡¨ä¸­æå¥æ°è®°å½/è¡",charIndex:3223},{level:3,title:"UPDATE: ç¨äºä¿®æ¹è¡¨ä¸­çç°æè®°å½/è¡",slug:"update-ç¨äºä¿®æ¹è¡¨ä¸­çç°æè®°å½-è¡",normalizedTitle:"update: ç¨äºä¿®æ¹è¡¨ä¸­çç°æè®°å½/è¡",charIndex:3377},{level:3,title:"DELETE: ç¨äºå é¤è¡¨ä¸­çç°æè®°å½/è¡",slug:"delete-ç¨äºå é¤è¡¨ä¸­çç°æè®°å½-è¡",normalizedTitle:"delete: ç¨äºå é¤è¡¨ä¸­çç°æè®°å½/è¡",charIndex:3527},{level:2,title:"èåæ¥è¯¢",slug:"èåæ¥è¯¢",normalizedTitle:"èåæ¥è¯¢",charIndex:3626},{level:3,title:"COUNT: è¿ååºç°æ¬¡æ°",slug:"count-è¿ååºç°æ¬¡æ°",normalizedTitle:"count: è¿ååºç°æ¬¡æ°",charIndex:3635},{level:3,title:"MIN() and MAX(): è¿åæéåçæå°/æå¤§å¼",slug:"min-and-max-è¿åæéåçæå°-æå¤§å¼",normalizedTitle:"min() and max(): è¿åæéåçæå°/æå¤§å¼",charIndex:3694},{level:3,title:"AVG(): è¿åæ°å­åçå¹³åå¼",slug:"avg-è¿åæ°å­åçå¹³åå¼",normalizedTitle:"avg(): è¿åæ°å­åçå¹³åå¼",charIndex:3853},{level:3,title:"SUM(): è¿åæ°å¼åçæ»å",slug:"sum-è¿åæ°å¼åçæ»å",normalizedTitle:"sum(): è¿åæ°å¼åçæ»å",charIndex:3936},{level:2,title:"è¿æ¥æ¥è¯¢",slug:"è¿æ¥æ¥è¯¢",normalizedTitle:"è¿æ¥æ¥è¯¢",charIndex:4018},{level:3,title:"INNER JOIN: åè¿æ¥ï¼è¿åå¨ä¸¤å¼ è¡¨ä¸­å·æå¹éå¼çè®°å½",slug:"inner-join-åè¿æ¥-è¿åå¨ä¸¤å¼ è¡¨ä¸­å·æå¹éå¼çè®°å½",normalizedTitle:"inner join: åè¿æ¥ï¼è¿åå¨ä¸¤å¼ è¡¨ä¸­å·æå¹éå¼çè®°å½",charIndex:4027},{level:3,title:"LEFT (OUTER) JOIN: å·¦å¤è¿æ¥ï¼è¿åå·¦è¡¨ï¼table1ï¼ä¸­çææè®°å½ï¼ä»¥åå³è¡¨ä¸­çå¹éè®°å½ï¼table2ï¼",slug:"left-outer-join-å·¦å¤è¿æ¥-è¿åå·¦è¡¨-table1-ä¸­çææè®°å½-ä»¥åå³è¡¨ä¸­çå¹éè®°å½-table2",normalizedTitle:"left (outer) join: å·¦å¤è¿æ¥ï¼è¿åå·¦è¡¨ï¼table1ï¼ä¸­çææè®°å½ï¼ä»¥åå³è¡¨ä¸­çå¹éè®°å½ï¼table2ï¼",charIndex:4316},{level:3,title:"RIGHT (OUTER) JOIN: å³å¤è¿æ¥ï¼è¿åå³è¡¨ï¼table2ï¼ä¸­çææè®°å½ï¼ä»¥åå·¦è¡¨ï¼table1ï¼ä¸­å¹éçè®°å½",slug:"right-outer-join-å³å¤è¿æ¥-è¿åå³è¡¨-table2-ä¸­çææè®°å½-ä»¥åå·¦è¡¨-table1-ä¸­å¹éçè®°å½",normalizedTitle:"right (outer) join: å³å¤è¿æ¥ï¼è¿åå³è¡¨ï¼table2ï¼ä¸­çææè®°å½ï¼ä»¥åå·¦è¡¨ï¼table1ï¼ä¸­å¹éçè®°å½",charIndex:4477},{level:3,title:"FULL (OUTER) JOIN: å¨å¤è¿æ¥ï¼å¨è¿æ¥æ¯å·¦å³å¤è¿æ¥çå¹¶é. è¿æ¥è¡¨åå«è¢«è¿æ¥çè¡¨çææè®°å½, å¦æç¼ºå°å¹éçè®°å½, ä»¥ NULL å¡«åã",slug:"full-outer-join-å¨å¤è¿æ¥-å¨è¿æ¥æ¯å·¦å³å¤è¿æ¥çå¹¶é-è¿æ¥è¡¨åå«è¢«è¿æ¥çè¡¨çææè®°å½-å¦æç¼ºå°å¹éçè®°å½-ä»¥-null-å¡«åã",normalizedTitle:"full (outer) join: å¨å¤è¿æ¥ï¼å¨è¿æ¥æ¯å·¦å³å¤è¿æ¥çå¹¶é. è¿æ¥è¡¨åå«è¢«è¿æ¥çè¡¨çææè®°å½, å¦æç¼ºå°å¹éçè®°å½, ä»¥ null å¡«åã",charIndex:4640},{level:3,title:"Self JOIN: èªè¿æ¥ï¼è¡¨èªèº«è¿æ¥",slug:"self-join-èªè¿æ¥-è¡¨èªèº«è¿æ¥",normalizedTitle:"self join: èªè¿æ¥ï¼è¡¨èªèº«è¿æ¥",charIndex:4822},{level:2,title:"è§å¾æ¥è¯¢",slug:"è§å¾æ¥è¯¢",normalizedTitle:"è§å¾æ¥è¯¢",charIndex:4914},{level:3,title:"CREATE: åå»ºè§å¾",slug:"create-åå»ºè§å¾",normalizedTitle:"create: åå»ºè§å¾",charIndex:4923},{level:3,title:"SELECT: æ£ç´¢è§å¾",slug:"select-æ£ç´¢è§å¾",normalizedTitle:"select: æ£ç´¢è§å¾",charIndex:5026},{level:3,title:"DROP: å é¤è§å¾",slug:"drop-å é¤è§å¾",normalizedTitle:"drop: å é¤è§å¾",charIndex:5072},{level:2,title:"ä¿®æ¹è¡¨çæ¥è¯¢",slug:"ä¿®æ¹è¡¨çæ¥è¯¢",normalizedTitle:"ä¿®æ¹è¡¨çæ¥è¯¢",charIndex:5112},{level:3,title:"ADD: æ·»å å­æ®µ",slug:"add-æ·»å å­æ®µ",normalizedTitle:"add: æ·»å å­æ®µ",charIndex:5123},{level:3,title:"MODIFY: ä¿®æ¹å­æ®µæ°æ®ç±»å",slug:"modify-ä¿®æ¹å­æ®µæ°æ®ç±»å",normalizedTitle:"modify: ä¿®æ¹å­æ®µæ°æ®ç±»å",charIndex:5199},{level:3,title:"DROP: å é¤å­æ®µ",slug:"drop-å é¤å­æ®µ",normalizedTitle:"drop: å é¤å­æ®µ",charIndex:5279}],headersStr:"æ¥æ¾æ°æ®çæ¥è¯¢ SELECT: ç¨äºä»æ°æ®åºä¸­éæ©æ°æ® DISTINCT: ç¨äºè¿æ»¤æéå¤çå¼å¹¶è¿åæå®åçè¡ WHERE: ç¨äºè¿æ»¤è®°å½/è¡ ORDER BY: ç¨äºç»æéçæåºï¼ååºï¼ASCï¼æèéåºï¼DESCï¼ SELECT TOP: ç¨äºæå®ä»è¡¨é¡¶é¨è¿åçè®°å½æ° LIKE: ç¨äºæç´¢åä¸­çç¹å®æ¨¡å¼ï¼WHERE å­å¥ä¸­ä½¿ç¨çè¿ç®ç¬¦ IN: ç¨äºå¨ WHERE å­å¥ä¸­æå®å¤ä¸ªå¼çè¿ç®ç¬¦ BETWEEN: ç¨äºè¿æ»¤ç»å®èå´çå¼çè¿ç®ç¬¦ NULL: ä»£è¡¨ä¸ä¸ªå­æ®µæ²¡æå¼ AS: ç¨äºç»è¡¨æèååéå«å UNION: ç¨äºç»åä¸¤ä¸ªæèå¤ä¸ª SELECT è¯­å¥çç»æéçè¿ç®ç¬¦ ANY|ALL: ç¨äºæ£æ¥ WHERE æ HAVING å­å¥ä¸­ä½¿ç¨çå­æ¥è¯¢æ¡ä»¶çè¿ç®ç¬¦ GROUP BY: éå¸¸ä¸èåå½æ°ï¼COUNTï¼MAXï¼MINï¼SUMï¼AVGï¼ä¸èµ·ä½¿ç¨ï¼ç¨äºå°ç»æéåç»ä¸ºä¸åæå¤å HAVING: HAVING å­å¥æå® SELECT è¯­å¥åºä»è¿åèåå¼æ»¡è¶³æå®æ¡ä»¶çè¡ãå®è¢«æ·»å å° SQL è¯­è¨ä¸­ï¼å ä¸º WHERE å³é®å­ä¸è½ä¸èåå½æ°ä¸èµ·ä½¿ç¨ã ä¿®æ¹æ°æ®çæ¥è¯¢ INSERT INTO: ç¨äºå¨è¡¨ä¸­æå¥æ°è®°å½/è¡ UPDATE: ç¨äºä¿®æ¹è¡¨ä¸­çç°æè®°å½/è¡ DELETE: ç¨äºå é¤è¡¨ä¸­çç°æè®°å½/è¡ èåæ¥è¯¢ COUNT: è¿ååºç°æ¬¡æ° MIN() and MAX(): è¿åæéåçæå°/æå¤§å¼ AVG(): è¿åæ°å­åçå¹³åå¼ SUM(): è¿åæ°å¼åçæ»å è¿æ¥æ¥è¯¢ INNER JOIN: åè¿æ¥ï¼è¿åå¨ä¸¤å¼ è¡¨ä¸­å·æå¹éå¼çè®°å½ LEFT (OUTER) JOIN: å·¦å¤è¿æ¥ï¼è¿åå·¦è¡¨ï¼table1ï¼ä¸­çææè®°å½ï¼ä»¥åå³è¡¨ä¸­çå¹éè®°å½ï¼table2ï¼ RIGHT (OUTER) JOIN: å³å¤è¿æ¥ï¼è¿åå³è¡¨ï¼table2ï¼ä¸­çææè®°å½ï¼ä»¥åå·¦è¡¨ï¼table1ï¼ä¸­å¹éçè®°å½ FULL (OUTER) JOIN: å¨å¤è¿æ¥ï¼å¨è¿æ¥æ¯å·¦å³å¤è¿æ¥çå¹¶é. è¿æ¥è¡¨åå«è¢«è¿æ¥çè¡¨çææè®°å½, å¦æç¼ºå°å¹éçè®°å½, ä»¥ NULL å¡«åã Self JOIN: èªè¿æ¥ï¼è¡¨èªèº«è¿æ¥ è§å¾æ¥è¯¢ CREATE: åå»ºè§å¾ SELECT: æ£ç´¢è§å¾ DROP: å é¤è§å¾ ä¿®æ¹è¡¨çæ¥è¯¢ ADD: æ·»å å­æ®µ MODIFY: ä¿®æ¹å­æ®µæ°æ®ç±»å DROP: å é¤å­æ®µ",content:"# SQL Cheat Sheet\n\n\n# æ¥æ¾æ°æ®çæ¥è¯¢\n\n\n# SELECT: ç¨äºä»æ°æ®åºä¸­éæ©æ°æ®\n\n * SELECT * FROM table_name;\n\n\n# DISTINCT: ç¨äºè¿æ»¤æéå¤çå¼å¹¶è¿åæå®åçè¡\n\n * SELECT DISTINCT column_name;\n\n\n# WHERE: ç¨äºè¿æ»¤è®°å½/è¡\n\n * SELECT column1, column2 FROM table_name WHERE condition;\n * SELECT * FROM table_name WHERE condition1 AND condition2;\n * SELECT * FROM table_name WHERE condition1 OR condition2;\n * SELECT * FROM table_name WHERE NOT condition;\n * SELECT * FROM table_name WHERE condition1 AND (condition2 OR condition3);\n * SELECT * FROM table_name WHERE EXISTS (SELECT column_name FROM table_name WHERE condition);\n\n\n# ORDER BY: ç¨äºç»æéçæåºï¼ååºï¼ASCï¼æèéåºï¼DESCï¼\n\n * SELECT * FROM table_name ORDER BY column;\n * SELECT * FROM table_name ORDER BY column DESC;\n * SELECT * FROM table_name ORDER BY column1 ASC, column2 DESC;\n\n\n# SELECT TOP: ç¨äºæå®ä»è¡¨é¡¶é¨è¿åçè®°å½æ°\n\n * SELECT TOP number columns_names FROM table_name WHERE condition;\n * SELECT TOP percent columns_names FROM table_name WHERE condition;\n * å¹¶éæææ°æ®åºç³»ç»é½æ¯æSELECT TOPã MySQL ä¸­æ¯LIMITå­å¥\n * SELECT column_names FROM table_name LIMIT offset, count;\n\n\n# LIKE: ç¨äºæç´¢åä¸­çç¹å®æ¨¡å¼ï¼WHERE å­å¥ä¸­ä½¿ç¨çè¿ç®ç¬¦\n\n * % (percent sign) æ¯ä¸ä¸ªè¡¨ç¤ºé¶ä¸ªï¼ä¸ä¸ªæå¤ä¸ªå­ç¬¦çééç¬¦\n * _ (underscore) æ¯ä¸ä¸ªè¡¨ç¤ºåä¸ªå­ç¬¦ééç¬¦\n * SELECT column_names FROM table_name WHERE column_name LIKE pattern;\n * LIKE âa%â ï¼æ¥æ¾ä»»ä½ä»¥âaâå¼å¤´çå¼ï¼\n * LIKE â%aâ ï¼æ¥æ¾ä»»ä½ä»¥âaâç»å°¾çå¼ï¼\n * LIKE â%or%â ï¼æ¥æ¾ä»»ä½åå«âorâçå¼ï¼\n * LIKE â_r%â ï¼æ¥æ¾ä»»ä½ç¬¬äºä½æ¯ârâçå¼ï¼\n * LIKE âa*%*%â ï¼æ¥æ¾ä»»ä½ä»¥âaâå¼å¤´ä¸é¿åº¦è³å°ä¸º 3 çå¼ï¼\n * LIKE â[a-c]%âï¼æ¥æ¾ä»»ä½ä»¥âaâæâbâæâcâå¼å¤´çå¼ï¼\n\n\n# IN: ç¨äºå¨ WHERE å­å¥ä¸­æå®å¤ä¸ªå¼çè¿ç®ç¬¦\n\n * æ¬è´¨ä¸ï¼IN è¿ç®ç¬¦æ¯å¤ä¸ª OR æ¡ä»¶çç®å\n * SELECT column_names FROM table_name WHERE column_name IN (value1, value2, â¦);\n * SELECT column_names FROM table_name WHERE column_name IN (SELECT STATEMENT);\n\n\n# BETWEEN: ç¨äºè¿æ»¤ç»å®èå´çå¼çè¿ç®ç¬¦\n\n * SELECT column_names FROM table_name WHERE column_name BETWEEN value1 AND value2;\n * SELECT * FROM Products WHERE (column_name BETWEEN value1 AND value2) AND NOT column_name2 IN (value3, value4);\n * SELECT * FROM Products WHERE column_name BETWEEN #01/07/1999# AND #03/12/1999#;\n\n\n# NULL: ä»£è¡¨ä¸ä¸ªå­æ®µæ²¡æå¼\n\n * SELECT * FROM table_name WHERE column_name IS NULL;\n * SELECT * FROM table_name WHERE column_name IS NOT NULL;\n\n\n# AS: ç¨äºç»è¡¨æèååéå«å\n\n * SELECT column_name AS alias_name FROM table_name;\n * SELECT column_name FROM table_name AS alias_name;\n * SELECT column_name AS alias_name1, column_name2 AS alias_name2;\n * SELECT column_name1, column_name2 + â, â + column_name3 AS alias_name;\n\n\n# UNION: ç¨äºç»åä¸¤ä¸ªæèå¤ä¸ª SELECT è¯­å¥çç»æéçè¿ç®ç¬¦\n\n * æ¯ä¸ª SELECT è¯­å¥å¿é¡»æ¥æç¸åçåæ°\n * åå¿é¡»æ¥æç¸ä¼¼çæ°æ®ç±»å\n * æ¯ä¸ª SELECT è¯­å¥ä¸­çåä¹å¿é¡»å·æç¸åçé¡ºåº\n * SELECT columns_names FROM table1 UNION SELECT column_name FROM table2;\n * UNION ä»åè®¸éæ©ä¸åçå¼, UNION ALL åè®¸éå¤\n\n\n# ANY|ALL: ç¨äºæ£æ¥ WHERE æ HAVING å­å¥ä¸­ä½¿ç¨çå­æ¥è¯¢æ¡ä»¶çè¿ç®ç¬¦\n\n * ANY å¦æä»»ä½å­æ¥è¯¢å¼æ»¡è¶³æ¡ä»¶ï¼åè¿å trueã\n * ALL å¦æææå­æ¥è¯¢å¼é½æ»¡è¶³æ¡ä»¶ï¼åè¿å trueã\n * SELECT columns_names FROM table1 WHERE column_name operator (ANY|ALL) (SELECT column_name FROM table_name WHERE condition);\n\n\n# GROUP BY: éå¸¸ä¸èåå½æ°ï¼COUNTï¼MAXï¼MINï¼SUMï¼AVGï¼ä¸èµ·ä½¿ç¨ï¼ç¨äºå°ç»æéåç»ä¸ºä¸åæå¤å\n\n * SELECT column_name1, COUNT(column_name2) FROM table_name WHERE condition GROUP BY column_name1 ORDER BY COUNT(column_name2) DESC;\n\n\n# HAVING: HAVING å­å¥æå® SELECT è¯­å¥åºä»è¿åèåå¼æ»¡è¶³æå®æ¡ä»¶çè¡ãå®è¢«æ·»å å° SQL è¯­è¨ä¸­ï¼å ä¸º WHERE å³é®å­ä¸è½ä¸èåå½æ°ä¸èµ·ä½¿ç¨ã\n\n * SELECT COUNT(column_name1), column_name2 FROM table GROUP BY column_name2 HAVING COUNT(column_name1) > 5;\n\n\n# ä¿®æ¹æ°æ®çæ¥è¯¢\n\n\n# INSERT INTO: ç¨äºå¨è¡¨ä¸­æå¥æ°è®°å½/è¡\n\n * INSERT INTO table_name (column1, column2) VALUES (value1, value2);\n * INSERT INTO table_name VALUES (value1, value2 â¦);\n\n\n# UPDATE: ç¨äºä¿®æ¹è¡¨ä¸­çç°æè®°å½/è¡\n\n * UPDATE table_name SET column1 = value1, column2 = value2 WHERE condition;\n * UPDATE table_name SET column_name = value;\n\n\n# DELETE: ç¨äºå é¤è¡¨ä¸­çç°æè®°å½/è¡\n\n * DELETE FROM table_name WHERE condition;\n * DELETE * FROM table_name;\n\n\n# èåæ¥è¯¢\n\n\n# COUNT: è¿ååºç°æ¬¡æ°\n\n * SELECT COUNT (DISTINCT column_name);\n\n\n# MIN() and MAX(): è¿åæéåçæå°/æå¤§å¼\n\n * SELECT MIN (column_names) FROM table_name WHERE condition;\n * SELECT MAX (column_names) FROM table_name WHERE condition;\n\n\n# AVG(): è¿åæ°å­åçå¹³åå¼\n\n * SELECT AVG (column_name) FROM table_name WHERE condition;\n\n\n# SUM(): è¿åæ°å¼åçæ»å\n\n * SELECT SUM (column_name) FROM table_name WHERE condition;\n\n\n# è¿æ¥æ¥è¯¢\n\n\n# INNER JOIN: åè¿æ¥ï¼è¿åå¨ä¸¤å¼ è¡¨ä¸­å·æå¹éå¼çè®°å½\n\n * SELECT column_names FROM table1 INNER JOIN table2 ON table1.column_name=table2.column_name;\n * SELECT table1.column_name1, table2.column_name2, table3.column_name3 FROM ((table1 INNER JOIN table2 ON relationship) INNER JOIN table3 ON relationship);\n\n\n# LEFT (OUTER) JOIN: å·¦å¤è¿æ¥ï¼è¿åå·¦è¡¨ï¼table1ï¼ä¸­çææè®°å½ï¼ä»¥åå³è¡¨ä¸­çå¹éè®°å½ï¼table2ï¼\n\n * SELECT column_names FROM table1 LEFT JOIN table2 ON table1.column_name=table2.column_name;\n\n\n# RIGHT (OUTER) JOIN: å³å¤è¿æ¥ï¼è¿åå³è¡¨ï¼table2ï¼ä¸­çææè®°å½ï¼ä»¥åå·¦è¡¨ï¼table1ï¼ä¸­å¹éçè®°å½\n\n * SELECT column_names FROM table1 RIGHT JOIN table2 ON table1.column_name=table2.column_name;\n\n\n# FULL (OUTER) JOIN: å¨å¤è¿æ¥ï¼å¨è¿æ¥æ¯å·¦å³å¤è¿æ¥çå¹¶é. è¿æ¥è¡¨åå«è¢«è¿æ¥çè¡¨çææè®°å½, å¦æç¼ºå°å¹éçè®°å½, ä»¥ NULL å¡«åã\n\n * SELECT column_names FROM table1 FULL OUTER JOIN table2 ON table1.column_name=table2.column_name;\n\n\n# Self JOIN: èªè¿æ¥ï¼è¡¨èªèº«è¿æ¥\n\n * SELECT column_names FROM table1 T1, table1 T2 WHERE condition;\n\n\n# è§å¾æ¥è¯¢\n\n\n# CREATE: åå»ºè§å¾\n\n * CREATE VIEW view_name AS SELECT column1, column2 FROM table_name WHERE condition;\n\n\n# SELECT: æ£ç´¢è§å¾\n\n * SELECT * FROM view_name;\n\n\n# DROP: å é¤è§å¾\n\n * DROP VIEW view_name;\n\n\n# ä¿®æ¹è¡¨çæ¥è¯¢\n\n\n# ADD: æ·»å å­æ®µ\n\n * ALTER TABLE table_name ADD column_name column_definition;\n\n\n# MODIFY: ä¿®æ¹å­æ®µæ°æ®ç±»å\n\n * ALTER TABLE table_name MODIFY column_name column_type;\n\n\n# DROP: å é¤å­æ®µ\n\n * ALTER TABLE table_name DROP COLUMN column_name;",normalizedContent:"# sql cheat sheet\n\n\n# æ¥æ¾æ°æ®çæ¥è¯¢\n\n\n# select: ç¨äºä»æ°æ®åºä¸­éæ©æ°æ®\n\n * select * from table_name;\n\n\n# distinct: ç¨äºè¿æ»¤æéå¤çå¼å¹¶è¿åæå®åçè¡\n\n * select distinct column_name;\n\n\n# where: ç¨äºè¿æ»¤è®°å½/è¡\n\n * select column1, column2 from table_name where condition;\n * select * from table_name where condition1 and condition2;\n * select * from table_name where condition1 or condition2;\n * select * from table_name where not condition;\n * select * from table_name where condition1 and (condition2 or condition3);\n * select * from table_name where exists (select column_name from table_name where condition);\n\n\n# order by: ç¨äºç»æéçæåºï¼ååºï¼ascï¼æèéåºï¼descï¼\n\n * select * from table_name order by column;\n * select * from table_name order by column desc;\n * select * from table_name order by column1 asc, column2 desc;\n\n\n# select top: ç¨äºæå®ä»è¡¨é¡¶é¨è¿åçè®°å½æ°\n\n * select top number columns_names from table_name where condition;\n * select top percent columns_names from table_name where condition;\n * å¹¶éæææ°æ®åºç³»ç»é½æ¯æselect topã mysql ä¸­æ¯limitå­å¥\n * select column_names from table_name limit offset, count;\n\n\n# like: ç¨äºæç´¢åä¸­çç¹å®æ¨¡å¼ï¼where å­å¥ä¸­ä½¿ç¨çè¿ç®ç¬¦\n\n * % (percent sign) æ¯ä¸ä¸ªè¡¨ç¤ºé¶ä¸ªï¼ä¸ä¸ªæå¤ä¸ªå­ç¬¦çééç¬¦\n * _ (underscore) æ¯ä¸ä¸ªè¡¨ç¤ºåä¸ªå­ç¬¦ééç¬¦\n * select column_names from table_name where column_name like pattern;\n * like âa%â ï¼æ¥æ¾ä»»ä½ä»¥âaâå¼å¤´çå¼ï¼\n * like â%aâ ï¼æ¥æ¾ä»»ä½ä»¥âaâç»å°¾çå¼ï¼\n * like â%or%â ï¼æ¥æ¾ä»»ä½åå«âorâçå¼ï¼\n * like â_r%â ï¼æ¥æ¾ä»»ä½ç¬¬äºä½æ¯ârâçå¼ï¼\n * like âa*%*%â ï¼æ¥æ¾ä»»ä½ä»¥âaâå¼å¤´ä¸é¿åº¦è³å°ä¸º 3 çå¼ï¼\n * like â[a-c]%âï¼æ¥æ¾ä»»ä½ä»¥âaâæâbâæâcâå¼å¤´çå¼ï¼\n\n\n# in: ç¨äºå¨ where å­å¥ä¸­æå®å¤ä¸ªå¼çè¿ç®ç¬¦\n\n * æ¬è´¨ä¸ï¼in è¿ç®ç¬¦æ¯å¤ä¸ª or æ¡ä»¶çç®å\n * select column_names from table_name where column_name in (value1, value2, â¦);\n * select column_names from table_name where column_name in (select statement);\n\n\n# between: ç¨äºè¿æ»¤ç»å®èå´çå¼çè¿ç®ç¬¦\n\n * select column_names from table_name where column_name between value1 and value2;\n * select * from products where (column_name between value1 and value2) and not column_name2 in (value3, value4);\n * select * from products where column_name between #01/07/1999# and #03/12/1999#;\n\n\n# null: ä»£è¡¨ä¸ä¸ªå­æ®µæ²¡æå¼\n\n * select * from table_name where column_name is null;\n * select * from table_name where column_name is not null;\n\n\n# as: ç¨äºç»è¡¨æèååéå«å\n\n * select column_name as alias_name from table_name;\n * select column_name from table_name as alias_name;\n * select column_name as alias_name1, column_name2 as alias_name2;\n * select column_name1, column_name2 + â, â + column_name3 as alias_name;\n\n\n# union: ç¨äºç»åä¸¤ä¸ªæèå¤ä¸ª select è¯­å¥çç»æéçè¿ç®ç¬¦\n\n * æ¯ä¸ª select è¯­å¥å¿é¡»æ¥æç¸åçåæ°\n * åå¿é¡»æ¥æç¸ä¼¼çæ°æ®ç±»å\n * æ¯ä¸ª select è¯­å¥ä¸­çåä¹å¿é¡»å·æç¸åçé¡ºåº\n * select columns_names from table1 union select column_name from table2;\n * union ä»åè®¸éæ©ä¸åçå¼, union all åè®¸éå¤\n\n\n# any|all: ç¨äºæ£æ¥ where æ having å­å¥ä¸­ä½¿ç¨çå­æ¥è¯¢æ¡ä»¶çè¿ç®ç¬¦\n\n * any å¦æä»»ä½å­æ¥è¯¢å¼æ»¡è¶³æ¡ä»¶ï¼åè¿å trueã\n * all å¦æææå­æ¥è¯¢å¼é½æ»¡è¶³æ¡ä»¶ï¼åè¿å trueã\n * select columns_names from table1 where column_name operator (any|all) (select column_name from table_name where condition);\n\n\n# group by: éå¸¸ä¸èåå½æ°ï¼countï¼maxï¼minï¼sumï¼avgï¼ä¸èµ·ä½¿ç¨ï¼ç¨äºå°ç»æéåç»ä¸ºä¸åæå¤å\n\n * select column_name1, count(column_name2) from table_name where condition group by column_name1 order by count(column_name2) desc;\n\n\n# having: having å­å¥æå® select è¯­å¥åºä»è¿åèåå¼æ»¡è¶³æå®æ¡ä»¶çè¡ãå®è¢«æ·»å å° sql è¯­è¨ä¸­ï¼å ä¸º where å³é®å­ä¸è½ä¸èåå½æ°ä¸èµ·ä½¿ç¨ã\n\n * select count(column_name1), column_name2 from table group by column_name2 having count(column_name1) > 5;\n\n\n# ä¿®æ¹æ°æ®çæ¥è¯¢\n\n\n# insert into: ç¨äºå¨è¡¨ä¸­æå¥æ°è®°å½/è¡\n\n * insert into table_name (column1, column2) values (value1, value2);\n * insert into table_name values (value1, value2 â¦);\n\n\n# update: ç¨äºä¿®æ¹è¡¨ä¸­çç°æè®°å½/è¡\n\n * update table_name set column1 = value1, column2 = value2 where condition;\n * update table_name set column_name = value;\n\n\n# delete: ç¨äºå é¤è¡¨ä¸­çç°æè®°å½/è¡\n\n * delete from table_name where condition;\n * delete * from table_name;\n\n\n# èåæ¥è¯¢\n\n\n# count: è¿ååºç°æ¬¡æ°\n\n * select count (distinct column_name);\n\n\n# min() and max(): è¿åæéåçæå°/æå¤§å¼\n\n * select min (column_names) from table_name where condition;\n * select max (column_names) from table_name where condition;\n\n\n# avg(): è¿åæ°å­åçå¹³åå¼\n\n * select avg (column_name) from table_name where condition;\n\n\n# sum(): è¿åæ°å¼åçæ»å\n\n * select sum (column_name) from table_name where condition;\n\n\n# è¿æ¥æ¥è¯¢\n\n\n# inner join: åè¿æ¥ï¼è¿åå¨ä¸¤å¼ è¡¨ä¸­å·æå¹éå¼çè®°å½\n\n * select column_names from table1 inner join table2 on table1.column_name=table2.column_name;\n * select table1.column_name1, table2.column_name2, table3.column_name3 from ((table1 inner join table2 on relationship) inner join table3 on relationship);\n\n\n# left (outer) join: å·¦å¤è¿æ¥ï¼è¿åå·¦è¡¨ï¼table1ï¼ä¸­çææè®°å½ï¼ä»¥åå³è¡¨ä¸­çå¹éè®°å½ï¼table2ï¼\n\n * select column_names from table1 left join table2 on table1.column_name=table2.column_name;\n\n\n# right (outer) join: å³å¤è¿æ¥ï¼è¿åå³è¡¨ï¼table2ï¼ä¸­çææè®°å½ï¼ä»¥åå·¦è¡¨ï¼table1ï¼ä¸­å¹éçè®°å½\n\n * select column_names from table1 right join table2 on table1.column_name=table2.column_name;\n\n\n# full (outer) join: å¨å¤è¿æ¥ï¼å¨è¿æ¥æ¯å·¦å³å¤è¿æ¥çå¹¶é. è¿æ¥è¡¨åå«è¢«è¿æ¥çè¡¨çææè®°å½, å¦æç¼ºå°å¹éçè®°å½, ä»¥ null å¡«åã\n\n * select column_names from table1 full outer join table2 on table1.column_name=table2.column_name;\n\n\n# self join: èªè¿æ¥ï¼è¡¨èªèº«è¿æ¥\n\n * select column_names from table1 t1, table1 t2 where condition;\n\n\n# è§å¾æ¥è¯¢\n\n\n# create: åå»ºè§å¾\n\n * create view view_name as select column1, column2 from table_name where condition;\n\n\n# select: æ£ç´¢è§å¾\n\n * select * from view_name;\n\n\n# drop: å é¤è§å¾\n\n * drop view view_name;\n\n\n# ä¿®æ¹è¡¨çæ¥è¯¢\n\n\n# add: æ·»å å­æ®µ\n\n * alter table table_name add column_name column_definition;\n\n\n# modify: ä¿®æ¹å­æ®µæ°æ®ç±»å\n\n * alter table table_name modify column_name column_type;\n\n\n# drop: å é¤å­æ®µ\n\n * alter table table_name drop column column_name;",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Mysql åºç¨æå",frontmatter:{title:"Mysql åºç¨æå",date:"2020-07-13T10:08:37.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],permalink:"/pages/5fe0f3/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/02.Mysql/01.Mysql%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97.html",relativePath:"12.æ°æ®åº/03.å³ç³»åæ°æ®åº/02.Mysql/01.Mysqlåºç¨æå.md",key:"v-b19bf61e",path:"/pages/5fe0f3/",headers:[{level:2,title:"SQL æ§è¡è¿ç¨",slug:"sql-æ§è¡è¿ç¨",normalizedTitle:"sql æ§è¡è¿ç¨",charIndex:17},{level:2,title:"å­å¨å¼æ",slug:"å­å¨å¼æ",normalizedTitle:"å­å¨å¼æ",charIndex:79},{level:3,title:"éæ©å­å¨å¼æ",slug:"éæ©å­å¨å¼æ",normalizedTitle:"éæ©å­å¨å¼æ",charIndex:307},{level:4,title:"Mysql åç½®çå­å¨å¼æ",slug:"mysql-åç½®çå­å¨å¼æ",normalizedTitle:"mysql åç½®çå­å¨å¼æ",charIndex:317},{level:4,title:"å¦ä½éæ©åéçå­å¨å¼æ",slug:"å¦ä½éæ©åéçå­å¨å¼æ",normalizedTitle:"å¦ä½éæ©åéçå­å¨å¼æ",charIndex:2347},{level:4,title:"è½¬æ¢è¡¨çå­å¨å¼æ",slug:"è½¬æ¢è¡¨çå­å¨å¼æ",normalizedTitle:"è½¬æ¢è¡¨çå­å¨å¼æ",charIndex:2776},{level:3,title:"MyISAM",slug:"myisam",normalizedTitle:"myisam",charIndex:1286},{level:3,title:"InnoDB",slug:"innodb",normalizedTitle:"innodb",charIndex:1020},{level:2,title:"æ°æ®ç±»å",slug:"æ°æ®ç±»å",normalizedTitle:"æ°æ®ç±»å",charIndex:3632},{level:3,title:"æ´å",slug:"æ´å",normalizedTitle:"æ´å",charIndex:3641},{level:3,title:"æµ®ç¹å",slug:"æµ®ç¹å",normalizedTitle:"æµ®ç¹å",charIndex:3814},{level:3,title:"å­ç¬¦ä¸²",slug:"å­ç¬¦ä¸²",normalizedTitle:"å­ç¬¦ä¸²",charIndex:4029},{level:3,title:"æ¶é´åæ¥æ",slug:"æ¶é´åæ¥æ",normalizedTitle:"æ¶é´åæ¥æ",charIndex:4240},{level:4,title:"DATATIME",slug:"datatime",normalizedTitle:"datatime",charIndex:4268},{level:4,title:"TIMESTAMP",slug:"timestamp",normalizedTitle:"timestamp",charIndex:4279},{level:3,title:"BLOB å TEXT",slug:"blob-å-text",normalizedTitle:"blob å text",charIndex:4752},{level:3,title:"æä¸¾ç±»å",slug:"æä¸¾ç±»å",normalizedTitle:"æä¸¾ç±»å",charIndex:4849},{level:3,title:"ç±»åçéæ©",slug:"ç±»åçéæ©",normalizedTitle:"ç±»åçéæ©",charIndex:4952},{level:2,title:"ç´¢å¼",slug:"ç´¢å¼",normalizedTitle:"ç´¢å¼",charIndex:268},{level:2,title:"é",slug:"é",normalizedTitle:"é",charIndex:2145},{level:2,title:"äºå¡",slug:"äºå¡",normalizedTitle:"äºå¡",charIndex:2130},{level:2,title:"æ§è½ä¼å",slug:"æ§è½ä¼å",normalizedTitle:"æ§è½ä¼å",charIndex:5351},{level:2,title:"å¤å¶",slug:"å¤å¶",normalizedTitle:"å¤å¶",charIndex:5377},{level:3,title:"ä¸»ä»å¤å¶",slug:"ä¸»ä»å¤å¶",normalizedTitle:"ä¸»ä»å¤å¶",charIndex:5384},{level:3,title:"è¯»ååç¦»",slug:"è¯»ååç¦»",normalizedTitle:"è¯»ååç¦»",charIndex:2539},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:5865},{level:2,title:"ä¼ éé¨",slug:"ä¼ éé¨",normalizedTitle:"ä¼ éé¨",charIndex:6007}],headersStr:"SQL æ§è¡è¿ç¨ å­å¨å¼æ éæ©å­å¨å¼æ Mysql åç½®çå­å¨å¼æ å¦ä½éæ©åéçå­å¨å¼æ è½¬æ¢è¡¨çå­å¨å¼æ MyISAM InnoDB æ°æ®ç±»å æ´å æµ®ç¹å å­ç¬¦ä¸² æ¶é´åæ¥æ DATATIME TIMESTAMP BLOB å TEXT æä¸¾ç±»å ç±»åçéæ© ç´¢å¼ é äºå¡ æ§è½ä¼å å¤å¶ ä¸»ä»å¤å¶ è¯»ååç¦» åèèµæ ä¼ éé¨",content:"# Mysql åºç¨æå\n\n\n# SQL æ§è¡è¿ç¨\n\nå­¦ä¹  Mysqlï¼æå¥½æ¯åä»å®è§ä¸äºè§£ Mysql å·¥ä½åçã\n\n> åèï¼Mysql å·¥ä½æµ\n\n\n# å­å¨å¼æ\n\nå¨æä»¶ç³»ç»ä¸­ï¼Mysql å°æ¯ä¸ªæ°æ®åºï¼ä¹å¯ä»¥æä¸º schemaï¼ä¿å­ä¸ºæ°æ®ç®å½ä¸çä¸ä¸ªå­ç®å½ãåå»ºè¡¨ç¤ºï¼Mysql ä¼å¨æ°æ®åºå­ç®å½ä¸åå»ºä¸ä¸ªåè¡¨ååç .frm æä»¶ä¿å­è¡¨çå®ä¹ãå ä¸º Mysql ä½¿ç¨æä»¶ç³»ç»çç®å½åæä»¶æ¥ä¿å­æ°æ®åºåè¡¨çå®ä¹ï¼å¤§å°åæææ§åå·ä½å¹³å°å¯åç¸å³ãWindows ä¸­å¤§å°åä¸ææï¼ç±» Unix ä¸­å¤§å°åææãä¸åçå­å¨å¼æä¿å­æ°æ®åç´¢å¼çæ¹å¼æ¯ä¸åçï¼ä½è¡¨çå®ä¹åæ¯å¨ Mysql æå¡å±ç»ä¸å¤ççã\n\n\n# éæ©å­å¨å¼æ\n\n# Mysql åç½®çå­å¨å¼æ\n\nmysql> SHOW ENGINES;\n+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+\n| Engine             | Support | Comment                                                        | Transactions | XA   | Savepoints |\n+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+\n| FEDERATED          | NO      | Federated MySQL storage engine                                 | NULL         | NULL | NULL       |\n| MEMORY             | YES     | Hash based, stored in memory, useful for temporary tables      | NO           | NO   | NO         |\n| InnoDB             | DEFAULT | Supports transactions, row-level locking, and foreign keys     | YES          | YES  | YES        |\n| PERFORMANCE_SCHEMA | YES     | Performance Schema                                             | NO           | NO   | NO         |\n| MyISAM             | YES     | MyISAM storage engine                                          | NO           | NO   | NO         |\n| MRG_MYISAM         | YES     | Collection of identical MyISAM tables                          | NO           | NO   | NO         |\n| BLACKHOLE          | YES     | /dev/null storage engine (anything you write to it disappears) | NO           | NO   | NO         |\n| CSV                | YES     | CSV storage engine                                             | NO           | NO   | NO         |\n| ARCHIVE            | YES     | Archive storage engine                                         | NO           | NO   | NO         |\n+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+\n9 rows in set (0.00 sec)\n\n\n * InnoDB - Mysql çé»è®¤äºå¡åå­å¨å¼æï¼å¹¶ä¸æä¾äºè¡çº§éåå¤é®ççº¦æãæ§è½ä¸éä¸æ¯æèªå¨å´©æºæ¢å¤ã\n * MyISAM - Mysql 5.1 çæ¬åçé»è®¤å­å¨å¼æãç¹æ§ä¸°å¯ä½ä¸æ¯æäºå¡ï¼ä¹ä¸æ¯æè¡çº§éåå¤é®ï¼ä¹æ²¡æå´©æºæ¢å¤åè½ã\n * CSV - å¯ä»¥å° CSV æä»¶ä½ä¸º Mysql çè¡¨æ¥å¤çï¼ä½è¿ç§è¡¨ä¸æ¯æç´¢å¼ã\n * Memory - éåå¿«éè®¿é®æ°æ®ï¼ä¸æ°æ®ä¸ä¼è¢«ä¿®æ¹ï¼éå¯ä¸¢å¤±ä¹æ²¡æå³ç³»ã\n * NDB - ç¨äº Mysql éç¾¤åºæ¯ã\n\n# å¦ä½éæ©åéçå­å¨å¼æ\n\nå¤§å¤æ°æåµä¸ï¼InnoDB é½æ¯æ­£ç¡®çéæ©ï¼é¤ééè¦ç¨å° InnoDB ä¸å·å¤çç¹æ§ã\n\nå¦æåºç¨éè¦éæ© InnoDB ä»¥å¤çå­å¨å¼æï¼å¯ä»¥èèä»¥ä¸å ç´ ï¼\n\n * äºå¡ï¼å¦æéè¦æ¯æäºå¡ï¼InnoDB æ¯é¦éãå¦æä¸éè¦æ¯æäºå¡ï¼ä¸ä¸»è¦æ¯ SELECT å INSERT æä½ï¼MyISAM æ¯ä¸éçéæ©ãæä»¥ï¼å¦æ Mysql é¨ç½²æ¹å¼ä¸ºä¸»å¤æ¨¡å¼ï¼å¹¶è¿è¡è¯»ååç¦»ãé£ä¹å¯ä»¥è¿ä¹åï¼ä¸»èç¹åªæ¯æåæä½ï¼é»è®¤å¼æä¸º InnoDBï¼å¤èç¹åªæ¯æè¯»æä½ï¼é»è®¤å¼æä¸º MyISAMã\n * å¹¶åï¼MyISAM åªæ¯æè¡¨çº§éï¼è InnoDB è¿æ¯æè¡çº§éãæä»¥ï¼InnoDB å¹¶åæ§è½æ´é«ã\n * å¤é®ï¼InnoDB æ¯æå¤é®ã\n * å¤ä»½ï¼InnoDB æ¯æå¨çº¿ç­å¤ä»½ã\n * å´©æºæ¢å¤ï¼MyISAM å´©æºååçæåçæ¦çæ¯ InnoDB é«å¾å¤ï¼èä¸æ¢å¤çéåº¦ä¹æ´æ¢ã\n * å¶å®ç¹æ§ï¼MyISAM æ¯æåç¼©è¡¨åç©ºé´æ°æ®ç´¢å¼ã\n\n# è½¬æ¢è¡¨çå­å¨å¼æ\n\nä¸é¢çè¯­å¥å¯ä»¥å° mytable è¡¨çå¼æä¿®æ¹ä¸º InnoDB\n\nALTER TABLE mytable ENGINE = InnoDB\n\n\n\n# MyISAM\n\nMyISAM è®¾è®¡ç®åï¼æ°æ®ä»¥ç´§å¯æ ¼å¼å­å¨ãå¯¹äºåªè¯»æ°æ®ï¼æèè¡¨æ¯è¾å°ãå¯ä»¥å®¹å¿ä¿®å¤æä½ï¼åä¾ç¶å¯ä»¥ä½¿ç¨ MyISAMã\n\nMyISAM å¼æä½¿ç¨ B+Tree ä½ä¸ºç´¢å¼ç»æï¼å¶èç¹ç data åå­æ¾çæ¯æ°æ®è®°å½çå°åã\n\nMyISAM æä¾äºå¤§éçç¹æ§ï¼åæ¬ï¼å¨æç´¢å¼ãåç¼©è¡¨ãç©ºé´å½æ°ç­ãä½æ¯ï¼MyISAM ä¸æ¯æäºå¡åè¡çº§éãå¹¶ä¸ MyISAM ä¸æ¯æå´©æºåçå®å¨æ¢å¤ã\n\n\n# InnoDB\n\nInnoDB æ¯ MySQL é»è®¤çäºå¡åå­å¨å¼æï¼åªæå¨éè¦ InnoDB ä¸æ¯æçç¹æ§æ¶ï¼æèèä½¿ç¨å¶å®å­å¨å¼æã\n\nç¶ InnoDB ä¹ä½¿ç¨ B+Tree ä½ä¸ºç´¢å¼ç»æï¼ä½å·ä½å®ç°æ¹å¼å´ä¸ MyISAM æªç¶ä¸åãMyISAM ç´¢å¼æä»¶åæ°æ®æä»¶æ¯åç¦»çï¼ç´¢å¼æä»¶ä»ä¿å­æ°æ®è®°å½çå°åãèå¨ InnoDB ä¸­ï¼è¡¨æ°æ®æä»¶æ¬èº«å°±æ¯æ B+Tree ç»ç»çä¸ä¸ªç´¢å¼ç»æï¼è¿æ£µæ çå¶èç¹ data åä¿å­äºå®æ´çæ°æ®è®°å½ãè¿ä¸ªç´¢å¼ç key æ¯æ°æ®è¡¨çä¸»é®ï¼å æ­¤InnoDB è¡¨æ°æ®æä»¶æ¬èº«å°±æ¯ä¸»ç´¢å¼ã\n\nInnoDB éç¨ MVCC æ¥æ¯æé«å¹¶åï¼å¹¶ä¸å®ç°äºåä¸ªæ åçéç¦»çº§å«ãå¶é»è®¤çº§å«æ¯å¯éå¤è¯»ï¼REPEATABLE READï¼ï¼å¹¶ä¸éè¿é´ééï¼next-key lockingï¼é²æ­¢å¹»è¯»ã\n\nInnoDB æ¯åºäºèç°ç´¢å¼å»ºç«çï¼ä¸å¶ä»å­å¨å¼ææå¾å¤§ä¸åãå¨ç´¢å¼ä¸­ä¿å­äºæ°æ®ï¼ä»èé¿åç´æ¥è¯»åç£çï¼å æ­¤å¯¹æ¥è¯¢æ§è½æå¾å¤§çæåã\n\nåé¨åäºå¾å¤ä¼åï¼åæ¬ä»ç£çè¯»åæ°æ®æ¶éç¨çå¯é¢æµæ§è¯»ãè½å¤å å¿«è¯»æä½å¹¶ä¸èªå¨åå»ºçèªéåºåå¸ç´¢å¼ãè½å¤å éæå¥æä½çæå¥ç¼å²åºç­ã\n\næ¯æçæ­£çå¨çº¿ç­å¤ä»½ãå¶å®å­å¨å¼æä¸æ¯æå¨çº¿ç­å¤ä»½ï¼è¦è·åä¸è´æ§è§å¾éè¦åæ­¢å¯¹ææè¡¨çåå¥ï¼èå¨è¯»åæ··ååºæ¯ä¸­ï¼åæ­¢åå¥å¯è½ä¹æå³çåæ­¢è¯»åã\n\n\n# æ°æ®ç±»å\n\n\n# æ´å\n\nTINYINT, SMALLINT, MEDIUMINT, INT, BIGINT åå«ä½¿ç¨ 8, 16, 24, 32, 64 ä½å­å¨ç©ºé´ï¼ä¸è¬æåµä¸è¶å°çåè¶å¥½ã\n\nUNSIGNED è¡¨ç¤ºä¸åè®¸è´å¼ï¼å¤§è´å¯ä»¥ä½¿æ­£æ°çä¸éæé«ä¸åã\n\nINT(11) ä¸­çæ°å­åªæ¯è§å®äºäº¤äºå·¥å·æ¾ç¤ºå­ç¬¦çä¸ªæ°ï¼å¯¹äºå­å¨åè®¡ç®æ¥è¯´æ¯æ²¡ææä¹çã\n\n\n# æµ®ç¹å\n\nFLOAT å DOUBLE ä¸ºæµ®ç¹ç±»åã\n\nDECIMAL ç±»åä¸»è¦ç¨äºç²¾ç¡®è®¡ç®ï¼ä»£ä»·è¾é«ï¼åºè¯¥å°½éåªå¨å¯¹å°æ°è¿è¡ç²¾ç¡®è®¡ç®æ¶æä½¿ç¨ DECIMAL ââä¾å¦å­å¨è´¢å¡æ°æ®ãæ°æ®éæ¯è¾å¤§çæ¶åï¼å¯ä»¥ä½¿ç¨ BIGINT ä»£æ¿ DECIMALã\n\nFLOATãDOUBLE å DECIMAL é½å¯ä»¥æå®åå®½ï¼ä¾å¦ DECIMAL(18, 9) è¡¨ç¤ºæ»å± 18 ä½ï¼å 9 ä½å­å¨å°æ°é¨åï¼å©ä¸ 9 ä½å­å¨æ´æ°é¨åã\n\n\n# å­ç¬¦ä¸²\n\nä¸»è¦æ CHAR å VARCHAR ä¸¤ç§ç±»åï¼ä¸ç§æ¯å®é¿çï¼ä¸ç§æ¯åé¿çã\n\nVARCHAR è¿ç§åé¿ç±»åè½å¤èçç©ºé´ï¼å ä¸ºåªéè¦å­å¨å¿è¦çåå®¹ãä½æ¯å¨æ§è¡ UPDATE æ¶å¯è½ä¼ä½¿è¡åå¾æ¯åæ¥é¿ãå½è¶åºä¸ä¸ªé¡µæè½å®¹çº³çå¤§å°æ¶ï¼å°±è¦æ§è¡é¢å¤çæä½ãMyISAM ä¼å°è¡ææä¸åççæ®µå­å¨ï¼è InnoDB åéè¦åè£é¡µæ¥ä½¿è¡æ¾è¿é¡µåã\n\nVARCHAR ä¼ä¿çå­ç¬¦ä¸²æ«å°¾çç©ºæ ¼ï¼è CHAR ä¼å é¤ã\n\n\n# æ¶é´åæ¥æ\n\nMySQL æä¾äºä¸¤ç§ç¸ä¼¼çæ¥ææ¶é´ç±»åï¼DATATIME å TIMESTAMPã\n\n# DATATIME\n\nè½å¤ä¿å­ä» 1001 å¹´å° 9999 å¹´çæ¥æåæ¶é´ï¼ç²¾åº¦ä¸ºç§ï¼ä½¿ç¨ 8 å­èçå­å¨ç©ºé´ã\n\nå®ä¸æ¶åºæ å³ã\n\né»è®¤æåµä¸ï¼MySQL ä»¥ä¸ç§å¯æåºçãæ æ­§ä¹çæ ¼å¼æ¾ç¤º DATATIME å¼ï¼ä¾å¦â2008-01-16 22:37:08âï¼è¿æ¯ ANSI æ åå®ä¹çæ¥æåæ¶é´è¡¨ç¤ºæ¹æ³ã\n\n# TIMESTAMP\n\nå UNIX æ¶é´æ³ç¸åï¼ä¿å­ä» 1970 å¹´ 1 æ 1 æ¥åå¤ï¼æ ¼æå¨æ²»æ¶é´ï¼ä»¥æ¥çç§æ°ï¼ä½¿ç¨ 4 ä¸ªå­èï¼åªè½è¡¨ç¤ºä» 1970 å¹´ å° 2038 å¹´ã\n\nå®åæ¶åºæå³ï¼ä¹å°±æ¯è¯´ä¸ä¸ªæ¶é´æ³å¨ä¸åçæ¶åºæä»£è¡¨çå·ä½æ¶é´æ¯ä¸åçã\n\nMySQL æä¾äº FROM_UNIXTIME() å½æ°æ UNIX æ¶é´æ³è½¬æ¢ä¸ºæ¥æï¼å¹¶æä¾äº UNIX_TIMESTAMP() å½æ°ææ¥æè½¬æ¢ä¸º UNIX æ¶é´æ³ã\n\né»è®¤æåµä¸ï¼å¦ææå¥æ¶æ²¡ææå® TIMESTAMP åçå¼ï¼ä¼å°è¿ä¸ªå¼è®¾ç½®ä¸ºå½åæ¶é´ã\n\nåºè¯¥å°½éä½¿ç¨ TIMESTAMPï¼å ä¸ºå®æ¯ DATETIME ç©ºé´æçæ´é«ã\n\n\n# BLOB å TEXT\n\nBLOB å TEXT é½æ¯ä¸ºäºå­å¨å¤§çæ°æ®èè®¾è®¡ï¼åèå­å¨äºè¿å¶æ°æ®ï¼åèå­å¨å­ç¬¦ä¸²æ°æ®ã\n\nä¸è½å¯¹ BLOB å TEXT ç±»åçå¨é¨åå®¹è¿è¡æåºãç´¢å¼ã\n\n\n# æä¸¾ç±»å\n\nå¤§å¤æ°æåµä¸æ²¡æä½¿ç¨æä¸¾ç±»åçå¿è¦ï¼å¶ä¸­ä¸ä¸ªç¼ºç¹æ¯ï¼æä¸¾çå­ç¬¦ä¸²åè¡¨æ¯åºå®çï¼æ·»å åå é¤å­ç¬¦ä¸²ï¼æä¸¾éé¡¹ï¼å¿é¡»ä½¿ç¨ALTER TABLEï¼å¦æåªåªæ¯å¨åè¡¨æ«å°¾è¿½å åç´ ï¼ä¸éè¦éå»ºè¡¨ï¼ã\n\n\n# ç±»åçéæ©\n\n * æ´æ°ç±»åéå¸¸æ¯æ è¯åæå¥½çéæ©ï¼å ä¸ºå®ä»¬å¾å¿«å¹¶ä¸å¯ä»¥ä½¿ç¨ AUTO_INCREMENTã\n\n * ENUM å SET ç±»åéå¸¸æ¯ä¸ä¸ªç³ç³çéæ©ï¼åºå°½éé¿åã\n\n * åºè¯¥å°½éé¿åç¨å­ç¬¦ä¸²ç±»åä½ä¸ºæ è¯åï¼å ä¸ºå®ä»¬å¾æ¶èç©ºé´ï¼å¹¶ä¸éå¸¸æ¯æ°å­ç±»åæ¢ãå¯¹äº MD5ãSHAãUUID è¿ç±»éæºå­ç¬¦ä¸²ï¼ç±äºæ¯è¾éæºï¼æä»¥å¯è½åå¸å¨å¾å¤§çç©ºé´åï¼å¯¼è´ INSERT ä»¥åä¸äº SELECT è¯­å¥åå¾å¾æ¢ã\n   \n   * å¦æå­å¨ UUID ï¼åºè¯¥ç§»é¤ - ç¬¦å·ï¼æ´å¥½çåæ³æ¯ï¼ç¨ UNHEX() å½æ°è½¬æ¢ UUID å¼ä¸º 16 å­èçæ°å­ï¼å¹¶å­å¨å¨ä¸ä¸ª BINARY(16) çåä¸­ï¼æ£ç´¢æ¶ï¼å¯ä»¥éè¿ HEX() å½æ°æ¥æ ¼å¼åä¸º 16 è¿å¶æ ¼å¼ã\n\n\n# ç´¢å¼\n\n> è¯¦è§ï¼Mysql ç´¢å¼\n\n\n# é\n\n> è¯¦è§ï¼Mysql é\n\n\n# äºå¡\n\n> è¯¦è§ï¼Mysql äºå¡\n\n\n# æ§è½ä¼å\n\n> è¯¦è§ï¼Mysql æ§è½ä¼å\n\n\n# å¤å¶\n\n\n# ä¸»ä»å¤å¶\n\nMysql æ¯æä¸¤ç§å¤å¶ï¼åºäºè¡çå¤å¶ååºäºè¯­å¥çå¤å¶ã\n\nè¿ä¸¤ç§æ¹å¼é½æ¯å¨ä¸»åºä¸è®°å½äºè¿å¶æ¥å¿ï¼ç¶åå¨ä»åºéæ¾æ¥å¿çæ¹å¼æ¥å®ç°å¼æ­¥çæ°æ®å¤å¶ãè¿æå³çï¼å¤å¶è¿ç¨å­å¨æ¶å»¶ï¼è¿æ®µæ¶é´åï¼ä¸»ä»æ°æ®å¯è½ä¸ä¸è´ã\n\nä¸»è¦æ¶åä¸ä¸ªçº¿ç¨ï¼binlog çº¿ç¨ãI/O çº¿ç¨å SQL çº¿ç¨ã\n\n * binlog çº¿ç¨ ï¼è´è´£å°ä¸»æå¡å¨ä¸çæ°æ®æ´æ¹åå¥äºè¿å¶æä»¶ï¼binlogï¼ä¸­ã\n * I/O çº¿ç¨ ï¼è´è´£ä»ä¸»æå¡å¨ä¸è¯»åäºè¿å¶æ¥å¿æä»¶ï¼å¹¶åå¥ä»æå¡å¨çä¸­ç»§æ¥å¿ä¸­ã\n * SQL çº¿ç¨ ï¼è´è´£è¯»åä¸­ç»§æ¥å¿å¹¶éæ¾å¶ä¸­ç SQL è¯­å¥ã\n\n\n\n\n# è¯»ååç¦»\n\nä¸»æå¡å¨ç¨æ¥å¤çåæä½ä»¥åå®æ¶æ§è¦æ±æ¯è¾é«çè¯»æä½ï¼èä»æå¡å¨ç¨æ¥å¤çè¯»æä½ã\n\nè¯»ååç¦»å¸¸ç¨ä»£çæ¹å¼æ¥å®ç°ï¼ä»£çæå¡å¨æ¥æ¶åºç¨å±ä¼ æ¥çè¯»åè¯·æ±ï¼ç¶åå³å®è½¬åå°åªä¸ªæå¡å¨ã\n\nMySQL è¯»ååç¦»è½æé«æ§è½çåå å¨äºï¼\n\n * ä¸»ä»æå¡å¨è´è´£åèªçè¯»ååï¼æå¤§ç¨åº¦ç¼è§£äºéçäºç¨ï¼\n * ä»æå¡å¨å¯ä»¥éç½® MyISAM å¼æï¼æåæ¥è¯¢æ§è½ä»¥åèçº¦ç³»ç»å¼éï¼\n * å¢å åä½ï¼æé«å¯ç¨æ§ã\n\n\n\n\n# åèèµæ\n\n * ãé«æ§è½ MySQLã\n * 20+ æ¡ MySQL æ§è½ä¼åçæä½³ç»éª\n * How to create unique row ID in sharded databases?\n * SQL Azure Federation â Introduction\n\n\n# ä¼ éé¨\n\nâ¾ ð§ éæç IT ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",normalizedContent:"# mysql åºç¨æå\n\n\n# sql æ§è¡è¿ç¨\n\nå­¦ä¹  mysqlï¼æå¥½æ¯åä»å®è§ä¸äºè§£ mysql å·¥ä½åçã\n\n> åèï¼mysql å·¥ä½æµ\n\n\n# å­å¨å¼æ\n\nå¨æä»¶ç³»ç»ä¸­ï¼mysql å°æ¯ä¸ªæ°æ®åºï¼ä¹å¯ä»¥æä¸º schemaï¼ä¿å­ä¸ºæ°æ®ç®å½ä¸çä¸ä¸ªå­ç®å½ãåå»ºè¡¨ç¤ºï¼mysql ä¼å¨æ°æ®åºå­ç®å½ä¸åå»ºä¸ä¸ªåè¡¨ååç .frm æä»¶ä¿å­è¡¨çå®ä¹ãå ä¸º mysql ä½¿ç¨æä»¶ç³»ç»çç®å½åæä»¶æ¥ä¿å­æ°æ®åºåè¡¨çå®ä¹ï¼å¤§å°åæææ§åå·ä½å¹³å°å¯åç¸å³ãwindows ä¸­å¤§å°åä¸ææï¼ç±» unix ä¸­å¤§å°åææãä¸åçå­å¨å¼æä¿å­æ°æ®åç´¢å¼çæ¹å¼æ¯ä¸åçï¼ä½è¡¨çå®ä¹åæ¯å¨ mysql æå¡å±ç»ä¸å¤ççã\n\n\n# éæ©å­å¨å¼æ\n\n# mysql åç½®çå­å¨å¼æ\n\nmysql> show engines;\n+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+\n| engine             | support | comment                                                        | transactions | xa   | savepoints |\n+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+\n| federated          | no      | federated mysql storage engine                                 | null         | null | null       |\n| memory             | yes     | hash based, stored in memory, useful for temporary tables      | no           | no   | no         |\n| innodb             | default | supports transactions, row-level locking, and foreign keys     | yes          | yes  | yes        |\n| performance_schema | yes     | performance schema                                             | no           | no   | no         |\n| myisam             | yes     | myisam storage engine                                          | no           | no   | no         |\n| mrg_myisam         | yes     | collection of identical myisam tables                          | no           | no   | no         |\n| blackhole          | yes     | /dev/null storage engine (anything you write to it disappears) | no           | no   | no         |\n| csv                | yes     | csv storage engine                                             | no           | no   | no         |\n| archive            | yes     | archive storage engine                                         | no           | no   | no         |\n+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+\n9 rows in set (0.00 sec)\n\n\n * innodb - mysql çé»è®¤äºå¡åå­å¨å¼æï¼å¹¶ä¸æä¾äºè¡çº§éåå¤é®ççº¦æãæ§è½ä¸éä¸æ¯æèªå¨å´©æºæ¢å¤ã\n * myisam - mysql 5.1 çæ¬åçé»è®¤å­å¨å¼æãç¹æ§ä¸°å¯ä½ä¸æ¯æäºå¡ï¼ä¹ä¸æ¯æè¡çº§éåå¤é®ï¼ä¹æ²¡æå´©æºæ¢å¤åè½ã\n * csv - å¯ä»¥å° csv æä»¶ä½ä¸º mysql çè¡¨æ¥å¤çï¼ä½è¿ç§è¡¨ä¸æ¯æç´¢å¼ã\n * memory - éåå¿«éè®¿é®æ°æ®ï¼ä¸æ°æ®ä¸ä¼è¢«ä¿®æ¹ï¼éå¯ä¸¢å¤±ä¹æ²¡æå³ç³»ã\n * ndb - ç¨äº mysql éç¾¤åºæ¯ã\n\n# å¦ä½éæ©åéçå­å¨å¼æ\n\nå¤§å¤æ°æåµä¸ï¼innodb é½æ¯æ­£ç¡®çéæ©ï¼é¤ééè¦ç¨å° innodb ä¸å·å¤çç¹æ§ã\n\nå¦æåºç¨éè¦éæ© innodb ä»¥å¤çå­å¨å¼æï¼å¯ä»¥èèä»¥ä¸å ç´ ï¼\n\n * äºå¡ï¼å¦æéè¦æ¯æäºå¡ï¼innodb æ¯é¦éãå¦æä¸éè¦æ¯æäºå¡ï¼ä¸ä¸»è¦æ¯ select å insert æä½ï¼myisam æ¯ä¸éçéæ©ãæä»¥ï¼å¦æ mysql é¨ç½²æ¹å¼ä¸ºä¸»å¤æ¨¡å¼ï¼å¹¶è¿è¡è¯»ååç¦»ãé£ä¹å¯ä»¥è¿ä¹åï¼ä¸»èç¹åªæ¯æåæä½ï¼é»è®¤å¼æä¸º innodbï¼å¤èç¹åªæ¯æè¯»æä½ï¼é»è®¤å¼æä¸º myisamã\n * å¹¶åï¼myisam åªæ¯æè¡¨çº§éï¼è innodb è¿æ¯æè¡çº§éãæä»¥ï¼innodb å¹¶åæ§è½æ´é«ã\n * å¤é®ï¼innodb æ¯æå¤é®ã\n * å¤ä»½ï¼innodb æ¯æå¨çº¿ç­å¤ä»½ã\n * å´©æºæ¢å¤ï¼myisam å´©æºååçæåçæ¦çæ¯ innodb é«å¾å¤ï¼èä¸æ¢å¤çéåº¦ä¹æ´æ¢ã\n * å¶å®ç¹æ§ï¼myisam æ¯æåç¼©è¡¨åç©ºé´æ°æ®ç´¢å¼ã\n\n# è½¬æ¢è¡¨çå­å¨å¼æ\n\nä¸é¢çè¯­å¥å¯ä»¥å° mytable è¡¨çå¼æä¿®æ¹ä¸º innodb\n\nalter table mytable engine = innodb\n\n\n\n# myisam\n\nmyisam è®¾è®¡ç®åï¼æ°æ®ä»¥ç´§å¯æ ¼å¼å­å¨ãå¯¹äºåªè¯»æ°æ®ï¼æèè¡¨æ¯è¾å°ãå¯ä»¥å®¹å¿ä¿®å¤æä½ï¼åä¾ç¶å¯ä»¥ä½¿ç¨ myisamã\n\nmyisam å¼æä½¿ç¨ b+tree ä½ä¸ºç´¢å¼ç»æï¼å¶èç¹ç data åå­æ¾çæ¯æ°æ®è®°å½çå°åã\n\nmyisam æä¾äºå¤§éçç¹æ§ï¼åæ¬ï¼å¨æç´¢å¼ãåç¼©è¡¨ãç©ºé´å½æ°ç­ãä½æ¯ï¼myisam ä¸æ¯æäºå¡åè¡çº§éãå¹¶ä¸ myisam ä¸æ¯æå´©æºåçå®å¨æ¢å¤ã\n\n\n# innodb\n\ninnodb æ¯ mysql é»è®¤çäºå¡åå­å¨å¼æï¼åªæå¨éè¦ innodb ä¸æ¯æçç¹æ§æ¶ï¼æèèä½¿ç¨å¶å®å­å¨å¼æã\n\nç¶ innodb ä¹ä½¿ç¨ b+tree ä½ä¸ºç´¢å¼ç»æï¼ä½å·ä½å®ç°æ¹å¼å´ä¸ myisam æªç¶ä¸åãmyisam ç´¢å¼æä»¶åæ°æ®æä»¶æ¯åç¦»çï¼ç´¢å¼æä»¶ä»ä¿å­æ°æ®è®°å½çå°åãèå¨ innodb ä¸­ï¼è¡¨æ°æ®æä»¶æ¬èº«å°±æ¯æ b+tree ç»ç»çä¸ä¸ªç´¢å¼ç»æï¼è¿æ£µæ çå¶èç¹ data åä¿å­äºå®æ´çæ°æ®è®°å½ãè¿ä¸ªç´¢å¼ç key æ¯æ°æ®è¡¨çä¸»é®ï¼å æ­¤innodb è¡¨æ°æ®æä»¶æ¬èº«å°±æ¯ä¸»ç´¢å¼ã\n\ninnodb éç¨ mvcc æ¥æ¯æé«å¹¶åï¼å¹¶ä¸å®ç°äºåä¸ªæ åçéç¦»çº§å«ãå¶é»è®¤çº§å«æ¯å¯éå¤è¯»ï¼repeatable readï¼ï¼å¹¶ä¸éè¿é´ééï¼next-key lockingï¼é²æ­¢å¹»è¯»ã\n\ninnodb æ¯åºäºèç°ç´¢å¼å»ºç«çï¼ä¸å¶ä»å­å¨å¼ææå¾å¤§ä¸åãå¨ç´¢å¼ä¸­ä¿å­äºæ°æ®ï¼ä»èé¿åç´æ¥è¯»åç£çï¼å æ­¤å¯¹æ¥è¯¢æ§è½æå¾å¤§çæåã\n\nåé¨åäºå¾å¤ä¼åï¼åæ¬ä»ç£çè¯»åæ°æ®æ¶éç¨çå¯é¢æµæ§è¯»ãè½å¤å å¿«è¯»æä½å¹¶ä¸èªå¨åå»ºçèªéåºåå¸ç´¢å¼ãè½å¤å éæå¥æä½çæå¥ç¼å²åºç­ã\n\næ¯æçæ­£çå¨çº¿ç­å¤ä»½ãå¶å®å­å¨å¼æä¸æ¯æå¨çº¿ç­å¤ä»½ï¼è¦è·åä¸è´æ§è§å¾éè¦åæ­¢å¯¹ææè¡¨çåå¥ï¼èå¨è¯»åæ··ååºæ¯ä¸­ï¼åæ­¢åå¥å¯è½ä¹æå³çåæ­¢è¯»åã\n\n\n# æ°æ®ç±»å\n\n\n# æ´å\n\ntinyint, smallint, mediumint, int, bigint åå«ä½¿ç¨ 8, 16, 24, 32, 64 ä½å­å¨ç©ºé´ï¼ä¸è¬æåµä¸è¶å°çåè¶å¥½ã\n\nunsigned è¡¨ç¤ºä¸åè®¸è´å¼ï¼å¤§è´å¯ä»¥ä½¿æ­£æ°çä¸éæé«ä¸åã\n\nint(11) ä¸­çæ°å­åªæ¯è§å®äºäº¤äºå·¥å·æ¾ç¤ºå­ç¬¦çä¸ªæ°ï¼å¯¹äºå­å¨åè®¡ç®æ¥è¯´æ¯æ²¡ææä¹çã\n\n\n# æµ®ç¹å\n\nfloat å double ä¸ºæµ®ç¹ç±»åã\n\ndecimal ç±»åä¸»è¦ç¨äºç²¾ç¡®è®¡ç®ï¼ä»£ä»·è¾é«ï¼åºè¯¥å°½éåªå¨å¯¹å°æ°è¿è¡ç²¾ç¡®è®¡ç®æ¶æä½¿ç¨ decimal ââä¾å¦å­å¨è´¢å¡æ°æ®ãæ°æ®éæ¯è¾å¤§çæ¶åï¼å¯ä»¥ä½¿ç¨ bigint ä»£æ¿ decimalã\n\nfloatãdouble å decimal é½å¯ä»¥æå®åå®½ï¼ä¾å¦ decimal(18, 9) è¡¨ç¤ºæ»å± 18 ä½ï¼å 9 ä½å­å¨å°æ°é¨åï¼å©ä¸ 9 ä½å­å¨æ´æ°é¨åã\n\n\n# å­ç¬¦ä¸²\n\nä¸»è¦æ char å varchar ä¸¤ç§ç±»åï¼ä¸ç§æ¯å®é¿çï¼ä¸ç§æ¯åé¿çã\n\nvarchar è¿ç§åé¿ç±»åè½å¤èçç©ºé´ï¼å ä¸ºåªéè¦å­å¨å¿è¦çåå®¹ãä½æ¯å¨æ§è¡ update æ¶å¯è½ä¼ä½¿è¡åå¾æ¯åæ¥é¿ãå½è¶åºä¸ä¸ªé¡µæè½å®¹çº³çå¤§å°æ¶ï¼å°±è¦æ§è¡é¢å¤çæä½ãmyisam ä¼å°è¡ææä¸åççæ®µå­å¨ï¼è innodb åéè¦åè£é¡µæ¥ä½¿è¡æ¾è¿é¡µåã\n\nvarchar ä¼ä¿çå­ç¬¦ä¸²æ«å°¾çç©ºæ ¼ï¼è char ä¼å é¤ã\n\n\n# æ¶é´åæ¥æ\n\nmysql æä¾äºä¸¤ç§ç¸ä¼¼çæ¥ææ¶é´ç±»åï¼datatime å timestampã\n\n# datatime\n\nè½å¤ä¿å­ä» 1001 å¹´å° 9999 å¹´çæ¥æåæ¶é´ï¼ç²¾åº¦ä¸ºç§ï¼ä½¿ç¨ 8 å­èçå­å¨ç©ºé´ã\n\nå®ä¸æ¶åºæ å³ã\n\né»è®¤æåµä¸ï¼mysql ä»¥ä¸ç§å¯æåºçãæ æ­§ä¹çæ ¼å¼æ¾ç¤º datatime å¼ï¼ä¾å¦â2008-01-16 22:37:08âï¼è¿æ¯ ansi æ åå®ä¹çæ¥æåæ¶é´è¡¨ç¤ºæ¹æ³ã\n\n# timestamp\n\nå unix æ¶é´æ³ç¸åï¼ä¿å­ä» 1970 å¹´ 1 æ 1 æ¥åå¤ï¼æ ¼æå¨æ²»æ¶é´ï¼ä»¥æ¥çç§æ°ï¼ä½¿ç¨ 4 ä¸ªå­èï¼åªè½è¡¨ç¤ºä» 1970 å¹´ å° 2038 å¹´ã\n\nå®åæ¶åºæå³ï¼ä¹å°±æ¯è¯´ä¸ä¸ªæ¶é´æ³å¨ä¸åçæ¶åºæä»£è¡¨çå·ä½æ¶é´æ¯ä¸åçã\n\nmysql æä¾äº from_unixtime() å½æ°æ unix æ¶é´æ³è½¬æ¢ä¸ºæ¥æï¼å¹¶æä¾äº unix_timestamp() å½æ°ææ¥æè½¬æ¢ä¸º unix æ¶é´æ³ã\n\né»è®¤æåµä¸ï¼å¦ææå¥æ¶æ²¡ææå® timestamp åçå¼ï¼ä¼å°è¿ä¸ªå¼è®¾ç½®ä¸ºå½åæ¶é´ã\n\nåºè¯¥å°½éä½¿ç¨ timestampï¼å ä¸ºå®æ¯ datetime ç©ºé´æçæ´é«ã\n\n\n# blob å text\n\nblob å text é½æ¯ä¸ºäºå­å¨å¤§çæ°æ®èè®¾è®¡ï¼åèå­å¨äºè¿å¶æ°æ®ï¼åèå­å¨å­ç¬¦ä¸²æ°æ®ã\n\nä¸è½å¯¹ blob å text ç±»åçå¨é¨åå®¹è¿è¡æåºãç´¢å¼ã\n\n\n# æä¸¾ç±»å\n\nå¤§å¤æ°æåµä¸æ²¡æä½¿ç¨æä¸¾ç±»åçå¿è¦ï¼å¶ä¸­ä¸ä¸ªç¼ºç¹æ¯ï¼æä¸¾çå­ç¬¦ä¸²åè¡¨æ¯åºå®çï¼æ·»å åå é¤å­ç¬¦ä¸²ï¼æä¸¾éé¡¹ï¼å¿é¡»ä½¿ç¨alter tableï¼å¦æåªåªæ¯å¨åè¡¨æ«å°¾è¿½å åç´ ï¼ä¸éè¦éå»ºè¡¨ï¼ã\n\n\n# ç±»åçéæ©\n\n * æ´æ°ç±»åéå¸¸æ¯æ è¯åæå¥½çéæ©ï¼å ä¸ºå®ä»¬å¾å¿«å¹¶ä¸å¯ä»¥ä½¿ç¨ auto_incrementã\n\n * enum å set ç±»åéå¸¸æ¯ä¸ä¸ªç³ç³çéæ©ï¼åºå°½éé¿åã\n\n * åºè¯¥å°½éé¿åç¨å­ç¬¦ä¸²ç±»åä½ä¸ºæ è¯åï¼å ä¸ºå®ä»¬å¾æ¶èç©ºé´ï¼å¹¶ä¸éå¸¸æ¯æ°å­ç±»åæ¢ãå¯¹äº md5ãshaãuuid è¿ç±»éæºå­ç¬¦ä¸²ï¼ç±äºæ¯è¾éæºï¼æä»¥å¯è½åå¸å¨å¾å¤§çç©ºé´åï¼å¯¼è´ insert ä»¥åä¸äº select è¯­å¥åå¾å¾æ¢ã\n   \n   * å¦æå­å¨ uuid ï¼åºè¯¥ç§»é¤ - ç¬¦å·ï¼æ´å¥½çåæ³æ¯ï¼ç¨ unhex() å½æ°è½¬æ¢ uuid å¼ä¸º 16 å­èçæ°å­ï¼å¹¶å­å¨å¨ä¸ä¸ª binary(16) çåä¸­ï¼æ£ç´¢æ¶ï¼å¯ä»¥éè¿ hex() å½æ°æ¥æ ¼å¼åä¸º 16 è¿å¶æ ¼å¼ã\n\n\n# ç´¢å¼\n\n> è¯¦è§ï¼mysql ç´¢å¼\n\n\n# é\n\n> è¯¦è§ï¼mysql é\n\n\n# äºå¡\n\n> è¯¦è§ï¼mysql äºå¡\n\n\n# æ§è½ä¼å\n\n> è¯¦è§ï¼mysql æ§è½ä¼å\n\n\n# å¤å¶\n\n\n# ä¸»ä»å¤å¶\n\nmysql æ¯æä¸¤ç§å¤å¶ï¼åºäºè¡çå¤å¶ååºäºè¯­å¥çå¤å¶ã\n\nè¿ä¸¤ç§æ¹å¼é½æ¯å¨ä¸»åºä¸è®°å½äºè¿å¶æ¥å¿ï¼ç¶åå¨ä»åºéæ¾æ¥å¿çæ¹å¼æ¥å®ç°å¼æ­¥çæ°æ®å¤å¶ãè¿æå³çï¼å¤å¶è¿ç¨å­å¨æ¶å»¶ï¼è¿æ®µæ¶é´åï¼ä¸»ä»æ°æ®å¯è½ä¸ä¸è´ã\n\nä¸»è¦æ¶åä¸ä¸ªçº¿ç¨ï¼binlog çº¿ç¨ãi/o çº¿ç¨å sql çº¿ç¨ã\n\n * binlog çº¿ç¨ ï¼è´è´£å°ä¸»æå¡å¨ä¸çæ°æ®æ´æ¹åå¥äºè¿å¶æä»¶ï¼binlogï¼ä¸­ã\n * i/o çº¿ç¨ ï¼è´è´£ä»ä¸»æå¡å¨ä¸è¯»åäºè¿å¶æ¥å¿æä»¶ï¼å¹¶åå¥ä»æå¡å¨çä¸­ç»§æ¥å¿ä¸­ã\n * sql çº¿ç¨ ï¼è´è´£è¯»åä¸­ç»§æ¥å¿å¹¶éæ¾å¶ä¸­ç sql è¯­å¥ã\n\n\n\n\n# è¯»ååç¦»\n\nä¸»æå¡å¨ç¨æ¥å¤çåæä½ä»¥åå®æ¶æ§è¦æ±æ¯è¾é«çè¯»æä½ï¼èä»æå¡å¨ç¨æ¥å¤çè¯»æä½ã\n\nè¯»ååç¦»å¸¸ç¨ä»£çæ¹å¼æ¥å®ç°ï¼ä»£çæå¡å¨æ¥æ¶åºç¨å±ä¼ æ¥çè¯»åè¯·æ±ï¼ç¶åå³å®è½¬åå°åªä¸ªæå¡å¨ã\n\nmysql è¯»ååç¦»è½æé«æ§è½çåå å¨äºï¼\n\n * ä¸»ä»æå¡å¨è´è´£åèªçè¯»ååï¼æå¤§ç¨åº¦ç¼è§£äºéçäºç¨ï¼\n * ä»æå¡å¨å¯ä»¥éç½® myisam å¼æï¼æåæ¥è¯¢æ§è½ä»¥åèçº¦ç³»ç»å¼éï¼\n * å¢å åä½ï¼æé«å¯ç¨æ§ã\n\n\n\n\n# åèèµæ\n\n * ãé«æ§è½ mysqlã\n * 20+ æ¡ mysql æ§è½ä¼åçæä½³ç»éª\n * how to create unique row id in sharded databases?\n * sql azure federation â introduction\n\n\n# ä¼ éé¨\n\nâ¾ ð§ éæç it ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"MySQL å·¥ä½æµ",frontmatter:{title:"MySQL å·¥ä½æµ",date:"2020-07-16T11:14:07.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],permalink:"/pages/8262aa/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/02.Mysql/02.MySQL%E5%B7%A5%E4%BD%9C%E6%B5%81.html",relativePath:"12.æ°æ®åº/03.å³ç³»åæ°æ®åº/02.Mysql/02.MySQLå·¥ä½æµ.md",key:"v-e2f7f754",path:"/pages/8262aa/",headers:[{level:2,title:"åºç¡æ¶æ",slug:"åºç¡æ¶æ",normalizedTitle:"åºç¡æ¶æ",charIndex:16},{level:2,title:"æ¥è¯¢è¿ç¨",slug:"æ¥è¯¢è¿ç¨",normalizedTitle:"æ¥è¯¢è¿ç¨",charIndex:286},{level:3,title:"ï¼ä¸ï¼è¿æ¥å¨",slug:"ä¸-è¿æ¥å¨",normalizedTitle:"ï¼ä¸ï¼è¿æ¥å¨",charIndex:597},{level:3,title:"ï¼äºï¼æ¥è¯¢ç¼å­",slug:"äº-æ¥è¯¢ç¼å­",normalizedTitle:"ï¼äºï¼æ¥è¯¢ç¼å­",charIndex:1556},{level:3,title:"ï¼ä¸ï¼è¯­æ³åæ",slug:"ä¸-è¯­æ³åæ",normalizedTitle:"ï¼ä¸ï¼è¯­æ³åæ",charIndex:2422},{level:3,title:"ï¼åï¼æ¥è¯¢ä¼å",slug:"å-æ¥è¯¢ä¼å",normalizedTitle:"ï¼åï¼æ¥è¯¢ä¼å",charIndex:2945},{level:3,title:"ï¼äºï¼æ¥è¯¢æ§è¡å¼æ",slug:"äº-æ¥è¯¢æ§è¡å¼æ",normalizedTitle:"ï¼äºï¼æ¥è¯¢æ§è¡å¼æ",charIndex:4152},{level:3,title:"ï¼å­ï¼è¿åç»æ",slug:"å­-è¿åç»æ",normalizedTitle:"ï¼å­ï¼è¿åç»æ",charIndex:4431},{level:2,title:"æ´æ°è¿ç¨",slug:"æ´æ°è¿ç¨",normalizedTitle:"æ´æ°è¿ç¨",charIndex:4746},{level:3,title:"redo log",slug:"redo-log",normalizedTitle:"redo log",charIndex:4810},{level:3,title:"bin log",slug:"bin-log",normalizedTitle:"bin log",charIndex:5294},{level:3,title:"redo log vs. bin log",slug:"redo-log-vs-bin-log",normalizedTitle:"redo log vs. bin log",charIndex:5532},{level:3,title:"ä¸¤é¶æ®µæäº¤",slug:"ä¸¤é¶æ®µæäº¤",normalizedTitle:"ä¸¤é¶æ®µæäº¤",charIndex:6301},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:7014}],headersStr:"åºç¡æ¶æ æ¥è¯¢è¿ç¨ ï¼ä¸ï¼è¿æ¥å¨ ï¼äºï¼æ¥è¯¢ç¼å­ ï¼ä¸ï¼è¯­æ³åæ ï¼åï¼æ¥è¯¢ä¼å ï¼äºï¼æ¥è¯¢æ§è¡å¼æ ï¼å­ï¼è¿åç»æ æ´æ°è¿ç¨ redo log bin log redo log vs. bin log ä¸¤é¶æ®µæäº¤ åèèµæ",content:'# MySQL å·¥ä½æµ\n\n\n# åºç¡æ¶æ\n\nå¤§ä½æ¥è¯´ï¼MySQL å¯ä»¥åä¸º Server å±åå­å¨å¼æå±ä¸¤é¨åã\n\nServer å±åæ¬è¿æ¥å¨ãæ¥è¯¢ç¼å­ãåæå¨ãä¼åå¨ãæ§è¡å¨ç­ï¼æ¶µç MySQL çå¤§å¤æ°æ ¸å¿æå¡åè½ï¼ä»¥åææçåç½®å½æ°ï¼å¦æ¥æãæ¶é´ãæ°å­¦åå å¯å½æ°ç­ï¼ï¼ææè·¨å­å¨å¼æçåè½é½å¨è¿ä¸å±å®ç°ï¼æ¯å¦å­å¨è¿ç¨ãè§¦åå¨ãè§å¾ç­ã\n\nå­å¨å¼æå±è´è´£æ°æ®çå­å¨åæåãå¶æ¶ææ¨¡å¼æ¯æä»¶å¼çï¼æ¯æ InnoDBãMyISAMãMemory ç­å¤ä¸ªå­å¨å¼æãç°å¨æå¸¸ç¨çå­å¨å¼ææ¯ InnoDBï¼å®ä» MySQL 5.5.5 çæ¬å¼å§æä¸ºäºé»è®¤å­å¨å¼æã\n\n\n\n\n# æ¥è¯¢è¿ç¨\n\nSQL è¯­å¥å¨ MySQL ä¸­æ¯å¦ä½æ§è¡çï¼\n\nMySQL æ´ä¸ªæ¥è¯¢æ§è¡è¿ç¨ï¼æ»çæ¥è¯´åä¸º 6 ä¸ªæ­¥éª¤ï¼åå«å¯¹åº 6 ä¸ªç»ä»¶ï¼\n\n 1. è¿æ¥å¨ï¼å®¢æ·ç«¯å MySQL æå¡å¨å»ºç«è¿æ¥ï¼è¿æ¥å¨è´è´£è·å®¢æ·ç«¯å»ºç«è¿æ¥ãè·åæéãç»´æåç®¡çè¿æ¥ã\n 2. MySQL æå¡å¨é¦åæ£æ¥æ¥è¯¢ç¼å­ï¼å¦æå½ä¸­ç¼å­ï¼åç«å»è¿åç»æãå¦åè¿å¥ä¸ä¸é¶æ®µã\n 3. MySQL æå¡å¨è¿è¡ SQL åæï¼è¯­æ³åæãè¯æ³åæã\n 4. MySQL æå¡å¨ç¨ä¼åå¨çæå¯¹åºçæ§è¡è®¡åã\n 5. MySQL æå¡å¨æ ¹æ®æ§è¡è®¡åï¼è°ç¨å­å¨å¼æç API æ¥æ§è¡æ¥è¯¢ã\n 6. MySQL æå¡å¨å°ç»æè¿åç»å®¢æ·ç«¯ï¼åæ¶ç¼å­æ¥è¯¢ç»æã\n\n\n# ï¼ä¸ï¼è¿æ¥å¨\n\nä½¿ç¨ MySQL ç¬¬ä¸æ­¥èªç¶æ¯è¦è¿æ¥æ°æ®åºãè¿æ¥å¨è´è´£è·å®¢æ·ç«¯å»ºç«è¿æ¥ãè·åæéãç»´æåç®¡çè¿æ¥ã\n\nMySQL å®¢æ·ç«¯/æå¡ç«¯éä¿¡æ¯ååå·¥æ¨¡å¼ï¼å³ä»»ä¸æ¶å»ï¼è¦ä¹æ¯æå¡ç«¯åå®¢æ·ç«¯åéæ°æ®ï¼è¦ä¹æ¯å®¢æ·ç«¯åæå¡å¨åéæ°æ®ãå®¢æ·ç«¯ç¨ä¸ä¸ªåç¬çæ°æ®åå°æ¥è¯¢è¯·æ±åéç»æå¡å¨ï¼æä»¥å½æ¥è¯¢è¯­å¥å¾é¿çæ¶åï¼éè¦è®¾ç½®max_allowed_packetåæ°ãä½æ¯éè¦æ³¨æçæ¯ï¼å¦ææ¥è¯¢å®å¨æ¯å¤ªå¤§ï¼æå¡ç«¯ä¼æç»æ¥æ¶æ´å¤æ°æ®å¹¶æåºå¼å¸¸ã\n\nMySQL å®¢æ·ç«¯è¿æ¥å½ä»¤ï¼mysql -h<ä¸»æº> -P<ç«¯å£> -u<ç¨æ·å> -p<å¯ç >ãå¦ææ²¡ææ¾å¼æå®å¯ç ï¼ä¼è¦æ±è¾å¥å¯ç æè½è®¿é®ã\n\nè¿æ¥å®æåï¼å¦æä½ æ²¡æåç»­çå¨ä½ï¼è¿ä¸ªè¿æ¥å°±å¤äºç©ºé²ç¶æï¼ä½ å¯ä»¥å¨ show processlist å½ä»¤ä¸­çå°å®ãå®¢æ·ç«¯å¦æå¤ªé¿æ¶é´æ²¡å¨éï¼è¿æ¥å¨å°±ä¼èªå¨å°å®æ­å¼ãå®¢æ·ç«¯è¿æ¥ç»´ææ¶é´æ¯ç±åæ° wait_timeout æ§å¶çï¼é»è®¤å¼æ¯ 8 å°æ¶ãå¦æå¨è¿æ¥è¢«æ­å¼ä¹åï¼å®¢æ·ç«¯åæ¬¡åéè¯·æ±çè¯ï¼å°±ä¼æ¶å°ä¸ä¸ªéè¯¯æéï¼ Lost connection to MySQL server during queryãè¿æ¶åå¦æä½ è¦ç»§ç»­ï¼å°±éè¦éè¿ï¼ç¶ååæ§è¡è¯·æ±äºã\n\nå»ºç«è¿æ¥çè¿ç¨éå¸¸æ¯æ¯è¾å¤æçï¼å»ºè®®å¨ä½¿ç¨ä¸­è¦å°½éåå°å»ºç«è¿æ¥çå¨ä½ï¼ä¹å°±æ¯å°½éä½¿ç¨é¿è¿æ¥ãä¸ºäºå¨ç¨åºä¸­æé«æ°æ®åºè¿æ¥çæç¨äºï¼ä¸è¬ä¼ä½¿ç¨æ°æ®åºè¿æ¥æ± æ¥ç»´æ¤ç®¡çã\n\nä½æ¯å¨é¨ä½¿ç¨é¿è¿æ¥åï¼ä½ å¯è½ä¼åç°ï¼æäºæ¶å MySQL å ç¨åå­æ¶¨å¾ç¹å«å¿«ï¼è¿æ¯å ä¸º MySQL å¨æ§è¡è¿ç¨ä¸­ä¸´æ¶ä½¿ç¨çåå­æ¯ç®¡çå¨è¿æ¥å¯¹è±¡éé¢çãè¿äºèµæºä¼å¨è¿æ¥æ­å¼çæ¶åæéæ¾ãæä»¥å¦æé¿è¿æ¥ç´¯ç§¯ä¸æ¥ï¼å¯è½å¯¼è´åå­å ç¨å¤ªå¤§ï¼è¢«ç³»ç»å¼ºè¡ææï¼OOMï¼ï¼ä»ç°è±¡çå°±æ¯ MySQL å¼å¸¸éå¯äºã\n\næä¹è§£å³è¿ä¸ªé®é¢å¢ï¼ä½ å¯ä»¥èèä»¥ä¸ä¸¤ç§æ¹æ¡ã\n\n * å®ææ­å¼é¿è¿æ¥ãä½¿ç¨ä¸æ®µæ¶é´ï¼æèç¨åºéé¢å¤æ­æ§è¡è¿ä¸ä¸ªå ç¨åå­çå¤§æ¥è¯¢åï¼æ­å¼è¿æ¥ï¼ä¹åè¦æ¥è¯¢åéè¿ã\n * å¦æä½ ç¨çæ¯ MySQL 5.7 ææ´æ°çæ¬ï¼å¯ä»¥å¨æ¯æ¬¡æ§è¡ä¸ä¸ªæ¯è¾å¤§çæä½åï¼éè¿æ§è¡ mysql_reset_connection æ¥éæ°åå§åè¿æ¥èµæºãè¿ä¸ªè¿ç¨ä¸éè¦éè¿åéæ°åæééªè¯ï¼ä½æ¯ä¼å°è¿æ¥æ¢å¤å°åååå»ºå®æ¶çç¶æã\n\n\n# ï¼äºï¼æ¥è¯¢ç¼å­\n\n> ä¸å»ºè®®ä½¿ç¨æ°æ®åºç¼å­ï¼å ä¸ºå¾å¾å¼å¤§äºå©ã\n\nè§£æä¸ä¸ªæ¥è¯¢è¯­å¥åï¼å¦ææ¥è¯¢ç¼å­æ¯æå¼çï¼é£ä¹ MySQL ä¼æ£æ¥è¿ä¸ªæ¥è¯¢è¯­å¥æ¯å¦å½ä¸­æ¥è¯¢ç¼å­ä¸­çæ°æ®ãå¦æå½åæ¥è¯¢æ°å¥½å½ä¸­æ¥è¯¢ç¼å­ï¼å¨æ£æ¥ä¸æ¬¡ç¨æ·æéåç´æ¥è¿åç¼å­ä¸­çç»æãè¿ç§æåµä¸ï¼æ¥è¯¢ä¸ä¼è¢«è§£æï¼ä¹ä¸ä¼çææ§è¡è®¡åï¼æ´ä¸ä¼æ§è¡ã\n\nMySQL å°ç¼å­å­æ¾å¨ä¸ä¸ªå¼ç¨è¡¨ï¼ä¸è¦çè§£ætableï¼å¯ä»¥è®¤ä¸ºæ¯ç±»ä¼¼äºHashMapçæ°æ®ç»æï¼ï¼éè¿ä¸ä¸ªåå¸å¼ç´¢å¼ï¼è¿ä¸ªåå¸å¼éè¿æ¥è¯¢æ¬èº«ãå½åè¦æ¥è¯¢çæ°æ®åºãå®¢æ·ç«¯åè®®çæ¬å·ç­ä¸äºå¯è½å½±åç»æçä¿¡æ¯è®¡ç®å¾æ¥ãæä»¥ä¸¤ä¸ªæ¥è¯¢å¨ä»»ä½å­ç¬¦ä¸çä¸åï¼ä¾å¦ï¼ç©ºæ ¼ãæ³¨éï¼ï¼é½ä¼å¯¼è´ç¼å­ä¸ä¼å½ä¸­ã\n\nå¦ææ¥è¯¢ä¸­åå«ä»»ä½ç¨æ·èªå®ä¹å½æ°ãå­å¨å½æ°ãç¨æ·åéãä¸´æ¶è¡¨ãmysql åºä¸­çç³»ç»è¡¨ï¼å¶æ¥è¯¢ç»æé½ä¸ä¼è¢«ç¼å­ãæ¯å¦å½æ°NOW()æèCURRENT_DATE()ä¼å ä¸ºä¸åçæ¥è¯¢æ¶é´ï¼è¿åä¸åçæ¥è¯¢ç»æï¼åæ¯å¦åå«CURRENT_USERæèCONNECION_ID()çæ¥è¯¢è¯­å¥ä¼å ä¸ºä¸åçç¨æ·èè¿åä¸åçç»æï¼å°è¿æ ·çæ¥è¯¢ç»æç¼å­èµ·æ¥æ²¡æä»»ä½çæä¹ã\n\nä¸å»ºè®®ä½¿ç¨æ°æ®åºç¼å­ï¼å ä¸ºå¾å¾å¼å¤§äºå©ãæ¥è¯¢ç¼å­çå¤±æéå¸¸é¢ç¹ï¼åªè¦æå¯¹ä¸ä¸ªè¡¨çæ´æ°ï¼è¿ä¸ªè¡¨ä¸ææçæ¥è¯¢ç¼å­é½ä¼è¢«æ¸ç©ºãå æ­¤å¾å¯è½ä½ è´¹å²å°æç»æå­èµ·æ¥ï¼è¿æ²¡ä½¿ç¨å¢ï¼å°±è¢«ä¸ä¸ªæ´æ°å¨æ¸ç©ºäºãå¯¹äºæ´æ°ååå¤§çæ°æ®åºæ¥è¯´ï¼æ¥è¯¢ç¼å­çå½ä¸­çä¼éå¸¸ä½ãé¤éä½ çä¸å¡å°±æ¯æä¸å¼ éæè¡¨ï¼å¾é¿æ¶é´æä¼æ´æ°ä¸æ¬¡ãæ¯å¦ï¼ä¸ä¸ªç³»ç»éç½®è¡¨ï¼é£è¿å¼ è¡¨ä¸çæ¥è¯¢æéåä½¿ç¨æ¥è¯¢ç¼å­ã\n\nå¥½å¨ MySQL ä¹æä¾äºè¿ç§âæéä½¿ç¨âçæ¹å¼ãä½ å¯ä»¥å°åæ° query_cache_type è®¾ç½®æ DEMANDï¼è¿æ ·å¯¹äºé»è®¤ç SQL è¯­å¥é½ä¸ä½¿ç¨æ¥è¯¢ç¼å­ãèå¯¹äºä½ ç¡®å®è¦ä½¿ç¨æ¥è¯¢ç¼å­çè¯­å¥ï¼å¯ä»¥ç¨ SQL_CACHE æ¾å¼æå®ï¼åä¸é¢è¿ä¸ªè¯­å¥ä¸æ ·ï¼\n\nselect SQL_CACHE * from T where ID=10;\n\n\n> æ³¨æï¼MySQL 8.0 çæ¬ç´æ¥å°æ¥è¯¢ç¼å­çæ´ååè½å æäºã\n\n\n# ï¼ä¸ï¼è¯­æ³åæ\n\nå¦ææ²¡æå½ä¸­æ¥è¯¢ç¼å­ï¼å°±è¦å¼å§çæ­£æ§è¡è¯­å¥äºãé¦åï¼MySQL éè¦ç¥éä½ è¦åä»ä¹ï¼å æ­¤éè¦å¯¹ SQL è¯­å¥åè§£æãMySQL éè¿å³é®å­å¯¹ SQL è¯­å¥è¿è¡è§£æï¼å¹¶çæä¸é¢å¯¹åºçè¯­æ³è§£ææ ãè¿ä¸ªè¿ç¨ä¸­ï¼åæå¨ä¸»è¦éè¿è¯­æ³è§åæ¥éªè¯åè§£æãæ¯å¦ SQL ä¸­æ¯å¦ä½¿ç¨äºéè¯¯çå³é®å­æèå³é®å­çé¡ºåºæ¯å¦æ­£ç¡®ç­ç­ãé¢å¤çåä¼æ ¹æ® MySQL è§åè¿ä¸æ­¥æ£æ¥è§£ææ æ¯å¦åæ³ãæ¯å¦æ£æ¥è¦æ¥è¯¢çæ°æ®è¡¨åæ°æ®åæ¯å¦å­å¨ç­ç­ã\n\n * åæå¨åä¼ååâè¯æ³åæâãä½ è¾å¥çæ¯ç±å¤ä¸ªå­ç¬¦ä¸²åç©ºæ ¼ç»æçä¸æ¡ SQL è¯­å¥ï¼MySQL éè¦è¯å«åºéé¢çå­ç¬¦ä¸²åå«æ¯ä»ä¹ï¼ä»£è¡¨ä»ä¹ãMySQL ä»ä½ è¾å¥ç"select"è¿ä¸ªå³é®å­è¯å«åºæ¥ï¼è¿æ¯ä¸ä¸ªæ¥è¯¢è¯­å¥ãå®ä¹è¦æå­ç¬¦ä¸²âTâè¯å«æâè¡¨å Tâï¼æå­ç¬¦ä¸²âIDâè¯å«æâå IDâã\n * æ¥ä¸æ¥ï¼è¦åâè¯­æ³åæâãæ ¹æ®è¯æ³åæçç»æï¼è¯­æ³åæå¨ä¼æ ¹æ®è¯­æ³è§åï¼å¤æ­ä½ è¾å¥çè¿ä¸ª SQL è¯­å¥æ¯å¦æ»¡è¶³ MySQL è¯­æ³ãå¦æä½ çè¯­å¥ä¸å¯¹ï¼å°±ä¼æ¶å°âYou have an error in your SQL syntaxâçéè¯¯æéï¼æ¯å¦ä¸é¢è¿ä¸ªè¯­å¥ select å°æäºå¼å¤´çå­æ¯âsâã\n\n\n# ï¼åï¼æ¥è¯¢ä¼å\n\nç»è¿äºåæå¨ï¼MySQL å°±ç¥éä½ è¦åä»ä¹äºãå¨å¼å§æ§è¡ä¹åï¼è¿è¦åç»è¿ä¼åå¨çå¤çã\n\nç»è¿åé¢çæ­¥éª¤çæçè¯­æ³æ è¢«è®¤ä¸ºæ¯åæ³çäºï¼å¹¶ä¸ç±ä¼åå¨å°å¶è½¬åææ§è¡è®¡åãå¤æ°æåµä¸ï¼ä¸æ¡æ¥è¯¢å¯ä»¥æå¾å¤ç§æ§è¡æ¹å¼ï¼æåé½è¿åç¸åºçç»æãä¼åå¨çä½ç¨å°±æ¯æ¾å°è¿å¶ä¸­æå¥½çæ§è¡è®¡åã\n\nMySQL ä½¿ç¨åºäºææ¬çä¼åå¨ï¼å®å°è¯é¢æµä¸ä¸ªæ¥è¯¢ä½¿ç¨æç§æ§è¡è®¡åæ¶çææ¬ï¼å¹¶éæ©å¶ä¸­ææ¬æå°çä¸ä¸ªãå¨ MySQL å¯ä»¥éè¿æ¥è¯¢å½åä¼è¯ç last_query_cost çå¼æ¥å¾å°å¶è®¡ç®å½åæ¥è¯¢çææ¬ã\n\nmysql> select * from t_message limit 10;\n...çç¥ç»æé\n\nmysql> show status like \'last_query_cost\';\n+-----------------+-------------+\n| Variable_name   | Value       |\n+-----------------+-------------+\n| Last_query_cost | 6391.799000 |\n+-----------------+-------------+\n\n\nç¤ºä¾ä¸­çç»æè¡¨ç¤ºä¼åå¨è®¤ä¸ºå¤§æ¦éè¦å 6391 ä¸ªæ°æ®é¡µçéæºæ¥æ¾æè½å®æä¸é¢çæ¥è¯¢ãè¿ä¸ªç»ææ¯æ ¹æ®ä¸äºåçç»è®¡ä¿¡æ¯è®¡ç®å¾æ¥çï¼è¿äºç»è®¡ä¿¡æ¯åæ¬ï¼æ¯å¼ è¡¨æèç´¢å¼çé¡µé¢ä¸ªæ°ãç´¢å¼çåºæ°ãç´¢å¼åæ°æ®è¡çé¿åº¦ãç´¢å¼çåå¸æåµç­ç­ã\n\næéå¸¸å¤çåå ä¼å¯¼è´ MySQL éæ©éè¯¯çæ§è¡è®¡åï¼æ¯å¦ç»è®¡ä¿¡æ¯ä¸åç¡®ãä¸ä¼èèä¸åå¶æ§å¶çæä½ææ¬ï¼ç¨æ·èªå®ä¹å½æ°ãå­å¨è¿ç¨ï¼ãMySQL è®¤ä¸ºçæä¼è·æä»¬æ³çä¸ä¸æ ·ï¼æä»¬å¸ææ§è¡æ¶é´å°½å¯è½ç­ï¼ä½ MySQL å¼éæ©å®è®¤ä¸ºææ¬å°çï¼ä½ææ¬å°å¹¶ä¸æå³çæ§è¡æ¶é´ç­ï¼ç­ç­ã\n\nMySQL çæ¥è¯¢ä¼åå¨æ¯ä¸ä¸ªéå¸¸å¤æçé¨ä»¶ï¼å®ä½¿ç¨äºéå¸¸å¤çä¼åç­ç¥æ¥çæä¸ä¸ªæä¼çæ§è¡è®¡åï¼\n\n * éæ°å®ä¹è¡¨çå³èé¡ºåºï¼å¤å¼ è¡¨å³èæ¥è¯¢æ¶ï¼å¹¶ä¸ä¸å®æç§ SQL ä¸­æå®çé¡ºåºè¿è¡ï¼ä½æä¸äºæå·§å¯ä»¥æå®å³èé¡ºåºï¼\n * ä¼åMIN()åMAX()å½æ°ï¼æ¾æåçæå°å¼ï¼å¦æè¯¥åæç´¢å¼ï¼åªéè¦æ¥æ¾ B+Tree ç´¢å¼æå·¦ç«¯ï¼åä¹åå¯ä»¥æ¾å°æå¤§å¼ï¼å·ä½åçè§ä¸æï¼\n * æåç»æ­¢æ¥è¯¢ï¼æ¯å¦ï¼ä½¿ç¨ Limit æ¶ï¼æ¥æ¾å°æ»¡è¶³æ°éçç»æéåä¼ç«å³ç»æ­¢æ¥è¯¢ï¼\n * ä¼åæåºï¼å¨èçæ¬ MySQL ä¼ä½¿ç¨ä¸¤æ¬¡ä¼ è¾æåºï¼å³åè¯»åè¡æéåéè¦æåºçå­æ®µå¨åå­ä¸­å¯¹å¶æåºï¼ç¶ååæ ¹æ®æåºç»æå»è¯»åæ°æ®è¡ï¼èæ°çæ¬éç¨çæ¯åæ¬¡ä¼ è¾æåºï¼ä¹å°±æ¯ä¸æ¬¡è¯»åææçæ°æ®è¡ï¼ç¶åæ ¹æ®ç»å®çåæåºãå¯¹äº I/O å¯éååºç¨ï¼æçä¼é«å¾å¤ï¼\n\néç MySQL çä¸æ­åå±ï¼ä¼åå¨ä½¿ç¨çä¼åç­ç¥ä¹å¨ä¸æ­çè¿åï¼è¿éä»ä»ä»ç»å ä¸ªéå¸¸å¸¸ç¨ä¸å®¹æçè§£çä¼åç­ç¥ï¼å¶ä»çä¼åç­ç¥ï¼å¤§å®¶èªè¡æ¥éå§ã\n\n\n# ï¼äºï¼æ¥è¯¢æ§è¡å¼æ\n\nå¨å®æè§£æåä¼åé¶æ®µä»¥åï¼MySQL ä¼çæå¯¹åºçæ§è¡è®¡åï¼æ¥è¯¢æ§è¡å¼ææ ¹æ®æ§è¡è®¡åç»åºçæä»¤éæ­¥æ§è¡å¾åºç»æãæ´ä¸ªæ§è¡è¿ç¨çå¤§é¨åæä½åæ¯éè¿è°ç¨å­å¨å¼æå®ç°çæ¥å£æ¥å®æï¼è¿äºæ¥å£è¢«ç§°ä¸ºhandler APIãæ¥è¯¢è¿ç¨ä¸­çæ¯ä¸å¼ è¡¨ç±ä¸ä¸ªhandlerå®ä¾è¡¨ç¤ºãå®éä¸ï¼MySQL å¨æ¥è¯¢ä¼åé¶æ®µå°±ä¸ºæ¯ä¸å¼ è¡¨åå»ºäºä¸ä¸ªhandlerå®ä¾ï¼ä¼åå¨å¯ä»¥æ ¹æ®è¿äºå®ä¾çæ¥å£æ¥è·åè¡¨çç¸å³ä¿¡æ¯ï¼åæ¬è¡¨çææååãç´¢å¼ç»è®¡ä¿¡æ¯ç­ãå­å¨å¼ææ¥å£æä¾äºéå¸¸ä¸°å¯çåè½ï¼ä½å¶åºå±ä»æå åä¸ªæ¥å£ï¼è¿äºæ¥å£åæ­ç§¯æ¨ä¸æ ·å®æäºä¸æ¬¡æ¥è¯¢çå¤§é¨åæä½ã\n\n\n# ï¼å­ï¼è¿åç»æ\n\næ¥è¯¢è¿ç¨çæåä¸ä¸ªé¶æ®µå°±æ¯å°ç»æè¿åç»å®¢æ·ç«¯ãå³ä½¿æ¥è¯¢ä¸å°æ°æ®ï¼MySQL ä»ç¶ä¼è¿åè¿ä¸ªæ¥è¯¢çç¸å³ä¿¡æ¯ï¼æ¯å¦è¯¥æ¥è¯¢å½±åå°çè¡æ°ä»¥åæ§è¡æ¶é´ç­ç­ã\n\nå¦ææ¥è¯¢ç¼å­è¢«æå¼ä¸è¿ä¸ªæ¥è¯¢å¯ä»¥è¢«ç¼å­ï¼MySQL ä¹ä¼å°ç»æå­æ¾å°ç¼å­ä¸­ã\n\nç»æéè¿åå®¢æ·ç«¯æ¯ä¸ä¸ªå¢éä¸éæ­¥è¿åçè¿ç¨ãæå¯è½ MySQL å¨çæç¬¬ä¸æ¡ç»ææ¶ï¼å°±å¼å§åå®¢æ·ç«¯éæ­¥è¿åç»æéäºãè¿æ ·æå¡ç«¯å°±æ é¡»å­å¨å¤ªå¤ç»æèæ¶èè¿å¤åå­ï¼ä¹å¯ä»¥è®©å®¢æ·ç«¯ç¬¬ä¸æ¶é´è·å¾è¿åç»æãéè¦æ³¨æçæ¯ï¼ç»æéä¸­çæ¯ä¸è¡é½ä¼ä»¥ä¸ä¸ªæ»¡è¶³ â  ä¸­ææè¿°çéä¿¡åè®®çæ°æ®ååéï¼åéè¿ TCP åè®®è¿è¡ä¼ è¾ï¼å¨ä¼ è¾è¿ç¨ä¸­ï¼å¯è½å¯¹ MySQL çæ°æ®åè¿è¡ç¼å­ç¶åæ¹éåéã\n\n\n# æ´æ°è¿ç¨\n\nMySQL æ´æ°è¿ç¨å MySQL æ¥è¯¢è¿ç¨ç±»ä¼¼ï¼ä¹ä¼å°æµç¨èµ°ä¸éãä¸ä¸æ ·çæ¯ï¼æ´æ°æµç¨è¿æ¶åä¸¤ä¸ªéè¦çæ¥å¿æ¨¡åï¼ï¼redo logï¼éåæ¥å¿ï¼å binlogï¼å½æ¡£æ¥å¿ï¼ã\n\n\n# redo log\n\nredo log æ¯ InnoDB å¼æç¹æçæ¥å¿ãredo log å³éåæ¥å¿ãredo log æ¯ç©çæ¥å¿ï¼è®°å½çæ¯âå¨æä¸ªæ°æ®é¡µä¸åäºä»ä¹ä¿®æ¹âã\n\nredo log æ¯åºäº WAL ææ¯ãWAL çå¨ç§°æ¯ Write-Ahead Loggingï¼å®çå³é®ç¹å°±æ¯ååæ¥å¿ï¼ååç£çãå·ä½æ¥è¯´ï¼å½æä¸æ¡è®°å½éè¦æ´æ°çæ¶åï¼InnoDB å¼æå°±ä¼åæè®°å½åå° redo log éï¼å¹¶æ´æ°åå­ï¼è¿ä¸ªæ¶åæ´æ°å°±ç®å®æäºãåæ¶ï¼InnoDB å¼æä¼å¨éå½çæ¶åï¼å°è¿ä¸ªæä½è®°å½æ´æ°å°ç£çéé¢ï¼èè¿ä¸ªæ´æ°å¾å¾æ¯å¨ç³»ç»æ¯è¾ç©ºé²çæ¶ååã\n\nInnoDB ç redo log æ¯åºå®å¤§å°çï¼æ¯å¦å¯ä»¥éç½®ä¸ºä¸ç» 4 ä¸ªæä»¶ï¼æ¯ä¸ªæä»¶çå¤§å°æ¯ 1GBï¼é£ä¹è¿åâç²æ¿âæ»å±å°±å¯ä»¥è®°å½ 4GB çæä½ãä»å¤´å¼å§åï¼åå°æ«å°¾å°±ååå°å¼å¤´å¾ªç¯åã\n\n\n\næäº redo logï¼InnoDB å°±å¯ä»¥ä¿è¯å³ä½¿æ°æ®åºåçå¼å¸¸éå¯ï¼ä¹åæäº¤çè®°å½é½ä¸ä¼ä¸¢å¤±ï¼è¿ä¸ªè½åç§°ä¸ºcrash-safeã\n\n\n# bin log\n\nbin log å³å½æ¡£æ¥å¿ãbinlog æ¯é»è¾æ¥å¿ï¼è®°å½çæ¯è¿ä¸ªè¯­å¥çåå§é»è¾ã\n\nbinlog æ¯å¯ä»¥è¿½å åå¥çï¼å³åå°ä¸å®å¤§å°åä¼åæ¢å°ä¸ä¸ä¸ªï¼å¹¶ä¸ä¼è¦çä»¥åçæ¥å¿ã\n\nbinlog æ¯ MySQL ç Server å±å®ç°çï¼ææå¼æé½å¯ä»¥ä½¿ç¨ã\n\nsync_binlog è¿ä¸ªåæ°è®¾ç½®æ 1 çæ¶åï¼è¡¨ç¤ºæ¯æ¬¡äºå¡ç binlog é½æä¹åå°ç£çãè¿ä¸ªåæ°æä¹å»ºè®®ä½ è®¾ç½®æ 1ï¼è¿æ ·å¯ä»¥ä¿è¯ MySQL å¼å¸¸éå¯ä¹å binlog ä¸ä¸¢å¤±ã\n\n\n# redo log vs. bin log\n\nè¿ä¸¤ç§æ¥å¿æä»¥ä¸ä¸ç¹ä¸åã\n\n * redo log æ¯ InnoDB å¼æç¹æçï¼binlog æ¯ MySQL ç Server å±å®ç°çï¼ææå¼æé½å¯ä»¥ä½¿ç¨ã\n * redo log æ¯ç©çæ¥å¿ï¼è®°å½çæ¯âå¨æä¸ªæ°æ®é¡µä¸åäºä»ä¹ä¿®æ¹âï¼binlog æ¯é»è¾æ¥å¿ï¼è®°å½çæ¯è¿ä¸ªè¯­å¥çåå§é»è¾ï¼æ¯å¦âç» ID=2 è¿ä¸è¡ç c å­æ®µå  1 âã\n * redo log æ¯å¾ªç¯åçï¼ç©ºé´åºå®ä¼ç¨å®ï¼binlog æ¯å¯ä»¥è¿½å åå¥çãâè¿½å åâæ¯æ binlog æä»¶åå°ä¸å®å¤§å°åä¼åæ¢å°ä¸ä¸ä¸ªï¼å¹¶ä¸ä¼è¦çä»¥åçæ¥å¿ã\n\næäºå¯¹è¿ä¸¤ä¸ªæ¥å¿çæ¦å¿µæ§çè§£ï¼æä»¬åæ¥çæ§è¡å¨å InnoDB å¼æå¨æ§è¡è¿ä¸ªç®åç update è¯­å¥æ¶çåé¨æµç¨ã\n\n 1. æ§è¡å¨åæ¾å¼æå ID=2 è¿ä¸è¡ãID æ¯ä¸»é®ï¼å¼æç´æ¥ç¨æ æç´¢æ¾å°è¿ä¸è¡ãå¦æ ID=2 è¿ä¸è¡æå¨çæ°æ®é¡µæ¬æ¥å°±å¨åå­ä¸­ï¼å°±ç´æ¥è¿åç»æ§è¡å¨ï¼å¦åï¼éè¦åä»ç£çè¯»å¥åå­ï¼ç¶ååè¿åã\n 2. æ§è¡å¨æ¿å°å¼æç»çè¡æ°æ®ï¼æè¿ä¸ªå¼å ä¸ 1ï¼æ¯å¦åæ¥æ¯ Nï¼ç°å¨å°±æ¯ N+1ï¼å¾å°æ°çä¸è¡æ°æ®ï¼åè°ç¨å¼ææ¥å£åå¥è¿è¡æ°æ°æ®ã\n 3. å¼æå°è¿è¡æ°æ°æ®æ´æ°å°åå­ä¸­ï¼åæ¶å°è¿ä¸ªæ´æ°æä½è®°å½å° redo log éé¢ï¼æ­¤æ¶ redo log å¤äº prepare ç¶æãç¶ååç¥æ§è¡å¨æ§è¡å®æäºï¼éæ¶å¯ä»¥æäº¤äºå¡ã\n 4. æ§è¡å¨çæè¿ä¸ªæä½ç binlogï¼å¹¶æ binlog åå¥ç£çã\n 5. æ§è¡å¨è°ç¨å¼æçæäº¤äºå¡æ¥å£ï¼å¼ææåååå¥ç redo log æ¹ææäº¤ï¼commitï¼ç¶æï¼æ´æ°å®æã\n\nè¿éæç»åºè¿ä¸ª update è¯­å¥çæ§è¡æµç¨å¾ï¼å¾ä¸­æµè²æ¡è¡¨ç¤ºæ¯å¨ InnoDB åé¨æ§è¡çï¼æ·±è²æ¡è¡¨ç¤ºæ¯å¨æ§è¡å¨ä¸­æ§è¡çã\n\n\n\n\n# ä¸¤é¶æ®µæäº¤\n\nredo log çåå¥ææäºä¸¤ä¸ªæ­¥éª¤ï¼prepare å commitï¼è¿å°±æ¯"ä¸¤é¶æ®µæäº¤"ãä¸ºä»ä¹æ¥å¿éè¦âä¸¤é¶æ®µæäº¤âã\n\nç±äº redo log å binlog æ¯ä¸¤ä¸ªç¬ç«çé»è¾ï¼å¦æä¸ç¨ä¸¤é¶æ®µæäº¤ï¼è¦ä¹å°±æ¯ååå® redo log åå binlogï¼æèéç¨åè¿æ¥çé¡ºåºãæä»¬ççè¿ä¸¤ç§æ¹å¼ä¼æä»ä¹é®é¢ã\n\n * åå redo log åå binlogãåè®¾å¨ redo log åå®ï¼binlog è¿æ²¡æåå®çæ¶åï¼MySQL è¿ç¨å¼å¸¸éå¯ãç±äºæä»¬åé¢è¯´è¿çï¼redo log åå®ä¹åï¼ç³»ç»å³ä½¿å´©æºï¼ä»ç¶è½å¤ææ°æ®æ¢å¤åæ¥ï¼æä»¥æ¢å¤åè¿ä¸è¡ c çå¼æ¯ 1ã ä½æ¯ç±äº binlog æ²¡åå®å°± crash äºï¼è¿æ¶å binlog éé¢å°±æ²¡æè®°å½è¿ä¸ªè¯­å¥ãå æ­¤ï¼ä¹åå¤ä»½æ¥å¿çæ¶åï¼å­èµ·æ¥ç binlog éé¢å°±æ²¡æè¿æ¡è¯­å¥ã ç¶åä½ ä¼åç°ï¼å¦æéè¦ç¨è¿ä¸ª binlog æ¥æ¢å¤ä¸´æ¶åºçè¯ï¼ç±äºè¿ä¸ªè¯­å¥ç binlog ä¸¢å¤±ï¼è¿ä¸ªä¸´æ¶åºå°±ä¼å°äºè¿ä¸æ¬¡æ´æ°ï¼æ¢å¤åºæ¥çè¿ä¸è¡ c çå¼å°±æ¯ 0ï¼ä¸ååºçå¼ä¸åã\n * åå binlog åå redo logãå¦æå¨ binlog åå®ä¹å crashï¼ç±äº redo log è¿æ²¡åï¼å´©æºæ¢å¤ä»¥åè¿ä¸ªäºå¡æ æï¼æä»¥è¿ä¸è¡ c çå¼æ¯ 0ãä½æ¯ binlog éé¢å·²ç»è®°å½äºâæ c ä» 0 æ¹æ 1âè¿ä¸ªæ¥å¿ãæä»¥ï¼å¨ä¹åç¨ binlog æ¥æ¢å¤çæ¶åå°±å¤äºä¸ä¸ªäºå¡åºæ¥ï¼æ¢å¤åºæ¥çè¿ä¸è¡ c çå¼å°±æ¯ 1ï¼ä¸ååºçå¼ä¸åã\n\nå¯ä»¥çå°ï¼å¦æä¸ä½¿ç¨âä¸¤é¶æ®µæäº¤âï¼é£ä¹æ°æ®åºçç¶æå°±æå¯è½åç¨å®çæ¥å¿æ¢å¤åºæ¥çåºçç¶æä¸ä¸è´ã\n\n\n# åèèµæ\n\n * ãé«æ§è½ MySQLã\n * MySQL å®æ 45 è®²',normalizedContent:'# mysql å·¥ä½æµ\n\n\n# åºç¡æ¶æ\n\nå¤§ä½æ¥è¯´ï¼mysql å¯ä»¥åä¸º server å±åå­å¨å¼æå±ä¸¤é¨åã\n\nserver å±åæ¬è¿æ¥å¨ãæ¥è¯¢ç¼å­ãåæå¨ãä¼åå¨ãæ§è¡å¨ç­ï¼æ¶µç mysql çå¤§å¤æ°æ ¸å¿æå¡åè½ï¼ä»¥åææçåç½®å½æ°ï¼å¦æ¥æãæ¶é´ãæ°å­¦åå å¯å½æ°ç­ï¼ï¼ææè·¨å­å¨å¼æçåè½é½å¨è¿ä¸å±å®ç°ï¼æ¯å¦å­å¨è¿ç¨ãè§¦åå¨ãè§å¾ç­ã\n\nå­å¨å¼æå±è´è´£æ°æ®çå­å¨åæåãå¶æ¶ææ¨¡å¼æ¯æä»¶å¼çï¼æ¯æ innodbãmyisamãmemory ç­å¤ä¸ªå­å¨å¼æãç°å¨æå¸¸ç¨çå­å¨å¼ææ¯ innodbï¼å®ä» mysql 5.5.5 çæ¬å¼å§æä¸ºäºé»è®¤å­å¨å¼æã\n\n\n\n\n# æ¥è¯¢è¿ç¨\n\nsql è¯­å¥å¨ mysql ä¸­æ¯å¦ä½æ§è¡çï¼\n\nmysql æ´ä¸ªæ¥è¯¢æ§è¡è¿ç¨ï¼æ»çæ¥è¯´åä¸º 6 ä¸ªæ­¥éª¤ï¼åå«å¯¹åº 6 ä¸ªç»ä»¶ï¼\n\n 1. è¿æ¥å¨ï¼å®¢æ·ç«¯å mysql æå¡å¨å»ºç«è¿æ¥ï¼è¿æ¥å¨è´è´£è·å®¢æ·ç«¯å»ºç«è¿æ¥ãè·åæéãç»´æåç®¡çè¿æ¥ã\n 2. mysql æå¡å¨é¦åæ£æ¥æ¥è¯¢ç¼å­ï¼å¦æå½ä¸­ç¼å­ï¼åç«å»è¿åç»æãå¦åè¿å¥ä¸ä¸é¶æ®µã\n 3. mysql æå¡å¨è¿è¡ sql åæï¼è¯­æ³åæãè¯æ³åæã\n 4. mysql æå¡å¨ç¨ä¼åå¨çæå¯¹åºçæ§è¡è®¡åã\n 5. mysql æå¡å¨æ ¹æ®æ§è¡è®¡åï¼è°ç¨å­å¨å¼æç api æ¥æ§è¡æ¥è¯¢ã\n 6. mysql æå¡å¨å°ç»æè¿åç»å®¢æ·ç«¯ï¼åæ¶ç¼å­æ¥è¯¢ç»æã\n\n\n# ï¼ä¸ï¼è¿æ¥å¨\n\nä½¿ç¨ mysql ç¬¬ä¸æ­¥èªç¶æ¯è¦è¿æ¥æ°æ®åºãè¿æ¥å¨è´è´£è·å®¢æ·ç«¯å»ºç«è¿æ¥ãè·åæéãç»´æåç®¡çè¿æ¥ã\n\nmysql å®¢æ·ç«¯/æå¡ç«¯éä¿¡æ¯ååå·¥æ¨¡å¼ï¼å³ä»»ä¸æ¶å»ï¼è¦ä¹æ¯æå¡ç«¯åå®¢æ·ç«¯åéæ°æ®ï¼è¦ä¹æ¯å®¢æ·ç«¯åæå¡å¨åéæ°æ®ãå®¢æ·ç«¯ç¨ä¸ä¸ªåç¬çæ°æ®åå°æ¥è¯¢è¯·æ±åéç»æå¡å¨ï¼æä»¥å½æ¥è¯¢è¯­å¥å¾é¿çæ¶åï¼éè¦è®¾ç½®max_allowed_packetåæ°ãä½æ¯éè¦æ³¨æçæ¯ï¼å¦ææ¥è¯¢å®å¨æ¯å¤ªå¤§ï¼æå¡ç«¯ä¼æç»æ¥æ¶æ´å¤æ°æ®å¹¶æåºå¼å¸¸ã\n\nmysql å®¢æ·ç«¯è¿æ¥å½ä»¤ï¼mysql -h<ä¸»æº> -p<ç«¯å£> -u<ç¨æ·å> -p<å¯ç >ãå¦ææ²¡ææ¾å¼æå®å¯ç ï¼ä¼è¦æ±è¾å¥å¯ç æè½è®¿é®ã\n\nè¿æ¥å®æåï¼å¦æä½ æ²¡æåç»­çå¨ä½ï¼è¿ä¸ªè¿æ¥å°±å¤äºç©ºé²ç¶æï¼ä½ å¯ä»¥å¨ show processlist å½ä»¤ä¸­çå°å®ãå®¢æ·ç«¯å¦æå¤ªé¿æ¶é´æ²¡å¨éï¼è¿æ¥å¨å°±ä¼èªå¨å°å®æ­å¼ãå®¢æ·ç«¯è¿æ¥ç»´ææ¶é´æ¯ç±åæ° wait_timeout æ§å¶çï¼é»è®¤å¼æ¯ 8 å°æ¶ãå¦æå¨è¿æ¥è¢«æ­å¼ä¹åï¼å®¢æ·ç«¯åæ¬¡åéè¯·æ±çè¯ï¼å°±ä¼æ¶å°ä¸ä¸ªéè¯¯æéï¼ lost connection to mysql server during queryãè¿æ¶åå¦æä½ è¦ç»§ç»­ï¼å°±éè¦éè¿ï¼ç¶ååæ§è¡è¯·æ±äºã\n\nå»ºç«è¿æ¥çè¿ç¨éå¸¸æ¯æ¯è¾å¤æçï¼å»ºè®®å¨ä½¿ç¨ä¸­è¦å°½éåå°å»ºç«è¿æ¥çå¨ä½ï¼ä¹å°±æ¯å°½éä½¿ç¨é¿è¿æ¥ãä¸ºäºå¨ç¨åºä¸­æé«æ°æ®åºè¿æ¥çæç¨äºï¼ä¸è¬ä¼ä½¿ç¨æ°æ®åºè¿æ¥æ± æ¥ç»´æ¤ç®¡çã\n\nä½æ¯å¨é¨ä½¿ç¨é¿è¿æ¥åï¼ä½ å¯è½ä¼åç°ï¼æäºæ¶å mysql å ç¨åå­æ¶¨å¾ç¹å«å¿«ï¼è¿æ¯å ä¸º mysql å¨æ§è¡è¿ç¨ä¸­ä¸´æ¶ä½¿ç¨çåå­æ¯ç®¡çå¨è¿æ¥å¯¹è±¡éé¢çãè¿äºèµæºä¼å¨è¿æ¥æ­å¼çæ¶åæéæ¾ãæä»¥å¦æé¿è¿æ¥ç´¯ç§¯ä¸æ¥ï¼å¯è½å¯¼è´åå­å ç¨å¤ªå¤§ï¼è¢«ç³»ç»å¼ºè¡ææï¼oomï¼ï¼ä»ç°è±¡çå°±æ¯ mysql å¼å¸¸éå¯äºã\n\næä¹è§£å³è¿ä¸ªé®é¢å¢ï¼ä½ å¯ä»¥èèä»¥ä¸ä¸¤ç§æ¹æ¡ã\n\n * å®ææ­å¼é¿è¿æ¥ãä½¿ç¨ä¸æ®µæ¶é´ï¼æèç¨åºéé¢å¤æ­æ§è¡è¿ä¸ä¸ªå ç¨åå­çå¤§æ¥è¯¢åï¼æ­å¼è¿æ¥ï¼ä¹åè¦æ¥è¯¢åéè¿ã\n * å¦æä½ ç¨çæ¯ mysql 5.7 ææ´æ°çæ¬ï¼å¯ä»¥å¨æ¯æ¬¡æ§è¡ä¸ä¸ªæ¯è¾å¤§çæä½åï¼éè¿æ§è¡ mysql_reset_connection æ¥éæ°åå§åè¿æ¥èµæºãè¿ä¸ªè¿ç¨ä¸éè¦éè¿åéæ°åæééªè¯ï¼ä½æ¯ä¼å°è¿æ¥æ¢å¤å°åååå»ºå®æ¶çç¶æã\n\n\n# ï¼äºï¼æ¥è¯¢ç¼å­\n\n> ä¸å»ºè®®ä½¿ç¨æ°æ®åºç¼å­ï¼å ä¸ºå¾å¾å¼å¤§äºå©ã\n\nè§£æä¸ä¸ªæ¥è¯¢è¯­å¥åï¼å¦ææ¥è¯¢ç¼å­æ¯æå¼çï¼é£ä¹ mysql ä¼æ£æ¥è¿ä¸ªæ¥è¯¢è¯­å¥æ¯å¦å½ä¸­æ¥è¯¢ç¼å­ä¸­çæ°æ®ãå¦æå½åæ¥è¯¢æ°å¥½å½ä¸­æ¥è¯¢ç¼å­ï¼å¨æ£æ¥ä¸æ¬¡ç¨æ·æéåç´æ¥è¿åç¼å­ä¸­çç»æãè¿ç§æåµä¸ï¼æ¥è¯¢ä¸ä¼è¢«è§£æï¼ä¹ä¸ä¼çææ§è¡è®¡åï¼æ´ä¸ä¼æ§è¡ã\n\nmysql å°ç¼å­å­æ¾å¨ä¸ä¸ªå¼ç¨è¡¨ï¼ä¸è¦çè§£ætableï¼å¯ä»¥è®¤ä¸ºæ¯ç±»ä¼¼äºhashmapçæ°æ®ç»æï¼ï¼éè¿ä¸ä¸ªåå¸å¼ç´¢å¼ï¼è¿ä¸ªåå¸å¼éè¿æ¥è¯¢æ¬èº«ãå½åè¦æ¥è¯¢çæ°æ®åºãå®¢æ·ç«¯åè®®çæ¬å·ç­ä¸äºå¯è½å½±åç»æçä¿¡æ¯è®¡ç®å¾æ¥ãæä»¥ä¸¤ä¸ªæ¥è¯¢å¨ä»»ä½å­ç¬¦ä¸çä¸åï¼ä¾å¦ï¼ç©ºæ ¼ãæ³¨éï¼ï¼é½ä¼å¯¼è´ç¼å­ä¸ä¼å½ä¸­ã\n\nå¦ææ¥è¯¢ä¸­åå«ä»»ä½ç¨æ·èªå®ä¹å½æ°ãå­å¨å½æ°ãç¨æ·åéãä¸´æ¶è¡¨ãmysql åºä¸­çç³»ç»è¡¨ï¼å¶æ¥è¯¢ç»æé½ä¸ä¼è¢«ç¼å­ãæ¯å¦å½æ°now()æècurrent_date()ä¼å ä¸ºä¸åçæ¥è¯¢æ¶é´ï¼è¿åä¸åçæ¥è¯¢ç»æï¼åæ¯å¦åå«current_useræèconnecion_id()çæ¥è¯¢è¯­å¥ä¼å ä¸ºä¸åçç¨æ·èè¿åä¸åçç»æï¼å°è¿æ ·çæ¥è¯¢ç»æç¼å­èµ·æ¥æ²¡æä»»ä½çæä¹ã\n\nä¸å»ºè®®ä½¿ç¨æ°æ®åºç¼å­ï¼å ä¸ºå¾å¾å¼å¤§äºå©ãæ¥è¯¢ç¼å­çå¤±æéå¸¸é¢ç¹ï¼åªè¦æå¯¹ä¸ä¸ªè¡¨çæ´æ°ï¼è¿ä¸ªè¡¨ä¸ææçæ¥è¯¢ç¼å­é½ä¼è¢«æ¸ç©ºãå æ­¤å¾å¯è½ä½ è´¹å²å°æç»æå­èµ·æ¥ï¼è¿æ²¡ä½¿ç¨å¢ï¼å°±è¢«ä¸ä¸ªæ´æ°å¨æ¸ç©ºäºãå¯¹äºæ´æ°ååå¤§çæ°æ®åºæ¥è¯´ï¼æ¥è¯¢ç¼å­çå½ä¸­çä¼éå¸¸ä½ãé¤éä½ çä¸å¡å°±æ¯æä¸å¼ éæè¡¨ï¼å¾é¿æ¶é´æä¼æ´æ°ä¸æ¬¡ãæ¯å¦ï¼ä¸ä¸ªç³»ç»éç½®è¡¨ï¼é£è¿å¼ è¡¨ä¸çæ¥è¯¢æéåä½¿ç¨æ¥è¯¢ç¼å­ã\n\nå¥½å¨ mysql ä¹æä¾äºè¿ç§âæéä½¿ç¨âçæ¹å¼ãä½ å¯ä»¥å°åæ° query_cache_type è®¾ç½®æ demandï¼è¿æ ·å¯¹äºé»è®¤ç sql è¯­å¥é½ä¸ä½¿ç¨æ¥è¯¢ç¼å­ãèå¯¹äºä½ ç¡®å®è¦ä½¿ç¨æ¥è¯¢ç¼å­çè¯­å¥ï¼å¯ä»¥ç¨ sql_cache æ¾å¼æå®ï¼åä¸é¢è¿ä¸ªè¯­å¥ä¸æ ·ï¼\n\nselect sql_cache * from t where id=10;\n\n\n> æ³¨æï¼mysql 8.0 çæ¬ç´æ¥å°æ¥è¯¢ç¼å­çæ´ååè½å æäºã\n\n\n# ï¼ä¸ï¼è¯­æ³åæ\n\nå¦ææ²¡æå½ä¸­æ¥è¯¢ç¼å­ï¼å°±è¦å¼å§çæ­£æ§è¡è¯­å¥äºãé¦åï¼mysql éè¦ç¥éä½ è¦åä»ä¹ï¼å æ­¤éè¦å¯¹ sql è¯­å¥åè§£æãmysql éè¿å³é®å­å¯¹ sql è¯­å¥è¿è¡è§£æï¼å¹¶çæä¸é¢å¯¹åºçè¯­æ³è§£ææ ãè¿ä¸ªè¿ç¨ä¸­ï¼åæå¨ä¸»è¦éè¿è¯­æ³è§åæ¥éªè¯åè§£æãæ¯å¦ sql ä¸­æ¯å¦ä½¿ç¨äºéè¯¯çå³é®å­æèå³é®å­çé¡ºåºæ¯å¦æ­£ç¡®ç­ç­ãé¢å¤çåä¼æ ¹æ® mysql è§åè¿ä¸æ­¥æ£æ¥è§£ææ æ¯å¦åæ³ãæ¯å¦æ£æ¥è¦æ¥è¯¢çæ°æ®è¡¨åæ°æ®åæ¯å¦å­å¨ç­ç­ã\n\n * åæå¨åä¼ååâè¯æ³åæâãä½ è¾å¥çæ¯ç±å¤ä¸ªå­ç¬¦ä¸²åç©ºæ ¼ç»æçä¸æ¡ sql è¯­å¥ï¼mysql éè¦è¯å«åºéé¢çå­ç¬¦ä¸²åå«æ¯ä»ä¹ï¼ä»£è¡¨ä»ä¹ãmysql ä»ä½ è¾å¥ç"select"è¿ä¸ªå³é®å­è¯å«åºæ¥ï¼è¿æ¯ä¸ä¸ªæ¥è¯¢è¯­å¥ãå®ä¹è¦æå­ç¬¦ä¸²âtâè¯å«æâè¡¨å tâï¼æå­ç¬¦ä¸²âidâè¯å«æâå idâã\n * æ¥ä¸æ¥ï¼è¦åâè¯­æ³åæâãæ ¹æ®è¯æ³åæçç»æï¼è¯­æ³åæå¨ä¼æ ¹æ®è¯­æ³è§åï¼å¤æ­ä½ è¾å¥çè¿ä¸ª sql è¯­å¥æ¯å¦æ»¡è¶³ mysql è¯­æ³ãå¦æä½ çè¯­å¥ä¸å¯¹ï¼å°±ä¼æ¶å°âyou have an error in your sql syntaxâçéè¯¯æéï¼æ¯å¦ä¸é¢è¿ä¸ªè¯­å¥ select å°æäºå¼å¤´çå­æ¯âsâã\n\n\n# ï¼åï¼æ¥è¯¢ä¼å\n\nç»è¿äºåæå¨ï¼mysql å°±ç¥éä½ è¦åä»ä¹äºãå¨å¼å§æ§è¡ä¹åï¼è¿è¦åç»è¿ä¼åå¨çå¤çã\n\nç»è¿åé¢çæ­¥éª¤çæçè¯­æ³æ è¢«è®¤ä¸ºæ¯åæ³çäºï¼å¹¶ä¸ç±ä¼åå¨å°å¶è½¬åææ§è¡è®¡åãå¤æ°æåµä¸ï¼ä¸æ¡æ¥è¯¢å¯ä»¥æå¾å¤ç§æ§è¡æ¹å¼ï¼æåé½è¿åç¸åºçç»æãä¼åå¨çä½ç¨å°±æ¯æ¾å°è¿å¶ä¸­æå¥½çæ§è¡è®¡åã\n\nmysql ä½¿ç¨åºäºææ¬çä¼åå¨ï¼å®å°è¯é¢æµä¸ä¸ªæ¥è¯¢ä½¿ç¨æç§æ§è¡è®¡åæ¶çææ¬ï¼å¹¶éæ©å¶ä¸­ææ¬æå°çä¸ä¸ªãå¨ mysql å¯ä»¥éè¿æ¥è¯¢å½åä¼è¯ç last_query_cost çå¼æ¥å¾å°å¶è®¡ç®å½åæ¥è¯¢çææ¬ã\n\nmysql> select * from t_message limit 10;\n...çç¥ç»æé\n\nmysql> show status like \'last_query_cost\';\n+-----------------+-------------+\n| variable_name   | value       |\n+-----------------+-------------+\n| last_query_cost | 6391.799000 |\n+-----------------+-------------+\n\n\nç¤ºä¾ä¸­çç»æè¡¨ç¤ºä¼åå¨è®¤ä¸ºå¤§æ¦éè¦å 6391 ä¸ªæ°æ®é¡µçéæºæ¥æ¾æè½å®æä¸é¢çæ¥è¯¢ãè¿ä¸ªç»ææ¯æ ¹æ®ä¸äºåçç»è®¡ä¿¡æ¯è®¡ç®å¾æ¥çï¼è¿äºç»è®¡ä¿¡æ¯åæ¬ï¼æ¯å¼ è¡¨æèç´¢å¼çé¡µé¢ä¸ªæ°ãç´¢å¼çåºæ°ãç´¢å¼åæ°æ®è¡çé¿åº¦ãç´¢å¼çåå¸æåµç­ç­ã\n\næéå¸¸å¤çåå ä¼å¯¼è´ mysql éæ©éè¯¯çæ§è¡è®¡åï¼æ¯å¦ç»è®¡ä¿¡æ¯ä¸åç¡®ãä¸ä¼èèä¸åå¶æ§å¶çæä½ææ¬ï¼ç¨æ·èªå®ä¹å½æ°ãå­å¨è¿ç¨ï¼ãmysql è®¤ä¸ºçæä¼è·æä»¬æ³çä¸ä¸æ ·ï¼æä»¬å¸ææ§è¡æ¶é´å°½å¯è½ç­ï¼ä½ mysql å¼éæ©å®è®¤ä¸ºææ¬å°çï¼ä½ææ¬å°å¹¶ä¸æå³çæ§è¡æ¶é´ç­ï¼ç­ç­ã\n\nmysql çæ¥è¯¢ä¼åå¨æ¯ä¸ä¸ªéå¸¸å¤æçé¨ä»¶ï¼å®ä½¿ç¨äºéå¸¸å¤çä¼åç­ç¥æ¥çæä¸ä¸ªæä¼çæ§è¡è®¡åï¼\n\n * éæ°å®ä¹è¡¨çå³èé¡ºåºï¼å¤å¼ è¡¨å³èæ¥è¯¢æ¶ï¼å¹¶ä¸ä¸å®æç§ sql ä¸­æå®çé¡ºåºè¿è¡ï¼ä½æä¸äºæå·§å¯ä»¥æå®å³èé¡ºåºï¼\n * ä¼åmin()åmax()å½æ°ï¼æ¾æåçæå°å¼ï¼å¦æè¯¥åæç´¢å¼ï¼åªéè¦æ¥æ¾ b+tree ç´¢å¼æå·¦ç«¯ï¼åä¹åå¯ä»¥æ¾å°æå¤§å¼ï¼å·ä½åçè§ä¸æï¼\n * æåç»æ­¢æ¥è¯¢ï¼æ¯å¦ï¼ä½¿ç¨ limit æ¶ï¼æ¥æ¾å°æ»¡è¶³æ°éçç»æéåä¼ç«å³ç»æ­¢æ¥è¯¢ï¼\n * ä¼åæåºï¼å¨èçæ¬ mysql ä¼ä½¿ç¨ä¸¤æ¬¡ä¼ è¾æåºï¼å³åè¯»åè¡æéåéè¦æåºçå­æ®µå¨åå­ä¸­å¯¹å¶æåºï¼ç¶ååæ ¹æ®æåºç»æå»è¯»åæ°æ®è¡ï¼èæ°çæ¬éç¨çæ¯åæ¬¡ä¼ è¾æåºï¼ä¹å°±æ¯ä¸æ¬¡è¯»åææçæ°æ®è¡ï¼ç¶åæ ¹æ®ç»å®çåæåºãå¯¹äº i/o å¯éååºç¨ï¼æçä¼é«å¾å¤ï¼\n\néç mysql çä¸æ­åå±ï¼ä¼åå¨ä½¿ç¨çä¼åç­ç¥ä¹å¨ä¸æ­çè¿åï¼è¿éä»ä»ä»ç»å ä¸ªéå¸¸å¸¸ç¨ä¸å®¹æçè§£çä¼åç­ç¥ï¼å¶ä»çä¼åç­ç¥ï¼å¤§å®¶èªè¡æ¥éå§ã\n\n\n# ï¼äºï¼æ¥è¯¢æ§è¡å¼æ\n\nå¨å®æè§£æåä¼åé¶æ®µä»¥åï¼mysql ä¼çæå¯¹åºçæ§è¡è®¡åï¼æ¥è¯¢æ§è¡å¼ææ ¹æ®æ§è¡è®¡åç»åºçæä»¤éæ­¥æ§è¡å¾åºç»æãæ´ä¸ªæ§è¡è¿ç¨çå¤§é¨åæä½åæ¯éè¿è°ç¨å­å¨å¼æå®ç°çæ¥å£æ¥å®æï¼è¿äºæ¥å£è¢«ç§°ä¸ºhandler apiãæ¥è¯¢è¿ç¨ä¸­çæ¯ä¸å¼ è¡¨ç±ä¸ä¸ªhandlerå®ä¾è¡¨ç¤ºãå®éä¸ï¼mysql å¨æ¥è¯¢ä¼åé¶æ®µå°±ä¸ºæ¯ä¸å¼ è¡¨åå»ºäºä¸ä¸ªhandlerå®ä¾ï¼ä¼åå¨å¯ä»¥æ ¹æ®è¿äºå®ä¾çæ¥å£æ¥è·åè¡¨çç¸å³ä¿¡æ¯ï¼åæ¬è¡¨çææååãç´¢å¼ç»è®¡ä¿¡æ¯ç­ãå­å¨å¼ææ¥å£æä¾äºéå¸¸ä¸°å¯çåè½ï¼ä½å¶åºå±ä»æå åä¸ªæ¥å£ï¼è¿äºæ¥å£åæ­ç§¯æ¨ä¸æ ·å®æäºä¸æ¬¡æ¥è¯¢çå¤§é¨åæä½ã\n\n\n# ï¼å­ï¼è¿åç»æ\n\næ¥è¯¢è¿ç¨çæåä¸ä¸ªé¶æ®µå°±æ¯å°ç»æè¿åç»å®¢æ·ç«¯ãå³ä½¿æ¥è¯¢ä¸å°æ°æ®ï¼mysql ä»ç¶ä¼è¿åè¿ä¸ªæ¥è¯¢çç¸å³ä¿¡æ¯ï¼æ¯å¦è¯¥æ¥è¯¢å½±åå°çè¡æ°ä»¥åæ§è¡æ¶é´ç­ç­ã\n\nå¦ææ¥è¯¢ç¼å­è¢«æå¼ä¸è¿ä¸ªæ¥è¯¢å¯ä»¥è¢«ç¼å­ï¼mysql ä¹ä¼å°ç»æå­æ¾å°ç¼å­ä¸­ã\n\nç»æéè¿åå®¢æ·ç«¯æ¯ä¸ä¸ªå¢éä¸éæ­¥è¿åçè¿ç¨ãæå¯è½ mysql å¨çæç¬¬ä¸æ¡ç»ææ¶ï¼å°±å¼å§åå®¢æ·ç«¯éæ­¥è¿åç»æéäºãè¿æ ·æå¡ç«¯å°±æ é¡»å­å¨å¤ªå¤ç»æèæ¶èè¿å¤åå­ï¼ä¹å¯ä»¥è®©å®¢æ·ç«¯ç¬¬ä¸æ¶é´è·å¾è¿åç»æãéè¦æ³¨æçæ¯ï¼ç»æéä¸­çæ¯ä¸è¡é½ä¼ä»¥ä¸ä¸ªæ»¡è¶³ â  ä¸­ææè¿°çéä¿¡åè®®çæ°æ®ååéï¼åéè¿ tcp åè®®è¿è¡ä¼ è¾ï¼å¨ä¼ è¾è¿ç¨ä¸­ï¼å¯è½å¯¹ mysql çæ°æ®åè¿è¡ç¼å­ç¶åæ¹éåéã\n\n\n# æ´æ°è¿ç¨\n\nmysql æ´æ°è¿ç¨å mysql æ¥è¯¢è¿ç¨ç±»ä¼¼ï¼ä¹ä¼å°æµç¨èµ°ä¸éãä¸ä¸æ ·çæ¯ï¼æ´æ°æµç¨è¿æ¶åä¸¤ä¸ªéè¦çæ¥å¿æ¨¡åï¼ï¼redo logï¼éåæ¥å¿ï¼å binlogï¼å½æ¡£æ¥å¿ï¼ã\n\n\n# redo log\n\nredo log æ¯ innodb å¼æç¹æçæ¥å¿ãredo log å³éåæ¥å¿ãredo log æ¯ç©çæ¥å¿ï¼è®°å½çæ¯âå¨æä¸ªæ°æ®é¡µä¸åäºä»ä¹ä¿®æ¹âã\n\nredo log æ¯åºäº wal ææ¯ãwal çå¨ç§°æ¯ write-ahead loggingï¼å®çå³é®ç¹å°±æ¯ååæ¥å¿ï¼ååç£çãå·ä½æ¥è¯´ï¼å½æä¸æ¡è®°å½éè¦æ´æ°çæ¶åï¼innodb å¼æå°±ä¼åæè®°å½åå° redo log éï¼å¹¶æ´æ°åå­ï¼è¿ä¸ªæ¶åæ´æ°å°±ç®å®æäºãåæ¶ï¼innodb å¼æä¼å¨éå½çæ¶åï¼å°è¿ä¸ªæä½è®°å½æ´æ°å°ç£çéé¢ï¼èè¿ä¸ªæ´æ°å¾å¾æ¯å¨ç³»ç»æ¯è¾ç©ºé²çæ¶ååã\n\ninnodb ç redo log æ¯åºå®å¤§å°çï¼æ¯å¦å¯ä»¥éç½®ä¸ºä¸ç» 4 ä¸ªæä»¶ï¼æ¯ä¸ªæä»¶çå¤§å°æ¯ 1gbï¼é£ä¹è¿åâç²æ¿âæ»å±å°±å¯ä»¥è®°å½ 4gb çæä½ãä»å¤´å¼å§åï¼åå°æ«å°¾å°±ååå°å¼å¤´å¾ªç¯åã\n\n\n\næäº redo logï¼innodb å°±å¯ä»¥ä¿è¯å³ä½¿æ°æ®åºåçå¼å¸¸éå¯ï¼ä¹åæäº¤çè®°å½é½ä¸ä¼ä¸¢å¤±ï¼è¿ä¸ªè½åç§°ä¸ºcrash-safeã\n\n\n# bin log\n\nbin log å³å½æ¡£æ¥å¿ãbinlog æ¯é»è¾æ¥å¿ï¼è®°å½çæ¯è¿ä¸ªè¯­å¥çåå§é»è¾ã\n\nbinlog æ¯å¯ä»¥è¿½å åå¥çï¼å³åå°ä¸å®å¤§å°åä¼åæ¢å°ä¸ä¸ä¸ªï¼å¹¶ä¸ä¼è¦çä»¥åçæ¥å¿ã\n\nbinlog æ¯ mysql ç server å±å®ç°çï¼ææå¼æé½å¯ä»¥ä½¿ç¨ã\n\nsync_binlog è¿ä¸ªåæ°è®¾ç½®æ 1 çæ¶åï¼è¡¨ç¤ºæ¯æ¬¡äºå¡ç binlog é½æä¹åå°ç£çãè¿ä¸ªåæ°æä¹å»ºè®®ä½ è®¾ç½®æ 1ï¼è¿æ ·å¯ä»¥ä¿è¯ mysql å¼å¸¸éå¯ä¹å binlog ä¸ä¸¢å¤±ã\n\n\n# redo log vs. bin log\n\nè¿ä¸¤ç§æ¥å¿æä»¥ä¸ä¸ç¹ä¸åã\n\n * redo log æ¯ innodb å¼æç¹æçï¼binlog æ¯ mysql ç server å±å®ç°çï¼ææå¼æé½å¯ä»¥ä½¿ç¨ã\n * redo log æ¯ç©çæ¥å¿ï¼è®°å½çæ¯âå¨æä¸ªæ°æ®é¡µä¸åäºä»ä¹ä¿®æ¹âï¼binlog æ¯é»è¾æ¥å¿ï¼è®°å½çæ¯è¿ä¸ªè¯­å¥çåå§é»è¾ï¼æ¯å¦âç» id=2 è¿ä¸è¡ç c å­æ®µå  1 âã\n * redo log æ¯å¾ªç¯åçï¼ç©ºé´åºå®ä¼ç¨å®ï¼binlog æ¯å¯ä»¥è¿½å åå¥çãâè¿½å åâæ¯æ binlog æä»¶åå°ä¸å®å¤§å°åä¼åæ¢å°ä¸ä¸ä¸ªï¼å¹¶ä¸ä¼è¦çä»¥åçæ¥å¿ã\n\næäºå¯¹è¿ä¸¤ä¸ªæ¥å¿çæ¦å¿µæ§çè§£ï¼æä»¬åæ¥çæ§è¡å¨å innodb å¼æå¨æ§è¡è¿ä¸ªç®åç update è¯­å¥æ¶çåé¨æµç¨ã\n\n 1. æ§è¡å¨åæ¾å¼æå id=2 è¿ä¸è¡ãid æ¯ä¸»é®ï¼å¼æç´æ¥ç¨æ æç´¢æ¾å°è¿ä¸è¡ãå¦æ id=2 è¿ä¸è¡æå¨çæ°æ®é¡µæ¬æ¥å°±å¨åå­ä¸­ï¼å°±ç´æ¥è¿åç»æ§è¡å¨ï¼å¦åï¼éè¦åä»ç£çè¯»å¥åå­ï¼ç¶ååè¿åã\n 2. æ§è¡å¨æ¿å°å¼æç»çè¡æ°æ®ï¼æè¿ä¸ªå¼å ä¸ 1ï¼æ¯å¦åæ¥æ¯ nï¼ç°å¨å°±æ¯ n+1ï¼å¾å°æ°çä¸è¡æ°æ®ï¼åè°ç¨å¼ææ¥å£åå¥è¿è¡æ°æ°æ®ã\n 3. å¼æå°è¿è¡æ°æ°æ®æ´æ°å°åå­ä¸­ï¼åæ¶å°è¿ä¸ªæ´æ°æä½è®°å½å° redo log éé¢ï¼æ­¤æ¶ redo log å¤äº prepare ç¶æãç¶ååç¥æ§è¡å¨æ§è¡å®æäºï¼éæ¶å¯ä»¥æäº¤äºå¡ã\n 4. æ§è¡å¨çæè¿ä¸ªæä½ç binlogï¼å¹¶æ binlog åå¥ç£çã\n 5. æ§è¡å¨è°ç¨å¼æçæäº¤äºå¡æ¥å£ï¼å¼ææåååå¥ç redo log æ¹ææäº¤ï¼commitï¼ç¶æï¼æ´æ°å®æã\n\nè¿éæç»åºè¿ä¸ª update è¯­å¥çæ§è¡æµç¨å¾ï¼å¾ä¸­æµè²æ¡è¡¨ç¤ºæ¯å¨ innodb åé¨æ§è¡çï¼æ·±è²æ¡è¡¨ç¤ºæ¯å¨æ§è¡å¨ä¸­æ§è¡çã\n\n\n\n\n# ä¸¤é¶æ®µæäº¤\n\nredo log çåå¥ææäºä¸¤ä¸ªæ­¥éª¤ï¼prepare å commitï¼è¿å°±æ¯"ä¸¤é¶æ®µæäº¤"ãä¸ºä»ä¹æ¥å¿éè¦âä¸¤é¶æ®µæäº¤âã\n\nç±äº redo log å binlog æ¯ä¸¤ä¸ªç¬ç«çé»è¾ï¼å¦æä¸ç¨ä¸¤é¶æ®µæäº¤ï¼è¦ä¹å°±æ¯ååå® redo log åå binlogï¼æèéç¨åè¿æ¥çé¡ºåºãæä»¬ççè¿ä¸¤ç§æ¹å¼ä¼æä»ä¹é®é¢ã\n\n * åå redo log åå binlogãåè®¾å¨ redo log åå®ï¼binlog è¿æ²¡æåå®çæ¶åï¼mysql è¿ç¨å¼å¸¸éå¯ãç±äºæä»¬åé¢è¯´è¿çï¼redo log åå®ä¹åï¼ç³»ç»å³ä½¿å´©æºï¼ä»ç¶è½å¤ææ°æ®æ¢å¤åæ¥ï¼æä»¥æ¢å¤åè¿ä¸è¡ c çå¼æ¯ 1ã ä½æ¯ç±äº binlog æ²¡åå®å°± crash äºï¼è¿æ¶å binlog éé¢å°±æ²¡æè®°å½è¿ä¸ªè¯­å¥ãå æ­¤ï¼ä¹åå¤ä»½æ¥å¿çæ¶åï¼å­èµ·æ¥ç binlog éé¢å°±æ²¡æè¿æ¡è¯­å¥ã ç¶åä½ ä¼åç°ï¼å¦æéè¦ç¨è¿ä¸ª binlog æ¥æ¢å¤ä¸´æ¶åºçè¯ï¼ç±äºè¿ä¸ªè¯­å¥ç binlog ä¸¢å¤±ï¼è¿ä¸ªä¸´æ¶åºå°±ä¼å°äºè¿ä¸æ¬¡æ´æ°ï¼æ¢å¤åºæ¥çè¿ä¸è¡ c çå¼å°±æ¯ 0ï¼ä¸ååºçå¼ä¸åã\n * åå binlog åå redo logãå¦æå¨ binlog åå®ä¹å crashï¼ç±äº redo log è¿æ²¡åï¼å´©æºæ¢å¤ä»¥åè¿ä¸ªäºå¡æ æï¼æä»¥è¿ä¸è¡ c çå¼æ¯ 0ãä½æ¯ binlog éé¢å·²ç»è®°å½äºâæ c ä» 0 æ¹æ 1âè¿ä¸ªæ¥å¿ãæä»¥ï¼å¨ä¹åç¨ binlog æ¥æ¢å¤çæ¶åå°±å¤äºä¸ä¸ªäºå¡åºæ¥ï¼æ¢å¤åºæ¥çè¿ä¸è¡ c çå¼å°±æ¯ 1ï¼ä¸ååºçå¼ä¸åã\n\nå¯ä»¥çå°ï¼å¦æä¸ä½¿ç¨âä¸¤é¶æ®µæäº¤âï¼é£ä¹æ°æ®åºçç¶æå°±æå¯è½åç¨å®çæ¥å¿æ¢å¤åºæ¥çåºçç¶æä¸ä¸è´ã\n\n\n# åèèµæ\n\n * ãé«æ§è½ mysqlã\n * mysql å®æ 45 è®²',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Mysql é",frontmatter:{title:"Mysql é",date:"2020-09-07T07:54:19.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql","é"],permalink:"/pages/f1f151/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/02.Mysql/04.Mysql%E9%94%81.html",relativePath:"12.æ°æ®åº/03.å³ç³»åæ°æ®åº/02.Mysql/04.Mysqlé.md",key:"v-41343aac",path:"/pages/f1f151/",headers:[{level:2,title:"æ²è§éåä¹è§é",slug:"æ²è§éåä¹è§é",normalizedTitle:"æ²è§éåä¹è§é",charIndex:16},{level:2,title:"è¡¨çº§éåè¡çº§é",slug:"è¡¨çº§éåè¡çº§é",normalizedTitle:"è¡¨çº§éåè¡çº§é",charIndex:605},{level:2,title:"è¯»åé",slug:"è¯»åé",normalizedTitle:"è¯»åé",charIndex:1023},{level:2,title:"æåé",slug:"æåé",normalizedTitle:"æåé",charIndex:1225},{level:2,title:"MVCC",slug:"mvcc",normalizedTitle:"mvcc",charIndex:2020},{level:3,title:"MVCC ææ³",slug:"mvcc-ææ³",normalizedTitle:"mvcc ææ³",charIndex:2301},{level:3,title:"çæ¬å·",slug:"çæ¬å·",normalizedTitle:"çæ¬å·",charIndex:2617},{level:3,title:"Undo æ¥å¿",slug:"undo-æ¥å¿",normalizedTitle:"undo æ¥å¿",charIndex:2840},{level:3,title:"ReadView",slug:"readview",normalizedTitle:"readview",charIndex:3340},{level:3,title:"å¿«ç§è¯»ä¸å½åè¯»",slug:"å¿«ç§è¯»ä¸å½åè¯»",normalizedTitle:"å¿«ç§è¯»ä¸å½åè¯»",charIndex:4206},{level:2,title:"è¡é",slug:"è¡é",normalizedTitle:"è¡é",charIndex:263},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:5549}],headersStr:"æ²è§éåä¹è§é è¡¨çº§éåè¡çº§é è¯»åé æåé MVCC MVCC ææ³ çæ¬å· Undo æ¥å¿ ReadView å¿«ç§è¯»ä¸å½åè¯» è¡é åèèµæ",content:'# Mysql é\n\n\n\n\n# æ²è§éåä¹è§é\n\nç¡®ä¿å¨å¤ä¸ªäºå¡åæ¶å­åæ°æ®åºä¸­åä¸æ°æ®æ¶ä¸ç ´åäºå¡çéç¦»æ§åç»ä¸æ§ä»¥åæ°æ®åºçç»ä¸æ§ï¼ä¹è§éåæ²è§éæ¯å¹¶åæ§å¶ä¸»è¦éç¨çææ¯ææ®µã\n\n * æ²è§é - åå®ä¼åçå¹¶åå²çªï¼å±è½ä¸åå¯è½è¿åæ°æ®å®æ´æ§çæä½\n   * å¨æ¥è¯¢å®æ°æ®çæ¶åå°±æäºå¡éèµ·æ¥ï¼ç´å°æäº¤äºå¡ï¼COMMITï¼\n   * å®ç°æ¹å¼ï¼ä½¿ç¨æ°æ®åºä¸­çéæºå¶ã\n * ä¹è§é - åè®¾ä¸ä¼åçå¹¶åå²çªï¼åªå¨æäº¤æä½æ¶æ£æ¥æ¯å¦è¿åæ°æ®å®æ´æ§ã\n   * å¨ä¿®æ¹æ°æ®çæ¶åæäºå¡éèµ·æ¥ï¼éè¿ version çæ¹å¼æ¥è¿è¡éå®\n   * å®ç°æ¹å¼ï¼ä½¿ç¨ version çæ¬æèæ¶é´æ³ã\n\nãç¤ºä¾ãä¹è§éç¤ºä¾\n\nåå goods è¡¨ä¸­æä¸ä¸ªå­æ®µ statusï¼status ä¸º 1 ä»£è¡¨ååæªè¢«ä¸åï¼status ä¸º 2 ä»£è¡¨ååå·²ç»è¢«ä¸åï¼é£ä¹æä»¬å¯¹æä¸ªååä¸åæ¶å¿é¡»ç¡®ä¿è¯¥åå status ä¸º 1ãåè®¾ååç id ä¸º 1ã\n\nselect (status,status,version) from t_goods where id=#{id}\n\nupdate t_goods\nset status=2,version=version+1\nwhere id=#{id} and version=#{version};\n\n\n> æ´è¯¦ç»çä¹è§éè¯´å¯ä»¥åèï¼ä½¿ç¨ mysql ä¹è§éè§£å³å¹¶åé®é¢\n\n\n# è¡¨çº§éåè¡çº§é\n\nä»æ°æ®åºçéç²åº¦æ¥çï¼MySQL ä¸­æä¾äºä¸¤ç§å°éç²åº¦ï¼è¡çº§éåè¡¨çº§éã\n\n * è¡¨çº§éï¼table lockï¼ - éå®æ´å¼ è¡¨ãç¨æ·å¯¹è¡¨è¿è¡åæä½åï¼éè¦åè·å¾åéï¼è¿ä¼é»å¡å¶ä»ç¨æ·å¯¹è¯¥è¡¨çææè¯»åæä½ãåªææ²¡æåéæ¶ï¼å¶ä»ç¨æ·æè½è·å¾è¯»éï¼è¯»éä¹é´ä¸ä¼ç¸äºé»å¡ã\n * è¡çº§éï¼row lockï¼ - éå®æå®çè¡è®°å½ãè¿æ ·å¶å®è¿ç¨è¿æ¯å¯ä»¥å¯¹åä¸ä¸ªè¡¨ä¸­çå¶å®è®°å½è¿è¡æä½ã\n\nåºè¯¥å°½éåªéå®éè¦ä¿®æ¹çé£é¨åæ°æ®ï¼èä¸æ¯ææçèµæºãéå®çæ°æ®éè¶å°ï¼éç«äºçåçé¢çå°±è¶å°ï¼ç³»ç»çå¹¶åç¨åº¦å°±è¶é«ãä½æ¯å ééè¦æ¶èèµæºï¼éçåç§æä½ï¼åæ¬è·åéãéæ¾éãä»¥åæ£æ¥éç¶æï¼é½ä¼å¢å ç³»ç»å¼éãå æ­¤éç²åº¦è¶å°ï¼ç³»ç»å¼éå°±è¶å¤§ã\n\nå¨éæ©éç²åº¦æ¶ï¼éè¦å¨éå¼éåå¹¶åç¨åº¦ä¹é´åä¸ä¸ªæè¡¡ã\n\nå¨ InnoDB ä¸­ï¼è¡éæ¯éè¿ç»ç´¢å¼ä¸çç´¢å¼é¡¹å éæ¥å®ç°çãå¦ææ²¡æç´¢å¼ï¼InnoDB å°ä¼éè¿éèçèç°ç´¢å¼æ¥å¯¹è®°å½å éã\n\n\n# è¯»åé\n\n * ç¬äº«éï¼Exclusiveï¼ï¼ç®åä¸º X éï¼åç§°åéãä½¿ç¨æ¹å¼ï¼SELECT ... FOR UPDATE;\n * å±äº«éï¼Sharedï¼ï¼ç®åä¸º S éï¼åç§°è¯»éãä½¿ç¨æ¹å¼ï¼SELECT ... LOCK IN SHARE MODE;\n\nåéåè¯»éçå³ç³»ï¼ç®è¨ä¹ï¼ç¬äº«éå­å¨ï¼å¶ä»äºå¡å°±ä¸è½åä»»ä½æä½ã\n\nInnoDB ä¸çè¡éãé´ééãnext-key éç»ç»å±äºç¬äº«éã\n\n\n# æåé\n\nå½å­å¨è¡¨çº§éåè¡çº§éçæåµä¸ï¼å¿é¡»åç³è¯·æåéï¼è¡¨çº§éï¼ä½ä¸æ¯ççå éï¼ï¼åè·åè¡çº§éãä½¿ç¨æåéï¼Intention Locksï¼å¯ä»¥æ´å®¹æå°æ¯æå¤ç²åº¦å°éã\n\næåéæ¯ InnoDB èªå¨å çï¼ä¸éè¦ç¨æ·å¹²é¢ã\n\nå¨å­å¨è¡çº§éåè¡¨çº§éçæåµä¸ï¼äºå¡ T æ³è¦å¯¹è¡¨ A å  X éï¼å°±éè¦åæ£æµæ¯å¦æå¶å®äºå¡å¯¹è¡¨ A æèè¡¨ A ä¸­çä»»æä¸è¡å äºéï¼é£ä¹å°±éè¦å¯¹è¡¨ A çæ¯ä¸è¡é½æ£æµä¸æ¬¡ï¼è¿æ¯éå¸¸èæ¶çã\n\næåéè§å®ï¼\n\n * IX/IS æ¯è¡¨éï¼\n * X/S æ¯è¡éã\n * ä¸ä¸ªäºå¡å¨è·å¾æä¸ªæ°æ®è¡ç S éä¹åï¼å¿é¡»åè·å¾è¡¨ç IS éæèæ´å¼ºçéï¼\n * ä¸ä¸ªäºå¡å¨è·å¾æä¸ªæ°æ®è¡ç X éä¹åï¼å¿é¡»åè·å¾è¡¨ç IX éã\n\néè¿å¼å¥æåéï¼äºå¡ T æ³è¦å¯¹è¡¨ A å  X éï¼åªéè¦åæ£æµæ¯å¦æå¶å®äºå¡å¯¹è¡¨ A å äº X/IX/S/IS éï¼å¦æå äºå°±è¡¨ç¤ºæå¶å®äºå¡æ­£å¨ä½¿ç¨è¿ä¸ªè¡¨æèè¡¨ä¸­æä¸è¡çéï¼å æ­¤äºå¡ T å  X éå¤±è´¥ã\n\nåç§éçå¼å®¹å³ç³»å¦ä¸ï¼\n\n-    X   IX   S    IS\nX    â   â    â    â\nIX   â   âï¸   â    âï¸\nS    â   â    âï¸   âï¸\nIS   â   âï¸   âï¸   âï¸\n\nè§£éå¦ä¸ï¼\n\n * ä»»æ IS/IX éä¹é´é½æ¯å¼å®¹çï¼å ä¸ºå®ä»¬åªè¡¨ç¤ºæ³è¦å¯¹è¡¨å éï¼èä¸æ¯çæ­£å éï¼\n * è¿éå¼å®¹å³ç³»éå¯¹çæ¯è¡¨çº§éï¼èè¡¨çº§ç IX éåè¡çº§ç X éå¼å®¹ï¼ä¸¤ä¸ªäºå¡å¯ä»¥å¯¹ä¸¤ä¸ªæ°æ®è¡å  X éãï¼äºå¡ T1 æ³è¦å¯¹æ°æ®è¡ R1 å  X éï¼äºå¡ T2 æ³è¦å¯¹åä¸ä¸ªè¡¨çæ°æ®è¡ R2 å  X éï¼ä¸¤ä¸ªäºå¡é½éè¦å¯¹è¯¥è¡¨å  IX éï¼ä½æ¯ IX éæ¯å¼å®¹çï¼å¹¶ä¸ IX éä¸è¡çº§ç X éä¹æ¯å¼å®¹çï¼å æ­¤ä¸¤ä¸ªäºå¡é½è½å éæåï¼å¯¹åä¸ä¸ªè¡¨ä¸­çä¸¤ä¸ªæ°æ®è¡åä¿®æ¹ãï¼\n\n\n# MVCC\n\nå¤çæ¬å¹¶åæ§å¶ï¼Multi-Version Concurrency Control, MVCCï¼å¯ä»¥è§ä¸ºè¡çº§éçä¸ä¸ªåç§ãå®å¨å¾å¤æåµä¸é½é¿åäºå éæä½ï¼å æ­¤å¼éæ´ä½ãä¸ä»æ¯ Mysqlï¼åæ¬ OracleãPostgreSQL ç­å¶ä»æ°æ®åºé½å®ç°äºåèªç MVCCï¼å®ç°æºå¶æ²¡æç»ä¸æ åã\n\nMVCC æ¯ InnoDB å­å¨å¼æå®ç°éç¦»çº§å«çä¸ç§å·ä½æ¹å¼ï¼ç¨äºå®ç°æäº¤è¯»åå¯éå¤è¯»è¿ä¸¤ç§éç¦»çº§å«ãèæªæäº¤è¯»éç¦»çº§å«æ»æ¯è¯»åææ°çæ°æ®è¡ï¼è¦æ±å¾ä½ï¼æ éä½¿ç¨ MVCCãå¯ä¸²è¡åéç¦»çº§å«éè¦å¯¹ææè¯»åçè¡é½å éï¼åçº¯ä½¿ç¨ MVCC æ æ³å®ç°ã\n\n\n# MVCC ææ³\n\nå éè½è§£å³å¤ä¸ªäºå¡åæ¶æ§è¡æ¶åºç°çå¹¶åä¸è´æ§é®é¢ãå¨å®éåºæ¯ä¸­è¯»æä½å¾å¾å¤äºåæä½ï¼å æ­¤åå¼å¥äºè¯»åéæ¥é¿åä¸å¿è¦çå éæä½ï¼ä¾å¦è¯»åè¯»æ²¡æäºæ¥å³ç³»ãè¯»åéä¸­è¯»ååæä½ä»ç¶æ¯äºæ¥çã\n\nMVCC çææ³æ¯ï¼\n\n * ä¿å­æ°æ®å¨æä¸ªæ¶é´ç¹çå¿«ç§ï¼åæä½ï¼DELETEãINSERTãUPDATEï¼æ´æ°ææ°ççæ¬å¿«ç§ï¼èè¯»æä½å»è¯»æ§çæ¬å¿«ç§ï¼æ²¡æäºæ¥å³ç³»ãè¿ä¸ç¹å CopyOnWrite ç±»ä¼¼ã\n * èè¯»åä¸å¯éå¤è¯»ææ ¹æ¬çåå æ¯äºå¡è¯»åå°å¶å®äºå¡æªæäº¤çä¿®æ¹ãå¨äºå¡è¿è¡è¯»åæä½æ¶ï¼ä¸ºäºè§£å³èè¯»åä¸å¯éå¤è¯»é®é¢ï¼MVCC è§å®åªè½è¯»åå·²ç»æäº¤çå¿«ç§ãå½ç¶ä¸ä¸ªäºå¡å¯ä»¥è¯»åèªèº«æªæäº¤çå¿«ç§ï¼è¿ä¸ç®æ¯èè¯»ã\n\n\n# çæ¬å·\n\nInnoDB ç MVCC å®ç°æ¯ï¼å¨æ¯è¡è®°å½åé¢ä¿å­ä¸¤ä¸ªéèåï¼ä¸ä¸ªåä¿å­è¡çåå»ºæ¶é´ï¼å¦ä¸ä¸ªåä¿å­è¡çè¿ææ¶é´ï¼è¿éçæ¶é´æ¯æç³»ç»çæ¬å·ï¼ãæ¯å¼å§ä¸ä¸ªæ°äºå¡ï¼ç³»ç»çæ¬å·ä¼èªå¨éå¢ï¼äºå¡å¼å§æ¶å»çç³»ç»çæ¬å·ä¼ä½ä¸ºäºå¡ççæ¬å·ï¼ç¨æ¥åæ¥è¯¢å°çæ¯è¡è®°å½ççæ¬å·è¿è¡æ¯è¾ã\n\n * ç³»ç»çæ¬å· SYS_IDï¼æ¯ä¸ä¸ªéå¢çæ°å­ï¼æ¯å¼å§ä¸ä¸ªæ°çäºå¡ï¼ç³»ç»çæ¬å·å°±ä¼èªå¨éå¢ã\n * äºå¡çæ¬å· TRX_ID ï¼äºå¡å¼å§æ¶çç³»ç»çæ¬å·ã\n\n\n# Undo æ¥å¿\n\nMVCC çå¤çæ¬æçæ¯å¤ä¸ªçæ¬çå¿«ç§ï¼å¿«ç§å­å¨å¨ Undo æ¥å¿ä¸­ï¼è¯¥æ¥å¿éè¿åæ»æé ROLL_PTR æä¸ä¸ªæ°æ®è¡çææå¿«ç§è¿æ¥èµ·æ¥ã\n\nä¾å¦å¨ MySQL åå»ºä¸ä¸ªè¡¨ tï¼åå«ä¸»é® id åä¸ä¸ªå­æ®µ xãæä»¬åæå¥ä¸ä¸ªæ°æ®è¡ï¼ç¶åå¯¹è¯¥æ°æ®è¡æ§è¡ä¸¤æ¬¡æ´æ°æä½ã\n\nINSERT INTO t(id, x) VALUES(1, "a");\nUPDATE t SET x="b" WHERE id=1;\nUPDATE t SET x="c" WHERE id=1;\n\n\nå ä¸ºæ²¡æä½¿ç¨ START TRANSACTION å°ä¸é¢çæä½å½æä¸ä¸ªäºå¡æ¥æ§è¡ï¼æ ¹æ® MySQL ç AUTOCOMMIT æºå¶ï¼æ¯ä¸ªæä½é½ä¼è¢«å½æä¸ä¸ªäºå¡æ¥æ§è¡ï¼æä»¥ä¸é¢çæä½æ»å±æ¶åå°ä¸ä¸ªäºå¡ãå¿«ç§ä¸­é¤äºè®°å½äºå¡çæ¬å· TRX_ID åæä½ä¹å¤ï¼è¿è®°å½äºä¸ä¸ª bit ç DEL å­æ®µï¼ç¨äºæ è®°æ¯å¦è¢«å é¤ã\n\nINSERTãUPDATEãDELETE æä½ä¼åå»ºä¸ä¸ªæ¥å¿ï¼å¹¶å°äºå¡çæ¬å· TRX_ID åå¥ãDELETE å¯ä»¥çææ¯ä¸ä¸ªç¹æ®ç UPDATEï¼è¿ä¼é¢å¤å° DEL å­æ®µè®¾ç½®ä¸º 1ã\n\n\n# ReadView\n\nMVCC ç»´æ¤äºä¸ä¸ªä¸è´æ§è¯»è§å¾ consistent read view ï¼ä¸»è¦åå«äºå½åç³»ç»æªæäº¤çäºå¡åè¡¨ TRX_IDs {TRX_ID_1, TRX_ID_2, ...}ï¼è¿æè¯¥åè¡¨çæå°å¼ TRX_ID_MIN å TRX_ID_MAXã\n\n\n\nè¿æ ·ï¼å¯¹äºå½åäºå¡çå¯å¨ç¬é´æ¥è¯´ï¼ä¸ä¸ªæ°æ®çæ¬ç row trx_idï¼æä»¥ä¸å ç§å¯è½ï¼\n\n 1. å¦æè½å¨ç»¿è²é¨åï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯å·²æäº¤çäºå¡æèæ¯å½åäºå¡èªå·±çæçï¼è¿ä¸ªæ°æ®æ¯å¯è§çï¼\n 2. å¦æè½å¨çº¢è²é¨åï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯ç±å°æ¥å¯å¨çäºå¡çæçï¼æ¯è¯å®ä¸å¯è§çï¼\n 3. å¦æè½å¨é»è²é¨åï¼é£å°±åæ¬ä¸¤ç§æåµ a. è¥ row trx_id å¨æ°ç»ä¸­ï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯ç±è¿æ²¡æäº¤çäºå¡çæçï¼ä¸å¯è§ï¼ b. è¥ row trx_id ä¸å¨æ°ç»ä¸­ï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯å·²ç»æäº¤äºçäºå¡çæçï¼å¯è§ã\n\nå¨è¿è¡ SELECT æä½æ¶ï¼æ ¹æ®æ°æ®è¡å¿«ç§ç TRX_ID ä¸ TRX_ID_MIN å TRX_ID_MAX ä¹é´çå³ç³»ï¼ä»èå¤æ­æ°æ®è¡å¿«ç§æ¯å¦å¯ä»¥ä½¿ç¨ï¼\n\n * TRX_ID < TRX_ID_MINï¼è¡¨ç¤ºè¯¥æ°æ®è¡å¿«ç§æ¶å¨å½åæææªæäº¤äºå¡ä¹åè¿è¡æ´æ¹çï¼å æ­¤å¯ä»¥ä½¿ç¨ã\n * TRX_ID > TRX_ID_MAXï¼è¡¨ç¤ºè¯¥æ°æ®è¡å¿«ç§æ¯å¨äºå¡å¯å¨ä¹åè¢«æ´æ¹çï¼å æ­¤ä¸å¯ä½¿ç¨ã\n * TRX_ID_MIN <= TRX_ID <= TRX_ID_MAXï¼éè¦æ ¹æ®éç¦»çº§å«åè¿è¡å¤æ­ï¼\n   * æäº¤è¯»ï¼å¦æ TRX_ID å¨ TRX_IDs åè¡¨ä¸­ï¼è¡¨ç¤ºè¯¥æ°æ®è¡å¿«ç§å¯¹åºçäºå¡è¿æªæäº¤ï¼åè¯¥å¿«ç§ä¸å¯ä½¿ç¨ãå¦åè¡¨ç¤ºå·²ç»æäº¤ï¼å¯ä»¥ä½¿ç¨ã\n   * å¯éå¤è¯»ï¼é½ä¸å¯ä»¥ä½¿ç¨ãå ä¸ºå¦æå¯ä»¥ä½¿ç¨çè¯ï¼é£ä¹å¶å®äºå¡ä¹å¯ä»¥è¯»å°è¿ä¸ªæ°æ®è¡å¿«ç§å¹¶è¿è¡ä¿®æ¹ï¼é£ä¹å½åäºå¡åå»è¯»è¿ä¸ªæ°æ®è¡å¾å°çå¼å°±ä¼åçæ¹åï¼ä¹å°±æ¯åºç°äºä¸å¯éå¤è¯»é®é¢ã\n\nå¨æ°æ®è¡å¿«ç§ä¸å¯ä½¿ç¨çæåµä¸ï¼éè¦æ²¿ç Undo Log çåæ»æé ROLL_PTR æ¾å°ä¸ä¸ä¸ªå¿«ç§ï¼åè¿è¡ä¸é¢çå¤æ­ã\n\n\n# å¿«ç§è¯»ä¸å½åè¯»\n\nå¿«ç§è¯»\n\nMVCC ç SELECT æä½æ¯å¿«ç§ä¸­çæ°æ®ï¼ä¸éè¦è¿è¡å éæä½ã\n\nSELECT * FROM table ...;\n\n\nå½åè¯»\n\nMVCC å¶å®ä¼å¯¹æ°æ®åºè¿è¡ä¿®æ¹çæä½ï¼INSERTãUPDATEãDELETEï¼éè¦è¿è¡å éæä½ï¼ä»èè¯»åææ°çæ°æ®ãå¯ä»¥çå° MVCC å¹¶ä¸æ¯å®å¨ä¸ç¨å éï¼èåªæ¯é¿åäº SELECT çå éæä½ã\n\nINSERT;\nUPDATE;\nDELETE;\n\n\nå¨è¿è¡ SELECT æä½æ¶ï¼å¯ä»¥å¼ºå¶æå®è¿è¡å éæä½ãä»¥ä¸ç¬¬ä¸ä¸ªè¯­å¥éè¦å  S éï¼ç¬¬äºä¸ªéè¦å  X éã\n\nSELECT * FROM table WHERE ? lock in share mode;\nSELECT * FROM table WHERE ? for update;\n\n\n\n# è¡é\n\nè¡éçå·ä½å®ç°ç®æ³æä¸ç§ï¼record lockãgap lock ä»¥å next-key lockã\n\n * Record Lock - è¡éå¯¹ç´¢å¼é¡¹å éï¼è¥æ²¡æç´¢å¼åä½¿ç¨è¡¨éã\n * Gap Lock - å¯¹ç´¢å¼é¡¹ä¹é´çé´éå éãéå®ç´¢å¼ä¹é´çé´éï¼ä½æ¯ä¸åå«ç´¢å¼æ¬èº«ãä¾å¦å½ä¸ä¸ªäºå¡æ§è¡ä»¥ä¸è¯­å¥ï¼å¶å®äºå¡å°±ä¸è½å¨ t.c ä¸­æå¥ 15ï¼SELECT c FROM t WHERE c BETWEEN 10 and 20 FOR UPDATE;ãå¨ MySQL ä¸­ï¼gap lock é»è®¤æ¯å¼å¯çï¼å³ innodb_locks_unsafe_for_binlog åæ°å¼æ¯ disable çï¼ä¸ MySQL ä¸­é»è®¤çæ¯ RR äºå¡éç¦»çº§å«ã\n * Next-key lock -å®æ¯ Record Lock å Gap Lock çç»åï¼ä¸ä»éå®ä¸ä¸ªè®°å½ä¸çç´¢å¼ï¼ä¹éå®ç´¢å¼ä¹é´çé´éãå®éå®ä¸ä¸ªåå¼åé­åºé´ã\n\nåªå¨å¯éå¤è¯»æä»¥ä¸éç¦»çº§å«ä¸çç¹å®æä½æä¼åå¾ gap lock æ next-key lockãå¨ SelectãUpdate å Delete æ¶ï¼é¤äºåºäºå¯ä¸ç´¢å¼çæ¥è¯¢ä¹å¤ï¼å¶å®ç´¢å¼æ¥è¯¢æ¶é½ä¼è·å gap lock æ next-key lockï¼å³éä½å¶æ«æçèå´ãä¸»é®ç´¢å¼ä¹å±äºå¯ä¸ç´¢å¼ï¼æä»¥ä¸»é®ç´¢å¼æ¯ä¸ä¼ä½¿ç¨ gap lock æ next-key lockã\n\nMVCC ä¸è½è§£å³å¹»è¯»é®é¢ï¼Next-Key éå°±æ¯ä¸ºäºè§£å³å¹»è¯»é®é¢ãå¨å¯éå¤è¯»ï¼REPEATABLE READï¼éç¦»çº§å«ä¸ï¼ä½¿ç¨ MVCC + Next-Key é å¯ä»¥è§£å³å¹»è¯»é®é¢ã\n\nç´¢å¼åä¸ºä¸»é®ç´¢å¼åéä¸»é®ç´¢å¼ä¸¤ç§ï¼å¦æä¸æ¡ SQL è¯­å¥æä½äºä¸»é®ç´¢å¼ï¼MySQL å°±ä¼éå®è¿æ¡ä¸»é®ç´¢å¼ï¼å¦æä¸æ¡è¯­å¥æä½äºéä¸»é®ç´¢å¼ï¼MySQL ä¼åéå®è¯¥éä¸»é®ç´¢å¼ï¼åéå®ç¸å³çä¸»é®ç´¢å¼ãå¨ UPDATEãDELETE æä½æ¶ï¼MySQL ä¸ä»éå® WHERE æ¡ä»¶æ«æè¿çææç´¢å¼è®°å½ï¼èä¸ä¼éå®ç¸é»çé®å¼ï¼å³æè°ç next-key lockã\n\nå½ä¸¤ä¸ªäºå¡åæ¶æ§è¡ï¼ä¸ä¸ªéä½äºä¸»é®ç´¢å¼ï¼å¨ç­å¾å¶ä»ç¸å³ç´¢å¼ãå¦ä¸ä¸ªéå®äºéä¸»é®ç´¢å¼ï¼å¨ç­å¾ä¸»é®ç´¢å¼ãè¿æ ·å°±ä¼åçæ­»éãåçæ­»éåï¼InnoDB ä¸è¬é½å¯ä»¥æ£æµå°ï¼å¹¶ä½¿ä¸ä¸ªäºå¡éæ¾éåéï¼å¦ä¸ä¸ªè·åéå®æäºå¡ã\n\n\n# åèèµæ\n\n * ãé«æ§è½ MySQLã\n * ãJava æ§è½è°ä¼å®æã\n * æ°æ®åºç³»ç»åç\n * æ°æ®åºä¸¤å¤§ç¥å¨ãç´¢å¼åéã\n * ä½¿ç¨ mysql ä¹è§éè§£å³å¹¶åé®é¢',normalizedContent:'# mysql é\n\n\n\n\n# æ²è§éåä¹è§é\n\nç¡®ä¿å¨å¤ä¸ªäºå¡åæ¶å­åæ°æ®åºä¸­åä¸æ°æ®æ¶ä¸ç ´åäºå¡çéç¦»æ§åç»ä¸æ§ä»¥åæ°æ®åºçç»ä¸æ§ï¼ä¹è§éåæ²è§éæ¯å¹¶åæ§å¶ä¸»è¦éç¨çææ¯ææ®µã\n\n * æ²è§é - åå®ä¼åçå¹¶åå²çªï¼å±è½ä¸åå¯è½è¿åæ°æ®å®æ´æ§çæä½\n   * å¨æ¥è¯¢å®æ°æ®çæ¶åå°±æäºå¡éèµ·æ¥ï¼ç´å°æäº¤äºå¡ï¼commitï¼\n   * å®ç°æ¹å¼ï¼ä½¿ç¨æ°æ®åºä¸­çéæºå¶ã\n * ä¹è§é - åè®¾ä¸ä¼åçå¹¶åå²çªï¼åªå¨æäº¤æä½æ¶æ£æ¥æ¯å¦è¿åæ°æ®å®æ´æ§ã\n   * å¨ä¿®æ¹æ°æ®çæ¶åæäºå¡éèµ·æ¥ï¼éè¿ version çæ¹å¼æ¥è¿è¡éå®\n   * å®ç°æ¹å¼ï¼ä½¿ç¨ version çæ¬æèæ¶é´æ³ã\n\nãç¤ºä¾ãä¹è§éç¤ºä¾\n\nåå goods è¡¨ä¸­æä¸ä¸ªå­æ®µ statusï¼status ä¸º 1 ä»£è¡¨ååæªè¢«ä¸åï¼status ä¸º 2 ä»£è¡¨ååå·²ç»è¢«ä¸åï¼é£ä¹æä»¬å¯¹æä¸ªååä¸åæ¶å¿é¡»ç¡®ä¿è¯¥åå status ä¸º 1ãåè®¾ååç id ä¸º 1ã\n\nselect (status,status,version) from t_goods where id=#{id}\n\nupdate t_goods\nset status=2,version=version+1\nwhere id=#{id} and version=#{version};\n\n\n> æ´è¯¦ç»çä¹è§éè¯´å¯ä»¥åèï¼ä½¿ç¨ mysql ä¹è§éè§£å³å¹¶åé®é¢\n\n\n# è¡¨çº§éåè¡çº§é\n\nä»æ°æ®åºçéç²åº¦æ¥çï¼mysql ä¸­æä¾äºä¸¤ç§å°éç²åº¦ï¼è¡çº§éåè¡¨çº§éã\n\n * è¡¨çº§éï¼table lockï¼ - éå®æ´å¼ è¡¨ãç¨æ·å¯¹è¡¨è¿è¡åæä½åï¼éè¦åè·å¾åéï¼è¿ä¼é»å¡å¶ä»ç¨æ·å¯¹è¯¥è¡¨çææè¯»åæä½ãåªææ²¡æåéæ¶ï¼å¶ä»ç¨æ·æè½è·å¾è¯»éï¼è¯»éä¹é´ä¸ä¼ç¸äºé»å¡ã\n * è¡çº§éï¼row lockï¼ - éå®æå®çè¡è®°å½ãè¿æ ·å¶å®è¿ç¨è¿æ¯å¯ä»¥å¯¹åä¸ä¸ªè¡¨ä¸­çå¶å®è®°å½è¿è¡æä½ã\n\nåºè¯¥å°½éåªéå®éè¦ä¿®æ¹çé£é¨åæ°æ®ï¼èä¸æ¯ææçèµæºãéå®çæ°æ®éè¶å°ï¼éç«äºçåçé¢çå°±è¶å°ï¼ç³»ç»çå¹¶åç¨åº¦å°±è¶é«ãä½æ¯å ééè¦æ¶èèµæºï¼éçåç§æä½ï¼åæ¬è·åéãéæ¾éãä»¥åæ£æ¥éç¶æï¼é½ä¼å¢å ç³»ç»å¼éãå æ­¤éç²åº¦è¶å°ï¼ç³»ç»å¼éå°±è¶å¤§ã\n\nå¨éæ©éç²åº¦æ¶ï¼éè¦å¨éå¼éåå¹¶åç¨åº¦ä¹é´åä¸ä¸ªæè¡¡ã\n\nå¨ innodb ä¸­ï¼è¡éæ¯éè¿ç»ç´¢å¼ä¸çç´¢å¼é¡¹å éæ¥å®ç°çãå¦ææ²¡æç´¢å¼ï¼innodb å°ä¼éè¿éèçèç°ç´¢å¼æ¥å¯¹è®°å½å éã\n\n\n# è¯»åé\n\n * ç¬äº«éï¼exclusiveï¼ï¼ç®åä¸º x éï¼åç§°åéãä½¿ç¨æ¹å¼ï¼select ... for update;\n * å±äº«éï¼sharedï¼ï¼ç®åä¸º s éï¼åç§°è¯»éãä½¿ç¨æ¹å¼ï¼select ... lock in share mode;\n\nåéåè¯»éçå³ç³»ï¼ç®è¨ä¹ï¼ç¬äº«éå­å¨ï¼å¶ä»äºå¡å°±ä¸è½åä»»ä½æä½ã\n\ninnodb ä¸çè¡éãé´ééãnext-key éç»ç»å±äºç¬äº«éã\n\n\n# æåé\n\nå½å­å¨è¡¨çº§éåè¡çº§éçæåµä¸ï¼å¿é¡»åç³è¯·æåéï¼è¡¨çº§éï¼ä½ä¸æ¯ççå éï¼ï¼åè·åè¡çº§éãä½¿ç¨æåéï¼intention locksï¼å¯ä»¥æ´å®¹æå°æ¯æå¤ç²åº¦å°éã\n\næåéæ¯ innodb èªå¨å çï¼ä¸éè¦ç¨æ·å¹²é¢ã\n\nå¨å­å¨è¡çº§éåè¡¨çº§éçæåµä¸ï¼äºå¡ t æ³è¦å¯¹è¡¨ a å  x éï¼å°±éè¦åæ£æµæ¯å¦æå¶å®äºå¡å¯¹è¡¨ a æèè¡¨ a ä¸­çä»»æä¸è¡å äºéï¼é£ä¹å°±éè¦å¯¹è¡¨ a çæ¯ä¸è¡é½æ£æµä¸æ¬¡ï¼è¿æ¯éå¸¸èæ¶çã\n\næåéè§å®ï¼\n\n * ix/is æ¯è¡¨éï¼\n * x/s æ¯è¡éã\n * ä¸ä¸ªäºå¡å¨è·å¾æä¸ªæ°æ®è¡ç s éä¹åï¼å¿é¡»åè·å¾è¡¨ç is éæèæ´å¼ºçéï¼\n * ä¸ä¸ªäºå¡å¨è·å¾æä¸ªæ°æ®è¡ç x éä¹åï¼å¿é¡»åè·å¾è¡¨ç ix éã\n\néè¿å¼å¥æåéï¼äºå¡ t æ³è¦å¯¹è¡¨ a å  x éï¼åªéè¦åæ£æµæ¯å¦æå¶å®äºå¡å¯¹è¡¨ a å äº x/ix/s/is éï¼å¦æå äºå°±è¡¨ç¤ºæå¶å®äºå¡æ­£å¨ä½¿ç¨è¿ä¸ªè¡¨æèè¡¨ä¸­æä¸è¡çéï¼å æ­¤äºå¡ t å  x éå¤±è´¥ã\n\nåç§éçå¼å®¹å³ç³»å¦ä¸ï¼\n\n-    x   ix   s    is\nx    â   â    â    â\nix   â   âï¸   â    âï¸\ns    â   â    âï¸   âï¸\nis   â   âï¸   âï¸   âï¸\n\nè§£éå¦ä¸ï¼\n\n * ä»»æ is/ix éä¹é´é½æ¯å¼å®¹çï¼å ä¸ºå®ä»¬åªè¡¨ç¤ºæ³è¦å¯¹è¡¨å éï¼èä¸æ¯çæ­£å éï¼\n * è¿éå¼å®¹å³ç³»éå¯¹çæ¯è¡¨çº§éï¼èè¡¨çº§ç ix éåè¡çº§ç x éå¼å®¹ï¼ä¸¤ä¸ªäºå¡å¯ä»¥å¯¹ä¸¤ä¸ªæ°æ®è¡å  x éãï¼äºå¡ t1 æ³è¦å¯¹æ°æ®è¡ r1 å  x éï¼äºå¡ t2 æ³è¦å¯¹åä¸ä¸ªè¡¨çæ°æ®è¡ r2 å  x éï¼ä¸¤ä¸ªäºå¡é½éè¦å¯¹è¯¥è¡¨å  ix éï¼ä½æ¯ ix éæ¯å¼å®¹çï¼å¹¶ä¸ ix éä¸è¡çº§ç x éä¹æ¯å¼å®¹çï¼å æ­¤ä¸¤ä¸ªäºå¡é½è½å éæåï¼å¯¹åä¸ä¸ªè¡¨ä¸­çä¸¤ä¸ªæ°æ®è¡åä¿®æ¹ãï¼\n\n\n# mvcc\n\nå¤çæ¬å¹¶åæ§å¶ï¼multi-version concurrency control, mvccï¼å¯ä»¥è§ä¸ºè¡çº§éçä¸ä¸ªåç§ãå®å¨å¾å¤æåµä¸é½é¿åäºå éæä½ï¼å æ­¤å¼éæ´ä½ãä¸ä»æ¯ mysqlï¼åæ¬ oracleãpostgresql ç­å¶ä»æ°æ®åºé½å®ç°äºåèªç mvccï¼å®ç°æºå¶æ²¡æç»ä¸æ åã\n\nmvcc æ¯ innodb å­å¨å¼æå®ç°éç¦»çº§å«çä¸ç§å·ä½æ¹å¼ï¼ç¨äºå®ç°æäº¤è¯»åå¯éå¤è¯»è¿ä¸¤ç§éç¦»çº§å«ãèæªæäº¤è¯»éç¦»çº§å«æ»æ¯è¯»åææ°çæ°æ®è¡ï¼è¦æ±å¾ä½ï¼æ éä½¿ç¨ mvccãå¯ä¸²è¡åéç¦»çº§å«éè¦å¯¹ææè¯»åçè¡é½å éï¼åçº¯ä½¿ç¨ mvcc æ æ³å®ç°ã\n\n\n# mvcc ææ³\n\nå éè½è§£å³å¤ä¸ªäºå¡åæ¶æ§è¡æ¶åºç°çå¹¶åä¸è´æ§é®é¢ãå¨å®éåºæ¯ä¸­è¯»æä½å¾å¾å¤äºåæä½ï¼å æ­¤åå¼å¥äºè¯»åéæ¥é¿åä¸å¿è¦çå éæä½ï¼ä¾å¦è¯»åè¯»æ²¡æäºæ¥å³ç³»ãè¯»åéä¸­è¯»ååæä½ä»ç¶æ¯äºæ¥çã\n\nmvcc çææ³æ¯ï¼\n\n * ä¿å­æ°æ®å¨æä¸ªæ¶é´ç¹çå¿«ç§ï¼åæä½ï¼deleteãinsertãupdateï¼æ´æ°ææ°ççæ¬å¿«ç§ï¼èè¯»æä½å»è¯»æ§çæ¬å¿«ç§ï¼æ²¡æäºæ¥å³ç³»ãè¿ä¸ç¹å copyonwrite ç±»ä¼¼ã\n * èè¯»åä¸å¯éå¤è¯»ææ ¹æ¬çåå æ¯äºå¡è¯»åå°å¶å®äºå¡æªæäº¤çä¿®æ¹ãå¨äºå¡è¿è¡è¯»åæä½æ¶ï¼ä¸ºäºè§£å³èè¯»åä¸å¯éå¤è¯»é®é¢ï¼mvcc è§å®åªè½è¯»åå·²ç»æäº¤çå¿«ç§ãå½ç¶ä¸ä¸ªäºå¡å¯ä»¥è¯»åèªèº«æªæäº¤çå¿«ç§ï¼è¿ä¸ç®æ¯èè¯»ã\n\n\n# çæ¬å·\n\ninnodb ç mvcc å®ç°æ¯ï¼å¨æ¯è¡è®°å½åé¢ä¿å­ä¸¤ä¸ªéèåï¼ä¸ä¸ªåä¿å­è¡çåå»ºæ¶é´ï¼å¦ä¸ä¸ªåä¿å­è¡çè¿ææ¶é´ï¼è¿éçæ¶é´æ¯æç³»ç»çæ¬å·ï¼ãæ¯å¼å§ä¸ä¸ªæ°äºå¡ï¼ç³»ç»çæ¬å·ä¼èªå¨éå¢ï¼äºå¡å¼å§æ¶å»çç³»ç»çæ¬å·ä¼ä½ä¸ºäºå¡ççæ¬å·ï¼ç¨æ¥åæ¥è¯¢å°çæ¯è¡è®°å½ççæ¬å·è¿è¡æ¯è¾ã\n\n * ç³»ç»çæ¬å· sys_idï¼æ¯ä¸ä¸ªéå¢çæ°å­ï¼æ¯å¼å§ä¸ä¸ªæ°çäºå¡ï¼ç³»ç»çæ¬å·å°±ä¼èªå¨éå¢ã\n * äºå¡çæ¬å· trx_id ï¼äºå¡å¼å§æ¶çç³»ç»çæ¬å·ã\n\n\n# undo æ¥å¿\n\nmvcc çå¤çæ¬æçæ¯å¤ä¸ªçæ¬çå¿«ç§ï¼å¿«ç§å­å¨å¨ undo æ¥å¿ä¸­ï¼è¯¥æ¥å¿éè¿åæ»æé roll_ptr æä¸ä¸ªæ°æ®è¡çææå¿«ç§è¿æ¥èµ·æ¥ã\n\nä¾å¦å¨ mysql åå»ºä¸ä¸ªè¡¨ tï¼åå«ä¸»é® id åä¸ä¸ªå­æ®µ xãæä»¬åæå¥ä¸ä¸ªæ°æ®è¡ï¼ç¶åå¯¹è¯¥æ°æ®è¡æ§è¡ä¸¤æ¬¡æ´æ°æä½ã\n\ninsert into t(id, x) values(1, "a");\nupdate t set x="b" where id=1;\nupdate t set x="c" where id=1;\n\n\nå ä¸ºæ²¡æä½¿ç¨ start transaction å°ä¸é¢çæä½å½æä¸ä¸ªäºå¡æ¥æ§è¡ï¼æ ¹æ® mysql ç autocommit æºå¶ï¼æ¯ä¸ªæä½é½ä¼è¢«å½æä¸ä¸ªäºå¡æ¥æ§è¡ï¼æä»¥ä¸é¢çæä½æ»å±æ¶åå°ä¸ä¸ªäºå¡ãå¿«ç§ä¸­é¤äºè®°å½äºå¡çæ¬å· trx_id åæä½ä¹å¤ï¼è¿è®°å½äºä¸ä¸ª bit ç del å­æ®µï¼ç¨äºæ è®°æ¯å¦è¢«å é¤ã\n\ninsertãupdateãdelete æä½ä¼åå»ºä¸ä¸ªæ¥å¿ï¼å¹¶å°äºå¡çæ¬å· trx_id åå¥ãdelete å¯ä»¥çææ¯ä¸ä¸ªç¹æ®ç updateï¼è¿ä¼é¢å¤å° del å­æ®µè®¾ç½®ä¸º 1ã\n\n\n# readview\n\nmvcc ç»´æ¤äºä¸ä¸ªä¸è´æ§è¯»è§å¾ consistent read view ï¼ä¸»è¦åå«äºå½åç³»ç»æªæäº¤çäºå¡åè¡¨ trx_ids {trx_id_1, trx_id_2, ...}ï¼è¿æè¯¥åè¡¨çæå°å¼ trx_id_min å trx_id_maxã\n\n\n\nè¿æ ·ï¼å¯¹äºå½åäºå¡çå¯å¨ç¬é´æ¥è¯´ï¼ä¸ä¸ªæ°æ®çæ¬ç row trx_idï¼æä»¥ä¸å ç§å¯è½ï¼\n\n 1. å¦æè½å¨ç»¿è²é¨åï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯å·²æäº¤çäºå¡æèæ¯å½åäºå¡èªå·±çæçï¼è¿ä¸ªæ°æ®æ¯å¯è§çï¼\n 2. å¦æè½å¨çº¢è²é¨åï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯ç±å°æ¥å¯å¨çäºå¡çæçï¼æ¯è¯å®ä¸å¯è§çï¼\n 3. å¦æè½å¨é»è²é¨åï¼é£å°±åæ¬ä¸¤ç§æåµ a. è¥ row trx_id å¨æ°ç»ä¸­ï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯ç±è¿æ²¡æäº¤çäºå¡çæçï¼ä¸å¯è§ï¼ b. è¥ row trx_id ä¸å¨æ°ç»ä¸­ï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯å·²ç»æäº¤äºçäºå¡çæçï¼å¯è§ã\n\nå¨è¿è¡ select æä½æ¶ï¼æ ¹æ®æ°æ®è¡å¿«ç§ç trx_id ä¸ trx_id_min å trx_id_max ä¹é´çå³ç³»ï¼ä»èå¤æ­æ°æ®è¡å¿«ç§æ¯å¦å¯ä»¥ä½¿ç¨ï¼\n\n * trx_id < trx_id_minï¼è¡¨ç¤ºè¯¥æ°æ®è¡å¿«ç§æ¶å¨å½åæææªæäº¤äºå¡ä¹åè¿è¡æ´æ¹çï¼å æ­¤å¯ä»¥ä½¿ç¨ã\n * trx_id > trx_id_maxï¼è¡¨ç¤ºè¯¥æ°æ®è¡å¿«ç§æ¯å¨äºå¡å¯å¨ä¹åè¢«æ´æ¹çï¼å æ­¤ä¸å¯ä½¿ç¨ã\n * trx_id_min <= trx_id <= trx_id_maxï¼éè¦æ ¹æ®éç¦»çº§å«åè¿è¡å¤æ­ï¼\n   * æäº¤è¯»ï¼å¦æ trx_id å¨ trx_ids åè¡¨ä¸­ï¼è¡¨ç¤ºè¯¥æ°æ®è¡å¿«ç§å¯¹åºçäºå¡è¿æªæäº¤ï¼åè¯¥å¿«ç§ä¸å¯ä½¿ç¨ãå¦åè¡¨ç¤ºå·²ç»æäº¤ï¼å¯ä»¥ä½¿ç¨ã\n   * å¯éå¤è¯»ï¼é½ä¸å¯ä»¥ä½¿ç¨ãå ä¸ºå¦æå¯ä»¥ä½¿ç¨çè¯ï¼é£ä¹å¶å®äºå¡ä¹å¯ä»¥è¯»å°è¿ä¸ªæ°æ®è¡å¿«ç§å¹¶è¿è¡ä¿®æ¹ï¼é£ä¹å½åäºå¡åå»è¯»è¿ä¸ªæ°æ®è¡å¾å°çå¼å°±ä¼åçæ¹åï¼ä¹å°±æ¯åºç°äºä¸å¯éå¤è¯»é®é¢ã\n\nå¨æ°æ®è¡å¿«ç§ä¸å¯ä½¿ç¨çæåµä¸ï¼éè¦æ²¿ç undo log çåæ»æé roll_ptr æ¾å°ä¸ä¸ä¸ªå¿«ç§ï¼åè¿è¡ä¸é¢çå¤æ­ã\n\n\n# å¿«ç§è¯»ä¸å½åè¯»\n\nå¿«ç§è¯»\n\nmvcc ç select æä½æ¯å¿«ç§ä¸­çæ°æ®ï¼ä¸éè¦è¿è¡å éæä½ã\n\nselect * from table ...;\n\n\nå½åè¯»\n\nmvcc å¶å®ä¼å¯¹æ°æ®åºè¿è¡ä¿®æ¹çæä½ï¼insertãupdateãdeleteï¼éè¦è¿è¡å éæä½ï¼ä»èè¯»åææ°çæ°æ®ãå¯ä»¥çå° mvcc å¹¶ä¸æ¯å®å¨ä¸ç¨å éï¼èåªæ¯é¿åäº select çå éæä½ã\n\ninsert;\nupdate;\ndelete;\n\n\nå¨è¿è¡ select æä½æ¶ï¼å¯ä»¥å¼ºå¶æå®è¿è¡å éæä½ãä»¥ä¸ç¬¬ä¸ä¸ªè¯­å¥éè¦å  s éï¼ç¬¬äºä¸ªéè¦å  x éã\n\nselect * from table where ? lock in share mode;\nselect * from table where ? for update;\n\n\n\n# è¡é\n\nè¡éçå·ä½å®ç°ç®æ³æä¸ç§ï¼record lockãgap lock ä»¥å next-key lockã\n\n * record lock - è¡éå¯¹ç´¢å¼é¡¹å éï¼è¥æ²¡æç´¢å¼åä½¿ç¨è¡¨éã\n * gap lock - å¯¹ç´¢å¼é¡¹ä¹é´çé´éå éãéå®ç´¢å¼ä¹é´çé´éï¼ä½æ¯ä¸åå«ç´¢å¼æ¬èº«ãä¾å¦å½ä¸ä¸ªäºå¡æ§è¡ä»¥ä¸è¯­å¥ï¼å¶å®äºå¡å°±ä¸è½å¨ t.c ä¸­æå¥ 15ï¼select c from t where c between 10 and 20 for update;ãå¨ mysql ä¸­ï¼gap lock é»è®¤æ¯å¼å¯çï¼å³ innodb_locks_unsafe_for_binlog åæ°å¼æ¯ disable çï¼ä¸ mysql ä¸­é»è®¤çæ¯ rr äºå¡éç¦»çº§å«ã\n * next-key lock -å®æ¯ record lock å gap lock çç»åï¼ä¸ä»éå®ä¸ä¸ªè®°å½ä¸çç´¢å¼ï¼ä¹éå®ç´¢å¼ä¹é´çé´éãå®éå®ä¸ä¸ªåå¼åé­åºé´ã\n\nåªå¨å¯éå¤è¯»æä»¥ä¸éç¦»çº§å«ä¸çç¹å®æä½æä¼åå¾ gap lock æ next-key lockãå¨ selectãupdate å delete æ¶ï¼é¤äºåºäºå¯ä¸ç´¢å¼çæ¥è¯¢ä¹å¤ï¼å¶å®ç´¢å¼æ¥è¯¢æ¶é½ä¼è·å gap lock æ next-key lockï¼å³éä½å¶æ«æçèå´ãä¸»é®ç´¢å¼ä¹å±äºå¯ä¸ç´¢å¼ï¼æä»¥ä¸»é®ç´¢å¼æ¯ä¸ä¼ä½¿ç¨ gap lock æ next-key lockã\n\nmvcc ä¸è½è§£å³å¹»è¯»é®é¢ï¼next-key éå°±æ¯ä¸ºäºè§£å³å¹»è¯»é®é¢ãå¨å¯éå¤è¯»ï¼repeatable readï¼éç¦»çº§å«ä¸ï¼ä½¿ç¨ mvcc + next-key é å¯ä»¥è§£å³å¹»è¯»é®é¢ã\n\nç´¢å¼åä¸ºä¸»é®ç´¢å¼åéä¸»é®ç´¢å¼ä¸¤ç§ï¼å¦æä¸æ¡ sql è¯­å¥æä½äºä¸»é®ç´¢å¼ï¼mysql å°±ä¼éå®è¿æ¡ä¸»é®ç´¢å¼ï¼å¦æä¸æ¡è¯­å¥æä½äºéä¸»é®ç´¢å¼ï¼mysql ä¼åéå®è¯¥éä¸»é®ç´¢å¼ï¼åéå®ç¸å³çä¸»é®ç´¢å¼ãå¨ updateãdelete æä½æ¶ï¼mysql ä¸ä»éå® where æ¡ä»¶æ«æè¿çææç´¢å¼è®°å½ï¼èä¸ä¼éå®ç¸é»çé®å¼ï¼å³æè°ç next-key lockã\n\nå½ä¸¤ä¸ªäºå¡åæ¶æ§è¡ï¼ä¸ä¸ªéä½äºä¸»é®ç´¢å¼ï¼å¨ç­å¾å¶ä»ç¸å³ç´¢å¼ãå¦ä¸ä¸ªéå®äºéä¸»é®ç´¢å¼ï¼å¨ç­å¾ä¸»é®ç´¢å¼ãè¿æ ·å°±ä¼åçæ­»éãåçæ­»éåï¼innodb ä¸è¬é½å¯ä»¥æ£æµå°ï¼å¹¶ä½¿ä¸ä¸ªäºå¡éæ¾éåéï¼å¦ä¸ä¸ªè·åéå®æäºå¡ã\n\n\n# åèèµæ\n\n * ãé«æ§è½ mysqlã\n * ãjava æ§è½è°ä¼å®æã\n * æ°æ®åºç³»ç»åç\n * æ°æ®åºä¸¤å¤§ç¥å¨ãç´¢å¼åéã\n * ä½¿ç¨ mysql ä¹è§éè§£å³å¹¶åé®é¢',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Mysql äºå¡",frontmatter:{title:"Mysql äºå¡",date:"2020-06-03T19:32:09.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql","äºå¡"],permalink:"/pages/00b04d/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/02.Mysql/03.Mysql%E4%BA%8B%E5%8A%A1.html",relativePath:"12.æ°æ®åº/03.å³ç³»åæ°æ®åº/02.Mysql/03.Mysqläºå¡.md",key:"v-413ab35d",path:"/pages/00b04d/",headers:[{level:2,title:"äºå¡ç®ä»",slug:"äºå¡ç®ä»",normalizedTitle:"äºå¡ç®ä»",charIndex:156},{level:2,title:"äºå¡ç¨æ³",slug:"äºå¡ç¨æ³",normalizedTitle:"äºå¡ç¨æ³",charIndex:471},{level:3,title:"äºå¡å¤çæä»¤",slug:"äºå¡å¤çæä»¤",normalizedTitle:"äºå¡å¤çæä»¤",charIndex:480},{level:3,title:"AUTOCOMMIT",slug:"autocommit",normalizedTitle:"autocommit",charIndex:1486},{level:2,title:"ACID",slug:"acid",normalizedTitle:"acid",charIndex:219},{level:2,title:"äºå¡éç¦»çº§å«",slug:"äºå¡éç¦»çº§å«",normalizedTitle:"äºå¡éç¦»çº§å«",charIndex:2598},{level:3,title:"äºå¡éç¦»ç®ä»",slug:"äºå¡éç¦»ç®ä»",normalizedTitle:"äºå¡éç¦»ç®ä»",charIndex:2609},{level:3,title:"è¯»æªæäº¤",slug:"è¯»æªæäº¤",normalizedTitle:"è¯»æªæäº¤",charIndex:2717},{level:3,title:"è¯»æäº¤",slug:"è¯»æäº¤",normalizedTitle:"è¯»æäº¤",charIndex:2725},{level:3,title:"å¯éå¤è¯»",slug:"å¯éå¤è¯»",normalizedTitle:"å¯éå¤è¯»",charIndex:2670},{level:3,title:"ä¸²è¡å",slug:"ä¸²è¡å",normalizedTitle:"ä¸²è¡å",charIndex:2740},{level:3,title:"éç¦»çº§å«å°ç»",slug:"éç¦»çº§å«å°ç»",normalizedTitle:"éç¦»çº§å«å°ç»",charIndex:3915},{level:2,title:"æ­»é",slug:"æ­»é",normalizedTitle:"æ­»é",charIndex:4330},{level:3,title:"æ­»éçåå ",slug:"æ­»éçåå ",normalizedTitle:"æ­»éçåå ",charIndex:4452},{level:3,title:"é¿åæ­»é",slug:"é¿åæ­»é",normalizedTitle:"é¿åæ­»é",charIndex:5631},{level:3,title:"è§£å³æ­»é",slug:"è§£å³æ­»é",normalizedTitle:"è§£å³æ­»é",charIndex:6106},{level:2,title:"åå¸å¼äºå¡",slug:"åå¸å¼äºå¡",normalizedTitle:"åå¸å¼äºå¡",charIndex:6761},{level:2,title:"äºå¡æä½³å®è·µ",slug:"äºå¡æä½³å®è·µ",normalizedTitle:"äºå¡æä½³å®è·µ",charIndex:7941},{level:3,title:"å°½éä½¿ç¨ä½çº§å«äºå¡éç¦»",slug:"å°½éä½¿ç¨ä½çº§å«äºå¡éç¦»",normalizedTitle:"å°½éä½¿ç¨ä½çº§å«äºå¡éç¦»",charIndex:7971},{level:3,title:"é¿åè¡éåçº§è¡¨é",slug:"é¿åè¡éåçº§è¡¨é",normalizedTitle:"é¿åè¡éåçº§è¡¨é",charIndex:8007},{level:3,title:"ç¼©å°äºå¡èå´",slug:"ç¼©å°äºå¡èå´",normalizedTitle:"ç¼©å°äºå¡èå´",charIndex:8101},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:8674}],headersStr:"äºå¡ç®ä» äºå¡ç¨æ³ äºå¡å¤çæä»¤ AUTOCOMMIT ACID äºå¡éç¦»çº§å« äºå¡éç¦»ç®ä» è¯»æªæäº¤ è¯»æäº¤ å¯éå¤è¯» ä¸²è¡å éç¦»çº§å«å°ç» æ­»é æ­»éçåå  é¿åæ­»é è§£å³æ­»é åå¸å¼äºå¡ äºå¡æä½³å®è·µ å°½éä½¿ç¨ä½çº§å«äºå¡éç¦» é¿åè¡éåçº§è¡¨é ç¼©å°äºå¡èå´ åèèµæ",content:"# Mysql äºå¡\n\n> ä¸æ¯ææç Mysql å­å¨å¼æé½å®ç°äºäºå¡å¤çãæ¯æäºå¡çå­å¨å¼ææï¼InnoDB å NDB Clusterãä¸æ¯æäºå¡çå­å¨å¼æï¼ä»£è¡¨æï¼MyISAMã\n> \n> ç¨æ·å¯ä»¥æ ¹æ®ä¸å¡æ¯å¦éè¦äºå¡å¤çï¼äºå¡å¤çå¯ä»¥ä¿è¯æ°æ®å®å¨ï¼ä½ä¼å¢å ç³»ç»å¼éï¼ï¼éæ©åéçå­å¨å¼æã\n\n\n\n\n# äºå¡ç®ä»\n\n> äºå¡ç®åæ¥è¯´ï¼ä¸ä¸ª Session ä¸­æè¿è¡ææçæä½ï¼è¦ä¹åæ¶æåï¼è¦ä¹åæ¶å¤±è´¥ãè¿ä¸æ­¥è¯´ï¼äºå¡æçæ¯æ»¡è¶³ ACID ç¹æ§çä¸ç»æä½ï¼å¯ä»¥éè¿ Commit æäº¤ä¸ä¸ªäºå¡ï¼ä¹å¯ä»¥ä½¿ç¨ Rollback è¿è¡åæ»ã\n\n\n\näºå¡å°±æ¯ä¸ç»åå­æ§ç SQL è¯­å¥ãå·ä½æ¥è¯´ï¼äºå¡æçæ¯æ»¡è¶³ ACID ç¹æ§çä¸ç»æä½ã\n\näºå¡åç SQL è¯­å¥ï¼è¦ä¹å¨æ§è¡æåï¼è¦ä¹å¨æ§è¡å¤±è´¥ã\n\néè¿å éçæ¹å¼ï¼å¯ä»¥å®ç°ä¸åçäºå¡éç¦»æºå¶ã\n\næ³è±¡ä¸ä¸ï¼å¦ææ²¡æäºå¡ï¼å¨å¹¶åç¯å¢ä¸ï¼å°±å¯è½åºç°ä¸¢å¤±ä¿®æ¹çé®é¢ã\n\nT1 å T2 ä¸¤ä¸ªçº¿ç¨é½å¯¹ä¸ä¸ªæ°æ®è¿è¡ä¿®æ¹ï¼T1 åä¿®æ¹ï¼T2 éåä¿®æ¹ï¼T2 çä¿®æ¹è¦çäº T1 çä¿®æ¹ã\n\n\n\n\n# äºå¡ç¨æ³\n\n\n# äºå¡å¤çæä»¤\n\nMysql ä¸­ï¼ä½¿ç¨ START TRANSACTION è¯­å¥å¼å§ä¸ä¸ªäºå¡ï¼ä½¿ç¨ COMMIT è¯­å¥æäº¤ææçä¿®æ¹ï¼ä½¿ç¨ ROLLBACK è¯­å¥æ¤éææçä¿®æ¹ãä¸è½åé SELECT è¯­å¥ï¼åé SELECT è¯­å¥ä¹æ²¡æä¹ï¼ä¹ä¸è½åé CREATE å DROP è¯­å¥ã\n\n * START TRANSACTION - æä»¤ç¨äºæ è®°äºå¡çèµ·å§ç¹ã\n * SAVEPOINT - æä»¤ç¨äºåå»ºä¿çç¹ã\n * ROLLBACK TO - æä»¤ç¨äºåæ»å°æå®çä¿çç¹ï¼å¦ææ²¡æè®¾ç½®ä¿çç¹ï¼ååéå° START TRANSACTION è¯­å¥å¤ã\n * COMMIT - æäº¤äºå¡ã\n\näºå¡å¤çç¤ºä¾ï¼\n\nï¼1ï¼åå»ºä¸å¼ ç¤ºä¾è¡¨\n\n-- æ¤éè¡¨ user\nDROP TABLE IF EXISTS user;\n\n-- åå»ºè¡¨ user\nCREATE TABLE user (\n  id int(10) unsigned NOT NULL COMMENT 'Id',\n  username varchar(64) NOT NULL DEFAULT 'default' COMMENT 'ç¨æ·å',\n  password varchar(64) NOT NULL DEFAULT 'default' COMMENT 'å¯ç ',\n  email varchar(64) NOT NULL DEFAULT 'default' COMMENT 'é®ç®±'\n) COMMENT='ç¨æ·è¡¨';\n\n\nï¼2ï¼æ§è¡äºå¡æä½\n\n-- å¼å§äºå¡\nSTART TRANSACTION;\n\n-- æå¥æä½ A\nINSERT INTO `user`\nVALUES (1, 'root1', 'root1', 'xxxx@163.com');\n\n-- åå»ºä¿çç¹ updateA\nSAVEPOINT updateA;\n\n-- æå¥æä½ B\nINSERT INTO `user`\nVALUES (2, 'root2', 'root2', 'xxxx@163.com');\n\n-- åæ»å°ä¿çç¹ updateA\nROLLBACK TO updateA;\n\n-- æäº¤äºå¡ï¼åªææä½ A çæ\nCOMMIT;\n\n\nï¼3ï¼æ§è¡ç»æ\n\nSELECT * FROM user;\n\n\nç»æï¼\n\n1\troot1\troot1\txxxx@163.com\n\n\n\n# AUTOCOMMIT\n\nMySQL é»è®¤éç¨éå¼æäº¤ç­ç¥ï¼autocommitï¼ãæ¯æ§è¡ä¸æ¡è¯­å¥å°±æè¿æ¡è¯­å¥å½æä¸ä¸ªäºå¡ç¶åè¿è¡æäº¤ãå½åºç° START TRANSACTION è¯­å¥æ¶ï¼ä¼å³é­éå¼æäº¤ï¼å½ COMMIT æ ROLLBACK è¯­å¥æ§è¡åï¼äºå¡ä¼èªå¨å³é­ï¼éæ°æ¢å¤éå¼æäº¤ã\n\néè¿ set autocommit=0 å¯ä»¥åæ¶èªå¨æäº¤ï¼ç´å° set autocommit=1 æä¼æäº¤ï¼autocommit æ è®°æ¯éå¯¹æ¯ä¸ªè¿æ¥èä¸æ¯éå¯¹æå¡å¨çã\n\n-- æ¥ç AUTOCOMMIT\nSHOW VARIABLES LIKE 'AUTOCOMMIT';\n\n-- å³é­ AUTOCOMMIT\nSET autocommit = 0;\n\n-- å¼å¯ AUTOCOMMIT\nSET autocommit = 1;\n\n\n\n# ACID\n\nACID æ¯æ°æ®åºäºå¡æ­£ç¡®æ§è¡çåä¸ªåºæ¬è¦ç´ ã\n\n * åå­æ§ï¼Atomicityï¼\n   * äºå¡è¢«è§ä¸ºä¸å¯åå²çæå°ååï¼äºå¡ä¸­çæææä½è¦ä¹å¨é¨æäº¤æåï¼è¦ä¹å¨é¨å¤±è´¥åæ»ã\n   * åæ»å¯ä»¥ç¨æ¥å¿æ¥å®ç°ï¼æ¥å¿è®°å½çäºå¡ææ§è¡çä¿®æ¹æä½ï¼å¨åæ»æ¶ååæ§è¡è¿äºä¿®æ¹æä½å³å¯ã\n * ä¸è´æ§ï¼Consistencyï¼\n   * æ°æ®åºå¨äºå¡æ§è¡ååé½ä¿æä¸è´æ§ç¶æã\n   * å¨ä¸è´æ§ç¶æä¸ï¼ææäºå¡å¯¹ä¸ä¸ªæ°æ®çè¯»åç»æé½æ¯ç¸åçã\n * éç¦»æ§ï¼Isolationï¼\n   * ä¸ä¸ªäºå¡æåçä¿®æ¹å¨æç»æäº¤ä»¥åï¼å¯¹å¶å®äºå¡æ¯ä¸å¯è§çã\n * æä¹æ§ï¼Durabilityï¼\n   * ä¸æ¦äºå¡æäº¤ï¼åå¶æåçä¿®æ¹å°ä¼æ°¸è¿ä¿å­å°æ°æ®åºä¸­ãå³ä½¿ç³»ç»åçå´©æºï¼äºå¡æ§è¡çç»æä¹ä¸è½ä¸¢å¤±ã\n   * å¯ä»¥éè¿æ°æ®åºå¤ä»½åæ¢å¤æ¥å®ç°ï¼å¨ç³»ç»åçå¥æºæ¶ï¼ä½¿ç¨å¤ä»½çæ°æ®åºè¿è¡æ°æ®æ¢å¤ã\n\nä¸ä¸ªæ¯æäºå¡ï¼Transactionï¼ä¸­çæ°æ®åºç³»ç»ï¼å¿éè¦å·æè¿åç§ç¹æ§ï¼å¦åå¨äºå¡è¿ç¨ï¼Transaction processingï¼å½ä¸­æ æ³ä¿è¯æ°æ®çæ­£ç¡®æ§ï¼äº¤æè¿ç¨æå¯è½è¾¾ä¸å°äº¤æã\n\n * åªææ»¡è¶³ä¸è´æ§ï¼äºå¡çæ§è¡ç»æææ¯æ­£ç¡®çã\n * å¨æ å¹¶åçæåµä¸ï¼äºå¡ä¸²è¡æ§è¡ï¼éç¦»æ§ä¸å®è½å¤æ»¡è¶³ãæ­¤æ¶åªè¦è½æ»¡è¶³åå­æ§ï¼å°±ä¸å®è½æ»¡è¶³ä¸è´æ§ã\n * å¨å¹¶åçæåµä¸ï¼å¤ä¸ªäºå¡å¹¶è¡æ§è¡ï¼äºå¡ä¸ä»è¦æ»¡è¶³åå­æ§ï¼è¿éè¦æ»¡è¶³éç¦»æ§ï¼æè½æ»¡è¶³ä¸è´æ§ã\n * äºå¡æ»¡è¶³æä¹åæ¯ä¸ºäºè½åºå¯¹ç³»ç»å´©æºçæåµã\n\n\n\n> MySQL é»è®¤éç¨èªå¨æäº¤æ¨¡å¼ï¼AUTO COMMITï¼ãä¹å°±æ¯è¯´ï¼å¦æä¸æ¾å¼ä½¿ç¨ START TRANSACTION è¯­å¥æ¥å¼å§ä¸ä¸ªäºå¡ï¼é£ä¹æ¯ä¸ªæ¥è¯¢æä½é½ä¼è¢«å½åä¸ä¸ªäºå¡å¹¶èªå¨æäº¤ã\n\n\n# äºå¡éç¦»çº§å«\n\n\n# äºå¡éç¦»ç®ä»\n\nå¨å¹¶åç¯å¢ä¸ï¼äºå¡çéç¦»æ§å¾é¾ä¿è¯ï¼å æ­¤ä¼åºç°å¾å¤å¹¶åä¸è´æ§é®é¢ï¼\n\n * ä¸¢å¤±ä¿®æ¹\n * èè¯»\n * ä¸å¯éå¤è¯»\n * å¹»è¯»\n\nå¨ SQL æ åä¸­ï¼å®ä¹äºåç§äºå¡éç¦»çº§å«ï¼çº§å«ç±ä½å°é«ï¼ï¼\n\n * è¯»æªæäº¤\n * è¯»æäº¤\n * å¯éå¤è¯»\n * ä¸²è¡å\n\nMysql ä¸­æ¥çåè®¾ç½®äºå¡éç¦»çº§å«ï¼\n\n-- æ¥çäºå¡éç¦»çº§å«\nSHOW VARIABLES LIKE 'transaction_isolation';\n\n-- è®¾ç½®äºå¡éç¦»çº§å«ä¸º READ UNCOMMITTED\nSET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;\n\n-- è®¾ç½®äºå¡éç¦»çº§å«ä¸º READ COMMITTED\nSET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;\n\n-- è®¾ç½®äºå¡éç¦»çº§å«ä¸º REPEATABLE READ\nSET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;\n\n-- è®¾ç½®äºå¡éç¦»çº§å«ä¸º SERIALIZABLE\nSET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;\n\n\n\n# è¯»æªæäº¤\n\nè¯»æªæäº¤ï¼read uncommittedï¼ æ¯æï¼äºå¡ä¸­çä¿®æ¹ï¼å³ä½¿æ²¡ææäº¤ï¼å¯¹å¶å®äºå¡ä¹æ¯å¯è§çã\n\nè¯»æªæäº¤çé®é¢ï¼äºå¡å¯ä»¥è¯»åæªæäº¤çæ°æ®ï¼ä¹è¢«ç§°ä¸º èè¯»ï¼Dirty Readï¼ã\n\nT1 ä¿®æ¹ä¸ä¸ªæ°æ®ï¼T2 éåè¯»åè¿ä¸ªæ°æ®ãå¦æ T1 æ¤éäºè¿æ¬¡ä¿®æ¹ï¼é£ä¹ T2 è¯»åçæ°æ®æ¯èæ°æ®ã\n\n\n\n\n# è¯»æäº¤\n\nè¯»æäº¤ï¼read committedï¼ æ¯æï¼äºå¡æäº¤åï¼å¶ä»äºå¡æè½çå°å®çä¿®æ¹ãæ¢å¥è¯è¯´ï¼ä¸ä¸ªäºå¡æåçä¿®æ¹å¨æäº¤ä¹åå¯¹å¶å®äºå¡æ¯ä¸å¯è§çãè¯»æäº¤è§£å³äºèè¯»çé®é¢ã\n\nè¯»æäº¤æ¯å¤§å¤æ°æ°æ®åºçé»è®¤äºå¡éç¦»çº§å«ã\n\nè¯»æäº¤ææ¶ä¹å«ä¸å¯éå¤è¯»ï¼å®çé®é¢æ¯ï¼æ§è¡ä¸¤æ¬¡ç¸åçæ¥è¯¢ï¼å¾å°çç»æå¯è½ä¸ä¸è´ã\n\nT2 è¯»åä¸ä¸ªæ°æ®ï¼T1 å¯¹è¯¥æ°æ®åäºä¿®æ¹ãå¦æ T2 åæ¬¡è¯»åè¿ä¸ªæ°æ®ï¼æ­¤æ¶è¯»åçç»æåç¬¬ä¸æ¬¡è¯»åçç»æä¸åã\n\n\n\n\n# å¯éå¤è¯»\n\nå¯éå¤è¯»ï¼REPEATABLE READï¼ æ¯æï¼ä¿è¯å¨åä¸ä¸ªäºå¡ä¸­å¤æ¬¡è¯»ååæ ·æ°æ®çç»ææ¯ä¸æ ·çãå¯éå¤è¯»è§£å³äºä¸å¯éå¤è¯»é®é¢ã\n\nå¯éå¤è¯»æ¯ Mysql çé»è®¤äºå¡éç¦»çº§å«ã\n\nå¯éå¤è¯»çé®é¢ï¼äºå¡ T1 è¯»åæä¸ªèå´åçè®°å½æ¶ï¼äºå¡ T2 å¨è¯¥èå´åæå¥äºæ°çè®°å½ï¼T1 åæ¬¡è¯»åè¿ä¸ªèå´çæ°æ®ï¼æ­¤æ¶è¯»åçç»æååç¬¬ä¸æ¬¡è¯»åçç»æä¸åï¼å³ä¸º å¹»è¯»ï¼Phantom Readï¼ã\n\n\n\n\n# ä¸²è¡å\n\nä¸²è¡åï¼SERIALIXABLEï¼ æ¯æï¼å¼ºå¶äºå¡ä¸²è¡æ§è¡ï¼å¯¹äºåä¸è¡è®°å½ï¼å è¯»åéï¼ä¸æ¦åºç°éå²çªï¼å¿é¡»ç­åé¢çäºå¡éæ¾éã\n\nå¼ºå¶äºå¡ä¸²è¡æ§è¡ï¼åé¿åäºææçå¹¶åé®é¢ãä¸²è¡åç­ç¥ä¼å¨è¯»åçæ¯ä¸è¡æ°æ®ä¸é½å éï¼è¿å¯è½å¯¼è´å¤§éçè¶æ¶åéç«äºãè¿å¯¹äºé«å¹¶ååºç¨åºæ¬ä¸æ¯ä¸å¯æ¥åçï¼æä»¥ä¸è¬ä¸ä¼éç¨è¿ä¸ªçº§å«ã\n\n\n# éç¦»çº§å«å°ç»\n\n * è¯»æªæäº¤ï¼READ UNCOMMITTEDï¼ - äºå¡ä¸­çä¿®æ¹ï¼å³ä½¿æ²¡ææäº¤ï¼å¯¹å¶å®äºå¡ä¹æ¯å¯è§çã\n * è¯»æäº¤ï¼READ COMMITTEDï¼ - ä¸ä¸ªäºå¡åªè½è¯»åå·²ç»æäº¤çäºå¡æåçä¿®æ¹ãæ¢å¥è¯è¯´ï¼ä¸ä¸ªäºå¡æåçä¿®æ¹å¨æäº¤ä¹åå¯¹å¶å®äºå¡æ¯ä¸å¯è§çã\n * éå¤è¯»ï¼REPEATABLE READï¼ - ä¿è¯å¨åä¸ä¸ªäºå¡ä¸­å¤æ¬¡è¯»ååæ ·æ°æ®çç»ææ¯ä¸æ ·çã\n * ä¸²è¡åï¼SERIALIXABLEï¼ - å¯¹äºåä¸è¡è®°å½ï¼å è¯»åéï¼ä¸æ¦åºç°éå²çªï¼å¿é¡»ç­åé¢çäºå¡éæ¾éã\n\næ°æ®åºéç¦»çº§å«è§£å³çé®é¢ï¼\n\néç¦»çº§å«   ä¸¢å¤±ä¿®æ¹   èè¯»   ä¸å¯éå¤è¯»   å¹»è¯»\nè¯»æªæäº¤   âï¸     â    â       â\nè¯»æäº¤    âï¸     âï¸   â       â\nå¯éå¤è¯»   âï¸     âï¸   âï¸      â\nå¯ä¸²è¡å   âï¸     âï¸   âï¸      âï¸\n\n\n# æ­»é\n\næ­»éæ¯æä¸¤ä¸ªæå¤ä¸ªäºå¡ç«äºåä¸èµæºï¼å¹¶è¯·æ±éå®å¯¹æ¹å ç¨çèµæºï¼ä»èå¯¼è´æ¶æ§å¾ªç¯çç°è±¡ã\n\näº§çæ­»éçåºæ¯ï¼\n\n * å½å¤ä¸ªäºå¡è¯å¾ä»¥ä¸åçé¡ºåºéå®èµæºæ¶ï¼å°±å¯è½ä¼äº§çæ­»éã\n\n * å¤ä¸ªäºå¡åæ¶éå®åä¸ä¸ªèµæºæ¶ï¼ä¹ä¼äº§çæ­»éã\n\n\n# æ­»éçåå \n\nè¡éçå·ä½å®ç°ç®æ³æä¸ç§ï¼record lockãgap lock ä»¥å next-key lockãrecord lock æ¯ä¸é¨å¯¹ç´¢å¼é¡¹å éï¼gap lock æ¯å¯¹ç´¢å¼é¡¹ä¹é´çé´éå éï¼next-key lock åæ¯åé¢ä¸¤ç§çç»åï¼å¯¹ç´¢å¼é¡¹ä»¥å¶ä¹é´çé´éå éã\n\nåªå¨å¯éå¤è¯»æä»¥ä¸éç¦»çº§å«ä¸çç¹å®æä½æä¼åå¾ gap lock æ next-key lockï¼å¨ SelectãUpdate å Delete æ¶ï¼é¤äºåºäºå¯ä¸ç´¢å¼çæ¥è¯¢ä¹å¤ï¼å¶å®ç´¢å¼æ¥è¯¢æ¶é½ä¼è·å gap lock æ next-key lockï¼å³éä½å¶æ«æçèå´ãä¸»é®ç´¢å¼ä¹å±äºå¯ä¸ç´¢å¼ï¼æä»¥ä¸»é®ç´¢å¼æ¯ä¸ä¼ä½¿ç¨ gap lock æ next-key lockã\n\nå¨ MySQL ä¸­ï¼gap lock é»è®¤æ¯å¼å¯çï¼å³ innodb_locks_unsafe_for_binlog åæ°å¼æ¯ disable çï¼ä¸ MySQL ä¸­é»è®¤çæ¯ RR äºå¡éç¦»çº§å«ã\n\nå½æä»¬æ§è¡ä»¥ä¸æ¥è¯¢ SQL æ¶ï¼ç±äº order_no åä¸ºéå¯ä¸ç´¢å¼ï¼æ­¤æ¶åæ¯ RR äºå¡éç¦»çº§å«ï¼æä»¥ SELECT çå éç±»åä¸º gap lockï¼è¿éç gap èå´æ¯ (4,+âï¼ã\n\n> SELECT id FROM demo.order_record where order_no = 4 for update;\n\næ§è¡æ¥è¯¢ SQL è¯­å¥è·åç gap lock å¹¶ä¸ä¼å¯¼è´é»å¡ï¼èå½æä»¬æ§è¡ä»¥ä¸æå¥ SQL æ¶ï¼ä¼å¨æå¥é´éä¸åæ¬¡è·åæå¥æåéãæå¥æåéå¶å®ä¹æ¯ä¸ç§ gap éï¼å®ä¸ gap lock æ¯å²çªçï¼æä»¥å½å¶å®äºå¡ææè¯¥é´éç gap lock æ¶ï¼éè¦ç­å¾å¶å®äºå¡éæ¾ gap lock ä¹åï¼æè½è·åå°æå¥æåéã\n\nä»¥ä¸äºå¡ A åäºå¡ B é½ææé´é (4,+âï¼ç gap éï¼èæ¥ä¸æ¥çæå¥æä½ä¸ºäºè·åå°æå¥æåéï¼é½å¨ç­å¾å¯¹æ¹äºå¡ç gap ééæ¾ï¼äºæ¯å°±é æäºå¾ªç¯ç­å¾ï¼å¯¼è´æ­»éã\n\n> INSERT INTO demo.order_record(order_no, status, create_date) VALUES (5, 1, â2019-07-13 10:57:03â);\n\n\n\nå¦ä¸ä¸ªæ­»éåºæ¯\n\nInnoDB å­å¨å¼æçä¸»é®ç´¢å¼ä¸ºèç°ç´¢å¼ï¼å¶å®ç´¢å¼ä¸ºè¾å©ç´¢å¼ãå¦æä½¿ç¨è¾å©ç´¢å¼æ¥æ´æ°æ°æ®åºï¼å°±éè¦ä½¿ç¨èç°ç´¢å¼æ¥æ´æ°æ°æ®åºå­æ®µãå¦æä¸¤ä¸ªæ´æ°äºå¡ä½¿ç¨äºä¸åçè¾å©ç´¢å¼ï¼æä¸ä¸ªä½¿ç¨äºè¾å©ç´¢å¼ï¼ä¸ä¸ªä½¿ç¨äºèç°ç´¢å¼ï¼å°±é½æå¯è½å¯¼è´éèµæºçå¾ªç¯ç­å¾ãç±äºæ¬èº«ä¸¤ä¸ªäºå¡æ¯äºæ¥ï¼ä¹å°±ææäºä»¥ä¸æ­»éçåä¸ªå¿è¦æ¡ä»¶äºã\n\n\n\nåºç°æ­»éçæ­¥éª¤ï¼\n\n\n\nç»¼ä¸å¯ç¥ï¼å¨æ´æ°æä½æ¶ï¼æä»¬åºè¯¥å°½éä½¿ç¨ä¸»é®æ¥æ´æ°è¡¨å­æ®µï¼è¿æ ·å¯ä»¥ææé¿åä¸äºä¸å¿è¦çæ­»éåçã\n\n\n# é¿åæ­»é\n\né¢é²æ­»éçæ³¨æäºé¡¹ï¼\n\n * å¨ç¼ç¨ä¸­å°½éæç§åºå®çé¡ºåºæ¥å¤çæ°æ®åºè®°å½ï¼åè®¾æä¸¤ä¸ªæ´æ°æä½ï¼åå«æ´æ°ä¸¤æ¡ç¸åçè®°å½ï¼ä½æ´æ°é¡ºåºä¸ä¸æ ·ï¼æå¯è½å¯¼è´æ­»éï¼\n * å¨åè®¸å¹»è¯»åä¸å¯éå¤è¯»çæåµä¸ï¼å°½éä½¿ç¨ RC äºå¡éç¦»çº§å«ï¼å¯ä»¥é¿å gap lock å¯¼è´çæ­»éé®é¢ï¼\n * æ´æ°è¡¨æ¶ï¼å°½éä½¿ç¨ä¸»é®æ´æ°ï¼\n * é¿åé¿äºå¡ï¼å°½éå°é¿äºå¡æè§£ï¼å¯ä»¥éä½ä¸å¶å®äºå¡åçå²çªçæ¦çï¼\n * è®¾ç½®åççéç­å¾è¶æ¶åæ°ï¼æä»¬å¯ä»¥éè¿ innodb_lock_wait_timeout è®¾ç½®åççç­å¾è¶æ¶éå¼ï¼ç¹å«æ¯å¨ä¸äºé«å¹¶åçä¸å¡ä¸­ï¼æä»¬å¯ä»¥å°½éå°è¯¥å¼è®¾ç½®å¾å°ä¸äºï¼é¿åå¤§éäºå¡ç­å¾ï¼å ç¨ç³»ç»èµæºï¼é æä¸¥éçæ§è½å¼éã\n\nå¦å¤ï¼æä»¬è¿å¯ä»¥å° order_no åè®¾ç½®ä¸ºå¯ä¸ç´¢å¼åãè½ç¶ä¸è½é²æ­¢å¹»è¯»ï¼ä½æä»¬å¯ä»¥å©ç¨å®çå¯ä¸æ§æ¥ä¿è¯è®¢åè®°å½ä¸éå¤åå»ºï¼è¿ç§æ¹å¼å¯ä¸çç¼ºç¹å°±æ¯å½éå°éå¤åå»ºè®¢åæ¶ä¼æåºå¼å¸¸ã\n\næä»¬è¿å¯ä»¥ä½¿ç¨å¶å®çæ¹å¼æ¥ä»£æ¿æ°æ®åºå®ç°å¹ç­æ§æ ¡éªãä¾å¦ï¼ä½¿ç¨ Redis ä»¥å ZooKeeper æ¥å®ç°ï¼è¿è¡æçæ¯æ°æ®åºæ´ä½³ã\n\n\n# è§£å³æ­»é\n\nå½åºç°æ­»éä»¥åï¼æä¸¤ç§ç­ç¥ï¼\n\n * ä¸ç§ç­ç¥æ¯ï¼ç´æ¥è¿å¥ç­å¾ï¼ç´å°è¶æ¶ãè¿ä¸ªè¶æ¶æ¶é´å¯ä»¥éè¿åæ° innodb_lock_wait_timeout æ¥è®¾ç½®ã\n * å¦ä¸ç§ç­ç¥æ¯ï¼åèµ·æ­»éæ£æµï¼åç°æ­»éåï¼ä¸»å¨åæ»æ­»éé¾æ¡ä¸­çæä¸ä¸ªäºå¡ï¼è®©å¶ä»äºå¡å¾ä»¥ç»§ç»­æ§è¡ãå°åæ° innodb_deadlock_detect è®¾ç½®ä¸º onï¼è¡¨ç¤ºå¼å¯è¿ä¸ªé»è¾ã\n\nå¨ InnoDB ä¸­ï¼innodb_lock_wait_timeout çé»è®¤å¼æ¯ 50sï¼æå³çå¦æéç¨ç¬¬ä¸ä¸ªç­ç¥ï¼å½åºç°æ­»éä»¥åï¼ç¬¬ä¸ä¸ªè¢«éä½ççº¿ç¨è¦è¿ 50s æä¼è¶æ¶éåºï¼ç¶åå¶ä»çº¿ç¨ææå¯è½ç»§ç»­æ§è¡ãå¯¹äºå¨çº¿æå¡æ¥è¯´ï¼è¿ä¸ªç­å¾æ¶é´å¾å¾æ¯æ æ³æ¥åçã\n\nä½æ¯ï¼æä»¬åä¸å¯è½ç´æ¥æè¿ä¸ªæ¶é´è®¾ç½®æä¸ä¸ªå¾å°çå¼ï¼æ¯å¦ 1sãè¿æ ·å½åºç°æ­»éçæ¶åï¼ç¡®å®å¾å¿«å°±å¯ä»¥è§£å¼ï¼ä½å¦æä¸æ¯æ­»éï¼èæ¯ç®åçéç­å¾å¢ï¼æä»¥ï¼è¶æ¶æ¶é´è®¾ç½®å¤ªç­çè¯ï¼ä¼åºç°å¾å¤è¯¯ä¼¤ã\n\næä»¥ï¼æ­£å¸¸æåµä¸æä»¬è¿æ¯è¦éç¨ç¬¬äºç§ç­ç¥ï¼å³ï¼ä¸»å¨æ­»éæ£æµï¼èä¸ innodb_deadlock_detect çé»è®¤å¼æ¬èº«å°±æ¯ onãä¸ºäºè§£å³æ­»éé®é¢ï¼ä¸åæ°æ®åºå®ç°äºåèªçæ­»éæ£æµåè¶æ¶æºå¶ãInnoDB çå¤çç­ç¥æ¯ï¼å°æææå°è¡çº§æå®éçäºå¡è¿è¡åæ»ã\n\nä¸»å¨æ­»éæ£æµå¨åçæ­»éçæ¶åï¼æ¯è½å¤å¿«éåç°å¹¶è¿è¡å¤ççï¼ä½æ¯å®ä¹æ¯æé¢å¤è´æçãä½ å¯ä»¥æ³è±¡ä¸ä¸è¿ä¸ªè¿ç¨ï¼æ¯å½ä¸ä¸ªäºå¡è¢«éçæ¶åï¼å°±è¦ççå®æä¾èµççº¿ç¨ææ²¡æè¢«å«äººéä½ï¼å¦æ­¤å¾ªç¯ï¼æåå¤æ­æ¯å¦åºç°äºå¾ªç¯ç­å¾ï¼ä¹å°±æ¯æ­»éã\n\n\n# åå¸å¼äºå¡\n\nå¨åä¸æ°æ®èç¹ä¸­ï¼äºå¡ä»éäºå¯¹åä¸æ°æ®åºèµæºçè®¿é®æ§å¶ï¼ç§°ä¹ä¸º æ¬å°äºå¡ãå ä¹ææçæççå³ç³»åæ°æ®åºé½æä¾äºå¯¹æ¬å°äºå¡çåçæ¯æã\n\nåå¸å¼äºå¡æçæ¯äºå¡æä½è·¨è¶å¤ä¸ªèç¹ï¼å¹¶ä¸è¦æ±æ»¡è¶³äºå¡ç ACID ç¹æ§ã\n\nåå¸å¼äºå¡çå¸¸è§æ¹æ¡å¦ä¸ï¼\n\n * ä¸¤é¶æ®µæäº¤ï¼2PCï¼ - å°äºå¡çæäº¤è¿ç¨åä¸ºä¸¤ä¸ªé¶æ®µæ¥è¿è¡å¤çï¼åå¤é¶æ®µåæäº¤é¶æ®µãåä¸èå°æä½æè´¥éç¥åè°èï¼åç±åè°èæ ¹æ®ææåä¸èçåé¦ææ¥å³å®ååä¸èæ¯å¦è¦æäº¤æä½è¿æ¯ä¸­æ­¢æä½ã\n * ä¸é¶æ®µæäº¤ï¼3PCï¼ - ä¸äºé¶æ®µæäº¤ä¸åçæ¯ï¼å¼å¥è¶æ¶æºå¶ãåæ¶å¨åè°èååä¸èä¸­é½å¼å¥è¶æ¶æºå¶ãå°äºé¶æ®µçåå¤é¶æ®µæåä¸º 2 ä¸ªé¶æ®µï¼æå¥äºä¸ä¸ª preCommit é¶æ®µï¼ä½¿å¾ååå¨äºé¶æ®µæäº¤ä¸­ï¼åä¸èå¨åå¤ä¹åï¼ç±äºåè°èåçå´©æºæéè¯¯ï¼èå¯¼è´åä¸èå¤äºæ æ³ç¥ææ¯å¦æäº¤æèä¸­æ­¢çâä¸ç¡®å®ç¶æâæäº§ççå¯è½ç¸å½é¿çå»¶æ¶çé®é¢å¾ä»¥è§£å³ã\n * è¡¥å¿äºå¡ï¼TCCï¼\n   * Try - æä½ä½ä¸ºä¸é¶æ®µï¼è´è´£èµæºçæ£æ¥åé¢çã\n   * Confirm - æä½ä½ä¸ºäºé¶æ®µæäº¤æä½ï¼æ§è¡çæ­£çä¸å¡ã\n   * Cancel - æ¯é¢çèµæºçåæ¶ã\n * æ¬å°æ¶æ¯è¡¨ - å¨äºå¡ä¸»å¨åèµ·æ¹é¢å¤æ°å»ºäºå¡æ¶æ¯è¡¨ï¼äºå¡åèµ·æ¹å¤çä¸å¡åè®°å½äºå¡æ¶æ¯å¨æ¬å°äºå¡ä¸­å®æï¼è½®è¯¢äºå¡æ¶æ¯è¡¨çæ°æ®åéäºå¡æ¶æ¯ï¼äºå¡è¢«å¨æ¹åºäºæ¶æ¯ä¸­é´ä»¶æ¶è´¹äºå¡æ¶æ¯è¡¨ä¸­çäºå¡ã\n * MQ äºå¡ - åºäº MQ çåå¸å¼äºå¡æ¹æ¡å¶å®æ¯å¯¹æ¬å°æ¶æ¯è¡¨çå°è£ã\n * SAGA - Saga äºå¡æ ¸å¿ææ³æ¯å°é¿äºå¡æåä¸ºå¤ä¸ªæ¬å°ç­äºå¡ï¼ç± Saga äºå¡åè°å¨åè°ï¼å¦ææ­£å¸¸ç»æé£å°±æ­£å¸¸å®æï¼å¦ææä¸ªæ­¥éª¤å¤±è´¥ï¼åæ ¹æ®ç¸åé¡ºåºä¸æ¬¡è°ç¨è¡¥å¿æä½ã\n\nåå¸å¼äºå¡æ¹æ¡åæï¼\n\n * 2PC/3PC ä¾èµäºæ°æ®åºï¼è½å¤å¾å¥½çæä¾å¼ºä¸è´æ§åå¼ºäºå¡æ§ï¼ä½ç¸å¯¹æ¥è¯´å»¶è¿æ¯è¾é«ï¼æ¯è¾éåä¼ ç»çåä½åºç¨ï¼å¨åä¸ä¸ªæ¹æ³ä¸­å­å¨è·¨åºæä½çæåµï¼ä¸éåé«å¹¶ååé«æ§è½è¦æ±çåºæ¯ã\n * TCC éç¨äºæ§è¡æ¶é´ç¡®å®ä¸è¾ç­ï¼å®æ¶æ§è¦æ±é«ï¼å¯¹æ°æ®ä¸è´æ§è¦æ±é«ï¼æ¯å¦äºèç½éèä¼ä¸ææ ¸å¿çä¸ä¸ªæå¡ï¼äº¤æãæ¯ä»ãè´¦å¡ã\n * æ¬å°æ¶æ¯è¡¨/MQ äºå¡ é½éç¨äºäºå¡ä¸­åä¸æ¹æ¯ææä½å¹ç­ï¼å¯¹ä¸è´æ§è¦æ±ä¸é«ï¼ä¸å¡ä¸è½å®¹å¿æ°æ®ä¸ä¸è´å°ä¸ä¸ªäººå·¥æ£æ¥å¨æï¼äºå¡æ¶åçåä¸æ¹ãåä¸ç¯èè¾å°ï¼ä¸å¡ä¸æå¯¹è´¦/æ ¡éªç³»ç»ååºã\n * Saga äºå¡ ç±äº Saga äºå¡ä¸è½ä¿è¯éç¦»æ§ï¼éè¦å¨ä¸å¡å±æ§å¶å¹¶åï¼éåäºä¸å¡åºæ¯äºå¡å¹¶åæä½åä¸èµæºè¾å°çæåµã Saga ç¸æ¯ç¼ºå°é¢æäº¤å¨ä½ï¼å¯¼è´è¡¥å¿å¨ä½çå®ç°æ¯è¾éº»ç¦ï¼ä¾å¦ä¸å¡æ¯åéç­ä¿¡ï¼è¡¥å¿å¨ä½åå¾ååéä¸æ¬¡ç­ä¿¡è¯´ææ¤éï¼ç¨æ·ä½éªæ¯è¾å·®ãSaga äºå¡è¾éç¨äºè¡¥å¿å¨ä½å®¹æå¤ççåºæ¯ã\n\n> åå¸å¼äºå¡è¯¦ç»è¯´æãåæè¯·åèï¼åå¸å¼äºå¡åºæ¬åç\n\n\n# äºå¡æä½³å®è·µ\n\né«å¹¶ååºæ¯ä¸çäºå¡å°åºè¯¥å¦ä½è°ä¼ï¼\n\n\n# å°½éä½¿ç¨ä½çº§å«äºå¡éç¦»\n\nç»åä¸å¡åºæ¯ï¼å°½éä½¿ç¨ä½çº§å«äºå¡éç¦»\n\n\n# é¿åè¡éåçº§è¡¨é\n\nå¨ InnoDB ä¸­ï¼è¡éæ¯éè¿ç´¢å¼å®ç°çï¼å¦æä¸éè¿ç´¢å¼æ¡ä»¶æ£ç´¢æ°æ®ï¼è¡éå°ä¼åçº§å°è¡¨éãæä»¬ç¥éï¼è¡¨éæ¯ä¼ä¸¥éå½±åå°æ´å¼ è¡¨çæä½æ§è½çï¼æä»¥åºè¯¥å°½åé¿åã\n\n\n# ç¼©å°äºå¡èå´\n\nææ¶åï¼æ°æ®åºå¹¶åè®¿é®éå¤ªå¤§ï¼ä¼åºç°ä»¥ä¸å¼å¸¸ï¼\n\nMySQLQueryInterruptedException: Query execution was interrupted\n\n\né«å¹¶åæ¶å¯¹ä¸æ¡è®°å½è¿è¡æ´æ°çæåµä¸ï¼ç±äºæ´æ°è®°å½æå¨çäºå¡è¿å¯è½å­å¨å¶ä»æä½ï¼å¯¼è´ä¸ä¸ªäºå¡æ¯è¾é¿ï¼å½æå¤§éè¯·æ±è¿å¥æ¶ï¼å°±å¯è½å¯¼è´ä¸äºè¯·æ±åæ¶è¿å¥å°äºå¡ä¸­ã\n\nåå ä¸ºéçç«äºæ¯ä¸å¬å¹³çï¼å½å¤ä¸ªäºå¡åæ¶å¯¹ä¸æ¡è®°å½è¿è¡æ´æ°æ¶ï¼æç«¯æåµä¸ï¼ä¸ä¸ªæ´æ°æä½è¿å»æéç³»ç»åï¼å¯è½ä¼ä¸ç´æ¿ä¸å°éï¼æåå è¶æ¶è¢«ç³»ç»ææ­è¸¢åºã\n\n\n\nå¦ä¸å¾ä¸­çæä½ï¼è½ç¶é½æ¯å¨ä¸ä¸ªäºå¡ä¸­ï¼ä½éçç³è¯·å¨ä¸åæ¶é´ï¼åªæå½å¶ä»æä½é½æ§è¡å®ï¼æä¼éæ¾ææéãå ä¸ºæ£é¤åºå­æ¯æ´æ°æä½ï¼å±äºè¡éï¼è¿å°ä¼å½±åå°å¶ä»æä½è¯¥æ°æ®çäºå¡ï¼æä»¥æä»¬åºè¯¥å°½éé¿åé¿æ¶é´å°ææè¯¥éï¼å°½å¿«éæ¾è¯¥éãåå ä¸ºåæ°å»ºè®¢åååæ£é¤åºå­é½ä¸ä¼å½±åä¸å¡ï¼æä»¥æä»¬å¯ä»¥å°æ£é¤åºå­æä½æ¾å°æåï¼ä¹å°±æ¯ä½¿ç¨æ§è¡é¡ºåº 1ï¼ä»¥æ­¤å°½éåå°éçæææ¶é´ã\n\nå¨ InnoDB äºå¡ä¸­ï¼è¡éæ¯å¨éè¦çæ¶åæå ä¸çï¼ä½å¹¶ä¸æ¯ä¸éè¦äºå°±ç«å»éæ¾ï¼èæ¯è¦ç­å°äºå¡ç»ææ¶æéæ¾ãè¿ä¸ªå°±æ¯ä¸¤é¶æ®µéåè®®ã\n\nç¥éäºè¿ä¸ªè®¾å®ï¼å¯¹æä»¬ä½¿ç¨äºå¡æä»ä¹å¸®å©å¢ï¼é£å°±æ¯ï¼å¦æä½ çäºå¡ä¸­éè¦éå¤ä¸ªè¡ï¼è¦ææå¯è½é æéå²çªãæå¯è½å½±åå¹¶ååº¦çéå°½éå¾åæ¾ã\n\n\n# åèèµæ\n\n * ãé«æ§è½ MySQLã\n * ãJava æ§è½è°ä¼å®æã\n * ShardingSphere åå¸å¼äºå¡",normalizedContent:"# mysql äºå¡\n\n> ä¸æ¯ææç mysql å­å¨å¼æé½å®ç°äºäºå¡å¤çãæ¯æäºå¡çå­å¨å¼ææï¼innodb å ndb clusterãä¸æ¯æäºå¡çå­å¨å¼æï¼ä»£è¡¨æï¼myisamã\n> \n> ç¨æ·å¯ä»¥æ ¹æ®ä¸å¡æ¯å¦éè¦äºå¡å¤çï¼äºå¡å¤çå¯ä»¥ä¿è¯æ°æ®å®å¨ï¼ä½ä¼å¢å ç³»ç»å¼éï¼ï¼éæ©åéçå­å¨å¼æã\n\n\n\n\n# äºå¡ç®ä»\n\n> äºå¡ç®åæ¥è¯´ï¼ä¸ä¸ª session ä¸­æè¿è¡ææçæä½ï¼è¦ä¹åæ¶æåï¼è¦ä¹åæ¶å¤±è´¥ãè¿ä¸æ­¥è¯´ï¼äºå¡æçæ¯æ»¡è¶³ acid ç¹æ§çä¸ç»æä½ï¼å¯ä»¥éè¿ commit æäº¤ä¸ä¸ªäºå¡ï¼ä¹å¯ä»¥ä½¿ç¨ rollback è¿è¡åæ»ã\n\n\n\näºå¡å°±æ¯ä¸ç»åå­æ§ç sql è¯­å¥ãå·ä½æ¥è¯´ï¼äºå¡æçæ¯æ»¡è¶³ acid ç¹æ§çä¸ç»æä½ã\n\näºå¡åç sql è¯­å¥ï¼è¦ä¹å¨æ§è¡æåï¼è¦ä¹å¨æ§è¡å¤±è´¥ã\n\néè¿å éçæ¹å¼ï¼å¯ä»¥å®ç°ä¸åçäºå¡éç¦»æºå¶ã\n\næ³è±¡ä¸ä¸ï¼å¦ææ²¡æäºå¡ï¼å¨å¹¶åç¯å¢ä¸ï¼å°±å¯è½åºç°ä¸¢å¤±ä¿®æ¹çé®é¢ã\n\nt1 å t2 ä¸¤ä¸ªçº¿ç¨é½å¯¹ä¸ä¸ªæ°æ®è¿è¡ä¿®æ¹ï¼t1 åä¿®æ¹ï¼t2 éåä¿®æ¹ï¼t2 çä¿®æ¹è¦çäº t1 çä¿®æ¹ã\n\n\n\n\n# äºå¡ç¨æ³\n\n\n# äºå¡å¤çæä»¤\n\nmysql ä¸­ï¼ä½¿ç¨ start transaction è¯­å¥å¼å§ä¸ä¸ªäºå¡ï¼ä½¿ç¨ commit è¯­å¥æäº¤ææçä¿®æ¹ï¼ä½¿ç¨ rollback è¯­å¥æ¤éææçä¿®æ¹ãä¸è½åé select è¯­å¥ï¼åé select è¯­å¥ä¹æ²¡æä¹ï¼ä¹ä¸è½åé create å drop è¯­å¥ã\n\n * start transaction - æä»¤ç¨äºæ è®°äºå¡çèµ·å§ç¹ã\n * savepoint - æä»¤ç¨äºåå»ºä¿çç¹ã\n * rollback to - æä»¤ç¨äºåæ»å°æå®çä¿çç¹ï¼å¦ææ²¡æè®¾ç½®ä¿çç¹ï¼ååéå° start transaction è¯­å¥å¤ã\n * commit - æäº¤äºå¡ã\n\näºå¡å¤çç¤ºä¾ï¼\n\nï¼1ï¼åå»ºä¸å¼ ç¤ºä¾è¡¨\n\n-- æ¤éè¡¨ user\ndrop table if exists user;\n\n-- åå»ºè¡¨ user\ncreate table user (\n  id int(10) unsigned not null comment 'id',\n  username varchar(64) not null default 'default' comment 'ç¨æ·å',\n  password varchar(64) not null default 'default' comment 'å¯ç ',\n  email varchar(64) not null default 'default' comment 'é®ç®±'\n) comment='ç¨æ·è¡¨';\n\n\nï¼2ï¼æ§è¡äºå¡æä½\n\n-- å¼å§äºå¡\nstart transaction;\n\n-- æå¥æä½ a\ninsert into `user`\nvalues (1, 'root1', 'root1', 'xxxx@163.com');\n\n-- åå»ºä¿çç¹ updatea\nsavepoint updatea;\n\n-- æå¥æä½ b\ninsert into `user`\nvalues (2, 'root2', 'root2', 'xxxx@163.com');\n\n-- åæ»å°ä¿çç¹ updatea\nrollback to updatea;\n\n-- æäº¤äºå¡ï¼åªææä½ a çæ\ncommit;\n\n\nï¼3ï¼æ§è¡ç»æ\n\nselect * from user;\n\n\nç»æï¼\n\n1\troot1\troot1\txxxx@163.com\n\n\n\n# autocommit\n\nmysql é»è®¤éç¨éå¼æäº¤ç­ç¥ï¼autocommitï¼ãæ¯æ§è¡ä¸æ¡è¯­å¥å°±æè¿æ¡è¯­å¥å½æä¸ä¸ªäºå¡ç¶åè¿è¡æäº¤ãå½åºç° start transaction è¯­å¥æ¶ï¼ä¼å³é­éå¼æäº¤ï¼å½ commit æ rollback è¯­å¥æ§è¡åï¼äºå¡ä¼èªå¨å³é­ï¼éæ°æ¢å¤éå¼æäº¤ã\n\néè¿ set autocommit=0 å¯ä»¥åæ¶èªå¨æäº¤ï¼ç´å° set autocommit=1 æä¼æäº¤ï¼autocommit æ è®°æ¯éå¯¹æ¯ä¸ªè¿æ¥èä¸æ¯éå¯¹æå¡å¨çã\n\n-- æ¥ç autocommit\nshow variables like 'autocommit';\n\n-- å³é­ autocommit\nset autocommit = 0;\n\n-- å¼å¯ autocommit\nset autocommit = 1;\n\n\n\n# acid\n\nacid æ¯æ°æ®åºäºå¡æ­£ç¡®æ§è¡çåä¸ªåºæ¬è¦ç´ ã\n\n * åå­æ§ï¼atomicityï¼\n   * äºå¡è¢«è§ä¸ºä¸å¯åå²çæå°ååï¼äºå¡ä¸­çæææä½è¦ä¹å¨é¨æäº¤æåï¼è¦ä¹å¨é¨å¤±è´¥åæ»ã\n   * åæ»å¯ä»¥ç¨æ¥å¿æ¥å®ç°ï¼æ¥å¿è®°å½çäºå¡ææ§è¡çä¿®æ¹æä½ï¼å¨åæ»æ¶ååæ§è¡è¿äºä¿®æ¹æä½å³å¯ã\n * ä¸è´æ§ï¼consistencyï¼\n   * æ°æ®åºå¨äºå¡æ§è¡ååé½ä¿æä¸è´æ§ç¶æã\n   * å¨ä¸è´æ§ç¶æä¸ï¼ææäºå¡å¯¹ä¸ä¸ªæ°æ®çè¯»åç»æé½æ¯ç¸åçã\n * éç¦»æ§ï¼isolationï¼\n   * ä¸ä¸ªäºå¡æåçä¿®æ¹å¨æç»æäº¤ä»¥åï¼å¯¹å¶å®äºå¡æ¯ä¸å¯è§çã\n * æä¹æ§ï¼durabilityï¼\n   * ä¸æ¦äºå¡æäº¤ï¼åå¶æåçä¿®æ¹å°ä¼æ°¸è¿ä¿å­å°æ°æ®åºä¸­ãå³ä½¿ç³»ç»åçå´©æºï¼äºå¡æ§è¡çç»æä¹ä¸è½ä¸¢å¤±ã\n   * å¯ä»¥éè¿æ°æ®åºå¤ä»½åæ¢å¤æ¥å®ç°ï¼å¨ç³»ç»åçå¥æºæ¶ï¼ä½¿ç¨å¤ä»½çæ°æ®åºè¿è¡æ°æ®æ¢å¤ã\n\nä¸ä¸ªæ¯æäºå¡ï¼transactionï¼ä¸­çæ°æ®åºç³»ç»ï¼å¿éè¦å·æè¿åç§ç¹æ§ï¼å¦åå¨äºå¡è¿ç¨ï¼transaction processingï¼å½ä¸­æ æ³ä¿è¯æ°æ®çæ­£ç¡®æ§ï¼äº¤æè¿ç¨æå¯è½è¾¾ä¸å°äº¤æã\n\n * åªææ»¡è¶³ä¸è´æ§ï¼äºå¡çæ§è¡ç»æææ¯æ­£ç¡®çã\n * å¨æ å¹¶åçæåµä¸ï¼äºå¡ä¸²è¡æ§è¡ï¼éç¦»æ§ä¸å®è½å¤æ»¡è¶³ãæ­¤æ¶åªè¦è½æ»¡è¶³åå­æ§ï¼å°±ä¸å®è½æ»¡è¶³ä¸è´æ§ã\n * å¨å¹¶åçæåµä¸ï¼å¤ä¸ªäºå¡å¹¶è¡æ§è¡ï¼äºå¡ä¸ä»è¦æ»¡è¶³åå­æ§ï¼è¿éè¦æ»¡è¶³éç¦»æ§ï¼æè½æ»¡è¶³ä¸è´æ§ã\n * äºå¡æ»¡è¶³æä¹åæ¯ä¸ºäºè½åºå¯¹ç³»ç»å´©æºçæåµã\n\n\n\n> mysql é»è®¤éç¨èªå¨æäº¤æ¨¡å¼ï¼auto commitï¼ãä¹å°±æ¯è¯´ï¼å¦æä¸æ¾å¼ä½¿ç¨ start transaction è¯­å¥æ¥å¼å§ä¸ä¸ªäºå¡ï¼é£ä¹æ¯ä¸ªæ¥è¯¢æä½é½ä¼è¢«å½åä¸ä¸ªäºå¡å¹¶èªå¨æäº¤ã\n\n\n# äºå¡éç¦»çº§å«\n\n\n# äºå¡éç¦»ç®ä»\n\nå¨å¹¶åç¯å¢ä¸ï¼äºå¡çéç¦»æ§å¾é¾ä¿è¯ï¼å æ­¤ä¼åºç°å¾å¤å¹¶åä¸è´æ§é®é¢ï¼\n\n * ä¸¢å¤±ä¿®æ¹\n * èè¯»\n * ä¸å¯éå¤è¯»\n * å¹»è¯»\n\nå¨ sql æ åä¸­ï¼å®ä¹äºåç§äºå¡éç¦»çº§å«ï¼çº§å«ç±ä½å°é«ï¼ï¼\n\n * è¯»æªæäº¤\n * è¯»æäº¤\n * å¯éå¤è¯»\n * ä¸²è¡å\n\nmysql ä¸­æ¥çåè®¾ç½®äºå¡éç¦»çº§å«ï¼\n\n-- æ¥çäºå¡éç¦»çº§å«\nshow variables like 'transaction_isolation';\n\n-- è®¾ç½®äºå¡éç¦»çº§å«ä¸º read uncommitted\nset session transaction isolation level read uncommitted;\n\n-- è®¾ç½®äºå¡éç¦»çº§å«ä¸º read committed\nset session transaction isolation level read committed;\n\n-- è®¾ç½®äºå¡éç¦»çº§å«ä¸º repeatable read\nset session transaction isolation level repeatable read;\n\n-- è®¾ç½®äºå¡éç¦»çº§å«ä¸º serializable\nset session transaction isolation level serializable;\n\n\n\n# è¯»æªæäº¤\n\nè¯»æªæäº¤ï¼read uncommittedï¼ æ¯æï¼äºå¡ä¸­çä¿®æ¹ï¼å³ä½¿æ²¡ææäº¤ï¼å¯¹å¶å®äºå¡ä¹æ¯å¯è§çã\n\nè¯»æªæäº¤çé®é¢ï¼äºå¡å¯ä»¥è¯»åæªæäº¤çæ°æ®ï¼ä¹è¢«ç§°ä¸º èè¯»ï¼dirty readï¼ã\n\nt1 ä¿®æ¹ä¸ä¸ªæ°æ®ï¼t2 éåè¯»åè¿ä¸ªæ°æ®ãå¦æ t1 æ¤éäºè¿æ¬¡ä¿®æ¹ï¼é£ä¹ t2 è¯»åçæ°æ®æ¯èæ°æ®ã\n\n\n\n\n# è¯»æäº¤\n\nè¯»æäº¤ï¼read committedï¼ æ¯æï¼äºå¡æäº¤åï¼å¶ä»äºå¡æè½çå°å®çä¿®æ¹ãæ¢å¥è¯è¯´ï¼ä¸ä¸ªäºå¡æåçä¿®æ¹å¨æäº¤ä¹åå¯¹å¶å®äºå¡æ¯ä¸å¯è§çãè¯»æäº¤è§£å³äºèè¯»çé®é¢ã\n\nè¯»æäº¤æ¯å¤§å¤æ°æ°æ®åºçé»è®¤äºå¡éç¦»çº§å«ã\n\nè¯»æäº¤ææ¶ä¹å«ä¸å¯éå¤è¯»ï¼å®çé®é¢æ¯ï¼æ§è¡ä¸¤æ¬¡ç¸åçæ¥è¯¢ï¼å¾å°çç»æå¯è½ä¸ä¸è´ã\n\nt2 è¯»åä¸ä¸ªæ°æ®ï¼t1 å¯¹è¯¥æ°æ®åäºä¿®æ¹ãå¦æ t2 åæ¬¡è¯»åè¿ä¸ªæ°æ®ï¼æ­¤æ¶è¯»åçç»æåç¬¬ä¸æ¬¡è¯»åçç»æä¸åã\n\n\n\n\n# å¯éå¤è¯»\n\nå¯éå¤è¯»ï¼repeatable readï¼ æ¯æï¼ä¿è¯å¨åä¸ä¸ªäºå¡ä¸­å¤æ¬¡è¯»ååæ ·æ°æ®çç»ææ¯ä¸æ ·çãå¯éå¤è¯»è§£å³äºä¸å¯éå¤è¯»é®é¢ã\n\nå¯éå¤è¯»æ¯ mysql çé»è®¤äºå¡éç¦»çº§å«ã\n\nå¯éå¤è¯»çé®é¢ï¼äºå¡ t1 è¯»åæä¸ªèå´åçè®°å½æ¶ï¼äºå¡ t2 å¨è¯¥èå´åæå¥äºæ°çè®°å½ï¼t1 åæ¬¡è¯»åè¿ä¸ªèå´çæ°æ®ï¼æ­¤æ¶è¯»åçç»æååç¬¬ä¸æ¬¡è¯»åçç»æä¸åï¼å³ä¸º å¹»è¯»ï¼phantom readï¼ã\n\n\n\n\n# ä¸²è¡å\n\nä¸²è¡åï¼serialixableï¼ æ¯æï¼å¼ºå¶äºå¡ä¸²è¡æ§è¡ï¼å¯¹äºåä¸è¡è®°å½ï¼å è¯»åéï¼ä¸æ¦åºç°éå²çªï¼å¿é¡»ç­åé¢çäºå¡éæ¾éã\n\nå¼ºå¶äºå¡ä¸²è¡æ§è¡ï¼åé¿åäºææçå¹¶åé®é¢ãä¸²è¡åç­ç¥ä¼å¨è¯»åçæ¯ä¸è¡æ°æ®ä¸é½å éï¼è¿å¯è½å¯¼è´å¤§éçè¶æ¶åéç«äºãè¿å¯¹äºé«å¹¶ååºç¨åºæ¬ä¸æ¯ä¸å¯æ¥åçï¼æä»¥ä¸è¬ä¸ä¼éç¨è¿ä¸ªçº§å«ã\n\n\n# éç¦»çº§å«å°ç»\n\n * è¯»æªæäº¤ï¼read uncommittedï¼ - äºå¡ä¸­çä¿®æ¹ï¼å³ä½¿æ²¡ææäº¤ï¼å¯¹å¶å®äºå¡ä¹æ¯å¯è§çã\n * è¯»æäº¤ï¼read committedï¼ - ä¸ä¸ªäºå¡åªè½è¯»åå·²ç»æäº¤çäºå¡æåçä¿®æ¹ãæ¢å¥è¯è¯´ï¼ä¸ä¸ªäºå¡æåçä¿®æ¹å¨æäº¤ä¹åå¯¹å¶å®äºå¡æ¯ä¸å¯è§çã\n * éå¤è¯»ï¼repeatable readï¼ - ä¿è¯å¨åä¸ä¸ªäºå¡ä¸­å¤æ¬¡è¯»ååæ ·æ°æ®çç»ææ¯ä¸æ ·çã\n * ä¸²è¡åï¼serialixableï¼ - å¯¹äºåä¸è¡è®°å½ï¼å è¯»åéï¼ä¸æ¦åºç°éå²çªï¼å¿é¡»ç­åé¢çäºå¡éæ¾éã\n\næ°æ®åºéç¦»çº§å«è§£å³çé®é¢ï¼\n\néç¦»çº§å«   ä¸¢å¤±ä¿®æ¹   èè¯»   ä¸å¯éå¤è¯»   å¹»è¯»\nè¯»æªæäº¤   âï¸     â    â       â\nè¯»æäº¤    âï¸     âï¸   â       â\nå¯éå¤è¯»   âï¸     âï¸   âï¸      â\nå¯ä¸²è¡å   âï¸     âï¸   âï¸      âï¸\n\n\n# æ­»é\n\næ­»éæ¯æä¸¤ä¸ªæå¤ä¸ªäºå¡ç«äºåä¸èµæºï¼å¹¶è¯·æ±éå®å¯¹æ¹å ç¨çèµæºï¼ä»èå¯¼è´æ¶æ§å¾ªç¯çç°è±¡ã\n\näº§çæ­»éçåºæ¯ï¼\n\n * å½å¤ä¸ªäºå¡è¯å¾ä»¥ä¸åçé¡ºåºéå®èµæºæ¶ï¼å°±å¯è½ä¼äº§çæ­»éã\n\n * å¤ä¸ªäºå¡åæ¶éå®åä¸ä¸ªèµæºæ¶ï¼ä¹ä¼äº§çæ­»éã\n\n\n# æ­»éçåå \n\nè¡éçå·ä½å®ç°ç®æ³æä¸ç§ï¼record lockãgap lock ä»¥å next-key lockãrecord lock æ¯ä¸é¨å¯¹ç´¢å¼é¡¹å éï¼gap lock æ¯å¯¹ç´¢å¼é¡¹ä¹é´çé´éå éï¼next-key lock åæ¯åé¢ä¸¤ç§çç»åï¼å¯¹ç´¢å¼é¡¹ä»¥å¶ä¹é´çé´éå éã\n\nåªå¨å¯éå¤è¯»æä»¥ä¸éç¦»çº§å«ä¸çç¹å®æä½æä¼åå¾ gap lock æ next-key lockï¼å¨ selectãupdate å delete æ¶ï¼é¤äºåºäºå¯ä¸ç´¢å¼çæ¥è¯¢ä¹å¤ï¼å¶å®ç´¢å¼æ¥è¯¢æ¶é½ä¼è·å gap lock æ next-key lockï¼å³éä½å¶æ«æçèå´ãä¸»é®ç´¢å¼ä¹å±äºå¯ä¸ç´¢å¼ï¼æä»¥ä¸»é®ç´¢å¼æ¯ä¸ä¼ä½¿ç¨ gap lock æ next-key lockã\n\nå¨ mysql ä¸­ï¼gap lock é»è®¤æ¯å¼å¯çï¼å³ innodb_locks_unsafe_for_binlog åæ°å¼æ¯ disable çï¼ä¸ mysql ä¸­é»è®¤çæ¯ rr äºå¡éç¦»çº§å«ã\n\nå½æä»¬æ§è¡ä»¥ä¸æ¥è¯¢ sql æ¶ï¼ç±äº order_no åä¸ºéå¯ä¸ç´¢å¼ï¼æ­¤æ¶åæ¯ rr äºå¡éç¦»çº§å«ï¼æä»¥ select çå éç±»åä¸º gap lockï¼è¿éç gap èå´æ¯ (4,+âï¼ã\n\n> select id from demo.order_record where order_no = 4 for update;\n\næ§è¡æ¥è¯¢ sql è¯­å¥è·åç gap lock å¹¶ä¸ä¼å¯¼è´é»å¡ï¼èå½æä»¬æ§è¡ä»¥ä¸æå¥ sql æ¶ï¼ä¼å¨æå¥é´éä¸åæ¬¡è·åæå¥æåéãæå¥æåéå¶å®ä¹æ¯ä¸ç§ gap éï¼å®ä¸ gap lock æ¯å²çªçï¼æä»¥å½å¶å®äºå¡ææè¯¥é´éç gap lock æ¶ï¼éè¦ç­å¾å¶å®äºå¡éæ¾ gap lock ä¹åï¼æè½è·åå°æå¥æåéã\n\nä»¥ä¸äºå¡ a åäºå¡ b é½ææé´é (4,+âï¼ç gap éï¼èæ¥ä¸æ¥çæå¥æä½ä¸ºäºè·åå°æå¥æåéï¼é½å¨ç­å¾å¯¹æ¹äºå¡ç gap ééæ¾ï¼äºæ¯å°±é æäºå¾ªç¯ç­å¾ï¼å¯¼è´æ­»éã\n\n> insert into demo.order_record(order_no, status, create_date) values (5, 1, â2019-07-13 10:57:03â);\n\n\n\nå¦ä¸ä¸ªæ­»éåºæ¯\n\ninnodb å­å¨å¼æçä¸»é®ç´¢å¼ä¸ºèç°ç´¢å¼ï¼å¶å®ç´¢å¼ä¸ºè¾å©ç´¢å¼ãå¦æä½¿ç¨è¾å©ç´¢å¼æ¥æ´æ°æ°æ®åºï¼å°±éè¦ä½¿ç¨èç°ç´¢å¼æ¥æ´æ°æ°æ®åºå­æ®µãå¦æä¸¤ä¸ªæ´æ°äºå¡ä½¿ç¨äºä¸åçè¾å©ç´¢å¼ï¼æä¸ä¸ªä½¿ç¨äºè¾å©ç´¢å¼ï¼ä¸ä¸ªä½¿ç¨äºèç°ç´¢å¼ï¼å°±é½æå¯è½å¯¼è´éèµæºçå¾ªç¯ç­å¾ãç±äºæ¬èº«ä¸¤ä¸ªäºå¡æ¯äºæ¥ï¼ä¹å°±ææäºä»¥ä¸æ­»éçåä¸ªå¿è¦æ¡ä»¶äºã\n\n\n\nåºç°æ­»éçæ­¥éª¤ï¼\n\n\n\nç»¼ä¸å¯ç¥ï¼å¨æ´æ°æä½æ¶ï¼æä»¬åºè¯¥å°½éä½¿ç¨ä¸»é®æ¥æ´æ°è¡¨å­æ®µï¼è¿æ ·å¯ä»¥ææé¿åä¸äºä¸å¿è¦çæ­»éåçã\n\n\n# é¿åæ­»é\n\né¢é²æ­»éçæ³¨æäºé¡¹ï¼\n\n * å¨ç¼ç¨ä¸­å°½éæç§åºå®çé¡ºåºæ¥å¤çæ°æ®åºè®°å½ï¼åè®¾æä¸¤ä¸ªæ´æ°æä½ï¼åå«æ´æ°ä¸¤æ¡ç¸åçè®°å½ï¼ä½æ´æ°é¡ºåºä¸ä¸æ ·ï¼æå¯è½å¯¼è´æ­»éï¼\n * å¨åè®¸å¹»è¯»åä¸å¯éå¤è¯»çæåµä¸ï¼å°½éä½¿ç¨ rc äºå¡éç¦»çº§å«ï¼å¯ä»¥é¿å gap lock å¯¼è´çæ­»éé®é¢ï¼\n * æ´æ°è¡¨æ¶ï¼å°½éä½¿ç¨ä¸»é®æ´æ°ï¼\n * é¿åé¿äºå¡ï¼å°½éå°é¿äºå¡æè§£ï¼å¯ä»¥éä½ä¸å¶å®äºå¡åçå²çªçæ¦çï¼\n * è®¾ç½®åççéç­å¾è¶æ¶åæ°ï¼æä»¬å¯ä»¥éè¿ innodb_lock_wait_timeout è®¾ç½®åççç­å¾è¶æ¶éå¼ï¼ç¹å«æ¯å¨ä¸äºé«å¹¶åçä¸å¡ä¸­ï¼æä»¬å¯ä»¥å°½éå°è¯¥å¼è®¾ç½®å¾å°ä¸äºï¼é¿åå¤§éäºå¡ç­å¾ï¼å ç¨ç³»ç»èµæºï¼é æä¸¥éçæ§è½å¼éã\n\nå¦å¤ï¼æä»¬è¿å¯ä»¥å° order_no åè®¾ç½®ä¸ºå¯ä¸ç´¢å¼åãè½ç¶ä¸è½é²æ­¢å¹»è¯»ï¼ä½æä»¬å¯ä»¥å©ç¨å®çå¯ä¸æ§æ¥ä¿è¯è®¢åè®°å½ä¸éå¤åå»ºï¼è¿ç§æ¹å¼å¯ä¸çç¼ºç¹å°±æ¯å½éå°éå¤åå»ºè®¢åæ¶ä¼æåºå¼å¸¸ã\n\næä»¬è¿å¯ä»¥ä½¿ç¨å¶å®çæ¹å¼æ¥ä»£æ¿æ°æ®åºå®ç°å¹ç­æ§æ ¡éªãä¾å¦ï¼ä½¿ç¨ redis ä»¥å zookeeper æ¥å®ç°ï¼è¿è¡æçæ¯æ°æ®åºæ´ä½³ã\n\n\n# è§£å³æ­»é\n\nå½åºç°æ­»éä»¥åï¼æä¸¤ç§ç­ç¥ï¼\n\n * ä¸ç§ç­ç¥æ¯ï¼ç´æ¥è¿å¥ç­å¾ï¼ç´å°è¶æ¶ãè¿ä¸ªè¶æ¶æ¶é´å¯ä»¥éè¿åæ° innodb_lock_wait_timeout æ¥è®¾ç½®ã\n * å¦ä¸ç§ç­ç¥æ¯ï¼åèµ·æ­»éæ£æµï¼åç°æ­»éåï¼ä¸»å¨åæ»æ­»éé¾æ¡ä¸­çæä¸ä¸ªäºå¡ï¼è®©å¶ä»äºå¡å¾ä»¥ç»§ç»­æ§è¡ãå°åæ° innodb_deadlock_detect è®¾ç½®ä¸º onï¼è¡¨ç¤ºå¼å¯è¿ä¸ªé»è¾ã\n\nå¨ innodb ä¸­ï¼innodb_lock_wait_timeout çé»è®¤å¼æ¯ 50sï¼æå³çå¦æéç¨ç¬¬ä¸ä¸ªç­ç¥ï¼å½åºç°æ­»éä»¥åï¼ç¬¬ä¸ä¸ªè¢«éä½ççº¿ç¨è¦è¿ 50s æä¼è¶æ¶éåºï¼ç¶åå¶ä»çº¿ç¨ææå¯è½ç»§ç»­æ§è¡ãå¯¹äºå¨çº¿æå¡æ¥è¯´ï¼è¿ä¸ªç­å¾æ¶é´å¾å¾æ¯æ æ³æ¥åçã\n\nä½æ¯ï¼æä»¬åä¸å¯è½ç´æ¥æè¿ä¸ªæ¶é´è®¾ç½®æä¸ä¸ªå¾å°çå¼ï¼æ¯å¦ 1sãè¿æ ·å½åºç°æ­»éçæ¶åï¼ç¡®å®å¾å¿«å°±å¯ä»¥è§£å¼ï¼ä½å¦æä¸æ¯æ­»éï¼èæ¯ç®åçéç­å¾å¢ï¼æä»¥ï¼è¶æ¶æ¶é´è®¾ç½®å¤ªç­çè¯ï¼ä¼åºç°å¾å¤è¯¯ä¼¤ã\n\næä»¥ï¼æ­£å¸¸æåµä¸æä»¬è¿æ¯è¦éç¨ç¬¬äºç§ç­ç¥ï¼å³ï¼ä¸»å¨æ­»éæ£æµï¼èä¸ innodb_deadlock_detect çé»è®¤å¼æ¬èº«å°±æ¯ onãä¸ºäºè§£å³æ­»éé®é¢ï¼ä¸åæ°æ®åºå®ç°äºåèªçæ­»éæ£æµåè¶æ¶æºå¶ãinnodb çå¤çç­ç¥æ¯ï¼å°æææå°è¡çº§æå®éçäºå¡è¿è¡åæ»ã\n\nä¸»å¨æ­»éæ£æµå¨åçæ­»éçæ¶åï¼æ¯è½å¤å¿«éåç°å¹¶è¿è¡å¤ççï¼ä½æ¯å®ä¹æ¯æé¢å¤è´æçãä½ å¯ä»¥æ³è±¡ä¸ä¸è¿ä¸ªè¿ç¨ï¼æ¯å½ä¸ä¸ªäºå¡è¢«éçæ¶åï¼å°±è¦ççå®æä¾èµççº¿ç¨ææ²¡æè¢«å«äººéä½ï¼å¦æ­¤å¾ªç¯ï¼æåå¤æ­æ¯å¦åºç°äºå¾ªç¯ç­å¾ï¼ä¹å°±æ¯æ­»éã\n\n\n# åå¸å¼äºå¡\n\nå¨åä¸æ°æ®èç¹ä¸­ï¼äºå¡ä»éäºå¯¹åä¸æ°æ®åºèµæºçè®¿é®æ§å¶ï¼ç§°ä¹ä¸º æ¬å°äºå¡ãå ä¹ææçæççå³ç³»åæ°æ®åºé½æä¾äºå¯¹æ¬å°äºå¡çåçæ¯æã\n\nåå¸å¼äºå¡æçæ¯äºå¡æä½è·¨è¶å¤ä¸ªèç¹ï¼å¹¶ä¸è¦æ±æ»¡è¶³äºå¡ç acid ç¹æ§ã\n\nåå¸å¼äºå¡çå¸¸è§æ¹æ¡å¦ä¸ï¼\n\n * ä¸¤é¶æ®µæäº¤ï¼2pcï¼ - å°äºå¡çæäº¤è¿ç¨åä¸ºä¸¤ä¸ªé¶æ®µæ¥è¿è¡å¤çï¼åå¤é¶æ®µåæäº¤é¶æ®µãåä¸èå°æä½æè´¥éç¥åè°èï¼åç±åè°èæ ¹æ®ææåä¸èçåé¦ææ¥å³å®ååä¸èæ¯å¦è¦æäº¤æä½è¿æ¯ä¸­æ­¢æä½ã\n * ä¸é¶æ®µæäº¤ï¼3pcï¼ - ä¸äºé¶æ®µæäº¤ä¸åçæ¯ï¼å¼å¥è¶æ¶æºå¶ãåæ¶å¨åè°èååä¸èä¸­é½å¼å¥è¶æ¶æºå¶ãå°äºé¶æ®µçåå¤é¶æ®µæåä¸º 2 ä¸ªé¶æ®µï¼æå¥äºä¸ä¸ª precommit é¶æ®µï¼ä½¿å¾ååå¨äºé¶æ®µæäº¤ä¸­ï¼åä¸èå¨åå¤ä¹åï¼ç±äºåè°èåçå´©æºæéè¯¯ï¼èå¯¼è´åä¸èå¤äºæ æ³ç¥ææ¯å¦æäº¤æèä¸­æ­¢çâä¸ç¡®å®ç¶æâæäº§ççå¯è½ç¸å½é¿çå»¶æ¶çé®é¢å¾ä»¥è§£å³ã\n * è¡¥å¿äºå¡ï¼tccï¼\n   * try - æä½ä½ä¸ºä¸é¶æ®µï¼è´è´£èµæºçæ£æ¥åé¢çã\n   * confirm - æä½ä½ä¸ºäºé¶æ®µæäº¤æä½ï¼æ§è¡çæ­£çä¸å¡ã\n   * cancel - æ¯é¢çèµæºçåæ¶ã\n * æ¬å°æ¶æ¯è¡¨ - å¨äºå¡ä¸»å¨åèµ·æ¹é¢å¤æ°å»ºäºå¡æ¶æ¯è¡¨ï¼äºå¡åèµ·æ¹å¤çä¸å¡åè®°å½äºå¡æ¶æ¯å¨æ¬å°äºå¡ä¸­å®æï¼è½®è¯¢äºå¡æ¶æ¯è¡¨çæ°æ®åéäºå¡æ¶æ¯ï¼äºå¡è¢«å¨æ¹åºäºæ¶æ¯ä¸­é´ä»¶æ¶è´¹äºå¡æ¶æ¯è¡¨ä¸­çäºå¡ã\n * mq äºå¡ - åºäº mq çåå¸å¼äºå¡æ¹æ¡å¶å®æ¯å¯¹æ¬å°æ¶æ¯è¡¨çå°è£ã\n * saga - saga äºå¡æ ¸å¿ææ³æ¯å°é¿äºå¡æåä¸ºå¤ä¸ªæ¬å°ç­äºå¡ï¼ç± saga äºå¡åè°å¨åè°ï¼å¦ææ­£å¸¸ç»æé£å°±æ­£å¸¸å®æï¼å¦ææä¸ªæ­¥éª¤å¤±è´¥ï¼åæ ¹æ®ç¸åé¡ºåºä¸æ¬¡è°ç¨è¡¥å¿æä½ã\n\nåå¸å¼äºå¡æ¹æ¡åæï¼\n\n * 2pc/3pc ä¾èµäºæ°æ®åºï¼è½å¤å¾å¥½çæä¾å¼ºä¸è´æ§åå¼ºäºå¡æ§ï¼ä½ç¸å¯¹æ¥è¯´å»¶è¿æ¯è¾é«ï¼æ¯è¾éåä¼ ç»çåä½åºç¨ï¼å¨åä¸ä¸ªæ¹æ³ä¸­å­å¨è·¨åºæä½çæåµï¼ä¸éåé«å¹¶ååé«æ§è½è¦æ±çåºæ¯ã\n * tcc éç¨äºæ§è¡æ¶é´ç¡®å®ä¸è¾ç­ï¼å®æ¶æ§è¦æ±é«ï¼å¯¹æ°æ®ä¸è´æ§è¦æ±é«ï¼æ¯å¦äºèç½éèä¼ä¸ææ ¸å¿çä¸ä¸ªæå¡ï¼äº¤æãæ¯ä»ãè´¦å¡ã\n * æ¬å°æ¶æ¯è¡¨/mq äºå¡ é½éç¨äºäºå¡ä¸­åä¸æ¹æ¯ææä½å¹ç­ï¼å¯¹ä¸è´æ§è¦æ±ä¸é«ï¼ä¸å¡ä¸è½å®¹å¿æ°æ®ä¸ä¸è´å°ä¸ä¸ªäººå·¥æ£æ¥å¨æï¼äºå¡æ¶åçåä¸æ¹ãåä¸ç¯èè¾å°ï¼ä¸å¡ä¸æå¯¹è´¦/æ ¡éªç³»ç»ååºã\n * saga äºå¡ ç±äº saga äºå¡ä¸è½ä¿è¯éç¦»æ§ï¼éè¦å¨ä¸å¡å±æ§å¶å¹¶åï¼éåäºä¸å¡åºæ¯äºå¡å¹¶åæä½åä¸èµæºè¾å°çæåµã saga ç¸æ¯ç¼ºå°é¢æäº¤å¨ä½ï¼å¯¼è´è¡¥å¿å¨ä½çå®ç°æ¯è¾éº»ç¦ï¼ä¾å¦ä¸å¡æ¯åéç­ä¿¡ï¼è¡¥å¿å¨ä½åå¾ååéä¸æ¬¡ç­ä¿¡è¯´ææ¤éï¼ç¨æ·ä½éªæ¯è¾å·®ãsaga äºå¡è¾éç¨äºè¡¥å¿å¨ä½å®¹æå¤ççåºæ¯ã\n\n> åå¸å¼äºå¡è¯¦ç»è¯´æãåæè¯·åèï¼åå¸å¼äºå¡åºæ¬åç\n\n\n# äºå¡æä½³å®è·µ\n\né«å¹¶ååºæ¯ä¸çäºå¡å°åºè¯¥å¦ä½è°ä¼ï¼\n\n\n# å°½éä½¿ç¨ä½çº§å«äºå¡éç¦»\n\nç»åä¸å¡åºæ¯ï¼å°½éä½¿ç¨ä½çº§å«äºå¡éç¦»\n\n\n# é¿åè¡éåçº§è¡¨é\n\nå¨ innodb ä¸­ï¼è¡éæ¯éè¿ç´¢å¼å®ç°çï¼å¦æä¸éè¿ç´¢å¼æ¡ä»¶æ£ç´¢æ°æ®ï¼è¡éå°ä¼åçº§å°è¡¨éãæä»¬ç¥éï¼è¡¨éæ¯ä¼ä¸¥éå½±åå°æ´å¼ è¡¨çæä½æ§è½çï¼æä»¥åºè¯¥å°½åé¿åã\n\n\n# ç¼©å°äºå¡èå´\n\nææ¶åï¼æ°æ®åºå¹¶åè®¿é®éå¤ªå¤§ï¼ä¼åºç°ä»¥ä¸å¼å¸¸ï¼\n\nmysqlqueryinterruptedexception: query execution was interrupted\n\n\né«å¹¶åæ¶å¯¹ä¸æ¡è®°å½è¿è¡æ´æ°çæåµä¸ï¼ç±äºæ´æ°è®°å½æå¨çäºå¡è¿å¯è½å­å¨å¶ä»æä½ï¼å¯¼è´ä¸ä¸ªäºå¡æ¯è¾é¿ï¼å½æå¤§éè¯·æ±è¿å¥æ¶ï¼å°±å¯è½å¯¼è´ä¸äºè¯·æ±åæ¶è¿å¥å°äºå¡ä¸­ã\n\nåå ä¸ºéçç«äºæ¯ä¸å¬å¹³çï¼å½å¤ä¸ªäºå¡åæ¶å¯¹ä¸æ¡è®°å½è¿è¡æ´æ°æ¶ï¼æç«¯æåµä¸ï¼ä¸ä¸ªæ´æ°æä½è¿å»æéç³»ç»åï¼å¯è½ä¼ä¸ç´æ¿ä¸å°éï¼æåå è¶æ¶è¢«ç³»ç»ææ­è¸¢åºã\n\n\n\nå¦ä¸å¾ä¸­çæä½ï¼è½ç¶é½æ¯å¨ä¸ä¸ªäºå¡ä¸­ï¼ä½éçç³è¯·å¨ä¸åæ¶é´ï¼åªæå½å¶ä»æä½é½æ§è¡å®ï¼æä¼éæ¾ææéãå ä¸ºæ£é¤åºå­æ¯æ´æ°æä½ï¼å±äºè¡éï¼è¿å°ä¼å½±åå°å¶ä»æä½è¯¥æ°æ®çäºå¡ï¼æä»¥æä»¬åºè¯¥å°½éé¿åé¿æ¶é´å°ææè¯¥éï¼å°½å¿«éæ¾è¯¥éãåå ä¸ºåæ°å»ºè®¢åååæ£é¤åºå­é½ä¸ä¼å½±åä¸å¡ï¼æä»¥æä»¬å¯ä»¥å°æ£é¤åºå­æä½æ¾å°æåï¼ä¹å°±æ¯ä½¿ç¨æ§è¡é¡ºåº 1ï¼ä»¥æ­¤å°½éåå°éçæææ¶é´ã\n\nå¨ innodb äºå¡ä¸­ï¼è¡éæ¯å¨éè¦çæ¶åæå ä¸çï¼ä½å¹¶ä¸æ¯ä¸éè¦äºå°±ç«å»éæ¾ï¼èæ¯è¦ç­å°äºå¡ç»ææ¶æéæ¾ãè¿ä¸ªå°±æ¯ä¸¤é¶æ®µéåè®®ã\n\nç¥éäºè¿ä¸ªè®¾å®ï¼å¯¹æä»¬ä½¿ç¨äºå¡æä»ä¹å¸®å©å¢ï¼é£å°±æ¯ï¼å¦æä½ çäºå¡ä¸­éè¦éå¤ä¸ªè¡ï¼è¦ææå¯è½é æéå²çªãæå¯è½å½±åå¹¶ååº¦çéå°½éå¾åæ¾ã\n\n\n# åèèµæ\n\n * ãé«æ§è½ mysqlã\n * ãjava æ§è½è°ä¼å®æã\n * shardingsphere åå¸å¼äºå¡",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Mysql ç´¢å¼",frontmatter:{title:"Mysql ç´¢å¼",date:"2020-07-16T11:14:07.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql","ç´¢å¼"],permalink:"/pages/fcb19c/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/02.Mysql/05.Mysql%E7%B4%A2%E5%BC%95.html",relativePath:"12.æ°æ®åº/03.å³ç³»åæ°æ®åº/02.Mysql/05.Mysqlç´¢å¼.md",key:"v-54c62a9f",path:"/pages/fcb19c/",headers:[{level:2,title:"ç´¢å¼ç®ä»",slug:"ç´¢å¼ç®ä»",normalizedTitle:"ç´¢å¼ç®ä»",charIndex:261},{level:3,title:"ç´¢å¼çä¼ç¼ºç¹",slug:"ç´¢å¼çä¼ç¼ºç¹",normalizedTitle:"ç´¢å¼çä¼ç¼ºç¹",charIndex:385},{level:3,title:"ä½æ¶ä½¿ç¨ç´¢å¼",slug:"ä½æ¶ä½¿ç¨ç´¢å¼",normalizedTitle:"ä½æ¶ä½¿ç¨ç´¢å¼",charIndex:895},{level:2,title:"ç´¢å¼çæ°æ®ç»æ",slug:"ç´¢å¼çæ°æ®ç»æ",normalizedTitle:"ç´¢å¼çæ°æ®ç»æ",charIndex:1206},{level:3,title:"æ°ç»",slug:"æ°ç»",normalizedTitle:"æ°ç»",charIndex:1283},{level:3,title:"åå¸ç´¢å¼",slug:"åå¸ç´¢å¼",normalizedTitle:"åå¸ç´¢å¼",charIndex:1475},{level:3,title:"B æ ç´¢å¼",slug:"b-æ ç´¢å¼",normalizedTitle:"b æ ç´¢å¼",charIndex:2355},{level:4,title:"äºåæç´¢æ ",slug:"äºåæç´¢æ ",normalizedTitle:"äºåæç´¢æ ",charIndex:2631},{level:4,title:"B+ æ ",slug:"b-æ ",normalizedTitle:"b+ æ ",charIndex:3031},{level:3,title:"å¨æç´¢å¼",slug:"å¨æç´¢å¼",normalizedTitle:"å¨æç´¢å¼",charIndex:4111},{level:3,title:"ç©ºé´æ°æ®ç´¢å¼",slug:"ç©ºé´æ°æ®ç´¢å¼",normalizedTitle:"ç©ºé´æ°æ®ç´¢å¼",charIndex:4272},{level:2,title:"ç´¢å¼çç±»å",slug:"ç´¢å¼çç±»å",normalizedTitle:"ç´¢å¼çç±»å",charIndex:4383},{level:3,title:"ä¸»é®ç´¢å¼ï¼PRIMARYï¼",slug:"ä¸»é®ç´¢å¼-primary",normalizedTitle:"ä¸»é®ç´¢å¼ï¼primaryï¼",charIndex:4416},{level:3,title:"å¯ä¸ç´¢å¼ï¼UNIQUEï¼",slug:"å¯ä¸ç´¢å¼-unique",normalizedTitle:"å¯ä¸ç´¢å¼ï¼uniqueï¼",charIndex:4607},{level:3,title:"æ®éç´¢å¼ï¼INDEXï¼",slug:"æ®éç´¢å¼-index",normalizedTitle:"æ®éç´¢å¼ï¼indexï¼",charIndex:4739},{level:3,title:"å¨æç´¢å¼ï¼FULLTEXTï¼",slug:"å¨æç´¢å¼-fulltext",normalizedTitle:"å¨æç´¢å¼ï¼fulltextï¼",charIndex:4848},{level:3,title:"èåç´¢å¼",slug:"èåç´¢å¼",normalizedTitle:"èåç´¢å¼",charIndex:5262},{level:2,title:"ç´¢å¼çç­ç¥",slug:"ç´¢å¼çç­ç¥",normalizedTitle:"ç´¢å¼çç­ç¥",charIndex:193},{level:3,title:"ç´¢å¼åºæ¬åå",slug:"ç´¢å¼åºæ¬åå",normalizedTitle:"ç´¢å¼åºæ¬åå",charIndex:5678},{level:3,title:"ç¬ç«çå",slug:"ç¬ç«çå",normalizedTitle:"ç¬ç«çå",charIndex:5890},{level:3,title:"è¦çç´¢å¼",slug:"è¦çç´¢å¼",normalizedTitle:"è¦çç´¢å¼",charIndex:6132},{level:3,title:"ä½¿ç¨ç´¢å¼æ¥æåº",slug:"ä½¿ç¨ç´¢å¼æ¥æåº",normalizedTitle:"ä½¿ç¨ç´¢å¼æ¥æåº",charIndex:6900},{level:3,title:"åç¼ç´¢å¼",slug:"åç¼ç´¢å¼",normalizedTitle:"åç¼ç´¢å¼",charIndex:7227},{level:3,title:"æå·¦åç¼å¹éåå",slug:"æå·¦åç¼å¹éåå",normalizedTitle:"æå·¦åç¼å¹éåå",charIndex:7998},{level:3,title:"= å in å¯ä»¥ä¹±åº",slug:"å-in-å¯ä»¥ä¹±åº",normalizedTitle:"= å in å¯ä»¥ä¹±åº",charIndex:8920},{level:2,title:"ç´¢å¼æä½³å®è·µ",slug:"ç´¢å¼æä½³å®è·µ",normalizedTitle:"ç´¢å¼æä½³å®è·µ",charIndex:9159},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:9448}],headersStr:"ç´¢å¼ç®ä» ç´¢å¼çä¼ç¼ºç¹ ä½æ¶ä½¿ç¨ç´¢å¼ ç´¢å¼çæ°æ®ç»æ æ°ç» åå¸ç´¢å¼ B æ ç´¢å¼ äºåæç´¢æ  B+ æ  å¨æç´¢å¼ ç©ºé´æ°æ®ç´¢å¼ ç´¢å¼çç±»å ä¸»é®ç´¢å¼ï¼PRIMARYï¼ å¯ä¸ç´¢å¼ï¼UNIQUEï¼ æ®éç´¢å¼ï¼INDEXï¼ å¨æç´¢å¼ï¼FULLTEXTï¼ èåç´¢å¼ ç´¢å¼çç­ç¥ ç´¢å¼åºæ¬åå ç¬ç«çå è¦çç´¢å¼ ä½¿ç¨ç´¢å¼æ¥æåº åç¼ç´¢å¼ æå·¦åç¼å¹éåå = å in å¯ä»¥ä¹±åº ç´¢å¼æä½³å®è·µ åèèµæ",content:"# Mysql ç´¢å¼\n\n> ç´¢å¼æ¯æé« MySQL æ¥è¯¢æ§è½çä¸ä¸ªéè¦éå¾ï¼ä½è¿å¤çç´¢å¼å¯è½ä¼å¯¼è´è¿é«çç£çä½¿ç¨çä»¥åè¿é«çåå­å ç¨ï¼ä»èå½±ååºç¨ç¨åºçæ´ä½æ§è½ãåºå½å°½éé¿åäºåææ³èµ·æ·»å ç´¢å¼ï¼å ä¸ºäºåå¯è½éè¦çæ§å¤§éç SQL æè½å®ä½å°é®é¢æå¨ï¼èä¸æ·»å ç´¢å¼çæ¶é´è¯å®æ¯è¿å¤§äºåå§æ·»å ç´¢å¼æéè¦çæ¶é´ï¼å¯è§ç´¢å¼çæ·»å ä¹æ¯éå¸¸æææ¯å«éçã\n> \n> æ¥ä¸æ¥å°åä½ å±ç¤ºä¸ç³»ååå»ºé«æ§è½ç´¢å¼çç­ç¥ï¼ä»¥åæ¯æ¡ç­ç¥å¶èåçå·¥ä½åçãä½å¨æ­¤ä¹åï¼åäºè§£ä¸ç´¢å¼ç¸å³çä¸äºç®æ³åæ°æ®ç»æï¼å°æå©äºæ´å¥½ççè§£åæçåå®¹ã\n\n\n\n\n# ç´¢å¼ç®ä»\n\nç´¢å¼æ¯æ°æ®åºä¸ºäºæé«æ¥æ¾æççä¸ç§æ°æ®ç»æã\n\nç´¢å¼å¯¹äºè¯å¥½çæ§è½éå¸¸å³é®ï¼å¨æ°æ®éå°ä¸è´è½½è¾ä½æ¶ï¼ä¸æ°å½çç´¢å¼å¯¹äºæ§è½çå½±åå¯è½è¿ä¸ææ¾ï¼ä½éçæ°æ®ééæ¸å¢å¤§ï¼æ§è½åä¼æ¥å§ä¸éãå æ­¤ï¼ç´¢å¼ä¼ååºè¯¥æ¯æ¥è¯¢æ§è½ä¼åçæææææ®µã\n\n\n# ç´¢å¼çä¼ç¼ºç¹\n\nB æ æ¯æå¸¸è§çç´¢å¼ï¼æç§é¡ºåºå­å¨æ°æ®ï¼æä»¥ Mysql å¯ä»¥ç¨æ¥å ORDER BY å GROUP BY æä½ãå ä¸ºæ°æ®æ¯æåºçï¼æä»¥ B æ ä¹å°±ä¼å°ç¸å³çåå¼é½å­å¨å¨ä¸èµ·ãæåï¼å ä¸ºç´¢å¼ä¸­å­å¨äºå®éçåå¼ï¼æä»¥æäºæ¥è¯¢åªä½¿ç¨ç´¢å¼å°±è½å¤å®æå¨é¨æ¥è¯¢ã\n\nâ ç´¢å¼çä¼ç¹ï¼\n\n * ç´¢å¼å¤§å¤§åå°äºæå¡å¨éè¦æ«æçæ°æ®éï¼ä»èå å¿«æ£ç´¢éåº¦ã\n * ç´¢å¼å¯ä»¥å¸®å©æå¡å¨é¿åæåºåä¸´æ¶è¡¨ã\n * ç´¢å¼å¯ä»¥å°éæº I/O åä¸ºé¡ºåº I/Oã\n * æ¯æè¡çº§éçæ°æ®åºï¼å¦ InnoDB ä¼å¨è®¿é®è¡çæ¶åå éãä½¿ç¨ç´¢å¼å¯ä»¥åå°è®¿é®çè¡æ°ï¼ä»èåå°éçç«äºï¼æé«å¹¶åã\n * å¯ä¸ç´¢å¼å¯ä»¥ç¡®ä¿æ¯ä¸è¡æ°æ®çå¯ä¸æ§ï¼éè¿ä½¿ç¨ç´¢å¼ï¼å¯ä»¥å¨æ¥è¯¢çè¿ç¨ä¸­ä½¿ç¨ä¼åéèå¨ï¼æé«ç³»ç»çæ§è½ã\n\nâ ç´¢å¼çç¼ºç¹ï¼\n\n * åå»ºåç»´æ¤ç´¢å¼è¦èè´¹æ¶é´ï¼è¿ä¼éçæ°æ®éçå¢å èå¢å ã\n * ç´¢å¼éè¦å ç¨é¢å¤çç©çç©ºé´ï¼é¤äºæ°æ®è¡¨å æ°æ®ç©ºé´ä¹å¤ï¼æ¯ä¸ä¸ªç´¢å¼è¿è¦å ä¸å®çç©çç©ºé´ï¼å¦æè¦å»ºç«ç»åç´¢å¼é£ä¹éè¦çç©ºé´å°±ä¼æ´å¤§ã\n * åæä½ï¼INSERT/UPDATE/DELETEï¼æ¶å¾å¯è½éè¦æ´æ°ç´¢å¼ï¼å¯¼è´æ°æ®åºçåæä½æ§è½éä½ã\n\n\n# ä½æ¶ä½¿ç¨ç´¢å¼\n\n> ç´¢å¼è½å¤è½»æå°æ¥è¯¢æ§è½æåå ä¸ªæ°éçº§ã\n\nâ ä»ä¹æåµéç¨ç´¢å¼ï¼\n\n * é¢ç¹è¯»æä½ï¼ SELECT ï¼\n * è¡¨çæ°æ®éæ¯è¾å¤§ã\n * ååç»å¸¸åºç°å¨ WHERE æè¿æ¥ï¼JOINï¼æ¡ä»¶ä¸­ã\n\nâ ä»ä¹æåµä¸éç¨ç´¢å¼ï¼\n\n * é¢ç¹åæä½ï¼ INSERT/UPDATE/DELETE ï¼ï¼ä¹å°±æå³çéè¦æ´æ°ç´¢å¼ã\n * ååä¸ç»å¸¸åºç°å¨ WHERE æè¿æ¥ï¼JOINï¼æ¡ä»¶ä¸­ï¼ä¹å°±æå³çç´¢å¼ä¼ç»å¸¸æ æ³å½ä¸­ï¼æ²¡ææä¹ï¼è¿å¢å ç©ºé´å¼éã\n * éå¸¸å°çè¡¨ï¼å¯¹äºéå¸¸å°çè¡¨ï¼å¤§é¨åæåµä¸ç®åçå¨è¡¨æ«ææ´é«æã\n * ç¹å¤§åçè¡¨ï¼å»ºç«åä½¿ç¨ç´¢å¼çä»£ä»·å°éä¹å¢é¿ãå¯ä»¥èèä½¿ç¨ååºææ¯æ Nosqlã\n\n\n# ç´¢å¼çæ°æ®ç»æ\n\nå¨ Mysql ä¸­ï¼ç´¢å¼æ¯å¨å­å¨å¼æå±èä¸æ¯æå¡å¨å±å®ç°çãæä»¥ï¼å¹¶æ²¡æç»ä¸çç´¢å¼æ åï¼ä¸åå­å¨å¼æçç´¢å¼çæ°æ®ç»æä¹ä¸ç¸åã\n\n\n# æ°ç»\n\næ°ç»æ¯ç¨è¿ç»­çåå­ç©ºé´æ¥å­å¨æ°æ®ï¼å¹¶ä¸æ¯æéæºè®¿é®ã\n\næåºæ°ç»å¯ä»¥ä½¿ç¨äºåæ¥æ¾æ³ï¼å¶æ¶é´å¤æåº¦ä¸º O(log n)ï¼æ è®ºæ¯ç­å¼æ¥è¯¢è¿æ¯èå´æ¥è¯¢ï¼é½éå¸¸é«æã\n\nä½æ°ç»æä¸¤ä¸ªéè¦éå¶ï¼\n\n * æ°ç»çç©ºé´å¤§å°åºå®ï¼å¦æè¦æ©å®¹åªè½éç¨å¤å¶æ°ç»çæ¹å¼ã\n * æå¥ãå é¤æ¶é´å¤æåº¦ä¸º O(n)ã\n\nè¿æå³çï¼å¦æä½¿ç¨æ°ç»ä½ä¸ºç´¢å¼ï¼å¦æè¦ä¿è¯æ°ç»æåºï¼å¶æ´æ°æä½ä»£ä»·é«æã\n\n\n# åå¸ç´¢å¼\n\nåå¸è¡¨æ¯ä¸ç§ä»¥é® - å¼ï¼key-valueï¼å¯¹å½¢å¼å­å¨æ°æ®çç»æï¼æä»¬åªè¦è¾å¥å¾æ¥æ¾çå¼å³ keyï¼å°±å¯ä»¥æ¾å°å¶å¯¹åºçå¼å³ Valueã\n\nåå¸è¡¨ ä½¿ç¨ åå¸å½æ° ç»ç»æ°æ®ï¼ä»¥æ¯æå¿«éæå¥åæç´¢çæ°æ®ç»æãåå¸è¡¨çæ¬è´¨æ¯ä¸ä¸ªæ°ç»ï¼å¶æè·¯æ¯ï¼ä½¿ç¨ Hash å½æ°å° Key è½¬æ¢ä¸ºæ°ç»ä¸æ ï¼å©ç¨æ°ç»çéæºè®¿é®ç¹æ§ï¼ä½¿å¾æä»¬è½å¨ O(1) çæ¶é´ä»£ä»·åå®ææ£ç´¢ã\n\n\n\næä¸¤ç§ä¸åç±»åçåå¸è¡¨ï¼åå¸éå å åå¸æ å°ã\n\n * åå¸éå æ¯éåæ°æ®ç»æçå®ç°ä¹ä¸ï¼ç¨äºå­å¨ééå¤å¼ã\n * åå¸æ å° æ¯æ å° æ°æ®ç»æçå®ç°ä¹ä¸ï¼ç¨äºå­å¨é®å¼å¯¹ã\n\nåå¸ç´¢å¼åºäºåå¸è¡¨å®ç°ï¼åªéç¨äºç­å¼æ¥è¯¢ãå¯¹äºæ¯ä¸è¡æ°æ®ï¼åå¸ç´¢å¼é½ä¼å°ææçç´¢å¼åè®¡ç®ä¸ä¸ªåå¸ç ï¼hashcodeï¼ï¼åå¸ç æ¯ä¸ä¸ªè¾å°çå¼ãåå¸ç´¢å¼å°ææçåå¸ç å­å¨å¨ç´¢å¼ä¸­ï¼åæ¶å¨åå¸è¡¨ä¸­ä¿å­æåæ¯ä¸ªæ°æ®è¡çæéã\n\nå¨ Mysql ä¸­ï¼åªæ Memory å­å¨å¼ææ¾ç¤ºæ¯æåå¸ç´¢å¼ã\n\nâ åå¸ç´¢å¼çä¼ç¹ï¼\n\n * å ä¸ºç´¢å¼æ°æ®ç»æç´§åï¼æä»¥æ¥è¯¢éåº¦éå¸¸å¿«ã\n\nâ åå¸ç´¢å¼çç¼ºç¹ï¼\n\n * åå¸ç´¢å¼å¼åå«åå¸å¼åè¡æéï¼èä¸å­å¨å­æ®µå¼ï¼æä»¥ä¸è½ä½¿ç¨ç´¢å¼ä¸­çå¼æ¥é¿åè¯»åè¡ãä¸è¿ï¼è®¿é®åå­ä¸­çè¡çéåº¦å¾å¿«ï¼æä»¥å¤§é¨åæåµä¸è¿ä¸ç¹å¯¹æ§è½å½±åä¸å¤§ã\n * åå¸ç´¢å¼æ°æ®ä¸æ¯æç§ç´¢å¼å¼é¡ºåºå­å¨çï¼æä»¥æ æ³ç¨äºæåºã\n * åå¸ç´¢å¼ä¸æ¯æé¨åç´¢å¼å¹éæ¥æ¾ï¼å ä¸ºåå¸ç´¢å¼æ¶ä½¿ç¨ç´¢å¼åçå¨é¨åå®¹æ¥è¿è¡åå¸è®¡ç®çãå¦ï¼å¨æ°æ®å (A,B) ä¸å»ºç«åå¸ç´¢å¼ï¼å¦ææ¥è¯¢åªææ°æ®å Aï¼æ æ³ä½¿ç¨è¯¥ç´¢å¼ã\n * åå¸ç´¢å¼åªæ¯æç­å¼æ¯è¾æ¥è¯¢ï¼åæ¬ =ãIN()ã<=>ï¼ä¸æ¯æä»»ä½èå´æ¥è¯¢ï¼å¦ WHERE price > 100ã\n * åå¸ç´¢å¼æå¯è½åºç°åå¸å²çª\n   * åºç°åå¸å²çªæ¶ï¼å¿é¡»éåé¾è¡¨ä¸­ææçè¡æéï¼éè¡æ¯è¾ï¼ç´å°æ¾å°ç¬¦åæ¡ä»¶çè¡ã\n   * å¦æåå¸å²çªå¤çè¯ï¼ç»´æ¤ç´¢å¼çä»£ä»·ä¼å¾é«ã\n\n> å ä¸ºç§ç§éå¶ï¼æä»¥åå¸ç´¢å¼åªéç¨äºç¹å®çåºåãèä¸æ¦ä½¿ç¨åå¸ç´¢å¼ï¼åå®å¸¦æ¥çæ§è½æåä¼éå¸¸æ¾èã\n\n\n# B æ ç´¢å¼\n\néå¸¸æä»¬æè¯´çç´¢å¼æ¯æB-Treeç´¢å¼ï¼å®æ¯ç®åå³ç³»åæ°æ®åºä¸­æ¥æ¾æ°æ®æä¸ºå¸¸ç¨åææçç´¢å¼ï¼å¤§å¤æ°å­å¨å¼æé½æ¯æè¿ç§ç´¢å¼ãä½¿ç¨B-Treeè¿ä¸ªæ¯è¯­ï¼æ¯å ä¸º MySQL å¨CREATE TABLEæå¶å®è¯­å¥ä¸­ä½¿ç¨äºè¿ä¸ªå³é®å­ï¼ä½å®éä¸ä¸åçå­å¨å¼æå¯è½ä½¿ç¨ä¸åçæ°æ®ç»æï¼æ¯å¦ InnoDB å°±æ¯ä½¿ç¨çB+Treeã\n\nB+Treeä¸­ç B æ¯æbalanceï¼æä¸ºå¹³è¡¡ãéè¦æ³¨æçæ¯ï¼B+æ ç´¢å¼å¹¶ä¸è½æ¾å°ä¸ä¸ªç»å®é®å¼çå·ä½è¡ï¼å®æ¾å°çåªæ¯è¢«æ¥æ¾æ°æ®è¡æå¨çé¡µï¼æ¥çæ°æ®åºä¼æé¡µè¯»å¥å°åå­ï¼åå¨åå­ä¸­è¿è¡æ¥æ¾ï¼æåå¾å°è¦æ¥æ¾çæ°æ®ã\n\n# äºåæç´¢æ \n\näºåæç´¢æ çç¹ç¹æ¯ï¼æ¯ä¸ªèç¹çå·¦å¿å­å°äºç¶èç¹ï¼ç¶èç¹åå°äºå³å¿å­ãå¶æ¥è¯¢æ¶é´å¤æåº¦æ¯ $$O(log(N))$$ã\n\nå½ç¶ä¸ºäºç»´æ $$O(log(N))$$ çæ¥è¯¢å¤æåº¦ï¼ä½ å°±éè¦ä¿æè¿æ£µæ æ¯å¹³è¡¡äºåæ ãä¸ºäºåè¿ä¸ªä¿è¯ï¼æ´æ°çæ¶é´å¤æåº¦ä¹æ¯ $$O(log(N))$$ã\n\néçæ°æ®åºä¸­æ°æ®çå¢å ï¼ç´¢å¼æ¬èº«å¤§å°éä¹å¢å ï¼ä¸å¯è½å¨é¨å­å¨å¨åå­ä¸­ï¼å æ­¤ç´¢å¼å¾å¾ä»¥ç´¢å¼æä»¶çå½¢å¼å­å¨çç£çä¸ãè¿æ ·çè¯ï¼ç´¢å¼æ¥æ¾è¿ç¨ä¸­å°±è¦äº§çç£ç I/O æ¶èï¼ç¸å¯¹äºåå­å­åï¼I/O å­åçæ¶èè¦é«å ä¸ªæ°éçº§ãå¯ä»¥æ³è±¡ä¸ä¸ä¸æ£µå ç¾ä¸èç¹çäºåæ çæ·±åº¦æ¯å¤å°ï¼å¦æå°è¿ä¹å¤§æ·±åº¦çä¸é¢äºåæ æ¾ç£çä¸ï¼æ¯è¯»åä¸ä¸ªèç¹ï¼éè¦ä¸æ¬¡ç£çç I/O è¯»åï¼æ´ä¸ªæ¥æ¾çèæ¶æ¾ç¶æ¯ä¸è½å¤æ¥åçãé£ä¹å¦ä½åå°æ¥æ¾è¿ç¨ä¸­ç I/O å­åæ¬¡æ°ï¼\n\nä¸ç§è¡ä¹ææçè§£å³æ¹æ³æ¯åå°æ çæ·±åº¦ï¼å°äºåæ åä¸º N åæ ï¼å¤è·¯æç´¢æ ï¼ï¼è B+ æ å°±æ¯ä¸ç§å¤è·¯æç´¢æ ã\n\n# B+ æ \n\nB+ æ ç´¢å¼éç¨äºå¨é®å¼æ¥æ¾ãé®å¼èå´æ¥æ¾åé®åç¼æ¥æ¾ï¼å¶ä¸­é®åç¼æ¥æ¾åªéç¨äºæå·¦åç¼æ¥æ¾ã\n\nçè§£B+Treeæ¶ï¼åªéè¦çè§£å¶æéè¦çä¸¤ä¸ªç¹å¾å³å¯ï¼\n\n * ç¬¬ä¸ï¼ææçå³é®å­ï¼å¯ä»¥çè§£ä¸ºæ°æ®ï¼é½å­å¨å¨å¶å­èç¹ï¼éå¶å­èç¹å¹¶ä¸å­å¨çæ­£çæ°æ®ï¼ææè®°å½èç¹é½æ¯æé®å¼å¤§å°é¡ºåºå­æ¾å¨åä¸å±å¶å­èç¹ä¸ã\n * å¶æ¬¡ï¼ææçå¶å­èç¹ç±æéè¿æ¥ãå¦ä¸å¾ä¸ºç®åäºçB+Treeã\n\n\n\næ ¹æ®å¶å­èç¹çåå®¹ï¼ç´¢å¼ç±»ååä¸ºä¸»é®ç´¢å¼åéä¸»é®ç´¢å¼ã\n\n * èç°ç´¢å¼ï¼clusteredï¼ï¼åç§°ä¸ºä¸»é®ç´¢å¼ï¼å¶å¶å­èç¹å­çæ¯æ´è¡æ°æ®ãå ä¸ºæ æ³åæ¶ææ°æ®è¡å­æ¾å¨ä¸¤ä¸ªä¸åçå°æ¹ï¼æä»¥ä¸ä¸ªè¡¨åªè½æä¸ä¸ªèç°ç´¢å¼ãInnoDB çèç°ç´¢å¼å®éæ¯å¨åä¸ä¸ªç»æä¸­ä¿å­äº B æ çç´¢å¼åæ°æ®è¡ã\n * éä¸»é®ç´¢å¼çå¶å­èç¹åå®¹æ¯ä¸»é®çå¼ãå¨ InnoDB éï¼éä¸»é®ç´¢å¼ä¹è¢«ç§°ä¸ºäºçº§ç´¢å¼ï¼secondaryï¼ãæ°æ®å­å¨å¨ä¸ä¸ªä½ç½®ï¼ç´¢å¼å­å¨å¨å¦ä¸ä¸ªä½ç½®ï¼ç´¢å¼ä¸­åå«æåæ°æ®å­å¨ä½ç½®çæéãå¯ä»¥æå¤ä¸ªï¼å°äº 249 ä¸ªã\n\nèç°è¡¨ç¤ºæ°æ®è¡åç¸é»çé®å¼ç´§åå°å­å¨å¨ä¸èµ·ï¼å ä¸ºæ°æ®ç´§åï¼æä»¥è®¿é®å¿«ãå ä¸ºæ æ³åæ¶ææ°æ®è¡å­æ¾å¨ä¸¤ä¸ªä¸åçå°æ¹ï¼æä»¥ä¸ä¸ªè¡¨åªè½æä¸ä¸ªèç°ç´¢å¼ã\n\nèç°ç´¢å¼åéèç°ç´¢å¼çæ¥è¯¢æä»ä¹åºå«\n\n * å¦æè¯­å¥æ¯ select * from T where ID=500ï¼å³èç°ç´¢å¼æ¥è¯¢æ¹å¼ï¼ååªéè¦æç´¢ ID è¿æ£µ B+ æ ï¼\n * å¦æè¯­å¥æ¯ select * from T where k=5ï¼å³éèç°ç´¢å¼æ¥è¯¢æ¹å¼ï¼åéè¦åæç´¢ k ç´¢å¼æ ï¼å¾å° ID çå¼ä¸º 500ï¼åå° ID ç´¢å¼æ æç´¢ä¸æ¬¡ãè¿ä¸ªè¿ç¨ç§°ä¸ºåè¡¨ã\n\nä¹å°±æ¯è¯´ï¼åºäºéèç°ç´¢å¼çæ¥è¯¢éè¦å¤æ«æä¸æ£µç´¢å¼æ ãå æ­¤ï¼æä»¬å¨åºç¨ä¸­åºè¯¥å°½éä½¿ç¨ä¸»é®æ¥è¯¢ã\n\næ¾ç¶ï¼ä¸»é®é¿åº¦è¶å°ï¼éèç°ç´¢å¼çå¶å­èç¹å°±è¶å°ï¼éèç°ç´¢å¼å ç¨çç©ºé´ä¹å°±è¶å°ã\n\nèªå¢ä¸»é®æ¯æèªå¢åä¸å®ä¹çä¸»é®ï¼å¨å»ºè¡¨è¯­å¥ä¸­ä¸è¬æ¯è¿ä¹å®ä¹çï¼ NOT NULL PRIMARY KEY AUTO_INCREMENTãä»æ§è½åå­å¨ç©ºé´æ¹é¢èéï¼èªå¢ä¸»é®å¾å¾æ¯æ´åççéæ©ãææ²¡æä»ä¹åºæ¯éåç¨ä¸å¡å­æ®µç´æ¥åä¸»é®çå¢ï¼è¿æ¯æçãæ¯å¦ï¼æäºä¸å¡çåºæ¯éæ±æ¯è¿æ ·çï¼\n\n * åªæä¸ä¸ªç´¢å¼ï¼\n * è¯¥ç´¢å¼å¿é¡»æ¯å¯ä¸ç´¢å¼ã\n\nç±äºæ²¡æå¶ä»ç´¢å¼ï¼æä»¥ä¹å°±ä¸ç¨èèå¶ä»ç´¢å¼çå¶å­èç¹å¤§å°çé®é¢ã\n\nè¿æ¶åæä»¬å°±è¦ä¼åèèä¸ä¸æ®µæå°çâå°½éä½¿ç¨ä¸»é®æ¥è¯¢âååï¼ç´æ¥å°è¿ä¸ªç´¢å¼è®¾ç½®ä¸ºä¸»é®ï¼å¯ä»¥é¿åæ¯æ¬¡æ¥è¯¢éè¦æç´¢ä¸¤æ£µæ ã\n\n\n# å¨æç´¢å¼\n\nMyISAM å­å¨å¼ææ¯æå¨æç´¢å¼ï¼ç¨äºæ¥æ¾ææ¬ä¸­çå³é®è¯ï¼èä¸æ¯ç´æ¥æ¯è¾æ¯å¦ç¸ç­ãæ¥æ¾æ¡ä»¶ä½¿ç¨ MATCH AGAINSTï¼èä¸æ¯æ®éç WHEREã\n\nå¨æç´¢å¼ä¸è¬ä½¿ç¨åæç´¢å¼å®ç°ï¼å®è®°å½çå³é®è¯å°å¶æå¨ææ¡£çæ å°ã\n\nInnoDB å­å¨å¼æå¨ MySQL 5.6.4 çæ¬ä¸­ä¹å¼å§æ¯æå¨æç´¢å¼ã\n\n\n# ç©ºé´æ°æ®ç´¢å¼\n\nMyISAM å­å¨å¼ææ¯æç©ºé´æ°æ®ç´¢å¼ï¼R-Treeï¼ï¼å¯ä»¥ç¨äºå°çæ°æ®å­å¨ãç©ºé´æ°æ®ç´¢å¼ä¼ä»ææç»´åº¦æ¥ç´¢å¼æ°æ®ï¼å¯ä»¥ææå°ä½¿ç¨ä»»æç»´åº¦æ¥è¿è¡ç»åæ¥è¯¢ã\n\nå¿é¡»ä½¿ç¨ GIS ç¸å³çå½æ°æ¥ç»´æ¤æ°æ®ã\n\n\n# ç´¢å¼çç±»å\n\nä¸»æµçå³ç³»åæ°æ®åºä¸è¬é½æ¯æä»¥ä¸ç´¢å¼ç±»åï¼\n\n\n# ä¸»é®ç´¢å¼ï¼PRIMARYï¼\n\nä¸»é®ç´¢å¼ï¼ä¸ç§ç¹æ®çå¯ä¸ç´¢å¼ï¼ä¸åè®¸æç©ºå¼ãä¸ä¸ªè¡¨åªè½æä¸ä¸ªä¸»é®ï¼å¨ InnoDB ä¸­æ¬è´¨ä¸å³èç°ç´¢å¼ï¼ï¼ä¸è¬æ¯å¨å»ºè¡¨çæ¶ååæ¶åå»ºä¸»é®ç´¢å¼ã\n\nCREATE TABLE `table` (\n    `id` int(11) NOT NULL AUTO_INCREMENT,\n    ...\n    PRIMARY KEY (`id`)\n)\n\n\n\n# å¯ä¸ç´¢å¼ï¼UNIQUEï¼\n\nå¯ä¸ç´¢å¼ï¼ç´¢å¼åçå¼å¿é¡»å¯ä¸ï¼ä½åè®¸æç©ºå¼ãå¦ææ¯ç»åç´¢å¼ï¼ååå¼çç»åå¿é¡»å¯ä¸ã\n\nCREATE TABLE `table` (\n    ...\n    UNIQUE indexName (title(length))\n)\n\n\n\n# æ®éç´¢å¼ï¼INDEXï¼\n\næ®éç´¢å¼ï¼æåºæ¬çç´¢å¼ï¼æ²¡æä»»ä½éå¶ã\n\nCREATE TABLE `table` (\n    ...\n    INDEX index_name (title(length))\n)\n\n\n\n# å¨æç´¢å¼ï¼FULLTEXTï¼\n\nå¨æç´¢å¼ï¼ä¸»è¦ç¨æ¥æ¥æ¾ææ¬ä¸­çå³é®å­ï¼èä¸æ¯ç´æ¥ä¸ç´¢å¼ä¸­çå¼ç¸æ¯è¾ã\n\nå¨æç´¢å¼è·å¶å®ç´¢å¼å¤§ä¸ç¸åï¼å®æ´åæ¯ä¸ä¸ªæç´¢å¼æï¼èä¸æ¯ç®åç WHERE è¯­å¥çåæ°å¹éãå¨æç´¢å¼éå match against æä½ä½¿ç¨ï¼èä¸æ¯ä¸è¬ç WHERE è¯­å¥å  LIKEãå®å¯ä»¥å¨ CREATE TABLEï¼ALTER TABLE ï¼CREATE INDEX ä½¿ç¨ï¼ä¸è¿ç®ååªæ charãvarcharï¼text åä¸å¯ä»¥åå»ºå¨æç´¢å¼ãå¼å¾ä¸æçæ¯ï¼å¨æ°æ®éè¾å¤§æ¶åï¼ç°å°æ°æ®æ¾å¥ä¸ä¸ªæ²¡æå¨å±ç´¢å¼çè¡¨ä¸­ï¼ç¶ååç¨ CREATE INDEX åå»ºå¨æç´¢å¼ï¼è¦æ¯åä¸ºä¸å¼ è¡¨å»ºç«å¨æç´¢å¼ç¶ååå°æ°æ®åå¥çéåº¦å¿«å¾å¤ã\n\nCREATE TABLE `table` (\n    `content` text CHARACTER NULL,\n    ...\n    FULLTEXT (content)\n)\n\n\n\n# èåç´¢å¼\n\nç»åç´¢å¼ï¼å¤ä¸ªå­æ®µä¸åå»ºçç´¢å¼ï¼åªæå¨æ¥è¯¢æ¡ä»¶ä¸­ä½¿ç¨äºåå»ºç´¢å¼æ¶çç¬¬ä¸ä¸ªå­æ®µï¼ç´¢å¼æä¼è¢«ä½¿ç¨ãä½¿ç¨ç»åç´¢å¼æ¶éµå¾ªæå·¦åç¼éåã\n\nCREATE TABLE `table` (\n    ...\n    INDEX index_name (title(length), title(length), ...)\n)\n\n\n\n# ç´¢å¼çç­ç¥\n\nåè®¾æä»¥ä¸è¡¨ï¼\n\nCREATE TABLE `t` (\n  `id` int(11) NOT NULL,\n  `city` varchar(16) NOT NULL,\n  `name` varchar(16) NOT NULL,\n  `age` int(11) NOT NULL,\n  `addr` varchar(128) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  KEY `city` (`city`)\n) ENGINE=InnoDB;\n\n\n\n# ç´¢å¼åºæ¬åå\n\n * ç´¢å¼ä¸æ¯è¶å¤è¶å¥½ï¼ä¸è¦ä¸ºææåé½åå»ºç´¢å¼ãè¦èèå°ç´¢å¼çç»´æ¤ä»£ä»·ãç©ºé´å ç¨åæ¥è¯¢æ¶åè¡¨çä»£ä»·ãç´¢å¼ä¸å®æ¯æéåå»ºçï¼å¹¶ä¸è¦å°½å¯è½ç¡®ä¿è¶³å¤è½»éãä¸æ¦åå»ºäºå¤å­æ®µçèåç´¢å¼ï¼æä»¬è¦èèå°½å¯è½å©ç¨ç´¢å¼æ¬èº«å®ææ°æ®æ¥è¯¢ï¼åå°åè¡¨çææ¬ã\n * è¦å°½éé¿ååä½åéå¤ç´¢å¼ã\n * è¦èèå é¤æªä½¿ç¨çç´¢å¼ã\n * å°½éçæ©å±ç´¢å¼ï¼ä¸è¦æ°å»ºç´¢å¼ã\n * é¢ç¹ä½ä¸º WHERE è¿æ»¤æ¡ä»¶çååºè¯¥èèæ·»å ç´¢å¼ã\n\n\n# ç¬ç«çå\n\nâç¬ç«çåâ æ¯æç´¢å¼åä¸è½æ¯è¡¨è¾¾å¼çä¸é¨åï¼ä¹ä¸è½æ¯å½æ°çåæ°ã\n\nå¯¹ç´¢å¼å­æ®µåå½æ°æä½ï¼å¯è½ä¼ç ´åç´¢å¼å¼çæåºæ§ï¼å æ­¤ä¼åå¨å°±å³å®æ¾å¼èµ°æ æç´¢åè½ã\n\nå¦ææ¥è¯¢ä¸­çåä¸æ¯ç¬ç«çåï¼åæ°æ®åºä¸ä¼ä½¿ç¨ç´¢å¼ã\n\nâ éè¯¯ç¤ºä¾ï¼\n\nSELECT actor_id FROM actor WHERE actor_id + 1 = 5;\nSELECT ... WHERE TO_DAYS(current_date) - TO_DAYS(date_col) <= 10;\n\n\n\n# è¦çç´¢å¼\n\nè¦çç´¢å¼æ¯æï¼ç´¢å¼ä¸çä¿¡æ¯è¶³å¤æ»¡è¶³æ¥è¯¢è¯·æ±ï¼ä¸éè¦åè¡¨æ¥è¯¢æ°æ®ã\n\nãç¤ºä¾ãèå´æ¥è¯¢\n\ncreate table T (\nID int primary key,\nk int NOT NULL DEFAULT 0,\ns varchar(16) NOT NULL DEFAULT '',\nindex k(k))\nengine=InnoDB;\n\ninsert into T values(100,1, 'aa'),(200,2,'bb'),(300,3,'cc'),(500,5,'ee'),(600,6,'ff'),(700,7,'gg');\n\nselect * from T where k between 3 and 5\n\n\néè¦æ§è¡å æ¬¡æ çæç´¢æä½ï¼ä¼æ«æå¤å°è¡ï¼\n\n 1. å¨ k ç´¢å¼æ ä¸æ¾å° k=3 çè®°å½ï¼åå¾ ID = 300ï¼\n 2. åå° ID ç´¢å¼æ æ¥å° ID=300 å¯¹åºç R3ï¼\n 3. å¨ k ç´¢å¼æ åä¸ä¸ä¸ªå¼ k=5ï¼åå¾ ID=500ï¼\n 4. ååå° ID ç´¢å¼æ æ¥å° ID=500 å¯¹åºç R4ï¼\n 5. å¨ k ç´¢å¼æ åä¸ä¸ä¸ªå¼ k=6ï¼ä¸æ»¡è¶³æ¡ä»¶ï¼å¾ªç¯ç»æã\n\nå¨è¿ä¸ªè¿ç¨ä¸­ï¼åå°ä¸»é®ç´¢å¼æ æç´¢çè¿ç¨ï¼æä»¬ç§°ä¸ºåè¡¨ãå¯ä»¥çå°ï¼è¿ä¸ªæ¥è¯¢è¿ç¨è¯»äº k ç´¢å¼æ ç 3 æ¡è®°å½ï¼æ­¥éª¤ 1ã3 å 5ï¼ï¼åè¡¨äºä¸¤æ¬¡ï¼æ­¥éª¤ 2 å 4ï¼ã\n\nå¦ææ§è¡çè¯­å¥æ¯ select ID from T where k between 3 and 5ï¼è¿æ¶åªéè¦æ¥ ID çå¼ï¼è ID çå¼å·²ç»å¨ k ç´¢å¼æ ä¸äºï¼å æ­¤å¯ä»¥ç´æ¥æä¾æ¥è¯¢ç»æï¼ä¸éè¦åè¡¨ãç´¢å¼åå«ææéè¦æ¥è¯¢çå­æ®µçå¼ï¼ç§°ä¸ºè¦çç´¢å¼ã\n\nç±äºè¦çç´¢å¼å¯ä»¥åå°æ çæç´¢æ¬¡æ°ï¼æ¾èæåæ¥è¯¢æ§è½ï¼æä»¥ä½¿ç¨è¦çç´¢å¼æ¯ä¸ä¸ªå¸¸ç¨çæ§è½ä¼åææ®µã\n\n\n# ä½¿ç¨ç´¢å¼æ¥æåº\n\nMysql æä¸¤ç§æ¹å¼å¯ä»¥çææåºç»æï¼éè¿æåºæä½ï¼æèæç´¢å¼é¡ºåºæ«æã\n\nç´¢å¼æå¥½æ¢æ»¡è¶³æåºï¼åç¨äºæ¥æ¾è¡ãè¿æ ·ï¼å°±å¯ä»¥éè¿å½ä¸­è¦çç´¢å¼ç´æ¥å°ç»ææ¥åºæ¥ï¼ä¹å°±ä¸åéè¦æåºäºã\n\nè¿æ ·æ´ä¸ªæ¥è¯¢è¯­å¥çæ§è¡æµç¨å°±åæäºï¼\n\n 1. ä»ç´¢å¼ (city,name,age) æ¾å°ç¬¬ä¸ä¸ªæ»¡è¶³ city='æ­å·âæ¡ä»¶çè®°å½ï¼ååºå¶ä¸­ç cityãname å age è¿ä¸ä¸ªå­æ®µçå¼ï¼ä½ä¸ºç»æéçä¸é¨åç´æ¥è¿åï¼\n 2. ä»ç´¢å¼ (city,name,age) åä¸ä¸ä¸ªè®°å½ï¼åæ ·ååºè¿ä¸ä¸ªå­æ®µçå¼ï¼ä½ä¸ºç»æéçä¸é¨åç´æ¥è¿åï¼\n 3. éå¤æ§è¡æ­¥éª¤ 2ï¼ç´å°æ¥å°ç¬¬ 1000 æ¡è®°å½ï¼æèæ¯ä¸æ»¡è¶³ city='æ­å·âæ¡ä»¶æ¶å¾ªç¯ç»æã\n\n\n# åç¼ç´¢å¼\n\nææ¶åéè¦ç´¢å¼å¾é¿çå­ç¬¦åï¼è¿ä¼è®©ç´¢å¼åå¾å¤§ä¸æ¢ã\n\nè¿æ¶ï¼å¯ä»¥ä½¿ç¨åç¼ç´¢å¼ï¼å³åªç´¢å¼å¼å§çé¨åå­ç¬¦ï¼è¿æ ·å¯ä»¥å¤§å¤§èçº¦ç´¢å¼ç©ºé´ï¼ä»èæé«ç´¢å¼æçãä½è¿æ ·ä¹ä¼éä½ç´¢å¼çéæ©æ§ãå¯¹äº BLOB/TEXT/VARCHAR è¿ç§ææ¬ç±»åçåï¼å¿é¡»ä½¿ç¨åç¼ç´¢å¼ï¼å ä¸ºæ°æ®åºå¾å¾ä¸åè®¸ç´¢å¼è¿äºåçå®æ´é¿åº¦ã\n\nç´¢å¼çéæ©æ§æ¯æï¼ä¸éå¤çç´¢å¼å¼åæ°æ®è¡¨è®°å½æ»æ°çæ¯å¼ãæå¤§å¼ä¸º 1ï¼æ­¤æ¶æ¯ä¸ªè®°å½é½æå¯ä¸çç´¢å¼ä¸å¶å¯¹åºãéæ©æ§è¶é«ï¼æ¥è¯¢æçä¹è¶é«ãå¦æå­å¨å¤æ¡å½ä¸­åç¼ç´¢å¼çæåµï¼å°±éè¦ä¾æ¬¡æ«æï¼ç´å°æç»æ¾å°æ­£ç¡®è®°å½ã\n\nä½¿ç¨åç¼ç´¢å¼ï¼å®ä¹å¥½é¿åº¦ï¼å°±å¯ä»¥åå°æ¢èçç©ºé´ï¼åä¸ç¨é¢å¤å¢å å¤ªå¤çæ¥è¯¢ææ¬ã\n\né£ä¹ï¼å¦ä½ç¡®å®åç¼ç´¢å¼åéçé¿åº¦å¢ï¼\n\nå¯ä»¥ä½¿ç¨ä¸é¢è¿ä¸ªè¯­å¥ï¼ç®åºè¿ä¸ªåä¸æå¤å°ä¸ªä¸åçå¼ï¼\n\nselect count(distinct email) as L from SUser;\n\n\nç¶åï¼ä¾æ¬¡éåä¸åé¿åº¦çåç¼æ¥çè¿ä¸ªå¼ï¼æ¯å¦æä»¬è¦çä¸ä¸ 4~7 ä¸ªå­èçåç¼ç´¢å¼ï¼å¯ä»¥ç¨è¿ä¸ªè¯­å¥ï¼\n\nselect\n  count(distinct left(email,4)ï¼as L4,\n  count(distinct left(email,5)ï¼as L5,\n  count(distinct left(email,6)ï¼as L6,\n  count(distinct left(email,7)ï¼as L7,\nfrom SUser;\n\n\nå½ç¶ï¼ä½¿ç¨åç¼ç´¢å¼å¾å¯è½ä¼æå¤±åºååº¦ï¼æä»¥ä½ éè¦é¢åè®¾å®ä¸ä¸ªå¯ä»¥æ¥åçæå¤±æ¯ä¾ï¼æ¯å¦ 5%ãç¶åï¼å¨è¿åç L4~L7 ä¸­ï¼æ¾åºä¸å°äº L * 95% çå¼ï¼åè®¾è¿é L6ãL7 é½æ»¡è¶³ï¼ä½ å°±å¯ä»¥éæ©åç¼é¿åº¦ä¸º 6ã\n\næ­¤å¤ï¼order by æ æ³ä½¿ç¨åç¼ç´¢å¼ï¼æ æ³æåç¼ç´¢å¼ç¨ä½è¦çç´¢å¼ã\n\n\n# æå·¦åç¼å¹éåå\n\nä¸åªæ¯ç´¢å¼çå¨é¨å®ä¹ï¼åªè¦æ»¡è¶³æå·¦åç¼ï¼å°±å¯ä»¥å©ç¨ç´¢å¼æ¥å éæ£ç´¢ãè¿ä¸ªæå·¦åç¼å¯ä»¥æ¯èåç´¢å¼çæå·¦ N ä¸ªå­æ®µï¼ä¹å¯ä»¥æ¯å­ç¬¦ä¸²ç´¢å¼çæå·¦ M ä¸ªå­ç¬¦ã\n\nMySQL ä¼ä¸ç´åå³å¹éç´å°éå°èå´æ¥è¯¢ (>,<,BETWEEN,LIKE) å°±åæ­¢å¹éã\n\n * ç´¢å¼å¯ä»¥ç®åå¦ä¸ä¸ªå(a)ï¼ä¹å¯ä»¥å¤æå¦å¤ä¸ªå(a, b, c, d)ï¼å³èåç´¢å¼ã\n * å¦ææ¯èåç´¢å¼ï¼é£ä¹ key ä¹ç±å¤ä¸ªåç»æï¼åæ¶ï¼ç´¢å¼åªè½ç¨äºæ¥æ¾ key æ¯å¦å­å¨ï¼ç¸ç­ï¼ï¼éå°èå´æ¥è¯¢(>ã<ãbetweenãlike å·¦å¹é)ç­å°±ä¸è½è¿ä¸æ­¥å¹éäºï¼åç»­éåä¸ºçº¿æ§æ¥æ¾ã\n * å æ­¤ï¼åçæåé¡ºåºå³å®äºå¯å½ä¸­ç´¢å¼çåæ°ã\n\nä¸è¦ä¸ºæ¯ä¸ªåé½åå»ºç¬ç«ç´¢å¼ã\n\nå°éæ©æ§é«çåæåºæ°å¤§çåä¼åæå¨å¤åç´¢å¼æååãä½ææ¶ï¼ä¹éè¦èè WHERE å­å¥ä¸­çæåºãåç»åèå´æ¡ä»¶ç­å ç´ ï¼è¿äºå ç´ ä¹ä¼å¯¹æ¥è¯¢æ§è½é æè¾å¤§å½±åã\n\nä¾å¦ï¼a = 1 and b = 2 and c > 3 and d = 4ï¼å¦æå»ºç«ï¼a,b,c,dï¼é¡ºåºçç´¢å¼ï¼d æ¯ç¨ä¸å°ç´¢å¼çï¼å¦æå»ºç«(a,b,d,c)çç´¢å¼åé½å¯ä»¥ç¨å°ï¼a,b,d çé¡ºåºå¯ä»¥ä»»æè°æ´ã\n\nè®©éæ©æ§æå¼ºçç´¢å¼åæ¾å¨åé¢ï¼ç´¢å¼çéæ©æ§æ¯æï¼ä¸éå¤çç´¢å¼å¼åè®°å½æ»æ°çæ¯å¼ãæå¤§å¼ä¸º 1ï¼æ­¤æ¶æ¯ä¸ªè®°å½é½æå¯ä¸çç´¢å¼ä¸å¶å¯¹åºãéæ©æ§è¶é«ï¼æ¥è¯¢æçä¹è¶é«ã\n\nä¾å¦ä¸é¢æ¾ç¤ºçç»æä¸­ customer_id çéæ©æ§æ¯ staff_id æ´é«ï¼å æ­¤æå¥½æ customer_id åæ¾å¨å¤åç´¢å¼çåé¢ã\n\nSELECT COUNT(DISTINCT staff_id)/COUNT(*) AS staff_id_selectivity,\nCOUNT(DISTINCT customer_id)/COUNT(*) AS customer_id_selectivity,\nCOUNT(*)\nFROM payment;\n\n\n   staff_id_selectivity: 0.0001\ncustomer_id_selectivity: 0.0373\n               COUNT(*): 16049\n\n\n\n# = å in å¯ä»¥ä¹±åº\n\nä¸éè¦èè =ãIN ç­çé¡ºåºï¼Mysql ä¼èªå¨ä¼åè¿äºæ¡ä»¶çé¡ºåºï¼ä»¥å¹éå°½å¯è½å¤çç´¢å¼åã\n\nãç¤ºä¾ãå¦æç´¢å¼ (a, b, c, d)ï¼æ¥è¯¢æ¡ä»¶ c > 3 and b = 2 and a = 1 and d < 4 ä¸ a = 1 and c > 3 and b = 2 and d < 4 ç­é¡ºåºé½æ¯å¯ä»¥çï¼MySQL ä¼èªå¨ä¼åä¸º a = 1 and b = 2 and c > 3 and d < 4ï¼ä¾æ¬¡å½ä¸­ aãbãcãdã\n\n\n# ç´¢å¼æä½³å®è·µ\n\nåå»ºäºç´¢å¼ï¼å¹¶éä¸å®ææãæ¯å¦ä¸æ»¡è¶³åç¼ç´¢å¼ãæå·¦åç¼å¹éååãæ¥è¯¢æ¡ä»¶æ¶åå½æ°è®¡ç®ç­æåµé½æ æ³ä½¿ç¨ç´¢å¼ãæ­¤å¤ï¼å³ä½¿ SQL æ¬èº«ç¬¦åç´¢å¼çä½¿ç¨æ¡ä»¶ï¼MySQL ä¹ä¼éè¿è¯ä¼°åç§æ¥è¯¢æ¹å¼çä»£ä»·ï¼æ¥å³å®æ¯å¦èµ°ç´¢å¼ï¼ä»¥åèµ°åªä¸ªç´¢å¼ã\n\nå æ­¤ï¼å¨å°è¯éè¿ç´¢å¼è¿è¡ SQL æ§è½ä¼åçæ¶åï¼å¡å¿éè¿æ§è¡è®¡åï¼EXPLAINï¼æå®éçæææ¥ç¡®è®¤ç´¢å¼æ¯å¦è½æææ¹åæ§è½é®é¢ï¼å¦åå¢å äºç´¢å¼ä¸ä½æ²¡è§£å³æ§è½é®é¢ï¼è¿å¢å äºæ°æ®åºå¢å æ¹çè´æãå¦æå¯¹ EXPLAIN ç»åºçæ§è¡è®¡åæçé®çè¯ï¼ä½ è¿å¯ä»¥å©ç¨ optimizer_trace æ¥çè¯¦ç»çæ§è¡è®¡ååè¿ä¸æ­¥åæã\n\n\n# åèèµæ\n\n * ãé«æ§è½ MySQLã\n * æ°æ®åºä¸¤å¤§ç¥å¨ãç´¢å¼åéã\n * MySQL ç´¢å¼èåçæ°æ®ç»æåç®æ³åç\n * MySQL å®æ 45 è®²",normalizedContent:"# mysql ç´¢å¼\n\n> ç´¢å¼æ¯æé« mysql æ¥è¯¢æ§è½çä¸ä¸ªéè¦éå¾ï¼ä½è¿å¤çç´¢å¼å¯è½ä¼å¯¼è´è¿é«çç£çä½¿ç¨çä»¥åè¿é«çåå­å ç¨ï¼ä»èå½±ååºç¨ç¨åºçæ´ä½æ§è½ãåºå½å°½éé¿åäºåææ³èµ·æ·»å ç´¢å¼ï¼å ä¸ºäºåå¯è½éè¦çæ§å¤§éç sql æè½å®ä½å°é®é¢æå¨ï¼èä¸æ·»å ç´¢å¼çæ¶é´è¯å®æ¯è¿å¤§äºåå§æ·»å ç´¢å¼æéè¦çæ¶é´ï¼å¯è§ç´¢å¼çæ·»å ä¹æ¯éå¸¸æææ¯å«éçã\n> \n> æ¥ä¸æ¥å°åä½ å±ç¤ºä¸ç³»ååå»ºé«æ§è½ç´¢å¼çç­ç¥ï¼ä»¥åæ¯æ¡ç­ç¥å¶èåçå·¥ä½åçãä½å¨æ­¤ä¹åï¼åäºè§£ä¸ç´¢å¼ç¸å³çä¸äºç®æ³åæ°æ®ç»æï¼å°æå©äºæ´å¥½ççè§£åæçåå®¹ã\n\n\n\n\n# ç´¢å¼ç®ä»\n\nç´¢å¼æ¯æ°æ®åºä¸ºäºæé«æ¥æ¾æççä¸ç§æ°æ®ç»æã\n\nç´¢å¼å¯¹äºè¯å¥½çæ§è½éå¸¸å³é®ï¼å¨æ°æ®éå°ä¸è´è½½è¾ä½æ¶ï¼ä¸æ°å½çç´¢å¼å¯¹äºæ§è½çå½±åå¯è½è¿ä¸ææ¾ï¼ä½éçæ°æ®ééæ¸å¢å¤§ï¼æ§è½åä¼æ¥å§ä¸éãå æ­¤ï¼ç´¢å¼ä¼ååºè¯¥æ¯æ¥è¯¢æ§è½ä¼åçæææææ®µã\n\n\n# ç´¢å¼çä¼ç¼ºç¹\n\nb æ æ¯æå¸¸è§çç´¢å¼ï¼æç§é¡ºåºå­å¨æ°æ®ï¼æä»¥ mysql å¯ä»¥ç¨æ¥å order by å group by æä½ãå ä¸ºæ°æ®æ¯æåºçï¼æä»¥ b æ ä¹å°±ä¼å°ç¸å³çåå¼é½å­å¨å¨ä¸èµ·ãæåï¼å ä¸ºç´¢å¼ä¸­å­å¨äºå®éçåå¼ï¼æä»¥æäºæ¥è¯¢åªä½¿ç¨ç´¢å¼å°±è½å¤å®æå¨é¨æ¥è¯¢ã\n\nâ ç´¢å¼çä¼ç¹ï¼\n\n * ç´¢å¼å¤§å¤§åå°äºæå¡å¨éè¦æ«æçæ°æ®éï¼ä»èå å¿«æ£ç´¢éåº¦ã\n * ç´¢å¼å¯ä»¥å¸®å©æå¡å¨é¿åæåºåä¸´æ¶è¡¨ã\n * ç´¢å¼å¯ä»¥å°éæº i/o åä¸ºé¡ºåº i/oã\n * æ¯æè¡çº§éçæ°æ®åºï¼å¦ innodb ä¼å¨è®¿é®è¡çæ¶åå éãä½¿ç¨ç´¢å¼å¯ä»¥åå°è®¿é®çè¡æ°ï¼ä»èåå°éçç«äºï¼æé«å¹¶åã\n * å¯ä¸ç´¢å¼å¯ä»¥ç¡®ä¿æ¯ä¸è¡æ°æ®çå¯ä¸æ§ï¼éè¿ä½¿ç¨ç´¢å¼ï¼å¯ä»¥å¨æ¥è¯¢çè¿ç¨ä¸­ä½¿ç¨ä¼åéèå¨ï¼æé«ç³»ç»çæ§è½ã\n\nâ ç´¢å¼çç¼ºç¹ï¼\n\n * åå»ºåç»´æ¤ç´¢å¼è¦èè´¹æ¶é´ï¼è¿ä¼éçæ°æ®éçå¢å èå¢å ã\n * ç´¢å¼éè¦å ç¨é¢å¤çç©çç©ºé´ï¼é¤äºæ°æ®è¡¨å æ°æ®ç©ºé´ä¹å¤ï¼æ¯ä¸ä¸ªç´¢å¼è¿è¦å ä¸å®çç©çç©ºé´ï¼å¦æè¦å»ºç«ç»åç´¢å¼é£ä¹éè¦çç©ºé´å°±ä¼æ´å¤§ã\n * åæä½ï¼insert/update/deleteï¼æ¶å¾å¯è½éè¦æ´æ°ç´¢å¼ï¼å¯¼è´æ°æ®åºçåæä½æ§è½éä½ã\n\n\n# ä½æ¶ä½¿ç¨ç´¢å¼\n\n> ç´¢å¼è½å¤è½»æå°æ¥è¯¢æ§è½æåå ä¸ªæ°éçº§ã\n\nâ ä»ä¹æåµéç¨ç´¢å¼ï¼\n\n * é¢ç¹è¯»æä½ï¼ select ï¼\n * è¡¨çæ°æ®éæ¯è¾å¤§ã\n * ååç»å¸¸åºç°å¨ where æè¿æ¥ï¼joinï¼æ¡ä»¶ä¸­ã\n\nâ ä»ä¹æåµä¸éç¨ç´¢å¼ï¼\n\n * é¢ç¹åæä½ï¼ insert/update/delete ï¼ï¼ä¹å°±æå³çéè¦æ´æ°ç´¢å¼ã\n * ååä¸ç»å¸¸åºç°å¨ where æè¿æ¥ï¼joinï¼æ¡ä»¶ä¸­ï¼ä¹å°±æå³çç´¢å¼ä¼ç»å¸¸æ æ³å½ä¸­ï¼æ²¡ææä¹ï¼è¿å¢å ç©ºé´å¼éã\n * éå¸¸å°çè¡¨ï¼å¯¹äºéå¸¸å°çè¡¨ï¼å¤§é¨åæåµä¸ç®åçå¨è¡¨æ«ææ´é«æã\n * ç¹å¤§åçè¡¨ï¼å»ºç«åä½¿ç¨ç´¢å¼çä»£ä»·å°éä¹å¢é¿ãå¯ä»¥èèä½¿ç¨ååºææ¯æ nosqlã\n\n\n# ç´¢å¼çæ°æ®ç»æ\n\nå¨ mysql ä¸­ï¼ç´¢å¼æ¯å¨å­å¨å¼æå±èä¸æ¯æå¡å¨å±å®ç°çãæä»¥ï¼å¹¶æ²¡æç»ä¸çç´¢å¼æ åï¼ä¸åå­å¨å¼æçç´¢å¼çæ°æ®ç»æä¹ä¸ç¸åã\n\n\n# æ°ç»\n\næ°ç»æ¯ç¨è¿ç»­çåå­ç©ºé´æ¥å­å¨æ°æ®ï¼å¹¶ä¸æ¯æéæºè®¿é®ã\n\næåºæ°ç»å¯ä»¥ä½¿ç¨äºåæ¥æ¾æ³ï¼å¶æ¶é´å¤æåº¦ä¸º o(log n)ï¼æ è®ºæ¯ç­å¼æ¥è¯¢è¿æ¯èå´æ¥è¯¢ï¼é½éå¸¸é«æã\n\nä½æ°ç»æä¸¤ä¸ªéè¦éå¶ï¼\n\n * æ°ç»çç©ºé´å¤§å°åºå®ï¼å¦æè¦æ©å®¹åªè½éç¨å¤å¶æ°ç»çæ¹å¼ã\n * æå¥ãå é¤æ¶é´å¤æåº¦ä¸º o(n)ã\n\nè¿æå³çï¼å¦æä½¿ç¨æ°ç»ä½ä¸ºç´¢å¼ï¼å¦æè¦ä¿è¯æ°ç»æåºï¼å¶æ´æ°æä½ä»£ä»·é«æã\n\n\n# åå¸ç´¢å¼\n\nåå¸è¡¨æ¯ä¸ç§ä»¥é® - å¼ï¼key-valueï¼å¯¹å½¢å¼å­å¨æ°æ®çç»æï¼æä»¬åªè¦è¾å¥å¾æ¥æ¾çå¼å³ keyï¼å°±å¯ä»¥æ¾å°å¶å¯¹åºçå¼å³ valueã\n\nåå¸è¡¨ ä½¿ç¨ åå¸å½æ° ç»ç»æ°æ®ï¼ä»¥æ¯æå¿«éæå¥åæç´¢çæ°æ®ç»æãåå¸è¡¨çæ¬è´¨æ¯ä¸ä¸ªæ°ç»ï¼å¶æè·¯æ¯ï¼ä½¿ç¨ hash å½æ°å° key è½¬æ¢ä¸ºæ°ç»ä¸æ ï¼å©ç¨æ°ç»çéæºè®¿é®ç¹æ§ï¼ä½¿å¾æä»¬è½å¨ o(1) çæ¶é´ä»£ä»·åå®ææ£ç´¢ã\n\n\n\næä¸¤ç§ä¸åç±»åçåå¸è¡¨ï¼åå¸éå å åå¸æ å°ã\n\n * åå¸éå æ¯éåæ°æ®ç»æçå®ç°ä¹ä¸ï¼ç¨äºå­å¨ééå¤å¼ã\n * åå¸æ å° æ¯æ å° æ°æ®ç»æçå®ç°ä¹ä¸ï¼ç¨äºå­å¨é®å¼å¯¹ã\n\nåå¸ç´¢å¼åºäºåå¸è¡¨å®ç°ï¼åªéç¨äºç­å¼æ¥è¯¢ãå¯¹äºæ¯ä¸è¡æ°æ®ï¼åå¸ç´¢å¼é½ä¼å°ææçç´¢å¼åè®¡ç®ä¸ä¸ªåå¸ç ï¼hashcodeï¼ï¼åå¸ç æ¯ä¸ä¸ªè¾å°çå¼ãåå¸ç´¢å¼å°ææçåå¸ç å­å¨å¨ç´¢å¼ä¸­ï¼åæ¶å¨åå¸è¡¨ä¸­ä¿å­æåæ¯ä¸ªæ°æ®è¡çæéã\n\nå¨ mysql ä¸­ï¼åªæ memory å­å¨å¼ææ¾ç¤ºæ¯æåå¸ç´¢å¼ã\n\nâ åå¸ç´¢å¼çä¼ç¹ï¼\n\n * å ä¸ºç´¢å¼æ°æ®ç»æç´§åï¼æä»¥æ¥è¯¢éåº¦éå¸¸å¿«ã\n\nâ åå¸ç´¢å¼çç¼ºç¹ï¼\n\n * åå¸ç´¢å¼å¼åå«åå¸å¼åè¡æéï¼èä¸å­å¨å­æ®µå¼ï¼æä»¥ä¸è½ä½¿ç¨ç´¢å¼ä¸­çå¼æ¥é¿åè¯»åè¡ãä¸è¿ï¼è®¿é®åå­ä¸­çè¡çéåº¦å¾å¿«ï¼æä»¥å¤§é¨åæåµä¸è¿ä¸ç¹å¯¹æ§è½å½±åä¸å¤§ã\n * åå¸ç´¢å¼æ°æ®ä¸æ¯æç§ç´¢å¼å¼é¡ºåºå­å¨çï¼æä»¥æ æ³ç¨äºæåºã\n * åå¸ç´¢å¼ä¸æ¯æé¨åç´¢å¼å¹éæ¥æ¾ï¼å ä¸ºåå¸ç´¢å¼æ¶ä½¿ç¨ç´¢å¼åçå¨é¨åå®¹æ¥è¿è¡åå¸è®¡ç®çãå¦ï¼å¨æ°æ®å (a,b) ä¸å»ºç«åå¸ç´¢å¼ï¼å¦ææ¥è¯¢åªææ°æ®å aï¼æ æ³ä½¿ç¨è¯¥ç´¢å¼ã\n * åå¸ç´¢å¼åªæ¯æç­å¼æ¯è¾æ¥è¯¢ï¼åæ¬ =ãin()ã<=>ï¼ä¸æ¯æä»»ä½èå´æ¥è¯¢ï¼å¦ where price > 100ã\n * åå¸ç´¢å¼æå¯è½åºç°åå¸å²çª\n   * åºç°åå¸å²çªæ¶ï¼å¿é¡»éåé¾è¡¨ä¸­ææçè¡æéï¼éè¡æ¯è¾ï¼ç´å°æ¾å°ç¬¦åæ¡ä»¶çè¡ã\n   * å¦æåå¸å²çªå¤çè¯ï¼ç»´æ¤ç´¢å¼çä»£ä»·ä¼å¾é«ã\n\n> å ä¸ºç§ç§éå¶ï¼æä»¥åå¸ç´¢å¼åªéç¨äºç¹å®çåºåãèä¸æ¦ä½¿ç¨åå¸ç´¢å¼ï¼åå®å¸¦æ¥çæ§è½æåä¼éå¸¸æ¾èã\n\n\n# b æ ç´¢å¼\n\néå¸¸æä»¬æè¯´çç´¢å¼æ¯æb-treeç´¢å¼ï¼å®æ¯ç®åå³ç³»åæ°æ®åºä¸­æ¥æ¾æ°æ®æä¸ºå¸¸ç¨åææçç´¢å¼ï¼å¤§å¤æ°å­å¨å¼æé½æ¯æè¿ç§ç´¢å¼ãä½¿ç¨b-treeè¿ä¸ªæ¯è¯­ï¼æ¯å ä¸º mysql å¨create tableæå¶å®è¯­å¥ä¸­ä½¿ç¨äºè¿ä¸ªå³é®å­ï¼ä½å®éä¸ä¸åçå­å¨å¼æå¯è½ä½¿ç¨ä¸åçæ°æ®ç»æï¼æ¯å¦ innodb å°±æ¯ä½¿ç¨çb+treeã\n\nb+treeä¸­ç b æ¯æbalanceï¼æä¸ºå¹³è¡¡ãéè¦æ³¨æçæ¯ï¼b+æ ç´¢å¼å¹¶ä¸è½æ¾å°ä¸ä¸ªç»å®é®å¼çå·ä½è¡ï¼å®æ¾å°çåªæ¯è¢«æ¥æ¾æ°æ®è¡æå¨çé¡µï¼æ¥çæ°æ®åºä¼æé¡µè¯»å¥å°åå­ï¼åå¨åå­ä¸­è¿è¡æ¥æ¾ï¼æåå¾å°è¦æ¥æ¾çæ°æ®ã\n\n# äºåæç´¢æ \n\näºåæç´¢æ çç¹ç¹æ¯ï¼æ¯ä¸ªèç¹çå·¦å¿å­å°äºç¶èç¹ï¼ç¶èç¹åå°äºå³å¿å­ãå¶æ¥è¯¢æ¶é´å¤æåº¦æ¯ $$o(log(n))$$ã\n\nå½ç¶ä¸ºäºç»´æ $$o(log(n))$$ çæ¥è¯¢å¤æåº¦ï¼ä½ å°±éè¦ä¿æè¿æ£µæ æ¯å¹³è¡¡äºåæ ãä¸ºäºåè¿ä¸ªä¿è¯ï¼æ´æ°çæ¶é´å¤æåº¦ä¹æ¯ $$o(log(n))$$ã\n\néçæ°æ®åºä¸­æ°æ®çå¢å ï¼ç´¢å¼æ¬èº«å¤§å°éä¹å¢å ï¼ä¸å¯è½å¨é¨å­å¨å¨åå­ä¸­ï¼å æ­¤ç´¢å¼å¾å¾ä»¥ç´¢å¼æä»¶çå½¢å¼å­å¨çç£çä¸ãè¿æ ·çè¯ï¼ç´¢å¼æ¥æ¾è¿ç¨ä¸­å°±è¦äº§çç£ç i/o æ¶èï¼ç¸å¯¹äºåå­å­åï¼i/o å­åçæ¶èè¦é«å ä¸ªæ°éçº§ãå¯ä»¥æ³è±¡ä¸ä¸ä¸æ£µå ç¾ä¸èç¹çäºåæ çæ·±åº¦æ¯å¤å°ï¼å¦æå°è¿ä¹å¤§æ·±åº¦çä¸é¢äºåæ æ¾ç£çä¸ï¼æ¯è¯»åä¸ä¸ªèç¹ï¼éè¦ä¸æ¬¡ç£çç i/o è¯»åï¼æ´ä¸ªæ¥æ¾çèæ¶æ¾ç¶æ¯ä¸è½å¤æ¥åçãé£ä¹å¦ä½åå°æ¥æ¾è¿ç¨ä¸­ç i/o å­åæ¬¡æ°ï¼\n\nä¸ç§è¡ä¹ææçè§£å³æ¹æ³æ¯åå°æ çæ·±åº¦ï¼å°äºåæ åä¸º n åæ ï¼å¤è·¯æç´¢æ ï¼ï¼è b+ æ å°±æ¯ä¸ç§å¤è·¯æç´¢æ ã\n\n# b+ æ \n\nb+ æ ç´¢å¼éç¨äºå¨é®å¼æ¥æ¾ãé®å¼èå´æ¥æ¾åé®åç¼æ¥æ¾ï¼å¶ä¸­é®åç¼æ¥æ¾åªéç¨äºæå·¦åç¼æ¥æ¾ã\n\nçè§£b+treeæ¶ï¼åªéè¦çè§£å¶æéè¦çä¸¤ä¸ªç¹å¾å³å¯ï¼\n\n * ç¬¬ä¸ï¼ææçå³é®å­ï¼å¯ä»¥çè§£ä¸ºæ°æ®ï¼é½å­å¨å¨å¶å­èç¹ï¼éå¶å­èç¹å¹¶ä¸å­å¨çæ­£çæ°æ®ï¼ææè®°å½èç¹é½æ¯æé®å¼å¤§å°é¡ºåºå­æ¾å¨åä¸å±å¶å­èç¹ä¸ã\n * å¶æ¬¡ï¼ææçå¶å­èç¹ç±æéè¿æ¥ãå¦ä¸å¾ä¸ºç®åäºçb+treeã\n\n\n\næ ¹æ®å¶å­èç¹çåå®¹ï¼ç´¢å¼ç±»ååä¸ºä¸»é®ç´¢å¼åéä¸»é®ç´¢å¼ã\n\n * èç°ç´¢å¼ï¼clusteredï¼ï¼åç§°ä¸ºä¸»é®ç´¢å¼ï¼å¶å¶å­èç¹å­çæ¯æ´è¡æ°æ®ãå ä¸ºæ æ³åæ¶ææ°æ®è¡å­æ¾å¨ä¸¤ä¸ªä¸åçå°æ¹ï¼æä»¥ä¸ä¸ªè¡¨åªè½æä¸ä¸ªèç°ç´¢å¼ãinnodb çèç°ç´¢å¼å®éæ¯å¨åä¸ä¸ªç»æä¸­ä¿å­äº b æ çç´¢å¼åæ°æ®è¡ã\n * éä¸»é®ç´¢å¼çå¶å­èç¹åå®¹æ¯ä¸»é®çå¼ãå¨ innodb éï¼éä¸»é®ç´¢å¼ä¹è¢«ç§°ä¸ºäºçº§ç´¢å¼ï¼secondaryï¼ãæ°æ®å­å¨å¨ä¸ä¸ªä½ç½®ï¼ç´¢å¼å­å¨å¨å¦ä¸ä¸ªä½ç½®ï¼ç´¢å¼ä¸­åå«æåæ°æ®å­å¨ä½ç½®çæéãå¯ä»¥æå¤ä¸ªï¼å°äº 249 ä¸ªã\n\nèç°è¡¨ç¤ºæ°æ®è¡åç¸é»çé®å¼ç´§åå°å­å¨å¨ä¸èµ·ï¼å ä¸ºæ°æ®ç´§åï¼æä»¥è®¿é®å¿«ãå ä¸ºæ æ³åæ¶ææ°æ®è¡å­æ¾å¨ä¸¤ä¸ªä¸åçå°æ¹ï¼æä»¥ä¸ä¸ªè¡¨åªè½æä¸ä¸ªèç°ç´¢å¼ã\n\nèç°ç´¢å¼åéèç°ç´¢å¼çæ¥è¯¢æä»ä¹åºå«\n\n * å¦æè¯­å¥æ¯ select * from t where id=500ï¼å³èç°ç´¢å¼æ¥è¯¢æ¹å¼ï¼ååªéè¦æç´¢ id è¿æ£µ b+ æ ï¼\n * å¦æè¯­å¥æ¯ select * from t where k=5ï¼å³éèç°ç´¢å¼æ¥è¯¢æ¹å¼ï¼åéè¦åæç´¢ k ç´¢å¼æ ï¼å¾å° id çå¼ä¸º 500ï¼åå° id ç´¢å¼æ æç´¢ä¸æ¬¡ãè¿ä¸ªè¿ç¨ç§°ä¸ºåè¡¨ã\n\nä¹å°±æ¯è¯´ï¼åºäºéèç°ç´¢å¼çæ¥è¯¢éè¦å¤æ«æä¸æ£µç´¢å¼æ ãå æ­¤ï¼æä»¬å¨åºç¨ä¸­åºè¯¥å°½éä½¿ç¨ä¸»é®æ¥è¯¢ã\n\næ¾ç¶ï¼ä¸»é®é¿åº¦è¶å°ï¼éèç°ç´¢å¼çå¶å­èç¹å°±è¶å°ï¼éèç°ç´¢å¼å ç¨çç©ºé´ä¹å°±è¶å°ã\n\nèªå¢ä¸»é®æ¯æèªå¢åä¸å®ä¹çä¸»é®ï¼å¨å»ºè¡¨è¯­å¥ä¸­ä¸è¬æ¯è¿ä¹å®ä¹çï¼ not null primary key auto_incrementãä»æ§è½åå­å¨ç©ºé´æ¹é¢èéï¼èªå¢ä¸»é®å¾å¾æ¯æ´åççéæ©ãææ²¡æä»ä¹åºæ¯éåç¨ä¸å¡å­æ®µç´æ¥åä¸»é®çå¢ï¼è¿æ¯æçãæ¯å¦ï¼æäºä¸å¡çåºæ¯éæ±æ¯è¿æ ·çï¼\n\n * åªæä¸ä¸ªç´¢å¼ï¼\n * è¯¥ç´¢å¼å¿é¡»æ¯å¯ä¸ç´¢å¼ã\n\nç±äºæ²¡æå¶ä»ç´¢å¼ï¼æä»¥ä¹å°±ä¸ç¨èèå¶ä»ç´¢å¼çå¶å­èç¹å¤§å°çé®é¢ã\n\nè¿æ¶åæä»¬å°±è¦ä¼åèèä¸ä¸æ®µæå°çâå°½éä½¿ç¨ä¸»é®æ¥è¯¢âååï¼ç´æ¥å°è¿ä¸ªç´¢å¼è®¾ç½®ä¸ºä¸»é®ï¼å¯ä»¥é¿åæ¯æ¬¡æ¥è¯¢éè¦æç´¢ä¸¤æ£µæ ã\n\n\n# å¨æç´¢å¼\n\nmyisam å­å¨å¼ææ¯æå¨æç´¢å¼ï¼ç¨äºæ¥æ¾ææ¬ä¸­çå³é®è¯ï¼èä¸æ¯ç´æ¥æ¯è¾æ¯å¦ç¸ç­ãæ¥æ¾æ¡ä»¶ä½¿ç¨ match againstï¼èä¸æ¯æ®éç whereã\n\nå¨æç´¢å¼ä¸è¬ä½¿ç¨åæç´¢å¼å®ç°ï¼å®è®°å½çå³é®è¯å°å¶æå¨ææ¡£çæ å°ã\n\ninnodb å­å¨å¼æå¨ mysql 5.6.4 çæ¬ä¸­ä¹å¼å§æ¯æå¨æç´¢å¼ã\n\n\n# ç©ºé´æ°æ®ç´¢å¼\n\nmyisam å­å¨å¼ææ¯æç©ºé´æ°æ®ç´¢å¼ï¼r-treeï¼ï¼å¯ä»¥ç¨äºå°çæ°æ®å­å¨ãç©ºé´æ°æ®ç´¢å¼ä¼ä»ææç»´åº¦æ¥ç´¢å¼æ°æ®ï¼å¯ä»¥ææå°ä½¿ç¨ä»»æç»´åº¦æ¥è¿è¡ç»åæ¥è¯¢ã\n\nå¿é¡»ä½¿ç¨ gis ç¸å³çå½æ°æ¥ç»´æ¤æ°æ®ã\n\n\n# ç´¢å¼çç±»å\n\nä¸»æµçå³ç³»åæ°æ®åºä¸è¬é½æ¯æä»¥ä¸ç´¢å¼ç±»åï¼\n\n\n# ä¸»é®ç´¢å¼ï¼primaryï¼\n\nä¸»é®ç´¢å¼ï¼ä¸ç§ç¹æ®çå¯ä¸ç´¢å¼ï¼ä¸åè®¸æç©ºå¼ãä¸ä¸ªè¡¨åªè½æä¸ä¸ªä¸»é®ï¼å¨ innodb ä¸­æ¬è´¨ä¸å³èç°ç´¢å¼ï¼ï¼ä¸è¬æ¯å¨å»ºè¡¨çæ¶ååæ¶åå»ºä¸»é®ç´¢å¼ã\n\ncreate table `table` (\n    `id` int(11) not null auto_increment,\n    ...\n    primary key (`id`)\n)\n\n\n\n# å¯ä¸ç´¢å¼ï¼uniqueï¼\n\nå¯ä¸ç´¢å¼ï¼ç´¢å¼åçå¼å¿é¡»å¯ä¸ï¼ä½åè®¸æç©ºå¼ãå¦ææ¯ç»åç´¢å¼ï¼ååå¼çç»åå¿é¡»å¯ä¸ã\n\ncreate table `table` (\n    ...\n    unique indexname (title(length))\n)\n\n\n\n# æ®éç´¢å¼ï¼indexï¼\n\næ®éç´¢å¼ï¼æåºæ¬çç´¢å¼ï¼æ²¡æä»»ä½éå¶ã\n\ncreate table `table` (\n    ...\n    index index_name (title(length))\n)\n\n\n\n# å¨æç´¢å¼ï¼fulltextï¼\n\nå¨æç´¢å¼ï¼ä¸»è¦ç¨æ¥æ¥æ¾ææ¬ä¸­çå³é®å­ï¼èä¸æ¯ç´æ¥ä¸ç´¢å¼ä¸­çå¼ç¸æ¯è¾ã\n\nå¨æç´¢å¼è·å¶å®ç´¢å¼å¤§ä¸ç¸åï¼å®æ´åæ¯ä¸ä¸ªæç´¢å¼æï¼èä¸æ¯ç®åç where è¯­å¥çåæ°å¹éãå¨æç´¢å¼éå match against æä½ä½¿ç¨ï¼èä¸æ¯ä¸è¬ç where è¯­å¥å  likeãå®å¯ä»¥å¨ create tableï¼alter table ï¼create index ä½¿ç¨ï¼ä¸è¿ç®ååªæ charãvarcharï¼text åä¸å¯ä»¥åå»ºå¨æç´¢å¼ãå¼å¾ä¸æçæ¯ï¼å¨æ°æ®éè¾å¤§æ¶åï¼ç°å°æ°æ®æ¾å¥ä¸ä¸ªæ²¡æå¨å±ç´¢å¼çè¡¨ä¸­ï¼ç¶ååç¨ create index åå»ºå¨æç´¢å¼ï¼è¦æ¯åä¸ºä¸å¼ è¡¨å»ºç«å¨æç´¢å¼ç¶ååå°æ°æ®åå¥çéåº¦å¿«å¾å¤ã\n\ncreate table `table` (\n    `content` text character null,\n    ...\n    fulltext (content)\n)\n\n\n\n# èåç´¢å¼\n\nç»åç´¢å¼ï¼å¤ä¸ªå­æ®µä¸åå»ºçç´¢å¼ï¼åªæå¨æ¥è¯¢æ¡ä»¶ä¸­ä½¿ç¨äºåå»ºç´¢å¼æ¶çç¬¬ä¸ä¸ªå­æ®µï¼ç´¢å¼æä¼è¢«ä½¿ç¨ãä½¿ç¨ç»åç´¢å¼æ¶éµå¾ªæå·¦åç¼éåã\n\ncreate table `table` (\n    ...\n    index index_name (title(length), title(length), ...)\n)\n\n\n\n# ç´¢å¼çç­ç¥\n\nåè®¾æä»¥ä¸è¡¨ï¼\n\ncreate table `t` (\n  `id` int(11) not null,\n  `city` varchar(16) not null,\n  `name` varchar(16) not null,\n  `age` int(11) not null,\n  `addr` varchar(128) default null,\n  primary key (`id`),\n  key `city` (`city`)\n) engine=innodb;\n\n\n\n# ç´¢å¼åºæ¬åå\n\n * ç´¢å¼ä¸æ¯è¶å¤è¶å¥½ï¼ä¸è¦ä¸ºææåé½åå»ºç´¢å¼ãè¦èèå°ç´¢å¼çç»´æ¤ä»£ä»·ãç©ºé´å ç¨åæ¥è¯¢æ¶åè¡¨çä»£ä»·ãç´¢å¼ä¸å®æ¯æéåå»ºçï¼å¹¶ä¸è¦å°½å¯è½ç¡®ä¿è¶³å¤è½»éãä¸æ¦åå»ºäºå¤å­æ®µçèåç´¢å¼ï¼æä»¬è¦èèå°½å¯è½å©ç¨ç´¢å¼æ¬èº«å®ææ°æ®æ¥è¯¢ï¼åå°åè¡¨çææ¬ã\n * è¦å°½éé¿ååä½åéå¤ç´¢å¼ã\n * è¦èèå é¤æªä½¿ç¨çç´¢å¼ã\n * å°½éçæ©å±ç´¢å¼ï¼ä¸è¦æ°å»ºç´¢å¼ã\n * é¢ç¹ä½ä¸º where è¿æ»¤æ¡ä»¶çååºè¯¥èèæ·»å ç´¢å¼ã\n\n\n# ç¬ç«çå\n\nâç¬ç«çåâ æ¯æç´¢å¼åä¸è½æ¯è¡¨è¾¾å¼çä¸é¨åï¼ä¹ä¸è½æ¯å½æ°çåæ°ã\n\nå¯¹ç´¢å¼å­æ®µåå½æ°æä½ï¼å¯è½ä¼ç ´åç´¢å¼å¼çæåºæ§ï¼å æ­¤ä¼åå¨å°±å³å®æ¾å¼èµ°æ æç´¢åè½ã\n\nå¦ææ¥è¯¢ä¸­çåä¸æ¯ç¬ç«çåï¼åæ°æ®åºä¸ä¼ä½¿ç¨ç´¢å¼ã\n\nâ éè¯¯ç¤ºä¾ï¼\n\nselect actor_id from actor where actor_id + 1 = 5;\nselect ... where to_days(current_date) - to_days(date_col) <= 10;\n\n\n\n# è¦çç´¢å¼\n\nè¦çç´¢å¼æ¯æï¼ç´¢å¼ä¸çä¿¡æ¯è¶³å¤æ»¡è¶³æ¥è¯¢è¯·æ±ï¼ä¸éè¦åè¡¨æ¥è¯¢æ°æ®ã\n\nãç¤ºä¾ãèå´æ¥è¯¢\n\ncreate table t (\nid int primary key,\nk int not null default 0,\ns varchar(16) not null default '',\nindex k(k))\nengine=innodb;\n\ninsert into t values(100,1, 'aa'),(200,2,'bb'),(300,3,'cc'),(500,5,'ee'),(600,6,'ff'),(700,7,'gg');\n\nselect * from t where k between 3 and 5\n\n\néè¦æ§è¡å æ¬¡æ çæç´¢æä½ï¼ä¼æ«æå¤å°è¡ï¼\n\n 1. å¨ k ç´¢å¼æ ä¸æ¾å° k=3 çè®°å½ï¼åå¾ id = 300ï¼\n 2. åå° id ç´¢å¼æ æ¥å° id=300 å¯¹åºç r3ï¼\n 3. å¨ k ç´¢å¼æ åä¸ä¸ä¸ªå¼ k=5ï¼åå¾ id=500ï¼\n 4. ååå° id ç´¢å¼æ æ¥å° id=500 å¯¹åºç r4ï¼\n 5. å¨ k ç´¢å¼æ åä¸ä¸ä¸ªå¼ k=6ï¼ä¸æ»¡è¶³æ¡ä»¶ï¼å¾ªç¯ç»æã\n\nå¨è¿ä¸ªè¿ç¨ä¸­ï¼åå°ä¸»é®ç´¢å¼æ æç´¢çè¿ç¨ï¼æä»¬ç§°ä¸ºåè¡¨ãå¯ä»¥çå°ï¼è¿ä¸ªæ¥è¯¢è¿ç¨è¯»äº k ç´¢å¼æ ç 3 æ¡è®°å½ï¼æ­¥éª¤ 1ã3 å 5ï¼ï¼åè¡¨äºä¸¤æ¬¡ï¼æ­¥éª¤ 2 å 4ï¼ã\n\nå¦ææ§è¡çè¯­å¥æ¯ select id from t where k between 3 and 5ï¼è¿æ¶åªéè¦æ¥ id çå¼ï¼è id çå¼å·²ç»å¨ k ç´¢å¼æ ä¸äºï¼å æ­¤å¯ä»¥ç´æ¥æä¾æ¥è¯¢ç»æï¼ä¸éè¦åè¡¨ãç´¢å¼åå«ææéè¦æ¥è¯¢çå­æ®µçå¼ï¼ç§°ä¸ºè¦çç´¢å¼ã\n\nç±äºè¦çç´¢å¼å¯ä»¥åå°æ çæç´¢æ¬¡æ°ï¼æ¾èæåæ¥è¯¢æ§è½ï¼æä»¥ä½¿ç¨è¦çç´¢å¼æ¯ä¸ä¸ªå¸¸ç¨çæ§è½ä¼åææ®µã\n\n\n# ä½¿ç¨ç´¢å¼æ¥æåº\n\nmysql æä¸¤ç§æ¹å¼å¯ä»¥çææåºç»æï¼éè¿æåºæä½ï¼æèæç´¢å¼é¡ºåºæ«æã\n\nç´¢å¼æå¥½æ¢æ»¡è¶³æåºï¼åç¨äºæ¥æ¾è¡ãè¿æ ·ï¼å°±å¯ä»¥éè¿å½ä¸­è¦çç´¢å¼ç´æ¥å°ç»ææ¥åºæ¥ï¼ä¹å°±ä¸åéè¦æåºäºã\n\nè¿æ ·æ´ä¸ªæ¥è¯¢è¯­å¥çæ§è¡æµç¨å°±åæäºï¼\n\n 1. ä»ç´¢å¼ (city,name,age) æ¾å°ç¬¬ä¸ä¸ªæ»¡è¶³ city='æ­å·âæ¡ä»¶çè®°å½ï¼ååºå¶ä¸­ç cityãname å age è¿ä¸ä¸ªå­æ®µçå¼ï¼ä½ä¸ºç»æéçä¸é¨åç´æ¥è¿åï¼\n 2. ä»ç´¢å¼ (city,name,age) åä¸ä¸ä¸ªè®°å½ï¼åæ ·ååºè¿ä¸ä¸ªå­æ®µçå¼ï¼ä½ä¸ºç»æéçä¸é¨åç´æ¥è¿åï¼\n 3. éå¤æ§è¡æ­¥éª¤ 2ï¼ç´å°æ¥å°ç¬¬ 1000 æ¡è®°å½ï¼æèæ¯ä¸æ»¡è¶³ city='æ­å·âæ¡ä»¶æ¶å¾ªç¯ç»æã\n\n\n# åç¼ç´¢å¼\n\nææ¶åéè¦ç´¢å¼å¾é¿çå­ç¬¦åï¼è¿ä¼è®©ç´¢å¼åå¾å¤§ä¸æ¢ã\n\nè¿æ¶ï¼å¯ä»¥ä½¿ç¨åç¼ç´¢å¼ï¼å³åªç´¢å¼å¼å§çé¨åå­ç¬¦ï¼è¿æ ·å¯ä»¥å¤§å¤§èçº¦ç´¢å¼ç©ºé´ï¼ä»èæé«ç´¢å¼æçãä½è¿æ ·ä¹ä¼éä½ç´¢å¼çéæ©æ§ãå¯¹äº blob/text/varchar è¿ç§ææ¬ç±»åçåï¼å¿é¡»ä½¿ç¨åç¼ç´¢å¼ï¼å ä¸ºæ°æ®åºå¾å¾ä¸åè®¸ç´¢å¼è¿äºåçå®æ´é¿åº¦ã\n\nç´¢å¼çéæ©æ§æ¯æï¼ä¸éå¤çç´¢å¼å¼åæ°æ®è¡¨è®°å½æ»æ°çæ¯å¼ãæå¤§å¼ä¸º 1ï¼æ­¤æ¶æ¯ä¸ªè®°å½é½æå¯ä¸çç´¢å¼ä¸å¶å¯¹åºãéæ©æ§è¶é«ï¼æ¥è¯¢æçä¹è¶é«ãå¦æå­å¨å¤æ¡å½ä¸­åç¼ç´¢å¼çæåµï¼å°±éè¦ä¾æ¬¡æ«æï¼ç´å°æç»æ¾å°æ­£ç¡®è®°å½ã\n\nä½¿ç¨åç¼ç´¢å¼ï¼å®ä¹å¥½é¿åº¦ï¼å°±å¯ä»¥åå°æ¢èçç©ºé´ï¼åä¸ç¨é¢å¤å¢å å¤ªå¤çæ¥è¯¢ææ¬ã\n\né£ä¹ï¼å¦ä½ç¡®å®åç¼ç´¢å¼åéçé¿åº¦å¢ï¼\n\nå¯ä»¥ä½¿ç¨ä¸é¢è¿ä¸ªè¯­å¥ï¼ç®åºè¿ä¸ªåä¸æå¤å°ä¸ªä¸åçå¼ï¼\n\nselect count(distinct email) as l from suser;\n\n\nç¶åï¼ä¾æ¬¡éåä¸åé¿åº¦çåç¼æ¥çè¿ä¸ªå¼ï¼æ¯å¦æä»¬è¦çä¸ä¸ 4~7 ä¸ªå­èçåç¼ç´¢å¼ï¼å¯ä»¥ç¨è¿ä¸ªè¯­å¥ï¼\n\nselect\n  count(distinct left(email,4)ï¼as l4,\n  count(distinct left(email,5)ï¼as l5,\n  count(distinct left(email,6)ï¼as l6,\n  count(distinct left(email,7)ï¼as l7,\nfrom suser;\n\n\nå½ç¶ï¼ä½¿ç¨åç¼ç´¢å¼å¾å¯è½ä¼æå¤±åºååº¦ï¼æä»¥ä½ éè¦é¢åè®¾å®ä¸ä¸ªå¯ä»¥æ¥åçæå¤±æ¯ä¾ï¼æ¯å¦ 5%ãç¶åï¼å¨è¿åç l4~l7 ä¸­ï¼æ¾åºä¸å°äº l * 95% çå¼ï¼åè®¾è¿é l6ãl7 é½æ»¡è¶³ï¼ä½ å°±å¯ä»¥éæ©åç¼é¿åº¦ä¸º 6ã\n\næ­¤å¤ï¼order by æ æ³ä½¿ç¨åç¼ç´¢å¼ï¼æ æ³æåç¼ç´¢å¼ç¨ä½è¦çç´¢å¼ã\n\n\n# æå·¦åç¼å¹éåå\n\nä¸åªæ¯ç´¢å¼çå¨é¨å®ä¹ï¼åªè¦æ»¡è¶³æå·¦åç¼ï¼å°±å¯ä»¥å©ç¨ç´¢å¼æ¥å éæ£ç´¢ãè¿ä¸ªæå·¦åç¼å¯ä»¥æ¯èåç´¢å¼çæå·¦ n ä¸ªå­æ®µï¼ä¹å¯ä»¥æ¯å­ç¬¦ä¸²ç´¢å¼çæå·¦ m ä¸ªå­ç¬¦ã\n\nmysql ä¼ä¸ç´åå³å¹éç´å°éå°èå´æ¥è¯¢ (>,<,between,like) å°±åæ­¢å¹éã\n\n * ç´¢å¼å¯ä»¥ç®åå¦ä¸ä¸ªå(a)ï¼ä¹å¯ä»¥å¤æå¦å¤ä¸ªå(a, b, c, d)ï¼å³èåç´¢å¼ã\n * å¦ææ¯èåç´¢å¼ï¼é£ä¹ key ä¹ç±å¤ä¸ªåç»æï¼åæ¶ï¼ç´¢å¼åªè½ç¨äºæ¥æ¾ key æ¯å¦å­å¨ï¼ç¸ç­ï¼ï¼éå°èå´æ¥è¯¢(>ã<ãbetweenãlike å·¦å¹é)ç­å°±ä¸è½è¿ä¸æ­¥å¹éäºï¼åç»­éåä¸ºçº¿æ§æ¥æ¾ã\n * å æ­¤ï¼åçæåé¡ºåºå³å®äºå¯å½ä¸­ç´¢å¼çåæ°ã\n\nä¸è¦ä¸ºæ¯ä¸ªåé½åå»ºç¬ç«ç´¢å¼ã\n\nå°éæ©æ§é«çåæåºæ°å¤§çåä¼åæå¨å¤åç´¢å¼æååãä½ææ¶ï¼ä¹éè¦èè where å­å¥ä¸­çæåºãåç»åèå´æ¡ä»¶ç­å ç´ ï¼è¿äºå ç´ ä¹ä¼å¯¹æ¥è¯¢æ§è½é æè¾å¤§å½±åã\n\nä¾å¦ï¼a = 1 and b = 2 and c > 3 and d = 4ï¼å¦æå»ºç«ï¼a,b,c,dï¼é¡ºåºçç´¢å¼ï¼d æ¯ç¨ä¸å°ç´¢å¼çï¼å¦æå»ºç«(a,b,d,c)çç´¢å¼åé½å¯ä»¥ç¨å°ï¼a,b,d çé¡ºåºå¯ä»¥ä»»æè°æ´ã\n\nè®©éæ©æ§æå¼ºçç´¢å¼åæ¾å¨åé¢ï¼ç´¢å¼çéæ©æ§æ¯æï¼ä¸éå¤çç´¢å¼å¼åè®°å½æ»æ°çæ¯å¼ãæå¤§å¼ä¸º 1ï¼æ­¤æ¶æ¯ä¸ªè®°å½é½æå¯ä¸çç´¢å¼ä¸å¶å¯¹åºãéæ©æ§è¶é«ï¼æ¥è¯¢æçä¹è¶é«ã\n\nä¾å¦ä¸é¢æ¾ç¤ºçç»æä¸­ customer_id çéæ©æ§æ¯ staff_id æ´é«ï¼å æ­¤æå¥½æ customer_id åæ¾å¨å¤åç´¢å¼çåé¢ã\n\nselect count(distinct staff_id)/count(*) as staff_id_selectivity,\ncount(distinct customer_id)/count(*) as customer_id_selectivity,\ncount(*)\nfrom payment;\n\n\n   staff_id_selectivity: 0.0001\ncustomer_id_selectivity: 0.0373\n               count(*): 16049\n\n\n\n# = å in å¯ä»¥ä¹±åº\n\nä¸éè¦èè =ãin ç­çé¡ºåºï¼mysql ä¼èªå¨ä¼åè¿äºæ¡ä»¶çé¡ºåºï¼ä»¥å¹éå°½å¯è½å¤çç´¢å¼åã\n\nãç¤ºä¾ãå¦æç´¢å¼ (a, b, c, d)ï¼æ¥è¯¢æ¡ä»¶ c > 3 and b = 2 and a = 1 and d < 4 ä¸ a = 1 and c > 3 and b = 2 and d < 4 ç­é¡ºåºé½æ¯å¯ä»¥çï¼mysql ä¼èªå¨ä¼åä¸º a = 1 and b = 2 and c > 3 and d < 4ï¼ä¾æ¬¡å½ä¸­ aãbãcãdã\n\n\n# ç´¢å¼æä½³å®è·µ\n\nåå»ºäºç´¢å¼ï¼å¹¶éä¸å®ææãæ¯å¦ä¸æ»¡è¶³åç¼ç´¢å¼ãæå·¦åç¼å¹éååãæ¥è¯¢æ¡ä»¶æ¶åå½æ°è®¡ç®ç­æåµé½æ æ³ä½¿ç¨ç´¢å¼ãæ­¤å¤ï¼å³ä½¿ sql æ¬èº«ç¬¦åç´¢å¼çä½¿ç¨æ¡ä»¶ï¼mysql ä¹ä¼éè¿è¯ä¼°åç§æ¥è¯¢æ¹å¼çä»£ä»·ï¼æ¥å³å®æ¯å¦èµ°ç´¢å¼ï¼ä»¥åèµ°åªä¸ªç´¢å¼ã\n\nå æ­¤ï¼å¨å°è¯éè¿ç´¢å¼è¿è¡ sql æ§è½ä¼åçæ¶åï¼å¡å¿éè¿æ§è¡è®¡åï¼explainï¼æå®éçæææ¥ç¡®è®¤ç´¢å¼æ¯å¦è½æææ¹åæ§è½é®é¢ï¼å¦åå¢å äºç´¢å¼ä¸ä½æ²¡è§£å³æ§è½é®é¢ï¼è¿å¢å äºæ°æ®åºå¢å æ¹çè´æãå¦æå¯¹ explain ç»åºçæ§è¡è®¡åæçé®çè¯ï¼ä½ è¿å¯ä»¥å©ç¨ optimizer_trace æ¥çè¯¦ç»çæ§è¡è®¡ååè¿ä¸æ­¥åæã\n\n\n# åèèµæ\n\n * ãé«æ§è½ mysqlã\n * æ°æ®åºä¸¤å¤§ç¥å¨ãç´¢å¼åéã\n * mysql ç´¢å¼èåçæ°æ®ç»æåç®æ³åç\n * mysql å®æ 45 è®²",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Mysql æ§è½ä¼å",frontmatter:{title:"Mysql æ§è½ä¼å",date:"2020-06-03T20:16:48.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql","æ§è½"],permalink:"/pages/396816/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/02.Mysql/06.Mysql%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html",relativePath:"12.æ°æ®åº/03.å³ç³»åæ°æ®åº/02.Mysql/06.Mysqlæ§è½ä¼å.md",key:"v-6d5ab7d6",path:"/pages/396816/",headers:[{level:2,title:"æ°æ®ç»æä¼å",slug:"æ°æ®ç»æä¼å",normalizedTitle:"æ°æ®ç»æä¼å",charIndex:17},{level:3,title:"æ°æ®ç±»åä¼å",slug:"æ°æ®ç±»åä¼å",normalizedTitle:"æ°æ®ç±»åä¼å",charIndex:50},{level:4,title:"æ°æ®ç±»åä¼ååºæ¬åå",slug:"æ°æ®ç±»åä¼ååºæ¬åå",normalizedTitle:"æ°æ®ç±»åä¼ååºæ¬åå",charIndex:60},{level:4,title:"ç±»åçéæ©",slug:"ç±»åçéæ©",normalizedTitle:"ç±»åçéæ©",charIndex:333},{level:3,title:"è¡¨è®¾è®¡",slug:"è¡¨è®¾è®¡",normalizedTitle:"è¡¨è®¾è®¡",charIndex:668},{level:3,title:"èå¼ååèå¼",slug:"èå¼ååèå¼",normalizedTitle:"èå¼ååèå¼",charIndex:932},{level:3,title:"ç´¢å¼ä¼å",slug:"ç´¢å¼ä¼å",normalizedTitle:"ç´¢å¼ä¼å",charIndex:1134},{level:4,title:"ä½æ¶ä½¿ç¨ç´¢å¼",slug:"ä½æ¶ä½¿ç¨ç´¢å¼",normalizedTitle:"ä½æ¶ä½¿ç¨ç´¢å¼",charIndex:1195},{level:4,title:"ç´¢å¼ä¼åç­ç¥",slug:"ç´¢å¼ä¼åç­ç¥",normalizedTitle:"ç´¢å¼ä¼åç­ç¥",charIndex:1333},{level:2,title:"SQL ä¼å",slug:"sql-ä¼å",normalizedTitle:"sql ä¼å",charIndex:1697},{level:3,title:"ä¼å COUNT() æ¥è¯¢",slug:"ä¼å-count-æ¥è¯¢",normalizedTitle:"ä¼å count() æ¥è¯¢",charIndex:1951},{level:3,title:"ä¼åå³èæ¥è¯¢",slug:"ä¼åå³èæ¥è¯¢",normalizedTitle:"ä¼åå³èæ¥è¯¢",charIndex:2609},{level:3,title:"ä¼å GROUP BY å DISTINCT",slug:"ä¼å-group-by-å-distinct",normalizedTitle:"ä¼å group by å distinct",charIndex:3734},{level:3,title:"ä¼å LIMIT",slug:"ä¼å-limit",normalizedTitle:"ä¼å limit",charIndex:3816},{level:3,title:"ä¼å UNION",slug:"ä¼å-union",normalizedTitle:"ä¼å union",charIndex:4624},{level:3,title:"ä¼åæ¥è¯¢æ¹å¼",slug:"ä¼åæ¥è¯¢æ¹å¼",normalizedTitle:"ä¼åæ¥è¯¢æ¹å¼",charIndex:4942},{level:4,title:"ååå¤§æ¥è¯¢",slug:"ååå¤§æ¥è¯¢",normalizedTitle:"ååå¤§æ¥è¯¢",charIndex:4952},{level:4,title:"åè§£å¤§è¿æ¥æ¥è¯¢",slug:"åè§£å¤§è¿æ¥æ¥è¯¢",normalizedTitle:"åè§£å¤§è¿æ¥æ¥è¯¢",charIndex:5262},{level:2,title:"æ§è¡è®¡åï¼EXPLAINï¼",slug:"æ§è¡è®¡å-explain",normalizedTitle:"æ§è¡è®¡åï¼explainï¼",charIndex:1742},{level:2,title:"optimizer trace",slug:"optimizer-trace",normalizedTitle:"optimizer trace",charIndex:7405},{level:2,title:"æ°æ®æ¨¡ååä¸å¡",slug:"æ°æ®æ¨¡ååä¸å¡",normalizedTitle:"æ°æ®æ¨¡ååä¸å¡",charIndex:7859},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:8112}],headersStr:"æ°æ®ç»æä¼å æ°æ®ç±»åä¼å æ°æ®ç±»åä¼ååºæ¬åå ç±»åçéæ© è¡¨è®¾è®¡ èå¼ååèå¼ ç´¢å¼ä¼å ä½æ¶ä½¿ç¨ç´¢å¼ ç´¢å¼ä¼åç­ç¥ SQL ä¼å ä¼å COUNT() æ¥è¯¢ ä¼åå³èæ¥è¯¢ ä¼å GROUP BY å DISTINCT ä¼å LIMIT ä¼å UNION ä¼åæ¥è¯¢æ¹å¼ ååå¤§æ¥è¯¢ åè§£å¤§è¿æ¥æ¥è¯¢ æ§è¡è®¡åï¼EXPLAINï¼ optimizer trace æ°æ®æ¨¡ååä¸å¡ åèèµæ",content:"# Mysql æ§è½ä¼å\n\n\n# æ°æ®ç»æä¼å\n\nè¯å¥½çé»è¾è®¾è®¡åç©çè®¾è®¡æ¯é«æ§è½çåºç³ã\n\n\n# æ°æ®ç±»åä¼å\n\n# æ°æ®ç±»åä¼ååºæ¬åå\n\n * æ´å°çéå¸¸æ´å¥½ - è¶å°çæ°æ®ç±»åéå¸¸ä¼æ´å¿«ï¼å ç¨æ´å°çç£çãåå­ï¼å¤çæ¶éè¦ç CPU å¨æä¹æ´å°ã\n   * ä¾å¦ï¼æ´åæ¯å­ç¬¦ç±»åæä½ä»£ä»·ä½ï¼å èä¼ä½¿ç¨æ´åæ¥å­å¨ IP å°åï¼ä½¿ç¨ DATETIME æ¥å­å¨æ¶é´ï¼èä¸æ¯ä½¿ç¨å­ç¬¦ä¸²ã\n * ç®åå°±å¥½ - å¦æ´åæ¯å­ç¬¦åæä½ä»£ä»·ä½ã\n   * ä¾å¦ï¼å¾å¤è½¯ä»¶ä¼ç¨æ´åæ¥å­å¨ IP å°åã\n   * ä¾å¦ï¼UNSIGNED è¡¨ç¤ºä¸åè®¸è´å¼ï¼å¤§è´å¯ä»¥ä½¿æ­£æ°çä¸éæé«ä¸åã\n * å°½éé¿å NULL - å¯ä¸º NULL çåä¼ä½¿å¾ç´¢å¼ãç´¢å¼ç»è®¡åå¼æ¯è¾é½æ´å¤æã\n\n# ç±»åçéæ©\n\n * æ´æ°ç±»åéå¸¸æ¯æ è¯åæå¥½çéæ©ï¼å ä¸ºå®ä»¬å¾å¿«å¹¶ä¸å¯ä»¥ä½¿ç¨ AUTO_INCREMENTã\n\n * ENUM å SET ç±»åéå¸¸æ¯ä¸ä¸ªç³ç³çéæ©ï¼åºå°½éé¿åã\n\n * åºè¯¥å°½éé¿åç¨å­ç¬¦ä¸²ç±»åä½ä¸ºæ è¯åï¼å ä¸ºå®ä»¬å¾æ¶èç©ºé´ï¼å¹¶ä¸éå¸¸æ¯æ°å­ç±»åæ¢ãå¯¹äº MD5ãSHAãUUID è¿ç±»éæºå­ç¬¦ä¸²ï¼ç±äºæ¯è¾éæºï¼æä»¥å¯è½åå¸å¨å¾å¤§çç©ºé´åï¼å¯¼è´ INSERT ä»¥åä¸äº SELECT è¯­å¥åå¾å¾æ¢ã\n   \n   * å¦æå­å¨ UUID ï¼åºè¯¥ç§»é¤ - ç¬¦å·ï¼æ´å¥½çåæ³æ¯ï¼ç¨ UNHEX() å½æ°è½¬æ¢ UUID å¼ä¸º 16 å­èçæ°å­ï¼å¹¶å­å¨å¨ä¸ä¸ª BINARY(16) çåä¸­ï¼æ£ç´¢æ¶ï¼å¯ä»¥éè¿ HEX() å½æ°æ¥æ ¼å¼åä¸º 16 è¿å¶æ ¼å¼ã\n\n\n# è¡¨è®¾è®¡\n\nåºè¯¥é¿åçè®¾è®¡é®é¢ï¼\n\n * å¤ªå¤çå - è®¾è®¡èä¸ºäºå¾æ¹ä¾¿ï¼å°å¤§éåä½åå å¥è¡¨ä¸­ï¼å®éæ¥è¯¢ä¸­ï¼è¡¨ä¸­å¾å¤åæ¯ç¨ä¸å°çãè¿ç§å®½è¡¨æ¨¡å¼è®¾è®¡ï¼ä¼é æä¸å°çæ§è½ä»£ä»·ï¼å°¤å¶æ¯ ALTER TABLE éå¸¸èæ¶ã\n * å¤ªå¤çå³è - æè°çå®ä½ - å±æ§ - å¼ï¼EAVï¼è®¾è®¡æ¨¡å¼æ¯ä¸ä¸ªå¸¸è§çç³ç³è®¾è®¡æ¨¡å¼ãMysql éå¶äºæ¯ä¸ªå³èæä½æå¤åªè½æ 61 å¼ è¡¨ï¼ä½ EAV æ¨¡å¼éè¦è®¸å¤èªå³èã\n * æä¸¾ - å°½éä¸è¦ç¨æä¸¾ï¼å ä¸ºæ·»å åå é¤å­ç¬¦ä¸²ï¼æä¸¾éé¡¹ï¼å¿é¡»ä½¿ç¨ ALTER TABLEã\n * å°½éé¿å NULL\n\n\n# èå¼ååèå¼\n\nèå¼åç®æ æ¯å°½éåå°åä½ï¼èåèå¼ååç¸åã\n\nèå¼åçä¼ç¹ï¼\n\n * æ¯åèå¼æ´èçç©ºé´\n * æ´æ°æä½æ¯åèå¼å¿«\n * æ´å°éè¦ DISTINCT æ GROUP BY è¯­å¥\n\nèå¼åçç¼ºç¹ï¼\n\n * éå¸¸éè¦å³èæ¥è¯¢ãèå³èæ¥è¯¢ä»£ä»·è¾é«ï¼å¦ææ¯åè¡¨çå³èæ¥è¯¢ï¼ä»£ä»·æ´æ¯é«æã\n\nå¨çå®ä¸çä¸­ï¼å¾å°ä¼æç«¯å°ä½¿ç¨èå¼åæåèå¼åãå®éä¸ï¼åºè¯¥æè¡¡èå¼ååèå¼çå©å¼ï¼æ··åä½¿ç¨ã\n\n\n# ç´¢å¼ä¼å\n\n> ç´¢å¼ä¼ååºè¯¥æ¯æ¥è¯¢æ§è½ä¼åçæææææ®µã\n> \n> å¦ææ³è¯¦ç»äºè§£ç´¢å¼ç¹æ§è¯·åèï¼Mysql ç´¢å¼\n\n# ä½æ¶ä½¿ç¨ç´¢å¼\n\n * å¯¹äºéå¸¸å°çè¡¨ï¼å¤§é¨åæåµä¸ç®åçå¨è¡¨æ«ææ´é«æã\n * å¯¹äºä¸­ãå¤§åè¡¨ï¼ç´¢å¼éå¸¸ææã\n * å¯¹äºç¹å¤§åè¡¨ï¼å»ºç«åä½¿ç¨ç´¢å¼çä»£ä»·å°éä¹å¢é¿ãå¯ä»¥èèä½¿ç¨ååºææ¯ã\n * å¦æè¡¨çæ°éç¹å«å¤ï¼å¯ä»¥å»ºç«ä¸ä¸ªåæ°æ®ä¿¡æ¯è¡¨ï¼ç¨æ¥æ¥è¯¢éè¦ç¨å°çæäºç¹æ§ã\n\n# ç´¢å¼ä¼åç­ç¥\n\n * ç´¢å¼åºæ¬åå\n   * ç´¢å¼ä¸æ¯è¶å¤è¶å¥½ï¼ä¸è¦ä¸ºææåé½åå»ºç´¢å¼ã\n   * è¦å°½éé¿ååä½åéå¤ç´¢å¼ã\n   * è¦èèå é¤æªä½¿ç¨çç´¢å¼ã\n   * å°½éçæ©å±ç´¢å¼ï¼ä¸è¦æ°å»ºç´¢å¼ã\n   * é¢ç¹ä½ä¸º WHERE è¿æ»¤æ¡ä»¶çååºè¯¥èèæ·»å ç´¢å¼ã\n * ç¬ç«çå - âç¬ç«çåâ æ¯æç´¢å¼åä¸è½æ¯è¡¨è¾¾å¼çä¸é¨åï¼ä¹ä¸è½æ¯å½æ°çåæ°ã\n * åç¼ç´¢å¼ - ç´¢å¼å¾é¿çå­ç¬¦åï¼å¯ä»¥ç´¢å¼å¼å§çé¨åå­ç¬¦ï¼è¿æ ·å¯ä»¥å¤§å¤§èçº¦ç´¢å¼ç©ºé´ã\n * æå·¦å¹éåå - å°éæ©æ§é«çåæåºæ°å¤§çåä¼åæå¨å¤åç´¢å¼æååã\n * ä½¿ç¨ç´¢å¼æ¥æåº - ç´¢å¼æå¥½æ¢æ»¡è¶³æåºï¼åç¨äºæ¥æ¾è¡ãè¿æ ·ï¼å°±å¯ä»¥ä½¿ç¨ç´¢å¼æ¥å¯¹ç»ææåºã\n * =ãIN å¯ä»¥ä¹±åº - ä¸éè¦èè =ãIN ç­çé¡ºåº\n * è¦çç´¢å¼\n * èªå¢å­æ®µä½ä¸»é®\n\n\n# SQL ä¼å\n\nä½¿ç¨ EXPLAIN å½ä»¤æ¥çå½å SQL æ¯å¦ä½¿ç¨äºç´¢å¼ï¼ä¼ååï¼åéè¿æ§è¡è®¡åï¼EXPLAINï¼æ¥æ¥çä¼åææã\n\nSQL ä¼ååºæ¬æè·¯ï¼\n\n * åªè¿åå¿è¦çå - æå¥½ä¸è¦ä½¿ç¨ SELECT * è¯­å¥ã\n\n * åªè¿åå¿è¦çè¡ - ä½¿ç¨ WHERE å­æ¥è¯¢è¯­å¥è¿è¡è¿æ»¤æ¥è¯¢ï¼ææ¶åä¹éè¦ä½¿ç¨ LIMIT è¯­å¥æ¥éå¶è¿åçæ°æ®ã\n\n * ç¼å­éå¤æ¥è¯¢çæ°æ® - åºè¯¥èèå¨å®¢æ·ç«¯ä½¿ç¨ç¼å­ï¼å°½éä¸è¦ä½¿ç¨ Mysql æå¡å¨ç¼å­ï¼å­å¨è¾å¤é®é¢åéå¶ï¼ã\n\n * ä½¿ç¨ç´¢å¼æ¥è¦çæ¥è¯¢\n\n\n# ä¼å COUNT() æ¥è¯¢\n\nCOUNT() æä¸¤ç§ä½ç¨ï¼\n\n * ç»è®¡æä¸ªåå¼çæ°éãç»è®¡åå¼æ¶ï¼è¦æ±åå¼æ¯é NULL çï¼å®ä¸ä¼ç»è®¡ NULLã\n * ç»è®¡è¡æ°ã\n\nç»è®¡åå¼æ¶ï¼è¦æ±åå¼æ¯éç©ºçï¼å®ä¸ä¼ç»è®¡ NULLãå¦æç¡®è®¤æ¬å·ä¸­çè¡¨è¾¾å¼ä¸å¯è½ä¸ºç©ºæ¶ï¼å®éä¸å°±æ¯å¨ç»è®¡è¡æ°ãæç®åçå°±æ¯å½ä½¿ç¨ COUNT(*) æ¶ï¼å¹¶ä¸æ¯æä»¬ææ³è±¡çé£æ ·æ©å±æææçåï¼å®éä¸ï¼å®ä¼å¿½ç¥ææçåèç´æ¥ç»è®¡è¡æ°ã\n\næä»¬æå¸¸è§çè¯¯è§£ä¹å°±å¨è¿å¿ï¼å¨æ¬å·åæå®äºä¸åå´å¸æç»è®¡ç»ææ¯è¡æ°ï¼èä¸è¿å¸¸å¸¸è¯¯ä»¥ä¸ºåèçæ§è½ä¼æ´å¥½ãä½å®éå¹¶éè¿æ ·ï¼å¦æè¦ç»è®¡è¡æ°ï¼ç´æ¥ä½¿ç¨ COUNT(*)ï¼æä¹æ¸æ°ï¼ä¸æ§è½æ´å¥½ã\n\nï¼1ï¼ç®åä¼å\n\nSELECT count(*) FROM world.city WHERE id > 5;\n\nSELECT (SELECT count(*) FROM world.city) - count(*)\nFROM world.city WHERE id <= 5;\n\n\nï¼2ï¼ä½¿ç¨è¿ä¼¼å¼\n\nææ¶åæäºä¸å¡åºæ¯å¹¶ä¸éè¦å®å¨ç²¾ç¡®çç»è®¡å¼ï¼å¯ä»¥ç¨è¿ä¼¼å¼æ¥ä»£æ¿ï¼EXPLAIN åºæ¥çè¡æ°å°±æ¯ä¸ä¸ªä¸éçè¿ä¼¼å¼ï¼èä¸æ§è¡ EXPLAIN å¹¶ä¸éè¦çæ­£å°å»æ§è¡æ¥è¯¢ï¼æä»¥ææ¬éå¸¸ä½ãéå¸¸æ¥è¯´ï¼æ§è¡ COUNT() é½éè¦æ«æå¤§éçè¡æè½è·åå°ç²¾ç¡®çæ°æ®ï¼å æ­¤å¾é¾ä¼åï¼MySQL å±é¢è¿è½åå¾ä¹å°±åªæè¦çç´¢å¼äºãå¦æä¸è¿è½è§£å³é®é¢ï¼åªæä»æ¶æå±é¢è§£å³äºï¼æ¯å¦æ·»å æ±æ»è¡¨ï¼æèä½¿ç¨ Redis è¿æ ·çå¤é¨ç¼å­ç³»ç»ã\n\n\n# ä¼åå³èæ¥è¯¢\n\nå¨å¤§æ°æ®åºæ¯ä¸ï¼è¡¨ä¸è¡¨ä¹é´éè¿ä¸ä¸ªåä½å­æ®µæ¥å³èï¼è¦æ¯ç´æ¥ä½¿ç¨ JOIN ææ´å¥½çæ§è½ã\n\nå¦æç¡®å®éè¦ä½¿ç¨å³èæ¥è¯¢çæåµä¸ï¼éè¦ç¹å«æ³¨æçæ¯ï¼\n\n * ç¡®ä¿ ON å USING å­å¥ä¸­çåä¸æç´¢å¼ãå¨åå»ºç´¢å¼çæ¶åå°±è¦èèå°å³èçé¡ºåºãå½è¡¨ A åè¡¨ B ç¨æå column å³èçæ¶åï¼å¦æä¼åå¨å³èçé¡ºåºæ¯ AãBï¼é£ä¹å°±ä¸éè¦å¨ A è¡¨çå¯¹åºåä¸åå»ºç´¢å¼ãæ²¡æç¨å°çç´¢å¼ä¼å¸¦æ¥é¢å¤çè´æï¼ä¸è¬æ¥è¯´ï¼é¤éæå¶ä»çç±ï¼åªéè¦å¨å³èé¡ºåºä¸­çç¬¬äºå¼ è¡¨çç¸åºåä¸åå»ºç´¢å¼ï¼å·ä½åå ä¸æåæï¼ã\n * ç¡®ä¿ä»»ä½ç GROUP BY å ORDER BY ä¸­çè¡¨è¾¾å¼åªæ¶åå°ä¸ä¸ªè¡¨ä¸­çåï¼è¿æ · MySQL ææå¯è½ä½¿ç¨ç´¢å¼æ¥ä¼åã\n\nè¦çè§£ä¼åå³èæ¥è¯¢çç¬¬ä¸ä¸ªæå·§ï¼å°±éè¦çè§£ MySQL æ¯å¦ä½æ§è¡å³èæ¥è¯¢çãå½å MySQL å³èæ§è¡çç­ç¥éå¸¸ç®åï¼å®å¯¹ä»»ä½çå³èé½æ§è¡åµå¥å¾ªç¯å³èæä½ï¼å³åå¨ä¸ä¸ªè¡¨ä¸­å¾ªç¯ååºåæ¡æ°æ®ï¼ç¶åå¨åµå¥å¾ªç¯å°ä¸ä¸ä¸ªè¡¨ä¸­å¯»æ¾å¹éçè¡ï¼ä¾æ¬¡ä¸å»ï¼ç´å°æ¾å°ææè¡¨ä¸­å¹éçè¡ä¸ºä¸ºæ­¢ãç¶åæ ¹æ®åä¸ªè¡¨å¹éçè¡ï¼è¿åæ¥è¯¢ä¸­éè¦çåä¸ªåã\n\nå¤ªæ½è±¡äºï¼ä»¥ä¸é¢çç¤ºä¾æ¥è¯´æï¼æ¯å¦æè¿æ ·çä¸ä¸ªæ¥è¯¢ï¼\n\nSELECT A.xx,B.yy\nFROM A INNER JOIN B USING(c)\nWHERE A.xx IN (5,6)\n\n\nåè®¾ MySQL æç§æ¥è¯¢ä¸­çå³èé¡ºåº AãB æ¥è¿è¡å³èæä½ï¼é£ä¹å¯ä»¥ç¨ä¸é¢çä¼ªä»£ç è¡¨ç¤º MySQL å¦ä½å®æè¿ä¸ªæ¥è¯¢ï¼\n\nouter_iterator = SELECT A.xx,A.c FROM A WHERE A.xx IN (5,6);\nouter_row = outer_iterator.next;\nwhile(outer_row) {\n    inner_iterator = SELECT B.yy FROM B WHERE B.c = outer_row.c;\n    inner_row = inner_iterator.next;\n    while(inner_row) {\n        output[inner_row.yy,outer_row.xx];\n        inner_row = inner_iterator.next;\n    }\n    outer_row = outer_iterator.next;\n}\n\n\nå¯ä»¥çå°ï¼æå¤å±çæ¥è¯¢æ¯æ ¹æ®A.xxåæ¥æ¥è¯¢çï¼A.cä¸å¦ææç´¢å¼çè¯ï¼æ´ä¸ªå³èæ¥è¯¢ä¹ä¸ä¼ä½¿ç¨ãåçåå±çæ¥è¯¢ï¼å¾ææ¾B.cä¸å¦ææç´¢å¼çè¯ï¼è½å¤å éæ¥è¯¢ï¼å æ­¤åªéè¦å¨å³èé¡ºåºä¸­çç¬¬äºå¼ è¡¨çç¸åºåä¸åå»ºç´¢å¼å³å¯ã\n\n\n# ä¼å GROUP BY å DISTINCT\n\nMysql ä¼åå¨ä¼å¨åé¨å¤ççæ¶åç¸äºè½¬åè¿ä¸¤ç±»æ¥è¯¢ãå®ä»¬é½å¯ä»¥ä½¿ç¨ç´¢å¼æ¥ä¼åï¼è¿ä¹æ¯æææçä¼åæ¹æ³ã\n\n\n# ä¼å LIMIT\n\nå½éè¦åé¡µæä½æ¶ï¼éå¸¸ä¼ä½¿ç¨ LIMIT å ä¸åç§»éçåæ³å®ç°ï¼åæ¶å ä¸åéç ORDER BY å­å¥ãå¦ææå¯¹åºçç´¢å¼ï¼éå¸¸æçä¼ä¸éï¼å¦åï¼MySQL éè¦åå¤§éçæä»¶æåºæä½ã\n\nä¸ä¸ªå¸¸è§çé®é¢æ¯å½åç§»ééå¸¸å¤§çæ¶åï¼æ¯å¦ï¼LIMIT 10000 20è¿æ ·çæ¥è¯¢ï¼MySQL éè¦æ¥è¯¢ 10020 æ¡è®°å½ç¶ååªè¿å 20 æ¡è®°å½ï¼åé¢ç 10000 æ¡é½å°è¢«æå¼ï¼è¿æ ·çä»£ä»·éå¸¸é«ã\n\nä¼åè¿ç§æ¥è¯¢ä¸ä¸ªæç®åçåæ³å°±æ¯å°½å¯è½çä½¿ç¨è¦çç´¢å¼æ«æï¼èä¸æ¯æ¥è¯¢ææçåãç¶åæ ¹æ®éè¦åä¸æ¬¡å³èæ¥è¯¢åè¿åææçåãå¯¹äºåç§»éå¾å¤§æ¶ï¼è¿æ ·åçæçä¼æåéå¸¸å¤§ãèèä¸é¢çæ¥è¯¢ï¼\n\nSELECT film_id,description FROM film ORDER BY title LIMIT 50,5;\n\n\nå¦æè¿å¼ è¡¨éå¸¸å¤§ï¼é£ä¹è¿ä¸ªæ¥è¯¢æå¥½æ¹æä¸é¢çæ ·å­ï¼\n\nSELECT film.film_id,film.description\nFROM film INNER JOIN (\n    SELECT film_id FROM film ORDER BY title LIMIT 50,5\n) AS tmp USING(film_id);\n\n\nè¿éçå»¶è¿å³èå°å¤§å¤§æåæ¥è¯¢æçï¼è®© MySQL æ«æå°½å¯è½å°çé¡µé¢ï¼è·åéè¦è®¿é®çè®°å½åå¨æ ¹æ®å³èåååè¡¨æ¥è¯¢æéè¦çåã\n\nææ¶åå¦æå¯ä»¥ä½¿ç¨ä¹¦ç­¾è®°å½ä¸æ¬¡åæ°æ®çä½ç½®ï¼é£ä¹ä¸æ¬¡å°±å¯ä»¥ç´æ¥ä»è¯¥ä¹¦ç­¾è®°å½çä½ç½®å¼å§æ«æï¼è¿æ ·å°±å¯ä»¥é¿åä½¿ç¨OFFSETï¼æ¯å¦ä¸é¢çæ¥è¯¢ï¼\n\nSELECT id FROM t LIMIT 10000, 10;\næ¹ä¸ºï¼\nSELECT id FROM t WHERE id > 10000 LIMIT 10;\n\n\nå¶ä»ä¼åçåæ³è¿åæ¬ä½¿ç¨é¢åè®¡ç®çæ±æ»è¡¨ï¼æèå³èå°ä¸ä¸ªåä½è¡¨ï¼åä½è¡¨ä¸­åªåå«ä¸»é®ååéè¦åæåºçåã\n\n\n# ä¼å UNION\n\nMySQL æ»æ¯éè¿åå»ºå¹¶å¡«åä¸´æ¶è¡¨çæ¹å¼æ¥æ§è¡ UNION æ¥è¯¢ãå æ­¤å¾å¤ä¼åç­ç¥å¨UNIONæ¥è¯¢ä¸­é½æ²¡æåæ³å¾å¥½çæ¶åãç»å¸¸éè¦æå¨å°WHEREãLIMITãORDER BYç­å­å¥âä¸æ¨âå°åä¸ªå­æ¥è¯¢ä¸­ï¼ä»¥ä¾¿ä¼åå¨å¯ä»¥ååå©ç¨è¿äºæ¡ä»¶åä¼åã\n\né¤éç¡®å®éè¦æå¡å¨å»éï¼å¦åå°±ä¸å®è¦ä½¿ç¨UNION ALLï¼å¦ææ²¡æALLå³é®å­ï¼MySQL ä¼ç»ä¸´æ¶è¡¨å ä¸DISTINCTéé¡¹ï¼è¿ä¼å¯¼è´æ´ä¸ªä¸´æ¶è¡¨çæ°æ®åå¯ä¸æ§æ£æ¥ï¼è¿æ ·åçä»£ä»·éå¸¸é«ãå½ç¶å³ä½¿ä½¿ç¨ ALL å³é®å­ï¼MySQL æ»æ¯å°ç»ææ¾å¥ä¸´æ¶è¡¨ï¼ç¶ååè¯»åºï¼åè¿åç»å®¢æ·ç«¯ãè½ç¶å¾å¤æ¶åæ²¡æè¿ä¸ªå¿è¦ï¼æ¯å¦ææ¶åå¯ä»¥ç´æ¥ææ¯ä¸ªå­æ¥è¯¢çç»æè¿åç»å®¢æ·ç«¯ã\n\n\n# ä¼åæ¥è¯¢æ¹å¼\n\n# ååå¤§æ¥è¯¢\n\nä¸ä¸ªå¤§æ¥è¯¢å¦æä¸æ¬¡æ§æ§è¡çè¯ï¼å¯è½ä¸æ¬¡éä½å¾å¤æ°æ®ãå æ»¡æ´ä¸ªäºå¡æ¥å¿ãèå°½ç³»ç»èµæºãé»å¡å¾å¤å°çä½éè¦çæ¥è¯¢ã\n\nDELEFT FROM messages WHERE create < DATE_SUB(NOW(), INTERVAL 3 MONTH);\n\n\nrows_affected = 0\ndo {\n    rows_affected = do_query(\n    \"DELETE FROM messages WHERE create  < DATE_SUB(NOW(), INTERVAL 3 MONTH) LIMIT 10000\")\n} while rows_affected > 0\n\n\n# åè§£å¤§è¿æ¥æ¥è¯¢\n\nå°ä¸ä¸ªå¤§è¿æ¥æ¥è¯¢ï¼JOINï¼åè§£æå¯¹æ¯ä¸ä¸ªè¡¨è¿è¡ä¸æ¬¡åè¡¨æ¥è¯¢ï¼ç¶åå°ç»æå¨åºç¨ç¨åºä¸­è¿è¡å³èï¼è¿æ ·åçå¥½å¤æï¼\n\n * è®©ç¼å­æ´é«æãå¯¹äºè¿æ¥æ¥è¯¢ï¼å¦æå¶ä¸­ä¸ä¸ªè¡¨åçååï¼é£ä¹æ´ä¸ªæ¥è¯¢ç¼å­å°±æ æ³ä½¿ç¨ãèåè§£åçå¤ä¸ªæ¥è¯¢ï¼å³ä½¿å¶ä¸­ä¸ä¸ªè¡¨åçååï¼å¯¹å¶å®è¡¨çæ¥è¯¢ç¼å­ä¾ç¶å¯ä»¥ä½¿ç¨ã\n * åè§£æå¤ä¸ªåè¡¨æ¥è¯¢ï¼è¿äºåè¡¨æ¥è¯¢çç¼å­ç»ææ´å¯è½è¢«å¶å®æ¥è¯¢ä½¿ç¨å°ï¼ä»èåå°åä½è®°å½çæ¥è¯¢ã\n * åå°éç«äºï¼\n * å¨åºç¨å±è¿è¡è¿æ¥ï¼å¯ä»¥æ´å®¹æå¯¹æ°æ®åºè¿è¡æåï¼ä»èæ´å®¹æåå°é«æ§è½åå¯æ©å±ã\n * æ¥è¯¢æ¬èº«æçä¹å¯è½ä¼æææåãä¾å¦ä¸é¢çä¾å­ä¸­ï¼ä½¿ç¨ IN() ä»£æ¿è¿æ¥æ¥è¯¢ï¼å¯ä»¥è®© MySQL æç§ ID é¡ºåºè¿è¡æ¥è¯¢ï¼è¿å¯è½æ¯éæºçè¿æ¥è¦æ´é«æã\n\nSELECT * FROM tag\nJOIN tag_post ON tag_post.tag_id=tag.id\nJOIN post ON tag_post.post_id=post.id\nWHERE tag.tag='mysql';\n\n\nSELECT * FROM tag WHERE tag='mysql';\nSELECT * FROM tag_post WHERE tag_id=1234;\nSELECT * FROM post WHERE post.id IN (123,456,567,9098,8904);\n\n\n\n# æ§è¡è®¡åï¼EXPLAINï¼\n\nå¦ä½å¤æ­å½å SQL æ¯å¦ä½¿ç¨äºç´¢å¼ï¼å¦ä½æ£éªä¿®æ¹åç SQL ç¡®å®æä¼åææï¼\n\nå¨ SQL ä¸­ï¼å¯ä»¥éè¿æ§è¡è®¡åï¼EXPLAINï¼åæ SELECT æ¥è¯¢æçã\n\nmysql> explain select * from user_info where id = 2\\G\n*************************** 1. row ***************************\n           id: 1\n  select_type: SIMPLE\n        table: user_info\n   partitions: NULL\n         type: const\npossible_keys: PRIMARY\n          key: PRIMARY\n      key_len: 8\n          ref: const\n         rows: 1\n     filtered: 100.00\n        Extra: NULL\n1 row in set, 1 warning (0.00 sec)\n\n\nEXPLAIN åæ°è¯´æï¼\n\n * id: SELECT æ¥è¯¢çæ è¯ç¬¦. æ¯ä¸ª SELECT é½ä¼èªå¨åéä¸ä¸ªå¯ä¸çæ è¯ç¬¦.\n * select_type â­ ï¼SELECT æ¥è¯¢çç±»å.\n   * SIMPLEï¼è¡¨ç¤ºæ­¤æ¥è¯¢ä¸åå« UNION æ¥è¯¢æå­æ¥è¯¢\n   * PRIMARYï¼è¡¨ç¤ºæ­¤æ¥è¯¢æ¯æå¤å±çæ¥è¯¢\n   * UNIONï¼è¡¨ç¤ºæ­¤æ¥è¯¢æ¯ UNION çç¬¬äºæéåçæ¥è¯¢\n   * DEPENDENT UNIONï¼UNION ä¸­çç¬¬äºä¸ªæåé¢çæ¥è¯¢è¯­å¥, åå³äºå¤é¢çæ¥è¯¢\n   * UNION RESULTï¼UNION çç»æ\n   * SUBQUERYï¼å­æ¥è¯¢ä¸­çç¬¬ä¸ä¸ª SELECT\n   * DEPENDENT SUBQUERY: å­æ¥è¯¢ä¸­çç¬¬ä¸ä¸ª SELECT, åå³äºå¤é¢çæ¥è¯¢. å³å­æ¥è¯¢ä¾èµäºå¤å±æ¥è¯¢çç»æ.\n * table: æ¥è¯¢çæ¯åªä¸ªè¡¨ï¼å¦æç»è¡¨èµ·å«åäºï¼åæ¾ç¤ºå«åã\n * partitionsï¼å¹éçååº\n * type â­ï¼è¡¨ç¤ºä»è¡¨ä¸­æ¥è¯¢å°è¡ææ§è¡çæ¹å¼ï¼æ¥è¯¢æ¹å¼æ¯ SQL ä¼åä¸­ä¸ä¸ªå¾éè¦çææ ï¼ç»æå¼ä»å¥½å°å·®ä¾æ¬¡æ¯ï¼system > const > eq_ref > ref > range > index > ALLã\n   * system/constï¼è¡¨ä¸­åªæä¸è¡æ°æ®å¹éï¼æ­¤æ¶æ ¹æ®ç´¢å¼æ¥è¯¢ä¸æ¬¡å°±è½æ¾å°å¯¹åºçæ°æ®ãå¦ææ¯ B + æ ç´¢å¼ï¼æä»¬ç¥éæ­¤æ¶ç´¢å¼æé æäºå¤ä¸ªå±çº§çæ ï¼å½æ¥è¯¢çç´¢å¼å¨æ çåºå±æ¶ï¼æ¥è¯¢æçå°±è¶ä½ãconst è¡¨ç¤ºæ­¤æ¶ç´¢å¼å¨ç¬¬ä¸å±ï¼åªéè®¿é®ä¸å±ä¾¿è½å¾å°æ°æ®ã\n   * eq_refï¼ä½¿ç¨å¯ä¸ç´¢å¼æ«æï¼å¸¸è§äºå¤è¡¨è¿æ¥ä¸­ä½¿ç¨ä¸»é®åå¯ä¸ç´¢å¼ä½ä¸ºå³èæ¡ä»¶ã\n   * refï¼éå¯ä¸ç´¢å¼æ«æï¼è¿å¯è§äºå¯ä¸ç´¢å¼æå·¦ååå¹éæ«æã\n   * rangeï¼ç´¢å¼èå´æ«æï¼æ¯å¦ï¼<ï¼>ï¼between ç­æä½ã\n   * indexï¼ç´¢å¼å¨è¡¨æ«æï¼æ­¤æ¶éåæ´ä¸ªç´¢å¼æ ã\n   * ALLï¼è¡¨ç¤ºå¨è¡¨æ«æï¼éè¦éåå¨è¡¨æ¥æ¾å°å¯¹åºçè¡ã\n * possible_keysï¼æ­¤æ¬¡æ¥è¯¢ä¸­å¯è½éç¨çç´¢å¼ã\n * key â­ï¼æ­¤æ¬¡æ¥è¯¢ä¸­å®éä½¿ç¨çç´¢å¼ã\n * refï¼åªä¸ªå­æ®µæå¸¸æ°ä¸ key ä¸èµ·è¢«ä½¿ç¨ã\n * rows â­ï¼æ¾ç¤ºæ­¤æ¥è¯¢ä¸å±æ«æäºå¤å°è¡ï¼è¿ä¸ªæ¯ä¸ä¸ªä¼°è®¡å¼ã\n * filteredï¼è¡¨ç¤ºæ­¤æ¥è¯¢æ¡ä»¶æè¿æ»¤çæ°æ®çç¾åæ¯ã\n * extraï¼é¢å¤çä¿¡æ¯ã\n\n> æ´å¤åå®¹è¯·åèï¼MySQL æ§è½ä¼åç¥å¨ Explain ä½¿ç¨åæ\n\n\n# optimizer trace\n\nå¨ MySQL 5.6 åä¹åççæ¬ä¸­ï¼æä»¬å¯ä»¥ä½¿ç¨ optimizer trace åè½æ¥çä¼åå¨çææ§è¡è®¡åçæ´ä¸ªè¿ç¨ãæäºè¿ä¸ªåè½ï¼æä»¬ä¸ä»å¯ä»¥äºè§£ä¼åå¨çéæ©è¿ç¨ï¼æ´å¯ä»¥äºè§£æ¯ä¸ä¸ªæ§è¡ç¯èçææ¬ï¼ç¶åä¾é è¿äºä¿¡æ¯è¿ä¸æ­¥ä¼åæ¥è¯¢ã\n\nå¦ä¸ä»£ç æç¤ºï¼æå¼ optimizer_trace åï¼åæ§è¡ SQL å°±å¯ä»¥æ¥è¯¢ information_schema.OPTIMIZER_TRACE è¡¨æ¥çæ§è¡è®¡åäºï¼æåå¯ä»¥å³é­ optimizer_trace åè½ï¼\n\nSET optimizer_trace=\"enabled=on\";\nSELECT * FROM person WHERE NAME >'name84059' AND create_time>'2020-01-24 05:00\nSELECT * FROM information_schema.OPTIMIZER_TRACE;\nSET optimizer_trace=\"enabled=off\";\n\n\n\n# æ°æ®æ¨¡ååä¸å¡\n\n * è¡¨å­æ®µæ¯è¾å¤æãæåå¨ãç»æé¾ä»¥ç»ä¸çæåµä¸ï¼å¯ä»¥èèä½¿ç¨ Nosql æ¥ä»£æ¿å³ç³»æ°æ®åºè¡¨å­å¨ï¼å¦ ElasticSearchãMongoDBã\n * å¨é«å¹¶åæåµä¸çæ¥è¯¢æä½ï¼å¯ä»¥ä½¿ç¨ç¼å­ï¼å¦ Redisï¼ä»£æ¿æ°æ®åºæä½ï¼æé«å¹¶åæ§è½ã\n * æ°æ®éå¢é¿è¾å¿«çè¡¨ï¼éè¦èèæ°´å¹³åè¡¨æååºï¼é¿ååè¡¨æä½çæ§è½ç¶é¢ã\n * é¤æ­¤ä¹å¤ï¼æä»¬åºè¯¥éè¿ä¸äºä¼åï¼å°½éé¿åæ¯è¾å¤æç JOIN æ¥è¯¢æä½ï¼ä¾å¦åä½ä¸äºå­æ®µï¼åå° JOIN æ¥è¯¢ï¼åå»ºä¸äºä¸­é´è¡¨ï¼åå° JOIN æ¥è¯¢ã\n\n\n# åèèµæ\n\n * ãé«æ§è½ MySQLã\n * ãJava æ§è½è°ä¼å®æã\n * æå¿é¡»å¾åè¯å¤§å®¶ç MySQL ä¼ååç\n * 20+ æ¡ MySQL æ§è½ä¼åçæä½³ç»éª\n * MySQL æ§è½ä¼åç¥å¨ Explain ä½¿ç¨åæ",normalizedContent:"# mysql æ§è½ä¼å\n\n\n# æ°æ®ç»æä¼å\n\nè¯å¥½çé»è¾è®¾è®¡åç©çè®¾è®¡æ¯é«æ§è½çåºç³ã\n\n\n# æ°æ®ç±»åä¼å\n\n# æ°æ®ç±»åä¼ååºæ¬åå\n\n * æ´å°çéå¸¸æ´å¥½ - è¶å°çæ°æ®ç±»åéå¸¸ä¼æ´å¿«ï¼å ç¨æ´å°çç£çãåå­ï¼å¤çæ¶éè¦ç cpu å¨æä¹æ´å°ã\n   * ä¾å¦ï¼æ´åæ¯å­ç¬¦ç±»åæä½ä»£ä»·ä½ï¼å èä¼ä½¿ç¨æ´åæ¥å­å¨ ip å°åï¼ä½¿ç¨ datetime æ¥å­å¨æ¶é´ï¼èä¸æ¯ä½¿ç¨å­ç¬¦ä¸²ã\n * ç®åå°±å¥½ - å¦æ´åæ¯å­ç¬¦åæä½ä»£ä»·ä½ã\n   * ä¾å¦ï¼å¾å¤è½¯ä»¶ä¼ç¨æ´åæ¥å­å¨ ip å°åã\n   * ä¾å¦ï¼unsigned è¡¨ç¤ºä¸åè®¸è´å¼ï¼å¤§è´å¯ä»¥ä½¿æ­£æ°çä¸éæé«ä¸åã\n * å°½éé¿å null - å¯ä¸º null çåä¼ä½¿å¾ç´¢å¼ãç´¢å¼ç»è®¡åå¼æ¯è¾é½æ´å¤æã\n\n# ç±»åçéæ©\n\n * æ´æ°ç±»åéå¸¸æ¯æ è¯åæå¥½çéæ©ï¼å ä¸ºå®ä»¬å¾å¿«å¹¶ä¸å¯ä»¥ä½¿ç¨ auto_incrementã\n\n * enum å set ç±»åéå¸¸æ¯ä¸ä¸ªç³ç³çéæ©ï¼åºå°½éé¿åã\n\n * åºè¯¥å°½éé¿åç¨å­ç¬¦ä¸²ç±»åä½ä¸ºæ è¯åï¼å ä¸ºå®ä»¬å¾æ¶èç©ºé´ï¼å¹¶ä¸éå¸¸æ¯æ°å­ç±»åæ¢ãå¯¹äº md5ãshaãuuid è¿ç±»éæºå­ç¬¦ä¸²ï¼ç±äºæ¯è¾éæºï¼æä»¥å¯è½åå¸å¨å¾å¤§çç©ºé´åï¼å¯¼è´ insert ä»¥åä¸äº select è¯­å¥åå¾å¾æ¢ã\n   \n   * å¦æå­å¨ uuid ï¼åºè¯¥ç§»é¤ - ç¬¦å·ï¼æ´å¥½çåæ³æ¯ï¼ç¨ unhex() å½æ°è½¬æ¢ uuid å¼ä¸º 16 å­èçæ°å­ï¼å¹¶å­å¨å¨ä¸ä¸ª binary(16) çåä¸­ï¼æ£ç´¢æ¶ï¼å¯ä»¥éè¿ hex() å½æ°æ¥æ ¼å¼åä¸º 16 è¿å¶æ ¼å¼ã\n\n\n# è¡¨è®¾è®¡\n\nåºè¯¥é¿åçè®¾è®¡é®é¢ï¼\n\n * å¤ªå¤çå - è®¾è®¡èä¸ºäºå¾æ¹ä¾¿ï¼å°å¤§éåä½åå å¥è¡¨ä¸­ï¼å®éæ¥è¯¢ä¸­ï¼è¡¨ä¸­å¾å¤åæ¯ç¨ä¸å°çãè¿ç§å®½è¡¨æ¨¡å¼è®¾è®¡ï¼ä¼é æä¸å°çæ§è½ä»£ä»·ï¼å°¤å¶æ¯ alter table éå¸¸èæ¶ã\n * å¤ªå¤çå³è - æè°çå®ä½ - å±æ§ - å¼ï¼eavï¼è®¾è®¡æ¨¡å¼æ¯ä¸ä¸ªå¸¸è§çç³ç³è®¾è®¡æ¨¡å¼ãmysql éå¶äºæ¯ä¸ªå³èæä½æå¤åªè½æ 61 å¼ è¡¨ï¼ä½ eav æ¨¡å¼éè¦è®¸å¤èªå³èã\n * æä¸¾ - å°½éä¸è¦ç¨æä¸¾ï¼å ä¸ºæ·»å åå é¤å­ç¬¦ä¸²ï¼æä¸¾éé¡¹ï¼å¿é¡»ä½¿ç¨ alter tableã\n * å°½éé¿å null\n\n\n# èå¼ååèå¼\n\nèå¼åç®æ æ¯å°½éåå°åä½ï¼èåèå¼ååç¸åã\n\nèå¼åçä¼ç¹ï¼\n\n * æ¯åèå¼æ´èçç©ºé´\n * æ´æ°æä½æ¯åèå¼å¿«\n * æ´å°éè¦ distinct æ group by è¯­å¥\n\nèå¼åçç¼ºç¹ï¼\n\n * éå¸¸éè¦å³èæ¥è¯¢ãèå³èæ¥è¯¢ä»£ä»·è¾é«ï¼å¦ææ¯åè¡¨çå³èæ¥è¯¢ï¼ä»£ä»·æ´æ¯é«æã\n\nå¨çå®ä¸çä¸­ï¼å¾å°ä¼æç«¯å°ä½¿ç¨èå¼åæåèå¼åãå®éä¸ï¼åºè¯¥æè¡¡èå¼ååèå¼çå©å¼ï¼æ··åä½¿ç¨ã\n\n\n# ç´¢å¼ä¼å\n\n> ç´¢å¼ä¼ååºè¯¥æ¯æ¥è¯¢æ§è½ä¼åçæææææ®µã\n> \n> å¦ææ³è¯¦ç»äºè§£ç´¢å¼ç¹æ§è¯·åèï¼mysql ç´¢å¼\n\n# ä½æ¶ä½¿ç¨ç´¢å¼\n\n * å¯¹äºéå¸¸å°çè¡¨ï¼å¤§é¨åæåµä¸ç®åçå¨è¡¨æ«ææ´é«æã\n * å¯¹äºä¸­ãå¤§åè¡¨ï¼ç´¢å¼éå¸¸ææã\n * å¯¹äºç¹å¤§åè¡¨ï¼å»ºç«åä½¿ç¨ç´¢å¼çä»£ä»·å°éä¹å¢é¿ãå¯ä»¥èèä½¿ç¨ååºææ¯ã\n * å¦æè¡¨çæ°éç¹å«å¤ï¼å¯ä»¥å»ºç«ä¸ä¸ªåæ°æ®ä¿¡æ¯è¡¨ï¼ç¨æ¥æ¥è¯¢éè¦ç¨å°çæäºç¹æ§ã\n\n# ç´¢å¼ä¼åç­ç¥\n\n * ç´¢å¼åºæ¬åå\n   * ç´¢å¼ä¸æ¯è¶å¤è¶å¥½ï¼ä¸è¦ä¸ºææåé½åå»ºç´¢å¼ã\n   * è¦å°½éé¿ååä½åéå¤ç´¢å¼ã\n   * è¦èèå é¤æªä½¿ç¨çç´¢å¼ã\n   * å°½éçæ©å±ç´¢å¼ï¼ä¸è¦æ°å»ºç´¢å¼ã\n   * é¢ç¹ä½ä¸º where è¿æ»¤æ¡ä»¶çååºè¯¥èèæ·»å ç´¢å¼ã\n * ç¬ç«çå - âç¬ç«çåâ æ¯æç´¢å¼åä¸è½æ¯è¡¨è¾¾å¼çä¸é¨åï¼ä¹ä¸è½æ¯å½æ°çåæ°ã\n * åç¼ç´¢å¼ - ç´¢å¼å¾é¿çå­ç¬¦åï¼å¯ä»¥ç´¢å¼å¼å§çé¨åå­ç¬¦ï¼è¿æ ·å¯ä»¥å¤§å¤§èçº¦ç´¢å¼ç©ºé´ã\n * æå·¦å¹éåå - å°éæ©æ§é«çåæåºæ°å¤§çåä¼åæå¨å¤åç´¢å¼æååã\n * ä½¿ç¨ç´¢å¼æ¥æåº - ç´¢å¼æå¥½æ¢æ»¡è¶³æåºï¼åç¨äºæ¥æ¾è¡ãè¿æ ·ï¼å°±å¯ä»¥ä½¿ç¨ç´¢å¼æ¥å¯¹ç»ææåºã\n * =ãin å¯ä»¥ä¹±åº - ä¸éè¦èè =ãin ç­çé¡ºåº\n * è¦çç´¢å¼\n * èªå¢å­æ®µä½ä¸»é®\n\n\n# sql ä¼å\n\nä½¿ç¨ explain å½ä»¤æ¥çå½å sql æ¯å¦ä½¿ç¨äºç´¢å¼ï¼ä¼ååï¼åéè¿æ§è¡è®¡åï¼explainï¼æ¥æ¥çä¼åææã\n\nsql ä¼ååºæ¬æè·¯ï¼\n\n * åªè¿åå¿è¦çå - æå¥½ä¸è¦ä½¿ç¨ select * è¯­å¥ã\n\n * åªè¿åå¿è¦çè¡ - ä½¿ç¨ where å­æ¥è¯¢è¯­å¥è¿è¡è¿æ»¤æ¥è¯¢ï¼ææ¶åä¹éè¦ä½¿ç¨ limit è¯­å¥æ¥éå¶è¿åçæ°æ®ã\n\n * ç¼å­éå¤æ¥è¯¢çæ°æ® - åºè¯¥èèå¨å®¢æ·ç«¯ä½¿ç¨ç¼å­ï¼å°½éä¸è¦ä½¿ç¨ mysql æå¡å¨ç¼å­ï¼å­å¨è¾å¤é®é¢åéå¶ï¼ã\n\n * ä½¿ç¨ç´¢å¼æ¥è¦çæ¥è¯¢\n\n\n# ä¼å count() æ¥è¯¢\n\ncount() æä¸¤ç§ä½ç¨ï¼\n\n * ç»è®¡æä¸ªåå¼çæ°éãç»è®¡åå¼æ¶ï¼è¦æ±åå¼æ¯é null çï¼å®ä¸ä¼ç»è®¡ nullã\n * ç»è®¡è¡æ°ã\n\nç»è®¡åå¼æ¶ï¼è¦æ±åå¼æ¯éç©ºçï¼å®ä¸ä¼ç»è®¡ nullãå¦æç¡®è®¤æ¬å·ä¸­çè¡¨è¾¾å¼ä¸å¯è½ä¸ºç©ºæ¶ï¼å®éä¸å°±æ¯å¨ç»è®¡è¡æ°ãæç®åçå°±æ¯å½ä½¿ç¨ count(*) æ¶ï¼å¹¶ä¸æ¯æä»¬ææ³è±¡çé£æ ·æ©å±æææçåï¼å®éä¸ï¼å®ä¼å¿½ç¥ææçåèç´æ¥ç»è®¡è¡æ°ã\n\næä»¬æå¸¸è§çè¯¯è§£ä¹å°±å¨è¿å¿ï¼å¨æ¬å·åæå®äºä¸åå´å¸æç»è®¡ç»ææ¯è¡æ°ï¼èä¸è¿å¸¸å¸¸è¯¯ä»¥ä¸ºåèçæ§è½ä¼æ´å¥½ãä½å®éå¹¶éè¿æ ·ï¼å¦æè¦ç»è®¡è¡æ°ï¼ç´æ¥ä½¿ç¨ count(*)ï¼æä¹æ¸æ°ï¼ä¸æ§è½æ´å¥½ã\n\nï¼1ï¼ç®åä¼å\n\nselect count(*) from world.city where id > 5;\n\nselect (select count(*) from world.city) - count(*)\nfrom world.city where id <= 5;\n\n\nï¼2ï¼ä½¿ç¨è¿ä¼¼å¼\n\nææ¶åæäºä¸å¡åºæ¯å¹¶ä¸éè¦å®å¨ç²¾ç¡®çç»è®¡å¼ï¼å¯ä»¥ç¨è¿ä¼¼å¼æ¥ä»£æ¿ï¼explain åºæ¥çè¡æ°å°±æ¯ä¸ä¸ªä¸éçè¿ä¼¼å¼ï¼èä¸æ§è¡ explain å¹¶ä¸éè¦çæ­£å°å»æ§è¡æ¥è¯¢ï¼æä»¥ææ¬éå¸¸ä½ãéå¸¸æ¥è¯´ï¼æ§è¡ count() é½éè¦æ«æå¤§éçè¡æè½è·åå°ç²¾ç¡®çæ°æ®ï¼å æ­¤å¾é¾ä¼åï¼mysql å±é¢è¿è½åå¾ä¹å°±åªæè¦çç´¢å¼äºãå¦æä¸è¿è½è§£å³é®é¢ï¼åªæä»æ¶æå±é¢è§£å³äºï¼æ¯å¦æ·»å æ±æ»è¡¨ï¼æèä½¿ç¨ redis è¿æ ·çå¤é¨ç¼å­ç³»ç»ã\n\n\n# ä¼åå³èæ¥è¯¢\n\nå¨å¤§æ°æ®åºæ¯ä¸ï¼è¡¨ä¸è¡¨ä¹é´éè¿ä¸ä¸ªåä½å­æ®µæ¥å³èï¼è¦æ¯ç´æ¥ä½¿ç¨ join ææ´å¥½çæ§è½ã\n\nå¦æç¡®å®éè¦ä½¿ç¨å³èæ¥è¯¢çæåµä¸ï¼éè¦ç¹å«æ³¨æçæ¯ï¼\n\n * ç¡®ä¿ on å using å­å¥ä¸­çåä¸æç´¢å¼ãå¨åå»ºç´¢å¼çæ¶åå°±è¦èèå°å³èçé¡ºåºãå½è¡¨ a åè¡¨ b ç¨æå column å³èçæ¶åï¼å¦æä¼åå¨å³èçé¡ºåºæ¯ aãbï¼é£ä¹å°±ä¸éè¦å¨ a è¡¨çå¯¹åºåä¸åå»ºç´¢å¼ãæ²¡æç¨å°çç´¢å¼ä¼å¸¦æ¥é¢å¤çè´æï¼ä¸è¬æ¥è¯´ï¼é¤éæå¶ä»çç±ï¼åªéè¦å¨å³èé¡ºåºä¸­çç¬¬äºå¼ è¡¨çç¸åºåä¸åå»ºç´¢å¼ï¼å·ä½åå ä¸æåæï¼ã\n * ç¡®ä¿ä»»ä½ç group by å order by ä¸­çè¡¨è¾¾å¼åªæ¶åå°ä¸ä¸ªè¡¨ä¸­çåï¼è¿æ · mysql ææå¯è½ä½¿ç¨ç´¢å¼æ¥ä¼åã\n\nè¦çè§£ä¼åå³èæ¥è¯¢çç¬¬ä¸ä¸ªæå·§ï¼å°±éè¦çè§£ mysql æ¯å¦ä½æ§è¡å³èæ¥è¯¢çãå½å mysql å³èæ§è¡çç­ç¥éå¸¸ç®åï¼å®å¯¹ä»»ä½çå³èé½æ§è¡åµå¥å¾ªç¯å³èæä½ï¼å³åå¨ä¸ä¸ªè¡¨ä¸­å¾ªç¯ååºåæ¡æ°æ®ï¼ç¶åå¨åµå¥å¾ªç¯å°ä¸ä¸ä¸ªè¡¨ä¸­å¯»æ¾å¹éçè¡ï¼ä¾æ¬¡ä¸å»ï¼ç´å°æ¾å°ææè¡¨ä¸­å¹éçè¡ä¸ºä¸ºæ­¢ãç¶åæ ¹æ®åä¸ªè¡¨å¹éçè¡ï¼è¿åæ¥è¯¢ä¸­éè¦çåä¸ªåã\n\nå¤ªæ½è±¡äºï¼ä»¥ä¸é¢çç¤ºä¾æ¥è¯´æï¼æ¯å¦æè¿æ ·çä¸ä¸ªæ¥è¯¢ï¼\n\nselect a.xx,b.yy\nfrom a inner join b using(c)\nwhere a.xx in (5,6)\n\n\nåè®¾ mysql æç§æ¥è¯¢ä¸­çå³èé¡ºåº aãb æ¥è¿è¡å³èæä½ï¼é£ä¹å¯ä»¥ç¨ä¸é¢çä¼ªä»£ç è¡¨ç¤º mysql å¦ä½å®æè¿ä¸ªæ¥è¯¢ï¼\n\nouter_iterator = select a.xx,a.c from a where a.xx in (5,6);\nouter_row = outer_iterator.next;\nwhile(outer_row) {\n    inner_iterator = select b.yy from b where b.c = outer_row.c;\n    inner_row = inner_iterator.next;\n    while(inner_row) {\n        output[inner_row.yy,outer_row.xx];\n        inner_row = inner_iterator.next;\n    }\n    outer_row = outer_iterator.next;\n}\n\n\nå¯ä»¥çå°ï¼æå¤å±çæ¥è¯¢æ¯æ ¹æ®a.xxåæ¥æ¥è¯¢çï¼a.cä¸å¦ææç´¢å¼çè¯ï¼æ´ä¸ªå³èæ¥è¯¢ä¹ä¸ä¼ä½¿ç¨ãåçåå±çæ¥è¯¢ï¼å¾ææ¾b.cä¸å¦ææç´¢å¼çè¯ï¼è½å¤å éæ¥è¯¢ï¼å æ­¤åªéè¦å¨å³èé¡ºåºä¸­çç¬¬äºå¼ è¡¨çç¸åºåä¸åå»ºç´¢å¼å³å¯ã\n\n\n# ä¼å group by å distinct\n\nmysql ä¼åå¨ä¼å¨åé¨å¤ççæ¶åç¸äºè½¬åè¿ä¸¤ç±»æ¥è¯¢ãå®ä»¬é½å¯ä»¥ä½¿ç¨ç´¢å¼æ¥ä¼åï¼è¿ä¹æ¯æææçä¼åæ¹æ³ã\n\n\n# ä¼å limit\n\nå½éè¦åé¡µæä½æ¶ï¼éå¸¸ä¼ä½¿ç¨ limit å ä¸åç§»éçåæ³å®ç°ï¼åæ¶å ä¸åéç order by å­å¥ãå¦ææå¯¹åºçç´¢å¼ï¼éå¸¸æçä¼ä¸éï¼å¦åï¼mysql éè¦åå¤§éçæä»¶æåºæä½ã\n\nä¸ä¸ªå¸¸è§çé®é¢æ¯å½åç§»ééå¸¸å¤§çæ¶åï¼æ¯å¦ï¼limit 10000 20è¿æ ·çæ¥è¯¢ï¼mysql éè¦æ¥è¯¢ 10020 æ¡è®°å½ç¶ååªè¿å 20 æ¡è®°å½ï¼åé¢ç 10000 æ¡é½å°è¢«æå¼ï¼è¿æ ·çä»£ä»·éå¸¸é«ã\n\nä¼åè¿ç§æ¥è¯¢ä¸ä¸ªæç®åçåæ³å°±æ¯å°½å¯è½çä½¿ç¨è¦çç´¢å¼æ«æï¼èä¸æ¯æ¥è¯¢ææçåãç¶åæ ¹æ®éè¦åä¸æ¬¡å³èæ¥è¯¢åè¿åææçåãå¯¹äºåç§»éå¾å¤§æ¶ï¼è¿æ ·åçæçä¼æåéå¸¸å¤§ãèèä¸é¢çæ¥è¯¢ï¼\n\nselect film_id,description from film order by title limit 50,5;\n\n\nå¦æè¿å¼ è¡¨éå¸¸å¤§ï¼é£ä¹è¿ä¸ªæ¥è¯¢æå¥½æ¹æä¸é¢çæ ·å­ï¼\n\nselect film.film_id,film.description\nfrom film inner join (\n    select film_id from film order by title limit 50,5\n) as tmp using(film_id);\n\n\nè¿éçå»¶è¿å³èå°å¤§å¤§æåæ¥è¯¢æçï¼è®© mysql æ«æå°½å¯è½å°çé¡µé¢ï¼è·åéè¦è®¿é®çè®°å½åå¨æ ¹æ®å³èåååè¡¨æ¥è¯¢æéè¦çåã\n\nææ¶åå¦æå¯ä»¥ä½¿ç¨ä¹¦ç­¾è®°å½ä¸æ¬¡åæ°æ®çä½ç½®ï¼é£ä¹ä¸æ¬¡å°±å¯ä»¥ç´æ¥ä»è¯¥ä¹¦ç­¾è®°å½çä½ç½®å¼å§æ«æï¼è¿æ ·å°±å¯ä»¥é¿åä½¿ç¨offsetï¼æ¯å¦ä¸é¢çæ¥è¯¢ï¼\n\nselect id from t limit 10000, 10;\næ¹ä¸ºï¼\nselect id from t where id > 10000 limit 10;\n\n\nå¶ä»ä¼åçåæ³è¿åæ¬ä½¿ç¨é¢åè®¡ç®çæ±æ»è¡¨ï¼æèå³èå°ä¸ä¸ªåä½è¡¨ï¼åä½è¡¨ä¸­åªåå«ä¸»é®ååéè¦åæåºçåã\n\n\n# ä¼å union\n\nmysql æ»æ¯éè¿åå»ºå¹¶å¡«åä¸´æ¶è¡¨çæ¹å¼æ¥æ§è¡ union æ¥è¯¢ãå æ­¤å¾å¤ä¼åç­ç¥å¨unionæ¥è¯¢ä¸­é½æ²¡æåæ³å¾å¥½çæ¶åãç»å¸¸éè¦æå¨å°whereãlimitãorder byç­å­å¥âä¸æ¨âå°åä¸ªå­æ¥è¯¢ä¸­ï¼ä»¥ä¾¿ä¼åå¨å¯ä»¥ååå©ç¨è¿äºæ¡ä»¶åä¼åã\n\né¤éç¡®å®éè¦æå¡å¨å»éï¼å¦åå°±ä¸å®è¦ä½¿ç¨union allï¼å¦ææ²¡æallå³é®å­ï¼mysql ä¼ç»ä¸´æ¶è¡¨å ä¸distinctéé¡¹ï¼è¿ä¼å¯¼è´æ´ä¸ªä¸´æ¶è¡¨çæ°æ®åå¯ä¸æ§æ£æ¥ï¼è¿æ ·åçä»£ä»·éå¸¸é«ãå½ç¶å³ä½¿ä½¿ç¨ all å³é®å­ï¼mysql æ»æ¯å°ç»ææ¾å¥ä¸´æ¶è¡¨ï¼ç¶ååè¯»åºï¼åè¿åç»å®¢æ·ç«¯ãè½ç¶å¾å¤æ¶åæ²¡æè¿ä¸ªå¿è¦ï¼æ¯å¦ææ¶åå¯ä»¥ç´æ¥ææ¯ä¸ªå­æ¥è¯¢çç»æè¿åç»å®¢æ·ç«¯ã\n\n\n# ä¼åæ¥è¯¢æ¹å¼\n\n# ååå¤§æ¥è¯¢\n\nä¸ä¸ªå¤§æ¥è¯¢å¦æä¸æ¬¡æ§æ§è¡çè¯ï¼å¯è½ä¸æ¬¡éä½å¾å¤æ°æ®ãå æ»¡æ´ä¸ªäºå¡æ¥å¿ãèå°½ç³»ç»èµæºãé»å¡å¾å¤å°çä½éè¦çæ¥è¯¢ã\n\ndeleft from messages where create < date_sub(now(), interval 3 month);\n\n\nrows_affected = 0\ndo {\n    rows_affected = do_query(\n    \"delete from messages where create  < date_sub(now(), interval 3 month) limit 10000\")\n} while rows_affected > 0\n\n\n# åè§£å¤§è¿æ¥æ¥è¯¢\n\nå°ä¸ä¸ªå¤§è¿æ¥æ¥è¯¢ï¼joinï¼åè§£æå¯¹æ¯ä¸ä¸ªè¡¨è¿è¡ä¸æ¬¡åè¡¨æ¥è¯¢ï¼ç¶åå°ç»æå¨åºç¨ç¨åºä¸­è¿è¡å³èï¼è¿æ ·åçå¥½å¤æï¼\n\n * è®©ç¼å­æ´é«æãå¯¹äºè¿æ¥æ¥è¯¢ï¼å¦æå¶ä¸­ä¸ä¸ªè¡¨åçååï¼é£ä¹æ´ä¸ªæ¥è¯¢ç¼å­å°±æ æ³ä½¿ç¨ãèåè§£åçå¤ä¸ªæ¥è¯¢ï¼å³ä½¿å¶ä¸­ä¸ä¸ªè¡¨åçååï¼å¯¹å¶å®è¡¨çæ¥è¯¢ç¼å­ä¾ç¶å¯ä»¥ä½¿ç¨ã\n * åè§£æå¤ä¸ªåè¡¨æ¥è¯¢ï¼è¿äºåè¡¨æ¥è¯¢çç¼å­ç»ææ´å¯è½è¢«å¶å®æ¥è¯¢ä½¿ç¨å°ï¼ä»èåå°åä½è®°å½çæ¥è¯¢ã\n * åå°éç«äºï¼\n * å¨åºç¨å±è¿è¡è¿æ¥ï¼å¯ä»¥æ´å®¹æå¯¹æ°æ®åºè¿è¡æåï¼ä»èæ´å®¹æåå°é«æ§è½åå¯æ©å±ã\n * æ¥è¯¢æ¬èº«æçä¹å¯è½ä¼æææåãä¾å¦ä¸é¢çä¾å­ä¸­ï¼ä½¿ç¨ in() ä»£æ¿è¿æ¥æ¥è¯¢ï¼å¯ä»¥è®© mysql æç§ id é¡ºåºè¿è¡æ¥è¯¢ï¼è¿å¯è½æ¯éæºçè¿æ¥è¦æ´é«æã\n\nselect * from tag\njoin tag_post on tag_post.tag_id=tag.id\njoin post on tag_post.post_id=post.id\nwhere tag.tag='mysql';\n\n\nselect * from tag where tag='mysql';\nselect * from tag_post where tag_id=1234;\nselect * from post where post.id in (123,456,567,9098,8904);\n\n\n\n# æ§è¡è®¡åï¼explainï¼\n\nå¦ä½å¤æ­å½å sql æ¯å¦ä½¿ç¨äºç´¢å¼ï¼å¦ä½æ£éªä¿®æ¹åç sql ç¡®å®æä¼åææï¼\n\nå¨ sql ä¸­ï¼å¯ä»¥éè¿æ§è¡è®¡åï¼explainï¼åæ select æ¥è¯¢æçã\n\nmysql> explain select * from user_info where id = 2\\g\n*************************** 1. row ***************************\n           id: 1\n  select_type: simple\n        table: user_info\n   partitions: null\n         type: const\npossible_keys: primary\n          key: primary\n      key_len: 8\n          ref: const\n         rows: 1\n     filtered: 100.00\n        extra: null\n1 row in set, 1 warning (0.00 sec)\n\n\nexplain åæ°è¯´æï¼\n\n * id: select æ¥è¯¢çæ è¯ç¬¦. æ¯ä¸ª select é½ä¼èªå¨åéä¸ä¸ªå¯ä¸çæ è¯ç¬¦.\n * select_type â­ ï¼select æ¥è¯¢çç±»å.\n   * simpleï¼è¡¨ç¤ºæ­¤æ¥è¯¢ä¸åå« union æ¥è¯¢æå­æ¥è¯¢\n   * primaryï¼è¡¨ç¤ºæ­¤æ¥è¯¢æ¯æå¤å±çæ¥è¯¢\n   * unionï¼è¡¨ç¤ºæ­¤æ¥è¯¢æ¯ union çç¬¬äºæéåçæ¥è¯¢\n   * dependent unionï¼union ä¸­çç¬¬äºä¸ªæåé¢çæ¥è¯¢è¯­å¥, åå³äºå¤é¢çæ¥è¯¢\n   * union resultï¼union çç»æ\n   * subqueryï¼å­æ¥è¯¢ä¸­çç¬¬ä¸ä¸ª select\n   * dependent subquery: å­æ¥è¯¢ä¸­çç¬¬ä¸ä¸ª select, åå³äºå¤é¢çæ¥è¯¢. å³å­æ¥è¯¢ä¾èµäºå¤å±æ¥è¯¢çç»æ.\n * table: æ¥è¯¢çæ¯åªä¸ªè¡¨ï¼å¦æç»è¡¨èµ·å«åäºï¼åæ¾ç¤ºå«åã\n * partitionsï¼å¹éçååº\n * type â­ï¼è¡¨ç¤ºä»è¡¨ä¸­æ¥è¯¢å°è¡ææ§è¡çæ¹å¼ï¼æ¥è¯¢æ¹å¼æ¯ sql ä¼åä¸­ä¸ä¸ªå¾éè¦çææ ï¼ç»æå¼ä»å¥½å°å·®ä¾æ¬¡æ¯ï¼system > const > eq_ref > ref > range > index > allã\n   * system/constï¼è¡¨ä¸­åªæä¸è¡æ°æ®å¹éï¼æ­¤æ¶æ ¹æ®ç´¢å¼æ¥è¯¢ä¸æ¬¡å°±è½æ¾å°å¯¹åºçæ°æ®ãå¦ææ¯ b + æ ç´¢å¼ï¼æä»¬ç¥éæ­¤æ¶ç´¢å¼æé æäºå¤ä¸ªå±çº§çæ ï¼å½æ¥è¯¢çç´¢å¼å¨æ çåºå±æ¶ï¼æ¥è¯¢æçå°±è¶ä½ãconst è¡¨ç¤ºæ­¤æ¶ç´¢å¼å¨ç¬¬ä¸å±ï¼åªéè®¿é®ä¸å±ä¾¿è½å¾å°æ°æ®ã\n   * eq_refï¼ä½¿ç¨å¯ä¸ç´¢å¼æ«æï¼å¸¸è§äºå¤è¡¨è¿æ¥ä¸­ä½¿ç¨ä¸»é®åå¯ä¸ç´¢å¼ä½ä¸ºå³èæ¡ä»¶ã\n   * refï¼éå¯ä¸ç´¢å¼æ«æï¼è¿å¯è§äºå¯ä¸ç´¢å¼æå·¦ååå¹éæ«æã\n   * rangeï¼ç´¢å¼èå´æ«æï¼æ¯å¦ï¼<ï¼>ï¼between ç­æä½ã\n   * indexï¼ç´¢å¼å¨è¡¨æ«æï¼æ­¤æ¶éåæ´ä¸ªç´¢å¼æ ã\n   * allï¼è¡¨ç¤ºå¨è¡¨æ«æï¼éè¦éåå¨è¡¨æ¥æ¾å°å¯¹åºçè¡ã\n * possible_keysï¼æ­¤æ¬¡æ¥è¯¢ä¸­å¯è½éç¨çç´¢å¼ã\n * key â­ï¼æ­¤æ¬¡æ¥è¯¢ä¸­å®éä½¿ç¨çç´¢å¼ã\n * refï¼åªä¸ªå­æ®µæå¸¸æ°ä¸ key ä¸èµ·è¢«ä½¿ç¨ã\n * rows â­ï¼æ¾ç¤ºæ­¤æ¥è¯¢ä¸å±æ«æäºå¤å°è¡ï¼è¿ä¸ªæ¯ä¸ä¸ªä¼°è®¡å¼ã\n * filteredï¼è¡¨ç¤ºæ­¤æ¥è¯¢æ¡ä»¶æè¿æ»¤çæ°æ®çç¾åæ¯ã\n * extraï¼é¢å¤çä¿¡æ¯ã\n\n> æ´å¤åå®¹è¯·åèï¼mysql æ§è½ä¼åç¥å¨ explain ä½¿ç¨åæ\n\n\n# optimizer trace\n\nå¨ mysql 5.6 åä¹åççæ¬ä¸­ï¼æä»¬å¯ä»¥ä½¿ç¨ optimizer trace åè½æ¥çä¼åå¨çææ§è¡è®¡åçæ´ä¸ªè¿ç¨ãæäºè¿ä¸ªåè½ï¼æä»¬ä¸ä»å¯ä»¥äºè§£ä¼åå¨çéæ©è¿ç¨ï¼æ´å¯ä»¥äºè§£æ¯ä¸ä¸ªæ§è¡ç¯èçææ¬ï¼ç¶åä¾é è¿äºä¿¡æ¯è¿ä¸æ­¥ä¼åæ¥è¯¢ã\n\nå¦ä¸ä»£ç æç¤ºï¼æå¼ optimizer_trace åï¼åæ§è¡ sql å°±å¯ä»¥æ¥è¯¢ information_schema.optimizer_trace è¡¨æ¥çæ§è¡è®¡åäºï¼æåå¯ä»¥å³é­ optimizer_trace åè½ï¼\n\nset optimizer_trace=\"enabled=on\";\nselect * from person where name >'name84059' and create_time>'2020-01-24 05:00\nselect * from information_schema.optimizer_trace;\nset optimizer_trace=\"enabled=off\";\n\n\n\n# æ°æ®æ¨¡ååä¸å¡\n\n * è¡¨å­æ®µæ¯è¾å¤æãæåå¨ãç»æé¾ä»¥ç»ä¸çæåµä¸ï¼å¯ä»¥èèä½¿ç¨ nosql æ¥ä»£æ¿å³ç³»æ°æ®åºè¡¨å­å¨ï¼å¦ elasticsearchãmongodbã\n * å¨é«å¹¶åæåµä¸çæ¥è¯¢æä½ï¼å¯ä»¥ä½¿ç¨ç¼å­ï¼å¦ redisï¼ä»£æ¿æ°æ®åºæä½ï¼æé«å¹¶åæ§è½ã\n * æ°æ®éå¢é¿è¾å¿«çè¡¨ï¼éè¦èèæ°´å¹³åè¡¨æååºï¼é¿ååè¡¨æä½çæ§è½ç¶é¢ã\n * é¤æ­¤ä¹å¤ï¼æä»¬åºè¯¥éè¿ä¸äºä¼åï¼å°½éé¿åæ¯è¾å¤æç join æ¥è¯¢æä½ï¼ä¾å¦åä½ä¸äºå­æ®µï¼åå° join æ¥è¯¢ï¼åå»ºä¸äºä¸­é´è¡¨ï¼åå° join æ¥è¯¢ã\n\n\n# åèèµæ\n\n * ãé«æ§è½ mysqlã\n * ãjava æ§è½è°ä¼å®æã\n * æå¿é¡»å¾åè¯å¤§å®¶ç mysql ä¼ååç\n * 20+ æ¡ mysql æ§è½ä¼åçæä½³ç»éª\n * mysql æ§è½ä¼åç¥å¨ explain ä½¿ç¨åæ",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Mysql è¿ç»´",frontmatter:{title:"Mysql è¿ç»´",date:"2019-11-26T21:37:17.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql","è¿ç»´"],permalink:"/pages/e33b92/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/02.Mysql/20.Mysql%E8%BF%90%E7%BB%B4.html",relativePath:"12.æ°æ®åº/03.å³ç³»åæ°æ®åº/02.Mysql/20.Mysqlè¿ç»´.md",key:"v-4ef63c90",path:"/pages/e33b92/",headers:[{level:2,title:"å®è£é¨ç½²",slug:"å®è£é¨ç½²",normalizedTitle:"å®è£é¨ç½²",charIndex:98},{level:3,title:"Windows å®è£",slug:"windows-å®è£",normalizedTitle:"windows å®è£",charIndex:107},{level:3,title:"CentOS å®è£",slug:"centos-å®è£",normalizedTitle:"centos å®è£",charIndex:774},{level:4,title:"å®è£ mysql yum æº",slug:"å®è£-mysql-yum-æº",normalizedTitle:"å®è£ mysql yum æº",charIndex:805},{level:4,title:"mysql æå¡ç®¡ç",slug:"mysql-æå¡ç®¡ç",normalizedTitle:"mysql æå¡ç®¡ç",charIndex:1884},{level:3,title:"åå§åæ°æ®åºå¯ç ",slug:"åå§åæ°æ®åºå¯ç ",normalizedTitle:"åå§åæ°æ®åºå¯ç ",charIndex:2155},{level:3,title:"éç½®è¿ç¨è®¿é®",slug:"éç½®è¿ç¨è®¿é®",normalizedTitle:"éç½®è¿ç¨è®¿é®",charIndex:2511},{level:3,title:"è·³è¿ç»å½è®¤è¯",slug:"è·³è¿ç»å½è®¤è¯",normalizedTitle:"è·³è¿ç»å½è®¤è¯",charIndex:2690},{level:2,title:"åºæ¬è¿ç»´",slug:"åºæ¬è¿ç»´",normalizedTitle:"åºæ¬è¿ç»´",charIndex:76},{level:3,title:"å®¢æ·ç«¯è¿æ¥",slug:"å®¢æ·ç«¯è¿æ¥",normalizedTitle:"å®¢æ·ç«¯è¿æ¥",charIndex:2840},{level:3,title:"æ¥çè¿æ¥",slug:"æ¥çè¿æ¥",normalizedTitle:"æ¥çè¿æ¥",charIndex:3435},{level:3,title:"åå»ºç¨æ·",slug:"åå»ºç¨æ·",normalizedTitle:"åå»ºç¨æ·",charIndex:3567},{level:3,title:"æ¥çç¨æ·",slug:"æ¥çç¨æ·",normalizedTitle:"æ¥çç¨æ·",charIndex:4252},{level:3,title:"ææ",slug:"ææ",normalizedTitle:"ææ",charIndex:4362},{level:3,title:"æ¤éææ",slug:"æ¤éææ",normalizedTitle:"æ¤éææ",charIndex:4940},{level:3,title:"æ¥çææ",slug:"æ¥çææ",normalizedTitle:"æ¥çææ",charIndex:5437},{level:3,title:"æ´æ¹ç¨æ·å¯ç ",slug:"æ´æ¹ç¨æ·å¯ç ",normalizedTitle:"æ´æ¹ç¨æ·å¯ç ",charIndex:5486},{level:3,title:"å¤ä»½ä¸æ¢å¤",slug:"å¤ä»½ä¸æ¢å¤",normalizedTitle:"å¤ä»½ä¸æ¢å¤",charIndex:5672},{level:4,title:"å¤ä»½ä¸ä¸ªæ°æ®åº",slug:"å¤ä»½ä¸ä¸ªæ°æ®åº",normalizedTitle:"å¤ä»½ä¸ä¸ªæ°æ®åº",charIndex:5767},{level:4,title:"å¤ä»½å¤ä¸ªæ°æ®åº",slug:"å¤ä»½å¤ä¸ªæ°æ®åº",normalizedTitle:"å¤ä»½å¤ä¸ªæ°æ®åº",charIndex:6089},{level:4,title:"å¤ä»½æææ°æ®åº",slug:"å¤ä»½æææ°æ®åº",normalizedTitle:"å¤ä»½æææ°æ®åº",charIndex:6182},{level:4,title:"æ¢å¤ä¸ä¸ªæ°æ®åº",slug:"æ¢å¤ä¸ä¸ªæ°æ®åº",normalizedTitle:"æ¢å¤ä¸ä¸ªæ°æ®åº",charIndex:6251},{level:4,title:"æ¢å¤æææ°æ®åº",slug:"æ¢å¤æææ°æ®åº",normalizedTitle:"æ¢å¤æææ°æ®åº",charIndex:6357},{level:3,title:"å¸è½½",slug:"å¸è½½",normalizedTitle:"å¸è½½",charIndex:6422},{level:3,title:"ä¸»ä»èç¹é¨ç½²",slug:"ä¸»ä»èç¹é¨ç½²",normalizedTitle:"ä¸»ä»èç¹é¨ç½²",charIndex:6778},{level:4,title:"ä¸»èç¹ä¸çæä½",slug:"ä¸»èç¹ä¸çæä½",normalizedTitle:"ä¸»èç¹ä¸çæä½",charIndex:6864},{level:4,title:"ä»èç¹ä¸çæä½",slug:"ä»èç¹ä¸çæä½",normalizedTitle:"ä»èç¹ä¸çæä½",charIndex:9108},{level:3,title:"æ¢æ¥è¯¢",slug:"æ¢æ¥è¯¢",normalizedTitle:"æ¢æ¥è¯¢",charIndex:10425},{level:3,title:"éç¦»çº§å«",slug:"éç¦»çº§å«",normalizedTitle:"éç¦»çº§å«",charIndex:10678},{level:2,title:"æå¡å¨éç½®",slug:"æå¡å¨éç½®",normalizedTitle:"æå¡å¨éç½®",charIndex:10958},{level:3,title:"éç½®æä»¶è·¯å¾",slug:"éç½®æä»¶è·¯å¾",normalizedTitle:"éç½®æä»¶è·¯å¾",charIndex:11159},{level:3,title:"éç½®é¡¹è¯­æ³",slug:"éç½®é¡¹è¯­æ³",normalizedTitle:"éç½®é¡¹è¯­æ³",charIndex:11517},{level:3,title:"å¸¸ç¨éç½®é¡¹è¯´æ",slug:"å¸¸ç¨éç½®é¡¹è¯´æ",normalizedTitle:"å¸¸ç¨éç½®é¡¹è¯´æ",charIndex:11691},{level:2,title:"å¸¸è§é®é¢",slug:"å¸¸è§é®é¢",normalizedTitle:"å¸¸è§é®é¢",charIndex:15687},{level:3,title:"Too many connections",slug:"too-many-connections",normalizedTitle:"too many connections",charIndex:15696},{level:3,title:"æ¶åºï¼time_zoneï¼åå·®",slug:"æ¶åº-time-zone-åå·®",normalizedTitle:"æ¶åºï¼time_zoneï¼åå·®",charIndex:16907},{level:3,title:"æ°æ®è¡¨æåå¦ä½ä¿®å¤",slug:"æ°æ®è¡¨æåå¦ä½ä¿®å¤",normalizedTitle:"æ°æ®è¡¨æåå¦ä½ä¿®å¤",charIndex:17662},{level:3,title:"æ°æ®ç»æ",slug:"æ°æ®ç»æ",normalizedTitle:"æ°æ®ç»æ",charIndex:18037},{level:2,title:"èæ¬",slug:"èæ¬",normalizedTitle:"èæ¬",charIndex:1767},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:18257}],headersStr:"å®è£é¨ç½² Windows å®è£ CentOS å®è£ å®è£ mysql yum æº mysql æå¡ç®¡ç åå§åæ°æ®åºå¯ç  éç½®è¿ç¨è®¿é® è·³è¿ç»å½è®¤è¯ åºæ¬è¿ç»´ å®¢æ·ç«¯è¿æ¥ æ¥çè¿æ¥ åå»ºç¨æ· æ¥çç¨æ· ææ æ¤éææ æ¥çææ æ´æ¹ç¨æ·å¯ç  å¤ä»½ä¸æ¢å¤ å¤ä»½ä¸ä¸ªæ°æ®åº å¤ä»½å¤ä¸ªæ°æ®åº å¤ä»½æææ°æ®åº æ¢å¤ä¸ä¸ªæ°æ®åº æ¢å¤æææ°æ®åº å¸è½½ ä¸»ä»èç¹é¨ç½² ä¸»èç¹ä¸çæä½ ä»èç¹ä¸çæä½ æ¢æ¥è¯¢ éç¦»çº§å« æå¡å¨éç½® éç½®æä»¶è·¯å¾ éç½®é¡¹è¯­æ³ å¸¸ç¨éç½®é¡¹è¯´æ å¸¸è§é®é¢ Too many connections æ¶åºï¼time_zoneï¼åå·® æ°æ®è¡¨æåå¦ä½ä¿®å¤ æ°æ®ç»æ èæ¬ åèèµæ",content:"# Mysql è¿ç»´\n\n> å¦æä½ çå¬å¸æ DBAï¼é£ä¹ææ­åä½ ï¼ä½ å¯ä»¥æ è§ Mysql è¿ç»´ãå¦æä½ çå¬å¸æ²¡æ DBAï¼é£ä½ å°±å¥½å¥½å­¦ä¸¤æ Mysql åºæ¬è¿ç»´æä½ï¼è¡èµ°æ±æ¹ï¼é²èº«å¿å¤ã\n\n\n# å®è£é¨ç½²\n\n\n# Windows å®è£\n\nï¼1ï¼ä¸è½½ Mysql 5.7 åå®è£ç\n\nä¸è½½å°åï¼https://dev.mysql.com/downloads/mysql/5.7.html#downloads\n\nï¼2ï¼è§£åå¹¶åå»º my.ini å¨æ ¹ç®å½\n\nmy.ini æä»¶ç¤ºä¾ï¼\n\n[mysqld]\n#è®¾ç½®3306ç«¯å£\nport = 3306\n# è®¾ç½®mysqlçå®è£ç®å½ è¿åæ¢æèªå·±è§£åçè·¯å¾\nbasedir=D:\\\\Tools\\\\DB\\\\mysql\\\\mysql-5.7.31\n# åè®¸æå¤§è¿æ¥æ°\nmax_connections=200\n# æå¡ç«¯ä½¿ç¨çå­ç¬¦éé»è®¤ä¸º8æ¯ç¹ç¼ç çlatin1å­ç¬¦é\ncharacter-set-server=utf8\n# åå»ºæ°è¡¨æ¶å°ä½¿ç¨çé»è®¤å­å¨å¼æ\ndefault-storage-engine=INNODB\n\n[client]\n# è®¾ç½®mysqlå®¢æ·ç«¯é»è®¤å­ç¬¦é\ndefault-character-set=utf8\n\n\nï¼3ï¼æ§è¡å®è£å½ä»¤\n\nå¨æ§å¶å° CMD ä¸­ä¾æ¬¡æ§è¡ä»¥ä¸å®è£å½ä»¤\n\ncd D:\\\\Tools\\\\DB\\\\mysql\\\\mysql-5.7.31\nmysqld --initialize\nmysqld -install\n\n\nè¯´æï¼\n\n * mysqld --initialize ä¼èªå¨åå§ååå»º data æä»¶å¤¹å¹¶åå§å mysqlã\n * mysqld -install ä¼å®è£ mysql æå¡ã\n\nï¼4ï¼å¯å¨æå¡\n\nå¨æ§å¶å°æ§è¡ net start mysql å¯å¨æå¡ã\n\n\n# CentOS å®è£\n\n> æ¬æä»ä»ç» rpm å®è£æ¹å¼\n\n# å®è£ mysql yum æº\n\nå®æ¹ä¸è½½å°åï¼https://dev.mysql.com/downloads/repo/yum/\n\nï¼1ï¼ä¸è½½ yum æº\n\nwget https://dev.mysql.com/get/mysql80-community-release-el7-1.noarch.rpm\n\n\nï¼2ï¼å®è£ yum repo æä»¶å¹¶æ´æ° yum ç¼å­\n\nrpm -ivh mysql80-community-release-el7-1.noarch.rpm\n\n\næ§è¡ç»æï¼\n\nä¼å¨ /etc/yum.repos.d/ ç®å½ä¸çæä¸¤ä¸ª repo æä»¶\n\n$ ls | grep mysql\nmysql-community.repo\nmysql-community-source.repo\n\n\næ´æ° yumï¼\n\nyum clean all\nyum makecache\n\n\nï¼3ï¼æ¥ç rpm å®è£ç¶æ\n\n$ yum search mysql | grep server\nmysql-community-common.i686 : MySQL database common files for server and client\nmysql-community-common.x86_64 : MySQL database common files for server and\nmysql-community-test.x86_64 : Test suite for the MySQL database server\n                       : administering MySQL servers\nmysql-community-server.x86_64 : A very fast and reliable SQL database server\n\n\néè¿ yum å®è£ mysql æå ä¸ªéè¦ç®å½ï¼\n\n## éç½®æä»¶\n/etc/my.cnf\n## æ°æ®åºç®å½\n/var/lib/mysql/\n## éç½®æä»¶\n/usr/share/mysqlï¼mysql.serverå½ä»¤åéç½®æä»¶ï¼\n## ç¸å³å½ä»¤\n/usr/binï¼mysqladmin mysqldumpç­å½ä»¤ï¼\n## å¯å¨èæ¬\n/usr/lib/systemd/system/mysqld.service ï¼æ³¨åä¸º systemd æå¡ï¼\n\n\nï¼4ï¼å®è£ mysql æå¡å¨\n\nyum install mysql-community-server\n\n\n# mysql æå¡ç®¡ç\n\néè¿ yum æ¹å¼å®è£ mysql åï¼æ¬å°ä¼æä¸ä¸ªåä¸º mysqld ç systemd æå¡ã\n\nå¶æå¡ç®¡çååç®ä¾¿ï¼\n\n## æ¥çç¶æ\nsystemctl status mysqld\n## å¯ç¨æå¡\nsystemctl enable mysqld\n## ç¦ç¨æå¡\nsystemctl disable mysqld\n## å¯å¨æå¡\nsystemctl start mysqld\n## éå¯æå¡\nsystemctl restart mysqld\n## åæ­¢æå¡\nsystemctl stop mysqld\n\n\n\n# åå§åæ°æ®åºå¯ç \n\næ¥çä¸ä¸åå§å¯ç \n\n$ grep \"password\" /var/log/mysqld.log\n2018-09-30T03:13:41.727736Z 5 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: %:lt+srWu4k1\n\n\næ§è¡å½ä»¤ï¼\n\nmysql -uroot -p<ä¸´æ¶å¯ç >\n\n\nè¾å¥ä¸´æ¶å¯ç ï¼è¿å¥ mysqlï¼å¦æè¦ä¿®æ¹å¯ç ï¼æ§è¡ä»¥ä¸æä»¤ï¼\n\nALTER user 'root'@'localhost' IDENTIFIED BY 'ä½ çå¯ç ';\n\n\næ³¨ï¼å¯ç å¼ºåº¦é»è®¤ä¸ºä¸­ç­ï¼å¤§å°åå­æ¯ãæ°å­ãç¹æ®ç¬¦å·ï¼åªæä¿®æ¹æååæè½ä¿®æ¹éç½®åè®¾ç½®æ´ç®åçå¯ç \n\n\n# éç½®è¿ç¨è®¿é®\n\nCREATE USER 'root'@'%' IDENTIFIED BY 'ä½ çå¯ç ';\nGRANT ALL ON *.* TO 'root'@'%';\nALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY 'ä½ çå¯ç ';\nFLUSH PRIVILEGES;\n\n\n\n# è·³è¿ç»å½è®¤è¯\n\nvim /etc/my.cnf\n\n\nå¨ [mysqld] ä¸é¢å ä¸ skip-grant-tables\n\nä½ç¨æ¯ç»å½æ¶è·³è¿ç»å½è®¤è¯ï¼æ¢å¥è¯è¯´å°±æ¯ root ä»ä¹å¯ç é½å¯ä»¥ç»å½è¿å»ã\n\næ§è¡ systemctl restart mysqldï¼éå¯ mysql\n\n\n# åºæ¬è¿ç»´\n\n\n# å®¢æ·ç«¯è¿æ¥\n\nè¯­æ³ï¼mysql -h<ä¸»æº> -P<ç«¯å£> -u<ç¨æ·å> -p<å¯ç >\n\nå¦ææ²¡ææ¾å¼æå®å¯ç ï¼ä¼è¦æ±è¾å¥å¯ç æè½è®¿é®ã\n\nãç¤ºä¾ãè¿æ¥æ¬å° Mysql\n\n$ mysql -h 127.0.0.1 -P 3306 -u root -p\nEnter password:\nWelcome to the MySQL monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 13501\nServer version: 8.0.19 MySQL Community Server - GPL\n\nCopyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.\n\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql>\n\n\n\n# æ¥çè¿æ¥\n\nè¿æ¥å®æåï¼å¦æä½ æ²¡æåç»­çå¨ä½ï¼è¿ä¸ªè¿æ¥å°±å¤äºç©ºé²ç¶æï¼ä½ å¯ä»¥å¨ show processlist å½ä»¤ä¸­çå°å®ãå®¢æ·ç«¯å¦æå¤ªé¿æ¶é´æ²¡å¨éï¼è¿æ¥å¨å°±ä¼èªå¨å°å®æ­å¼ãè¿ä¸ªæ¶é´æ¯ç±åæ° wait_timeout æ§å¶çï¼é»è®¤å¼æ¯ 8 å°æ¶ã\n\n\n\n\n# åå»ºç¨æ·\n\nCREATE USER 'username'@'host' IDENTIFIED BY 'password';\n\n\nè¯´æï¼\n\n * usernameï¼ä½ å°åå»ºçç¨æ·å\n * hostï¼æå®è¯¥ç¨æ·å¨åªä¸ªä¸»æºä¸å¯ä»¥ç»éï¼å¦ææ¯æ¬å°ç¨æ·å¯ç¨ localhostï¼å¦ææ³è®©è¯¥ç¨æ·å¯ä»¥ä»ä»»æè¿ç¨ä¸»æºç»éï¼å¯ä»¥ä½¿ç¨ééç¬¦%\n * passwordï¼è¯¥ç¨æ·çç»éå¯ç ï¼å¯ç å¯ä»¥ä¸ºç©ºï¼å¦æä¸ºç©ºåè¯¥ç¨æ·å¯ä»¥ä¸éè¦å¯ç ç»éæå¡å¨\n\nç¤ºä¾ï¼\n\nCREATE USER 'dog'@'localhost' IDENTIFIED BY '123456';\nCREATE USER 'pig'@'192.168.1.101_' IDENDIFIED BY '123456';\nCREATE USER 'pig'@'%' IDENTIFIED BY '123456';\nCREATE USER 'pig'@'%' IDENTIFIED BY '';\nCREATE USER 'pig'@'%';\n\n\n> æ³¨æï¼å¨ Mysql 8 ä¸­ï¼é»è®¤å¯ç éªè¯ä¸åæ¯ passwordãæä»¥å¨åå»ºç¨æ·æ¶ï¼create user 'username'@'%' identified by 'password'; å®¢æ·ç«¯æ¯æ æ³è¿æ¥æå¡çã\n> \n> æä»¥ï¼éè¦å ä¸ IDENTIFIED WITH mysql_native_passwordï¼ä¾å¦ï¼CREATE USER 'slave'@'%' IDENTIFIED WITH mysql_native_password BY '123456';\n\n\n# æ¥çç¨æ·\n\n-- æ¥çææç¨æ·\nSELECT DISTINCT CONCAT('User: ''', user, '''@''', host, ''';') AS query\nFROM mysql.user;\n\n\n\n# ææ\n\nå½ä»¤ï¼\n\nGRANT privileges ON databasename.tablename TO 'username'@'host'\n\n\nè¯´æï¼\n\n * privilegesï¼ç¨æ·çæä½æéï¼å¦SELECTï¼INSERTï¼UPDATEç­ï¼å¦æè¦æäºæçæéåä½¿ç¨ALL\n * databasenameï¼æ°æ®åºå\n * tablenameï¼è¡¨åï¼å¦æè¦æäºè¯¥ç¨æ·å¯¹æææ°æ®åºåè¡¨çç¸åºæä½æéåå¯ç¨*è¡¨ç¤ºï¼å¦*.*\n\nç¤ºä¾ï¼\n\nGRANT SELECT, INSERT ON test.user TO 'pig'@'%';\nGRANT ALL ON *.* TO 'pig'@'%';\nGRANT ALL ON maindataplus.* TO 'pig'@'%';\n\n\næ³¨æï¼\n\nç¨ä»¥ä¸å½ä»¤ææçç¨æ·ä¸è½ç»å¶å®ç¨æ·ææï¼å¦ææ³è®©è¯¥ç¨æ·å¯ä»¥ææï¼ç¨ä»¥ä¸å½ä»¤:\n\n-- ä¸ºæå®ç¨æ·éç½®æå®æé\nGRANT privileges ON databasename.tablename TO 'username'@'host' WITH GRANT OPTION;\n-- ä¸º root ç¨æ·åéæææé\nGRANT ALL ON *.* TO 'root'@'%' IDENTIFIED BY 'å¯ç ' WITH GRANT OPTION;\n\n\n\n# æ¤éææ\n\nå½ä»¤:\n\nREVOKE privilege ON databasename.tablename FROM 'username'@'host';\n\n\nè¯´æ:\n\nprivilege, databasename, tablenameï¼åææé¨å\n\nä¾å­:\n\nREVOKE SELECT ON *.* FROM 'pig'@'%';\n\n\næ³¨æ:\n\nåå¦ä½ å¨ç»ç¨æ·'pig'@'%'ææçæ¶åæ¯è¿æ ·çï¼æç±»ä¼¼çï¼ï¼GRANT SELECT ON test.user TO 'pig'@'%'ï¼åå¨ä½¿ç¨REVOKE SELECT ON *.* FROM 'pig'@'%';å½ä»¤å¹¶ä¸è½æ¤éè¯¥ç¨æ·å¯¹ test æ°æ®åºä¸­ user è¡¨çSELECT æä½ãç¸åï¼å¦æææä½¿ç¨çæ¯GRANT SELECT ON *.* TO 'pig'@'%';åREVOKE SELECT ON test.user FROM 'pig'@'%';å½ä»¤ä¹ä¸è½æ¤éè¯¥ç¨æ·å¯¹ test æ°æ®åºä¸­ user è¡¨çSelectæéã\n\nå·ä½ä¿¡æ¯å¯ä»¥ç¨å½ä»¤SHOW GRANTS FOR 'pig'@'%'; æ¥çã\n\n\n# æ¥çææ\n\n-- æ¥çç¨æ·æé\nSHOW GRANTS FOR 'root'@'%';\n\n\n\n# æ´æ¹ç¨æ·å¯ç \n\nSET PASSWORD FOR 'username'@'host' = PASSWORD('newpassword');\n\n\nå¦ææ¯å½åç»éç¨æ·ç¨:\n\nSET PASSWORD = PASSWORD(\"newpassword\");\n\n\nç¤ºä¾ï¼\n\nSET PASSWORD FOR 'pig'@'%' = PASSWORD(\"123456\");\n\n\n\n# å¤ä»½ä¸æ¢å¤\n\nMysql å¤ä»½æ°æ®ä½¿ç¨ mysqldump å½ä»¤ã\n\nmysqldump å°æ°æ®åºä¸­çæ°æ®å¤ä»½æä¸ä¸ªææ¬æä»¶ï¼è¡¨çç»æåè¡¨ä¸­çæ°æ®å°å­å¨å¨çæçææ¬æä»¶ä¸­ã\n\nå¤ä»½ï¼\n\n# å¤ä»½ä¸ä¸ªæ°æ®åº\n\nè¯­æ³ï¼\n\nmysqldump -h <host> -P<port> -u<username> -p<database> [<table1> <table2> ...] > backup.sql\n\n\n * host - Mysql Server ç host\n * port - Mysql Server çç«¯å£\n * username - æ°æ®åºç¨æ·\n * dbname - æ°æ®åºåç§°\n * table1 å table2 åæ°è¡¨ç¤ºéè¦å¤ä»½çè¡¨çåç§°ï¼ä¸ºç©ºåæ´ä¸ªæ°æ®åºå¤ä»½ï¼\n * BackupName.sql åæ°è¡¨è®¾è®¡å¤ä»½æä»¶çåç§°ï¼æä»¶ååé¢å¯ä»¥å ä¸ä¸ä¸ªç»å¯¹è·¯å¾ãéå¸¸å°æ°æ®åºè¢«åæä¸ä¸ªåç¼åä¸º sql çæä»¶\n\n# å¤ä»½å¤ä¸ªæ°æ®åº\n\nmysqldump -u <username> -p --databases <database1> <database2> ... > backup.sql\n\n\n# å¤ä»½æææ°æ®åº\n\nmysqldump -u <username> -p --all-databases > backup.sql\n\n\n# æ¢å¤ä¸ä¸ªæ°æ®åº\n\nMysql æ¢å¤æ°æ®ä½¿ç¨ mysql å½ä»¤ã\n\nè¯­æ³ï¼\n\nmysql -h <host> -P<port> -u<username> -p<database> < backup.sql\n\n\n# æ¢å¤æææ°æ®åº\n\nmysql -u<username> -p --all-databases < backup.sql\n\n\n\n# å¸è½½\n\nï¼1ï¼æ¥çå·²å®è£ç mysql\n\n$ rpm -qa | grep -i mysql\nperl-DBD-MySQL-4.023-6.el7.x86_64\nmysql80-community-release-el7-1.noarch\nmysql-community-common-8.0.12-1.el7.x86_64\nmysql-community-client-8.0.12-1.el7.x86_64\nmysql-community-libs-compat-8.0.12-1.el7.x86_64\nmysql-community-libs-8.0.12-1.el7.x86_64\n\n\nï¼2ï¼å¸è½½ mysql\n\nyum remove mysql-community-server.x86_64\n\n\n\n# ä¸»ä»èç¹é¨ç½²\n\nåè®¾éè¦éç½®ä¸ä¸ªä¸»ä» Mysql æå¡å¨ç¯å¢\n\n * master èç¹ï¼192.168.8.10\n * slave èç¹ï¼192.168.8.11\n\n# ä¸»èç¹ä¸çæä½\n\nï¼1ï¼ä¿®æ¹éç½®å¹¶éå¯\n\næ§è¡ vi /etc/my.cnf ï¼æ·»å å¦ä¸éç½®ï¼\n\n[mysqld]\nserver-id=1\nlog_bin=/var/lib/mysql/binlog\n\n\n * server-id - æå¡å¨ ID å·ãå¨ä¸»ä»æ¶æä¸­ï¼æ¯å°æºå¨ç ID å¿é¡»å¯ä¸ã\n * log_bin - åæ­¥çæ¥å¿è·¯å¾åæä»¶åï¼ä¸å®æ³¨æè¿ä¸ªç®å½è¦æ¯ mysql ææéåå¥çï¼\n\nä¿®æ¹åï¼éå¯ mysql ä½¿éç½®çæï¼\n\nsystemctl restart mysql\n\n\nï¼2ï¼åå»ºç¨äºåæ­¥çç¨æ·\n\nè¿å¥ mysql å½ä»¤æ§å¶å°ï¼\n\n$ mysql -u root -p\nPassword:\n\n\næ§è¡ä»¥ä¸ SQLï¼\n\n-- a. åå»º slave ç¨æ·\nCREATE USER 'slave'@'%' IDENTIFIED WITH mysql_native_password BY 'å¯ç ';\n-- ä¸º slave èµäº REPLICATION SLAVE æé\nGRANT REPLICATION SLAVE ON *.* TO 'slave'@'%';\n\n-- b. æèï¼åå»º slave ç¨æ·ï¼å¹¶æå®è¯¥ç¨æ·è½å¨ä»»æä¸»æºä¸ç»å½\n-- å¦ææå¤ä¸ªä»èç¹ï¼åæ³è®©ææä»èç¹é½ä½¿ç¨ç»ä¸çç¨æ·åãå¯ç è®¤è¯ï¼å¯ä»¥èèè¿ç§æ¹å¼\nCREATE USER 'slave'@'%' IDENTIFIED WITH mysql_native_password BY 'å¯ç ';\nGRANT REPLICATION SLAVE ON *.* TO 'slave'@'%';\n\n-- å·æ°ææè¡¨ä¿¡æ¯\nFLUSH PRIVILEGES;\n\n\n> æ³¨æï¼å¨ Mysql 8 ä¸­ï¼é»è®¤å¯ç éªè¯ä¸åæ¯ passwordãæä»¥å¨åå»ºç¨æ·æ¶ï¼create user 'username'@'%' identified by 'password'; å®¢æ·ç«¯æ¯æ æ³è¿æ¥æå¡çãæä»¥ï¼éè¦å ä¸ IDENTIFIED WITH mysql_native_password BY 'password'\n\nè¡¥åç¨æ·ç®¡ç SQL:\n\n-- æ¥çææç¨æ·\nSELECT DISTINCT CONCAT('User: ''', user, '''@''', host, ''';') AS query\nFROM mysql.user;\n\n-- æ¥çç¨æ·æé\nSHOW GRANTS FOR 'root'@'%';\n\n-- åå»ºç¨æ·\n-- a. åå»º slave ç¨æ·ï¼å¹¶æå®è¯¥ç¨æ·åªè½å¨ä¸»æº 192.168.8.11 ä¸ç»å½\nCREATE USER 'slave'@'192.168.8.11' IDENTIFIED WITH mysql_native_password BY 'å¯ç ';\n-- ä¸º slave èµäº REPLICATION SLAVE æé\nGRANT REPLICATION SLAVE ON *.* TO 'slave'@'192.168.8.11';\n\n-- å é¤ç¨æ·\nDROP USER 'slave'@'192.168.8.11';\n\n\nï¼3ï¼å è¯»é\n\nä¸ºäºä¸»åºä¸ä»åºçæ°æ®ä¿æä¸è´ï¼æä»¬åä¸º mysql å å¥è¯»éï¼ä½¿å¶åä¸ºåªè¯»ã\n\nmysql> FLUSH TABLES WITH READ LOCK;\n\n\nï¼4ï¼æ¥çä¸»èç¹ç¶æ\n\nmysql> show master status;\n+------------------+----------+--------------+---------------------------------------------+-------------------+\n| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB                            | Executed_Gtid_Set |\n+------------------+----------+--------------+---------------------------------------------+-------------------+\n| mysql-bin.000001 |     4202 |              | mysql,information_schema,performance_schema |                   |\n+------------------+----------+--------------+---------------------------------------------+-------------------+\n1 row in set (0.00 sec)\n\n\n> æ³¨æï¼éè¦è®°å½ä¸ File å Positionï¼åé¢ä¼ç¨å°ã\n\nï¼5ï¼å¯¼åº sql\n\nmysqldump -u root -p --all-databases --master-data > dbdump.sql\n\n\nï¼6ï¼è§£é¤è¯»é\n\nmysql> UNLOCK TABLES;\n\n\nï¼7ï¼å° sql è¿ç¨ä¼ éå°ä»èç¹ä¸\n\nscp dbdump.sql root@192.168.8.11:/home\n\n\n# ä»èç¹ä¸çæä½\n\nï¼1ï¼ä¿®æ¹éç½®å¹¶éå¯\n\næ§è¡ vi /etc/my.cnf ï¼æ·»å å¦ä¸éç½®ï¼\n\n[mysqld]\nserver-id=2\nlog_bin=/var/lib/mysql/binlog\n\n\n * server-id - æå¡å¨ ID å·ãå¨ä¸»ä»æ¶æä¸­ï¼æ¯å°æºå¨ç ID å¿é¡»å¯ä¸ã\n * log_bin - åæ­¥çæ¥å¿è·¯å¾åæä»¶åï¼ä¸å®æ³¨æè¿ä¸ªç®å½è¦æ¯ mysql ææéåå¥çï¼\n\nä¿®æ¹åï¼éå¯ mysql ä½¿éç½®çæï¼\n\nsystemctl restart mysql\n\n\nï¼2ï¼å¯¼å¥ sql\n\nmysql -u root -p < /home/dbdump.sql\n\n\nï¼3ï¼å¨ä»èç¹ä¸å»ºç«ä¸ä¸»èç¹çè¿æ¥\n\nè¿å¥ mysql å½ä»¤æ§å¶å°ï¼\n\n$ mysql -u root -p\nPassword:\n\n\næ§è¡ä»¥ä¸ SQLï¼\n\n-- åæ­¢ä»èç¹æå¡\nSTOP SLAVE;\n\n-- æ³¨æï¼MASTER_USER å\nCHANGE MASTER TO\nMASTER_HOST='192.168.8.10',\nMASTER_USER='slave',\nMASTER_PASSWORD='å¯ç ',\nMASTER_LOG_FILE='binlog.000001',\nMASTER_LOG_POS=4202;\n\n\n * MASTER_LOG_FILE å MASTER_LOG_POS åæ°è¦åå«ä¸ show master status æä»¤è·å¾ç File å Position å±æ§å¼å¯¹åºã\n * MASTER_HOST æ¯ä¸»èç¹ç HOSTã\n * MASTER_USER å MASTER_PASSWORD æ¯å¨ä¸»èç¹ä¸æ³¨åçç¨æ·åå¯ç ã\n\nï¼4ï¼å¯å¨ slave è¿ç¨\n\nmysql> start slave;\n\n\nï¼5ï¼æ¥çä¸»ä»åæ­¥ç¶æ\n\nmysql> show slave status\\G;\n\n\nè¯´æï¼å¦æä»¥ä¸ä¸¤é¡¹åæ°åä¸º YESï¼è¯´æéç½®æ­£ç¡®ã\n\n * Slave_IO_Running\n * Slave_SQL_Running\n\nï¼6ï¼å°ä»èç¹è®¾ä¸ºåªè¯»\n\nmysql> set global read_only=1;\nmysql> set global super_read_only=1;\nmysql> show global variables like \"%read_only%\";\n+-----------------------+-------+\n| Variable_name         | Value |\n+-----------------------+-------+\n| innodb_read_only      | OFF   |\n| read_only             | ON    |\n| super_read_only       | ON    |\n| transaction_read_only | OFF   |\n+-----------------------+-------+\n\n\n> æ³¨ï¼è®¾ç½® slave æå¡å¨ä¸ºåªè¯»ï¼å¹¶ä¸å½±åä¸»ä»åæ­¥ã\n\n\n# æ¢æ¥è¯¢\n\næ¥çæ¢æ¥è¯¢æ¯å¦å¼å¯\n\nshow variables like '%slow_query_log';\n\n\nå¯ä»¥éè¿ set global slow_query_log å½ä»¤è®¾ç½®æ¢æ¥è¯¢æ¯å¦å¼å¯ï¼ON è¡¨ç¤ºå¼å¯ï¼OFF è¡¨ç¤ºå³é­ã\n\nset global slow_query_log='ON';\n\n\næ¥çæ¢æ¥è¯¢æ¶é´éå¼\n\nshow variables like '%long_query_time%';\n\n\nè®¾ç½®æ¢æ¥è¯¢éå¼\n\nset global long_query_time = 3;\n\n\n\n# éç¦»çº§å«\n\næ¥çéç¦»çº§å«ï¼\n\nmysql> show variables like 'transaction_isolation';\n \n+-----------------------+----------------+\n \n| Variable_name | Value |\n \n+-----------------------+----------------+\n \n| transaction_isolation | READ-COMMITTED |\n \n+-----------------------+----------------+\n\n\n\n# æå¡å¨éç½®\n\n> å¤§é¨åæåµä¸ï¼é»è®¤çåºæ¬éç½®å·²ç»è¶³å¤åºä»å¤§å¤æ°åºæ¯ï¼ä¸è¦è½»æä¿®æ¹ Mysql æå¡å¨éç½®ï¼é¤éä½ æç¡®ç¥éä¿®æ¹é¡¹æ¯æççã\n> \n> å°½éä¸è¦ä½¿ç¨ Mysql çç¼å­åè½ï¼å ä¸ºå¶è¦æ±æ¯æ¬¡è¯·æ±åæ°å®å¨ç¸åï¼æè½å½ä¸­ç¼å­ãè¿ç§æ¹å¼å®éä¸å¹¶ä¸é«æï¼è¿ä¼å¢å é¢å¤å¼éï¼å®éä¸å¡åºæ¯ä¸­ä¸è¬ä½¿ç¨ Redis ç­ key-value å­å¨æ¥è§£å³ç¼å­é®é¢ï¼æ§è½è¿é«äº Mysql çæ¥è¯¢ç¼å­ã\n\n\n# éç½®æä»¶è·¯å¾\n\néç½® Mysql é¦åè¦ç¡®å®éç½®æä»¶å¨åªå¿ã\n\nä¸å Linux æä½ç³»ç»ä¸ï¼Mysql éç½®æä»¶è·¯å¾å¯è½ä¸åãéå¸¸çè·¯å¾ä¸º /etc/my.cnf æ /etc/mysql/my.cnf ã\n\nå¦æä¸ç¥ééç½®æä»¶è·¯å¾ï¼å¯ä»¥å°è¯ä»¥ä¸æä½ï¼\n\n# which mysqld\n/usr/sbin/mysqld\n# /usr/sbin/mysqld --verbose --help | grep -A 1 'Default options'\nDefault options are read from the following files in the given order:\n/etc/my.cnf /etc/mysql/my.cnf /usr/etc/my.cnf ~/.my.cnf\n\n\n\n# éç½®é¡¹è¯­æ³\n\nMysql éç½®é¡¹è®¾ç½®é½ä½¿ç¨å°åï¼åè¯ä¹é´ç¨ä¸åçº¿ææ¨ªçº¿éå¼ï¼äºèæ¯ç­ä»·çï¼ã\n\nå»ºè®®ä½¿ç¨åºå®çé£æ ¼ï¼è¿æ ·æ£ç´¢éç½®é¡¹æ¶è¾ä¸ºæ¹ä¾¿ã\n\n# è¿ä¸¤ç§æ ¼å¼ç­ä»·\n/usr/sbin/mysqld --auto-increment-offset=5\n/usr/sbin/mysqld --auto_increment_offset=5\n\n\n\n# å¸¸ç¨éç½®é¡¹è¯´æ\n\n> è¿éä»ç»æ¯è¾å¸¸ç¨çåºæ¬éç½®ï¼æ´å¤éç½®é¡¹è¯´æå¯ä»¥åèï¼Mysql æå¡å¨éç½®è¯´æ\n\nåç»åºä¸ä»½å¸¸ç¨éç½®æ¨¡æ¿ï¼åå®¹å¦ä¸ï¼\n\n[mysqld]\n# GENERAL\n# -------------------------------------------------------------------------------\ndatadir = /var/lib/mysql\nsocket  = /var/lib/mysql/mysql.sock\npid_file = /var/lib/mysql/mysql.pid\nuser = mysql\nport = 3306\ndefault_storage_engine = InnoDB\ndefault_time_zone = '+8:00'\ncharacter_set_server = utf8mb4\ncollation_server = utf8mb4_0900_ai_ci\n\n# LOG\n# -------------------------------------------------------------------------------\nlog_error = /var/log/mysql/mysql-error.log\nslow_query_log = 1\nslow_query_log_file = /var/log/mysql/mysql-slow.log\n\n# InnoDB\n# -------------------------------------------------------------------------------\ninnodb_buffer_pool_size = <value>\ninnodb_log_file_size = <value>\ninnodb_file_per_table = 1\ninnodb_flush_method = O_DIRECT\n\n# MyIsam\n# -------------------------------------------------------------------------------\nkey_buffer_size = <value>\n\n# OTHER\n# -------------------------------------------------------------------------------\ntmp_table_size = 32M\nmax_heap_table_size = 32M\nquery_cache_type = 0\nquery_cache_size = 0\nmax_connections = <value>\nthread_cache = <value>\nopen_files_limit = 65535\n\n[client]\nsocket  = /var/lib/mysql/mysql.sock\nport = 3306\n\n\n * GENERAL\n   \n   * datadir - mysql æ°æ®æä»¶æå¨ç®å½\n   * socket - scoket æä»¶\n   * pid_file - PID æä»¶\n   * user - å¯å¨ mysql æå¡è¿ç¨çç¨æ·\n   * port - æå¡ç«¯å£å·ï¼é»è®¤ 3306\n   * default_storage_engine - mysql 5.1 ä¹åï¼é»è®¤å¼ææ¯ InnoDB\n   * default_time_zone - é»è®¤æ¶åºãä¸­å½å¤§é¨åå°åºå¨ä¸å«åºï¼å³ +8:00\n   * character_set_server - æ°æ®åºé»è®¤å­ç¬¦é\n   * collation_server - æ°æ®åºå­ç¬¦éå¯¹åºä¸äºæåºç­è§åï¼æ³¨æè¦å character_set_server å¯¹åº\n\n * LOG\n   \n   * log_error - éè¯¯æ¥å¿æä»¶å°å\n   * slow_query_log - éè¯¯æ¥å¿æä»¶å°å\n\n * InnoDB\n   \n   * innodb_buffer_pool_size - InnoDB ä½¿ç¨ä¸ä¸ªç¼å²æ± æ¥ä¿å­ç´¢å¼ååå§æ°æ®ï¼ä¸å MyISAMãè¿éä½ è®¾ç½®è¶å¤§ï¼ä½ å¨å­åè¡¨éé¢æ°æ®æ¶æéè¦çç£ç I/O è¶å°ã\n     * å¨ä¸ä¸ªç¬ç«ä½¿ç¨çæ°æ®åºæå¡å¨ä¸,ä½ å¯ä»¥è®¾ç½®è¿ä¸ªåéå°æå¡å¨ç©çåå­å¤§å°ç 60%-80%\n     * æ³¨æå«è®¾ç½®çè¿å¤§ï¼ä¼å¯¼è´ system ç swap ç©ºé´è¢«å ç¨ï¼å¯¼è´æä½ç³»ç»åæ¢ï¼ä»èåä½ sql æ¥è¯¢çæç\n     * é»è®¤å¼ï¼128Mï¼å»ºè®®å¼ï¼ç©çåå­ç 60%-80%\n   * innodb_log_file_size - æ¥å¿æä»¶çå¤§å°ãé»è®¤å¼ï¼48Mï¼å»ºè®®å¼ï¼æ ¹æ®ä½ ç³»ç»çç£çç©ºé´åæ¥å¿å¢é¿æåµè°æ´å¤§å°\n   * innodb_file_per_table - è¯´æï¼mysql5.7 ä¹åé»è®¤å¼å¯ï¼æææ¯ï¼æ¯å¼ è¡¨ä¸ä¸ªç¬ç«è¡¨ç©ºé´ãé»è®¤å¼ 1ï¼å¼å¯ã\n   * innodb_flush_method - è¯´æï¼æ§å¶ç innodb æ°æ®æä»¶å redo log çæå¼ãå·åæ¨¡å¼ï¼ä¸ç§æ¨¡å¼ï¼fdatasync(é»è®¤)ï¼O_DSYNCï¼O_DIRECTãé»è®¤å¼ä¸ºç©ºï¼å»ºè®®å¼ï¼ä½¿ç¨ SAN æè raidï¼å»ºè®®ç¨ O_DIRECTï¼ä¸ææµè¯çè¯ï¼é»è®¤çäº§ä¸ä½¿ç¨ O_DIRECT\n     * fdatasyncï¼æ°æ®æä»¶ï¼buffer pool->os buffer->ç£çï¼æ¥å¿æä»¶ï¼buffer pool->os buffer->ç£çï¼\n     * O_DSYNCï¼ æ°æ®æä»¶ï¼buffer pool->os buffer->ç£çï¼æ¥å¿æä»¶ï¼buffer pool->ç£çï¼\n     * O_DIRECTï¼ æ°æ®æä»¶ï¼buffer pool->ç£çï¼ æ¥å¿æä»¶ï¼buffer pool->os buffer->ç£çï¼\n\n * MyIsam\n   \n   * key_buffer_size - æå®ç´¢å¼ç¼å²åºçå¤§å°ï¼ä¸º MYISAM æ°æ®è¡¨å¼å¯ä¾çº¿ç¨å±äº«çç´¢å¼ç¼å­ï¼å¯¹ INNODB å¼ææ æãç¸å½å½±å MyISAM çæ§è½ã\n     * ä¸è¦å°å¶è®¾ç½®å¤§äºä½ å¯ç¨åå­ç 30%ï¼å ä¸ºä¸é¨ååå­åæ ·è¢« OS ç¨æ¥ç¼å²è¡æ°æ®\n     * çè³å¨ä½ å¹¶ä¸ä½¿ç¨ MyISAM è¡¨çæåµä¸ï¼ä½ ä¹éè¦ä»æ§è®¾ç½®èµ· 8-64M åå­ç±äºå®åæ ·ä¼è¢«åé¨ä¸´æ¶ç£çè¡¨ä½¿ç¨ã\n     * é»è®¤å¼ 8Mï¼å»ºè®®å¼ï¼å¯¹äºåå­å¨ 4GB å·¦å³çæå¡å¨è¯¥åæ°å¯è®¾ç½®ä¸º 256M æ 384Mã\n     * æ³¨æï¼è¯¥åæ°å¼è®¾ç½®çè¿å¤§åèä¼æ¯æå¡å¨æ´ä½æçéä½ï¼\n\n * OTHER\n   \n   * tmp_table_size - åå­ä¸´æ¶è¡¨çæå¤§å¼ï¼é»è®¤ 16Mï¼æ­¤å¤è®¾ç½®æ 128M\n   * max_heap_table_size - ç¨æ·åå»ºçåå­è¡¨çå¤§å°ï¼é»è®¤ 16Mï¼å¾å¾å tmp_table_size ä¸èµ·è®¾ç½®ï¼éå¶ç¨æ·ä¸´æ¶è¡¨å¤§å°ãè¶éçè¯ï¼MySQL å°±ä¼èªå¨å°æå®è½¬åä¸ºåºäºç£çç MyISAM è¡¨ï¼å­å¨å¨æå®ç tmpdir ç®å½ä¸ï¼å¢å¤§ IO ååï¼å»ºè®®åå­å¤§ï¼å¢å¤§è¯¥æ°å¼ã\n   * query_cache_type - è¿ä¸ªç³»ç»åéæ§å¶çæ¥è¯¢ç¼å­åè½çå¼å¯åå³é­ï¼0 è¡¨ç¤ºå³é­ï¼1 è¡¨ç¤ºæå¼ï¼2 è¡¨ç¤ºåªè¦ select ä¸­æç¡®æå® SQL_CACHE æç¼å­ã\n   * query_cache_size - é»è®¤å¼ 1Mï¼ä¼ç¹æ¯æ¥è¯¢ç¼å­å¯ä»¥æå¤§çæé«æå¡å¨éåº¦ï¼å¦æä½ æå¤§éçç¸åçæ¥è¯¢å¹¶ä¸å¾å°ä¿®æ¹è¡¨ãç¼ºç¹ï¼å¨ä½ è¡¨ç»å¸¸ååçæåµä¸æèå¦æä½ çæ¥è¯¢åææ¯æ¬¡é½ä¸åï¼æ¥è¯¢ç¼å­ä¹è®¸å¼èµ·æ§è½ä¸éèä¸æ¯æ§è½æåã\n   * max_connections - æå¤§è¿æ¥æ°ï¼å¯è®¾æå¤§å¼ 16384ï¼ä¸è¬èèæ ¹æ®åæ¶å¨çº¿äººæ°è®¾ç½®ä¸ä¸ªæ¯è¾ç»¼åçæ°å­ï¼é´äºè¯¥æ°å¼å¢å¤§å¹¶ä¸å¤ªæ¶èç³»ç»èµæºï¼å»ºè®®ç´æ¥è®¾ 10000ãå¦æå¨è®¿é®æ¶ç»å¸¸åºç° Too Many Connections çéè¯¯æç¤ºï¼åéè¦å¢å¤§è¯¥åæ°å¼\n   * thread_cache - å½å®¢æ·ç«¯æ­å¼ä¹åï¼æå¡å¨å¤çæ­¤å®¢æ·ççº¿ç¨å°ä¼ç¼å­èµ·æ¥ä»¥ååºä¸ä¸ä¸ªå®¢æ·èä¸æ¯éæ¯ãå¯éç¨ï¼åå°äºç³»ç»å¼éãé»è®¤å¼ä¸º 9ï¼å»ºè®®å¼ï¼ä¸¤ç§åå¼æ¹å¼ï¼\n     * æ¹å¼ä¸ï¼æ ¹æ®ç©çåå­ï¼1G â> 8ï¼2G â> 16ï¼ 3G â> 32ï¼ >3G â> 64ï¼\n     * æ¹å¼äºï¼æ ¹æ® show status like 'threads%'ï¼æ¥ç Threads_connected å¼ã\n   * open_files_limit - MySQL æå¼çæä»¶æè¿°ç¬¦éå¶ï¼é»è®¤æå° 1024;\n     * å½ open_files_limit æ²¡æè¢«éç½®çæ¶åï¼æ¯è¾ max_connections*5 å ulimit -n çå¼ï¼åªä¸ªå¤§ç¨åªä¸ªï¼\n     * å½ open_file_limit è¢«éç½®çæ¶åï¼æ¯è¾ open_files_limit å max_connections*5 çå¼ï¼åªä¸ªå¤§ç¨åªä¸ª\n     * æ³¨æï¼ä»ç¶å¯è½åºç°æ¥éä¿¡æ¯ Can't create a new threadï¼æ­¤æ¶è§å¯ç³»ç» cat /proc/mysql è¿ç¨å·/limitsï¼è§å¯è¿ç¨ ulimit éå¶æåµ\n     * è¿å°çè¯ï¼èèä¿®æ¹ç³»ç»éç½®è¡¨ï¼/etc/security/limits.conf å /etc/security/limits.d/90-nproc.conf\n\n\n# å¸¸è§é®é¢\n\n\n# Too many connections\n\nç°è±¡\n\nå°è¯è¿æ¥ Mysql æ¶ï¼éå° Too many connections éè¯¯ã\n\nåå \n\næ°æ®åºè¿æ¥çº¿ç¨æ°è¶è¿æå¤§å¼ï¼è®¿é®è¢«æç»ã\n\nè§£å³æ¹æ¡\n\nå¦æå®éè¿æ¥çº¿ç¨æ°è¿å¤§ï¼å¯ä»¥èèå¢å æå¡å¨èç¹æ¥åæµï¼å¦æå®éçº¿ç¨æ°å¹¶ä¸ç®è¿å¤§ï¼é£ä¹å¯ä»¥éç½® max_connections æ¥å¢å åè®¸çæå¤§è¿æ¥æ°ãéè¦æ³¨æçæ¯ï¼è¿æ¥æ°ä¸å®è¿å¤§ï¼ä¸è¬æ¥è¯´ï¼ååºæ¯ç§æ 2000 ä¸ªå¹¶åè¿æ¥æ¶ï¼å°±å¯ä»¥èèæ©å®¹äºï¼å¥åº·çç¶æåºè¯¥ç»´æå¨æ¯ç§ 1000 ä¸ªå¹¶åè¿æ¥å·¦å³ã\n\nï¼1ï¼æ¥çæå¤§è¿æ¥æ°\n\nmysql> show variables like '%max_connections%';\n+------------------------+-------+\n| Variable_name          | Value |\n+------------------------+-------+\n| max_connections        | 151   |\n| mysqlx_max_connections | 100   |\n+------------------------+-------+\n\n\nï¼2ï¼æ¥çæå¡å¨ååºçæå¤§è¿æ¥æ°\n\nmysql> show global status like 'Max_used_connections';\n+----------------------+-------+\n| Variable_name        | Value |\n+----------------------+-------+\n| Max_used_connections | 142   |\n+----------------------+-------+\n1 row in set (0.00 sec)\n\n\nï¼3ï¼ä¸´æ¶è®¾ç½®æå¤§è¿æ¥æ°\n\nset GLOBAL max_connections=256;\n\n\næ³¨æï¼å½æå¡å¨éå¯æ¶ï¼æå¤§è¿æ¥æ°ä¼è¢«éç½®ã\n\nï¼4ï¼æ°¸ä¹è®¾ç½®æå¤§è¿æ¥æ°\n\nä¿®æ¹ /etc/my.cnf éç½®æä»¶ï¼å¨ [mysqld] æ·»å ä»¥ä¸éç½®ï¼\n\nmax_connections=256\n\n\néå¯ mysql ä»¥çæ\n\nï¼5ï¼ä¿®æ¹ Linux æå¤§æä»¶æ°éå¶\n\nè®¾ç½®äºæå¤§è¿æ¥æ°ï¼å¦æè¿æ¯æ²¡æçæï¼èèæ£æ¥ä¸ä¸ Linux æå¤§æä»¶æ°\n\nMysql æå¤§è¿æ¥æ°ä¼åå°æå¤§æä»¶æ°éå¶ï¼vim /etc/security/limits.confï¼æ·»å  mysql ç¨æ·éç½®\n\nmysql hard nofile 65535\nmysql soft nofile 65535\n\n\nï¼6ï¼æ£æ¥ LimitNOFILE\n\nå¦ææ¯ä½¿ç¨ rpm æ¹å¼å®è£ mysqlï¼æ£æ¥ mysqld.service æä»¶ä¸­ç LimitNOFILE æ¯å¦éç½®çå¤ªå°ã\n\n\n# æ¶åºï¼time_zoneï¼åå·®\n\nç°è±¡\n\næ°æ®åºä¸­å­å¨ç Timestamp å­æ®µå¼æ¯çå®å¼å°äº 13 ä¸ªå°æ¶ã\n\nåå \n\n * å½ JDBC ä¸ MySQL å¼å§å»ºç«è¿æ¥æ¶ï¼ä¼è·åæå¡å¨åæ°ã\n * å½ MySQL ç time_zone å¼ä¸º SYSTEM æ¶ï¼ä¼å system_time_zone å¼ä½ä¸ºåè°æ¶åºï¼è¥å¾å°çæ¯ CST é£ä¹ Java ä¼è¯¯ä»¥ä¸ºè¿æ¯ CST -0500 ï¼å æ­¤ä¼ç»åºéè¯¯çæ¶åºä¿¡æ¯ï¼å½åä¸è¬æ¯CST +0800ï¼å³ä¸å«åºï¼ã\n\næ¥çæ¶åºæ¹æ³ï¼\n\néè¿ show variables like '%time_zone%'; å½ä»¤æ¥ç Mysql æ¶åºéç½®ï¼\n\nmysql> show variables like '%time_zone%';\n+------------------+--------+\n| Variable_name    | Value  |\n+------------------+--------+\n| system_time_zone | CST    |\n| time_zone        | SYSTEM |\n+------------------+--------+\n\n\nè§£å³æ¹æ¡\n\næ¹æ¡ä¸\n\nmysql> set global time_zone = '+08:00';\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> set time_zone = '+08:00';\nQuery OK, 0 rows affected (0.00 sec)\n\n\næ¹æ¡äº\n\nä¿®æ¹ my.cnf æä»¶ï¼å¨ [mysqld] èä¸å¢å  default-time-zone='+08:00' ï¼ç¶åéå¯ã\n\n\n# æ°æ®è¡¨æåå¦ä½ä¿®å¤\n\nä½¿ç¨ myisamchk æ¥ä¿®å¤ï¼å·ä½æ­¥éª¤ï¼\n\n 1. ä¿®å¤åå° mysql æå¡åæ­¢ã\n 2. æå¼å½ä»¤è¡æ¹å¼ï¼ç¶åè¿å¥å° mysql ç bin ç®å½ã\n 3. æ§è¡ myisamchk ârecover æ°æ®åºæå¨è·¯ /*.MYI\n\nä½¿ç¨ repair table æè OPTIMIZE table å½ä»¤æ¥ä¿®å¤ï¼REPAIR TABLE table_name ä¿®å¤è¡¨ OPTIMIZE TABLE table_name ä¼åè¡¨ REPAIR TABLE ç¨äºä¿®å¤è¢«ç ´åçè¡¨ã OPTIMIZE TABLE ç¨äºåæ¶é²ç½®çæ°æ®åºç©ºé´ï¼å½è¡¨ä¸çæ°æ®è¡è¢«å é¤æ¶ï¼æå æ®çç£çç©ºé´å¹¶æ²¡æç«å³è¢«åæ¶ï¼ä½¿ç¨äº OPTIMIZE TABLE å½ä»¤åè¿äºç©ºé´å°è¢«åæ¶ï¼å¹¶ä¸å¯¹ç£çä¸çæ°æ®è¡è¿è¡éæï¼æ³¨æï¼æ¯ç£çä¸ï¼èéæ°æ®åºï¼\n\n\n# æ°æ®ç»æ\n\n> é®é¢ç°è±¡ï¼ERROR 1071: Specified key was too long; max key length is 767 bytes\n\né®é¢åå ï¼Mysql é»è®¤æåµä¸åä¸ªåçç´¢å¼ä¸è½è¶è¿ 767 ä½ï¼ä¸åçæ¬å¯è½å­å¨å·®å¼ï¼ ã\n\nè§£å³æ¹æ³ï¼ä¼åç´¢å¼ç»æï¼ç´¢å¼å­æ®µä¸å®è¿é¿ã\n\n\n# èæ¬\n\nè¿éæ¨èæåçå ä¸ªä¸é®è¿ç»´èæ¬ï¼éå¸¸æ¹ä¾¿ï¼æ¬¢è¿ä½¿ç¨ï¼\n\n * Mysql å®è£èæ¬\n * Mysql å¤ä»½èæ¬\n\n\n# åèèµæ\n\n * ãé«æ§è½ MySQLã\n * https://www.cnblogs.com/xiaopotian/p/8196464.html\n * https://www.cnblogs.com/bigbrotherer/p/7241845.html\n * https://blog.csdn.net/managementandjava/article/details/80039650\n * http://www.manongjc.com/article/6996.html\n * https://www.cnblogs.com/xyabk/p/8967990.html\n * MySQL 8.0 ä¸»ä»ï¼Master-Slaveï¼éç½®\n * Mysql ä¸»ä»åæ­¥å®æ\n * MySQL å¤ä»½åæ¢å¤æºå¶",normalizedContent:"# mysql è¿ç»´\n\n> å¦æä½ çå¬å¸æ dbaï¼é£ä¹ææ­åä½ ï¼ä½ å¯ä»¥æ è§ mysql è¿ç»´ãå¦æä½ çå¬å¸æ²¡æ dbaï¼é£ä½ å°±å¥½å¥½å­¦ä¸¤æ mysql åºæ¬è¿ç»´æä½ï¼è¡èµ°æ±æ¹ï¼é²èº«å¿å¤ã\n\n\n# å®è£é¨ç½²\n\n\n# windows å®è£\n\nï¼1ï¼ä¸è½½ mysql 5.7 åå®è£ç\n\nä¸è½½å°åï¼https://dev.mysql.com/downloads/mysql/5.7.html#downloads\n\nï¼2ï¼è§£åå¹¶åå»º my.ini å¨æ ¹ç®å½\n\nmy.ini æä»¶ç¤ºä¾ï¼\n\n[mysqld]\n#è®¾ç½®3306ç«¯å£\nport = 3306\n# è®¾ç½®mysqlçå®è£ç®å½ è¿åæ¢æèªå·±è§£åçè·¯å¾\nbasedir=d:\\\\tools\\\\db\\\\mysql\\\\mysql-5.7.31\n# åè®¸æå¤§è¿æ¥æ°\nmax_connections=200\n# æå¡ç«¯ä½¿ç¨çå­ç¬¦éé»è®¤ä¸º8æ¯ç¹ç¼ç çlatin1å­ç¬¦é\ncharacter-set-server=utf8\n# åå»ºæ°è¡¨æ¶å°ä½¿ç¨çé»è®¤å­å¨å¼æ\ndefault-storage-engine=innodb\n\n[client]\n# è®¾ç½®mysqlå®¢æ·ç«¯é»è®¤å­ç¬¦é\ndefault-character-set=utf8\n\n\nï¼3ï¼æ§è¡å®è£å½ä»¤\n\nå¨æ§å¶å° cmd ä¸­ä¾æ¬¡æ§è¡ä»¥ä¸å®è£å½ä»¤\n\ncd d:\\\\tools\\\\db\\\\mysql\\\\mysql-5.7.31\nmysqld --initialize\nmysqld -install\n\n\nè¯´æï¼\n\n * mysqld --initialize ä¼èªå¨åå§ååå»º data æä»¶å¤¹å¹¶åå§å mysqlã\n * mysqld -install ä¼å®è£ mysql æå¡ã\n\nï¼4ï¼å¯å¨æå¡\n\nå¨æ§å¶å°æ§è¡ net start mysql å¯å¨æå¡ã\n\n\n# centos å®è£\n\n> æ¬æä»ä»ç» rpm å®è£æ¹å¼\n\n# å®è£ mysql yum æº\n\nå®æ¹ä¸è½½å°åï¼https://dev.mysql.com/downloads/repo/yum/\n\nï¼1ï¼ä¸è½½ yum æº\n\nwget https://dev.mysql.com/get/mysql80-community-release-el7-1.noarch.rpm\n\n\nï¼2ï¼å®è£ yum repo æä»¶å¹¶æ´æ° yum ç¼å­\n\nrpm -ivh mysql80-community-release-el7-1.noarch.rpm\n\n\næ§è¡ç»æï¼\n\nä¼å¨ /etc/yum.repos.d/ ç®å½ä¸çæä¸¤ä¸ª repo æä»¶\n\n$ ls | grep mysql\nmysql-community.repo\nmysql-community-source.repo\n\n\næ´æ° yumï¼\n\nyum clean all\nyum makecache\n\n\nï¼3ï¼æ¥ç rpm å®è£ç¶æ\n\n$ yum search mysql | grep server\nmysql-community-common.i686 : mysql database common files for server and client\nmysql-community-common.x86_64 : mysql database common files for server and\nmysql-community-test.x86_64 : test suite for the mysql database server\n                       : administering mysql servers\nmysql-community-server.x86_64 : a very fast and reliable sql database server\n\n\néè¿ yum å®è£ mysql æå ä¸ªéè¦ç®å½ï¼\n\n## éç½®æä»¶\n/etc/my.cnf\n## æ°æ®åºç®å½\n/var/lib/mysql/\n## éç½®æä»¶\n/usr/share/mysqlï¼mysql.serverå½ä»¤åéç½®æä»¶ï¼\n## ç¸å³å½ä»¤\n/usr/binï¼mysqladmin mysqldumpç­å½ä»¤ï¼\n## å¯å¨èæ¬\n/usr/lib/systemd/system/mysqld.service ï¼æ³¨åä¸º systemd æå¡ï¼\n\n\nï¼4ï¼å®è£ mysql æå¡å¨\n\nyum install mysql-community-server\n\n\n# mysql æå¡ç®¡ç\n\néè¿ yum æ¹å¼å®è£ mysql åï¼æ¬å°ä¼æä¸ä¸ªåä¸º mysqld ç systemd æå¡ã\n\nå¶æå¡ç®¡çååç®ä¾¿ï¼\n\n## æ¥çç¶æ\nsystemctl status mysqld\n## å¯ç¨æå¡\nsystemctl enable mysqld\n## ç¦ç¨æå¡\nsystemctl disable mysqld\n## å¯å¨æå¡\nsystemctl start mysqld\n## éå¯æå¡\nsystemctl restart mysqld\n## åæ­¢æå¡\nsystemctl stop mysqld\n\n\n\n# åå§åæ°æ®åºå¯ç \n\næ¥çä¸ä¸åå§å¯ç \n\n$ grep \"password\" /var/log/mysqld.log\n2018-09-30t03:13:41.727736z 5 [note] [my-010454] [server] a temporary password is generated for root@localhost: %:lt+srwu4k1\n\n\næ§è¡å½ä»¤ï¼\n\nmysql -uroot -p<ä¸´æ¶å¯ç >\n\n\nè¾å¥ä¸´æ¶å¯ç ï¼è¿å¥ mysqlï¼å¦æè¦ä¿®æ¹å¯ç ï¼æ§è¡ä»¥ä¸æä»¤ï¼\n\nalter user 'root'@'localhost' identified by 'ä½ çå¯ç ';\n\n\næ³¨ï¼å¯ç å¼ºåº¦é»è®¤ä¸ºä¸­ç­ï¼å¤§å°åå­æ¯ãæ°å­ãç¹æ®ç¬¦å·ï¼åªæä¿®æ¹æååæè½ä¿®æ¹éç½®åè®¾ç½®æ´ç®åçå¯ç \n\n\n# éç½®è¿ç¨è®¿é®\n\ncreate user 'root'@'%' identified by 'ä½ çå¯ç ';\ngrant all on *.* to 'root'@'%';\nalter user 'root'@'%' identified with mysql_native_password by 'ä½ çå¯ç ';\nflush privileges;\n\n\n\n# è·³è¿ç»å½è®¤è¯\n\nvim /etc/my.cnf\n\n\nå¨ [mysqld] ä¸é¢å ä¸ skip-grant-tables\n\nä½ç¨æ¯ç»å½æ¶è·³è¿ç»å½è®¤è¯ï¼æ¢å¥è¯è¯´å°±æ¯ root ä»ä¹å¯ç é½å¯ä»¥ç»å½è¿å»ã\n\næ§è¡ systemctl restart mysqldï¼éå¯ mysql\n\n\n# åºæ¬è¿ç»´\n\n\n# å®¢æ·ç«¯è¿æ¥\n\nè¯­æ³ï¼mysql -h<ä¸»æº> -p<ç«¯å£> -u<ç¨æ·å> -p<å¯ç >\n\nå¦ææ²¡ææ¾å¼æå®å¯ç ï¼ä¼è¦æ±è¾å¥å¯ç æè½è®¿é®ã\n\nãç¤ºä¾ãè¿æ¥æ¬å° mysql\n\n$ mysql -h 127.0.0.1 -p 3306 -u root -p\nenter password:\nwelcome to the mysql monitor.  commands end with ; or \\g.\nyour mysql connection id is 13501\nserver version: 8.0.19 mysql community server - gpl\n\ncopyright (c) 2000, 2020, oracle and/or its affiliates. all rights reserved.\n\noracle is a registered trademark of oracle corporation and/or its\naffiliates. other names may be trademarks of their respective\nowners.\n\ntype 'help;' or '\\h' for help. type '\\c' to clear the current input statement.\n\nmysql>\n\n\n\n# æ¥çè¿æ¥\n\nè¿æ¥å®æåï¼å¦æä½ æ²¡æåç»­çå¨ä½ï¼è¿ä¸ªè¿æ¥å°±å¤äºç©ºé²ç¶æï¼ä½ å¯ä»¥å¨ show processlist å½ä»¤ä¸­çå°å®ãå®¢æ·ç«¯å¦æå¤ªé¿æ¶é´æ²¡å¨éï¼è¿æ¥å¨å°±ä¼èªå¨å°å®æ­å¼ãè¿ä¸ªæ¶é´æ¯ç±åæ° wait_timeout æ§å¶çï¼é»è®¤å¼æ¯ 8 å°æ¶ã\n\n\n\n\n# åå»ºç¨æ·\n\ncreate user 'username'@'host' identified by 'password';\n\n\nè¯´æï¼\n\n * usernameï¼ä½ å°åå»ºçç¨æ·å\n * hostï¼æå®è¯¥ç¨æ·å¨åªä¸ªä¸»æºä¸å¯ä»¥ç»éï¼å¦ææ¯æ¬å°ç¨æ·å¯ç¨ localhostï¼å¦ææ³è®©è¯¥ç¨æ·å¯ä»¥ä»ä»»æè¿ç¨ä¸»æºç»éï¼å¯ä»¥ä½¿ç¨ééç¬¦%\n * passwordï¼è¯¥ç¨æ·çç»éå¯ç ï¼å¯ç å¯ä»¥ä¸ºç©ºï¼å¦æä¸ºç©ºåè¯¥ç¨æ·å¯ä»¥ä¸éè¦å¯ç ç»éæå¡å¨\n\nç¤ºä¾ï¼\n\ncreate user 'dog'@'localhost' identified by '123456';\ncreate user 'pig'@'192.168.1.101_' idendified by '123456';\ncreate user 'pig'@'%' identified by '123456';\ncreate user 'pig'@'%' identified by '';\ncreate user 'pig'@'%';\n\n\n> æ³¨æï¼å¨ mysql 8 ä¸­ï¼é»è®¤å¯ç éªè¯ä¸åæ¯ passwordãæä»¥å¨åå»ºç¨æ·æ¶ï¼create user 'username'@'%' identified by 'password'; å®¢æ·ç«¯æ¯æ æ³è¿æ¥æå¡çã\n> \n> æä»¥ï¼éè¦å ä¸ identified with mysql_native_passwordï¼ä¾å¦ï¼create user 'slave'@'%' identified with mysql_native_password by '123456';\n\n\n# æ¥çç¨æ·\n\n-- æ¥çææç¨æ·\nselect distinct concat('user: ''', user, '''@''', host, ''';') as query\nfrom mysql.user;\n\n\n\n# ææ\n\nå½ä»¤ï¼\n\ngrant privileges on databasename.tablename to 'username'@'host'\n\n\nè¯´æï¼\n\n * privilegesï¼ç¨æ·çæä½æéï¼å¦selectï¼insertï¼updateç­ï¼å¦æè¦æäºæçæéåä½¿ç¨all\n * databasenameï¼æ°æ®åºå\n * tablenameï¼è¡¨åï¼å¦æè¦æäºè¯¥ç¨æ·å¯¹æææ°æ®åºåè¡¨çç¸åºæä½æéåå¯ç¨*è¡¨ç¤ºï¼å¦*.*\n\nç¤ºä¾ï¼\n\ngrant select, insert on test.user to 'pig'@'%';\ngrant all on *.* to 'pig'@'%';\ngrant all on maindataplus.* to 'pig'@'%';\n\n\næ³¨æï¼\n\nç¨ä»¥ä¸å½ä»¤ææçç¨æ·ä¸è½ç»å¶å®ç¨æ·ææï¼å¦ææ³è®©è¯¥ç¨æ·å¯ä»¥ææï¼ç¨ä»¥ä¸å½ä»¤:\n\n-- ä¸ºæå®ç¨æ·éç½®æå®æé\ngrant privileges on databasename.tablename to 'username'@'host' with grant option;\n-- ä¸º root ç¨æ·åéæææé\ngrant all on *.* to 'root'@'%' identified by 'å¯ç ' with grant option;\n\n\n\n# æ¤éææ\n\nå½ä»¤:\n\nrevoke privilege on databasename.tablename from 'username'@'host';\n\n\nè¯´æ:\n\nprivilege, databasename, tablenameï¼åææé¨å\n\nä¾å­:\n\nrevoke select on *.* from 'pig'@'%';\n\n\næ³¨æ:\n\nåå¦ä½ å¨ç»ç¨æ·'pig'@'%'ææçæ¶åæ¯è¿æ ·çï¼æç±»ä¼¼çï¼ï¼grant select on test.user to 'pig'@'%'ï¼åå¨ä½¿ç¨revoke select on *.* from 'pig'@'%';å½ä»¤å¹¶ä¸è½æ¤éè¯¥ç¨æ·å¯¹ test æ°æ®åºä¸­ user è¡¨çselect æä½ãç¸åï¼å¦æææä½¿ç¨çæ¯grant select on *.* to 'pig'@'%';årevoke select on test.user from 'pig'@'%';å½ä»¤ä¹ä¸è½æ¤éè¯¥ç¨æ·å¯¹ test æ°æ®åºä¸­ user è¡¨çselectæéã\n\nå·ä½ä¿¡æ¯å¯ä»¥ç¨å½ä»¤show grants for 'pig'@'%'; æ¥çã\n\n\n# æ¥çææ\n\n-- æ¥çç¨æ·æé\nshow grants for 'root'@'%';\n\n\n\n# æ´æ¹ç¨æ·å¯ç \n\nset password for 'username'@'host' = password('newpassword');\n\n\nå¦ææ¯å½åç»éç¨æ·ç¨:\n\nset password = password(\"newpassword\");\n\n\nç¤ºä¾ï¼\n\nset password for 'pig'@'%' = password(\"123456\");\n\n\n\n# å¤ä»½ä¸æ¢å¤\n\nmysql å¤ä»½æ°æ®ä½¿ç¨ mysqldump å½ä»¤ã\n\nmysqldump å°æ°æ®åºä¸­çæ°æ®å¤ä»½æä¸ä¸ªææ¬æä»¶ï¼è¡¨çç»æåè¡¨ä¸­çæ°æ®å°å­å¨å¨çæçææ¬æä»¶ä¸­ã\n\nå¤ä»½ï¼\n\n# å¤ä»½ä¸ä¸ªæ°æ®åº\n\nè¯­æ³ï¼\n\nmysqldump -h <host> -p<port> -u<username> -p<database> [<table1> <table2> ...] > backup.sql\n\n\n * host - mysql server ç host\n * port - mysql server çç«¯å£\n * username - æ°æ®åºç¨æ·\n * dbname - æ°æ®åºåç§°\n * table1 å table2 åæ°è¡¨ç¤ºéè¦å¤ä»½çè¡¨çåç§°ï¼ä¸ºç©ºåæ´ä¸ªæ°æ®åºå¤ä»½ï¼\n * backupname.sql åæ°è¡¨è®¾è®¡å¤ä»½æä»¶çåç§°ï¼æä»¶ååé¢å¯ä»¥å ä¸ä¸ä¸ªç»å¯¹è·¯å¾ãéå¸¸å°æ°æ®åºè¢«åæä¸ä¸ªåç¼åä¸º sql çæä»¶\n\n# å¤ä»½å¤ä¸ªæ°æ®åº\n\nmysqldump -u <username> -p --databases <database1> <database2> ... > backup.sql\n\n\n# å¤ä»½æææ°æ®åº\n\nmysqldump -u <username> -p --all-databases > backup.sql\n\n\n# æ¢å¤ä¸ä¸ªæ°æ®åº\n\nmysql æ¢å¤æ°æ®ä½¿ç¨ mysql å½ä»¤ã\n\nè¯­æ³ï¼\n\nmysql -h <host> -p<port> -u<username> -p<database> < backup.sql\n\n\n# æ¢å¤æææ°æ®åº\n\nmysql -u<username> -p --all-databases < backup.sql\n\n\n\n# å¸è½½\n\nï¼1ï¼æ¥çå·²å®è£ç mysql\n\n$ rpm -qa | grep -i mysql\nperl-dbd-mysql-4.023-6.el7.x86_64\nmysql80-community-release-el7-1.noarch\nmysql-community-common-8.0.12-1.el7.x86_64\nmysql-community-client-8.0.12-1.el7.x86_64\nmysql-community-libs-compat-8.0.12-1.el7.x86_64\nmysql-community-libs-8.0.12-1.el7.x86_64\n\n\nï¼2ï¼å¸è½½ mysql\n\nyum remove mysql-community-server.x86_64\n\n\n\n# ä¸»ä»èç¹é¨ç½²\n\nåè®¾éè¦éç½®ä¸ä¸ªä¸»ä» mysql æå¡å¨ç¯å¢\n\n * master èç¹ï¼192.168.8.10\n * slave èç¹ï¼192.168.8.11\n\n# ä¸»èç¹ä¸çæä½\n\nï¼1ï¼ä¿®æ¹éç½®å¹¶éå¯\n\næ§è¡ vi /etc/my.cnf ï¼æ·»å å¦ä¸éç½®ï¼\n\n[mysqld]\nserver-id=1\nlog_bin=/var/lib/mysql/binlog\n\n\n * server-id - æå¡å¨ id å·ãå¨ä¸»ä»æ¶æä¸­ï¼æ¯å°æºå¨ç id å¿é¡»å¯ä¸ã\n * log_bin - åæ­¥çæ¥å¿è·¯å¾åæä»¶åï¼ä¸å®æ³¨æè¿ä¸ªç®å½è¦æ¯ mysql ææéåå¥çï¼\n\nä¿®æ¹åï¼éå¯ mysql ä½¿éç½®çæï¼\n\nsystemctl restart mysql\n\n\nï¼2ï¼åå»ºç¨äºåæ­¥çç¨æ·\n\nè¿å¥ mysql å½ä»¤æ§å¶å°ï¼\n\n$ mysql -u root -p\npassword:\n\n\næ§è¡ä»¥ä¸ sqlï¼\n\n-- a. åå»º slave ç¨æ·\ncreate user 'slave'@'%' identified with mysql_native_password by 'å¯ç ';\n-- ä¸º slave èµäº replication slave æé\ngrant replication slave on *.* to 'slave'@'%';\n\n-- b. æèï¼åå»º slave ç¨æ·ï¼å¹¶æå®è¯¥ç¨æ·è½å¨ä»»æä¸»æºä¸ç»å½\n-- å¦ææå¤ä¸ªä»èç¹ï¼åæ³è®©ææä»èç¹é½ä½¿ç¨ç»ä¸çç¨æ·åãå¯ç è®¤è¯ï¼å¯ä»¥èèè¿ç§æ¹å¼\ncreate user 'slave'@'%' identified with mysql_native_password by 'å¯ç ';\ngrant replication slave on *.* to 'slave'@'%';\n\n-- å·æ°ææè¡¨ä¿¡æ¯\nflush privileges;\n\n\n> æ³¨æï¼å¨ mysql 8 ä¸­ï¼é»è®¤å¯ç éªè¯ä¸åæ¯ passwordãæä»¥å¨åå»ºç¨æ·æ¶ï¼create user 'username'@'%' identified by 'password'; å®¢æ·ç«¯æ¯æ æ³è¿æ¥æå¡çãæä»¥ï¼éè¦å ä¸ identified with mysql_native_password by 'password'\n\nè¡¥åç¨æ·ç®¡ç sql:\n\n-- æ¥çææç¨æ·\nselect distinct concat('user: ''', user, '''@''', host, ''';') as query\nfrom mysql.user;\n\n-- æ¥çç¨æ·æé\nshow grants for 'root'@'%';\n\n-- åå»ºç¨æ·\n-- a. åå»º slave ç¨æ·ï¼å¹¶æå®è¯¥ç¨æ·åªè½å¨ä¸»æº 192.168.8.11 ä¸ç»å½\ncreate user 'slave'@'192.168.8.11' identified with mysql_native_password by 'å¯ç ';\n-- ä¸º slave èµäº replication slave æé\ngrant replication slave on *.* to 'slave'@'192.168.8.11';\n\n-- å é¤ç¨æ·\ndrop user 'slave'@'192.168.8.11';\n\n\nï¼3ï¼å è¯»é\n\nä¸ºäºä¸»åºä¸ä»åºçæ°æ®ä¿æä¸è´ï¼æä»¬åä¸º mysql å å¥è¯»éï¼ä½¿å¶åä¸ºåªè¯»ã\n\nmysql> flush tables with read lock;\n\n\nï¼4ï¼æ¥çä¸»èç¹ç¶æ\n\nmysql> show master status;\n+------------------+----------+--------------+---------------------------------------------+-------------------+\n| file             | position | binlog_do_db | binlog_ignore_db                            | executed_gtid_set |\n+------------------+----------+--------------+---------------------------------------------+-------------------+\n| mysql-bin.000001 |     4202 |              | mysql,information_schema,performance_schema |                   |\n+------------------+----------+--------------+---------------------------------------------+-------------------+\n1 row in set (0.00 sec)\n\n\n> æ³¨æï¼éè¦è®°å½ä¸ file å positionï¼åé¢ä¼ç¨å°ã\n\nï¼5ï¼å¯¼åº sql\n\nmysqldump -u root -p --all-databases --master-data > dbdump.sql\n\n\nï¼6ï¼è§£é¤è¯»é\n\nmysql> unlock tables;\n\n\nï¼7ï¼å° sql è¿ç¨ä¼ éå°ä»èç¹ä¸\n\nscp dbdump.sql root@192.168.8.11:/home\n\n\n# ä»èç¹ä¸çæä½\n\nï¼1ï¼ä¿®æ¹éç½®å¹¶éå¯\n\næ§è¡ vi /etc/my.cnf ï¼æ·»å å¦ä¸éç½®ï¼\n\n[mysqld]\nserver-id=2\nlog_bin=/var/lib/mysql/binlog\n\n\n * server-id - æå¡å¨ id å·ãå¨ä¸»ä»æ¶æä¸­ï¼æ¯å°æºå¨ç id å¿é¡»å¯ä¸ã\n * log_bin - åæ­¥çæ¥å¿è·¯å¾åæä»¶åï¼ä¸å®æ³¨æè¿ä¸ªç®å½è¦æ¯ mysql ææéåå¥çï¼\n\nä¿®æ¹åï¼éå¯ mysql ä½¿éç½®çæï¼\n\nsystemctl restart mysql\n\n\nï¼2ï¼å¯¼å¥ sql\n\nmysql -u root -p < /home/dbdump.sql\n\n\nï¼3ï¼å¨ä»èç¹ä¸å»ºç«ä¸ä¸»èç¹çè¿æ¥\n\nè¿å¥ mysql å½ä»¤æ§å¶å°ï¼\n\n$ mysql -u root -p\npassword:\n\n\næ§è¡ä»¥ä¸ sqlï¼\n\n-- åæ­¢ä»èç¹æå¡\nstop slave;\n\n-- æ³¨æï¼master_user å\nchange master to\nmaster_host='192.168.8.10',\nmaster_user='slave',\nmaster_password='å¯ç ',\nmaster_log_file='binlog.000001',\nmaster_log_pos=4202;\n\n\n * master_log_file å master_log_pos åæ°è¦åå«ä¸ show master status æä»¤è·å¾ç file å position å±æ§å¼å¯¹åºã\n * master_host æ¯ä¸»èç¹ç hostã\n * master_user å master_password æ¯å¨ä¸»èç¹ä¸æ³¨åçç¨æ·åå¯ç ã\n\nï¼4ï¼å¯å¨ slave è¿ç¨\n\nmysql> start slave;\n\n\nï¼5ï¼æ¥çä¸»ä»åæ­¥ç¶æ\n\nmysql> show slave status\\g;\n\n\nè¯´æï¼å¦æä»¥ä¸ä¸¤é¡¹åæ°åä¸º yesï¼è¯´æéç½®æ­£ç¡®ã\n\n * slave_io_running\n * slave_sql_running\n\nï¼6ï¼å°ä»èç¹è®¾ä¸ºåªè¯»\n\nmysql> set global read_only=1;\nmysql> set global super_read_only=1;\nmysql> show global variables like \"%read_only%\";\n+-----------------------+-------+\n| variable_name         | value |\n+-----------------------+-------+\n| innodb_read_only      | off   |\n| read_only             | on    |\n| super_read_only       | on    |\n| transaction_read_only | off   |\n+-----------------------+-------+\n\n\n> æ³¨ï¼è®¾ç½® slave æå¡å¨ä¸ºåªè¯»ï¼å¹¶ä¸å½±åä¸»ä»åæ­¥ã\n\n\n# æ¢æ¥è¯¢\n\næ¥çæ¢æ¥è¯¢æ¯å¦å¼å¯\n\nshow variables like '%slow_query_log';\n\n\nå¯ä»¥éè¿ set global slow_query_log å½ä»¤è®¾ç½®æ¢æ¥è¯¢æ¯å¦å¼å¯ï¼on è¡¨ç¤ºå¼å¯ï¼off è¡¨ç¤ºå³é­ã\n\nset global slow_query_log='on';\n\n\næ¥çæ¢æ¥è¯¢æ¶é´éå¼\n\nshow variables like '%long_query_time%';\n\n\nè®¾ç½®æ¢æ¥è¯¢éå¼\n\nset global long_query_time = 3;\n\n\n\n# éç¦»çº§å«\n\næ¥çéç¦»çº§å«ï¼\n\nmysql> show variables like 'transaction_isolation';\n \n+-----------------------+----------------+\n \n| variable_name | value |\n \n+-----------------------+----------------+\n \n| transaction_isolation | read-committed |\n \n+-----------------------+----------------+\n\n\n\n# æå¡å¨éç½®\n\n> å¤§é¨åæåµä¸ï¼é»è®¤çåºæ¬éç½®å·²ç»è¶³å¤åºä»å¤§å¤æ°åºæ¯ï¼ä¸è¦è½»æä¿®æ¹ mysql æå¡å¨éç½®ï¼é¤éä½ æç¡®ç¥éä¿®æ¹é¡¹æ¯æççã\n> \n> å°½éä¸è¦ä½¿ç¨ mysql çç¼å­åè½ï¼å ä¸ºå¶è¦æ±æ¯æ¬¡è¯·æ±åæ°å®å¨ç¸åï¼æè½å½ä¸­ç¼å­ãè¿ç§æ¹å¼å®éä¸å¹¶ä¸é«æï¼è¿ä¼å¢å é¢å¤å¼éï¼å®éä¸å¡åºæ¯ä¸­ä¸è¬ä½¿ç¨ redis ç­ key-value å­å¨æ¥è§£å³ç¼å­é®é¢ï¼æ§è½è¿é«äº mysql çæ¥è¯¢ç¼å­ã\n\n\n# éç½®æä»¶è·¯å¾\n\néç½® mysql é¦åè¦ç¡®å®éç½®æä»¶å¨åªå¿ã\n\nä¸å linux æä½ç³»ç»ä¸ï¼mysql éç½®æä»¶è·¯å¾å¯è½ä¸åãéå¸¸çè·¯å¾ä¸º /etc/my.cnf æ /etc/mysql/my.cnf ã\n\nå¦æä¸ç¥ééç½®æä»¶è·¯å¾ï¼å¯ä»¥å°è¯ä»¥ä¸æä½ï¼\n\n# which mysqld\n/usr/sbin/mysqld\n# /usr/sbin/mysqld --verbose --help | grep -a 1 'default options'\ndefault options are read from the following files in the given order:\n/etc/my.cnf /etc/mysql/my.cnf /usr/etc/my.cnf ~/.my.cnf\n\n\n\n# éç½®é¡¹è¯­æ³\n\nmysql éç½®é¡¹è®¾ç½®é½ä½¿ç¨å°åï¼åè¯ä¹é´ç¨ä¸åçº¿ææ¨ªçº¿éå¼ï¼äºèæ¯ç­ä»·çï¼ã\n\nå»ºè®®ä½¿ç¨åºå®çé£æ ¼ï¼è¿æ ·æ£ç´¢éç½®é¡¹æ¶è¾ä¸ºæ¹ä¾¿ã\n\n# è¿ä¸¤ç§æ ¼å¼ç­ä»·\n/usr/sbin/mysqld --auto-increment-offset=5\n/usr/sbin/mysqld --auto_increment_offset=5\n\n\n\n# å¸¸ç¨éç½®é¡¹è¯´æ\n\n> è¿éä»ç»æ¯è¾å¸¸ç¨çåºæ¬éç½®ï¼æ´å¤éç½®é¡¹è¯´æå¯ä»¥åèï¼mysql æå¡å¨éç½®è¯´æ\n\nåç»åºä¸ä»½å¸¸ç¨éç½®æ¨¡æ¿ï¼åå®¹å¦ä¸ï¼\n\n[mysqld]\n# general\n# -------------------------------------------------------------------------------\ndatadir = /var/lib/mysql\nsocket  = /var/lib/mysql/mysql.sock\npid_file = /var/lib/mysql/mysql.pid\nuser = mysql\nport = 3306\ndefault_storage_engine = innodb\ndefault_time_zone = '+8:00'\ncharacter_set_server = utf8mb4\ncollation_server = utf8mb4_0900_ai_ci\n\n# log\n# -------------------------------------------------------------------------------\nlog_error = /var/log/mysql/mysql-error.log\nslow_query_log = 1\nslow_query_log_file = /var/log/mysql/mysql-slow.log\n\n# innodb\n# -------------------------------------------------------------------------------\ninnodb_buffer_pool_size = <value>\ninnodb_log_file_size = <value>\ninnodb_file_per_table = 1\ninnodb_flush_method = o_direct\n\n# myisam\n# -------------------------------------------------------------------------------\nkey_buffer_size = <value>\n\n# other\n# -------------------------------------------------------------------------------\ntmp_table_size = 32m\nmax_heap_table_size = 32m\nquery_cache_type = 0\nquery_cache_size = 0\nmax_connections = <value>\nthread_cache = <value>\nopen_files_limit = 65535\n\n[client]\nsocket  = /var/lib/mysql/mysql.sock\nport = 3306\n\n\n * general\n   \n   * datadir - mysql æ°æ®æä»¶æå¨ç®å½\n   * socket - scoket æä»¶\n   * pid_file - pid æä»¶\n   * user - å¯å¨ mysql æå¡è¿ç¨çç¨æ·\n   * port - æå¡ç«¯å£å·ï¼é»è®¤ 3306\n   * default_storage_engine - mysql 5.1 ä¹åï¼é»è®¤å¼ææ¯ innodb\n   * default_time_zone - é»è®¤æ¶åºãä¸­å½å¤§é¨åå°åºå¨ä¸å«åºï¼å³ +8:00\n   * character_set_server - æ°æ®åºé»è®¤å­ç¬¦é\n   * collation_server - æ°æ®åºå­ç¬¦éå¯¹åºä¸äºæåºç­è§åï¼æ³¨æè¦å character_set_server å¯¹åº\n\n * log\n   \n   * log_error - éè¯¯æ¥å¿æä»¶å°å\n   * slow_query_log - éè¯¯æ¥å¿æä»¶å°å\n\n * innodb\n   \n   * innodb_buffer_pool_size - innodb ä½¿ç¨ä¸ä¸ªç¼å²æ± æ¥ä¿å­ç´¢å¼ååå§æ°æ®ï¼ä¸å myisamãè¿éä½ è®¾ç½®è¶å¤§ï¼ä½ å¨å­åè¡¨éé¢æ°æ®æ¶æéè¦çç£ç i/o è¶å°ã\n     * å¨ä¸ä¸ªç¬ç«ä½¿ç¨çæ°æ®åºæå¡å¨ä¸,ä½ å¯ä»¥è®¾ç½®è¿ä¸ªåéå°æå¡å¨ç©çåå­å¤§å°ç 60%-80%\n     * æ³¨æå«è®¾ç½®çè¿å¤§ï¼ä¼å¯¼è´ system ç swap ç©ºé´è¢«å ç¨ï¼å¯¼è´æä½ç³»ç»åæ¢ï¼ä»èåä½ sql æ¥è¯¢çæç\n     * é»è®¤å¼ï¼128mï¼å»ºè®®å¼ï¼ç©çåå­ç 60%-80%\n   * innodb_log_file_size - æ¥å¿æä»¶çå¤§å°ãé»è®¤å¼ï¼48mï¼å»ºè®®å¼ï¼æ ¹æ®ä½ ç³»ç»çç£çç©ºé´åæ¥å¿å¢é¿æåµè°æ´å¤§å°\n   * innodb_file_per_table - è¯´æï¼mysql5.7 ä¹åé»è®¤å¼å¯ï¼æææ¯ï¼æ¯å¼ è¡¨ä¸ä¸ªç¬ç«è¡¨ç©ºé´ãé»è®¤å¼ 1ï¼å¼å¯ã\n   * innodb_flush_method - è¯´æï¼æ§å¶ç innodb æ°æ®æä»¶å redo log çæå¼ãå·åæ¨¡å¼ï¼ä¸ç§æ¨¡å¼ï¼fdatasync(é»è®¤)ï¼o_dsyncï¼o_directãé»è®¤å¼ä¸ºç©ºï¼å»ºè®®å¼ï¼ä½¿ç¨ san æè raidï¼å»ºè®®ç¨ o_directï¼ä¸ææµè¯çè¯ï¼é»è®¤çäº§ä¸ä½¿ç¨ o_direct\n     * fdatasyncï¼æ°æ®æä»¶ï¼buffer pool->os buffer->ç£çï¼æ¥å¿æä»¶ï¼buffer pool->os buffer->ç£çï¼\n     * o_dsyncï¼ æ°æ®æä»¶ï¼buffer pool->os buffer->ç£çï¼æ¥å¿æä»¶ï¼buffer pool->ç£çï¼\n     * o_directï¼ æ°æ®æä»¶ï¼buffer pool->ç£çï¼ æ¥å¿æä»¶ï¼buffer pool->os buffer->ç£çï¼\n\n * myisam\n   \n   * key_buffer_size - æå®ç´¢å¼ç¼å²åºçå¤§å°ï¼ä¸º myisam æ°æ®è¡¨å¼å¯ä¾çº¿ç¨å±äº«çç´¢å¼ç¼å­ï¼å¯¹ innodb å¼ææ æãç¸å½å½±å myisam çæ§è½ã\n     * ä¸è¦å°å¶è®¾ç½®å¤§äºä½ å¯ç¨åå­ç 30%ï¼å ä¸ºä¸é¨ååå­åæ ·è¢« os ç¨æ¥ç¼å²è¡æ°æ®\n     * çè³å¨ä½ å¹¶ä¸ä½¿ç¨ myisam è¡¨çæåµä¸ï¼ä½ ä¹éè¦ä»æ§è®¾ç½®èµ· 8-64m åå­ç±äºå®åæ ·ä¼è¢«åé¨ä¸´æ¶ç£çè¡¨ä½¿ç¨ã\n     * é»è®¤å¼ 8mï¼å»ºè®®å¼ï¼å¯¹äºåå­å¨ 4gb å·¦å³çæå¡å¨è¯¥åæ°å¯è®¾ç½®ä¸º 256m æ 384mã\n     * æ³¨æï¼è¯¥åæ°å¼è®¾ç½®çè¿å¤§åèä¼æ¯æå¡å¨æ´ä½æçéä½ï¼\n\n * other\n   \n   * tmp_table_size - åå­ä¸´æ¶è¡¨çæå¤§å¼ï¼é»è®¤ 16mï¼æ­¤å¤è®¾ç½®æ 128m\n   * max_heap_table_size - ç¨æ·åå»ºçåå­è¡¨çå¤§å°ï¼é»è®¤ 16mï¼å¾å¾å tmp_table_size ä¸èµ·è®¾ç½®ï¼éå¶ç¨æ·ä¸´æ¶è¡¨å¤§å°ãè¶éçè¯ï¼mysql å°±ä¼èªå¨å°æå®è½¬åä¸ºåºäºç£çç myisam è¡¨ï¼å­å¨å¨æå®ç tmpdir ç®å½ä¸ï¼å¢å¤§ io ååï¼å»ºè®®åå­å¤§ï¼å¢å¤§è¯¥æ°å¼ã\n   * query_cache_type - è¿ä¸ªç³»ç»åéæ§å¶çæ¥è¯¢ç¼å­åè½çå¼å¯åå³é­ï¼0 è¡¨ç¤ºå³é­ï¼1 è¡¨ç¤ºæå¼ï¼2 è¡¨ç¤ºåªè¦ select ä¸­æç¡®æå® sql_cache æç¼å­ã\n   * query_cache_size - é»è®¤å¼ 1mï¼ä¼ç¹æ¯æ¥è¯¢ç¼å­å¯ä»¥æå¤§çæé«æå¡å¨éåº¦ï¼å¦æä½ æå¤§éçç¸åçæ¥è¯¢å¹¶ä¸å¾å°ä¿®æ¹è¡¨ãç¼ºç¹ï¼å¨ä½ è¡¨ç»å¸¸ååçæåµä¸æèå¦æä½ çæ¥è¯¢åææ¯æ¬¡é½ä¸åï¼æ¥è¯¢ç¼å­ä¹è®¸å¼èµ·æ§è½ä¸éèä¸æ¯æ§è½æåã\n   * max_connections - æå¤§è¿æ¥æ°ï¼å¯è®¾æå¤§å¼ 16384ï¼ä¸è¬èèæ ¹æ®åæ¶å¨çº¿äººæ°è®¾ç½®ä¸ä¸ªæ¯è¾ç»¼åçæ°å­ï¼é´äºè¯¥æ°å¼å¢å¤§å¹¶ä¸å¤ªæ¶èç³»ç»èµæºï¼å»ºè®®ç´æ¥è®¾ 10000ãå¦æå¨è®¿é®æ¶ç»å¸¸åºç° too many connections çéè¯¯æç¤ºï¼åéè¦å¢å¤§è¯¥åæ°å¼\n   * thread_cache - å½å®¢æ·ç«¯æ­å¼ä¹åï¼æå¡å¨å¤çæ­¤å®¢æ·ççº¿ç¨å°ä¼ç¼å­èµ·æ¥ä»¥ååºä¸ä¸ä¸ªå®¢æ·èä¸æ¯éæ¯ãå¯éç¨ï¼åå°äºç³»ç»å¼éãé»è®¤å¼ä¸º 9ï¼å»ºè®®å¼ï¼ä¸¤ç§åå¼æ¹å¼ï¼\n     * æ¹å¼ä¸ï¼æ ¹æ®ç©çåå­ï¼1g â> 8ï¼2g â> 16ï¼ 3g â> 32ï¼ >3g â> 64ï¼\n     * æ¹å¼äºï¼æ ¹æ® show status like 'threads%'ï¼æ¥ç threads_connected å¼ã\n   * open_files_limit - mysql æå¼çæä»¶æè¿°ç¬¦éå¶ï¼é»è®¤æå° 1024;\n     * å½ open_files_limit æ²¡æè¢«éç½®çæ¶åï¼æ¯è¾ max_connections*5 å ulimit -n çå¼ï¼åªä¸ªå¤§ç¨åªä¸ªï¼\n     * å½ open_file_limit è¢«éç½®çæ¶åï¼æ¯è¾ open_files_limit å max_connections*5 çå¼ï¼åªä¸ªå¤§ç¨åªä¸ª\n     * æ³¨æï¼ä»ç¶å¯è½åºç°æ¥éä¿¡æ¯ can't create a new threadï¼æ­¤æ¶è§å¯ç³»ç» cat /proc/mysql è¿ç¨å·/limitsï¼è§å¯è¿ç¨ ulimit éå¶æåµ\n     * è¿å°çè¯ï¼èèä¿®æ¹ç³»ç»éç½®è¡¨ï¼/etc/security/limits.conf å /etc/security/limits.d/90-nproc.conf\n\n\n# å¸¸è§é®é¢\n\n\n# too many connections\n\nç°è±¡\n\nå°è¯è¿æ¥ mysql æ¶ï¼éå° too many connections éè¯¯ã\n\nåå \n\næ°æ®åºè¿æ¥çº¿ç¨æ°è¶è¿æå¤§å¼ï¼è®¿é®è¢«æç»ã\n\nè§£å³æ¹æ¡\n\nå¦æå®éè¿æ¥çº¿ç¨æ°è¿å¤§ï¼å¯ä»¥èèå¢å æå¡å¨èç¹æ¥åæµï¼å¦æå®éçº¿ç¨æ°å¹¶ä¸ç®è¿å¤§ï¼é£ä¹å¯ä»¥éç½® max_connections æ¥å¢å åè®¸çæå¤§è¿æ¥æ°ãéè¦æ³¨æçæ¯ï¼è¿æ¥æ°ä¸å®è¿å¤§ï¼ä¸è¬æ¥è¯´ï¼ååºæ¯ç§æ 2000 ä¸ªå¹¶åè¿æ¥æ¶ï¼å°±å¯ä»¥èèæ©å®¹äºï¼å¥åº·çç¶æåºè¯¥ç»´æå¨æ¯ç§ 1000 ä¸ªå¹¶åè¿æ¥å·¦å³ã\n\nï¼1ï¼æ¥çæå¤§è¿æ¥æ°\n\nmysql> show variables like '%max_connections%';\n+------------------------+-------+\n| variable_name          | value |\n+------------------------+-------+\n| max_connections        | 151   |\n| mysqlx_max_connections | 100   |\n+------------------------+-------+\n\n\nï¼2ï¼æ¥çæå¡å¨ååºçæå¤§è¿æ¥æ°\n\nmysql> show global status like 'max_used_connections';\n+----------------------+-------+\n| variable_name        | value |\n+----------------------+-------+\n| max_used_connections | 142   |\n+----------------------+-------+\n1 row in set (0.00 sec)\n\n\nï¼3ï¼ä¸´æ¶è®¾ç½®æå¤§è¿æ¥æ°\n\nset global max_connections=256;\n\n\næ³¨æï¼å½æå¡å¨éå¯æ¶ï¼æå¤§è¿æ¥æ°ä¼è¢«éç½®ã\n\nï¼4ï¼æ°¸ä¹è®¾ç½®æå¤§è¿æ¥æ°\n\nä¿®æ¹ /etc/my.cnf éç½®æä»¶ï¼å¨ [mysqld] æ·»å ä»¥ä¸éç½®ï¼\n\nmax_connections=256\n\n\néå¯ mysql ä»¥çæ\n\nï¼5ï¼ä¿®æ¹ linux æå¤§æä»¶æ°éå¶\n\nè®¾ç½®äºæå¤§è¿æ¥æ°ï¼å¦æè¿æ¯æ²¡æçæï¼èèæ£æ¥ä¸ä¸ linux æå¤§æä»¶æ°\n\nmysql æå¤§è¿æ¥æ°ä¼åå°æå¤§æä»¶æ°éå¶ï¼vim /etc/security/limits.confï¼æ·»å  mysql ç¨æ·éç½®\n\nmysql hard nofile 65535\nmysql soft nofile 65535\n\n\nï¼6ï¼æ£æ¥ limitnofile\n\nå¦ææ¯ä½¿ç¨ rpm æ¹å¼å®è£ mysqlï¼æ£æ¥ mysqld.service æä»¶ä¸­ç limitnofile æ¯å¦éç½®çå¤ªå°ã\n\n\n# æ¶åºï¼time_zoneï¼åå·®\n\nç°è±¡\n\næ°æ®åºä¸­å­å¨ç timestamp å­æ®µå¼æ¯çå®å¼å°äº 13 ä¸ªå°æ¶ã\n\nåå \n\n * å½ jdbc ä¸ mysql å¼å§å»ºç«è¿æ¥æ¶ï¼ä¼è·åæå¡å¨åæ°ã\n * å½ mysql ç time_zone å¼ä¸º system æ¶ï¼ä¼å system_time_zone å¼ä½ä¸ºåè°æ¶åºï¼è¥å¾å°çæ¯ cst é£ä¹ java ä¼è¯¯ä»¥ä¸ºè¿æ¯ cst -0500 ï¼å æ­¤ä¼ç»åºéè¯¯çæ¶åºä¿¡æ¯ï¼å½åä¸è¬æ¯cst +0800ï¼å³ä¸å«åºï¼ã\n\næ¥çæ¶åºæ¹æ³ï¼\n\néè¿ show variables like '%time_zone%'; å½ä»¤æ¥ç mysql æ¶åºéç½®ï¼\n\nmysql> show variables like '%time_zone%';\n+------------------+--------+\n| variable_name    | value  |\n+------------------+--------+\n| system_time_zone | cst    |\n| time_zone        | system |\n+------------------+--------+\n\n\nè§£å³æ¹æ¡\n\næ¹æ¡ä¸\n\nmysql> set global time_zone = '+08:00';\nquery ok, 0 rows affected (0.00 sec)\n\nmysql> set time_zone = '+08:00';\nquery ok, 0 rows affected (0.00 sec)\n\n\næ¹æ¡äº\n\nä¿®æ¹ my.cnf æä»¶ï¼å¨ [mysqld] èä¸å¢å  default-time-zone='+08:00' ï¼ç¶åéå¯ã\n\n\n# æ°æ®è¡¨æåå¦ä½ä¿®å¤\n\nä½¿ç¨ myisamchk æ¥ä¿®å¤ï¼å·ä½æ­¥éª¤ï¼\n\n 1. ä¿®å¤åå° mysql æå¡åæ­¢ã\n 2. æå¼å½ä»¤è¡æ¹å¼ï¼ç¶åè¿å¥å° mysql ç bin ç®å½ã\n 3. æ§è¡ myisamchk ârecover æ°æ®åºæå¨è·¯ /*.myi\n\nä½¿ç¨ repair table æè optimize table å½ä»¤æ¥ä¿®å¤ï¼repair table table_name ä¿®å¤è¡¨ optimize table table_name ä¼åè¡¨ repair table ç¨äºä¿®å¤è¢«ç ´åçè¡¨ã optimize table ç¨äºåæ¶é²ç½®çæ°æ®åºç©ºé´ï¼å½è¡¨ä¸çæ°æ®è¡è¢«å é¤æ¶ï¼æå æ®çç£çç©ºé´å¹¶æ²¡æç«å³è¢«åæ¶ï¼ä½¿ç¨äº optimize table å½ä»¤åè¿äºç©ºé´å°è¢«åæ¶ï¼å¹¶ä¸å¯¹ç£çä¸çæ°æ®è¡è¿è¡éæï¼æ³¨æï¼æ¯ç£çä¸ï¼èéæ°æ®åºï¼\n\n\n# æ°æ®ç»æ\n\n> é®é¢ç°è±¡ï¼error 1071: specified key was too long; max key length is 767 bytes\n\né®é¢åå ï¼mysql é»è®¤æåµä¸åä¸ªåçç´¢å¼ä¸è½è¶è¿ 767 ä½ï¼ä¸åçæ¬å¯è½å­å¨å·®å¼ï¼ ã\n\nè§£å³æ¹æ³ï¼ä¼åç´¢å¼ç»æï¼ç´¢å¼å­æ®µä¸å®è¿é¿ã\n\n\n# èæ¬\n\nè¿éæ¨èæåçå ä¸ªä¸é®è¿ç»´èæ¬ï¼éå¸¸æ¹ä¾¿ï¼æ¬¢è¿ä½¿ç¨ï¼\n\n * mysql å®è£èæ¬\n * mysql å¤ä»½èæ¬\n\n\n# åèèµæ\n\n * ãé«æ§è½ mysqlã\n * https://www.cnblogs.com/xiaopotian/p/8196464.html\n * https://www.cnblogs.com/bigbrotherer/p/7241845.html\n * https://blog.csdn.net/managementandjava/article/details/80039650\n * http://www.manongjc.com/article/6996.html\n * https://www.cnblogs.com/xyabk/p/8967990.html\n * mysql 8.0 ä¸»ä»ï¼master-slaveï¼éç½®\n * mysql ä¸»ä»åæ­¥å®æ\n * mysql å¤ä»½åæ¢å¤æºå¶",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Mysql å¸¸è§é®é¢",frontmatter:{title:"Mysql å¸¸è§é®é¢",date:"2020-09-12T10:43:53.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql","FAQ"],permalink:"/pages/7b0caf/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/02.Mysql/99.Mysql%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98.html",relativePath:"12.æ°æ®åº/03.å³ç³»åæ°æ®åº/02.Mysql/99.Mysqlå¸¸è§é®é¢.md",key:"v-4954d596",path:"/pages/7b0caf/",headers:[{level:2,title:"ä¸ºä»ä¹è¡¨æ°æ®å æä¸åï¼è¡¨æä»¶å¤§å°ä¸å",slug:"ä¸ºä»ä¹è¡¨æ°æ®å æä¸å-è¡¨æä»¶å¤§å°ä¸å",normalizedTitle:"ä¸ºä»ä¹è¡¨æ°æ®å æä¸åï¼è¡¨æä»¶å¤§å°ä¸å",charIndex:48},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:744}],headersStr:"ä¸ºä»ä¹è¡¨æ°æ®å æä¸åï¼è¡¨æä»¶å¤§å°ä¸å åèèµæ",content:"# Mysql å¸¸è§é®é¢\n\n> ð¦ æ¬æä»¥åç¤ºä¾æºç å·²å½æ¡£å¨ db-tutorial\n\n\n# ä¸ºä»ä¹è¡¨æ°æ®å æä¸åï¼è¡¨æä»¶å¤§å°ä¸å\n\nãé®é¢ãæ°æ®åºå ç¨ç©ºé´å¤ªå¤§ï¼ææä¸ä¸ªæå¤§çè¡¨å æäºä¸åçæ°æ®ï¼æä¹è¡¨æä»¶çå¤§å°è¿æ¯æ²¡åï¼\n\nè¡¨æ°æ®æ¢å¯ä»¥å­å¨å±äº«è¡¨ç©ºé´éï¼ä¹å¯ä»¥æ¯åç¬çæä»¶ãè¿ä¸ªè¡ä¸ºæ¯ç±åæ° innodb_file_per_table æ§å¶çï¼\n\n 1. è¿ä¸ªåæ°è®¾ç½®ä¸º OFF è¡¨ç¤ºçæ¯ï¼è¡¨çæ°æ®æ¾å¨ç³»ç»å±äº«è¡¨ç©ºé´ï¼ä¹å°±æ¯è·æ°æ®å­å¸æ¾å¨ä¸èµ·ï¼\n 2. è¿ä¸ªåæ°è®¾ç½®ä¸º ON è¡¨ç¤ºçæ¯ï¼æ¯ä¸ª InnoDB è¡¨æ°æ®å­å¨å¨ä¸ä¸ªä»¥ .ibd ä¸ºåç¼çæä»¶ä¸­ã\n\nä» MySQL 5.6.6 çæ¬å¼å§ï¼å®çé»è®¤å¼å°±æ¯ ON äºã\n\næå»ºè®®ä½ ä¸è®ºä½¿ç¨ MySQL çåªä¸ªçæ¬ï¼é½å°è¿ä¸ªå¼è®¾ç½®ä¸º ONãå ä¸ºï¼ä¸ä¸ªè¡¨åç¬å­å¨ä¸ºä¸ä¸ªæä»¶æ´å®¹æç®¡çï¼èä¸å¨ä½ ä¸éè¦è¿ä¸ªè¡¨çæ¶åï¼éè¿ drop table å½ä»¤ï¼ç³»ç»å°±ä¼ç´æ¥å é¤è¿ä¸ªæä»¶ãèå¦ææ¯æ¾å¨å±äº«è¡¨ç©ºé´ä¸­ï¼å³ä½¿è¡¨å æäºï¼ç©ºé´ä¹æ¯ä¸ä¼åæ¶çã\n\næä»¥ï¼å° innodb_file_per_table è®¾ç½®ä¸º ONï¼æ¯æ¨èåæ³ï¼æä»¬æ¥ä¸æ¥çè®¨è®ºé½æ¯åºäºè¿ä¸ªè®¾ç½®å±å¼çã\n\næä»¬å¨å é¤æ´ä¸ªè¡¨çæ¶åï¼å¯ä»¥ä½¿ç¨ drop table å½ä»¤åæ¶è¡¨ç©ºé´ãä½æ¯ï¼æä»¬éå°çæ´å¤çå é¤æ°æ®çåºæ¯æ¯å é¤æäºè¡ï¼è¿æ¶å°±éå°äºæä»¬æç« å¼å¤´çé®é¢ï¼è¡¨ä¸­çæ°æ®è¢«å é¤äºï¼ä½æ¯è¡¨ç©ºé´å´æ²¡æè¢«åæ¶ã\n\næå¥åå é¤æä½å¯è½ä¼é æç©ºæ´ã\n\n * æå¥æ¶ï¼å¦ææå¥ä½ç½®æå¨é¡µå·²æ»¡ï¼éè¦ç³è¯·æ°é¡µé¢ã\n * å é¤æ¶ï¼ä¸ä¼å é¤æå¨é¡µï¼èæ¯å°è®°å½å¨é¡µé¢çä½ç½®æ è®°ä¸ºå¯éç¨ã\n\næä»¥ï¼å¦æè½å¤æè¿äºç©ºæ´å»æï¼å°±è½è¾¾å°æ¶ç¼©è¡¨ç©ºé´çç®çã\n\nè¦è¾¾å°æ¶ç¼©ç©ºæ´çç®çï¼å¯ä»¥ä½¿ç¨éå»ºè¡¨çæ¹å¼ã\n\n\n# åèèµæ\n\n * ãé«æ§è½ MySQLã\n * MySQL å®æ 45 è®²",normalizedContent:"# mysql å¸¸è§é®é¢\n\n> ð¦ æ¬æä»¥åç¤ºä¾æºç å·²å½æ¡£å¨ db-tutorial\n\n\n# ä¸ºä»ä¹è¡¨æ°æ®å æä¸åï¼è¡¨æä»¶å¤§å°ä¸å\n\nãé®é¢ãæ°æ®åºå ç¨ç©ºé´å¤ªå¤§ï¼ææä¸ä¸ªæå¤§çè¡¨å æäºä¸åçæ°æ®ï¼æä¹è¡¨æä»¶çå¤§å°è¿æ¯æ²¡åï¼\n\nè¡¨æ°æ®æ¢å¯ä»¥å­å¨å±äº«è¡¨ç©ºé´éï¼ä¹å¯ä»¥æ¯åç¬çæä»¶ãè¿ä¸ªè¡ä¸ºæ¯ç±åæ° innodb_file_per_table æ§å¶çï¼\n\n 1. è¿ä¸ªåæ°è®¾ç½®ä¸º off è¡¨ç¤ºçæ¯ï¼è¡¨çæ°æ®æ¾å¨ç³»ç»å±äº«è¡¨ç©ºé´ï¼ä¹å°±æ¯è·æ°æ®å­å¸æ¾å¨ä¸èµ·ï¼\n 2. è¿ä¸ªåæ°è®¾ç½®ä¸º on è¡¨ç¤ºçæ¯ï¼æ¯ä¸ª innodb è¡¨æ°æ®å­å¨å¨ä¸ä¸ªä»¥ .ibd ä¸ºåç¼çæä»¶ä¸­ã\n\nä» mysql 5.6.6 çæ¬å¼å§ï¼å®çé»è®¤å¼å°±æ¯ on äºã\n\næå»ºè®®ä½ ä¸è®ºä½¿ç¨ mysql çåªä¸ªçæ¬ï¼é½å°è¿ä¸ªå¼è®¾ç½®ä¸º onãå ä¸ºï¼ä¸ä¸ªè¡¨åç¬å­å¨ä¸ºä¸ä¸ªæä»¶æ´å®¹æç®¡çï¼èä¸å¨ä½ ä¸éè¦è¿ä¸ªè¡¨çæ¶åï¼éè¿ drop table å½ä»¤ï¼ç³»ç»å°±ä¼ç´æ¥å é¤è¿ä¸ªæä»¶ãèå¦ææ¯æ¾å¨å±äº«è¡¨ç©ºé´ä¸­ï¼å³ä½¿è¡¨å æäºï¼ç©ºé´ä¹æ¯ä¸ä¼åæ¶çã\n\næä»¥ï¼å° innodb_file_per_table è®¾ç½®ä¸º onï¼æ¯æ¨èåæ³ï¼æä»¬æ¥ä¸æ¥çè®¨è®ºé½æ¯åºäºè¿ä¸ªè®¾ç½®å±å¼çã\n\næä»¬å¨å é¤æ´ä¸ªè¡¨çæ¶åï¼å¯ä»¥ä½¿ç¨ drop table å½ä»¤åæ¶è¡¨ç©ºé´ãä½æ¯ï¼æä»¬éå°çæ´å¤çå é¤æ°æ®çåºæ¯æ¯å é¤æäºè¡ï¼è¿æ¶å°±éå°äºæä»¬æç« å¼å¤´çé®é¢ï¼è¡¨ä¸­çæ°æ®è¢«å é¤äºï¼ä½æ¯è¡¨ç©ºé´å´æ²¡æè¢«åæ¶ã\n\næå¥åå é¤æä½å¯è½ä¼é æç©ºæ´ã\n\n * æå¥æ¶ï¼å¦ææå¥ä½ç½®æå¨é¡µå·²æ»¡ï¼éè¦ç³è¯·æ°é¡µé¢ã\n * å é¤æ¶ï¼ä¸ä¼å é¤æå¨é¡µï¼èæ¯å°è®°å½å¨é¡µé¢çä½ç½®æ è®°ä¸ºå¯éç¨ã\n\næä»¥ï¼å¦æè½å¤æè¿äºç©ºæ´å»æï¼å°±è½è¾¾å°æ¶ç¼©è¡¨ç©ºé´çç®çã\n\nè¦è¾¾å°æ¶ç¼©ç©ºæ´çç®çï¼å¯ä»¥ä½¿ç¨éå»ºè¡¨çæ¹å¼ã\n\n\n# åèèµæ\n\n * ãé«æ§è½ mysqlã\n * mysql å®æ 45 è®²",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Mysql éç½®",frontmatter:{title:"Mysql éç½®",date:"2020-02-29T22:32:57.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql","éç½®"],permalink:"/pages/5da42d/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/02.Mysql/21.Mysql%E9%85%8D%E7%BD%AE.html",relativePath:"12.æ°æ®åº/03.å³ç³»åæ°æ®åº/02.Mysql/21.Mysqléç½®.md",key:"v-076936e6",path:"/pages/5da42d/",headers:[{level:2,title:"åºæ¬éç½®",slug:"åºæ¬éç½®",normalizedTitle:"åºæ¬éç½®",charIndex:22},{level:2,title:"éç½®é¡¹è¯´æ",slug:"éç½®é¡¹è¯´æ",normalizedTitle:"éç½®é¡¹è¯´æ",charIndex:1167},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:13209}],headersStr:"åºæ¬éç½® éç½®é¡¹è¯´æ åèèµæ",content:"# Mysql éç½®\n\n> çæ¬ï¼\n\n\n# åºæ¬éç½®\n\n[mysqld]\n# GENERAL\n# -------------------------------------------------------------------------------\ndatadir = /var/lib/mysql\nsocket  = /var/lib/mysql/mysql.sock\npid_file = /var/lib/mysql/mysql.pid\nuser = mysql\nport = 3306\ndefault_storage_engine = InnoDB\ndefault_time_zone = '+8ï¼00'\ncharacter_set_server = utf8mb4\ncollation_server = utf8mb4_0900_ai_ci\n\n# LOG\n# -------------------------------------------------------------------------------\nlog_error = /var/log/mysql/mysql-error.log\nslow_query_log = 1\nslow_query_log_file = /var/log/mysql/mysql-slow.log\n\n# InnoDB\n# -------------------------------------------------------------------------------\ninnodb_buffer_pool_size = <value>\ninnodb_log_file_size = <value>\ninnodb_file_per_table = 1\ninnodb_flush_method = O_DIRECT\n\n# MyIsam\n# -------------------------------------------------------------------------------\nkey_buffer_size = <value>\n\n# OTHER\n# -------------------------------------------------------------------------------\ntmp_table_size = 32M\nmax_heap_table_size = 32M\nmax_connections = <value>\nopen_files_limit = 65535\n\n[client]\nsocket  = /var/lib/mysql/mysql.sock\nport = 3306\n\n\n\n# éç½®é¡¹è¯´æ\n\n[client]\n# æå¡ç«¯å£å·ï¼é»è®¤ 3306\nport = 3306\n\n# socket æä»¶\nsocket = /var/lib/mysql/mysql.sock\n\n\n\n[mysqld]\n\n# GENERAL\n# -------------------------------------------------------------------------------\n\n# socket æä»¶\nsocket = /var/lib/mysql/mysql.sock\n\n# PID æä»¶\npid_file = /var/lib/mysql/mysql.pid\n\n# å¯å¨ mysql æå¡è¿ç¨çç¨æ·\nuser = mysql\n\n# æå¡ç«¯å£å·ï¼é»è®¤ 3306\nport = 3306\n\n# é»è®¤æ¶åº\ndefault_time_zone = '+8ï¼00'\n\n# Mysql æå¡ IDï¼åç¹æå¡æ¶æ²¡å¿è¦è®¾ç½®\nserver-id = 1\n\n# äºå¡éç¦»çº§å«ï¼é»è®¤ä¸ºå¯éå¤è¯»ï¼REPEATABLE-READï¼ãï¼æ­¤çº§å«ä¸å¯è½åæ°å¾å¤é´ééï¼å½±åæ§è½ï¼ä½æ¯ä¿®æ¹åå½±åä¸»ä»å¤å¶åç¾é¾æ¢å¤ï¼å»ºè®®è¿æ¯ä¿®æ¹ä»£ç é»è¾å§ï¼\n# éç¦»çº§å«å¯éé¡¹ç®ï¼READ-UNCOMMITTED READ-COMMITTED REPEATABLE-READ SERIALIZABLE\ntransaction_isolation = REPEATABLE-READ\n\n# ç®å½éç½®\n# -------------------------------------------------------------------------------\n\n# mysql å®è£æ ¹ç®å½\nbasedir = /usr/local/mysql-5.7.21\n\n# mysql æ°æ®æä»¶æå¨ç®å½\ndatadir = /var/lib/mysql\n\n# ä¸´æ¶ç®å½ æ¯å¦ load data infile ä¼ç¨å°ï¼ä¸è¬é½æ¯ä½¿ç¨/tmp\ntmpdir = /tmp\n\n# æ°æ®åºå¼æéç½®\n# -------------------------------------------------------------------------------\n\n# mysql 5.1 ä¹åï¼é»è®¤å¼ææ¯ InnoDB\ndefault_storage_engine = InnoDB\n\n# åå­ä¸´æ¶è¡¨é»è®¤å¼æï¼é»è®¤ InnoDB\ndefault_tmp_storage_engine = InnoDB\n\n# mysql 5.7 æ°å¢ç¹æ§ï¼ç£çä¸´æ¶è¡¨é»è®¤å¼æï¼é»è®¤ InnoDB\ninternal_tmp_disk_storage_engine = InnoDB\n\n# å­ç¬¦ééç½®\n# -------------------------------------------------------------------------------\n\n# æ°æ®åºé»è®¤å­ç¬¦éï¼ä¸»æµå­ç¬¦éæ¯æä¸äºç¹æ®è¡¨æç¬¦å·ï¼ç¹æ®è¡¨æç¬¦å ç¨ 4 ä¸ªå­èï¼\ncharacter_set_server = utf8mb4\n\n# æ°æ®åºå­ç¬¦éå¯¹åºä¸äºæåºç­è§åï¼æ³¨æè¦å character_set_server å¯¹åº\ncollation-server = utf8mb4_0900_ai_ci\n\n# è®¾ç½® client è¿æ¥ mysql æ¶çå­ç¬¦éï¼é²æ­¢ä¹±ç \n# init_connect='SET NAMES utf8'\n\n# æ¯å¦å¯¹ sql è¯­å¥å¤§å°åææï¼é»è®¤å¼ä¸º 0ï¼1 è¡¨ç¤ºä¸ææ\nlower_case_table_names = 1\n\n# æ°æ®åºè¿æ¥éç½®\n# -------------------------------------------------------------------------------\n\n# æå¤§è¿æ¥æ°ï¼å¯è®¾æå¤§å¼ 16384ï¼ä¸è¬èèæ ¹æ®åæ¶å¨çº¿äººæ°è®¾ç½®ä¸ä¸ªæ¯è¾ç»¼åçæ°å­ï¼é´äºè¯¥æ°å¼å¢å¤§å¹¶ä¸å¤ªæ¶èç³»ç»èµæºï¼å»ºè®®ç´æ¥è®¾ 10000\n# å¦æå¨è®¿é®æ¶ç»å¸¸åºç° Too Many Connections çéè¯¯æç¤ºï¼åéè¦å¢å¤§è¯¥åæ°å¼\nmax_connections = 10000\n\n# é»è®¤å¼ 100ï¼æå¤§éè¯¯è¿æ¥æ°ï¼å¦ææè¶åºè¯¥åæ°å¼ä¸ªæ°çä¸­æ­éè¯¯è¿æ¥ï¼åè¯¥ä¸»æºå°è¢«ç¦æ­¢è¿æ¥ãå¦éå¯¹è¯¥ä¸»æºè¿è¡è§£ç¦ï¼æ§è¡ï¼FLUSH HOST\n# èèé«å¹¶ååºæ¯ä¸çå®¹éï¼å»ºè®®å å¤§ã\nmax_connect_errors = 10000\n\n# MySQL æå¼çæä»¶æè¿°ç¬¦éå¶ï¼é»è®¤æå° 1024;\n# å½ open_files_limit æ²¡æè¢«éç½®çæ¶åï¼æ¯è¾ max_connections\\*5 å ulimit -n çå¼ï¼åªä¸ªå¤§ç¨åªä¸ªï¼\n# å½ open_file_limit è¢«éç½®çæ¶åï¼æ¯è¾ open_files_limit å max_connections\\*5 çå¼ï¼åªä¸ªå¤§ç¨åªä¸ªã\n# æ³¨æï¼ä»ç¶å¯è½åºç°æ¥éä¿¡æ¯ Can't create a new threadï¼æ­¤æ¶è§å¯ç³»ç» cat /proc/mysql è¿ç¨å·/limitsï¼è§å¯è¿ç¨ ulimit éå¶æåµ\n# è¿å°çè¯ï¼èèä¿®æ¹ç³»ç»éç½®è¡¨ï¼/etc/security/limits.conf å /etc/security/limits.d/90-nproc.conf\nopen_files_limit = 65535\n\n# è¶æ¶éç½®\n# -------------------------------------------------------------------------------\n\n# MySQL é»è®¤ç wait_timeout å¼ä¸º 8 ä¸ªå°æ¶ï¼interactive_timeout åæ°éè¦åæ¶éç½®æè½çæ\n# MySQL è¿æ¥é²ç½®è¶è¿ä¸å®æ¶é´å(åä½ï¼ç§ï¼æ­¤å¤ä¸º 1800 ç§)å°ä¼è¢«å¼ºè¡å³é­\ninteractive_timeout = 1800\nwait_timeout = 1800\n\n# å¨ MySQL ææ¶åæ­¢ååºæ°è¯·æ±ä¹åçç­æ¶é´åå¤å°ä¸ªè¯·æ±å¯ä»¥è¢«å­å¨å æ ä¸­\n# å®æ¹å»ºè®® back_log = 50 + (max_connections / 5)ï¼å°é¡¶æ°ä¸º 900\nback_log = 900\n\n# æ°æ®åºæ°æ®äº¤æ¢éç½®\n# -------------------------------------------------------------------------------\n# è¯¥åæ°éå¶æå¡å¨ç«¯ï¼æ¥åçæ°æ®åå¤§å°ï¼å¦ææ BLOB å­æ®µï¼å»ºè®®å¢å¤§æ­¤å¼ï¼é¿ååå¥æèæ´æ°åºéãæ BLOB å­æ®µï¼å»ºè®®æ¹ä¸º 1024M\nmax_allowed_packet = 128M\n\n# åå­ãcache ä¸ buffer è®¾ç½®\n\n# åå­ä¸´æ¶è¡¨çæå¤§å¼ï¼é»è®¤ 16Mï¼æ­¤å¤è®¾ç½®æ 64M\ntmp_table_size = 64M\n\n# ç¨æ·åå»ºçåå­è¡¨çå¤§å°ï¼é»è®¤ 16Mï¼å¾å¾å tmp_table_size ä¸èµ·è®¾ç½®ï¼éå¶ç¨æ·ä¸´æ¶è¡¨å¤§å°ã\n# è¶éçè¯ï¼MySQL å°±ä¼èªå¨å°æå®è½¬åä¸ºåºäºç£çç MyISAM è¡¨ï¼å­å¨å¨æå®ç tmpdir ç®å½ä¸ï¼å¢å¤§ IO ååï¼å»ºè®®åå­å¤§ï¼å¢å¤§è¯¥æ°å¼ã\nmax_heap_table_size = 64M\n\n# è¡¨ç¤ºè¿ä¸ª mysql çæ¬æ¯å¦æ¯ææ¥è¯¢ç¼å­ãpsï¼SHOW STATUS LIKE 'qcache%'ï¼ä¸ç¼å­ç¸å³çç¶æåéã\n# have_query_cache\n\n# è¿ä¸ªç³»ç»åéæ§å¶çæ¥è¯¢ç¼å­åè½çå¼å¯åå³é­ï¼0 è¡¨ç¤ºå³é­ï¼1 è¡¨ç¤ºæå¼ï¼2 è¡¨ç¤ºåªè¦ select ä¸­æç¡®æå® SQL_CACHE æç¼å­ã\n# çä¸å¡åºæ¯å³å®æ¯å¦ä½¿ç¨ç¼å­ï¼ä¸ä½¿ç¨ï¼ä¸é¢å°±ä¸ç¨éç½®äºã\n# Mysql8 ä¸æ¯æ\nquery_cache_type = 0\n\n# é»è®¤å¼ 1Mï¼ä¼ç¹æ¯æ¥è¯¢ç¼å­å¯ä»¥æå¤§çæé«æå¡å¨éåº¦ï¼å¦æä½ æå¤§éçç¸åçæ¥è¯¢å¹¶ä¸å¾å°ä¿®æ¹è¡¨ã\n# ç¼ºç¹ï¼å¨ä½ è¡¨ç»å¸¸ååçæåµä¸æèå¦æä½ çæ¥è¯¢åææ¯æ¬¡é½ä¸åï¼æ¥è¯¢ç¼å­ä¹è®¸å¼èµ·æ§è½ä¸éèä¸æ¯æ§è½æåã\n# Mysql8 ä¸æ¯æ\nquery_cache_size = 64M\n\n# åªæå°äºæ­¤è®¾å®å¼çç»ææä¼è¢«ç¼å²ï¼ä¿æ¤æ¥è¯¢ç¼å²ï¼é²æ­¢ä¸ä¸ªæå¤§çç»æéå°å¶ä»ææçæ¥è¯¢ç»æé½è¦çã\nquery_cache_limit = 2M\n\n# æ¯ä¸ªè¢«ç¼å­çç»æéè¦å ç¨çæå°åå­ï¼é»è®¤å¼ 4kbï¼ä¸è¬ä¸æä¹è°æ´ã\n# å¦æ Qcache_free_blocks å¼è¿å¤§ï¼å¯è½æ¯ query_cache_min_res_unit å¼è¿å¤§ï¼åºè¯¥è°å°äº\n# query_cache_min_res_unit çä¼°è®¡å¼ï¼(query_cache_size - Qcache_free_memory) / Qcache_queries_in_cache\nquery_cache_min_res_unit = 4kb\n\n# å¨ä¸ä¸ªäºå¡ä¸­ binlog ä¸ºäºè®°å½ SQL ç¶ææææç cache å¤§å°\n# å¦æä½ ç»å¸¸ä½¿ç¨å¤§çãå¤å£°æçäºå¡ï¼ä½ å¯ä»¥å¢å æ­¤å¼æ¥è·åæ´å¤§çæ§è½ã\n# ææä»äºå¡æ¥çç¶æé½å°è¢«ç¼å²å¨ binlog ç¼å²ä¸­ç¶åå¨æäº¤åä¸æ¬¡æ§åå¥å° binlog ä¸­\n# å¦æäºå¡æ¯æ­¤å¼å¤§ï¼ä¼ä½¿ç¨ç£çä¸çä¸´æ¶æä»¶æ¥æ¿ä»£ã\n# æ­¤ç¼å²å¨æ¯ä¸ªè¿æ¥çäºå¡ç¬¬ä¸æ¬¡æ´æ°ç¶ææ¶è¢«åå»º\nbinlog_cache_size = 1M\n\n# æ¥å¿éç½®\n# -------------------------------------------------------------------------------\n\n# æ¥å¿æä»¶ç¸å³è®¾ç½®ï¼ä¸è¬åªå¼å¯ä¸ç§æ¥å¿ï¼éè¯¯æ¥å¿ï¼æ¢æ¥è¯¢æ¥å¿ï¼äºè¿å¶æ¥å¿ãæ®éæ¥è¯¢æ¥å¿ä¸å¼å¯ã\n# æ®éæ¥è¯¢æ¥å¿ï¼é»è®¤å¼ offï¼ä¸å¼å¯\ngeneral_log = 0\n\n# æ®éæ¥è¯¢æ¥å¿å­æ¾å°å\ngeneral_log_file = /usr/local/mysql-5.7.21/log/mysql-general.log\n\n# å¨å±å¨æåéï¼é»è®¤ 3ï¼èå´ï¼1 ï½ 3\n# è¡¨ç¤ºéè¯¯æ¥å¿è®°å½çä¿¡æ¯ï¼1ï¼åªè®°å½ error ä¿¡æ¯ï¼2ï¼è®°å½ error å warnings ä¿¡æ¯ï¼3ï¼è®°å½ errorãwarnings åæ®éç notes ä¿¡æ¯ã\nlog_error_verbosity = 2\n\n# éè¯¯æ¥å¿æä»¶å°å\nlog_error = /usr/local/mysql-5.7.21/log/mysql-error.log\n\n# å¼å¯æ¢æ¥è¯¢\nslow_query_log = 1\n\n# å¼å¯æ¢æ¥è¯¢æ¶é´ï¼æ­¤å¤ä¸º 1 ç§ï¼è¾¾å°æ­¤å¼æè®°å½æ°æ®\nlong_query_time = 3\n\n# æ£ç´¢è¡æ°è¾¾å°æ­¤æ°å¼ï¼æè®°å½æ¢æ¥è¯¢æ¥å¿ä¸­\nmin_examined_row_limit = 100\n\n# mysql 5.6.5 æ°å¢ï¼ç¨æ¥è¡¨ç¤ºæ¯åéåè®¸è®°å½å° slow log çä¸æªä½¿ç¨ç´¢å¼ç SQL è¯­å¥æ¬¡æ°ï¼é»è®¤å¼ä¸º 0ï¼ä¸éå¶ã\nlog_throttle_queries_not_using_indexes = 0\n\n# æ¢æ¥è¯¢æ¥å¿æä»¶å°å\nslow_query_log_file = /var/log/mysql/mysql-slow.log\n\n# å¼å¯è®°å½æ²¡æä½¿ç¨ç´¢å¼æ¥è¯¢è¯­å¥\nlog-queries-not-using-indexes = 1\n\n# å¼å¯äºè¿å¶æ¥å¿\nlog_bin = /usr/local/mysql-5.7.21/log/mysql-bin.log\n\n# mysql æ¸é¤è¿ææ¥å¿çæ¶é´ï¼é»è®¤å¼ 0ï¼ä¸èªå¨æ¸çï¼èæ¯ä½¿ç¨æ»å¨å¾ªç¯çæ¹å¼ã\nexpire_logs_days = 0\n\n# å¦æäºè¿å¶æ¥å¿åå¥çåå®¹è¶åºç»å®å¼ï¼æ¥å¿å°±ä¼åçæ»å¨ãä½ ä¸è½å°è¯¥åéè®¾ç½®ä¸ºå¤§äº 1GB æå°äº 4096 å­èã é»è®¤å¼æ¯ 1GBã\nmax_binlog_size = 1000M\n\n# binlog çæ ¼å¼ä¹æä¸ç§ï¼STATEMENTï¼ROWï¼MIXEDãmysql 5.7.7 åï¼é»è®¤å¼ä» MIXED æ¹ä¸º ROW\n# å³äº binlog æ¥å¿æ ¼å¼é®é¢ï¼è¯·æ¥éç½ç»èµæ\nbinlog_format = row\n\n# è¡¨ç¤ºæ¯ N æ¬¡åå¥ binlog åï¼æä¹åå°ç£çï¼é»è®¤å¼ N=1\n# å»ºè®®è®¾ç½®æ 1ï¼è¿æ ·å¯ä»¥ä¿è¯ MySQL å¼å¸¸éå¯ä¹å binlog ä¸ä¸¢å¤±ã\n# sync_binlog = 1\n\n# MyISAM å¼æéç½®\n# -------------------------------------------------------------------------------\n\n# æå®ç´¢å¼ç¼å²åºçå¤§å°ï¼ä¸º MYISAM æ°æ®è¡¨å¼å¯ä¾çº¿ç¨å±äº«çç´¢å¼ç¼å­ï¼å¯¹ INNODB å¼ææ æãç¸å½å½±å MyISAM çæ§è½ã\n# ä¸è¦å°å¶è®¾ç½®å¤§äºä½ å¯ç¨åå­ç 30%ï¼å ä¸ºä¸é¨ååå­åæ ·è¢« OS ç¨æ¥ç¼å²è¡æ°æ®\n# çè³å¨ä½ å¹¶ä¸ä½¿ç¨ MyISAM è¡¨çæåµä¸ï¼ä½ ä¹éè¦ä»æ§è®¾ç½®èµ· 8-64M åå­ç±äºå®åæ ·ä¼è¢«åé¨ä¸´æ¶ç£çè¡¨ä½¿ç¨ã\n# é»è®¤å¼ 8Mï¼å»ºè®®å¼ï¼å¯¹äºåå­å¨ 4GB å·¦å³çæå¡å¨è¯¥åæ°å¯è®¾ç½®ä¸º 256M æ 384Mãæ³¨æï¼è¯¥åæ°å¼è®¾ç½®çè¿å¤§åèä¼æ¯æå¡å¨æ´ä½æçéä½ï¼\nkey_buffer_size = 64M\n\n# ä¸ºæ¯ä¸ªæ«æ MyISAM ççº¿ç¨åéåæ°è®¾ç½®çåå­å¤§å°ç¼å²åºã\n# é»è®¤å¼ 128kbï¼å»ºè®®å¼ï¼16G åå­å»ºè®® 1Mï¼4Gï¼128kb æè 256kb å§\n# æ³¨æï¼è¯¥ç¼å²åºæ¯æ¯ä¸ªè¿æ¥ç¬å çï¼æä»¥æ»ç¼å²åºå¤§å°ä¸º 128kb*è¿æ¥æ°ï¼æç«¯æåµ 128kb*maxconnectiosnsï¼ä¼è¶çº§å¤§ï¼æä»¥è¦èèæ¥å¸¸å¹³åè¿æ¥æ°ã\n# ä¸è¬ä¸éè¦å¤ªå³å¿è¯¥æ°å¼ï¼ç¨å¾®å¢å¤§å°±å¯ä»¥äºï¼\nread_buffer_size = 262144\n\n# æ¯æä»»ä½å­å¨å¼æ\n# MySQL çéæºè¯»ç¼å²åºå¤§å°ï¼éå½å¢å¤§ï¼å¯ä»¥æé«æ§è½ã\n# é»è®¤å¼ 256kbï¼å»ºè®®å¼ï¼å¾åèè¿æ¥æ°ï¼16G åå­ï¼æäººæ¨è 8M\n# æ³¨æï¼è¯¥ç¼å²åºæ¯æ¯ä¸ªè¿æ¥ç¬å çï¼æä»¥æ»ç¼å²åºå¤§å°ä¸º 128kb*è¿æ¥æ°ï¼æç«¯æåµ 128kb*maxconnectiosnsï¼ä¼è¶çº§å¤§ï¼æä»¥è¦èèæ¥å¸¸å¹³åè¿æ¥æ°ã\nread_rnd_buffer_size = 1M\n\n# order by æ group by æ¶ç¨å°\n# æ¯æææå¼æï¼innodb å myisam æèªå·±ç innodb_sort_buffer_size å myisam_sort_buffer_size è®¾ç½®\n# é»è®¤å¼ 256kbï¼å»ºè®®å¼ï¼å¾åèè¿æ¥æ°ï¼16G åå­ï¼æäººæ¨è 8Mã\n# æ³¨æï¼è¯¥ç¼å²åºæ¯æ¯ä¸ªè¿æ¥ç¬å çï¼æä»¥æ»ç¼å²åºå¤§å°ä¸º 1M*è¿æ¥æ°ï¼æç«¯æåµ 1M*maxconnectiosnsï¼ä¼è¶çº§å¤§ãæä»¥è¦èèæ¥å¸¸å¹³åè¿æ¥æ°ã\nsort_buffer_size = 1M\n\n# æ­¤ç¼å²è¢«ä½¿ç¨æ¥ä¼åå¨èå(full JOINs ä¸å¸¦ç´¢å¼çèå)\n# ç±»ä¼¼çèåå¨æå¤§å¤æ°æåµä¸æéå¸¸ç³ç³çæ§è½è¡¨ç°ï¼ä½æ¯å°æ­¤å¼è®¾å¤§è½å¤åè½»æ§è½å½±åã\n# éè¿ âSelect_full_joinâ ç¶æåéæ¥çå¨èåçæ°é\n# æ³¨æï¼è¯¥ç¼å²åºæ¯æ¯ä¸ªè¿æ¥ç¬å çï¼æä»¥æ»ç¼å²åºå¤§å°ä¸º 1M*è¿æ¥æ°ï¼æç«¯æåµ 1M*maxconnectiosnsï¼ä¼è¶çº§å¤§ãæä»¥è¦èèæ¥å¸¸å¹³åè¿æ¥æ°ã\n# é»è®¤å¼ 256kb;å»ºè®®å¼ï¼16G åå­ï¼è®¾ç½® 8Mã\njoin_buffer_size = 1M\n\n# ç¼å­ linux æä»¶æè¿°ç¬¦ä¿¡æ¯ï¼å å¿«æ°æ®æä»¶æå¼éåº¦\n# å®å½±å myisam è¡¨çæå¼å³é­ï¼ä½æ¯ä¸å½±å innodb è¡¨çæå¼å³é­ã\n# é»è®¤å¼ 2000ï¼å»ºè®®å¼ï¼æ ¹æ®ç¶æåé Opened_tables å»è®¾å®\ntable_open_cache = 2000\n\n# ç¼å­è¡¨å®ä¹çç¸å³ä¿¡æ¯ï¼å å¿«è¯»åè¡¨ä¿¡æ¯éåº¦\n# é»è®¤å¼ 1400ï¼æå¤§å¼ 2000ï¼å»ºè®®å¼ï¼åºæ¬ä¸æ¹ã\ntable_definition_cache = 1400\n\n# è¯¥åæ°æ¯ myssql 5.6 åå¼å¥çï¼ç®çæ¯æé«å¹¶åã\n# é»è®¤å¼ 1ï¼å»ºè®®å¼ï¼cpu æ ¸æ°ï¼å¹¶ä¸<=16\ntable_open_cache_instances = 2\n\n# å½å®¢æ·ç«¯æ­å¼ä¹åï¼æå¡å¨å¤çæ­¤å®¢æ·ççº¿ç¨å°ä¼ç¼å­èµ·æ¥ä»¥ååºä¸ä¸ä¸ªå®¢æ·èä¸æ¯éæ¯ãå¯éç¨ï¼åå°äºç³»ç»å¼éã\n# é»è®¤å¼ä¸º 9ï¼å»ºè®®å¼ï¼ä¸¤ç§åå¼æ¹å¼ï¼æ¹å¼ä¸ï¼æ ¹æ®ç©çåå­ï¼1G â> 8ï¼2G â> 16ï¼ 3G â> 32ï¼ >3G â> 64ï¼\n# æ¹å¼äºï¼æ ¹æ® show status like 'threads%'ï¼æ¥ç Threads_connected å¼ã\nthread_cache_size = 16\n\n# é»è®¤å¼ 256kï¼å»ºè®®å¼ï¼16/32G åå­ï¼512kbï¼å¶ä»ä¸è¬ä¸æ¹åï¼å¦ææ¥éï¼Thread stack overrunï¼å°±å¢å¤§ççï¼\n# æ³¨æï¼æ¯ä¸ªçº¿ç¨åéåå­ç©ºé´ï¼æä»¥æ»åå­ç©ºé´ãããä½ æå¾ã\nthread_stack = 512k\n\n# InnoDB å¼æéç½®\n# -------------------------------------------------------------------------------\n\n# è¯´æï¼è¯¥åæ°å¯ä»¥æåæ©å±æ§åå·èé¡µæ§è½ã\n# é»è®¤å¼ 1ï¼å»ºè®®å¼ï¼4-8ï¼å¹¶ä¸å¿é¡»å°äº innodb_buffer_pool_instances\ninnodb_page_cleaners = 4\n\n# è¯´æï¼ä¸è¬ 8k å 16k ä¸­éæ©ï¼8k çè¯ï¼cpu æ¶èå°äºï¼selcet æçé«ä¸ç¹ï¼ä¸è¬ä¸ç¨æ¹\n# é»è®¤å¼ï¼16kï¼å»ºè®®å¼ï¼ä¸æ¹ï¼\ninnodb_page_size = 16384\n\n# è¯´æï¼InnoDB ä½¿ç¨ä¸ä¸ªç¼å²æ± æ¥ä¿å­ç´¢å¼ååå§æ°æ®ï¼ä¸å MyISAMãè¿éä½ è®¾ç½®è¶å¤§ï¼ä½ å¨å­åè¡¨éé¢æ°æ®æ¶æéè¦çç£ç I/O è¶å°ã\n# å¨ä¸ä¸ªç¬ç«ä½¿ç¨çæ°æ®åºæå¡å¨ä¸ï¼ä½ å¯ä»¥è®¾ç½®è¿ä¸ªåéå°æå¡å¨ç©çåå­å¤§å°ç 60%-80%\n# æ³¨æå«è®¾ç½®çè¿å¤§ï¼ä¼å¯¼è´ system ç swap ç©ºé´è¢«å ç¨ï¼å¯¼è´æä½ç³»ç»åæ¢ï¼ä»èåä½ sql æ¥è¯¢çæç\n# é»è®¤å¼ï¼128Mï¼å»ºè®®å¼ï¼ç©çåå­ç 60%-80%\ninnodb_buffer_pool_size = 512M\n\n# è¯´æï¼åªæå½è®¾ç½® innodb_buffer_pool_size å¼å¤§äº 1G æ¶æææä¹ï¼å°äº 1Gï¼instances é»è®¤ä¸º 1ï¼å¤§äº 1Gï¼instances é»è®¤ä¸º 8\n# ä½æ¯ç½ç»ä¸æè¯ä»·ï¼æä½³æ§è½ï¼æ¯ä¸ªå®ä¾è³å° 1G å¤§å°ã\n# é»è®¤å¼ï¼1 æ 8ï¼å»ºè®®å¼ï¼innodb_buffer_pool_size/innodb_buffer_pool_instances >= 1G\ninnodb_buffer_pool_instances = 1\n\n# è¯´æï¼mysql 5.7 æ°ç¹æ§ï¼defines the chunk size for online InnoDB buffer pool resizing operationsã\n# å®éç¼å²åºå¤§å°å¿é¡»ä¸º innodb_buffer_pool_chunk_size*innodb_buffer_pool_instances*åæ°ï¼åç¥å¤§äº innodb_buffer_pool_size\n# é»è®¤å¼ 128Mï¼å»ºè®®å¼ï¼é»è®¤å¼å°±å¥½ï¼ä¹±æ¹åèå®¹æåºé®é¢ï¼å®ä¼å½±åå®é buffer pool å¤§å°ã\ninnodb_buffer_pool_chunk_size = 128M\n\n# å¨å¯å¨æ¶æç­æ°æ®å è½½å°åå­ãé»è®¤å¼ä¸º onï¼ä¸ä¿®æ¹\ninnodb_buffer_pool_load_at_startup = 1\n\n# å¨å³é­æ¶æç­æ°æ® dump å°æ¬å°ç£çãé»è®¤å¼ä¸º onï¼ä¸ä¿®æ¹\ninnodb_buffer_pool_dump_at_shutdown = 1\n\n# è¯´æï¼å½±å Innodb ç¼å²åºçå·æ°ç®æ³ï¼å»ºè®®ä»å°å°å¤§éç½®ï¼ç´å° zero free pagesï¼innodb_lru_scan_depth \\* innodb_buffer_pool_instances defines the amount of work performed by the page cleaner thread each secondã\n# é»è®¤å¼ 1024ï¼å»ºè®®å¼ï¼ æªç¥\ninnodb_lru_scan_depth = 1024\n\n# è¯´æï¼äºå¡ç­å¾è·åèµæºç­å¾çæé¿æ¶é´ï¼åä½ä¸ºç§ï¼çå·ä½ä¸å¡æåµï¼ä¸è¬é»è®¤å¼å°±å¥½\n# é»è®¤å¼ï¼50ï¼å»ºè®®å¼ï¼çä¸å¡ã\ninnodb_lock_wait_timeout = 60\n\n# è¯´æï¼è®¾ç½®äº Mysql åå°ä»»å¡ï¼ä¾å¦é¡µå·æ°å merge dadta from buffer poolï¼æ¯ç§ io æä½çä¸éã\n# é»è®¤å¼ï¼200ï¼å»ºè®®å¼ï¼æ¹æ³ä¸ï¼åç sata è®¾ 100ï¼sas10ï¼raid10 è®¾ 200ï¼ssd è®¾ 2000ï¼fushion-io è®¾ 50000ï¼æ¹æ³äºï¼éè¿æµè¯å·¥å·è·å¾ç£ç io æ§è½åï¼è®¾ç½® IOPS æ°å¼/2ã\ninnodb_io_capacity = 2000\n\n# è¯´æï¼è¯¥åæ°æ¯ææç¼å²åºçº¿ç¨ io æä½çæ»ä¸éã\n# é»è®¤å¼ï¼innodb_io_capacity çä¸¤åãå»ºè®®å¼ï¼ä¾å¦ç¨ iometer æµè¯åç iops æ°å¼å°±å¥½\ninnodb_io_capacity_max = 4000\n\n# è¯´æï¼æ§å¶ç innodb æ°æ®æä»¶å redo log çæå¼ãå·åæ¨¡å¼ï¼ä¸ç§æ¨¡å¼ï¼fdatasync(é»è®¤)ï¼O_DSYNCï¼O_DIRECT\n# fdatasyncï¼æ°æ®æä»¶ï¼buffer pool->os buffer->ç£çï¼æ¥å¿æä»¶ï¼buffer pool->os buffer->ç£çï¼\n# O_DSYNCï¼ æ°æ®æä»¶ï¼buffer pool->os buffer->ç£çï¼æ¥å¿æä»¶ï¼buffer pool->ç£çï¼\n# O_DIRECTï¼ æ°æ®æä»¶ï¼buffer pool->ç£çï¼ æ¥å¿æä»¶ï¼buffer pool->os buffer->ç£çï¼\n# é»è®¤å¼ä¸ºç©ºï¼å»ºè®®å¼ï¼ä½¿ç¨ SAN æè raidï¼å»ºè®®ç¨ O_DIRECTï¼ä¸ææµè¯çè¯ï¼é»è®¤çäº§ä¸ä½¿ç¨ O_DIRECT\ninnodb_flush_method = O_DIRECT\n\n# è¯´æï¼mysql5.7 ä¹åé»è®¤å¼å¯ï¼æææ¯ï¼æ¯å¼ è¡¨ä¸ä¸ªç¬ç«è¡¨ç©ºé´ã\n# é»è®¤å¼ 1ï¼å¼å¯\ninnodb_file_per_table = 1\n\n# è¯´æï¼The path where InnoDB creates undo tablespacesãéå¸¸ç­äº undo log æä»¶çå­æ¾ç®å½ã\n# é»è®¤å¼ ./;èªè¡è®¾ç½®\ninnodb_undo_directory = /usr/local/mysql-5.7.21/log\n\n# è¯´æï¼The number of undo tablespaces used by InnoDB ç­äº undo log æä»¶æ°éã5.7.21 åå¼å§å¼ç¨\n# é»è®¤å¼ä¸º 0ï¼å»ºè®®é»è®¤å¼å°±å¥½ï¼ä¸ç¨è°æ´äºã\ninnodb_undo_tablespaces = 0\n\n# è¯´æï¼å®ä¹ undo ä½¿ç¨çåæ»æ®µæ°éã5.7.19 åå¼ç¨\n# é»è®¤å¼ 128ï¼å»ºè®®ä¸å¨ï¼ä»¥åå¼ç¨äºã\ninnodb_undo_logs = 128\n\n# è¯´æï¼5.7.5 åå¼å§ä½¿ç¨ï¼å¨çº¿æ¶ç¼© undo log ä½¿ç¨çç©ºé´ã\n# é»è®¤å¼ï¼å³é­ï¼å»ºè®®å¼ï¼å¼å¯\ninnodb_undo_log_truncate = 1\n\n# è¯´æï¼ç»å innodb_undo_log_truncateï¼å®ç° undo ç©ºé´æ¶ç¼©åè½\n# é»è®¤å¼ï¼1Gï¼å»ºè®®å¼ï¼ä¸æ¹ã\ninnodb_max_undo_log_size = 1G\n\n# è¯´æï¼éä½æ¥å¿æä»¶çå­æ¾ç®å½\ninnodb_log_group_home_dir = /usr/local/mysql-5.7.21/log\n\n# è¯´æï¼æ¥å¿æä»¶çå¤§å°\n# é»è®¤å¼ï¼48Mï¼å»ºè®®å¼ï¼æ ¹æ®ä½ ç³»ç»çç£çç©ºé´åæ¥å¿å¢é¿æåµè°æ´å¤§å°\ninnodb_log_file_size = 128M\n\n# è¯´æï¼æ¥å¿ç»ä¸­çæä»¶æ°éï¼mysql ä»¥å¾ªç¯æ¹å¼åå¥æ¥å¿\n# é»è®¤å¼ 2ï¼å»ºè®®å¼ï¼æ ¹æ®ä½ ç³»ç»çç£çç©ºé´åæ¥å¿å¢é¿æåµè°æ´å¤§å°\ninnodb_log_files_in_group = 3\n\n# æ­¤åæ°ç¡®å®äºæ¥å¿æä»¶æç¨çåå­å¤§å°ï¼ä»¥ M ä¸ºåä½ãç¼å²åºæ´å¤§è½æé«æ§è½ï¼ä½æå¤çæéå°ä¼ä¸¢å¤±æ°æ®ãMySQL å¼åäººåå»ºè®®è®¾ç½®ä¸º 1ï¼8M ä¹é´\ninnodb_log_buffer_size = 16M\n\n# è¯´æï¼å¯ä»¥æ§å¶ log ä»ç³»ç» buffer å·å¥ç£çæä»¶çå·æ°é¢çï¼å¢å¤§å¯åè½»ç³»ç»è´è·\n# é»è®¤å¼æ¯ 1ï¼å»ºè®®å¼ä¸æ¹ãç³»ç»æ§è½ä¸è¬å¤ç¨ã\ninnodb_flush_log_at_timeout = 1\n\n# è¯´æï¼åæ°å¯è®¾ä¸º 0ï¼1ï¼2ï¼\n# åæ° 0ï¼è¡¨ç¤ºæ¯ç§å° log buffer åå®¹å·æ°å°ç³»ç» buffer ä¸­ï¼åè°ç¨ç³»ç» flush æä½åå¥ç£çæä»¶ã\n# åæ° 1ï¼è¡¨ç¤ºæ¯æ¬¡äºå¡æäº¤ï¼redo log é½ç´æ¥æä¹åå°ç£çã\n# åæ° 2ï¼è¡¨ç¤ºæ¯æ¬¡äºå¡æäº¤ï¼é 1 ç§ååå° redo log æä¹åå°ç£çã\n# å»ºè®®è®¾ç½®æ 1ï¼è¿æ ·å¯ä»¥ä¿è¯ MySQL å¼å¸¸éå¯ä¹åæ°æ®ä¸ä¸¢å¤±ã\ninnodb_flush_log_at_trx_commit = 1\n\n# è¯´æï¼éå¶ Innodb è½æå¼çè¡¨çæ°æ®ï¼å¦æåºéçè¡¨ç¹å«å¤çæåµï¼è¯·å¢å è¿ä¸ªã\n# å¼é»è®¤æ¯ 2000ï¼å»ºè®®å¼ï¼åèæ°æ®åºè¡¨æ»æ°åè¿è¡è°æ´ï¼ä¸è¬å¤ç¨ä¸ç¨è°æ´ã\ninnodb_open_files = 8192\n\n# innodb å¤ç io è¯»åçåå°å¹¶åçº¿ç¨æ°éï¼æ ¹æ® cpu æ ¸æ¥ç¡®è®¤ï¼åå¼èå´ï¼1-64\n# é»è®¤å¼ï¼4ï¼å»ºè®®å¼ï¼ä¸é»è¾ cpu æ°éçä¸åä¿æä¸è´ã\ninnodb_read_io_threads = 4\ninnodb_write_io_threads = 4\n\n# é»è®¤è®¾ç½®ä¸º 0ï¼è¡¨ç¤ºä¸éå¶å¹¶åæ°ï¼è¿éæ¨èè®¾ç½®ä¸º 0ï¼æ´å¥½å»åæ¥ CPU å¤æ ¸å¤çè½åï¼æé«å¹¶åé\ninnodb_thread_concurrency = 0\n\n# é»è®¤å¼ä¸º 4ï¼å»ºè®®ä¸åãInnoDB ä¸­çæ¸é¤æä½æ¯ä¸ç±»å®æåæ¶æ ç¨æ°æ®çæä½ãmysql 5.5 ä¹åï¼æ¯æå¤çº¿ç¨æ¸é¤æä½ã\ninnodb_purge_threads = 4\n\n# è¯´æï¼mysql ç¼å²åºåä¸º new blocks å old blocksï¼æ­¤åæ°è¡¨ç¤º old blocks å æ¯ï¼\n# é»è®¤å¼ï¼37ï¼å»ºè®®å¼ï¼ä¸è¬ä¸å¨\ninnodb_old_blocks_pct = 37\n\n# è¯´æï¼æ°æ°æ®è¢«è½½å¥ç¼å²æ± ï¼è¿å¥ old pages é¾åºï¼å½ 1 ç§ååæ¬¡è®¿é®ï¼åæåè¿å¥ new pages é¾åºã\n# é»è®¤å¼ï¼1000\ninnodb_old_blocks_time=1000\n\n# è¯´æï¼å¼å¯å¼æ­¥ ioï¼å¯ä»¥æé«å¹¶åæ§ï¼é»è®¤å¼å¯ã\n# é»è®¤å¼ä¸º 1ï¼å»ºè®®ä¸å¨\ninnodb_use_native_aio = 1\n\n# è¯´æï¼é»è®¤ä¸ºç©ºï¼ä½¿ç¨ data ç®å½ï¼ä¸è¬ä¸æ¹ã\ninnodb_data_home_dir=/usr/local/mysql-5.7.21/data\n\n# è¯´æï¼Defines the nameï¼sizeï¼and attributes of InnoDB system tablespace data filesã\n# é»è®¤å¼ï¼ä¸æå®ï¼é»è®¤ä¸º ibdata1ï¼12Mï¼autoextend\ninnodb_data_file_path = ibdata1ï¼12Mï¼autoextend\n\n# è¯´æï¼è®¾ç½®äº InnoDB å­å¨å¼æç¨æ¥å­æ¾æ°æ®å­å¸ä¿¡æ¯ä»¥åä¸äºåé¨æ°æ®ç»æçåå­ç©ºé´å¤§å°ï¼é¤éä½ çæ°æ®å¯¹è±¡åå¶å¤ï¼å¦åä¸è¬é»è®¤ä¸æ¹ã\n# innodb_additional_mem_pool_size = 16M\n# è¯´æï¼The crash recovery modeãåªæç´§æ¥æåµéè¦æ¢å¤æ°æ®çæ¶åï¼ææ¹ä¸ºå¤§äº 1-6 ä¹é´æ°å¼ï¼å«ä¹æ¥ä¸å®ç½ã\n# é»è®¤å¼ä¸º 0ï¼\n#innodb_force_recovery = 0\n\n\n\n[mysqldump]\n\n# quick éé¡¹å¼ºå¶ mysqldump ä»æå¡å¨æ¥è¯¢åå¾è®°å½ç´æ¥è¾åºèä¸æ¯åå¾ææè®°å½åå°å®ä»¬ç¼å­å°åå­ä¸­\nquick\n\nmax_allowed_packet = 16M\n\n\n\n[mysql]\n\n# mysql å½ä»¤è¡å·¥å·ä¸ä½¿ç¨èªå¨è¡¥å¨åè½ï¼å»ºè®®è¿æ¯æ¹ä¸º\n# no-auto-rehash\nauto-rehash\n\n# socket æä»¶\nsocket = /var/lib/mysql/mysql.sock\n\n\n\n# åèèµæ\n\n * ãé«æ§è½ MySQLã\n * Mysql éç½®æä»¶/etc/my.cnf è§£æ",normalizedContent:"# mysql éç½®\n\n> çæ¬ï¼\n\n\n# åºæ¬éç½®\n\n[mysqld]\n# general\n# -------------------------------------------------------------------------------\ndatadir = /var/lib/mysql\nsocket  = /var/lib/mysql/mysql.sock\npid_file = /var/lib/mysql/mysql.pid\nuser = mysql\nport = 3306\ndefault_storage_engine = innodb\ndefault_time_zone = '+8ï¼00'\ncharacter_set_server = utf8mb4\ncollation_server = utf8mb4_0900_ai_ci\n\n# log\n# -------------------------------------------------------------------------------\nlog_error = /var/log/mysql/mysql-error.log\nslow_query_log = 1\nslow_query_log_file = /var/log/mysql/mysql-slow.log\n\n# innodb\n# -------------------------------------------------------------------------------\ninnodb_buffer_pool_size = <value>\ninnodb_log_file_size = <value>\ninnodb_file_per_table = 1\ninnodb_flush_method = o_direct\n\n# myisam\n# -------------------------------------------------------------------------------\nkey_buffer_size = <value>\n\n# other\n# -------------------------------------------------------------------------------\ntmp_table_size = 32m\nmax_heap_table_size = 32m\nmax_connections = <value>\nopen_files_limit = 65535\n\n[client]\nsocket  = /var/lib/mysql/mysql.sock\nport = 3306\n\n\n\n# éç½®é¡¹è¯´æ\n\n[client]\n# æå¡ç«¯å£å·ï¼é»è®¤ 3306\nport = 3306\n\n# socket æä»¶\nsocket = /var/lib/mysql/mysql.sock\n\n\n\n[mysqld]\n\n# general\n# -------------------------------------------------------------------------------\n\n# socket æä»¶\nsocket = /var/lib/mysql/mysql.sock\n\n# pid æä»¶\npid_file = /var/lib/mysql/mysql.pid\n\n# å¯å¨ mysql æå¡è¿ç¨çç¨æ·\nuser = mysql\n\n# æå¡ç«¯å£å·ï¼é»è®¤ 3306\nport = 3306\n\n# é»è®¤æ¶åº\ndefault_time_zone = '+8ï¼00'\n\n# mysql æå¡ idï¼åç¹æå¡æ¶æ²¡å¿è¦è®¾ç½®\nserver-id = 1\n\n# äºå¡éç¦»çº§å«ï¼é»è®¤ä¸ºå¯éå¤è¯»ï¼repeatable-readï¼ãï¼æ­¤çº§å«ä¸å¯è½åæ°å¾å¤é´ééï¼å½±åæ§è½ï¼ä½æ¯ä¿®æ¹åå½±åä¸»ä»å¤å¶åç¾é¾æ¢å¤ï¼å»ºè®®è¿æ¯ä¿®æ¹ä»£ç é»è¾å§ï¼\n# éç¦»çº§å«å¯éé¡¹ç®ï¼read-uncommitted read-committed repeatable-read serializable\ntransaction_isolation = repeatable-read\n\n# ç®å½éç½®\n# -------------------------------------------------------------------------------\n\n# mysql å®è£æ ¹ç®å½\nbasedir = /usr/local/mysql-5.7.21\n\n# mysql æ°æ®æä»¶æå¨ç®å½\ndatadir = /var/lib/mysql\n\n# ä¸´æ¶ç®å½ æ¯å¦ load data infile ä¼ç¨å°ï¼ä¸è¬é½æ¯ä½¿ç¨/tmp\ntmpdir = /tmp\n\n# æ°æ®åºå¼æéç½®\n# -------------------------------------------------------------------------------\n\n# mysql 5.1 ä¹åï¼é»è®¤å¼ææ¯ innodb\ndefault_storage_engine = innodb\n\n# åå­ä¸´æ¶è¡¨é»è®¤å¼æï¼é»è®¤ innodb\ndefault_tmp_storage_engine = innodb\n\n# mysql 5.7 æ°å¢ç¹æ§ï¼ç£çä¸´æ¶è¡¨é»è®¤å¼æï¼é»è®¤ innodb\ninternal_tmp_disk_storage_engine = innodb\n\n# å­ç¬¦ééç½®\n# -------------------------------------------------------------------------------\n\n# æ°æ®åºé»è®¤å­ç¬¦éï¼ä¸»æµå­ç¬¦éæ¯æä¸äºç¹æ®è¡¨æç¬¦å·ï¼ç¹æ®è¡¨æç¬¦å ç¨ 4 ä¸ªå­èï¼\ncharacter_set_server = utf8mb4\n\n# æ°æ®åºå­ç¬¦éå¯¹åºä¸äºæåºç­è§åï¼æ³¨æè¦å character_set_server å¯¹åº\ncollation-server = utf8mb4_0900_ai_ci\n\n# è®¾ç½® client è¿æ¥ mysql æ¶çå­ç¬¦éï¼é²æ­¢ä¹±ç \n# init_connect='set names utf8'\n\n# æ¯å¦å¯¹ sql è¯­å¥å¤§å°åææï¼é»è®¤å¼ä¸º 0ï¼1 è¡¨ç¤ºä¸ææ\nlower_case_table_names = 1\n\n# æ°æ®åºè¿æ¥éç½®\n# -------------------------------------------------------------------------------\n\n# æå¤§è¿æ¥æ°ï¼å¯è®¾æå¤§å¼ 16384ï¼ä¸è¬èèæ ¹æ®åæ¶å¨çº¿äººæ°è®¾ç½®ä¸ä¸ªæ¯è¾ç»¼åçæ°å­ï¼é´äºè¯¥æ°å¼å¢å¤§å¹¶ä¸å¤ªæ¶èç³»ç»èµæºï¼å»ºè®®ç´æ¥è®¾ 10000\n# å¦æå¨è®¿é®æ¶ç»å¸¸åºç° too many connections çéè¯¯æç¤ºï¼åéè¦å¢å¤§è¯¥åæ°å¼\nmax_connections = 10000\n\n# é»è®¤å¼ 100ï¼æå¤§éè¯¯è¿æ¥æ°ï¼å¦ææè¶åºè¯¥åæ°å¼ä¸ªæ°çä¸­æ­éè¯¯è¿æ¥ï¼åè¯¥ä¸»æºå°è¢«ç¦æ­¢è¿æ¥ãå¦éå¯¹è¯¥ä¸»æºè¿è¡è§£ç¦ï¼æ§è¡ï¼flush host\n# èèé«å¹¶ååºæ¯ä¸çå®¹éï¼å»ºè®®å å¤§ã\nmax_connect_errors = 10000\n\n# mysql æå¼çæä»¶æè¿°ç¬¦éå¶ï¼é»è®¤æå° 1024;\n# å½ open_files_limit æ²¡æè¢«éç½®çæ¶åï¼æ¯è¾ max_connections\\*5 å ulimit -n çå¼ï¼åªä¸ªå¤§ç¨åªä¸ªï¼\n# å½ open_file_limit è¢«éç½®çæ¶åï¼æ¯è¾ open_files_limit å max_connections\\*5 çå¼ï¼åªä¸ªå¤§ç¨åªä¸ªã\n# æ³¨æï¼ä»ç¶å¯è½åºç°æ¥éä¿¡æ¯ can't create a new threadï¼æ­¤æ¶è§å¯ç³»ç» cat /proc/mysql è¿ç¨å·/limitsï¼è§å¯è¿ç¨ ulimit éå¶æåµ\n# è¿å°çè¯ï¼èèä¿®æ¹ç³»ç»éç½®è¡¨ï¼/etc/security/limits.conf å /etc/security/limits.d/90-nproc.conf\nopen_files_limit = 65535\n\n# è¶æ¶éç½®\n# -------------------------------------------------------------------------------\n\n# mysql é»è®¤ç wait_timeout å¼ä¸º 8 ä¸ªå°æ¶ï¼interactive_timeout åæ°éè¦åæ¶éç½®æè½çæ\n# mysql è¿æ¥é²ç½®è¶è¿ä¸å®æ¶é´å(åä½ï¼ç§ï¼æ­¤å¤ä¸º 1800 ç§)å°ä¼è¢«å¼ºè¡å³é­\ninteractive_timeout = 1800\nwait_timeout = 1800\n\n# å¨ mysql ææ¶åæ­¢ååºæ°è¯·æ±ä¹åçç­æ¶é´åå¤å°ä¸ªè¯·æ±å¯ä»¥è¢«å­å¨å æ ä¸­\n# å®æ¹å»ºè®® back_log = 50 + (max_connections / 5)ï¼å°é¡¶æ°ä¸º 900\nback_log = 900\n\n# æ°æ®åºæ°æ®äº¤æ¢éç½®\n# -------------------------------------------------------------------------------\n# è¯¥åæ°éå¶æå¡å¨ç«¯ï¼æ¥åçæ°æ®åå¤§å°ï¼å¦ææ blob å­æ®µï¼å»ºè®®å¢å¤§æ­¤å¼ï¼é¿ååå¥æèæ´æ°åºéãæ blob å­æ®µï¼å»ºè®®æ¹ä¸º 1024m\nmax_allowed_packet = 128m\n\n# åå­ãcache ä¸ buffer è®¾ç½®\n\n# åå­ä¸´æ¶è¡¨çæå¤§å¼ï¼é»è®¤ 16mï¼æ­¤å¤è®¾ç½®æ 64m\ntmp_table_size = 64m\n\n# ç¨æ·åå»ºçåå­è¡¨çå¤§å°ï¼é»è®¤ 16mï¼å¾å¾å tmp_table_size ä¸èµ·è®¾ç½®ï¼éå¶ç¨æ·ä¸´æ¶è¡¨å¤§å°ã\n# è¶éçè¯ï¼mysql å°±ä¼èªå¨å°æå®è½¬åä¸ºåºäºç£çç myisam è¡¨ï¼å­å¨å¨æå®ç tmpdir ç®å½ä¸ï¼å¢å¤§ io ååï¼å»ºè®®åå­å¤§ï¼å¢å¤§è¯¥æ°å¼ã\nmax_heap_table_size = 64m\n\n# è¡¨ç¤ºè¿ä¸ª mysql çæ¬æ¯å¦æ¯ææ¥è¯¢ç¼å­ãpsï¼show status like 'qcache%'ï¼ä¸ç¼å­ç¸å³çç¶æåéã\n# have_query_cache\n\n# è¿ä¸ªç³»ç»åéæ§å¶çæ¥è¯¢ç¼å­åè½çå¼å¯åå³é­ï¼0 è¡¨ç¤ºå³é­ï¼1 è¡¨ç¤ºæå¼ï¼2 è¡¨ç¤ºåªè¦ select ä¸­æç¡®æå® sql_cache æç¼å­ã\n# çä¸å¡åºæ¯å³å®æ¯å¦ä½¿ç¨ç¼å­ï¼ä¸ä½¿ç¨ï¼ä¸é¢å°±ä¸ç¨éç½®äºã\n# mysql8 ä¸æ¯æ\nquery_cache_type = 0\n\n# é»è®¤å¼ 1mï¼ä¼ç¹æ¯æ¥è¯¢ç¼å­å¯ä»¥æå¤§çæé«æå¡å¨éåº¦ï¼å¦æä½ æå¤§éçç¸åçæ¥è¯¢å¹¶ä¸å¾å°ä¿®æ¹è¡¨ã\n# ç¼ºç¹ï¼å¨ä½ è¡¨ç»å¸¸ååçæåµä¸æèå¦æä½ çæ¥è¯¢åææ¯æ¬¡é½ä¸åï¼æ¥è¯¢ç¼å­ä¹è®¸å¼èµ·æ§è½ä¸éèä¸æ¯æ§è½æåã\n# mysql8 ä¸æ¯æ\nquery_cache_size = 64m\n\n# åªæå°äºæ­¤è®¾å®å¼çç»ææä¼è¢«ç¼å²ï¼ä¿æ¤æ¥è¯¢ç¼å²ï¼é²æ­¢ä¸ä¸ªæå¤§çç»æéå°å¶ä»ææçæ¥è¯¢ç»æé½è¦çã\nquery_cache_limit = 2m\n\n# æ¯ä¸ªè¢«ç¼å­çç»æéè¦å ç¨çæå°åå­ï¼é»è®¤å¼ 4kbï¼ä¸è¬ä¸æä¹è°æ´ã\n# å¦æ qcache_free_blocks å¼è¿å¤§ï¼å¯è½æ¯ query_cache_min_res_unit å¼è¿å¤§ï¼åºè¯¥è°å°äº\n# query_cache_min_res_unit çä¼°è®¡å¼ï¼(query_cache_size - qcache_free_memory) / qcache_queries_in_cache\nquery_cache_min_res_unit = 4kb\n\n# å¨ä¸ä¸ªäºå¡ä¸­ binlog ä¸ºäºè®°å½ sql ç¶ææææç cache å¤§å°\n# å¦æä½ ç»å¸¸ä½¿ç¨å¤§çãå¤å£°æçäºå¡ï¼ä½ å¯ä»¥å¢å æ­¤å¼æ¥è·åæ´å¤§çæ§è½ã\n# ææä»äºå¡æ¥çç¶æé½å°è¢«ç¼å²å¨ binlog ç¼å²ä¸­ç¶åå¨æäº¤åä¸æ¬¡æ§åå¥å° binlog ä¸­\n# å¦æäºå¡æ¯æ­¤å¼å¤§ï¼ä¼ä½¿ç¨ç£çä¸çä¸´æ¶æä»¶æ¥æ¿ä»£ã\n# æ­¤ç¼å²å¨æ¯ä¸ªè¿æ¥çäºå¡ç¬¬ä¸æ¬¡æ´æ°ç¶ææ¶è¢«åå»º\nbinlog_cache_size = 1m\n\n# æ¥å¿éç½®\n# -------------------------------------------------------------------------------\n\n# æ¥å¿æä»¶ç¸å³è®¾ç½®ï¼ä¸è¬åªå¼å¯ä¸ç§æ¥å¿ï¼éè¯¯æ¥å¿ï¼æ¢æ¥è¯¢æ¥å¿ï¼äºè¿å¶æ¥å¿ãæ®éæ¥è¯¢æ¥å¿ä¸å¼å¯ã\n# æ®éæ¥è¯¢æ¥å¿ï¼é»è®¤å¼ offï¼ä¸å¼å¯\ngeneral_log = 0\n\n# æ®éæ¥è¯¢æ¥å¿å­æ¾å°å\ngeneral_log_file = /usr/local/mysql-5.7.21/log/mysql-general.log\n\n# å¨å±å¨æåéï¼é»è®¤ 3ï¼èå´ï¼1 ï½ 3\n# è¡¨ç¤ºéè¯¯æ¥å¿è®°å½çä¿¡æ¯ï¼1ï¼åªè®°å½ error ä¿¡æ¯ï¼2ï¼è®°å½ error å warnings ä¿¡æ¯ï¼3ï¼è®°å½ errorãwarnings åæ®éç notes ä¿¡æ¯ã\nlog_error_verbosity = 2\n\n# éè¯¯æ¥å¿æä»¶å°å\nlog_error = /usr/local/mysql-5.7.21/log/mysql-error.log\n\n# å¼å¯æ¢æ¥è¯¢\nslow_query_log = 1\n\n# å¼å¯æ¢æ¥è¯¢æ¶é´ï¼æ­¤å¤ä¸º 1 ç§ï¼è¾¾å°æ­¤å¼æè®°å½æ°æ®\nlong_query_time = 3\n\n# æ£ç´¢è¡æ°è¾¾å°æ­¤æ°å¼ï¼æè®°å½æ¢æ¥è¯¢æ¥å¿ä¸­\nmin_examined_row_limit = 100\n\n# mysql 5.6.5 æ°å¢ï¼ç¨æ¥è¡¨ç¤ºæ¯åéåè®¸è®°å½å° slow log çä¸æªä½¿ç¨ç´¢å¼ç sql è¯­å¥æ¬¡æ°ï¼é»è®¤å¼ä¸º 0ï¼ä¸éå¶ã\nlog_throttle_queries_not_using_indexes = 0\n\n# æ¢æ¥è¯¢æ¥å¿æä»¶å°å\nslow_query_log_file = /var/log/mysql/mysql-slow.log\n\n# å¼å¯è®°å½æ²¡æä½¿ç¨ç´¢å¼æ¥è¯¢è¯­å¥\nlog-queries-not-using-indexes = 1\n\n# å¼å¯äºè¿å¶æ¥å¿\nlog_bin = /usr/local/mysql-5.7.21/log/mysql-bin.log\n\n# mysql æ¸é¤è¿ææ¥å¿çæ¶é´ï¼é»è®¤å¼ 0ï¼ä¸èªå¨æ¸çï¼èæ¯ä½¿ç¨æ»å¨å¾ªç¯çæ¹å¼ã\nexpire_logs_days = 0\n\n# å¦æäºè¿å¶æ¥å¿åå¥çåå®¹è¶åºç»å®å¼ï¼æ¥å¿å°±ä¼åçæ»å¨ãä½ ä¸è½å°è¯¥åéè®¾ç½®ä¸ºå¤§äº 1gb æå°äº 4096 å­èã é»è®¤å¼æ¯ 1gbã\nmax_binlog_size = 1000m\n\n# binlog çæ ¼å¼ä¹æä¸ç§ï¼statementï¼rowï¼mixedãmysql 5.7.7 åï¼é»è®¤å¼ä» mixed æ¹ä¸º row\n# å³äº binlog æ¥å¿æ ¼å¼é®é¢ï¼è¯·æ¥éç½ç»èµæ\nbinlog_format = row\n\n# è¡¨ç¤ºæ¯ n æ¬¡åå¥ binlog åï¼æä¹åå°ç£çï¼é»è®¤å¼ n=1\n# å»ºè®®è®¾ç½®æ 1ï¼è¿æ ·å¯ä»¥ä¿è¯ mysql å¼å¸¸éå¯ä¹å binlog ä¸ä¸¢å¤±ã\n# sync_binlog = 1\n\n# myisam å¼æéç½®\n# -------------------------------------------------------------------------------\n\n# æå®ç´¢å¼ç¼å²åºçå¤§å°ï¼ä¸º myisam æ°æ®è¡¨å¼å¯ä¾çº¿ç¨å±äº«çç´¢å¼ç¼å­ï¼å¯¹ innodb å¼ææ æãç¸å½å½±å myisam çæ§è½ã\n# ä¸è¦å°å¶è®¾ç½®å¤§äºä½ å¯ç¨åå­ç 30%ï¼å ä¸ºä¸é¨ååå­åæ ·è¢« os ç¨æ¥ç¼å²è¡æ°æ®\n# çè³å¨ä½ å¹¶ä¸ä½¿ç¨ myisam è¡¨çæåµä¸ï¼ä½ ä¹éè¦ä»æ§è®¾ç½®èµ· 8-64m åå­ç±äºå®åæ ·ä¼è¢«åé¨ä¸´æ¶ç£çè¡¨ä½¿ç¨ã\n# é»è®¤å¼ 8mï¼å»ºè®®å¼ï¼å¯¹äºåå­å¨ 4gb å·¦å³çæå¡å¨è¯¥åæ°å¯è®¾ç½®ä¸º 256m æ 384mãæ³¨æï¼è¯¥åæ°å¼è®¾ç½®çè¿å¤§åèä¼æ¯æå¡å¨æ´ä½æçéä½ï¼\nkey_buffer_size = 64m\n\n# ä¸ºæ¯ä¸ªæ«æ myisam ççº¿ç¨åéåæ°è®¾ç½®çåå­å¤§å°ç¼å²åºã\n# é»è®¤å¼ 128kbï¼å»ºè®®å¼ï¼16g åå­å»ºè®® 1mï¼4gï¼128kb æè 256kb å§\n# æ³¨æï¼è¯¥ç¼å²åºæ¯æ¯ä¸ªè¿æ¥ç¬å çï¼æä»¥æ»ç¼å²åºå¤§å°ä¸º 128kb*è¿æ¥æ°ï¼æç«¯æåµ 128kb*maxconnectiosnsï¼ä¼è¶çº§å¤§ï¼æä»¥è¦èèæ¥å¸¸å¹³åè¿æ¥æ°ã\n# ä¸è¬ä¸éè¦å¤ªå³å¿è¯¥æ°å¼ï¼ç¨å¾®å¢å¤§å°±å¯ä»¥äºï¼\nread_buffer_size = 262144\n\n# æ¯æä»»ä½å­å¨å¼æ\n# mysql çéæºè¯»ç¼å²åºå¤§å°ï¼éå½å¢å¤§ï¼å¯ä»¥æé«æ§è½ã\n# é»è®¤å¼ 256kbï¼å»ºè®®å¼ï¼å¾åèè¿æ¥æ°ï¼16g åå­ï¼æäººæ¨è 8m\n# æ³¨æï¼è¯¥ç¼å²åºæ¯æ¯ä¸ªè¿æ¥ç¬å çï¼æä»¥æ»ç¼å²åºå¤§å°ä¸º 128kb*è¿æ¥æ°ï¼æç«¯æåµ 128kb*maxconnectiosnsï¼ä¼è¶çº§å¤§ï¼æä»¥è¦èèæ¥å¸¸å¹³åè¿æ¥æ°ã\nread_rnd_buffer_size = 1m\n\n# order by æ group by æ¶ç¨å°\n# æ¯æææå¼æï¼innodb å myisam æèªå·±ç innodb_sort_buffer_size å myisam_sort_buffer_size è®¾ç½®\n# é»è®¤å¼ 256kbï¼å»ºè®®å¼ï¼å¾åèè¿æ¥æ°ï¼16g åå­ï¼æäººæ¨è 8mã\n# æ³¨æï¼è¯¥ç¼å²åºæ¯æ¯ä¸ªè¿æ¥ç¬å çï¼æä»¥æ»ç¼å²åºå¤§å°ä¸º 1m*è¿æ¥æ°ï¼æç«¯æåµ 1m*maxconnectiosnsï¼ä¼è¶çº§å¤§ãæä»¥è¦èèæ¥å¸¸å¹³åè¿æ¥æ°ã\nsort_buffer_size = 1m\n\n# æ­¤ç¼å²è¢«ä½¿ç¨æ¥ä¼åå¨èå(full joins ä¸å¸¦ç´¢å¼çèå)\n# ç±»ä¼¼çèåå¨æå¤§å¤æ°æåµä¸æéå¸¸ç³ç³çæ§è½è¡¨ç°ï¼ä½æ¯å°æ­¤å¼è®¾å¤§è½å¤åè½»æ§è½å½±åã\n# éè¿ âselect_full_joinâ ç¶æåéæ¥çå¨èåçæ°é\n# æ³¨æï¼è¯¥ç¼å²åºæ¯æ¯ä¸ªè¿æ¥ç¬å çï¼æä»¥æ»ç¼å²åºå¤§å°ä¸º 1m*è¿æ¥æ°ï¼æç«¯æåµ 1m*maxconnectiosnsï¼ä¼è¶çº§å¤§ãæä»¥è¦èèæ¥å¸¸å¹³åè¿æ¥æ°ã\n# é»è®¤å¼ 256kb;å»ºè®®å¼ï¼16g åå­ï¼è®¾ç½® 8mã\njoin_buffer_size = 1m\n\n# ç¼å­ linux æä»¶æè¿°ç¬¦ä¿¡æ¯ï¼å å¿«æ°æ®æä»¶æå¼éåº¦\n# å®å½±å myisam è¡¨çæå¼å³é­ï¼ä½æ¯ä¸å½±å innodb è¡¨çæå¼å³é­ã\n# é»è®¤å¼ 2000ï¼å»ºè®®å¼ï¼æ ¹æ®ç¶æåé opened_tables å»è®¾å®\ntable_open_cache = 2000\n\n# ç¼å­è¡¨å®ä¹çç¸å³ä¿¡æ¯ï¼å å¿«è¯»åè¡¨ä¿¡æ¯éåº¦\n# é»è®¤å¼ 1400ï¼æå¤§å¼ 2000ï¼å»ºè®®å¼ï¼åºæ¬ä¸æ¹ã\ntable_definition_cache = 1400\n\n# è¯¥åæ°æ¯ myssql 5.6 åå¼å¥çï¼ç®çæ¯æé«å¹¶åã\n# é»è®¤å¼ 1ï¼å»ºè®®å¼ï¼cpu æ ¸æ°ï¼å¹¶ä¸<=16\ntable_open_cache_instances = 2\n\n# å½å®¢æ·ç«¯æ­å¼ä¹åï¼æå¡å¨å¤çæ­¤å®¢æ·ççº¿ç¨å°ä¼ç¼å­èµ·æ¥ä»¥ååºä¸ä¸ä¸ªå®¢æ·èä¸æ¯éæ¯ãå¯éç¨ï¼åå°äºç³»ç»å¼éã\n# é»è®¤å¼ä¸º 9ï¼å»ºè®®å¼ï¼ä¸¤ç§åå¼æ¹å¼ï¼æ¹å¼ä¸ï¼æ ¹æ®ç©çåå­ï¼1g â> 8ï¼2g â> 16ï¼ 3g â> 32ï¼ >3g â> 64ï¼\n# æ¹å¼äºï¼æ ¹æ® show status like 'threads%'ï¼æ¥ç threads_connected å¼ã\nthread_cache_size = 16\n\n# é»è®¤å¼ 256kï¼å»ºè®®å¼ï¼16/32g åå­ï¼512kbï¼å¶ä»ä¸è¬ä¸æ¹åï¼å¦ææ¥éï¼thread stack overrunï¼å°±å¢å¤§ççï¼\n# æ³¨æï¼æ¯ä¸ªçº¿ç¨åéåå­ç©ºé´ï¼æä»¥æ»åå­ç©ºé´ãããä½ æå¾ã\nthread_stack = 512k\n\n# innodb å¼æéç½®\n# -------------------------------------------------------------------------------\n\n# è¯´æï¼è¯¥åæ°å¯ä»¥æåæ©å±æ§åå·èé¡µæ§è½ã\n# é»è®¤å¼ 1ï¼å»ºè®®å¼ï¼4-8ï¼å¹¶ä¸å¿é¡»å°äº innodb_buffer_pool_instances\ninnodb_page_cleaners = 4\n\n# è¯´æï¼ä¸è¬ 8k å 16k ä¸­éæ©ï¼8k çè¯ï¼cpu æ¶èå°äºï¼selcet æçé«ä¸ç¹ï¼ä¸è¬ä¸ç¨æ¹\n# é»è®¤å¼ï¼16kï¼å»ºè®®å¼ï¼ä¸æ¹ï¼\ninnodb_page_size = 16384\n\n# è¯´æï¼innodb ä½¿ç¨ä¸ä¸ªç¼å²æ± æ¥ä¿å­ç´¢å¼ååå§æ°æ®ï¼ä¸å myisamãè¿éä½ è®¾ç½®è¶å¤§ï¼ä½ å¨å­åè¡¨éé¢æ°æ®æ¶æéè¦çç£ç i/o è¶å°ã\n# å¨ä¸ä¸ªç¬ç«ä½¿ç¨çæ°æ®åºæå¡å¨ä¸ï¼ä½ å¯ä»¥è®¾ç½®è¿ä¸ªåéå°æå¡å¨ç©çåå­å¤§å°ç 60%-80%\n# æ³¨æå«è®¾ç½®çè¿å¤§ï¼ä¼å¯¼è´ system ç swap ç©ºé´è¢«å ç¨ï¼å¯¼è´æä½ç³»ç»åæ¢ï¼ä»èåä½ sql æ¥è¯¢çæç\n# é»è®¤å¼ï¼128mï¼å»ºè®®å¼ï¼ç©çåå­ç 60%-80%\ninnodb_buffer_pool_size = 512m\n\n# è¯´æï¼åªæå½è®¾ç½® innodb_buffer_pool_size å¼å¤§äº 1g æ¶æææä¹ï¼å°äº 1gï¼instances é»è®¤ä¸º 1ï¼å¤§äº 1gï¼instances é»è®¤ä¸º 8\n# ä½æ¯ç½ç»ä¸æè¯ä»·ï¼æä½³æ§è½ï¼æ¯ä¸ªå®ä¾è³å° 1g å¤§å°ã\n# é»è®¤å¼ï¼1 æ 8ï¼å»ºè®®å¼ï¼innodb_buffer_pool_size/innodb_buffer_pool_instances >= 1g\ninnodb_buffer_pool_instances = 1\n\n# è¯´æï¼mysql 5.7 æ°ç¹æ§ï¼defines the chunk size for online innodb buffer pool resizing operationsã\n# å®éç¼å²åºå¤§å°å¿é¡»ä¸º innodb_buffer_pool_chunk_size*innodb_buffer_pool_instances*åæ°ï¼åç¥å¤§äº innodb_buffer_pool_size\n# é»è®¤å¼ 128mï¼å»ºè®®å¼ï¼é»è®¤å¼å°±å¥½ï¼ä¹±æ¹åèå®¹æåºé®é¢ï¼å®ä¼å½±åå®é buffer pool å¤§å°ã\ninnodb_buffer_pool_chunk_size = 128m\n\n# å¨å¯å¨æ¶æç­æ°æ®å è½½å°åå­ãé»è®¤å¼ä¸º onï¼ä¸ä¿®æ¹\ninnodb_buffer_pool_load_at_startup = 1\n\n# å¨å³é­æ¶æç­æ°æ® dump å°æ¬å°ç£çãé»è®¤å¼ä¸º onï¼ä¸ä¿®æ¹\ninnodb_buffer_pool_dump_at_shutdown = 1\n\n# è¯´æï¼å½±å innodb ç¼å²åºçå·æ°ç®æ³ï¼å»ºè®®ä»å°å°å¤§éç½®ï¼ç´å° zero free pagesï¼innodb_lru_scan_depth \\* innodb_buffer_pool_instances defines the amount of work performed by the page cleaner thread each secondã\n# é»è®¤å¼ 1024ï¼å»ºè®®å¼ï¼ æªç¥\ninnodb_lru_scan_depth = 1024\n\n# è¯´æï¼äºå¡ç­å¾è·åèµæºç­å¾çæé¿æ¶é´ï¼åä½ä¸ºç§ï¼çå·ä½ä¸å¡æåµï¼ä¸è¬é»è®¤å¼å°±å¥½\n# é»è®¤å¼ï¼50ï¼å»ºè®®å¼ï¼çä¸å¡ã\ninnodb_lock_wait_timeout = 60\n\n# è¯´æï¼è®¾ç½®äº mysql åå°ä»»å¡ï¼ä¾å¦é¡µå·æ°å merge dadta from buffer poolï¼æ¯ç§ io æä½çä¸éã\n# é»è®¤å¼ï¼200ï¼å»ºè®®å¼ï¼æ¹æ³ä¸ï¼åç sata è®¾ 100ï¼sas10ï¼raid10 è®¾ 200ï¼ssd è®¾ 2000ï¼fushion-io è®¾ 50000ï¼æ¹æ³äºï¼éè¿æµè¯å·¥å·è·å¾ç£ç io æ§è½åï¼è®¾ç½® iops æ°å¼/2ã\ninnodb_io_capacity = 2000\n\n# è¯´æï¼è¯¥åæ°æ¯ææç¼å²åºçº¿ç¨ io æä½çæ»ä¸éã\n# é»è®¤å¼ï¼innodb_io_capacity çä¸¤åãå»ºè®®å¼ï¼ä¾å¦ç¨ iometer æµè¯åç iops æ°å¼å°±å¥½\ninnodb_io_capacity_max = 4000\n\n# è¯´æï¼æ§å¶ç innodb æ°æ®æä»¶å redo log çæå¼ãå·åæ¨¡å¼ï¼ä¸ç§æ¨¡å¼ï¼fdatasync(é»è®¤)ï¼o_dsyncï¼o_direct\n# fdatasyncï¼æ°æ®æä»¶ï¼buffer pool->os buffer->ç£çï¼æ¥å¿æä»¶ï¼buffer pool->os buffer->ç£çï¼\n# o_dsyncï¼ æ°æ®æä»¶ï¼buffer pool->os buffer->ç£çï¼æ¥å¿æä»¶ï¼buffer pool->ç£çï¼\n# o_directï¼ æ°æ®æä»¶ï¼buffer pool->ç£çï¼ æ¥å¿æä»¶ï¼buffer pool->os buffer->ç£çï¼\n# é»è®¤å¼ä¸ºç©ºï¼å»ºè®®å¼ï¼ä½¿ç¨ san æè raidï¼å»ºè®®ç¨ o_directï¼ä¸ææµè¯çè¯ï¼é»è®¤çäº§ä¸ä½¿ç¨ o_direct\ninnodb_flush_method = o_direct\n\n# è¯´æï¼mysql5.7 ä¹åé»è®¤å¼å¯ï¼æææ¯ï¼æ¯å¼ è¡¨ä¸ä¸ªç¬ç«è¡¨ç©ºé´ã\n# é»è®¤å¼ 1ï¼å¼å¯\ninnodb_file_per_table = 1\n\n# è¯´æï¼the path where innodb creates undo tablespacesãéå¸¸ç­äº undo log æä»¶çå­æ¾ç®å½ã\n# é»è®¤å¼ ./;èªè¡è®¾ç½®\ninnodb_undo_directory = /usr/local/mysql-5.7.21/log\n\n# è¯´æï¼the number of undo tablespaces used by innodb ç­äº undo log æä»¶æ°éã5.7.21 åå¼å§å¼ç¨\n# é»è®¤å¼ä¸º 0ï¼å»ºè®®é»è®¤å¼å°±å¥½ï¼ä¸ç¨è°æ´äºã\ninnodb_undo_tablespaces = 0\n\n# è¯´æï¼å®ä¹ undo ä½¿ç¨çåæ»æ®µæ°éã5.7.19 åå¼ç¨\n# é»è®¤å¼ 128ï¼å»ºè®®ä¸å¨ï¼ä»¥åå¼ç¨äºã\ninnodb_undo_logs = 128\n\n# è¯´æï¼5.7.5 åå¼å§ä½¿ç¨ï¼å¨çº¿æ¶ç¼© undo log ä½¿ç¨çç©ºé´ã\n# é»è®¤å¼ï¼å³é­ï¼å»ºè®®å¼ï¼å¼å¯\ninnodb_undo_log_truncate = 1\n\n# è¯´æï¼ç»å innodb_undo_log_truncateï¼å®ç° undo ç©ºé´æ¶ç¼©åè½\n# é»è®¤å¼ï¼1gï¼å»ºè®®å¼ï¼ä¸æ¹ã\ninnodb_max_undo_log_size = 1g\n\n# è¯´æï¼éä½æ¥å¿æä»¶çå­æ¾ç®å½\ninnodb_log_group_home_dir = /usr/local/mysql-5.7.21/log\n\n# è¯´æï¼æ¥å¿æä»¶çå¤§å°\n# é»è®¤å¼ï¼48mï¼å»ºè®®å¼ï¼æ ¹æ®ä½ ç³»ç»çç£çç©ºé´åæ¥å¿å¢é¿æåµè°æ´å¤§å°\ninnodb_log_file_size = 128m\n\n# è¯´æï¼æ¥å¿ç»ä¸­çæä»¶æ°éï¼mysql ä»¥å¾ªç¯æ¹å¼åå¥æ¥å¿\n# é»è®¤å¼ 2ï¼å»ºè®®å¼ï¼æ ¹æ®ä½ ç³»ç»çç£çç©ºé´åæ¥å¿å¢é¿æåµè°æ´å¤§å°\ninnodb_log_files_in_group = 3\n\n# æ­¤åæ°ç¡®å®äºæ¥å¿æä»¶æç¨çåå­å¤§å°ï¼ä»¥ m ä¸ºåä½ãç¼å²åºæ´å¤§è½æé«æ§è½ï¼ä½æå¤çæéå°ä¼ä¸¢å¤±æ°æ®ãmysql å¼åäººåå»ºè®®è®¾ç½®ä¸º 1ï¼8m ä¹é´\ninnodb_log_buffer_size = 16m\n\n# è¯´æï¼å¯ä»¥æ§å¶ log ä»ç³»ç» buffer å·å¥ç£çæä»¶çå·æ°é¢çï¼å¢å¤§å¯åè½»ç³»ç»è´è·\n# é»è®¤å¼æ¯ 1ï¼å»ºè®®å¼ä¸æ¹ãç³»ç»æ§è½ä¸è¬å¤ç¨ã\ninnodb_flush_log_at_timeout = 1\n\n# è¯´æï¼åæ°å¯è®¾ä¸º 0ï¼1ï¼2ï¼\n# åæ° 0ï¼è¡¨ç¤ºæ¯ç§å° log buffer åå®¹å·æ°å°ç³»ç» buffer ä¸­ï¼åè°ç¨ç³»ç» flush æä½åå¥ç£çæä»¶ã\n# åæ° 1ï¼è¡¨ç¤ºæ¯æ¬¡äºå¡æäº¤ï¼redo log é½ç´æ¥æä¹åå°ç£çã\n# åæ° 2ï¼è¡¨ç¤ºæ¯æ¬¡äºå¡æäº¤ï¼é 1 ç§ååå° redo log æä¹åå°ç£çã\n# å»ºè®®è®¾ç½®æ 1ï¼è¿æ ·å¯ä»¥ä¿è¯ mysql å¼å¸¸éå¯ä¹åæ°æ®ä¸ä¸¢å¤±ã\ninnodb_flush_log_at_trx_commit = 1\n\n# è¯´æï¼éå¶ innodb è½æå¼çè¡¨çæ°æ®ï¼å¦æåºéçè¡¨ç¹å«å¤çæåµï¼è¯·å¢å è¿ä¸ªã\n# å¼é»è®¤æ¯ 2000ï¼å»ºè®®å¼ï¼åèæ°æ®åºè¡¨æ»æ°åè¿è¡è°æ´ï¼ä¸è¬å¤ç¨ä¸ç¨è°æ´ã\ninnodb_open_files = 8192\n\n# innodb å¤ç io è¯»åçåå°å¹¶åçº¿ç¨æ°éï¼æ ¹æ® cpu æ ¸æ¥ç¡®è®¤ï¼åå¼èå´ï¼1-64\n# é»è®¤å¼ï¼4ï¼å»ºè®®å¼ï¼ä¸é»è¾ cpu æ°éçä¸åä¿æä¸è´ã\ninnodb_read_io_threads = 4\ninnodb_write_io_threads = 4\n\n# é»è®¤è®¾ç½®ä¸º 0ï¼è¡¨ç¤ºä¸éå¶å¹¶åæ°ï¼è¿éæ¨èè®¾ç½®ä¸º 0ï¼æ´å¥½å»åæ¥ cpu å¤æ ¸å¤çè½åï¼æé«å¹¶åé\ninnodb_thread_concurrency = 0\n\n# é»è®¤å¼ä¸º 4ï¼å»ºè®®ä¸åãinnodb ä¸­çæ¸é¤æä½æ¯ä¸ç±»å®æåæ¶æ ç¨æ°æ®çæä½ãmysql 5.5 ä¹åï¼æ¯æå¤çº¿ç¨æ¸é¤æä½ã\ninnodb_purge_threads = 4\n\n# è¯´æï¼mysql ç¼å²åºåä¸º new blocks å old blocksï¼æ­¤åæ°è¡¨ç¤º old blocks å æ¯ï¼\n# é»è®¤å¼ï¼37ï¼å»ºè®®å¼ï¼ä¸è¬ä¸å¨\ninnodb_old_blocks_pct = 37\n\n# è¯´æï¼æ°æ°æ®è¢«è½½å¥ç¼å²æ± ï¼è¿å¥ old pages é¾åºï¼å½ 1 ç§ååæ¬¡è®¿é®ï¼åæåè¿å¥ new pages é¾åºã\n# é»è®¤å¼ï¼1000\ninnodb_old_blocks_time=1000\n\n# è¯´æï¼å¼å¯å¼æ­¥ ioï¼å¯ä»¥æé«å¹¶åæ§ï¼é»è®¤å¼å¯ã\n# é»è®¤å¼ä¸º 1ï¼å»ºè®®ä¸å¨\ninnodb_use_native_aio = 1\n\n# è¯´æï¼é»è®¤ä¸ºç©ºï¼ä½¿ç¨ data ç®å½ï¼ä¸è¬ä¸æ¹ã\ninnodb_data_home_dir=/usr/local/mysql-5.7.21/data\n\n# è¯´æï¼defines the nameï¼sizeï¼and attributes of innodb system tablespace data filesã\n# é»è®¤å¼ï¼ä¸æå®ï¼é»è®¤ä¸º ibdata1ï¼12mï¼autoextend\ninnodb_data_file_path = ibdata1ï¼12mï¼autoextend\n\n# è¯´æï¼è®¾ç½®äº innodb å­å¨å¼æç¨æ¥å­æ¾æ°æ®å­å¸ä¿¡æ¯ä»¥åä¸äºåé¨æ°æ®ç»æçåå­ç©ºé´å¤§å°ï¼é¤éä½ çæ°æ®å¯¹è±¡åå¶å¤ï¼å¦åä¸è¬é»è®¤ä¸æ¹ã\n# innodb_additional_mem_pool_size = 16m\n# è¯´æï¼the crash recovery modeãåªæç´§æ¥æåµéè¦æ¢å¤æ°æ®çæ¶åï¼ææ¹ä¸ºå¤§äº 1-6 ä¹é´æ°å¼ï¼å«ä¹æ¥ä¸å®ç½ã\n# é»è®¤å¼ä¸º 0ï¼\n#innodb_force_recovery = 0\n\n\n\n[mysqldump]\n\n# quick éé¡¹å¼ºå¶ mysqldump ä»æå¡å¨æ¥è¯¢åå¾è®°å½ç´æ¥è¾åºèä¸æ¯åå¾ææè®°å½åå°å®ä»¬ç¼å­å°åå­ä¸­\nquick\n\nmax_allowed_packet = 16m\n\n\n\n[mysql]\n\n# mysql å½ä»¤è¡å·¥å·ä¸ä½¿ç¨èªå¨è¡¥å¨åè½ï¼å»ºè®®è¿æ¯æ¹ä¸º\n# no-auto-rehash\nauto-rehash\n\n# socket æä»¶\nsocket = /var/lib/mysql/mysql.sock\n\n\n\n# åèèµæ\n\n * ãé«æ§è½ mysqlã\n * mysql éç½®æä»¶/etc/my.cnf è§£æ",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Mysql æç¨",frontmatter:{title:"Mysql æç¨",date:"2020-02-10T14:27:39.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],permalink:"/pages/a5b63b/",hidden:!0},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/02.Mysql/",relativePath:"12.æ°æ®åº/03.å³ç³»åæ°æ®åº/02.Mysql/README.md",key:"v-74c83129",path:"/pages/a5b63b/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:17},{level:3,title:"Mysql åºç¨æå",slug:"mysql-åºç¨æå",normalizedTitle:"mysql åºç¨æå",charIndex:27},{level:3,title:"Mysql å·¥ä½æµ",slug:"mysql-å·¥ä½æµ",normalizedTitle:"mysql å·¥ä½æµ",charIndex:42},{level:3,title:"Mysql äºå¡",slug:"mysql-äºå¡",normalizedTitle:"mysql äºå¡",charIndex:56},{level:3,title:"Mysql é",slug:"mysql-é",normalizedTitle:"mysql é",charIndex:110},{level:3,title:"Mysql ç´¢å¼",slug:"mysql-ç´¢å¼",normalizedTitle:"mysql ç´¢å¼",charIndex:163},{level:3,title:"Mysql æ§è½ä¼å",slug:"mysql-æ§è½ä¼å",normalizedTitle:"mysql æ§è½ä¼å",charIndex:202},{level:3,title:"Mysql è¿ç»´ ð¨",slug:"mysql-è¿ç»´-ð¨",normalizedTitle:"mysql è¿ç»´ ð¨",charIndex:217},{level:3,title:"Mysql éç½® ð¨",slug:"mysql-éç½®-ð¨",normalizedTitle:"mysql éç½® ð¨",charIndex:233},{level:3,title:"Mysql å¸¸è§é®é¢",slug:"mysql-å¸¸è§é®é¢",normalizedTitle:"mysql å¸¸è§é®é¢",charIndex:249},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:264},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:504}],headersStr:"ð åå®¹ Mysql åºç¨æå Mysql å·¥ä½æµ Mysql äºå¡ Mysql é Mysql ç´¢å¼ Mysql æ§è½ä¼å Mysql è¿ç»´ ð¨ Mysql éç½® ð¨ Mysql å¸¸è§é®é¢ ð èµæ ðª ä¼ é",content:"# Mysql æç¨\n\n\n\n\n# ð åå®¹\n\n\n# Mysql åºç¨æå\n\n\n# Mysql å·¥ä½æµ\n\n\n# Mysql äºå¡\n\n> å³é®è¯ï¼ACIDãAUTOCOMMITãäºå¡éç¦»çº§å«ãæ­»éãåå¸å¼äºå¡\n\n\n\n\n# Mysql é\n\n> å³é®è¯ï¼ä¹è§éãè¡¨çº§éãè¡çº§éãæåéãMVCCãNext-key é\n\n\n\n\n# Mysql ç´¢å¼\n\n> å³é®è¯ï¼HashãB æ ãèç°ç´¢å¼ãåè¡¨\n\n\n\n\n# Mysql æ§è½ä¼å\n\n\n# Mysql è¿ç»´ ð¨\n\n\n# Mysql éç½® ð¨\n\n\n# Mysql å¸¸è§é®é¢\n\n\n# ð èµæ\n\n * å®æ¹\n   * Mysql å®ç½\n   * Mysql å®æ¹ææ¡£\n   * Mysql å®æ¹ææ¡£ä¹å½ä»¤è¡å®¢æ·ç«¯\n * ä¹¦ç±\n   * ãé«æ§è½ MySQLã - ç»å¸ï¼éå DBA æä½ä¸ºå¼åèçåèæå\n   * ãMySQL å¿ç¥å¿ä¼ã - éåå¥é¨è\n * æç¨\n   * MySQL å®æ 45 è®²\n   * runoob.com MySQL æç¨\n   * mysql-tutorial\n * æ´å¤èµæº\n   * awesome-mysql\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç IT ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",normalizedContent:"# mysql æç¨\n\n\n\n\n# ð åå®¹\n\n\n# mysql åºç¨æå\n\n\n# mysql å·¥ä½æµ\n\n\n# mysql äºå¡\n\n> å³é®è¯ï¼acidãautocommitãäºå¡éç¦»çº§å«ãæ­»éãåå¸å¼äºå¡\n\n\n\n\n# mysql é\n\n> å³é®è¯ï¼ä¹è§éãè¡¨çº§éãè¡çº§éãæåéãmvccãnext-key é\n\n\n\n\n# mysql ç´¢å¼\n\n> å³é®è¯ï¼hashãb æ ãèç°ç´¢å¼ãåè¡¨\n\n\n\n\n# mysql æ§è½ä¼å\n\n\n# mysql è¿ç»´ ð¨\n\n\n# mysql éç½® ð¨\n\n\n# mysql å¸¸è§é®é¢\n\n\n# ð èµæ\n\n * å®æ¹\n   * mysql å®ç½\n   * mysql å®æ¹ææ¡£\n   * mysql å®æ¹ææ¡£ä¹å½ä»¤è¡å®¢æ·ç«¯\n * ä¹¦ç±\n   * ãé«æ§è½ mysqlã - ç»å¸ï¼éå dba æä½ä¸ºå¼åèçåèæå\n   * ãmysql å¿ç¥å¿ä¼ã - éåå¥é¨è\n * æç¨\n   * mysql å®æ 45 è®²\n   * runoob.com mysql æç¨\n   * mysql-tutorial\n * æ´å¤èµæº\n   * awesome-mysql\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç it ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"PostgreSQL åºç¨æå",frontmatter:{title:"PostgreSQL åºç¨æå",date:"2019-08-22T09:02:39.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","å¶ä»"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","PostgreSQL"],permalink:"/pages/52609d/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/99.%E5%85%B6%E4%BB%96/01.PostgreSQL.html",relativePath:"12.æ°æ®åº/03.å³ç³»åæ°æ®åº/99.å¶ä»/01.PostgreSQL.md",key:"v-5a900e2a",path:"/pages/52609d/",headers:[{level:2,title:"å®è£",slug:"å®è£",normalizedTitle:"å®è£",charIndex:85},{level:2,title:"æ·»å æ°ç¨æ·åæ°æ°æ®åº",slug:"æ·»å æ°ç¨æ·åæ°æ°æ®åº",normalizedTitle:"æ·»å æ°ç¨æ·åæ°æ°æ®åº",charIndex:612},{level:2,title:"ç»å½æ°æ®åº",slug:"ç»å½æ°æ®åº",normalizedTitle:"ç»å½æ°æ®åº",charIndex:866},{level:2,title:"æ§å¶å°å½ä»¤",slug:"æ§å¶å°å½ä»¤",normalizedTitle:"æ§å¶å°å½ä»¤",charIndex:1897},{level:2,title:"æ°æ®åºæä½",slug:"æ°æ®åºæä½",normalizedTitle:"æ°æ®åºæä½",charIndex:1247},{level:2,title:"å¤ä»½åæ¢å¤",slug:"å¤ä»½åæ¢å¤",normalizedTitle:"å¤ä»½åæ¢å¤",charIndex:2901},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:3037},{level:2,title:"ðª ä¼ éé¨",slug:"ä¼ éé¨",normalizedTitle:"ðª ä¼ éé¨",charIndex:3166}],headersStr:"å®è£ æ·»å æ°ç¨æ·åæ°æ°æ®åº ç»å½æ°æ®åº æ§å¶å°å½ä»¤ æ°æ®åºæä½ å¤ä»½åæ¢å¤ åèèµæ ðª ä¼ éé¨",content:"# PostgreSQL åºç¨æå\n\n> PostgreSQL æ¯ä¸ä¸ªå³ç³»åæ°æ®åºï¼RDBMï¼ã\n> \n> å³é®è¯ï¼Database, RDBM, psql\n\n\n\n\n# å®è£\n\n> æ¬æä»ä»¥è¿è¡å¨ Centos ç¯å¢ä¸ä¸¾ä¾ã\n\nè¿å¥å®æ¹ä¸è½½é¡µé¢ï¼æ ¹æ®æä½ç³»ç»éæ©åéçæ¬ã\n\nå®æ¹ä¸è½½é¡µé¢è¦æ±ç¨æ·éæ©ç¸åºçæ¬ï¼ç¶åå¨æçç»åºå®è£æç¤ºï¼å¦ä¸å¾æç¤ºï¼\n\n\n\nå 3 æ­¥è¦æ±ç¨æ·éæ©ï¼å 4 æ­¥æ¯æ ¹æ®éæ©å¨ææç¤ºçå®è£æ­¥éª¤\n\nï¼1ï¼éæ© PostgreSQL çæ¬\n\nï¼2ï¼éæ©å¹³å°\n\nï¼3ï¼éæ©æ¶æ\n\nï¼4ï¼å®è£ PostgreSQL ç rpm ä»åºï¼ä¸ºäºè¯å«ä¸è½½æºï¼\n\nyum install https://download.postgresql.org/pub/repos/yum/10/redhat/rhel-7-x86_64/pgdg-centos10-10-2.noarch.rpm\n\n\nï¼5ï¼å®è£å®¢æ·ç«¯\n\nyum install postgresql10\n\n\nï¼6ï¼å®è£æå¡ç«¯ï¼å¯éçï¼\n\nyum install postgresql10-server\n\n\nï¼7ï¼è®¾ç½®å¼æºå¯å¨ï¼å¯éçï¼\n\n/usr/pgsql-10/bin/postgresql-10-setup initdb\nsystemctl enable postgresql-10\nsystemctl start postgresql-10\n\n\n\n# æ·»å æ°ç¨æ·åæ°æ°æ®åº\n\nåæ¬¡å®è£åï¼é»è®¤çæä¸ä¸ªåä¸º postgres çæ°æ®åºåä¸ä¸ªåä¸º postgres çæ°æ®åºç¨æ·ãè¿ééè¦æ³¨æçæ¯ï¼åæ¶è¿çæäºä¸ä¸ªåä¸º postgres ç Linux ç³»ç»ç¨æ·ã\n\né¦åï¼æ°å»ºä¸ä¸ª Linux æ°ç¨æ·ï¼å¯ä»¥åä½ æ³è¦çåå­ï¼è¿éä¸º dbuserã\n\nsudo adduser dbuser\n\n\nä½¿ç¨ psql å½ä»¤ç»å½ PostgreSQL æ§å¶å°ï¼\n\nsudo -u postgres psql\n\n\nè¿æ¶ç¸å½äºç³»ç»ç¨æ· postgres ä»¥ååæ°æ®åºç¨æ·çèº«ä»½ï¼ç»å½æ°æ®åºï¼è¿æ¯ä¸ç¨è¾å¥å¯ç çãå¦æä¸åæ­£å¸¸ï¼ç³»ç»æç¤ºç¬¦ä¼åä¸º\"postgres=#\"ï¼è¡¨ç¤ºè¿æ¶å·²ç»è¿å¥äºæ°æ®åºæ§å¶å°ãä»¥ä¸çå½ä»¤é½å¨æ§å¶å°åå®æã\n\nï¼1ï¼ä½¿ç¨ \\password å½ä»¤ï¼ä¸º postgres ç¨æ·è®¾ç½®ä¸ä¸ªå¯ç ã\n\npostgres=# \\password postgres\n\n\nï¼2ï¼åå»ºæ°æ®åºç¨æ· dbuserï¼åæåå»ºçæ¯ Linux ç³»ç»ç¨æ·ï¼ï¼å¹¶è®¾ç½®å¯ç ã\n\nCREATE USER dbuser WITH PASSWORD 'password';\n\n\nï¼3ï¼åå»ºç¨æ·æ°æ®åºï¼è¿éä¸º exampledbï¼å¹¶æå®ææèä¸º dbuserã\n\nCREATE DATABASE exampledb OWNER dbuser;\n\n\nï¼4ï¼å° exampledb æ°æ®åºçæææéé½èµäº dbuserï¼å¦å dbuser åªè½ç»å½æ§å¶å°ï¼æ²¡æä»»ä½æ°æ®åºæä½æéã\n\nGRANT ALL PRIVILEGES ON DATABASE exampledb to dbuser;\n\n\nï¼5ï¼ä½¿ç¨\\q å½ä»¤éåºæ§å¶å°ï¼ä¹å¯ä»¥ç´æ¥æ ctrl+Dï¼ã\n\n\n# ç»å½æ°æ®åº\n\næ·»å æ°ç¨æ·åæ°æ°æ®åºä»¥åï¼å°±è¦ä»¥æ°ç¨æ·çåä¹ç»å½æ°æ®åºï¼è¿æ¶ä½¿ç¨çæ¯ psql å½ä»¤ã\n\npsql -U dbuser -d exampledb -h 127.0.0.1 -p 5432\n\n\nä¸é¢å½ä»¤çåæ°å«ä¹å¦ä¸ï¼-U æå®ç¨æ·ï¼-d æå®æ°æ®åºï¼-h æå®æå¡å¨ï¼-p æå®ç«¯å£ã\n\nè¾å¥ä¸é¢å½ä»¤ä»¥åï¼ç³»ç»ä¼æç¤ºè¾å¥ dbuser ç¨æ·çå¯ç ãè¾å¥æ­£ç¡®ï¼å°±å¯ä»¥ç»å½æ§å¶å°äºã\n\npsql å½ä»¤å­å¨ç®åå½¢å¼ãå¦æå½å Linux ç³»ç»ç¨æ·ï¼åæ¶ä¹æ¯ PostgreSQL ç¨æ·ï¼åå¯ä»¥çç¥ç¨æ·åï¼-U åæ°çé¨åï¼ãä¸¾ä¾æ¥è¯´ï¼æç Linux ç³»ç»ç¨æ·åä¸º ruanyfï¼ä¸ PostgreSQL æ°æ®åºå­å¨ååç¨æ·ï¼åæä»¥ ruanyf èº«ä»½ç»å½ Linux ç³»ç»åï¼å¯ä»¥ç´æ¥ä½¿ç¨ä¸é¢çå½ä»¤ç»å½æ°æ®åºï¼ä¸ä¸éè¦å¯ç ã\n\npsql exampledb\n\n\næ­¤æ¶ï¼å¦æ PostgreSQL åé¨è¿å­å¨ä¸å½åç³»ç»ç¨æ·ååçæ°æ®åºï¼åè¿æ°æ®åºåé½å¯ä»¥çç¥ãæ¯å¦ï¼åå®å­å¨ä¸ä¸ªå«å ruanyf çæ°æ®åºï¼åç´æ¥é®å¥ psql å°±å¯ä»¥ç»å½è¯¥æ°æ®åºã\n\npsql\n\nå¦å¤ï¼å¦æè¦æ¢å¤å¤é¨æ°æ®ï¼å¯ä»¥ä½¿ç¨ä¸é¢çå½ä»¤ã\n\npsql exampledb < exampledb.sql\n\n\n\n# æ§å¶å°å½ä»¤\n\né¤äºåé¢å·²ç»ç¨å°ç \\password å½ä»¤ï¼è®¾ç½®å¯ç ï¼å \\q å½ä»¤ï¼éåºï¼ä»¥å¤ï¼æ§å¶å°è¿æä¾ä¸ç³»åå¶ä»å½ä»¤ã\n\n\\password           è®¾ç½®å¯ç \n\\q                  éåº\n\\h                  æ¥çSQLå½ä»¤çè§£éï¼æ¯å¦\\h select\n\\?                  æ¥çpsqlå½ä»¤åè¡¨\n\\l                  ååºæææ°æ®åº\n\\c [database_name]  è¿æ¥å¶ä»æ°æ®åº\n\\d                  ååºå½åæ°æ®åºçææè¡¨æ ¼\n\\d [table_name]     ååºæä¸å¼ è¡¨æ ¼çç»æ\n\\x                  å¯¹æ°æ®åå±å¼æä½\n\\du                 ååºææç¨æ·\n\n\n\n# æ°æ®åºæä½\n\nåºæ¬çæ°æ®åºæä½ï¼å°±æ¯ä½¿ç¨ä¸è¬ç SQL è¯­è¨ã\n\n# åå»ºæ°è¡¨\nCREATE TABLE user_tbl(name VARCHAR(20), signup_date DATE);\n# æå¥æ°æ®\nINSERT INTO user_tbl(name, signup_date) VALUES('å¼ ä¸', '2013-12-22');\n# éæ©è®°å½\nSELECT * FROM user_tbl;\n# æ´æ°æ°æ®\nUPDATE user_tbl set name = 'æå' WHERE name = 'å¼ ä¸';\n# å é¤è®°å½\nDELETE FROM user_tbl WHERE name = 'æå' ;\n# æ·»å æ ä½\nALTER TABLE user_tbl ADD email VARCHAR(40);\n# æ´æ°ç»æ\nALTER TABLE user_tbl ALTER COLUMN signup_date SET NOT NULL;\n# æ´åæ ä½\nALTER TABLE user_tbl RENAME COLUMN signup_date TO signup;\n# å é¤æ ä½\nALTER TABLE user_tbl DROP COLUMN email;\n# è¡¨æ ¼æ´å\nALTER TABLE user_tbl RENAME TO backup_tbl;\n# å é¤è¡¨æ ¼\nDROP TABLE IF EXISTS backup_tbl;\n\n\n\n# å¤ä»½åæ¢å¤\n\npg_dump --format=t -d db_name -U user_name -h 127.0.0.1 -O -W  > dump.sql\npsql -h 127.0.0.1 -U user_name db_name < dump.sql\n\n\n\n# åèèµæ\n\n * https://www.postgresql.org/download/\n * http://www.ruanyifeng.com/blog/2013/12/getting_started_with_postgresql.html\n\n\n# ðª ä¼ éé¨\n\n| éæçåå®¢ | db-tutorial é¦é¡µ |",normalizedContent:"# postgresql åºç¨æå\n\n> postgresql æ¯ä¸ä¸ªå³ç³»åæ°æ®åºï¼rdbmï¼ã\n> \n> å³é®è¯ï¼database, rdbm, psql\n\n\n\n\n# å®è£\n\n> æ¬æä»ä»¥è¿è¡å¨ centos ç¯å¢ä¸ä¸¾ä¾ã\n\nè¿å¥å®æ¹ä¸è½½é¡µé¢ï¼æ ¹æ®æä½ç³»ç»éæ©åéçæ¬ã\n\nå®æ¹ä¸è½½é¡µé¢è¦æ±ç¨æ·éæ©ç¸åºçæ¬ï¼ç¶åå¨æçç»åºå®è£æç¤ºï¼å¦ä¸å¾æç¤ºï¼\n\n\n\nå 3 æ­¥è¦æ±ç¨æ·éæ©ï¼å 4 æ­¥æ¯æ ¹æ®éæ©å¨ææç¤ºçå®è£æ­¥éª¤\n\nï¼1ï¼éæ© postgresql çæ¬\n\nï¼2ï¼éæ©å¹³å°\n\nï¼3ï¼éæ©æ¶æ\n\nï¼4ï¼å®è£ postgresql ç rpm ä»åºï¼ä¸ºäºè¯å«ä¸è½½æºï¼\n\nyum install https://download.postgresql.org/pub/repos/yum/10/redhat/rhel-7-x86_64/pgdg-centos10-10-2.noarch.rpm\n\n\nï¼5ï¼å®è£å®¢æ·ç«¯\n\nyum install postgresql10\n\n\nï¼6ï¼å®è£æå¡ç«¯ï¼å¯éçï¼\n\nyum install postgresql10-server\n\n\nï¼7ï¼è®¾ç½®å¼æºå¯å¨ï¼å¯éçï¼\n\n/usr/pgsql-10/bin/postgresql-10-setup initdb\nsystemctl enable postgresql-10\nsystemctl start postgresql-10\n\n\n\n# æ·»å æ°ç¨æ·åæ°æ°æ®åº\n\nåæ¬¡å®è£åï¼é»è®¤çæä¸ä¸ªåä¸º postgres çæ°æ®åºåä¸ä¸ªåä¸º postgres çæ°æ®åºç¨æ·ãè¿ééè¦æ³¨æçæ¯ï¼åæ¶è¿çæäºä¸ä¸ªåä¸º postgres ç linux ç³»ç»ç¨æ·ã\n\né¦åï¼æ°å»ºä¸ä¸ª linux æ°ç¨æ·ï¼å¯ä»¥åä½ æ³è¦çåå­ï¼è¿éä¸º dbuserã\n\nsudo adduser dbuser\n\n\nä½¿ç¨ psql å½ä»¤ç»å½ postgresql æ§å¶å°ï¼\n\nsudo -u postgres psql\n\n\nè¿æ¶ç¸å½äºç³»ç»ç¨æ· postgres ä»¥ååæ°æ®åºç¨æ·çèº«ä»½ï¼ç»å½æ°æ®åºï¼è¿æ¯ä¸ç¨è¾å¥å¯ç çãå¦æä¸åæ­£å¸¸ï¼ç³»ç»æç¤ºç¬¦ä¼åä¸º\"postgres=#\"ï¼è¡¨ç¤ºè¿æ¶å·²ç»è¿å¥äºæ°æ®åºæ§å¶å°ãä»¥ä¸çå½ä»¤é½å¨æ§å¶å°åå®æã\n\nï¼1ï¼ä½¿ç¨ \\password å½ä»¤ï¼ä¸º postgres ç¨æ·è®¾ç½®ä¸ä¸ªå¯ç ã\n\npostgres=# \\password postgres\n\n\nï¼2ï¼åå»ºæ°æ®åºç¨æ· dbuserï¼åæåå»ºçæ¯ linux ç³»ç»ç¨æ·ï¼ï¼å¹¶è®¾ç½®å¯ç ã\n\ncreate user dbuser with password 'password';\n\n\nï¼3ï¼åå»ºç¨æ·æ°æ®åºï¼è¿éä¸º exampledbï¼å¹¶æå®ææèä¸º dbuserã\n\ncreate database exampledb owner dbuser;\n\n\nï¼4ï¼å° exampledb æ°æ®åºçæææéé½èµäº dbuserï¼å¦å dbuser åªè½ç»å½æ§å¶å°ï¼æ²¡æä»»ä½æ°æ®åºæä½æéã\n\ngrant all privileges on database exampledb to dbuser;\n\n\nï¼5ï¼ä½¿ç¨\\q å½ä»¤éåºæ§å¶å°ï¼ä¹å¯ä»¥ç´æ¥æ ctrl+dï¼ã\n\n\n# ç»å½æ°æ®åº\n\næ·»å æ°ç¨æ·åæ°æ°æ®åºä»¥åï¼å°±è¦ä»¥æ°ç¨æ·çåä¹ç»å½æ°æ®åºï¼è¿æ¶ä½¿ç¨çæ¯ psql å½ä»¤ã\n\npsql -u dbuser -d exampledb -h 127.0.0.1 -p 5432\n\n\nä¸é¢å½ä»¤çåæ°å«ä¹å¦ä¸ï¼-u æå®ç¨æ·ï¼-d æå®æ°æ®åºï¼-h æå®æå¡å¨ï¼-p æå®ç«¯å£ã\n\nè¾å¥ä¸é¢å½ä»¤ä»¥åï¼ç³»ç»ä¼æç¤ºè¾å¥ dbuser ç¨æ·çå¯ç ãè¾å¥æ­£ç¡®ï¼å°±å¯ä»¥ç»å½æ§å¶å°äºã\n\npsql å½ä»¤å­å¨ç®åå½¢å¼ãå¦æå½å linux ç³»ç»ç¨æ·ï¼åæ¶ä¹æ¯ postgresql ç¨æ·ï¼åå¯ä»¥çç¥ç¨æ·åï¼-u åæ°çé¨åï¼ãä¸¾ä¾æ¥è¯´ï¼æç linux ç³»ç»ç¨æ·åä¸º ruanyfï¼ä¸ postgresql æ°æ®åºå­å¨ååç¨æ·ï¼åæä»¥ ruanyf èº«ä»½ç»å½ linux ç³»ç»åï¼å¯ä»¥ç´æ¥ä½¿ç¨ä¸é¢çå½ä»¤ç»å½æ°æ®åºï¼ä¸ä¸éè¦å¯ç ã\n\npsql exampledb\n\n\næ­¤æ¶ï¼å¦æ postgresql åé¨è¿å­å¨ä¸å½åç³»ç»ç¨æ·ååçæ°æ®åºï¼åè¿æ°æ®åºåé½å¯ä»¥çç¥ãæ¯å¦ï¼åå®å­å¨ä¸ä¸ªå«å ruanyf çæ°æ®åºï¼åç´æ¥é®å¥ psql å°±å¯ä»¥ç»å½è¯¥æ°æ®åºã\n\npsql\n\nå¦å¤ï¼å¦æè¦æ¢å¤å¤é¨æ°æ®ï¼å¯ä»¥ä½¿ç¨ä¸é¢çå½ä»¤ã\n\npsql exampledb < exampledb.sql\n\n\n\n# æ§å¶å°å½ä»¤\n\né¤äºåé¢å·²ç»ç¨å°ç \\password å½ä»¤ï¼è®¾ç½®å¯ç ï¼å \\q å½ä»¤ï¼éåºï¼ä»¥å¤ï¼æ§å¶å°è¿æä¾ä¸ç³»åå¶ä»å½ä»¤ã\n\n\\password           è®¾ç½®å¯ç \n\\q                  éåº\n\\h                  æ¥çsqlå½ä»¤çè§£éï¼æ¯å¦\\h select\n\\?                  æ¥çpsqlå½ä»¤åè¡¨\n\\l                  ååºæææ°æ®åº\n\\c [database_name]  è¿æ¥å¶ä»æ°æ®åº\n\\d                  ååºå½åæ°æ®åºçææè¡¨æ ¼\n\\d [table_name]     ååºæä¸å¼ è¡¨æ ¼çç»æ\n\\x                  å¯¹æ°æ®åå±å¼æä½\n\\du                 ååºææç¨æ·\n\n\n\n# æ°æ®åºæä½\n\nåºæ¬çæ°æ®åºæä½ï¼å°±æ¯ä½¿ç¨ä¸è¬ç sql è¯­è¨ã\n\n# åå»ºæ°è¡¨\ncreate table user_tbl(name varchar(20), signup_date date);\n# æå¥æ°æ®\ninsert into user_tbl(name, signup_date) values('å¼ ä¸', '2013-12-22');\n# éæ©è®°å½\nselect * from user_tbl;\n# æ´æ°æ°æ®\nupdate user_tbl set name = 'æå' where name = 'å¼ ä¸';\n# å é¤è®°å½\ndelete from user_tbl where name = 'æå' ;\n# æ·»å æ ä½\nalter table user_tbl add email varchar(40);\n# æ´æ°ç»æ\nalter table user_tbl alter column signup_date set not null;\n# æ´åæ ä½\nalter table user_tbl rename column signup_date to signup;\n# å é¤æ ä½\nalter table user_tbl drop column email;\n# è¡¨æ ¼æ´å\nalter table user_tbl rename to backup_tbl;\n# å é¤è¡¨æ ¼\ndrop table if exists backup_tbl;\n\n\n\n# å¤ä»½åæ¢å¤\n\npg_dump --format=t -d db_name -u user_name -h 127.0.0.1 -o -w  > dump.sql\npsql -h 127.0.0.1 -u user_name db_name < dump.sql\n\n\n\n# åèèµæ\n\n * https://www.postgresql.org/download/\n * http://www.ruanyifeng.com/blog/2013/12/getting_started_with_postgresql.html\n\n\n# ðª ä¼ éé¨\n\n| éæçåå®¢ | db-tutorial é¦é¡µ |",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"H2 åºç¨æå",frontmatter:{title:"H2 åºç¨æå",date:"2019-08-22T09:02:39.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","å¶ä»"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","H2"],permalink:"/pages/f27c0c/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/99.%E5%85%B6%E4%BB%96/02.H2.html",relativePath:"12.æ°æ®åº/03.å³ç³»åæ°æ®åº/99.å¶ä»/02.H2.md",key:"v-7b0ce341",path:"/pages/f27c0c/",headers:[{level:2,title:"æ¦è¿°",slug:"æ¦è¿°",normalizedTitle:"æ¦è¿°",charIndex:14},{level:2,title:"ä½¿ç¨è¯´æ",slug:"ä½¿ç¨è¯´æ",normalizedTitle:"ä½¿ç¨è¯´æ",charIndex:145},{level:3,title:"H2 æ§å¶å°åºç¨",slug:"h2-æ§å¶å°åºç¨",normalizedTitle:"h2 æ§å¶å°åºç¨",charIndex:154},{level:3,title:"åµå¥å¼åºç¨",slug:"åµå¥å¼åºç¨",normalizedTitle:"åµå¥å¼åºç¨",charIndex:389},{level:4,title:"JDBC API",slug:"jdbc-api",normalizedTitle:"jdbc api",charIndex:398},{level:4,title:"è¿æ¥æ± ",slug:"è¿æ¥æ± ",normalizedTitle:"è¿æ¥æ± ",charIndex:521},{level:4,title:"Maven",slug:"maven",normalizedTitle:"maven",charIndex:740},{level:4,title:"Hibernate",slug:"hibernate",normalizedTitle:"hibernate",charIndex:893},{level:4,title:"TopLink å Glassfish",slug:"toplink-å-glassfish",normalizedTitle:"toplink å glassfish",charIndex:1043},{level:3,title:"è¿è¡æ¹å¼",slug:"è¿è¡æ¹å¼",normalizedTitle:"è¿è¡æ¹å¼",charIndex:1197},{level:4,title:"åµå¥å¼",slug:"åµå¥å¼",normalizedTitle:"åµå¥å¼",charIndex:27},{level:4,title:"åå­å¼",slug:"åå­å¼",normalizedTitle:"åå­å¼",charIndex:1393},{level:4,title:"æå¡æ¨¡å¼",slug:"æå¡æ¨¡å¼",normalizedTitle:"æå¡æ¨¡å¼",charIndex:1573},{level:4,title:"å¯å¨æå¡",slug:"å¯å¨æå¡",normalizedTitle:"å¯å¨æå¡",charIndex:1806},{level:4,title:"è®¾ç½®",slug:"è®¾ç½®",normalizedTitle:"è®¾ç½®",charIndex:2075},{level:4,title:"è¿æ¥å­ç¬¦ä¸²åæ°",slug:"è¿æ¥å­ç¬¦ä¸²åæ°",normalizedTitle:"è¿æ¥å­ç¬¦ä¸²åæ°",charIndex:2172},{level:4,title:"maven æ¹å¼",slug:"maven-æ¹å¼",normalizedTitle:"maven æ¹å¼",charIndex:2569},{level:2,title:"Spring æ´å H2",slug:"spring-æ´å-h2",normalizedTitle:"spring æ´å h2",charIndex:3256},{level:2,title:"H2 SQL",slug:"h2-sql",normalizedTitle:"h2 sql",charIndex:4911},{level:3,title:"SELECT",slug:"select",normalizedTitle:"select",charIndex:4922},{level:3,title:"INSERT",slug:"insert",normalizedTitle:"insert",charIndex:4935},{level:3,title:"UPDATE",slug:"update",normalizedTitle:"update",charIndex:4948},{level:3,title:"DELETE",slug:"delete",normalizedTitle:"delete",charIndex:4961},{level:3,title:"BACKUP",slug:"backup",normalizedTitle:"backup",charIndex:4974},{level:3,title:"EXPLAIN",slug:"explain",normalizedTitle:"explain",charIndex:4987},{level:3,title:"RUNSCRIPT",slug:"runscript",normalizedTitle:"runscript",charIndex:5010},{level:3,title:"SCRIPT",slug:"script",normalizedTitle:"script",charIndex:5013},{level:3,title:"SHOW",slug:"show",normalizedTitle:"show",charIndex:5068},{level:3,title:"ALTER",slug:"alter",normalizedTitle:"alter",charIndex:5079},{level:4,title:"ALTER INDEX RENAME",slug:"alter-index-rename",normalizedTitle:"alter index rename",charIndex:5088},{level:4,title:"ALTER SCHEMA RENAME",slug:"alter-schema-rename",normalizedTitle:"alter schema rename",charIndex:5112},{level:4,title:"ALTER SEQUENCE",slug:"alter-sequence",normalizedTitle:"alter sequence",charIndex:5137},{level:4,title:"ALTER TABLE",slug:"alter-table",normalizedTitle:"alter table",charIndex:5157},{level:5,title:"å¢å çº¦æ",slug:"å¢å çº¦æ",normalizedTitle:"å¢å çº¦æ",charIndex:5174},{level:5,title:"ä¿®æ¹å",slug:"ä¿®æ¹å",normalizedTitle:"ä¿®æ¹å",charIndex:5184},{level:5,title:"å é¤å",slug:"å é¤å",normalizedTitle:"å é¤å",charIndex:5193},{level:5,title:"å é¤åºå",slug:"å é¤åºå",normalizedTitle:"å é¤åºå",charIndex:5202},{level:4,title:"ALTER USER",slug:"alter-user",normalizedTitle:"alter user",charIndex:5212},{level:5,title:"ä¿®æ¹ç¨æ·å",slug:"ä¿®æ¹ç¨æ·å",normalizedTitle:"ä¿®æ¹ç¨æ·å",charIndex:5226},{level:5,title:"ä¿®æ¹ç¨æ·å¯ç ",slug:"ä¿®æ¹ç¨æ·å¯ç ",normalizedTitle:"ä¿®æ¹ç¨æ·å¯ç ",charIndex:5237},{level:4,title:"ALTER VIEW",slug:"alter-view",normalizedTitle:"alter view",charIndex:5249},{level:3,title:"COMMENT",slug:"comment",normalizedTitle:"comment",charIndex:5266},{level:3,title:"CREATE CONSTANT",slug:"create-constant",normalizedTitle:"create constant",charIndex:5280},{level:3,title:"CREATE INDEX",slug:"create-index",normalizedTitle:"create index",charIndex:5302},{level:3,title:"CREATE ROLE",slug:"create-role",normalizedTitle:"create role",charIndex:5321},{level:3,title:"CREATE SCHEMA",slug:"create-schema",normalizedTitle:"create schema",charIndex:5339},{level:3,title:"CREATE SEQUENCE",slug:"create-sequence",normalizedTitle:"create sequence",charIndex:5359},{level:3,title:"CREATE TABLE",slug:"create-table",normalizedTitle:"create table",charIndex:5381},{level:3,title:"CREATE TRIGGER",slug:"create-trigger",normalizedTitle:"create trigger",charIndex:5400},{level:3,title:"CREATE USER",slug:"create-user",normalizedTitle:"create user",charIndex:5421},{level:3,title:"CREATE VIEW",slug:"create-view",normalizedTitle:"create view",charIndex:5439},{level:3,title:"DROP",slug:"drop",normalizedTitle:"drop",charIndex:5457},{level:3,title:"GRANT RIGHT",slug:"grant-right",normalizedTitle:"grant right",charIndex:5468},{level:4,title:"å¤å¶è§è²çæé",slug:"å¤å¶è§è²çæé",normalizedTitle:"å¤å¶è§è²çæé",charIndex:5526},{level:3,title:"REVOKE RIGHT",slug:"revoke-right",normalizedTitle:"revoke right",charIndex:5540},{level:4,title:"ç§»é¤ææ",slug:"ç§»é¤ææ",normalizedTitle:"ç§»é¤ææ",charIndex:5556},{level:4,title:"ç§»é¤è§è²å·æçæé",slug:"ç§»é¤è§è²å·æçæé",normalizedTitle:"ç§»é¤è§è²å·æçæé",charIndex:5566},{level:3,title:"ROLLBACK",slug:"rollback",normalizedTitle:"rollback",charIndex:5582},{level:4,title:"ä»æä¸ªè¿åç¹ï¼savepointï¼åæ»",slug:"ä»æä¸ªè¿åç¹-savepoint-åæ»",normalizedTitle:"ä»æä¸ªè¿åç¹ï¼savepointï¼åæ»",charIndex:5594},{level:4,title:"åæ»äºå¡",slug:"åæ»äºå¡",normalizedTitle:"åæ»äºå¡",charIndex:5619},{level:4,title:"åå»º savepoint",slug:"åå»º-savepoint",normalizedTitle:"åå»º savepoint",charIndex:5629},{level:2,title:"æ°æ®ç±»å",slug:"æ°æ®ç±»å",normalizedTitle:"æ°æ®ç±»å",charIndex:5648},{level:3,title:"INT Type",slug:"int-type",normalizedTitle:"int type",charIndex:5659},{level:2,title:"éç¾¤",slug:"éç¾¤",normalizedTitle:"éç¾¤",charIndex:5674},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:6274},{level:2,title:"ðª ä¼ éé¨",slug:"ä¼ éé¨",normalizedTitle:"ðª ä¼ éé¨",charIndex:6337}],headersStr:"æ¦è¿° ä½¿ç¨è¯´æ H2 æ§å¶å°åºç¨ åµå¥å¼åºç¨ JDBC API è¿æ¥æ±  Maven Hibernate TopLink å Glassfish è¿è¡æ¹å¼ åµå¥å¼ åå­å¼ æå¡æ¨¡å¼ å¯å¨æå¡ è®¾ç½® è¿æ¥å­ç¬¦ä¸²åæ° maven æ¹å¼ Spring æ´å H2 H2 SQL SELECT INSERT UPDATE DELETE BACKUP EXPLAIN RUNSCRIPT SCRIPT SHOW ALTER ALTER INDEX RENAME ALTER SCHEMA RENAME ALTER SEQUENCE ALTER TABLE å¢å çº¦æ ä¿®æ¹å å é¤å å é¤åºå ALTER USER ä¿®æ¹ç¨æ·å ä¿®æ¹ç¨æ·å¯ç  ALTER VIEW COMMENT CREATE CONSTANT CREATE INDEX CREATE ROLE CREATE SCHEMA CREATE SEQUENCE CREATE TABLE CREATE TRIGGER CREATE USER CREATE VIEW DROP GRANT RIGHT å¤å¶è§è²çæé REVOKE RIGHT ç§»é¤ææ ç§»é¤è§è²å·æçæé ROLLBACK ä»æä¸ªè¿åç¹ï¼savepointï¼åæ» åæ»äºå¡ åå»º savepoint æ°æ®ç±»å INT Type éç¾¤ åèèµæ ðª ä¼ éé¨",content:'# H2 åºç¨æå\n\n\n# æ¦è¿°\n\nH2 æ¯ä¸ä¸ªå¼æºçåµå¥å¼æ°æ®åºå¼æï¼éç¨ java è¯­è¨ç¼åï¼ä¸åå¹³å°çéå¶ãåæ¶ H2 æä¾äºä¸ä¸ªååæ¹ä¾¿ç web æ§å¶å°ç¨äºæä½åç®¡çæ°æ®åºåå®¹ãH2 è¿æä¾å¼å®¹æ¨¡å¼ï¼å¯ä»¥å¼å®¹ä¸äºä¸»æµçæ°æ®åºï¼å æ­¤éç¨ H2 ä½ä¸ºå¼åæçæ°æ®åºéå¸¸æ¹ä¾¿ã\n\n\n# ä½¿ç¨è¯´æ\n\n\n# H2 æ§å¶å°åºç¨\n\nH2 åè®¸ç¨æ·éè¿æµè§å¨æ¥å£æ¹å¼è®¿é® SQL æ°æ®åºã\n\n 1. è¿å¥å®æ¹ä¸è½½å°åï¼éæ©åéçæ¬ï¼ä¸è½½å¹¶å®è£å°æ¬å°ã\n 2. å¯å¨æ¹å¼ï¼å¨ bin ç®å½ä¸ï¼åå» jar åï¼æ§è¡ java -jar h2*.jarï¼æ§è¡èæ¬ï¼h2.bat æ h2.shã\n 3. å¨æµè§å¨ä¸­è®¿é®ï¼http://localhost:8082ï¼åºè¯¥å¯ä»¥çå°ä¸å¾ä¸­çé¡µé¢ï¼\n\n\n\nç¹å» Connect ï¼å¯ä»¥è¿å¥æä½çé¢ï¼\n\n\n\næä½çé¢ååç®åï¼ä¸ä¸ä¸ç»è¯´ã\n\n\n# åµå¥å¼åºç¨\n\n# JDBC API\n\nConnection conn = DriverManager.\n    getConnection("jdbc:h2:~/test");\nconn.close();\n\n\n> è¯¦è§ï¼Using the JDBC API\n\n# è¿æ¥æ± \n\nimport org.h2.jdbcx.JdbcConnectionPool;\nJdbcConnectionPool cp = JdbcConnectionPool.\ncreate("jdbc:h2:~/test", "sa", "sa");\nConnection conn = cp.getConnection();\nconn.close(); cp.dispose();\n\n\n> è¯¦è§ï¼Connection Pool\n\n# Maven\n\n<dependency>\n    <groupId>com.h2database</groupId>\n    <artifactId>h2</artifactId>\n    <version>1.4.197</version>\n</dependency>\n\n\n> è¯¦è§ï¼Maven 2\n\n# Hibernate\n\nhibernate.cfg.xml (or use the HSQLDialect):\n\n<property name="dialect">\n    org.hibernate.dialect.H2Dialect\n</property>\n\n\n> è¯¦è§ï¼Hibernate\n\n# TopLink å Glassfish\n\nDatasource class: org.h2.jdbcx.JdbcDataSource oracle.toplink.essentials.platform.database.H2Platform\n\n> è¯¦è§ï¼TopLink and Glassfish\n\n\n# è¿è¡æ¹å¼\n\n# åµå¥å¼\n\næ°æ®åºæä¹åå­å¨ä¸ºåä¸ªæä»¶ã\n\nè¿æ¥å­ç¬¦ä¸²ï¼\\~/.h2/DBName è¡¨ç¤ºæ°æ®åºæä»¶çå­å¨ä½ç½®ï¼å¦æç¬¬ä¸æ¬¡è¿æ¥åä¼èªå¨åå»ºæ°æ®åºã\n\n * jdbc:h2:\\~/test - \'test\' å¨ç¨æ·æ ¹ç®å½ä¸\n * jdbc:h2:/data/test - \'test\' å¨ /data ç®å½ä¸\n * jdbc:h2:test - \'test\' å¨å½åå·¥ä½ç®å½\n\n# åå­å¼\n\næ°æ®åºåªå¨åå­ä¸­è¿è¡ï¼å³é­è¿æ¥åæ°æ®åºå°è¢«æ¸ç©ºï¼éåæµè¯ç¯å¢\n\nè¿æ¥å­ç¬¦ä¸²ï¼jdbc:h2:mem:DBName;DB_CLOSE_DELAY=-1\n\nå¦æä¸æå® DBNameï¼åä»¥ç§ææ¹å¼å¯å¨ï¼åªåè®¸ä¸ä¸ªè¿æ¥ã\n\n * jdbc:h2:mem:test - ä¸ä¸ªè¿ç¨ä¸­æå¤ä¸ªè¿æ¥\n * jdbc:h2:mem: - æªå½åçç§æåºï¼ä¸ä¸ªè¿æ¥\n\n# æå¡æ¨¡å¼\n\nH2 æ¯æä¸ç§æå¡æ¨¡å¼ï¼\n\n * web serverï¼æ­¤ç§è¿è¡æ¹å¼æ¯æä½¿ç¨æµè§å¨è®¿é® H2 Console\n * TCP serverï¼æ¯æå®¢æ·ç«¯/æå¡å¨ç«¯çè¿æ¥æ¹å¼\n * PG serverï¼æ¯æ PostgreSQL å®¢æ·ç«¯\n\nå¯å¨ tcp æå¡è¿æ¥å­ç¬¦ä¸²ç¤ºä¾ï¼\n\n * jdbc:h2:tcp://localhost/\\~/test - ç¨æ·æ ¹ç®å½\n * jdbc:h2:tcp://localhost//data/test - ç»å¯¹è·¯å¾\n\n# å¯å¨æå¡\n\næ§è¡ java -cp *.jar org.h2.tools.Server\n\næ§è¡å¦ä¸å½ä»¤ï¼è·åéé¡¹åè¡¨åé»è®¤å¼\n\njava -cp h2*.jar org.h2.tools.Server -?\n\n\nå¸¸è§çéé¡¹å¦ä¸ï¼\n\n * -webï¼å¯å¨æ¯æ H2 Console çæå¡\n * -webPort <port>ï¼æå¡å¯å¨ç«¯å£ï¼é»è®¤ä¸º 8082\n * -browserï¼å¯å¨ H2 Console web ç®¡çé¡µé¢\n * -tcpï¼ä½¿ç¨ TCP server æ¨¡å¼å¯å¨\n * -pgï¼ä½¿ç¨ PG server æ¨¡å¼å¯å¨\n\n# è®¾ç½®\n\n * jdbc:h2:..;MODE=MySQL å¼å®¹æ¨¡å¼ï¼æ HSQLDB ç­ï¼\n * jdbc:h2:..;TRACE_LEVEL_FILE=3 è®°å½å° *.trace.db\n\n# è¿æ¥å­ç¬¦ä¸²åæ°\n\n * DB_CLOSE_DELAY - è¦æ±æåä¸ä¸ªæ­£å¨è¿æ¥çè¿æ¥æ­å¼åï¼ä¸è¦å³é­æ°æ®åº\n * MODE=MySQL - å¼å®¹æ¨¡å¼ï¼H2 å¼å®¹å¤ç§æ°æ®åºï¼è¯¥å¼å¯ä»¥ä¸ºï¼DB2ãDerbyãHSQLDBãMSSQLServerãMySQLãOracleãPostgreSQL\n * AUTO_RECONNECT=TRUE - è¿æ¥ä¸¢å¤±åèªå¨éæ°è¿æ¥\n * AUTO_SERVER=TRUE - å¯å¨èªå¨æ··åæ¨¡å¼ï¼åè®¸å¼å¯å¤ä¸ªè¿æ¥ï¼è¯¥åæ°ä¸æ¯æå¨åå­ä¸­è¿è¡æ¨¡å¼\n * TRACE_LEVEL_SYSTEM_OUTãTRACE_LEVEL_FILE - è¾åºè·è¸ªæ¥å¿å°æ§å¶å°ææä»¶ï¼ åå¼ 0 ä¸º OFFï¼1 ä¸º ERRORï¼é»è®¤å¼ï¼ï¼2 ä¸º INFOï¼3 ä¸º DEBUG\n * SET TRACE_MAX_FILE_SIZE mb - è®¾ç½®è·è¸ªæ¥å¿æä»¶çå¤§å°ï¼é»è®¤ä¸º 16M\n\n# maven æ¹å¼\n\næ­¤å¤ï¼ä½¿ç¨ maven ä¹å¯ä»¥å¯å¨ H2 æå¡ãæ·»å ä»¥ä¸æä»¶\n\n<plugin>\n  <groupId>org.codehaus.mojo</groupId>\n  <artifactId>exec-maven-plugin</artifactId>\n  <executions>\n    <execution>\n      <goals>\n        <goal>java</goal>\n      </goals>\n    </execution>\n  </executions>\n  <configuration>\n    <mainClass>org.h2.tools.Server</mainClass>\n    <arguments>\n      <argument>-web</argument>\n      <argument>-webPort</argument>\n      <argument>8090</argument>\n      <argument>-browser</argument>\n    </arguments>\n  </configuration>\n</plugin>\n\n\nå¨å½ä»¤è¡ä¸­æ§è¡å¦ä¸å½ä»¤å¯å¨ H2 Console\n\nmvn exec:java\n\n\næèå»ºç«ä¸ä¸ª bat æä»¶\n\n@echo off\ncall mvn exec:java\npause\n\n\næ­¤æä½ç¸å½äºæ§è¡äºå¦ä¸å½ä»¤ï¼\n\njava -jar h2-1.3.168.jar -web -webPort 8090 -browser\n\n\n\n# Spring æ´å H2\n\nï¼1ï¼æ·»å ä¾èµ\n\n<dependency>\n  <groupId>com.h2database</groupId>\n  <artifactId>h2</artifactId>\n  <version>1.4.194</version>\n</dependency>\n\n\nï¼2ï¼spring éç½®\n\n<?xml version="1.0" encoding="UTF-8"?>\n<beans xmlns="http://www.springframework.org/schema/beans"\n       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n       xmlns:jdbc="http://www.springframework.org/schema/jdbc"\n       xsi:schemaLocation="http://www.springframework.org/schema/beans\n            http://www.springframework.org/schema/beans/spring-beans-3.2.xsd\n            http://www.springframework.org/schema/jdbc\n            http://www.springframework.org/schema/jdbc/spring-jdbc.xsd">\n\n  \x3c!--éç½®æ°æ®æº--\x3e\n  <bean id="dataSource" class="org.h2.jdbcx.JdbcConnectionPool"\n        destroy-method="dispose">\n    <constructor-arg>\n      <bean class="org.h2.jdbcx.JdbcDataSource">\n        \x3c!-- åå­æ¨¡å¼ --\x3e\n        <property name="URL" value="jdbc:h2:mem:test"/>\n        \x3c!-- æä»¶æ¨¡å¼ --\x3e\n        \x3c!-- <property name="URL" value="jdbc:h2:testRestDB" /> --\x3e\n        <property name="user" value="root"/>\n        <property name="password" value="root"/>\n      </bean>\n    </constructor-arg>\n  </bean>\n\n  \x3c!-- JDBCæ¨¡æ¿ --\x3e\n  <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">\n    <constructor-arg ref="dataSource"/>\n  </bean>\n  <bean id="myJdbcTemplate" class="org.zp.notes.spring.jdbc.MyJdbcTemplate">\n    <property name="jdbcTemplate" ref="jdbcTemplate"/>\n  </bean>\n\n  \x3c!-- åå§åæ°æ®è¡¨ç»æ --\x3e\n  <jdbc:initialize-database data-source="dataSource" ignore-failures="ALL">\n    <jdbc:script location="classpath:sql/h2/create_table_student.sql"/>\n  </jdbc:initialize-database>\n</beans>\n\n\n\n# H2 SQL\n\n\n# SELECT\n\n\n\n\n# INSERT\n\n\n\n\n# UPDATE\n\n\n\n\n# DELETE\n\n\n\n\n# BACKUP\n\n\n\n\n# EXPLAIN\n\n\n\n7ãMERGE\n\n\n# RUNSCRIPT\n\nè¿è¡ sql èæ¬æä»¶\n\n\n\n\n# SCRIPT\n\næ ¹æ®æ°æ®åºåå»º sql èæ¬\n\n\n\n\n# SHOW\n\n\n\n\n# ALTER\n\n# ALTER INDEX RENAME\n\n\n\n# ALTER SCHEMA RENAME\n\n\n\n# ALTER SEQUENCE\n\n\n\n# ALTER TABLE\n\n\n\n# å¢å çº¦æ\n\n\n\n# ä¿®æ¹å\n\n\n\n# å é¤å\n\n\n\n# å é¤åºå\n\n\n\n# ALTER USER\n\n# ä¿®æ¹ç¨æ·å\n\n\n\n# ä¿®æ¹ç¨æ·å¯ç \n\n\n\n# ALTER VIEW\n\n\n\n\n# COMMENT\n\n\n\n\n# CREATE CONSTANT\n\n\n\n\n# CREATE INDEX\n\n\n\n\n# CREATE ROLE\n\n\n\n\n# CREATE SCHEMA\n\n\n\n\n# CREATE SEQUENCE\n\n\n\n\n# CREATE TABLE\n\n\n\n\n# CREATE TRIGGER\n\n\n\n\n# CREATE USER\n\n\n\n\n# CREATE VIEW\n\n\n\n\n# DROP\n\n\n\n\n# GRANT RIGHT\n\nç» schema ææææ\n\n\n\nç» schema ææç» schema ææ\n\n\n\n# å¤å¶è§è²çæé\n\n\n\n\n# REVOKE RIGHT\n\n# ç§»é¤ææ\n\n\n\n# ç§»é¤è§è²å·æçæé\n\n\n\n\n# ROLLBACK\n\n# ä»æä¸ªè¿åç¹ï¼savepointï¼åæ»\n\n\n\n# åæ»äºå¡\n\n\n\n# åå»º savepoint\n\n\n\n\n# æ°æ®ç±»å\n\n\n\n\n# INT Type\n\n\n\n\n# éç¾¤\n\nH2 æ¯æä¸¤å°æå¡å¨è¿è¡ä¸¤ä¸ªæ°æ®åºæä¸ºéç¾¤ï¼ä¸¤ä¸ªæ°æ®åºäºä¸ºå¤ä»½ï¼å¦æä¸ä¸ªæå¡å¨å¤±æï¼å¦ä¸ä¸ªæå¡å¨ä»ç¶å¯ä»¥å·¥ä½ãå¦å¤åªææå¡æ¨¡å¼æ¯æéç¾¤éç½®ã\n\nH2 å¯ä»¥éè¿ CreateCluster å·¥å·åå»ºéç¾¤ï¼ç¤ºä¾æ­¥éª¤å¦ä¸ï¼å¨å¨ä¸å°æå¡å¨ä¸æ¨¡æä¸¤ä¸ªæ°æ®åºç»æéç¾¤ï¼ï¼\n\n * åå»ºç®å½\n   * åå»ºä¸¤ä¸ªæå¡å¨å·¥ä½çç®å½\n * å¯å¨ tcp æå¡\n   * æ§è¡å¦ä¸å½ä»¤åå«å¨ 9101ã9102 ç«¯å£å¯å¨ä¸¤ä¸ªä½¿ç¨ tcp æå¡æ¨¡å¼çæ°æ®åº\n * ä½¿ç¨ CreateCluster å·¥å·åå»ºéç¾¤\n   * å¦æä¸¤ä¸ªæ°æ®åºä¸å­å¨ï¼è¯¥å½ä»¤å°ä¼èªå¨åå»ºæ°æ®åºãå¦æä¸ä¸ªæ°æ®åºå¤±æï¼å¯ä»¥åå é¤åçæ°æ®åºæä»¶ï¼éæ°å¯å¨æ°æ®åºï¼ç¶åéæ°è¿è¡ CreateCluster å·¥å·\n * è¿æ¥æ°æ®åºç°å¨å¯ä»¥ä½¿ç¨å¦ä¸è¿æ¥å­ç¬¦ä¸²è¿æ¥éç¾¤æ°æ®åº\n   * çæ§éç¾¤è¿è¡ç¶æ\n   * å¯ä»¥ä½¿ç¨å¦ä¸å½ä»¤æ¥çéç½®çéç¾¤æå¡å¨æ¯å¦é½å¨è¿è¡\n * éå¶\n   * H2 çéç¾¤å¹¶ä¸æ¯æéå¯¹äºå¡çè´è½½åè¡¡ï¼æä»¥å¾å¤æä½ä¼ä½¿ä¸¤ä¸ªæ°æ®åºäº§çä¸ä¸è´çç»æ\n * æ§è¡å¦ä¸æä½æ¶è¯·å°å¿ï¼\n   * èªå¨å¢é¿ååæ è¯åä¸æ¯æéç¾¤ï¼å½æå¥æ°æ®æ¶ï¼åºåå¼éè¦æå¨åå»ºä¸æ¯æ SET AUTOCOMMIT FALSE è¯­å¥ï¼\n   * å¦æéè¦è®¾ç½®æä¸ºä¸èªå¨æäº¤ï¼å¯ä»¥æ§è¡æ¹æ³ Connection.setAutoCommit(false)\n\n\n# åèèµæ\n\n * h2database å®ç½\n * Java åµå¥å¼æ°æ®åº H2 å­¦ä¹ æ»ç»(ä¸)ââH2 æ°æ®åºå¥é¨\n\n\n# ðª ä¼ éé¨\n\n| éæçåå®¢ | db-tutorial é¦é¡µ |',normalizedContent:'# h2 åºç¨æå\n\n\n# æ¦è¿°\n\nh2 æ¯ä¸ä¸ªå¼æºçåµå¥å¼æ°æ®åºå¼æï¼éç¨ java è¯­è¨ç¼åï¼ä¸åå¹³å°çéå¶ãåæ¶ h2 æä¾äºä¸ä¸ªååæ¹ä¾¿ç web æ§å¶å°ç¨äºæä½åç®¡çæ°æ®åºåå®¹ãh2 è¿æä¾å¼å®¹æ¨¡å¼ï¼å¯ä»¥å¼å®¹ä¸äºä¸»æµçæ°æ®åºï¼å æ­¤éç¨ h2 ä½ä¸ºå¼åæçæ°æ®åºéå¸¸æ¹ä¾¿ã\n\n\n# ä½¿ç¨è¯´æ\n\n\n# h2 æ§å¶å°åºç¨\n\nh2 åè®¸ç¨æ·éè¿æµè§å¨æ¥å£æ¹å¼è®¿é® sql æ°æ®åºã\n\n 1. è¿å¥å®æ¹ä¸è½½å°åï¼éæ©åéçæ¬ï¼ä¸è½½å¹¶å®è£å°æ¬å°ã\n 2. å¯å¨æ¹å¼ï¼å¨ bin ç®å½ä¸ï¼åå» jar åï¼æ§è¡ java -jar h2*.jarï¼æ§è¡èæ¬ï¼h2.bat æ h2.shã\n 3. å¨æµè§å¨ä¸­è®¿é®ï¼http://localhost:8082ï¼åºè¯¥å¯ä»¥çå°ä¸å¾ä¸­çé¡µé¢ï¼\n\n\n\nç¹å» connect ï¼å¯ä»¥è¿å¥æä½çé¢ï¼\n\n\n\næä½çé¢ååç®åï¼ä¸ä¸ä¸ç»è¯´ã\n\n\n# åµå¥å¼åºç¨\n\n# jdbc api\n\nconnection conn = drivermanager.\n    getconnection("jdbc:h2:~/test");\nconn.close();\n\n\n> è¯¦è§ï¼using the jdbc api\n\n# è¿æ¥æ± \n\nimport org.h2.jdbcx.jdbcconnectionpool;\njdbcconnectionpool cp = jdbcconnectionpool.\ncreate("jdbc:h2:~/test", "sa", "sa");\nconnection conn = cp.getconnection();\nconn.close(); cp.dispose();\n\n\n> è¯¦è§ï¼connection pool\n\n# maven\n\n<dependency>\n    <groupid>com.h2database</groupid>\n    <artifactid>h2</artifactid>\n    <version>1.4.197</version>\n</dependency>\n\n\n> è¯¦è§ï¼maven 2\n\n# hibernate\n\nhibernate.cfg.xml (or use the hsqldialect):\n\n<property name="dialect">\n    org.hibernate.dialect.h2dialect\n</property>\n\n\n> è¯¦è§ï¼hibernate\n\n# toplink å glassfish\n\ndatasource class: org.h2.jdbcx.jdbcdatasource oracle.toplink.essentials.platform.database.h2platform\n\n> è¯¦è§ï¼toplink and glassfish\n\n\n# è¿è¡æ¹å¼\n\n# åµå¥å¼\n\næ°æ®åºæä¹åå­å¨ä¸ºåä¸ªæä»¶ã\n\nè¿æ¥å­ç¬¦ä¸²ï¼\\~/.h2/dbname è¡¨ç¤ºæ°æ®åºæä»¶çå­å¨ä½ç½®ï¼å¦æç¬¬ä¸æ¬¡è¿æ¥åä¼èªå¨åå»ºæ°æ®åºã\n\n * jdbc:h2:\\~/test - \'test\' å¨ç¨æ·æ ¹ç®å½ä¸\n * jdbc:h2:/data/test - \'test\' å¨ /data ç®å½ä¸\n * jdbc:h2:test - \'test\' å¨å½åå·¥ä½ç®å½\n\n# åå­å¼\n\næ°æ®åºåªå¨åå­ä¸­è¿è¡ï¼å³é­è¿æ¥åæ°æ®åºå°è¢«æ¸ç©ºï¼éåæµè¯ç¯å¢\n\nè¿æ¥å­ç¬¦ä¸²ï¼jdbc:h2:mem:dbname;db_close_delay=-1\n\nå¦æä¸æå® dbnameï¼åä»¥ç§ææ¹å¼å¯å¨ï¼åªåè®¸ä¸ä¸ªè¿æ¥ã\n\n * jdbc:h2:mem:test - ä¸ä¸ªè¿ç¨ä¸­æå¤ä¸ªè¿æ¥\n * jdbc:h2:mem: - æªå½åçç§æåºï¼ä¸ä¸ªè¿æ¥\n\n# æå¡æ¨¡å¼\n\nh2 æ¯æä¸ç§æå¡æ¨¡å¼ï¼\n\n * web serverï¼æ­¤ç§è¿è¡æ¹å¼æ¯æä½¿ç¨æµè§å¨è®¿é® h2 console\n * tcp serverï¼æ¯æå®¢æ·ç«¯/æå¡å¨ç«¯çè¿æ¥æ¹å¼\n * pg serverï¼æ¯æ postgresql å®¢æ·ç«¯\n\nå¯å¨ tcp æå¡è¿æ¥å­ç¬¦ä¸²ç¤ºä¾ï¼\n\n * jdbc:h2:tcp://localhost/\\~/test - ç¨æ·æ ¹ç®å½\n * jdbc:h2:tcp://localhost//data/test - ç»å¯¹è·¯å¾\n\n# å¯å¨æå¡\n\næ§è¡ java -cp *.jar org.h2.tools.server\n\næ§è¡å¦ä¸å½ä»¤ï¼è·åéé¡¹åè¡¨åé»è®¤å¼\n\njava -cp h2*.jar org.h2.tools.server -?\n\n\nå¸¸è§çéé¡¹å¦ä¸ï¼\n\n * -webï¼å¯å¨æ¯æ h2 console çæå¡\n * -webport <port>ï¼æå¡å¯å¨ç«¯å£ï¼é»è®¤ä¸º 8082\n * -browserï¼å¯å¨ h2 console web ç®¡çé¡µé¢\n * -tcpï¼ä½¿ç¨ tcp server æ¨¡å¼å¯å¨\n * -pgï¼ä½¿ç¨ pg server æ¨¡å¼å¯å¨\n\n# è®¾ç½®\n\n * jdbc:h2:..;mode=mysql å¼å®¹æ¨¡å¼ï¼æ hsqldb ç­ï¼\n * jdbc:h2:..;trace_level_file=3 è®°å½å° *.trace.db\n\n# è¿æ¥å­ç¬¦ä¸²åæ°\n\n * db_close_delay - è¦æ±æåä¸ä¸ªæ­£å¨è¿æ¥çè¿æ¥æ­å¼åï¼ä¸è¦å³é­æ°æ®åº\n * mode=mysql - å¼å®¹æ¨¡å¼ï¼h2 å¼å®¹å¤ç§æ°æ®åºï¼è¯¥å¼å¯ä»¥ä¸ºï¼db2ãderbyãhsqldbãmssqlserverãmysqlãoracleãpostgresql\n * auto_reconnect=true - è¿æ¥ä¸¢å¤±åèªå¨éæ°è¿æ¥\n * auto_server=true - å¯å¨èªå¨æ··åæ¨¡å¼ï¼åè®¸å¼å¯å¤ä¸ªè¿æ¥ï¼è¯¥åæ°ä¸æ¯æå¨åå­ä¸­è¿è¡æ¨¡å¼\n * trace_level_system_outãtrace_level_file - è¾åºè·è¸ªæ¥å¿å°æ§å¶å°ææä»¶ï¼ åå¼ 0 ä¸º offï¼1 ä¸º errorï¼é»è®¤å¼ï¼ï¼2 ä¸º infoï¼3 ä¸º debug\n * set trace_max_file_size mb - è®¾ç½®è·è¸ªæ¥å¿æä»¶çå¤§å°ï¼é»è®¤ä¸º 16m\n\n# maven æ¹å¼\n\næ­¤å¤ï¼ä½¿ç¨ maven ä¹å¯ä»¥å¯å¨ h2 æå¡ãæ·»å ä»¥ä¸æä»¶\n\n<plugin>\n  <groupid>org.codehaus.mojo</groupid>\n  <artifactid>exec-maven-plugin</artifactid>\n  <executions>\n    <execution>\n      <goals>\n        <goal>java</goal>\n      </goals>\n    </execution>\n  </executions>\n  <configuration>\n    <mainclass>org.h2.tools.server</mainclass>\n    <arguments>\n      <argument>-web</argument>\n      <argument>-webport</argument>\n      <argument>8090</argument>\n      <argument>-browser</argument>\n    </arguments>\n  </configuration>\n</plugin>\n\n\nå¨å½ä»¤è¡ä¸­æ§è¡å¦ä¸å½ä»¤å¯å¨ h2 console\n\nmvn exec:java\n\n\næèå»ºç«ä¸ä¸ª bat æä»¶\n\n@echo off\ncall mvn exec:java\npause\n\n\næ­¤æä½ç¸å½äºæ§è¡äºå¦ä¸å½ä»¤ï¼\n\njava -jar h2-1.3.168.jar -web -webport 8090 -browser\n\n\n\n# spring æ´å h2\n\nï¼1ï¼æ·»å ä¾èµ\n\n<dependency>\n  <groupid>com.h2database</groupid>\n  <artifactid>h2</artifactid>\n  <version>1.4.194</version>\n</dependency>\n\n\nï¼2ï¼spring éç½®\n\n<?xml version="1.0" encoding="utf-8"?>\n<beans xmlns="http://www.springframework.org/schema/beans"\n       xmlns:xsi="http://www.w3.org/2001/xmlschema-instance"\n       xmlns:jdbc="http://www.springframework.org/schema/jdbc"\n       xsi:schemalocation="http://www.springframework.org/schema/beans\n            http://www.springframework.org/schema/beans/spring-beans-3.2.xsd\n            http://www.springframework.org/schema/jdbc\n            http://www.springframework.org/schema/jdbc/spring-jdbc.xsd">\n\n  \x3c!--éç½®æ°æ®æº--\x3e\n  <bean id="datasource" class="org.h2.jdbcx.jdbcconnectionpool"\n        destroy-method="dispose">\n    <constructor-arg>\n      <bean class="org.h2.jdbcx.jdbcdatasource">\n        \x3c!-- åå­æ¨¡å¼ --\x3e\n        <property name="url" value="jdbc:h2:mem:test"/>\n        \x3c!-- æä»¶æ¨¡å¼ --\x3e\n        \x3c!-- <property name="url" value="jdbc:h2:testrestdb" /> --\x3e\n        <property name="user" value="root"/>\n        <property name="password" value="root"/>\n      </bean>\n    </constructor-arg>\n  </bean>\n\n  \x3c!-- jdbcæ¨¡æ¿ --\x3e\n  <bean id="jdbctemplate" class="org.springframework.jdbc.core.jdbctemplate">\n    <constructor-arg ref="datasource"/>\n  </bean>\n  <bean id="myjdbctemplate" class="org.zp.notes.spring.jdbc.myjdbctemplate">\n    <property name="jdbctemplate" ref="jdbctemplate"/>\n  </bean>\n\n  \x3c!-- åå§åæ°æ®è¡¨ç»æ --\x3e\n  <jdbc:initialize-database data-source="datasource" ignore-failures="all">\n    <jdbc:script location="classpath:sql/h2/create_table_student.sql"/>\n  </jdbc:initialize-database>\n</beans>\n\n\n\n# h2 sql\n\n\n# select\n\n\n\n\n# insert\n\n\n\n\n# update\n\n\n\n\n# delete\n\n\n\n\n# backup\n\n\n\n\n# explain\n\n\n\n7ãmerge\n\n\n# runscript\n\nè¿è¡ sql èæ¬æä»¶\n\n\n\n\n# script\n\næ ¹æ®æ°æ®åºåå»º sql èæ¬\n\n\n\n\n# show\n\n\n\n\n# alter\n\n# alter index rename\n\n\n\n# alter schema rename\n\n\n\n# alter sequence\n\n\n\n# alter table\n\n\n\n# å¢å çº¦æ\n\n\n\n# ä¿®æ¹å\n\n\n\n# å é¤å\n\n\n\n# å é¤åºå\n\n\n\n# alter user\n\n# ä¿®æ¹ç¨æ·å\n\n\n\n# ä¿®æ¹ç¨æ·å¯ç \n\n\n\n# alter view\n\n\n\n\n# comment\n\n\n\n\n# create constant\n\n\n\n\n# create index\n\n\n\n\n# create role\n\n\n\n\n# create schema\n\n\n\n\n# create sequence\n\n\n\n\n# create table\n\n\n\n\n# create trigger\n\n\n\n\n# create user\n\n\n\n\n# create view\n\n\n\n\n# drop\n\n\n\n\n# grant right\n\nç» schema ææææ\n\n\n\nç» schema ææç» schema ææ\n\n\n\n# å¤å¶è§è²çæé\n\n\n\n\n# revoke right\n\n# ç§»é¤ææ\n\n\n\n# ç§»é¤è§è²å·æçæé\n\n\n\n\n# rollback\n\n# ä»æä¸ªè¿åç¹ï¼savepointï¼åæ»\n\n\n\n# åæ»äºå¡\n\n\n\n# åå»º savepoint\n\n\n\n\n# æ°æ®ç±»å\n\n\n\n\n# int type\n\n\n\n\n# éç¾¤\n\nh2 æ¯æä¸¤å°æå¡å¨è¿è¡ä¸¤ä¸ªæ°æ®åºæä¸ºéç¾¤ï¼ä¸¤ä¸ªæ°æ®åºäºä¸ºå¤ä»½ï¼å¦æä¸ä¸ªæå¡å¨å¤±æï¼å¦ä¸ä¸ªæå¡å¨ä»ç¶å¯ä»¥å·¥ä½ãå¦å¤åªææå¡æ¨¡å¼æ¯æéç¾¤éç½®ã\n\nh2 å¯ä»¥éè¿ createcluster å·¥å·åå»ºéç¾¤ï¼ç¤ºä¾æ­¥éª¤å¦ä¸ï¼å¨å¨ä¸å°æå¡å¨ä¸æ¨¡æä¸¤ä¸ªæ°æ®åºç»æéç¾¤ï¼ï¼\n\n * åå»ºç®å½\n   * åå»ºä¸¤ä¸ªæå¡å¨å·¥ä½çç®å½\n * å¯å¨ tcp æå¡\n   * æ§è¡å¦ä¸å½ä»¤åå«å¨ 9101ã9102 ç«¯å£å¯å¨ä¸¤ä¸ªä½¿ç¨ tcp æå¡æ¨¡å¼çæ°æ®åº\n * ä½¿ç¨ createcluster å·¥å·åå»ºéç¾¤\n   * å¦æä¸¤ä¸ªæ°æ®åºä¸å­å¨ï¼è¯¥å½ä»¤å°ä¼èªå¨åå»ºæ°æ®åºãå¦æä¸ä¸ªæ°æ®åºå¤±æï¼å¯ä»¥åå é¤åçæ°æ®åºæä»¶ï¼éæ°å¯å¨æ°æ®åºï¼ç¶åéæ°è¿è¡ createcluster å·¥å·\n * è¿æ¥æ°æ®åºç°å¨å¯ä»¥ä½¿ç¨å¦ä¸è¿æ¥å­ç¬¦ä¸²è¿æ¥éç¾¤æ°æ®åº\n   * çæ§éç¾¤è¿è¡ç¶æ\n   * å¯ä»¥ä½¿ç¨å¦ä¸å½ä»¤æ¥çéç½®çéç¾¤æå¡å¨æ¯å¦é½å¨è¿è¡\n * éå¶\n   * h2 çéç¾¤å¹¶ä¸æ¯æéå¯¹äºå¡çè´è½½åè¡¡ï¼æä»¥å¾å¤æä½ä¼ä½¿ä¸¤ä¸ªæ°æ®åºäº§çä¸ä¸è´çç»æ\n * æ§è¡å¦ä¸æä½æ¶è¯·å°å¿ï¼\n   * èªå¨å¢é¿ååæ è¯åä¸æ¯æéç¾¤ï¼å½æå¥æ°æ®æ¶ï¼åºåå¼éè¦æå¨åå»ºä¸æ¯æ set autocommit false è¯­å¥ï¼\n   * å¦æéè¦è®¾ç½®æä¸ºä¸èªå¨æäº¤ï¼å¯ä»¥æ§è¡æ¹æ³ connection.setautocommit(false)\n\n\n# åèèµæ\n\n * h2database å®ç½\n * java åµå¥å¼æ°æ®åº h2 å­¦ä¹ æ»ç»(ä¸)ââh2 æ°æ®åºå¥é¨\n\n\n# ðª ä¼ éé¨\n\n| éæçåå®¢ | db-tutorial é¦é¡µ |',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"sqlite",frontmatter:{title:"sqlite",date:"2019-08-22T09:02:39.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","å¶ä»"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","SQLite"],permalink:"/pages/bdcd7e/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/99.%E5%85%B6%E4%BB%96/03.Sqlite.html",relativePath:"12.æ°æ®åº/03.å³ç³»åæ°æ®åº/99.å¶ä»/03.Sqlite.md",key:"v-28fda0bf",path:"/pages/bdcd7e/",headers:[{level:2,title:"SQLite ç®ä»",slug:"sqlite-ç®ä»",normalizedTitle:"sqlite ç®ä»",charIndex:61},{level:3,title:"ä¼ç¹",slug:"ä¼ç¹",normalizedTitle:"ä¼ç¹",charIndex:445},{level:3,title:"å±é",slug:"å±é",normalizedTitle:"å±é",charIndex:822},{level:3,title:"å®è£",slug:"å®è£",normalizedTitle:"å®è£",charIndex:511},{level:2,title:"SQLite è¯­æ³",slug:"sqlite-è¯­æ³",normalizedTitle:"sqlite è¯­æ³",charIndex:1412},{level:3,title:"å¤§å°åææ",slug:"å¤§å°åææ",normalizedTitle:"å¤§å°åææ",charIndex:1511},{level:3,title:"æ³¨é",slug:"æ³¨é",normalizedTitle:"æ³¨é",charIndex:1589},{level:3,title:"åå»ºæ°æ®åº",slug:"åå»ºæ°æ®åº",normalizedTitle:"åå»ºæ°æ®åº",charIndex:1627},{level:3,title:"æ¥çæ°æ®åº",slug:"æ¥çæ°æ®åº",normalizedTitle:"æ¥çæ°æ®åº",charIndex:1795},{level:3,title:"éåºæ°æ®åº",slug:"éåºæ°æ®åº",normalizedTitle:"éåºæ°æ®åº",charIndex:1970},{level:3,title:"éå æ°æ®åº",slug:"éå æ°æ®åº",normalizedTitle:"éå æ°æ®åº",charIndex:1996},{level:3,title:"åç¦»æ°æ®åº",slug:"åç¦»æ°æ®åº",normalizedTitle:"åç¦»æ°æ®åº",charIndex:2462},{level:3,title:"å¤ä»½æ°æ®åº",slug:"å¤ä»½æ°æ®åº",normalizedTitle:"å¤ä»½æ°æ®åº",charIndex:2943},{level:3,title:"æ¢å¤æ°æ®åº",slug:"æ¢å¤æ°æ®åº",normalizedTitle:"æ¢å¤æ°æ®åº",charIndex:3026},{level:2,title:"SQLite æ°æ®ç±»å",slug:"sqlite-æ°æ®ç±»å",normalizedTitle:"sqlite æ°æ®ç±»å",charIndex:3099},{level:3,title:"SQLite å­å¨ç±»",slug:"sqlite-å­å¨ç±»",normalizedTitle:"sqlite å­å¨ç±»",charIndex:3176},{level:3,title:"SQLite äº²å(Affinity)ç±»å",slug:"sqlite-äº²å-affinity-ç±»å",normalizedTitle:"sqlite äº²å(affinity)ç±»å",charIndex:3502},{level:3,title:"SQLite äº²åç±»å(Affinity)åç±»ååç§°",slug:"sqlite-äº²åç±»å-affinity-åç±»ååç§°",normalizedTitle:"sqlite äº²åç±»å(affinity)åç±»ååç§°",charIndex:4186},{level:3,title:"Boolean æ°æ®ç±»å",slug:"boolean-æ°æ®ç±»å",normalizedTitle:"boolean æ°æ®ç±»å",charIndex:4759},{level:3,title:"Date ä¸ Time æ°æ®ç±»å",slug:"date-ä¸-time-æ°æ®ç±»å",normalizedTitle:"date ä¸ time æ°æ®ç±»å",charIndex:4834},{level:2,title:"SQLite å½ä»¤",slug:"sqlite-å½ä»¤",normalizedTitle:"sqlite å½ä»¤",charIndex:5130},{level:3,title:"å¿«éå¼å§",slug:"å¿«éå¼å§",normalizedTitle:"å¿«éå¼å§",charIndex:5144},{level:4,title:"è¿å¥ SQLite æ§å¶å°",slug:"è¿å¥-sqlite-æ§å¶å°",normalizedTitle:"è¿å¥ sqlite æ§å¶å°",charIndex:5152},{level:4,title:"è¿å¥ SQLite æ§å¶å°å¹¶æå®æ°æ®åº",slug:"è¿å¥-sqlite-æ§å¶å°å¹¶æå®æ°æ®åº",normalizedTitle:"è¿å¥ sqlite æ§å¶å°å¹¶æå®æ°æ®åº",charIndex:5305},{level:4,title:"éåº SQLite æ§å¶å°",slug:"éåº-sqlite-æ§å¶å°",normalizedTitle:"éåº sqlite æ§å¶å°",charIndex:5472},{level:4,title:"æ¥çå½ä»¤å¸®å©",slug:"æ¥çå½ä»¤å¸®å©",normalizedTitle:"æ¥çå½ä»¤å¸®å©",charIndex:5504},{level:3,title:"å¸¸ç¨å½ä»¤æ¸å",slug:"å¸¸ç¨å½ä»¤æ¸å",normalizedTitle:"å¸¸ç¨å½ä»¤æ¸å",charIndex:5530},{level:3,title:"å®æ",slug:"å®æ",normalizedTitle:"å®æ",charIndex:6966},{level:4,title:"æ ¼å¼åè¾åº",slug:"æ ¼å¼åè¾åº",normalizedTitle:"æ ¼å¼åè¾åº",charIndex:6972},{level:4,title:"è¾åºç»æå°æä»¶",slug:"è¾åºç»æå°æä»¶",normalizedTitle:"è¾åºç»æå°æä»¶",charIndex:7046},{level:2,title:"SQLite JAVA Client",slug:"sqlite-java-client",normalizedTitle:"sqlite java client",charIndex:7222},{level:3,title:"å¦ä½æå®æ°æ®åºæä»¶",slug:"å¦ä½æå®æ°æ®åºæä»¶",normalizedTitle:"å¦ä½æå®æ°æ®åºæä»¶",charIndex:8921},{level:3,title:"å¦ä½ä½¿ç¨åå­æ°æ®åº",slug:"å¦ä½ä½¿ç¨åå­æ°æ®åº",normalizedTitle:"å¦ä½ä½¿ç¨åå­æ°æ®åº",charIndex:9164},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:9257},{level:2,title:"ðª ä¼ éé¨",slug:"ä¼ éé¨",normalizedTitle:"ðª ä¼ éé¨",charIndex:9473}],headersStr:"SQLite ç®ä» ä¼ç¹ å±é å®è£ SQLite è¯­æ³ å¤§å°åææ æ³¨é åå»ºæ°æ®åº æ¥çæ°æ®åº éåºæ°æ®åº éå æ°æ®åº åç¦»æ°æ®åº å¤ä»½æ°æ®åº æ¢å¤æ°æ®åº SQLite æ°æ®ç±»å SQLite å­å¨ç±» SQLite äº²å(Affinity)ç±»å SQLite äº²åç±»å(Affinity)åç±»ååç§° Boolean æ°æ®ç±»å Date ä¸ Time æ°æ®ç±»å SQLite å½ä»¤ å¿«éå¼å§ è¿å¥ SQLite æ§å¶å° è¿å¥ SQLite æ§å¶å°å¹¶æå®æ°æ®åº éåº SQLite æ§å¶å° æ¥çå½ä»¤å¸®å© å¸¸ç¨å½ä»¤æ¸å å®æ æ ¼å¼åè¾åº è¾åºç»æå°æä»¶ SQLite JAVA Client å¦ä½æå®æ°æ®åºæä»¶ å¦ä½ä½¿ç¨åå­æ°æ®åº åèèµæ ðª ä¼ éé¨",content:'# SQLite\n\n> SQLite æ¯ä¸ä¸ªæ æå¡å¨çãé¶éç½®çãäºå¡æ§ççå¼æºæ°æ®åºå¼æã ð» å®æ´ç¤ºä¾æºç \n\n\n# SQLite ç®ä»\n\nSQLite æ¯ä¸ä¸ªCè¯­è¨ç¼åçè½»éçº§ãå¨åè½ãæ æå¡å¨ãé¶éç½®ççå¼æºæ°æ®åºå¼æã\n\nSQLite çè®¾è®¡ç®æ æ¯åµå¥å¼çæ°æ®åºï¼å¾å¤åµå¥å¼äº§åä¸­é½ä½¿ç¨äºå®ãSQLite ååè½»éï¼å ç¨èµæºéå¸¸çä½ï¼å¨åµå¥å¼è®¾å¤ä¸­ï¼å¯è½åªéè¦å ç¾Kçåå­å°±å¤äºãSQLite è½å¤æ¯æWindows/Linux/Unixç­ç­ä¸»æµçæä½ç³»ç»ï¼åæ¶è½å¤è·å¾å¤ç¨åºè¯­è¨ç¸ç»åï¼åæ ·æ¯èµ·MysqlãPostgreSQLè¿ä¸¤æ¬¾å¼æºçä¸çèåæ°æ®åºç®¡çç³»ç»æ¥è®²ï¼å®çå¤çéåº¦æ¯ä»ä»¬é½å¿«ã\n\nSQLite å¤§å°åªæ 3M å·¦å³ï¼å¯ä»¥å°æ´ä¸ª SQLite åµå¥å°åºç¨ä¸­ï¼èä¸ç¨éç¨ä¼ ç»çå®¢æ·ç«¯ï¼æå¡å¨ï¼Client/Serverï¼çæ¶æãè¿æ ·åçå¥½å¤å°±æ¯éå¸¸è½»ä¾¿ï¼å¨è®¸å¤æºè½è®¾å¤ååºç¨ä¸­é½å¯ä»¥ä½¿ç¨ SQLiteï¼æ¯å¦å¾®ä¿¡å°±éç¨äº SQLite ä½ä¸ºæ¬å°èå¤©è®°å½çå­å¨ã\n\n\n# ä¼ç¹\n\n * SQLite æ¯èªç»èªè¶³çï¼è¿æå³çä¸éè¦ä»»ä½å¤é¨çä¾èµã\n * SQLite æ¯æ æå¡å¨çãé¶éç½®çï¼è¿æå³çä¸éè¦å®è£æç®¡çã\n * SQLite äºå¡æ¯å®å¨å¼å®¹ ACID çï¼åè®¸ä»å¤ä¸ªè¿ç¨æçº¿ç¨å®å¨è®¿é®ã\n * SQLite æ¯éå¸¸å°çï¼æ¯è½»éçº§çï¼å®å¨éç½®æ¶å°äº 400KiBï¼çç¥å¯éåè½éç½®æ¶å°äº 250KiBã\n * SQLite æ¯æ SQL92ï¼SQL2ï¼æ åçå¤§å¤æ°æ¥è¯¢è¯­è¨çåè½ã\n * ä¸ä¸ªå®æ´ç SQLite æ°æ®åºæ¯å­å¨å¨ä¸ä¸ªåä¸çè·¨å¹³å°çç£çæä»¶ã\n * SQLite ä½¿ç¨ ANSI-C ç¼åçï¼å¹¶æä¾äºç®ååæäºä½¿ç¨ç APIã\n * SQLite å¯å¨ UNIXï¼Linux, Mac OS-X, Android, iOSï¼å Windowsï¼Win32, WinCE, WinRTï¼ä¸­è¿è¡ã\n\n\n# å±é\n\nç¹æ§                 æè¿°\nRIGHT OUTER JOIN   åªå®ç°äº LEFT OUTER JOINã\nFULL OUTER JOIN    åªå®ç°äº LEFT OUTER JOINã\nALTER TABLE        æ¯æ RENAME TABLE å ALTER TABLE ç ADD COLUMN variants å½ä»¤ï¼ä¸æ¯æ\n                   DROP COLUMNãALTER COLUMNãADD CONSTRAINTã\nTrigger æ¯æ         æ¯æ FOR EACH ROW è§¦åå¨ï¼ä½ä¸æ¯æ FOR EACH STATEMENT è§¦åå¨ã\nVIEWs              å¨ SQLite ä¸­ï¼è§å¾æ¯åªè¯»çãæ¨ä¸å¯ä»¥å¨è§å¾ä¸æ§è¡ DELETEãINSERT æ UPDATE è¯­å¥ã\nGRANT å REVOKE     å¯ä»¥åºç¨çå¯ä¸çè®¿é®æéæ¯åºå±æä½ç³»ç»çæ­£å¸¸æä»¶è®¿é®æéã\n\n\n# å®è£\n\nSqlite å¯å¨ UNIXï¼Linux, Mac OS-X, Android, iOSï¼å Windowsï¼Win32, WinCE, WinRTï¼ä¸­è¿è¡ã\n\nä¸è¬ï¼Linux å Mac ä¸ä¼é¢å®è£ sqliteãå¦ææ²¡æå®è£ï¼å¯ä»¥å¨å®æ¹ä¸è½½å°åä¸è½½åéå®è£çæ¬ï¼èªè¡å®è£ã\n\n\n# SQLite è¯­æ³\n\n> è¿éä¸ä¼è¯¦ç»åä¸¾ææ SQL è¯­æ³ï¼ä»åä¸¾ SQLite é¤æ å SQL ä»¥å¤çï¼ä¸äºèªèº«ç¹æ®ç SQL è¯­æ³ã\n> \n> ð æ©å±éè¯»ï¼æ å SQL åºæ¬è¯­æ³\n\n\n# å¤§å°åææ\n\nSQLite æ¯ä¸åºåå¤§å°åçï¼ä½ä¹æä¸äºå½ä»¤æ¯å¤§å°åææçï¼æ¯å¦ GLOB å glob å¨ SQLite çè¯­å¥ä¸­æä¸åçå«ä¹ã\n\n\n# æ³¨é\n\n-- åè¡æ³¨é\n/*\n å¤è¡æ³¨é1\n å¤è¡æ³¨é2\n */\n\n\n\n# åå»ºæ°æ®åº\n\nå¦ä¸ï¼åå»ºä¸ä¸ªåä¸º test çæ°æ®åºï¼\n\n$ sqlite3 test.db\nSQLite version 3.7.17 2013-05-20 00:56:22\nEnter ".help" for instructions\nEnter SQL statements terminated with a ";"\n\n\n\n# æ¥çæ°æ®åº\n\nsqlite> .databases\nseq  name             file\n---  ---------------  ----------------------------------------------------------\n0    main             /root/test.db\n\n\n\n# éåºæ°æ®åº\n\nsqlite> .quit\n\n\n\n# éå æ°æ®åº\n\nåè®¾è¿æ ·ä¸ç§æåµï¼å½å¨åä¸æ¶é´æå¤ä¸ªæ°æ®åºå¯ç¨ï¼æ¨æ³ä½¿ç¨å¶ä¸­çä»»ä½ä¸ä¸ªã\n\nSQLite ç ATTACH DATABASE è¯­å¥æ¯ç¨æ¥éæ©ä¸ä¸ªç¹å®çæ°æ®åºï¼ä½¿ç¨è¯¥å½ä»¤åï¼ææç SQLite è¯­å¥å°å¨éå çæ°æ®åºä¸æ§è¡ã\n\nsqlite> ATTACH DATABASE \'test.db\' AS \'test\';\nsqlite> .databases\nseq  name             file\n---  ---------------  ----------------------------------------------------------\n0    main             /root/test.db\n2    test             /root/test.db\n\n\n> ð æ³¨æï¼æ°æ®åºå main å temp è¢«ä¿çç¨äºä¸»æ°æ®åºåå­å¨ä¸´æ¶è¡¨åå¶ä»ä¸´æ¶æ°æ®å¯¹è±¡çæ°æ®åºãè¿ä¸¤ä¸ªæ°æ®åºåç§°å¯ç¨äºæ¯ä¸ªæ°æ®åºè¿æ¥ï¼ä¸ä¸åºè¯¥è¢«ç¨äºéå ï¼å¦åå°å¾å°ä¸ä¸ªè­¦åæ¶æ¯ã\n\n\n# åç¦»æ°æ®åº\n\nSQLite ç DETACH DATABASE è¯­å¥æ¯ç¨æ¥æå½åæ°æ®åºä»ä¸ä¸ªæ°æ®åºè¿æ¥åç¦»åæ¸¸ç¦»åºæ¥ï¼è¿æ¥æ¯ä¹åä½¿ç¨ ATTACH è¯­å¥éå çã\n\nsqlite> .databases\nseq  name             file\n---  ---------------  ----------------------------------------------------------\n0    main             /root/test.db\n2    test             /root/test.db\nsqlite> DETACH DATABASE \'test\';\nsqlite> .databases\nseq  name             file\n---  ---------------  ----------------------------------------------------------\n0    main             /root/test.db\n\n\n\n# å¤ä»½æ°æ®åº\n\nå¦ä¸ï¼å¤ä»½ test æ°æ®åºå° /home/test.sql\n\nsqlite3 test.db .dump > /home/test.sql\n\n\n\n# æ¢å¤æ°æ®åº\n\nå¦ä¸ï¼æ ¹æ® /home/test.sql æ¢å¤ test æ°æ®åº\n\nsqlite3 test.db < test.sql\n\n\n\n# SQLite æ°æ®ç±»å\n\nSQLite ä½¿ç¨ä¸ä¸ªæ´æ®éçå¨æç±»åç³»ç»ãå¨ SQLite ä¸­ï¼å¼çæ°æ®ç±»åä¸å¼æ¬èº«æ¯ç¸å³çï¼èä¸æ¯ä¸å®çå®¹å¨ç¸å³ã\n\n\n# SQLite å­å¨ç±»\n\næ¯ä¸ªå­å¨å¨ SQLite æ°æ®åºä¸­çå¼é½å·æä»¥ä¸å­å¨ç±»ä¹ä¸ï¼\n\nå­å¨ç±»       æè¿°\nNULL      å¼æ¯ä¸ä¸ª NULL å¼ã\nINTEGER   å¼æ¯ä¸ä¸ªå¸¦ç¬¦å·çæ´æ°ï¼æ ¹æ®å¼çå¤§å°å­å¨å¨ 1ã2ã3ã4ã6 æ 8 å­èä¸­ã\nREAL      å¼æ¯ä¸ä¸ªæµ®ç¹å¼ï¼å­å¨ä¸º 8 å­èç IEEE æµ®ç¹æ°å­ã\nTEXT      å¼æ¯ä¸ä¸ªææ¬å­ç¬¦ä¸²ï¼ä½¿ç¨æ°æ®åºç¼ç ï¼UTF-8ãUTF-16BE æ UTF-16LEï¼å­å¨ã\nBLOB      å¼æ¯ä¸ä¸ª blob æ°æ®ï¼å®å¨æ ¹æ®å®çè¾å¥å­å¨ã\n\nSQLite çå­å¨ç±»ç¨å¾®æ¯æ°æ®ç±»åæ´æ®éãINTEGER å­å¨ç±»ï¼ä¾å¦ï¼åå« 6 ç§ä¸åçä¸åé¿åº¦çæ´æ°æ°æ®ç±»åã\n\n\n# SQLite äº²å(Affinity)ç±»å\n\nSQLite æ¯æåçäº²åç±»åæ¦å¿µãä»»ä½åä»ç¶å¯ä»¥å­å¨ä»»ä½ç±»åçæ°æ®ï¼å½æ°æ®æå¥æ¶ï¼è¯¥å­æ®µçæ°æ®å°ä¼ä¼åéç¨äº²ç¼ç±»åä½ä¸ºè¯¥å¼çå­å¨æ¹å¼ãSQLite ç®åççæ¬æ¯æä»¥ä¸äºç§äº²ç¼ç±»åï¼\n\näº²åç±»å      æè¿°\nTEXT      æ°å¼åæ°æ®å¨è¢«æå¥ä¹åï¼éè¦åè¢«è½¬æ¢ä¸ºææ¬æ ¼å¼ï¼ä¹ååæå¥å°ç®æ å­æ®µä¸­ã\nNUMERIC   å½ææ¬æ°æ®è¢«æå¥å°äº²ç¼æ§ä¸º NUMERIC çå­æ®µä¸­æ¶ï¼å¦æè½¬æ¢æä½ä¸ä¼å¯¼è´æ°æ®ä¿¡æ¯ä¸¢å¤±ä»¥åå®å¨å¯éï¼é£ä¹ SQLite\n          å°±ä¼å°è¯¥ææ¬æ°æ®è½¬æ¢ä¸º INTEGER æ REAL ç±»åçæ°æ®ï¼å¦æè½¬æ¢å¤±è´¥ï¼SQLite ä»ä¼ä»¥ TEXT\n          æ¹å¼å­å¨è¯¥æ°æ®ãå¯¹äº NULL æ BLOB ç±»åçæ°æ°æ®ï¼SQLite å°ä¸åä»»ä½è½¬æ¢ï¼ç´æ¥ä»¥ NULL æ BLOB\n          çæ¹å¼å­å¨è¯¥æ°æ®ãéè¦é¢å¤è¯´æçæ¯ï¼å¯¹äºæµ®ç¹æ ¼å¼çå¸¸éææ¬ï¼å¦"30000.0"ï¼å¦æè¯¥å¼å¯ä»¥è½¬æ¢ä¸º INTEGER\n          åæ¶åä¸ä¼ä¸¢å¤±æ°å¼ä¿¡æ¯ï¼é£ä¹ SQLite å°±ä¼å°å¶è½¬æ¢ä¸º INTEGER çå­å¨æ¹å¼ã\nINTEGER   å¯¹äºäº²ç¼ç±»åä¸º INTEGER çå­æ®µï¼å¶è§åç­åäº NUMERICï¼å¯ä¸å·®å«æ¯å¨æ§è¡ CAST è¡¨è¾¾å¼æ¶ã\nREAL      å¶è§ååºæ¬ç­åäº NUMERICï¼å¯ä¸çå·®å«æ¯ä¸ä¼å°"30000.0"è¿æ ·çææ¬æ°æ®è½¬æ¢ä¸º INTEGER å­å¨æ¹å¼ã\nNONE      ä¸åä»»ä½çè½¬æ¢ï¼ç´æ¥ä»¥è¯¥æ°æ®æå±çæ°æ®ç±»åè¿è¡å­å¨ã\n\n\n# SQLite äº²åç±»å(Affinity)åç±»ååç§°\n\nä¸è¡¨ååºäºå½åå»º SQLite3 è¡¨æ¶å¯ä½¿ç¨çåç§æ°æ®ç±»ååç§°ï¼åæ¶ä¹æ¾ç¤ºäºç¸åºçäº²åç±»åï¼\n\næ°æ®ç±»å                                                           äº²åç±»å\nINT, INTEGER, TINYINT, SMALLINT, MEDIUMINT, BIGINT, UNSIGNED   INTEGER\nBIG INT, INT2, INT8\nCHARACTER(20), VARCHAR(255), VARYING CHARACTER(255),           TEXT\nNCHAR(55), NATIVE CHARACTER(70), NVARCHAR(100), TEXT, CLOB\nBLOB, no datatype specified                                    NONE\nREAL, DOUBLE, DOUBLE PRECISION, FLOAT                          REAL\nNUMERIC, DECIMAL(10,5), BOOLEAN, DATE, DATETIME                NUMERIC\n\n\n# Boolean æ°æ®ç±»å\n\nSQLite æ²¡æåç¬ç Boolean å­å¨ç±»ãç¸åï¼å¸å°å¼è¢«å­å¨ä¸ºæ´æ° 0ï¼falseï¼å 1ï¼trueï¼ã\n\n\n# Date ä¸ Time æ°æ®ç±»å\n\nSQLite æ²¡æä¸ä¸ªåç¬çç¨äºå­å¨æ¥æå/ææ¶é´çå­å¨ç±»ï¼ä½ SQLite è½å¤ææ¥æåæ¶é´å­å¨ä¸º TEXTãREAL æ INTEGER å¼ã\n\nå­å¨ç±»       æ¥ææ ¼å¼\nTEXT      æ ¼å¼ä¸º "YYYY-MM-DD HH:MM:SS.SSS" çæ¥æã\nREAL      ä»å¬åå 4714 å¹´ 11 æ 24 æ¥æ ¼æå°¼æ²»æ¶é´çæ­£åå¼å§ç®èµ·çå¤©æ°ã\nINTEGER   ä» 1970-01-01 00:00:00 UTC ç®èµ·çç§æ°ã\n\næ¨å¯ä»¥ä»¥ä»»ä½ä¸è¿°æ ¼å¼æ¥å­å¨æ¥æåæ¶é´ï¼å¹¶ä¸å¯ä»¥ä½¿ç¨åç½®çæ¥æåæ¶é´å½æ°æ¥èªç±è½¬æ¢ä¸åæ ¼å¼ã\n\n\n# SQLite å½ä»¤\n\n\n# å¿«éå¼å§\n\n# è¿å¥ SQLite æ§å¶å°\n\n$ sqlite3\nSQLite version 3.7.17 2013-05-20 00:56:22\nEnter ".help" for instructions\nEnter SQL statements terminated with a ";"\nsqlite>\n\n\n# è¿å¥ SQLite æ§å¶å°å¹¶æå®æ°æ®åº\n\n$ sqlite3 test.db\nSQLite version 3.7.17 2013-05-20 00:56:22\nEnter ".help" for instructions\nEnter SQL statements terminated with a ";"\nsqlite>\n\n\n# éåº SQLite æ§å¶å°\n\nsqlite>.quit\n\n\n# æ¥çå½ä»¤å¸®å©\n\nsqlite>.help\n\n\n\n# å¸¸ç¨å½ä»¤æ¸å\n\nå½ä»¤                      æè¿°\n.backup ?DB? FILE       å¤ä»½ DB æ°æ®åºï¼é»è®¤æ¯ "main"ï¼å° FILE æä»¶ã\n.bail ON|OFF            åçéè¯¯ååæ­¢ãé»è®¤ä¸º OFFã\n.databases              ååºæ°æ®åºçåç§°åå¶æä¾éçæä»¶ã\n.dump ?TABLE?           ä»¥ SQL ææ¬æ ¼å¼è½¬å¨æ°æ®åºãå¦ææå®äº TABLE è¡¨ï¼ååªè½¬å¨å¹é LIKE æ¨¡å¼ç TABLE è¡¨ã\n.echo ON|OFF            å¼å¯æå³é­ echo å½ä»¤ã\n.exit                   éåº SQLite æç¤ºç¬¦ã\n.explain ON|OFF         å¼å¯æå³é­éåäº EXPLAIN çè¾åºæ¨¡å¼ãå¦ææ²¡æå¸¦åæ°ï¼åä¸º EXPLAIN onï¼åå¼å¯ EXPLAINã\n.header(s) ON|OFF       å¼å¯æå³é­å¤´é¨æ¾ç¤ºã\n.help                   æ¾ç¤ºæ¶æ¯ã\n.import FILE TABLE      å¯¼å¥æ¥èª FILE æä»¶çæ°æ®å° TABLE è¡¨ä¸­ã\n.indices ?TABLE?        æ¾ç¤ºææç´¢å¼çåç§°ãå¦ææå®äº TABLE è¡¨ï¼ååªæ¾ç¤ºå¹é LIKE æ¨¡å¼ç TABLE è¡¨çç´¢å¼ã\n.load FILE ?ENTRY?      å è½½ä¸ä¸ªæ©å±åºã\n.log FILE|off           å¼å¯æå³é­æ¥å¿ãFILE æä»¶å¯ä»¥æ¯ stderrï¼æ åéè¯¯ï¼/stdoutï¼æ åè¾åºï¼ã\n.mode MODE              è®¾ç½®è¾åºæ¨¡å¼ï¼MODE å¯ä»¥æ¯ä¸åä¹ä¸ï¼csv éå·åéçå¼column å·¦å¯¹é½çåhtml HTML ç\n.nullvalue STRING       å¨ NULL å¼çå°æ¹è¾åº STRING å­ç¬¦ä¸²ã\n.output FILENAME        åéè¾åºå° FILENAME æä»¶ã\n.output stdout          åéè¾åºå°å±å¹ã\n.print STRING...        éå­å°è¾åº STRING å­ç¬¦ä¸²ã\n.prompt MAIN CONTINUE   æ¿æ¢æ åæç¤ºç¬¦ã\n.quit                   éåº SQLite æç¤ºç¬¦ã\n.read FILENAME          æ§è¡ FILENAME æä»¶ä¸­ç SQLã\n.schema ?TABLE?         æ¾ç¤º CREATE è¯­å¥ãå¦ææå®äº TABLE è¡¨ï¼ååªæ¾ç¤ºå¹é LIKE æ¨¡å¼ç TABLE è¡¨ã\n.separator STRING       æ¹åè¾åºæ¨¡å¼å .import æä½¿ç¨çåéç¬¦ã\n.show                   æ¾ç¤ºåç§è®¾ç½®çå½åå¼ã\n.stats ON|OFF           å¼å¯æå³é­ç»è®¡ã\n.tables ?PATTERN?       ååºå¹é LIKE æ¨¡å¼çè¡¨çåç§°ã\n.timeout MS             å°è¯æå¼éå®çè¡¨ MS æ¯«ç§ã\n.width NUM NUM          ä¸º "column" æ¨¡å¼è®¾ç½®åå®½åº¦ã\n.timer ON|OFF           å¼å¯æå³é­ CPU å®æ¶å¨ã\n\n\n# å®æ\n\n# æ ¼å¼åè¾åº\n\nsqlite>.header on\nsqlite>.mode column\nsqlite>.timer on\nsqlite>\n\n\n# è¾åºç»æå°æä»¶\n\nsqlite> .mode list\nsqlite> .separator |\nsqlite> .output teyptest_file_1.txt\nsqlite> select * from tbl1;\nsqlite> .exit\n$ cat test_file_1.txt\nhello|10\ngoodbye|20\n$\n\n\n\n# SQLite JAVA Client\n\nï¼1ï¼å¨å®æ¹ä¸è½½å°åä¸è½½ sqlite-jdbc-(VERSION).jar ï¼ç¶åå° jar åæ¾å¨é¡¹ç®ä¸­ç classpathã\n\nï¼2ï¼éè¿ API æå¼ä¸ä¸ª SQLite æ°æ®åºè¿æ¥ã\n\næ§è¡æ¹æ³ï¼\n\n> javac Sample.java\n> java -classpath ".;sqlite-jdbc-(VERSION).jar" Sample   # in Windows\nor\n> java -classpath ".:sqlite-jdbc-(VERSION).jar" Sample   # in Mac or Linux\nname = leo\nid = 1\nname = yui\nid = 2\n\n\nç¤ºä¾ï¼\n\npublic class Sample {\n    public static void main(String[] args) {\n        Connection connection = null;\n        try {\n            // åå»ºæ°æ®åºè¿æ¥\n            connection = DriverManager.getConnection("jdbc:sqlite:sample.db");\n            Statement statement = connection.createStatement();\n            statement.setQueryTimeout(30);  // è®¾ç½® sql æ§è¡è¶æ¶æ¶é´ä¸º 30s\n\n            statement.executeUpdate("drop table if exists person");\n            statement.executeUpdate("create table person (id integer, name string)");\n            statement.executeUpdate("insert into person values(1, \'leo\')");\n            statement.executeUpdate("insert into person values(2, \'yui\')");\n            ResultSet rs = statement.executeQuery("select * from person");\n            while (rs.next()) {\n                // è¯»åç»æé\n                System.out.println("name = " + rs.getString("name"));\n                System.out.println("id = " + rs.getInt("id"));\n            }\n        } catch (SQLException e) {\n            // å¦æéè¯¯ä¿¡æ¯æ¯ "out of memory"ï¼å¯è½æ¯æ¾ä¸å°æ°æ®åºæä»¶\n            System.err.println(e.getMessage());\n        } finally {\n            try {\n                if (connection != null) {\n                    connection.close();\n                }\n            } catch (SQLException e) {\n                // å³é­è¿æ¥å¤±è´¥\n                System.err.println(e.getMessage());\n            }\n        }\n    }\n}\n\n\n\n# å¦ä½æå®æ°æ®åºæä»¶\n\nWindows\n\nConnection connection = DriverManager.getConnection("jdbc:sqlite:C:/work/mydatabase.db");\n\n\nUnix (Linux, Mac OS X, etc)\n\nConnection connection = DriverManager.getConnection("jdbc:sqlite:/home/leo/work/mydatabase.db");\n\n\n\n# å¦ä½ä½¿ç¨åå­æ°æ®åº\n\nConnection connection = DriverManager.getConnection("jdbc:sqlite::memory:");\n\n\n\n# åèèµæ\n\n * SQLite å®ç½\n * SQLite Github\n * SQLite å®æ¹ææ¡£\n * SQLite å®æ¹å½ä»¤è¡æå\n * http://www.runoob.com/sqlite/sqlite-commands.html\n * https://github.com/xerial/sqlite-jdbc\n * http://www.runoob.com/sqlite/sqlite-java.html\n\n\n# ðª ä¼ éé¨\n\n| éæçåå®¢ | db-tutorial é¦é¡µ |',normalizedContent:'# sqlite\n\n> sqlite æ¯ä¸ä¸ªæ æå¡å¨çãé¶éç½®çãäºå¡æ§ççå¼æºæ°æ®åºå¼æã ð» å®æ´ç¤ºä¾æºç \n\n\n# sqlite ç®ä»\n\nsqlite æ¯ä¸ä¸ªcè¯­è¨ç¼åçè½»éçº§ãå¨åè½ãæ æå¡å¨ãé¶éç½®ççå¼æºæ°æ®åºå¼æã\n\nsqlite çè®¾è®¡ç®æ æ¯åµå¥å¼çæ°æ®åºï¼å¾å¤åµå¥å¼äº§åä¸­é½ä½¿ç¨äºå®ãsqlite ååè½»éï¼å ç¨èµæºéå¸¸çä½ï¼å¨åµå¥å¼è®¾å¤ä¸­ï¼å¯è½åªéè¦å ç¾kçåå­å°±å¤äºãsqlite è½å¤æ¯æwindows/linux/unixç­ç­ä¸»æµçæä½ç³»ç»ï¼åæ¶è½å¤è·å¾å¤ç¨åºè¯­è¨ç¸ç»åï¼åæ ·æ¯èµ·mysqlãpostgresqlè¿ä¸¤æ¬¾å¼æºçä¸çèåæ°æ®åºç®¡çç³»ç»æ¥è®²ï¼å®çå¤çéåº¦æ¯ä»ä»¬é½å¿«ã\n\nsqlite å¤§å°åªæ 3m å·¦å³ï¼å¯ä»¥å°æ´ä¸ª sqlite åµå¥å°åºç¨ä¸­ï¼èä¸ç¨éç¨ä¼ ç»çå®¢æ·ç«¯ï¼æå¡å¨ï¼client/serverï¼çæ¶æãè¿æ ·åçå¥½å¤å°±æ¯éå¸¸è½»ä¾¿ï¼å¨è®¸å¤æºè½è®¾å¤ååºç¨ä¸­é½å¯ä»¥ä½¿ç¨ sqliteï¼æ¯å¦å¾®ä¿¡å°±éç¨äº sqlite ä½ä¸ºæ¬å°èå¤©è®°å½çå­å¨ã\n\n\n# ä¼ç¹\n\n * sqlite æ¯èªç»èªè¶³çï¼è¿æå³çä¸éè¦ä»»ä½å¤é¨çä¾èµã\n * sqlite æ¯æ æå¡å¨çãé¶éç½®çï¼è¿æå³çä¸éè¦å®è£æç®¡çã\n * sqlite äºå¡æ¯å®å¨å¼å®¹ acid çï¼åè®¸ä»å¤ä¸ªè¿ç¨æçº¿ç¨å®å¨è®¿é®ã\n * sqlite æ¯éå¸¸å°çï¼æ¯è½»éçº§çï¼å®å¨éç½®æ¶å°äº 400kibï¼çç¥å¯éåè½éç½®æ¶å°äº 250kibã\n * sqlite æ¯æ sql92ï¼sql2ï¼æ åçå¤§å¤æ°æ¥è¯¢è¯­è¨çåè½ã\n * ä¸ä¸ªå®æ´ç sqlite æ°æ®åºæ¯å­å¨å¨ä¸ä¸ªåä¸çè·¨å¹³å°çç£çæä»¶ã\n * sqlite ä½¿ç¨ ansi-c ç¼åçï¼å¹¶æä¾äºç®ååæäºä½¿ç¨ç apiã\n * sqlite å¯å¨ unixï¼linux, mac os-x, android, iosï¼å windowsï¼win32, wince, winrtï¼ä¸­è¿è¡ã\n\n\n# å±é\n\nç¹æ§                 æè¿°\nright outer join   åªå®ç°äº left outer joinã\nfull outer join    åªå®ç°äº left outer joinã\nalter table        æ¯æ rename table å alter table ç add column variants å½ä»¤ï¼ä¸æ¯æ\n                   drop columnãalter columnãadd constraintã\ntrigger æ¯æ         æ¯æ for each row è§¦åå¨ï¼ä½ä¸æ¯æ for each statement è§¦åå¨ã\nviews              å¨ sqlite ä¸­ï¼è§å¾æ¯åªè¯»çãæ¨ä¸å¯ä»¥å¨è§å¾ä¸æ§è¡ deleteãinsert æ update è¯­å¥ã\ngrant å revoke     å¯ä»¥åºç¨çå¯ä¸çè®¿é®æéæ¯åºå±æä½ç³»ç»çæ­£å¸¸æä»¶è®¿é®æéã\n\n\n# å®è£\n\nsqlite å¯å¨ unixï¼linux, mac os-x, android, iosï¼å windowsï¼win32, wince, winrtï¼ä¸­è¿è¡ã\n\nä¸è¬ï¼linux å mac ä¸ä¼é¢å®è£ sqliteãå¦ææ²¡æå®è£ï¼å¯ä»¥å¨å®æ¹ä¸è½½å°åä¸è½½åéå®è£çæ¬ï¼èªè¡å®è£ã\n\n\n# sqlite è¯­æ³\n\n> è¿éä¸ä¼è¯¦ç»åä¸¾ææ sql è¯­æ³ï¼ä»åä¸¾ sqlite é¤æ å sql ä»¥å¤çï¼ä¸äºèªèº«ç¹æ®ç sql è¯­æ³ã\n> \n> ð æ©å±éè¯»ï¼æ å sql åºæ¬è¯­æ³\n\n\n# å¤§å°åææ\n\nsqlite æ¯ä¸åºåå¤§å°åçï¼ä½ä¹æä¸äºå½ä»¤æ¯å¤§å°åææçï¼æ¯å¦ glob å glob å¨ sqlite çè¯­å¥ä¸­æä¸åçå«ä¹ã\n\n\n# æ³¨é\n\n-- åè¡æ³¨é\n/*\n å¤è¡æ³¨é1\n å¤è¡æ³¨é2\n */\n\n\n\n# åå»ºæ°æ®åº\n\nå¦ä¸ï¼åå»ºä¸ä¸ªåä¸º test çæ°æ®åºï¼\n\n$ sqlite3 test.db\nsqlite version 3.7.17 2013-05-20 00:56:22\nenter ".help" for instructions\nenter sql statements terminated with a ";"\n\n\n\n# æ¥çæ°æ®åº\n\nsqlite> .databases\nseq  name             file\n---  ---------------  ----------------------------------------------------------\n0    main             /root/test.db\n\n\n\n# éåºæ°æ®åº\n\nsqlite> .quit\n\n\n\n# éå æ°æ®åº\n\nåè®¾è¿æ ·ä¸ç§æåµï¼å½å¨åä¸æ¶é´æå¤ä¸ªæ°æ®åºå¯ç¨ï¼æ¨æ³ä½¿ç¨å¶ä¸­çä»»ä½ä¸ä¸ªã\n\nsqlite ç attach database è¯­å¥æ¯ç¨æ¥éæ©ä¸ä¸ªç¹å®çæ°æ®åºï¼ä½¿ç¨è¯¥å½ä»¤åï¼ææç sqlite è¯­å¥å°å¨éå çæ°æ®åºä¸æ§è¡ã\n\nsqlite> attach database \'test.db\' as \'test\';\nsqlite> .databases\nseq  name             file\n---  ---------------  ----------------------------------------------------------\n0    main             /root/test.db\n2    test             /root/test.db\n\n\n> ð æ³¨æï¼æ°æ®åºå main å temp è¢«ä¿çç¨äºä¸»æ°æ®åºåå­å¨ä¸´æ¶è¡¨åå¶ä»ä¸´æ¶æ°æ®å¯¹è±¡çæ°æ®åºãè¿ä¸¤ä¸ªæ°æ®åºåç§°å¯ç¨äºæ¯ä¸ªæ°æ®åºè¿æ¥ï¼ä¸ä¸åºè¯¥è¢«ç¨äºéå ï¼å¦åå°å¾å°ä¸ä¸ªè­¦åæ¶æ¯ã\n\n\n# åç¦»æ°æ®åº\n\nsqlite ç detach database è¯­å¥æ¯ç¨æ¥æå½åæ°æ®åºä»ä¸ä¸ªæ°æ®åºè¿æ¥åç¦»åæ¸¸ç¦»åºæ¥ï¼è¿æ¥æ¯ä¹åä½¿ç¨ attach è¯­å¥éå çã\n\nsqlite> .databases\nseq  name             file\n---  ---------------  ----------------------------------------------------------\n0    main             /root/test.db\n2    test             /root/test.db\nsqlite> detach database \'test\';\nsqlite> .databases\nseq  name             file\n---  ---------------  ----------------------------------------------------------\n0    main             /root/test.db\n\n\n\n# å¤ä»½æ°æ®åº\n\nå¦ä¸ï¼å¤ä»½ test æ°æ®åºå° /home/test.sql\n\nsqlite3 test.db .dump > /home/test.sql\n\n\n\n# æ¢å¤æ°æ®åº\n\nå¦ä¸ï¼æ ¹æ® /home/test.sql æ¢å¤ test æ°æ®åº\n\nsqlite3 test.db < test.sql\n\n\n\n# sqlite æ°æ®ç±»å\n\nsqlite ä½¿ç¨ä¸ä¸ªæ´æ®éçå¨æç±»åç³»ç»ãå¨ sqlite ä¸­ï¼å¼çæ°æ®ç±»åä¸å¼æ¬èº«æ¯ç¸å³çï¼èä¸æ¯ä¸å®çå®¹å¨ç¸å³ã\n\n\n# sqlite å­å¨ç±»\n\næ¯ä¸ªå­å¨å¨ sqlite æ°æ®åºä¸­çå¼é½å·æä»¥ä¸å­å¨ç±»ä¹ä¸ï¼\n\nå­å¨ç±»       æè¿°\nnull      å¼æ¯ä¸ä¸ª null å¼ã\ninteger   å¼æ¯ä¸ä¸ªå¸¦ç¬¦å·çæ´æ°ï¼æ ¹æ®å¼çå¤§å°å­å¨å¨ 1ã2ã3ã4ã6 æ 8 å­èä¸­ã\nreal      å¼æ¯ä¸ä¸ªæµ®ç¹å¼ï¼å­å¨ä¸º 8 å­èç ieee æµ®ç¹æ°å­ã\ntext      å¼æ¯ä¸ä¸ªææ¬å­ç¬¦ä¸²ï¼ä½¿ç¨æ°æ®åºç¼ç ï¼utf-8ãutf-16be æ utf-16leï¼å­å¨ã\nblob      å¼æ¯ä¸ä¸ª blob æ°æ®ï¼å®å¨æ ¹æ®å®çè¾å¥å­å¨ã\n\nsqlite çå­å¨ç±»ç¨å¾®æ¯æ°æ®ç±»åæ´æ®éãinteger å­å¨ç±»ï¼ä¾å¦ï¼åå« 6 ç§ä¸åçä¸åé¿åº¦çæ´æ°æ°æ®ç±»åã\n\n\n# sqlite äº²å(affinity)ç±»å\n\nsqlite æ¯æåçäº²åç±»åæ¦å¿µãä»»ä½åä»ç¶å¯ä»¥å­å¨ä»»ä½ç±»åçæ°æ®ï¼å½æ°æ®æå¥æ¶ï¼è¯¥å­æ®µçæ°æ®å°ä¼ä¼åéç¨äº²ç¼ç±»åä½ä¸ºè¯¥å¼çå­å¨æ¹å¼ãsqlite ç®åççæ¬æ¯æä»¥ä¸äºç§äº²ç¼ç±»åï¼\n\näº²åç±»å      æè¿°\ntext      æ°å¼åæ°æ®å¨è¢«æå¥ä¹åï¼éè¦åè¢«è½¬æ¢ä¸ºææ¬æ ¼å¼ï¼ä¹ååæå¥å°ç®æ å­æ®µä¸­ã\nnumeric   å½ææ¬æ°æ®è¢«æå¥å°äº²ç¼æ§ä¸º numeric çå­æ®µä¸­æ¶ï¼å¦æè½¬æ¢æä½ä¸ä¼å¯¼è´æ°æ®ä¿¡æ¯ä¸¢å¤±ä»¥åå®å¨å¯éï¼é£ä¹ sqlite\n          å°±ä¼å°è¯¥ææ¬æ°æ®è½¬æ¢ä¸º integer æ real ç±»åçæ°æ®ï¼å¦æè½¬æ¢å¤±è´¥ï¼sqlite ä»ä¼ä»¥ text\n          æ¹å¼å­å¨è¯¥æ°æ®ãå¯¹äº null æ blob ç±»åçæ°æ°æ®ï¼sqlite å°ä¸åä»»ä½è½¬æ¢ï¼ç´æ¥ä»¥ null æ blob\n          çæ¹å¼å­å¨è¯¥æ°æ®ãéè¦é¢å¤è¯´æçæ¯ï¼å¯¹äºæµ®ç¹æ ¼å¼çå¸¸éææ¬ï¼å¦"30000.0"ï¼å¦æè¯¥å¼å¯ä»¥è½¬æ¢ä¸º integer\n          åæ¶åä¸ä¼ä¸¢å¤±æ°å¼ä¿¡æ¯ï¼é£ä¹ sqlite å°±ä¼å°å¶è½¬æ¢ä¸º integer çå­å¨æ¹å¼ã\ninteger   å¯¹äºäº²ç¼ç±»åä¸º integer çå­æ®µï¼å¶è§åç­åäº numericï¼å¯ä¸å·®å«æ¯å¨æ§è¡ cast è¡¨è¾¾å¼æ¶ã\nreal      å¶è§ååºæ¬ç­åäº numericï¼å¯ä¸çå·®å«æ¯ä¸ä¼å°"30000.0"è¿æ ·çææ¬æ°æ®è½¬æ¢ä¸º integer å­å¨æ¹å¼ã\nnone      ä¸åä»»ä½çè½¬æ¢ï¼ç´æ¥ä»¥è¯¥æ°æ®æå±çæ°æ®ç±»åè¿è¡å­å¨ã\n\n\n# sqlite äº²åç±»å(affinity)åç±»ååç§°\n\nä¸è¡¨ååºäºå½åå»º sqlite3 è¡¨æ¶å¯ä½¿ç¨çåç§æ°æ®ç±»ååç§°ï¼åæ¶ä¹æ¾ç¤ºäºç¸åºçäº²åç±»åï¼\n\næ°æ®ç±»å                                                           äº²åç±»å\nint, integer, tinyint, smallint, mediumint, bigint, unsigned   integer\nbig int, int2, int8\ncharacter(20), varchar(255), varying character(255),           text\nnchar(55), native character(70), nvarchar(100), text, clob\nblob, no datatype specified                                    none\nreal, double, double precision, float                          real\nnumeric, decimal(10,5), boolean, date, datetime                numeric\n\n\n# boolean æ°æ®ç±»å\n\nsqlite æ²¡æåç¬ç boolean å­å¨ç±»ãç¸åï¼å¸å°å¼è¢«å­å¨ä¸ºæ´æ° 0ï¼falseï¼å 1ï¼trueï¼ã\n\n\n# date ä¸ time æ°æ®ç±»å\n\nsqlite æ²¡æä¸ä¸ªåç¬çç¨äºå­å¨æ¥æå/ææ¶é´çå­å¨ç±»ï¼ä½ sqlite è½å¤ææ¥æåæ¶é´å­å¨ä¸º textãreal æ integer å¼ã\n\nå­å¨ç±»       æ¥ææ ¼å¼\ntext      æ ¼å¼ä¸º "yyyy-mm-dd hh:mm:ss.sss" çæ¥æã\nreal      ä»å¬åå 4714 å¹´ 11 æ 24 æ¥æ ¼æå°¼æ²»æ¶é´çæ­£åå¼å§ç®èµ·çå¤©æ°ã\ninteger   ä» 1970-01-01 00:00:00 utc ç®èµ·çç§æ°ã\n\næ¨å¯ä»¥ä»¥ä»»ä½ä¸è¿°æ ¼å¼æ¥å­å¨æ¥æåæ¶é´ï¼å¹¶ä¸å¯ä»¥ä½¿ç¨åç½®çæ¥æåæ¶é´å½æ°æ¥èªç±è½¬æ¢ä¸åæ ¼å¼ã\n\n\n# sqlite å½ä»¤\n\n\n# å¿«éå¼å§\n\n# è¿å¥ sqlite æ§å¶å°\n\n$ sqlite3\nsqlite version 3.7.17 2013-05-20 00:56:22\nenter ".help" for instructions\nenter sql statements terminated with a ";"\nsqlite>\n\n\n# è¿å¥ sqlite æ§å¶å°å¹¶æå®æ°æ®åº\n\n$ sqlite3 test.db\nsqlite version 3.7.17 2013-05-20 00:56:22\nenter ".help" for instructions\nenter sql statements terminated with a ";"\nsqlite>\n\n\n# éåº sqlite æ§å¶å°\n\nsqlite>.quit\n\n\n# æ¥çå½ä»¤å¸®å©\n\nsqlite>.help\n\n\n\n# å¸¸ç¨å½ä»¤æ¸å\n\nå½ä»¤                      æè¿°\n.backup ?db? file       å¤ä»½ db æ°æ®åºï¼é»è®¤æ¯ "main"ï¼å° file æä»¶ã\n.bail on|off            åçéè¯¯ååæ­¢ãé»è®¤ä¸º offã\n.databases              ååºæ°æ®åºçåç§°åå¶æä¾éçæä»¶ã\n.dump ?table?           ä»¥ sql ææ¬æ ¼å¼è½¬å¨æ°æ®åºãå¦ææå®äº table è¡¨ï¼ååªè½¬å¨å¹é like æ¨¡å¼ç table è¡¨ã\n.echo on|off            å¼å¯æå³é­ echo å½ä»¤ã\n.exit                   éåº sqlite æç¤ºç¬¦ã\n.explain on|off         å¼å¯æå³é­éåäº explain çè¾åºæ¨¡å¼ãå¦ææ²¡æå¸¦åæ°ï¼åä¸º explain onï¼åå¼å¯ explainã\n.header(s) on|off       å¼å¯æå³é­å¤´é¨æ¾ç¤ºã\n.help                   æ¾ç¤ºæ¶æ¯ã\n.import file table      å¯¼å¥æ¥èª file æä»¶çæ°æ®å° table è¡¨ä¸­ã\n.indices ?table?        æ¾ç¤ºææç´¢å¼çåç§°ãå¦ææå®äº table è¡¨ï¼ååªæ¾ç¤ºå¹é like æ¨¡å¼ç table è¡¨çç´¢å¼ã\n.load file ?entry?      å è½½ä¸ä¸ªæ©å±åºã\n.log file|off           å¼å¯æå³é­æ¥å¿ãfile æä»¶å¯ä»¥æ¯ stderrï¼æ åéè¯¯ï¼/stdoutï¼æ åè¾åºï¼ã\n.mode mode              è®¾ç½®è¾åºæ¨¡å¼ï¼mode å¯ä»¥æ¯ä¸åä¹ä¸ï¼csv éå·åéçå¼column å·¦å¯¹é½çåhtml html ç\n.nullvalue string       å¨ null å¼çå°æ¹è¾åº string å­ç¬¦ä¸²ã\n.output filename        åéè¾åºå° filename æä»¶ã\n.output stdout          åéè¾åºå°å±å¹ã\n.print string...        éå­å°è¾åº string å­ç¬¦ä¸²ã\n.prompt main continue   æ¿æ¢æ åæç¤ºç¬¦ã\n.quit                   éåº sqlite æç¤ºç¬¦ã\n.read filename          æ§è¡ filename æä»¶ä¸­ç sqlã\n.schema ?table?         æ¾ç¤º create è¯­å¥ãå¦ææå®äº table è¡¨ï¼ååªæ¾ç¤ºå¹é like æ¨¡å¼ç table è¡¨ã\n.separator string       æ¹åè¾åºæ¨¡å¼å .import æä½¿ç¨çåéç¬¦ã\n.show                   æ¾ç¤ºåç§è®¾ç½®çå½åå¼ã\n.stats on|off           å¼å¯æå³é­ç»è®¡ã\n.tables ?pattern?       ååºå¹é like æ¨¡å¼çè¡¨çåç§°ã\n.timeout ms             å°è¯æå¼éå®çè¡¨ ms æ¯«ç§ã\n.width num num          ä¸º "column" æ¨¡å¼è®¾ç½®åå®½åº¦ã\n.timer on|off           å¼å¯æå³é­ cpu å®æ¶å¨ã\n\n\n# å®æ\n\n# æ ¼å¼åè¾åº\n\nsqlite>.header on\nsqlite>.mode column\nsqlite>.timer on\nsqlite>\n\n\n# è¾åºç»æå°æä»¶\n\nsqlite> .mode list\nsqlite> .separator |\nsqlite> .output teyptest_file_1.txt\nsqlite> select * from tbl1;\nsqlite> .exit\n$ cat test_file_1.txt\nhello|10\ngoodbye|20\n$\n\n\n\n# sqlite java client\n\nï¼1ï¼å¨å®æ¹ä¸è½½å°åä¸è½½ sqlite-jdbc-(version).jar ï¼ç¶åå° jar åæ¾å¨é¡¹ç®ä¸­ç classpathã\n\nï¼2ï¼éè¿ api æå¼ä¸ä¸ª sqlite æ°æ®åºè¿æ¥ã\n\næ§è¡æ¹æ³ï¼\n\n> javac sample.java\n> java -classpath ".;sqlite-jdbc-(version).jar" sample   # in windows\nor\n> java -classpath ".:sqlite-jdbc-(version).jar" sample   # in mac or linux\nname = leo\nid = 1\nname = yui\nid = 2\n\n\nç¤ºä¾ï¼\n\npublic class sample {\n    public static void main(string[] args) {\n        connection connection = null;\n        try {\n            // åå»ºæ°æ®åºè¿æ¥\n            connection = drivermanager.getconnection("jdbc:sqlite:sample.db");\n            statement statement = connection.createstatement();\n            statement.setquerytimeout(30);  // è®¾ç½® sql æ§è¡è¶æ¶æ¶é´ä¸º 30s\n\n            statement.executeupdate("drop table if exists person");\n            statement.executeupdate("create table person (id integer, name string)");\n            statement.executeupdate("insert into person values(1, \'leo\')");\n            statement.executeupdate("insert into person values(2, \'yui\')");\n            resultset rs = statement.executequery("select * from person");\n            while (rs.next()) {\n                // è¯»åç»æé\n                system.out.println("name = " + rs.getstring("name"));\n                system.out.println("id = " + rs.getint("id"));\n            }\n        } catch (sqlexception e) {\n            // å¦æéè¯¯ä¿¡æ¯æ¯ "out of memory"ï¼å¯è½æ¯æ¾ä¸å°æ°æ®åºæä»¶\n            system.err.println(e.getmessage());\n        } finally {\n            try {\n                if (connection != null) {\n                    connection.close();\n                }\n            } catch (sqlexception e) {\n                // å³é­è¿æ¥å¤±è´¥\n                system.err.println(e.getmessage());\n            }\n        }\n    }\n}\n\n\n\n# å¦ä½æå®æ°æ®åºæä»¶\n\nwindows\n\nconnection connection = drivermanager.getconnection("jdbc:sqlite:c:/work/mydatabase.db");\n\n\nunix (linux, mac os x, etc)\n\nconnection connection = drivermanager.getconnection("jdbc:sqlite:/home/leo/work/mydatabase.db");\n\n\n\n# å¦ä½ä½¿ç¨åå­æ°æ®åº\n\nconnection connection = drivermanager.getconnection("jdbc:sqlite::memory:");\n\n\n\n# åèèµæ\n\n * sqlite å®ç½\n * sqlite github\n * sqlite å®æ¹ææ¡£\n * sqlite å®æ¹å½ä»¤è¡æå\n * http://www.runoob.com/sqlite/sqlite-commands.html\n * https://github.com/xerial/sqlite-jdbc\n * http://www.runoob.com/sqlite/sqlite-java.html\n\n\n# ðª ä¼ éé¨\n\n| éæçåå®¢ | db-tutorial é¦é¡µ |',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"MongoDB åºç¨æå",frontmatter:{title:"MongoDB åºç¨æå",date:"2020-09-07T07:54:19.000Z",categories:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],tags:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],permalink:"/pages/3288f3/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/04.%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/01.MongoDB/01.MongoDB%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97.html",relativePath:"12.æ°æ®åº/04.ææ¡£æ°æ®åº/01.MongoDB/01.MongoDBåºç¨æå.md",key:"v-62392692",path:"/pages/3288f3/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:19},{level:3,title:"MongoDB åå±",slug:"mongodb-åå±",normalizedTitle:"mongodb åå±",charIndex:178},{level:3,title:"MongoDB å RDBMS",slug:"mongodb-å-rdbms",normalizedTitle:"mongodb å rdbms",charIndex:273},{level:3,title:"MongoDB ç¹æ§",slug:"mongodb-ç¹æ§",normalizedTitle:"mongodb ç¹æ§",charIndex:652},{level:2,title:"MongoDB æ¦å¿µ",slug:"mongodb-æ¦å¿µ",normalizedTitle:"mongodb æ¦å¿µ",charIndex:748},{level:3,title:"æ°æ®åº",slug:"æ°æ®åº",normalizedTitle:"æ°æ®åº",charIndex:44},{level:3,title:"ææ¡£",slug:"ææ¡£",normalizedTitle:"ææ¡£",charIndex:105},{level:3,title:"éå",slug:"éå",normalizedTitle:"éå",charIndex:865},{level:3,title:"åæ°æ®",slug:"åæ°æ®",normalizedTitle:"åæ°æ®",charIndex:2594},{level:2,title:"MongoDB æ°æ®ç±»å",slug:"mongodb-æ°æ®ç±»å",normalizedTitle:"mongodb æ°æ®ç±»å",charIndex:3092},{level:2,title:"MongoDB CRUD",slug:"mongodb-crud",normalizedTitle:"mongodb crud",charIndex:3848},{level:3,title:"æ°æ®åºæä½",slug:"æ°æ®åºæä½",normalizedTitle:"æ°æ®åºæä½",charIndex:3865},{level:4,title:"æ¥çæææ°æ®åº",slug:"æ¥çæææ°æ®åº",normalizedTitle:"æ¥çæææ°æ®åº",charIndex:3874},{level:4,title:"åå»ºæ°æ®åº",slug:"åå»ºæ°æ®åº",normalizedTitle:"åå»ºæ°æ®åº",charIndex:3896},{level:4,title:"å é¤æ°æ®åº",slug:"å é¤æ°æ®åº",normalizedTitle:"å é¤æ°æ®åº",charIndex:4249},{level:3,title:"éåæä½",slug:"éåæä½",normalizedTitle:"éåæä½",charIndex:4288},{level:4,title:"æ¥çéå",slug:"æ¥çéå",normalizedTitle:"æ¥çéå",charIndex:4296},{level:4,title:"åå»ºéå",slug:"åå»ºéå",normalizedTitle:"åå»ºéå",charIndex:4323},{level:4,title:"å é¤éå",slug:"å é¤éå",normalizedTitle:"å é¤éå",charIndex:4899},{level:3,title:"æå¥ææ¡£æä½",slug:"æå¥ææ¡£æä½",normalizedTitle:"æå¥ææ¡£æä½",charIndex:4959},{level:3,title:"æ¥è¯¢ææ¡£æä½",slug:"æ¥è¯¢ææ¡£æä½",normalizedTitle:"æ¥è¯¢ææ¡£æä½",charIndex:5539},{level:4,title:"æ¥è¯¢æ¡ä»¶",slug:"æ¥è¯¢æ¡ä»¶",normalizedTitle:"æ¥è¯¢æ¡ä»¶",charIndex:5607},{level:4,title:"æ¥è¯¢é»è¾æ¡ä»¶",slug:"æ¥è¯¢é»è¾æ¡ä»¶",normalizedTitle:"æ¥è¯¢é»è¾æ¡ä»¶",charIndex:6768},{level:4,title:"æ¨¡ç³æ¥è¯¢",slug:"æ¨¡ç³æ¥è¯¢",normalizedTitle:"æ¨¡ç³æ¥è¯¢",charIndex:7058},{level:4,title:"Limit() æ¹æ³",slug:"limit-æ¹æ³",normalizedTitle:"limit() æ¹æ³",charIndex:7228},{level:4,title:"Skip() æ¹æ³",slug:"skip-æ¹æ³",normalizedTitle:"skip() æ¹æ³",charIndex:7401},{level:4,title:"Sort() æ¹æ³",slug:"sort-æ¹æ³",normalizedTitle:"sort() æ¹æ³",charIndex:7574},{level:3,title:"æ´æ°ææ¡£æä½",slug:"æ´æ°ææ¡£æä½",normalizedTitle:"æ´æ°ææ¡£æä½",charIndex:7835},{level:3,title:"å é¤ææ¡£æä½",slug:"å é¤ææ¡£æä½",normalizedTitle:"å é¤ææ¡£æä½",charIndex:9212},{level:3,title:"ç´¢å¼æä½",slug:"ç´¢å¼æä½",normalizedTitle:"ç´¢å¼æä½",charIndex:9399},{level:2,title:"MongoDB èåæä½",slug:"mongodb-èåæä½",normalizedTitle:"mongodb èåæä½",charIndex:10938},{level:3,title:"ç®¡é",slug:"ç®¡é",normalizedTitle:"ç®¡é",charIndex:11036},{level:3,title:"èåæ­¥éª¤",slug:"èåæ­¥éª¤",normalizedTitle:"èåæ­¥éª¤",charIndex:11228},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:13583}],headersStr:"ç®ä» MongoDB åå± MongoDB å RDBMS MongoDB ç¹æ§ MongoDB æ¦å¿µ æ°æ®åº ææ¡£ éå åæ°æ® MongoDB æ°æ®ç±»å MongoDB CRUD æ°æ®åºæä½ æ¥çæææ°æ®åº åå»ºæ°æ®åº å é¤æ°æ®åº éåæä½ æ¥çéå åå»ºéå å é¤éå æå¥ææ¡£æä½ æ¥è¯¢ææ¡£æä½ æ¥è¯¢æ¡ä»¶ æ¥è¯¢é»è¾æ¡ä»¶ æ¨¡ç³æ¥è¯¢ Limit() æ¹æ³ Skip() æ¹æ³ Sort() æ¹æ³ æ´æ°ææ¡£æä½ å é¤ææ¡£æä½ ç´¢å¼æä½ MongoDB èåæä½ ç®¡é èåæ­¥éª¤ åèèµæ",content:'# MongoDB åºç¨æå\n\n\n# ç®ä»\n\nMongoDB æ¯ä¸ä¸ªåºäºåå¸å¼æä»¶å­å¨çæ°æ®åºãç± C++ è¯­è¨ç¼åãæ¨å¨ä¸º WEB åºç¨æä¾å¯æ©å±çé«æ§è½æ°æ®å­å¨è§£å³æ¹æ¡ã\n\nMongoDB å°æ°æ®å­å¨ä¸ºä¸ä¸ªææ¡£ï¼æ°æ®ç»æç±é®å¼(key=>value)å¯¹ç»æãMongoDB ææ¡£ç±»ä¼¼äº JSON å¯¹è±¡ãå­æ®µå¼å¯ä»¥åå«å¶ä»ææ¡£ï¼æ°ç»åææ¡£æ°ç»ã\n\n\n# MongoDB åå±\n\n * 1.x - æ¯æå¤å¶ååç\n * 2.x - æ´ä¸°å¯çæ°æ®åºåè½\n * 3.x - WiredTiger åå¨è¾¹çæ\n * 4.x - æ¯æåå¸å¼äºå¡\n\n\n# MongoDB å RDBMS\n\nç¹æ§        MONGODB                       RDBMS\næ°æ®æ¨¡å      ææ¡£æ¨¡å                          å³ç³»å\nCRUD æä½   MQL/SQL                       SQL\né«å¯ç¨       å¤å¶é                           éç¾¤æ¨¡å¼\næ©å±æ§       æ¯æåç                          æ°æ®ååº\næ©ç¹æ¹å¼      åç´æ©å±+æ°´å¹³æ©å±                     åç´æ©å±\nç´¢å¼ç±»å      B æ ãå¨æç´¢å¼ãå°çä½ç½®ç´¢å¼ãå¤é®ç´¢å¼ãTTL ç´¢å¼   B æ \næ°æ®å®¹é      æ²¡æçè®ºä¸é                        åä¸ãäº¿\n\n\n# MongoDB ç¹æ§\n\n * æ°æ®æ¯ JSON ç»æ\n   * æ¯æç»æåãåç»æåæ°æ®æ¨¡å\n   * å¯ä»¥å¨æååºç»æåå\n * éè¿å¯æ¬æºå¶æä¾é«å¯ç¨\n * éè¿åçæä¾æ©å®¹è½å\n\n\n# MongoDB æ¦å¿µ\n\nSQL æ¯è¯­/æ¦å¿µ     MONGODB æ¯è¯­/æ¦å¿µ   è§£é/è¯´æ\ndatabase      database        æ°æ®åº\ntable         collection      æ°æ®åºè¡¨/éå\nrow           document        æ°æ®è®°å½è¡/ææ¡£\ncolumn        field           æ°æ®å­æ®µ/å\nindex         index           ç´¢å¼\ntable joins                   è¡¨è¿æ¥,MongoDB ä¸æ¯æ\nprimary key   primary key     ä¸»é®,MongoDB èªå¨å°_id å­æ®µè®¾ç½®ä¸ºä¸»é®\n\n\n# æ°æ®åº\n\nä¸ä¸ª MongoDB ä¸­å¯ä»¥å»ºç«å¤ä¸ªæ°æ®åºã\n\nMongoDB çé»è®¤æ°æ®åºä¸º"db"ï¼è¯¥æ°æ®åºå­å¨å¨ data ç®å½ä¸­ã\n\nMongoDB çåä¸ªå®ä¾å¯ä»¥å®¹çº³å¤ä¸ªç¬ç«çæ°æ®åºï¼æ¯ä¸ä¸ªé½æèªå·±çéååæéï¼ä¸åçæ°æ®åºä¹æ¾ç½®å¨ä¸åçæä»¶ä¸­ã\n\n"show dbs" å½ä»¤å¯ä»¥æ¾ç¤ºæææ°æ®çåè¡¨ã\n\n$ ./mongo\nMongoDBshell version: 3.0.6\nconnecting to: test\n> show dbs\nlocal  0.078GB\ntest   0.078GB\n>\n\n\næ§è¡ "db" å½ä»¤å¯ä»¥æ¾ç¤ºå½åæ°æ®åºå¯¹è±¡æéåã\n\n$ ./mongo\nMongoDBshell version: 3.0.6\nconnecting to: test\n> db\ntest\n>\n\n\nè¿è¡"use"å½ä»¤ï¼å¯ä»¥è¿æ¥å°ä¸ä¸ªæå®çæ°æ®åºã\n\n> use local\nswitched to db local\n> db\nlocal\n>\n\n\næ°æ®åºä¹éè¿åå­æ¥æ è¯ãæ°æ®åºåå¯ä»¥æ¯æ»¡è¶³ä»¥ä¸æ¡ä»¶çä»»æ UTF-8 å­ç¬¦ä¸²ã\n\n * ä¸è½æ¯ç©ºå­ç¬¦ä¸²ï¼"")ã\n * ä¸å¾å«æ \' \'ï¼ç©ºæ ¼)ã.ã\\$ã/ã\\å \\0 (ç©ºå­ç¬¦)ã\n * åºå¨é¨å°åã\n * æå¤ 64 å­èã\n\næä¸äºæ°æ®åºåæ¯ä¿ççï¼å¯ä»¥ç´æ¥è®¿é®è¿äºæç¹æ®ä½ç¨çæ°æ®åºã\n\n * adminï¼ä»æéçè§åº¦æ¥çï¼è¿æ¯"root"æ°æ®åºãè¦æ¯å°ä¸ä¸ªç¨æ·æ·»å å°è¿ä¸ªæ°æ®åºï¼è¿ä¸ªç¨æ·èªå¨ç»§æ¿æææ°æ®åºçæéãä¸äºç¹å®çæå¡å¨ç«¯å½ä»¤ä¹åªè½ä»è¿ä¸ªæ°æ®åºè¿è¡ï¼æ¯å¦ååºææçæ°æ®åºæèå³é­æå¡å¨ã\n * localï¼è¿ä¸ªæ°æ®æ°¸è¿ä¸ä¼è¢«å¤å¶ï¼å¯ä»¥ç¨æ¥å­å¨éäºæ¬å°åå°æå¡å¨çä»»æéå\n * configï¼å½ Mongo ç¨äºåçè®¾ç½®æ¶ï¼config æ°æ®åºå¨åé¨ä½¿ç¨ï¼ç¨äºä¿å­åççç¸å³ä¿¡æ¯ã\n\n\n# ææ¡£\n\nææ¡£æ¯ä¸ç»é®å¼(key-value)å¯¹(å³ BSON)ãMongoDB çææ¡£ä¸éè¦è®¾ç½®ç¸åçå­æ®µï¼å¹¶ä¸ç¸åçå­æ®µä¸éè¦ç¸åçæ°æ®ç±»åï¼è¿ä¸å³ç³»åæ°æ®åºæå¾å¤§çåºå«ï¼ä¹æ¯ MongoDB éå¸¸çªåºçç¹ç¹ã\n\néè¦æ³¨æçæ¯ï¼\n\n * ææ¡£ä¸­çé®/å¼å¯¹æ¯æåºçã\n * ææ¡£ä¸­çå¼ä¸ä»å¯ä»¥æ¯å¨åå¼å·éé¢çå­ç¬¦ä¸²ï¼è¿å¯ä»¥æ¯å¶ä»å ç§æ°æ®ç±»åï¼çè³å¯ä»¥æ¯æ´ä¸ªåµå¥çææ¡£)ã\n * MongoDB åºåç±»ååå¤§å°åã\n * MongoDB çææ¡£ä¸è½æéå¤çé®ã\n * ææ¡£çé®æ¯å­ç¬¦ä¸²ãé¤äºå°æ°ä¾å¤æåµï¼é®å¯ä»¥ä½¿ç¨ä»»æ UTF-8 å­ç¬¦ã\n\nææ¡£é®å½åè§èï¼\n\n * é®ä¸è½å«æ \\0 (ç©ºå­ç¬¦)ãè¿ä¸ªå­ç¬¦ç¨æ¥è¡¨ç¤ºé®çç»å°¾ã\n * . å $ æç¹å«çæä¹ï¼åªæå¨ç¹å®ç¯å¢ä¸æè½ä½¿ç¨ã\n * ä»¥ä¸åçº¿ _ å¼å¤´çé®æ¯ä¿çç(ä¸æ¯ä¸¥æ ¼è¦æ±ç)ã\n\n\n# éå\n\néåå°±æ¯ MongoDB ææ¡£ç»ï¼ç±»ä¼¼äº RDBMS ï¼å³ç³»æ°æ®åºç®¡çç³»ç»ï¼Relational Database Management System)ä¸­çè¡¨æ ¼ã\n\néåå­å¨äºæ°æ®åºä¸­ï¼éåæ²¡æåºå®çç»æï¼è¿æå³çä½ å¨å¯¹éåå¯ä»¥æå¥ä¸åæ ¼å¼åç±»åçæ°æ®ï¼ä½éå¸¸æåµä¸æä»¬æå¥éåçæ°æ®é½ä¼æä¸å®çå³èæ§ã\n\nåæ³çéååï¼\n\n * éååä¸è½æ¯ç©ºå­ç¬¦ä¸²""ã\n * éååä¸è½å«æ \\0 å­ç¬¦ï¼ç©ºå­ç¬¦)ï¼è¿ä¸ªå­ç¬¦è¡¨ç¤ºéååçç»å°¾ã\n * éååä¸è½ä»¥"system."å¼å¤´ï¼è¿æ¯ä¸ºç³»ç»éåä¿ççåç¼ã\n * ç¨æ·åå»ºçéååå­ä¸è½å«æä¿çå­ç¬¦ãæäºé©±å¨ç¨åºçç¡®æ¯æå¨éååéé¢åå«ï¼è¿æ¯å ä¸ºæäºç³»ç»çæçéåä¸­åå«è¯¥å­ç¬¦ãé¤éä½ è¦è®¿é®è¿ç§ç³»ç»åå»ºçéåï¼å¦ååä¸ä¸è¦å¨åå­éåºç° $ã\n\n\n# åæ°æ®\n\næ°æ®åºçä¿¡æ¯æ¯å­å¨å¨éåä¸­ãå®ä»¬ä½¿ç¨äºç³»ç»çå½åç©ºé´ï¼dbname.system.*\n\nå¨ MongoDB æ°æ®åºä¸­åå­ç©ºé´ <dbname>.system.* æ¯åå«å¤ç§ç³»ç»ä¿¡æ¯çç¹æ®éå(Collection)ï¼å¦ä¸:\n\néåå½åç©ºé´                     æè¿°\ndbname.system.namespaces   ååºææåå­ç©ºé´ã\ndbname.system.indexes      ååºææç´¢å¼ã\ndbname.system.profile      åå«æ°æ®åºæ¦è¦(profile)ä¿¡æ¯ã\ndbname.system.users        ååºææå¯è®¿é®æ°æ®åºçç¨æ·ã\ndbname.local.sources       åå«å¤å¶å¯¹ç«¯ï¼slaveï¼çæå¡å¨ä¿¡æ¯åç¶æã\n\nå¯¹äºä¿®æ¹ç³»ç»éåä¸­çå¯¹è±¡æå¦ä¸éå¶ã\n\nå¨ system.indexes æå¥æ°æ®ï¼å¯ä»¥åå»ºç´¢å¼ãä½é¤æ­¤ä¹å¤è¯¥è¡¨ä¿¡æ¯æ¯ä¸å¯åç(ç¹æ®ç drop index å½ä»¤å°èªå¨æ´æ°ç¸å³ä¿¡æ¯)ãsystem.users æ¯å¯ä¿®æ¹çãsystem.profile æ¯å¯å é¤çã\n\n\n# MongoDB æ°æ®ç±»å\n\næ°æ®ç±»å                 æè¿°\nString               å­ç¬¦ä¸²ãå­å¨æ°æ®å¸¸ç¨çæ°æ®ç±»åãå¨ MongoDB ä¸­ï¼UTF-8 ç¼ç çå­ç¬¦ä¸²ææ¯åæ³çã\nInteger              æ´åæ°å¼ãç¨äºå­å¨æ°å¼ãæ ¹æ®ä½ æéç¨çæå¡å¨ï¼å¯åä¸º 32 ä½æ 64 ä½ã\nBoolean              å¸å°å¼ãç¨äºå­å¨å¸å°å¼ï¼ç/åï¼ã\nDouble               åç²¾åº¦æµ®ç¹å¼ãç¨äºå­å¨æµ®ç¹å¼ã\nMin/Max keys         å°ä¸ä¸ªå¼ä¸ BSONï¼äºè¿å¶ç JSONï¼åç´ çæä½å¼åæé«å¼ç¸å¯¹æ¯ã\nArray                ç¨äºå°æ°ç»æåè¡¨æå¤ä¸ªå¼å­å¨ä¸ºä¸ä¸ªé®ã\nTimestamp            æ¶é´æ³ãè®°å½ææ¡£ä¿®æ¹ææ·»å çå·ä½æ¶é´ã\nObject               ç¨äºååµææ¡£ã\nNull                 ç¨äºåå»ºç©ºå¼ã\nSymbol               ç¬¦å·ãè¯¥æ°æ®ç±»ååºæ¬ä¸ç­åäºå­ç¬¦ä¸²ç±»åï¼ä½ä¸åçæ¯ï¼å®ä¸è¬ç¨äºéç¨ç¹æ®ç¬¦å·ç±»åçè¯­è¨ã\nDate                 æ¥ææ¶é´ãç¨ UNIX æ¶é´æ ¼å¼æ¥å­å¨å½åæ¥æææ¶é´ãä½ å¯ä»¥æå®èªå·±çæ¥ææ¶é´ï¼åå»º Date å¯¹è±¡ï¼ä¼ å¥å¹´ææ¥ä¿¡æ¯ã\nObject ID            å¯¹è±¡ IDãç¨äºåå»ºææ¡£ç IDã\nBinary Data          äºè¿å¶æ°æ®ãç¨äºå­å¨äºè¿å¶æ°æ®ã\nCode                 ä»£ç ç±»åãç¨äºå¨ææ¡£ä¸­å­å¨ JavaScript ä»£ç ã\nRegular expression   æ­£åè¡¨è¾¾å¼ç±»åãç¨äºå­å¨æ­£åè¡¨è¾¾å¼ã\n\n\n# MongoDB CRUD\n\n\n# æ°æ®åºæä½\n\n# æ¥çæææ°æ®åº\n\nshow dbs\n\n\n# åå»ºæ°æ®åº\n\nuse <database>\n\n\nå¦ææ°æ®åºä¸å­å¨ï¼ååå»ºæ°æ®åºï¼å¦ååæ¢å°æå®æ°æ®åºã\n\nãç¤ºä¾ãåå»ºæ°æ®åºï¼å¹¶æå¥ä¸æ¡æ°æ®\n\nååå»ºçæ°æ®åº test å¹¶ä¸å¨æ°æ®åºçåè¡¨ä¸­ï¼ è¦æ¾ç¤ºå®ï¼éè¦æå¥ä¸äºæ°æ®\n\n> use test\nswitched to db test\n>\n> show dbs\nadmin   0.000GB\nconfig  0.000GB\nlocal   0.000GB\n> db.test.insert({"name":"mongodb"})\nWriteResult({ "nInserted" : 1 })\n> show dbs\nadmin   0.000GB\nconfig  0.000GB\nlocal   0.000GB\ntest    0.000GB\n\n\n# å é¤æ°æ®åº\n\nå é¤å½åæ°æ®åº\n\ndb.dropDatabase()\n\n\n\n# éåæä½\n\n# æ¥çéå\n\nshow collections\n\n\n# åå»ºéå\n\ndb.createCollection(name, options)\n\n\nåæ°è¯´æï¼\n\n * name: è¦åå»ºçéååç§°\n * options: å¯éåæ°, æå®æå³åå­å¤§å°åç´¢å¼çéé¡¹\n\noptions å¯ä»¥æ¯å¦ä¸åæ°ï¼\n\nå­æ®µ            ç±»å   æè¿°\ncapped        å¸å°   ï¼å¯éï¼å¦æä¸º trueï¼ååå»ºåºå®éåãåºå®éåæ¯ææçåºå®å¤§å°çéåï¼å½è¾¾å°æå¤§å¼æ¶ï¼å®ä¼èªå¨è¦çææ©çææ¡£ã\n                   å½è¯¥å¼ä¸º true æ¶ï¼å¿é¡»æå® size åæ°ã\nautoIndexId   å¸å°   3.2 ä¹åä¸åæ¯æè¯¥åæ°ãï¼å¯éï¼å¦ä¸º trueï¼èªå¨å¨ _id å­æ®µåå»ºç´¢å¼ãé»è®¤ä¸º falseã\nsize          æ°å¼   ï¼å¯éï¼ä¸ºåºå®éåæå®ä¸ä¸ªæå¤§å¼ï¼å³å­èæ°ã å¦æ capped ä¸º trueï¼ä¹éè¦æå®è¯¥å­æ®µã\nmax           æ°å¼   ï¼å¯éï¼æå®åºå®éåä¸­åå«ææ¡£çæå¤§æ°éã\n\nå¨æå¥ææ¡£æ¶ï¼MongoDB é¦åæ£æ¥åºå®éåç size å­æ®µï¼ç¶åæ£æ¥ max å­æ®µã\n\n> db.createCollection("collection")\n{ "ok" : 1 }\n> show collections\ncollection\n\n\n# å é¤éå\n\n> db.collection.drop()\ntrue\n> show collections\n>\n\n\n\n# æå¥ææ¡£æä½\n\nMongoDB ä½¿ç¨ insert() æ¹æ³å®ææå¥æä½ã\n\nè¯­æ³æ ¼å¼\n\n# æå¥åæ¡è®°å½\ndb.<éå>.insertOne(<JSON>)\n# æå¥å¤æ¡è®°å½\ndb.<éå>.insertMany([<JSON 1>, <JSON 2>, ..., <JSON N>])\n\n\nãç¤ºä¾ãinsertOne\n\n> db.color.insertOne({name: "red"})\n{\n        "acknowledged" : true,\n        "insertedId" : ObjectId("5f533ae4e8f16647950fdf43")\n}\n\n\nãç¤ºä¾ãinsertMany\n\n> db.color.insertMany([\n  {\n    "name": "yellow"\n  },\n  {\n    "name": "blue"\n  }\n])\n{\n        "acknowledged" : true,\n        "insertedIds" : [\n                ObjectId("5f533bcae8f16647950fdf44"),\n                ObjectId("5f533bcae8f16647950fdf45")\n        ]\n}\n>\n\n\n\n# æ¥è¯¢ææ¡£æä½\n\nMongoDB ä½¿ç¨ find() æ¹æ³å®ææ¥è¯¢ææ¡£æä½ã\n\nè¯­æ³æ ¼å¼\n\ndb.<éå>.find(<JSON>)\n\n\næ¥è¯¢æ¡ä»¶ä¹æ¯ json å½¢å¼ï¼å¦æä¸è®¾ç½®æ¥è¯¢æ¡ä»¶ï¼å³ä¸ºå¨éæ¥è¯¢ã\n\n# æ¥è¯¢æ¡ä»¶\n\næä½                      æ ¼å¼                                      èä¾                                         RDBMS ä¸­çç±»ä¼¼è¯­å¥\nç­äº                      {<key>:<value>}                         db.book.find({"pageCount": {$eq: 0}})      where pageCount = 0\nä¸ç­äº                     {<key>:{$ne:<value>}}                   db.book.find({"pageCount": {$ne: 0}})      where likes != 50\nå¤§äº                      {<key>:{$gt:<value>}}                   db.book.find({"pageCount": {$gt: 0}})      where likes > 50\n{<key>:{$gt:<value>}}   db.book.find({"pageCount": {$gt: 0}})   where likes > 50                           å¤§äºæç­äº\nå°äº                      {<key>:{$lt:<value>}}                   db.book.find({"pageCount": {$lt: 200}})    where likes < 50\nå°äºæç­äº                   {<key>:{$lte:<value>}}                  db.book.find({"pageCount": {$lte: 200}})   where likes <= 50\n\n> è¯´æï¼\n> \n> $eq  --------  equal  =\n> $ne ----------- not equal  !=\n> $gt -------- greater than  >\n> $gte --------- gt equal  >=\n> $lt -------- less than  <\n> $lte --------- lt equal  <=\n\nãç¤ºä¾ã\n\n\n\n# ç»è®¡å¹éæ¥è¯¢æ¡ä»¶çè®°å½æ°\n> db.book.find({"status": "MEAP"}).count()\n68\n\n\n# æ¥è¯¢é»è¾æ¡ä»¶\n\nï¼1ï¼and æ¡ä»¶\n\nMongoDB ç find() æ¹æ³å¯ä»¥ä¼ å¥å¤ä¸ªé®(key)ï¼æ¯ä¸ªé®(key)ä»¥éå·éå¼ï¼å³å¸¸è§ SQL ç AND æ¡ä»¶ã\n\nè¯­æ³æ ¼å¼å¦ä¸ï¼\n\n> db.col.find({key1:value1, key2:value2}).pretty()\n\n\nï¼2ï¼or æ¡ä»¶\n\nMongoDB OR æ¡ä»¶è¯­å¥ä½¿ç¨äºå³é®å­ $or,è¯­æ³æ ¼å¼å¦ä¸ï¼\n\n>db.col.find(\n   {\n      $or: [\n         {key1: value1}, {key2:value2}\n      ]\n   }\n).pretty()\n\n\n# æ¨¡ç³æ¥è¯¢\n\næ¥è¯¢ title åå«"æ"å­çææ¡£ï¼\n\ndb.col.find({ title: /æ/ })\n\n\næ¥è¯¢ title å­æ®µä»¥"æ"å­å¼å¤´çææ¡£ï¼\n\ndb.col.find({ title: /^æ/ })\n\n\næ¥è¯¢ titl e å­æ®µä»¥"æ"å­ç»å°¾çææ¡£ï¼\n\ndb.col.find({ title: /æ$/ })\n\n\n# Limit() æ¹æ³\n\nå¦æä½ éè¦å¨ MongoDB ä¸­è¯»åæå®æ°éçæ°æ®è®°å½ï¼å¯ä»¥ä½¿ç¨ MongoDB ç Limit æ¹æ³ï¼limit()æ¹æ³æ¥åä¸ä¸ªæ°å­åæ°ï¼è¯¥åæ°æå®ä» MongoDB ä¸­è¯»åçè®°å½æ¡æ°ã\n\nlimit()æ¹æ³åºæ¬è¯­æ³å¦ä¸æç¤ºï¼\n\n>db.COLLECTION_NAME.find().limit(NUMBER)\n\n\n# Skip() æ¹æ³\n\næä»¬é¤äºå¯ä»¥ä½¿ç¨ limit()æ¹æ³æ¥è¯»åæå®æ°éçæ°æ®å¤ï¼è¿å¯ä»¥ä½¿ç¨ skip()æ¹æ³æ¥è·³è¿æå®æ°éçæ°æ®ï¼skip æ¹æ³åæ ·æ¥åä¸ä¸ªæ°å­åæ°ä½ä¸ºè·³è¿çè®°å½æ¡æ°ã\n\nskip() æ¹æ³èæ¬è¯­æ³æ ¼å¼å¦ä¸ï¼\n\n>db.COLLECTION_NAME.find().limit(NUMBER).skip(NUMBER)\n\n\n# Sort() æ¹æ³\n\nå¨ MongoDB ä¸­ä½¿ç¨ sort() æ¹æ³å¯¹æ°æ®è¿è¡æåºï¼sort() æ¹æ³å¯ä»¥éè¿åæ°æå®æåºçå­æ®µï¼å¹¶ä½¿ç¨ 1 å -1 æ¥æå®æåºçæ¹å¼ï¼å¶ä¸­ 1 ä¸ºååºæåï¼è -1 æ¯ç¨äºéåºæåã\n\nsort()æ¹æ³åºæ¬è¯­æ³å¦ä¸æç¤ºï¼\n\n>db.COLLECTION_NAME.find().sort({KEY:1})\n\n\n> æ³¨æï¼skip(), limilt(), sort()ä¸ä¸ªæ¾å¨ä¸èµ·æ§è¡çæ¶åï¼æ§è¡çé¡ºåºæ¯å sort(), ç¶åæ¯ skip()ï¼æåæ¯æ¾ç¤ºç limit()ã\n\n\n# æ´æ°ææ¡£æä½\n\nupdate() æ¹æ³ç¨äºæ´æ°å·²å­å¨çææ¡£ãè¯­æ³æ ¼å¼å¦ä¸ï¼\n\ndb.collection.update(\n   <query>,\n   <update>,\n   {\n     upsert: <boolean>,\n     multi: <boolean>,\n     writeConcern: <document>\n   }\n)\n\n\nåæ°è¯´æï¼\n\n * query : update çæ¥è¯¢æ¡ä»¶ï¼ç±»ä¼¼ sql update æ¥è¯¢å where åé¢çã\n * update : update çå¯¹è±¡åä¸äºæ´æ°çæä½ç¬¦ï¼å¦$,$inc...ï¼ç­ï¼ä¹å¯ä»¥çè§£ä¸º sql update æ¥è¯¢å set åé¢ç\n * upsert : å¯éï¼è¿ä¸ªåæ°çæææ¯ï¼å¦æä¸å­å¨ update çè®°å½ï¼æ¯å¦æå¥ objNew,true ä¸ºæå¥ï¼é»è®¤æ¯ falseï¼ä¸æå¥ã\n * multi : å¯éï¼mongodb é»è®¤æ¯ false,åªæ´æ°æ¾å°çç¬¬ä¸æ¡è®°å½ï¼å¦æè¿ä¸ªåæ°ä¸º true,å°±æææ¡ä»¶æ¥åºæ¥å¤æ¡è®°å½å¨é¨æ´æ°ã\n * writeConcern :å¯éï¼æåºå¼å¸¸ççº§å«ã\n\nãç¤ºä¾ãæ´æ°ææ¡£\n\ndb.collection.update({ title: \'MongoDB æç¨\' }, { $set: { title: \'MongoDB\' } })\n\n\nãç¤ºä¾ãæ´æ°å¤æ¡ç¸åææ¡£\n\nä»¥ä¸è¯­å¥åªä¼ä¿®æ¹ç¬¬ä¸æ¡åç°çææ¡£ï¼å¦æä½ è¦ä¿®æ¹å¤æ¡ç¸åçææ¡£ï¼åéè¦è®¾ç½® multi åæ°ä¸º trueã\n\ndb.collection.update(\n  { title: \'MongoDB æç¨\' },\n  { $set: { title: \'MongoDB\' } },\n  { multi: true }\n)\n\n\nãç¤ºä¾ãæ´å¤å®ä¾\n\nåªæ´æ°ç¬¬ä¸æ¡è®°å½ï¼\n\ndb.collection.update({ count: { $gt: 1 } }, { $set: { test2: \'OK\' } })\n\n\nå¨é¨æ´æ°ï¼\n\ndb.collection.update(\n  { count: { $gt: 3 } },\n  { $set: { test2: \'OK\' } },\n  false,\n  true\n)\n\n\nåªæ·»å ç¬¬ä¸æ¡ï¼\n\ndb.collection.update(\n  { count: { $gt: 4 } },\n  { $set: { test5: \'OK\' } },\n  true,\n  false\n)\n\n\nå¨é¨æ·»å è¿å»:\n\ndb.collection.update(\n  { count: { $gt: 4 } },\n  { $set: { test5: \'OK\' } },\n  true,\n  false\n)\n\n\nå¨é¨æ´æ°ï¼\n\ndb.collection.update(\n  { count: { $gt: 4 } },\n  { $set: { test5: \'OK\' } },\n  true,\n  false\n)\n\n\nåªæ´æ°ç¬¬ä¸æ¡è®°å½ï¼\n\ndb.collection.update(\n  { count: { $gt: 4 } },\n  { $set: { test5: \'OK\' } },\n  true,\n  false\n)\n\n\n\n# å é¤ææ¡£æä½\n\nå®æ¹æ¨èä½¿ç¨ deleteOne() å deleteMany() æ¹æ³å é¤æ°æ®ã\n\nå é¤ status ç­äº A çå¨é¨ææ¡£ï¼\n\ndb.collection.deleteMany({ status: \'A\' })\n\n\nå é¤ status ç­äº D çä¸ä¸ªææ¡£ï¼\n\ndb.collection.deleteOne({ status: \'D\' })\n\n\n\n# ç´¢å¼æä½\n\nç´¢å¼éå¸¸è½å¤æå¤§çæé«æ¥è¯¢çæçï¼å¦ææ²¡æç´¢å¼ï¼MongoDB å¨è¯»åæ°æ®æ¶å¿é¡»æ«æéåä¸­çæ¯ä¸ªæä»¶å¹¶éåé£äºç¬¦åæ¥è¯¢æ¡ä»¶çè®°å½ã\n\nè¿ç§æ«æå¨éåçæ¥è¯¢æçæ¯éå¸¸ä½çï¼ç¹å«å¨å¤çå¤§éçæ°æ®æ¶ï¼æ¥è¯¢å¯ä»¥è¦è±è´¹å åç§çè³å åéï¼è¿å¯¹ç½ç«çæ§è½æ¯éå¸¸è´å½çã\n\nç´¢å¼æ¯ç¹æ®çæ°æ®ç»æï¼ç´¢å¼å­å¨å¨ä¸ä¸ªæäºéåè¯»åçæ°æ®éåä¸­ï¼ç´¢å¼æ¯å¯¹æ°æ®åºè¡¨ä¸­ä¸åæå¤åçå¼è¿è¡æåºçä¸ç§ç»æã\n\nMongoDB ä½¿ç¨ createIndex() æ¹æ³æ¥åå»ºç´¢å¼ã\n\ncreateIndex()æ¹æ³åºæ¬è¯­æ³æ ¼å¼å¦ä¸æç¤ºï¼\n\n>db.collection.createIndex(keys, options)\n\n\nè¯­æ³ä¸­ Key å¼ä¸ºä½ è¦åå»ºçç´¢å¼å­æ®µï¼1 ä¸ºæå®æååºåå»ºç´¢å¼ï¼å¦æä½ æ³æéåºæ¥åå»ºç´¢å¼æå®ä¸º -1 å³å¯ã\n\n>db.col.createIndex({"title":1})\n\n\ncreateIndex() æ¹æ³ä¸­ä½ ä¹å¯ä»¥è®¾ç½®ä½¿ç¨å¤ä¸ªå­æ®µåå»ºç´¢å¼ï¼å³ç³»åæ°æ®åºä¸­ç§°ä½å¤åç´¢å¼ï¼ã\n\n>db.col.createIndex({"title":1,"description":-1})\n\n\ncreateIndex() æ¥æ¶å¯éåæ°ï¼å¯éåæ°åè¡¨å¦ä¸ï¼\n\nPARAMETER            TYPE            DESCRIPTION\nbackground           Boolean         å»ºç´¢å¼è¿ç¨ä¼é»å¡å¶å®æ°æ®åºæä½ï¼background å¯æå®ä»¥åå°æ¹å¼åå»ºç´¢å¼ï¼å³å¢å  "background"\n                                     å¯éåæ°ã "background" é»è®¤å¼ä¸ºfalseã\nunique               Boolean         å»ºç«çç´¢å¼æ¯å¦å¯ä¸ãæå®ä¸º true åå»ºå¯ä¸ç´¢å¼ãé»è®¤å¼ä¸ºfalse.\nname                 string          ç´¢å¼çåç§°ãå¦ææªæå®ï¼MongoDB çéè¿è¿æ¥ç´¢å¼çå­æ®µååæåºé¡ºåºçæä¸ä¸ªç´¢å¼åç§°ã\ndropDups             Boolean         **3.0+çæ¬å·²åºå¼ã**å¨å»ºç«å¯ä¸ç´¢å¼æ¶æ¯å¦å é¤éå¤è®°å½,æå® true åå»ºå¯ä¸ç´¢å¼ãé»è®¤å¼ä¸º falseã\nsparse               Boolean         å¯¹ææ¡£ä¸­ä¸å­å¨çå­æ®µæ°æ®ä¸å¯ç¨ç´¢å¼ï¼è¿ä¸ªåæ°éè¦ç¹å«æ³¨æï¼å¦æè®¾ç½®ä¸º true\n                                     çè¯ï¼å¨ç´¢å¼å­æ®µä¸­ä¸ä¼æ¥è¯¢åºä¸åå«å¯¹åºå­æ®µçææ¡£.ãé»è®¤å¼ä¸º false.\nexpireAfterSeconds   integer         æå®ä¸ä¸ªä»¥ç§ä¸ºåä½çæ°å¼ï¼å®æ TTL è®¾å®ï¼è®¾å®éåççå­æ¶é´ã\nv                    index version   ç´¢å¼ççæ¬å·ãé»è®¤çç´¢å¼çæ¬åå³äº mongod åå»ºç´¢å¼æ¶è¿è¡ççæ¬ã\nweights              document        ç´¢å¼æéå¼ï¼æ°å¼å¨ 1 å° 99,999 ä¹é´ï¼è¡¨ç¤ºè¯¥ç´¢å¼ç¸å¯¹äºå¶ä»ç´¢å¼å­æ®µçå¾åæéã\ndefault_language     string          å¯¹äºææ¬ç´¢å¼ï¼è¯¥åæ°å³å®äºåç¨è¯åè¯å¹²åè¯å¨çè§åçåè¡¨ã é»è®¤ä¸ºè±è¯­\nlanguage_override    string          å¯¹äºææ¬ç´¢å¼ï¼è¯¥åæ°æå®äºåå«å¨ææ¡£ä¸­çå­æ®µåï¼è¯­è¨è¦çé»è®¤ç languageï¼é»è®¤å¼ä¸º language.\n\n\n# MongoDB èåæä½\n\nMongoDB ä¸­èå(aggregate)ä¸»è¦ç¨äºå¤çæ°æ®(è¯¸å¦ç»è®¡å¹³åå¼,æ±åç­)ï¼å¹¶è¿åè®¡ç®åçæ°æ®ç»æãæç¹ç±»ä¼¼ sql è¯­å¥ä¸­ç count(*)ã\n\n\n# ç®¡é\n\næ´ä¸ªèåè¿ç®è¿ç¨ç§°ä¸ºç®¡éï¼å®æ¯ç±å¤ä¸ªæ­¥éª¤ç»æï¼æ¯ä¸ªç®¡é\n\n * æ¥åä¸ç³»åææ¡£ï¼åå§æ°æ®ï¼ï¼\n * æ¯ä¸ªæ­¥éª¤å¯¹è¿äºææ¡£è¿è¡ä¸ç³»åè¿ç®ï¼\n * ç»æææ¡£è¾åºç»ä¸ä¸ä¸ªæ­¥éª¤ï¼\n\nèåæä½çåºæ¬æ ¼å¼\n\npipeline = [$stage1, $stage1, ..., $stageN];\n\ndb.<éå>.aggregate(pipeline, {options});\n\n\n\n# èåæ­¥éª¤\n\næ­¥éª¤                 ä½ç¨     SQL ç­ä»·è¿ç®ç¬¦\n$match             è¿æ»¤     WHERE\n$project           æå½±     AS\n$sort              æåº     ORDER BY\n$group             åç»     GROUP BY\n$skip / $limit     ç»æéå¶   SKIP / LIMIT\n$lookup            å·¦å¤è¿æ¥   LEFT OUTER JOIN\n$unwind            å±å¼æ°ç»   N/A\n$graphLookup       å¾æç´¢    N/A\n$facet / $bucket   åé¢æç´¢   N/A\n\nãç¤ºä¾ã\n\n> db.collection.insertMany([{"title":"MongoDB Overview","description":"MongoDB is no sql database","by_user":"collection","tagsr":["mongodb","database","NoSQL"],"likes":"100"},{"title":"NoSQL Overview","description":"No sql database is very fast","by_user":"collection","tagsr":["mongodb","database","NoSQL"],"likes":"10"},{"title":"Neo4j Overview","description":"Neo4j is no sql database","by_user":"Neo4j","tagsr":["neo4j","database","NoSQL"],"likes":"750"}])\n> db.collection.aggregate([{$group : {_id : "$by_user", num_tutorial : {$sum : 1}}}])\n{ "_id" : null, "num_tutorial" : 3 }\n{ "_id" : "Neo4j", "num_tutorial" : 1 }\n{ "_id" : "collection", "num_tutorial" : 2 }\n\n\nä¸è¡¨å±ç¤ºäºä¸äºèåçè¡¨è¾¾å¼:\n\nè¡¨è¾¾å¼         æè¿°                        å®ä¾\n$sum        è®¡ç®æ»åã                     db.mycol.aggregate([{$group : {_id : "$by_user",\n                                      num_tutorial : {$sum : "$likes"}}}])\n$avg        è®¡ç®å¹³åå¼                     db.mycol.aggregate([{$group : {_id : "$by_user",\n                                      num_tutorial : {$avg : "$likes"}}}])\n$min        è·åéåä¸­ææææ¡£å¯¹åºå¼å¾æå°å¼ã         db.mycol.aggregate([{$group : {_id : "$by_user",\n                                      num_tutorial : {$min : "$likes"}}}])\n$max        è·åéåä¸­ææææ¡£å¯¹åºå¼å¾æå¤§å¼ã         db.mycol.aggregate([{$group : {_id : "$by_user",\n                                      num_tutorial : {$max : "$likes"}}}])\n$push       å¨ç»æææ¡£ä¸­æå¥å¼å°ä¸ä¸ªæ°ç»ä¸­ã          db.mycol.aggregate([{$group : {_id : "$by_user", url :\n                                      {$push: "$url"}}}])\n$addToSet   å¨ç»æææ¡£ä¸­æå¥å¼å°ä¸ä¸ªæ°ç»ä¸­ï¼ä½ä¸åå»ºå¯æ¬ã   db.mycol.aggregate([{$group : {_id : "$by_user", url :\n                                      {$addToSet : "$url"}}}])\n$first      æ ¹æ®èµæºææ¡£çæåºè·åç¬¬ä¸ä¸ªææ¡£æ°æ®ã       db.mycol.aggregate([{$group : {_id : "$by_user", first_url :\n                                      {$first : "$url"}}}])\n$last       æ ¹æ®èµæºææ¡£çæåºè·åæåä¸ä¸ªææ¡£æ°æ®       db.mycol.aggregate([{$group : {_id : "$by_user", last_url :\n                                      {$last : "$url"}}}])\n\n\n# åèèµæ\n\n * MongoDB å®ç½\n * MongoDB Github\n * MongoDB æç¨',normalizedContent:'# mongodb åºç¨æå\n\n\n# ç®ä»\n\nmongodb æ¯ä¸ä¸ªåºäºåå¸å¼æä»¶å­å¨çæ°æ®åºãç± c++ è¯­è¨ç¼åãæ¨å¨ä¸º web åºç¨æä¾å¯æ©å±çé«æ§è½æ°æ®å­å¨è§£å³æ¹æ¡ã\n\nmongodb å°æ°æ®å­å¨ä¸ºä¸ä¸ªææ¡£ï¼æ°æ®ç»æç±é®å¼(key=>value)å¯¹ç»æãmongodb ææ¡£ç±»ä¼¼äº json å¯¹è±¡ãå­æ®µå¼å¯ä»¥åå«å¶ä»ææ¡£ï¼æ°ç»åææ¡£æ°ç»ã\n\n\n# mongodb åå±\n\n * 1.x - æ¯æå¤å¶ååç\n * 2.x - æ´ä¸°å¯çæ°æ®åºåè½\n * 3.x - wiredtiger åå¨è¾¹çæ\n * 4.x - æ¯æåå¸å¼äºå¡\n\n\n# mongodb å rdbms\n\nç¹æ§        mongodb                       rdbms\næ°æ®æ¨¡å      ææ¡£æ¨¡å                          å³ç³»å\ncrud æä½   mql/sql                       sql\né«å¯ç¨       å¤å¶é                           éç¾¤æ¨¡å¼\næ©å±æ§       æ¯æåç                          æ°æ®ååº\næ©ç¹æ¹å¼      åç´æ©å±+æ°´å¹³æ©å±                     åç´æ©å±\nç´¢å¼ç±»å      b æ ãå¨æç´¢å¼ãå°çä½ç½®ç´¢å¼ãå¤é®ç´¢å¼ãttl ç´¢å¼   b æ \næ°æ®å®¹é      æ²¡æçè®ºä¸é                        åä¸ãäº¿\n\n\n# mongodb ç¹æ§\n\n * æ°æ®æ¯ json ç»æ\n   * æ¯æç»æåãåç»æåæ°æ®æ¨¡å\n   * å¯ä»¥å¨æååºç»æåå\n * éè¿å¯æ¬æºå¶æä¾é«å¯ç¨\n * éè¿åçæä¾æ©å®¹è½å\n\n\n# mongodb æ¦å¿µ\n\nsql æ¯è¯­/æ¦å¿µ     mongodb æ¯è¯­/æ¦å¿µ   è§£é/è¯´æ\ndatabase      database        æ°æ®åº\ntable         collection      æ°æ®åºè¡¨/éå\nrow           document        æ°æ®è®°å½è¡/ææ¡£\ncolumn        field           æ°æ®å­æ®µ/å\nindex         index           ç´¢å¼\ntable joins                   è¡¨è¿æ¥,mongodb ä¸æ¯æ\nprimary key   primary key     ä¸»é®,mongodb èªå¨å°_id å­æ®µè®¾ç½®ä¸ºä¸»é®\n\n\n# æ°æ®åº\n\nä¸ä¸ª mongodb ä¸­å¯ä»¥å»ºç«å¤ä¸ªæ°æ®åºã\n\nmongodb çé»è®¤æ°æ®åºä¸º"db"ï¼è¯¥æ°æ®åºå­å¨å¨ data ç®å½ä¸­ã\n\nmongodb çåä¸ªå®ä¾å¯ä»¥å®¹çº³å¤ä¸ªç¬ç«çæ°æ®åºï¼æ¯ä¸ä¸ªé½æèªå·±çéååæéï¼ä¸åçæ°æ®åºä¹æ¾ç½®å¨ä¸åçæä»¶ä¸­ã\n\n"show dbs" å½ä»¤å¯ä»¥æ¾ç¤ºæææ°æ®çåè¡¨ã\n\n$ ./mongo\nmongodbshell version: 3.0.6\nconnecting to: test\n> show dbs\nlocal  0.078gb\ntest   0.078gb\n>\n\n\næ§è¡ "db" å½ä»¤å¯ä»¥æ¾ç¤ºå½åæ°æ®åºå¯¹è±¡æéåã\n\n$ ./mongo\nmongodbshell version: 3.0.6\nconnecting to: test\n> db\ntest\n>\n\n\nè¿è¡"use"å½ä»¤ï¼å¯ä»¥è¿æ¥å°ä¸ä¸ªæå®çæ°æ®åºã\n\n> use local\nswitched to db local\n> db\nlocal\n>\n\n\næ°æ®åºä¹éè¿åå­æ¥æ è¯ãæ°æ®åºåå¯ä»¥æ¯æ»¡è¶³ä»¥ä¸æ¡ä»¶çä»»æ utf-8 å­ç¬¦ä¸²ã\n\n * ä¸è½æ¯ç©ºå­ç¬¦ä¸²ï¼"")ã\n * ä¸å¾å«æ \' \'ï¼ç©ºæ ¼)ã.ã\\$ã/ã\\å \\0 (ç©ºå­ç¬¦)ã\n * åºå¨é¨å°åã\n * æå¤ 64 å­èã\n\næä¸äºæ°æ®åºåæ¯ä¿ççï¼å¯ä»¥ç´æ¥è®¿é®è¿äºæç¹æ®ä½ç¨çæ°æ®åºã\n\n * adminï¼ä»æéçè§åº¦æ¥çï¼è¿æ¯"root"æ°æ®åºãè¦æ¯å°ä¸ä¸ªç¨æ·æ·»å å°è¿ä¸ªæ°æ®åºï¼è¿ä¸ªç¨æ·èªå¨ç»§æ¿æææ°æ®åºçæéãä¸äºç¹å®çæå¡å¨ç«¯å½ä»¤ä¹åªè½ä»è¿ä¸ªæ°æ®åºè¿è¡ï¼æ¯å¦ååºææçæ°æ®åºæèå³é­æå¡å¨ã\n * localï¼è¿ä¸ªæ°æ®æ°¸è¿ä¸ä¼è¢«å¤å¶ï¼å¯ä»¥ç¨æ¥å­å¨éäºæ¬å°åå°æå¡å¨çä»»æéå\n * configï¼å½ mongo ç¨äºåçè®¾ç½®æ¶ï¼config æ°æ®åºå¨åé¨ä½¿ç¨ï¼ç¨äºä¿å­åççç¸å³ä¿¡æ¯ã\n\n\n# ææ¡£\n\nææ¡£æ¯ä¸ç»é®å¼(key-value)å¯¹(å³ bson)ãmongodb çææ¡£ä¸éè¦è®¾ç½®ç¸åçå­æ®µï¼å¹¶ä¸ç¸åçå­æ®µä¸éè¦ç¸åçæ°æ®ç±»åï¼è¿ä¸å³ç³»åæ°æ®åºæå¾å¤§çåºå«ï¼ä¹æ¯ mongodb éå¸¸çªåºçç¹ç¹ã\n\néè¦æ³¨æçæ¯ï¼\n\n * ææ¡£ä¸­çé®/å¼å¯¹æ¯æåºçã\n * ææ¡£ä¸­çå¼ä¸ä»å¯ä»¥æ¯å¨åå¼å·éé¢çå­ç¬¦ä¸²ï¼è¿å¯ä»¥æ¯å¶ä»å ç§æ°æ®ç±»åï¼çè³å¯ä»¥æ¯æ´ä¸ªåµå¥çææ¡£)ã\n * mongodb åºåç±»ååå¤§å°åã\n * mongodb çææ¡£ä¸è½æéå¤çé®ã\n * ææ¡£çé®æ¯å­ç¬¦ä¸²ãé¤äºå°æ°ä¾å¤æåµï¼é®å¯ä»¥ä½¿ç¨ä»»æ utf-8 å­ç¬¦ã\n\nææ¡£é®å½åè§èï¼\n\n * é®ä¸è½å«æ \\0 (ç©ºå­ç¬¦)ãè¿ä¸ªå­ç¬¦ç¨æ¥è¡¨ç¤ºé®çç»å°¾ã\n * . å $ æç¹å«çæä¹ï¼åªæå¨ç¹å®ç¯å¢ä¸æè½ä½¿ç¨ã\n * ä»¥ä¸åçº¿ _ å¼å¤´çé®æ¯ä¿çç(ä¸æ¯ä¸¥æ ¼è¦æ±ç)ã\n\n\n# éå\n\néåå°±æ¯ mongodb ææ¡£ç»ï¼ç±»ä¼¼äº rdbms ï¼å³ç³»æ°æ®åºç®¡çç³»ç»ï¼relational database management system)ä¸­çè¡¨æ ¼ã\n\néåå­å¨äºæ°æ®åºä¸­ï¼éåæ²¡æåºå®çç»æï¼è¿æå³çä½ å¨å¯¹éåå¯ä»¥æå¥ä¸åæ ¼å¼åç±»åçæ°æ®ï¼ä½éå¸¸æåµä¸æä»¬æå¥éåçæ°æ®é½ä¼æä¸å®çå³èæ§ã\n\nåæ³çéååï¼\n\n * éååä¸è½æ¯ç©ºå­ç¬¦ä¸²""ã\n * éååä¸è½å«æ \\0 å­ç¬¦ï¼ç©ºå­ç¬¦)ï¼è¿ä¸ªå­ç¬¦è¡¨ç¤ºéååçç»å°¾ã\n * éååä¸è½ä»¥"system."å¼å¤´ï¼è¿æ¯ä¸ºç³»ç»éåä¿ççåç¼ã\n * ç¨æ·åå»ºçéååå­ä¸è½å«æä¿çå­ç¬¦ãæäºé©±å¨ç¨åºçç¡®æ¯æå¨éååéé¢åå«ï¼è¿æ¯å ä¸ºæäºç³»ç»çæçéåä¸­åå«è¯¥å­ç¬¦ãé¤éä½ è¦è®¿é®è¿ç§ç³»ç»åå»ºçéåï¼å¦ååä¸ä¸è¦å¨åå­éåºç° $ã\n\n\n# åæ°æ®\n\næ°æ®åºçä¿¡æ¯æ¯å­å¨å¨éåä¸­ãå®ä»¬ä½¿ç¨äºç³»ç»çå½åç©ºé´ï¼dbname.system.*\n\nå¨ mongodb æ°æ®åºä¸­åå­ç©ºé´ <dbname>.system.* æ¯åå«å¤ç§ç³»ç»ä¿¡æ¯çç¹æ®éå(collection)ï¼å¦ä¸:\n\néåå½åç©ºé´                     æè¿°\ndbname.system.namespaces   ååºææåå­ç©ºé´ã\ndbname.system.indexes      ååºææç´¢å¼ã\ndbname.system.profile      åå«æ°æ®åºæ¦è¦(profile)ä¿¡æ¯ã\ndbname.system.users        ååºææå¯è®¿é®æ°æ®åºçç¨æ·ã\ndbname.local.sources       åå«å¤å¶å¯¹ç«¯ï¼slaveï¼çæå¡å¨ä¿¡æ¯åç¶æã\n\nå¯¹äºä¿®æ¹ç³»ç»éåä¸­çå¯¹è±¡æå¦ä¸éå¶ã\n\nå¨ system.indexes æå¥æ°æ®ï¼å¯ä»¥åå»ºç´¢å¼ãä½é¤æ­¤ä¹å¤è¯¥è¡¨ä¿¡æ¯æ¯ä¸å¯åç(ç¹æ®ç drop index å½ä»¤å°èªå¨æ´æ°ç¸å³ä¿¡æ¯)ãsystem.users æ¯å¯ä¿®æ¹çãsystem.profile æ¯å¯å é¤çã\n\n\n# mongodb æ°æ®ç±»å\n\næ°æ®ç±»å                 æè¿°\nstring               å­ç¬¦ä¸²ãå­å¨æ°æ®å¸¸ç¨çæ°æ®ç±»åãå¨ mongodb ä¸­ï¼utf-8 ç¼ç çå­ç¬¦ä¸²ææ¯åæ³çã\ninteger              æ´åæ°å¼ãç¨äºå­å¨æ°å¼ãæ ¹æ®ä½ æéç¨çæå¡å¨ï¼å¯åä¸º 32 ä½æ 64 ä½ã\nboolean              å¸å°å¼ãç¨äºå­å¨å¸å°å¼ï¼ç/åï¼ã\ndouble               åç²¾åº¦æµ®ç¹å¼ãç¨äºå­å¨æµ®ç¹å¼ã\nmin/max keys         å°ä¸ä¸ªå¼ä¸ bsonï¼äºè¿å¶ç jsonï¼åç´ çæä½å¼åæé«å¼ç¸å¯¹æ¯ã\narray                ç¨äºå°æ°ç»æåè¡¨æå¤ä¸ªå¼å­å¨ä¸ºä¸ä¸ªé®ã\ntimestamp            æ¶é´æ³ãè®°å½ææ¡£ä¿®æ¹ææ·»å çå·ä½æ¶é´ã\nobject               ç¨äºååµææ¡£ã\nnull                 ç¨äºåå»ºç©ºå¼ã\nsymbol               ç¬¦å·ãè¯¥æ°æ®ç±»ååºæ¬ä¸ç­åäºå­ç¬¦ä¸²ç±»åï¼ä½ä¸åçæ¯ï¼å®ä¸è¬ç¨äºéç¨ç¹æ®ç¬¦å·ç±»åçè¯­è¨ã\ndate                 æ¥ææ¶é´ãç¨ unix æ¶é´æ ¼å¼æ¥å­å¨å½åæ¥æææ¶é´ãä½ å¯ä»¥æå®èªå·±çæ¥ææ¶é´ï¼åå»º date å¯¹è±¡ï¼ä¼ å¥å¹´ææ¥ä¿¡æ¯ã\nobject id            å¯¹è±¡ idãç¨äºåå»ºææ¡£ç idã\nbinary data          äºè¿å¶æ°æ®ãç¨äºå­å¨äºè¿å¶æ°æ®ã\ncode                 ä»£ç ç±»åãç¨äºå¨ææ¡£ä¸­å­å¨ javascript ä»£ç ã\nregular expression   æ­£åè¡¨è¾¾å¼ç±»åãç¨äºå­å¨æ­£åè¡¨è¾¾å¼ã\n\n\n# mongodb crud\n\n\n# æ°æ®åºæä½\n\n# æ¥çæææ°æ®åº\n\nshow dbs\n\n\n# åå»ºæ°æ®åº\n\nuse <database>\n\n\nå¦ææ°æ®åºä¸å­å¨ï¼ååå»ºæ°æ®åºï¼å¦ååæ¢å°æå®æ°æ®åºã\n\nãç¤ºä¾ãåå»ºæ°æ®åºï¼å¹¶æå¥ä¸æ¡æ°æ®\n\nååå»ºçæ°æ®åº test å¹¶ä¸å¨æ°æ®åºçåè¡¨ä¸­ï¼ è¦æ¾ç¤ºå®ï¼éè¦æå¥ä¸äºæ°æ®\n\n> use test\nswitched to db test\n>\n> show dbs\nadmin   0.000gb\nconfig  0.000gb\nlocal   0.000gb\n> db.test.insert({"name":"mongodb"})\nwriteresult({ "ninserted" : 1 })\n> show dbs\nadmin   0.000gb\nconfig  0.000gb\nlocal   0.000gb\ntest    0.000gb\n\n\n# å é¤æ°æ®åº\n\nå é¤å½åæ°æ®åº\n\ndb.dropdatabase()\n\n\n\n# éåæä½\n\n# æ¥çéå\n\nshow collections\n\n\n# åå»ºéå\n\ndb.createcollection(name, options)\n\n\nåæ°è¯´æï¼\n\n * name: è¦åå»ºçéååç§°\n * options: å¯éåæ°, æå®æå³åå­å¤§å°åç´¢å¼çéé¡¹\n\noptions å¯ä»¥æ¯å¦ä¸åæ°ï¼\n\nå­æ®µ            ç±»å   æè¿°\ncapped        å¸å°   ï¼å¯éï¼å¦æä¸º trueï¼ååå»ºåºå®éåãåºå®éåæ¯ææçåºå®å¤§å°çéåï¼å½è¾¾å°æå¤§å¼æ¶ï¼å®ä¼èªå¨è¦çææ©çææ¡£ã\n                   å½è¯¥å¼ä¸º true æ¶ï¼å¿é¡»æå® size åæ°ã\nautoindexid   å¸å°   3.2 ä¹åä¸åæ¯æè¯¥åæ°ãï¼å¯éï¼å¦ä¸º trueï¼èªå¨å¨ _id å­æ®µåå»ºç´¢å¼ãé»è®¤ä¸º falseã\nsize          æ°å¼   ï¼å¯éï¼ä¸ºåºå®éåæå®ä¸ä¸ªæå¤§å¼ï¼å³å­èæ°ã å¦æ capped ä¸º trueï¼ä¹éè¦æå®è¯¥å­æ®µã\nmax           æ°å¼   ï¼å¯éï¼æå®åºå®éåä¸­åå«ææ¡£çæå¤§æ°éã\n\nå¨æå¥ææ¡£æ¶ï¼mongodb é¦åæ£æ¥åºå®éåç size å­æ®µï¼ç¶åæ£æ¥ max å­æ®µã\n\n> db.createcollection("collection")\n{ "ok" : 1 }\n> show collections\ncollection\n\n\n# å é¤éå\n\n> db.collection.drop()\ntrue\n> show collections\n>\n\n\n\n# æå¥ææ¡£æä½\n\nmongodb ä½¿ç¨ insert() æ¹æ³å®ææå¥æä½ã\n\nè¯­æ³æ ¼å¼\n\n# æå¥åæ¡è®°å½\ndb.<éå>.insertone(<json>)\n# æå¥å¤æ¡è®°å½\ndb.<éå>.insertmany([<json 1>, <json 2>, ..., <json n>])\n\n\nãç¤ºä¾ãinsertone\n\n> db.color.insertone({name: "red"})\n{\n        "acknowledged" : true,\n        "insertedid" : objectid("5f533ae4e8f16647950fdf43")\n}\n\n\nãç¤ºä¾ãinsertmany\n\n> db.color.insertmany([\n  {\n    "name": "yellow"\n  },\n  {\n    "name": "blue"\n  }\n])\n{\n        "acknowledged" : true,\n        "insertedids" : [\n                objectid("5f533bcae8f16647950fdf44"),\n                objectid("5f533bcae8f16647950fdf45")\n        ]\n}\n>\n\n\n\n# æ¥è¯¢ææ¡£æä½\n\nmongodb ä½¿ç¨ find() æ¹æ³å®ææ¥è¯¢ææ¡£æä½ã\n\nè¯­æ³æ ¼å¼\n\ndb.<éå>.find(<json>)\n\n\næ¥è¯¢æ¡ä»¶ä¹æ¯ json å½¢å¼ï¼å¦æä¸è®¾ç½®æ¥è¯¢æ¡ä»¶ï¼å³ä¸ºå¨éæ¥è¯¢ã\n\n# æ¥è¯¢æ¡ä»¶\n\næä½                      æ ¼å¼                                      èä¾                                         rdbms ä¸­çç±»ä¼¼è¯­å¥\nç­äº                      {<key>:<value>}                         db.book.find({"pagecount": {$eq: 0}})      where pagecount = 0\nä¸ç­äº                     {<key>:{$ne:<value>}}                   db.book.find({"pagecount": {$ne: 0}})      where likes != 50\nå¤§äº                      {<key>:{$gt:<value>}}                   db.book.find({"pagecount": {$gt: 0}})      where likes > 50\n{<key>:{$gt:<value>}}   db.book.find({"pagecount": {$gt: 0}})   where likes > 50                           å¤§äºæç­äº\nå°äº                      {<key>:{$lt:<value>}}                   db.book.find({"pagecount": {$lt: 200}})    where likes < 50\nå°äºæç­äº                   {<key>:{$lte:<value>}}                  db.book.find({"pagecount": {$lte: 200}})   where likes <= 50\n\n> è¯´æï¼\n> \n> $eq  --------  equal  =\n> $ne ----------- not equal  !=\n> $gt -------- greater than  >\n> $gte --------- gt equal  >=\n> $lt -------- less than  <\n> $lte --------- lt equal  <=\n\nãç¤ºä¾ã\n\n\n\n# ç»è®¡å¹éæ¥è¯¢æ¡ä»¶çè®°å½æ°\n> db.book.find({"status": "meap"}).count()\n68\n\n\n# æ¥è¯¢é»è¾æ¡ä»¶\n\nï¼1ï¼and æ¡ä»¶\n\nmongodb ç find() æ¹æ³å¯ä»¥ä¼ å¥å¤ä¸ªé®(key)ï¼æ¯ä¸ªé®(key)ä»¥éå·éå¼ï¼å³å¸¸è§ sql ç and æ¡ä»¶ã\n\nè¯­æ³æ ¼å¼å¦ä¸ï¼\n\n> db.col.find({key1:value1, key2:value2}).pretty()\n\n\nï¼2ï¼or æ¡ä»¶\n\nmongodb or æ¡ä»¶è¯­å¥ä½¿ç¨äºå³é®å­ $or,è¯­æ³æ ¼å¼å¦ä¸ï¼\n\n>db.col.find(\n   {\n      $or: [\n         {key1: value1}, {key2:value2}\n      ]\n   }\n).pretty()\n\n\n# æ¨¡ç³æ¥è¯¢\n\næ¥è¯¢ title åå«"æ"å­çææ¡£ï¼\n\ndb.col.find({ title: /æ/ })\n\n\næ¥è¯¢ title å­æ®µä»¥"æ"å­å¼å¤´çææ¡£ï¼\n\ndb.col.find({ title: /^æ/ })\n\n\næ¥è¯¢ titl e å­æ®µä»¥"æ"å­ç»å°¾çææ¡£ï¼\n\ndb.col.find({ title: /æ$/ })\n\n\n# limit() æ¹æ³\n\nå¦æä½ éè¦å¨ mongodb ä¸­è¯»åæå®æ°éçæ°æ®è®°å½ï¼å¯ä»¥ä½¿ç¨ mongodb ç limit æ¹æ³ï¼limit()æ¹æ³æ¥åä¸ä¸ªæ°å­åæ°ï¼è¯¥åæ°æå®ä» mongodb ä¸­è¯»åçè®°å½æ¡æ°ã\n\nlimit()æ¹æ³åºæ¬è¯­æ³å¦ä¸æç¤ºï¼\n\n>db.collection_name.find().limit(number)\n\n\n# skip() æ¹æ³\n\næä»¬é¤äºå¯ä»¥ä½¿ç¨ limit()æ¹æ³æ¥è¯»åæå®æ°éçæ°æ®å¤ï¼è¿å¯ä»¥ä½¿ç¨ skip()æ¹æ³æ¥è·³è¿æå®æ°éçæ°æ®ï¼skip æ¹æ³åæ ·æ¥åä¸ä¸ªæ°å­åæ°ä½ä¸ºè·³è¿çè®°å½æ¡æ°ã\n\nskip() æ¹æ³èæ¬è¯­æ³æ ¼å¼å¦ä¸ï¼\n\n>db.collection_name.find().limit(number).skip(number)\n\n\n# sort() æ¹æ³\n\nå¨ mongodb ä¸­ä½¿ç¨ sort() æ¹æ³å¯¹æ°æ®è¿è¡æåºï¼sort() æ¹æ³å¯ä»¥éè¿åæ°æå®æåºçå­æ®µï¼å¹¶ä½¿ç¨ 1 å -1 æ¥æå®æåºçæ¹å¼ï¼å¶ä¸­ 1 ä¸ºååºæåï¼è -1 æ¯ç¨äºéåºæåã\n\nsort()æ¹æ³åºæ¬è¯­æ³å¦ä¸æç¤ºï¼\n\n>db.collection_name.find().sort({key:1})\n\n\n> æ³¨æï¼skip(), limilt(), sort()ä¸ä¸ªæ¾å¨ä¸èµ·æ§è¡çæ¶åï¼æ§è¡çé¡ºåºæ¯å sort(), ç¶åæ¯ skip()ï¼æåæ¯æ¾ç¤ºç limit()ã\n\n\n# æ´æ°ææ¡£æä½\n\nupdate() æ¹æ³ç¨äºæ´æ°å·²å­å¨çææ¡£ãè¯­æ³æ ¼å¼å¦ä¸ï¼\n\ndb.collection.update(\n   <query>,\n   <update>,\n   {\n     upsert: <boolean>,\n     multi: <boolean>,\n     writeconcern: <document>\n   }\n)\n\n\nåæ°è¯´æï¼\n\n * query : update çæ¥è¯¢æ¡ä»¶ï¼ç±»ä¼¼ sql update æ¥è¯¢å where åé¢çã\n * update : update çå¯¹è±¡åä¸äºæ´æ°çæä½ç¬¦ï¼å¦$,$inc...ï¼ç­ï¼ä¹å¯ä»¥çè§£ä¸º sql update æ¥è¯¢å set åé¢ç\n * upsert : å¯éï¼è¿ä¸ªåæ°çæææ¯ï¼å¦æä¸å­å¨ update çè®°å½ï¼æ¯å¦æå¥ objnew,true ä¸ºæå¥ï¼é»è®¤æ¯ falseï¼ä¸æå¥ã\n * multi : å¯éï¼mongodb é»è®¤æ¯ false,åªæ´æ°æ¾å°çç¬¬ä¸æ¡è®°å½ï¼å¦æè¿ä¸ªåæ°ä¸º true,å°±æææ¡ä»¶æ¥åºæ¥å¤æ¡è®°å½å¨é¨æ´æ°ã\n * writeconcern :å¯éï¼æåºå¼å¸¸ççº§å«ã\n\nãç¤ºä¾ãæ´æ°ææ¡£\n\ndb.collection.update({ title: \'mongodb æç¨\' }, { $set: { title: \'mongodb\' } })\n\n\nãç¤ºä¾ãæ´æ°å¤æ¡ç¸åææ¡£\n\nä»¥ä¸è¯­å¥åªä¼ä¿®æ¹ç¬¬ä¸æ¡åç°çææ¡£ï¼å¦æä½ è¦ä¿®æ¹å¤æ¡ç¸åçææ¡£ï¼åéè¦è®¾ç½® multi åæ°ä¸º trueã\n\ndb.collection.update(\n  { title: \'mongodb æç¨\' },\n  { $set: { title: \'mongodb\' } },\n  { multi: true }\n)\n\n\nãç¤ºä¾ãæ´å¤å®ä¾\n\nåªæ´æ°ç¬¬ä¸æ¡è®°å½ï¼\n\ndb.collection.update({ count: { $gt: 1 } }, { $set: { test2: \'ok\' } })\n\n\nå¨é¨æ´æ°ï¼\n\ndb.collection.update(\n  { count: { $gt: 3 } },\n  { $set: { test2: \'ok\' } },\n  false,\n  true\n)\n\n\nåªæ·»å ç¬¬ä¸æ¡ï¼\n\ndb.collection.update(\n  { count: { $gt: 4 } },\n  { $set: { test5: \'ok\' } },\n  true,\n  false\n)\n\n\nå¨é¨æ·»å è¿å»:\n\ndb.collection.update(\n  { count: { $gt: 4 } },\n  { $set: { test5: \'ok\' } },\n  true,\n  false\n)\n\n\nå¨é¨æ´æ°ï¼\n\ndb.collection.update(\n  { count: { $gt: 4 } },\n  { $set: { test5: \'ok\' } },\n  true,\n  false\n)\n\n\nåªæ´æ°ç¬¬ä¸æ¡è®°å½ï¼\n\ndb.collection.update(\n  { count: { $gt: 4 } },\n  { $set: { test5: \'ok\' } },\n  true,\n  false\n)\n\n\n\n# å é¤ææ¡£æä½\n\nå®æ¹æ¨èä½¿ç¨ deleteone() å deletemany() æ¹æ³å é¤æ°æ®ã\n\nå é¤ status ç­äº a çå¨é¨ææ¡£ï¼\n\ndb.collection.deletemany({ status: \'a\' })\n\n\nå é¤ status ç­äº d çä¸ä¸ªææ¡£ï¼\n\ndb.collection.deleteone({ status: \'d\' })\n\n\n\n# ç´¢å¼æä½\n\nç´¢å¼éå¸¸è½å¤æå¤§çæé«æ¥è¯¢çæçï¼å¦ææ²¡æç´¢å¼ï¼mongodb å¨è¯»åæ°æ®æ¶å¿é¡»æ«æéåä¸­çæ¯ä¸ªæä»¶å¹¶éåé£äºç¬¦åæ¥è¯¢æ¡ä»¶çè®°å½ã\n\nè¿ç§æ«æå¨éåçæ¥è¯¢æçæ¯éå¸¸ä½çï¼ç¹å«å¨å¤çå¤§éçæ°æ®æ¶ï¼æ¥è¯¢å¯ä»¥è¦è±è´¹å åç§çè³å åéï¼è¿å¯¹ç½ç«çæ§è½æ¯éå¸¸è´å½çã\n\nç´¢å¼æ¯ç¹æ®çæ°æ®ç»æï¼ç´¢å¼å­å¨å¨ä¸ä¸ªæäºéåè¯»åçæ°æ®éåä¸­ï¼ç´¢å¼æ¯å¯¹æ°æ®åºè¡¨ä¸­ä¸åæå¤åçå¼è¿è¡æåºçä¸ç§ç»æã\n\nmongodb ä½¿ç¨ createindex() æ¹æ³æ¥åå»ºç´¢å¼ã\n\ncreateindex()æ¹æ³åºæ¬è¯­æ³æ ¼å¼å¦ä¸æç¤ºï¼\n\n>db.collection.createindex(keys, options)\n\n\nè¯­æ³ä¸­ key å¼ä¸ºä½ è¦åå»ºçç´¢å¼å­æ®µï¼1 ä¸ºæå®æååºåå»ºç´¢å¼ï¼å¦æä½ æ³æéåºæ¥åå»ºç´¢å¼æå®ä¸º -1 å³å¯ã\n\n>db.col.createindex({"title":1})\n\n\ncreateindex() æ¹æ³ä¸­ä½ ä¹å¯ä»¥è®¾ç½®ä½¿ç¨å¤ä¸ªå­æ®µåå»ºç´¢å¼ï¼å³ç³»åæ°æ®åºä¸­ç§°ä½å¤åç´¢å¼ï¼ã\n\n>db.col.createindex({"title":1,"description":-1})\n\n\ncreateindex() æ¥æ¶å¯éåæ°ï¼å¯éåæ°åè¡¨å¦ä¸ï¼\n\nparameter            type            description\nbackground           boolean         å»ºç´¢å¼è¿ç¨ä¼é»å¡å¶å®æ°æ®åºæä½ï¼background å¯æå®ä»¥åå°æ¹å¼åå»ºç´¢å¼ï¼å³å¢å  "background"\n                                     å¯éåæ°ã "background" é»è®¤å¼ä¸ºfalseã\nunique               boolean         å»ºç«çç´¢å¼æ¯å¦å¯ä¸ãæå®ä¸º true åå»ºå¯ä¸ç´¢å¼ãé»è®¤å¼ä¸ºfalse.\nname                 string          ç´¢å¼çåç§°ãå¦ææªæå®ï¼mongodb çéè¿è¿æ¥ç´¢å¼çå­æ®µååæåºé¡ºåºçæä¸ä¸ªç´¢å¼åç§°ã\ndropdups             boolean         **3.0+çæ¬å·²åºå¼ã**å¨å»ºç«å¯ä¸ç´¢å¼æ¶æ¯å¦å é¤éå¤è®°å½,æå® true åå»ºå¯ä¸ç´¢å¼ãé»è®¤å¼ä¸º falseã\nsparse               boolean         å¯¹ææ¡£ä¸­ä¸å­å¨çå­æ®µæ°æ®ä¸å¯ç¨ç´¢å¼ï¼è¿ä¸ªåæ°éè¦ç¹å«æ³¨æï¼å¦æè®¾ç½®ä¸º true\n                                     çè¯ï¼å¨ç´¢å¼å­æ®µä¸­ä¸ä¼æ¥è¯¢åºä¸åå«å¯¹åºå­æ®µçææ¡£.ãé»è®¤å¼ä¸º false.\nexpireafterseconds   integer         æå®ä¸ä¸ªä»¥ç§ä¸ºåä½çæ°å¼ï¼å®æ ttl è®¾å®ï¼è®¾å®éåççå­æ¶é´ã\nv                    index version   ç´¢å¼ççæ¬å·ãé»è®¤çç´¢å¼çæ¬åå³äº mongod åå»ºç´¢å¼æ¶è¿è¡ççæ¬ã\nweights              document        ç´¢å¼æéå¼ï¼æ°å¼å¨ 1 å° 99,999 ä¹é´ï¼è¡¨ç¤ºè¯¥ç´¢å¼ç¸å¯¹äºå¶ä»ç´¢å¼å­æ®µçå¾åæéã\ndefault_language     string          å¯¹äºææ¬ç´¢å¼ï¼è¯¥åæ°å³å®äºåç¨è¯åè¯å¹²åè¯å¨çè§åçåè¡¨ã é»è®¤ä¸ºè±è¯­\nlanguage_override    string          å¯¹äºææ¬ç´¢å¼ï¼è¯¥åæ°æå®äºåå«å¨ææ¡£ä¸­çå­æ®µåï¼è¯­è¨è¦çé»è®¤ç languageï¼é»è®¤å¼ä¸º language.\n\n\n# mongodb èåæä½\n\nmongodb ä¸­èå(aggregate)ä¸»è¦ç¨äºå¤çæ°æ®(è¯¸å¦ç»è®¡å¹³åå¼,æ±åç­)ï¼å¹¶è¿åè®¡ç®åçæ°æ®ç»æãæç¹ç±»ä¼¼ sql è¯­å¥ä¸­ç count(*)ã\n\n\n# ç®¡é\n\næ´ä¸ªèåè¿ç®è¿ç¨ç§°ä¸ºç®¡éï¼å®æ¯ç±å¤ä¸ªæ­¥éª¤ç»æï¼æ¯ä¸ªç®¡é\n\n * æ¥åä¸ç³»åææ¡£ï¼åå§æ°æ®ï¼ï¼\n * æ¯ä¸ªæ­¥éª¤å¯¹è¿äºææ¡£è¿è¡ä¸ç³»åè¿ç®ï¼\n * ç»æææ¡£è¾åºç»ä¸ä¸ä¸ªæ­¥éª¤ï¼\n\nèåæä½çåºæ¬æ ¼å¼\n\npipeline = [$stage1, $stage1, ..., $stagen];\n\ndb.<éå>.aggregate(pipeline, {options});\n\n\n\n# èåæ­¥éª¤\n\næ­¥éª¤                 ä½ç¨     sql ç­ä»·è¿ç®ç¬¦\n$match             è¿æ»¤     where\n$project           æå½±     as\n$sort              æåº     order by\n$group             åç»     group by\n$skip / $limit     ç»æéå¶   skip / limit\n$lookup            å·¦å¤è¿æ¥   left outer join\n$unwind            å±å¼æ°ç»   n/a\n$graphlookup       å¾æç´¢    n/a\n$facet / $bucket   åé¢æç´¢   n/a\n\nãç¤ºä¾ã\n\n> db.collection.insertmany([{"title":"mongodb overview","description":"mongodb is no sql database","by_user":"collection","tagsr":["mongodb","database","nosql"],"likes":"100"},{"title":"nosql overview","description":"no sql database is very fast","by_user":"collection","tagsr":["mongodb","database","nosql"],"likes":"10"},{"title":"neo4j overview","description":"neo4j is no sql database","by_user":"neo4j","tagsr":["neo4j","database","nosql"],"likes":"750"}])\n> db.collection.aggregate([{$group : {_id : "$by_user", num_tutorial : {$sum : 1}}}])\n{ "_id" : null, "num_tutorial" : 3 }\n{ "_id" : "neo4j", "num_tutorial" : 1 }\n{ "_id" : "collection", "num_tutorial" : 2 }\n\n\nä¸è¡¨å±ç¤ºäºä¸äºèåçè¡¨è¾¾å¼:\n\nè¡¨è¾¾å¼         æè¿°                        å®ä¾\n$sum        è®¡ç®æ»åã                     db.mycol.aggregate([{$group : {_id : "$by_user",\n                                      num_tutorial : {$sum : "$likes"}}}])\n$avg        è®¡ç®å¹³åå¼                     db.mycol.aggregate([{$group : {_id : "$by_user",\n                                      num_tutorial : {$avg : "$likes"}}}])\n$min        è·åéåä¸­ææææ¡£å¯¹åºå¼å¾æå°å¼ã         db.mycol.aggregate([{$group : {_id : "$by_user",\n                                      num_tutorial : {$min : "$likes"}}}])\n$max        è·åéåä¸­ææææ¡£å¯¹åºå¼å¾æå¤§å¼ã         db.mycol.aggregate([{$group : {_id : "$by_user",\n                                      num_tutorial : {$max : "$likes"}}}])\n$push       å¨ç»æææ¡£ä¸­æå¥å¼å°ä¸ä¸ªæ°ç»ä¸­ã          db.mycol.aggregate([{$group : {_id : "$by_user", url :\n                                      {$push: "$url"}}}])\n$addtoset   å¨ç»æææ¡£ä¸­æå¥å¼å°ä¸ä¸ªæ°ç»ä¸­ï¼ä½ä¸åå»ºå¯æ¬ã   db.mycol.aggregate([{$group : {_id : "$by_user", url :\n                                      {$addtoset : "$url"}}}])\n$first      æ ¹æ®èµæºææ¡£çæåºè·åç¬¬ä¸ä¸ªææ¡£æ°æ®ã       db.mycol.aggregate([{$group : {_id : "$by_user", first_url :\n                                      {$first : "$url"}}}])\n$last       æ ¹æ®èµæºææ¡£çæåºè·åæåä¸ä¸ªææ¡£æ°æ®       db.mycol.aggregate([{$group : {_id : "$by_user", last_url :\n                                      {$last : "$url"}}}])\n\n\n# åèèµæ\n\n * mongodb å®ç½\n * mongodb github\n * mongodb æç¨',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"å³ç³»åæ°æ®åº",frontmatter:{title:"å³ç³»åæ°æ®åº",date:"2022-04-11T16:52:35.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº"],permalink:"/pages/bb43eb/",hidden:!0},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/",relativePath:"12.æ°æ®åº/03.å³ç³»åæ°æ®åº/README.md",key:"v-44b09ccb",path:"/pages/bb43eb/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:13},{level:3,title:"å³ç³»åæ°æ®åºç»¼å",slug:"å³ç³»åæ°æ®åºç»¼å",normalizedTitle:"å³ç³»åæ°æ®åºç»¼å",charIndex:23},{level:3,title:"Mysql",slug:"mysql",normalizedTitle:"mysql",charIndex:111},{level:3,title:"å¶ä»",slug:"å¶ä»",normalizedTitle:"å¶ä»",charIndex:391},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:444},{level:3,title:"ç»¼å",slug:"ç»¼å",normalizedTitle:"ç»¼å",charIndex:29},{level:3,title:"Mysql",slug:"mysql-2",normalizedTitle:"mysql",charIndex:111},{level:3,title:"å¶ä»",slug:"å¶ä»-2",normalizedTitle:"å¶ä»",charIndex:391},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:794}],headersStr:"ð åå®¹ å³ç³»åæ°æ®åºç»¼å Mysql å¶ä» ð èµæ ç»¼å Mysql å¶ä» ðª ä¼ é",content:"# å³ç³»åæ°æ®åº\n\n\n# ð åå®¹\n\n\n# å³ç³»åæ°æ®åºç»¼å\n\n * å³ç³»åæ°æ®åºé¢è¯æ»ç» ð¯\n * SQL è¯­æ³åºç¡ç¹æ§\n * SQL è¯­æ³é«çº§ç¹æ§\n * æ©å± SQL\n * SQL Cheat Sheet\n\n\n# Mysql\n\n\n\n * Mysql åºç¨æå â¡\n * Mysql å·¥ä½æµ - å³é®è¯ï¼è¿æ¥ãç¼å­ãè¯­æ³åæãä¼åãæ§è¡å¼æãredo logãbin logãä¸¤é¶æ®µæäº¤\n * Mysql äºå¡ - å³é®è¯ï¼ACIDãAUTOCOMMITãäºå¡éç¦»çº§å«ãæ­»éãåå¸å¼äºå¡\n * Mysql é - å³é®è¯ï¼ä¹è§éãè¡¨çº§éãè¡çº§éãæåéãMVCCãNext-key é\n * Mysql ç´¢å¼ - å³é®è¯ï¼HashãB æ ãèç°ç´¢å¼ãåè¡¨\n * Mysql æ§è½ä¼å\n * Mysql è¿ç»´ ð¨\n * Mysql éç½® ð¨\n * Mysql é®é¢\n\n\n# å¶ä»\n\n * PostgreSQL åºç¨æå\n * H2 åºç¨æå\n * SqLite åºç¨æå\n\n\n# ð èµæ\n\n\n# ç»¼å\n\n * ãæ°æ®åºçç´¢å¼è®¾è®¡ä¸ä¼åã\n * ãSQL å¿ç¥å¿ä¼ã - SQL å¥é¨ç»å¸\n\n\n# Mysql\n\n * å®æ¹\n   * Mysql å®ç½\n   * Mysql å®æ¹ææ¡£\n   * Mysql å®æ¹ææ¡£ä¹å½ä»¤è¡å®¢æ·ç«¯\n * ä¹¦ç±\n   * ãé«æ§è½ MySQLã - ç»å¸ï¼éå DBA æä½ä¸ºå¼åèçåèæå\n   * ãMySQL å¿ç¥å¿ä¼ã - MySQL å¥é¨ç»å¸\n * æç¨\n   * MySQL å®æ 45 è®²\n   * runoob.com MySQL æç¨\n   * mysql-tutorial\n * æ´å¤èµæº\n   * awesome-mysql\n\n\n# å¶ä»\n\n * ãOracle Database 9i/10g/11g ç¼ç¨èºæ¯ã\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç IT ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",normalizedContent:"# å³ç³»åæ°æ®åº\n\n\n# ð åå®¹\n\n\n# å³ç³»åæ°æ®åºç»¼å\n\n * å³ç³»åæ°æ®åºé¢è¯æ»ç» ð¯\n * sql è¯­æ³åºç¡ç¹æ§\n * sql è¯­æ³é«çº§ç¹æ§\n * æ©å± sql\n * sql cheat sheet\n\n\n# mysql\n\n\n\n * mysql åºç¨æå â¡\n * mysql å·¥ä½æµ - å³é®è¯ï¼è¿æ¥ãç¼å­ãè¯­æ³åæãä¼åãæ§è¡å¼æãredo logãbin logãä¸¤é¶æ®µæäº¤\n * mysql äºå¡ - å³é®è¯ï¼acidãautocommitãäºå¡éç¦»çº§å«ãæ­»éãåå¸å¼äºå¡\n * mysql é - å³é®è¯ï¼ä¹è§éãè¡¨çº§éãè¡çº§éãæåéãmvccãnext-key é\n * mysql ç´¢å¼ - å³é®è¯ï¼hashãb æ ãèç°ç´¢å¼ãåè¡¨\n * mysql æ§è½ä¼å\n * mysql è¿ç»´ ð¨\n * mysql éç½® ð¨\n * mysql é®é¢\n\n\n# å¶ä»\n\n * postgresql åºç¨æå\n * h2 åºç¨æå\n * sqlite åºç¨æå\n\n\n# ð èµæ\n\n\n# ç»¼å\n\n * ãæ°æ®åºçç´¢å¼è®¾è®¡ä¸ä¼åã\n * ãsql å¿ç¥å¿ä¼ã - sql å¥é¨ç»å¸\n\n\n# mysql\n\n * å®æ¹\n   * mysql å®ç½\n   * mysql å®æ¹ææ¡£\n   * mysql å®æ¹ææ¡£ä¹å½ä»¤è¡å®¢æ·ç«¯\n * ä¹¦ç±\n   * ãé«æ§è½ mysqlã - ç»å¸ï¼éå dba æä½ä¸ºå¼åèçåèæå\n   * ãmysql å¿ç¥å¿ä¼ã - mysql å¥é¨ç»å¸\n * æç¨\n   * mysql å®æ 45 è®²\n   * runoob.com mysql æç¨\n   * mysql-tutorial\n * æ´å¤èµæº\n   * awesome-mysql\n\n\n# å¶ä»\n\n * ãoracle database 9i/10g/11g ç¼ç¨èºæ¯ã\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç it ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"å³ç³»åæ°æ®åºå¶ä»ç¥è¯",frontmatter:{title:"å³ç³»åæ°æ®åºå¶ä»ç¥è¯",date:"2022-04-11T16:52:35.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","å¶ä»"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº"],permalink:"/pages/ca9888/",hidden:!0},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/99.%E5%85%B6%E4%BB%96/",relativePath:"12.æ°æ®åº/03.å³ç³»åæ°æ®åº/99.å¶ä»/README.md",key:"v-19684eb4",path:"/pages/ca9888/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:17},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:73},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:83}],headersStr:"ð åå®¹ ð èµæ ðª ä¼ é",content:"# å³ç³»åæ°æ®åºå¶ä»ç¥è¯\n\n\n# ð åå®¹\n\n * PostgreSQL åºç¨æå\n * H2 åºç¨æå\n * SqLite åºç¨æå\n\n\n# ð èµæ\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç IT ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",normalizedContent:"# å³ç³»åæ°æ®åºå¶ä»ç¥è¯\n\n\n# ð åå®¹\n\n * postgresql åºç¨æå\n * h2 åºç¨æå\n * sqlite åºç¨æå\n\n\n# ð èµæ\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç it ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"MongoDB çèåæä½",frontmatter:{title:"MongoDB çèåæä½",date:"2020-09-21T21:22:57.000Z",categories:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],tags:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB","èå"],permalink:"/pages/75daa5/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/04.%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/01.MongoDB/03.MongoDB%E7%9A%84%E8%81%9A%E5%90%88%E6%93%8D%E4%BD%9C.html",relativePath:"12.æ°æ®åº/04.ææ¡£æ°æ®åº/01.MongoDB/03.MongoDBçèåæä½.md",key:"v-0f37026c",path:"/pages/75daa5/",headers:[{level:2,title:"Pipeline",slug:"pipeline",normalizedTitle:"pipeline",charIndex:137},{level:3,title:"Pipeline ç®ä»",slug:"pipeline-ç®ä»",normalizedTitle:"pipeline ç®ä»",charIndex:150},{level:3,title:"Pipeline ä¼å",slug:"pipeline-ä¼å",normalizedTitle:"pipeline ä¼å",charIndex:868},{level:4,title:"æå½±ä¼å",slug:"æå½±ä¼å",normalizedTitle:"æå½±ä¼å",charIndex:883},{level:4,title:"Pipeline ä¸²è¡ä¼å",slug:"pipeline-ä¸²è¡ä¼å",normalizedTitle:"pipeline ä¸²è¡ä¼å",charIndex:933},{level:4,title:"Pipeline å¹¶è¡ä¼å",slug:"pipeline-å¹¶è¡ä¼å",normalizedTitle:"pipeline å¹¶è¡ä¼å",charIndex:2147},{level:5,title:"$sort + $limit",slug:"sort-limit",normalizedTitle:"$sort + $limit",charIndex:2217},{level:5,title:"$limit + $limit",slug:"limit-limit",normalizedTitle:"$limit + $limit",charIndex:2710},{level:5,title:"$skip + $skip",slug:"skip-skip",normalizedTitle:"$skip + $skip",charIndex:2832},{level:5,title:"$match + $match",slug:"match-match",normalizedTitle:"$match + $match",charIndex:2944},{level:5,title:"$lookup + $unwind",slug:"lookup-unwind",normalizedTitle:"$lookup + $unwind",charIndex:3144},{level:3,title:"Pipeline éå¶",slug:"pipeline-éå¶",normalizedTitle:"pipeline éå¶",charIndex:3614},{level:2,title:"Map-Reduce",slug:"map-reduce",normalizedTitle:"map-reduce",charIndex:3691},{level:2,title:"åä¸ç®çèåæ¹æ³",slug:"åä¸ç®çèåæ¹æ³",normalizedTitle:"åä¸ç®çèåæ¹æ³",charIndex:123},{level:2,title:"SQL å MongoDB èåå¯¹æ¯",slug:"sql-å-mongodb-èåå¯¹æ¯",normalizedTitle:"sql å mongodb èåå¯¹æ¯",charIndex:4488},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:7427}],headersStr:"Pipeline Pipeline ç®ä» Pipeline ä¼å æå½±ä¼å Pipeline ä¸²è¡ä¼å Pipeline å¹¶è¡ä¼å $sort + $limit $limit + $limit $skip + $skip $match + $match $lookup + $unwind Pipeline éå¶ Map-Reduce åä¸ç®çèåæ¹æ³ SQL å MongoDB èåå¯¹æ¯ åèèµæ",content:"# MongoDB çèåæä½\n\nèåæä½å¤çæ°æ®è®°å½å¹¶è¿åè®¡ç®ç»æãèåæä½å°æ¥èªå¤ä¸ª document çå¼åç»ï¼å¹¶å¯ä»¥å¯¹åç»çæ°æ®æ§è¡åç§æä½ä»¥è¿ååä¸ªç»æã MongoDB æä¾äºä¸ç§æ§è¡èåçæ¹å¼ï¼èåç®¡éï¼map-reduce å½æ°ååä¸ç®çèåæ¹æ³ã\n\n\n# Pipeline\n\n\n# Pipeline ç®ä»\n\nMongoDB çèåæ¡æ¶ä»¥æ°æ®å¤çç®¡éï¼Pipelineï¼çæ¦å¿µä¸ºæ¨¡åã\n\nMongoDB éè¿ db.collection.aggregate() æ¹æ³æ¯æèåæä½ãå¹¶æä¾äº aggregate å½ä»¤æ¥æ§è¡ pipelineã\n\nMongoDB Pipeline ç±å¤ä¸ªé¶æ®µï¼stagesï¼ç»æãæ¯ä¸ªé¶æ®µå¨ document éè¿ pipeline æ¶é½ä¼å¯¹å¶è¿è¡è½¬æ¢ãpipeline é¶æ®µä¸éè¦ä¸ºæ¯ä¸ªè¾å¥ document é½çæä¸ä¸ªè¾åº documentãä¾å¦ï¼æäºé¶æ®µå¯è½ä¼çææ° document æè¿æ»¤ documentã\n\nåä¸ä¸ªé¶æ®µå¯ä»¥å¨ pipeline ä¸­åºç°å¤æ¬¡ï¼ä½ $outã$merge,å $geoNear é¶æ®µé¤å¤ãææå¯ç¨ pipeline é¶æ®µå¯ä»¥åèï¼Aggregation Pipeline Stagesã\n\n\n\n * ç¬¬ä¸é¶æ®µï¼$match é¶æ®µæç¶æå­æ®µè¿æ»¤ documentï¼ç¶åå°ç¶æç­äºâ Aâçé£äº document ä¼ éå°ä¸ä¸é¶æ®µã\n * ç¬¬äºé¶æ®µï¼$group é¶æ®µæ cust_id å­æ®µå¯¹ document è¿è¡åç»ï¼ä»¥è®¡ç®æ¯ä¸ªå¯ä¸ cust_id çéé¢æ»åã\n\næåºæ¬çç®¡éé¶æ®µæä¾è¿æ»¤å¨ï¼å¶æä½ç±»ä¼¼äºæ¥è¯¢å document è½¬æ¢ï¼ä¿®æ¹è¾åº document å½¢å¼ï¼ã\n\nå¶ä»ç®¡éæä½æä¾äºç¨äºæç¹å®å­æ®µå¯¹ document è¿è¡åç»åæåºçå·¥å·ï¼ä»¥åç¨äºæ±æ»æ°ç»ï¼åæ¬ document æ°ç»ï¼åå®¹çå·¥å·ãå¦å¤ï¼ç®¡éé¶æ®µå¯ä»¥å°è¿ç®ç¬¦ç¨äºè¯¸å¦è®¡ç®å¹³åå¼æè¿æ¥å­ç¬¦ä¸²ä¹ç±»çä»»å¡ã\n\nèåç®¡éä¹å¯ä»¥å¨åç collection ä¸æä½ã\n\n\n# Pipeline ä¼å\n\n# æå½±ä¼å\n\nPipeline å¯ä»¥ç¡®å®æ¯å¦ä»éè¦ document ä¸­å¿å¡«å­æ®µå³å¯è·å¾ç»æã\n\n# Pipeline ä¸²è¡ä¼å\n\nï¼$projectã$unsetã$addFieldsã$setï¼ + $match ä¸²è¡ä¼å\n\nå¯¹äºåå«æå½±é¶æ®µï¼$project æ $unset æ $addFields æ $setï¼ï¼ä¸åç»­è·éç $match é¶æ®µç Pipeline ï¼MongoDB ä¼å°ææ $match é¶æ®µä¸­ä¸éè¦å¨æå½±é¶æ®µä¸­è®¡ç®åºçå¼çè¿æ»¤å¨ï¼ç§»å¨ä¸ä¸ªå¨æå½±é¶æ®µä¹åçæ° $match é¶æ®µã\n\nå¦æ Pipeline åå«å¤ä¸ªæå½±é¶æ®µ å / æ $match é¶æ®µï¼å MongoDB å°ä¸ºæ¯ä¸ª $match é¶æ®µæ§è¡æ­¤ä¼åï¼å°æ¯ä¸ª $match è¿æ»¤å¨ç§»å¨å°è¯¥è¿æ»¤å¨ä¸ä¾èµçæææå½±é¶æ®µä¹åã\n\nãç¤ºä¾ãPipeline ä¸²è¡ä¼åç¤ºä¾\n\nä¼ååï¼\n\n{ $addFields: {\n    maxTime: { $max: \"$times\" },\n    minTime: { $min: \"$times\" }\n} },\n{ $project: {\n    _id: 1, name: 1, times: 1, maxTime: 1, minTime: 1,\n    avgTime: { $avg: [\"$maxTime\", \"$minTime\"] }\n} },\n{ $match: {\n    name: \"Joe Schmoe\",\n    maxTime: { $lt: 20 },\n    minTime: { $gt: 5 },\n    avgTime: { $gt: 7 }\n} }\n\n\nä¼ååï¼\n\n{ $match: { name: \"Joe Schmoe\" } },\n{ $addFields: {\n    maxTime: { $max: \"$times\" },\n    minTime: { $min: \"$times\" }\n} },\n{ $match: { maxTime: { $lt: 20 }, minTime: { $gt: 5 } } },\n{ $project: {\n    _id: 1, name: 1, times: 1, maxTime: 1, minTime: 1,\n    avgTime: { $avg: [\"$maxTime\", \"$minTime\"] }\n} },\n{ $match: { avgTime: { $gt: 7 } } }\n\n\nè¯´æï¼\n\n{ name: \"Joe Schmoe\" } ä¸éè¦è®¡ç®ä»»ä½æå½±é¶æ®µçå¼ï¼æä»¥å¯ä»¥æ¾å¨æåé¢ã\n\n{ avgTime: { $gt: 7 } } ä¾èµ $project é¶æ®µç avgTime å­æ®µï¼æä»¥ä¸è½ç§»å¨ã\n\nmaxTime å minTime å­æ®µè¢« $addFields é¶æ®µæä¾èµï¼ä½èªèº«ä¸ä¾èµå¶ä»ï¼æä»¥ä¼æ°å»ºä¸ä¸ª $match é¶æ®µï¼å¹¶å°å¶ç½®äº $project é¶æ®µä¹åã\n\n# Pipeline å¹¶è¡ä¼å\n\nå¦æå¯è½ï¼ä¼åé¶æ®µä¼å° Pipeline é¶æ®µåå¹¶å°å¶åèº«ãéå¸¸ï¼åå¹¶åçå¨ä»»æåºåéæ°æåºä¼åä¹åã\n\n# $sort + $limit\n\nå½ $sort å¨ $limit ä¹åæ¶ï¼å¦ææ²¡æä¸­é´é¶æ®µä¿®æ¹ææ¡£æ°éï¼ä¾å¦ $unwindã$groupï¼ï¼åä¼åç¨åºå¯ä»¥å° $limit åå¹¶å° $sort ä¸­ãå¦ææç®¡éé¶æ®µæ´æ¹äº $sort å $limit é¶æ®µä¹é´çææ¡£æ°ï¼å MongoDB ä¸ä¼å° $limit åå¹¶å° $sort ä¸­ã\n\nãç¤ºä¾ã$sort + $limit\n\nä¼ååï¼\n\n{ $sort : { age : -1 } },\n{ $project : { age : 1, status : 1, name : 1 } },\n{ $limit: 5 }\n\n\nä¼ååï¼\n\n{\n    \"$sort\" : {\n       \"sortKey\" : {\n          \"age\" : -1\n       },\n       \"limit\" : NumberLong(5)\n    }\n},\n{ \"$project\" : {\n         \"age\" : 1,\n         \"status\" : 1,\n         \"name\" : 1\n  }\n}\n\n\n# $limit + $limit\n\nå¦æä¸ä¸ª $limit ç´§éå¦ä¸ä¸ª $limitï¼é£ä¹å®ä»¬å¯ä»¥åå¹¶ä¸ºä¸ã\n\nä¼ååï¼\n\n{ $limit: 100 },\n{ $limit: 10 }\n\n\nä¼ååï¼\n\n{\n  $limit: 10\n}\n\n\n# $skip + $skip\n\nå¦æä¸ä¸ª $skip ç´§éå¦ä¸ä¸ª $skip ï¼é£ä¹å®ä»¬å¯ä»¥åå¹¶ä¸ºä¸ã\n\nä¼ååï¼\n\n{ $skip: 5 },\n{ $skip: 2 }\n\n\nä¼ååï¼\n\n{\n  $skip: 7\n}\n\n\n# $match + $match\n\nå¦æä¸ä¸ª $skip ç´§éå¦ä¸ä¸ª $skip ï¼é£ä¹å®ä»¬å¯ä»¥éè¿ $and åå¹¶ä¸ºä¸ã\n\nä¼ååï¼\n\n{ $match: { year: 2014 } },\n{ $match: { status: \"A\" } }\n\n\nä¼ååï¼\n\n{\n  $match: {\n    $and: [{ year: 2014 }, { status: 'A' }]\n  }\n}\n\n\n# $lookup + $unwind\n\nå¦æä¸ä¸ª $unwind ç´§éå¦ä¸ä¸ª $lookupï¼å¹¶ä¸ $unwind å¨ $lookup ç as å­æ®µä¸è¿è¡æ¶ï¼ä¼åç¨åºå¯ä»¥å° $unwind åå¹¶å° $lookup é¶æ®µãè¿æ ·å¯ä»¥é¿ååå»ºè¾å¤§çä¸­é´ææ¡£ã\n\nä¼ååï¼\n\n{\n  $lookup: {\n    from: \"otherCollection\",\n    as: \"resultingArray\",\n    localField: \"x\",\n    foreignField: \"y\"\n  }\n},\n{ $unwind: \"$resultingArray\"}\n\n\nä¼ååï¼\n\n{\n  $lookup: {\n    from: \"otherCollection\",\n    as: \"resultingArray\",\n    localField: \"x\",\n    foreignField: \"y\",\n    unwinding: { preserveNullAndEmptyArrays: false }\n  }\n}\n\n\n\n# Pipeline éå¶\n\nç»æéä¸­çæ¯ä¸ªææ¡£åå BSON ææ¡£å¤§å°éå¶ï¼å½åä¸º 16 MBï¼\n\nPipeline çåå­éå¶ä¸º 100 MBã\n\n\n# Map-Reduce\n\n> èå pipeline æ¯ map-reduce æä¾æ´å¥½çæ§è½åæ´ä¸è´çæ¥å£ã\n\nMap-reduce æ¯ä¸ç§æ°æ®å¤çèå¼ï¼ç¨äºå°å¤§éæ°æ®æ±æ»ä¸ºæç¨çèåç»æãä¸ºäºæ§è¡ map-reduce æä½ï¼MongoDB æä¾äº mapReduce æ°æ®åºå½ä»¤ã\n\n\n\nå¨ä¸é¢çæä½ä¸­ï¼MongoDB å° map é¶æ®µåºç¨äºæ¯ä¸ªè¾å¥ documentï¼å³ collection ä¸­ä¸æ¥è¯¢æ¡ä»¶å¹éç documentï¼ã map å½æ°åååºå¤ä¸ªé®-å¼å¯¹ãå¯¹äºå·æå¤ä¸ªå¼çé£äºé®ï¼MongoDB åºç¨ reduce é¶æ®µï¼è¯¥é¶æ®µæ¶éå¹¶æ±æ»èåçæ°æ®ãç¶åï¼MongoDB å°ç»æå­å¨å¨ collection ä¸­ãå¯éå°ï¼reduce å½æ°çè¾åºå¯ä»¥éè¿ finalize å½æ°æ¥è¿ä¸æ­¥æ±æ»èåç»æã\n\nMongoDB ä¸­çææ map-reduce å½æ°é½æ¯ JavaScriptï¼å¹¶å¨ mongod è¿ç¨ä¸­è¿è¡ã Map-reduce æä½å°åä¸ª collection ç document ä½ä¸ºè¾å¥ï¼å¹¶ä¸å¯ä»¥å¨å¼å§ map é¶æ®µä¹åæ§è¡ä»»ææåºåéå¶ã mapReduce å¯ä»¥å° map-reduce æä½çç»æä½ä¸º document è¿åï¼ä¹å¯ä»¥å°ç»æåå¥ collectionã\n\n\n# åä¸ç®çèåæ¹æ³\n\nMongoDB æ¯æä¸ä¸åä¸ç®ççèåæä½ï¼\n\n * db.collection.estimatedDocumentCount()\n * db.collection.count()\n * db.collection.distinct()\n\nææè¿äºæä½é½æ±æ»äºåä¸ª collection ä¸­ç documentãå°½ç®¡è¿äºæä½æä¾äºå¯¹å¸¸è§èåè¿ç¨çç®åè®¿é®ï¼ä½æ¯å®ä»¬ç¸æ¯èå pipeline å map-reduceï¼ç¼ºå°çµæ´»æ§åä¸°å¯çåè½æ§ã\n\n\n\n\n# SQL å MongoDB èåå¯¹æ¯\n\nMongoDB pipeline æä¾äºè®¸å¤ç­ä»·äº SQL ä¸­å¸¸è§èåè¯­å¥çæä½ã\n\nä¸è¡¨æ¦è¿°äºå¸¸è§ç SQL èåè¯­å¥æå½æ°å MongoDB èåæä½çæ å°è¡¨ï¼\n\nSQL TERMS, FUNCTIONS, AND CONCEPTS   MONGODB AGGREGATION OPERATORS\nWHERE                                $match\nGROUP BY                             $group\nHAVING                               $match\nSELECT                               $project\nORDER BY                             $sort\nLIMIT                                $limit\nSUM()                                $sum\nCOUNT()                              $sum$sortByCount\nJOIN                                 $lookup\nSELECT INTO NEW_TABLE                $out\nMERGE INTO TABLE                     $merge (Available starting in MongoDB 4.2)\nUNION ALL                            $unionWith (Available starting in MongoDB 4.4)\n\nãç¤ºä¾ã\n\ndb.orders.insertMany([\n  {\n    _id: 1,\n    cust_id: 'Ant O. Knee',\n    ord_date: new Date('2020-03-01'),\n    price: 25,\n    items: [\n      { sku: 'oranges', qty: 5, price: 2.5 },\n      { sku: 'apples', qty: 5, price: 2.5 }\n    ],\n    status: 'A'\n  },\n  {\n    _id: 2,\n    cust_id: 'Ant O. Knee',\n    ord_date: new Date('2020-03-08'),\n    price: 70,\n    items: [\n      { sku: 'oranges', qty: 8, price: 2.5 },\n      { sku: 'chocolates', qty: 5, price: 10 }\n    ],\n    status: 'A'\n  },\n  {\n    _id: 3,\n    cust_id: 'Busby Bee',\n    ord_date: new Date('2020-03-08'),\n    price: 50,\n    items: [\n      { sku: 'oranges', qty: 10, price: 2.5 },\n      { sku: 'pears', qty: 10, price: 2.5 }\n    ],\n    status: 'A'\n  },\n  {\n    _id: 4,\n    cust_id: 'Busby Bee',\n    ord_date: new Date('2020-03-18'),\n    price: 25,\n    items: [{ sku: 'oranges', qty: 10, price: 2.5 }],\n    status: 'A'\n  },\n  {\n    _id: 5,\n    cust_id: 'Busby Bee',\n    ord_date: new Date('2020-03-19'),\n    price: 50,\n    items: [{ sku: 'chocolates', qty: 5, price: 10 }],\n    status: 'A'\n  },\n  {\n    _id: 6,\n    cust_id: 'Cam Elot',\n    ord_date: new Date('2020-03-19'),\n    price: 35,\n    items: [\n      { sku: 'carrots', qty: 10, price: 1.0 },\n      { sku: 'apples', qty: 10, price: 2.5 }\n    ],\n    status: 'A'\n  },\n  {\n    _id: 7,\n    cust_id: 'Cam Elot',\n    ord_date: new Date('2020-03-20'),\n    price: 25,\n    items: [{ sku: 'oranges', qty: 10, price: 2.5 }],\n    status: 'A'\n  },\n  {\n    _id: 8,\n    cust_id: 'Don Quis',\n    ord_date: new Date('2020-03-20'),\n    price: 75,\n    items: [\n      { sku: 'chocolates', qty: 5, price: 10 },\n      { sku: 'apples', qty: 10, price: 2.5 }\n    ],\n    status: 'A'\n  },\n  {\n    _id: 9,\n    cust_id: 'Don Quis',\n    ord_date: new Date('2020-03-20'),\n    price: 55,\n    items: [\n      { sku: 'carrots', qty: 5, price: 1.0 },\n      { sku: 'apples', qty: 10, price: 2.5 },\n      { sku: 'oranges', qty: 10, price: 2.5 }\n    ],\n    status: 'A'\n  },\n  {\n    _id: 10,\n    cust_id: 'Don Quis',\n    ord_date: new Date('2020-03-23'),\n    price: 25,\n    items: [{ sku: 'oranges', qty: 10, price: 2.5 }],\n    status: 'A'\n  }\n])\n\n\nSQL å MongoDB èåæ¹å¼å¯¹æ¯ï¼\n\n\n\n\n# åèèµæ\n\n * å®æ¹\n   * MongoDB å®ç½\n   * MongoDB Github\n   * MongoDB å®æ¹åè´¹æç¨\n * æç¨\n   * MongoDB æç¨\n   * MongoDB é«æè¯¾",normalizedContent:"# mongodb çèåæä½\n\nèåæä½å¤çæ°æ®è®°å½å¹¶è¿åè®¡ç®ç»æãèåæä½å°æ¥èªå¤ä¸ª document çå¼åç»ï¼å¹¶å¯ä»¥å¯¹åç»çæ°æ®æ§è¡åç§æä½ä»¥è¿ååä¸ªç»æã mongodb æä¾äºä¸ç§æ§è¡èåçæ¹å¼ï¼èåç®¡éï¼map-reduce å½æ°ååä¸ç®çèåæ¹æ³ã\n\n\n# pipeline\n\n\n# pipeline ç®ä»\n\nmongodb çèåæ¡æ¶ä»¥æ°æ®å¤çç®¡éï¼pipelineï¼çæ¦å¿µä¸ºæ¨¡åã\n\nmongodb éè¿ db.collection.aggregate() æ¹æ³æ¯æèåæä½ãå¹¶æä¾äº aggregate å½ä»¤æ¥æ§è¡ pipelineã\n\nmongodb pipeline ç±å¤ä¸ªé¶æ®µï¼stagesï¼ç»æãæ¯ä¸ªé¶æ®µå¨ document éè¿ pipeline æ¶é½ä¼å¯¹å¶è¿è¡è½¬æ¢ãpipeline é¶æ®µä¸éè¦ä¸ºæ¯ä¸ªè¾å¥ document é½çæä¸ä¸ªè¾åº documentãä¾å¦ï¼æäºé¶æ®µå¯è½ä¼çææ° document æè¿æ»¤ documentã\n\nåä¸ä¸ªé¶æ®µå¯ä»¥å¨ pipeline ä¸­åºç°å¤æ¬¡ï¼ä½ $outã$merge,å $geonear é¶æ®µé¤å¤ãææå¯ç¨ pipeline é¶æ®µå¯ä»¥åèï¼aggregation pipeline stagesã\n\n\n\n * ç¬¬ä¸é¶æ®µï¼$match é¶æ®µæç¶æå­æ®µè¿æ»¤ documentï¼ç¶åå°ç¶æç­äºâ aâçé£äº document ä¼ éå°ä¸ä¸é¶æ®µã\n * ç¬¬äºé¶æ®µï¼$group é¶æ®µæ cust_id å­æ®µå¯¹ document è¿è¡åç»ï¼ä»¥è®¡ç®æ¯ä¸ªå¯ä¸ cust_id çéé¢æ»åã\n\næåºæ¬çç®¡éé¶æ®µæä¾è¿æ»¤å¨ï¼å¶æä½ç±»ä¼¼äºæ¥è¯¢å document è½¬æ¢ï¼ä¿®æ¹è¾åº document å½¢å¼ï¼ã\n\nå¶ä»ç®¡éæä½æä¾äºç¨äºæç¹å®å­æ®µå¯¹ document è¿è¡åç»åæåºçå·¥å·ï¼ä»¥åç¨äºæ±æ»æ°ç»ï¼åæ¬ document æ°ç»ï¼åå®¹çå·¥å·ãå¦å¤ï¼ç®¡éé¶æ®µå¯ä»¥å°è¿ç®ç¬¦ç¨äºè¯¸å¦è®¡ç®å¹³åå¼æè¿æ¥å­ç¬¦ä¸²ä¹ç±»çä»»å¡ã\n\nèåç®¡éä¹å¯ä»¥å¨åç collection ä¸æä½ã\n\n\n# pipeline ä¼å\n\n# æå½±ä¼å\n\npipeline å¯ä»¥ç¡®å®æ¯å¦ä»éè¦ document ä¸­å¿å¡«å­æ®µå³å¯è·å¾ç»æã\n\n# pipeline ä¸²è¡ä¼å\n\nï¼$projectã$unsetã$addfieldsã$setï¼ + $match ä¸²è¡ä¼å\n\nå¯¹äºåå«æå½±é¶æ®µï¼$project æ $unset æ $addfields æ $setï¼ï¼ä¸åç»­è·éç $match é¶æ®µç pipeline ï¼mongodb ä¼å°ææ $match é¶æ®µä¸­ä¸éè¦å¨æå½±é¶æ®µä¸­è®¡ç®åºçå¼çè¿æ»¤å¨ï¼ç§»å¨ä¸ä¸ªå¨æå½±é¶æ®µä¹åçæ° $match é¶æ®µã\n\nå¦æ pipeline åå«å¤ä¸ªæå½±é¶æ®µ å / æ $match é¶æ®µï¼å mongodb å°ä¸ºæ¯ä¸ª $match é¶æ®µæ§è¡æ­¤ä¼åï¼å°æ¯ä¸ª $match è¿æ»¤å¨ç§»å¨å°è¯¥è¿æ»¤å¨ä¸ä¾èµçæææå½±é¶æ®µä¹åã\n\nãç¤ºä¾ãpipeline ä¸²è¡ä¼åç¤ºä¾\n\nä¼ååï¼\n\n{ $addfields: {\n    maxtime: { $max: \"$times\" },\n    mintime: { $min: \"$times\" }\n} },\n{ $project: {\n    _id: 1, name: 1, times: 1, maxtime: 1, mintime: 1,\n    avgtime: { $avg: [\"$maxtime\", \"$mintime\"] }\n} },\n{ $match: {\n    name: \"joe schmoe\",\n    maxtime: { $lt: 20 },\n    mintime: { $gt: 5 },\n    avgtime: { $gt: 7 }\n} }\n\n\nä¼ååï¼\n\n{ $match: { name: \"joe schmoe\" } },\n{ $addfields: {\n    maxtime: { $max: \"$times\" },\n    mintime: { $min: \"$times\" }\n} },\n{ $match: { maxtime: { $lt: 20 }, mintime: { $gt: 5 } } },\n{ $project: {\n    _id: 1, name: 1, times: 1, maxtime: 1, mintime: 1,\n    avgtime: { $avg: [\"$maxtime\", \"$mintime\"] }\n} },\n{ $match: { avgtime: { $gt: 7 } } }\n\n\nè¯´æï¼\n\n{ name: \"joe schmoe\" } ä¸éè¦è®¡ç®ä»»ä½æå½±é¶æ®µçå¼ï¼æä»¥å¯ä»¥æ¾å¨æåé¢ã\n\n{ avgtime: { $gt: 7 } } ä¾èµ $project é¶æ®µç avgtime å­æ®µï¼æä»¥ä¸è½ç§»å¨ã\n\nmaxtime å mintime å­æ®µè¢« $addfields é¶æ®µæä¾èµï¼ä½èªèº«ä¸ä¾èµå¶ä»ï¼æä»¥ä¼æ°å»ºä¸ä¸ª $match é¶æ®µï¼å¹¶å°å¶ç½®äº $project é¶æ®µä¹åã\n\n# pipeline å¹¶è¡ä¼å\n\nå¦æå¯è½ï¼ä¼åé¶æ®µä¼å° pipeline é¶æ®µåå¹¶å°å¶åèº«ãéå¸¸ï¼åå¹¶åçå¨ä»»æåºåéæ°æåºä¼åä¹åã\n\n# $sort + $limit\n\nå½ $sort å¨ $limit ä¹åæ¶ï¼å¦ææ²¡æä¸­é´é¶æ®µä¿®æ¹ææ¡£æ°éï¼ä¾å¦ $unwindã$groupï¼ï¼åä¼åç¨åºå¯ä»¥å° $limit åå¹¶å° $sort ä¸­ãå¦ææç®¡éé¶æ®µæ´æ¹äº $sort å $limit é¶æ®µä¹é´çææ¡£æ°ï¼å mongodb ä¸ä¼å° $limit åå¹¶å° $sort ä¸­ã\n\nãç¤ºä¾ã$sort + $limit\n\nä¼ååï¼\n\n{ $sort : { age : -1 } },\n{ $project : { age : 1, status : 1, name : 1 } },\n{ $limit: 5 }\n\n\nä¼ååï¼\n\n{\n    \"$sort\" : {\n       \"sortkey\" : {\n          \"age\" : -1\n       },\n       \"limit\" : numberlong(5)\n    }\n},\n{ \"$project\" : {\n         \"age\" : 1,\n         \"status\" : 1,\n         \"name\" : 1\n  }\n}\n\n\n# $limit + $limit\n\nå¦æä¸ä¸ª $limit ç´§éå¦ä¸ä¸ª $limitï¼é£ä¹å®ä»¬å¯ä»¥åå¹¶ä¸ºä¸ã\n\nä¼ååï¼\n\n{ $limit: 100 },\n{ $limit: 10 }\n\n\nä¼ååï¼\n\n{\n  $limit: 10\n}\n\n\n# $skip + $skip\n\nå¦æä¸ä¸ª $skip ç´§éå¦ä¸ä¸ª $skip ï¼é£ä¹å®ä»¬å¯ä»¥åå¹¶ä¸ºä¸ã\n\nä¼ååï¼\n\n{ $skip: 5 },\n{ $skip: 2 }\n\n\nä¼ååï¼\n\n{\n  $skip: 7\n}\n\n\n# $match + $match\n\nå¦æä¸ä¸ª $skip ç´§éå¦ä¸ä¸ª $skip ï¼é£ä¹å®ä»¬å¯ä»¥éè¿ $and åå¹¶ä¸ºä¸ã\n\nä¼ååï¼\n\n{ $match: { year: 2014 } },\n{ $match: { status: \"a\" } }\n\n\nä¼ååï¼\n\n{\n  $match: {\n    $and: [{ year: 2014 }, { status: 'a' }]\n  }\n}\n\n\n# $lookup + $unwind\n\nå¦æä¸ä¸ª $unwind ç´§éå¦ä¸ä¸ª $lookupï¼å¹¶ä¸ $unwind å¨ $lookup ç as å­æ®µä¸è¿è¡æ¶ï¼ä¼åç¨åºå¯ä»¥å° $unwind åå¹¶å° $lookup é¶æ®µãè¿æ ·å¯ä»¥é¿ååå»ºè¾å¤§çä¸­é´ææ¡£ã\n\nä¼ååï¼\n\n{\n  $lookup: {\n    from: \"othercollection\",\n    as: \"resultingarray\",\n    localfield: \"x\",\n    foreignfield: \"y\"\n  }\n},\n{ $unwind: \"$resultingarray\"}\n\n\nä¼ååï¼\n\n{\n  $lookup: {\n    from: \"othercollection\",\n    as: \"resultingarray\",\n    localfield: \"x\",\n    foreignfield: \"y\",\n    unwinding: { preservenullandemptyarrays: false }\n  }\n}\n\n\n\n# pipeline éå¶\n\nç»æéä¸­çæ¯ä¸ªææ¡£åå bson ææ¡£å¤§å°éå¶ï¼å½åä¸º 16 mbï¼\n\npipeline çåå­éå¶ä¸º 100 mbã\n\n\n# map-reduce\n\n> èå pipeline æ¯ map-reduce æä¾æ´å¥½çæ§è½åæ´ä¸è´çæ¥å£ã\n\nmap-reduce æ¯ä¸ç§æ°æ®å¤çèå¼ï¼ç¨äºå°å¤§éæ°æ®æ±æ»ä¸ºæç¨çèåç»æãä¸ºäºæ§è¡ map-reduce æä½ï¼mongodb æä¾äº mapreduce æ°æ®åºå½ä»¤ã\n\n\n\nå¨ä¸é¢çæä½ä¸­ï¼mongodb å° map é¶æ®µåºç¨äºæ¯ä¸ªè¾å¥ documentï¼å³ collection ä¸­ä¸æ¥è¯¢æ¡ä»¶å¹éç documentï¼ã map å½æ°åååºå¤ä¸ªé®-å¼å¯¹ãå¯¹äºå·æå¤ä¸ªå¼çé£äºé®ï¼mongodb åºç¨ reduce é¶æ®µï¼è¯¥é¶æ®µæ¶éå¹¶æ±æ»èåçæ°æ®ãç¶åï¼mongodb å°ç»æå­å¨å¨ collection ä¸­ãå¯éå°ï¼reduce å½æ°çè¾åºå¯ä»¥éè¿ finalize å½æ°æ¥è¿ä¸æ­¥æ±æ»èåç»æã\n\nmongodb ä¸­çææ map-reduce å½æ°é½æ¯ javascriptï¼å¹¶å¨ mongod è¿ç¨ä¸­è¿è¡ã map-reduce æä½å°åä¸ª collection ç document ä½ä¸ºè¾å¥ï¼å¹¶ä¸å¯ä»¥å¨å¼å§ map é¶æ®µä¹åæ§è¡ä»»ææåºåéå¶ã mapreduce å¯ä»¥å° map-reduce æä½çç»æä½ä¸º document è¿åï¼ä¹å¯ä»¥å°ç»æåå¥ collectionã\n\n\n# åä¸ç®çèåæ¹æ³\n\nmongodb æ¯æä¸ä¸åä¸ç®ççèåæä½ï¼\n\n * db.collection.estimateddocumentcount()\n * db.collection.count()\n * db.collection.distinct()\n\nææè¿äºæä½é½æ±æ»äºåä¸ª collection ä¸­ç documentãå°½ç®¡è¿äºæä½æä¾äºå¯¹å¸¸è§èåè¿ç¨çç®åè®¿é®ï¼ä½æ¯å®ä»¬ç¸æ¯èå pipeline å map-reduceï¼ç¼ºå°çµæ´»æ§åä¸°å¯çåè½æ§ã\n\n\n\n\n# sql å mongodb èåå¯¹æ¯\n\nmongodb pipeline æä¾äºè®¸å¤ç­ä»·äº sql ä¸­å¸¸è§èåè¯­å¥çæä½ã\n\nä¸è¡¨æ¦è¿°äºå¸¸è§ç sql èåè¯­å¥æå½æ°å mongodb èåæä½çæ å°è¡¨ï¼\n\nsql terms, functions, and concepts   mongodb aggregation operators\nwhere                                $match\ngroup by                             $group\nhaving                               $match\nselect                               $project\norder by                             $sort\nlimit                                $limit\nsum()                                $sum\ncount()                              $sum$sortbycount\njoin                                 $lookup\nselect into new_table                $out\nmerge into table                     $merge (available starting in mongodb 4.2)\nunion all                            $unionwith (available starting in mongodb 4.4)\n\nãç¤ºä¾ã\n\ndb.orders.insertmany([\n  {\n    _id: 1,\n    cust_id: 'ant o. knee',\n    ord_date: new date('2020-03-01'),\n    price: 25,\n    items: [\n      { sku: 'oranges', qty: 5, price: 2.5 },\n      { sku: 'apples', qty: 5, price: 2.5 }\n    ],\n    status: 'a'\n  },\n  {\n    _id: 2,\n    cust_id: 'ant o. knee',\n    ord_date: new date('2020-03-08'),\n    price: 70,\n    items: [\n      { sku: 'oranges', qty: 8, price: 2.5 },\n      { sku: 'chocolates', qty: 5, price: 10 }\n    ],\n    status: 'a'\n  },\n  {\n    _id: 3,\n    cust_id: 'busby bee',\n    ord_date: new date('2020-03-08'),\n    price: 50,\n    items: [\n      { sku: 'oranges', qty: 10, price: 2.5 },\n      { sku: 'pears', qty: 10, price: 2.5 }\n    ],\n    status: 'a'\n  },\n  {\n    _id: 4,\n    cust_id: 'busby bee',\n    ord_date: new date('2020-03-18'),\n    price: 25,\n    items: [{ sku: 'oranges', qty: 10, price: 2.5 }],\n    status: 'a'\n  },\n  {\n    _id: 5,\n    cust_id: 'busby bee',\n    ord_date: new date('2020-03-19'),\n    price: 50,\n    items: [{ sku: 'chocolates', qty: 5, price: 10 }],\n    status: 'a'\n  },\n  {\n    _id: 6,\n    cust_id: 'cam elot',\n    ord_date: new date('2020-03-19'),\n    price: 35,\n    items: [\n      { sku: 'carrots', qty: 10, price: 1.0 },\n      { sku: 'apples', qty: 10, price: 2.5 }\n    ],\n    status: 'a'\n  },\n  {\n    _id: 7,\n    cust_id: 'cam elot',\n    ord_date: new date('2020-03-20'),\n    price: 25,\n    items: [{ sku: 'oranges', qty: 10, price: 2.5 }],\n    status: 'a'\n  },\n  {\n    _id: 8,\n    cust_id: 'don quis',\n    ord_date: new date('2020-03-20'),\n    price: 75,\n    items: [\n      { sku: 'chocolates', qty: 5, price: 10 },\n      { sku: 'apples', qty: 10, price: 2.5 }\n    ],\n    status: 'a'\n  },\n  {\n    _id: 9,\n    cust_id: 'don quis',\n    ord_date: new date('2020-03-20'),\n    price: 55,\n    items: [\n      { sku: 'carrots', qty: 5, price: 1.0 },\n      { sku: 'apples', qty: 10, price: 2.5 },\n      { sku: 'oranges', qty: 10, price: 2.5 }\n    ],\n    status: 'a'\n  },\n  {\n    _id: 10,\n    cust_id: 'don quis',\n    ord_date: new date('2020-03-23'),\n    price: 25,\n    items: [{ sku: 'oranges', qty: 10, price: 2.5 }],\n    status: 'a'\n  }\n])\n\n\nsql å mongodb èåæ¹å¼å¯¹æ¯ï¼\n\n\n\n\n# åèèµæ\n\n * å®æ¹\n   * mongodb å®ç½\n   * mongodb github\n   * mongodb å®æ¹åè´¹æç¨\n * æç¨\n   * mongodb æç¨\n   * mongodb é«æè¯¾",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"MongoDB ç CRUD æä½",frontmatter:{title:"MongoDB ç CRUD æä½",date:"2020-09-25T21:23:41.000Z",categories:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],tags:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],permalink:"/pages/7efbac/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/04.%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/01.MongoDB/02.MongoDB%E7%9A%84CRUD%E6%93%8D%E4%BD%9C.html",relativePath:"12.æ°æ®åº/04.ææ¡£æ°æ®åº/01.MongoDB/02.MongoDBçCRUDæä½.md",key:"v-62ac19f1",path:"/pages/7efbac/",headers:[{level:2,title:"ä¸ãåºæ¬ CRUD æä½",slug:"ä¸ãåºæ¬-crud-æä½",normalizedTitle:"ä¸ãåºæ¬ crud æä½",charIndex:24},{level:3,title:"Create æä½",slug:"create-æä½",normalizedTitle:"create æä½",charIndex:79},{level:3,title:"Read æä½",slug:"read-æä½",normalizedTitle:"read æä½",charIndex:983},{level:3,title:"Update æä½",slug:"update-æä½",normalizedTitle:"update æä½",charIndex:1046},{level:3,title:"Delete æä½",slug:"delete-æä½",normalizedTitle:"delete æä½",charIndex:3207},{level:2,title:"äºãæ¹éåæä½",slug:"äºãæ¹éåæä½",normalizedTitle:"äºãæ¹éåæä½",charIndex:3397},{level:3,title:"æåºåæ åºçæä½",slug:"æåºåæ åºçæä½",normalizedTitle:"æåºåæ åºçæä½",charIndex:3516},{level:3,title:"bulkWrite() æ¹æ³",slug:"bulkwrite-æ¹æ³",normalizedTitle:"bulkwrite() æ¹æ³",charIndex:3431},{level:3,title:"æ¹éåæä½ç­ç¥",slug:"æ¹éåæä½ç­ç¥",normalizedTitle:"æ¹éåæä½ç­ç¥",charIndex:4653},{level:4,title:"é¢æå collection",slug:"é¢æå-collection",normalizedTitle:"é¢æå collection",charIndex:4718},{level:4,title:"æ åºåæä½",slug:"æ åºåæä½",normalizedTitle:"æ åºåæä½",charIndex:3767},{level:4,title:"é¿ååè°èæµ",slug:"é¿ååè°èæµ",normalizedTitle:"é¿ååè°èæµ",charIndex:4996},{level:2,title:"SQL å MongoDB å¯¹æ¯",slug:"sql-å-mongodb-å¯¹æ¯",normalizedTitle:"sql å mongodb å¯¹æ¯",charIndex:5236},{level:3,title:"æ¯è¯­åæ¦å¿µ",slug:"æ¯è¯­åæ¦å¿µ",normalizedTitle:"æ¯è¯­åæ¦å¿µ",charIndex:5257},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:6095}],headersStr:"ä¸ãåºæ¬ CRUD æä½ Create æä½ Read æä½ Update æä½ Delete æä½ äºãæ¹éåæä½ æåºåæ åºçæä½ bulkWrite() æ¹æ³ æ¹éåæä½ç­ç¥ é¢æå collection æ åºåæä½ é¿ååè°èæµ SQL å MongoDB å¯¹æ¯ æ¯è¯­åæ¦å¿µ åèèµæ",content:"# MongoDB ç CRUD æä½\n\n\n# ä¸ãåºæ¬ CRUD æä½\n\nMongoDB ç CRUD æä½æ¯éå¯¹ document çè¯»åæä½ã\n\n\n# Create æä½\n\nMongoDB æä¾ä»¥ä¸æä½åä¸ä¸ª collection æå¥ document\n\n * db.collection.insertOne()ï¼æå¥ä¸æ¡ document\n * db.collection.insertMany()ï¼æå¥å¤æ¡ document\n\n> æ³¨ï¼ä»¥ä¸æä½é½æ¯åå­æä½ã\n\n\n\næå¥æä½çç¹æ§ï¼\n\n * MongoDB ä¸­çææåæä½é½æ¯åä¸ªææ¡£çº§å«çåå­æä½ã\n * å¦æè¦æå¥ç collection å½åä¸å­å¨ï¼åæå¥æä½ä¼èªå¨åå»º collectionã\n * å¨ MongoDB ä¸­ï¼å­å¨å¨éåä¸­çæ¯ä¸ªææ¡£é½éè¦ä¸ä¸ªå¯ä¸ç _id å­æ®µä½ä¸ºä¸»é®ãå¦ææå¥çææ¡£çç¥ _id å­æ®µï¼å MongoDB é©±å¨ç¨åºä¼èªå¨ä¸º _id å­æ®µçæ ObjectIdã\n * å¯ä»¥ MongoDB åå¥æä½çç¡®è®¤çº§å«æ¥æ§å¶åå¥è¡ä¸ºã\n\nãç¤ºä¾ãæå¥ä¸æ¡ document ç¤ºä¾\n\ndb.inventory.insertOne({\n  item: 'canvas',\n  qty: 100,\n  tags: ['cotton'],\n  size: { h: 28, w: 35.5, uom: 'cm' }\n})\n\n\nãç¤ºä¾ãæå¥å¤æ¡ document ç¤ºä¾\n\ndb.inventory.insertMany([\n  {\n    item: 'journal',\n    qty: 25,\n    tags: ['blank', 'red'],\n    size: { h: 14, w: 21, uom: 'cm' }\n  },\n  {\n    item: 'mat',\n    qty: 85,\n    tags: ['gray'],\n    size: { h: 27.9, w: 35.5, uom: 'cm' }\n  },\n  {\n    item: 'mousepad',\n    qty: 25,\n    tags: ['gel', 'blue'],\n    size: { h: 19, w: 22.85, uom: 'cm' }\n  }\n])\n\n\n\n# Read æä½\n\nMongoDB æä¾ db.collection.find() æ¹æ³æ¥æ£ç´¢ documentã\n\n\n\n\n# Update æä½\n\nMongoDB æä¾ä»¥ä¸æä½æ¥æ´æ° collection ä¸­ç document\n\n * db.collection.updateOne()ï¼æ´æ°ä¸æ¡ document\n * db.collection.updateMany()ï¼æ´æ°å¤æ¡ document\n * db.collection.replaceOne()ï¼æ¿æ¢ä¸æ¡ document\n\nè¯­æ³æ ¼å¼ï¼\n\n * db.collection.updateOne(<filter>, <update>, <options>)\n * db.collection.updateMany(<filter>, <update>, <options>)\n * db.collection.replaceOne(<filter>, <update>, <options>)\n\n\n\nãç¤ºä¾ãæå¥æµè¯æ°æ®\n\ndb.inventory.insertMany([\n  {\n    item: 'canvas',\n    qty: 100,\n    size: { h: 28, w: 35.5, uom: 'cm' },\n    status: 'A'\n  },\n  { item: 'journal', qty: 25, size: { h: 14, w: 21, uom: 'cm' }, status: 'A' },\n  { item: 'mat', qty: 85, size: { h: 27.9, w: 35.5, uom: 'cm' }, status: 'A' },\n  {\n    item: 'mousepad',\n    qty: 25,\n    size: { h: 19, w: 22.85, uom: 'cm' },\n    status: 'P'\n  },\n  {\n    item: 'notebook',\n    qty: 50,\n    size: { h: 8.5, w: 11, uom: 'in' },\n    status: 'P'\n  },\n  { item: 'paper', qty: 100, size: { h: 8.5, w: 11, uom: 'in' }, status: 'D' },\n  {\n    item: 'planner',\n    qty: 75,\n    size: { h: 22.85, w: 30, uom: 'cm' },\n    status: 'D'\n  },\n  {\n    item: 'postcard',\n    qty: 45,\n    size: { h: 10, w: 15.25, uom: 'cm' },\n    status: 'A'\n  },\n  {\n    item: 'sketchbook',\n    qty: 80,\n    size: { h: 14, w: 21, uom: 'cm' },\n    status: 'A'\n  },\n  {\n    item: 'sketch pad',\n    qty: 95,\n    size: { h: 22.85, w: 30.5, uom: 'cm' },\n    status: 'A'\n  }\n])\n\n\nãç¤ºä¾ãæ´æ°ä¸æ¡ document\n\ndb.inventory.updateOne(\n  { item: 'paper' },\n  {\n    $set: { 'size.uom': 'cm', status: 'P' },\n    $currentDate: { lastModified: true }\n  }\n)\n\n\nãç¤ºä¾ãæ´æ°å¤æ¡ document\n\ndb.inventory.updateMany(\n  { qty: { $lt: 50 } },\n  {\n    $set: { 'size.uom': 'in', status: 'P' },\n    $currentDate: { lastModified: true }\n  }\n)\n\n\nãç¤ºä¾ãæ¿æ¢ä¸æ¡ document\n\ndb.inventory.replaceOne(\n  { item: 'paper' },\n  {\n    item: 'paper',\n    instock: [\n      { warehouse: 'A', qty: 60 },\n      { warehouse: 'B', qty: 40 }\n    ]\n  }\n)\n\n\næ´æ°æä½çç¹æ§ï¼\n\n * MongoDB ä¸­çææåæä½é½æ¯åä¸ªææ¡£çº§å«çåå­æä½ã\n * ä¸æ¦è®¾ç½®äºï¼å°±æ æ³æ´æ°ææ¿æ¢ _id å­æ®µã\n * é¤ä»¥ä¸æåµå¤ï¼MongoDB ä¼å¨æ§è¡åæä½åä¿çææ¡£å­æ®µçé¡ºåºï¼\n   * _id å­æ®µå§ç»æ¯ææ¡£ä¸­çç¬¬ä¸ä¸ªå­æ®µã\n   * åæ¬éå½åå­æ®µåç§°çæ´æ°å¯è½å¯¼è´ææ¡£ä¸­å­æ®µçéæ°æåºã\n * å¦ææ´æ°æä½ä¸­åå« upsert : true å¹¶ä¸æ²¡æ document å¹éè¿æ»¤å¨ï¼MongoDB ä¼æ°æå¥ä¸ä¸ª documentï¼å¦ææå¹éç documentï¼MongoDB ä¼ä¿®æ¹ææ¿æ¢è¿äº documentã\n\n\n# Delete æä½\n\nMongoDB æä¾ä»¥ä¸æä½æ¥å é¤ collection ä¸­ç document\n\n * db.collection.deleteOne()ï¼å é¤ä¸æ¡ document\n * db.collection.deleteMany()ï¼å é¤å¤æ¡ document\n\n\n\nå é¤æä½çç¹æ§ï¼\n\n * MongoDB ä¸­çææåæä½é½æ¯åä¸ªææ¡£çº§å«çåå­æä½ã\n\n\n# äºãæ¹éåæä½\n\nMongoDB éè¿ db.collection.bulkWrite() æ¹æ³æ¥æ¯ææ¹éåæä½ï¼åæ¬æ¹éæå¥ãæ´æ°ãå é¤ï¼ã\n\næ­¤å¤ï¼db.collection.insertMany() æ¹æ³æ¯ææ¹éæå¥æä½ã\n\n\n# æåºåæ åºçæä½\n\næ¹éåæä½å¯ä»¥æåºææ åºã\n\n * å¯¹äºæåºåè¡¨ï¼MongoDB ä¸²è¡æ§è¡æä½ãå¦æå¨åæä½çå¤çè¿ç¨ä¸­åçéè¯¯ï¼MongoDB å°ä¸å¤çåè¡¨ä¸­å©ä½çåæä½ã\n * å¯¹äºæ åºåè¡¨ï¼MongoDB å¯ä»¥å¹¶è¡æ§è¡æä½ï¼ä½æ¯ä¸è½ä¿è¯æ­¤è¡ä¸ºãå¦æå¨åæä½çå¤çè¿ç¨ä¸­åçéè¯¯ï¼MongoDB å°ç»§ç»­å¤çåè¡¨ä¸­å©ä½çåæä½ã\n\nå¨åçéåä¸æ§è¡æä½çæåºåè¡¨éå¸¸æ¯æ§è¡æ åºåè¡¨è¦æ¢ï¼å ä¸ºå¯¹äºæåºåè¡¨ï¼æ¯ä¸ªæä½å¿é¡»ç­å¾ä¸ä¸ä¸ªæä½å®æã\n\né»è®¤æåµä¸ï¼bulkWrite() æ§è¡æåºæä½ãè¦æå®æ åºåæä½ï¼è¯·å¨éé¡¹ææ¡£ä¸­è®¾ç½® ordered : falseã\n\n\n# bulkWrite() æ¹æ³\n\nbulkWrite() æ¯æä»¥ä¸åæä½ï¼\n\n * insertOne\n * updateOne\n * updateMany\n * replaceOne\n * deleteOne\n * deleteMany\n\nãç¤ºä¾ãæ¹éåæä½ç¤ºä¾\n\ntry {\n  db.characters.bulkWrite([\n    {\n      insertOne: {\n        document: {\n          _id: 4,\n          char: 'Dithras',\n          class: 'barbarian',\n          lvl: 4\n        }\n      }\n    },\n    {\n      insertOne: {\n        document: {\n          _id: 5,\n          char: 'Taeln',\n          class: 'fighter',\n          lvl: 3\n        }\n      }\n    },\n    {\n      updateOne: {\n        filter: { char: 'Eldon' },\n        update: { $set: { status: 'Critical Injury' } }\n      }\n    },\n    { deleteOne: { filter: { char: 'Brisbane' } } },\n    {\n      replaceOne: {\n        filter: { char: 'Meldane' },\n        replacement: { char: 'Tanys', class: 'oracle', lvl: 4 }\n      }\n    }\n  ])\n} catch (e) {\n  print(e)\n}\n\n\n\n# æ¹éåæä½ç­ç¥\n\nå¤§éçæå¥æä½ï¼åæ¬åå§æ°æ®æå¥æå¸¸è§æ°æ®å¯¼å¥ï¼å¯è½ä¼å½±ååçéç¾¤çæ§è½ãå¯¹äºæ¹éæå¥ï¼è¯·èèä»¥ä¸ç­ç¥ï¼\n\n# é¢æå collection\n\nå¦æåçéåä¸ºç©ºï¼åè¯¥éååªæä¸ä¸ªåå§ chunkï¼è¯¥ chunk ä½äºåä¸ªåçä¸ãç¶åï¼MongoDB å¿é¡»è±ä¸äºæ¶é´æ¥æ¥æ¶æ°æ®ï¼åå»ºæåå¹¶å°æåçåååå°å¯ç¨çåçãä¸ºäºé¿åè¿ç§æ§è½ææ¬ï¼æ¨å¯ä»¥æç§æåç¾¤éä¸­çæååä¸­çè¯´æé¢æå collectionã\n\n# æ åºåæä½\n\nè¦æé«å¯¹åçéç¾¤çåå¥æ§è½ï¼è¯·ä½¿ç¨ bulkWrite()ï¼å¹¶å°å¯éåæ°é¡ºåºè®¾ç½®ä¸º falseãmongos å¯ä»¥å°è¯åæ¶å°åå¥æä½åéå°å¤ä¸ªåçãå¯¹äºç©ºéåï¼é¦åæç§åçç¾¤éä¸­çåå² chunk ä¸­çè¯´æé¢æå collectionã\n\n# é¿ååè°èæµ\n\nå¦æå¨ä¸æ¬¡æå¥æä½ä¸­ï¼åç key åè°éå¢ï¼é£ä¹ææçæå¥æ°æ®é½ä¼å­å¥ collection çæåä¸ä¸ª chunkï¼ä¹å°±æ¯å­å¥ä¸ä¸ªåçä¸­ãå æ­¤ï¼éç¾¤çæå¥å®¹éå°æ°¸è¿ä¸ä¼è¶è¿è¯¥åä¸ªåççæå¥å®¹éã\n\nå¦ææå¥éå¤§äºåä¸ªåçå¯ä»¥å¤ççæå¥éï¼å¹¶ä¸æ æ³é¿ååè°éå¢çåçé®ï¼é£ä¹è¯·èèå¯¹åºç¨ç¨åºè¿è¡ä»¥ä¸ä¿®æ¹ï¼\n\n * åè½¬åçå¯é¥çäºè¿å¶ä½ãè¿æ ·å¯ä»¥ä¿çä¿¡æ¯ï¼å¹¶é¿åå°æå¥é¡ºåºä¸å¼åºåçå¢å å³èèµ·æ¥ã\n * äº¤æ¢ç¬¬ä¸ä¸ªåæåä¸ä¸ª 16 ä½å­ä»¥âéæºâæå¥ã\n\n\n# SQL å MongoDB å¯¹æ¯\n\n\n# æ¯è¯­åæ¦å¿µ\n\nSQL æ¯è¯­åæ¦å¿µ                     MONGODB æ¯è¯­åæ¦å¿µ\ndatabase                      database\ntable                         collection\nrow                           document æ BSON\ncolumn                        field\nindex                         index\ntable joins                   $lookupãåµå¥å¼ææ¡£\nprimary key                   primary key\n                              MongoDB ä¸­èªå¨è®¾ç½®ä¸»é®ä¸º _id å­æ®µ\naggregation (e.g. group by)   aggregation pipeline\n                              åè SQL to Aggregation Mapping Chart.\nSELECT INTO NEW_TABLE         $out\n                              åè SQL to Aggregation Mapping Chart\nMERGE INTO TABLE              $merge (MongoDB 4.2 å¼å§æ¯æ)\n                              åè SQL to Aggregation Mapping Chart.\nUNION ALL                     $unionWith (MongoDB 4.4 å¼å§æ¯æ)\ntransactions                  transactions\n\n\n# åèèµæ\n\n * å®æ¹\n   * MongoDB å®ç½\n   * MongoDB Github\n   * MongoDB å®æ¹åè´¹æç¨\n * æç¨\n   * MongoDB æç¨\n   * MongoDB é«æè¯¾",normalizedContent:"# mongodb ç crud æä½\n\n\n# ä¸ãåºæ¬ crud æä½\n\nmongodb ç crud æä½æ¯éå¯¹ document çè¯»åæä½ã\n\n\n# create æä½\n\nmongodb æä¾ä»¥ä¸æä½åä¸ä¸ª collection æå¥ document\n\n * db.collection.insertone()ï¼æå¥ä¸æ¡ document\n * db.collection.insertmany()ï¼æå¥å¤æ¡ document\n\n> æ³¨ï¼ä»¥ä¸æä½é½æ¯åå­æä½ã\n\n\n\næå¥æä½çç¹æ§ï¼\n\n * mongodb ä¸­çææåæä½é½æ¯åä¸ªææ¡£çº§å«çåå­æä½ã\n * å¦æè¦æå¥ç collection å½åä¸å­å¨ï¼åæå¥æä½ä¼èªå¨åå»º collectionã\n * å¨ mongodb ä¸­ï¼å­å¨å¨éåä¸­çæ¯ä¸ªææ¡£é½éè¦ä¸ä¸ªå¯ä¸ç _id å­æ®µä½ä¸ºä¸»é®ãå¦ææå¥çææ¡£çç¥ _id å­æ®µï¼å mongodb é©±å¨ç¨åºä¼èªå¨ä¸º _id å­æ®µçæ objectidã\n * å¯ä»¥ mongodb åå¥æä½çç¡®è®¤çº§å«æ¥æ§å¶åå¥è¡ä¸ºã\n\nãç¤ºä¾ãæå¥ä¸æ¡ document ç¤ºä¾\n\ndb.inventory.insertone({\n  item: 'canvas',\n  qty: 100,\n  tags: ['cotton'],\n  size: { h: 28, w: 35.5, uom: 'cm' }\n})\n\n\nãç¤ºä¾ãæå¥å¤æ¡ document ç¤ºä¾\n\ndb.inventory.insertmany([\n  {\n    item: 'journal',\n    qty: 25,\n    tags: ['blank', 'red'],\n    size: { h: 14, w: 21, uom: 'cm' }\n  },\n  {\n    item: 'mat',\n    qty: 85,\n    tags: ['gray'],\n    size: { h: 27.9, w: 35.5, uom: 'cm' }\n  },\n  {\n    item: 'mousepad',\n    qty: 25,\n    tags: ['gel', 'blue'],\n    size: { h: 19, w: 22.85, uom: 'cm' }\n  }\n])\n\n\n\n# read æä½\n\nmongodb æä¾ db.collection.find() æ¹æ³æ¥æ£ç´¢ documentã\n\n\n\n\n# update æä½\n\nmongodb æä¾ä»¥ä¸æä½æ¥æ´æ° collection ä¸­ç document\n\n * db.collection.updateone()ï¼æ´æ°ä¸æ¡ document\n * db.collection.updatemany()ï¼æ´æ°å¤æ¡ document\n * db.collection.replaceone()ï¼æ¿æ¢ä¸æ¡ document\n\nè¯­æ³æ ¼å¼ï¼\n\n * db.collection.updateone(<filter>, <update>, <options>)\n * db.collection.updatemany(<filter>, <update>, <options>)\n * db.collection.replaceone(<filter>, <update>, <options>)\n\n\n\nãç¤ºä¾ãæå¥æµè¯æ°æ®\n\ndb.inventory.insertmany([\n  {\n    item: 'canvas',\n    qty: 100,\n    size: { h: 28, w: 35.5, uom: 'cm' },\n    status: 'a'\n  },\n  { item: 'journal', qty: 25, size: { h: 14, w: 21, uom: 'cm' }, status: 'a' },\n  { item: 'mat', qty: 85, size: { h: 27.9, w: 35.5, uom: 'cm' }, status: 'a' },\n  {\n    item: 'mousepad',\n    qty: 25,\n    size: { h: 19, w: 22.85, uom: 'cm' },\n    status: 'p'\n  },\n  {\n    item: 'notebook',\n    qty: 50,\n    size: { h: 8.5, w: 11, uom: 'in' },\n    status: 'p'\n  },\n  { item: 'paper', qty: 100, size: { h: 8.5, w: 11, uom: 'in' }, status: 'd' },\n  {\n    item: 'planner',\n    qty: 75,\n    size: { h: 22.85, w: 30, uom: 'cm' },\n    status: 'd'\n  },\n  {\n    item: 'postcard',\n    qty: 45,\n    size: { h: 10, w: 15.25, uom: 'cm' },\n    status: 'a'\n  },\n  {\n    item: 'sketchbook',\n    qty: 80,\n    size: { h: 14, w: 21, uom: 'cm' },\n    status: 'a'\n  },\n  {\n    item: 'sketch pad',\n    qty: 95,\n    size: { h: 22.85, w: 30.5, uom: 'cm' },\n    status: 'a'\n  }\n])\n\n\nãç¤ºä¾ãæ´æ°ä¸æ¡ document\n\ndb.inventory.updateone(\n  { item: 'paper' },\n  {\n    $set: { 'size.uom': 'cm', status: 'p' },\n    $currentdate: { lastmodified: true }\n  }\n)\n\n\nãç¤ºä¾ãæ´æ°å¤æ¡ document\n\ndb.inventory.updatemany(\n  { qty: { $lt: 50 } },\n  {\n    $set: { 'size.uom': 'in', status: 'p' },\n    $currentdate: { lastmodified: true }\n  }\n)\n\n\nãç¤ºä¾ãæ¿æ¢ä¸æ¡ document\n\ndb.inventory.replaceone(\n  { item: 'paper' },\n  {\n    item: 'paper',\n    instock: [\n      { warehouse: 'a', qty: 60 },\n      { warehouse: 'b', qty: 40 }\n    ]\n  }\n)\n\n\næ´æ°æä½çç¹æ§ï¼\n\n * mongodb ä¸­çææåæä½é½æ¯åä¸ªææ¡£çº§å«çåå­æä½ã\n * ä¸æ¦è®¾ç½®äºï¼å°±æ æ³æ´æ°ææ¿æ¢ _id å­æ®µã\n * é¤ä»¥ä¸æåµå¤ï¼mongodb ä¼å¨æ§è¡åæä½åä¿çææ¡£å­æ®µçé¡ºåºï¼\n   * _id å­æ®µå§ç»æ¯ææ¡£ä¸­çç¬¬ä¸ä¸ªå­æ®µã\n   * åæ¬éå½åå­æ®µåç§°çæ´æ°å¯è½å¯¼è´ææ¡£ä¸­å­æ®µçéæ°æåºã\n * å¦ææ´æ°æä½ä¸­åå« upsert : true å¹¶ä¸æ²¡æ document å¹éè¿æ»¤å¨ï¼mongodb ä¼æ°æå¥ä¸ä¸ª documentï¼å¦ææå¹éç documentï¼mongodb ä¼ä¿®æ¹ææ¿æ¢è¿äº documentã\n\n\n# delete æä½\n\nmongodb æä¾ä»¥ä¸æä½æ¥å é¤ collection ä¸­ç document\n\n * db.collection.deleteone()ï¼å é¤ä¸æ¡ document\n * db.collection.deletemany()ï¼å é¤å¤æ¡ document\n\n\n\nå é¤æä½çç¹æ§ï¼\n\n * mongodb ä¸­çææåæä½é½æ¯åä¸ªææ¡£çº§å«çåå­æä½ã\n\n\n# äºãæ¹éåæä½\n\nmongodb éè¿ db.collection.bulkwrite() æ¹æ³æ¥æ¯ææ¹éåæä½ï¼åæ¬æ¹éæå¥ãæ´æ°ãå é¤ï¼ã\n\næ­¤å¤ï¼db.collection.insertmany() æ¹æ³æ¯ææ¹éæå¥æä½ã\n\n\n# æåºåæ åºçæä½\n\næ¹éåæä½å¯ä»¥æåºææ åºã\n\n * å¯¹äºæåºåè¡¨ï¼mongodb ä¸²è¡æ§è¡æä½ãå¦æå¨åæä½çå¤çè¿ç¨ä¸­åçéè¯¯ï¼mongodb å°ä¸å¤çåè¡¨ä¸­å©ä½çåæä½ã\n * å¯¹äºæ åºåè¡¨ï¼mongodb å¯ä»¥å¹¶è¡æ§è¡æä½ï¼ä½æ¯ä¸è½ä¿è¯æ­¤è¡ä¸ºãå¦æå¨åæä½çå¤çè¿ç¨ä¸­åçéè¯¯ï¼mongodb å°ç»§ç»­å¤çåè¡¨ä¸­å©ä½çåæä½ã\n\nå¨åçéåä¸æ§è¡æä½çæåºåè¡¨éå¸¸æ¯æ§è¡æ åºåè¡¨è¦æ¢ï¼å ä¸ºå¯¹äºæåºåè¡¨ï¼æ¯ä¸ªæä½å¿é¡»ç­å¾ä¸ä¸ä¸ªæä½å®æã\n\né»è®¤æåµä¸ï¼bulkwrite() æ§è¡æåºæä½ãè¦æå®æ åºåæä½ï¼è¯·å¨éé¡¹ææ¡£ä¸­è®¾ç½® ordered : falseã\n\n\n# bulkwrite() æ¹æ³\n\nbulkwrite() æ¯æä»¥ä¸åæä½ï¼\n\n * insertone\n * updateone\n * updatemany\n * replaceone\n * deleteone\n * deletemany\n\nãç¤ºä¾ãæ¹éåæä½ç¤ºä¾\n\ntry {\n  db.characters.bulkwrite([\n    {\n      insertone: {\n        document: {\n          _id: 4,\n          char: 'dithras',\n          class: 'barbarian',\n          lvl: 4\n        }\n      }\n    },\n    {\n      insertone: {\n        document: {\n          _id: 5,\n          char: 'taeln',\n          class: 'fighter',\n          lvl: 3\n        }\n      }\n    },\n    {\n      updateone: {\n        filter: { char: 'eldon' },\n        update: { $set: { status: 'critical injury' } }\n      }\n    },\n    { deleteone: { filter: { char: 'brisbane' } } },\n    {\n      replaceone: {\n        filter: { char: 'meldane' },\n        replacement: { char: 'tanys', class: 'oracle', lvl: 4 }\n      }\n    }\n  ])\n} catch (e) {\n  print(e)\n}\n\n\n\n# æ¹éåæä½ç­ç¥\n\nå¤§éçæå¥æä½ï¼åæ¬åå§æ°æ®æå¥æå¸¸è§æ°æ®å¯¼å¥ï¼å¯è½ä¼å½±ååçéç¾¤çæ§è½ãå¯¹äºæ¹éæå¥ï¼è¯·èèä»¥ä¸ç­ç¥ï¼\n\n# é¢æå collection\n\nå¦æåçéåä¸ºç©ºï¼åè¯¥éååªæä¸ä¸ªåå§ chunkï¼è¯¥ chunk ä½äºåä¸ªåçä¸ãç¶åï¼mongodb å¿é¡»è±ä¸äºæ¶é´æ¥æ¥æ¶æ°æ®ï¼åå»ºæåå¹¶å°æåçåååå°å¯ç¨çåçãä¸ºäºé¿åè¿ç§æ§è½ææ¬ï¼æ¨å¯ä»¥æç§æåç¾¤éä¸­çæååä¸­çè¯´æé¢æå collectionã\n\n# æ åºåæä½\n\nè¦æé«å¯¹åçéç¾¤çåå¥æ§è½ï¼è¯·ä½¿ç¨ bulkwrite()ï¼å¹¶å°å¯éåæ°é¡ºåºè®¾ç½®ä¸º falseãmongos å¯ä»¥å°è¯åæ¶å°åå¥æä½åéå°å¤ä¸ªåçãå¯¹äºç©ºéåï¼é¦åæç§åçç¾¤éä¸­çåå² chunk ä¸­çè¯´æé¢æå collectionã\n\n# é¿ååè°èæµ\n\nå¦æå¨ä¸æ¬¡æå¥æä½ä¸­ï¼åç key åè°éå¢ï¼é£ä¹ææçæå¥æ°æ®é½ä¼å­å¥ collection çæåä¸ä¸ª chunkï¼ä¹å°±æ¯å­å¥ä¸ä¸ªåçä¸­ãå æ­¤ï¼éç¾¤çæå¥å®¹éå°æ°¸è¿ä¸ä¼è¶è¿è¯¥åä¸ªåççæå¥å®¹éã\n\nå¦ææå¥éå¤§äºåä¸ªåçå¯ä»¥å¤ççæå¥éï¼å¹¶ä¸æ æ³é¿ååè°éå¢çåçé®ï¼é£ä¹è¯·èèå¯¹åºç¨ç¨åºè¿è¡ä»¥ä¸ä¿®æ¹ï¼\n\n * åè½¬åçå¯é¥çäºè¿å¶ä½ãè¿æ ·å¯ä»¥ä¿çä¿¡æ¯ï¼å¹¶é¿åå°æå¥é¡ºåºä¸å¼åºåçå¢å å³èèµ·æ¥ã\n * äº¤æ¢ç¬¬ä¸ä¸ªåæåä¸ä¸ª 16 ä½å­ä»¥âéæºâæå¥ã\n\n\n# sql å mongodb å¯¹æ¯\n\n\n# æ¯è¯­åæ¦å¿µ\n\nsql æ¯è¯­åæ¦å¿µ                     mongodb æ¯è¯­åæ¦å¿µ\ndatabase                      database\ntable                         collection\nrow                           document æ bson\ncolumn                        field\nindex                         index\ntable joins                   $lookupãåµå¥å¼ææ¡£\nprimary key                   primary key\n                              mongodb ä¸­èªå¨è®¾ç½®ä¸»é®ä¸º _id å­æ®µ\naggregation (e.g. group by)   aggregation pipeline\n                              åè sql to aggregation mapping chart.\nselect into new_table         $out\n                              åè sql to aggregation mapping chart\nmerge into table              $merge (mongodb 4.2 å¼å§æ¯æ)\n                              åè sql to aggregation mapping chart.\nunion all                     $unionwith (mongodb 4.4 å¼å§æ¯æ)\ntransactions                  transactions\n\n\n# åèèµæ\n\n * å®æ¹\n   * mongodb å®ç½\n   * mongodb github\n   * mongodb å®æ¹åè´¹æç¨\n * æç¨\n   * mongodb æç¨\n   * mongodb é«æè¯¾",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"MongoDB äºå¡",frontmatter:{title:"MongoDB äºå¡",date:"2020-09-20T23:12:17.000Z",categories:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],tags:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB","äºå¡"],permalink:"/pages/4574fe/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/04.%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/01.MongoDB/04.MongoDB%E4%BA%8B%E5%8A%A1.html",relativePath:"12.æ°æ®åº/04.ææ¡£æ°æ®åº/01.MongoDB/04.MongoDBäºå¡.md",key:"v-f8f28ef4",path:"/pages/4574fe/",headersStr:null,content:"# MongoDB äºå¡\n\nwriteConcern å¯ä»¥å³å®åæä½å°è¾¾å¤å°ä¸ªèç¹æç®æåã\n\n * é»è®¤ï¼å¤èç¹å¤å¶éä¸åä»»ä½è®¾å®ï¼æä»¥æ¯æå¯è½ä¸¢å¤±æ°æ®ã\n * w: \"majority\"ï¼å¤§é¨åèç¹ç¡®è®¤ï¼å°±è§ä¸ºåæå\n * w: \"all\"ï¼å¨é¨èç¹ç¡®è®¤ï¼æè§ä¸ºåæå\n\njournal åå®ä¹å¦ä½æç®æåãåå¼åæ¬ï¼\n\n * trueï¼åæä½è½å° journal æä»¶ä¸­æç®æåï¼\n * falseï¼åæä½è¾¾å°åå­å³ç®ä½æåã\n\nãç¤ºä¾ãå¨éç¾¤ä¸­ä½¿ç¨ writeConcern åæ°\n\ndb.transaction.insert({ count: 1 }, { writeConcern: { w: 'majoriy' } })\ndb.transaction.insert({ count: 1 }, { writeConcern: { w: '4' } })\ndb.transaction.insert({ count: 1 }, { writeConcern: { w: 'all' } })\n\n\nãç¤ºä¾ãéç½®å»¶è¿èç¹ï¼æ¨¡æç½ç»å»¶è¿\n\nconf=rs.conf()\nconf.memebers[2].slaveDelay=5\nconf.memebers[2].priority=0\nrs.reconfig(conf)\n",normalizedContent:"# mongodb äºå¡\n\nwriteconcern å¯ä»¥å³å®åæä½å°è¾¾å¤å°ä¸ªèç¹æç®æåã\n\n * é»è®¤ï¼å¤èç¹å¤å¶éä¸åä»»ä½è®¾å®ï¼æä»¥æ¯æå¯è½ä¸¢å¤±æ°æ®ã\n * w: \"majority\"ï¼å¤§é¨åèç¹ç¡®è®¤ï¼å°±è§ä¸ºåæå\n * w: \"all\"ï¼å¨é¨èç¹ç¡®è®¤ï¼æè§ä¸ºåæå\n\njournal åå®ä¹å¦ä½æç®æåãåå¼åæ¬ï¼\n\n * trueï¼åæä½è½å° journal æä»¶ä¸­æç®æåï¼\n * falseï¼åæä½è¾¾å°åå­å³ç®ä½æåã\n\nãç¤ºä¾ãå¨éç¾¤ä¸­ä½¿ç¨ writeconcern åæ°\n\ndb.transaction.insert({ count: 1 }, { writeconcern: { w: 'majoriy' } })\ndb.transaction.insert({ count: 1 }, { writeconcern: { w: '4' } })\ndb.transaction.insert({ count: 1 }, { writeconcern: { w: 'all' } })\n\n\nãç¤ºä¾ãéç½®å»¶è¿èç¹ï¼æ¨¡æç½ç»å»¶è¿\n\nconf=rs.conf()\nconf.memebers[2].slavedelay=5\nconf.memebers[2].priority=0\nrs.reconfig(conf)\n",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"MongoDB å»ºæ¨¡",frontmatter:{title:"MongoDB å»ºæ¨¡",date:"2020-09-09T20:47:14.000Z",categories:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],tags:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB","å»ºæ¨¡"],permalink:"/pages/562f99/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/04.%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/01.MongoDB/05.MongoDB%E5%BB%BA%E6%A8%A1.html",relativePath:"12.æ°æ®åº/04.ææ¡£æ°æ®åº/01.MongoDB/05.MongoDBå»ºæ¨¡.md",key:"v-925d1ece",path:"/pages/562f99/",headers:[{level:2,title:"MongoDB æ°æ®å»ºæ¨¡å¥é¨",slug:"mongodb-æ°æ®å»ºæ¨¡å¥é¨",normalizedTitle:"mongodb æ°æ®å»ºæ¨¡å¥é¨",charIndex:295},{level:3,title:"ï¼ä¸ï¼å®ä¹æ°æ®é",slug:"ä¸-å®ä¹æ°æ®é",normalizedTitle:"ï¼ä¸ï¼å®ä¹æ°æ®é",charIndex:390},{level:3,title:"ï¼äºï¼æè JSON ç»æ",slug:"äº-æè-json-ç»æ",normalizedTitle:"ï¼äºï¼æè json ç»æ",charIndex:992},{level:3,title:"ï¼ä¸ï¼ç¡®å®åªäºå­æ®µä½ä¸ºåµå¥å¼æ°æ®",slug:"ä¸-ç¡®å®åªäºå­æ®µä½ä¸ºåµå¥å¼æ°æ®",normalizedTitle:"ï¼ä¸ï¼ç¡®å®åªäºå­æ®µä½ä¸ºåµå¥å¼æ°æ®",charIndex:1564},{level:2,title:"æ°æ®æ¨¡åç®ä»",slug:"æ°æ®æ¨¡åç®ä»",normalizedTitle:"æ°æ®æ¨¡åç®ä»",charIndex:2357},{level:3,title:"çµæ´»ç Schema",slug:"çµæ´»ç-schema",normalizedTitle:"çµæ´»ç schema",charIndex:2461},{level:3,title:"Document ç»æ",slug:"document-ç»æ",normalizedTitle:"document ç»æ",charIndex:2865},{level:4,title:"åµå¥å¼æ°æ®æ¨¡å",slug:"åµå¥å¼æ°æ®æ¨¡å",normalizedTitle:"åµå¥å¼æ°æ®æ¨¡å",charIndex:2880},{level:4,title:"å¼ç¨å¼æ°æ®æ¨¡å",slug:"å¼ç¨å¼æ°æ®æ¨¡å",normalizedTitle:"å¼ç¨å¼æ°æ®æ¨¡å",charIndex:3136},{level:3,title:"åå­åæä½",slug:"åå­åæä½",normalizedTitle:"åå­åæä½",charIndex:3580},{level:4,title:"å document çåå­æ§",slug:"å-document-çåå­æ§",normalizedTitle:"å document çåå­æ§",charIndex:3589},{level:4,title:"å¤ document äºå¡",slug:"å¤-document-äºå¡",normalizedTitle:"å¤ document äºå¡",charIndex:3854},{level:3,title:"æ°æ®ä½¿ç¨åæ§è½",slug:"æ°æ®ä½¿ç¨åæ§è½",normalizedTitle:"æ°æ®ä½¿ç¨åæ§è½",charIndex:4229},{level:2,title:"Schema æ ¡éª",slug:"schema-æ ¡éª",normalizedTitle:"schema æ ¡éª",charIndex:4355},{level:3,title:"æå®æ ¡éªè§å",slug:"æå®æ ¡éªè§å",normalizedTitle:"æå®æ ¡éªè§å",charIndex:4369},{level:3,title:"JSON Schema",slug:"json-schema",normalizedTitle:"json schema",charIndex:4693},{level:3,title:"å¶å®æ¥è¯¢è¡¨è¾¾å¼",slug:"å¶å®æ¥è¯¢è¡¨è¾¾å¼",normalizedTitle:"å¶å®æ¥è¯¢è¡¨è¾¾å¼",charIndex:5992},{level:3,title:"è¡ä¸º",slug:"è¡ä¸º",normalizedTitle:"è¡ä¸º",charIndex:6386},{level:4,title:"ç°æç document",slug:"ç°æç-document",normalizedTitle:"ç°æç document",charIndex:6427},{level:4,title:"æ¥åææç»æ æç document",slug:"æ¥åææç»æ æç-document",normalizedTitle:"æ¥åææç»æ æç document",charIndex:7576},{level:4,title:"éå¶",slug:"éå¶",normalizedTitle:"éå¶",charIndex:82},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:8886}],headersStr:"MongoDB æ°æ®å»ºæ¨¡å¥é¨ ï¼ä¸ï¼å®ä¹æ°æ®é ï¼äºï¼æè JSON ç»æ ï¼ä¸ï¼ç¡®å®åªäºå­æ®µä½ä¸ºåµå¥å¼æ°æ® æ°æ®æ¨¡åç®ä» çµæ´»ç Schema Document ç»æ åµå¥å¼æ°æ®æ¨¡å å¼ç¨å¼æ°æ®æ¨¡å åå­åæä½ å document çåå­æ§ å¤ document äºå¡ æ°æ®ä½¿ç¨åæ§è½ Schema æ ¡éª æå®æ ¡éªè§å JSON Schema å¶å®æ¥è¯¢è¡¨è¾¾å¼ è¡ä¸º ç°æç document æ¥åææç»æ æç document éå¶ åèèµæ",content:"# MongoDB å»ºæ¨¡\n\nMongoDB çæ°æ®æ¨¡å¼æ¯ä¸ç§çµæ´»æ¨¡å¼ï¼å³ç³»åæ°æ®åºè¦æ±ä½ å¨æå¥æ°æ®ä¹åå¿é¡»åå®ä¹å¥½ä¸ä¸ªè¡¨çæ¨¡å¼ç»æï¼è MongoDB çéååå¹¶ä¸éå¶ document ç»æãè¿ç§çµæ´»æ§è®©å¯¹è±¡åæ°æ®åºææ¡£ä¹é´çæ å°åå¾å¾å®¹æãå³ä½¿æ°æ®è®°å½ä¹é´æå¾å¤§çååï¼æ¯ä¸ªææ¡£ä¹å¯ä»¥å¾å¥½çæ å°å°åæ¡ä¸åçè®°å½ã å½ç¶å¨å®éä½¿ç¨ä¸­ï¼åä¸ä¸ªéåä¸­çææ¡£å¾å¾é½æä¸ä¸ªæ¯è¾ç±»ä¼¼çç»æã\n\næ°æ®æ¨¡åè®¾è®¡ä¸­æå·æææ§çæ¯å¨åºç¨ç¨åºéæ±ï¼æ°æ®åºå¼ææ§è½è¦æ±åæ°æ®è¯»åæ¨¡å¼ä¹é´åæè¡¡èéãå½è®¾è®¡æ°æ®æ¨¡åçæ¶åï¼ä¸å®è¦èèåºç¨ç¨åºå¯¹æ°æ®çä½¿ç¨æ¨¡å¼ï¼å¦æ¥è¯¢ï¼æ´æ°åå¤çï¼ä»¥åæ°æ®æ¬èº«çå¤©ç¶ç»æã\n\n\n# MongoDB æ°æ®å»ºæ¨¡å¥é¨\n\n> åèï¼https://docs.mongodb.com/guides/server/introduction/#what-you-ll-need\n\n\n# ï¼ä¸ï¼å®ä¹æ°æ®é\n\nå½éè¦å»ºç«æ°æ®å­å¨æ¶ï¼é¦ååºè¯¥æèä»¥ä¸é®é¢ï¼éè¦å­å¨åªäºæ°æ®ï¼è¿äºå­æ®µä¹é´å¦ä½å³èï¼\n\nè¿æ¯ä¸ä¸ªæ°æ®å»ºæ¨¡çè¿ç¨ãç®æ æ¯å°ä¸å¡éæ±æ½è±¡ä¸ºé»è¾æ¨¡åã\n\nåè®¾è¿æ ·ä¸ä¸ªåºæ¯ï¼æä»¬éè¦å»ºç«æ°æ®åºä»¥è·è¸ªç©æåå¶æ°éï¼å¤§å°ï¼æ ç­¾åç­çº§ã\n\nå¦ææ¯å­å¨å¨ RDBMSï¼å¯è½ä»¥ä¸çæ°æ®è¡¨ï¼\n\nNAME       QUANTITY   SIZE          STATUS   TAGS                       RATING\njournal    25         14x21,cm      A        brown, lined               9\nnotebook   50         8.5x11,in     A        college-ruled,perforated   8\npaper      100        8.5x11,in     D        watercolor                 10\nplanner    75         22.85x30,cm   D        2019                       10\npostcard   45         10x,cm        D        double-sided,white         2\n\n\n# ï¼äºï¼æè JSON ç»æ\n\nä»ä¸ä¾ä¸­å¯ä»¥çåºï¼è¡¨ä¼¼ä¹æ¯å­å¨æ°æ®çå¥½å°æ¹ï¼ä½è¯¥æ°æ®éä¸­çå­æ®µéè¦å¤ä¸ªå¼ï¼å¦æå¨åä¸ªåä¸­å»ºæ¨¡ï¼åä¸å®¹ææç´¢ææ¾ç¤ºï¼å¯¹äº ä¾å¦âå¤§å°åæ ç­¾ï¼ã\n\nå¨ SQL æ°æ®åºä¸­ï¼æ¨å¯ä»¥éè¿åå»ºå³ç³»è¡¨æ¥è§£å³æ­¤é®é¢ã\n\nå¨ MongoDB ä¸­ï¼æ°æ®å­å¨ä¸ºææ¡£ï¼documentï¼ã è¿äºææ¡£ä»¥ JSONï¼JavaScript å¯¹è±¡è¡¨ç¤ºæ³ï¼æ ¼å¼å­å¨å¨ MongoDB ä¸­ã JSON ææ¡£æ¯æåµå¥å¼å­æ®µï¼å æ­¤ç¸å³æ°æ®åæ°æ®åè¡¨å¯ä»¥ä¸ææ¡£ä¸èµ·å­å¨ï¼èä¸æ¯ä¸å¤é¨è¡¨ä¸èµ·å­å¨ã\n\nJSON æ ¼å¼ä¸ºé®/å¼å¯¹ã å¨ JSON ææ¡£ä¸­ï¼å­æ®µååå¼ç¨åå·åéï¼å­æ®µååå¼å¯¹ç¨éå·åéï¼å¹¶ä¸å­æ®µéå°è£å¨âå¤§æ¬å·âï¼{}ï¼ä¸­ã\n\nå¦æè¦å¼å§å¯¹ä¸é¢çè¡ä¹ä¸è¿è¡å»ºæ¨¡ï¼ä¾å¦æ­¤è¡ï¼\n\nNAME       QUANTITY   SIZE        STATUS   TAGS                       RATING\nnotebook   50         8.5x11,in   A        college-ruled,perforated   8\n\næ¨å¯ä»¥ä» name å quantity å­æ®µå¼å§ã å¨ JSON ä¸­ï¼è¿äºå­æ®µå¦ä¸æç¤ºï¼\n\n{ \"name\": \"notebook\", \"qty\": 50 }\n\n\n\n# ï¼ä¸ï¼ç¡®å®åªäºå­æ®µä½ä¸ºåµå¥å¼æ°æ®\n\næ¥ä¸æ¥ï¼éè¦ç¡®å®åªäºå­æ®µå¯è½éè¦å¤ä¸ªå¼ãå¯ä»¥èèå°è¿äºå­æ®µä½ä¸ºåµå¥å¼ææ¡£æåµå¥å¼ææ¡£ä¸­ç åè¡¨/æ°ç» å¯¹è±¡ã\n\nä¾å¦ï¼å¨ä¸é¢çç¤ºä¾ä¸­ï¼size å¯è½åå«ä¸ä¸ªå­æ®µï¼\n\n{ \"h\": 11, \"w\": 8.5, \"uom\": \"in\" }\n\n\nAnd some items have multiple ratings, so ratings might be represented as a list of documents containing the field scores:\n\n[{ \"score\": 8 }, { \"score\": 9 }]\n\n\nAnd you might need to handle multiple tags per item. So you might store them in a list too.\n\n[\"college-ruled\", \"perforated\"]\n\n\nFinally, a JSON document that stores an inventory item might look like this:\n\n{\n  \"name\": \"notebook\",\n  \"qty\": 50,\n  \"rating\": [{ \"score\": 8 }, { \"score\": 9 }],\n  \"size\": { \"height\": 11, \"width\": 8.5, \"unit\": \"in\" },\n  \"status\": \"A\",\n  \"tags\": [\"college-ruled\", \"perforated\"]\n}\n\n\nThis looks very different from the tabular data structure you started with in Step 1.\n\n\n# æ°æ®æ¨¡åç®ä»\n\næ°æ®å»ºæ¨¡ä¸­çå³é®æææ¯å¹³è¡¡åºç¨ç¨åºçéæ±ãæ°æ®åºå¼æçæ§è½ä»¥åæ°æ®æ£ç´¢æ¨¡å¼ã å¨è®¾è®¡æ°æ®æ¨¡åæ¶ï¼å§ç»éè¦èèæ°æ®çåºç¨ç¨åºä½¿ç¨æåµï¼å³æ°æ®çæ¥è¯¢ï¼æ´æ°åå¤çï¼ä»¥åæ°æ®æ¬èº«çåºæç»æã\n\n\n# çµæ´»ç Schema\n\nå¨å³ç³»åæ°æ®åºä¸­ï¼å¿é¡»å¨æå¥æ°æ®ä¹åç¡®å®å¹¶å£°æè¡¨çç»æãè MongoDB ç collection é»è®¤æåµä¸ä¸éè¦å¶ææ¡£å·æç¸åçæ¶æãä¹å°±æ¯è¯´ï¼\n\nåä¸ä¸ª collection ä¸­ç document ä¸éè¦å·æç¸åç field éï¼å¹¶ä¸ field çæ°æ®ç±»åå¯ä»¥å¨éåä¸­çä¸åææ¡£ä¹é´ææä¸åã\n\nè¦æ´æ¹ collection ä¸­ç document ç»æï¼ä¾å¦æ·»å æ° fieldï¼å é¤ç°æ field æå° field å¼æ´æ¹ä¸ºæ°ç±»åï¼åªéè¦å°ææ¡£æ´æ°ä¸ºæ°ç»æå³å¯ã\n\nè¿ç§çµæ´»æ§æå©äºå° document æ å°å°å®ä½æå¯¹è±¡ãæ¯ä¸ª document é½å¯ä»¥å¹éæè¡¨ç¤ºå®ä½çæ°æ®å­æ®µï¼å³ä½¿è¯¥ææ¡£ä¸éåä¸­çå¶ä»ææ¡£æå¾å¤§çä¸åãä½æ¯ï¼å®éä¸ï¼éåä¸­çææ¡£å·æç¸ä¼¼çç»æï¼å¹¶ä¸æ¨å¯ä»¥å¨æ´æ°åæå¥æä½æé´å¯¹ collection å¼ºå¶æ§è¡ document æ ¡éªè§åã\n\n\n# Document ç»æ\n\n# åµå¥å¼æ°æ®æ¨¡å\n\nåµå¥å¼ document éè¿å°ç¸å³æ°æ®å­å¨å¨åä¸ª document ç»æä¸­æ¥æè·æ°æ®ä¹é´çå³ç³»ã MongoDB document å¯ä»¥å° document ç»æåµå¥å°å¦ä¸ä¸ª document ä¸­çå­æ®µææ°ç»ä¸­ãè¿äºéè§èåçæ°æ®æ¨¡ååè®¸åºç¨ç¨åºå¨åä¸ªæ°æ®åºæä½ä¸­æ£ç´¢åæçºµç¸å³æ°æ®ã\n\n\n\nå¯¹äº MongoDB ä¸­çå¾å¤åºæ¯ï¼éè§èåæ°æ®æ¨¡åé½æ¯æä½³çã\n\n> åµå¥å¼ document æå¤§å°éå¶ï¼å¿é¡»å°äº 16 MBã\n> \n> å¦ææ¯è¾å¤§çäºè¿å¶æ°æ®ï¼å¯ä»¥èè GridFSã\n\n# å¼ç¨å¼æ°æ®æ¨¡å\n\nå¼ç¨éè¿åå«ä»ä¸ä¸ª document å°å¦ä¸ä¸ª document çé¾æ¥æå¼ç¨æ¥å­å¨æ°æ®ä¹é´çå³ç³»ã åºç¨ç¨åºå¯ä»¥è§£æè¿äºå¼ç¨ä»¥è®¿é®ç¸å³æ°æ®ã å¹¿ä¹ä¸è®²ï¼è¿äºæ¯è§èåçæ°æ®æ¨¡åã\n\n\n\néå¸¸ï¼å¨ä»¥ä¸åºæ¯ä½¿ç¨å¼ç¨å¼çæ°æ®æ¨¡åï¼\n\n * åµå¥æ¶ä¼å¯¼è´æ°æ®éå¤ï¼ä½æ æ³æä¾è¶³å¤çè¯»åæ§è½ä¼å¿ï¼æ æ³èè¿éå¤çå«ä¹ã\n * ä»£è¡¨æ´å¤æçå¤å¯¹å¤å³ç³»ã\n * ä¸ºå¤§è§æ¨¡åå±æ°æ®éå»ºæ¨¡ã\n\nä¸ºäº join collectionï¼MongoDB æ¯æèå stageï¼\n\n * $lookupï¼MongoDB 3.2 å¼å§æ¯æï¼\n * $graphLookupï¼MongoDB 3.4 å¼å§æ¯æï¼\n\nMongoDB è¿æä¾äºå¼ç¨æ¥æ¯æè·¨éå join æ°æ®ï¼\n\n * å¼ç¨æ°æ®æ¨¡åç¤ºä¾ï¼åèï¼Model One-to-Many Relationships with Document References.\n * æ´å¤æ å½¢æ¨¡åï¼åèï¼Model Tree Structures.\n\n\n# åå­åæä½\n\n# å document çåå­æ§\n\nå¨ MongoDB ä¸­ï¼éå¯¹åä¸ª document çåæä½æ¯åå­æ§çï¼å³ä½¿è¯¥ document ä¸­åµå¥äºå¤ä¸ªå­ documentã å·æåµå¥æ°æ®çéè§èåæ°æ®æ¨¡åå°ææç¸å³æ°æ®åå¹¶å¨ä¸ä¸ª document ä¸­ï¼èä¸æ¯å¨å¤ä¸ª document å collection ä¸­è¿è¡è§èåã è¯¥æ°æ®æ¨¡åæå©äºåå­æä½ã å½åä¸ªåå¥æä½ï¼ä¾å¦ db.collection.updateMany()ï¼ä¿®æ¹å¤ä¸ª document æ¶ï¼æ¯ä¸ª document çç¬ç«ä¿®æ¹æ¯åå­çï¼ä½æ´ä¸ªæä½ä¸æ¯åå­çã\n\n# å¤ document äºå¡\n\nå¯¹äºéè¦å¯¹å¤ä¸ª documentï¼å¨åä¸ªæå¤ä¸ªéåä¸­ï¼è¿è¡è¯»ååå­æ§çæåµï¼MongoDB æ¯æå¤ document äºå¡ã\n\n * å¨çæ¬ 4.0 ä¸­ï¼MongoDB å¨å¯æ¬éä¸æ¯æå¤ document äºå¡ã\n * å¨çæ¬ 4.2 ä¸­ï¼MongoDB å¼å¥äºåå¸å¼äºå¡ï¼å®å¢å äºå¯¹åçç¾¤éä¸å¤ document äºå¡çæ¯æï¼å¹¶åå¹¶äºå¯¹å¯æ¬éä¸å¤ document äºå¡çç°ææ¯æã\n\n> å¨å¤§å¤æ°æåµä¸ï¼å¤ document äºå¡ä¼æ¯å document çåå¥äº§çæ´é«çæ§è½æ¶èï¼å¹¶ä¸å¤ document äºå¡çå¯ç¨æ§ä¸è½æ¿ä»£é«æçç»æè®¾è®¡ã å¨è®¸å¤æåµä¸ï¼éè§èåæ°æ®æ¨¡åï¼åµå¥å¼ document åæ°ç»ï¼ä»æ¯æä½³éæ©ã ä¹å°±æ¯è¯´ï¼åççæ°æ®å»ºæ¨¡ï¼å°æå¤§ç¨åº¦å°åå°å¯¹å¤ document äºå¡çéæ±ã\n\n\n# æ°æ®ä½¿ç¨åæ§è½\n\nå¨è®¾è®¡æ°æ®æ¨¡åæ¶ï¼è¯·èèåºç¨ç¨åºå°å¦ä½ä½¿ç¨æ¨çæ°æ®åºã ä¾å¦ï¼å¦ææ¨çåºç¨ç¨åºä»ä½¿ç¨æè¿æå¥ç documentï¼è¯·èèä½¿ç¨ä¸ééåã æèï¼å¦ææ¨çåºç¨ç¨åºä¸»è¦æ¯å¯¹ collection çè¯»åæä½ï¼åæ·»å ç´¢å¼ä»¥æé«æ§è½ã\n\n\n# Schema æ ¡éª\n\n\n# æå®æ ¡éªè§å\n\nå¦æåå»ºæ° collection æ¶è¦æå®æ ¡éªè§åï¼éè¦å¨ä½¿ç¨ db.createCollection() æ¶æå® validator éé¡¹ã\n\nå¦æè¦å° document æ ¡éªæ·»å å°ç°æ collection ä¸­ï¼éè¦ä½¿ç¨å¸¦æ validator éé¡¹ç collMod å½ä»¤ã\n\nMongoDB è¿æä¾ä»¥ä¸ç¸å³éé¡¹ï¼\n\n * validationLevel éé¡¹ï¼ç¨äºç¡®å® MongoDB å¨æ´æ°è¿ç¨ä¸­ï¼å¯¹ç°æ document åºç¨æ ¡éªè§åçä¸¥æ ¼ç¨åº¦ï¼\n * validationAction éé¡¹ï¼ç¨äºç¡®å® MongoDB åç°è¿åæ ¡éªè§åç document æ¶ï¼æ¯éæ©æ¥éå¹¶æç»ï¼è¿æ¯æ¥åæ°æ®ä½å¨æ¥å¿ä¸­åè­¦ï¼ã\n\n\n# JSON Schema\n\nä» 3.6 çæ¬å¼å§ï¼MongoDB å¼å§æ¯æ JSON Schema æ ¡éªã\n\nå¯ä»¥éè¿å¨ validator è¡¨è¾¾å¼ä¸­ä½¿ç¨ $jsonSchema æä½æ¥æå® JSON Schema æ ¡éªã\n\nãç¤ºä¾ã\n\ndb.createCollection('students', {\n  validator: {\n    $jsonSchema: {\n      bsonType: 'object',\n      required: ['name', 'year', 'major', 'address'],\n      properties: {\n        name: {\n          bsonType: 'string',\n          description: 'must be a string and is required'\n        },\n        year: {\n          bsonType: 'int',\n          minimum: 2017,\n          maximum: 3017,\n          description: 'must be an integer in [ 2017, 3017 ] and is required'\n        },\n        major: {\n          enum: ['Math', 'English', 'Computer Science', 'History', null],\n          description: 'can only be one of the enum values and is required'\n        },\n        gpa: {\n          bsonType: ['double'],\n          description: 'must be a double if the field exists'\n        },\n        address: {\n          bsonType: 'object',\n          required: ['city'],\n          properties: {\n            street: {\n              bsonType: 'string',\n              description: 'must be a string if the field exists'\n            },\n            city: {\n              bsonType: 'string',\n              description: 'must be a string and is required'\n            }\n          }\n        }\n      }\n    }\n  }\n})\n\n\n\n# å¶å®æ¥è¯¢è¡¨è¾¾å¼\n\né¤äºä½¿ç¨ $jsonSchema æ¥è¯¢è¿ç®ç¬¦ç JSON Schema æ ¡éªå¤ï¼MongoDB è¿æ¯æå¶å®æ¥è¯¢è¿ç®ç¬¦çæ ¡éªï¼ä½ä»¥ä¸æåµé¤å¤ï¼\n\n * $near,\n * $nearSphere,\n * $text,\n * $where, and\n * å¸¦æ $function è¡¨è¾¾å¼ç $expr\n\nãç¤ºä¾ãæ¥è¯¢è¡¨è¾¾å¼ä¸­æå®æ ¡éªè§å\n\ndb.createCollection('contacts', {\n  validator: {\n    $or: [\n      { phone: { $type: 'string' } },\n      { email: { $regex: /@mongodb\\.com$/ } },\n      { status: { $in: ['Unknown', 'Incomplete'] } }\n    ]\n  }\n})\n\n\n\n# è¡ä¸º\n\næ ¡éªåçå¨æ´æ°åæå¥æé´ãæ·»å æ ¡éªè§åå° collection æ¶ï¼ä¸ä¼å¯¹ç°æç document è¿è¡æ ¡éªï¼é¤éåçä¿®æ¹æä½ã\n\n# ç°æç document\n\nvalidationLevel éé¡¹ç¡®å® MongoDB è¿è¡è§åæ ¡éªæ¶æ§è¡çæä½ï¼\n\n * å¦æ validationLevel æ¯ strictï¼ä¸¥æ ¼çº§å«ãè¿æ¯ MongoDB é»è®¤çº§å«ï¼ï¼å MongoDB å°æ ¡éªè§ååºç¨äºæææå¥åæ´æ°ã\n * å¦æ validationLevel æ¯ moderateï¼ä¸­ç­çº§å«ï¼ï¼å MongoDB åªå¯¹å·²æ»¡è¶³æ ¡éªæ¡ä»¶çç°æææ¡£çæå¥åæ´æ°æä½è¿è¡æ ¡éªï¼å¯¹ä¸ç¬¦åæ ¡éªæ åçç°æææ¡£çæ´æ°æä½ä¸è¿è¡æ ¡éªã\n\nãç¤ºä¾ã\n\nä¸é¢æ¯ä¸ä¸ªæ­£å¸¸çæå¥æä½ï¼\n\ndb.contacts.insert([\n  {\n    _id: 1,\n    name: 'Anne',\n    phone: '+1 555 123 456',\n    city: 'London',\n    status: 'Complete'\n  },\n  { _id: 2, name: 'Ivan', city: 'Vancouver' }\n])\n\n\nå¨ collection ä¸éç½®ä¸ä¸ªæ ¡éªè§åï¼\n\ndb.runCommand({\n  collMod: 'contacts',\n  validator: {\n    $jsonSchema: {\n      bsonType: 'object',\n      required: ['phone', 'name'],\n      properties: {\n        phone: {\n          bsonType: 'string',\n          description: 'must be a string and is required'\n        },\n        name: {\n          bsonType: 'string',\n          description: 'must be a string and is required'\n        }\n      }\n    }\n  },\n  validationLevel: 'moderate'\n})\n\n\nå contacts collection ç°å¨æ·»å äºå«ä¸­ç­çº§å«ï¼moderateï¼ validationLevel ç validatorï¼\n\n * å¦æå°è¯æ´æ° _idä¸º 1 çææ¡£ï¼å MongoDB å°åºç¨æ ¡éªè§åï¼å ä¸ºç°æææ¡£ç¬¦åæ¡ä»¶ã\n\n * ç¸åï¼MongoDB ä¸ä¼å°æ ¡éª _id ä¸º 2 çææ¡£ï¼å ä¸ºå®ä¸ç¬¦åæ ¡éªè§åã\n\nå¦æè¦å®å¨ç¦ç¨æ ¡éªï¼å¯ä»¥å° validationLevel ç½®ä¸º offã\n\n# æ¥åææç»æ æç document\n\n * å¦æ validationAction æ¯ Errorï¼é»è®¤ï¼ï¼å MongoDB æç»ä»»ä½è¿åæ ¡éªè§åçæå¥ææ´æ°ã\n * å¦æ validationAction æ¯ Warnï¼MongoDB ä¼è®°å½ææçè¿è§ï¼ä½åè®¸è¿è¡æå¥ææ´æ°ã\n\nãç¤ºä¾ã\n\nåå»ºéåæ¶ï¼éç½® validationAction ä¸º warnã\n\ndb.createCollection('contacts2', {\n  validator: {\n    $jsonSchema: {\n      bsonType: 'object',\n      required: ['phone'],\n      properties: {\n        phone: {\n          bsonType: 'string',\n          description: 'must be a string and is required'\n        },\n        email: {\n          bsonType: 'string',\n          pattern: '@mongodb.com$',\n          description:\n            'must be a string and match the regular expression pattern'\n        },\n        status: {\n          enum: ['Unknown', 'Incomplete'],\n          description: 'can only be one of the enum values'\n        }\n      }\n    }\n  },\n  validationAction: 'warn'\n})\n\n\nå°è¯æå¥ä¸æ¡è¿è§è®°å½\n\n> db.contacts2.insert( { name: \"Amanda\", status: \"Updated\" } )\nWriteResult({ \"nInserted\" : 1 })\n\n\nMongoDB åè®¸è¿æ¡æä½æ§è¡ï¼ä½æ¯æå¡å¨ä¼è®°å½ä¸åè­¦ä¿¡æ¯ã\n\n{\"t\":{\"$date\":\"2020-09-11T16:35:57.754+08:00\"},\"s\":\"W\",  \"c\":\"STORAGE\",  \"id\":20294,   \"ctx\":\"conn14\",\"msg\":\"Document would fail validation\",\"attr\":{\"namespace\":\"test.contacts2\",\"document\":{\"_id\":{\"$oid\":\"5f5b36ed8ea53d62a0b51c4e\"},\"name\":\"Amanda\",\"status\":\"Updated\"}}}\n\n\n# éå¶\n\nä¸è½å¨ adminãlocalãconfig è¿å ä¸ªç¹æ®çæ°æ®åºä¸­æå®æ ¡éªè§åã\n\nä¸è½å¨ system.* collection ä¸­æå®æ ¡éªã\n\n\n# åèèµæ\n\n * å®æ¹\n   * MongoDB å®ç½\n   * MongoDB Github\n   * MongoDB å®æ¹åè´¹æç¨\n * æç¨\n   * MongoDB æç¨\n   * MongoDB é«æè¯¾",normalizedContent:"# mongodb å»ºæ¨¡\n\nmongodb çæ°æ®æ¨¡å¼æ¯ä¸ç§çµæ´»æ¨¡å¼ï¼å³ç³»åæ°æ®åºè¦æ±ä½ å¨æå¥æ°æ®ä¹åå¿é¡»åå®ä¹å¥½ä¸ä¸ªè¡¨çæ¨¡å¼ç»æï¼è mongodb çéååå¹¶ä¸éå¶ document ç»æãè¿ç§çµæ´»æ§è®©å¯¹è±¡åæ°æ®åºææ¡£ä¹é´çæ å°åå¾å¾å®¹æãå³ä½¿æ°æ®è®°å½ä¹é´æå¾å¤§çååï¼æ¯ä¸ªææ¡£ä¹å¯ä»¥å¾å¥½çæ å°å°åæ¡ä¸åçè®°å½ã å½ç¶å¨å®éä½¿ç¨ä¸­ï¼åä¸ä¸ªéåä¸­çææ¡£å¾å¾é½æä¸ä¸ªæ¯è¾ç±»ä¼¼çç»æã\n\næ°æ®æ¨¡åè®¾è®¡ä¸­æå·æææ§çæ¯å¨åºç¨ç¨åºéæ±ï¼æ°æ®åºå¼ææ§è½è¦æ±åæ°æ®è¯»åæ¨¡å¼ä¹é´åæè¡¡èéãå½è®¾è®¡æ°æ®æ¨¡åçæ¶åï¼ä¸å®è¦èèåºç¨ç¨åºå¯¹æ°æ®çä½¿ç¨æ¨¡å¼ï¼å¦æ¥è¯¢ï¼æ´æ°åå¤çï¼ä»¥åæ°æ®æ¬èº«çå¤©ç¶ç»æã\n\n\n# mongodb æ°æ®å»ºæ¨¡å¥é¨\n\n> åèï¼https://docs.mongodb.com/guides/server/introduction/#what-you-ll-need\n\n\n# ï¼ä¸ï¼å®ä¹æ°æ®é\n\nå½éè¦å»ºç«æ°æ®å­å¨æ¶ï¼é¦ååºè¯¥æèä»¥ä¸é®é¢ï¼éè¦å­å¨åªäºæ°æ®ï¼è¿äºå­æ®µä¹é´å¦ä½å³èï¼\n\nè¿æ¯ä¸ä¸ªæ°æ®å»ºæ¨¡çè¿ç¨ãç®æ æ¯å°ä¸å¡éæ±æ½è±¡ä¸ºé»è¾æ¨¡åã\n\nåè®¾è¿æ ·ä¸ä¸ªåºæ¯ï¼æä»¬éè¦å»ºç«æ°æ®åºä»¥è·è¸ªç©æåå¶æ°éï¼å¤§å°ï¼æ ç­¾åç­çº§ã\n\nå¦ææ¯å­å¨å¨ rdbmsï¼å¯è½ä»¥ä¸çæ°æ®è¡¨ï¼\n\nname       quantity   size          status   tags                       rating\njournal    25         14x21,cm      a        brown, lined               9\nnotebook   50         8.5x11,in     a        college-ruled,perforated   8\npaper      100        8.5x11,in     d        watercolor                 10\nplanner    75         22.85x30,cm   d        2019                       10\npostcard   45         10x,cm        d        double-sided,white         2\n\n\n# ï¼äºï¼æè json ç»æ\n\nä»ä¸ä¾ä¸­å¯ä»¥çåºï¼è¡¨ä¼¼ä¹æ¯å­å¨æ°æ®çå¥½å°æ¹ï¼ä½è¯¥æ°æ®éä¸­çå­æ®µéè¦å¤ä¸ªå¼ï¼å¦æå¨åä¸ªåä¸­å»ºæ¨¡ï¼åä¸å®¹ææç´¢ææ¾ç¤ºï¼å¯¹äº ä¾å¦âå¤§å°åæ ç­¾ï¼ã\n\nå¨ sql æ°æ®åºä¸­ï¼æ¨å¯ä»¥éè¿åå»ºå³ç³»è¡¨æ¥è§£å³æ­¤é®é¢ã\n\nå¨ mongodb ä¸­ï¼æ°æ®å­å¨ä¸ºææ¡£ï¼documentï¼ã è¿äºææ¡£ä»¥ jsonï¼javascript å¯¹è±¡è¡¨ç¤ºæ³ï¼æ ¼å¼å­å¨å¨ mongodb ä¸­ã json ææ¡£æ¯æåµå¥å¼å­æ®µï¼å æ­¤ç¸å³æ°æ®åæ°æ®åè¡¨å¯ä»¥ä¸ææ¡£ä¸èµ·å­å¨ï¼èä¸æ¯ä¸å¤é¨è¡¨ä¸èµ·å­å¨ã\n\njson æ ¼å¼ä¸ºé®/å¼å¯¹ã å¨ json ææ¡£ä¸­ï¼å­æ®µååå¼ç¨åå·åéï¼å­æ®µååå¼å¯¹ç¨éå·åéï¼å¹¶ä¸å­æ®µéå°è£å¨âå¤§æ¬å·âï¼{}ï¼ä¸­ã\n\nå¦æè¦å¼å§å¯¹ä¸é¢çè¡ä¹ä¸è¿è¡å»ºæ¨¡ï¼ä¾å¦æ­¤è¡ï¼\n\nname       quantity   size        status   tags                       rating\nnotebook   50         8.5x11,in   a        college-ruled,perforated   8\n\næ¨å¯ä»¥ä» name å quantity å­æ®µå¼å§ã å¨ json ä¸­ï¼è¿äºå­æ®µå¦ä¸æç¤ºï¼\n\n{ \"name\": \"notebook\", \"qty\": 50 }\n\n\n\n# ï¼ä¸ï¼ç¡®å®åªäºå­æ®µä½ä¸ºåµå¥å¼æ°æ®\n\næ¥ä¸æ¥ï¼éè¦ç¡®å®åªäºå­æ®µå¯è½éè¦å¤ä¸ªå¼ãå¯ä»¥èèå°è¿äºå­æ®µä½ä¸ºåµå¥å¼ææ¡£æåµå¥å¼ææ¡£ä¸­ç åè¡¨/æ°ç» å¯¹è±¡ã\n\nä¾å¦ï¼å¨ä¸é¢çç¤ºä¾ä¸­ï¼size å¯è½åå«ä¸ä¸ªå­æ®µï¼\n\n{ \"h\": 11, \"w\": 8.5, \"uom\": \"in\" }\n\n\nand some items have multiple ratings, so ratings might be represented as a list of documents containing the field scores:\n\n[{ \"score\": 8 }, { \"score\": 9 }]\n\n\nand you might need to handle multiple tags per item. so you might store them in a list too.\n\n[\"college-ruled\", \"perforated\"]\n\n\nfinally, a json document that stores an inventory item might look like this:\n\n{\n  \"name\": \"notebook\",\n  \"qty\": 50,\n  \"rating\": [{ \"score\": 8 }, { \"score\": 9 }],\n  \"size\": { \"height\": 11, \"width\": 8.5, \"unit\": \"in\" },\n  \"status\": \"a\",\n  \"tags\": [\"college-ruled\", \"perforated\"]\n}\n\n\nthis looks very different from the tabular data structure you started with in step 1.\n\n\n# æ°æ®æ¨¡åç®ä»\n\næ°æ®å»ºæ¨¡ä¸­çå³é®æææ¯å¹³è¡¡åºç¨ç¨åºçéæ±ãæ°æ®åºå¼æçæ§è½ä»¥åæ°æ®æ£ç´¢æ¨¡å¼ã å¨è®¾è®¡æ°æ®æ¨¡åæ¶ï¼å§ç»éè¦èèæ°æ®çåºç¨ç¨åºä½¿ç¨æåµï¼å³æ°æ®çæ¥è¯¢ï¼æ´æ°åå¤çï¼ä»¥åæ°æ®æ¬èº«çåºæç»æã\n\n\n# çµæ´»ç schema\n\nå¨å³ç³»åæ°æ®åºä¸­ï¼å¿é¡»å¨æå¥æ°æ®ä¹åç¡®å®å¹¶å£°æè¡¨çç»æãè mongodb ç collection é»è®¤æåµä¸ä¸éè¦å¶ææ¡£å·æç¸åçæ¶æãä¹å°±æ¯è¯´ï¼\n\nåä¸ä¸ª collection ä¸­ç document ä¸éè¦å·æç¸åç field éï¼å¹¶ä¸ field çæ°æ®ç±»åå¯ä»¥å¨éåä¸­çä¸åææ¡£ä¹é´ææä¸åã\n\nè¦æ´æ¹ collection ä¸­ç document ç»æï¼ä¾å¦æ·»å æ° fieldï¼å é¤ç°æ field æå° field å¼æ´æ¹ä¸ºæ°ç±»åï¼åªéè¦å°ææ¡£æ´æ°ä¸ºæ°ç»æå³å¯ã\n\nè¿ç§çµæ´»æ§æå©äºå° document æ å°å°å®ä½æå¯¹è±¡ãæ¯ä¸ª document é½å¯ä»¥å¹éæè¡¨ç¤ºå®ä½çæ°æ®å­æ®µï¼å³ä½¿è¯¥ææ¡£ä¸éåä¸­çå¶ä»ææ¡£æå¾å¤§çä¸åãä½æ¯ï¼å®éä¸ï¼éåä¸­çææ¡£å·æç¸ä¼¼çç»æï¼å¹¶ä¸æ¨å¯ä»¥å¨æ´æ°åæå¥æä½æé´å¯¹ collection å¼ºå¶æ§è¡ document æ ¡éªè§åã\n\n\n# document ç»æ\n\n# åµå¥å¼æ°æ®æ¨¡å\n\nåµå¥å¼ document éè¿å°ç¸å³æ°æ®å­å¨å¨åä¸ª document ç»æä¸­æ¥æè·æ°æ®ä¹é´çå³ç³»ã mongodb document å¯ä»¥å° document ç»æåµå¥å°å¦ä¸ä¸ª document ä¸­çå­æ®µææ°ç»ä¸­ãè¿äºéè§èåçæ°æ®æ¨¡ååè®¸åºç¨ç¨åºå¨åä¸ªæ°æ®åºæä½ä¸­æ£ç´¢åæçºµç¸å³æ°æ®ã\n\n\n\nå¯¹äº mongodb ä¸­çå¾å¤åºæ¯ï¼éè§èåæ°æ®æ¨¡åé½æ¯æä½³çã\n\n> åµå¥å¼ document æå¤§å°éå¶ï¼å¿é¡»å°äº 16 mbã\n> \n> å¦ææ¯è¾å¤§çäºè¿å¶æ°æ®ï¼å¯ä»¥èè gridfsã\n\n# å¼ç¨å¼æ°æ®æ¨¡å\n\nå¼ç¨éè¿åå«ä»ä¸ä¸ª document å°å¦ä¸ä¸ª document çé¾æ¥æå¼ç¨æ¥å­å¨æ°æ®ä¹é´çå³ç³»ã åºç¨ç¨åºå¯ä»¥è§£æè¿äºå¼ç¨ä»¥è®¿é®ç¸å³æ°æ®ã å¹¿ä¹ä¸è®²ï¼è¿äºæ¯è§èåçæ°æ®æ¨¡åã\n\n\n\néå¸¸ï¼å¨ä»¥ä¸åºæ¯ä½¿ç¨å¼ç¨å¼çæ°æ®æ¨¡åï¼\n\n * åµå¥æ¶ä¼å¯¼è´æ°æ®éå¤ï¼ä½æ æ³æä¾è¶³å¤çè¯»åæ§è½ä¼å¿ï¼æ æ³èè¿éå¤çå«ä¹ã\n * ä»£è¡¨æ´å¤æçå¤å¯¹å¤å³ç³»ã\n * ä¸ºå¤§è§æ¨¡åå±æ°æ®éå»ºæ¨¡ã\n\nä¸ºäº join collectionï¼mongodb æ¯æèå stageï¼\n\n * $lookupï¼mongodb 3.2 å¼å§æ¯æï¼\n * $graphlookupï¼mongodb 3.4 å¼å§æ¯æï¼\n\nmongodb è¿æä¾äºå¼ç¨æ¥æ¯æè·¨éå join æ°æ®ï¼\n\n * å¼ç¨æ°æ®æ¨¡åç¤ºä¾ï¼åèï¼model one-to-many relationships with document references.\n * æ´å¤æ å½¢æ¨¡åï¼åèï¼model tree structures.\n\n\n# åå­åæä½\n\n# å document çåå­æ§\n\nå¨ mongodb ä¸­ï¼éå¯¹åä¸ª document çåæä½æ¯åå­æ§çï¼å³ä½¿è¯¥ document ä¸­åµå¥äºå¤ä¸ªå­ documentã å·æåµå¥æ°æ®çéè§èåæ°æ®æ¨¡åå°ææç¸å³æ°æ®åå¹¶å¨ä¸ä¸ª document ä¸­ï¼èä¸æ¯å¨å¤ä¸ª document å collection ä¸­è¿è¡è§èåã è¯¥æ°æ®æ¨¡åæå©äºåå­æä½ã å½åä¸ªåå¥æä½ï¼ä¾å¦ db.collection.updatemany()ï¼ä¿®æ¹å¤ä¸ª document æ¶ï¼æ¯ä¸ª document çç¬ç«ä¿®æ¹æ¯åå­çï¼ä½æ´ä¸ªæä½ä¸æ¯åå­çã\n\n# å¤ document äºå¡\n\nå¯¹äºéè¦å¯¹å¤ä¸ª documentï¼å¨åä¸ªæå¤ä¸ªéåä¸­ï¼è¿è¡è¯»ååå­æ§çæåµï¼mongodb æ¯æå¤ document äºå¡ã\n\n * å¨çæ¬ 4.0 ä¸­ï¼mongodb å¨å¯æ¬éä¸æ¯æå¤ document äºå¡ã\n * å¨çæ¬ 4.2 ä¸­ï¼mongodb å¼å¥äºåå¸å¼äºå¡ï¼å®å¢å äºå¯¹åçç¾¤éä¸å¤ document äºå¡çæ¯æï¼å¹¶åå¹¶äºå¯¹å¯æ¬éä¸å¤ document äºå¡çç°ææ¯æã\n\n> å¨å¤§å¤æ°æåµä¸ï¼å¤ document äºå¡ä¼æ¯å document çåå¥äº§çæ´é«çæ§è½æ¶èï¼å¹¶ä¸å¤ document äºå¡çå¯ç¨æ§ä¸è½æ¿ä»£é«æçç»æè®¾è®¡ã å¨è®¸å¤æåµä¸ï¼éè§èåæ°æ®æ¨¡åï¼åµå¥å¼ document åæ°ç»ï¼ä»æ¯æä½³éæ©ã ä¹å°±æ¯è¯´ï¼åççæ°æ®å»ºæ¨¡ï¼å°æå¤§ç¨åº¦å°åå°å¯¹å¤ document äºå¡çéæ±ã\n\n\n# æ°æ®ä½¿ç¨åæ§è½\n\nå¨è®¾è®¡æ°æ®æ¨¡åæ¶ï¼è¯·èèåºç¨ç¨åºå°å¦ä½ä½¿ç¨æ¨çæ°æ®åºã ä¾å¦ï¼å¦ææ¨çåºç¨ç¨åºä»ä½¿ç¨æè¿æå¥ç documentï¼è¯·èèä½¿ç¨ä¸ééåã æèï¼å¦ææ¨çåºç¨ç¨åºä¸»è¦æ¯å¯¹ collection çè¯»åæä½ï¼åæ·»å ç´¢å¼ä»¥æé«æ§è½ã\n\n\n# schema æ ¡éª\n\n\n# æå®æ ¡éªè§å\n\nå¦æåå»ºæ° collection æ¶è¦æå®æ ¡éªè§åï¼éè¦å¨ä½¿ç¨ db.createcollection() æ¶æå® validator éé¡¹ã\n\nå¦æè¦å° document æ ¡éªæ·»å å°ç°æ collection ä¸­ï¼éè¦ä½¿ç¨å¸¦æ validator éé¡¹ç collmod å½ä»¤ã\n\nmongodb è¿æä¾ä»¥ä¸ç¸å³éé¡¹ï¼\n\n * validationlevel éé¡¹ï¼ç¨äºç¡®å® mongodb å¨æ´æ°è¿ç¨ä¸­ï¼å¯¹ç°æ document åºç¨æ ¡éªè§åçä¸¥æ ¼ç¨åº¦ï¼\n * validationaction éé¡¹ï¼ç¨äºç¡®å® mongodb åç°è¿åæ ¡éªè§åç document æ¶ï¼æ¯éæ©æ¥éå¹¶æç»ï¼è¿æ¯æ¥åæ°æ®ä½å¨æ¥å¿ä¸­åè­¦ï¼ã\n\n\n# json schema\n\nä» 3.6 çæ¬å¼å§ï¼mongodb å¼å§æ¯æ json schema æ ¡éªã\n\nå¯ä»¥éè¿å¨ validator è¡¨è¾¾å¼ä¸­ä½¿ç¨ $jsonschema æä½æ¥æå® json schema æ ¡éªã\n\nãç¤ºä¾ã\n\ndb.createcollection('students', {\n  validator: {\n    $jsonschema: {\n      bsontype: 'object',\n      required: ['name', 'year', 'major', 'address'],\n      properties: {\n        name: {\n          bsontype: 'string',\n          description: 'must be a string and is required'\n        },\n        year: {\n          bsontype: 'int',\n          minimum: 2017,\n          maximum: 3017,\n          description: 'must be an integer in [ 2017, 3017 ] and is required'\n        },\n        major: {\n          enum: ['math', 'english', 'computer science', 'history', null],\n          description: 'can only be one of the enum values and is required'\n        },\n        gpa: {\n          bsontype: ['double'],\n          description: 'must be a double if the field exists'\n        },\n        address: {\n          bsontype: 'object',\n          required: ['city'],\n          properties: {\n            street: {\n              bsontype: 'string',\n              description: 'must be a string if the field exists'\n            },\n            city: {\n              bsontype: 'string',\n              description: 'must be a string and is required'\n            }\n          }\n        }\n      }\n    }\n  }\n})\n\n\n\n# å¶å®æ¥è¯¢è¡¨è¾¾å¼\n\né¤äºä½¿ç¨ $jsonschema æ¥è¯¢è¿ç®ç¬¦ç json schema æ ¡éªå¤ï¼mongodb è¿æ¯æå¶å®æ¥è¯¢è¿ç®ç¬¦çæ ¡éªï¼ä½ä»¥ä¸æåµé¤å¤ï¼\n\n * $near,\n * $nearsphere,\n * $text,\n * $where, and\n * å¸¦æ $function è¡¨è¾¾å¼ç $expr\n\nãç¤ºä¾ãæ¥è¯¢è¡¨è¾¾å¼ä¸­æå®æ ¡éªè§å\n\ndb.createcollection('contacts', {\n  validator: {\n    $or: [\n      { phone: { $type: 'string' } },\n      { email: { $regex: /@mongodb\\.com$/ } },\n      { status: { $in: ['unknown', 'incomplete'] } }\n    ]\n  }\n})\n\n\n\n# è¡ä¸º\n\næ ¡éªåçå¨æ´æ°åæå¥æé´ãæ·»å æ ¡éªè§åå° collection æ¶ï¼ä¸ä¼å¯¹ç°æç document è¿è¡æ ¡éªï¼é¤éåçä¿®æ¹æä½ã\n\n# ç°æç document\n\nvalidationlevel éé¡¹ç¡®å® mongodb è¿è¡è§åæ ¡éªæ¶æ§è¡çæä½ï¼\n\n * å¦æ validationlevel æ¯ strictï¼ä¸¥æ ¼çº§å«ãè¿æ¯ mongodb é»è®¤çº§å«ï¼ï¼å mongodb å°æ ¡éªè§ååºç¨äºæææå¥åæ´æ°ã\n * å¦æ validationlevel æ¯ moderateï¼ä¸­ç­çº§å«ï¼ï¼å mongodb åªå¯¹å·²æ»¡è¶³æ ¡éªæ¡ä»¶çç°æææ¡£çæå¥åæ´æ°æä½è¿è¡æ ¡éªï¼å¯¹ä¸ç¬¦åæ ¡éªæ åçç°æææ¡£çæ´æ°æä½ä¸è¿è¡æ ¡éªã\n\nãç¤ºä¾ã\n\nä¸é¢æ¯ä¸ä¸ªæ­£å¸¸çæå¥æä½ï¼\n\ndb.contacts.insert([\n  {\n    _id: 1,\n    name: 'anne',\n    phone: '+1 555 123 456',\n    city: 'london',\n    status: 'complete'\n  },\n  { _id: 2, name: 'ivan', city: 'vancouver' }\n])\n\n\nå¨ collection ä¸éç½®ä¸ä¸ªæ ¡éªè§åï¼\n\ndb.runcommand({\n  collmod: 'contacts',\n  validator: {\n    $jsonschema: {\n      bsontype: 'object',\n      required: ['phone', 'name'],\n      properties: {\n        phone: {\n          bsontype: 'string',\n          description: 'must be a string and is required'\n        },\n        name: {\n          bsontype: 'string',\n          description: 'must be a string and is required'\n        }\n      }\n    }\n  },\n  validationlevel: 'moderate'\n})\n\n\nå contacts collection ç°å¨æ·»å äºå«ä¸­ç­çº§å«ï¼moderateï¼ validationlevel ç validatorï¼\n\n * å¦æå°è¯æ´æ° _idä¸º 1 çææ¡£ï¼å mongodb å°åºç¨æ ¡éªè§åï¼å ä¸ºç°æææ¡£ç¬¦åæ¡ä»¶ã\n\n * ç¸åï¼mongodb ä¸ä¼å°æ ¡éª _id ä¸º 2 çææ¡£ï¼å ä¸ºå®ä¸ç¬¦åæ ¡éªè§åã\n\nå¦æè¦å®å¨ç¦ç¨æ ¡éªï¼å¯ä»¥å° validationlevel ç½®ä¸º offã\n\n# æ¥åææç»æ æç document\n\n * å¦æ validationaction æ¯ errorï¼é»è®¤ï¼ï¼å mongodb æç»ä»»ä½è¿åæ ¡éªè§åçæå¥ææ´æ°ã\n * å¦æ validationaction æ¯ warnï¼mongodb ä¼è®°å½ææçè¿è§ï¼ä½åè®¸è¿è¡æå¥ææ´æ°ã\n\nãç¤ºä¾ã\n\nåå»ºéåæ¶ï¼éç½® validationaction ä¸º warnã\n\ndb.createcollection('contacts2', {\n  validator: {\n    $jsonschema: {\n      bsontype: 'object',\n      required: ['phone'],\n      properties: {\n        phone: {\n          bsontype: 'string',\n          description: 'must be a string and is required'\n        },\n        email: {\n          bsontype: 'string',\n          pattern: '@mongodb.com$',\n          description:\n            'must be a string and match the regular expression pattern'\n        },\n        status: {\n          enum: ['unknown', 'incomplete'],\n          description: 'can only be one of the enum values'\n        }\n      }\n    }\n  },\n  validationaction: 'warn'\n})\n\n\nå°è¯æå¥ä¸æ¡è¿è§è®°å½\n\n> db.contacts2.insert( { name: \"amanda\", status: \"updated\" } )\nwriteresult({ \"ninserted\" : 1 })\n\n\nmongodb åè®¸è¿æ¡æä½æ§è¡ï¼ä½æ¯æå¡å¨ä¼è®°å½ä¸åè­¦ä¿¡æ¯ã\n\n{\"t\":{\"$date\":\"2020-09-11t16:35:57.754+08:00\"},\"s\":\"w\",  \"c\":\"storage\",  \"id\":20294,   \"ctx\":\"conn14\",\"msg\":\"document would fail validation\",\"attr\":{\"namespace\":\"test.contacts2\",\"document\":{\"_id\":{\"$oid\":\"5f5b36ed8ea53d62a0b51c4e\"},\"name\":\"amanda\",\"status\":\"updated\"}}}\n\n\n# éå¶\n\nä¸è½å¨ adminãlocalãconfig è¿å ä¸ªç¹æ®çæ°æ®åºä¸­æå®æ ¡éªè§åã\n\nä¸è½å¨ system.* collection ä¸­æå®æ ¡éªã\n\n\n# åèèµæ\n\n * å®æ¹\n   * mongodb å®ç½\n   * mongodb github\n   * mongodb å®æ¹åè´¹æç¨\n * æç¨\n   * mongodb æç¨\n   * mongodb é«æè¯¾",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"MongoDB å»ºæ¨¡ç¤ºä¾",frontmatter:{title:"MongoDB å»ºæ¨¡ç¤ºä¾",date:"2020-09-12T10:43:53.000Z",categories:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],tags:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB","å»ºæ¨¡"],permalink:"/pages/88c7d3/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/04.%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/01.MongoDB/06.MongoDB%E5%BB%BA%E6%A8%A1%E7%A4%BA%E4%BE%8B.html",relativePath:"12.æ°æ®åº/04.ææ¡£æ°æ®åº/01.MongoDB/06.MongoDBå»ºæ¨¡ç¤ºä¾.md",key:"v-2d5a6152",path:"/pages/88c7d3/",headers:[{level:2,title:"å³ç³»åæ¨¡å",slug:"å³ç³»åæ¨¡å",normalizedTitle:"å³ç³»åæ¨¡å",charIndex:19},{level:3,title:"åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å",slug:"åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å",normalizedTitle:"åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å",charIndex:29},{level:4,title:"åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å - åµå¥å¼ææ¡£æ¨¡å¼",slug:"åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å-åµå¥å¼ææ¡£æ¨¡å¼",normalizedTitle:"åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å - åµå¥å¼ææ¡£æ¨¡å¼",charIndex:45},{level:4,title:"åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å - å­éæ¨¡å¼",slug:"åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å-å­éæ¨¡å¼",normalizedTitle:"åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å - å­éæ¨¡å¼",charIndex:466},{level:3,title:"åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å",slug:"åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å",normalizedTitle:"åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å",charIndex:3099},{level:4,title:"åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å - åµå¥å¼ææ¡£æ¨¡å¼",slug:"åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å-åµå¥å¼ææ¡£æ¨¡å¼",normalizedTitle:"åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å - åµå¥å¼ææ¡£æ¨¡å¼",charIndex:3115},{level:4,title:"åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å - å­éæ¨¡å¼",slug:"åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å-å­éæ¨¡å¼",normalizedTitle:"åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å - å­éæ¨¡å¼",charIndex:3788},{level:3,title:"å¼ç¨å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å",slug:"å¼ç¨å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å",normalizedTitle:"å¼ç¨å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å",charIndex:5670},{level:2,title:"æ å½¢ç»ææ¨¡å",slug:"æ å½¢ç»ææ¨¡å",normalizedTitle:"æ å½¢ç»ææ¨¡å",charIndex:7560},{level:3,title:"å·æç¶èç¹çæ å½¢ç»ææ¨¡å",slug:"å·æç¶èç¹çæ å½¢ç»ææ¨¡å",normalizedTitle:"å·æç¶èç¹çæ å½¢ç»ææ¨¡å",charIndex:7573},{level:3,title:"å·æå­èç¹çæ å½¢ç»ææ¨¡å",slug:"å·æå­èç¹çæ å½¢ç»ææ¨¡å",normalizedTitle:"å·æå­èç¹çæ å½¢ç»ææ¨¡å",charIndex:8181},{level:3,title:"å·æç¥åçæ å½¢ç»ææ¨¡å",slug:"å·æç¥åçæ å½¢ç»ææ¨¡å",normalizedTitle:"å·æç¥åçæ å½¢ç»ææ¨¡å",charIndex:8800},{level:3,title:"å·æå®ä½åè·¯å¾çæ å½¢ç»ææ¨¡å",slug:"å·æå®ä½åè·¯å¾çæ å½¢ç»ææ¨¡å",normalizedTitle:"å·æå®ä½åè·¯å¾çæ å½¢ç»ææ¨¡å",charIndex:9685},{level:3,title:"å·æåµå¥éçæ å½¢ç»ææ¨¡å",slug:"å·æåµå¥éçæ å½¢ç»ææ¨¡å",normalizedTitle:"å·æåµå¥éçæ å½¢ç»ææ¨¡å",charIndex:10414},{level:2,title:"è®¾è®¡æ¨¡å¼",slug:"è®¾è®¡æ¨¡å¼",normalizedTitle:"è®¾è®¡æ¨¡å¼",charIndex:11020},{level:3,title:"å¤§ææ¡£ï¼å¾å¤åï¼å¾å¤ç´¢å¼",slug:"å¤§ææ¡£-å¾å¤å-å¾å¤ç´¢å¼",normalizedTitle:"å¤§ææ¡£ï¼å¾å¤åï¼å¾å¤ç´¢å¼",charIndex:11029},{level:3,title:"ç®¡çææ¡£ä¸åçæ¬",slug:"ç®¡çææ¡£ä¸åçæ¬",normalizedTitle:"ç®¡çææ¡£ä¸åçæ¬",charIndex:11059},{level:3,title:"ç»è®¡ç½é¡µç¹å»é",slug:"ç»è®¡ç½é¡µç¹å»é",normalizedTitle:"ç»è®¡ç½é¡µç¹å»é",charIndex:11163},{level:3,title:"ç²¾ç¡®ç»è®¡",slug:"ç²¾ç¡®ç»è®¡",normalizedTitle:"ç²¾ç¡®ç»è®¡",charIndex:11248},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:11269}],headersStr:"å³ç³»åæ¨¡å åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å - åµå¥å¼ææ¡£æ¨¡å¼ åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å - å­éæ¨¡å¼ åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å - åµå¥å¼ææ¡£æ¨¡å¼ åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å - å­éæ¨¡å¼ å¼ç¨å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å æ å½¢ç»ææ¨¡å å·æç¶èç¹çæ å½¢ç»ææ¨¡å å·æå­èç¹çæ å½¢ç»ææ¨¡å å·æç¥åçæ å½¢ç»ææ¨¡å å·æå®ä½åè·¯å¾çæ å½¢ç»ææ¨¡å å·æåµå¥éçæ å½¢ç»ææ¨¡å è®¾è®¡æ¨¡å¼ å¤§ææ¡£ï¼å¾å¤åï¼å¾å¤ç´¢å¼ ç®¡çææ¡£ä¸åçæ¬ ç»è®¡ç½é¡µç¹å»é ç²¾ç¡®ç»è®¡ åèèµæ",content:'# MongoDB å»ºæ¨¡ç¤ºä¾\n\n\n# å³ç³»åæ¨¡å\n\n\n# åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å\n\n# åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å - åµå¥å¼ææ¡£æ¨¡å¼\n\n// patron document\n{\n   _id: "joe",\n   name: "Joe Bookreader"\n}\n\n// address document\n{\n   patron_id: "joe", // reference to patron document\n   street: "123 Fake Street",\n   city: "Faketon",\n   state: "MA",\n   zip: "12345"\n}\n\n\nåå¹¶ä¸ºï¼\n\n{\n  "_id": "joe",\n  "name": "Joe Bookreader",\n  "address": {\n    "street": "123 Fake Street",\n    "city": "Faketon",\n    "state": "MA",\n    "zip": "12345"\n  }\n}\n\n\n# åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å - å­éæ¨¡å¼\n\nåè®¾ï¼æä¸ä¸ªç¨äºæè¿°çµå½±ä¿¡æ¯ç collection å®ä¹ï¼\n\n{\n  "_id": 1,\n  "title": "The Arrival of a Train",\n  "year": 1896,\n  "runtime": 1,\n  "released": ISODate("01-25-1896"),\n  "poster": "http://ia.media-imdb.com/images/M/MV5BMjEyNDk5MDYzOV5BMl5BanBnXkFtZTgwNjIxMTEwMzE@._V1_SX300.jpg",\n  "plot": "A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, ...",\n  "fullplot": "A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, the line dissolves. The doors of the railway-cars open, and people on the platform help passengers to get off.",\n  "lastupdated": ISODate("2015-08-15T10:06:53"),\n  "type": "movie",\n  "directors": ["Auguste LumiÃ¨re", "Louis LumiÃ¨re"],\n  "imdb": {\n    "rating": 7.3,\n    "votes": 5043,\n    "id": 12\n  },\n  "countries": ["France"],\n  "genres": ["Documentary", "Short"],\n  "tomatoes": {\n    "viewer": {\n      "rating": 3.7,\n      "numReviews": 59\n    },\n    "lastUpdated": ISODate("2020-01-09T00:02:53")\n  }\n}\n\n\nå¨åºç¨ä¸­ï¼æçåºæ¯åªéè¦æ¾ç¤ºçµå½±çç®åæµè§ä¿¡æ¯ï¼ä¸éè¦æ¾ç¤ºç±»ä¼¼ fullplotãposter è¿æ ·çè¯¦ç»ä¿¡æ¯ãå ä¸ºï¼æä»¬å¯ä»¥èèå°åç»æä¸ä»½ä¸ºäºï¼å¹¶éè¿ id å­æ®µå³èèµ·æ¥ã\n\nç¨äºå±ç¤ºæè¦ä¿¡æ¯ç movie collection\n\n// movie collection\n\n{\n  "_id": 1,\n  "title": "The Arrival of a Train",\n  "year": 1896,\n  "runtime": 1,\n  "released": ISODate("1896-01-25"),\n  "type": "movie",\n  "directors": ["Auguste LumiÃ¨re", "Louis LumiÃ¨re"],\n  "countries": ["France"],\n  "genres": ["Documentary", "Short"]\n}\n\n\nç¨äºå±ç¤ºç»èä¿¡æ¯ç movie_details collection\n\n// movie_details collection\n\n{\n  "_id": 156,\n  "movie_id": 1, // reference to the movie collection\n  "poster": "http://ia.media-imdb.com/images/M/MV5BMjEyNDk5MDYzOV5BMl5BanBnXkFtZTgwNjIxMTEwMzE@._V1_SX300.jpg",\n  "plot": "A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, ...",\n  "fullplot": "A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, the line dissolves. The doors of the railway-cars open, and people on the platform help passengers to get off.",\n  "lastupdated": ISODate("2015-08-15T10:06:53"),\n  "imdb": {\n    "rating": 7.3,\n    "votes": 5043,\n    "id": 12\n  },\n  "tomatoes": {\n    "viewer": {\n      "rating": 3.7,\n      "numReviews": 59\n    },\n    "lastUpdated": ISODate("2020-01-29T00:02:53")\n  }\n}\n\n\n\n# åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å\n\n# åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å - åµå¥å¼ææ¡£æ¨¡å¼\n\n// patron document\n{\n   _id: "joe",\n   name: "Joe Bookreader"\n}\n\n// address documents\n{\n   patron_id: "joe", // reference to patron document\n   street: "123 Fake Street",\n   city: "Faketon",\n   state: "MA",\n   zip: "12345"\n}\n\n{\n   patron_id: "joe",\n   street: "1 Some Other Street",\n   city: "Boston",\n   state: "MA",\n   zip: "12345"\n}\n\n\nåå¹¶ä¸ºï¼\n\n{\n  "_id": "joe",\n  "name": "Joe Bookreader",\n  "addresses": [\n    {\n      "street": "123 Fake Street",\n      "city": "Faketon",\n      "state": "MA",\n      "zip": "12345"\n    },\n    {\n      "street": "1 Some Other Street",\n      "city": "Boston",\n      "state": "MA",\n      "zip": "12345"\n    }\n  ]\n}\n\n\n# åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å - å­éæ¨¡å¼\n\nèèä¸ä¸ªçµåç½ç«ç¨äºè¡¨ç¤ºååç collectionï¼\n\n{\n  "_id": 1,\n  "name": "Super Widget",\n  "description": "This is the most useful item in your toolbox.",\n  "price": { "value": NumberDecimal("119.99"), "currency": "USD" },\n  "reviews": [\n    {\n      "review_id": 786,\n      "review_author": "Kristina",\n      "review_text": "This is indeed an amazing widget.",\n      "published_date": ISODate("2019-02-18")\n    },\n    {\n      "review_id": 785,\n      "review_author": "Trina",\n      "review_text": "Nice product. Slow shipping.",\n      "published_date": ISODate("2019-02-17")\n    },\n    ...{\n      "review_id": 1,\n      "review_author": "Hans",\n      "review_text": "Meh, it\'s okay.",\n      "published_date": ISODate("2017-12-06")\n    }\n  ]\n}\n\n\nè¯è®ºææ¶é´ååºæåã å½ç¨æ·è®¿é®äº§åé¡µé¢æ¶ï¼åºç¨ç¨åºå°å è½½åæ¡æè¿çè¯è®ºãå¯ä»¥å°éååä¸ºä¸¤ä¸ªéåï¼èä¸æ¯ä¸äº§åä¸èµ·å­å¨ææè¯è®ºï¼\n\näº§åéåå­å¨æå³æ¯ä¸ªäº§åçä¿¡æ¯ï¼åæ¬äº§åçåä¸ªææ°è¯è®ºï¼\n\n{\n  "_id": 1,\n  "name": "Super Widget",\n  "description": "This is the most useful item in your toolbox.",\n  "price": { "value": NumberDecimal("119.99"), "currency": "USD" },\n  "reviews": [\n    {\n      "review_id": 786,\n      "review_author": "Kristina",\n      "review_text": "This is indeed an amazing widget.",\n      "published_date": ISODate("2019-02-18")\n    }\n    ...\n    {\n      "review_id": 776,\n      "review_author": "Pablo",\n      "review_text": "Amazing!",\n      "published_date": ISODate("2019-02-16")\n    }\n  ]\n}\n\n\nreview collection å­å¨ææçè¯è®º\n\n{\n  "review_id": 786,\n  "product_id": 1,\n  "review_author": "Kristina",\n  "review_text": "This is indeed an amazing widget.",\n  "published_date": ISODate("2019-02-18")\n}\n{\n  "review_id": 785,\n  "product_id": 1,\n  "review_author": "Trina",\n  "review_text": "Nice product. Slow shipping.",\n  "published_date": ISODate("2019-02-17")\n}\n...\n{\n  "review_id": 1,\n  "product_id": 1,\n  "review_author": "Hans",\n  "review_text": "Meh, it\'s okay.",\n  "published_date": ISODate("2017-12-06")\n}\n\n\n\n# å¼ç¨å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å\n\nèèä»¥ä¸æ å°åºçååä¹¦ç±å³ç³»çç¤ºä¾ã\n\nè¯¥ç¤ºä¾è¯´æäºå¼ç¨å¼ææ¡£çä¼ç¹ï¼ä»¥é¿åéå¤åå¸èä¿¡æ¯ã\n\n{\n   title: "MongoDB: The Definitive Guide",\n   author: [ "Kristina Chodorow", "Mike Dirolf" ],\n   published_date: ISODate("2010-09-24"),\n   pages: 216,\n   language: "English",\n   publisher: {\n              name: "O\'Reilly Media",\n              founded: 1980,\n              location: "CA"\n            }\n}\n\n{\n   title: "50 Tips and Tricks for MongoDB Developer",\n   author: "Kristina Chodorow",\n   published_date: ISODate("2011-05-06"),\n   pages: 68,\n   language: "English",\n   publisher: {\n              name: "O\'Reilly Media",\n              founded: 1980,\n              location: "CA"\n            }\n}\n\n\nä¸ºé¿åéå¤åºçåæ°æ®ï¼å¯ä»¥ä½¿ç¨å¼ç¨åææ¡£ï¼å¹¶å°åºçåä¿¡æ¯ä¸ä¹¦æ¬åå¼ä¿å­ã ä½¿ç¨å¼ç¨æ¶ï¼å³ç³»çå¢é¿å³å®äºå°å¼ç¨å­å¨å¨ä½å¤ã å¦ææ¯ä¸ªåºçåçå¾ä¹¦æ°éå¾å°ä¸å¢é¿æéï¼åææ¶å°å¾ä¹¦åèå­å¨å¨åºçåææ¡£ä¸­å¯è½ä¼å¾æç¨ã å¦åï¼å¦ææ¯ä¸ªåå¸èçä¹¦ç±æ°éä¸åéå¶ï¼åæ­¤æ°æ®æ¨¡åå°å¯¼è´å¯åçï¼ä¸æ­å¢é¿çæ°ç»ï¼å¦ä»¥ä¸ç¤ºä¾æç¤ºï¼\n\n{\n   name: "O\'Reilly Media",\n   founded: 1980,\n   location: "CA",\n   books: [123456789, 234567890, ...]\n}\n\n{\n    _id: 123456789,\n    title: "MongoDB: The Definitive Guide",\n    author: [ "Kristina Chodorow", "Mike Dirolf" ],\n    published_date: ISODate("2010-09-24"),\n    pages: 216,\n    language: "English"\n}\n\n{\n   _id: 234567890,\n   title: "50 Tips and Tricks for MongoDB Developer",\n   author: "Kristina Chodorow",\n   published_date: ISODate("2011-05-06"),\n   pages: 68,\n   language: "English"\n}\n\n\nä¸ºäºé¿åå¯åçï¼å¢é¿çæ°ç»ï¼è¯·å°åè¡èåèå­å¨å¨ä¹¦ç±ææ¡£ä¸­ï¼\n\n{\n   _id: "oreilly",\n   name: "O\'Reilly Media",\n   founded: 1980,\n   location: "CA"\n}\n\n{\n   _id: 123456789,\n   title: "MongoDB: The Definitive Guide",\n   author: [ "Kristina Chodorow", "Mike Dirolf" ],\n   published_date: ISODate("2010-09-24"),\n   pages: 216,\n   language: "English",\n   publisher_id: "oreilly"\n}\n\n{\n   _id: 234567890,\n   title: "50 Tips and Tricks for MongoDB Developer",\n   author: "Kristina Chodorow",\n   published_date: ISODate("2011-05-06"),\n   pages: 68,\n   language: "English",\n   publisher_id: "oreilly"\n}\n\n\n\n# æ å½¢ç»ææ¨¡å\n\n\n\n\n# å·æç¶èç¹çæ å½¢ç»ææ¨¡å\n\nä¸å¾ç»æå¯ä»¥ç¨ç¶å¼ç¨æ¥è¡¨ç¤ºï¼\n\ndb.categories.insertMany([\n  { "_id": "MongoDB", "parent": "Databases" },\n  { "_id": "dbm", "parent": "Databases" },\n  { "_id": "Databases", "parent": "Programming" },\n  { "_id": "Languages", "parent": "Programming" },\n  { "_id": "Programming", "parent": "Books" },\n  { "_id": "Books", "parent": null }\n])\n\n\n * æ£ç´¢èç¹çç¶èç¹ï¼\n   \n   db.categories.findOne( { _id: "MongoDB" } ).parent\n   \n\n * å¯ä»¥å¨ç¶å­æ®µä¸åå»ºç´¢å¼ä»¥å¯ç¨ç¶èç¹çå¿«éæç´¢ï¼\n   \n   db.categories.createIndex( { parent: 1 } )\n   \n\n * å¯ä»¥éè¿ç¶å­æ®µæ¥è¯¢æ¾å°å¶ç´æ¥å­èç¹ï¼\n   \n   db.categories.find( { parent: "Databases" } )\n   \n\n * æ£ç´¢å­æ ï¼å¯ä»¥åèï¼ $graphLookup.\n\n\n# å·æå­èç¹çæ å½¢ç»ææ¨¡å\n\ndb.categories.insertMany([\n  { "_id": "MongoDB", "children": [] },\n  { "_id": "dbm", "children": [] },\n  { "_id": "Databases", "children": ["MongoDB", "dbm"] },\n  { "_id": "Languages", "children": [] },\n  { "_id": "Programming", "children": ["Databases", "Languages"] },\n  { "_id": "Books", "children": ["Programming"] }\n])\n\n\n * æ£ç´¢èç¹ç childrenï¼\n   \n   db.categories.findOne( { _id: "Databases" } ).children\n   \n\n * å¯ä»¥å¨ children å­æ®µä¸åå»ºç´¢å¼ä»¥å¯ç¨å­èç¹çå¿«éæç´¢ï¼\n   \n   db.categories.createIndex( { children: 1 } )\n   \n\n * å¯ä»¥å¨ children å­æ®µä¸­æ¥è¯¢èç¹ï¼ä»¥æ¾å°å¶ç¶èç¹åå¶åå¼èç¹ï¼\n   \n   db.categories.find( { children: "MongoDB" } )\n   \n\n\n# å·æç¥åçæ å½¢ç»ææ¨¡å\n\ndb.categories.insertMany([\n  {\n    "_id": "MongoDB",\n    "ancestors": ["Books", "Programming", "Databases"],\n    "parent": "Databases"\n  },\n  {\n    "_id": "dbm",\n    "ancestors": ["Books", "Programming", "Databases"],\n    "parent": "Databases"\n  },\n  {\n    "_id": "Databases",\n    "ancestors": ["Books", "Programming"],\n    "parent": "Programming"\n  },\n  {\n    "_id": "Languages",\n    "ancestors": ["Books", "Programming"],\n    "parent": "Programming"\n  },\n  { "_id": "Programming", "ancestors": ["Books"], "parent": "Books" },\n  { "_id": "Books", "ancestors": [], "parent": null }\n])\n\n\n * æ£ç´¢èç¹çç¥åæè·¯å¾çæ¥è¯¢æ¯å¿«éèç´æ¥çï¼\n   \n   db.categories.findOne({ "_id": "MongoDB" }).ancestors\n   \n\n * å¯ä»¥å¨ ancestors å­æ®µä¸åå»ºç´¢å¼ï¼ä»¥å¯ç¨ç¥åèç¹çå¿«éæç´¢ï¼\n   \n   db.categories.createIndex({ "ancestors": 1 })\n   \n\n * å¯ä»¥éè¿ ancestors å­æ®µæ¥è¯¢æ¥æ¾å¶ææåä»£ï¼\n   \n   db.categories.find({ "ancestors": "Programming" })\n   \n\n\n# å·æå®ä½åè·¯å¾çæ å½¢ç»ææ¨¡å\n\ndb.categories.insertMany([\n  { "_id": "Books", "path": null },\n  { "_id": "Programming", "path": ",Books," },\n  { "_id": "Databases", "path": ",Books,Programming," },\n  { "_id": "Languages", "path": ",Books,Programming," },\n  { "_id": "MongoDB", "path": ",Books,Programming,Databases," },\n  { "_id": "dbm", "path": ",Books,Programming,Databases," }\n])\n\n\n * å¯ä»¥æ¥è¯¢ä»¥æ£ç´¢æ´ä¸ªæ ï¼å¹¶æå­æ®µè·¯å¾æåºï¼\n   \n   db.categories.find().sort( { path: 1 } )\n   \n\n * å¯ä»¥å¨ path å­æ®µä¸ä½¿ç¨æ­£åè¡¨è¾¾å¼æ¥æ¥æ¾ Programming çåä»£\n   \n   db.categories.find( { path: /,Programming,/ } )\n   \n\n * å¯ä»¥æ£ç´¢ Books çåä»£ï¼å¶ä¸­ Books ä¹ä½äºå±æ¬¡ç»æçæé«çº§å«ï¼\n   \n   db.categories.find( { path: /^,Books,/ } )\n   \n\n * è¦å¨ path å­æ®µä¸åå»ºç´¢å¼ï¼è¯·ä½¿ç¨ä»¥ä¸è°ç¨ï¼\n   \n   db.categories.createIndex( { path: 1 } )\n   \n\n\n# å·æåµå¥éçæ å½¢ç»ææ¨¡å\n\n\n\ndb.categories.insertMany([\n  { _id: \'Books\', parent: 0, left: 1, right: 12 },\n  { _id: \'Programming\', parent: \'Books\', left: 2, right: 11 },\n  { _id: \'Languages\', parent: \'Programming\', left: 3, right: 4 },\n  { _id: \'Databases\', parent: \'Programming\', left: 5, right: 10 },\n  { _id: \'MongoDB\', parent: \'Databases\', left: 6, right: 7 },\n  { _id: \'dbm\', parent: \'Databases\', left: 8, right: 9 }\n])\n\n\nå¯ä»¥æ¥è¯¢ä»¥æ£ç´¢èç¹çåä»£ï¼\n\nvar databaseCategory = db.categories.findOne({ _id: \'Databases\' })\ndb.categories.find({\n  left: { $gt: databaseCategory.left },\n  right: { $lt: databaseCategory.right }\n})\n\n\n\n# è®¾è®¡æ¨¡å¼\n\n\n# å¤§ææ¡£ï¼å¾å¤åï¼å¾å¤ç´¢å¼\n\nè§£å³æ¹æ¡æ¯ï¼åè½¬è¡\n\n\n\n\n# ç®¡çææ¡£ä¸åçæ¬\n\nMongoDB ææ¡£æ ¼å¼éå¸¸çµæ´»ï¼å¿å¿ä¼å¸¦æ¥çæ¬ç»´æ¤ä¸çé¾åº¦ã\n\nè§£å³æ¹æ¡æ¯ï¼å¯ä»¥å¢å ä¸ä¸ªçæ¬å·å­æ®µ\n\n * å¿«éè¿æ»¤æä¸éè¦åçº§çææ¡£\n * åçº§æ¶ï¼å¯¹ä¸åçæ¬çææ¡£åä¸åå¤ç\n\n\n# ç»è®¡ç½é¡µç¹å»é\n\nç»è®¡æ°æ®ç²¾ç¡®æ§è¦æ±å¹¶ä¸æ¯ååéè¦ã\n\nè§£å³æ¹æ¡ï¼ç¨è¿ä¼¼è®¡ç®\n\næ¯é 10 æ¬¡åä¸æ¬¡ï¼\n\n{ "$inc": { "views": 1 } }\n\n\n\n# ç²¾ç¡®ç»è®¡\n\nè§£å³æ¹æ¡ï¼ä½¿ç¨é¢èå\n\n\n# åèèµæ\n\n * Data Model Examples and Patterns',normalizedContent:'# mongodb å»ºæ¨¡ç¤ºä¾\n\n\n# å³ç³»åæ¨¡å\n\n\n# åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å\n\n# åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å - åµå¥å¼ææ¡£æ¨¡å¼\n\n// patron document\n{\n   _id: "joe",\n   name: "joe bookreader"\n}\n\n// address document\n{\n   patron_id: "joe", // reference to patron document\n   street: "123 fake street",\n   city: "faketon",\n   state: "ma",\n   zip: "12345"\n}\n\n\nåå¹¶ä¸ºï¼\n\n{\n  "_id": "joe",\n  "name": "joe bookreader",\n  "address": {\n    "street": "123 fake street",\n    "city": "faketon",\n    "state": "ma",\n    "zip": "12345"\n  }\n}\n\n\n# åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å - å­éæ¨¡å¼\n\nåè®¾ï¼æä¸ä¸ªç¨äºæè¿°çµå½±ä¿¡æ¯ç collection å®ä¹ï¼\n\n{\n  "_id": 1,\n  "title": "the arrival of a train",\n  "year": 1896,\n  "runtime": 1,\n  "released": isodate("01-25-1896"),\n  "poster": "http://ia.media-imdb.com/images/m/mv5bmjeyndk5mdyzov5bml5banbnxkftztgwnjixmtewmze@._v1_sx300.jpg",\n  "plot": "a group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. when the train stops at the platform, ...",\n  "fullplot": "a group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. when the train stops at the platform, the line dissolves. the doors of the railway-cars open, and people on the platform help passengers to get off.",\n  "lastupdated": isodate("2015-08-15t10:06:53"),\n  "type": "movie",\n  "directors": ["auguste lumiere", "louis lumiere"],\n  "imdb": {\n    "rating": 7.3,\n    "votes": 5043,\n    "id": 12\n  },\n  "countries": ["france"],\n  "genres": ["documentary", "short"],\n  "tomatoes": {\n    "viewer": {\n      "rating": 3.7,\n      "numreviews": 59\n    },\n    "lastupdated": isodate("2020-01-09t00:02:53")\n  }\n}\n\n\nå¨åºç¨ä¸­ï¼æçåºæ¯åªéè¦æ¾ç¤ºçµå½±çç®åæµè§ä¿¡æ¯ï¼ä¸éè¦æ¾ç¤ºç±»ä¼¼ fullplotãposter è¿æ ·çè¯¦ç»ä¿¡æ¯ãå ä¸ºï¼æä»¬å¯ä»¥èèå°åç»æä¸ä»½ä¸ºäºï¼å¹¶éè¿ id å­æ®µå³èèµ·æ¥ã\n\nç¨äºå±ç¤ºæè¦ä¿¡æ¯ç movie collection\n\n// movie collection\n\n{\n  "_id": 1,\n  "title": "the arrival of a train",\n  "year": 1896,\n  "runtime": 1,\n  "released": isodate("1896-01-25"),\n  "type": "movie",\n  "directors": ["auguste lumiere", "louis lumiere"],\n  "countries": ["france"],\n  "genres": ["documentary", "short"]\n}\n\n\nç¨äºå±ç¤ºç»èä¿¡æ¯ç movie_details collection\n\n// movie_details collection\n\n{\n  "_id": 156,\n  "movie_id": 1, // reference to the movie collection\n  "poster": "http://ia.media-imdb.com/images/m/mv5bmjeyndk5mdyzov5bml5banbnxkftztgwnjixmtewmze@._v1_sx300.jpg",\n  "plot": "a group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. when the train stops at the platform, ...",\n  "fullplot": "a group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. when the train stops at the platform, the line dissolves. the doors of the railway-cars open, and people on the platform help passengers to get off.",\n  "lastupdated": isodate("2015-08-15t10:06:53"),\n  "imdb": {\n    "rating": 7.3,\n    "votes": 5043,\n    "id": 12\n  },\n  "tomatoes": {\n    "viewer": {\n      "rating": 3.7,\n      "numreviews": 59\n    },\n    "lastupdated": isodate("2020-01-29t00:02:53")\n  }\n}\n\n\n\n# åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å\n\n# åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å - åµå¥å¼ææ¡£æ¨¡å¼\n\n// patron document\n{\n   _id: "joe",\n   name: "joe bookreader"\n}\n\n// address documents\n{\n   patron_id: "joe", // reference to patron document\n   street: "123 fake street",\n   city: "faketon",\n   state: "ma",\n   zip: "12345"\n}\n\n{\n   patron_id: "joe",\n   street: "1 some other street",\n   city: "boston",\n   state: "ma",\n   zip: "12345"\n}\n\n\nåå¹¶ä¸ºï¼\n\n{\n  "_id": "joe",\n  "name": "joe bookreader",\n  "addresses": [\n    {\n      "street": "123 fake street",\n      "city": "faketon",\n      "state": "ma",\n      "zip": "12345"\n    },\n    {\n      "street": "1 some other street",\n      "city": "boston",\n      "state": "ma",\n      "zip": "12345"\n    }\n  ]\n}\n\n\n# åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å - å­éæ¨¡å¼\n\nèèä¸ä¸ªçµåç½ç«ç¨äºè¡¨ç¤ºååç collectionï¼\n\n{\n  "_id": 1,\n  "name": "super widget",\n  "description": "this is the most useful item in your toolbox.",\n  "price": { "value": numberdecimal("119.99"), "currency": "usd" },\n  "reviews": [\n    {\n      "review_id": 786,\n      "review_author": "kristina",\n      "review_text": "this is indeed an amazing widget.",\n      "published_date": isodate("2019-02-18")\n    },\n    {\n      "review_id": 785,\n      "review_author": "trina",\n      "review_text": "nice product. slow shipping.",\n      "published_date": isodate("2019-02-17")\n    },\n    ...{\n      "review_id": 1,\n      "review_author": "hans",\n      "review_text": "meh, it\'s okay.",\n      "published_date": isodate("2017-12-06")\n    }\n  ]\n}\n\n\nè¯è®ºææ¶é´ååºæåã å½ç¨æ·è®¿é®äº§åé¡µé¢æ¶ï¼åºç¨ç¨åºå°å è½½åæ¡æè¿çè¯è®ºãå¯ä»¥å°éååä¸ºä¸¤ä¸ªéåï¼èä¸æ¯ä¸äº§åä¸èµ·å­å¨ææè¯è®ºï¼\n\näº§åéåå­å¨æå³æ¯ä¸ªäº§åçä¿¡æ¯ï¼åæ¬äº§åçåä¸ªææ°è¯è®ºï¼\n\n{\n  "_id": 1,\n  "name": "super widget",\n  "description": "this is the most useful item in your toolbox.",\n  "price": { "value": numberdecimal("119.99"), "currency": "usd" },\n  "reviews": [\n    {\n      "review_id": 786,\n      "review_author": "kristina",\n      "review_text": "this is indeed an amazing widget.",\n      "published_date": isodate("2019-02-18")\n    }\n    ...\n    {\n      "review_id": 776,\n      "review_author": "pablo",\n      "review_text": "amazing!",\n      "published_date": isodate("2019-02-16")\n    }\n  ]\n}\n\n\nreview collection å­å¨ææçè¯è®º\n\n{\n  "review_id": 786,\n  "product_id": 1,\n  "review_author": "kristina",\n  "review_text": "this is indeed an amazing widget.",\n  "published_date": isodate("2019-02-18")\n}\n{\n  "review_id": 785,\n  "product_id": 1,\n  "review_author": "trina",\n  "review_text": "nice product. slow shipping.",\n  "published_date": isodate("2019-02-17")\n}\n...\n{\n  "review_id": 1,\n  "product_id": 1,\n  "review_author": "hans",\n  "review_text": "meh, it\'s okay.",\n  "published_date": isodate("2017-12-06")\n}\n\n\n\n# å¼ç¨å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å\n\nèèä»¥ä¸æ å°åºçååä¹¦ç±å³ç³»çç¤ºä¾ã\n\nè¯¥ç¤ºä¾è¯´æäºå¼ç¨å¼ææ¡£çä¼ç¹ï¼ä»¥é¿åéå¤åå¸èä¿¡æ¯ã\n\n{\n   title: "mongodb: the definitive guide",\n   author: [ "kristina chodorow", "mike dirolf" ],\n   published_date: isodate("2010-09-24"),\n   pages: 216,\n   language: "english",\n   publisher: {\n              name: "o\'reilly media",\n              founded: 1980,\n              location: "ca"\n            }\n}\n\n{\n   title: "50 tips and tricks for mongodb developer",\n   author: "kristina chodorow",\n   published_date: isodate("2011-05-06"),\n   pages: 68,\n   language: "english",\n   publisher: {\n              name: "o\'reilly media",\n              founded: 1980,\n              location: "ca"\n            }\n}\n\n\nä¸ºé¿åéå¤åºçåæ°æ®ï¼å¯ä»¥ä½¿ç¨å¼ç¨åææ¡£ï¼å¹¶å°åºçåä¿¡æ¯ä¸ä¹¦æ¬åå¼ä¿å­ã ä½¿ç¨å¼ç¨æ¶ï¼å³ç³»çå¢é¿å³å®äºå°å¼ç¨å­å¨å¨ä½å¤ã å¦ææ¯ä¸ªåºçåçå¾ä¹¦æ°éå¾å°ä¸å¢é¿æéï¼åææ¶å°å¾ä¹¦åèå­å¨å¨åºçåææ¡£ä¸­å¯è½ä¼å¾æç¨ã å¦åï¼å¦ææ¯ä¸ªåå¸èçä¹¦ç±æ°éä¸åéå¶ï¼åæ­¤æ°æ®æ¨¡åå°å¯¼è´å¯åçï¼ä¸æ­å¢é¿çæ°ç»ï¼å¦ä»¥ä¸ç¤ºä¾æç¤ºï¼\n\n{\n   name: "o\'reilly media",\n   founded: 1980,\n   location: "ca",\n   books: [123456789, 234567890, ...]\n}\n\n{\n    _id: 123456789,\n    title: "mongodb: the definitive guide",\n    author: [ "kristina chodorow", "mike dirolf" ],\n    published_date: isodate("2010-09-24"),\n    pages: 216,\n    language: "english"\n}\n\n{\n   _id: 234567890,\n   title: "50 tips and tricks for mongodb developer",\n   author: "kristina chodorow",\n   published_date: isodate("2011-05-06"),\n   pages: 68,\n   language: "english"\n}\n\n\nä¸ºäºé¿åå¯åçï¼å¢é¿çæ°ç»ï¼è¯·å°åè¡èåèå­å¨å¨ä¹¦ç±ææ¡£ä¸­ï¼\n\n{\n   _id: "oreilly",\n   name: "o\'reilly media",\n   founded: 1980,\n   location: "ca"\n}\n\n{\n   _id: 123456789,\n   title: "mongodb: the definitive guide",\n   author: [ "kristina chodorow", "mike dirolf" ],\n   published_date: isodate("2010-09-24"),\n   pages: 216,\n   language: "english",\n   publisher_id: "oreilly"\n}\n\n{\n   _id: 234567890,\n   title: "50 tips and tricks for mongodb developer",\n   author: "kristina chodorow",\n   published_date: isodate("2011-05-06"),\n   pages: 68,\n   language: "english",\n   publisher_id: "oreilly"\n}\n\n\n\n# æ å½¢ç»ææ¨¡å\n\n\n\n\n# å·æç¶èç¹çæ å½¢ç»ææ¨¡å\n\nä¸å¾ç»æå¯ä»¥ç¨ç¶å¼ç¨æ¥è¡¨ç¤ºï¼\n\ndb.categories.insertmany([\n  { "_id": "mongodb", "parent": "databases" },\n  { "_id": "dbm", "parent": "databases" },\n  { "_id": "databases", "parent": "programming" },\n  { "_id": "languages", "parent": "programming" },\n  { "_id": "programming", "parent": "books" },\n  { "_id": "books", "parent": null }\n])\n\n\n * æ£ç´¢èç¹çç¶èç¹ï¼\n   \n   db.categories.findone( { _id: "mongodb" } ).parent\n   \n\n * å¯ä»¥å¨ç¶å­æ®µä¸åå»ºç´¢å¼ä»¥å¯ç¨ç¶èç¹çå¿«éæç´¢ï¼\n   \n   db.categories.createindex( { parent: 1 } )\n   \n\n * å¯ä»¥éè¿ç¶å­æ®µæ¥è¯¢æ¾å°å¶ç´æ¥å­èç¹ï¼\n   \n   db.categories.find( { parent: "databases" } )\n   \n\n * æ£ç´¢å­æ ï¼å¯ä»¥åèï¼ $graphlookup.\n\n\n# å·æå­èç¹çæ å½¢ç»ææ¨¡å\n\ndb.categories.insertmany([\n  { "_id": "mongodb", "children": [] },\n  { "_id": "dbm", "children": [] },\n  { "_id": "databases", "children": ["mongodb", "dbm"] },\n  { "_id": "languages", "children": [] },\n  { "_id": "programming", "children": ["databases", "languages"] },\n  { "_id": "books", "children": ["programming"] }\n])\n\n\n * æ£ç´¢èç¹ç childrenï¼\n   \n   db.categories.findone( { _id: "databases" } ).children\n   \n\n * å¯ä»¥å¨ children å­æ®µä¸åå»ºç´¢å¼ä»¥å¯ç¨å­èç¹çå¿«éæç´¢ï¼\n   \n   db.categories.createindex( { children: 1 } )\n   \n\n * å¯ä»¥å¨ children å­æ®µä¸­æ¥è¯¢èç¹ï¼ä»¥æ¾å°å¶ç¶èç¹åå¶åå¼èç¹ï¼\n   \n   db.categories.find( { children: "mongodb" } )\n   \n\n\n# å·æç¥åçæ å½¢ç»ææ¨¡å\n\ndb.categories.insertmany([\n  {\n    "_id": "mongodb",\n    "ancestors": ["books", "programming", "databases"],\n    "parent": "databases"\n  },\n  {\n    "_id": "dbm",\n    "ancestors": ["books", "programming", "databases"],\n    "parent": "databases"\n  },\n  {\n    "_id": "databases",\n    "ancestors": ["books", "programming"],\n    "parent": "programming"\n  },\n  {\n    "_id": "languages",\n    "ancestors": ["books", "programming"],\n    "parent": "programming"\n  },\n  { "_id": "programming", "ancestors": ["books"], "parent": "books" },\n  { "_id": "books", "ancestors": [], "parent": null }\n])\n\n\n * æ£ç´¢èç¹çç¥åæè·¯å¾çæ¥è¯¢æ¯å¿«éèç´æ¥çï¼\n   \n   db.categories.findone({ "_id": "mongodb" }).ancestors\n   \n\n * å¯ä»¥å¨ ancestors å­æ®µä¸åå»ºç´¢å¼ï¼ä»¥å¯ç¨ç¥åèç¹çå¿«éæç´¢ï¼\n   \n   db.categories.createindex({ "ancestors": 1 })\n   \n\n * å¯ä»¥éè¿ ancestors å­æ®µæ¥è¯¢æ¥æ¾å¶ææåä»£ï¼\n   \n   db.categories.find({ "ancestors": "programming" })\n   \n\n\n# å·æå®ä½åè·¯å¾çæ å½¢ç»ææ¨¡å\n\ndb.categories.insertmany([\n  { "_id": "books", "path": null },\n  { "_id": "programming", "path": ",books," },\n  { "_id": "databases", "path": ",books,programming," },\n  { "_id": "languages", "path": ",books,programming," },\n  { "_id": "mongodb", "path": ",books,programming,databases," },\n  { "_id": "dbm", "path": ",books,programming,databases," }\n])\n\n\n * å¯ä»¥æ¥è¯¢ä»¥æ£ç´¢æ´ä¸ªæ ï¼å¹¶æå­æ®µè·¯å¾æåºï¼\n   \n   db.categories.find().sort( { path: 1 } )\n   \n\n * å¯ä»¥å¨ path å­æ®µä¸ä½¿ç¨æ­£åè¡¨è¾¾å¼æ¥æ¥æ¾ programming çåä»£\n   \n   db.categories.find( { path: /,programming,/ } )\n   \n\n * å¯ä»¥æ£ç´¢ books çåä»£ï¼å¶ä¸­ books ä¹ä½äºå±æ¬¡ç»æçæé«çº§å«ï¼\n   \n   db.categories.find( { path: /^,books,/ } )\n   \n\n * è¦å¨ path å­æ®µä¸åå»ºç´¢å¼ï¼è¯·ä½¿ç¨ä»¥ä¸è°ç¨ï¼\n   \n   db.categories.createindex( { path: 1 } )\n   \n\n\n# å·æåµå¥éçæ å½¢ç»ææ¨¡å\n\n\n\ndb.categories.insertmany([\n  { _id: \'books\', parent: 0, left: 1, right: 12 },\n  { _id: \'programming\', parent: \'books\', left: 2, right: 11 },\n  { _id: \'languages\', parent: \'programming\', left: 3, right: 4 },\n  { _id: \'databases\', parent: \'programming\', left: 5, right: 10 },\n  { _id: \'mongodb\', parent: \'databases\', left: 6, right: 7 },\n  { _id: \'dbm\', parent: \'databases\', left: 8, right: 9 }\n])\n\n\nå¯ä»¥æ¥è¯¢ä»¥æ£ç´¢èç¹çåä»£ï¼\n\nvar databasecategory = db.categories.findone({ _id: \'databases\' })\ndb.categories.find({\n  left: { $gt: databasecategory.left },\n  right: { $lt: databasecategory.right }\n})\n\n\n\n# è®¾è®¡æ¨¡å¼\n\n\n# å¤§ææ¡£ï¼å¾å¤åï¼å¾å¤ç´¢å¼\n\nè§£å³æ¹æ¡æ¯ï¼åè½¬è¡\n\n\n\n\n# ç®¡çææ¡£ä¸åçæ¬\n\nmongodb ææ¡£æ ¼å¼éå¸¸çµæ´»ï¼å¿å¿ä¼å¸¦æ¥çæ¬ç»´æ¤ä¸çé¾åº¦ã\n\nè§£å³æ¹æ¡æ¯ï¼å¯ä»¥å¢å ä¸ä¸ªçæ¬å·å­æ®µ\n\n * å¿«éè¿æ»¤æä¸éè¦åçº§çææ¡£\n * åçº§æ¶ï¼å¯¹ä¸åçæ¬çææ¡£åä¸åå¤ç\n\n\n# ç»è®¡ç½é¡µç¹å»é\n\nç»è®¡æ°æ®ç²¾ç¡®æ§è¦æ±å¹¶ä¸æ¯ååéè¦ã\n\nè§£å³æ¹æ¡ï¼ç¨è¿ä¼¼è®¡ç®\n\næ¯é 10 æ¬¡åä¸æ¬¡ï¼\n\n{ "$inc": { "views": 1 } }\n\n\n\n# ç²¾ç¡®ç»è®¡\n\nè§£å³æ¹æ¡ï¼ä½¿ç¨é¢èå\n\n\n# åèèµæ\n\n * data model examples and patterns',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"MongoDB ç´¢å¼",frontmatter:{title:"MongoDB ç´¢å¼",date:"2020-09-21T21:22:57.000Z",categories:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],tags:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB","ç´¢å¼"],permalink:"/pages/10c674/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/04.%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/01.MongoDB/07.MongoDB%E7%B4%A2%E5%BC%95.html",relativePath:"12.æ°æ®åº/04.ææ¡£æ°æ®åº/01.MongoDB/07.MongoDBç´¢å¼.md",key:"v-2310a086",path:"/pages/10c674/",headers:[{level:2,title:"MongoDB ç´¢å¼ç®ä»",slug:"mongodb-ç´¢å¼ç®ä»",normalizedTitle:"mongodb ç´¢å¼ç®ä»",charIndex:17},{level:3,title:"ç´¢å¼çä½ç¨",slug:"ç´¢å¼çä½ç¨",normalizedTitle:"ç´¢å¼çä½ç¨",charIndex:34},{level:3,title:"createIndex() æ¹æ³",slug:"createindex-æ¹æ³",normalizedTitle:"createindex() æ¹æ³",charIndex:284},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:1542}],headersStr:"MongoDB ç´¢å¼ç®ä» ç´¢å¼çä½ç¨ createIndex() æ¹æ³ åèèµæ",content:'# MongoDB ç´¢å¼\n\n\n# MongoDB ç´¢å¼ç®ä»\n\n\n# ç´¢å¼çä½ç¨\n\nMongoDB å¨ collection æ°æ®çº§å«ä¸å®ä¹ç´¢å¼ã\n\nç´¢å¼éå¸¸è½å¤æå¤§çæé«æ¥è¯¢çæçãå¦ææ²¡æç´¢å¼ï¼MongoDB å¨è¯»åæ°æ®æ¶å¿é¡»æ«æ collection ä¸­çæ¯ä¸ª document å¹¶éåé£äºç¬¦åæ¥è¯¢æ¡ä»¶çè®°å½ã\n\nè¿ç§æ«æå¨éåçæ¥è¯¢æ¯éå¸¸ä½æçï¼ç¹å«æ¯å¨å¤çå¤§éçæ°æ®æ¶ãæ¥è¯¢å¯è½è¦è±è´¹å åç§çè³å åéï¼è¿ç§æ§è½å¼éæ¯ä¸å¯æ¥åçã\n\nç´¢å¼æ¯ç¹æ®çæ°æ®ç»æï¼ç´¢å¼å­å¨å¨ä¸ä¸ªæäºéåè¯»åçæ°æ®éåä¸­ï¼ç´¢å¼æ¯å¯¹æ°æ®åºè¡¨ä¸­ä¸åæå¤åçå¼è¿è¡æåºçä¸ç§ç»æã\n\n\n\n\n# createIndex() æ¹æ³\n\nMongoDB ä½¿ç¨ createIndex() æ¹æ³æ¥åå»ºç´¢å¼ã\n\ncreateIndex() è¯­æ³å¦ä¸ï¼\n\ndb.collection.createIndex( <key and index type specification>, <options> )\n\n\ncreateIndex() å¯éåæ°åè¡¨å¦ä¸ï¼\n\nPARAMETER            TYPE            DESCRIPTION\nbackground           Boolean         å»ºç´¢å¼è¿ç¨ä¼é»å¡å¶å®æ°æ®åºæä½ï¼background å¯æå®ä»¥åå°æ¹å¼åå»ºç´¢å¼ï¼å³å¢å  "background"\n                                     å¯éåæ°ã "background" é»è®¤å¼ä¸ºfalseã\nunique               Boolean         å»ºç«çç´¢å¼æ¯å¦å¯ä¸ãæå®ä¸º true åå»ºå¯ä¸ç´¢å¼ãé»è®¤å¼ä¸ºfalse.\nname                 string          ç´¢å¼çåç§°ãå¦ææªæå®ï¼MongoDB çéè¿è¿æ¥ç´¢å¼çå­æ®µååæåºé¡ºåºçæä¸ä¸ªç´¢å¼åç§°ã\ndropDups             Boolean         **3.0+çæ¬å·²åºå¼ã**å¨å»ºç«å¯ä¸ç´¢å¼æ¶æ¯å¦å é¤éå¤è®°å½,æå® true åå»ºå¯ä¸ç´¢å¼ãé»è®¤å¼ä¸º false.\nsparse               Boolean         å¯¹ææ¡£ä¸­ä¸å­å¨çå­æ®µæ°æ®ä¸å¯ç¨ç´¢å¼ï¼è¿ä¸ªåæ°éè¦ç¹å«æ³¨æï¼å¦æè®¾ç½®ä¸º true\n                                     çè¯ï¼å¨ç´¢å¼å­æ®µä¸­ä¸ä¼æ¥è¯¢åºä¸åå«å¯¹åºå­æ®µçææ¡£.ãé»è®¤å¼ä¸º false.\nexpireAfterSeconds   integer         æå®ä¸ä¸ªä»¥ç§ä¸ºåä½çæ°å¼ï¼å®æ TTL è®¾å®ï¼è®¾å®éåççå­æ¶é´ã\nv                    index version   ç´¢å¼ççæ¬å·ãé»è®¤çç´¢å¼çæ¬åå³äº mongod åå»ºç´¢å¼æ¶è¿è¡ççæ¬ã\nweights              document        ç´¢å¼æéå¼ï¼æ°å¼å¨ 1 å° 99,999 ä¹é´ï¼è¡¨ç¤ºè¯¥ç´¢å¼ç¸å¯¹äºå¶ä»ç´¢å¼å­æ®µçå¾åæéã\ndefault_language     string          å¯¹äºææ¬ç´¢å¼ï¼è¯¥åæ°å³å®äºåç¨è¯åè¯å¹²åè¯å¨çè§åçåè¡¨ã é»è®¤ä¸ºè±è¯­\nlanguage_override    string          å¯¹äºææ¬ç´¢å¼ï¼è¯¥åæ°æå®äºåå«å¨ææ¡£ä¸­çå­æ®µåï¼è¯­è¨è¦çé»è®¤ç languageï¼é»è®¤å¼ä¸º language.\n\nãç¤ºä¾ãä½¿ç¨ name ä½ä¸ºç´¢å¼ï¼å¹¶ä¸æç§éåºæåº\n\ndb.collection.createIndex( { name: -1 } )\n\n\n\n# åèèµæ\n\n * å®æ¹\n   * MongoDB å®ç½\n   * MongoDB Github\n   * MongoDB å®æ¹åè´¹æç¨\n * æç¨\n   * MongoDB æç¨\n   * MongoDB é«æè¯¾',normalizedContent:'# mongodb ç´¢å¼\n\n\n# mongodb ç´¢å¼ç®ä»\n\n\n# ç´¢å¼çä½ç¨\n\nmongodb å¨ collection æ°æ®çº§å«ä¸å®ä¹ç´¢å¼ã\n\nç´¢å¼éå¸¸è½å¤æå¤§çæé«æ¥è¯¢çæçãå¦ææ²¡æç´¢å¼ï¼mongodb å¨è¯»åæ°æ®æ¶å¿é¡»æ«æ collection ä¸­çæ¯ä¸ª document å¹¶éåé£äºç¬¦åæ¥è¯¢æ¡ä»¶çè®°å½ã\n\nè¿ç§æ«æå¨éåçæ¥è¯¢æ¯éå¸¸ä½æçï¼ç¹å«æ¯å¨å¤çå¤§éçæ°æ®æ¶ãæ¥è¯¢å¯è½è¦è±è´¹å åç§çè³å åéï¼è¿ç§æ§è½å¼éæ¯ä¸å¯æ¥åçã\n\nç´¢å¼æ¯ç¹æ®çæ°æ®ç»æï¼ç´¢å¼å­å¨å¨ä¸ä¸ªæäºéåè¯»åçæ°æ®éåä¸­ï¼ç´¢å¼æ¯å¯¹æ°æ®åºè¡¨ä¸­ä¸åæå¤åçå¼è¿è¡æåºçä¸ç§ç»æã\n\n\n\n\n# createindex() æ¹æ³\n\nmongodb ä½¿ç¨ createindex() æ¹æ³æ¥åå»ºç´¢å¼ã\n\ncreateindex() è¯­æ³å¦ä¸ï¼\n\ndb.collection.createindex( <key and index type specification>, <options> )\n\n\ncreateindex() å¯éåæ°åè¡¨å¦ä¸ï¼\n\nparameter            type            description\nbackground           boolean         å»ºç´¢å¼è¿ç¨ä¼é»å¡å¶å®æ°æ®åºæä½ï¼background å¯æå®ä»¥åå°æ¹å¼åå»ºç´¢å¼ï¼å³å¢å  "background"\n                                     å¯éåæ°ã "background" é»è®¤å¼ä¸ºfalseã\nunique               boolean         å»ºç«çç´¢å¼æ¯å¦å¯ä¸ãæå®ä¸º true åå»ºå¯ä¸ç´¢å¼ãé»è®¤å¼ä¸ºfalse.\nname                 string          ç´¢å¼çåç§°ãå¦ææªæå®ï¼mongodb çéè¿è¿æ¥ç´¢å¼çå­æ®µååæåºé¡ºåºçæä¸ä¸ªç´¢å¼åç§°ã\ndropdups             boolean         **3.0+çæ¬å·²åºå¼ã**å¨å»ºç«å¯ä¸ç´¢å¼æ¶æ¯å¦å é¤éå¤è®°å½,æå® true åå»ºå¯ä¸ç´¢å¼ãé»è®¤å¼ä¸º false.\nsparse               boolean         å¯¹ææ¡£ä¸­ä¸å­å¨çå­æ®µæ°æ®ä¸å¯ç¨ç´¢å¼ï¼è¿ä¸ªåæ°éè¦ç¹å«æ³¨æï¼å¦æè®¾ç½®ä¸º true\n                                     çè¯ï¼å¨ç´¢å¼å­æ®µä¸­ä¸ä¼æ¥è¯¢åºä¸åå«å¯¹åºå­æ®µçææ¡£.ãé»è®¤å¼ä¸º false.\nexpireafterseconds   integer         æå®ä¸ä¸ªä»¥ç§ä¸ºåä½çæ°å¼ï¼å®æ ttl è®¾å®ï¼è®¾å®éåççå­æ¶é´ã\nv                    index version   ç´¢å¼ççæ¬å·ãé»è®¤çç´¢å¼çæ¬åå³äº mongod åå»ºç´¢å¼æ¶è¿è¡ççæ¬ã\nweights              document        ç´¢å¼æéå¼ï¼æ°å¼å¨ 1 å° 99,999 ä¹é´ï¼è¡¨ç¤ºè¯¥ç´¢å¼ç¸å¯¹äºå¶ä»ç´¢å¼å­æ®µçå¾åæéã\ndefault_language     string          å¯¹äºææ¬ç´¢å¼ï¼è¯¥åæ°å³å®äºåç¨è¯åè¯å¹²åè¯å¨çè§åçåè¡¨ã é»è®¤ä¸ºè±è¯­\nlanguage_override    string          å¯¹äºææ¬ç´¢å¼ï¼è¯¥åæ°æå®äºåå«å¨ææ¡£ä¸­çå­æ®µåï¼è¯­è¨è¦çé»è®¤ç languageï¼é»è®¤å¼ä¸º language.\n\nãç¤ºä¾ãä½¿ç¨ name ä½ä¸ºç´¢å¼ï¼å¹¶ä¸æç§éåºæåº\n\ndb.collection.createindex( { name: -1 } )\n\n\n\n# åèèµæ\n\n * å®æ¹\n   * mongodb å®ç½\n   * mongodb github\n   * mongodb å®æ¹åè´¹æç¨\n * æç¨\n   * mongodb æç¨\n   * mongodb é«æè¯¾',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"MongoDB å¤å¶",frontmatter:{title:"MongoDB å¤å¶",date:"2020-09-20T23:12:17.000Z",categories:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],tags:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB","å¤å¶"],permalink:"/pages/505407/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/04.%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/01.MongoDB/08.MongoDB%E5%A4%8D%E5%88%B6.html",relativePath:"12.æ°æ®åº/04.ææ¡£æ°æ®åº/01.MongoDB/08.MongoDBå¤å¶.md",key:"v-0b02d45b",path:"/pages/505407/",headers:[{level:2,title:"å¯æ¬åå¯ç¨æ§",slug:"å¯æ¬åå¯ç¨æ§",normalizedTitle:"å¯æ¬åå¯ç¨æ§",charIndex:17},{level:2,title:"MongoDB å¯æ¬",slug:"mongodb-å¯æ¬",normalizedTitle:"mongodb å¯æ¬",charIndex:214},{level:2,title:"å¼æ­¥å¤å¶",slug:"å¼æ­¥å¤å¶",normalizedTitle:"å¼æ­¥å¤å¶",charIndex:689},{level:3,title:"æ¢æä½",slug:"æ¢æä½",normalizedTitle:"æ¢æä½",charIndex:698},{level:3,title:"å¤å¶å»¶è¿åæµæ§",slug:"å¤å¶å»¶è¿åæµæ§",normalizedTitle:"å¤å¶å»¶è¿åæµæ§",charIndex:970},{level:2,title:"æéè½¬ç§»",slug:"æéè½¬ç§»",normalizedTitle:"æéè½¬ç§»",charIndex:1291},{level:2,title:"è¯»æä½",slug:"è¯»æä½",normalizedTitle:"è¯»æä½",charIndex:1935},{level:3,title:"è¯»ä¼å",slug:"è¯»ä¼å",normalizedTitle:"è¯»ä¼å",charIndex:1943},{level:3,title:"æ°æ®å¯è§æ§",slug:"æ°æ®å¯è§æ§",normalizedTitle:"æ°æ®å¯è§æ§",charIndex:2085},{level:3,title:"éåè¯»å",slug:"éåè¯»å",normalizedTitle:"éåè¯»å",charIndex:1880},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:2645}],headersStr:"å¯æ¬åå¯ç¨æ§ MongoDB å¯æ¬ å¼æ­¥å¤å¶ æ¢æä½ å¤å¶å»¶è¿åæµæ§ æéè½¬ç§» è¯»æä½ è¯»ä¼å æ°æ®å¯è§æ§ éåè¯»å åèèµæ",content:'# MongoDB å¤å¶\n\n\n# å¯æ¬åå¯ç¨æ§\n\nå¯æ¬å¯ä»¥æä¾åä½å¹¶æé«æ°æ®å¯ç¨æ§ãå¨ä¸åæ°æ®åºæå¡å¨ä¸ä½¿ç¨å¤ä¸ªæ°æ®å¯æ¬ï¼å¯ä»¥æä¾ä¸å®ç¨åº¦çå®¹éè½åï¼ä»¥é²æ­¢åä¸ªæ°æ®åºæå¡å¨å®æºæ¶ï¼æ°æ®ä¸¢å¤±ã\n\nå¨æäºæåµä¸ï¼å¯æ¬è¿å¯ä»¥æä¾æ´å¤§çè¯»åååéãå ä¸ºå®¢æ·ç«¯å¯ä»¥å°è¯»åæä½åéå°ä¸åçæå¡å¨ãå¨ä¸åæ°æ®ä¸­å¿ä¸­ç»´æ¤æ°æ®å¯æ¬å¯ä»¥æé«æ°æ®æ¬å°æ§ååå¸å¼åºç¨ç¨åºçå¯ç¨æ§ãæ¨è¿å¯ä»¥ç»´æ¤å¶ä»å¯æ¬ä»¥ç¨äºä¸ç¨ç®çï¼ä¾å¦ç¾é¾æ¢å¤ï¼æ¥åæå¤ä»½ã\n\n\n# MongoDB å¯æ¬\n\nMongoDB ä¸­çå¯æ¬éæ¯ä¸ç»ç»´æ¤ç¸åæ°æ®éç mongod è¿ç¨ãä¸ä¸ªå¯æ¬éåå«å¤ä¸ªæ°æ®æ¿è½½èç¹åä¸ä¸ªä»²è£å¨èç¹ï¼å¯éï¼ãå¨æ°æ®æ¿è½½èç¹ä¸­ï¼åªæä¸ä¸ªæåè¢«è§ä¸ºä¸»è¦èç¹ï¼èå¶ä»èç¹åè¢«è§ä¸ºæ¬¡è¦èç¹ã\n\nä¸»èç¹è´è´£æ¥æ¶ææåæä½ãå¯æ¬éåªè½æä¸ä¸ªä¸»å¯æ¬ï¼è½å¤ä»¥ { w: "majority" } æ¥ç¡®è®¤éç¾¤ä¸­èç¹çåæä½æåæåµï¼å°½ç®¡å¨æäºæåµä¸ï¼å¦ä¸ä¸ª MongoDB å®ä¾å¯è½ä¼ææ¶è®¤ä¸ºèªå·±ä¹æ¯ä¸»è¦çãä¸»èç¹å¨å¶æä½æ¥å¿ï¼å³ oplogï¼ä¸­è®°å½äºå¯¹å¶æ°æ®éçæææ´æ¹ã\n\n\n\nä»èç¹å¤å¶ä¸»èç¹çæä½æ¥å¿ï¼å¹¶å°æä½åºç¨äºå¶æ°æ®éï¼ä»¥ä¾¿åæ­¥ä¸»èç¹çæ°æ®ãå¦æä¸»èç¹ä¸å¯ç¨ï¼åç¬¦åæ¡ä»¶çä»èç¹å°éä¸¾æ°çä¸»èç¹ã\n\n\n\nå¨æäºæåµä¸ï¼ä¾å¦ï¼æä¸ä¸ªä¸»èç¹åä¸ä¸ªä»èç¹ï¼ä½ç±äºææ¬éå¶ï¼ç¦æ­¢æ·»å å¦ä¸ä¸ªä»èç¹ï¼ï¼æ¨å¯ä»¥éæ©å° mongod å®ä¾ä½ä¸ºä»²è£èç¹æ·»å å°å¯æ¬éãä»²è£èç¹åå éä¸¾ä½ä¸ä¿å­æ°æ®ï¼å³ä¸æä¾æ°æ®åä½ï¼ã\n\n\n\nä»²è£èç¹å°æ°¸è¿æ¯ä»²è£èç¹ãå¨éä¸¾æé´ï¼ä¸»èç¹å¯è½ä¼éçº§æä¸ºæ¬¡èç¹ï¼èæ¬¡èç¹å¯è½ä¼åçº§æä¸ºä¸»èç¹ã\n\n\n# å¼æ­¥å¤å¶\n\n\n# æ¢æä½\n\nä»èç¹å¤å¶ä¸»èç¹çæä½æ¥å¿ï¼å¹¶å°æä½å¼æ­¥åºç¨äºå¶æ°æ®éãéè¿ä»èç¹åæ­¥ä¸»èç¹çæ°æ®éï¼å³ä½¿ä¸ä¸ªæå¤ä¸ªæåå¤±è´¥ï¼å¯æ¬éï¼MongoDB éç¾¤ï¼ä¹å¯ä»¥ç»§ç»­è¿è¡ã\n\nä» 4.2 çæ¬å¼å§ï¼å¯æ¬éçä»èç¹è®°å½æ¢æä½ï¼æä½æ¶é´æ¯è®¾ç½®çéå¼é¿ï¼çæ¥å¿æ¡ç®ãè¿äºæ¢æä½å¨ REPL ç»ä»¶ä¸ç è¯æ­æ¥å¿ ä¸­è®°å½äºæ¥å¿æ¶æ¯ï¼å¹¶ä½¿ç¨äºææ¬ op: <oplog entry> è±è´¹äº <num>msãè¿äºæ¢æä½æ¥å¿æ¡ç®ä»åå³äºæ¢æä½éå¼ï¼èä¸åå³äºæ¥å¿çº§å«ï¼å¨ç³»ç»çº§å«æç»ä»¶çº§å«ï¼ï¼éç½®çº§å«æè¿è¡ç¼æ¢çéæ ·çãæ¢æ¥å¨ä¸ä¼æè·ç¼æ¢çæä½æ¥å¿æ¡ç®ã\n\n\n# å¤å¶å»¶è¿åæµæ§\n\nå¤å¶å»¶è¿ï¼Replication lagï¼æ¯æå°ä¸»èç¹ä¸çåæä½å¤å¶å°ä»èç¹ä¸æè±è´¹çæ¶é´ãè¾ç­çå»¶è¿æ¶é´æ¯å¯ä»¥æ¥åçï¼ä½æ¯éçå¤å¶å»¶è¿çå¢å ï¼å¯è½ä¼åºç°ä¸¥éçé®é¢ï¼æ¯å¦å¨ä¸»èç¹ä¸çç¼å­ååã\n\nä» MongoDB 4.2 å¼å§ï¼ç®¡çåå¯ä»¥éå¶ä¸»èç¹çåå¥éçï¼ä½¿å¾å¤§å¤æ°å»¶è¿æ¶é´ä¿æå¨å¯éç½®çæå¤§å¼ flowControlTargetLagSeconds ä»¥ä¸ã\n\né»è®¤æåµä¸ï¼æµæ§æ¯å¼å¯çã\n\nå¯ç¨æµæ§åï¼éçå»¶è¿æ¶é´è¶æ¥è¶æ¥è¿ flowControlTargetLagSecondsï¼ä¸»å¯¹è±¡ä¸çåæä½å¿é¡»åè·å¾ä»¤çï¼ç¶åæè½è¿è¡éå®å¹¶æ§è¡åæä½ãéè¿éå¶æ¯ç§ååºçä»¤çæ°éï¼æµæ§æºå¶å°è¯å°å»¶è¿ä¿æå¨ç®æ ä»¥ä¸ã\n\n\n# æéè½¬ç§»\n\nå½ä¸»èç¹ä¸éç¾¤ä¸­çå¶ä»æåéä¿¡çæ¶é´è¶è¿éç½®ç electionTimeoutMillisï¼é»è®¤ä¸º 10 ç§ï¼æ¶ï¼ç¬¦åéä¸¾è¦æ±çä»èç¹å°è¦æ±éä¸¾ï¼å¹¶æåèªå·±ä¸ºæ°çä¸»èç¹ãéç¾¤å°è¯å®æéä¸¾æ°ä¸»èç¹å¹¶æ¢å¤æ­£å¸¸å·¥ä½ã\n\n\n\néä¸¾å®æåï¼å¯æ¬éæ æ³å¤çåå¥æä½ãå¦æå°å¯æ¬ééç½®ä¸ºï¼å¨ä¸»èç¹å¤äºè±æºç¶ææ¶ï¼å¨æ¬¡èç¹ä¸è¿è¡ï¼åå¯æ¬éå¯ä»¥ç»§ç»­æä¾è¯»åæ¥è¯¢ã\n\nåè®¾å¯æ¬éç½®éç¨é»è®¤éç½®ï¼åéç¾¤éæ©æ°èç¹çæ¶é´éå¸¸ä¸åºè¶è¿ 12 ç§ï¼è¿åæ¬ï¼å°ä¸»èç¹æ è®°ä¸ºä¸å¯ç¨å¹¶å®æéä¸¾æéçæ¶é´ãå¯ä»¥éè¿ä¿®æ¹ settings.electionTimeoutMillis éç½®éé¡¹æ¥è°æ´æ­¤æ¶é´ãç½ç»å»¶è¿ç­å ç´ å¯è½ä¼å»¶é¿å®æéä¸¾æéçæ¶é´ï¼è¿èå½±åéç¾¤å¨æ²¡æä¸»èç¹çæåµä¸å¯ä»¥è¿è¡çæ¶é´ãè¿äºå ç´ åå³äºéç¾¤å®éçæåµã\n\nå°é»è®¤ä¸º 10 ç§ç electionTimeoutMillis éé¡¹æ°å¼ç¼©å°ï¼å¯ä»¥æ´å¿«å°æ£æµå°ä¸»è¦æéãä½æ¯ï¼ç±äºç½ç»å»¶è¿ç­å ç´ ï¼éç¾¤å¯è½ä¼æ´é¢ç¹å°è¿è¡éä¸¾ï¼å³ä½¿è¯¥ä¸»èç¹å®éä¸å¤äºå¥åº·ç¶æãè¿å¯è½å¯¼è´ w : 1 åæä½çåæ»æ¬¡æ°å¢å ã\n\nåºç¨ç¨åºçè¿æ¥é»è¾åºåæ¬å¯¹èªå¨æéè½¬ç§»ååç»­éä¸¾çå®¹éå¤çãä» MongoDB 3.6 å¼å§ï¼MongoDB é©±å¨ç¨åºå¯ä»¥æ£æµå°ä¸»èç¹çå¤±èï¼å¹¶å¯ä»¥èªå¨éè¯ä¸æ¬¡æäºåå¥æä½ã\n\nä» MongoDB4.4 å¼å§ï¼MongoDB æä¾éåè¯»åï¼å°å¯éä¸¾çä»èç¹çæè¿è®¿é®çæ°æ®ï¼é¢ç­ä¸ºç¼å­ãé¢ç­ä»èç¹çç¼å­å¯ä»¥å¸®å©å¨éä¸¾åæ´å¿«å°æ¢å¤ã\n\n\n# è¯»æä½\n\n\n# è¯»ä¼å\n\né»è®¤æåµä¸ï¼å®¢æ·ç«¯ä»ä¸»èç¹è¯»åæ°æ®ï¼ä½æ¯ï¼å®¢æ·ç«¯å¯ä»¥æå®è¯»åé¦éé¡¹ï¼ä»¥å°è¯»åæä½åéå°ä»èç¹ã\n\n\n\nå¼æ­¥å¤å¶å°ä»èç¹æå³çåä»èç¹è¯»åæ°æ®å¯è½ä¼è¿åä¸ä¸»èç¹ä¸ä¸è´çæ°æ®ã\n\nåå«è¯»åæä½çå¤ææ¡£äºå¡å¿é¡»ä½¿ç¨è¯»åä¸»èç¹ä¼åãç»å®äºå¡ä¸­çæææä½å¿é¡»è·¯ç±å°åä¸æåã\n\n\n# æ°æ®å¯è§æ§\n\næ ¹æ®è¯»åçå³æ³¨ç¹ï¼å®¢æ·ç«¯å¯ä»¥å¨æä¹ååå¥åæ¥çåå¥ç»æï¼\n\n * ä¸ç®¡åç write concern å¦ä½è®¾ç½®ï¼å¶ä»ä½¿ç¨ "local" æ "available" çè¯»éç½®çå®¢æ·ç«¯é½å¯ä»¥ååå¸å®¢æ·ç«¯ç¡®è®¤åæä½ä¹åçå°åæä½çç»æã\n * ä½¿ç¨ "local" æ "available" è¯»åéç½®çå®¢æ·ç«¯å¯ä»¥è¯»åæ°æ®ï¼è¿äºæ°æ®éåå¯è½ä¼å¨å¯æ¬éæéè½¬ç§»æé´åæ»ã\n\nå¯¹äºå¤ææ¡£äºå¡ä¸­çæä½ï¼å½äºå¡æäº¤æ¶ï¼å¨äºå¡ä¸­è¿è¡çæææ°æ®æ´æ¹é½å°ä¿å­ï¼å¹¶å¨äºå¡å¤é¨å¯è§ãä¹å°±æ¯è¯´ï¼äºå¡å¨åæ»å¶ä»äºå¡æ¶å°ä¸ä¼æäº¤å¶æäºæ´æ¹ãå¨æäº¤äºå¡åï¼äºå¡å¤é¨çä¸å°å¨äºå¡ä¸­è¿è¡çæ°æ®æ´æ¹ã\n\nä½æ¯ï¼å½äºå¡åå¥å¤ä¸ªåçæ¶ï¼å¹¶éææå¤é¨è¯»æä½é½éè¦ç­å¾å·²æäº¤äºå¡çç»æå¨ææåçä¸å¯è§ãä¾å¦ï¼å¦ææäº¤äºä¸ä¸ªäºå¡ï¼å¹¶ä¸å¨åç A ä¸å¯ä»¥çå°å 1ï¼ä½æ¯å¨åç B ä¸è¿çä¸å°å 2ï¼åå¨ "local" è¯»éç½®çº§å«ï¼å¤é¨è¯»åå¯ä»¥è¯»åå 1 çç»æèçä¸å°å 2ã\n\n\n# éåè¯»å\n\nä» MongoDB 4.4 å¼å§ï¼MongoDB æä¾éåè¯»åä»¥é¢ç­å¯éä»èç¹ï¼å³ä¼åçº§å¤§äº 0 çæåï¼çç¼å­ãä½¿ç¨éåè¯»åï¼é»è®¤æåµä¸å·²å¯ç¨ï¼ï¼ä¸»èç¹å¯ä»¥éåå®æ¥æ¶å°çä¸é¨åæä½ï¼å¹¶å°å¶åéç»å¯éæ©çä»èç¹çå­éãå­éçå¤§å°æ¯å¯éç½®çã\n\n\n# åèèµæ\n\n * å®æ¹\n   * MongoDB å®ç½\n   * MongoDB Github\n   * MongoDB å®æ¹åè´¹æç¨\n * æç¨\n   * MongoDB æç¨\n   * MongoDB é«æè¯¾',normalizedContent:'# mongodb å¤å¶\n\n\n# å¯æ¬åå¯ç¨æ§\n\nå¯æ¬å¯ä»¥æä¾åä½å¹¶æé«æ°æ®å¯ç¨æ§ãå¨ä¸åæ°æ®åºæå¡å¨ä¸ä½¿ç¨å¤ä¸ªæ°æ®å¯æ¬ï¼å¯ä»¥æä¾ä¸å®ç¨åº¦çå®¹éè½åï¼ä»¥é²æ­¢åä¸ªæ°æ®åºæå¡å¨å®æºæ¶ï¼æ°æ®ä¸¢å¤±ã\n\nå¨æäºæåµä¸ï¼å¯æ¬è¿å¯ä»¥æä¾æ´å¤§çè¯»åååéãå ä¸ºå®¢æ·ç«¯å¯ä»¥å°è¯»åæä½åéå°ä¸åçæå¡å¨ãå¨ä¸åæ°æ®ä¸­å¿ä¸­ç»´æ¤æ°æ®å¯æ¬å¯ä»¥æé«æ°æ®æ¬å°æ§ååå¸å¼åºç¨ç¨åºçå¯ç¨æ§ãæ¨è¿å¯ä»¥ç»´æ¤å¶ä»å¯æ¬ä»¥ç¨äºä¸ç¨ç®çï¼ä¾å¦ç¾é¾æ¢å¤ï¼æ¥åæå¤ä»½ã\n\n\n# mongodb å¯æ¬\n\nmongodb ä¸­çå¯æ¬éæ¯ä¸ç»ç»´æ¤ç¸åæ°æ®éç mongod è¿ç¨ãä¸ä¸ªå¯æ¬éåå«å¤ä¸ªæ°æ®æ¿è½½èç¹åä¸ä¸ªä»²è£å¨èç¹ï¼å¯éï¼ãå¨æ°æ®æ¿è½½èç¹ä¸­ï¼åªæä¸ä¸ªæåè¢«è§ä¸ºä¸»è¦èç¹ï¼èå¶ä»èç¹åè¢«è§ä¸ºæ¬¡è¦èç¹ã\n\nä¸»èç¹è´è´£æ¥æ¶ææåæä½ãå¯æ¬éåªè½æä¸ä¸ªä¸»å¯æ¬ï¼è½å¤ä»¥ { w: "majority" } æ¥ç¡®è®¤éç¾¤ä¸­èç¹çåæä½æåæåµï¼å°½ç®¡å¨æäºæåµä¸ï¼å¦ä¸ä¸ª mongodb å®ä¾å¯è½ä¼ææ¶è®¤ä¸ºèªå·±ä¹æ¯ä¸»è¦çãä¸»èç¹å¨å¶æä½æ¥å¿ï¼å³ oplogï¼ä¸­è®°å½äºå¯¹å¶æ°æ®éçæææ´æ¹ã\n\n\n\nä»èç¹å¤å¶ä¸»èç¹çæä½æ¥å¿ï¼å¹¶å°æä½åºç¨äºå¶æ°æ®éï¼ä»¥ä¾¿åæ­¥ä¸»èç¹çæ°æ®ãå¦æä¸»èç¹ä¸å¯ç¨ï¼åç¬¦åæ¡ä»¶çä»èç¹å°éä¸¾æ°çä¸»èç¹ã\n\n\n\nå¨æäºæåµä¸ï¼ä¾å¦ï¼æä¸ä¸ªä¸»èç¹åä¸ä¸ªä»èç¹ï¼ä½ç±äºææ¬éå¶ï¼ç¦æ­¢æ·»å å¦ä¸ä¸ªä»èç¹ï¼ï¼æ¨å¯ä»¥éæ©å° mongod å®ä¾ä½ä¸ºä»²è£èç¹æ·»å å°å¯æ¬éãä»²è£èç¹åå éä¸¾ä½ä¸ä¿å­æ°æ®ï¼å³ä¸æä¾æ°æ®åä½ï¼ã\n\n\n\nä»²è£èç¹å°æ°¸è¿æ¯ä»²è£èç¹ãå¨éä¸¾æé´ï¼ä¸»èç¹å¯è½ä¼éçº§æä¸ºæ¬¡èç¹ï¼èæ¬¡èç¹å¯è½ä¼åçº§æä¸ºä¸»èç¹ã\n\n\n# å¼æ­¥å¤å¶\n\n\n# æ¢æä½\n\nä»èç¹å¤å¶ä¸»èç¹çæä½æ¥å¿ï¼å¹¶å°æä½å¼æ­¥åºç¨äºå¶æ°æ®éãéè¿ä»èç¹åæ­¥ä¸»èç¹çæ°æ®éï¼å³ä½¿ä¸ä¸ªæå¤ä¸ªæåå¤±è´¥ï¼å¯æ¬éï¼mongodb éç¾¤ï¼ä¹å¯ä»¥ç»§ç»­è¿è¡ã\n\nä» 4.2 çæ¬å¼å§ï¼å¯æ¬éçä»èç¹è®°å½æ¢æä½ï¼æä½æ¶é´æ¯è®¾ç½®çéå¼é¿ï¼çæ¥å¿æ¡ç®ãè¿äºæ¢æä½å¨ repl ç»ä»¶ä¸ç è¯æ­æ¥å¿ ä¸­è®°å½äºæ¥å¿æ¶æ¯ï¼å¹¶ä½¿ç¨äºææ¬ op: <oplog entry> è±è´¹äº <num>msãè¿äºæ¢æä½æ¥å¿æ¡ç®ä»åå³äºæ¢æä½éå¼ï¼èä¸åå³äºæ¥å¿çº§å«ï¼å¨ç³»ç»çº§å«æç»ä»¶çº§å«ï¼ï¼éç½®çº§å«æè¿è¡ç¼æ¢çéæ ·çãæ¢æ¥å¨ä¸ä¼æè·ç¼æ¢çæä½æ¥å¿æ¡ç®ã\n\n\n# å¤å¶å»¶è¿åæµæ§\n\nå¤å¶å»¶è¿ï¼replication lagï¼æ¯æå°ä¸»èç¹ä¸çåæä½å¤å¶å°ä»èç¹ä¸æè±è´¹çæ¶é´ãè¾ç­çå»¶è¿æ¶é´æ¯å¯ä»¥æ¥åçï¼ä½æ¯éçå¤å¶å»¶è¿çå¢å ï¼å¯è½ä¼åºç°ä¸¥éçé®é¢ï¼æ¯å¦å¨ä¸»èç¹ä¸çç¼å­ååã\n\nä» mongodb 4.2 å¼å§ï¼ç®¡çåå¯ä»¥éå¶ä¸»èç¹çåå¥éçï¼ä½¿å¾å¤§å¤æ°å»¶è¿æ¶é´ä¿æå¨å¯éç½®çæå¤§å¼ flowcontroltargetlagseconds ä»¥ä¸ã\n\né»è®¤æåµä¸ï¼æµæ§æ¯å¼å¯çã\n\nå¯ç¨æµæ§åï¼éçå»¶è¿æ¶é´è¶æ¥è¶æ¥è¿ flowcontroltargetlagsecondsï¼ä¸»å¯¹è±¡ä¸çåæä½å¿é¡»åè·å¾ä»¤çï¼ç¶åæè½è¿è¡éå®å¹¶æ§è¡åæä½ãéè¿éå¶æ¯ç§ååºçä»¤çæ°éï¼æµæ§æºå¶å°è¯å°å»¶è¿ä¿æå¨ç®æ ä»¥ä¸ã\n\n\n# æéè½¬ç§»\n\nå½ä¸»èç¹ä¸éç¾¤ä¸­çå¶ä»æåéä¿¡çæ¶é´è¶è¿éç½®ç electiontimeoutmillisï¼é»è®¤ä¸º 10 ç§ï¼æ¶ï¼ç¬¦åéä¸¾è¦æ±çä»èç¹å°è¦æ±éä¸¾ï¼å¹¶æåèªå·±ä¸ºæ°çä¸»èç¹ãéç¾¤å°è¯å®æéä¸¾æ°ä¸»èç¹å¹¶æ¢å¤æ­£å¸¸å·¥ä½ã\n\n\n\néä¸¾å®æåï¼å¯æ¬éæ æ³å¤çåå¥æä½ãå¦æå°å¯æ¬ééç½®ä¸ºï¼å¨ä¸»èç¹å¤äºè±æºç¶ææ¶ï¼å¨æ¬¡èç¹ä¸è¿è¡ï¼åå¯æ¬éå¯ä»¥ç»§ç»­æä¾è¯»åæ¥è¯¢ã\n\nåè®¾å¯æ¬éç½®éç¨é»è®¤éç½®ï¼åéç¾¤éæ©æ°èç¹çæ¶é´éå¸¸ä¸åºè¶è¿ 12 ç§ï¼è¿åæ¬ï¼å°ä¸»èç¹æ è®°ä¸ºä¸å¯ç¨å¹¶å®æéä¸¾æéçæ¶é´ãå¯ä»¥éè¿ä¿®æ¹ settings.electiontimeoutmillis éç½®éé¡¹æ¥è°æ´æ­¤æ¶é´ãç½ç»å»¶è¿ç­å ç´ å¯è½ä¼å»¶é¿å®æéä¸¾æéçæ¶é´ï¼è¿èå½±åéç¾¤å¨æ²¡æä¸»èç¹çæåµä¸å¯ä»¥è¿è¡çæ¶é´ãè¿äºå ç´ åå³äºéç¾¤å®éçæåµã\n\nå°é»è®¤ä¸º 10 ç§ç electiontimeoutmillis éé¡¹æ°å¼ç¼©å°ï¼å¯ä»¥æ´å¿«å°æ£æµå°ä¸»è¦æéãä½æ¯ï¼ç±äºç½ç»å»¶è¿ç­å ç´ ï¼éç¾¤å¯è½ä¼æ´é¢ç¹å°è¿è¡éä¸¾ï¼å³ä½¿è¯¥ä¸»èç¹å®éä¸å¤äºå¥åº·ç¶æãè¿å¯è½å¯¼è´ w : 1 åæä½çåæ»æ¬¡æ°å¢å ã\n\nåºç¨ç¨åºçè¿æ¥é»è¾åºåæ¬å¯¹èªå¨æéè½¬ç§»ååç»­éä¸¾çå®¹éå¤çãä» mongodb 3.6 å¼å§ï¼mongodb é©±å¨ç¨åºå¯ä»¥æ£æµå°ä¸»èç¹çå¤±èï¼å¹¶å¯ä»¥èªå¨éè¯ä¸æ¬¡æäºåå¥æä½ã\n\nä» mongodb4.4 å¼å§ï¼mongodb æä¾éåè¯»åï¼å°å¯éä¸¾çä»èç¹çæè¿è®¿é®çæ°æ®ï¼é¢ç­ä¸ºç¼å­ãé¢ç­ä»èç¹çç¼å­å¯ä»¥å¸®å©å¨éä¸¾åæ´å¿«å°æ¢å¤ã\n\n\n# è¯»æä½\n\n\n# è¯»ä¼å\n\né»è®¤æåµä¸ï¼å®¢æ·ç«¯ä»ä¸»èç¹è¯»åæ°æ®ï¼ä½æ¯ï¼å®¢æ·ç«¯å¯ä»¥æå®è¯»åé¦éé¡¹ï¼ä»¥å°è¯»åæä½åéå°ä»èç¹ã\n\n\n\nå¼æ­¥å¤å¶å°ä»èç¹æå³çåä»èç¹è¯»åæ°æ®å¯è½ä¼è¿åä¸ä¸»èç¹ä¸ä¸è´çæ°æ®ã\n\nåå«è¯»åæä½çå¤ææ¡£äºå¡å¿é¡»ä½¿ç¨è¯»åä¸»èç¹ä¼åãç»å®äºå¡ä¸­çæææä½å¿é¡»è·¯ç±å°åä¸æåã\n\n\n# æ°æ®å¯è§æ§\n\næ ¹æ®è¯»åçå³æ³¨ç¹ï¼å®¢æ·ç«¯å¯ä»¥å¨æä¹ååå¥åæ¥çåå¥ç»æï¼\n\n * ä¸ç®¡åç write concern å¦ä½è®¾ç½®ï¼å¶ä»ä½¿ç¨ "local" æ "available" çè¯»éç½®çå®¢æ·ç«¯é½å¯ä»¥ååå¸å®¢æ·ç«¯ç¡®è®¤åæä½ä¹åçå°åæä½çç»æã\n * ä½¿ç¨ "local" æ "available" è¯»åéç½®çå®¢æ·ç«¯å¯ä»¥è¯»åæ°æ®ï¼è¿äºæ°æ®éåå¯è½ä¼å¨å¯æ¬éæéè½¬ç§»æé´åæ»ã\n\nå¯¹äºå¤ææ¡£äºå¡ä¸­çæä½ï¼å½äºå¡æäº¤æ¶ï¼å¨äºå¡ä¸­è¿è¡çæææ°æ®æ´æ¹é½å°ä¿å­ï¼å¹¶å¨äºå¡å¤é¨å¯è§ãä¹å°±æ¯è¯´ï¼äºå¡å¨åæ»å¶ä»äºå¡æ¶å°ä¸ä¼æäº¤å¶æäºæ´æ¹ãå¨æäº¤äºå¡åï¼äºå¡å¤é¨çä¸å°å¨äºå¡ä¸­è¿è¡çæ°æ®æ´æ¹ã\n\nä½æ¯ï¼å½äºå¡åå¥å¤ä¸ªåçæ¶ï¼å¹¶éææå¤é¨è¯»æä½é½éè¦ç­å¾å·²æäº¤äºå¡çç»æå¨ææåçä¸å¯è§ãä¾å¦ï¼å¦ææäº¤äºä¸ä¸ªäºå¡ï¼å¹¶ä¸å¨åç a ä¸å¯ä»¥çå°å 1ï¼ä½æ¯å¨åç b ä¸è¿çä¸å°å 2ï¼åå¨ "local" è¯»éç½®çº§å«ï¼å¤é¨è¯»åå¯ä»¥è¯»åå 1 çç»æèçä¸å°å 2ã\n\n\n# éåè¯»å\n\nä» mongodb 4.4 å¼å§ï¼mongodb æä¾éåè¯»åä»¥é¢ç­å¯éä»èç¹ï¼å³ä¼åçº§å¤§äº 0 çæåï¼çç¼å­ãä½¿ç¨éåè¯»åï¼é»è®¤æåµä¸å·²å¯ç¨ï¼ï¼ä¸»èç¹å¯ä»¥éåå®æ¥æ¶å°çä¸é¨åæä½ï¼å¹¶å°å¶åéç»å¯éæ©çä»èç¹çå­éãå­éçå¤§å°æ¯å¯éç½®çã\n\n\n# åèèµæ\n\n * å®æ¹\n   * mongodb å®ç½\n   * mongodb github\n   * mongodb å®æ¹åè´¹æç¨\n * æç¨\n   * mongodb æç¨\n   * mongodb é«æè¯¾',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"MongoDB åç",frontmatter:{title:"MongoDB åç",date:"2020-09-20T23:12:17.000Z",categories:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],tags:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB","åç"],permalink:"/pages/ad08f5/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/04.%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/01.MongoDB/09.MongoDB%E5%88%86%E7%89%87.html",relativePath:"12.æ°æ®åº/04.ææ¡£æ°æ®åº/01.MongoDB/09.MongoDBåç.md",key:"v-1211efa8",path:"/pages/ad08f5/",headers:[{level:2,title:"åçéç¾¤ç®ä»",slug:"åçéç¾¤ç®ä»",normalizedTitle:"åçéç¾¤ç®ä»",charIndex:17},{level:3,title:"åçéç¾¤ç¹ç¹",slug:"åçéç¾¤ç¹ç¹",normalizedTitle:"åçéç¾¤ç¹ç¹",charIndex:107},{level:3,title:"åçéç¾¤ç»ä»¶",slug:"åçéç¾¤ç»ä»¶",normalizedTitle:"åçéç¾¤ç»ä»¶",charIndex:151},{level:3,title:"åçéç¾¤çåå¸",slug:"åçéç¾¤çåå¸",normalizedTitle:"åçéç¾¤çåå¸",charIndex:361},{level:3,title:"è·¯ç±èç¹ mongos",slug:"è·¯ç±èç¹-mongos",normalizedTitle:"è·¯ç±èç¹ mongos",charIndex:606},{level:2,title:"åç Key",slug:"åç-key",normalizedTitle:"åç key",charIndex:857},{level:2,title:"åçç­ç¥",slug:"åçç­ç¥",normalizedTitle:"åçç­ç¥",charIndex:1606},{level:3,title:"Hash åç",slug:"hash-åç",normalizedTitle:"hash åç",charIndex:1721},{level:3,title:"èå´åç",slug:"èå´åç",normalizedTitle:"èå´åç",charIndex:1729},{level:2,title:"åçéç¾¤ä¸­çåºå",slug:"åçéç¾¤ä¸­çåºå",normalizedTitle:"åçéç¾¤ä¸­çåºå",charIndex:2173},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:2459}],headersStr:"åçéç¾¤ç®ä» åçéç¾¤ç¹ç¹ åçéç¾¤ç»ä»¶ åçéç¾¤çåå¸ è·¯ç±èç¹ mongos åç Key åçç­ç¥ Hash åç èå´åç åçéç¾¤ä¸­çåºå åèèµæ",content:"# MongoDB åç\n\n\n# åçéç¾¤ç®ä»\n\nå½ MongoDB éè¦å­å¨æµ·éæ°æ®æ¶ï¼åèç¹ä¸è¶³ä»¥å­å¨å¨éæ°æ®ï¼ä¸å¯è½æ æ³æä¾ä»¤äººæ»¡æçååéãæä»¥ï¼å¯ä»¥éè¿ MongoDB åçæºå¶æ¥æ¯ææ°´å¹³æ©å±ã\n\n\n# åçéç¾¤ç¹ç¹\n\nå¯¹åºç¨å®å¨éæ\n\næ°æ®èªå¨åè¡¡\n\nå¨ææ©å®¹\n\næä¾ä¸ç§åçæ¹å¼\n\n\n# åçéç¾¤ç»ä»¶\n\nMongoDB åçéç¾¤å«ä»¥ä¸ç»ä»¶ï¼\n\n * shardï¼æ¯ä¸ªåçåå«åçæ°æ®çå­éãæ¯ä¸ªåçé½å¯ä»¥é¨ç½²ä¸ºå¯æ¬éã\n * mongosï¼mongos åå½æ¥è¯¢è·¯ç±å¨ï¼å¨å®¢æ·ç«¯åºç¨ç¨åºååçéç¾¤ä¹é´æä¾æ¥å£ãä» MongoDB 4.4 å¼å§ï¼mongos å¯ä»¥æ¯æ hedged reads ä»¥æå¤§ç¨åº¦å°åå°å»¶è¿ã\n * config serversï¼æä¾éç¾¤åæ°æ®å­å¨ååçæ°æ®åå¸çæ å°ã\n\n\n\n\n# åçéç¾¤çåå¸\n\nMongoDB å¤å¶éä»¥ collection ä¸ºåä½ï¼å°æ°æ®åå¸å¨éç¾¤ä¸­çåä¸ªåçä¸ãæå¤åè®¸ 1024 ä¸ªåçã\n\nMongoDB å¤å¶éçåçä¹é´æ°æ®ä¸éå¤ï¼åªæå½ææåçé½æ­£å¸¸æ¶ï¼æè½å®æ´å·¥ä½ã\n\nMongoDB æ°æ®åºå¯ä»¥åæ¶åå«åçåæªåççéåç collectionãåç collection ä¼åå¸å¨éç¾¤ä¸­åèç¹ä¸ãèæªåçç collection å­å¨å¨ä¸»èç¹ä¸ãæ¯ä¸ªæ°æ®åºé½æå¶èªå·±çä¸»èç¹ã\n\nåçåæªåçç collectionï¼\n\n\n\n\n# è·¯ç±èç¹ mongos\n\nè¦è¿æ¥ MongoDB åçéç¾¤ï¼å¿é¡»è¿æ¥å° mongos è·¯ç±å¨ãè¿åæ¬åçåæªåçç collectionãå®¢æ·ç«¯ä¸åºè¯¥è¿æ¥å°åä¸ªåçèç¹è¿è¡è¯»åæä½ã\n\nè¿æ¥ mongos çæ¹å¼åè¿æ¥ mongod ç¸åï¼ä¾å¦éè¿ mongo shell æ MongoDB é©±å¨ç¨åºã\n\n\n\nè·¯ç±èç¹çä½ç¨ï¼\n\n * æä¾éç¾¤çåä¸å¥å£\n * è½¬ååºç¨ç«¯è¯·æ±\n * éæ©åéæ°æ®èç¹è¿è¡è¯»å\n * åå¹¶å¤ä¸ªæ°æ®èç¹çè¿å\n\nä¸è¬ï¼è·¯ç±èç¹ mongos å»ºè®®è³å° 2 ä¸ªã\n\n\n# åç Key\n\nMongoDB ä½¿ç¨åç Key å¨åä¸ªåçä¹é´åå collection ç documentãåç Key ç± document ä¸­çä¸ä¸ªæå¤ä¸ªå­æ®µç»æã\n\n * ä» MongoDB 4.4 å¼å§ï¼åç collection ä¸­ç document å¯è½ç¼ºå°åç Key å­æ®µãå¨è·¨åçåå¸ææ¡£æ¶ï¼ç¼ºå°åç Key å­æ®µå°è¢«è§ä¸ºå·æç©ºå¼ï¼ä½å¨è·¯ç±æ¥è¯¢æ¶åä¸ä¼ã\n\n * å¨ MongoDB 4.2 åæ´æ©çæ¬ä¸­ï¼åç Key å­æ®µå¿é¡»å¨æ¯ä¸ª document ä¸­å­å¨ä¸ä¸ªåç collectionã\n\nå¨åç collection æ¶éæ©åç Keyã\n\n * ä» MongoDB 4.4 å¼å§ï¼æ¨å¯ä»¥éè¿å¨ç°æ Key ä¸­æ·»å ä¸ä¸ªæå¤ä¸ªåç¼å­æ®µæ¥ä¼å collection çåç Keyã\n * å¨ MongoDB 4.2 åæ´ä½çæ¬ä¸­ï¼æ æ³å¨åçåæ´æ¹åç Key çéæ©ã\n\ndocument çåçé®å¼å³å®äºå¶å¨åä¸ªåçä¸­çåå¸\n\n * ä» MongoDB 4.2 å¼å§ï¼é¤éæ¨çåç Key å­æ®µæ¯ä¸å¯åç_id å­æ®µï¼å¦åæ¨å¯ä»¥æ´æ° document çåçé®å¼ã\n * å¨ MongoDB 4.0 åæ´ä½çæ¬ä¸­ï¼ææ¡£çåç Key å­æ®µå¼æ¯ä¸å¯åçã\n\nåç Key ç´¢å¼ï¼è¦å¯¹å·²å¡«åç collection è¿è¡åçï¼è¯¥ collection å¿é¡»å·æä»¥åç Key å¼å¤´çç´¢å¼ãåçä¸ä¸ªç©º collection æ¶ï¼å¦æè¯¥ collection è¿æ²¡æéå¯¹æå®åç Key çéå½ç´¢å¼ï¼å MongoDB ä¼åå»ºæ¯æç´¢å¼ã\n\nåç Key ç­ç¥ï¼åç Key çéæ©ä¼å½±ååçéç¾¤çæ§è½ï¼æçåå¯ä¼¸ç¼©æ§ãåç Key åå¶åå¤ç´¢å¼çéæ©ä¹ä¼å½±åéç¾¤å¯ä»¥ä½¿ç¨çåçç­ç¥ã\n\nMongoDB ååºå°æ°æ®åçãæ¯ä¸ªååé½æåºäºåç Key çä¸ä¸éã\n\nä¸ºäºå¨æ´ä¸ªéç¾¤ä¸­çææåçä¸å®ç°åçåååå¸ï¼åè¡¡å¨å¨åå°è¿è¡ï¼å¹¶å¨ååçä¸è¿ç§»åã\n\n\n# åçç­ç¥\n\nMongoDB æ¯æä¸¤ç§åçç­ç¥ï¼Hash åçåèå´åçã\n\n\n# Hash åç\n\nHash åçç­ç¥ä¼åè®¡ç®åç Key å­æ®µå¼çåå¸å¼ï¼ç¶åï¼æ ¹æ®åçé®å¼ä¸ºæ¯ä¸ª chunk åéä¸ä¸ªèå´ã\n\n> æ³¨æï¼ä½¿ç¨åå¸ç´¢å¼è§£ææ¥è¯¢æ¶ï¼MongoDB ä¼èªå¨è®¡ç®åå¸å¼ï¼åºç¨ç¨åºä¸éè¦è®¡ç®åå¸ã\n\n\n\nå°½ç®¡åç Key èå´å¯è½æ¯âæ¥è¿âçï¼ä½å®ä»¬çåå¸å¼ä¸å¤ªå¯è½å¨åä¸ chunk ä¸ãåºäº Hash çæ°æ®ååæå©äºæ´ååçæ°æ®åå¸ï¼å°¤å¶æ¯å¨åç Key åè°æ´æ¹çæ°æ®éä¸­ã\n\nä½æ¯ï¼Hash åçæå³çå¯¹åç Key åèå´æ¥è¯¢æ¶ä¸å¤ªå¯è½éå¯¹åä¸ªåçï¼ä»èå¯¼è´æ´å¤çéç¾¤èå´åçå¹¿æ­æä½ã\n\n\n# èå´åç\n\nèå´åçæ ¹æ®åç Key å¼å°æ°æ®ååä¸ºå¤ä¸ªèå´ãç¶åï¼æ ¹æ®åç Key å¼ä¸ºæ¯ä¸ª chunk åéä¸ä¸ªèå´ã\n\n\n\nå¼æ¯è¾è¿ä¼¼çä¸ç³»ååç Key æ´æå¯è½é©»çå¨åä¸ chunk ä¸ãèå´åççæçåå³äºéæ©çåç Keyãåç Key èèä¸å¨å¨ä¼å¯¼è´æ°æ®åå¸ä¸åï¼è¿å¯è½ä¼åå¼±åççæäºä¼å¿æå¯¼è´æ§è½ç¶é¢ã\n\n\n# åçéç¾¤ä¸­çåºå\n\nåºåå¯ä»¥æé«è·¨å¤ä¸ªæ°æ®ä¸­å¿çåçéç¾¤çæ°æ®å±é¨æ§ã\n\nå¨åçéç¾¤ä¸­ï¼å¯ä»¥åºäºåç Key åå»ºåçæ°æ®åºåãå¯ä»¥å°æ¯ä¸ªåºåä¸éç¾¤ä¸­çä¸ä¸ªæå¤ä¸ªåçå³èãåçå¯ä»¥ä¸ä»»ææ°éçåºåå³èãå¨å¹³è¡¡çéç¾¤ä¸­ï¼MongoDB ä»å°åºåè¦çç chunk è¿ç§»å°ä¸è¯¥åºåå³èçåçã\n\næ¯ä¸ªåºåè¦çä¸ä¸ªæå¤ä¸ªåç Key å¼èå´ãåºåè¦ççæ¯ä¸ªèå´å§ç»åæ¬å¶ä¸ä¸è¾¹çã\n\n\n\nå¨å®ä¹è¦è¦ççåºåçæ°èå´æ¶ï¼å¿é¡»ä½¿ç¨åç Key ä¸­åå«çå­æ®µãå¦æä½¿ç¨å¤ååç Keyï¼åèå´å¿é¡»åå«åç Key çåç¼ã\n\néæ©åç Key æ¶ï¼åºèèå°æ¥å¯è½ä½¿ç¨çåºåã\n\n\n# åèèµæ\n\n * å®æ¹\n   * MongoDB å®ç½\n   * MongoDB Github\n   * MongoDB å®æ¹åè´¹æç¨\n * æç¨\n   * MongoDB æç¨\n   * MongoDB é«æè¯¾",normalizedContent:"# mongodb åç\n\n\n# åçéç¾¤ç®ä»\n\nå½ mongodb éè¦å­å¨æµ·éæ°æ®æ¶ï¼åèç¹ä¸è¶³ä»¥å­å¨å¨éæ°æ®ï¼ä¸å¯è½æ æ³æä¾ä»¤äººæ»¡æçååéãæä»¥ï¼å¯ä»¥éè¿ mongodb åçæºå¶æ¥æ¯ææ°´å¹³æ©å±ã\n\n\n# åçéç¾¤ç¹ç¹\n\nå¯¹åºç¨å®å¨éæ\n\næ°æ®èªå¨åè¡¡\n\nå¨ææ©å®¹\n\næä¾ä¸ç§åçæ¹å¼\n\n\n# åçéç¾¤ç»ä»¶\n\nmongodb åçéç¾¤å«ä»¥ä¸ç»ä»¶ï¼\n\n * shardï¼æ¯ä¸ªåçåå«åçæ°æ®çå­éãæ¯ä¸ªåçé½å¯ä»¥é¨ç½²ä¸ºå¯æ¬éã\n * mongosï¼mongos åå½æ¥è¯¢è·¯ç±å¨ï¼å¨å®¢æ·ç«¯åºç¨ç¨åºååçéç¾¤ä¹é´æä¾æ¥å£ãä» mongodb 4.4 å¼å§ï¼mongos å¯ä»¥æ¯æ hedged reads ä»¥æå¤§ç¨åº¦å°åå°å»¶è¿ã\n * config serversï¼æä¾éç¾¤åæ°æ®å­å¨ååçæ°æ®åå¸çæ å°ã\n\n\n\n\n# åçéç¾¤çåå¸\n\nmongodb å¤å¶éä»¥ collection ä¸ºåä½ï¼å°æ°æ®åå¸å¨éç¾¤ä¸­çåä¸ªåçä¸ãæå¤åè®¸ 1024 ä¸ªåçã\n\nmongodb å¤å¶éçåçä¹é´æ°æ®ä¸éå¤ï¼åªæå½ææåçé½æ­£å¸¸æ¶ï¼æè½å®æ´å·¥ä½ã\n\nmongodb æ°æ®åºå¯ä»¥åæ¶åå«åçåæªåççéåç collectionãåç collection ä¼åå¸å¨éç¾¤ä¸­åèç¹ä¸ãèæªåçç collection å­å¨å¨ä¸»èç¹ä¸ãæ¯ä¸ªæ°æ®åºé½æå¶èªå·±çä¸»èç¹ã\n\nåçåæªåçç collectionï¼\n\n\n\n\n# è·¯ç±èç¹ mongos\n\nè¦è¿æ¥ mongodb åçéç¾¤ï¼å¿é¡»è¿æ¥å° mongos è·¯ç±å¨ãè¿åæ¬åçåæªåçç collectionãå®¢æ·ç«¯ä¸åºè¯¥è¿æ¥å°åä¸ªåçèç¹è¿è¡è¯»åæä½ã\n\nè¿æ¥ mongos çæ¹å¼åè¿æ¥ mongod ç¸åï¼ä¾å¦éè¿ mongo shell æ mongodb é©±å¨ç¨åºã\n\n\n\nè·¯ç±èç¹çä½ç¨ï¼\n\n * æä¾éç¾¤çåä¸å¥å£\n * è½¬ååºç¨ç«¯è¯·æ±\n * éæ©åéæ°æ®èç¹è¿è¡è¯»å\n * åå¹¶å¤ä¸ªæ°æ®èç¹çè¿å\n\nä¸è¬ï¼è·¯ç±èç¹ mongos å»ºè®®è³å° 2 ä¸ªã\n\n\n# åç key\n\nmongodb ä½¿ç¨åç key å¨åä¸ªåçä¹é´åå collection ç documentãåç key ç± document ä¸­çä¸ä¸ªæå¤ä¸ªå­æ®µç»æã\n\n * ä» mongodb 4.4 å¼å§ï¼åç collection ä¸­ç document å¯è½ç¼ºå°åç key å­æ®µãå¨è·¨åçåå¸ææ¡£æ¶ï¼ç¼ºå°åç key å­æ®µå°è¢«è§ä¸ºå·æç©ºå¼ï¼ä½å¨è·¯ç±æ¥è¯¢æ¶åä¸ä¼ã\n\n * å¨ mongodb 4.2 åæ´æ©çæ¬ä¸­ï¼åç key å­æ®µå¿é¡»å¨æ¯ä¸ª document ä¸­å­å¨ä¸ä¸ªåç collectionã\n\nå¨åç collection æ¶éæ©åç keyã\n\n * ä» mongodb 4.4 å¼å§ï¼æ¨å¯ä»¥éè¿å¨ç°æ key ä¸­æ·»å ä¸ä¸ªæå¤ä¸ªåç¼å­æ®µæ¥ä¼å collection çåç keyã\n * å¨ mongodb 4.2 åæ´ä½çæ¬ä¸­ï¼æ æ³å¨åçåæ´æ¹åç key çéæ©ã\n\ndocument çåçé®å¼å³å®äºå¶å¨åä¸ªåçä¸­çåå¸\n\n * ä» mongodb 4.2 å¼å§ï¼é¤éæ¨çåç key å­æ®µæ¯ä¸å¯åç_id å­æ®µï¼å¦åæ¨å¯ä»¥æ´æ° document çåçé®å¼ã\n * å¨ mongodb 4.0 åæ´ä½çæ¬ä¸­ï¼ææ¡£çåç key å­æ®µå¼æ¯ä¸å¯åçã\n\nåç key ç´¢å¼ï¼è¦å¯¹å·²å¡«åç collection è¿è¡åçï¼è¯¥ collection å¿é¡»å·æä»¥åç key å¼å¤´çç´¢å¼ãåçä¸ä¸ªç©º collection æ¶ï¼å¦æè¯¥ collection è¿æ²¡æéå¯¹æå®åç key çéå½ç´¢å¼ï¼å mongodb ä¼åå»ºæ¯æç´¢å¼ã\n\nåç key ç­ç¥ï¼åç key çéæ©ä¼å½±ååçéç¾¤çæ§è½ï¼æçåå¯ä¼¸ç¼©æ§ãåç key åå¶åå¤ç´¢å¼çéæ©ä¹ä¼å½±åéç¾¤å¯ä»¥ä½¿ç¨çåçç­ç¥ã\n\nmongodb ååºå°æ°æ®åçãæ¯ä¸ªååé½æåºäºåç key çä¸ä¸éã\n\nä¸ºäºå¨æ´ä¸ªéç¾¤ä¸­çææåçä¸å®ç°åçåååå¸ï¼åè¡¡å¨å¨åå°è¿è¡ï¼å¹¶å¨ååçä¸è¿ç§»åã\n\n\n# åçç­ç¥\n\nmongodb æ¯æä¸¤ç§åçç­ç¥ï¼hash åçåèå´åçã\n\n\n# hash åç\n\nhash åçç­ç¥ä¼åè®¡ç®åç key å­æ®µå¼çåå¸å¼ï¼ç¶åï¼æ ¹æ®åçé®å¼ä¸ºæ¯ä¸ª chunk åéä¸ä¸ªèå´ã\n\n> æ³¨æï¼ä½¿ç¨åå¸ç´¢å¼è§£ææ¥è¯¢æ¶ï¼mongodb ä¼èªå¨è®¡ç®åå¸å¼ï¼åºç¨ç¨åºä¸éè¦è®¡ç®åå¸ã\n\n\n\nå°½ç®¡åç key èå´å¯è½æ¯âæ¥è¿âçï¼ä½å®ä»¬çåå¸å¼ä¸å¤ªå¯è½å¨åä¸ chunk ä¸ãåºäº hash çæ°æ®ååæå©äºæ´ååçæ°æ®åå¸ï¼å°¤å¶æ¯å¨åç key åè°æ´æ¹çæ°æ®éä¸­ã\n\nä½æ¯ï¼hash åçæå³çå¯¹åç key åèå´æ¥è¯¢æ¶ä¸å¤ªå¯è½éå¯¹åä¸ªåçï¼ä»èå¯¼è´æ´å¤çéç¾¤èå´åçå¹¿æ­æä½ã\n\n\n# èå´åç\n\nèå´åçæ ¹æ®åç key å¼å°æ°æ®ååä¸ºå¤ä¸ªèå´ãç¶åï¼æ ¹æ®åç key å¼ä¸ºæ¯ä¸ª chunk åéä¸ä¸ªèå´ã\n\n\n\nå¼æ¯è¾è¿ä¼¼çä¸ç³»ååç key æ´æå¯è½é©»çå¨åä¸ chunk ä¸ãèå´åççæçåå³äºéæ©çåç keyãåç key èèä¸å¨å¨ä¼å¯¼è´æ°æ®åå¸ä¸åï¼è¿å¯è½ä¼åå¼±åççæäºä¼å¿æå¯¼è´æ§è½ç¶é¢ã\n\n\n# åçéç¾¤ä¸­çåºå\n\nåºåå¯ä»¥æé«è·¨å¤ä¸ªæ°æ®ä¸­å¿çåçéç¾¤çæ°æ®å±é¨æ§ã\n\nå¨åçéç¾¤ä¸­ï¼å¯ä»¥åºäºåç key åå»ºåçæ°æ®åºåãå¯ä»¥å°æ¯ä¸ªåºåä¸éç¾¤ä¸­çä¸ä¸ªæå¤ä¸ªåçå³èãåçå¯ä»¥ä¸ä»»ææ°éçåºåå³èãå¨å¹³è¡¡çéç¾¤ä¸­ï¼mongodb ä»å°åºåè¦çç chunk è¿ç§»å°ä¸è¯¥åºåå³èçåçã\n\næ¯ä¸ªåºåè¦çä¸ä¸ªæå¤ä¸ªåç key å¼èå´ãåºåè¦ççæ¯ä¸ªèå´å§ç»åæ¬å¶ä¸ä¸è¾¹çã\n\n\n\nå¨å®ä¹è¦è¦ççåºåçæ°èå´æ¶ï¼å¿é¡»ä½¿ç¨åç key ä¸­åå«çå­æ®µãå¦æä½¿ç¨å¤ååç keyï¼åèå´å¿é¡»åå«åç key çåç¼ã\n\néæ©åç key æ¶ï¼åºèèå°æ¥å¯è½ä½¿ç¨çåºåã\n\n\n# åèèµæ\n\n * å®æ¹\n   * mongodb å®ç½\n   * mongodb github\n   * mongodb å®æ¹åè´¹æç¨\n * æç¨\n   * mongodb æç¨\n   * mongodb é«æè¯¾",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"MongoDB è¿ç»´",frontmatter:{title:"MongoDB è¿ç»´",date:"2020-09-09T20:47:14.000Z",categories:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],tags:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB","è¿ç»´"],permalink:"/pages/5e3c30/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/04.%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/01.MongoDB/20.MongoDB%E8%BF%90%E7%BB%B4.html",relativePath:"12.æ°æ®åº/04.ææ¡£æ°æ®åº/01.MongoDB/20.MongoDBè¿ç»´.md",key:"v-74c8571a",path:"/pages/5e3c30/",headers:[{level:2,title:"MongoDB å®è£",slug:"mongodb-å®è£",normalizedTitle:"mongodb å®è£",charIndex:17},{level:3,title:"Windows",slug:"windows",normalizedTitle:"windows",charIndex:32},{level:3,title:"Linux",slug:"linux",normalizedTitle:"linux",charIndex:358},{level:3,title:"è®¾ç½®ç¨æ·åãå¯ç ",slug:"è®¾ç½®ç¨æ·åãå¯ç ",normalizedTitle:"è®¾ç½®ç¨æ·åãå¯ç ",charIndex:1427},{level:2,title:"å¤ä»½åæ¢å¤",slug:"å¤ä»½åæ¢å¤",normalizedTitle:"å¤ä»½åæ¢å¤",charIndex:1794},{level:3,title:"æ°æ®å¤ä»½",slug:"æ°æ®å¤ä»½",normalizedTitle:"æ°æ®å¤ä»½",charIndex:1804},{level:3,title:"æ°æ®æ¢å¤",slug:"æ°æ®æ¢å¤",normalizedTitle:"æ°æ®æ¢å¤",charIndex:3296},{level:2,title:"å¯¼å¥å¯¼åº",slug:"å¯¼å¥å¯¼åº",normalizedTitle:"å¯¼å¥å¯¼åº",charIndex:4859},{level:3,title:"å¯¼å¥æä½",slug:"å¯¼å¥æä½",normalizedTitle:"å¯¼å¥æä½",charIndex:4975},{level:3,title:"å¯¼åºæä½",slug:"å¯¼åºæä½",normalizedTitle:"å¯¼åºæä½",charIndex:6498},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:7501}],headersStr:"MongoDB å®è£ Windows Linux è®¾ç½®ç¨æ·åãå¯ç  å¤ä»½åæ¢å¤ æ°æ®å¤ä»½ æ°æ®æ¢å¤ å¯¼å¥å¯¼åº å¯¼å¥æä½ å¯¼åºæä½ åèèµæ",content:'# MongoDB è¿ç»´\n\n\n# MongoDB å®è£\n\n\n# Windows\n\nï¼1ï¼ä¸è½½å¹¶è§£åå°æ¬å°\n\nè¿å¥å®ç½ä¸è½½å°åï¼å®æ¹ä¸è½½å°å ï¼éæ©åéççæ¬ä¸è½½ã\n\nï¼2ï¼åå»ºæ°æ®ç®å½\n\nMongoDB å°æ°æ®ç®å½å­å¨å¨ db ç®å½ä¸ãä½æ¯è¿ä¸ªæ°æ®ç®å½ä¸ä¼ä¸»å¨åå»ºï¼æä»¬å¨å®è£å®æåéè¦åå»ºå®ã\n\nä¾å¦ï¼D:\\Tools\\Server\\mongodb\\mongodb-4.4.0\\data\\db\n\nï¼3ï¼è¿è¡ MongoDB æå¡\n\nmongod --dbpath D:\\Tools\\Server\\mongodb\\mongodb-4.4.0\\data\\db\n\n\nï¼4ï¼å®¢æ·ç«¯è¿æ¥ MongoDB\n\nå¯ä»¥å¨å½ä»¤çªå£ä¸­è¿è¡ mongo.exe å½ä»¤å³å¯è¿æ¥ä¸ MongoDB\n\nï¼5ï¼éç½® MongoDB æå¡\n\n\n# Linux\n\nï¼1ï¼ä½¿ç¨å®è£åå®è£\n\nå®è£åæä»¬éè¦å®è£åä¸ª Linux å¹³å°ä¾èµåã\n\nRed Hat/CentOSï¼\n\nsudo yum install libcurl openssl\n\n\nUbuntu 18.04 LTS ("Bionic")/Debian 10 "Buster"ï¼\n\nsudo apt-get install libcurl4 openssl\n\n\nUbuntu 16.04 LTS ("Xenial")/Debian 9 "Stretch"ï¼\n\nsudo apt-get install libcurl3 openssl\n\n\nï¼2ï¼åå»ºæ°æ®ç®å½\n\né»è®¤æåµä¸ MongoDB å¯å¨åä¼åå§åä»¥ä¸ä¸¤ä¸ªç®å½ï¼\n\n * æ°æ®å­å¨ç®å½ï¼/var/lib/mongodb\n * æ¥å¿æä»¶ç®å½ï¼/var/log/mongodb\n\næä»¬å¨å¯å¨åå¯ä»¥ååå»ºè¿ä¸¤ä¸ªç®å½å¹¶è®¾ç½®å½åç¨æ·æè¯»åæéï¼\n\nsudo mkdir -p /var/lib/mongo\nsudo mkdir -p /var/log/mongodb\nsudo chown `whoami` /var/lib/mongo     # è®¾ç½®æé\nsudo chown `whoami` /var/log/mongodb   # è®¾ç½®æé\n\n\nï¼3ï¼è¿è¡ MongoDB æå¡\n\nmongod --dbpath /var/lib/mongo --logpath /var/log/mongodb/mongod.log --fork\n\n\næå¼ /var/log/mongodb/mongod.log æä»¶çå°ä»¥ä¸ä¿¡æ¯ï¼è¯´æå¯å¨æåã\n\n# tail -10f /var/log/mongodb/mongod.log\n2020-07-09T12:20:17.391+0800 I  NETWORK  [listener] Listening on /tmp/mongodb-27017.sock\n2020-07-09T12:20:17.392+0800 I  NETWORK  [listener] Listening on 127.0.0.1\n2020-07-09T12:20:17.392+0800 I  NETWORK  [listener] waiting for connections on port 27017\n\n\nï¼4ï¼å®¢æ·ç«¯è¿æ¥ MongoDB\n\ncd /usr/local/mongodb4/bin\n./mongo\n\n\n> Linux å®è£èæ¬\n\n\n# è®¾ç½®ç¨æ·åãå¯ç \n\n> use admin\nswitched to db admin\n> db.createUser({"user":"root","pwd":"root","roles":[{"role":"userAdminAnyDatabase","db":"admin"}]})\nSuccessfully added user: {\n        "user" : "root",\n        "roles" : [\n                {\n                        "role" : "userAdminAnyDatabase",\n                        "db" : "admin"\n                }\n        ]\n}\n>\n\n\n\n# å¤ä»½åæ¢å¤\n\n\n# æ°æ®å¤ä»½\n\nå¨ Mongodb ä¸­ï¼ä½¿ç¨ mongodump å½ä»¤æ¥å¤ä»½ MongoDB æ°æ®ãè¯¥å½ä»¤å¯ä»¥å¯¼åºæææ°æ®å°æå®ç®å½ä¸­ã\n\nmongodump å½ä»¤å¯ä»¥éè¿åæ°æå®å¯¼åºçæ°æ®éçº§è½¬å­çæå¡å¨ã\n\nmongodump å½ä»¤è¯­æ³å¦ä¸ï¼\n\nmongodump -h dbhost -d dbname -o dbdirectory\n\n\n * -hï¼MongDB æå¨æå¡å¨å°åï¼ä¾å¦ï¼127.0.0.1ï¼å½ç¶ä¹å¯ä»¥æå®ç«¯å£å·ï¼127.0.0.1:27017\n\n * -dï¼éè¦å¤ä»½çæ°æ®åºå®ä¾ï¼ä¾å¦ï¼test\n\n * -oï¼å¤ä»½çæ°æ®å­æ¾ä½ç½®ï¼ä¾å¦ï¼c:\\data\\dumpï¼å½ç¶è¯¥ç®å½éè¦æåå»ºç«ï¼å¨å¤ä»½å®æåï¼ç³»ç»èªå¨å¨ dump ç®å½ä¸å»ºç«ä¸ä¸ª test ç®å½ï¼è¿ä¸ªç®å½éé¢å­æ¾è¯¥æ°æ®åºå®ä¾çå¤ä»½æ°æ®ã\n\nmongodump å½ä»¤å¯éåæ°åè¡¨å¦ä¸æç¤ºï¼\n\nè¯­æ³                                                  æè¿°                    å®ä¾\nmongodump --host HOST_NAME --port PORT_NUMBER       è¯¥å½ä»¤å°å¤ä»½ææ MongoDB æ°æ®   mongodump --host runoob.com --port 27017\nmongodump --dbpath DB_PATH --out BACKUP_DIRECTORY                         mongodump --dbpath /data/db/ --out /data/backup/\nmongodump --collection COLLECTION --db DB_NAME      è¯¥å½ä»¤å°å¤ä»½æå®æ°æ®åºçéåã       mongodump --collection mycol --db test\n\nãç¤ºä¾ãå¤ä»½å¨éæ°æ®\n\n$ mongodump -h 127.0.0.1 --port 27017 -o test2\n...\n2020-09-11T11:55:58.086+0800    done dumping test.company (18801 documents)\n2020-09-11T11:56:00.725+0800    [#############...........]  test.people  559101/1000000  (55.9%)\n2020-09-11T11:56:03.725+0800    [###################.....]  test.people  829496/1000000  (82.9%)\n2020-09-11T11:56:06.725+0800    [#####################...]  test.people  884614/1000000  (88.5%)\n2020-09-11T11:56:08.088+0800    [########################]  test.people  1000000/1000000  (100.0%)\n2020-09-11T11:56:08.350+0800    done dumping test.people (1000000 documents)\n\n\nãç¤ºä¾ãå¤ä»½æå®æ°æ®åº\n\nmongodump -h 127.0.0.1 --port 27017 -d admin -o test3\n\n\n\n# æ°æ®æ¢å¤\n\nmongodb ä½¿ç¨ mongorestore å½ä»¤æ¥æ¢å¤å¤ä»½çæ°æ®ã\n\nmongorestore å½ä»¤è¯­æ³å¦ä¸ï¼\n\n> mongorestore -h <hostname><:port> -d dbname <path>\n\n\n * --host <:port>, -h <:port>ï¼MongoDB æå¨æå¡å¨å°åï¼é»è®¤ä¸ºï¼ localhost:27017\n\n * --db , -d ï¼éè¦æ¢å¤çæ°æ®åºå®ä¾ï¼ä¾å¦ï¼testï¼å½ç¶è¿ä¸ªåç§°ä¹å¯ä»¥åå¤ä»½æ¶åçä¸ä¸æ ·ï¼æ¯å¦ test2\n\n * --dropï¼æ¢å¤çæ¶åï¼åå é¤å½åæ°æ®ï¼ç¶åæ¢å¤å¤ä»½çæ°æ®ãå°±æ¯è¯´ï¼æ¢å¤åï¼å¤ä»½åæ·»å ä¿®æ¹çæ°æ®é½ä¼è¢«å é¤ï¼æç¨å¦ï¼\n\n * <path>ï¼mongorestore æåçä¸ä¸ªåæ°ï¼è®¾ç½®å¤ä»½æ°æ®æå¨ä½ç½®ï¼ä¾å¦ï¼c:\\data\\dump\\testãä½ ä¸è½åæ¶æå® <path> å --dir éé¡¹ï¼--dir ä¹å¯ä»¥è®¾ç½®å¤ä»½ç®å½ã\n\n * --dirï¼æå®å¤ä»½çç®å½ãä½ ä¸è½åæ¶æå® <path> å --dir éé¡¹ã\n\nãç¤ºä¾ã\n\n$ mongorestore -h 127.0.0.1 --port 27017 -d test --dir test --drop\n...\n2020-09-11T11:46:16.053+0800    finished restoring test.tweets (966 documents, 0 failures)\n2020-09-11T11:46:18.256+0800    [###.....................]  test.people  164MB/1.03GB  (15.6%)\n2020-09-11T11:46:21.255+0800    [########................]  test.people  364MB/1.03GB  (34.6%)\n2020-09-11T11:46:24.256+0800    [############............]  test.people  558MB/1.03GB  (53.0%)\n2020-09-11T11:46:27.255+0800    [###############.........]  test.people  700MB/1.03GB  (66.5%)\n2020-09-11T11:46:30.257+0800    [###################.....]  test.people  846MB/1.03GB  (80.3%)\n2020-09-11T11:46:33.255+0800    [######################..]  test.people  990MB/1.03GB  (94.0%)\n2020-09-11T11:46:34.542+0800    [########################]  test.people  1.03GB/1.03GB  (100.0%)\n2020-09-11T11:46:34.543+0800    no indexes to restore\n2020-09-11T11:46:34.543+0800    finished restoring test.people (1000000 documents, 0 failures)\n2020-09-11T11:46:34.544+0800    1000966 document(s) restored successfully. 0 document(s) failed to restore.\n\n\n\n# å¯¼å¥å¯¼åº\n\nmongoimport å mongoexport å¹¶ä¸è½å¯é å°ä¿å­ææçå¯ææ¬ BSON æ°æ®ç±»åï¼å ä¸º JSON ä»è½ä»£è¡¨ä¸ç§ BSON æ¯æçå­éç±»åãå æ­¤ï¼æ°æ®ç¨è¿äºå·¥å·å¯¼åºå¯¼å¥æè®¸ä¼ä¸¢å¤±ä¸äºç²¾ç¡®ç¨åº¦ã\n\n\n# å¯¼å¥æä½\n\nå¨ MongoDB ä¸­ï¼ä½¿ç¨ mongoimport æ¥å¯¼å¥æ°æ®ã é»è®¤æåµä¸ï¼mongoimport ä¼å°æ°æ®å¯¼å¥å°æ¬å°ä¸»æºç«¯å£ 27017 ä¸ç MongoDB å®ä¾ä¸­ãè¦å°æ°æ®å¯¼å¥å¨å¶ä»ä¸»æºæç«¯å£ä¸è¿è¡ç MongoDB å®ä¾ä¸­ï¼è¯·éè¿åå« --host å --port éé¡¹æ¥æå®ä¸»æºåæç«¯å£ã ä½¿ç¨ --drop éé¡¹å é¤éåï¼å¦æå·²ç»å­å¨ï¼ã è¿æ ·å¯ä»¥ç¡®ä¿è¯¥éåä»åå«æ¨è¦å¯¼å¥çæ°æ®ã\n\nè¯­æ³æ ¼å¼ï¼\n\nmongoimport -h IP --port ç«¯å£ -u ç¨æ·å -p å¯ç  -d æ°æ®åº -c è¡¨å --type ç±»å --headerline --upsert --drop æä»¶å\n\n\nãç¤ºä¾ãå¯¼å¥è¡¨æ°æ®\n\n$ mongoimport -h 127.0.0.1 --port 27017 -d test -c book --drop test/book.dat\n2020-09-11T10:53:56.359+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11T10:53:56.372+0800    dropping: test.book\n2020-09-11T10:53:56.628+0800    431 document(s) imported successfully. 0 document(s) failed to import.\n\n\nãç¤ºä¾ãä» json æä»¶ä¸­å¯¼å¥è¡¨æ°æ®\n\n$ mongoimport -h 127.0.0.1 --port 27017 -d test -c student --upsert test/student.json\n2020-09-11T11:02:55.907+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11T11:02:56.068+0800    200 document(s) imported successfully. 0 document(s) failed to import.\n\n\nãç¤ºä¾ãä» csv æä»¶ä¸­å¯¼å¥è¡¨æ°æ®\n\n$ mongoimport -h 127.0.0.1 --port 27017 -d test -c product --type csv --headerline test/product.csv\n2020-09-11T11:07:49.788+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11T11:07:51.051+0800    11 document(s) imported successfully. 0 document(s) failed to import.\n\n\nãç¤ºä¾ãå¯¼å¥é¨åè¡¨å­æ®µæ°æ®\n\n$ mongoimport -h 127.0.0.1 --port 27017 -d test -c product --type json --upsertFields name,price test/product.json\n2020-09-11T11:14:05.410+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11T11:14:05.612+0800    11 document(s) imported successfully. 0 document(s) failed to import.\n\n\n\n# å¯¼åºæä½\n\nè¯­æ³æ ¼å¼ï¼\n\nmongoexport -h <IP> --port <ç«¯å£> -u <ç¨æ·å> -p <å¯ç > -d <æ°æ®åº> -c <è¡¨å> -f <å­æ®µ> -q <æ¡ä»¶å¯¼åº> --csv -o <æä»¶å>\n\n\n * -fï¼å¯¼åºæå­æ®µï¼ä»¥éå·åå²ï¼-f name,email,age å¯¼åº name,email,age è¿ä¸ä¸ªå­æ®µ\n * -qï¼å¯ä»¥æ ¹æ¥è¯¢æ¡ä»¶å¯¼åºï¼-q \'{ "uid" : "100" }\' å¯¼åº uid ä¸º 100 çæ°æ®\n * --csvï¼è¡¨ç¤ºå¯¼åºçæä»¶æ ¼å¼ä¸º csv çï¼è¿ä¸ªæ¯è¾æç¨ï¼å ä¸ºå¤§é¨åçå³ç³»åæ°æ®åºé½æ¯æ¯æ csvï¼å¨è¿éæå±åç¹\n\nãç¤ºä¾ãå¯¼åºæ´å¼ è¡¨\n\n$ mongoexport -h 127.0.0.1 --port 27017 -d test -c product -o test/product.dat\n2020-09-11T10:44:23.161+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11T10:44:23.177+0800    exported 11 records\n\n\nãç¤ºä¾ãå¯¼åºè¡¨å° json æä»¶\n\n$ mongoexport -h 127.0.0.1 --port 27017 -d test -c product --type json -o test/product.json\n2020-09-11T10:49:52.735+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11T10:49:52.750+0800    exported 11 records\n\n\nãç¤ºä¾ãå¯¼åºè¡¨ä¸­é¨åå­æ®µå° csv æä»¶\n\n$ mongoexport -h 127.0.0.1 --port 27017 -d test -c product --type csv -f name,price -o test/product.csv\n2020-09-11T10:47:33.160+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11T10:47:33.176+0800    exported 11 records\n\n\n\n# åèèµæ\n\n * MongoDB å®ç½\n * MongoDB Github\n * MongoDB å®æ¹åè´¹æç¨\n * MongoDB æç¨',normalizedContent:'# mongodb è¿ç»´\n\n\n# mongodb å®è£\n\n\n# windows\n\nï¼1ï¼ä¸è½½å¹¶è§£åå°æ¬å°\n\nè¿å¥å®ç½ä¸è½½å°åï¼å®æ¹ä¸è½½å°å ï¼éæ©åéççæ¬ä¸è½½ã\n\nï¼2ï¼åå»ºæ°æ®ç®å½\n\nmongodb å°æ°æ®ç®å½å­å¨å¨ db ç®å½ä¸ãä½æ¯è¿ä¸ªæ°æ®ç®å½ä¸ä¼ä¸»å¨åå»ºï¼æä»¬å¨å®è£å®æåéè¦åå»ºå®ã\n\nä¾å¦ï¼d:\\tools\\server\\mongodb\\mongodb-4.4.0\\data\\db\n\nï¼3ï¼è¿è¡ mongodb æå¡\n\nmongod --dbpath d:\\tools\\server\\mongodb\\mongodb-4.4.0\\data\\db\n\n\nï¼4ï¼å®¢æ·ç«¯è¿æ¥ mongodb\n\nå¯ä»¥å¨å½ä»¤çªå£ä¸­è¿è¡ mongo.exe å½ä»¤å³å¯è¿æ¥ä¸ mongodb\n\nï¼5ï¼éç½® mongodb æå¡\n\n\n# linux\n\nï¼1ï¼ä½¿ç¨å®è£åå®è£\n\nå®è£åæä»¬éè¦å®è£åä¸ª linux å¹³å°ä¾èµåã\n\nred hat/centosï¼\n\nsudo yum install libcurl openssl\n\n\nubuntu 18.04 lts ("bionic")/debian 10 "buster"ï¼\n\nsudo apt-get install libcurl4 openssl\n\n\nubuntu 16.04 lts ("xenial")/debian 9 "stretch"ï¼\n\nsudo apt-get install libcurl3 openssl\n\n\nï¼2ï¼åå»ºæ°æ®ç®å½\n\né»è®¤æåµä¸ mongodb å¯å¨åä¼åå§åä»¥ä¸ä¸¤ä¸ªç®å½ï¼\n\n * æ°æ®å­å¨ç®å½ï¼/var/lib/mongodb\n * æ¥å¿æä»¶ç®å½ï¼/var/log/mongodb\n\næä»¬å¨å¯å¨åå¯ä»¥ååå»ºè¿ä¸¤ä¸ªç®å½å¹¶è®¾ç½®å½åç¨æ·æè¯»åæéï¼\n\nsudo mkdir -p /var/lib/mongo\nsudo mkdir -p /var/log/mongodb\nsudo chown `whoami` /var/lib/mongo     # è®¾ç½®æé\nsudo chown `whoami` /var/log/mongodb   # è®¾ç½®æé\n\n\nï¼3ï¼è¿è¡ mongodb æå¡\n\nmongod --dbpath /var/lib/mongo --logpath /var/log/mongodb/mongod.log --fork\n\n\næå¼ /var/log/mongodb/mongod.log æä»¶çå°ä»¥ä¸ä¿¡æ¯ï¼è¯´æå¯å¨æåã\n\n# tail -10f /var/log/mongodb/mongod.log\n2020-07-09t12:20:17.391+0800 i  network  [listener] listening on /tmp/mongodb-27017.sock\n2020-07-09t12:20:17.392+0800 i  network  [listener] listening on 127.0.0.1\n2020-07-09t12:20:17.392+0800 i  network  [listener] waiting for connections on port 27017\n\n\nï¼4ï¼å®¢æ·ç«¯è¿æ¥ mongodb\n\ncd /usr/local/mongodb4/bin\n./mongo\n\n\n> linux å®è£èæ¬\n\n\n# è®¾ç½®ç¨æ·åãå¯ç \n\n> use admin\nswitched to db admin\n> db.createuser({"user":"root","pwd":"root","roles":[{"role":"useradminanydatabase","db":"admin"}]})\nsuccessfully added user: {\n        "user" : "root",\n        "roles" : [\n                {\n                        "role" : "useradminanydatabase",\n                        "db" : "admin"\n                }\n        ]\n}\n>\n\n\n\n# å¤ä»½åæ¢å¤\n\n\n# æ°æ®å¤ä»½\n\nå¨ mongodb ä¸­ï¼ä½¿ç¨ mongodump å½ä»¤æ¥å¤ä»½ mongodb æ°æ®ãè¯¥å½ä»¤å¯ä»¥å¯¼åºæææ°æ®å°æå®ç®å½ä¸­ã\n\nmongodump å½ä»¤å¯ä»¥éè¿åæ°æå®å¯¼åºçæ°æ®éçº§è½¬å­çæå¡å¨ã\n\nmongodump å½ä»¤è¯­æ³å¦ä¸ï¼\n\nmongodump -h dbhost -d dbname -o dbdirectory\n\n\n * -hï¼mongdb æå¨æå¡å¨å°åï¼ä¾å¦ï¼127.0.0.1ï¼å½ç¶ä¹å¯ä»¥æå®ç«¯å£å·ï¼127.0.0.1:27017\n\n * -dï¼éè¦å¤ä»½çæ°æ®åºå®ä¾ï¼ä¾å¦ï¼test\n\n * -oï¼å¤ä»½çæ°æ®å­æ¾ä½ç½®ï¼ä¾å¦ï¼c:\\data\\dumpï¼å½ç¶è¯¥ç®å½éè¦æåå»ºç«ï¼å¨å¤ä»½å®æåï¼ç³»ç»èªå¨å¨ dump ç®å½ä¸å»ºç«ä¸ä¸ª test ç®å½ï¼è¿ä¸ªç®å½éé¢å­æ¾è¯¥æ°æ®åºå®ä¾çå¤ä»½æ°æ®ã\n\nmongodump å½ä»¤å¯éåæ°åè¡¨å¦ä¸æç¤ºï¼\n\nè¯­æ³                                                  æè¿°                    å®ä¾\nmongodump --host host_name --port port_number       è¯¥å½ä»¤å°å¤ä»½ææ mongodb æ°æ®   mongodump --host runoob.com --port 27017\nmongodump --dbpath db_path --out backup_directory                         mongodump --dbpath /data/db/ --out /data/backup/\nmongodump --collection collection --db db_name      è¯¥å½ä»¤å°å¤ä»½æå®æ°æ®åºçéåã       mongodump --collection mycol --db test\n\nãç¤ºä¾ãå¤ä»½å¨éæ°æ®\n\n$ mongodump -h 127.0.0.1 --port 27017 -o test2\n...\n2020-09-11t11:55:58.086+0800    done dumping test.company (18801 documents)\n2020-09-11t11:56:00.725+0800    [#############...........]  test.people  559101/1000000  (55.9%)\n2020-09-11t11:56:03.725+0800    [###################.....]  test.people  829496/1000000  (82.9%)\n2020-09-11t11:56:06.725+0800    [#####################...]  test.people  884614/1000000  (88.5%)\n2020-09-11t11:56:08.088+0800    [########################]  test.people  1000000/1000000  (100.0%)\n2020-09-11t11:56:08.350+0800    done dumping test.people (1000000 documents)\n\n\nãç¤ºä¾ãå¤ä»½æå®æ°æ®åº\n\nmongodump -h 127.0.0.1 --port 27017 -d admin -o test3\n\n\n\n# æ°æ®æ¢å¤\n\nmongodb ä½¿ç¨ mongorestore å½ä»¤æ¥æ¢å¤å¤ä»½çæ°æ®ã\n\nmongorestore å½ä»¤è¯­æ³å¦ä¸ï¼\n\n> mongorestore -h <hostname><:port> -d dbname <path>\n\n\n * --host <:port>, -h <:port>ï¼mongodb æå¨æå¡å¨å°åï¼é»è®¤ä¸ºï¼ localhost:27017\n\n * --db , -d ï¼éè¦æ¢å¤çæ°æ®åºå®ä¾ï¼ä¾å¦ï¼testï¼å½ç¶è¿ä¸ªåç§°ä¹å¯ä»¥åå¤ä»½æ¶åçä¸ä¸æ ·ï¼æ¯å¦ test2\n\n * --dropï¼æ¢å¤çæ¶åï¼åå é¤å½åæ°æ®ï¼ç¶åæ¢å¤å¤ä»½çæ°æ®ãå°±æ¯è¯´ï¼æ¢å¤åï¼å¤ä»½åæ·»å ä¿®æ¹çæ°æ®é½ä¼è¢«å é¤ï¼æç¨å¦ï¼\n\n * <path>ï¼mongorestore æåçä¸ä¸ªåæ°ï¼è®¾ç½®å¤ä»½æ°æ®æå¨ä½ç½®ï¼ä¾å¦ï¼c:\\data\\dump\\testãä½ ä¸è½åæ¶æå® <path> å --dir éé¡¹ï¼--dir ä¹å¯ä»¥è®¾ç½®å¤ä»½ç®å½ã\n\n * --dirï¼æå®å¤ä»½çç®å½ãä½ ä¸è½åæ¶æå® <path> å --dir éé¡¹ã\n\nãç¤ºä¾ã\n\n$ mongorestore -h 127.0.0.1 --port 27017 -d test --dir test --drop\n...\n2020-09-11t11:46:16.053+0800    finished restoring test.tweets (966 documents, 0 failures)\n2020-09-11t11:46:18.256+0800    [###.....................]  test.people  164mb/1.03gb  (15.6%)\n2020-09-11t11:46:21.255+0800    [########................]  test.people  364mb/1.03gb  (34.6%)\n2020-09-11t11:46:24.256+0800    [############............]  test.people  558mb/1.03gb  (53.0%)\n2020-09-11t11:46:27.255+0800    [###############.........]  test.people  700mb/1.03gb  (66.5%)\n2020-09-11t11:46:30.257+0800    [###################.....]  test.people  846mb/1.03gb  (80.3%)\n2020-09-11t11:46:33.255+0800    [######################..]  test.people  990mb/1.03gb  (94.0%)\n2020-09-11t11:46:34.542+0800    [########################]  test.people  1.03gb/1.03gb  (100.0%)\n2020-09-11t11:46:34.543+0800    no indexes to restore\n2020-09-11t11:46:34.543+0800    finished restoring test.people (1000000 documents, 0 failures)\n2020-09-11t11:46:34.544+0800    1000966 document(s) restored successfully. 0 document(s) failed to restore.\n\n\n\n# å¯¼å¥å¯¼åº\n\nmongoimport å mongoexport å¹¶ä¸è½å¯é å°ä¿å­ææçå¯ææ¬ bson æ°æ®ç±»åï¼å ä¸º json ä»è½ä»£è¡¨ä¸ç§ bson æ¯æçå­éç±»åãå æ­¤ï¼æ°æ®ç¨è¿äºå·¥å·å¯¼åºå¯¼å¥æè®¸ä¼ä¸¢å¤±ä¸äºç²¾ç¡®ç¨åº¦ã\n\n\n# å¯¼å¥æä½\n\nå¨ mongodb ä¸­ï¼ä½¿ç¨ mongoimport æ¥å¯¼å¥æ°æ®ã é»è®¤æåµä¸ï¼mongoimport ä¼å°æ°æ®å¯¼å¥å°æ¬å°ä¸»æºç«¯å£ 27017 ä¸ç mongodb å®ä¾ä¸­ãè¦å°æ°æ®å¯¼å¥å¨å¶ä»ä¸»æºæç«¯å£ä¸è¿è¡ç mongodb å®ä¾ä¸­ï¼è¯·éè¿åå« --host å --port éé¡¹æ¥æå®ä¸»æºåæç«¯å£ã ä½¿ç¨ --drop éé¡¹å é¤éåï¼å¦æå·²ç»å­å¨ï¼ã è¿æ ·å¯ä»¥ç¡®ä¿è¯¥éåä»åå«æ¨è¦å¯¼å¥çæ°æ®ã\n\nè¯­æ³æ ¼å¼ï¼\n\nmongoimport -h ip --port ç«¯å£ -u ç¨æ·å -p å¯ç  -d æ°æ®åº -c è¡¨å --type ç±»å --headerline --upsert --drop æä»¶å\n\n\nãç¤ºä¾ãå¯¼å¥è¡¨æ°æ®\n\n$ mongoimport -h 127.0.0.1 --port 27017 -d test -c book --drop test/book.dat\n2020-09-11t10:53:56.359+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11t10:53:56.372+0800    dropping: test.book\n2020-09-11t10:53:56.628+0800    431 document(s) imported successfully. 0 document(s) failed to import.\n\n\nãç¤ºä¾ãä» json æä»¶ä¸­å¯¼å¥è¡¨æ°æ®\n\n$ mongoimport -h 127.0.0.1 --port 27017 -d test -c student --upsert test/student.json\n2020-09-11t11:02:55.907+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11t11:02:56.068+0800    200 document(s) imported successfully. 0 document(s) failed to import.\n\n\nãç¤ºä¾ãä» csv æä»¶ä¸­å¯¼å¥è¡¨æ°æ®\n\n$ mongoimport -h 127.0.0.1 --port 27017 -d test -c product --type csv --headerline test/product.csv\n2020-09-11t11:07:49.788+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11t11:07:51.051+0800    11 document(s) imported successfully. 0 document(s) failed to import.\n\n\nãç¤ºä¾ãå¯¼å¥é¨åè¡¨å­æ®µæ°æ®\n\n$ mongoimport -h 127.0.0.1 --port 27017 -d test -c product --type json --upsertfields name,price test/product.json\n2020-09-11t11:14:05.410+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11t11:14:05.612+0800    11 document(s) imported successfully. 0 document(s) failed to import.\n\n\n\n# å¯¼åºæä½\n\nè¯­æ³æ ¼å¼ï¼\n\nmongoexport -h <ip> --port <ç«¯å£> -u <ç¨æ·å> -p <å¯ç > -d <æ°æ®åº> -c <è¡¨å> -f <å­æ®µ> -q <æ¡ä»¶å¯¼åº> --csv -o <æä»¶å>\n\n\n * -fï¼å¯¼åºæå­æ®µï¼ä»¥éå·åå²ï¼-f name,email,age å¯¼åº name,email,age è¿ä¸ä¸ªå­æ®µ\n * -qï¼å¯ä»¥æ ¹æ¥è¯¢æ¡ä»¶å¯¼åºï¼-q \'{ "uid" : "100" }\' å¯¼åº uid ä¸º 100 çæ°æ®\n * --csvï¼è¡¨ç¤ºå¯¼åºçæä»¶æ ¼å¼ä¸º csv çï¼è¿ä¸ªæ¯è¾æç¨ï¼å ä¸ºå¤§é¨åçå³ç³»åæ°æ®åºé½æ¯æ¯æ csvï¼å¨è¿éæå±åç¹\n\nãç¤ºä¾ãå¯¼åºæ´å¼ è¡¨\n\n$ mongoexport -h 127.0.0.1 --port 27017 -d test -c product -o test/product.dat\n2020-09-11t10:44:23.161+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11t10:44:23.177+0800    exported 11 records\n\n\nãç¤ºä¾ãå¯¼åºè¡¨å° json æä»¶\n\n$ mongoexport -h 127.0.0.1 --port 27017 -d test -c product --type json -o test/product.json\n2020-09-11t10:49:52.735+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11t10:49:52.750+0800    exported 11 records\n\n\nãç¤ºä¾ãå¯¼åºè¡¨ä¸­é¨åå­æ®µå° csv æä»¶\n\n$ mongoexport -h 127.0.0.1 --port 27017 -d test -c product --type csv -f name,price -o test/product.csv\n2020-09-11t10:47:33.160+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11t10:47:33.176+0800    exported 11 records\n\n\n\n# åèèµæ\n\n * mongodb å®ç½\n * mongodb github\n * mongodb å®æ¹åè´¹æç¨\n * mongodb æç¨',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"MongoDB æç¨",frontmatter:{title:"MongoDB æç¨",date:"2020-09-09T20:47:14.000Z",categories:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],tags:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],permalink:"/pages/b1a116/",hidden:!0},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/04.%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/01.MongoDB/",relativePath:"12.æ°æ®åº/04.ææ¡£æ°æ®åº/01.MongoDB/README.md",key:"v-d98adcc4",path:"/pages/b1a116/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:284},{level:3,title:"MongoDB åºç¨æå",slug:"mongodb-åºç¨æå",normalizedTitle:"mongodb åºç¨æå",charIndex:294},{level:3,title:"MongoDB ç CRUD æä½",slug:"mongodb-ç-crud-æä½",normalizedTitle:"mongodb ç crud æä½",charIndex:311},{level:3,title:"MongoDB èåæä½",slug:"mongodb-èåæä½",normalizedTitle:"mongodb èåæä½",charIndex:333},{level:3,title:"MongoDB äºå¡",slug:"mongodb-äºå¡",normalizedTitle:"mongodb äºå¡",charIndex:350},{level:3,title:"MongoDB å»ºæ¨¡",slug:"mongodb-å»ºæ¨¡",normalizedTitle:"mongodb å»ºæ¨¡",charIndex:365},{level:3,title:"MongoDB å»ºæ¨¡ç¤ºä¾",slug:"mongodb-å»ºæ¨¡ç¤ºä¾",normalizedTitle:"mongodb å»ºæ¨¡ç¤ºä¾",charIndex:380},{level:3,title:"MongoDB ç´¢å¼",slug:"mongodb-ç´¢å¼",normalizedTitle:"mongodb ç´¢å¼",charIndex:397},{level:3,title:"MongoDB å¤å¶",slug:"mongodb-å¤å¶",normalizedTitle:"mongodb å¤å¶",charIndex:412},{level:3,title:"MongoDB åç",slug:"mongodb-åç",normalizedTitle:"mongodb åç",charIndex:427},{level:3,title:"MongoDB è¿ç»´",slug:"mongodb-è¿ç»´",normalizedTitle:"mongodb è¿ç»´",charIndex:442},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:457},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:634}],headersStr:"ð åå®¹ MongoDB åºç¨æå MongoDB ç CRUD æä½ MongoDB èåæä½ MongoDB äºå¡ MongoDB å»ºæ¨¡ MongoDB å»ºæ¨¡ç¤ºä¾ MongoDB ç´¢å¼ MongoDB å¤å¶ MongoDB åç MongoDB è¿ç»´ ð èµæ ðª ä¼ é",content:"# MongoDB æç¨\n\n> MongoDB æ¯ä¸ä¸ªåºäºææ¡£çåå¸å¼æ°æ®åºï¼ç± C++ è¯­è¨ç¼åãæ¨å¨ä¸º WEB åºç¨æä¾å¯æ©å±çé«æ§è½æ°æ®å­å¨è§£å³æ¹æ¡ã\n> \n> MongoDB æ¯ä¸ä¸ªä»äºå³ç³»åæ°æ®åºåéå³ç³»åæ°æ®åºä¹é´çäº§åãå®æ¯éå³ç³»æ°æ®åºå½ä¸­åè½æä¸°å¯ï¼æåå³ç³»æ°æ®åºçãå®æ¯æçæ°æ®ç»æéå¸¸æ¾æ£ï¼æ¯ç±»ä¼¼ json ç bson æ ¼å¼ï¼å æ­¤å¯ä»¥å­å¨æ¯è¾å¤æçæ°æ®ç±»åã\n> \n> MongoDB æå¤§çç¹ç¹æ¯å®æ¯æçæ¥è¯¢è¯­è¨éå¸¸å¼ºå¤§ï¼å¶è¯­æ³æç¹ç±»ä¼¼äºé¢åå¯¹è±¡çæ¥è¯¢è¯­è¨ï¼å ä¹å¯ä»¥å®ç°ç±»ä¼¼å³ç³»æ°æ®åºåè¡¨æ¥è¯¢çç»å¤§é¨ååè½ï¼èä¸è¿æ¯æå¯¹æ°æ®å»ºç«ç´¢å¼ã\n\n\n# ð åå®¹\n\n\n# MongoDB åºç¨æå\n\n\n# MongoDB ç CRUD æä½\n\n\n# MongoDB èåæä½\n\n\n# MongoDB äºå¡\n\n\n# MongoDB å»ºæ¨¡\n\n\n# MongoDB å»ºæ¨¡ç¤ºä¾\n\n\n# MongoDB ç´¢å¼\n\n\n# MongoDB å¤å¶\n\n\n# MongoDB åç\n\n\n# MongoDB è¿ç»´\n\n\n# ð èµæ\n\n * å®æ¹\n   * MongoDB å®ç½\n   * MongoDB Github\n   * MongoDB å®æ¹åè´¹æç¨\n * æç¨\n   * MongoDB æç¨\n   * MongoDB é«æè¯¾\n * æ°æ®\n   * mongodb-json-files\n * æç« \n   * Introduction to MongoDB\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç IT ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",normalizedContent:"# mongodb æç¨\n\n> mongodb æ¯ä¸ä¸ªåºäºææ¡£çåå¸å¼æ°æ®åºï¼ç± c++ è¯­è¨ç¼åãæ¨å¨ä¸º web åºç¨æä¾å¯æ©å±çé«æ§è½æ°æ®å­å¨è§£å³æ¹æ¡ã\n> \n> mongodb æ¯ä¸ä¸ªä»äºå³ç³»åæ°æ®åºåéå³ç³»åæ°æ®åºä¹é´çäº§åãå®æ¯éå³ç³»æ°æ®åºå½ä¸­åè½æä¸°å¯ï¼æåå³ç³»æ°æ®åºçãå®æ¯æçæ°æ®ç»æéå¸¸æ¾æ£ï¼æ¯ç±»ä¼¼ json ç bson æ ¼å¼ï¼å æ­¤å¯ä»¥å­å¨æ¯è¾å¤æçæ°æ®ç±»åã\n> \n> mongodb æå¤§çç¹ç¹æ¯å®æ¯æçæ¥è¯¢è¯­è¨éå¸¸å¼ºå¤§ï¼å¶è¯­æ³æç¹ç±»ä¼¼äºé¢åå¯¹è±¡çæ¥è¯¢è¯­è¨ï¼å ä¹å¯ä»¥å®ç°ç±»ä¼¼å³ç³»æ°æ®åºåè¡¨æ¥è¯¢çç»å¤§é¨ååè½ï¼èä¸è¿æ¯æå¯¹æ°æ®å»ºç«ç´¢å¼ã\n\n\n# ð åå®¹\n\n\n# mongodb åºç¨æå\n\n\n# mongodb ç crud æä½\n\n\n# mongodb èåæä½\n\n\n# mongodb äºå¡\n\n\n# mongodb å»ºæ¨¡\n\n\n# mongodb å»ºæ¨¡ç¤ºä¾\n\n\n# mongodb ç´¢å¼\n\n\n# mongodb å¤å¶\n\n\n# mongodb åç\n\n\n# mongodb è¿ç»´\n\n\n# ð èµæ\n\n * å®æ¹\n   * mongodb å®ç½\n   * mongodb github\n   * mongodb å®æ¹åè´¹æç¨\n * æç¨\n   * mongodb æç¨\n   * mongodb é«æè¯¾\n * æ°æ®\n   * mongodb-json-files\n * æç« \n   * introduction to mongodb\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç it ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Redis é¢è¯æ»ç»",frontmatter:{title:"Redis é¢è¯æ»ç»",date:"2020-07-13T17:03:42.000Z",categories:["æ°æ®åº","KVæ°æ®åº","Redis"],tags:["æ°æ®åº","KVæ°æ®åº","Redis","é¢è¯"],permalink:"/pages/451b73/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/05.KV%E6%95%B0%E6%8D%AE%E5%BA%93/01.Redis/01.Redis%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html",relativePath:"12.æ°æ®åº/05.KVæ°æ®åº/01.Redis/01.Redisé¢è¯æ»ç».md",key:"v-cd3bd61e",path:"/pages/451b73/",headers:[{level:2,title:"Redis æ°æ®ç±»å",slug:"redis-æ°æ®ç±»å",normalizedTitle:"redis æ°æ®ç±»å",charIndex:17},{level:2,title:"Redis åå­æ·æ±°",slug:"redis-åå­æ·æ±°",normalizedTitle:"redis åå­æ·æ±°",charIndex:460},{level:2,title:"Redis æä¹å",slug:"redis-æä¹å",normalizedTitle:"redis æä¹å",charIndex:1439},{level:2,title:"Redis äºå¡",slug:"redis-äºå¡",normalizedTitle:"redis äºå¡",charIndex:2113},{level:2,title:"Redis ç®¡é",slug:"redis-ç®¡é",normalizedTitle:"redis ç®¡é",charIndex:2637},{level:2,title:"Redis é«å¹¶å",slug:"redis-é«å¹¶å",normalizedTitle:"redis é«å¹¶å",charIndex:2894},{level:2,title:"Redis å¤å¶",slug:"redis-å¤å¶",normalizedTitle:"redis å¤å¶",charIndex:3785},{level:2,title:"Redis å¨åµ",slug:"redis-å¨åµ",normalizedTitle:"redis å¨åµ",charIndex:4419},{level:2,title:"Redis vs. Memcached",slug:"redis-vs-memcached",normalizedTitle:"redis vs. memcached",charIndex:4847},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:5466}],headersStr:"Redis æ°æ®ç±»å Redis åå­æ·æ±° Redis æä¹å Redis äºå¡ Redis ç®¡é Redis é«å¹¶å Redis å¤å¶ Redis å¨åµ Redis vs. Memcached åèèµæ",content:"# Redis é¢è¯æ»ç»\n\n\n# Redis æ°æ®ç±»å\n\nãé®é¢ã\n\n * Redis æåªäºæ°æ®ç±»åï¼\n * Redis çæ°æ®ç±»ååå«éç¨äºä»ä¹æ ·çåºæ¯ï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\n> Redis æ°æ®ç±»åååºç¨\n> \n> æ°æ®ç±»åçç¹æ§ååºç¨ç»èç¹è¾å¤ï¼è¯¦æå¯ä»¥åèï¼Redis æ°æ®ç±»å\n\nï¼1ï¼Redis æ¯æäºç§åºæ¬æ°æ®ç±»åï¼\n\n * Stringï¼å¸¸ç¨äº KV ç¼å­\n * Hashï¼å­å¨ç»æåæ°æ®ï¼å¦ï¼äº§åä¿¡æ¯ãç¨æ·ä¿¡æ¯ç­ã\n * Listï¼å­å¨åè¡¨ï¼å¦ï¼ç²ä¸åè¡¨ãæç« è¯è®ºåè¡¨ç­ãå¯ä»¥éè¿ lrange å½ä»¤è¿è¡åé¡µæ¥è¯¢ã\n * Setï¼å­å¨å»éåè¡¨ï¼å¦ï¼ç²ä¸åè¡¨ç­ãå¯ä»¥åºäº set ç©å¿äº¤éãå¹¶éãå·®éçæä½ãä¾å¦ï¼æ±ä¸¤ä¸ªäººçå±åå¥½ååè¡¨ã\n * Sorted Setï¼å­å¨å«è¯åçå»éåè¡¨ï¼å¦ï¼åç§æè¡æ¦ã\n\nï¼2ï¼é¤æ­¤ä»¥å¤ï¼è¿æ BitmapsãHyperLogLogsãGEOãStreams ç­é«çº§æ°æ®ç±»åã\n\n\n# Redis åå­æ·æ±°\n\nãé®é¢ã\n\n * Redis æåªäºåå­æ·æ±°ç­ç¥ï¼\n * è¿äºæ·æ±°ç­ç¥åå«éç¨äºä»ä¹åºæ¯ï¼\n * Redis æåªäºå é¤å¤±æ key çæ¹æ³ï¼\n * å¦ä½è®¾ç½® Redis ä¸­é®çè¿ææ¶é´ï¼\n * å¦æè®©ä½ å®ç°ä¸ä¸ª LRU ç®æ³ï¼æä¹åï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\nï¼1ï¼Redis è¿æç­ç¥æ¯ï¼å®æå é¤+æ°æ§å é¤ã\n\n * æ¶ææ¹æ³ï¼passive wayï¼ï¼å¨ä¸»é®è¢«è®¿é®æ¶å¦æåç°å®å·²ç»å¤±æï¼é£ä¹å°±å é¤å®ã\n * ä¸»å¨æ¹æ³ï¼active wayï¼ï¼å®æä»è®¾ç½®äºå¤±ææ¶é´çä¸»é®ä¸­éæ©ä¸é¨åå¤±æçä¸»é®å é¤ã\n\nï¼2ï¼Redis åå­æ·æ±°ç­ç¥ï¼\n\n * noeviction - å½åå­ä½¿ç¨è¾¾å°éå¼çæ¶åï¼ææå¼èµ·ç³è¯·åå­çå½ä»¤ä¼æ¥éãè¿æ¯ Redis é»è®¤çç­ç¥ã\n * allkeys-lru - å¨ä¸»é®ç©ºé´ä¸­ï¼ä¼åç§»é¤æè¿æªä½¿ç¨ç keyã\n * allkeys-random - å¨ä¸»é®ç©ºé´ä¸­ï¼éæºç§»é¤æä¸ª keyã\n * volatile-lru - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼ä¼åç§»é¤æè¿æªä½¿ç¨ç keyã\n * volatile-random - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼éæºç§»é¤æä¸ª keyã\n * volatile-ttl - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼å·ææ´æ©è¿ææ¶é´ç key ä¼åç§»é¤ã\n\nï¼3ï¼å¦ä½éæ©åå­æ·æ±°ç­ç¥ï¼\n\n * å¦ææ°æ®åç°å¹ç­åå¸ï¼ä¹å°±æ¯ä¸é¨åæ°æ®è®¿é®é¢çé«ï¼ä¸é¨åæ°æ®è®¿é®é¢çä½ï¼åä½¿ç¨ allkeys-lruã\n * å¦ææ°æ®åç°å¹³ç­åå¸ï¼ä¹å°±æ¯ææçæ°æ®è®¿é®é¢çé½ç¸åï¼åä½¿ç¨ allkeys-randomã\n * volatile-lru ç­ç¥å volatile-random ç­ç¥éåæä»¬å°ä¸ä¸ª Redis å®ä¾æ¢åºç¨äºç¼å­åååºç¨äºæä¹åå­å¨çæ¶åï¼ç¶èæä»¬ä¹å¯ä»¥éè¿ä½¿ç¨ä¸¤ä¸ª Redis å®ä¾æ¥è¾¾å°ç¸åçææã\n * å° key è®¾ç½®è¿ææ¶é´å®éä¸ä¼æ¶èæ´å¤çåå­ï¼å æ­¤æä»¬å»ºè®®ä½¿ç¨ allkeys-lru ç­ç¥ä»èæ´ææççä½¿ç¨åå­ã\n\nï¼4ï¼LRU ç®æ³å®ç°æè·¯ï¼å¯ä»¥ç»§æ¿ LinkedHashMapï¼å¹¶è¦å removeEldestEntry æ¹æ³æ¥å®ç°ä¸ä¸ªæç®åç LRUCache\n\n\n# Redis æä¹å\n\nãé®é¢ã\n\n * Redis æå ç§æä¹åæ¹å¼ï¼\n * Redis çä¸åæä¹åæ¹å¼çç¹æ§ååçæ¯ä»ä¹ï¼\n * RDB å AOF åæä»ä¹ä¼ç¼ºç¹ï¼åå«éç¨äºä»ä¹æ ·çåºæ¯ï¼\n * Redis æ§è¡æä¹åæ¶ï¼å¯ä»¥å¤çè¯·æ±åï¼\n * AOF æå ç§åæ­¥é¢çï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\n> Redis æä¹å\n> \n> è¯¦æå¯ä»¥åèï¼Redis æä¹å\n\nï¼1ï¼Redis æ¯æä¸¤ç§æä¹åæ¹å¼ï¼RDB å AOFã\n\nï¼2ï¼RDB å³æä¸æ¶å»çäºè¿å¶æ°æ®å¿«ç§ã\n\nRedis ä¼å¨ææ§çæ RDB æä»¶ã\n\nçæ RDB æµç¨ï¼Redis fork ä¸ä¸ªå­è¿ç¨ï¼è´è´£çæ RDBï¼çæ RDB éç¨ Copy On Write æ¨¡å¼ï¼æ­¤æ¶ï¼å¦ææ¶å°åè¯·æ±ï¼ä¼å¨åå¯æ¬ä¸æä½ï¼ä¸å½±åå·¥ä½ã\n\nRDB åªè½æ¢å¤çæå¿«ç§æ¶å»çæ°æ®ï¼ä¹åçæ°æ®æ æ³æ¢å¤ãçæ RDB çèµæºå¼éé«æãRDB éååå·å¤ã\n\nï¼3ï¼AOF ä¼å°åå½ä»¤ä¸æ­è¿½å å° AOF ææ¬æ¥å¿æ«å°¾ã\n\nAOF ä¸¢æ°æ®æ¯ RDB å°ï¼ä½æä»¶ä¼æ¯ RDB æä»¶å¤§å¾å¤ã\n\nä¸è¬ï¼AOF è®¾ç½® appendfsync åæ­¥é¢çä¸º everysec å³å¯ã\n\nï¼4ï¼RDB or AOF\n\nå»ºè®®åæ¶ä½¿ç¨ RDB å AOFãç¨ AOF æ¥ä¿è¯æ°æ®ä¸ä¸¢å¤±ï¼ä½ä¸ºæ°æ®æ¢å¤çç¬¬ä¸éæ©; ç¨ RDB æ¥åä¸åç¨åº¦çå·å¤ï¼å¨ AOF æä»¶é½ä¸¢å¤±ææåä¸å¯ç¨çæ¶åï¼è¿å¯ä»¥ä½¿ç¨ RDB æ¥è¿è¡å¿«éçæ°æ®æ¢å¤ã\n\n\n# Redis äºå¡\n\nãé®é¢ã\n\n * Redis çå¹¶åç«äºé®é¢æ¯ä»ä¹ï¼å¦ä½è§£å³è¿ä¸ªé®é¢ï¼\n * Redis æ¯æäºå¡åï¼\n * Redis äºå¡æ¯ä¸¥æ ¼æä¹çäºå¡åï¼Redis ä¸ºä»ä¹ä¸æ¯æåæ»ã\n * Redis äºå¡å¦ä½å·¥ä½ï¼\n * äºè§£ Redis äºå¡ä¸­ç CAS è¡ä¸ºåï¼\n\nãè§£ç­ã\n\n> Redis çäºå¡ç¹æ§ãåç\n> \n> è¯¦æåèï¼Redis åºç¨æåä¹ äºå¡\n\nRedis æä¾çä¸æ¯ä¸¥æ ¼çäºå¡ï¼Redis åªä¿è¯ä¸²è¡æ§è¡å½ä»¤ï¼å¹¶ä¸è½ä¿è¯å¨é¨æ§è¡ï¼ä½æ¯æ§è¡å½ä»¤å¤±è´¥æ¶å¹¶ä¸ä¼åæ»ï¼èæ¯ä¼ç»§ç»­æ§è¡ä¸å»ã\n\nRedis ä¸æ¯æåæ»ççç±ï¼\n\n * Redis å½ä»¤åªä¼å ä¸ºéè¯¯çè¯­æ³èå¤±è´¥ï¼ææ¯å½ä»¤ç¨å¨äºéè¯¯ç±»åçé®ä¸é¢ã\n * å ä¸ºä¸éè¦å¯¹åæ»è¿è¡æ¯æï¼æä»¥ Redis çåé¨å¯ä»¥ä¿æç®åä¸å¿«éã\n\nMULTI ã EXEC ã DISCARD å WATCH æ¯ Redis äºå¡ç¸å³çå½ä»¤ã\n\nRedis æå¤©ç¶è§£å³è¿ä¸ªå¹¶åç«äºé®é¢çç±» CAS ä¹è§éæ¹æ¡ï¼æ¯æ¬¡è¦åä¹åï¼åå¤æ­ä¸ä¸å½åè¿ä¸ª value çæ¶é´æ³æ¯å¦æ¯ç¼å­éç value çæ¶é´æ³è¦æ°ãå¦ææ¯çè¯ï¼é£ä¹å¯ä»¥åï¼å¦åï¼å°±ä¸è½ç¨æ§çæ°æ®è¦çæ°çæ°æ®ã\n\n\n# Redis ç®¡é\n\nãé®é¢ã\n\n * é¤äºäºå¡ï¼è¿æå¶ä»æ¹éæ§è¡ Redis å½ä»¤çæ¹å¼åï¼\n\nãè§£ç­ã\n\nRedis æ¯ä¸ç§åºäº C/S æ¨¡åä»¥åè¯·æ±/ååºåè®®ç TCP æå¡ãRedis æ¯æç®¡éææ¯ãç®¡éææ¯åè®¸è¯·æ±ä»¥å¼æ­¥æ¹å¼åéï¼å³æ§è¯·æ±çåºç­è¿æªè¿åçæåµä¸ï¼åè®¸åéæ°è¯·æ±ãè¿ç§æ¹å¼å¯ä»¥å¤§å¤§æé«ä¼ è¾æçãä½¿ç¨ç®¡éåéå½ä»¤æ¶ï¼Redis Server ä¼å°é¨åè¯·æ±æ¾å°ç¼å­éåä¸­ï¼å ç¨åå­ï¼ï¼æ§è¡å®æ¯åä¸æ¬¡æ§åéç»æãå¦æéè¦åéå¤§éçå½ä»¤ï¼ä¼å ç¨å¤§éçåå­ï¼å æ­¤åºè¯¥æç§åçæ°éåæ¹æ¬¡çå¤çã\n\n\n# Redis é«å¹¶å\n\nãé®é¢ã\n\n * Redis æ¯åçº¿ç¨æ¨¡åï¼ä¸ºä½ååéè¿å¾é«ï¼\n * Redis ç IO å¤è·¯å¤ç¨åçæ¯ä»ä¹ï¼\n * Redis éç¾¤å¦ä½åçåå¯»åï¼\n * Redis éç¾¤å¦ä½æ©å±ï¼\n * Redis éç¾¤å¦ä½ä¿è¯æ°æ®ä¸è´ï¼\n * Redis éç¾¤å¦ä½è§åï¼ä½ ä»¬å¬å¸ççäº§ç¯å¢ä¸å¦ä½é¨ç½² Redis éç¾¤ï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\n> Redis éç¾¤\n> \n> è¯¦æå¯ä»¥åèï¼Redis éç¾¤\n\nï¼1ï¼åçº¿ç¨\n\nRedis ä¸ºåè¿ç¨åçº¿ç¨æ¨¡å¼ï¼éç¨éåæ¨¡å¼å°å¹¶åè®¿é®åä¸ºä¸²è¡è®¿é®ãRedis åæºååéä¹å¾é«ï¼è½è¾¾å°å ä¸ QPSã\n\nRedis åçº¿ç¨æ¨¡åï¼ä¾ç¶æå¾é«çå¹¶åååï¼åå å¨äºï¼\n\n * Redis è¯»åé½æ¯åå­æä½ã\n * Redis åºäºéé»å¡ç IO å¤è·¯å¤ç¨æºå¶ï¼åæ¶çå¬å¤ä¸ª socketï¼å°äº§çäºä»¶ç socket åå¥åå­éåä¸­ï¼äºä»¶åæ´¾å¨æ ¹æ® socket ä¸çäºä»¶ç±»åæ¥éæ©å¯¹åºçäºä»¶å¤çå¨è¿è¡å¤çã\n * åçº¿ç¨ï¼é¿åäºçº¿ç¨åå»ºãéæ¯ãä¸ä¸æåæ¢çå¼éï¼å¹¶ä¸é¿åäºèµæºç«äºã\n\nï¼2ï¼æ©å±å¹¶åååéãå­å¨å®¹é\n\nRedis çé«æ§è½ï¼æ©å±å¹¶åååéãå­å¨å®¹éï¼éè¿ä¸»ä»æ¶ææ¥å®ç°ã\n\nRedis éç¾¤éç¨ä¸»ä»æ¨¡åï¼æä¾å¤å¶åæéè½¬ç§»åè½ï¼æ¥ä¿è¯ Redis éç¾¤çé«å¯ç¨ãéå¸¸æåµï¼ä¸ä¸»å¤ä»æ¨¡å¼å·²ç»å¯ä»¥æ»¡è¶³å¤§é¨åé¡¹ç®çéè¦ãæ ¹æ®å®éçå¹¶åéï¼å¯ä»¥éè¿å¢å èç¹æ¥æ©å±å¹¶åååã\n\nä¸ä¸»å¤ä»æ¨¡å¼ä¸ï¼ä¸»èç¹è´è´£åæä½ï¼åæºå ä¸ QPSï¼ï¼ä»èç¹è´è´£æ¥è¯¢æä½ï¼åæºåä¸ QPSï¼ã\n\nè¿ä¸æ­¥ï¼å¦æéè¦ç¼å­å¤§éæ°æ®ï¼å°±éè¦ååºï¼shardingï¼ãRedis éç¾¤éè¿ååèæ hash æ§½æ¥åçï¼æ¯ä¸ªä¸»èç¹è´è´£ä¸å®èå´ç hash æ§½ãå½éè¦æ©å±éç¾¤èç¹æ¶ï¼éæ°åé hash æ§½å³å¯ï¼redis-trib ä¼èªå¨è¿ç§»åæ´ hash æ§½ä¸­æå±ç keyã\n\nï¼3ï¼Redis éç¾¤æ°æ®ä¸è´æ§\n\nRedis éç¾¤åºäºå¤å¶ç¹æ§å®ç°èç¹é´çæ°æ®ä¸è´æ§ã\n\n\n# Redis å¤å¶\n\nãé®é¢ã\n\n * Redis å¤å¶çå·¥ä½åçï¼Redis æ§çå¤å¶åæ°çå¤å¶æä½ä¸åï¼\n * Redis ä¸»ä»èç¹é´å¦ä½å¤å¶æ°æ®ï¼\n * Redis çæ°æ®ä¸è´æ§æ¯å¼ºä¸è´æ§åï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\n> Redis å¤å¶\n> \n> è¯¦æå¯ä»¥åèï¼Redis å¤å¶\n\nï¼1ï¼æ§çå¤å¶åºäº SYNC å½ä»¤å®ç°ãåä¸ºåæ­¥ï¼syncï¼åå½ä»¤ä¼ æ­ï¼command propagateï¼ä¸¤ä¸ªæä½ãè¿ç§æ¹å¼å­å¨ç¼ºé·ï¼ä¸è½é«æå¤çæ­çº¿éè¿åçå¤å¶æåµã\n\nï¼2ï¼æ°çå¤å¶åºäº PSYNC å½ä»¤å®ç°ãåæ­¥æä½åä¸ºäºä¸¤åï¼\n\n * å®æ´éåæ­¥ï¼full resychronizationï¼ ç¨äºåæ¬¡å¤å¶ï¼\n * é¨åéåæ­¥ï¼partial resychronizationï¼ ç¨äºæ­çº¿åéå¤å¶ã\n   * ä¸»ä»æå¡å¨çå¤å¶åç§»éï¼replication offsetï¼\n   * ä¸»æå¡å¨çå¤å¶ç§¯åç¼å²åºï¼replication backlogï¼\n   * æå¡å¨çè¿è¡ ID\n\nï¼3ï¼Redis éç¾¤ä¸»ä»èç¹å¤å¶çå·¥ä½æµç¨ï¼\n\n * æ­¥éª¤ 1. è®¾ç½®ä¸»ä»æå¡å¨\n * æ­¥éª¤ 2. ä¸»ä»æå¡å¨å»ºç« TCP è¿æ¥ã\n * æ­¥éª¤ 3. åé PING æ£æ¥éä¿¡ç¶æã\n * æ­¥éª¤ 4. èº«ä»½éªè¯ã\n * æ­¥éª¤ 5. åéç«¯å£ä¿¡æ¯ã\n * æ­¥éª¤ 6. åæ­¥ã\n * æ­¥éª¤ 7. å½ä»¤ä¼ æ­ã\n\n\n# Redis å¨åµ\n\nãé®é¢ã\n\n * Redis å¦ä½å®ç°é«å¯ç¨ï¼\n * Redis å¨åµçåè½ï¼\n * Redis å¨åµçåçï¼\n * Redis å¨åµå¦ä½éä¸¾ Leaderï¼\n * Redis å¦ä½å®ç°æéè½¬ç§»ï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\n> Redis å¨åµ\n> \n> è¯¦æå¯ä»¥åèï¼Redis å¨åµ\n\nï¼1ï¼Redis çé«å¯ç¨æ¯éè¿å¨åµæ¥å®ç°ï¼Raft åè®®ç Redis å®ç°ï¼ãSentinelï¼å¨åµï¼å¯ä»¥çå¬ä¸»æå¡å¨ï¼å¹¶å¨ä¸»æå¡å¨è¿å¥ä¸çº¿ç¶ææ¶ï¼èªå¨ä»ä»æå¡å¨ä¸­éä¸¾åºæ°çä¸»æå¡å¨ã\n\nç±ä¸ä¸ªæå¤ä¸ª Sentinel å®ä¾ç»æç Sentinel ç³»ç»å¯ä»¥çè§ä»»æå¤ä¸ªä¸»æå¡å¨ï¼ä»¥åè¿äºä¸»æå¡å¨çææä»æå¡å¨ï¼å¹¶å¨è¢«çè§çä¸»æå¡å¨è¿å¥ä¸çº¿ç¶ææ¶ï¼èªå¨å°ä¸çº¿ä¸»æå¡å¨çæä¸ªä»æå¡å¨åçº§ä¸ºæ°çä¸»æå¡å¨ï¼ç¶åç±æ°çä¸»æå¡å¨ä»£æ¿å·²ä¸çº¿çä¸»æå¡å¨ç»§ç»­å¤çå½ä»¤è¯·æ±ã\n\n\n\n\n# Redis vs. Memcached\n\nãé®é¢ã\n\nRedis å Memcached æä»ä¹åºå«ï¼\n\nåå¸å¼ç¼å­ææ¯éåï¼é Redis è¿æ¯ Memcachedï¼ä¸ºä»ä¹ï¼\n\nRedis å Memcached åèªççº¿ç¨æ¨¡åæ¯ææ ·çï¼\n\nä¸ºä»ä¹åçº¿ç¨ç Redis æ§è½å´ä¸è¾äºå¤çº¿ç¨ç Memcachedï¼\n\nãè§£ç­ã\n\nRedis ä¸ä»ä»æ¯æç®åç k/v ç±»åçæ°æ®ï¼åæ¶è¿æä¾ listï¼setï¼zsetï¼hash ç­æ°æ®ç»æçå­å¨ãmemcache æ¯æç®åçæ°æ®ç±»åï¼Stringã\n\nRedis æ¯ææ°æ®çå¤ä»½ï¼å³ master-slave æ¨¡å¼çæ°æ®å¤ä»½ã\n\nRedis æ¯ææ°æ®çæä¹åï¼å¯ä»¥å°åå­ä¸­çæ°æ®ä¿æå¨ç£çä¸­ï¼éå¯çæ¶åå¯ä»¥åæ¬¡å è½½è¿è¡ä½¿ç¨,è Memecache ææ°æ®å¨é¨å­å¨åå­ä¹ä¸­\n\nredis çéåº¦æ¯ memcached å¿«å¾å¤\n\nMemcached æ¯å¤çº¿ç¨ï¼éé»å¡ IO å¤ç¨çç½ç»æ¨¡åï¼Redis ä½¿ç¨åçº¿ç¨ç IO å¤ç¨æ¨¡åã\n\n\n\nå¦ææ³è¦æ´è¯¦ç»äºè§£çè¯ï¼å¯ä»¥æ¥çæè¯¾ç½ä¸çè¿ç¯æè®°ï¼éå¸¸æ¨èï¼ ï¼ãèè¸ä¸¤åªè¹çå°æ - Memcached ä¸ Redisãï¼www.imooc.com/article/23549\n\nç»æç­ç¥ï¼ ä½¿ç¨ Redis ç String ç±»ååçäºï¼é½å¯ä»¥ç¨ Memcached æ¿æ¢ï¼ä»¥æ­¤æ¢åæ´å¥½çæ§è½æåï¼ é¤æ­¤ä»¥å¤ï¼ä¼åèè Redisï¼\n\n\n# åèèµæ\n\n * é¢è¯ä¸­å³äº Redis çé®é¢çè¿ç¯å°±å¤äº\n * advanced-java",normalizedContent:"# redis é¢è¯æ»ç»\n\n\n# redis æ°æ®ç±»å\n\nãé®é¢ã\n\n * redis æåªäºæ°æ®ç±»åï¼\n * redis çæ°æ®ç±»ååå«éç¨äºä»ä¹æ ·çåºæ¯ï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\n> redis æ°æ®ç±»åååºç¨\n> \n> æ°æ®ç±»åçç¹æ§ååºç¨ç»èç¹è¾å¤ï¼è¯¦æå¯ä»¥åèï¼redis æ°æ®ç±»å\n\nï¼1ï¼redis æ¯æäºç§åºæ¬æ°æ®ç±»åï¼\n\n * stringï¼å¸¸ç¨äº kv ç¼å­\n * hashï¼å­å¨ç»æåæ°æ®ï¼å¦ï¼äº§åä¿¡æ¯ãç¨æ·ä¿¡æ¯ç­ã\n * listï¼å­å¨åè¡¨ï¼å¦ï¼ç²ä¸åè¡¨ãæç« è¯è®ºåè¡¨ç­ãå¯ä»¥éè¿ lrange å½ä»¤è¿è¡åé¡µæ¥è¯¢ã\n * setï¼å­å¨å»éåè¡¨ï¼å¦ï¼ç²ä¸åè¡¨ç­ãå¯ä»¥åºäº set ç©å¿äº¤éãå¹¶éãå·®éçæä½ãä¾å¦ï¼æ±ä¸¤ä¸ªäººçå±åå¥½ååè¡¨ã\n * sorted setï¼å­å¨å«è¯åçå»éåè¡¨ï¼å¦ï¼åç§æè¡æ¦ã\n\nï¼2ï¼é¤æ­¤ä»¥å¤ï¼è¿æ bitmapsãhyperloglogsãgeoãstreams ç­é«çº§æ°æ®ç±»åã\n\n\n# redis åå­æ·æ±°\n\nãé®é¢ã\n\n * redis æåªäºåå­æ·æ±°ç­ç¥ï¼\n * è¿äºæ·æ±°ç­ç¥åå«éç¨äºä»ä¹åºæ¯ï¼\n * redis æåªäºå é¤å¤±æ key çæ¹æ³ï¼\n * å¦ä½è®¾ç½® redis ä¸­é®çè¿ææ¶é´ï¼\n * å¦æè®©ä½ å®ç°ä¸ä¸ª lru ç®æ³ï¼æä¹åï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\nï¼1ï¼redis è¿æç­ç¥æ¯ï¼å®æå é¤+æ°æ§å é¤ã\n\n * æ¶ææ¹æ³ï¼passive wayï¼ï¼å¨ä¸»é®è¢«è®¿é®æ¶å¦æåç°å®å·²ç»å¤±æï¼é£ä¹å°±å é¤å®ã\n * ä¸»å¨æ¹æ³ï¼active wayï¼ï¼å®æä»è®¾ç½®äºå¤±ææ¶é´çä¸»é®ä¸­éæ©ä¸é¨åå¤±æçä¸»é®å é¤ã\n\nï¼2ï¼redis åå­æ·æ±°ç­ç¥ï¼\n\n * noeviction - å½åå­ä½¿ç¨è¾¾å°éå¼çæ¶åï¼ææå¼èµ·ç³è¯·åå­çå½ä»¤ä¼æ¥éãè¿æ¯ redis é»è®¤çç­ç¥ã\n * allkeys-lru - å¨ä¸»é®ç©ºé´ä¸­ï¼ä¼åç§»é¤æè¿æªä½¿ç¨ç keyã\n * allkeys-random - å¨ä¸»é®ç©ºé´ä¸­ï¼éæºç§»é¤æä¸ª keyã\n * volatile-lru - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼ä¼åç§»é¤æè¿æªä½¿ç¨ç keyã\n * volatile-random - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼éæºç§»é¤æä¸ª keyã\n * volatile-ttl - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼å·ææ´æ©è¿ææ¶é´ç key ä¼åç§»é¤ã\n\nï¼3ï¼å¦ä½éæ©åå­æ·æ±°ç­ç¥ï¼\n\n * å¦ææ°æ®åç°å¹ç­åå¸ï¼ä¹å°±æ¯ä¸é¨åæ°æ®è®¿é®é¢çé«ï¼ä¸é¨åæ°æ®è®¿é®é¢çä½ï¼åä½¿ç¨ allkeys-lruã\n * å¦ææ°æ®åç°å¹³ç­åå¸ï¼ä¹å°±æ¯ææçæ°æ®è®¿é®é¢çé½ç¸åï¼åä½¿ç¨ allkeys-randomã\n * volatile-lru ç­ç¥å volatile-random ç­ç¥éåæä»¬å°ä¸ä¸ª redis å®ä¾æ¢åºç¨äºç¼å­åååºç¨äºæä¹åå­å¨çæ¶åï¼ç¶èæä»¬ä¹å¯ä»¥éè¿ä½¿ç¨ä¸¤ä¸ª redis å®ä¾æ¥è¾¾å°ç¸åçææã\n * å° key è®¾ç½®è¿ææ¶é´å®éä¸ä¼æ¶èæ´å¤çåå­ï¼å æ­¤æä»¬å»ºè®®ä½¿ç¨ allkeys-lru ç­ç¥ä»èæ´ææççä½¿ç¨åå­ã\n\nï¼4ï¼lru ç®æ³å®ç°æè·¯ï¼å¯ä»¥ç»§æ¿ linkedhashmapï¼å¹¶è¦å removeeldestentry æ¹æ³æ¥å®ç°ä¸ä¸ªæç®åç lrucache\n\n\n# redis æä¹å\n\nãé®é¢ã\n\n * redis æå ç§æä¹åæ¹å¼ï¼\n * redis çä¸åæä¹åæ¹å¼çç¹æ§ååçæ¯ä»ä¹ï¼\n * rdb å aof åæä»ä¹ä¼ç¼ºç¹ï¼åå«éç¨äºä»ä¹æ ·çåºæ¯ï¼\n * redis æ§è¡æä¹åæ¶ï¼å¯ä»¥å¤çè¯·æ±åï¼\n * aof æå ç§åæ­¥é¢çï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\n> redis æä¹å\n> \n> è¯¦æå¯ä»¥åèï¼redis æä¹å\n\nï¼1ï¼redis æ¯æä¸¤ç§æä¹åæ¹å¼ï¼rdb å aofã\n\nï¼2ï¼rdb å³æä¸æ¶å»çäºè¿å¶æ°æ®å¿«ç§ã\n\nredis ä¼å¨ææ§çæ rdb æä»¶ã\n\nçæ rdb æµç¨ï¼redis fork ä¸ä¸ªå­è¿ç¨ï¼è´è´£çæ rdbï¼çæ rdb éç¨ copy on write æ¨¡å¼ï¼æ­¤æ¶ï¼å¦ææ¶å°åè¯·æ±ï¼ä¼å¨åå¯æ¬ä¸æä½ï¼ä¸å½±åå·¥ä½ã\n\nrdb åªè½æ¢å¤çæå¿«ç§æ¶å»çæ°æ®ï¼ä¹åçæ°æ®æ æ³æ¢å¤ãçæ rdb çèµæºå¼éé«æãrdb éååå·å¤ã\n\nï¼3ï¼aof ä¼å°åå½ä»¤ä¸æ­è¿½å å° aof ææ¬æ¥å¿æ«å°¾ã\n\naof ä¸¢æ°æ®æ¯ rdb å°ï¼ä½æä»¶ä¼æ¯ rdb æä»¶å¤§å¾å¤ã\n\nä¸è¬ï¼aof è®¾ç½® appendfsync åæ­¥é¢çä¸º everysec å³å¯ã\n\nï¼4ï¼rdb or aof\n\nå»ºè®®åæ¶ä½¿ç¨ rdb å aofãç¨ aof æ¥ä¿è¯æ°æ®ä¸ä¸¢å¤±ï¼ä½ä¸ºæ°æ®æ¢å¤çç¬¬ä¸éæ©; ç¨ rdb æ¥åä¸åç¨åº¦çå·å¤ï¼å¨ aof æä»¶é½ä¸¢å¤±ææåä¸å¯ç¨çæ¶åï¼è¿å¯ä»¥ä½¿ç¨ rdb æ¥è¿è¡å¿«éçæ°æ®æ¢å¤ã\n\n\n# redis äºå¡\n\nãé®é¢ã\n\n * redis çå¹¶åç«äºé®é¢æ¯ä»ä¹ï¼å¦ä½è§£å³è¿ä¸ªé®é¢ï¼\n * redis æ¯æäºå¡åï¼\n * redis äºå¡æ¯ä¸¥æ ¼æä¹çäºå¡åï¼redis ä¸ºä»ä¹ä¸æ¯æåæ»ã\n * redis äºå¡å¦ä½å·¥ä½ï¼\n * äºè§£ redis äºå¡ä¸­ç cas è¡ä¸ºåï¼\n\nãè§£ç­ã\n\n> redis çäºå¡ç¹æ§ãåç\n> \n> è¯¦æåèï¼redis åºç¨æåä¹ äºå¡\n\nredis æä¾çä¸æ¯ä¸¥æ ¼çäºå¡ï¼redis åªä¿è¯ä¸²è¡æ§è¡å½ä»¤ï¼å¹¶ä¸è½ä¿è¯å¨é¨æ§è¡ï¼ä½æ¯æ§è¡å½ä»¤å¤±è´¥æ¶å¹¶ä¸ä¼åæ»ï¼èæ¯ä¼ç»§ç»­æ§è¡ä¸å»ã\n\nredis ä¸æ¯æåæ»ççç±ï¼\n\n * redis å½ä»¤åªä¼å ä¸ºéè¯¯çè¯­æ³èå¤±è´¥ï¼ææ¯å½ä»¤ç¨å¨äºéè¯¯ç±»åçé®ä¸é¢ã\n * å ä¸ºä¸éè¦å¯¹åæ»è¿è¡æ¯æï¼æä»¥ redis çåé¨å¯ä»¥ä¿æç®åä¸å¿«éã\n\nmulti ã exec ã discard å watch æ¯ redis äºå¡ç¸å³çå½ä»¤ã\n\nredis æå¤©ç¶è§£å³è¿ä¸ªå¹¶åç«äºé®é¢çç±» cas ä¹è§éæ¹æ¡ï¼æ¯æ¬¡è¦åä¹åï¼åå¤æ­ä¸ä¸å½åè¿ä¸ª value çæ¶é´æ³æ¯å¦æ¯ç¼å­éç value çæ¶é´æ³è¦æ°ãå¦ææ¯çè¯ï¼é£ä¹å¯ä»¥åï¼å¦åï¼å°±ä¸è½ç¨æ§çæ°æ®è¦çæ°çæ°æ®ã\n\n\n# redis ç®¡é\n\nãé®é¢ã\n\n * é¤äºäºå¡ï¼è¿æå¶ä»æ¹éæ§è¡ redis å½ä»¤çæ¹å¼åï¼\n\nãè§£ç­ã\n\nredis æ¯ä¸ç§åºäº c/s æ¨¡åä»¥åè¯·æ±/ååºåè®®ç tcp æå¡ãredis æ¯æç®¡éææ¯ãç®¡éææ¯åè®¸è¯·æ±ä»¥å¼æ­¥æ¹å¼åéï¼å³æ§è¯·æ±çåºç­è¿æªè¿åçæåµä¸ï¼åè®¸åéæ°è¯·æ±ãè¿ç§æ¹å¼å¯ä»¥å¤§å¤§æé«ä¼ è¾æçãä½¿ç¨ç®¡éåéå½ä»¤æ¶ï¼redis server ä¼å°é¨åè¯·æ±æ¾å°ç¼å­éåä¸­ï¼å ç¨åå­ï¼ï¼æ§è¡å®æ¯åä¸æ¬¡æ§åéç»æãå¦æéè¦åéå¤§éçå½ä»¤ï¼ä¼å ç¨å¤§éçåå­ï¼å æ­¤åºè¯¥æç§åçæ°éåæ¹æ¬¡çå¤çã\n\n\n# redis é«å¹¶å\n\nãé®é¢ã\n\n * redis æ¯åçº¿ç¨æ¨¡åï¼ä¸ºä½ååéè¿å¾é«ï¼\n * redis ç io å¤è·¯å¤ç¨åçæ¯ä»ä¹ï¼\n * redis éç¾¤å¦ä½åçåå¯»åï¼\n * redis éç¾¤å¦ä½æ©å±ï¼\n * redis éç¾¤å¦ä½ä¿è¯æ°æ®ä¸è´ï¼\n * redis éç¾¤å¦ä½è§åï¼ä½ ä»¬å¬å¸ççäº§ç¯å¢ä¸å¦ä½é¨ç½² redis éç¾¤ï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\n> redis éç¾¤\n> \n> è¯¦æå¯ä»¥åèï¼redis éç¾¤\n\nï¼1ï¼åçº¿ç¨\n\nredis ä¸ºåè¿ç¨åçº¿ç¨æ¨¡å¼ï¼éç¨éåæ¨¡å¼å°å¹¶åè®¿é®åä¸ºä¸²è¡è®¿é®ãredis åæºååéä¹å¾é«ï¼è½è¾¾å°å ä¸ qpsã\n\nredis åçº¿ç¨æ¨¡åï¼ä¾ç¶æå¾é«çå¹¶åååï¼åå å¨äºï¼\n\n * redis è¯»åé½æ¯åå­æä½ã\n * redis åºäºéé»å¡ç io å¤è·¯å¤ç¨æºå¶ï¼åæ¶çå¬å¤ä¸ª socketï¼å°äº§çäºä»¶ç socket åå¥åå­éåä¸­ï¼äºä»¶åæ´¾å¨æ ¹æ® socket ä¸çäºä»¶ç±»åæ¥éæ©å¯¹åºçäºä»¶å¤çå¨è¿è¡å¤çã\n * åçº¿ç¨ï¼é¿åäºçº¿ç¨åå»ºãéæ¯ãä¸ä¸æåæ¢çå¼éï¼å¹¶ä¸é¿åäºèµæºç«äºã\n\nï¼2ï¼æ©å±å¹¶åååéãå­å¨å®¹é\n\nredis çé«æ§è½ï¼æ©å±å¹¶åååéãå­å¨å®¹éï¼éè¿ä¸»ä»æ¶ææ¥å®ç°ã\n\nredis éç¾¤éç¨ä¸»ä»æ¨¡åï¼æä¾å¤å¶åæéè½¬ç§»åè½ï¼æ¥ä¿è¯ redis éç¾¤çé«å¯ç¨ãéå¸¸æåµï¼ä¸ä¸»å¤ä»æ¨¡å¼å·²ç»å¯ä»¥æ»¡è¶³å¤§é¨åé¡¹ç®çéè¦ãæ ¹æ®å®éçå¹¶åéï¼å¯ä»¥éè¿å¢å èç¹æ¥æ©å±å¹¶åååã\n\nä¸ä¸»å¤ä»æ¨¡å¼ä¸ï¼ä¸»èç¹è´è´£åæä½ï¼åæºå ä¸ qpsï¼ï¼ä»èç¹è´è´£æ¥è¯¢æä½ï¼åæºåä¸ qpsï¼ã\n\nè¿ä¸æ­¥ï¼å¦æéè¦ç¼å­å¤§éæ°æ®ï¼å°±éè¦ååºï¼shardingï¼ãredis éç¾¤éè¿ååèæ hash æ§½æ¥åçï¼æ¯ä¸ªä¸»èç¹è´è´£ä¸å®èå´ç hash æ§½ãå½éè¦æ©å±éç¾¤èç¹æ¶ï¼éæ°åé hash æ§½å³å¯ï¼redis-trib ä¼èªå¨è¿ç§»åæ´ hash æ§½ä¸­æå±ç keyã\n\nï¼3ï¼redis éç¾¤æ°æ®ä¸è´æ§\n\nredis éç¾¤åºäºå¤å¶ç¹æ§å®ç°èç¹é´çæ°æ®ä¸è´æ§ã\n\n\n# redis å¤å¶\n\nãé®é¢ã\n\n * redis å¤å¶çå·¥ä½åçï¼redis æ§çå¤å¶åæ°çå¤å¶æä½ä¸åï¼\n * redis ä¸»ä»èç¹é´å¦ä½å¤å¶æ°æ®ï¼\n * redis çæ°æ®ä¸è´æ§æ¯å¼ºä¸è´æ§åï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\n> redis å¤å¶\n> \n> è¯¦æå¯ä»¥åèï¼redis å¤å¶\n\nï¼1ï¼æ§çå¤å¶åºäº sync å½ä»¤å®ç°ãåä¸ºåæ­¥ï¼syncï¼åå½ä»¤ä¼ æ­ï¼command propagateï¼ä¸¤ä¸ªæä½ãè¿ç§æ¹å¼å­å¨ç¼ºé·ï¼ä¸è½é«æå¤çæ­çº¿éè¿åçå¤å¶æåµã\n\nï¼2ï¼æ°çå¤å¶åºäº psync å½ä»¤å®ç°ãåæ­¥æä½åä¸ºäºä¸¤åï¼\n\n * å®æ´éåæ­¥ï¼full resychronizationï¼ ç¨äºåæ¬¡å¤å¶ï¼\n * é¨åéåæ­¥ï¼partial resychronizationï¼ ç¨äºæ­çº¿åéå¤å¶ã\n   * ä¸»ä»æå¡å¨çå¤å¶åç§»éï¼replication offsetï¼\n   * ä¸»æå¡å¨çå¤å¶ç§¯åç¼å²åºï¼replication backlogï¼\n   * æå¡å¨çè¿è¡ id\n\nï¼3ï¼redis éç¾¤ä¸»ä»èç¹å¤å¶çå·¥ä½æµç¨ï¼\n\n * æ­¥éª¤ 1. è®¾ç½®ä¸»ä»æå¡å¨\n * æ­¥éª¤ 2. ä¸»ä»æå¡å¨å»ºç« tcp è¿æ¥ã\n * æ­¥éª¤ 3. åé ping æ£æ¥éä¿¡ç¶æã\n * æ­¥éª¤ 4. èº«ä»½éªè¯ã\n * æ­¥éª¤ 5. åéç«¯å£ä¿¡æ¯ã\n * æ­¥éª¤ 6. åæ­¥ã\n * æ­¥éª¤ 7. å½ä»¤ä¼ æ­ã\n\n\n# redis å¨åµ\n\nãé®é¢ã\n\n * redis å¦ä½å®ç°é«å¯ç¨ï¼\n * redis å¨åµçåè½ï¼\n * redis å¨åµçåçï¼\n * redis å¨åµå¦ä½éä¸¾ leaderï¼\n * redis å¦ä½å®ç°æéè½¬ç§»ï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\n> redis å¨åµ\n> \n> è¯¦æå¯ä»¥åèï¼redis å¨åµ\n\nï¼1ï¼redis çé«å¯ç¨æ¯éè¿å¨åµæ¥å®ç°ï¼raft åè®®ç redis å®ç°ï¼ãsentinelï¼å¨åµï¼å¯ä»¥çå¬ä¸»æå¡å¨ï¼å¹¶å¨ä¸»æå¡å¨è¿å¥ä¸çº¿ç¶ææ¶ï¼èªå¨ä»ä»æå¡å¨ä¸­éä¸¾åºæ°çä¸»æå¡å¨ã\n\nç±ä¸ä¸ªæå¤ä¸ª sentinel å®ä¾ç»æç sentinel ç³»ç»å¯ä»¥çè§ä»»æå¤ä¸ªä¸»æå¡å¨ï¼ä»¥åè¿äºä¸»æå¡å¨çææä»æå¡å¨ï¼å¹¶å¨è¢«çè§çä¸»æå¡å¨è¿å¥ä¸çº¿ç¶ææ¶ï¼èªå¨å°ä¸çº¿ä¸»æå¡å¨çæä¸ªä»æå¡å¨åçº§ä¸ºæ°çä¸»æå¡å¨ï¼ç¶åç±æ°çä¸»æå¡å¨ä»£æ¿å·²ä¸çº¿çä¸»æå¡å¨ç»§ç»­å¤çå½ä»¤è¯·æ±ã\n\n\n\n\n# redis vs. memcached\n\nãé®é¢ã\n\nredis å memcached æä»ä¹åºå«ï¼\n\nåå¸å¼ç¼å­ææ¯éåï¼é redis è¿æ¯ memcachedï¼ä¸ºä»ä¹ï¼\n\nredis å memcached åèªççº¿ç¨æ¨¡åæ¯ææ ·çï¼\n\nä¸ºä»ä¹åçº¿ç¨ç redis æ§è½å´ä¸è¾äºå¤çº¿ç¨ç memcachedï¼\n\nãè§£ç­ã\n\nredis ä¸ä»ä»æ¯æç®åç k/v ç±»åçæ°æ®ï¼åæ¶è¿æä¾ listï¼setï¼zsetï¼hash ç­æ°æ®ç»æçå­å¨ãmemcache æ¯æç®åçæ°æ®ç±»åï¼stringã\n\nredis æ¯ææ°æ®çå¤ä»½ï¼å³ master-slave æ¨¡å¼çæ°æ®å¤ä»½ã\n\nredis æ¯ææ°æ®çæä¹åï¼å¯ä»¥å°åå­ä¸­çæ°æ®ä¿æå¨ç£çä¸­ï¼éå¯çæ¶åå¯ä»¥åæ¬¡å è½½è¿è¡ä½¿ç¨,è memecache ææ°æ®å¨é¨å­å¨åå­ä¹ä¸­\n\nredis çéåº¦æ¯ memcached å¿«å¾å¤\n\nmemcached æ¯å¤çº¿ç¨ï¼éé»å¡ io å¤ç¨çç½ç»æ¨¡åï¼redis ä½¿ç¨åçº¿ç¨ç io å¤ç¨æ¨¡åã\n\n\n\nå¦ææ³è¦æ´è¯¦ç»äºè§£çè¯ï¼å¯ä»¥æ¥çæè¯¾ç½ä¸çè¿ç¯æè®°ï¼éå¸¸æ¨èï¼ ï¼ãèè¸ä¸¤åªè¹çå°æ - memcached ä¸ redisãï¼www.imooc.com/article/23549\n\nç»æç­ç¥ï¼ ä½¿ç¨ redis ç string ç±»ååçäºï¼é½å¯ä»¥ç¨ memcached æ¿æ¢ï¼ä»¥æ­¤æ¢åæ´å¥½çæ§è½æåï¼ é¤æ­¤ä»¥å¤ï¼ä¼åèè redisï¼\n\n\n# åèèµæ\n\n * é¢è¯ä¸­å³äº redis çé®é¢çè¿ç¯å°±å¤äº\n * advanced-java",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Redis åºç¨æå",frontmatter:{title:"Redis åºç¨æå",date:"2020-01-30T21:48:57.000Z",categories:["æ°æ®åº","KVæ°æ®åº","Redis"],tags:["æ°æ®åº","KVæ°æ®åº","Redis"],permalink:"/pages/94e9d6/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/05.KV%E6%95%B0%E6%8D%AE%E5%BA%93/01.Redis/02.Redis%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97.html",relativePath:"12.æ°æ®åº/05.KVæ°æ®åº/01.Redis/02.Redisåºç¨æå.md",key:"v-2a8b7fae",path:"/pages/94e9d6/",headers:[{level:2,title:"ä¸ãRedis ç®ä»",slug:"ä¸ãredis-ç®ä»",normalizedTitle:"ä¸ãredis ç®ä»",charIndex:17},{level:3,title:"Redis ä½¿ç¨åºæ¯",slug:"redis-ä½¿ç¨åºæ¯",normalizedTitle:"redis ä½¿ç¨åºæ¯",charIndex:138},{level:3,title:"Redis çä¼å¿",slug:"redis-çä¼å¿",normalizedTitle:"redis çä¼å¿",charIndex:495},{level:3,title:"Redis ä¸ Memcached",slug:"redis-ä¸-memcached",normalizedTitle:"redis ä¸ memcached",charIndex:815},{level:3,title:"Redis ä¸ºä»ä¹å¿«",slug:"redis-ä¸ºä»ä¹å¿«",normalizedTitle:"redis ä¸ºä»ä¹å¿«",charIndex:1348},{level:2,title:"äºãRedis æ°æ®ç±»å",slug:"äºãredis-æ°æ®ç±»å",normalizedTitle:"äºãredis æ°æ®ç±»å",charIndex:1709},{level:2,title:"ä¸ãRedis åå­æ·æ±°",slug:"ä¸ãredis-åå­æ·æ±°",normalizedTitle:"ä¸ãredis åå­æ·æ±°",charIndex:1838},{level:3,title:"åå­æ·æ±°è¦ç¹",slug:"åå­æ·æ±°è¦ç¹",normalizedTitle:"åå­æ·æ±°è¦ç¹",charIndex:1855},{level:3,title:"ä¸»é®è¿ææ¶é´",slug:"ä¸»é®è¿ææ¶é´",normalizedTitle:"ä¸»é®è¿ææ¶é´",charIndex:2309},{level:3,title:"æ·æ±°ç­ç¥",slug:"æ·æ±°ç­ç¥",normalizedTitle:"æ·æ±°ç­ç¥",charIndex:183},{level:3,title:"å¦ä½éæ©æ·æ±°ç­ç¥",slug:"å¦ä½éæ©æ·æ±°ç­ç¥",normalizedTitle:"å¦ä½éæ©æ·æ±°ç­ç¥",charIndex:3112},{level:3,title:"åé¨å®ç°",slug:"åé¨å®ç°",normalizedTitle:"åé¨å®ç°",charIndex:3440},{level:2,title:"åãRedis æä¹å",slug:"åãredis-æä¹å",normalizedTitle:"åãredis æä¹å",charIndex:3654},{level:2,title:"äºãRedis äºä»¶",slug:"äºãredis-äºä»¶",normalizedTitle:"äºãredis äºä»¶",charIndex:3955},{level:3,title:"æä»¶äºä»¶",slug:"æä»¶äºä»¶",normalizedTitle:"æä»¶äºä»¶",charIndex:4003},{level:3,title:"æ¶é´äºä»¶",slug:"æ¶é´äºä»¶",normalizedTitle:"æ¶é´äºä»¶",charIndex:4135},{level:3,title:"äºä»¶çè°åº¦ä¸æ§è¡",slug:"äºä»¶çè°åº¦ä¸æ§è¡",normalizedTitle:"äºä»¶çè°åº¦ä¸æ§è¡",charIndex:4662},{level:2,title:"å­ãRedis äºå¡",slug:"å­ãredis-äºå¡",normalizedTitle:"å­ãredis äºå¡",charIndex:5564},{level:3,title:"MULTI",slug:"multi",normalizedTitle:"multi",charIndex:646},{level:3,title:"EXEC",slug:"exec",normalizedTitle:"exec",charIndex:654},{level:3,title:"DISCARD",slug:"discard",normalizedTitle:"discard",charIndex:5663},{level:3,title:"WATCH",slug:"watch",normalizedTitle:"watch",charIndex:5673},{level:4,title:"åæ¶ WATCH çåºæ¯",slug:"åæ¶-watch-çåºæ¯",normalizedTitle:"åæ¶ watch çåºæ¯",charIndex:6982},{level:4,title:"ä½¿ç¨ WATCH åå»ºåå­æä½",slug:"ä½¿ç¨-watch-åå»ºåå­æä½",normalizedTitle:"ä½¿ç¨ watch åå»ºåå­æä½",charIndex:7220},{level:3,title:"Rollback",slug:"rollback",normalizedTitle:"rollback",charIndex:7393},{level:2,title:"ä¸ãRedis ç®¡é",slug:"ä¸ãredis-ç®¡é",normalizedTitle:"ä¸ãredis ç®¡é",charIndex:7516},{level:2,title:"å«ãRedis åå¸ä¸è®¢é",slug:"å«ãredis-åå¸ä¸è®¢é",normalizedTitle:"å«ãredis åå¸ä¸è®¢é",charIndex:8174},{level:2,title:"ä¹ãRedis å¤å¶",slug:"ä¹ãredis-å¤å¶",normalizedTitle:"ä¹ãredis å¤å¶",charIndex:8819},{level:3,title:"æ§çå¤å¶",slug:"æ§çå¤å¶",normalizedTitle:"æ§çå¤å¶",charIndex:8906},{level:3,title:"æ°çå¤å¶",slug:"æ°çå¤å¶",normalizedTitle:"æ°çå¤å¶",charIndex:9152},{level:3,title:"é¨åéåæ­¥",slug:"é¨åéåæ­¥",normalizedTitle:"é¨åéåæ­¥",charIndex:9207},{level:3,title:"PSYNC å½ä»¤",slug:"psync-å½ä»¤",normalizedTitle:"psync å½ä»¤",charIndex:9180},{level:3,title:"å¿è·³æ£æµ",slug:"å¿è·³æ£æµ",normalizedTitle:"å¿è·³æ£æµ",charIndex:9673},{level:2,title:"åãRedis å¨åµ",slug:"åãredis-å¨åµ",normalizedTitle:"åãredis å¨åµ",charIndex:9816},{level:2,title:"åä¸ãRedis éç¾¤",slug:"åä¸ãredis-éç¾¤",normalizedTitle:"åä¸ãredis éç¾¤",charIndex:9916},{level:2,title:"åäºãRedis Client",slug:"åäºãredis-client",normalizedTitle:"åäºãredis client",charIndex:10376},{level:2,title:"æ©å±éè¯»",slug:"æ©å±éè¯»",normalizedTitle:"æ©å±éè¯»",charIndex:10645},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:10696}],headersStr:"ä¸ãRedis ç®ä» Redis ä½¿ç¨åºæ¯ Redis çä¼å¿ Redis ä¸ Memcached Redis ä¸ºä»ä¹å¿« äºãRedis æ°æ®ç±»å ä¸ãRedis åå­æ·æ±° åå­æ·æ±°è¦ç¹ ä¸»é®è¿ææ¶é´ æ·æ±°ç­ç¥ å¦ä½éæ©æ·æ±°ç­ç¥ åé¨å®ç° åãRedis æä¹å äºãRedis äºä»¶ æä»¶äºä»¶ æ¶é´äºä»¶ äºä»¶çè°åº¦ä¸æ§è¡ å­ãRedis äºå¡ MULTI EXEC DISCARD WATCH åæ¶ WATCH çåºæ¯ ä½¿ç¨ WATCH åå»ºåå­æä½ Rollback ä¸ãRedis ç®¡é å«ãRedis åå¸ä¸è®¢é ä¹ãRedis å¤å¶ æ§çå¤å¶ æ°çå¤å¶ é¨åéåæ­¥ PSYNC å½ä»¤ å¿è·³æ£æµ åãRedis å¨åµ åä¸ãRedis éç¾¤ åäºãRedis Client æ©å±éè¯» åèèµæ",content:'# Redis åºç¨æå\n\n\n# ä¸ãRedis ç®ä»\n\n> Redis æ¯éåº¦éå¸¸å¿«çéå³ç³»åï¼NoSQLï¼åå­é®å¼æ°æ®åºï¼å¯ä»¥å­å¨é®åäºç§ä¸åç±»åçå¼ä¹é´çæ å°ã\n> \n> é®çç±»ååªè½ä¸ºå­ç¬¦ä¸²ï¼å¼æ¯æçäºç§ç±»åæ°æ®ç±»åä¸ºï¼å­ç¬¦ä¸²ãåè¡¨ãéåãæåºéåãæ£åè¡¨ã\n\n\n# Redis ä½¿ç¨åºæ¯\n\n * ç¼å­ - å°ç­ç¹æ°æ®æ¾å°åå­ä¸­ï¼è®¾ç½®åå­çæå¤§ä½¿ç¨éä»¥åè¿ææ·æ±°ç­ç¥æ¥ä¿è¯ç¼å­çå½ä¸­çã\n * è®¡æ°å¨ - Redis è¿ç§åå­æ°æ®åºè½æ¯æè®¡æ°å¨é¢ç¹çè¯»åæä½ã\n * åºç¨éæµ - éå¶ä¸ä¸ªç½ç«è®¿é®æµéã\n * æ¶æ¯éå - ä½¿ç¨ List æ°æ®ç±»åï¼å®æ¯ååé¾è¡¨ã\n * æ¥æ¾è¡¨ - ä½¿ç¨ HASH æ°æ®ç±»åã\n * äº¤éè¿ç® - ä½¿ç¨ SET ç±»åï¼ä¾å¦æ±ä¸¤ä¸ªç¨æ·çå±åå¥½åã\n * æè¡æ¦ - ä½¿ç¨ ZSET æ°æ®ç±»åã\n * åå¸å¼ Session - å¤ä¸ªåºç¨æå¡å¨ç Session é½å­å¨å° Redis ä¸­æ¥ä¿è¯ Session çä¸è´æ§ã\n * åå¸å¼é - é¤äºå¯ä»¥ä½¿ç¨ SETNX å®ç°åå¸å¼éä¹å¤ï¼è¿å¯ä»¥ä½¿ç¨å®æ¹æä¾ç RedLock åå¸å¼éå®ç°ã\n\n\n# Redis çä¼å¿\n\n * æ§è½æé« â Redis è½è¯»çéåº¦æ¯ 110000 æ¬¡/s,åçéåº¦æ¯ 81000 æ¬¡/sã\n * ä¸°å¯çæ°æ®ç±»å - æ¯æå­ç¬¦ä¸²ãåè¡¨ãéåãæåºéåãæ£åè¡¨ã\n * åå­ - Redis çæææä½é½æ¯åå­æ§çãåä¸ªæä½æ¯åå­æ§çãå¤ä¸ªæä½ä¹æ¯æäºå¡ï¼å³åå­æ§ï¼éè¿ MULTI å EXEC æä»¤åèµ·æ¥ã\n * æä¹å - Redis æ¯ææ°æ®çæä¹åãå¯ä»¥å°åå­ä¸­çæ°æ®ä¿å­å¨ç£çä¸­ï¼éå¯çæ¶åå¯ä»¥åæ¬¡å è½½è¿è¡ä½¿ç¨ã\n * å¤ä»½ - Redis æ¯ææ°æ®çå¤ä»½ï¼å³ master-slave æ¨¡å¼çæ°æ®å¤ä»½ã\n * ä¸°å¯çç¹æ§ - Redis è¿æ¯æåå¸è®¢é, éç¥, key è¿æç­ç­ç¹æ§ã\n\n\n# Redis ä¸ Memcached\n\nRedis ä¸ Memcached å ä¸ºé½å¯ä»¥ç¨äºç¼å­ï¼æä»¥å¸¸å¸¸è¢«æ¿æ¥åæ¯è¾ï¼äºèä¸»è¦æä»¥ä¸åºå«ï¼\n\næ°æ®ç±»å\n\n * Memcached ä»æ¯æå­ç¬¦ä¸²ç±»åï¼\n * è Redis æ¯æäºç§ä¸åç§ç±»çæ°æ®ç±»åï¼ä½¿å¾å®å¯ä»¥æ´çµæ´»å°è§£å³é®é¢ã\n\næ°æ®æä¹å\n\n * Memcached ä¸æ¯ææä¹åï¼\n * Redis æ¯æä¸¤ç§æä¹åç­ç¥ï¼RDB å¿«ç§å AOF æ¥å¿ã\n\nåå¸å¼\n\n * Memcached ä¸æ¯æåå¸å¼ï¼åªè½éè¿å¨å®¢æ·ç«¯ä½¿ç¨åä¸è´æ§åå¸è¿æ ·çåå¸å¼ç®æ³æ¥å®ç°åå¸å¼å­å¨ï¼è¿ç§æ¹å¼å¨å­å¨åæ¥è¯¢æ¶é½éè¦åå¨å®¢æ·ç«¯è®¡ç®ä¸æ¬¡æ°æ®æå¨çèç¹ã\n * Redis Cluster å®ç°äºåå¸å¼çæ¯æã\n\nåå­ç®¡çæºå¶\n\n * Memcached å°åå­åå²æç¹å®é¿åº¦çåæ¥å­å¨æ°æ®ï¼ä»¥å®å¨è§£å³åå­ç¢ççé®é¢ï¼ä½æ¯è¿ç§æ¹å¼ä¼ä½¿å¾åå­çå©ç¨çä¸é«ï¼ä¾å¦åçå¤§å°ä¸º 128 bytesï¼åªå­å¨ 100 bytes çæ°æ®ï¼é£ä¹å©ä¸ç 28 bytes å°±æµªè´¹æäºã\n * å¨ Redis ä¸­ï¼å¹¶ä¸æ¯æææ°æ®é½ä¸ç´å­å¨å¨åå­ä¸­ï¼å¯ä»¥å°ä¸äºå¾ä¹æ²¡ç¨ç value äº¤æ¢å°ç£çãè Memcached çæ°æ®åä¼ä¸ç´å¨åå­ä¸­ã\n\n\n# Redis ä¸ºä»ä¹å¿«\n\nRedis åæº QPS è½è¾¾å° 100000ã\n\nRedis æ¯åçº¿ç¨æ¨¡åï¼Redis 6.0 å·²ç»æ¯æå¤çº¿ç¨æ¨¡åï¼ï¼ä¸ºä»ä¹è¿è½æè¿ä¹é«çå¹¶åï¼\n\n * Redis å®å¨åºäºåå­æä½ã\n * Redis æ°æ®ç»æç®åã\n * éç¨åçº¿ç¨ï¼é¿åçº¿ç¨ä¸ä¸æåæ¢åç«äºã\n * ä½¿ç¨ I/O å¤è·¯å¤ç¨æ¨¡åï¼éé»å¡ I/Oï¼ã\n\n> I/O å¤è·¯å¤ç¨\n> \n> I/O å¤è·¯å¤ç¨æ¨¡åæ¯å©ç¨ selectãpollãepoll å¯ä»¥åæ¶çå¯å¤ä¸ªæµç I/O äºä»¶çè½åï¼å¨ç©ºé²çæ¶åï¼ä¼æå½åçº¿ç¨é»å¡æï¼å½æä¸ä¸ªæå¤ä¸ªæµæ I/O äºä»¶æ¶ï¼å°±ä»é»å¡æä¸­å¤éï¼äºæ¯ç¨åºå°±ä¼è½®è¯¢ä¸éææçæµï¼epoll æ¯åªè½®è¯¢é£äºçæ­£ååºäºäºä»¶çæµï¼ï¼å¹¶ä¸åªä¾æ¬¡é¡ºåºçå¤çå°±ç»ªçæµï¼è¿ç§åæ³å°±é¿åäºå¤§éçæ ç¨æä½ã\n\n\n# äºãRedis æ°æ®ç±»å\n\nRedis åºæ¬æ°æ®ç±»åï¼STRINGãHASHãLISTãSETãZSET\n\nRedis é«çº§æ°æ®ç±»åï¼BitMapãHyperLogLogãGEO\n\n> ð¡ æ´è¯¦ç»çç¹æ§ååçè¯´æè¯·åèï¼Redis æ°æ®ç±»åååºç¨\n\n\n# ä¸ãRedis åå­æ·æ±°\n\n\n# åå­æ·æ±°è¦ç¹\n\n * æå¤§ç¼å­ - Redis åè®¸éè¿ maxmemory åæ°æ¥è®¾ç½®åå­æå¤§å¼ã\n\n * å¤±ææ¶é´ - ä½ä¸ºä¸ç§å®ææ¸çæ ææ°æ®çéè¦æºå¶ï¼å¨ Redis æä¾çè¯¸å¤å½ä»¤ä¸­ï¼EXPIREãEXPIREATãPEXPIREãPEXPIREAT ä»¥å SETEX å PSETEX åå¯ä»¥ç¨æ¥è®¾ç½®ä¸æ¡é®å¼å¯¹çå¤±ææ¶é´ãèä¸æ¡é®å¼å¯¹ä¸æ¦è¢«å³èäºå¤±ææ¶é´å°±ä¼å¨å°æåèªå¨å é¤ï¼æèè¯´åå¾æ æ³è®¿é®æ´ä¸ºåç¡®ï¼ã\n\n * æ·æ±°ç­ç¥ - éçä¸æ­çå Redis ä¸­ä¿å­æ°æ®ï¼å½åå­å©ä½ç©ºé´æ æ³æ»¡è¶³æ·»å çæ°æ®æ¶ï¼Redis åå°±ä¼æ½è¡æ°æ®æ·æ±°ç­ç¥ï¼æ¸é¤ä¸é¨ååå®¹ç¶åä¿è¯æ°çæ°æ®å¯ä»¥ä¿å­å°åå­ä¸­ãåå­æ·æ±°æºå¶æ¯ä¸ºäºæ´å¥½çä½¿ç¨åå­ï¼ç¨ä¸å®å¾ miss æ¥æ¢ååå­çå©ç¨çï¼ä¿è¯ Redis ç¼å­ä¸­ä¿å­çé½æ¯ç­ç¹æ°æ®ã\n\n * éç²¾åç LRU - å®éä¸ Redis å®ç°ç LRU å¹¶ä¸æ¯å¯é ç LRUï¼ä¹å°±æ¯åä¹ä¸æä»¬ä½¿ç¨ LRU ç®æ³æ·æ±°é®ï¼ä½æ¯å®éä¸è¢«æ·æ±°çé®å¹¶ä¸ä¸å®æ¯çæ­£çæä¹æ²¡ç¨çã\n\n\n# ä¸»é®è¿ææ¶é´\n\nRedis å¯ä»¥ä¸ºæ¯ä¸ªé®è®¾ç½®è¿ææ¶é´ï¼å½é®è¿ææ¶ï¼ä¼èªå¨å é¤è¯¥é®ã\n\nå¯¹äºæ£åè¡¨è¿ç§å®¹å¨ï¼åªè½ä¸ºæ´ä¸ªé®è®¾ç½®è¿ææ¶é´ï¼æ´ä¸ªæ£åè¡¨ï¼ï¼èä¸è½ä¸ºé®éé¢çåä¸ªåç´ è®¾ç½®è¿ææ¶é´ã\n\nå¯ä»¥ä½¿ç¨ EXPIRE æ EXPIREAT æ¥ä¸º key è®¾ç½®è¿ææ¶é´ã\n\n> ð æ³¨æï¼å½ EXPIRE çæ¶é´å¦æè®¾ç½®çæ¯è´æ°ï¼EXPIREAT è®¾ç½®çæ¶é´æ³æ¯è¿ææ¶é´ï¼å°ç´æ¥å é¤ keyã\n\nç¤ºä¾ï¼\n\nredis> SET mykey "Hello"\n"OK"\nredis> EXPIRE mykey 10\n(integer) 1\nredis> TTL mykey\n(integer) 10\nredis> SET mykey "Hello World"\n"OK"\nredis> TTL mykey\n(integer) -1\nredis>\n\n\n\n# æ·æ±°ç­ç¥\n\nåå­æ·æ±°åªæ¯ Redis æä¾çä¸ä¸ªåè½ï¼ä¸ºäºæ´å¥½å°å®ç°è¿ä¸ªåè½ï¼å¿é¡»ä¸ºä¸åçåºç¨åºæ¯æä¾ä¸åçç­ç¥ï¼åå­æ·æ±°ç­ç¥è®²çæ¯ä¸ºå®ç°åå­æ·æ±°æä»¬å·ä½æä¹åï¼è¦è§£å³çé®é¢åæ¬æ·æ±°é®ç©ºé´å¦ä½éæ©ï¼å¨é®ç©ºé´ä¸­æ·æ±°é®å¦ä½éæ©ï¼\n\nRedis æä¾äºä¸é¢å ç§åå­æ·æ±°ç­ç¥ä¾ç¨æ·éï¼\n\n * noeviction - å½åå­ä½¿ç¨è¾¾å°éå¼çæ¶åï¼ææå¼èµ·ç³è¯·åå­çå½ä»¤ä¼æ¥éãè¿æ¯ Redis é»è®¤çç­ç¥ã\n * allkeys-lru - å¨ä¸»é®ç©ºé´ä¸­ï¼ä¼åç§»é¤æè¿æªä½¿ç¨ç keyã\n * allkeys-random - å¨ä¸»é®ç©ºé´ä¸­ï¼éæºç§»é¤æä¸ª keyã\n * volatile-lru - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼ä¼åç§»é¤æè¿æªä½¿ç¨ç keyã\n * volatile-random - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼éæºç§»é¤æä¸ª keyã\n * volatile-ttl - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼å·ææ´æ©è¿ææ¶é´ç key ä¼åç§»é¤ã\n\n\n# å¦ä½éæ©æ·æ±°ç­ç¥\n\n * å¦ææ°æ®åç°å¹ç­åå¸ï¼å­å¨ç­ç¹æ°æ®ï¼é¨åæ°æ®è®¿é®é¢çé«ï¼é¨åæ°æ®è®¿é®é¢çä½ï¼ï¼åä½¿ç¨ allkeys-lruã\n * å¦ææ°æ®åç°å¹³ç­åå¸ï¼æ°æ®è®¿é®é¢çå¤§è´ç¸åï¼ï¼åä½¿ç¨ allkeys-randomã\n * å¦æå¸æä½¿ç¨ä¸åç TTL å¼å Redis æç¤ºåªäº key æ´éåè¢«æ·æ±°ï¼è¯·ä½¿ç¨ volatile-ttlã\n * volatile-lru å volatile-random éåæ¢åºç¨äºç¼å­åååºç¨äºæä¹åå­å¨çåºæ¯ï¼ç¶èæä»¬ä¹å¯ä»¥éè¿ä½¿ç¨ä¸¤ä¸ª Redis å®ä¾æ¥è¾¾å°ç¸åçææã\n * å° key è®¾ç½®è¿ææ¶é´å®éä¸ä¼æ¶èæ´å¤çåå­ï¼å æ­¤å»ºè®®ä½¿ç¨ allkeys-lru ç­ç¥ä»èæ´ææççä½¿ç¨åå­ã\n\n\n# åé¨å®ç°\n\nRedis å é¤å¤±æä¸»é®çæ¹æ³ä¸»è¦æä¸¤ç§ï¼\n\n * æ¶ææ¹æ³ï¼passive wayï¼ï¼å¨ä¸»é®è¢«è®¿é®æ¶å¦æåç°å®å·²ç»å¤±æï¼é£ä¹å°±å é¤å®ã\n * ä¸»å¨æ¹æ³ï¼active wayï¼ï¼å¨ææ§å°ä»è®¾ç½®äºå¤±ææ¶é´çä¸»é®ä¸­éæ©ä¸é¨åå¤±æçä¸»é®å é¤ã\n * ä¸»å¨å é¤ï¼å½åå·²ç¨åå­è¶è¿ maxmemory éå®æ¶ï¼è§¦åä¸»å¨æ¸çç­ç¥ï¼è¯¥ç­ç¥ç±å¯å¨åæ°çéç½®å³å®ä¸»é®å·ä½çå¤±ææ¶é´å¨é¨é½ç»´æ¤å¨ expires è¿ä¸ªå­å¸è¡¨ä¸­ã\n\n\n# åãRedis æä¹å\n\nRedis æ¯åå­åæ°æ®åºï¼ä¸ºäºä¿è¯æ°æ®å¨å®æºåä¸ä¼ä¸¢å¤±ï¼éè¦å°åå­ä¸­çæ°æ®æä¹åå°ç¡¬çä¸ã\n\nRedis æ¯æä¸¤ç§æä¹åæ¹å¼ï¼RDB å AOFã\n\n * RDB - RDB å³å¿«ç§æ¹å¼ï¼å®å°æä¸ªæ¶é´ç¹çææ Redis æ°æ®ä¿å­å°ä¸ä¸ªç»è¿åç¼©çäºè¿å¶æä»¶ï¼RDB æä»¶ï¼ä¸­ã\n * AOF - AOF(Append Only File) æ¯ä»¥ææ¬æ¥å¿å½¢å¼å°ææåå½ä»¤è¿½å å° AOF æä»¶çæ«å°¾ï¼ä»¥æ­¤æ¥è®°å½æ°æ®çååãå½æå¡å¨éå¯çæ¶åä¼éæ°è½½å¥åæ§è¡è¿äºå½ä»¤æ¥æ¢å¤åå§çæ°æ®ãAOF éåä½ä¸º ç­å¤ã\n\n> ð¡ æ´è¯¦ç»çç¹æ§ååçè¯´æè¯·åèï¼Redis æä¹å\n\n\n# äºãRedis äºä»¶\n\nRedis æå¡å¨æ¯ä¸ä¸ªäºä»¶é©±å¨ç¨åºï¼æå¡å¨éè¦å¤çä¸¤ç±»äºä»¶ï¼\n\n * æä»¶äºä»¶ï¼file eventï¼ - Redis æå¡å¨éè¿å¥æ¥å­ï¼Socketï¼ä¸å®¢æ·ç«¯æèå¶å®æå¡å¨è¿è¡éä¿¡ï¼æä»¶äºä»¶å°±æ¯å¯¹å¥æ¥å­æä½çæ½è±¡ãæå¡å¨ä¸å®¢æ·ç«¯ï¼æå¶ä»çæå¡å¨ï¼çéä¿¡ä¼äº§çæä»¶äºä»¶ï¼èæå¡å¨éè¿çå¬å¹¶å¤çè¿äºäºä»¶æ¥å®æä¸ç³»åç½ç»éä¿¡æä½ã\n * æ¶é´äºä»¶ï¼time eventï¼ - Redis æå¡å¨æä¸äºæä½éè¦å¨ç»å®çæ¶é´ç¹æ§è¡ï¼æ¶é´äºä»¶æ¯å¯¹è¿ç±»å®æ¶æä½çæ½è±¡ã\n\n\n# æä»¶äºä»¶\n\nRedis åºäº Reactor æ¨¡å¼å¼åäºèªå·±çç½ç»æ¶é´å¤çå¨ã\n\n * Redis æä»¶äºä»¶å¤çå¨ä½¿ç¨ I/O å¤è·¯å¤ç¨ç¨åºæ¥åæ¶çå¬å¤ä¸ªå¥æ¥å­ï¼å¹¶æ ¹æ®å¥æ¥å­ç®åæ§è¡çä»»å¡æ¥ä¸ºå¥æ¥å­å³èä¸åçäºä»¶å¤çå¨ã\n * å½è¢«çå¬çå¥æ¥å­åå¤å¥½æ§è¡è¿æ¥åºç­ãè¯»åãåå¥ãå³é­æä½æ¶ï¼ä¸æä½ç¸å¯¹åºçæä»¶äºä»¶å°±ä¼äº§çï¼è¿æ¶æä»¶äºä»¶å¤çå¨å°±ä¼è°ç¨å¥æ¥å­ä¹åå³èå¥½çäºä»¶å¤çå¨æ¥å¤çè¿äºäºä»¶ã\n\nè½ç¶æä»¶äºä»¶å¤çå¨ä»¥åçº¿ç¨æ¹å¼è¿è¡ï¼ä½éè¿ä½¿ç¨ I/O å¤è·¯å¤ç¨ç¨åºæ¥çå¬å¤ä¸ªå¥æ¥å­ï¼æä»¶äºä»¶å¤çå¨å®ç°äºé«æ§è½çç½ç»éä¿¡æ¨¡åã\n\næä»¶äºä»¶å¤çå¨æåä¸ªç»æé¨åï¼å¥æ¥å­ãI/O å¤è·¯å¤ç¨ç¨åºãæä»¶äºä»¶åæ´¾å¨ãäºä»¶å¤çå¨ã\n\n\n\n\n# æ¶é´äºä»¶\n\næ¶é´äºä»¶ååä¸ºï¼\n\n * å®æ¶äºä»¶ï¼æ¯è®©ä¸æ®µç¨åºå¨æå®çæ¶é´ä¹åæ§è¡ä¸æ¬¡ï¼\n * å¨ææ§äºä»¶ï¼æ¯è®©ä¸æ®µç¨åºæ¯éæå®æ¶é´å°±æ§è¡ä¸æ¬¡ã\n\nRedis å°æææ¶é´äºä»¶é½æ¾å¨ä¸ä¸ªæ åºé¾è¡¨ä¸­ï¼æ¯å½æ¶é´äºä»¶æ§è¡å¨è¿è¡æ¶ï¼éè¿éåæ´ä¸ªé¾è¡¨æ¥æ¾åºå·²å°è¾¾çæ¶é´äºä»¶ï¼å¹¶è°ç¨ååºçäºä»¶å¤çå¨ã\n\n\n# äºä»¶çè°åº¦ä¸æ§è¡\n\næå¡å¨éè¦ä¸æ­çå¬æä»¶äºä»¶çå¥æ¥å­æè½å¾å°å¾å¤ççæä»¶äºä»¶ï¼ä½æ¯ä¸è½ä¸ç´çå¬ï¼å¦åæ¶é´äºä»¶æ æ³å¨è§å®çæ¶é´åæ§è¡ï¼å æ­¤çå¬æ¶é´åºè¯¥æ ¹æ®è·ç¦»ç°å¨æè¿çæ¶é´äºä»¶æ¥å³å®ã\n\näºä»¶è°åº¦ä¸æ§è¡ç± aeProcessEvents å½æ°è´è´£ï¼ä¼ªä»£ç å¦ä¸ï¼\n\ndef aeProcessEvents():\n\n    ## è·åå°è¾¾æ¶é´ç¦»å½åæ¶é´ææ¥è¿çæ¶é´äºä»¶\n    time_event = aeSearchNearestTimer()\n\n    ## è®¡ç®ææ¥è¿çæ¶é´äºä»¶è·ç¦»å°è¾¾è¿æå¤å°æ¯«ç§\n    remaind_ms = time_event.when - unix_ts_now()\n\n    ## å¦æäºä»¶å·²å°è¾¾ï¼é£ä¹ remaind_ms çå¼å¯è½ä¸ºè´æ°ï¼å°å®è®¾ä¸º 0\n    if remaind_ms < 0:\n        remaind_ms = 0\n\n    ## æ ¹æ® remaind_ms çå¼ï¼åå»º timeval\n    timeval = create_timeval_with_ms(remaind_ms)\n\n    ## é»å¡å¹¶ç­å¾æä»¶äºä»¶äº§çï¼æå¤§é»å¡æ¶é´ç±ä¼ å¥ç timeval å³å®\n    aeApiPoll(timeval)\n\n    ## å¤çææå·²äº§ççæä»¶äºä»¶\n    procesFileEvents()\n\n    ## å¤çææå·²å°è¾¾çæ¶é´äºä»¶\n    processTimeEvents()\n\n\nå° aeProcessEvents å½æ°ç½®äºä¸ä¸ªå¾ªç¯éé¢ï¼å ä¸åå§ååæ¸çå½æ°ï¼å°±ææäº Redis æå¡å¨çä¸»å½æ°ï¼ä¼ªä»£ç å¦ä¸ï¼\n\ndef main():\n\n    ## åå§åæå¡å¨\n    init_server()\n\n    ## ä¸ç´å¤çäºä»¶ï¼ç´å°æå¡å¨å³é­ä¸ºæ­¢\n    while server_is_not_shutdown():\n        aeProcessEvents()\n\n    ## æå¡å¨å³é­ï¼æ§è¡æ¸çæä½\n    clean_server()\n\n\nä»äºä»¶å¤ççè§åº¦æ¥çï¼æå¡å¨è¿è¡æµç¨å¦ä¸ï¼\n\n\n\n\n# å­ãRedis äºå¡\n\n> Redis æä¾çä¸æ¯ä¸¥æ ¼çäºå¡ï¼Redis åªä¿è¯ä¸²è¡æ§è¡å½ä»¤ï¼å¹¶ä¸è½ä¿è¯å¨é¨æ§è¡ï¼ä½æ¯æ§è¡å½ä»¤å¤±è´¥æ¶å¹¶ä¸ä¼åæ»ï¼èæ¯ä¼ç»§ç»­æ§è¡ä¸å»ã\n\nMULTI ã EXEC ã DISCARD å WATCH æ¯ Redis äºå¡ç¸å³çå½ä»¤ã\n\näºå¡å¯ä»¥ä¸æ¬¡æ§è¡å¤ä¸ªå½ä»¤ï¼ å¹¶ä¸æä»¥ä¸ä¸¤ä¸ªéè¦çä¿è¯ï¼\n\n * äºå¡æ¯ä¸ä¸ªåç¬çéç¦»æä½ï¼äºå¡ä¸­çææå½ä»¤é½ä¼åºååãæé¡ºåºå°æ§è¡ãäºå¡å¨æ§è¡çè¿ç¨ä¸­ï¼ä¸ä¼è¢«å¶ä»å®¢æ·ç«¯åéæ¥çå½ä»¤è¯·æ±æææ­ã\n * äºå¡æ¯ä¸ä¸ªåå­æä½ï¼äºå¡ä¸­çå½ä»¤è¦ä¹å¨é¨è¢«æ§è¡ï¼è¦ä¹å¨é¨é½ä¸æ§è¡ã\n\n\n# MULTI\n\nMULTI å½ä»¤ç¨äºå¼å¯ä¸ä¸ªäºå¡ï¼å®æ»æ¯è¿å OK ã\n\nMULTI æ§è¡ä¹åï¼ å®¢æ·ç«¯å¯ä»¥ç»§ç»­åæå¡å¨åéä»»æå¤æ¡å½ä»¤ï¼ è¿äºå½ä»¤ä¸ä¼ç«å³è¢«æ§è¡ï¼ èæ¯è¢«æ¾å°ä¸ä¸ªéåä¸­ï¼ å½ EXEC å½ä»¤è¢«è°ç¨æ¶ï¼ ææéåä¸­çå½ä»¤æä¼è¢«æ§è¡ã\n\nä»¥ä¸æ¯ä¸ä¸ªäºå¡ä¾å­ï¼ å®åå­å°å¢å äº foo å bar ä¸¤ä¸ªé®çå¼ï¼\n\n> MULTI\nOK\n> INCR foo\nQUEUED\n> INCR bar\nQUEUED\n> EXEC\n1) (integer) 1\n2) (integer) 1\n\n\n\n# EXEC\n\nEXEC å½ä»¤è´è´£è§¦åå¹¶æ§è¡äºå¡ä¸­çææå½ä»¤ã\n\n * å¦æå®¢æ·ç«¯å¨ä½¿ç¨ MULTI å¼å¯äºä¸ä¸ªäºå¡ä¹åï¼å´å ä¸ºæ­çº¿èæ²¡ææåæ§è¡ EXEC ï¼é£ä¹äºå¡ä¸­çææå½ä»¤é½ä¸ä¼è¢«æ§è¡ã\n * å¦ä¸æ¹é¢ï¼å¦æå®¢æ·ç«¯æåå¨å¼å¯äºå¡ä¹åæ§è¡ EXEC ï¼é£ä¹äºå¡ä¸­çææå½ä»¤é½ä¼è¢«æ§è¡ã\n\n\n# DISCARD\n\nå½æ§è¡ DISCARD å½ä»¤æ¶ï¼ äºå¡ä¼è¢«æ¾å¼ï¼ äºå¡éåä¼è¢«æ¸ç©ºï¼ å¹¶ä¸å®¢æ·ç«¯ä¼ä»äºå¡ç¶æä¸­éåºã\n\nç¤ºä¾ï¼\n\n> SET foo 1\nOK\n> MULTI\nOK\n> INCR foo\nQUEUED\n> DISCARD\nOK\n> GET foo\n"1"\n\n\n\n# WATCH\n\nWATCH å½ä»¤å¯ä»¥ä¸º Redis äºå¡æä¾ check-and-set ï¼CASï¼è¡ä¸ºã\n\nè¢« WATCH çé®ä¼è¢«çè§ï¼å¹¶ä¼åè§è¿äºé®æ¯å¦è¢«æ¹å¨è¿äºã å¦ææè³å°ä¸ä¸ªè¢«çè§çé®å¨ EXEC æ§è¡ä¹åè¢«ä¿®æ¹äºï¼ é£ä¹æ´ä¸ªäºå¡é½ä¼è¢«åæ¶ï¼ EXEC è¿å nil-reply æ¥è¡¨ç¤ºäºå¡å·²ç»å¤±è´¥ã\n\nWATCH mykey\nval = GET mykey\nval = val + 1\nMULTI\nSET mykey $val\nEXEC\n\n\nä½¿ç¨ä¸é¢çä»£ç ï¼ å¦æå¨ WATCH æ§è¡ä¹åï¼ EXEC æ§è¡ä¹åï¼ æå¶ä»å®¢æ·ç«¯ä¿®æ¹äº mykey çå¼ï¼ é£ä¹å½åå®¢æ·ç«¯çäºå¡å°±ä¼å¤±è´¥ã ç¨åºéè¦åçï¼ å°±æ¯ä¸æ­éè¯è¿ä¸ªæä½ï¼ ç´å°æ²¡æåçç¢°æä¸ºæ­¢ã\n\nè¿ç§å½¢å¼çéè¢«ç§°ä½ä¹è§éï¼ å®æ¯ä¸ç§éå¸¸å¼ºå¤§çéæºå¶ã å¹¶ä¸å ä¸ºå¤§å¤æ°æåµä¸ï¼ ä¸åçå®¢æ·ç«¯ä¼è®¿é®ä¸åçé®ï¼ ç¢°æçæåµä¸è¬é½å¾å°ï¼ æä»¥éå¸¸å¹¶ä¸éè¦è¿è¡éè¯ã\n\nWATCH ä½¿å¾ EXEC å½ä»¤éè¦ææ¡ä»¶å°æ§è¡ï¼äºå¡åªè½å¨ææè¢«çè§é®é½æ²¡æè¢«ä¿®æ¹çåæä¸æ§è¡ï¼å¦æè¿ä¸ªåæä¸è½æ»¡è¶³çè¯ï¼äºå¡å°±ä¸ä¼è¢«æ§è¡ã\n\nWATCH å½ä»¤å¯ä»¥è¢«è°ç¨å¤æ¬¡ãå¯¹é®ççè§ä» WATCH æ§è¡ä¹åå¼å§çæï¼ç´å°è°ç¨ EXEC ä¸ºæ­¢ã\n\nç¨æ·è¿å¯ä»¥å¨åä¸ª WATCH å½ä»¤ä¸­çè§ä»»æå¤ä¸ªé®ï¼ä¾å¦ï¼\n\nredis> WATCH key1 key2 key3\nOK\n\n\n# åæ¶ WATCH çåºæ¯\n\nå½ EXEC è¢«è°ç¨æ¶ï¼ ä¸ç®¡äºå¡æ¯å¦æåæ§è¡ï¼ å¯¹ææé®ççè§é½ä¼è¢«åæ¶ã\n\nå¦å¤ï¼ å½å®¢æ·ç«¯æ­å¼è¿æ¥æ¶ï¼ è¯¥å®¢æ·ç«¯å¯¹é®ççè§ä¹ä¼è¢«åæ¶ã\n\nä½¿ç¨æ åæ°ç UNWATCH å½ä»¤å¯ä»¥æå¨åæ¶å¯¹ææé®ççè§ã å¯¹äºä¸äºéè¦æ¹å¨å¤ä¸ªé®çäºå¡ï¼ ææ¶åç¨åºéè¦åæ¶å¯¹å¤ä¸ªé®è¿è¡å éï¼ ç¶åæ£æ¥è¿äºé®çå½åå¼æ¯å¦ç¬¦åç¨åºçè¦æ±ã å½å¼è¾¾ä¸å°è¦æ±æ¶ï¼ å°±å¯ä»¥ä½¿ç¨ UNWATCH å½ä»¤æ¥åæ¶ç®åå¯¹é®ççè§ï¼ ä¸­éæ¾å¼è¿ä¸ªäºå¡ï¼ å¹¶ç­å¾äºå¡çä¸æ¬¡å°è¯ã\n\n# ä½¿ç¨ WATCH åå»ºåå­æä½\n\nWATCH å¯ä»¥ç¨äºåå»º Redis æ²¡æåç½®çåå­æä½ã\n\nä¸¾ä¸ªä¾å­ï¼ä»¥ä¸ä»£ç å®ç°äºååç ZPOP å½ä»¤ï¼å®å¯ä»¥åå­å°å¼¹åºæåºéåä¸­åå¼ï¼scoreï¼æå°çåç´ ï¼\n\nWATCH zset\nelement = ZRANGE zset 0 0\nMULTI\nZREM zset element\nEXEC\n\n\n\n# Rollback\n\nRedis ä¸æ¯æåæ»ãRedis ä¸æ¯æåæ»ççç±ï¼\n\n * Redis å½ä»¤åªä¼å ä¸ºéè¯¯çè¯­æ³èå¤±è´¥ï¼ææ¯å½ä»¤ç¨å¨äºéè¯¯ç±»åçé®ä¸é¢ã\n * å ä¸ºä¸éè¦å¯¹åæ»è¿è¡æ¯æï¼æä»¥ Redis çåé¨å¯ä»¥ä¿æç®åä¸å¿«éã\n\n\n# ä¸ãRedis ç®¡é\n\nRedis æ¯ä¸ç§åºäº C/S æ¨¡åä»¥åè¯·æ±/ååºåè®®ç TCP æå¡ãRedis æ¯æç®¡éææ¯ãç®¡éææ¯åè®¸è¯·æ±ä»¥å¼æ­¥æ¹å¼åéï¼å³æ§è¯·æ±çåºç­è¿æªè¿åçæåµä¸ï¼åè®¸åéæ°è¯·æ±ãè¿ç§æ¹å¼å¯ä»¥å¤§å¤§æé«ä¼ è¾æçã\n\nå¨éè¦æ¹éæ§è¡ Redis å½ä»¤æ¶ï¼å¦æä¸æ¡ä¸æ¡æ§è¡ï¼æ¾ç¶å¾ä½æãä¸ºäºåå°éä¿¡æ¬¡æ°å¹¶éä½å»¶è¿ï¼å¯ä»¥ä½¿ç¨ Redis ç®¡éåè½ãRedis çç®¡éï¼pipelineï¼åè½æ²¡ææä¾å½ä»¤è¡æ¯æï¼ä½æ¯å¨åç§è¯­è¨çæ¬çå®¢æ·ç«¯ä¸­é½æç¸åºçå®ç°ã\n\nä»¥ Jedis ä¸ºä¾ï¼\n\nPipeline pipe = conn.pipelined();\npipe.multi();\npipe.hset("login:", token, user);\npipe.zadd("recent:", timestamp, token);\nif (item != null) {\n    pipe.zadd("viewed:" + token, timestamp, item);\n    pipe.zremrangeByRank("viewed:" + token, 0, -26);\n    pipe.zincrby("viewed:", -1, item);\n}\npipe.exec();\n\n\n> ð æ³¨æï¼ä½¿ç¨ç®¡éåéå½ä»¤æ¶ï¼Redis Server ä¼å°é¨åè¯·æ±æ¾å°ç¼å­éåä¸­ï¼å ç¨åå­ï¼ï¼æ§è¡å®æ¯åä¸æ¬¡æ§åéç»æãå¦æéè¦åéå¤§éçå½ä»¤ï¼ä¼å ç¨å¤§éçåå­ï¼å æ­¤åºè¯¥æç§åçæ°éåæ¹æ¬¡çå¤çã\n\n\n# å«ãRedis åå¸ä¸è®¢é\n\nRedis æä¾äº 5 ä¸ªåå¸ä¸è®¢éå½ä»¤ï¼\n\nå½ä»¤             æè¿°\nSUBSCRIBE      SUBSCRIBE channel [channel ...]âè®¢éæå®é¢éã\nUNSUBSCRIBE    UNSUBSCRIBE [channel [channel ...]]âåæ¶è®¢éæå®é¢éã\nPUBLISH        PUBLISH channel messageâåéä¿¡æ¯å°æå®çé¢éã\nPSUBSCRIBE     PSUBSCRIBE pattern [pattern ...]âè®¢éç¬¦åæå®æ¨¡å¼çé¢éã\nPUNSUBSCRIBE   PUNSUBSCRIBE [pattern [pattern ...]]âåæ¶è®¢éç¬¦åæå®æ¨¡å¼çé¢éã\n\nè®¢éèè®¢éäºé¢éä¹åï¼åå¸èåé¢éåéå­ç¬¦ä¸²æ¶æ¯ä¼è¢«ææè®¢éèæ¥æ¶å°ã\n\næä¸ªå®¢æ·ç«¯ä½¿ç¨ SUBSCRIBE è®¢éä¸ä¸ªé¢éï¼å¶å®å®¢æ·ç«¯å¯ä»¥ä½¿ç¨ PUBLISH åè¿ä¸ªé¢éåéæ¶æ¯ã\n\nåå¸ä¸è®¢éæ¨¡å¼åè§å¯èæ¨¡å¼æä»¥ä¸ä¸åï¼\n\n * è§å¯èæ¨¡å¼ä¸­ï¼è§å¯èåä¸»é¢é½ç¥éå¯¹æ¹çå­å¨ï¼èå¨åå¸ä¸è®¢éæ¨¡å¼ä¸­ï¼åå¸èä¸è®¢éèä¸ç¥éå¯¹æ¹çå­å¨ï¼å®ä»¬ä¹é´éè¿é¢éè¿è¡éä¿¡ã\n * è§å¯èæ¨¡å¼æ¯åæ­¥çï¼å½äºä»¶è§¦åæ¶ï¼ä¸»é¢ä¼å»è°ç¨è§å¯èçæ¹æ³ï¼èåå¸ä¸è®¢éæ¨¡å¼æ¯å¼æ­¥çï¼\n\n----------------------------------------\n\nåå²çº¿ä»¥ä¸ä¸º Redis éç¾¤åè½ç¹æ§\n\n\n# ä¹ãRedis å¤å¶\n\n> å³ç³»åæ°æ®åºéå¸¸ä¼ä½¿ç¨ä¸ä¸ªä¸»æå¡å¨åå¤ä¸ªä»æå¡å¨åéæ´æ°ï¼å¹¶ä½¿ç¨ä»æå¡å¨æ¥å¤çææè¯»è¯·æ±ï¼Redis ä¹éç¨äºåæ ·çæ¹å¼æ¥å®ç°å¤å¶ç¹æ§ã\n\n\n# æ§çå¤å¶\n\nRedis 2.8 çæ¬ä»¥åçå¤å¶åè½åºäº SYNC å½ä»¤å®ç°ã\n\nRedis çå¤å¶åè½åä¸ºåæ­¥ï¼syncï¼åå½ä»¤ä¼ æ­ï¼command propagateï¼ä¸¤ä¸ªæä½ï¼\n\n * åæ­¥ï¼syncï¼ - ç¨äºå°ä»æå¡å¨çæ°æ®åºç¶ææ´æ°è³ä¸»æå¡å¨å½åçæ°æ®åºç¶æã\n * å½ä»¤ä¼ æ­ï¼command propagateï¼ - å½ä¸»æå¡å¨çæ°æ®åºç¶æè¢«ä¿®æ¹ï¼å¯¼è´ä¸»ä»æ°æ®åºç¶æä¸ä¸è´æ¶ï¼è®©ä¸»ä»æå¡å¨çæ°æ®åºéæ°åå°ä¸è´ç¶æã\n\nè¿ç§æ¹å¼å­å¨ç¼ºé·ï¼ä¸è½é«æå¤çæ­çº¿éè¿åçå¤å¶æåµã\n\n\n# æ°çå¤å¶\n\nRedis 2.8 çæ¬ä»¥åçå¤å¶åè½åºäº PSYNC å½ä»¤å®ç°ãPSYNC å½ä»¤å·æå®æ´éåæ­¥åé¨åéåæ­¥ä¸¤ç§æ¨¡å¼ã\n\n * å®æ´éåæ­¥ï¼full resychronizationï¼ - ç¨äºåæ¬¡å¤å¶ãæ§è¡æ­¥éª¤ä¸ SYNC å½ä»¤åºæ¬ä¸è´ã\n * é¨åéåæ­¥ï¼partial resychronizationï¼ - ç¨äºæ­çº¿åéå¤å¶ãå¦ææ¡ä»¶åè®¸ï¼ä¸»æå¡å¨å¯ä»¥å°ä¸»ä»æå¡å¨è¿æ¥æ­å¼æé´æ§è¡çåå½ä»¤åéç»ä»æå¡å¨ï¼ä»æå¡å¨åªéæ¥æ¶å¹¶æ§è¡è¿äºåå½ä»¤ï¼å³å¯å°ä¸»ä»æå¡å¨çæ°æ®åºç¶æä¿æä¸è´ã\n\n\n# é¨åéåæ­¥\n\né¨åéåæ­¥æä¸ä¸ªç»æé¨åï¼\n\n * ä¸»ä»æå¡å¨çå¤å¶åç§»éï¼replication offsetï¼\n * ä¸»æå¡å¨çå¤å¶ç§¯åç¼å²åºï¼replication backlogï¼\n * æå¡å¨çè¿è¡ ID\n\n\n# PSYNC å½ä»¤\n\nä»æå¡å¨åè¦å¤å¶çä¸»æå¡å¨åé PSYNC <runid> <offset> å½ä»¤\n\n * åå¦ä¸»ä»æå¡å¨ç master run id ç¸åï¼å¹¶ä¸æå®çåç§»éï¼offsetï¼å¨åå­ç¼å²åºä¸­è¿ææï¼å¤å¶å°±ä¼ä»ä¸æ¬¡ä¸­æ­çç¹å¼å§ç»§ç»­ã\n * å¦æå¶ä¸­ä¸ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼å°±ä¼è¿è¡å®å¨éæ°åæ­¥ã\n\n\n# å¿è·³æ£æµ\n\nä¸»æå¡å¨éè¿åä»æå¡ä¼ æ­å½ä»¤æ¥æ´æ°ä»æå¡å¨ç¶æï¼ä¿æä¸»ä»æ°æ®ä¸è´ã\n\nä»æå¡å¨éè¿åä¸»æå¡å¨åéå½ä»¤ REPLCONF ACK <replication_offset> æ¥è¿è¡å¿è·³æ£æµï¼ä»¥åå½ä»¤ä¸¢å¤±æ£æµã\n\n> ð¡ æ´è¯¦ç»çç¹æ§ååçè¯´æè¯·åèï¼Redis å¤å¶\n\n\n# åãRedis å¨åµ\n\nSentinelï¼å¨åµï¼å¯ä»¥çå¬ä¸»æå¡å¨ï¼å¹¶å¨ä¸»æå¡å¨è¿å¥ä¸çº¿ç¶ææ¶ï¼èªå¨ä»ä»æå¡å¨ä¸­éä¸¾åºæ°çä¸»æå¡å¨ã\n\n> ð¡ æ´è¯¦ç»çç¹æ§ååçè¯´æè¯·åèï¼Redis å¨åµ\n\n\n# åä¸ãRedis éç¾¤\n\nåçæ¯å°æ°æ®ååä¸ºå¤ä¸ªé¨åçæ¹æ³ï¼å¯ä»¥å°æ°æ®å­å¨å°å¤å°æºå¨éé¢ï¼ä¹å¯ä»¥ä»å¤å°æºå¨éé¢è·åæ°æ®ï¼è¿ç§æ¹æ³å¨è§£å³æäºé®é¢æ¶å¯ä»¥è·å¾çº¿æ§çº§å«çæ§è½æåã\n\nåè®¾æ 4 ä¸ª Reids å®ä¾ R0ï¼R1ï¼R2ï¼R3ï¼è¿æå¾å¤è¡¨ç¤ºç¨æ·çé® user:1ï¼user:2ï¼... ç­ç­ï¼æä¸åçæ¹å¼æ¥éæ©ä¸ä¸ªæå®çé®å­å¨å¨åªä¸ªå®ä¾ä¸­ãæç®åçæ¹å¼æ¯èå´åçï¼ä¾å¦ç¨æ· id ä» 0~1000 çå­å¨å°å®ä¾ R0 ä¸­ï¼ç¨æ· id ä» 1001~2000 çå­å¨å°å®ä¾ R1 ä¸­ï¼ç­ç­ãä½æ¯è¿æ ·éè¦ç»´æ¤ä¸å¼ æ å°èå´è¡¨ï¼ç»´æ¤æä½ä»£ä»·å¾é«ãè¿æä¸ç§æ¹å¼æ¯åå¸åçï¼ä½¿ç¨ CRC32 åå¸å½æ°å°é®è½¬æ¢ä¸ºä¸ä¸ªæ°å­ï¼åå¯¹å®ä¾æ°éæ±æ¨¡å°±è½ç¥éåºè¯¥å­å¨çå®ä¾ã\n\nä¸»è¦æä¸ç§åçæ¹å¼ï¼\n\n * å®¢æ·ç«¯åçï¼å®¢æ·ç«¯ä½¿ç¨ä¸è´æ§åå¸ç­ç®æ³å³å®é®åºå½åå¸å°åªä¸ªèç¹ã\n * ä»£çåçï¼å°å®¢æ·ç«¯è¯·æ±åéå°ä»£çä¸ï¼ç±ä»£çè½¬åè¯·æ±å°æ­£ç¡®çèç¹ä¸ã\n * æå¡å¨åçï¼Redis Clusterï¼å®æ¹ç Redis éç¾¤è§£å³æ¹æ¡ï¼ã\n\n\n# åäºãRedis Client\n\nRedis ç¤¾åºä¸­æå¤ç§ç¼ç¨è¯­è¨çå®¢æ·ç«¯ï¼å¯ä»¥å¨è¿éæ¥æ¾åéçå®¢æ·ç«¯ï¼Redis å®æ¹ç½åçå®¢æ·ç«¯æ¸å\n\nredis å®æ¹æ¨èç Java Redis Clientï¼\n\n * jedis - ææµè¡ç Redis Java å®¢æ·ç«¯\n * redisson - é¢å¤æä¾äºå¾å¤çåå¸å¼æå¡ç¹æ§ï¼å¦ï¼åå¸å¼éãåå¸å¼ Java å¸¸ç¨å¯¹è±¡ï¼BitSetãBlockingQueueãCountDownLatch ç­ï¼\n * lettuce - Spring Boot 2.0 é»è®¤ Redis å®¢æ·ç«¯\n\n\n# æ©å±éè¯»\n\n> ð¡ Redis å¸¸ç¨äºåå¸å¼ç¼å­ï¼æå³ç¼å­çç¹æ§ååçè¯·åèï¼ç¼å­åºæ¬åç\n\n\n# åèèµæ\n\n * å®ç½\n   * Redis å®ç½\n   * Redis github\n   * Redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãRedis å®æã\n   * ãRedis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * Redis å½ä»¤åè\n * èµæºæ±æ»\n   * awesome-redis\n * Redis Client\n   * spring-data-redis å®æ¹ææ¡£\n   * redisson å®æ¹ææ¡£(ä¸­æ,ç¥ææ»å)\n   * redisson å®æ¹ææ¡£(è±æ)\n   * CRUG | Redisson PRO vs. Jedis: Which Is Faster? ç¿»è¯\n   * redis åå¸é Redisson æ§è½æµè¯',normalizedContent:'# redis åºç¨æå\n\n\n# ä¸ãredis ç®ä»\n\n> redis æ¯éåº¦éå¸¸å¿«çéå³ç³»åï¼nosqlï¼åå­é®å¼æ°æ®åºï¼å¯ä»¥å­å¨é®åäºç§ä¸åç±»åçå¼ä¹é´çæ å°ã\n> \n> é®çç±»ååªè½ä¸ºå­ç¬¦ä¸²ï¼å¼æ¯æçäºç§ç±»åæ°æ®ç±»åä¸ºï¼å­ç¬¦ä¸²ãåè¡¨ãéåãæåºéåãæ£åè¡¨ã\n\n\n# redis ä½¿ç¨åºæ¯\n\n * ç¼å­ - å°ç­ç¹æ°æ®æ¾å°åå­ä¸­ï¼è®¾ç½®åå­çæå¤§ä½¿ç¨éä»¥åè¿ææ·æ±°ç­ç¥æ¥ä¿è¯ç¼å­çå½ä¸­çã\n * è®¡æ°å¨ - redis è¿ç§åå­æ°æ®åºè½æ¯æè®¡æ°å¨é¢ç¹çè¯»åæä½ã\n * åºç¨éæµ - éå¶ä¸ä¸ªç½ç«è®¿é®æµéã\n * æ¶æ¯éå - ä½¿ç¨ list æ°æ®ç±»åï¼å®æ¯ååé¾è¡¨ã\n * æ¥æ¾è¡¨ - ä½¿ç¨ hash æ°æ®ç±»åã\n * äº¤éè¿ç® - ä½¿ç¨ set ç±»åï¼ä¾å¦æ±ä¸¤ä¸ªç¨æ·çå±åå¥½åã\n * æè¡æ¦ - ä½¿ç¨ zset æ°æ®ç±»åã\n * åå¸å¼ session - å¤ä¸ªåºç¨æå¡å¨ç session é½å­å¨å° redis ä¸­æ¥ä¿è¯ session çä¸è´æ§ã\n * åå¸å¼é - é¤äºå¯ä»¥ä½¿ç¨ setnx å®ç°åå¸å¼éä¹å¤ï¼è¿å¯ä»¥ä½¿ç¨å®æ¹æä¾ç redlock åå¸å¼éå®ç°ã\n\n\n# redis çä¼å¿\n\n * æ§è½æé« â redis è½è¯»çéåº¦æ¯ 110000 æ¬¡/s,åçéåº¦æ¯ 81000 æ¬¡/sã\n * ä¸°å¯çæ°æ®ç±»å - æ¯æå­ç¬¦ä¸²ãåè¡¨ãéåãæåºéåãæ£åè¡¨ã\n * åå­ - redis çæææä½é½æ¯åå­æ§çãåä¸ªæä½æ¯åå­æ§çãå¤ä¸ªæä½ä¹æ¯æäºå¡ï¼å³åå­æ§ï¼éè¿ multi å exec æä»¤åèµ·æ¥ã\n * æä¹å - redis æ¯ææ°æ®çæä¹åãå¯ä»¥å°åå­ä¸­çæ°æ®ä¿å­å¨ç£çä¸­ï¼éå¯çæ¶åå¯ä»¥åæ¬¡å è½½è¿è¡ä½¿ç¨ã\n * å¤ä»½ - redis æ¯ææ°æ®çå¤ä»½ï¼å³ master-slave æ¨¡å¼çæ°æ®å¤ä»½ã\n * ä¸°å¯çç¹æ§ - redis è¿æ¯æåå¸è®¢é, éç¥, key è¿æç­ç­ç¹æ§ã\n\n\n# redis ä¸ memcached\n\nredis ä¸ memcached å ä¸ºé½å¯ä»¥ç¨äºç¼å­ï¼æä»¥å¸¸å¸¸è¢«æ¿æ¥åæ¯è¾ï¼äºèä¸»è¦æä»¥ä¸åºå«ï¼\n\næ°æ®ç±»å\n\n * memcached ä»æ¯æå­ç¬¦ä¸²ç±»åï¼\n * è redis æ¯æäºç§ä¸åç§ç±»çæ°æ®ç±»åï¼ä½¿å¾å®å¯ä»¥æ´çµæ´»å°è§£å³é®é¢ã\n\næ°æ®æä¹å\n\n * memcached ä¸æ¯ææä¹åï¼\n * redis æ¯æä¸¤ç§æä¹åç­ç¥ï¼rdb å¿«ç§å aof æ¥å¿ã\n\nåå¸å¼\n\n * memcached ä¸æ¯æåå¸å¼ï¼åªè½éè¿å¨å®¢æ·ç«¯ä½¿ç¨åä¸è´æ§åå¸è¿æ ·çåå¸å¼ç®æ³æ¥å®ç°åå¸å¼å­å¨ï¼è¿ç§æ¹å¼å¨å­å¨åæ¥è¯¢æ¶é½éè¦åå¨å®¢æ·ç«¯è®¡ç®ä¸æ¬¡æ°æ®æå¨çèç¹ã\n * redis cluster å®ç°äºåå¸å¼çæ¯æã\n\nåå­ç®¡çæºå¶\n\n * memcached å°åå­åå²æç¹å®é¿åº¦çåæ¥å­å¨æ°æ®ï¼ä»¥å®å¨è§£å³åå­ç¢ççé®é¢ï¼ä½æ¯è¿ç§æ¹å¼ä¼ä½¿å¾åå­çå©ç¨çä¸é«ï¼ä¾å¦åçå¤§å°ä¸º 128 bytesï¼åªå­å¨ 100 bytes çæ°æ®ï¼é£ä¹å©ä¸ç 28 bytes å°±æµªè´¹æäºã\n * å¨ redis ä¸­ï¼å¹¶ä¸æ¯æææ°æ®é½ä¸ç´å­å¨å¨åå­ä¸­ï¼å¯ä»¥å°ä¸äºå¾ä¹æ²¡ç¨ç value äº¤æ¢å°ç£çãè memcached çæ°æ®åä¼ä¸ç´å¨åå­ä¸­ã\n\n\n# redis ä¸ºä»ä¹å¿«\n\nredis åæº qps è½è¾¾å° 100000ã\n\nredis æ¯åçº¿ç¨æ¨¡åï¼redis 6.0 å·²ç»æ¯æå¤çº¿ç¨æ¨¡åï¼ï¼ä¸ºä»ä¹è¿è½æè¿ä¹é«çå¹¶åï¼\n\n * redis å®å¨åºäºåå­æä½ã\n * redis æ°æ®ç»æç®åã\n * éç¨åçº¿ç¨ï¼é¿åçº¿ç¨ä¸ä¸æåæ¢åç«äºã\n * ä½¿ç¨ i/o å¤è·¯å¤ç¨æ¨¡åï¼éé»å¡ i/oï¼ã\n\n> i/o å¤è·¯å¤ç¨\n> \n> i/o å¤è·¯å¤ç¨æ¨¡åæ¯å©ç¨ selectãpollãepoll å¯ä»¥åæ¶çå¯å¤ä¸ªæµç i/o äºä»¶çè½åï¼å¨ç©ºé²çæ¶åï¼ä¼æå½åçº¿ç¨é»å¡æï¼å½æä¸ä¸ªæå¤ä¸ªæµæ i/o äºä»¶æ¶ï¼å°±ä»é»å¡æä¸­å¤éï¼äºæ¯ç¨åºå°±ä¼è½®è¯¢ä¸éææçæµï¼epoll æ¯åªè½®è¯¢é£äºçæ­£ååºäºäºä»¶çæµï¼ï¼å¹¶ä¸åªä¾æ¬¡é¡ºåºçå¤çå°±ç»ªçæµï¼è¿ç§åæ³å°±é¿åäºå¤§éçæ ç¨æä½ã\n\n\n# äºãredis æ°æ®ç±»å\n\nredis åºæ¬æ°æ®ç±»åï¼stringãhashãlistãsetãzset\n\nredis é«çº§æ°æ®ç±»åï¼bitmapãhyperloglogãgeo\n\n> ð¡ æ´è¯¦ç»çç¹æ§ååçè¯´æè¯·åèï¼redis æ°æ®ç±»åååºç¨\n\n\n# ä¸ãredis åå­æ·æ±°\n\n\n# åå­æ·æ±°è¦ç¹\n\n * æå¤§ç¼å­ - redis åè®¸éè¿ maxmemory åæ°æ¥è®¾ç½®åå­æå¤§å¼ã\n\n * å¤±ææ¶é´ - ä½ä¸ºä¸ç§å®ææ¸çæ ææ°æ®çéè¦æºå¶ï¼å¨ redis æä¾çè¯¸å¤å½ä»¤ä¸­ï¼expireãexpireatãpexpireãpexpireat ä»¥å setex å psetex åå¯ä»¥ç¨æ¥è®¾ç½®ä¸æ¡é®å¼å¯¹çå¤±ææ¶é´ãèä¸æ¡é®å¼å¯¹ä¸æ¦è¢«å³èäºå¤±ææ¶é´å°±ä¼å¨å°æåèªå¨å é¤ï¼æèè¯´åå¾æ æ³è®¿é®æ´ä¸ºåç¡®ï¼ã\n\n * æ·æ±°ç­ç¥ - éçä¸æ­çå redis ä¸­ä¿å­æ°æ®ï¼å½åå­å©ä½ç©ºé´æ æ³æ»¡è¶³æ·»å çæ°æ®æ¶ï¼redis åå°±ä¼æ½è¡æ°æ®æ·æ±°ç­ç¥ï¼æ¸é¤ä¸é¨ååå®¹ç¶åä¿è¯æ°çæ°æ®å¯ä»¥ä¿å­å°åå­ä¸­ãåå­æ·æ±°æºå¶æ¯ä¸ºäºæ´å¥½çä½¿ç¨åå­ï¼ç¨ä¸å®å¾ miss æ¥æ¢ååå­çå©ç¨çï¼ä¿è¯ redis ç¼å­ä¸­ä¿å­çé½æ¯ç­ç¹æ°æ®ã\n\n * éç²¾åç lru - å®éä¸ redis å®ç°ç lru å¹¶ä¸æ¯å¯é ç lruï¼ä¹å°±æ¯åä¹ä¸æä»¬ä½¿ç¨ lru ç®æ³æ·æ±°é®ï¼ä½æ¯å®éä¸è¢«æ·æ±°çé®å¹¶ä¸ä¸å®æ¯çæ­£çæä¹æ²¡ç¨çã\n\n\n# ä¸»é®è¿ææ¶é´\n\nredis å¯ä»¥ä¸ºæ¯ä¸ªé®è®¾ç½®è¿ææ¶é´ï¼å½é®è¿ææ¶ï¼ä¼èªå¨å é¤è¯¥é®ã\n\nå¯¹äºæ£åè¡¨è¿ç§å®¹å¨ï¼åªè½ä¸ºæ´ä¸ªé®è®¾ç½®è¿ææ¶é´ï¼æ´ä¸ªæ£åè¡¨ï¼ï¼èä¸è½ä¸ºé®éé¢çåä¸ªåç´ è®¾ç½®è¿ææ¶é´ã\n\nå¯ä»¥ä½¿ç¨ expire æ expireat æ¥ä¸º key è®¾ç½®è¿ææ¶é´ã\n\n> ð æ³¨æï¼å½ expire çæ¶é´å¦æè®¾ç½®çæ¯è´æ°ï¼expireat è®¾ç½®çæ¶é´æ³æ¯è¿ææ¶é´ï¼å°ç´æ¥å é¤ keyã\n\nç¤ºä¾ï¼\n\nredis> set mykey "hello"\n"ok"\nredis> expire mykey 10\n(integer) 1\nredis> ttl mykey\n(integer) 10\nredis> set mykey "hello world"\n"ok"\nredis> ttl mykey\n(integer) -1\nredis>\n\n\n\n# æ·æ±°ç­ç¥\n\nåå­æ·æ±°åªæ¯ redis æä¾çä¸ä¸ªåè½ï¼ä¸ºäºæ´å¥½å°å®ç°è¿ä¸ªåè½ï¼å¿é¡»ä¸ºä¸åçåºç¨åºæ¯æä¾ä¸åçç­ç¥ï¼åå­æ·æ±°ç­ç¥è®²çæ¯ä¸ºå®ç°åå­æ·æ±°æä»¬å·ä½æä¹åï¼è¦è§£å³çé®é¢åæ¬æ·æ±°é®ç©ºé´å¦ä½éæ©ï¼å¨é®ç©ºé´ä¸­æ·æ±°é®å¦ä½éæ©ï¼\n\nredis æä¾äºä¸é¢å ç§åå­æ·æ±°ç­ç¥ä¾ç¨æ·éï¼\n\n * noeviction - å½åå­ä½¿ç¨è¾¾å°éå¼çæ¶åï¼ææå¼èµ·ç³è¯·åå­çå½ä»¤ä¼æ¥éãè¿æ¯ redis é»è®¤çç­ç¥ã\n * allkeys-lru - å¨ä¸»é®ç©ºé´ä¸­ï¼ä¼åç§»é¤æè¿æªä½¿ç¨ç keyã\n * allkeys-random - å¨ä¸»é®ç©ºé´ä¸­ï¼éæºç§»é¤æä¸ª keyã\n * volatile-lru - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼ä¼åç§»é¤æè¿æªä½¿ç¨ç keyã\n * volatile-random - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼éæºç§»é¤æä¸ª keyã\n * volatile-ttl - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼å·ææ´æ©è¿ææ¶é´ç key ä¼åç§»é¤ã\n\n\n# å¦ä½éæ©æ·æ±°ç­ç¥\n\n * å¦ææ°æ®åç°å¹ç­åå¸ï¼å­å¨ç­ç¹æ°æ®ï¼é¨åæ°æ®è®¿é®é¢çé«ï¼é¨åæ°æ®è®¿é®é¢çä½ï¼ï¼åä½¿ç¨ allkeys-lruã\n * å¦ææ°æ®åç°å¹³ç­åå¸ï¼æ°æ®è®¿é®é¢çå¤§è´ç¸åï¼ï¼åä½¿ç¨ allkeys-randomã\n * å¦æå¸æä½¿ç¨ä¸åç ttl å¼å redis æç¤ºåªäº key æ´éåè¢«æ·æ±°ï¼è¯·ä½¿ç¨ volatile-ttlã\n * volatile-lru å volatile-random éåæ¢åºç¨äºç¼å­åååºç¨äºæä¹åå­å¨çåºæ¯ï¼ç¶èæä»¬ä¹å¯ä»¥éè¿ä½¿ç¨ä¸¤ä¸ª redis å®ä¾æ¥è¾¾å°ç¸åçææã\n * å° key è®¾ç½®è¿ææ¶é´å®éä¸ä¼æ¶èæ´å¤çåå­ï¼å æ­¤å»ºè®®ä½¿ç¨ allkeys-lru ç­ç¥ä»èæ´ææççä½¿ç¨åå­ã\n\n\n# åé¨å®ç°\n\nredis å é¤å¤±æä¸»é®çæ¹æ³ä¸»è¦æä¸¤ç§ï¼\n\n * æ¶ææ¹æ³ï¼passive wayï¼ï¼å¨ä¸»é®è¢«è®¿é®æ¶å¦æåç°å®å·²ç»å¤±æï¼é£ä¹å°±å é¤å®ã\n * ä¸»å¨æ¹æ³ï¼active wayï¼ï¼å¨ææ§å°ä»è®¾ç½®äºå¤±ææ¶é´çä¸»é®ä¸­éæ©ä¸é¨åå¤±æçä¸»é®å é¤ã\n * ä¸»å¨å é¤ï¼å½åå·²ç¨åå­è¶è¿ maxmemory éå®æ¶ï¼è§¦åä¸»å¨æ¸çç­ç¥ï¼è¯¥ç­ç¥ç±å¯å¨åæ°çéç½®å³å®ä¸»é®å·ä½çå¤±ææ¶é´å¨é¨é½ç»´æ¤å¨ expires è¿ä¸ªå­å¸è¡¨ä¸­ã\n\n\n# åãredis æä¹å\n\nredis æ¯åå­åæ°æ®åºï¼ä¸ºäºä¿è¯æ°æ®å¨å®æºåä¸ä¼ä¸¢å¤±ï¼éè¦å°åå­ä¸­çæ°æ®æä¹åå°ç¡¬çä¸ã\n\nredis æ¯æä¸¤ç§æä¹åæ¹å¼ï¼rdb å aofã\n\n * rdb - rdb å³å¿«ç§æ¹å¼ï¼å®å°æä¸ªæ¶é´ç¹çææ redis æ°æ®ä¿å­å°ä¸ä¸ªç»è¿åç¼©çäºè¿å¶æä»¶ï¼rdb æä»¶ï¼ä¸­ã\n * aof - aof(append only file) æ¯ä»¥ææ¬æ¥å¿å½¢å¼å°ææåå½ä»¤è¿½å å° aof æä»¶çæ«å°¾ï¼ä»¥æ­¤æ¥è®°å½æ°æ®çååãå½æå¡å¨éå¯çæ¶åä¼éæ°è½½å¥åæ§è¡è¿äºå½ä»¤æ¥æ¢å¤åå§çæ°æ®ãaof éåä½ä¸º ç­å¤ã\n\n> ð¡ æ´è¯¦ç»çç¹æ§ååçè¯´æè¯·åèï¼redis æä¹å\n\n\n# äºãredis äºä»¶\n\nredis æå¡å¨æ¯ä¸ä¸ªäºä»¶é©±å¨ç¨åºï¼æå¡å¨éè¦å¤çä¸¤ç±»äºä»¶ï¼\n\n * æä»¶äºä»¶ï¼file eventï¼ - redis æå¡å¨éè¿å¥æ¥å­ï¼socketï¼ä¸å®¢æ·ç«¯æèå¶å®æå¡å¨è¿è¡éä¿¡ï¼æä»¶äºä»¶å°±æ¯å¯¹å¥æ¥å­æä½çæ½è±¡ãæå¡å¨ä¸å®¢æ·ç«¯ï¼æå¶ä»çæå¡å¨ï¼çéä¿¡ä¼äº§çæä»¶äºä»¶ï¼èæå¡å¨éè¿çå¬å¹¶å¤çè¿äºäºä»¶æ¥å®æä¸ç³»åç½ç»éä¿¡æä½ã\n * æ¶é´äºä»¶ï¼time eventï¼ - redis æå¡å¨æä¸äºæä½éè¦å¨ç»å®çæ¶é´ç¹æ§è¡ï¼æ¶é´äºä»¶æ¯å¯¹è¿ç±»å®æ¶æä½çæ½è±¡ã\n\n\n# æä»¶äºä»¶\n\nredis åºäº reactor æ¨¡å¼å¼åäºèªå·±çç½ç»æ¶é´å¤çå¨ã\n\n * redis æä»¶äºä»¶å¤çå¨ä½¿ç¨ i/o å¤è·¯å¤ç¨ç¨åºæ¥åæ¶çå¬å¤ä¸ªå¥æ¥å­ï¼å¹¶æ ¹æ®å¥æ¥å­ç®åæ§è¡çä»»å¡æ¥ä¸ºå¥æ¥å­å³èä¸åçäºä»¶å¤çå¨ã\n * å½è¢«çå¬çå¥æ¥å­åå¤å¥½æ§è¡è¿æ¥åºç­ãè¯»åãåå¥ãå³é­æä½æ¶ï¼ä¸æä½ç¸å¯¹åºçæä»¶äºä»¶å°±ä¼äº§çï¼è¿æ¶æä»¶äºä»¶å¤çå¨å°±ä¼è°ç¨å¥æ¥å­ä¹åå³èå¥½çäºä»¶å¤çå¨æ¥å¤çè¿äºäºä»¶ã\n\nè½ç¶æä»¶äºä»¶å¤çå¨ä»¥åçº¿ç¨æ¹å¼è¿è¡ï¼ä½éè¿ä½¿ç¨ i/o å¤è·¯å¤ç¨ç¨åºæ¥çå¬å¤ä¸ªå¥æ¥å­ï¼æä»¶äºä»¶å¤çå¨å®ç°äºé«æ§è½çç½ç»éä¿¡æ¨¡åã\n\næä»¶äºä»¶å¤çå¨æåä¸ªç»æé¨åï¼å¥æ¥å­ãi/o å¤è·¯å¤ç¨ç¨åºãæä»¶äºä»¶åæ´¾å¨ãäºä»¶å¤çå¨ã\n\n\n\n\n# æ¶é´äºä»¶\n\næ¶é´äºä»¶ååä¸ºï¼\n\n * å®æ¶äºä»¶ï¼æ¯è®©ä¸æ®µç¨åºå¨æå®çæ¶é´ä¹åæ§è¡ä¸æ¬¡ï¼\n * å¨ææ§äºä»¶ï¼æ¯è®©ä¸æ®µç¨åºæ¯éæå®æ¶é´å°±æ§è¡ä¸æ¬¡ã\n\nredis å°æææ¶é´äºä»¶é½æ¾å¨ä¸ä¸ªæ åºé¾è¡¨ä¸­ï¼æ¯å½æ¶é´äºä»¶æ§è¡å¨è¿è¡æ¶ï¼éè¿éåæ´ä¸ªé¾è¡¨æ¥æ¾åºå·²å°è¾¾çæ¶é´äºä»¶ï¼å¹¶è°ç¨ååºçäºä»¶å¤çå¨ã\n\n\n# äºä»¶çè°åº¦ä¸æ§è¡\n\næå¡å¨éè¦ä¸æ­çå¬æä»¶äºä»¶çå¥æ¥å­æè½å¾å°å¾å¤ççæä»¶äºä»¶ï¼ä½æ¯ä¸è½ä¸ç´çå¬ï¼å¦åæ¶é´äºä»¶æ æ³å¨è§å®çæ¶é´åæ§è¡ï¼å æ­¤çå¬æ¶é´åºè¯¥æ ¹æ®è·ç¦»ç°å¨æè¿çæ¶é´äºä»¶æ¥å³å®ã\n\näºä»¶è°åº¦ä¸æ§è¡ç± aeprocessevents å½æ°è´è´£ï¼ä¼ªä»£ç å¦ä¸ï¼\n\ndef aeprocessevents():\n\n    ## è·åå°è¾¾æ¶é´ç¦»å½åæ¶é´ææ¥è¿çæ¶é´äºä»¶\n    time_event = aesearchnearesttimer()\n\n    ## è®¡ç®ææ¥è¿çæ¶é´äºä»¶è·ç¦»å°è¾¾è¿æå¤å°æ¯«ç§\n    remaind_ms = time_event.when - unix_ts_now()\n\n    ## å¦æäºä»¶å·²å°è¾¾ï¼é£ä¹ remaind_ms çå¼å¯è½ä¸ºè´æ°ï¼å°å®è®¾ä¸º 0\n    if remaind_ms < 0:\n        remaind_ms = 0\n\n    ## æ ¹æ® remaind_ms çå¼ï¼åå»º timeval\n    timeval = create_timeval_with_ms(remaind_ms)\n\n    ## é»å¡å¹¶ç­å¾æä»¶äºä»¶äº§çï¼æå¤§é»å¡æ¶é´ç±ä¼ å¥ç timeval å³å®\n    aeapipoll(timeval)\n\n    ## å¤çææå·²äº§ççæä»¶äºä»¶\n    procesfileevents()\n\n    ## å¤çææå·²å°è¾¾çæ¶é´äºä»¶\n    processtimeevents()\n\n\nå° aeprocessevents å½æ°ç½®äºä¸ä¸ªå¾ªç¯éé¢ï¼å ä¸åå§ååæ¸çå½æ°ï¼å°±ææäº redis æå¡å¨çä¸»å½æ°ï¼ä¼ªä»£ç å¦ä¸ï¼\n\ndef main():\n\n    ## åå§åæå¡å¨\n    init_server()\n\n    ## ä¸ç´å¤çäºä»¶ï¼ç´å°æå¡å¨å³é­ä¸ºæ­¢\n    while server_is_not_shutdown():\n        aeprocessevents()\n\n    ## æå¡å¨å³é­ï¼æ§è¡æ¸çæä½\n    clean_server()\n\n\nä»äºä»¶å¤ççè§åº¦æ¥çï¼æå¡å¨è¿è¡æµç¨å¦ä¸ï¼\n\n\n\n\n# å­ãredis äºå¡\n\n> redis æä¾çä¸æ¯ä¸¥æ ¼çäºå¡ï¼redis åªä¿è¯ä¸²è¡æ§è¡å½ä»¤ï¼å¹¶ä¸è½ä¿è¯å¨é¨æ§è¡ï¼ä½æ¯æ§è¡å½ä»¤å¤±è´¥æ¶å¹¶ä¸ä¼åæ»ï¼èæ¯ä¼ç»§ç»­æ§è¡ä¸å»ã\n\nmulti ã exec ã discard å watch æ¯ redis äºå¡ç¸å³çå½ä»¤ã\n\näºå¡å¯ä»¥ä¸æ¬¡æ§è¡å¤ä¸ªå½ä»¤ï¼ å¹¶ä¸æä»¥ä¸ä¸¤ä¸ªéè¦çä¿è¯ï¼\n\n * äºå¡æ¯ä¸ä¸ªåç¬çéç¦»æä½ï¼äºå¡ä¸­çææå½ä»¤é½ä¼åºååãæé¡ºåºå°æ§è¡ãäºå¡å¨æ§è¡çè¿ç¨ä¸­ï¼ä¸ä¼è¢«å¶ä»å®¢æ·ç«¯åéæ¥çå½ä»¤è¯·æ±æææ­ã\n * äºå¡æ¯ä¸ä¸ªåå­æä½ï¼äºå¡ä¸­çå½ä»¤è¦ä¹å¨é¨è¢«æ§è¡ï¼è¦ä¹å¨é¨é½ä¸æ§è¡ã\n\n\n# multi\n\nmulti å½ä»¤ç¨äºå¼å¯ä¸ä¸ªäºå¡ï¼å®æ»æ¯è¿å ok ã\n\nmulti æ§è¡ä¹åï¼ å®¢æ·ç«¯å¯ä»¥ç»§ç»­åæå¡å¨åéä»»æå¤æ¡å½ä»¤ï¼ è¿äºå½ä»¤ä¸ä¼ç«å³è¢«æ§è¡ï¼ èæ¯è¢«æ¾å°ä¸ä¸ªéåä¸­ï¼ å½ exec å½ä»¤è¢«è°ç¨æ¶ï¼ ææéåä¸­çå½ä»¤æä¼è¢«æ§è¡ã\n\nä»¥ä¸æ¯ä¸ä¸ªäºå¡ä¾å­ï¼ å®åå­å°å¢å äº foo å bar ä¸¤ä¸ªé®çå¼ï¼\n\n> multi\nok\n> incr foo\nqueued\n> incr bar\nqueued\n> exec\n1) (integer) 1\n2) (integer) 1\n\n\n\n# exec\n\nexec å½ä»¤è´è´£è§¦åå¹¶æ§è¡äºå¡ä¸­çææå½ä»¤ã\n\n * å¦æå®¢æ·ç«¯å¨ä½¿ç¨ multi å¼å¯äºä¸ä¸ªäºå¡ä¹åï¼å´å ä¸ºæ­çº¿èæ²¡ææåæ§è¡ exec ï¼é£ä¹äºå¡ä¸­çææå½ä»¤é½ä¸ä¼è¢«æ§è¡ã\n * å¦ä¸æ¹é¢ï¼å¦æå®¢æ·ç«¯æåå¨å¼å¯äºå¡ä¹åæ§è¡ exec ï¼é£ä¹äºå¡ä¸­çææå½ä»¤é½ä¼è¢«æ§è¡ã\n\n\n# discard\n\nå½æ§è¡ discard å½ä»¤æ¶ï¼ äºå¡ä¼è¢«æ¾å¼ï¼ äºå¡éåä¼è¢«æ¸ç©ºï¼ å¹¶ä¸å®¢æ·ç«¯ä¼ä»äºå¡ç¶æä¸­éåºã\n\nç¤ºä¾ï¼\n\n> set foo 1\nok\n> multi\nok\n> incr foo\nqueued\n> discard\nok\n> get foo\n"1"\n\n\n\n# watch\n\nwatch å½ä»¤å¯ä»¥ä¸º redis äºå¡æä¾ check-and-set ï¼casï¼è¡ä¸ºã\n\nè¢« watch çé®ä¼è¢«çè§ï¼å¹¶ä¼åè§è¿äºé®æ¯å¦è¢«æ¹å¨è¿äºã å¦ææè³å°ä¸ä¸ªè¢«çè§çé®å¨ exec æ§è¡ä¹åè¢«ä¿®æ¹äºï¼ é£ä¹æ´ä¸ªäºå¡é½ä¼è¢«åæ¶ï¼ exec è¿å nil-reply æ¥è¡¨ç¤ºäºå¡å·²ç»å¤±è´¥ã\n\nwatch mykey\nval = get mykey\nval = val + 1\nmulti\nset mykey $val\nexec\n\n\nä½¿ç¨ä¸é¢çä»£ç ï¼ å¦æå¨ watch æ§è¡ä¹åï¼ exec æ§è¡ä¹åï¼ æå¶ä»å®¢æ·ç«¯ä¿®æ¹äº mykey çå¼ï¼ é£ä¹å½åå®¢æ·ç«¯çäºå¡å°±ä¼å¤±è´¥ã ç¨åºéè¦åçï¼ å°±æ¯ä¸æ­éè¯è¿ä¸ªæä½ï¼ ç´å°æ²¡æåçç¢°æä¸ºæ­¢ã\n\nè¿ç§å½¢å¼çéè¢«ç§°ä½ä¹è§éï¼ å®æ¯ä¸ç§éå¸¸å¼ºå¤§çéæºå¶ã å¹¶ä¸å ä¸ºå¤§å¤æ°æåµä¸ï¼ ä¸åçå®¢æ·ç«¯ä¼è®¿é®ä¸åçé®ï¼ ç¢°æçæåµä¸è¬é½å¾å°ï¼ æä»¥éå¸¸å¹¶ä¸éè¦è¿è¡éè¯ã\n\nwatch ä½¿å¾ exec å½ä»¤éè¦ææ¡ä»¶å°æ§è¡ï¼äºå¡åªè½å¨ææè¢«çè§é®é½æ²¡æè¢«ä¿®æ¹çåæä¸æ§è¡ï¼å¦æè¿ä¸ªåæä¸è½æ»¡è¶³çè¯ï¼äºå¡å°±ä¸ä¼è¢«æ§è¡ã\n\nwatch å½ä»¤å¯ä»¥è¢«è°ç¨å¤æ¬¡ãå¯¹é®ççè§ä» watch æ§è¡ä¹åå¼å§çæï¼ç´å°è°ç¨ exec ä¸ºæ­¢ã\n\nç¨æ·è¿å¯ä»¥å¨åä¸ª watch å½ä»¤ä¸­çè§ä»»æå¤ä¸ªé®ï¼ä¾å¦ï¼\n\nredis> watch key1 key2 key3\nok\n\n\n# åæ¶ watch çåºæ¯\n\nå½ exec è¢«è°ç¨æ¶ï¼ ä¸ç®¡äºå¡æ¯å¦æåæ§è¡ï¼ å¯¹ææé®ççè§é½ä¼è¢«åæ¶ã\n\nå¦å¤ï¼ å½å®¢æ·ç«¯æ­å¼è¿æ¥æ¶ï¼ è¯¥å®¢æ·ç«¯å¯¹é®ççè§ä¹ä¼è¢«åæ¶ã\n\nä½¿ç¨æ åæ°ç unwatch å½ä»¤å¯ä»¥æå¨åæ¶å¯¹ææé®ççè§ã å¯¹äºä¸äºéè¦æ¹å¨å¤ä¸ªé®çäºå¡ï¼ ææ¶åç¨åºéè¦åæ¶å¯¹å¤ä¸ªé®è¿è¡å éï¼ ç¶åæ£æ¥è¿äºé®çå½åå¼æ¯å¦ç¬¦åç¨åºçè¦æ±ã å½å¼è¾¾ä¸å°è¦æ±æ¶ï¼ å°±å¯ä»¥ä½¿ç¨ unwatch å½ä»¤æ¥åæ¶ç®åå¯¹é®ççè§ï¼ ä¸­éæ¾å¼è¿ä¸ªäºå¡ï¼ å¹¶ç­å¾äºå¡çä¸æ¬¡å°è¯ã\n\n# ä½¿ç¨ watch åå»ºåå­æä½\n\nwatch å¯ä»¥ç¨äºåå»º redis æ²¡æåç½®çåå­æä½ã\n\nä¸¾ä¸ªä¾å­ï¼ä»¥ä¸ä»£ç å®ç°äºååç zpop å½ä»¤ï¼å®å¯ä»¥åå­å°å¼¹åºæåºéåä¸­åå¼ï¼scoreï¼æå°çåç´ ï¼\n\nwatch zset\nelement = zrange zset 0 0\nmulti\nzrem zset element\nexec\n\n\n\n# rollback\n\nredis ä¸æ¯æåæ»ãredis ä¸æ¯æåæ»ççç±ï¼\n\n * redis å½ä»¤åªä¼å ä¸ºéè¯¯çè¯­æ³èå¤±è´¥ï¼ææ¯å½ä»¤ç¨å¨äºéè¯¯ç±»åçé®ä¸é¢ã\n * å ä¸ºä¸éè¦å¯¹åæ»è¿è¡æ¯æï¼æä»¥ redis çåé¨å¯ä»¥ä¿æç®åä¸å¿«éã\n\n\n# ä¸ãredis ç®¡é\n\nredis æ¯ä¸ç§åºäº c/s æ¨¡åä»¥åè¯·æ±/ååºåè®®ç tcp æå¡ãredis æ¯æç®¡éææ¯ãç®¡éææ¯åè®¸è¯·æ±ä»¥å¼æ­¥æ¹å¼åéï¼å³æ§è¯·æ±çåºç­è¿æªè¿åçæåµä¸ï¼åè®¸åéæ°è¯·æ±ãè¿ç§æ¹å¼å¯ä»¥å¤§å¤§æé«ä¼ è¾æçã\n\nå¨éè¦æ¹éæ§è¡ redis å½ä»¤æ¶ï¼å¦æä¸æ¡ä¸æ¡æ§è¡ï¼æ¾ç¶å¾ä½æãä¸ºäºåå°éä¿¡æ¬¡æ°å¹¶éä½å»¶è¿ï¼å¯ä»¥ä½¿ç¨ redis ç®¡éåè½ãredis çç®¡éï¼pipelineï¼åè½æ²¡ææä¾å½ä»¤è¡æ¯æï¼ä½æ¯å¨åç§è¯­è¨çæ¬çå®¢æ·ç«¯ä¸­é½æç¸åºçå®ç°ã\n\nä»¥ jedis ä¸ºä¾ï¼\n\npipeline pipe = conn.pipelined();\npipe.multi();\npipe.hset("login:", token, user);\npipe.zadd("recent:", timestamp, token);\nif (item != null) {\n    pipe.zadd("viewed:" + token, timestamp, item);\n    pipe.zremrangebyrank("viewed:" + token, 0, -26);\n    pipe.zincrby("viewed:", -1, item);\n}\npipe.exec();\n\n\n> ð æ³¨æï¼ä½¿ç¨ç®¡éåéå½ä»¤æ¶ï¼redis server ä¼å°é¨åè¯·æ±æ¾å°ç¼å­éåä¸­ï¼å ç¨åå­ï¼ï¼æ§è¡å®æ¯åä¸æ¬¡æ§åéç»æãå¦æéè¦åéå¤§éçå½ä»¤ï¼ä¼å ç¨å¤§éçåå­ï¼å æ­¤åºè¯¥æç§åçæ°éåæ¹æ¬¡çå¤çã\n\n\n# å«ãredis åå¸ä¸è®¢é\n\nredis æä¾äº 5 ä¸ªåå¸ä¸è®¢éå½ä»¤ï¼\n\nå½ä»¤             æè¿°\nsubscribe      subscribe channel [channel ...]âè®¢éæå®é¢éã\nunsubscribe    unsubscribe [channel [channel ...]]âåæ¶è®¢éæå®é¢éã\npublish        publish channel messageâåéä¿¡æ¯å°æå®çé¢éã\npsubscribe     psubscribe pattern [pattern ...]âè®¢éç¬¦åæå®æ¨¡å¼çé¢éã\npunsubscribe   punsubscribe [pattern [pattern ...]]âåæ¶è®¢éç¬¦åæå®æ¨¡å¼çé¢éã\n\nè®¢éèè®¢éäºé¢éä¹åï¼åå¸èåé¢éåéå­ç¬¦ä¸²æ¶æ¯ä¼è¢«ææè®¢éèæ¥æ¶å°ã\n\næä¸ªå®¢æ·ç«¯ä½¿ç¨ subscribe è®¢éä¸ä¸ªé¢éï¼å¶å®å®¢æ·ç«¯å¯ä»¥ä½¿ç¨ publish åè¿ä¸ªé¢éåéæ¶æ¯ã\n\nåå¸ä¸è®¢éæ¨¡å¼åè§å¯èæ¨¡å¼æä»¥ä¸ä¸åï¼\n\n * è§å¯èæ¨¡å¼ä¸­ï¼è§å¯èåä¸»é¢é½ç¥éå¯¹æ¹çå­å¨ï¼èå¨åå¸ä¸è®¢éæ¨¡å¼ä¸­ï¼åå¸èä¸è®¢éèä¸ç¥éå¯¹æ¹çå­å¨ï¼å®ä»¬ä¹é´éè¿é¢éè¿è¡éä¿¡ã\n * è§å¯èæ¨¡å¼æ¯åæ­¥çï¼å½äºä»¶è§¦åæ¶ï¼ä¸»é¢ä¼å»è°ç¨è§å¯èçæ¹æ³ï¼èåå¸ä¸è®¢éæ¨¡å¼æ¯å¼æ­¥çï¼\n\n----------------------------------------\n\nåå²çº¿ä»¥ä¸ä¸º redis éç¾¤åè½ç¹æ§\n\n\n# ä¹ãredis å¤å¶\n\n> å³ç³»åæ°æ®åºéå¸¸ä¼ä½¿ç¨ä¸ä¸ªä¸»æå¡å¨åå¤ä¸ªä»æå¡å¨åéæ´æ°ï¼å¹¶ä½¿ç¨ä»æå¡å¨æ¥å¤çææè¯»è¯·æ±ï¼redis ä¹éç¨äºåæ ·çæ¹å¼æ¥å®ç°å¤å¶ç¹æ§ã\n\n\n# æ§çå¤å¶\n\nredis 2.8 çæ¬ä»¥åçå¤å¶åè½åºäº sync å½ä»¤å®ç°ã\n\nredis çå¤å¶åè½åä¸ºåæ­¥ï¼syncï¼åå½ä»¤ä¼ æ­ï¼command propagateï¼ä¸¤ä¸ªæä½ï¼\n\n * åæ­¥ï¼syncï¼ - ç¨äºå°ä»æå¡å¨çæ°æ®åºç¶ææ´æ°è³ä¸»æå¡å¨å½åçæ°æ®åºç¶æã\n * å½ä»¤ä¼ æ­ï¼command propagateï¼ - å½ä¸»æå¡å¨çæ°æ®åºç¶æè¢«ä¿®æ¹ï¼å¯¼è´ä¸»ä»æ°æ®åºç¶æä¸ä¸è´æ¶ï¼è®©ä¸»ä»æå¡å¨çæ°æ®åºéæ°åå°ä¸è´ç¶æã\n\nè¿ç§æ¹å¼å­å¨ç¼ºé·ï¼ä¸è½é«æå¤çæ­çº¿éè¿åçå¤å¶æåµã\n\n\n# æ°çå¤å¶\n\nredis 2.8 çæ¬ä»¥åçå¤å¶åè½åºäº psync å½ä»¤å®ç°ãpsync å½ä»¤å·æå®æ´éåæ­¥åé¨åéåæ­¥ä¸¤ç§æ¨¡å¼ã\n\n * å®æ´éåæ­¥ï¼full resychronizationï¼ - ç¨äºåæ¬¡å¤å¶ãæ§è¡æ­¥éª¤ä¸ sync å½ä»¤åºæ¬ä¸è´ã\n * é¨åéåæ­¥ï¼partial resychronizationï¼ - ç¨äºæ­çº¿åéå¤å¶ãå¦ææ¡ä»¶åè®¸ï¼ä¸»æå¡å¨å¯ä»¥å°ä¸»ä»æå¡å¨è¿æ¥æ­å¼æé´æ§è¡çåå½ä»¤åéç»ä»æå¡å¨ï¼ä»æå¡å¨åªéæ¥æ¶å¹¶æ§è¡è¿äºåå½ä»¤ï¼å³å¯å°ä¸»ä»æå¡å¨çæ°æ®åºç¶æä¿æä¸è´ã\n\n\n# é¨åéåæ­¥\n\né¨åéåæ­¥æä¸ä¸ªç»æé¨åï¼\n\n * ä¸»ä»æå¡å¨çå¤å¶åç§»éï¼replication offsetï¼\n * ä¸»æå¡å¨çå¤å¶ç§¯åç¼å²åºï¼replication backlogï¼\n * æå¡å¨çè¿è¡ id\n\n\n# psync å½ä»¤\n\nä»æå¡å¨åè¦å¤å¶çä¸»æå¡å¨åé psync <runid> <offset> å½ä»¤\n\n * åå¦ä¸»ä»æå¡å¨ç master run id ç¸åï¼å¹¶ä¸æå®çåç§»éï¼offsetï¼å¨åå­ç¼å²åºä¸­è¿ææï¼å¤å¶å°±ä¼ä»ä¸æ¬¡ä¸­æ­çç¹å¼å§ç»§ç»­ã\n * å¦æå¶ä¸­ä¸ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼å°±ä¼è¿è¡å®å¨éæ°åæ­¥ã\n\n\n# å¿è·³æ£æµ\n\nä¸»æå¡å¨éè¿åä»æå¡ä¼ æ­å½ä»¤æ¥æ´æ°ä»æå¡å¨ç¶æï¼ä¿æä¸»ä»æ°æ®ä¸è´ã\n\nä»æå¡å¨éè¿åä¸»æå¡å¨åéå½ä»¤ replconf ack <replication_offset> æ¥è¿è¡å¿è·³æ£æµï¼ä»¥åå½ä»¤ä¸¢å¤±æ£æµã\n\n> ð¡ æ´è¯¦ç»çç¹æ§ååçè¯´æè¯·åèï¼redis å¤å¶\n\n\n# åãredis å¨åµ\n\nsentinelï¼å¨åµï¼å¯ä»¥çå¬ä¸»æå¡å¨ï¼å¹¶å¨ä¸»æå¡å¨è¿å¥ä¸çº¿ç¶ææ¶ï¼èªå¨ä»ä»æå¡å¨ä¸­éä¸¾åºæ°çä¸»æå¡å¨ã\n\n> ð¡ æ´è¯¦ç»çç¹æ§ååçè¯´æè¯·åèï¼redis å¨åµ\n\n\n# åä¸ãredis éç¾¤\n\nåçæ¯å°æ°æ®ååä¸ºå¤ä¸ªé¨åçæ¹æ³ï¼å¯ä»¥å°æ°æ®å­å¨å°å¤å°æºå¨éé¢ï¼ä¹å¯ä»¥ä»å¤å°æºå¨éé¢è·åæ°æ®ï¼è¿ç§æ¹æ³å¨è§£å³æäºé®é¢æ¶å¯ä»¥è·å¾çº¿æ§çº§å«çæ§è½æåã\n\nåè®¾æ 4 ä¸ª reids å®ä¾ r0ï¼r1ï¼r2ï¼r3ï¼è¿æå¾å¤è¡¨ç¤ºç¨æ·çé® user:1ï¼user:2ï¼... ç­ç­ï¼æä¸åçæ¹å¼æ¥éæ©ä¸ä¸ªæå®çé®å­å¨å¨åªä¸ªå®ä¾ä¸­ãæç®åçæ¹å¼æ¯èå´åçï¼ä¾å¦ç¨æ· id ä» 0~1000 çå­å¨å°å®ä¾ r0 ä¸­ï¼ç¨æ· id ä» 1001~2000 çå­å¨å°å®ä¾ r1 ä¸­ï¼ç­ç­ãä½æ¯è¿æ ·éè¦ç»´æ¤ä¸å¼ æ å°èå´è¡¨ï¼ç»´æ¤æä½ä»£ä»·å¾é«ãè¿æä¸ç§æ¹å¼æ¯åå¸åçï¼ä½¿ç¨ crc32 åå¸å½æ°å°é®è½¬æ¢ä¸ºä¸ä¸ªæ°å­ï¼åå¯¹å®ä¾æ°éæ±æ¨¡å°±è½ç¥éåºè¯¥å­å¨çå®ä¾ã\n\nä¸»è¦æä¸ç§åçæ¹å¼ï¼\n\n * å®¢æ·ç«¯åçï¼å®¢æ·ç«¯ä½¿ç¨ä¸è´æ§åå¸ç­ç®æ³å³å®é®åºå½åå¸å°åªä¸ªèç¹ã\n * ä»£çåçï¼å°å®¢æ·ç«¯è¯·æ±åéå°ä»£çä¸ï¼ç±ä»£çè½¬åè¯·æ±å°æ­£ç¡®çèç¹ä¸ã\n * æå¡å¨åçï¼redis clusterï¼å®æ¹ç redis éç¾¤è§£å³æ¹æ¡ï¼ã\n\n\n# åäºãredis client\n\nredis ç¤¾åºä¸­æå¤ç§ç¼ç¨è¯­è¨çå®¢æ·ç«¯ï¼å¯ä»¥å¨è¿éæ¥æ¾åéçå®¢æ·ç«¯ï¼redis å®æ¹ç½åçå®¢æ·ç«¯æ¸å\n\nredis å®æ¹æ¨èç java redis clientï¼\n\n * jedis - ææµè¡ç redis java å®¢æ·ç«¯\n * redisson - é¢å¤æä¾äºå¾å¤çåå¸å¼æå¡ç¹æ§ï¼å¦ï¼åå¸å¼éãåå¸å¼ java å¸¸ç¨å¯¹è±¡ï¼bitsetãblockingqueueãcountdownlatch ç­ï¼\n * lettuce - spring boot 2.0 é»è®¤ redis å®¢æ·ç«¯\n\n\n# æ©å±éè¯»\n\n> ð¡ redis å¸¸ç¨äºåå¸å¼ç¼å­ï¼æå³ç¼å­çç¹æ§ååçè¯·åèï¼ç¼å­åºæ¬åç\n\n\n# åèèµæ\n\n * å®ç½\n   * redis å®ç½\n   * redis github\n   * redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãredis å®æã\n   * ãredis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * redis å½ä»¤åè\n * èµæºæ±æ»\n   * awesome-redis\n * redis client\n   * spring-data-redis å®æ¹ææ¡£\n   * redisson å®æ¹ææ¡£(ä¸­æ,ç¥ææ»å)\n   * redisson å®æ¹ææ¡£(è±æ)\n   * crug | redisson pro vs. jedis: which is faster? ç¿»è¯\n   * redis åå¸é redisson æ§è½æµè¯',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Redis æ°æ®ç±»åååºç¨",frontmatter:{title:"Redis æ°æ®ç±»åååºç¨",date:"2020-06-24T10:45:38.000Z",categories:["æ°æ®åº","KVæ°æ®åº","Redis"],tags:["æ°æ®åº","KVæ°æ®åº","Redis","æ°æ®ç±»å"],permalink:"/pages/ed757c/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/05.KV%E6%95%B0%E6%8D%AE%E5%BA%93/01.Redis/03.Redis%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%BA%94%E7%94%A8.html",relativePath:"12.æ°æ®åº/05.KVæ°æ®åº/01.Redis/03.Redisæ°æ®ç±»åååºç¨.md",key:"v-a0623b42",path:"/pages/ed757c/",headers:[{level:2,title:"ä¸ãRedis åºæ¬æ°æ®ç±»å",slug:"ä¸ãredis-åºæ¬æ°æ®ç±»å",normalizedTitle:"ä¸ãredis åºæ¬æ°æ®ç±»å",charIndex:113},{level:3,title:"STRING",slug:"string",normalizedTitle:"string",charIndex:157},{level:3,title:"HASH",slug:"hash",normalizedTitle:"hash",charIndex:495},{level:3,title:"LIST",slug:"list",normalizedTitle:"list",charIndex:243},{level:3,title:"SET",slug:"set",normalizedTitle:"set",charIndex:352},{level:3,title:"ZSET",slug:"zset",normalizedTitle:"zset",charIndex:596},{level:3,title:"éç¨å½ä»¤",slug:"éç¨å½ä»¤",normalizedTitle:"éç¨å½ä»¤",charIndex:3993},{level:4,title:"æåº",slug:"æåº",normalizedTitle:"æåº",charIndex:3238},{level:4,title:"é®çè¿ææ¶é´",slug:"é®çè¿ææ¶é´",normalizedTitle:"é®çè¿ææ¶é´",charIndex:4860},{level:2,title:"äºãRedis é«çº§æ°æ®ç±»å",slug:"äºãredis-é«çº§æ°æ®ç±»å",normalizedTitle:"äºãredis é«çº§æ°æ®ç±»å",charIndex:5580},{level:3,title:"BitMap",slug:"bitmap",normalizedTitle:"bitmap",charIndex:5599},{level:4,title:"BitMap å½ä»¤",slug:"bitmap-å½ä»¤",normalizedTitle:"bitmap å½ä»¤",charIndex:5882},{level:4,title:"BitMap ç¤ºä¾",slug:"bitmap-ç¤ºä¾",normalizedTitle:"bitmap ç¤ºä¾",charIndex:6057},{level:4,title:"BitMap åºç¨",slug:"bitmap-åºç¨",normalizedTitle:"bitmap åºç¨",charIndex:6318},{level:3,title:"HyperLogLog",slug:"hyperloglog",normalizedTitle:"hyperloglog",charIndex:6761},{level:4,title:"HyperLogLog å½ä»¤",slug:"hyperloglog-å½ä»¤",normalizedTitle:"hyperloglog å½ä»¤",charIndex:6875},{level:3,title:"GEO",slug:"geo",normalizedTitle:"geo",charIndex:7530},{level:4,title:"GEO å½ä»¤",slug:"geo-å½ä»¤",normalizedTitle:"geo å½ä»¤",charIndex:7580},{level:2,title:"ä¸ãRedis æ°æ®ç±»ååºç¨",slug:"ä¸ãredis-æ°æ®ç±»ååºç¨",normalizedTitle:"ä¸ãredis æ°æ®ç±»ååºç¨",charIndex:7805},{level:3,title:"æ¡ä¾-æåæ¬¢è¿æç« ",slug:"æ¡ä¾-æåæ¬¢è¿æç« ",normalizedTitle:"æ¡ä¾-æåæ¬¢è¿æç« ",charIndex:7824},{level:4,title:"å¯¹æç« è¿è¡æç¥¨",slug:"å¯¹æç« è¿è¡æç¥¨",normalizedTitle:"å¯¹æç« è¿è¡æç¥¨",charIndex:7860},{level:4,title:"åå¸å¹¶è·åæç« ",slug:"åå¸å¹¶è·åæç« ",normalizedTitle:"åå¸å¹¶è·åæç« ",charIndex:9134},{level:4,title:"å¯¹æç« è¿è¡åç»",slug:"å¯¹æç« è¿è¡åç»",normalizedTitle:"å¯¹æç« è¿è¡åç»",charIndex:11015},{level:3,title:"æ¡ä¾-ç®¡çä»¤ç",slug:"æ¡ä¾-ç®¡çä»¤ç",normalizedTitle:"æ¡ä¾-ç®¡çä»¤ç",charIndex:12271},{level:4,title:"æ¥è¯¢ä»¤ç",slug:"æ¥è¯¢ä»¤ç",normalizedTitle:"æ¥è¯¢ä»¤ç",charIndex:12376},{level:4,title:"æ´æ°ä»¤ç",slug:"æ´æ°ä»¤ç",normalizedTitle:"æ´æ°ä»¤ç",charIndex:12519},{level:4,title:"æ¸çä»¤ç",slug:"æ¸çä»¤ç",normalizedTitle:"æ¸çä»¤ç",charIndex:13293},{level:3,title:"æ¡ä¾-è´­ç©è½¦",slug:"æ¡ä¾-è´­ç©è½¦",normalizedTitle:"æ¡ä¾-è´­ç©è½¦",charIndex:14906},{level:4,title:"å¨è´­ç©è½¦ä¸­æ·»å ãå é¤åå",slug:"å¨è´­ç©è½¦ä¸­æ·»å ãå é¤åå",normalizedTitle:"å¨è´­ç©è½¦ä¸­æ·»å ãå é¤åå",charIndex:14968},{level:4,title:"æ¸ç©ºè´­ç©è½¦",slug:"æ¸ç©ºè´­ç©è½¦",normalizedTitle:"æ¸ç©ºè´­ç©è½¦",charIndex:15303},{level:3,title:"æ¡ä¾-é¡µé¢ç¼å­",slug:"æ¡ä¾-é¡µé¢ç¼å­",normalizedTitle:"æ¡ä¾-é¡µé¢ç¼å­",charIndex:16243},{level:3,title:"æ¡ä¾-æ°æ®è¡ç¼å­",slug:"æ¡ä¾-æ°æ®è¡ç¼å­",normalizedTitle:"æ¡ä¾-æ°æ®è¡ç¼å­",charIndex:16981},{level:3,title:"æ¡ä¾-ç½é¡µåæ",slug:"æ¡ä¾-ç½é¡µåæ",normalizedTitle:"æ¡ä¾-ç½é¡µåæ",charIndex:18993},{level:3,title:"æ¡ä¾-è®°å½æ¥å¿",slug:"æ¡ä¾-è®°å½æ¥å¿",normalizedTitle:"æ¡ä¾-è®°å½æ¥å¿",charIndex:20077},{level:3,title:"æ¡ä¾-ç»è®¡æ°æ®",slug:"æ¡ä¾-ç»è®¡æ°æ®",normalizedTitle:"æ¡ä¾-ç»è®¡æ°æ®",charIndex:20450},{level:3,title:"æ¡ä¾-æ¥æ¾ IP æå±å°",slug:"æ¡ä¾-æ¥æ¾-ip-æå±å°",normalizedTitle:"æ¡ä¾-æ¥æ¾ ip æå±å°",charIndex:21534},{level:4,title:"è½½å¥ IP æ°æ®",slug:"è½½å¥-ip-æ°æ®",normalizedTitle:"è½½å¥ ip æ°æ®",charIndex:21583},{level:4,title:"æ¥æ¾ IP æå±åå¸",slug:"æ¥æ¾-ip-æå±åå¸",normalizedTitle:"æ¥æ¾ ip æå±åå¸",charIndex:24645},{level:3,title:"æ¡ä¾-æå¡çåç°ä¸éç½®",slug:"æ¡ä¾-æå¡çåç°ä¸éç½®",normalizedTitle:"æ¡ä¾-æå¡çåç°ä¸éç½®",charIndex:25228},{level:3,title:"æ¡ä¾-èªå¨è¡¥å¨",slug:"æ¡ä¾-èªå¨è¡¥å¨",normalizedTitle:"æ¡ä¾-èªå¨è¡¥å¨",charIndex:25244},{level:3,title:"æ¡ä¾-å¹¿åå®å",slug:"æ¡ä¾-å¹¿åå®å",normalizedTitle:"æ¡ä¾-å¹¿åå®å",charIndex:25594},{level:3,title:"æ¡ä¾-èä½æç´¢",slug:"æ¡ä¾-èä½æç´¢",normalizedTitle:"æ¡ä¾-èä½æç´¢",charIndex:25606},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:27112}],headersStr:"ä¸ãRedis åºæ¬æ°æ®ç±»å STRING HASH LIST SET ZSET éç¨å½ä»¤ æåº é®çè¿ææ¶é´ äºãRedis é«çº§æ°æ®ç±»å BitMap BitMap å½ä»¤ BitMap ç¤ºä¾ BitMap åºç¨ HyperLogLog HyperLogLog å½ä»¤ GEO GEO å½ä»¤ ä¸ãRedis æ°æ®ç±»ååºç¨ æ¡ä¾-æåæ¬¢è¿æç«  å¯¹æç« è¿è¡æç¥¨ åå¸å¹¶è·åæç«  å¯¹æç« è¿è¡åç» æ¡ä¾-ç®¡çä»¤ç æ¥è¯¢ä»¤ç æ´æ°ä»¤ç æ¸çä»¤ç æ¡ä¾-è´­ç©è½¦ å¨è´­ç©è½¦ä¸­æ·»å ãå é¤åå æ¸ç©ºè´­ç©è½¦ æ¡ä¾-é¡µé¢ç¼å­ æ¡ä¾-æ°æ®è¡ç¼å­ æ¡ä¾-ç½é¡µåæ æ¡ä¾-è®°å½æ¥å¿ æ¡ä¾-ç»è®¡æ°æ® æ¡ä¾-æ¥æ¾ IP æå±å° è½½å¥ IP æ°æ® æ¥æ¾ IP æå±åå¸ æ¡ä¾-æå¡çåç°ä¸éç½® æ¡ä¾-èªå¨è¡¥å¨ æ¡ä¾-å¹¿åå®å æ¡ä¾-èä½æç´¢ åèèµæ",content:'# Redis æ°æ®ç±»åååºç¨\n\n> Redis æä¾äºå¤ç§æ°æ®ç±»åï¼æ¯ç§æ°æ®ç±»åæä¸°å¯çå½ä»¤æ¯æã\n> \n> ä½¿ç¨ Redis ï¼ä¸ä»è¦äºè§£å¶æ°æ®ç±»åçç¹æ§ï¼è¿éè¦æ ¹æ®ä¸å¡åºæ¯ï¼çµæ´»çãé«æçä½¿ç¨å¶æ°æ®ç±»åæ¥å»ºæ¨¡ã\n\n\n# ä¸ãRedis åºæ¬æ°æ®ç±»å\n\n\n\næ°æ®ç±»å     å¯ä»¥å­å¨çå¼        æä½\nSTRING   å­ç¬¦ä¸²ãæ´æ°æèæµ®ç¹æ°   å¯¹æ´ä¸ªå­ç¬¦ä¸²æèå­ç¬¦ä¸²çå¶ä¸­ä¸é¨åæ§è¡æä½\n                       å¯¹æ´æ°åæµ®ç¹æ°æ§è¡èªå¢æèèªåæä½\nLIST     åè¡¨            ä»ä¸¤ç«¯åå¥æèå¼¹åºåç´ \n                       è¯»ååä¸ªæèå¤ä¸ªåç´ \n                       è¿è¡ä¿®åªï¼åªä¿çä¸ä¸ªèå´åçåç´ \nSET      æ åºéå          æ·»å ãè·åãç§»é¤åä¸ªåç´ \n                       æ£æ¥ä¸ä¸ªåç´ æ¯å¦å­å¨äºéåä¸­\n                       è®¡ç®äº¤éãå¹¶éãå·®é\n                       ä»éåéé¢éæºè·ååç´ \nHASH     åå«é®å¼å¯¹çæ åºæ£åè¡¨   æ·»å ãè·åãç§»é¤åä¸ªé®å¼å¯¹\n                       è·åææé®å¼å¯¹\n                       æ£æ¥æä¸ªé®æ¯å¦å­å¨\nZSET     æåºéå          æ·»å ãè·åãå é¤åç´ \n                       æ ¹æ®åå¼èå´æèæåæ¥è·ååç´ \n                       è®¡ç®ä¸ä¸ªé®çæå\n\n> What Redis data structures look like\n\n\n# STRING\n\n\n**éç¨åºæ¯ï¼ç¼å­ãè®¡æ°å¨ãå±äº« Session**\n\nå½ä»¤ï¼\n\nå½ä»¤     è¡ä¸º\nGET    è·åå­å¨å¨ç»å®é®ä¸­çå¼ã\nSET    è®¾ç½®å­å¨å¨ç»å®é®ä¸­çå¼ã\nDEL    å é¤å­å¨å¨ç»å®é®ä¸­çå¼ï¼è¿ä¸ªå½ä»¤å¯ä»¥ç¨äºææç±»åï¼ã\nINCR   ä¸ºé® key å¨å­çæ°å­å¼å ä¸\nDECR   ä¸ºé® key å¨å­çæ°å­å¼åä¸\n\n> æ´å¤å½ä»¤è¯·åèï¼Redis String ç±»åå½ä»¤\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379> set hello world\nOK\n127.0.0.1:6379> get hello\n"world"\n127.0.0.1:6379> del hello\n(integer) 1\n127.0.0.1:6379> get hello\n(nil)\n\n\n\n# HASH\n\n\n**éç¨åºæ¯ï¼å­å¨ç»æåæ°æ®**ï¼å¦ä¸ä¸ªå¯¹è±¡ï¼ç¨æ·ä¿¡æ¯ãäº§åä¿¡æ¯ç­ã\n\nå½ä»¤ï¼\n\nå½ä»¤        è¡ä¸º\nHSET      å¨æ£åéé¢å³èèµ·ç»å®çé®å¼å¯¹ã\nHGET      è·åæå®æ£åé®çå¼ã\nHGETALL   è·åæ£ååå«çææé®å¼å¯¹ã\nHDEL      å¦æç»å®é®å­å¨äºæ£åéé¢ï¼é£ä¹ç§»é¤è¿ä¸ªé®ã\n\n> æ´å¤å½ä»¤è¯·åèï¼Redis Hash ç±»åå½ä»¤\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379> hset hash-key sub-key1 value1\n(integer) 1\n127.0.0.1:6379> hset hash-key sub-key2 value2\n(integer) 1\n127.0.0.1:6379> hset hash-key sub-key1 value1\n(integer) 0\n127.0.0.1:6379> hset hash-key sub-key3 value2\n(integer) 0\n127.0.0.1:6379> hgetall hash-key\n1) "sub-key1"\n2) "value1"\n3) "sub-key2"\n4) "value2"\n127.0.0.1:6379> hdel hash-key sub-key2\n(integer) 1\n127.0.0.1:6379> hdel hash-key sub-key2\n(integer) 0\n127.0.0.1:6379> hget hash-key sub-key1\n"value1"\n127.0.0.1:6379> hgetall hash-key\n1) "sub-key1"\n2) "value1"\n\n\n\n# LIST\n\n\n**éç¨åºæ¯ï¼ç¨äºå­å¨åè¡¨åæ°æ®**ãå¦ï¼ç²ä¸åè¡¨ãåååè¡¨ç­ã\n\nå½ä»¤ï¼\n\nå½ä»¤       è¡ä¸º\nLPUSH    å°ç»å®å¼æ¨å¥åè¡¨çå³ç«¯ã\nRPUSH    å°ç»å®å¼æ¨å¥åè¡¨çå³ç«¯ã\nLPOP     ä»åè¡¨çå·¦ç«¯å¼¹åºä¸ä¸ªå¼ï¼å¹¶è¿åè¢«å¼¹åºçå¼ã\nRPOP     ä»åè¡¨çå³ç«¯å¼¹åºä¸ä¸ªå¼ï¼å¹¶è¿åè¢«å¼¹åºçå¼ã\nLRANGE   è·ååè¡¨å¨ç»å®èå´ä¸çææå¼ã\nLINDEX   è·ååè¡¨å¨ç»å®ä½ç½®ä¸çåä¸ªåç´ ã\nLREM     ä»åè¡¨çå·¦ç«¯å¼¹åºä¸ä¸ªå¼ï¼å¹¶è¿åè¢«å¼¹åºçå¼ã\nLTRIM    åªä¿çæå®åºé´åçåç´ ï¼å é¤å¶ä»åç´ ã\n\n> æ´å¤å½ä»¤è¯·åèï¼Redis List ç±»åå½ä»¤\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379> rpush list-key item\n(integer) 1\n127.0.0.1:6379> rpush list-key item2\n(integer) 2\n127.0.0.1:6379> rpush list-key item\n(integer) 3\n127.0.0.1:6379> lrange list-key 0 -1\n1) "item"\n2) "item2"\n3) "item"\n127.0.0.1:6379> lindex list-key 1\n"item2"\n127.0.0.1:6379> lpop list-key\n"item"\n127.0.0.1:6379> lrange list-key 0 -1\n1) "item2"\n2) "item"\n\n\n\n# SET\n\n\n**éç¨åºæ¯ï¼ç¨äºå­å¨å»éçåè¡¨åæ°æ®**ã\n\nå½ä»¤ï¼\n\nå½ä»¤          è¡ä¸º\nSADD        å°ç»å®åç´ æ·»å å°éåã\nSMEMBERS    è¿åéååå«çææåç´ ã\nSISMEMBER   æ£æ¥ç»å®åç´ æ¯å¦å­å¨äºéåä¸­ã\nSREM        å¦æç»å®çåç´ å­å¨äºéåä¸­ï¼é£ä¹ç§»é¤è¿ä¸ªåç´ ã\n\n> æ´å¤å½ä»¤è¯·åèï¼Redis Set ç±»åå½ä»¤\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379> sadd set-key item\n(integer) 1\n127.0.0.1:6379> sadd set-key item2\n(integer) 1\n127.0.0.1:6379> sadd set-key item3\n(integer) 1\n127.0.0.1:6379> sadd set-key item\n(integer) 0\n127.0.0.1:6379> smembers set-key\n1) "item"\n2) "item2"\n3) "item3"\n127.0.0.1:6379> sismember set-key item4\n(integer) 0\n127.0.0.1:6379> sismember set-key item\n(integer) 1\n127.0.0.1:6379> srem set-key item2\n(integer) 1\n127.0.0.1:6379> srem set-key item2\n(integer) 0\n127.0.0.1:6379> smembers set-key\n1) "item"\n2) "item3"\n\n\n\n# ZSET\n\n\n\néç¨åºæ¯ï¼ç±äºå¯ä»¥è®¾ç½® scoreï¼ä¸ä¸éå¤ãéåç¨äºå­å¨åç§æè¡æ°æ®ï¼å¦ï¼æè¯åæåºçæåºååéåãææ¶é´æåºçæåºæç« éåã\n\nå½ä»¤ï¼\n\nå½ä»¤              è¡ä¸º\nZADD            å°ä¸ä¸ªå¸¦æç»å®åå¼çæåæ·»å å°æåºéåéé¢ã\nZRANGE          æ ¹æ®åç´ å¨æåºæåä¸­æå¤çä½ç½®ï¼ä»æåºéåéé¢è·åå¤ä¸ªåç´ ã\nZRANGEBYSCORE   è·åæåºéåå¨ç»å®åå¼èå´åçææåç´ ã\nZREM            å¦æç»å®æåå­å¨äºæåºéåï¼é£ä¹ç§»é¤è¿ä¸ªæåã\n\n> æ´å¤å½ä»¤è¯·åèï¼Redis ZSet ç±»åå½ä»¤\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379> zadd zset-key 728 member1\n(integer) 1\n127.0.0.1:6379> zadd zset-key 982 member0\n(integer) 1\n127.0.0.1:6379> zadd zset-key 982 member0\n(integer) 0\n\n127.0.0.1:6379> zrange zset-key 0 -1 withscores\n1) "member1"\n2) "728"\n3) "member0"\n4) "982"\n\n127.0.0.1:6379> zrangebyscore zset-key 0 800 withscores\n1) "member1"\n2) "728"\n\n127.0.0.1:6379> zrem zset-key member1\n(integer) 1\n127.0.0.1:6379> zrem zset-key member1\n(integer) 0\n127.0.0.1:6379> zrange zset-key 0 -1 withscores\n1) "member0"\n2) "982"\n\n\n\n# éç¨å½ä»¤\n\n# æåº\n\nRedis ç SORT å½ä»¤å¯ä»¥å¯¹ LISTãSETãZSET è¿è¡æåºã\n\nå½ä»¤     æè¿°\nSORT   SORT source-key [BY pattern] [LIMIT offset count] [GET\n       pattern [GET pattern ...]] [ASC | DESC] [ALPHA] [STORE\n       dest-key]âæ ¹æ®ç»å®éé¡¹ï¼å¯¹è¾å¥ LISTãSETãZSET è¿è¡æåºï¼ç¶åè¿åæå­å¨æåºçç»æã\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379[15]> RPUSH \'sort-input\' 23 15 110 7\n(integer) 4\n127.0.0.1:6379[15]> SORT \'sort-input\'\n1) "7"\n2) "15"\n3) "23"\n4) "110"\n127.0.0.1:6379[15]> SORT \'sort-input\' alpha\n1) "110"\n2) "15"\n3) "23"\n4) "7"\n127.0.0.1:6379[15]> HSET \'d-7\' \'field\' 5\n(integer) 1\n127.0.0.1:6379[15]> HSET \'d-15\' \'field\' 1\n(integer) 1\n127.0.0.1:6379[15]> HSET \'d-23\' \'field\' 9\n(integer) 1\n127.0.0.1:6379[15]> HSET \'d-110\' \'field\' 3\n(integer) 1\n127.0.0.1:6379[15]> SORT \'sort-input\' by \'d-*->field\'\n1) "15"\n2) "110"\n3) "7"\n4) "23"\n127.0.0.1:6379[15]> SORT \'sort-input\' by \'d-*->field\' get \'d-*->field\'\n1) "1"\n2) "3"\n3) "5"\n4) "9"\n\n\n# é®çè¿ææ¶é´\n\nRedis ç EXPIRE å½ä»¤å¯ä»¥æå®ä¸ä¸ªé®çè¿ææ¶é´ï¼å½è¾¾å°è¿ææ¶é´åï¼Redis ä¼èªå¨å é¤è¯¥é®ã\n\nå½ä»¤          æè¿°\nPERSIST     PERSIST key-nameâç§»é¤é®çè¿ææ¶é´\nTTL         TTL key-nameâæ¥çç»å®é®è·ç¦»è¿æè¿æå¤å°ç§\nEXPIRE      EXPIRE key-name secondsâè®©ç»å®é®å¨æå®çç§æ°ä¹åè¿æ\nEXPIREAT    EXPIREAT key-name timestampâå°ç»å®é®çè¿ææ¶é´è®¾ç½®ä¸ºç»å®ç UNIX æ¶é´æ³\nPTTL        PTTL key-nameâæ¥çç»å®é®è·ç¦»è¿ææ¶é´è¿æå¤å°æ¯«ç§ï¼è¿ä¸ªå½ä»¤å¨ Redis 2.6 æä»¥ä¸çæ¬å¯ç¨ï¼\nPEXPIRE     PEXPIRE key-name millisecondsâè®©ç»å®é®å¨æå®çæ¯«ç§æ°ä¹åè¿æï¼è¿ä¸ªå½ä»¤å¨ Redis\n            2.6 æä»¥ä¸çæ¬å¯ç¨ï¼\nPEXPIREAT   PEXPIREAT key-name timestamp-millisecondsâå°ä¸ä¸ªæ¯«ç§çº§ç²¾åº¦ç UNIX\n            æ¶é´æ³è®¾ç½®ä¸ºç»å®é®çè¿ææ¶é´ï¼è¿ä¸ªå½ä»¤å¨ Redis 2.6 æä»¥ä¸çæ¬å¯ç¨ï¼\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379[15]> SET key value\nOK\n127.0.0.1:6379[15]> GET key\n"value"\n127.0.0.1:6379[15]> EXPIRE key 2\n(integer) 1\n127.0.0.1:6379[15]> GET key\n(nil)\n\n\n\n# äºãRedis é«çº§æ°æ®ç±»å\n\n\n# BitMap\n\nBitMap å³ä½å¾ãBitMap ä¸æ¯ä¸ä¸ªçå®çæ°æ®ç»æãèæ¯ STRING ç±»åä¸çä¸ç»é¢å bit æä½çéåãç±äº STRING æ¯äºè¿å¶å®å¨ç blobï¼å¹¶ä¸å®ä»¬çæå¤§é¿åº¦æ¯ 512mï¼æä»¥ BitMap è½æå¤§è®¾ç½® $$2^{32}$$ ä¸ªä¸åç bitã\n\nBitmaps çæå¤§ä¼ç¹å°±æ¯å­å¨ä¿¡æ¯æ¶å¯ä»¥èçå¤§éçç©ºé´ãä¾å¦å¨ä¸ä¸ªç³»ç»ä¸­ï¼ä¸åçç¨æ·è¢«ä¸ä¸ªå¢é¿çç¨æ· ID è¡¨ç¤ºã40 äº¿ï¼$$2^{32}$$ = $$410241024*1024$$ â 40 äº¿ï¼ç¨æ·åªéè¦ 512M åå­å°±è½è®°ä½æç§ä¿¡æ¯ï¼ä¾å¦ç¨æ·æ¯å¦ç»å½è¿ã\n\n# BitMap å½ä»¤\n\n * SETBIT - å¯¹ key æå¨å­çå­ç¬¦ä¸²å¼ï¼è®¾ç½®ææ¸é¤æå®åç§»éä¸çä½(bit)ã\n * GETBIT - å¯¹ key æå¨å­çå­ç¬¦ä¸²å¼ï¼è·åæå®åç§»éä¸çä½(bit)ã\n * BITCOUNT - è®¡ç®ç»å®å­ç¬¦ä¸²ä¸­ï¼è¢«è®¾ç½®ä¸º 1 çæ¯ç¹ä½çæ°éã\n * BITPOS\n * BITOP\n * BITFIELD\n\n# BitMap ç¤ºä¾\n\n# å¯¹ä¸å­å¨ç key æèä¸å­å¨ç offset è¿è¡ GETBITï¼ è¿å 0\n\nredis> EXISTS bit\n(integer) 0\n\nredis> GETBIT bit 10086\n(integer) 0\n\n\n# å¯¹å·²å­å¨ç offset è¿è¡ GETBIT\n\nredis> SETBIT bit 10086 1\n(integer) 0\n\nredis> GETBIT bit 10086\n(integer) 1\n\nredis> BITCOUNT bit\n(integer) 1\n\n\n# BitMap åºç¨\n\nBitmap å¯¹äºä¸äºç¹å®ç±»åçè®¡ç®éå¸¸ææãä¾å¦ï¼ä½¿ç¨ bitmap å®ç°ç¨æ·ä¸çº¿æ¬¡æ°ç»è®¡ã\n\nåè®¾ç°å¨æä»¬å¸æè®°å½èªå·±ç½ç«ä¸çç¨æ·çä¸çº¿é¢çï¼æ¯å¦è¯´ï¼è®¡ç®ç¨æ· A ä¸çº¿äºå¤å°å¤©ï¼ç¨æ· B ä¸çº¿äºå¤å°å¤©ï¼è¯¸å¦æ­¤ç±»ï¼ä»¥æ­¤ä½ä¸ºæ°æ®ï¼ä»èå³å®è®©åªäºç¨æ·åå  beta æµè¯ç­æ´»å¨ ââ è¿ä¸ªæ¨¡å¼å¯ä»¥ä½¿ç¨ SETBIT key offset value å [BITCOUNT key start] [end] æ¥å®ç°ã\n\næ¯å¦è¯´ï¼æ¯å½ç¨æ·å¨æä¸å¤©ä¸çº¿çæ¶åï¼æä»¬å°±ä½¿ç¨ SETBIT key offset value ï¼ä»¥ç¨æ·åä½ä¸º keyï¼å°é£å¤©æä»£è¡¨çç½ç«çä¸çº¿æ¥ä½ä¸º offset åæ°ï¼å¹¶å°è¿ä¸ª offset ä¸çä¸ºè®¾ç½®ä¸º 1 ã\n\n> æ´è¯¦ç»çå®ç°å¯ä»¥åèï¼\n> \n> ä¸çå°±æç³»åä¹ è¯¦è§£ redis ç bitmap å¨äº¿çº§é¡¹ç®ä¸­çåºç¨\n> \n> Fast, easy, realtime metrics using Redis bitmaps\n\n\n# HyperLogLog\n\nHyperLogLog æ¯ç¨äºè®¡ç®å¯ä¸äºç©çæ¦çæ°æ®ç»æï¼ä»ææ¯ä¸è®²ï¼è¿è¢«ç§°ä¸ºä¼°è®¡éåçåºæ°ï¼ãå¦æç»è®¡å¯ä¸é¡¹ï¼é¡¹ç®è¶å¤ï¼éè¦çåå­å°±è¶å¤ãå ä¸ºéè¦è®°ä½è¿å»å·²ç»çè¿çé¡¹ï¼ä»èé¿åå¤æ¬¡ç»è®¡è¿äºé¡¹ã\n\n# HyperLogLog å½ä»¤\n\n * PFADD - å°ä»»ææ°éçåç´ æ·»å å°æå®ç HyperLogLog éé¢ã\n * PFCOUNT - è¿å HyperLogLog åå«çå¯ä¸åç´ çè¿ä¼¼æ°éã\n * PFMERGE - å°å¤ä¸ª HyperLogLog åå¹¶ï¼mergeï¼ä¸ºä¸ä¸ª HyperLogLog ï¼ åå¹¶åç HyperLogLog çåºæ°æ¥è¿äºææè¾å¥ HyperLogLog çå¯è§éåï¼observed setï¼çå¹¶éãåå¹¶å¾åºç HyperLogLog ä¼è¢«å¨å­å¨ destkey é®éé¢ï¼ å¦æè¯¥é®å¹¶ä¸å­å¨ï¼ é£ä¹å½ä»¤å¨æ§è¡ä¹åï¼ ä¼åä¸ºè¯¥é®åå»ºä¸ä¸ªç©ºç HyperLogLog ã\n\nç¤ºä¾ï¼\n\nredis> PFADD  databases  "Redis"  "MongoDB"  "MySQL"\n(integer) 1\n\nredis> PFCOUNT  databases\n(integer) 3\n\nredis> PFADD  databases  "Redis"    # Redis å·²ç»å­å¨ï¼ä¸å¿å¯¹ä¼°è®¡æ°éè¿è¡æ´æ°\n(integer) 0\n\nredis> PFCOUNT  databases    # åç´ ä¼°è®¡æ°éæ²¡æåå\n(integer) 3\n\nredis> PFADD  databases  "PostgreSQL"    # æ·»å ä¸ä¸ªä¸å­å¨çåç´ \n(integer) 1\n\nredis> PFCOUNT  databases    # ä¼°è®¡æ°éå¢ä¸\n4\n\n\n\n# GEO\n\nè¿ä¸ªåè½å¯ä»¥å°ç¨æ·ç»å®çå°çä½ç½®ï¼ç»åº¦åçº¬åº¦ï¼ä¿¡æ¯å¨å­èµ·æ¥ï¼å¹¶å¯¹è¿äºä¿¡æ¯è¿è¡æä½ã\n\n# GEO å½ä»¤\n\n * GEOADD - å°æå®çå°çç©ºé´ä½ç½®ï¼çº¬åº¦ãç»åº¦ãåç§°ï¼æ·»å å°æå®ç key ä¸­ã\n * GEOPOS - ä» key éè¿åææç»å®ä½ç½®åç´ çä½ç½®ï¼ç»åº¦åçº¬åº¦ï¼ã\n * GEODIST - è¿åä¸¤ä¸ªç»å®ä½ç½®ä¹é´çè·ç¦»ã\n * GEOHASH - åä¸ä¸ªæå¤ä¸ªä½ç½®åç´ çæ å Geohash å¼ï¼å®å¯ä»¥å¨http://geohash.org/ä½¿ç¨ã\n * GEORADIUS\n * GEORADIUSBYMEMBER\n\n\n# ä¸ãRedis æ°æ®ç±»ååºç¨\n\n\n# æ¡ä¾-æåæ¬¢è¿æç« \n\néåºæåæ¬¢è¿æç« ï¼éè¦æ¯æå¯¹æç« è¿è¡è¯åã\n\n# å¯¹æç« è¿è¡æç¥¨\n\nï¼1ï¼ä½¿ç¨ HASH å­å¨æç« \n\nä½¿ç¨ HASH ç±»åå­å¨æç« ä¿¡æ¯ãå¶ä¸­ï¼key æ¯æç«  IDï¼field æ¯æç« çå±æ§ keyï¼value æ¯å±æ§å¯¹åºå¼ã\n\n\n\næä½ï¼\n\n * å­å¨æç« ä¿¡æ¯ - ä½¿ç¨ HSET æ HMGET å½ä»¤\n * æ¥è¯¢æç« ä¿¡æ¯ - ä½¿ç¨ HGETALL å½ä»¤\n * æ·»å æç¥¨ - ä½¿ç¨ HINCRBY å½ä»¤\n\nï¼2ï¼ä½¿ç¨ ZSET éå¯¹ä¸åç»´åº¦éåæåº\n\nä½¿ç¨ ZSET ç±»ååå«å­å¨æç§æ¶é´æåºåæç§è¯åæåºçæç«  ID éåã\n\n\n\næä½ï¼\n\n * æ·»å è®°å½ - ä½¿ç¨ ZADD å½ä»¤\n * æ·»å åæ° - ä½¿ç¨ ZINCRBY å½ä»¤\n * ååºå¤ç¯æç«  - ä½¿ç¨ ZREVRANGE å½ä»¤\n\nï¼3ï¼ä¸ºäºé²æ­¢éå¤æç¥¨ï¼ä½¿ç¨ SET ç±»åè®°å½æ¯ç¯æç«  ID å¯¹åºçæç¥¨éåã\n\n\n\næä½ï¼\n\n * æ·»å æç¥¨è - ä½¿ç¨ SADD å½ä»¤\n * è®¾ç½®æææ - ä½¿ç¨ EXPIRE å½ä»¤\n\nï¼4ï¼åè®¾ user:115423 ç» article:100408 æç¥¨ï¼åå«éè¦é«æ´æ°è¯åæåºéåä»¥åæç¥¨éåã\n\n\n\nå½éè¦å¯¹ä¸ç¯æç« æç¥¨æ¶ï¼ç¨åºéè¦ç¨ ZSCORE å½ä»¤æ£æ¥è®°å½æç« åå¸æ¶é´çæåºéåï¼å¤æ­æç« çåå¸æ¶é´æ¯å¦è¶è¿æç¥¨æææï¼æ¯å¦ï¼ä¸ææï¼ã\n\n    public void articleVote(Jedis conn, String user, String article) {\n        // è®¡ç®æç« çæç¥¨æªæ­¢æ¶é´ã\n        long cutoff = (System.currentTimeMillis() / 1000) - ONE_WEEK_IN_SECONDS;\n\n        // æ£æ¥æ¯å¦è¿å¯ä»¥å¯¹æç« è¿è¡æç¥¨\n        // ï¼è½ç¶ä½¿ç¨æ£åä¹å¯ä»¥è·åæç« çåå¸æ¶é´ï¼\n        // ä½æåºéåè¿åçæç« åå¸æ¶é´ä¸ºæµ®ç¹æ°ï¼\n        // å¯ä»¥ä¸è¿è¡è½¬æ¢ç´æ¥ä½¿ç¨ï¼ã\n        if (conn.zscore("time:", article) < cutoff) {\n            return;\n        }\n\n        // ä»article:idæ è¯ç¬¦ï¼identifierï¼éé¢ååºæç« çIDã\n        String articleId = article.substring(article.indexOf(\':\') + 1);\n\n        // å¦æç¨æ·æ¯ç¬¬ä¸æ¬¡ä¸ºè¿ç¯æç« æç¥¨ï¼é£ä¹å¢å è¿ç¯æç« çæç¥¨æ°éåè¯åã\n        if (conn.sadd("voted:" + articleId, user) == 1) {\n            conn.zincrby("score:", VOTE_SCORE, article);\n            conn.hincrBy(article, "votes", 1);\n        }\n    }\n\n\n# åå¸å¹¶è·åæç« \n\nåå¸æç« ï¼\n\n * æ·»å æç«  - ä½¿ç¨ INCR å½ä»¤è®¡ç®æ°çæç«  IDï¼å¡«åæç« ä¿¡æ¯ï¼ç¶åç¨ HSET å½ä»¤æ HMSET å½ä»¤åå¥å° HASH ç»æä¸­ã\n * å°æç« ä½è ID æ·»å å°æç¥¨åå - ä½¿ç¨ SADD å½ä»¤æ·»å å°ä»£è¡¨æç¥¨ååç SET ç»æä¸­ã\n * è®¾ç½®æç¥¨æææ - ä½¿ç¨ EXPIRE å½ä»¤è®¾ç½®æç¥¨æææã\n\n    public String postArticle(Jedis conn, String user, String title, String link) {\n        // çæä¸ä¸ªæ°çæç« IDã\n        String articleId = String.valueOf(conn.incr("article:"));\n\n        String voted = "voted:" + articleId;\n        // å°åå¸æç« çç¨æ·æ·»å å°æç« çå·²æç¥¨ç¨æ·ååéé¢ï¼\n        conn.sadd(voted, user);\n        // ç¶åå°è¿ä¸ªååçè¿ææ¶é´è®¾ç½®ä¸ºä¸å¨ï¼ç¬¬3ç« å°å¯¹è¿ææ¶é´ä½æ´è¯¦ç»çä»ç»ï¼ã\n        conn.expire(voted, ONE_WEEK_IN_SECONDS);\n\n        long now = System.currentTimeMillis() / 1000;\n        String article = "article:" + articleId;\n        // å°æç« ä¿¡æ¯å­å¨å°ä¸ä¸ªæ£åéé¢ã\n        HashMap<String, String> articleData = new HashMap<String, String>();\n        articleData.put("title", title);\n        articleData.put("link", link);\n        articleData.put("user", user);\n        articleData.put("now", String.valueOf(now));\n        articleData.put("votes", "1");\n        conn.hmset(article, articleData);\n\n        // å°æç« æ·»å å°æ ¹æ®åå¸æ¶é´æåºçæåºéååæ ¹æ®è¯åæåºçæåºéåéé¢ã\n        conn.zadd("score:", now + VOTE_SCORE, article);\n        conn.zadd("time:", now, article);\n\n        return articleId;\n    }\n\n\nåé¡µæ¥è¯¢æåæ¬¢è¿æç« ï¼\n\nä½¿ç¨ ZINTERSTORE å½ä»¤æ ¹æ®é¡µç ãæ¯é¡µè®°å½æ°ãæåºå·ï¼æ ¹æ®è¯åå¼ä»å¤§å°å°åé¡µæ¥åºæç«  ID åè¡¨ã\n\n    public List<Map<String, String>> getArticles(Jedis conn, int page, String order) {\n        // è®¾ç½®è·åæç« çèµ·å§ç´¢å¼åç»æç´¢å¼ã\n        int start = (page - 1) * ARTICLES_PER_PAGE;\n        int end = start + ARTICLES_PER_PAGE - 1;\n\n        // è·åå¤ä¸ªæç« IDã\n        Set<String> ids = conn.zrevrange(order, start, end);\n        List<Map<String, String>> articles = new ArrayList<>();\n        // æ ¹æ®æç« IDè·åæç« çè¯¦ç»ä¿¡æ¯ã\n        for (String id : ids) {\n            Map<String, String> articleData = conn.hgetAll(id);\n            articleData.put("id", id);\n            articles.add(articleData);\n        }\n\n        return articles;\n    }\n\n\n# å¯¹æç« è¿è¡åç»\n\nå¦ææç« éè¦åç»ï¼åè½éè¦åä¸ºä¸¤åï¼\n\n * è®°å½æç« å±äºåªä¸ªç¾¤ç»\n * è´è´£ååºç¾¤ç»éçæç« \n\nå°æç« æ·»å ãå é¤ç¾¤ç»ï¼\n\n    public void addRemoveGroups(Jedis conn, String articleId, String[] toAdd, String[] toRemove) {\n        // æå»ºå­å¨æç« ä¿¡æ¯çé®åã\n        String article = "article:" + articleId;\n        // å°æç« æ·»å å°å®æå±çç¾¤ç»éé¢ã\n        for (String group : toAdd) {\n            conn.sadd("group:" + group, article);\n        }\n        // ä»ç¾¤ç»éé¢ç§»é¤æç« ã\n        for (String group : toRemove) {\n            conn.srem("group:" + group, article);\n        }\n    }\n\n\nååºç¾¤ç»éçæç« ï¼\n\n\n\n * éè¿å¯¹å­å¨ç¾¤ç»æç« çéååå­å¨æç« è¯åçæåºéåæ§è¡ ZINTERSTORE å½ä»¤ï¼å¯ä»¥å¾å°æç§æç« è¯åæåºçç¾¤ç»æç« ã\n * éè¿å¯¹å­å¨ç¾¤ç»æç« çéååå­å¨æç« åå¸æ¶é´çæåºéåæ§è¡ ZINTERSTORE å½ä»¤ï¼å¯ä»¥å¾å°æç§æç« åå¸æ¶é´æåºçç¾¤ç»æç« ã\n\n    public List<Map<String, String>> getGroupArticles(Jedis conn, String group, int page, String order) {\n        // ä¸ºæ¯ä¸ªç¾¤ç»çæ¯ç§æåé¡ºåºé½åå»ºä¸ä¸ªé®ã\n        String key = order + group;\n        // æ£æ¥æ¯å¦æå·²ç¼å­çæåºç»æï¼å¦ææ²¡æçè¯å°±ç°å¨è¿è¡æåºã\n        if (!conn.exists(key)) {\n            // æ ¹æ®è¯åæèåå¸æ¶é´ï¼å¯¹ç¾¤ç»æç« è¿è¡æåºã\n            ZParams params = new ZParams().aggregate(ZParams.Aggregate.MAX);\n            conn.zinterstore(key, params, "group:" + group, order);\n            // è®©Rediså¨60ç§éä¹åèªå¨å é¤è¿ä¸ªæåºéåã\n            conn.expire(key, 60);\n        }\n        // è°ç¨ä¹åå®ä¹çgetArticleså½æ°æ¥è¿è¡åé¡µå¹¶è·åæç« æ°æ®ã\n        return getArticles(conn, page, key);\n    }\n\n\n\n# æ¡ä¾-ç®¡çä»¤ç\n\nç½ç«ä¸è¬ä¼ä»¥ CookieãSessionãä»¤çè¿ç±»ä¿¡æ¯å­å¨ç¨æ·èº«ä»½ä¿¡æ¯ã\n\nå¯ä»¥å° Cookie/Session/ä»¤ç åç¨æ·çæ å°å³ç³»å­å¨å¨ HASH ç»æã\n\nä¸é¢ä»¥ä»¤çæ¥ä¸¾ä¾ã\n\n# æ¥è¯¢ä»¤ç\n\n    public String checkToken(Jedis conn, String token) {\n        // å°è¯è·åå¹¶è¿åä»¤çå¯¹åºçç¨æ·ã\n        return conn.hget("login:", token);\n    }\n\n\n# æ´æ°ä»¤ç\n\n * ç¨æ·æ¯æ¬¡è®¿é®é¡µé¢ï¼å¯ä»¥è®°å½ä¸ä»¤çåå½åæ¶é´æ³çæ å°å³ç³»ï¼å­å¥ä¸ä¸ª ZSET ç»æä¸­ï¼ä»¥ä¾¿åæç¨æ·æ¯å¦æ´»è·ï¼ç»§èå¯ä»¥å¨ææ§æ¸çæèçä»¤çï¼ç»è®¡å½åå¨çº¿ç¨æ·æ°ç­è¡ä¸ºã\n * ç¨æ·å¦ææ­£å¨æµè§ååï¼å¯ä»¥è®°å½å°ç¨æ·æè¿æµè§è¿çååæåºéåä¸­ï¼éåå¯ä»¥éå®æ°éï¼è¶è¿æ°éè¿è¡è£åªï¼ï¼å­å¥å°ä¸ä¸ª ZSET ç»æä¸­ï¼ä»¥ä¾¿åæç¨æ·æè¿å¯è½æå´è¶£çååï¼ä»¥ä¾¿æ¨èååã\n\n    public void updateToken(Jedis conn, String token, String user, String item) {\n        // è·åå½åæ¶é´æ³ã\n        long timestamp = System.currentTimeMillis() / 1000;\n        // ç»´æä»¤çä¸å·²ç»å½ç¨æ·ä¹é´çæ å°ã\n        conn.hset("login:", token, user);\n        // è®°å½ä»¤çæåä¸æ¬¡åºç°çæ¶é´ã\n        conn.zadd("recent:", timestamp, token);\n        if (item != null) {\n            // è®°å½ç¨æ·æµè§è¿çååã\n            conn.zadd("viewed:" + token, timestamp, item);\n            // ç§»é¤æ§çè®°å½ï¼åªä¿çç¨æ·æè¿æµè§è¿ç25ä¸ªååã\n            conn.zremrangeByRank("viewed:" + token, 0, -26);\n            conn.zincrby("viewed:", -1, item);\n        }\n    }\n\n\n# æ¸çä»¤ç\n\nä¸ä¸èæå°ï¼æ´æ°ä»¤çæ¶ï¼å°ä»¤çåå½åæ¶é´æ³çæ å°å³ç³»ï¼å­å¥ä¸ä¸ª ZSET ç»æä¸­ãæä»¥å¯ä»¥éè¿æåºå¾ç¥åªäºä»¤çæèãå¦ææ²¡ææ¸çæä½ï¼æ´æ°ä»¤çå ç¨çåå­ä¼ä¸æ­è¨èï¼ç´å°å¯¼è´æºå¨å®æºã\n\næ¯å¦ï¼æå¤åè®¸å­å¨ 1000 ä¸æ¡ä»¤çä¿¡æ¯ï¼å¨ææ§æ£æ¥ï¼ä¸æ¦åç°è®°å½æ°è¶åº 1000 ä¸æ¡ï¼å° ZSET ä»æ°å°èæåºï¼å°è¶åº 1000 ä¸æ¡çè®°å½æ¸é¤ã\n\npublic static class CleanSessionsThread extends Thread {\n\n    private Jedis conn;\n\n    private int limit;\n\n    private volatile boolean quit;\n\n    public CleanSessionsThread(int limit) {\n        this.conn = new Jedis("localhost");\n        this.conn.select(15);\n        this.limit = limit;\n    }\n\n    public void quit() {\n        quit = true;\n    }\n\n    @Override\n    public void run() {\n        while (!quit) {\n            // æ¾åºç®åå·²æä»¤ççæ°éã\n            long size = conn.zcard("recent:");\n            // ä»¤çæ°éæªè¶è¿éå¶ï¼ä¼ç å¹¶å¨ä¹åéæ°æ£æ¥ã\n            if (size <= limit) {\n                try {\n                    sleep(1000);\n                } catch (InterruptedException ie) {\n                    Thread.currentThread().interrupt();\n                }\n                continue;\n            }\n\n            // è·åéè¦ç§»é¤çä»¤çIDã\n            long endIndex = Math.min(size - limit, 100);\n            Set<String> tokenSet = conn.zrange("recent:", 0, endIndex - 1);\n            String[] tokens = tokenSet.toArray(new String[tokenSet.size()]);\n\n            // ä¸ºé£äºå°è¦è¢«å é¤çä»¤çæå»ºé®åã\n            ArrayList<String> sessionKeys = new ArrayList<String>();\n            for (String token : tokens) {\n                sessionKeys.add("viewed:" + token);\n            }\n\n            // ç§»é¤ææ§çé£äºä»¤çã\n            conn.del(sessionKeys.toArray(new String[sessionKeys.size()]));\n            conn.hdel("login:", tokens);\n            conn.zrem("recent:", tokens);\n        }\n    }\n\n}\n\n\n\n# æ¡ä¾-è´­ç©è½¦\n\nå¯ä»¥ä½¿ç¨ HASH ç»ææ¥å®ç°è´­ç©è½¦åè½ã\n\næ¯ä¸ªç¨æ·çè´­ç©è½¦ï¼å­å¨äºåå ID åååæ°éçæ å°ã\n\n# å¨è´­ç©è½¦ä¸­æ·»å ãå é¤åå\n\n    public void addToCart(Jedis conn, String session, String item, int count) {\n        if (count <= 0) {\n            // ä»è´­ç©è½¦éé¢ç§»é¤æå®çååã\n            conn.hdel("cart:" + session, item);\n        } else {\n            // å°æå®çååæ·»å å°è´­ç©è½¦ã\n            conn.hset("cart:" + session, item, String.valueOf(count));\n        }\n    }\n\n\n# æ¸ç©ºè´­ç©è½¦\n\nå¨ æ¸çä»¤ç çåºç¡ä¸ï¼æ¸ç©ºä¼è¯æ¶ï¼é¡ºä¾¿å°è´­ç©è½¦ç¼å­ä¸å¹¶æ¸çã\n\n   while (!quit) {\n        long size = conn.zcard("recent:");\n        if (size <= limit) {\n            try {\n                sleep(1000);\n            } catch (InterruptedException ie) {\n                Thread.currentThread().interrupt();\n            }\n            continue;\n        }\n\n        long endIndex = Math.min(size - limit, 100);\n        Set<String> sessionSet = conn.zrange("recent:", 0, endIndex - 1);\n        String[] sessions = sessionSet.toArray(new String[sessionSet.size()]);\n\n        ArrayList<String> sessionKeys = new ArrayList<String>();\n        for (String sess : sessions) {\n            sessionKeys.add("viewed:" + sess);\n            // æ°å¢å çè¿è¡ä»£ç ç¨äºå é¤æ§ä¼è¯å¯¹åºç¨æ·çè´­ç©è½¦ã\n            sessionKeys.add("cart:" + sess);\n        }\n\n        conn.del(sessionKeys.toArray(new String[sessionKeys.size()]));\n        conn.hdel("login:", sessions);\n        conn.zrem("recent:", sessions);\n    }\n\n\n\n# æ¡ä¾-é¡µé¢ç¼å­\n\nå¤§é¨åç½é¡µåå®¹å¹¶ä¸ä¼ç»å¸¸æ¹åï¼ä½æ¯è®¿é®æ¶ï¼åå°éè¦å¨æè®¡ç®ï¼è¿å¯è½èæ¶è¾å¤ï¼æ­¤æ¶å¯ä»¥ä½¿ç¨ STRING ç»æå­å¨é¡µé¢ç¼å­ï¼\n\n    public String cacheRequest(Jedis conn, String request, Callback callback) {\n        // å¯¹äºä¸è½è¢«ç¼å­çè¯·æ±ï¼ç´æ¥è°ç¨åè°å½æ°ã\n        if (!canCache(conn, request)) {\n            return callback != null ? callback.call(request) : null;\n        }\n\n        // å°è¯·æ±è½¬æ¢æä¸ä¸ªç®åçå­ç¬¦ä¸²é®ï¼æ¹ä¾¿ä¹åè¿è¡æ¥æ¾ã\n        String pageKey = "cache:" + hashRequest(request);\n        // å°è¯æ¥æ¾è¢«ç¼å­çé¡µé¢ã\n        String content = conn.get(pageKey);\n\n        if (content == null && callback != null) {\n            // å¦æé¡µé¢è¿æ²¡æè¢«ç¼å­ï¼é£ä¹çæé¡µé¢ã\n            content = callback.call(request);\n            // å°æ°çæçé¡µé¢æ¾å°ç¼å­éé¢ã\n            conn.setex(pageKey, 300, content);\n        }\n\n        // è¿åé¡µé¢ã\n        return content;\n    }\n\n\n\n# æ¡ä¾-æ°æ®è¡ç¼å­\n\nçµåç½ç«å¯è½ä¼æä¿éãç¹åãæ½å¥ç­æ´»å¨ï¼è¿äºæ´»å¨é¡µé¢åªéè¦ä»æ°æ®åºä¸­å è½½å è¡æ°æ®ï¼å¦ï¼ç¨æ·ä¿¡æ¯ãååä¿¡æ¯ã\n\nå¯ä»¥ä½¿ç¨ STRING ç»ææ¥ç¼å­è¿äºæ°æ®ï¼ä½¿ç¨ JSON å­å¨ç»æåçä¿¡æ¯ã\n\næ­¤å¤ï¼éè¦æä¸¤ä¸ª ZSET ç»ææ¥è®°å½æ´æ°ç¼å­çæ¶æºï¼\n\n * ç¬¬ä¸ä¸ªä¸ºè°åº¦æåºéåï¼\n * ç¬¬äºä¸ªä¸ºå»¶æ¶æåºéåã\n\nè®°å½ç¼å­æ¶æºï¼\n\n    public void scheduleRowCache(Jedis conn, String rowId, int delay) {\n        // åè®¾ç½®æ°æ®è¡çå»¶è¿å¼ã\n        conn.zadd("delay:", delay, rowId);\n        // ç«å³ç¼å­æ°æ®è¡ã\n        conn.zadd("schedule:", System.currentTimeMillis() / 1000, rowId);\n    }\n\n\nå®æ¶æ´æ°æ°æ®è¡ç¼å­ï¼\n\npublic class CacheRowsThread extends Thread {\n\n    private Jedis conn;\n\n    private boolean quit;\n\n    public CacheRowsThread() {\n        this.conn = new Jedis("localhost");\n        this.conn.select(15);\n    }\n\n    public void quit() {\n        quit = true;\n    }\n\n    @Override\n    public void run() {\n        Gson gson = new Gson();\n        while (!quit) {\n            // å°è¯è·åä¸ä¸ä¸ªéè¦è¢«ç¼å­çæ°æ®è¡ä»¥åè¯¥è¡çè°åº¦æ¶é´æ³ï¼\n            // å½ä»¤ä¼è¿åä¸ä¸ªåå«é¶ä¸ªæä¸ä¸ªåç»ï¼tupleï¼çåè¡¨ã\n            Set<Tuple> range = conn.zrangeWithScores("schedule:", 0, 0);\n            Tuple next = range.size() > 0 ? range.iterator().next() : null;\n            long now = System.currentTimeMillis() / 1000;\n            if (next == null || next.getScore() > now) {\n                try {\n                    // ææ¶æ²¡æè¡éè¦è¢«ç¼å­ï¼ä¼ç 50æ¯«ç§åéè¯ã\n                    sleep(50);\n                } catch (InterruptedException ie) {\n                    Thread.currentThread().interrupt();\n                }\n                continue;\n            }\n\n            String rowId = next.getElement();\n            // è·åä¸ä¸æ¬¡è°åº¦åçå»¶è¿æ¶é´ã\n            double delay = conn.zscore("delay:", rowId);\n            if (delay <= 0) {\n                // ä¸å¿åç¼å­è¿ä¸ªè¡ï¼å°å®ä»ç¼å­ä¸­ç§»é¤ã\n                conn.zrem("delay:", rowId);\n                conn.zrem("schedule:", rowId);\n                conn.del("inv:" + rowId);\n                continue;\n            }\n\n            // è¯»åæ°æ®è¡ã\n            Inventory row = Inventory.get(rowId);\n            // æ´æ°è°åº¦æ¶é´å¹¶è®¾ç½®ç¼å­å¼ã\n            conn.zadd("schedule:", now + delay, rowId);\n            conn.set("inv:" + rowId, gson.toJson(row));\n        }\n    }\n\n}\n\n\n\n# æ¡ä¾-ç½é¡µåæ\n\nç½ç«å¯ä»¥ééç¨æ·çè®¿é®ãäº¤äºãè´­ä¹°è¡ä¸ºï¼ååæç¨æ·ä¹ æ¯ãåå¥½ï¼ä»èå¤æ­å¸åºè¡æåæ½å¨åæºç­ã\n\né£ä¹ï¼ç®åçï¼å¦ä½è®°å½ç¨æ·å¨ä¸å®æ¶é´åè®¿é®çååé¡µé¢å¢ï¼\n\nåè æ´æ°ä»¤ç ä»£ç ç¤ºä¾ï¼è®°å½ç¨æ·è®¿é®ä¸åååçæµè§æ¬¡æ°ï¼å¹¶æåºã\n\nå¤æ­é¡µé¢æ¯å¦éè¦ç¼å­ï¼æ ¹æ®è¯åå¤æ­ååé¡µé¢æ¯å¦ç­é¨ï¼\n\n    public boolean canCache(Jedis conn, String request) {\n        try {\n            URL url = new URL(request);\n            HashMap<String, String> params = new HashMap<>();\n            if (url.getQuery() != null) {\n                for (String param : url.getQuery().split("&")) {\n                    String[] pair = param.split("=", 2);\n                    params.put(pair[0], pair.length == 2 ? pair[1] : null);\n                }\n            }\n\n            // å°è¯ä»é¡µé¢éé¢ååºååIDã\n            String itemId = extractItemId(params);\n            // æ£æ¥è¿ä¸ªé¡µé¢è½å¦è¢«ç¼å­ä»¥åè¿ä¸ªé¡µé¢æ¯å¦ä¸ºååé¡µé¢ã\n            if (itemId == null || isDynamic(params)) {\n                return false;\n            }\n            // åå¾ååçæµè§æ¬¡æ°æåã\n            Long rank = conn.zrank("viewed:", itemId);\n            // æ ¹æ®ååçæµè§æ¬¡æ°æåæ¥å¤æ­æ¯å¦éè¦ç¼å­è¿ä¸ªé¡µé¢ã\n            return rank != null && rank < 10000;\n        } catch (MalformedURLException mue) {\n            return false;\n        }\n    }\n\n\n\n# æ¡ä¾-è®°å½æ¥å¿\n\nå¯ç¨ä½¿ç¨ LIST ç»æå­å¨æ¥å¿æ°æ®ã\n\n    public void logRecent(Jedis conn, String name, String message, String severity) {\n        String destination = "recent:" + name + \':\' + severity;\n        Pipeline pipe = conn.pipelined();\n        pipe.lpush(destination, TIMESTAMP.format(new Date()) + \' \' + message);\n        pipe.ltrim(destination, 0, 99);\n        pipe.sync();\n    }\n\n\n\n# æ¡ä¾-ç»è®¡æ°æ®\n\næ´æ°è®¡æ°å¨ï¼\n\n    public static final int[] PRECISION = new int[] { 1, 5, 60, 300, 3600, 18000, 86400 };\n\n    public void updateCounter(Jedis conn, String name, int count, long now) {\n        Transaction trans = conn.multi();\n        for (int prec : PRECISION) {\n            long pnow = (now / prec) * prec;\n            String hash = String.valueOf(prec) + \':\' + name;\n            trans.zadd("known:", 0, hash);\n            trans.hincrBy("count:" + hash, String.valueOf(pnow), count);\n        }\n        trans.exec();\n    }\n\n\næ¥çè®¡æ°å¨æ°æ®ï¼\n\n    public List<Pair<Integer>> getCounter(\n        Jedis conn, String name, int precision) {\n        String hash = String.valueOf(precision) + \':\' + name;\n        Map<String, String> data = conn.hgetAll("count:" + hash);\n        List<Pair<Integer>> results = new ArrayList<>();\n        for (Map.Entry<String, String> entry : data.entrySet()) {\n            results.add(new Pair<>(\n                entry.getKey(),\n                Integer.parseInt(entry.getValue())));\n        }\n        Collections.sort(results);\n        return results;\n    }\n\n\n\n# æ¡ä¾-æ¥æ¾ IP æå±å°\n\nRedis å®ç°ç IP æå±å°æ¥æ¾æ¯å³ç³»åæ°æ®å®ç°æ¹å¼æ´å¿«ã\n\n# è½½å¥ IP æ°æ®\n\nIP å°åè½¬ä¸ºæ´æ°å¼ï¼\n\n    public int ipToScore(String ipAddress) {\n        int score = 0;\n        for (String v : ipAddress.split("\\\\.")) {\n            score = score * 256 + Integer.parseInt(v, 10);\n        }\n        return score;\n    }\n\n\nåå»º IP å°åä¸åå¸ ID ä¹é´çæ å°ï¼\n\n    public void importIpsToRedis(Jedis conn, File file) {\n        FileReader reader = null;\n        try {\n            // è½½å¥ csv æä»¶æ°æ®\n            reader = new FileReader(file);\n            CSVFormat csvFormat = CSVFormat.DEFAULT.withRecordSeparator("\\n");\n            CSVParser csvParser = csvFormat.parse(reader);\n            int count = 0;\n            List<CSVRecord> records = csvParser.getRecords();\n            for (CSVRecord line : records) {\n                String startIp = line.get(0);\n                if (startIp.toLowerCase().indexOf(\'i\') != -1) {\n                    continue;\n                }\n                // å° IP å°åè½¬ä¸ºæ´æ°å¼\n                int score = 0;\n                if (startIp.indexOf(\'.\') != -1) {\n                    score = ipToScore(startIp);\n                } else {\n                    try {\n                        score = Integer.parseInt(startIp, 10);\n                    } catch (NumberFormatException nfe) {\n                        // ç¥è¿æä»¶çç¬¬ä¸è¡ä»¥åæ ¼å¼ä¸æ­£ç¡®çæ¡ç®\n                        continue;\n                    }\n                }\n\n                // æå»ºå¯ä¸çåå¸ ID\n                String cityId = line.get(2) + \'_\' + count;\n                // å°åå¸ ID åå¶å¯¹åºç IP å°åæ´æ°å¼æ·»å å° ZSET\n                conn.zadd("ip2cityid:", score, cityId);\n                count++;\n            }\n        } catch (Exception e) {\n            throw new RuntimeException(e);\n        } finally {\n            try {\n                reader.close();\n            } catch (Exception e) {\n                // ignore\n            }\n        }\n    }\n\n\nå­å¨åå¸ä¿¡æ¯ï¼\n\n    public void importCitiesToRedis(Jedis conn, File file) {\n        Gson gson = new Gson();\n        FileReader reader = null;\n        try {\n            // å è½½ csv ä¿¡æ¯\n            reader = new FileReader(file);\n            CSVFormat csvFormat = CSVFormat.DEFAULT.withRecordSeparator("\\n");\n            CSVParser parser = new CSVParser(reader, csvFormat);\n            // String[] line;\n            List<CSVRecord> records = parser.getRecords();\n            for (CSVRecord record : records) {\n\n                if (record.size() < 4 || !Character.isDigit(record.get(0).charAt(0))) {\n                    continue;\n                }\n\n                // å°åå¸å°çä¿¡æ¯è½¬ä¸º json ç»æï¼å­å¥ HASH ç»æä¸­\n                String cityId = record.get(0);\n                String country = record.get(1);\n                String region = record.get(2);\n                String city = record.get(3);\n                String json = gson.toJson(new String[] { city, region, country });\n                conn.hset("cityid2city:", cityId, json);\n            }\n        } catch (Exception e) {\n            throw new RuntimeException(e);\n        } finally {\n            try {\n                reader.close();\n            } catch (Exception e) {\n                // ignore\n            }\n        }\n    }\n\n\n# æ¥æ¾ IP æå±åå¸\n\næä½æ­¥éª¤ï¼\n\n 1. å°è¦æ¥æ¾ç IP å°åè½¬ä¸ºæ´æ°å¼ï¼\n 2. æ¥æ¾ææåå¼å°äºç­äºè¦æ¥æ¾ç IP å°åçå°åï¼ååºå¶ä¸­æå¤§åå¼çé£ä¸ªè®°å½ï¼\n 3. ç¨æ¾å°çè®°å½æå¯¹åºçåå¸ ID å»æ£ç´¢åå¸ä¿¡æ¯ã\n\n    public String[] findCityByIp(Jedis conn, String ipAddress) {\n        int score = ipToScore(ipAddress);\n        Set<String> results = conn.zrevrangeByScore("ip2cityid:", score, 0, 0, 1);\n        if (results.size() == 0) {\n            return null;\n        }\n\n        String cityId = results.iterator().next();\n        cityId = cityId.substring(0, cityId.indexOf(\'_\'));\n        return new Gson().fromJson(conn.hget("cityid2city:", cityId), String[].class);\n    }\n\n\n\n# æ¡ä¾-æå¡çåç°ä¸éç½®\n\n\n# æ¡ä¾-èªå¨è¡¥å¨\n\néæ±ï¼æ ¹æ®ç¨æ·è¾å¥ï¼èªå¨è¡¥å¨ä¿¡æ¯ï¼å¦ï¼èç³»äººãåååç­ã\n\n * å¸ååºæ¯ä¸ï¼ç¤¾äº¤ç½ç«åå°è®°å½ç¨æ·æè¿èç³»è¿ç 100 ä¸ªå¥½åï¼å½ç¨æ·æ¥æ¾å¥½åæ¶ï¼æ ¹æ®è¾å¥çå³é®å­èªå¨è¡¥å¨å§åã\n * å¸ååºæ¯äºï¼çµåç½ç«åå°è®°å½ç¨æ·æè¿æµè§è¿ç 10 ä»¶ååï¼å½ç¨æ·æ¥æ¾ååæ¯ï¼æ ¹æ®è¾å¥çå³é®å­èªå¨è¡¥å¨åååç§°ã\n\næ°æ®æ¨¡åï¼ä½¿ç¨ Redis ç LIST ç±»åå­å¨æè¿èç³»äººåè¡¨ã\n\næå»ºèªå¨è¡¥å¨åè¡¨éå¸¸æä»¥ä¸æä½ï¼\n\n * å¦ææå®èç³»äººå·²ç»å­å¨äºæè¿èç³»äººåè¡¨éï¼é£ä¹ä»åè¡¨éç§»é¤ä»ãå¯¹åº LREM å½ä»¤ã\n * å°æå®èç³»äººæ·»å å°æè¿èç³»äººåè¡¨çæåé¢ãå¯¹åº LPUSH å½ä»¤ã\n * æ·»å æä½å®æåï¼å¦æèç³»äººåè¡¨ä¸­çæ°éè¶è¿ 100 ä¸ªï¼è¿è¡è£åªæä½ãå¯¹åº LTRIM å½ä»¤ã\n\n\n# æ¡ä¾-å¹¿åå®å\n\n\n# æ¡ä¾-èä½æç´¢\n\néæ±ï¼å¨ä¸ä¸ªæèç½ç«ä¸ï¼æ±èèæèªå·±çæè½æ¸åï¼ç¨äººå¬å¸çèä½æå¿è¦çæè½æ¸åãç¨äººå¬å¸éè¦æ¥è¯¢æ»¡è¶³èªå·±èä½è¦æ±çæ±èèï¼æ±èèéè¦æ¥è¯¢èªå·±å¯ä»¥æéç®åçèä½ã\n\nå³é®æ°æ®æ¨¡åï¼ä½¿ç¨ SET ç±»åå­å¨æ±èèçæè½åè¡¨ï¼ä½¿ç¨ SET ç±»åå­å¨èä½çæè½åè¡¨ã\n\nå³é®æä½ï¼ä½¿ç¨ SDIFF å½ä»¤å¯¹æ¯ä¸¤ä¸ª SET çå·®å¼ï¼è¿å empty è¡¨ç¤ºå¹éè¦æ±ã\n\nredis cli ç¤ºä¾ï¼\n\n# -----------------------------------------------------------\n# Redis èä½æç´¢æ°æ®æ¨¡åç¤ºä¾\n# -----------------------------------------------------------\n\n# ï¼1ï¼èä½æè½è¡¨ï¼ä½¿ç¨ set å­å¨\n# job:001 èä½æ·»å  4 ç§æè½\nSADD job:001 skill:001\nSADD job:001 skill:002\nSADD job:001 skill:003\nSADD job:001 skill:004\n\n# job:002 èä½æ·»å  3 ç§æè½\nSADD job:002 skill:001\nSADD job:002 skill:002\nSADD job:002 skill:003\n\n# job:003 èä½æ·»å  2 ç§æè½\nSADD job:003 skill:001\nSADD job:003 skill:003\n\n# æ¥ç\nSMEMBERS job:001\nSMEMBERS job:002\nSMEMBERS job:003\n\n# ï¼2ï¼æ±èèæè½è¡¨ï¼ä½¿ç¨ set å­å¨\nSADD interviewee:001 skill:001\nSADD interviewee:001 skill:003\n\nSADD interviewee:002 skill:001\nSADD interviewee:002 skill:002\nSADD interviewee:002 skill:003\nSADD interviewee:002 skill:004\nSADD interviewee:002 skill:005\n\n# æ¥ç\nSMEMBERS interviewee:001\nSMEMBERS interviewee:002\n\n# ï¼3ï¼æ±èèéåæ¥æ¾èªå·±ç¬¦åè¦æ±çèä½ï¼è¿åç»æä¸º empty è¡¨ç¤ºè¦æ±çæè½å¨é¨å½ä¸­ï¼\n# æ¯è¾èä½æè½æ¸ååæ±èèæè½æ¸åçå·®å¼\nSDIFF job:001 interviewee:001\nSDIFF job:002 interviewee:001\nSDIFF job:003 interviewee:001\n\nSDIFF job:001 interviewee:002\nSDIFF job:002 interviewee:002\nSDIFF job:003 interviewee:002\n\n# ï¼4ï¼ç¨äººå¬å¸æ ¹æ®éåæ¥æ¾ç¬¦åèªå·±èä½è¦æ±çæ±èèï¼è¿åç»æä¸º empty è¡¨ç¤ºè¦æ±çæè½å¨é¨å½ä¸­ï¼\n# æ¯è¾èä½æè½æ¸ååæ±èèæè½æ¸åçå·®å¼\nSDIFF interviewee:001 job:001\nSDIFF interviewee:002 job:001\n\nSDIFF interviewee:001 job:002\nSDIFF interviewee:002 job:002\n\nSDIFF interviewee:001 job:003\nSDIFF interviewee:002 job:003\n\n\n\n# åèèµæ\n\n * å®ç½\n   * Redis å®ç½\n   * Redis github\n   * Redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãRedis å®æã\n   * ãRedis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * Redis å½ä»¤åè\n * æç« \n   * ä¸çå°±æç³»åä¹ è¯¦è§£ redis ç bitmap å¨äº¿çº§é¡¹ç®ä¸­çåºç¨\n   * Fast, easy, realtime metrics using Redis bitmaps',normalizedContent:'# redis æ°æ®ç±»åååºç¨\n\n> redis æä¾äºå¤ç§æ°æ®ç±»åï¼æ¯ç§æ°æ®ç±»åæä¸°å¯çå½ä»¤æ¯æã\n> \n> ä½¿ç¨ redis ï¼ä¸ä»è¦äºè§£å¶æ°æ®ç±»åçç¹æ§ï¼è¿éè¦æ ¹æ®ä¸å¡åºæ¯ï¼çµæ´»çãé«æçä½¿ç¨å¶æ°æ®ç±»åæ¥å»ºæ¨¡ã\n\n\n# ä¸ãredis åºæ¬æ°æ®ç±»å\n\n\n\næ°æ®ç±»å     å¯ä»¥å­å¨çå¼        æä½\nstring   å­ç¬¦ä¸²ãæ´æ°æèæµ®ç¹æ°   å¯¹æ´ä¸ªå­ç¬¦ä¸²æèå­ç¬¦ä¸²çå¶ä¸­ä¸é¨åæ§è¡æä½\n                       å¯¹æ´æ°åæµ®ç¹æ°æ§è¡èªå¢æèèªåæä½\nlist     åè¡¨            ä»ä¸¤ç«¯åå¥æèå¼¹åºåç´ \n                       è¯»ååä¸ªæèå¤ä¸ªåç´ \n                       è¿è¡ä¿®åªï¼åªä¿çä¸ä¸ªèå´åçåç´ \nset      æ åºéå          æ·»å ãè·åãç§»é¤åä¸ªåç´ \n                       æ£æ¥ä¸ä¸ªåç´ æ¯å¦å­å¨äºéåä¸­\n                       è®¡ç®äº¤éãå¹¶éãå·®é\n                       ä»éåéé¢éæºè·ååç´ \nhash     åå«é®å¼å¯¹çæ åºæ£åè¡¨   æ·»å ãè·åãç§»é¤åä¸ªé®å¼å¯¹\n                       è·åææé®å¼å¯¹\n                       æ£æ¥æä¸ªé®æ¯å¦å­å¨\nzset     æåºéå          æ·»å ãè·åãå é¤åç´ \n                       æ ¹æ®åå¼èå´æèæåæ¥è·ååç´ \n                       è®¡ç®ä¸ä¸ªé®çæå\n\n> what redis data structures look like\n\n\n# string\n\n\n**éç¨åºæ¯ï¼ç¼å­ãè®¡æ°å¨ãå±äº« session**\n\nå½ä»¤ï¼\n\nå½ä»¤     è¡ä¸º\nget    è·åå­å¨å¨ç»å®é®ä¸­çå¼ã\nset    è®¾ç½®å­å¨å¨ç»å®é®ä¸­çå¼ã\ndel    å é¤å­å¨å¨ç»å®é®ä¸­çå¼ï¼è¿ä¸ªå½ä»¤å¯ä»¥ç¨äºææç±»åï¼ã\nincr   ä¸ºé® key å¨å­çæ°å­å¼å ä¸\ndecr   ä¸ºé® key å¨å­çæ°å­å¼åä¸\n\n> æ´å¤å½ä»¤è¯·åèï¼redis string ç±»åå½ä»¤\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379> set hello world\nok\n127.0.0.1:6379> get hello\n"world"\n127.0.0.1:6379> del hello\n(integer) 1\n127.0.0.1:6379> get hello\n(nil)\n\n\n\n# hash\n\n\n**éç¨åºæ¯ï¼å­å¨ç»æåæ°æ®**ï¼å¦ä¸ä¸ªå¯¹è±¡ï¼ç¨æ·ä¿¡æ¯ãäº§åä¿¡æ¯ç­ã\n\nå½ä»¤ï¼\n\nå½ä»¤        è¡ä¸º\nhset      å¨æ£åéé¢å³èèµ·ç»å®çé®å¼å¯¹ã\nhget      è·åæå®æ£åé®çå¼ã\nhgetall   è·åæ£ååå«çææé®å¼å¯¹ã\nhdel      å¦æç»å®é®å­å¨äºæ£åéé¢ï¼é£ä¹ç§»é¤è¿ä¸ªé®ã\n\n> æ´å¤å½ä»¤è¯·åèï¼redis hash ç±»åå½ä»¤\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379> hset hash-key sub-key1 value1\n(integer) 1\n127.0.0.1:6379> hset hash-key sub-key2 value2\n(integer) 1\n127.0.0.1:6379> hset hash-key sub-key1 value1\n(integer) 0\n127.0.0.1:6379> hset hash-key sub-key3 value2\n(integer) 0\n127.0.0.1:6379> hgetall hash-key\n1) "sub-key1"\n2) "value1"\n3) "sub-key2"\n4) "value2"\n127.0.0.1:6379> hdel hash-key sub-key2\n(integer) 1\n127.0.0.1:6379> hdel hash-key sub-key2\n(integer) 0\n127.0.0.1:6379> hget hash-key sub-key1\n"value1"\n127.0.0.1:6379> hgetall hash-key\n1) "sub-key1"\n2) "value1"\n\n\n\n# list\n\n\n**éç¨åºæ¯ï¼ç¨äºå­å¨åè¡¨åæ°æ®**ãå¦ï¼ç²ä¸åè¡¨ãåååè¡¨ç­ã\n\nå½ä»¤ï¼\n\nå½ä»¤       è¡ä¸º\nlpush    å°ç»å®å¼æ¨å¥åè¡¨çå³ç«¯ã\nrpush    å°ç»å®å¼æ¨å¥åè¡¨çå³ç«¯ã\nlpop     ä»åè¡¨çå·¦ç«¯å¼¹åºä¸ä¸ªå¼ï¼å¹¶è¿åè¢«å¼¹åºçå¼ã\nrpop     ä»åè¡¨çå³ç«¯å¼¹åºä¸ä¸ªå¼ï¼å¹¶è¿åè¢«å¼¹åºçå¼ã\nlrange   è·ååè¡¨å¨ç»å®èå´ä¸çææå¼ã\nlindex   è·ååè¡¨å¨ç»å®ä½ç½®ä¸çåä¸ªåç´ ã\nlrem     ä»åè¡¨çå·¦ç«¯å¼¹åºä¸ä¸ªå¼ï¼å¹¶è¿åè¢«å¼¹åºçå¼ã\nltrim    åªä¿çæå®åºé´åçåç´ ï¼å é¤å¶ä»åç´ ã\n\n> æ´å¤å½ä»¤è¯·åèï¼redis list ç±»åå½ä»¤\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379> rpush list-key item\n(integer) 1\n127.0.0.1:6379> rpush list-key item2\n(integer) 2\n127.0.0.1:6379> rpush list-key item\n(integer) 3\n127.0.0.1:6379> lrange list-key 0 -1\n1) "item"\n2) "item2"\n3) "item"\n127.0.0.1:6379> lindex list-key 1\n"item2"\n127.0.0.1:6379> lpop list-key\n"item"\n127.0.0.1:6379> lrange list-key 0 -1\n1) "item2"\n2) "item"\n\n\n\n# set\n\n\n**éç¨åºæ¯ï¼ç¨äºå­å¨å»éçåè¡¨åæ°æ®**ã\n\nå½ä»¤ï¼\n\nå½ä»¤          è¡ä¸º\nsadd        å°ç»å®åç´ æ·»å å°éåã\nsmembers    è¿åéååå«çææåç´ ã\nsismember   æ£æ¥ç»å®åç´ æ¯å¦å­å¨äºéåä¸­ã\nsrem        å¦æç»å®çåç´ å­å¨äºéåä¸­ï¼é£ä¹ç§»é¤è¿ä¸ªåç´ ã\n\n> æ´å¤å½ä»¤è¯·åèï¼redis set ç±»åå½ä»¤\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379> sadd set-key item\n(integer) 1\n127.0.0.1:6379> sadd set-key item2\n(integer) 1\n127.0.0.1:6379> sadd set-key item3\n(integer) 1\n127.0.0.1:6379> sadd set-key item\n(integer) 0\n127.0.0.1:6379> smembers set-key\n1) "item"\n2) "item2"\n3) "item3"\n127.0.0.1:6379> sismember set-key item4\n(integer) 0\n127.0.0.1:6379> sismember set-key item\n(integer) 1\n127.0.0.1:6379> srem set-key item2\n(integer) 1\n127.0.0.1:6379> srem set-key item2\n(integer) 0\n127.0.0.1:6379> smembers set-key\n1) "item"\n2) "item3"\n\n\n\n# zset\n\n\n\néç¨åºæ¯ï¼ç±äºå¯ä»¥è®¾ç½® scoreï¼ä¸ä¸éå¤ãéåç¨äºå­å¨åç§æè¡æ°æ®ï¼å¦ï¼æè¯åæåºçæåºååéåãææ¶é´æåºçæåºæç« éåã\n\nå½ä»¤ï¼\n\nå½ä»¤              è¡ä¸º\nzadd            å°ä¸ä¸ªå¸¦æç»å®åå¼çæåæ·»å å°æåºéåéé¢ã\nzrange          æ ¹æ®åç´ å¨æåºæåä¸­æå¤çä½ç½®ï¼ä»æåºéåéé¢è·åå¤ä¸ªåç´ ã\nzrangebyscore   è·åæåºéåå¨ç»å®åå¼èå´åçææåç´ ã\nzrem            å¦æç»å®æåå­å¨äºæåºéåï¼é£ä¹ç§»é¤è¿ä¸ªæåã\n\n> æ´å¤å½ä»¤è¯·åèï¼redis zset ç±»åå½ä»¤\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379> zadd zset-key 728 member1\n(integer) 1\n127.0.0.1:6379> zadd zset-key 982 member0\n(integer) 1\n127.0.0.1:6379> zadd zset-key 982 member0\n(integer) 0\n\n127.0.0.1:6379> zrange zset-key 0 -1 withscores\n1) "member1"\n2) "728"\n3) "member0"\n4) "982"\n\n127.0.0.1:6379> zrangebyscore zset-key 0 800 withscores\n1) "member1"\n2) "728"\n\n127.0.0.1:6379> zrem zset-key member1\n(integer) 1\n127.0.0.1:6379> zrem zset-key member1\n(integer) 0\n127.0.0.1:6379> zrange zset-key 0 -1 withscores\n1) "member0"\n2) "982"\n\n\n\n# éç¨å½ä»¤\n\n# æåº\n\nredis ç sort å½ä»¤å¯ä»¥å¯¹ listãsetãzset è¿è¡æåºã\n\nå½ä»¤     æè¿°\nsort   sort source-key [by pattern] [limit offset count] [get\n       pattern [get pattern ...]] [asc | desc] [alpha] [store\n       dest-key]âæ ¹æ®ç»å®éé¡¹ï¼å¯¹è¾å¥ listãsetãzset è¿è¡æåºï¼ç¶åè¿åæå­å¨æåºçç»æã\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379[15]> rpush \'sort-input\' 23 15 110 7\n(integer) 4\n127.0.0.1:6379[15]> sort \'sort-input\'\n1) "7"\n2) "15"\n3) "23"\n4) "110"\n127.0.0.1:6379[15]> sort \'sort-input\' alpha\n1) "110"\n2) "15"\n3) "23"\n4) "7"\n127.0.0.1:6379[15]> hset \'d-7\' \'field\' 5\n(integer) 1\n127.0.0.1:6379[15]> hset \'d-15\' \'field\' 1\n(integer) 1\n127.0.0.1:6379[15]> hset \'d-23\' \'field\' 9\n(integer) 1\n127.0.0.1:6379[15]> hset \'d-110\' \'field\' 3\n(integer) 1\n127.0.0.1:6379[15]> sort \'sort-input\' by \'d-*->field\'\n1) "15"\n2) "110"\n3) "7"\n4) "23"\n127.0.0.1:6379[15]> sort \'sort-input\' by \'d-*->field\' get \'d-*->field\'\n1) "1"\n2) "3"\n3) "5"\n4) "9"\n\n\n# é®çè¿ææ¶é´\n\nredis ç expire å½ä»¤å¯ä»¥æå®ä¸ä¸ªé®çè¿ææ¶é´ï¼å½è¾¾å°è¿ææ¶é´åï¼redis ä¼èªå¨å é¤è¯¥é®ã\n\nå½ä»¤          æè¿°\npersist     persist key-nameâç§»é¤é®çè¿ææ¶é´\nttl         ttl key-nameâæ¥çç»å®é®è·ç¦»è¿æè¿æå¤å°ç§\nexpire      expire key-name secondsâè®©ç»å®é®å¨æå®çç§æ°ä¹åè¿æ\nexpireat    expireat key-name timestampâå°ç»å®é®çè¿ææ¶é´è®¾ç½®ä¸ºç»å®ç unix æ¶é´æ³\npttl        pttl key-nameâæ¥çç»å®é®è·ç¦»è¿ææ¶é´è¿æå¤å°æ¯«ç§ï¼è¿ä¸ªå½ä»¤å¨ redis 2.6 æä»¥ä¸çæ¬å¯ç¨ï¼\npexpire     pexpire key-name millisecondsâè®©ç»å®é®å¨æå®çæ¯«ç§æ°ä¹åè¿æï¼è¿ä¸ªå½ä»¤å¨ redis\n            2.6 æä»¥ä¸çæ¬å¯ç¨ï¼\npexpireat   pexpireat key-name timestamp-millisecondsâå°ä¸ä¸ªæ¯«ç§çº§ç²¾åº¦ç unix\n            æ¶é´æ³è®¾ç½®ä¸ºç»å®é®çè¿ææ¶é´ï¼è¿ä¸ªå½ä»¤å¨ redis 2.6 æä»¥ä¸çæ¬å¯ç¨ï¼\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379[15]> set key value\nok\n127.0.0.1:6379[15]> get key\n"value"\n127.0.0.1:6379[15]> expire key 2\n(integer) 1\n127.0.0.1:6379[15]> get key\n(nil)\n\n\n\n# äºãredis é«çº§æ°æ®ç±»å\n\n\n# bitmap\n\nbitmap å³ä½å¾ãbitmap ä¸æ¯ä¸ä¸ªçå®çæ°æ®ç»æãèæ¯ string ç±»åä¸çä¸ç»é¢å bit æä½çéåãç±äº string æ¯äºè¿å¶å®å¨ç blobï¼å¹¶ä¸å®ä»¬çæå¤§é¿åº¦æ¯ 512mï¼æä»¥ bitmap è½æå¤§è®¾ç½® $$2^{32}$$ ä¸ªä¸åç bitã\n\nbitmaps çæå¤§ä¼ç¹å°±æ¯å­å¨ä¿¡æ¯æ¶å¯ä»¥èçå¤§éçç©ºé´ãä¾å¦å¨ä¸ä¸ªç³»ç»ä¸­ï¼ä¸åçç¨æ·è¢«ä¸ä¸ªå¢é¿çç¨æ· id è¡¨ç¤ºã40 äº¿ï¼$$2^{32}$$ = $$410241024*1024$$ â 40 äº¿ï¼ç¨æ·åªéè¦ 512m åå­å°±è½è®°ä½æç§ä¿¡æ¯ï¼ä¾å¦ç¨æ·æ¯å¦ç»å½è¿ã\n\n# bitmap å½ä»¤\n\n * setbit - å¯¹ key æå¨å­çå­ç¬¦ä¸²å¼ï¼è®¾ç½®ææ¸é¤æå®åç§»éä¸çä½(bit)ã\n * getbit - å¯¹ key æå¨å­çå­ç¬¦ä¸²å¼ï¼è·åæå®åç§»éä¸çä½(bit)ã\n * bitcount - è®¡ç®ç»å®å­ç¬¦ä¸²ä¸­ï¼è¢«è®¾ç½®ä¸º 1 çæ¯ç¹ä½çæ°éã\n * bitpos\n * bitop\n * bitfield\n\n# bitmap ç¤ºä¾\n\n# å¯¹ä¸å­å¨ç key æèä¸å­å¨ç offset è¿è¡ getbitï¼ è¿å 0\n\nredis> exists bit\n(integer) 0\n\nredis> getbit bit 10086\n(integer) 0\n\n\n# å¯¹å·²å­å¨ç offset è¿è¡ getbit\n\nredis> setbit bit 10086 1\n(integer) 0\n\nredis> getbit bit 10086\n(integer) 1\n\nredis> bitcount bit\n(integer) 1\n\n\n# bitmap åºç¨\n\nbitmap å¯¹äºä¸äºç¹å®ç±»åçè®¡ç®éå¸¸ææãä¾å¦ï¼ä½¿ç¨ bitmap å®ç°ç¨æ·ä¸çº¿æ¬¡æ°ç»è®¡ã\n\nåè®¾ç°å¨æä»¬å¸æè®°å½èªå·±ç½ç«ä¸çç¨æ·çä¸çº¿é¢çï¼æ¯å¦è¯´ï¼è®¡ç®ç¨æ· a ä¸çº¿äºå¤å°å¤©ï¼ç¨æ· b ä¸çº¿äºå¤å°å¤©ï¼è¯¸å¦æ­¤ç±»ï¼ä»¥æ­¤ä½ä¸ºæ°æ®ï¼ä»èå³å®è®©åªäºç¨æ·åå  beta æµè¯ç­æ´»å¨ ââ è¿ä¸ªæ¨¡å¼å¯ä»¥ä½¿ç¨ setbit key offset value å [bitcount key start] [end] æ¥å®ç°ã\n\næ¯å¦è¯´ï¼æ¯å½ç¨æ·å¨æä¸å¤©ä¸çº¿çæ¶åï¼æä»¬å°±ä½¿ç¨ setbit key offset value ï¼ä»¥ç¨æ·åä½ä¸º keyï¼å°é£å¤©æä»£è¡¨çç½ç«çä¸çº¿æ¥ä½ä¸º offset åæ°ï¼å¹¶å°è¿ä¸ª offset ä¸çä¸ºè®¾ç½®ä¸º 1 ã\n\n> æ´è¯¦ç»çå®ç°å¯ä»¥åèï¼\n> \n> ä¸çå°±æç³»åä¹ è¯¦è§£ redis ç bitmap å¨äº¿çº§é¡¹ç®ä¸­çåºç¨\n> \n> fast, easy, realtime metrics using redis bitmaps\n\n\n# hyperloglog\n\nhyperloglog æ¯ç¨äºè®¡ç®å¯ä¸äºç©çæ¦çæ°æ®ç»æï¼ä»ææ¯ä¸è®²ï¼è¿è¢«ç§°ä¸ºä¼°è®¡éåçåºæ°ï¼ãå¦æç»è®¡å¯ä¸é¡¹ï¼é¡¹ç®è¶å¤ï¼éè¦çåå­å°±è¶å¤ãå ä¸ºéè¦è®°ä½è¿å»å·²ç»çè¿çé¡¹ï¼ä»èé¿åå¤æ¬¡ç»è®¡è¿äºé¡¹ã\n\n# hyperloglog å½ä»¤\n\n * pfadd - å°ä»»ææ°éçåç´ æ·»å å°æå®ç hyperloglog éé¢ã\n * pfcount - è¿å hyperloglog åå«çå¯ä¸åç´ çè¿ä¼¼æ°éã\n * pfmerge - å°å¤ä¸ª hyperloglog åå¹¶ï¼mergeï¼ä¸ºä¸ä¸ª hyperloglog ï¼ åå¹¶åç hyperloglog çåºæ°æ¥è¿äºææè¾å¥ hyperloglog çå¯è§éåï¼observed setï¼çå¹¶éãåå¹¶å¾åºç hyperloglog ä¼è¢«å¨å­å¨ destkey é®éé¢ï¼ å¦æè¯¥é®å¹¶ä¸å­å¨ï¼ é£ä¹å½ä»¤å¨æ§è¡ä¹åï¼ ä¼åä¸ºè¯¥é®åå»ºä¸ä¸ªç©ºç hyperloglog ã\n\nç¤ºä¾ï¼\n\nredis> pfadd  databases  "redis"  "mongodb"  "mysql"\n(integer) 1\n\nredis> pfcount  databases\n(integer) 3\n\nredis> pfadd  databases  "redis"    # redis å·²ç»å­å¨ï¼ä¸å¿å¯¹ä¼°è®¡æ°éè¿è¡æ´æ°\n(integer) 0\n\nredis> pfcount  databases    # åç´ ä¼°è®¡æ°éæ²¡æåå\n(integer) 3\n\nredis> pfadd  databases  "postgresql"    # æ·»å ä¸ä¸ªä¸å­å¨çåç´ \n(integer) 1\n\nredis> pfcount  databases    # ä¼°è®¡æ°éå¢ä¸\n4\n\n\n\n# geo\n\nè¿ä¸ªåè½å¯ä»¥å°ç¨æ·ç»å®çå°çä½ç½®ï¼ç»åº¦åçº¬åº¦ï¼ä¿¡æ¯å¨å­èµ·æ¥ï¼å¹¶å¯¹è¿äºä¿¡æ¯è¿è¡æä½ã\n\n# geo å½ä»¤\n\n * geoadd - å°æå®çå°çç©ºé´ä½ç½®ï¼çº¬åº¦ãç»åº¦ãåç§°ï¼æ·»å å°æå®ç key ä¸­ã\n * geopos - ä» key éè¿åææç»å®ä½ç½®åç´ çä½ç½®ï¼ç»åº¦åçº¬åº¦ï¼ã\n * geodist - è¿åä¸¤ä¸ªç»å®ä½ç½®ä¹é´çè·ç¦»ã\n * geohash - åä¸ä¸ªæå¤ä¸ªä½ç½®åç´ çæ å geohash å¼ï¼å®å¯ä»¥å¨http://geohash.org/ä½¿ç¨ã\n * georadius\n * georadiusbymember\n\n\n# ä¸ãredis æ°æ®ç±»ååºç¨\n\n\n# æ¡ä¾-æåæ¬¢è¿æç« \n\néåºæåæ¬¢è¿æç« ï¼éè¦æ¯æå¯¹æç« è¿è¡è¯åã\n\n# å¯¹æç« è¿è¡æç¥¨\n\nï¼1ï¼ä½¿ç¨ hash å­å¨æç« \n\nä½¿ç¨ hash ç±»åå­å¨æç« ä¿¡æ¯ãå¶ä¸­ï¼key æ¯æç«  idï¼field æ¯æç« çå±æ§ keyï¼value æ¯å±æ§å¯¹åºå¼ã\n\n\n\næä½ï¼\n\n * å­å¨æç« ä¿¡æ¯ - ä½¿ç¨ hset æ hmget å½ä»¤\n * æ¥è¯¢æç« ä¿¡æ¯ - ä½¿ç¨ hgetall å½ä»¤\n * æ·»å æç¥¨ - ä½¿ç¨ hincrby å½ä»¤\n\nï¼2ï¼ä½¿ç¨ zset éå¯¹ä¸åç»´åº¦éåæåº\n\nä½¿ç¨ zset ç±»ååå«å­å¨æç§æ¶é´æåºåæç§è¯åæåºçæç«  id éåã\n\n\n\næä½ï¼\n\n * æ·»å è®°å½ - ä½¿ç¨ zadd å½ä»¤\n * æ·»å åæ° - ä½¿ç¨ zincrby å½ä»¤\n * ååºå¤ç¯æç«  - ä½¿ç¨ zrevrange å½ä»¤\n\nï¼3ï¼ä¸ºäºé²æ­¢éå¤æç¥¨ï¼ä½¿ç¨ set ç±»åè®°å½æ¯ç¯æç«  id å¯¹åºçæç¥¨éåã\n\n\n\næä½ï¼\n\n * æ·»å æç¥¨è - ä½¿ç¨ sadd å½ä»¤\n * è®¾ç½®æææ - ä½¿ç¨ expire å½ä»¤\n\nï¼4ï¼åè®¾ user:115423 ç» article:100408 æç¥¨ï¼åå«éè¦é«æ´æ°è¯åæåºéåä»¥åæç¥¨éåã\n\n\n\nå½éè¦å¯¹ä¸ç¯æç« æç¥¨æ¶ï¼ç¨åºéè¦ç¨ zscore å½ä»¤æ£æ¥è®°å½æç« åå¸æ¶é´çæåºéåï¼å¤æ­æç« çåå¸æ¶é´æ¯å¦è¶è¿æç¥¨æææï¼æ¯å¦ï¼ä¸ææï¼ã\n\n    public void articlevote(jedis conn, string user, string article) {\n        // è®¡ç®æç« çæç¥¨æªæ­¢æ¶é´ã\n        long cutoff = (system.currenttimemillis() / 1000) - one_week_in_seconds;\n\n        // æ£æ¥æ¯å¦è¿å¯ä»¥å¯¹æç« è¿è¡æç¥¨\n        // ï¼è½ç¶ä½¿ç¨æ£åä¹å¯ä»¥è·åæç« çåå¸æ¶é´ï¼\n        // ä½æåºéåè¿åçæç« åå¸æ¶é´ä¸ºæµ®ç¹æ°ï¼\n        // å¯ä»¥ä¸è¿è¡è½¬æ¢ç´æ¥ä½¿ç¨ï¼ã\n        if (conn.zscore("time:", article) < cutoff) {\n            return;\n        }\n\n        // ä»article:idæ è¯ç¬¦ï¼identifierï¼éé¢ååºæç« çidã\n        string articleid = article.substring(article.indexof(\':\') + 1);\n\n        // å¦æç¨æ·æ¯ç¬¬ä¸æ¬¡ä¸ºè¿ç¯æç« æç¥¨ï¼é£ä¹å¢å è¿ç¯æç« çæç¥¨æ°éåè¯åã\n        if (conn.sadd("voted:" + articleid, user) == 1) {\n            conn.zincrby("score:", vote_score, article);\n            conn.hincrby(article, "votes", 1);\n        }\n    }\n\n\n# åå¸å¹¶è·åæç« \n\nåå¸æç« ï¼\n\n * æ·»å æç«  - ä½¿ç¨ incr å½ä»¤è®¡ç®æ°çæç«  idï¼å¡«åæç« ä¿¡æ¯ï¼ç¶åç¨ hset å½ä»¤æ hmset å½ä»¤åå¥å° hash ç»æä¸­ã\n * å°æç« ä½è id æ·»å å°æç¥¨åå - ä½¿ç¨ sadd å½ä»¤æ·»å å°ä»£è¡¨æç¥¨ååç set ç»æä¸­ã\n * è®¾ç½®æç¥¨æææ - ä½¿ç¨ expire å½ä»¤è®¾ç½®æç¥¨æææã\n\n    public string postarticle(jedis conn, string user, string title, string link) {\n        // çæä¸ä¸ªæ°çæç« idã\n        string articleid = string.valueof(conn.incr("article:"));\n\n        string voted = "voted:" + articleid;\n        // å°åå¸æç« çç¨æ·æ·»å å°æç« çå·²æç¥¨ç¨æ·ååéé¢ï¼\n        conn.sadd(voted, user);\n        // ç¶åå°è¿ä¸ªååçè¿ææ¶é´è®¾ç½®ä¸ºä¸å¨ï¼ç¬¬3ç« å°å¯¹è¿ææ¶é´ä½æ´è¯¦ç»çä»ç»ï¼ã\n        conn.expire(voted, one_week_in_seconds);\n\n        long now = system.currenttimemillis() / 1000;\n        string article = "article:" + articleid;\n        // å°æç« ä¿¡æ¯å­å¨å°ä¸ä¸ªæ£åéé¢ã\n        hashmap<string, string> articledata = new hashmap<string, string>();\n        articledata.put("title", title);\n        articledata.put("link", link);\n        articledata.put("user", user);\n        articledata.put("now", string.valueof(now));\n        articledata.put("votes", "1");\n        conn.hmset(article, articledata);\n\n        // å°æç« æ·»å å°æ ¹æ®åå¸æ¶é´æåºçæåºéååæ ¹æ®è¯åæåºçæåºéåéé¢ã\n        conn.zadd("score:", now + vote_score, article);\n        conn.zadd("time:", now, article);\n\n        return articleid;\n    }\n\n\nåé¡µæ¥è¯¢æåæ¬¢è¿æç« ï¼\n\nä½¿ç¨ zinterstore å½ä»¤æ ¹æ®é¡µç ãæ¯é¡µè®°å½æ°ãæåºå·ï¼æ ¹æ®è¯åå¼ä»å¤§å°å°åé¡µæ¥åºæç«  id åè¡¨ã\n\n    public list<map<string, string>> getarticles(jedis conn, int page, string order) {\n        // è®¾ç½®è·åæç« çèµ·å§ç´¢å¼åç»æç´¢å¼ã\n        int start = (page - 1) * articles_per_page;\n        int end = start + articles_per_page - 1;\n\n        // è·åå¤ä¸ªæç« idã\n        set<string> ids = conn.zrevrange(order, start, end);\n        list<map<string, string>> articles = new arraylist<>();\n        // æ ¹æ®æç« idè·åæç« çè¯¦ç»ä¿¡æ¯ã\n        for (string id : ids) {\n            map<string, string> articledata = conn.hgetall(id);\n            articledata.put("id", id);\n            articles.add(articledata);\n        }\n\n        return articles;\n    }\n\n\n# å¯¹æç« è¿è¡åç»\n\nå¦ææç« éè¦åç»ï¼åè½éè¦åä¸ºä¸¤åï¼\n\n * è®°å½æç« å±äºåªä¸ªç¾¤ç»\n * è´è´£ååºç¾¤ç»éçæç« \n\nå°æç« æ·»å ãå é¤ç¾¤ç»ï¼\n\n    public void addremovegroups(jedis conn, string articleid, string[] toadd, string[] toremove) {\n        // æå»ºå­å¨æç« ä¿¡æ¯çé®åã\n        string article = "article:" + articleid;\n        // å°æç« æ·»å å°å®æå±çç¾¤ç»éé¢ã\n        for (string group : toadd) {\n            conn.sadd("group:" + group, article);\n        }\n        // ä»ç¾¤ç»éé¢ç§»é¤æç« ã\n        for (string group : toremove) {\n            conn.srem("group:" + group, article);\n        }\n    }\n\n\nååºç¾¤ç»éçæç« ï¼\n\n\n\n * éè¿å¯¹å­å¨ç¾¤ç»æç« çéååå­å¨æç« è¯åçæåºéåæ§è¡ zinterstore å½ä»¤ï¼å¯ä»¥å¾å°æç§æç« è¯åæåºçç¾¤ç»æç« ã\n * éè¿å¯¹å­å¨ç¾¤ç»æç« çéååå­å¨æç« åå¸æ¶é´çæåºéåæ§è¡ zinterstore å½ä»¤ï¼å¯ä»¥å¾å°æç§æç« åå¸æ¶é´æåºçç¾¤ç»æç« ã\n\n    public list<map<string, string>> getgrouparticles(jedis conn, string group, int page, string order) {\n        // ä¸ºæ¯ä¸ªç¾¤ç»çæ¯ç§æåé¡ºåºé½åå»ºä¸ä¸ªé®ã\n        string key = order + group;\n        // æ£æ¥æ¯å¦æå·²ç¼å­çæåºç»æï¼å¦ææ²¡æçè¯å°±ç°å¨è¿è¡æåºã\n        if (!conn.exists(key)) {\n            // æ ¹æ®è¯åæèåå¸æ¶é´ï¼å¯¹ç¾¤ç»æç« è¿è¡æåºã\n            zparams params = new zparams().aggregate(zparams.aggregate.max);\n            conn.zinterstore(key, params, "group:" + group, order);\n            // è®©rediså¨60ç§éä¹åèªå¨å é¤è¿ä¸ªæåºéåã\n            conn.expire(key, 60);\n        }\n        // è°ç¨ä¹åå®ä¹çgetarticleså½æ°æ¥è¿è¡åé¡µå¹¶è·åæç« æ°æ®ã\n        return getarticles(conn, page, key);\n    }\n\n\n\n# æ¡ä¾-ç®¡çä»¤ç\n\nç½ç«ä¸è¬ä¼ä»¥ cookieãsessionãä»¤çè¿ç±»ä¿¡æ¯å­å¨ç¨æ·èº«ä»½ä¿¡æ¯ã\n\nå¯ä»¥å° cookie/session/ä»¤ç åç¨æ·çæ å°å³ç³»å­å¨å¨ hash ç»æã\n\nä¸é¢ä»¥ä»¤çæ¥ä¸¾ä¾ã\n\n# æ¥è¯¢ä»¤ç\n\n    public string checktoken(jedis conn, string token) {\n        // å°è¯è·åå¹¶è¿åä»¤çå¯¹åºçç¨æ·ã\n        return conn.hget("login:", token);\n    }\n\n\n# æ´æ°ä»¤ç\n\n * ç¨æ·æ¯æ¬¡è®¿é®é¡µé¢ï¼å¯ä»¥è®°å½ä¸ä»¤çåå½åæ¶é´æ³çæ å°å³ç³»ï¼å­å¥ä¸ä¸ª zset ç»æä¸­ï¼ä»¥ä¾¿åæç¨æ·æ¯å¦æ´»è·ï¼ç»§èå¯ä»¥å¨ææ§æ¸çæèçä»¤çï¼ç»è®¡å½åå¨çº¿ç¨æ·æ°ç­è¡ä¸ºã\n * ç¨æ·å¦ææ­£å¨æµè§ååï¼å¯ä»¥è®°å½å°ç¨æ·æè¿æµè§è¿çååæåºéåä¸­ï¼éåå¯ä»¥éå®æ°éï¼è¶è¿æ°éè¿è¡è£åªï¼ï¼å­å¥å°ä¸ä¸ª zset ç»æä¸­ï¼ä»¥ä¾¿åæç¨æ·æè¿å¯è½æå´è¶£çååï¼ä»¥ä¾¿æ¨èååã\n\n    public void updatetoken(jedis conn, string token, string user, string item) {\n        // è·åå½åæ¶é´æ³ã\n        long timestamp = system.currenttimemillis() / 1000;\n        // ç»´æä»¤çä¸å·²ç»å½ç¨æ·ä¹é´çæ å°ã\n        conn.hset("login:", token, user);\n        // è®°å½ä»¤çæåä¸æ¬¡åºç°çæ¶é´ã\n        conn.zadd("recent:", timestamp, token);\n        if (item != null) {\n            // è®°å½ç¨æ·æµè§è¿çååã\n            conn.zadd("viewed:" + token, timestamp, item);\n            // ç§»é¤æ§çè®°å½ï¼åªä¿çç¨æ·æè¿æµè§è¿ç25ä¸ªååã\n            conn.zremrangebyrank("viewed:" + token, 0, -26);\n            conn.zincrby("viewed:", -1, item);\n        }\n    }\n\n\n# æ¸çä»¤ç\n\nä¸ä¸èæå°ï¼æ´æ°ä»¤çæ¶ï¼å°ä»¤çåå½åæ¶é´æ³çæ å°å³ç³»ï¼å­å¥ä¸ä¸ª zset ç»æä¸­ãæä»¥å¯ä»¥éè¿æåºå¾ç¥åªäºä»¤çæèãå¦ææ²¡ææ¸çæä½ï¼æ´æ°ä»¤çå ç¨çåå­ä¼ä¸æ­è¨èï¼ç´å°å¯¼è´æºå¨å®æºã\n\næ¯å¦ï¼æå¤åè®¸å­å¨ 1000 ä¸æ¡ä»¤çä¿¡æ¯ï¼å¨ææ§æ£æ¥ï¼ä¸æ¦åç°è®°å½æ°è¶åº 1000 ä¸æ¡ï¼å° zset ä»æ°å°èæåºï¼å°è¶åº 1000 ä¸æ¡çè®°å½æ¸é¤ã\n\npublic static class cleansessionsthread extends thread {\n\n    private jedis conn;\n\n    private int limit;\n\n    private volatile boolean quit;\n\n    public cleansessionsthread(int limit) {\n        this.conn = new jedis("localhost");\n        this.conn.select(15);\n        this.limit = limit;\n    }\n\n    public void quit() {\n        quit = true;\n    }\n\n    @override\n    public void run() {\n        while (!quit) {\n            // æ¾åºç®åå·²æä»¤ççæ°éã\n            long size = conn.zcard("recent:");\n            // ä»¤çæ°éæªè¶è¿éå¶ï¼ä¼ç å¹¶å¨ä¹åéæ°æ£æ¥ã\n            if (size <= limit) {\n                try {\n                    sleep(1000);\n                } catch (interruptedexception ie) {\n                    thread.currentthread().interrupt();\n                }\n                continue;\n            }\n\n            // è·åéè¦ç§»é¤çä»¤çidã\n            long endindex = math.min(size - limit, 100);\n            set<string> tokenset = conn.zrange("recent:", 0, endindex - 1);\n            string[] tokens = tokenset.toarray(new string[tokenset.size()]);\n\n            // ä¸ºé£äºå°è¦è¢«å é¤çä»¤çæå»ºé®åã\n            arraylist<string> sessionkeys = new arraylist<string>();\n            for (string token : tokens) {\n                sessionkeys.add("viewed:" + token);\n            }\n\n            // ç§»é¤ææ§çé£äºä»¤çã\n            conn.del(sessionkeys.toarray(new string[sessionkeys.size()]));\n            conn.hdel("login:", tokens);\n            conn.zrem("recent:", tokens);\n        }\n    }\n\n}\n\n\n\n# æ¡ä¾-è´­ç©è½¦\n\nå¯ä»¥ä½¿ç¨ hash ç»ææ¥å®ç°è´­ç©è½¦åè½ã\n\næ¯ä¸ªç¨æ·çè´­ç©è½¦ï¼å­å¨äºåå id åååæ°éçæ å°ã\n\n# å¨è´­ç©è½¦ä¸­æ·»å ãå é¤åå\n\n    public void addtocart(jedis conn, string session, string item, int count) {\n        if (count <= 0) {\n            // ä»è´­ç©è½¦éé¢ç§»é¤æå®çååã\n            conn.hdel("cart:" + session, item);\n        } else {\n            // å°æå®çååæ·»å å°è´­ç©è½¦ã\n            conn.hset("cart:" + session, item, string.valueof(count));\n        }\n    }\n\n\n# æ¸ç©ºè´­ç©è½¦\n\nå¨ æ¸çä»¤ç çåºç¡ä¸ï¼æ¸ç©ºä¼è¯æ¶ï¼é¡ºä¾¿å°è´­ç©è½¦ç¼å­ä¸å¹¶æ¸çã\n\n   while (!quit) {\n        long size = conn.zcard("recent:");\n        if (size <= limit) {\n            try {\n                sleep(1000);\n            } catch (interruptedexception ie) {\n                thread.currentthread().interrupt();\n            }\n            continue;\n        }\n\n        long endindex = math.min(size - limit, 100);\n        set<string> sessionset = conn.zrange("recent:", 0, endindex - 1);\n        string[] sessions = sessionset.toarray(new string[sessionset.size()]);\n\n        arraylist<string> sessionkeys = new arraylist<string>();\n        for (string sess : sessions) {\n            sessionkeys.add("viewed:" + sess);\n            // æ°å¢å çè¿è¡ä»£ç ç¨äºå é¤æ§ä¼è¯å¯¹åºç¨æ·çè´­ç©è½¦ã\n            sessionkeys.add("cart:" + sess);\n        }\n\n        conn.del(sessionkeys.toarray(new string[sessionkeys.size()]));\n        conn.hdel("login:", sessions);\n        conn.zrem("recent:", sessions);\n    }\n\n\n\n# æ¡ä¾-é¡µé¢ç¼å­\n\nå¤§é¨åç½é¡µåå®¹å¹¶ä¸ä¼ç»å¸¸æ¹åï¼ä½æ¯è®¿é®æ¶ï¼åå°éè¦å¨æè®¡ç®ï¼è¿å¯è½èæ¶è¾å¤ï¼æ­¤æ¶å¯ä»¥ä½¿ç¨ string ç»æå­å¨é¡µé¢ç¼å­ï¼\n\n    public string cacherequest(jedis conn, string request, callback callback) {\n        // å¯¹äºä¸è½è¢«ç¼å­çè¯·æ±ï¼ç´æ¥è°ç¨åè°å½æ°ã\n        if (!cancache(conn, request)) {\n            return callback != null ? callback.call(request) : null;\n        }\n\n        // å°è¯·æ±è½¬æ¢æä¸ä¸ªç®åçå­ç¬¦ä¸²é®ï¼æ¹ä¾¿ä¹åè¿è¡æ¥æ¾ã\n        string pagekey = "cache:" + hashrequest(request);\n        // å°è¯æ¥æ¾è¢«ç¼å­çé¡µé¢ã\n        string content = conn.get(pagekey);\n\n        if (content == null && callback != null) {\n            // å¦æé¡µé¢è¿æ²¡æè¢«ç¼å­ï¼é£ä¹çæé¡µé¢ã\n            content = callback.call(request);\n            // å°æ°çæçé¡µé¢æ¾å°ç¼å­éé¢ã\n            conn.setex(pagekey, 300, content);\n        }\n\n        // è¿åé¡µé¢ã\n        return content;\n    }\n\n\n\n# æ¡ä¾-æ°æ®è¡ç¼å­\n\nçµåç½ç«å¯è½ä¼æä¿éãç¹åãæ½å¥ç­æ´»å¨ï¼è¿äºæ´»å¨é¡µé¢åªéè¦ä»æ°æ®åºä¸­å è½½å è¡æ°æ®ï¼å¦ï¼ç¨æ·ä¿¡æ¯ãååä¿¡æ¯ã\n\nå¯ä»¥ä½¿ç¨ string ç»ææ¥ç¼å­è¿äºæ°æ®ï¼ä½¿ç¨ json å­å¨ç»æåçä¿¡æ¯ã\n\næ­¤å¤ï¼éè¦æä¸¤ä¸ª zset ç»ææ¥è®°å½æ´æ°ç¼å­çæ¶æºï¼\n\n * ç¬¬ä¸ä¸ªä¸ºè°åº¦æåºéåï¼\n * ç¬¬äºä¸ªä¸ºå»¶æ¶æåºéåã\n\nè®°å½ç¼å­æ¶æºï¼\n\n    public void schedulerowcache(jedis conn, string rowid, int delay) {\n        // åè®¾ç½®æ°æ®è¡çå»¶è¿å¼ã\n        conn.zadd("delay:", delay, rowid);\n        // ç«å³ç¼å­æ°æ®è¡ã\n        conn.zadd("schedule:", system.currenttimemillis() / 1000, rowid);\n    }\n\n\nå®æ¶æ´æ°æ°æ®è¡ç¼å­ï¼\n\npublic class cacherowsthread extends thread {\n\n    private jedis conn;\n\n    private boolean quit;\n\n    public cacherowsthread() {\n        this.conn = new jedis("localhost");\n        this.conn.select(15);\n    }\n\n    public void quit() {\n        quit = true;\n    }\n\n    @override\n    public void run() {\n        gson gson = new gson();\n        while (!quit) {\n            // å°è¯è·åä¸ä¸ä¸ªéè¦è¢«ç¼å­çæ°æ®è¡ä»¥åè¯¥è¡çè°åº¦æ¶é´æ³ï¼\n            // å½ä»¤ä¼è¿åä¸ä¸ªåå«é¶ä¸ªæä¸ä¸ªåç»ï¼tupleï¼çåè¡¨ã\n            set<tuple> range = conn.zrangewithscores("schedule:", 0, 0);\n            tuple next = range.size() > 0 ? range.iterator().next() : null;\n            long now = system.currenttimemillis() / 1000;\n            if (next == null || next.getscore() > now) {\n                try {\n                    // ææ¶æ²¡æè¡éè¦è¢«ç¼å­ï¼ä¼ç 50æ¯«ç§åéè¯ã\n                    sleep(50);\n                } catch (interruptedexception ie) {\n                    thread.currentthread().interrupt();\n                }\n                continue;\n            }\n\n            string rowid = next.getelement();\n            // è·åä¸ä¸æ¬¡è°åº¦åçå»¶è¿æ¶é´ã\n            double delay = conn.zscore("delay:", rowid);\n            if (delay <= 0) {\n                // ä¸å¿åç¼å­è¿ä¸ªè¡ï¼å°å®ä»ç¼å­ä¸­ç§»é¤ã\n                conn.zrem("delay:", rowid);\n                conn.zrem("schedule:", rowid);\n                conn.del("inv:" + rowid);\n                continue;\n            }\n\n            // è¯»åæ°æ®è¡ã\n            inventory row = inventory.get(rowid);\n            // æ´æ°è°åº¦æ¶é´å¹¶è®¾ç½®ç¼å­å¼ã\n            conn.zadd("schedule:", now + delay, rowid);\n            conn.set("inv:" + rowid, gson.tojson(row));\n        }\n    }\n\n}\n\n\n\n# æ¡ä¾-ç½é¡µåæ\n\nç½ç«å¯ä»¥ééç¨æ·çè®¿é®ãäº¤äºãè´­ä¹°è¡ä¸ºï¼ååæç¨æ·ä¹ æ¯ãåå¥½ï¼ä»èå¤æ­å¸åºè¡æåæ½å¨åæºç­ã\n\né£ä¹ï¼ç®åçï¼å¦ä½è®°å½ç¨æ·å¨ä¸å®æ¶é´åè®¿é®çååé¡µé¢å¢ï¼\n\nåè æ´æ°ä»¤ç ä»£ç ç¤ºä¾ï¼è®°å½ç¨æ·è®¿é®ä¸åååçæµè§æ¬¡æ°ï¼å¹¶æåºã\n\nå¤æ­é¡µé¢æ¯å¦éè¦ç¼å­ï¼æ ¹æ®è¯åå¤æ­ååé¡µé¢æ¯å¦ç­é¨ï¼\n\n    public boolean cancache(jedis conn, string request) {\n        try {\n            url url = new url(request);\n            hashmap<string, string> params = new hashmap<>();\n            if (url.getquery() != null) {\n                for (string param : url.getquery().split("&")) {\n                    string[] pair = param.split("=", 2);\n                    params.put(pair[0], pair.length == 2 ? pair[1] : null);\n                }\n            }\n\n            // å°è¯ä»é¡µé¢éé¢ååºååidã\n            string itemid = extractitemid(params);\n            // æ£æ¥è¿ä¸ªé¡µé¢è½å¦è¢«ç¼å­ä»¥åè¿ä¸ªé¡µé¢æ¯å¦ä¸ºååé¡µé¢ã\n            if (itemid == null || isdynamic(params)) {\n                return false;\n            }\n            // åå¾ååçæµè§æ¬¡æ°æåã\n            long rank = conn.zrank("viewed:", itemid);\n            // æ ¹æ®ååçæµè§æ¬¡æ°æåæ¥å¤æ­æ¯å¦éè¦ç¼å­è¿ä¸ªé¡µé¢ã\n            return rank != null && rank < 10000;\n        } catch (malformedurlexception mue) {\n            return false;\n        }\n    }\n\n\n\n# æ¡ä¾-è®°å½æ¥å¿\n\nå¯ç¨ä½¿ç¨ list ç»æå­å¨æ¥å¿æ°æ®ã\n\n    public void logrecent(jedis conn, string name, string message, string severity) {\n        string destination = "recent:" + name + \':\' + severity;\n        pipeline pipe = conn.pipelined();\n        pipe.lpush(destination, timestamp.format(new date()) + \' \' + message);\n        pipe.ltrim(destination, 0, 99);\n        pipe.sync();\n    }\n\n\n\n# æ¡ä¾-ç»è®¡æ°æ®\n\næ´æ°è®¡æ°å¨ï¼\n\n    public static final int[] precision = new int[] { 1, 5, 60, 300, 3600, 18000, 86400 };\n\n    public void updatecounter(jedis conn, string name, int count, long now) {\n        transaction trans = conn.multi();\n        for (int prec : precision) {\n            long pnow = (now / prec) * prec;\n            string hash = string.valueof(prec) + \':\' + name;\n            trans.zadd("known:", 0, hash);\n            trans.hincrby("count:" + hash, string.valueof(pnow), count);\n        }\n        trans.exec();\n    }\n\n\næ¥çè®¡æ°å¨æ°æ®ï¼\n\n    public list<pair<integer>> getcounter(\n        jedis conn, string name, int precision) {\n        string hash = string.valueof(precision) + \':\' + name;\n        map<string, string> data = conn.hgetall("count:" + hash);\n        list<pair<integer>> results = new arraylist<>();\n        for (map.entry<string, string> entry : data.entryset()) {\n            results.add(new pair<>(\n                entry.getkey(),\n                integer.parseint(entry.getvalue())));\n        }\n        collections.sort(results);\n        return results;\n    }\n\n\n\n# æ¡ä¾-æ¥æ¾ ip æå±å°\n\nredis å®ç°ç ip æå±å°æ¥æ¾æ¯å³ç³»åæ°æ®å®ç°æ¹å¼æ´å¿«ã\n\n# è½½å¥ ip æ°æ®\n\nip å°åè½¬ä¸ºæ´æ°å¼ï¼\n\n    public int iptoscore(string ipaddress) {\n        int score = 0;\n        for (string v : ipaddress.split("\\\\.")) {\n            score = score * 256 + integer.parseint(v, 10);\n        }\n        return score;\n    }\n\n\nåå»º ip å°åä¸åå¸ id ä¹é´çæ å°ï¼\n\n    public void importipstoredis(jedis conn, file file) {\n        filereader reader = null;\n        try {\n            // è½½å¥ csv æä»¶æ°æ®\n            reader = new filereader(file);\n            csvformat csvformat = csvformat.default.withrecordseparator("\\n");\n            csvparser csvparser = csvformat.parse(reader);\n            int count = 0;\n            list<csvrecord> records = csvparser.getrecords();\n            for (csvrecord line : records) {\n                string startip = line.get(0);\n                if (startip.tolowercase().indexof(\'i\') != -1) {\n                    continue;\n                }\n                // å° ip å°åè½¬ä¸ºæ´æ°å¼\n                int score = 0;\n                if (startip.indexof(\'.\') != -1) {\n                    score = iptoscore(startip);\n                } else {\n                    try {\n                        score = integer.parseint(startip, 10);\n                    } catch (numberformatexception nfe) {\n                        // ç¥è¿æä»¶çç¬¬ä¸è¡ä»¥åæ ¼å¼ä¸æ­£ç¡®çæ¡ç®\n                        continue;\n                    }\n                }\n\n                // æå»ºå¯ä¸çåå¸ id\n                string cityid = line.get(2) + \'_\' + count;\n                // å°åå¸ id åå¶å¯¹åºç ip å°åæ´æ°å¼æ·»å å° zset\n                conn.zadd("ip2cityid:", score, cityid);\n                count++;\n            }\n        } catch (exception e) {\n            throw new runtimeexception(e);\n        } finally {\n            try {\n                reader.close();\n            } catch (exception e) {\n                // ignore\n            }\n        }\n    }\n\n\nå­å¨åå¸ä¿¡æ¯ï¼\n\n    public void importcitiestoredis(jedis conn, file file) {\n        gson gson = new gson();\n        filereader reader = null;\n        try {\n            // å è½½ csv ä¿¡æ¯\n            reader = new filereader(file);\n            csvformat csvformat = csvformat.default.withrecordseparator("\\n");\n            csvparser parser = new csvparser(reader, csvformat);\n            // string[] line;\n            list<csvrecord> records = parser.getrecords();\n            for (csvrecord record : records) {\n\n                if (record.size() < 4 || !character.isdigit(record.get(0).charat(0))) {\n                    continue;\n                }\n\n                // å°åå¸å°çä¿¡æ¯è½¬ä¸º json ç»æï¼å­å¥ hash ç»æä¸­\n                string cityid = record.get(0);\n                string country = record.get(1);\n                string region = record.get(2);\n                string city = record.get(3);\n                string json = gson.tojson(new string[] { city, region, country });\n                conn.hset("cityid2city:", cityid, json);\n            }\n        } catch (exception e) {\n            throw new runtimeexception(e);\n        } finally {\n            try {\n                reader.close();\n            } catch (exception e) {\n                // ignore\n            }\n        }\n    }\n\n\n# æ¥æ¾ ip æå±åå¸\n\næä½æ­¥éª¤ï¼\n\n 1. å°è¦æ¥æ¾ç ip å°åè½¬ä¸ºæ´æ°å¼ï¼\n 2. æ¥æ¾ææåå¼å°äºç­äºè¦æ¥æ¾ç ip å°åçå°åï¼ååºå¶ä¸­æå¤§åå¼çé£ä¸ªè®°å½ï¼\n 3. ç¨æ¾å°çè®°å½æå¯¹åºçåå¸ id å»æ£ç´¢åå¸ä¿¡æ¯ã\n\n    public string[] findcitybyip(jedis conn, string ipaddress) {\n        int score = iptoscore(ipaddress);\n        set<string> results = conn.zrevrangebyscore("ip2cityid:", score, 0, 0, 1);\n        if (results.size() == 0) {\n            return null;\n        }\n\n        string cityid = results.iterator().next();\n        cityid = cityid.substring(0, cityid.indexof(\'_\'));\n        return new gson().fromjson(conn.hget("cityid2city:", cityid), string[].class);\n    }\n\n\n\n# æ¡ä¾-æå¡çåç°ä¸éç½®\n\n\n# æ¡ä¾-èªå¨è¡¥å¨\n\néæ±ï¼æ ¹æ®ç¨æ·è¾å¥ï¼èªå¨è¡¥å¨ä¿¡æ¯ï¼å¦ï¼èç³»äººãåååç­ã\n\n * å¸ååºæ¯ä¸ï¼ç¤¾äº¤ç½ç«åå°è®°å½ç¨æ·æè¿èç³»è¿ç 100 ä¸ªå¥½åï¼å½ç¨æ·æ¥æ¾å¥½åæ¶ï¼æ ¹æ®è¾å¥çå³é®å­èªå¨è¡¥å¨å§åã\n * å¸ååºæ¯äºï¼çµåç½ç«åå°è®°å½ç¨æ·æè¿æµè§è¿ç 10 ä»¶ååï¼å½ç¨æ·æ¥æ¾ååæ¯ï¼æ ¹æ®è¾å¥çå³é®å­èªå¨è¡¥å¨åååç§°ã\n\næ°æ®æ¨¡åï¼ä½¿ç¨ redis ç list ç±»åå­å¨æè¿èç³»äººåè¡¨ã\n\næå»ºèªå¨è¡¥å¨åè¡¨éå¸¸æä»¥ä¸æä½ï¼\n\n * å¦ææå®èç³»äººå·²ç»å­å¨äºæè¿èç³»äººåè¡¨éï¼é£ä¹ä»åè¡¨éç§»é¤ä»ãå¯¹åº lrem å½ä»¤ã\n * å°æå®èç³»äººæ·»å å°æè¿èç³»äººåè¡¨çæåé¢ãå¯¹åº lpush å½ä»¤ã\n * æ·»å æä½å®æåï¼å¦æèç³»äººåè¡¨ä¸­çæ°éè¶è¿ 100 ä¸ªï¼è¿è¡è£åªæä½ãå¯¹åº ltrim å½ä»¤ã\n\n\n# æ¡ä¾-å¹¿åå®å\n\n\n# æ¡ä¾-èä½æç´¢\n\néæ±ï¼å¨ä¸ä¸ªæèç½ç«ä¸ï¼æ±èèæèªå·±çæè½æ¸åï¼ç¨äººå¬å¸çèä½æå¿è¦çæè½æ¸åãç¨äººå¬å¸éè¦æ¥è¯¢æ»¡è¶³èªå·±èä½è¦æ±çæ±èèï¼æ±èèéè¦æ¥è¯¢èªå·±å¯ä»¥æéç®åçèä½ã\n\nå³é®æ°æ®æ¨¡åï¼ä½¿ç¨ set ç±»åå­å¨æ±èèçæè½åè¡¨ï¼ä½¿ç¨ set ç±»åå­å¨èä½çæè½åè¡¨ã\n\nå³é®æä½ï¼ä½¿ç¨ sdiff å½ä»¤å¯¹æ¯ä¸¤ä¸ª set çå·®å¼ï¼è¿å empty è¡¨ç¤ºå¹éè¦æ±ã\n\nredis cli ç¤ºä¾ï¼\n\n# -----------------------------------------------------------\n# redis èä½æç´¢æ°æ®æ¨¡åç¤ºä¾\n# -----------------------------------------------------------\n\n# ï¼1ï¼èä½æè½è¡¨ï¼ä½¿ç¨ set å­å¨\n# job:001 èä½æ·»å  4 ç§æè½\nsadd job:001 skill:001\nsadd job:001 skill:002\nsadd job:001 skill:003\nsadd job:001 skill:004\n\n# job:002 èä½æ·»å  3 ç§æè½\nsadd job:002 skill:001\nsadd job:002 skill:002\nsadd job:002 skill:003\n\n# job:003 èä½æ·»å  2 ç§æè½\nsadd job:003 skill:001\nsadd job:003 skill:003\n\n# æ¥ç\nsmembers job:001\nsmembers job:002\nsmembers job:003\n\n# ï¼2ï¼æ±èèæè½è¡¨ï¼ä½¿ç¨ set å­å¨\nsadd interviewee:001 skill:001\nsadd interviewee:001 skill:003\n\nsadd interviewee:002 skill:001\nsadd interviewee:002 skill:002\nsadd interviewee:002 skill:003\nsadd interviewee:002 skill:004\nsadd interviewee:002 skill:005\n\n# æ¥ç\nsmembers interviewee:001\nsmembers interviewee:002\n\n# ï¼3ï¼æ±èèéåæ¥æ¾èªå·±ç¬¦åè¦æ±çèä½ï¼è¿åç»æä¸º empty è¡¨ç¤ºè¦æ±çæè½å¨é¨å½ä¸­ï¼\n# æ¯è¾èä½æè½æ¸ååæ±èèæè½æ¸åçå·®å¼\nsdiff job:001 interviewee:001\nsdiff job:002 interviewee:001\nsdiff job:003 interviewee:001\n\nsdiff job:001 interviewee:002\nsdiff job:002 interviewee:002\nsdiff job:003 interviewee:002\n\n# ï¼4ï¼ç¨äººå¬å¸æ ¹æ®éåæ¥æ¾ç¬¦åèªå·±èä½è¦æ±çæ±èèï¼è¿åç»æä¸º empty è¡¨ç¤ºè¦æ±çæè½å¨é¨å½ä¸­ï¼\n# æ¯è¾èä½æè½æ¸ååæ±èèæè½æ¸åçå·®å¼\nsdiff interviewee:001 job:001\nsdiff interviewee:002 job:001\n\nsdiff interviewee:001 job:002\nsdiff interviewee:002 job:002\n\nsdiff interviewee:001 job:003\nsdiff interviewee:002 job:003\n\n\n\n# åèèµæ\n\n * å®ç½\n   * redis å®ç½\n   * redis github\n   * redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãredis å®æã\n   * ãredis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * redis å½ä»¤åè\n * æç« \n   * ä¸çå°±æç³»åä¹ è¯¦è§£ redis ç bitmap å¨äº¿çº§é¡¹ç®ä¸­çåºç¨\n   * fast, easy, realtime metrics using redis bitmaps',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Redis æä¹å",frontmatter:{title:"Redis æä¹å",date:"2020-06-24T10:45:38.000Z",categories:["æ°æ®åº","KVæ°æ®åº","Redis"],tags:["æ°æ®åº","KVæ°æ®åº","Redis","æä¹å"],permalink:"/pages/4de901/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/05.KV%E6%95%B0%E6%8D%AE%E5%BA%93/01.Redis/04.Redis%E6%8C%81%E4%B9%85%E5%8C%96.html",relativePath:"12.æ°æ®åº/05.KVæ°æ®åº/01.Redis/04.Redisæä¹å.md",key:"v-80c82fb0",path:"/pages/4de901/",headers:[{level:2,title:"ä¸ãRDB",slug:"ä¸ãrdb",normalizedTitle:"ä¸ãrdb",charIndex:493},{level:3,title:"RDB ç®ä»",slug:"rdb-ç®ä»",normalizedTitle:"rdb ç®ä»",charIndex:503},{level:4,title:"RDB çä¼ç¹",slug:"rdb-çä¼ç¹",normalizedTitle:"rdb çä¼ç¹",charIndex:721},{level:4,title:"RDB çç¼ºç¹",slug:"rdb-çç¼ºç¹",normalizedTitle:"rdb çç¼ºç¹",charIndex:951},{level:3,title:"RDB çåå»º",slug:"rdb-çåå»º",normalizedTitle:"rdb çåå»º",charIndex:1358},{level:4,title:"èªå¨é´éä¿å­",slug:"èªå¨é´éä¿å­",normalizedTitle:"èªå¨é´éä¿å­",charIndex:1625},{level:3,title:"RDB çè½½å¥",slug:"rdb-çè½½å¥",normalizedTitle:"rdb çè½½å¥",charIndex:1950},{level:3,title:"RDB çæä»¶ç»æ",slug:"rdb-çæä»¶ç»æ",normalizedTitle:"rdb çæä»¶ç»æ",charIndex:2173},{level:3,title:"RDB çéç½®",slug:"rdb-çéç½®",normalizedTitle:"rdb çéç½®",charIndex:2329},{level:2,title:"äºãAOF",slug:"äºãaof",normalizedTitle:"äºãaof",charIndex:2773},{level:3,title:"AOF ç®ä»",slug:"aof-ç®ä»",normalizedTitle:"aof ç®ä»",charIndex:2783},{level:4,title:"AOF çä¼ç¹",slug:"aof-çä¼ç¹",normalizedTitle:"aof çä¼ç¹",charIndex:3e3},{level:4,title:"AOF çç¼ºç¹",slug:"aof-çç¼ºç¹",normalizedTitle:"aof çç¼ºç¹",charIndex:3773},{level:3,title:"AOF çåå»º",slug:"aof-çåå»º",normalizedTitle:"aof çåå»º",charIndex:4011},{level:3,title:"AOF çè½½å¥",slug:"aof-çè½½å¥",normalizedTitle:"aof çè½½å¥",charIndex:4613},{level:3,title:"AOF çéå",slug:"aof-çéå",normalizedTitle:"aof çéå",charIndex:4886},{level:4,title:"AOF åå°éå",slug:"aof-åå°éå",normalizedTitle:"aof åå°éå",charIndex:5227},{level:3,title:"AOF çéç½®",slug:"aof-çéç½®",normalizedTitle:"aof çéç½®",charIndex:5884},{level:2,title:"ä¸ãRDB å AOF",slug:"ä¸ãrdb-å-aof",normalizedTitle:"ä¸ãrdb å aof",charIndex:6556},{level:3,title:"å¦ä½éæ©æä¹å",slug:"å¦ä½éæ©æä¹å",normalizedTitle:"å¦ä½éæ©æä¹å",charIndex:6655},{level:3,title:"RDB åæ¢ä¸º AOF",slug:"rdb-åæ¢ä¸º-aof",normalizedTitle:"rdb åæ¢ä¸º aof",charIndex:6886},{level:3,title:"AOF å RDB çç¸äºä½ç¨",slug:"aof-å-rdb-çç¸äºä½ç¨",normalizedTitle:"aof å rdb çç¸äºä½ç¨",charIndex:7350},{level:2,title:"åãRedis å¤ä»½",slug:"åãredis-å¤ä»½",normalizedTitle:"åãredis å¤ä»½",charIndex:7567},{level:3,title:"å¤ä»½è¿ç¨",slug:"å¤ä»½è¿ç¨",normalizedTitle:"å¤ä»½è¿ç¨",charIndex:7626},{level:3,title:"å®¹ç¾å¤ä»½",slug:"å®¹ç¾å¤ä»½",normalizedTitle:"å®¹ç¾å¤ä»½",charIndex:7864},{level:2,title:"äºãè¦ç¹æ»ç»",slug:"äºãè¦ç¹æ»ç»",normalizedTitle:"äºãè¦ç¹æ»ç»",charIndex:7970},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:7983}],headersStr:"ä¸ãRDB RDB ç®ä» RDB çä¼ç¹ RDB çç¼ºç¹ RDB çåå»º èªå¨é´éä¿å­ RDB çè½½å¥ RDB çæä»¶ç»æ RDB çéç½® äºãAOF AOF ç®ä» AOF çä¼ç¹ AOF çç¼ºç¹ AOF çåå»º AOF çè½½å¥ AOF çéå AOF åå°éå AOF çéç½® ä¸ãRDB å AOF å¦ä½éæ©æä¹å RDB åæ¢ä¸º AOF AOF å RDB çç¸äºä½ç¨ åãRedis å¤ä»½ å¤ä»½è¿ç¨ å®¹ç¾å¤ä»½ äºãè¦ç¹æ»ç» åèèµæ",content:"# Redis æä¹å\n\n> Redis æ¯ææä¹åï¼å³ææ°æ®å­å¨å°ç¡¬çä¸­ã\n> \n> Redis æä¾äºä¸¤ç§æä¹åæ¹å¼ï¼\n> \n>  * RDB å¿«ç§ï¼snapshotï¼ - å°å­å¨äºæä¸æ¶å»çæææ°æ®é½åå¥å°ç¡¬çä¸­ã\n>  * åªè¿½å æä»¶ï¼append-only fileï¼AOFï¼ - å®ä¼å¨æ§è¡åå½ä»¤æ¶ï¼å°è¢«æ§è¡çåå½ä»¤å¤å¶å°ç¡¬çä¸­ã\n> \n> è¿ä¸¤ç§æä¹åæ¹å¼æ¢å¯ä»¥åæ¶ä½¿ç¨ï¼ä¹å¯ä»¥åç¬ä½¿ç¨ã\n> \n> å°åå­ä¸­çæ°æ®å­å¨å°ç¡¬ççä¸ä¸ªä¸»è¦åå æ¯ä¸ºäºå¨ä¹åéç¨æ°æ®ï¼æèæ¯ä¸ºäºé²æ­¢ç³»ç»æéèå°æ°æ®å¤ä»½å°ä¸ä¸ªè¿ç¨ä½ç½®ãå¦å¤ï¼å­å¨å¨ Redis éé¢çæ°æ®æå¯è½æ¯ç»è¿é¿æ¶é´è®¡ç®å¾åºçï¼æèæç¨åºæ­£å¨ä½¿ç¨ Redis å­å¨çæ°æ®è¿è¡è®¡ç®ï¼æä»¥ç¨æ·ä¼å¸æèªå·±å¯ä»¥å°è¿äºæ°æ®å­å¨èµ·æ¥ä»¥ä¾¿ä¹åä½¿ç¨ï¼è¿æ ·å°±ä¸å¿éæ°è®¡ç®äºã\n> \n> Redis æä¾äºä¸¤ç§æä¹æ¹å¼ï¼RDB å AOFãä½ å¯ä»¥åæ¶å¼å¯ä¸¤ç§æä¹åæ¹å¼ãå¨è¿ç§æåµä¸, å½ redis éå¯çæ¶åä¼ä¼åè½½å¥ AOF æä»¶æ¥æ¢å¤åå§çæ°æ®ï¼å ä¸ºå¨éå¸¸æåµä¸ AOF æä»¶ä¿å­çæ°æ®éè¦æ¯ RDB æä»¶ä¿å­çæ°æ®éè¦å®æ´ã\n\n\n# ä¸ãRDB\n\n\n# RDB ç®ä»\n\nRDB å³å¿«ç§æ¹å¼ï¼å®å°æä¸ªæ¶é´ç¹çææ Redis æ°æ®ä¿å­å°ä¸ä¸ªç»è¿åç¼©çäºè¿å¶æä»¶ï¼RDB æä»¶ï¼ä¸­ã\n\nåå»º RDB åï¼ç¨æ·å¯ä»¥å¯¹ RDB è¿è¡å¤ä»½ï¼å¯ä»¥å° RDB å¤å¶å°å¶ä»æå¡å¨ä»èåå»ºå·æç¸åæ°æ®çæå¡å¨å¯æ¬ï¼è¿å¯ä»¥å¨éå¯æå¡å¨æ¶ä½¿ç¨ãä¸å¥è¯æ¥è¯´ï¼RDB éåä½ä¸º å·å¤ã\n\nRDB æ¢å¯ä»¥æå¨æ§è¡ï¼ä¹å¯ä»¥æ ¹æ®æå¡å¨éç½®éé¡¹å®ææ§è¡ãè¯¥åè½å¯ä»¥å°æä¸ªæ¶é´ç¹çæ°æ®åºç¶æä¿å­å°ä¸ä¸ª RDB æä»¶ä¸­ã\n\n# RDB çä¼ç¹\n\n * RDB æä»¶éå¸¸ç´§åï¼éåä½ä¸ºå·å¤ãæ¯å¦ä½ å¯ä»¥å¨æ¯ä¸ªå°æ¶æ¥ä¿å­ä¸ä¸è¿å» 24 å°æ¶åçæ°æ®ï¼åæ¶æ¯å¤©ä¿å­è¿å» 30 å¤©çæ°æ®ï¼è¿æ ·å³ä½¿åºäºé®é¢ä½ ä¹å¯ä»¥æ ¹æ®éæ±æ¢å¤å°ä¸åçæ¬çæ°æ®éã\n * å¿«ç§å¨ä¿å­ RDB æä»¶æ¶ç¶è¿ç¨å¯ä¸éè¦åçå°±æ¯ fork åºä¸ä¸ªå­è¿ç¨ï¼æ¥ä¸æ¥çå·¥ä½å¨é¨ç±å­è¿ç¨æ¥åï¼ç¶è¿ç¨ä¸éè¦ååå¶ä» IO æä½ï¼æä»¥å¿«ç§æä¹åæ¹å¼å¯ä»¥æå¤§å Redis çæ§è½ã\n * æ¢å¤å¤§æ°æ®éæ¶ï¼RDB æ¯ AOF æ´å¿«ã\n\n# RDB çç¼ºç¹\n\n * å¦æç³»ç»åçæéï¼å°ä¼ä¸¢å¤±æåä¸æ¬¡åå»ºå¿«ç§ä¹åçæ°æ®ãå¦æä½ å¸æå¨ Redis æå¤åæ­¢å·¥ä½ï¼ä¾å¦çµæºä¸­æ­ï¼çæåµä¸ä¸¢å¤±çæ°æ®æå°çè¯ï¼é£ä¹ å¿«ç§ä¸éåä½ ãè½ç¶ä½ å¯ä»¥éç½®ä¸åç save æ¶é´ç¹(ä¾å¦æ¯é 5 åéå¹¶ä¸å¯¹æ°æ®éæ 100 ä¸ªåçæä½)ï¼æ¯ Redis è¦å®æ´çä¿å­æ´ä¸ªæ°æ®éæ¯ä¸ä¸ªæ¯è¾ç¹éçå·¥ä½ï¼ä½ éå¸¸ä¼æ¯é 5 åéæèæ´ä¹åä¸æ¬¡å®æ´çä¿å­ï¼ä¸ä¸å¨ Redis æå¤å®æºï¼ä½ å¯è½ä¼ä¸¢å¤±å åéçæ°æ®ã\n * å¦ææ°æ®éå¾å¤§ï¼ä¿å­å¿«ç§çæ¶é´ä¼å¾é¿ãå¿«ç§éè¦ç»å¸¸ fork å­è¿ç¨æ¥ä¿å­æ°æ®éå°ç¡¬çä¸ãå½æ°æ®éæ¯è¾å¤§çæ¶åï¼fork çè¿ç¨æ¯éå¸¸èæ¶çï¼å¯è½ä¼å¯¼è´ Redis å¨ä¸äºæ¯«ç§çº§åä¸è½ååºå®¢æ·ç«¯çè¯·æ±ãå¦ææ°æ®éå·¨å¤§å¹¶ä¸ CPU æ§è½ä¸æ¯å¾å¥½çæåµä¸ï¼è¿ç§æåµä¼æç»­ 1 ç§ãAOF ä¹éè¦ forkï¼ä½æ¯ä½ å¯ä»¥è°èéåæ¥å¿æä»¶çé¢çæ¥æé«æ°æ®éçèä¹åº¦ã\n\n\n# RDB çåå»º\n\næä¸¤ä¸ª Redis å½ä»¤å¯ä»¥ç¨äºçæ RDB æä»¶ï¼SAVE å BGSAVEã\n\n * SAVE å½ä»¤ä¼é»å¡ Redis æå¡å¨è¿ç¨ï¼ç´å° RDB åå»ºå®æä¸ºæ­¢ï¼å¨é»å¡æé´ï¼æå¡å¨ä¸è½ååºä»»ä½å½ä»¤è¯·æ±ã\n * BGSAVE å½ä»¤ä¼æ´¾çåºï¼forkï¼ä¸ä¸ªå­è¿ç¨ï¼ç¶åç±å­è¿ç¨è´è´£åå»º RDB æä»¶ï¼æå¡å¨è¿ç¨ï¼ç¶è¿ç¨ï¼ç»§ç»­å¤çå½ä»¤è¯·æ±ã\n\n> ð æ³¨æï¼BGSAVE å½ä»¤æ§è¡æé´ï¼SAVEãBGSAVEãBGREWRITEAOF ä¸ä¸ªå½ä»¤ä¼è¢«æç»ï¼ä»¥åä¸å½åç BGSAVE æä½äº§çç«ææ¡ä»¶ï¼éä½æ§è½ã\n\n# èªå¨é´éä¿å­\n\nRedis åè®¸ç¨æ·éè¿è®¾ç½®æå¡å¨éç½®ç save éé¡¹ï¼è®©æå¡å¨æ¯éä¸æ®µæ¶é´èªå¨æ§è¡ä¸æ¬¡ BGSAVE å½ä»¤ã\n\nç¨æ·å¯ä»¥éè¿ save éé¡¹è®¾ç½®å¤ä¸ªä¿å­æ¡ä»¶ï¼ä½åªè¦å¶ä¸­ä»»æä¸ä¸ªæ¡ä»¶è¢«æ»¡è¶³ï¼æå¡å¨å°±ä¼æ§è¡ BGSAVE å½ä»¤ã\n\nä¸¾ä¾æ¥è¯´ï¼redis.conf ä¸­è®¾ç½®äºå¦ä¸éç½®ï¼\n\nsave 900 1       -- 900 ç§åï¼è³å°å¯¹æ°æ®åºè¿è¡äº 1 æ¬¡ä¿®æ¹\nsave 300 10      -- 300 ç§åï¼è³å°å¯¹æ°æ®åºè¿è¡äº 10 æ¬¡ä¿®æ¹\nsave 60 10000    -- 60 ç§åï¼è³å°å¯¹æ°æ®åºè¿è¡äº 10000 æ¬¡ä¿®æ¹\n\n\nåªè¦æ»¡è¶³ä»¥ä¸ä»»ææ¡ä»¶ï¼Redis æå¡å°±ä¼æ§è¡ BGSAVE å½ä»¤ã\n\n\n# RDB çè½½å¥\n\nRDB æä»¶çè½½å¥å·¥ä½æ¯å¨æå¡å¨å¯å¨æ¶èªå¨æ§è¡çï¼Redis å¹¶æ²¡æä¸é¨ç¨äºè½½å¥ RDB æä»¶çå½ä»¤ã\n\næå¡å¨è½½å¥ RDB æä»¶æé´ï¼ä¼ä¸ç´å¤äºé»å¡ç¶æï¼ç´å°è½½å¥å®æä¸ºæ­¢ã\n\n> ð æ³¨æï¼å ä¸º AOF éå¸¸æ´æ°é¢çæ¯ RDB é«ï¼æä»¥ä¸¢å¤±æ°æ®ç¸å¯¹æ´å°ãåºäºè¿ä¸ªåå ï¼Redis æä»¥ä¸é»è®¤è¡ä¸ºï¼\n> \n>  * åªæå¨å³é­ AOF åè½çæåµä¸ï¼æä¼ä½¿ç¨ RDB è¿åæ°æ®ï¼å¦åä¼åä½¿ç¨ AOF æä»¶æ¥è¿åæ°æ®ã\n\n\n# RDB çæä»¶ç»æ\n\nRDB æä»¶æ¯ä¸ä¸ªç»è¿åç¼©çäºè¿å¶æä»¶ï¼ç±å¤ä¸ªé¨åç»æã\n\nå¯¹äºä¸åç±»åï¼STRINGãHASHãLISTãSETãSORTED SETï¼çé®å¼å¯¹ï¼RDB æä»¶ä¼ä½¿ç¨ä¸åçæ¹å¼æ¥ä¿å­å®ä»¬ã\n\n\n\nRedis æ¬èº«æä¾äºä¸ä¸ª RDB æä»¶æ£æ¥å·¥å· redis-check-dumpã\n\n\n# RDB çéç½®\n\nRedis RDB é»è®¤éç½®å¦ä¸ï¼\n\nsave 900 1\nsave 300 10\nsave 60 10000\nstop-writes-on-bgsave-error yes\nrdbcompression yes\nrdbchecksum yes\ndbfilename dump.rdb\ndir ./\n\n\nRedis çéç½®æä»¶ redis.conf ä¸­ä¸ RDB æå³çéé¡¹ï¼\n\n * save - Redis ä¼æ ¹æ® save éé¡¹ï¼è®©æå¡å¨æ¯éä¸æ®µæ¶é´èªå¨æ§è¡ä¸æ¬¡ BGSAVE å½ä»¤ã\n\n * stop-writes-on-bgsave-error - å½ BGSAVE å½ä»¤åºç°éè¯¯æ¶åæ­¢å RDB æä»¶\n\n * rdbcompression - RDB æä»¶å¼å¯åç¼©åè½ã\n\n * rdbchecksum - å¯¹ RDB æä»¶è¿è¡æ ¡éªã\n\n * dbfilename - RDB æä»¶åã\n\n * dir - RDB æä»¶å AOF æä»¶çå­å¨è·¯å¾ã\n\n\n# äºãAOF\n\n\n# AOF ç®ä»\n\nAOF(Append Only File) æ¯ä»¥ ææ¬æ¥å¿å½¢å¼ å° ææåå½ä»¤ä»¥ Redis å½ä»¤è¯·æ±åè®®æ ¼å¼è¿½å å° AOF æä»¶çæ«å°¾ï¼ä»¥æ­¤æ¥è®°å½æ°æ®çååãå½æå¡å¨éå¯æ¶ï¼ä¼éæ°è½½å¥åæ§è¡ AOF æä»¶ä¸­çå½ä»¤ï¼å°±å¯ä»¥æ¢å¤åå§çæ°æ®ãAOF éåä½ä¸º ç­å¤ã\n\nAOF å¯ä»¥éè¿ appendonly yes éç½®éé¡¹æ¥å¼å¯ã\n\nå½ä»¤è¯·æ±ä¼åä¿å­å° AOF ç¼å²åºä¸­ï¼ä¹ååå®æåå¥å¹¶åæ­¥å° AOF æä»¶ã\n\n# AOF çä¼ç¹\n\n * å¦æç³»ç»åçæéï¼AOF ä¸¢å¤±æ°æ®æ¯ RDB å°ãä½ å¯ä»¥ä½¿ç¨ä¸åç fsync ç­ç¥ï¼æ  fsyncï¼æ¯ç§ fsyncï¼æ¯æ¬¡åçæ¶å fsyncãä½¿ç¨é»è®¤çæ¯ç§ fsync ç­ç¥ï¼Redis çæ§è½ä¾ç¶å¾å¥½(fsync æ¯ç±åå°çº¿ç¨è¿è¡å¤çç,ä¸»çº¿ç¨ä¼å°½åå¤çå®¢æ·ç«¯è¯·æ±)ï¼ä¸æ¦åºç°æéï¼ä½ æå¤ä¸¢å¤± 1 ç§çæ°æ®ã\n * AOF æä»¶å¯ä¿®å¤ - AOF æä»¶æ¯ä¸ä¸ªåªè¿è¡è¿½å çæ¥å¿æä»¶ï¼æä»¥ä¸éè¦åå¥ seekï¼å³ä½¿ç±äºæäºåå (ç£çç©ºé´å·²æ»¡ï¼åçè¿ç¨ä¸­å®æºç­ç­)æªæ§è¡å®æ´çåå¥å½ä»¤ï¼ä½ ä¹ä¹å¯ä½¿ç¨ redis-check-aof å·¥å·ä¿®å¤è¿äºé®é¢ã\n * AOF æä»¶å¯åç¼©ãRedis å¯ä»¥å¨ AOF æä»¶ä½ç§¯åå¾è¿å¤§æ¶ï¼èªå¨å°å¨åå°å¯¹ AOF è¿è¡éåï¼éååçæ° AOF æä»¶åå«äºæ¢å¤å½åæ°æ®éæéçæå°å½ä»¤éåãæ´ä¸ªéåæä½æ¯ç»å¯¹å®å¨çï¼å ä¸º Redis å¨åå»ºæ° AOF æä»¶çè¿ç¨ä¸­ï¼ä¼ç»§ç»­å°å½ä»¤è¿½å å°ç°æç AOF æä»¶éé¢ï¼å³ä½¿éåè¿ç¨ä¸­åçåæºï¼ç°æç AOF æä»¶ä¹ä¸ä¼ä¸¢å¤±ãèä¸æ¦æ° AOF æä»¶åå»ºå®æ¯ï¼Redis å°±ä¼ä»æ§ AOF æä»¶åæ¢å°æ° AOF æä»¶ï¼å¹¶å¼å§å¯¹æ° AOF æä»¶è¿è¡è¿½å æä½ã\n * AOF æä»¶å¯è¯» - AOF æä»¶æåºå°ä¿å­äºå¯¹æ°æ®åºæ§è¡çææåå¥æä½ï¼è¿äºåå¥æä½ä»¥ Redis å½ä»¤çæ ¼å¼ä¿å­ãå æ­¤ AOF æä»¶çåå®¹éå¸¸å®¹æè¢«äººè¯»æï¼å¯¹æä»¶è¿è¡åæï¼parseï¼ä¹å¾è½»æ¾ã å¯¼åºï¼exportï¼ AOF æä»¶ä¹éå¸¸ç®åãä¸¾ä¸ªä¾å­ï¼å¦æä½ ä¸å°å¿æ§è¡äº FLUSHALL å½ä»¤ï¼ä½åªè¦ AOF æä»¶æªè¢«éåï¼é£ä¹åªè¦åæ­¢æå¡å¨ï¼ç§»é¤ AOF æä»¶æ«å°¾ç FLUSHALL å½ä»¤ï¼å¹¶éå¯ Redis ï¼å°±å¯ä»¥å°æ°æ®éæ¢å¤å° FLUSHALL æ§è¡ä¹åçç¶æã\n\n# AOF çç¼ºç¹\n\n * AOF æä»¶ä½ç§¯ä¸è¬æ¯ RDB å¤§ - å¯¹äºç¸åçæ°æ®éæ¥è¯´ï¼AOF æä»¶çä½ç§¯éå¸¸è¦å¤§äº RDB æä»¶çä½ç§¯ã\n * æ¢å¤å¤§æ°æ®éæ¶ï¼AOF æ¯ RDB æ¢ã - æ ¹æ®æä½¿ç¨ç fsync ç­ç¥ï¼AOF çéåº¦å¯è½ä¼æ¢äºå¿«ç§ãå¨ä¸è¬æåµä¸ï¼æ¯ç§ fsync çæ§è½ä¾ç¶éå¸¸é«ï¼èå³é­ fsync å¯ä»¥è®© AOF çéåº¦åå¿«ç§ä¸æ ·å¿«ï¼å³ä½¿å¨é«è´è·ä¹ä¸ä¹æ¯å¦æ­¤ãä¸è¿å¨å¤çå·¨å¤§çåå¥è½½å¥æ¶ï¼å¿«ç§å¯ä»¥æä¾æ´æä¿è¯çæå¤§å»¶è¿æ¶é´ï¼latencyï¼ã\n\n\n# AOF çåå»º\n\nRedis å½ä»¤è¯·æ±ä¼åä¿å­å° AOF ç¼å²åºï¼åå®æåå¥å¹¶åæ­¥å° AOF æä»¶ã\n\nAOF çå®ç°å¯ä»¥åä¸ºå½ä»¤è¿½å ï¼appendï¼ãæä»¶åå¥ãæä»¶åæ­¥ï¼syncï¼ä¸ä¸ªæ­¥éª¤ã\n\n * å½ä»¤è¿½å  - å½ Redis æå¡å¨å¼å¯ AOF åè½æ¶ï¼æå¡å¨å¨æ§è¡å®ä¸ä¸ªåå½ä»¤åï¼ä¼ä»¥ Redis å½ä»¤åè®®æ ¼å¼å°è¢«æ§è¡çåå½ä»¤è¿½å å° AOF ç¼å²åºçæ«å°¾ã\n * æä»¶åå¥åæä»¶åæ­¥ - Redis çæå¡å¨è¿ç¨å°±æ¯ä¸ä¸ªäºä»¶å¾ªç¯ï¼è¿ä¸ªå¾ªç¯ä¸­çæä»¶äºä»¶è´è´£æ¥æ¶å®¢æ·ç«¯çå½ä»¤è¯·æ±ï¼ä»¥ååå®¢æ·ç«¯åéå½ä»¤åå¤ãèæ¶é´äºä»¶åè´è´£æ§è¡å®æ¶è¿è¡çå½æ°ãå ä¸ºæå¡å¨å¨å¤çæä»¶äºä»¶æ¶å¯è½ä¼æ§è¡åå½ä»¤ï¼è¿äºåå½ä»¤ä¼è¢«è¿½å å° AOF ç¼å²åºï¼æå¡å¨æ¯æ¬¡ç»æäºä»¶å¾ªç¯åï¼é½ä¼æ ¹æ® appendfsync éé¡¹æ¥å¤æ­ AOF ç¼å²åºåå®¹æ¯å¦éè¦åå¥ååæ­¥å° AOF æä»¶ä¸­ã\n\nappendfsync ä¸åéé¡¹å³å®äºä¸åçæä¹åè¡ä¸ºï¼\n\n * always - å°ç¼å²åºææåå®¹åå¥å¹¶åæ­¥å° AOF æä»¶ã\n * everysec - å°ç¼å²åºææåå®¹åå¥å° AOF æä»¶ï¼å¦æä¸æ¬¡åæ­¥ AOF æä»¶çæ¶é´è·ç¦»ç°å¨è¶è¿ä¸ç§éï¼é£ä¹åæ¬¡å¯¹ AOF æä»¶è¿è¡åæ­¥ï¼è¿ä¸ªåæ­¥æä½æ¯æä¸ä¸ªçº¿ç¨ä¸é¨è´è´£æ§è¡çã\n * no - å°ç¼å²åºææåå®¹åå¥å° AOF æä»¶ï¼ä½å¹¶ä¸å¯¹ AOF æä»¶è¿è¡åæ­¥ï¼ä½æ¶åæ­¥ç±æä½ç³»ç»å³å®ã\n\n\n# AOF çè½½å¥\n\nå ä¸º AOF æä»¶ä¸­åå«äºéå»ºæ°æ®åºæéçææåå½ä»¤ï¼æä»¥æå¡å¨åªè¦è½½å¥å¹¶æ§è¡ä¸é AOF æä»¶ä¸­ä¿å­çåå½ä»¤ï¼å°±å¯ä»¥è¿åæå¡å¨å³é­åçæ°æ®åºç¶æã\n\nAOF è½½å¥è¿ç¨å¦ä¸ï¼\n\n 1. æå¡å¨å¯å¨è½½å¥ç¨åºã\n 2. åå»ºä¸ä¸ªä¼ªå®¢æ·ç«¯ãå ä¸º Redis å½ä»¤åªè½å¨å®¢æ·ç«¯ä¸ä¸æä¸­æ§è¡ï¼æä»¥éè¦åå»ºä¸ä¸ªä¼ªå®¢æ·ç«¯æ¥è½½å¥ãæ§è¡ AOF æä»¶ä¸­è®°å½çå½ä»¤ã\n 3. ä» AOF æä»¶ä¸­åæå¹¶è¯»åä¸æ¡åå½ä»¤ã\n 4. ä½¿ç¨ä¼ªå®¢æ·ç«¯æ§è¡åå½ä»¤ã\n 5. å¾ªç¯æ§è¡æ­¥éª¤ 3ã4ï¼ç´å°ææåå½ä»¤é½è¢«å¤çå®æ¯ä¸ºæ­¢ã\n 6. è½½å¥å®æ¯ã\n\n\n\n\n# AOF çéå\n\néç Redis ä¸æ­è¿è¡ï¼AOF çä½ç§¯ä¹ä¼ä¸æ­å¢é¿ï¼è¿å°å¯¼è´ä¸¤ä¸ªé®é¢ï¼\n\n * AOF èå°½ç£çå¯ç¨ç©ºé´ã\n * Redis éå¯åéè¦æ§è¡ AOF æä»¶è®°å½çææåå½ä»¤æ¥è¿åæ°æ®éï¼å¦æ AOF è¿å¤§ï¼åè¿åæä½æ§è¡çæ¶é´å°±ä¼éå¸¸é¿ã\n\nä¸ºäºè§£å³ AOF ä½ç§¯è¨èé®é¢ï¼Redis æä¾äº AOF éååè½ï¼æ¥å¯¹ AOF æä»¶è¿è¡åç¼©ãAOF éåå¯ä»¥äº§çä¸ä¸ªæ°ç AOF æä»¶ï¼è¿ä¸ªæ°ç AOF æä»¶ååæ¥ç AOF æä»¶æä¿å­çæ°æ®åºç¶æä¸è´ï¼ä½ä½ç§¯æ´å°ã\n\nAOF éåå¹¶éè¯»åååæç°æ AOF æä»¶çåå®¹ï¼èæ¯ç´æ¥ä»æ°æ®åºä¸­è¯»åå½åçæ°æ®åºç¶æãå³ä¾æ¬¡è¯»åæ°æ®åºä¸­çæ¯ä¸ªé®å¼å¯¹ï¼ç¶åç¨ä¸æ¡å½ä»¤å»è®°å½è¯¥é®å¼å¯¹ï¼ä»¥æ­¤ä»£æ¿ä¹åå¯è½å­å¨åä½çå½ä»¤ã\n\n# AOF åå°éå\n\nä½ä¸ºä¸ç§è¾å©æ§åè½ï¼æ¾ç¶ Redis å¹¶ä¸æ³å¨ AOF éåæ¶é»å¡ Redis æå¡æ¥æ¶å¶ä»å½ä»¤ãå æ­¤ï¼Redis å³å®éè¿ BGREWRITEAOF å½ä»¤åå»ºä¸ä¸ªå­è¿ç¨ï¼ç¶åç±å­è¿ç¨è´è´£å¯¹ AOF æä»¶è¿è¡éåï¼è¿ä¸ BGSAVE åçç±»ä¼¼ã\n\n * å¨æ§è¡ BGREWRITEAOF å½ä»¤æ¶ï¼Redis æå¡å¨ä¼ç»´æ¤ä¸ä¸ª AOF éåç¼å²åºãå½ AOF éåå­è¿ç¨å¼å§å·¥ä½åï¼Redis æ¯æ§è¡å®ä¸ä¸ªåå½ä»¤ï¼ä¼åæ¶å°è¿ä¸ªå½ä»¤åéç» AOF ç¼å²åºå AOF éåç¼å²åºã\n * ç±äºå½¼æ­¤ä¸æ¯å¨åä¸ä¸ªè¿ç¨ä¸­å·¥ä½ï¼AOF éåä¸å½±å AOF åå¥ååæ­¥ãå½å­è¿ç¨å®æåå»ºæ° AOF æä»¶çå·¥ä½ä¹åï¼æå¡å¨ä¼å°éåç¼å²åºä¸­çææåå®¹è¿½å å°æ° AOF æä»¶çæ«å°¾ï¼ä½¿å¾æ°æ§ä¸¤ä¸ª AOF æä»¶æä¿å­çæ°æ®åºç¶æä¸è´ã\n * æåï¼æå¡å¨ç¨æ°ç AOF æä»¶æ¿æ¢å°±ç AOF æä»¶ï¼ä»¥æ­¤æ¥å®æ AOF éåæä½ã\n\n\n\nå¯ä»¥éè¿è®¾ç½® auto-aof-rewrite-percentage å auto-aof-rewrite-min-sizeï¼ä½¿å¾ Redis å¨æ»¡è¶³æ¡ä»¶æ¶ï¼èªå¨æ§è¡ BGREWRITEAOFã\n\nåè®¾éç½®å¦ä¸ï¼\n\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\n\n\nè¡¨æï¼å½ AOF å¤§äº 64MBï¼ä¸ AOF ä½ç§¯æ¯ä¸ä¸æ¬¡éååçä½ç§¯å¤§äºè³å° 100% æ¶ï¼æ§è¡ BGREWRITEAOFã\n\n\n# AOF çéç½®\n\nAOF çé»è®¤éç½®ï¼\n\nappendonly no\nappendfsync everysec\nno-appendfsync-on-rewrite no\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\n\n\nAOF æä¹åéè¿å¨ redis.conf ä¸­ç appendonly yes éç½®éé¡¹æ¥å¼å¯ã\n\n * appendonly - å¼å¯ AOF åè½ã\n * appendfilename - AOF æä»¶åã\n * appendfsync - ç¨äºè®¾ç½®åæ­¥é¢çï¼å®æä»¥ä¸å¯éé¡¹ï¼\n   * always - æ¯ä¸ª Redis åå½ä»¤é½è¦åæ­¥åå¥ç¡¬çãè¿æ ·åä¼ä¸¥ééä½ Redis çéåº¦ã\n   * everysec - æ¯ç§æ§è¡ä¸æ¬¡åæ­¥ï¼æ¾ç¤ºå°å°å¤ä¸ªåå½ä»¤åæ­¥å°ç¡¬çãä¸ºäºå¼é¡¾æ°æ®å®å¨ååå¥æ§è½ï¼æ¨èä½¿ç¨ appendfsync everysec éé¡¹ãRedis æ¯ç§åæ­¥ä¸æ¬¡ AOF æä»¶æ¶çæ§è½åä¸ä½¿ç¨ä»»ä½æä¹åç¹æ§æ¶çæ§è½ç¸å·®æ å ã\n   * no - è®©æä½ç³»ç»æ¥å³å®åºè¯¥ä½æ¶è¿è¡åæ­¥ã\n * no-appendfsync-on-rewrite - AOF éåæ¶ä¸æ¯æè¿½å å½ä»¤ã\n * auto-aof-rewrite-percentage - AOF éåç¾åæ¯ã\n * auto-aof-rewrite-min-size - AOF éåæä»¶çæå°å¤§å°ã\n * dir - RDB æä»¶å AOF æä»¶çå­å¨è·¯å¾ã\n\n\n# ä¸ãRDB å AOF\n\n> å½ Redis å¯å¨æ¶ï¼ å¦æ RDB å AOF åè½é½å¼å¯äºï¼é£ä¹ç¨åºä¼ä¼åä½¿ç¨ AOF æä»¶æ¥æ¢å¤æ°æ®éï¼å ä¸º AOF æä»¶æä¿å­çæ°æ®éå¸¸æ¯æå®æ´çã\n\n\n# å¦ä½éæ©æä¹å\n\n * å¦æä¸å³å¿æ°æ®ä¸¢å¤±ï¼å¯ä»¥ä¸æä¹åã\n * å¦æå¯ä»¥æ¿åæ°åéä»¥åçæ°æ®ä¸¢å¤±ï¼å¯ä»¥åªä½¿ç¨ RDBã\n * å¦æä¸è½æ¿åæ°åéä»¥åçæ°æ®ä¸¢å¤±ï¼å¯ä»¥åæ¶ä½¿ç¨ RDB å AOFã\n\næå¾å¤ç¨æ·é½åªä½¿ç¨ AOF æä¹åï¼ ä½å¹¶ä¸æ¨èè¿ç§æ¹å¼ï¼ å ä¸ºå®æ¶çæ RDB å¿«ç§ï¼snapshotï¼éå¸¸ä¾¿äºè¿è¡æ°æ®åºå¤ä»½ï¼å¹¶ä¸å¿«ç§æ¢å¤æ°æ®éçéåº¦ä¹è¦æ¯ AOF æ¢å¤çéåº¦è¦å¿«ï¼é¤æ­¤ä¹å¤ï¼ä½¿ç¨å¿«ç§è¿å¯ä»¥é¿åä¹åæå°ç AOF ç¨åºç bug ã\n\n\n# RDB åæ¢ä¸º AOF\n\nå¨ Redis 2.2 æä»¥ä¸çæ¬ï¼å¯ä»¥å¨ä¸éå¯çæåµä¸ï¼ä» RDB åæ¢ä¸º AOF ï¼\n\n * ä¸ºææ°ç dump.rdb æä»¶åå»ºä¸ä¸ªå¤ä»½ã\n * å°å¤ä»½æ¾å°ä¸ä¸ªå®å¨çå°æ¹ã\n * æ§è¡ä»¥ä¸ä¸¤æ¡å½ä»¤:\n * redis-cli config set appendonly yes\n * redis-cli config set save\n * ç¡®ä¿åå½ä»¤ä¼è¢«æ­£ç¡®å°è¿½å å° AOF æä»¶çæ«å°¾ã\n * æ§è¡çç¬¬ä¸æ¡å½ä»¤å¼å¯äº AOF åè½ï¼ Redis ä¼é»å¡ç´å°åå§ AOF æä»¶åå»ºå®æä¸ºæ­¢ï¼ ä¹å Redis ä¼ç»§ç»­å¤çå½ä»¤è¯·æ±ï¼ å¹¶å¼å§å°åå¥å½ä»¤è¿½å å° AOF æä»¶æ«å°¾ã\n\næ§è¡çç¬¬äºæ¡å½ä»¤ç¨äºå³é­å¿«ç§åè½ã è¿ä¸æ­¥æ¯å¯éçï¼ å¦æä½ æ¿æçè¯ï¼ ä¹å¯ä»¥åæ¶ä½¿ç¨å¿«ç§å AOF è¿ä¸¤ç§æä¹ååè½ã\n\n> ð éè¦ï¼å«å¿äºå¨ redis.conf ä¸­æå¼ AOF åè½ï¼å¦åçè¯ï¼æå¡å¨éå¯ä¹åï¼ä¹åéè¿ CONFIG SET è®¾ç½®çéç½®å°±ä¼è¢«éå¿ï¼ç¨åºä¼æåæ¥çéç½®æ¥å¯å¨æå¡å¨ã\n\n\n# AOF å RDB çç¸äºä½ç¨\n\nBGSAVE å BGREWRITEAOF å½ä»¤ä¸å¯ä»¥åæ¶æ§è¡ãè¿æ¯ä¸ºäºé¿åä¸¤ä¸ª Redis åå°è¿ç¨åæ¶å¯¹ç£çè¿è¡å¤§éç I/O æä½ã\n\nå¦æ BGSAVE æ­£å¨æ§è¡ï¼å¹¶ä¸ç¨æ·æ¾ç¤ºå°è°ç¨ BGREWRITEAOF å½ä»¤ï¼é£ä¹æå¡å¨å°åç¨æ·åå¤ä¸ä¸ª OK ç¶æï¼å¹¶åç¥ç¨æ·ï¼BGREWRITEAOF å·²ç»è¢«é¢å®æ§è¡ãä¸æ¦ BGSAVE æ§è¡å®æ¯ï¼ BGREWRITEAOF å°±ä¼æ­£å¼å¼å§ã\n\n\n# åãRedis å¤ä»½\n\nåºè¯¥ç¡®ä¿ Redis æ°æ®æå®æ´çå¤ä»½ã\n\nå¤ä»½ Redis æ°æ®å»ºè®®éç¨ RDBã\n\n\n# å¤ä»½è¿ç¨\n\n 1. åå»ºä¸ä¸ªå®æä»»å¡ï¼cron jobï¼ï¼æ¯å°æ¶å°ä¸ä¸ª RDB æä»¶å¤ä»½å°ä¸ä¸ªæä»¶å¤¹ï¼å¹¶ä¸æ¯å¤©å°ä¸ä¸ª RDB æä»¶å¤ä»½å°å¦ä¸ä¸ªæä»¶å¤¹ã\n 2. ç¡®ä¿å¿«ç§çå¤ä»½é½å¸¦æç¸åºçæ¥æåæ¶é´ä¿¡æ¯ï¼æ¯æ¬¡æ§è¡å®æä»»å¡èæ¬æ¶ï¼ä½¿ç¨ find å½ä»¤æ¥å é¤è¿æçå¿«ç§ï¼æ¯å¦è¯´ï¼ä½ å¯ä»¥ä¿çæè¿ 48 å°æ¶åçæ¯å°æ¶å¿«ç§ï¼è¿å¯ä»¥ä¿çæè¿ä¸ä¸¤ä¸ªæçæ¯æ¥å¿«ç§ã\n 3. è³å°æ¯å¤©ä¸æ¬¡ï¼å° RDB å¤ä»½å°ä½ çæ°æ®ä¸­å¿ä¹å¤ï¼æèè³å°æ¯å¤ä»½å°ä½ è¿è¡ Redis æå¡å¨çç©çæºå¨ä¹å¤ã\n\n\n# å®¹ç¾å¤ä»½\n\nRedis çå®¹ç¾å¤ä»½åºæ¬ä¸å°±æ¯å¯¹æ°æ®è¿è¡å¤ä»½ï¼å¹¶å°è¿äºå¤ä»½ä¼ éå°å¤ä¸ªä¸åçå¤é¨æ°æ®ä¸­å¿ã\n\nå®¹ç¾å¤ä»½å¯ä»¥å¨ Redis è¿è¡å¹¶äº§çå¿«ç§çä¸»æ°æ®ä¸­å¿åçä¸¥éçé®é¢æ¶ï¼ä»ç¶è®©æ°æ®å¤äºå®å¨ç¶æã\n\n\n# äºãè¦ç¹æ»ç»\n\n\n\n\n# åèèµæ\n\n * å®ç½\n   * Redis å®ç½\n   * Redis github\n   * Redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãRedis å®æã\n   * ãRedis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * Redis å½ä»¤åè",normalizedContent:"# redis æä¹å\n\n> redis æ¯ææä¹åï¼å³ææ°æ®å­å¨å°ç¡¬çä¸­ã\n> \n> redis æä¾äºä¸¤ç§æä¹åæ¹å¼ï¼\n> \n>  * rdb å¿«ç§ï¼snapshotï¼ - å°å­å¨äºæä¸æ¶å»çæææ°æ®é½åå¥å°ç¡¬çä¸­ã\n>  * åªè¿½å æä»¶ï¼append-only fileï¼aofï¼ - å®ä¼å¨æ§è¡åå½ä»¤æ¶ï¼å°è¢«æ§è¡çåå½ä»¤å¤å¶å°ç¡¬çä¸­ã\n> \n> è¿ä¸¤ç§æä¹åæ¹å¼æ¢å¯ä»¥åæ¶ä½¿ç¨ï¼ä¹å¯ä»¥åç¬ä½¿ç¨ã\n> \n> å°åå­ä¸­çæ°æ®å­å¨å°ç¡¬ççä¸ä¸ªä¸»è¦åå æ¯ä¸ºäºå¨ä¹åéç¨æ°æ®ï¼æèæ¯ä¸ºäºé²æ­¢ç³»ç»æéèå°æ°æ®å¤ä»½å°ä¸ä¸ªè¿ç¨ä½ç½®ãå¦å¤ï¼å­å¨å¨ redis éé¢çæ°æ®æå¯è½æ¯ç»è¿é¿æ¶é´è®¡ç®å¾åºçï¼æèæç¨åºæ­£å¨ä½¿ç¨ redis å­å¨çæ°æ®è¿è¡è®¡ç®ï¼æä»¥ç¨æ·ä¼å¸æèªå·±å¯ä»¥å°è¿äºæ°æ®å­å¨èµ·æ¥ä»¥ä¾¿ä¹åä½¿ç¨ï¼è¿æ ·å°±ä¸å¿éæ°è®¡ç®äºã\n> \n> redis æä¾äºä¸¤ç§æä¹æ¹å¼ï¼rdb å aofãä½ å¯ä»¥åæ¶å¼å¯ä¸¤ç§æä¹åæ¹å¼ãå¨è¿ç§æåµä¸, å½ redis éå¯çæ¶åä¼ä¼åè½½å¥ aof æä»¶æ¥æ¢å¤åå§çæ°æ®ï¼å ä¸ºå¨éå¸¸æåµä¸ aof æä»¶ä¿å­çæ°æ®éè¦æ¯ rdb æä»¶ä¿å­çæ°æ®éè¦å®æ´ã\n\n\n# ä¸ãrdb\n\n\n# rdb ç®ä»\n\nrdb å³å¿«ç§æ¹å¼ï¼å®å°æä¸ªæ¶é´ç¹çææ redis æ°æ®ä¿å­å°ä¸ä¸ªç»è¿åç¼©çäºè¿å¶æä»¶ï¼rdb æä»¶ï¼ä¸­ã\n\nåå»º rdb åï¼ç¨æ·å¯ä»¥å¯¹ rdb è¿è¡å¤ä»½ï¼å¯ä»¥å° rdb å¤å¶å°å¶ä»æå¡å¨ä»èåå»ºå·æç¸åæ°æ®çæå¡å¨å¯æ¬ï¼è¿å¯ä»¥å¨éå¯æå¡å¨æ¶ä½¿ç¨ãä¸å¥è¯æ¥è¯´ï¼rdb éåä½ä¸º å·å¤ã\n\nrdb æ¢å¯ä»¥æå¨æ§è¡ï¼ä¹å¯ä»¥æ ¹æ®æå¡å¨éç½®éé¡¹å®ææ§è¡ãè¯¥åè½å¯ä»¥å°æä¸ªæ¶é´ç¹çæ°æ®åºç¶æä¿å­å°ä¸ä¸ª rdb æä»¶ä¸­ã\n\n# rdb çä¼ç¹\n\n * rdb æä»¶éå¸¸ç´§åï¼éåä½ä¸ºå·å¤ãæ¯å¦ä½ å¯ä»¥å¨æ¯ä¸ªå°æ¶æ¥ä¿å­ä¸ä¸è¿å» 24 å°æ¶åçæ°æ®ï¼åæ¶æ¯å¤©ä¿å­è¿å» 30 å¤©çæ°æ®ï¼è¿æ ·å³ä½¿åºäºé®é¢ä½ ä¹å¯ä»¥æ ¹æ®éæ±æ¢å¤å°ä¸åçæ¬çæ°æ®éã\n * å¿«ç§å¨ä¿å­ rdb æä»¶æ¶ç¶è¿ç¨å¯ä¸éè¦åçå°±æ¯ fork åºä¸ä¸ªå­è¿ç¨ï¼æ¥ä¸æ¥çå·¥ä½å¨é¨ç±å­è¿ç¨æ¥åï¼ç¶è¿ç¨ä¸éè¦ååå¶ä» io æä½ï¼æä»¥å¿«ç§æä¹åæ¹å¼å¯ä»¥æå¤§å redis çæ§è½ã\n * æ¢å¤å¤§æ°æ®éæ¶ï¼rdb æ¯ aof æ´å¿«ã\n\n# rdb çç¼ºç¹\n\n * å¦æç³»ç»åçæéï¼å°ä¼ä¸¢å¤±æåä¸æ¬¡åå»ºå¿«ç§ä¹åçæ°æ®ãå¦æä½ å¸æå¨ redis æå¤åæ­¢å·¥ä½ï¼ä¾å¦çµæºä¸­æ­ï¼çæåµä¸ä¸¢å¤±çæ°æ®æå°çè¯ï¼é£ä¹ å¿«ç§ä¸éåä½ ãè½ç¶ä½ å¯ä»¥éç½®ä¸åç save æ¶é´ç¹(ä¾å¦æ¯é 5 åéå¹¶ä¸å¯¹æ°æ®éæ 100 ä¸ªåçæä½)ï¼æ¯ redis è¦å®æ´çä¿å­æ´ä¸ªæ°æ®éæ¯ä¸ä¸ªæ¯è¾ç¹éçå·¥ä½ï¼ä½ éå¸¸ä¼æ¯é 5 åéæèæ´ä¹åä¸æ¬¡å®æ´çä¿å­ï¼ä¸ä¸å¨ redis æå¤å®æºï¼ä½ å¯è½ä¼ä¸¢å¤±å åéçæ°æ®ã\n * å¦ææ°æ®éå¾å¤§ï¼ä¿å­å¿«ç§çæ¶é´ä¼å¾é¿ãå¿«ç§éè¦ç»å¸¸ fork å­è¿ç¨æ¥ä¿å­æ°æ®éå°ç¡¬çä¸ãå½æ°æ®éæ¯è¾å¤§çæ¶åï¼fork çè¿ç¨æ¯éå¸¸èæ¶çï¼å¯è½ä¼å¯¼è´ redis å¨ä¸äºæ¯«ç§çº§åä¸è½ååºå®¢æ·ç«¯çè¯·æ±ãå¦ææ°æ®éå·¨å¤§å¹¶ä¸ cpu æ§è½ä¸æ¯å¾å¥½çæåµä¸ï¼è¿ç§æåµä¼æç»­ 1 ç§ãaof ä¹éè¦ forkï¼ä½æ¯ä½ å¯ä»¥è°èéåæ¥å¿æä»¶çé¢çæ¥æé«æ°æ®éçèä¹åº¦ã\n\n\n# rdb çåå»º\n\næä¸¤ä¸ª redis å½ä»¤å¯ä»¥ç¨äºçæ rdb æä»¶ï¼save å bgsaveã\n\n * save å½ä»¤ä¼é»å¡ redis æå¡å¨è¿ç¨ï¼ç´å° rdb åå»ºå®æä¸ºæ­¢ï¼å¨é»å¡æé´ï¼æå¡å¨ä¸è½ååºä»»ä½å½ä»¤è¯·æ±ã\n * bgsave å½ä»¤ä¼æ´¾çåºï¼forkï¼ä¸ä¸ªå­è¿ç¨ï¼ç¶åç±å­è¿ç¨è´è´£åå»º rdb æä»¶ï¼æå¡å¨è¿ç¨ï¼ç¶è¿ç¨ï¼ç»§ç»­å¤çå½ä»¤è¯·æ±ã\n\n> ð æ³¨æï¼bgsave å½ä»¤æ§è¡æé´ï¼saveãbgsaveãbgrewriteaof ä¸ä¸ªå½ä»¤ä¼è¢«æç»ï¼ä»¥åä¸å½åç bgsave æä½äº§çç«ææ¡ä»¶ï¼éä½æ§è½ã\n\n# èªå¨é´éä¿å­\n\nredis åè®¸ç¨æ·éè¿è®¾ç½®æå¡å¨éç½®ç save éé¡¹ï¼è®©æå¡å¨æ¯éä¸æ®µæ¶é´èªå¨æ§è¡ä¸æ¬¡ bgsave å½ä»¤ã\n\nç¨æ·å¯ä»¥éè¿ save éé¡¹è®¾ç½®å¤ä¸ªä¿å­æ¡ä»¶ï¼ä½åªè¦å¶ä¸­ä»»æä¸ä¸ªæ¡ä»¶è¢«æ»¡è¶³ï¼æå¡å¨å°±ä¼æ§è¡ bgsave å½ä»¤ã\n\nä¸¾ä¾æ¥è¯´ï¼redis.conf ä¸­è®¾ç½®äºå¦ä¸éç½®ï¼\n\nsave 900 1       -- 900 ç§åï¼è³å°å¯¹æ°æ®åºè¿è¡äº 1 æ¬¡ä¿®æ¹\nsave 300 10      -- 300 ç§åï¼è³å°å¯¹æ°æ®åºè¿è¡äº 10 æ¬¡ä¿®æ¹\nsave 60 10000    -- 60 ç§åï¼è³å°å¯¹æ°æ®åºè¿è¡äº 10000 æ¬¡ä¿®æ¹\n\n\nåªè¦æ»¡è¶³ä»¥ä¸ä»»ææ¡ä»¶ï¼redis æå¡å°±ä¼æ§è¡ bgsave å½ä»¤ã\n\n\n# rdb çè½½å¥\n\nrdb æä»¶çè½½å¥å·¥ä½æ¯å¨æå¡å¨å¯å¨æ¶èªå¨æ§è¡çï¼redis å¹¶æ²¡æä¸é¨ç¨äºè½½å¥ rdb æä»¶çå½ä»¤ã\n\næå¡å¨è½½å¥ rdb æä»¶æé´ï¼ä¼ä¸ç´å¤äºé»å¡ç¶æï¼ç´å°è½½å¥å®æä¸ºæ­¢ã\n\n> ð æ³¨æï¼å ä¸º aof éå¸¸æ´æ°é¢çæ¯ rdb é«ï¼æä»¥ä¸¢å¤±æ°æ®ç¸å¯¹æ´å°ãåºäºè¿ä¸ªåå ï¼redis æä»¥ä¸é»è®¤è¡ä¸ºï¼\n> \n>  * åªæå¨å³é­ aof åè½çæåµä¸ï¼æä¼ä½¿ç¨ rdb è¿åæ°æ®ï¼å¦åä¼åä½¿ç¨ aof æä»¶æ¥è¿åæ°æ®ã\n\n\n# rdb çæä»¶ç»æ\n\nrdb æä»¶æ¯ä¸ä¸ªç»è¿åç¼©çäºè¿å¶æä»¶ï¼ç±å¤ä¸ªé¨åç»æã\n\nå¯¹äºä¸åç±»åï¼stringãhashãlistãsetãsorted setï¼çé®å¼å¯¹ï¼rdb æä»¶ä¼ä½¿ç¨ä¸åçæ¹å¼æ¥ä¿å­å®ä»¬ã\n\n\n\nredis æ¬èº«æä¾äºä¸ä¸ª rdb æä»¶æ£æ¥å·¥å· redis-check-dumpã\n\n\n# rdb çéç½®\n\nredis rdb é»è®¤éç½®å¦ä¸ï¼\n\nsave 900 1\nsave 300 10\nsave 60 10000\nstop-writes-on-bgsave-error yes\nrdbcompression yes\nrdbchecksum yes\ndbfilename dump.rdb\ndir ./\n\n\nredis çéç½®æä»¶ redis.conf ä¸­ä¸ rdb æå³çéé¡¹ï¼\n\n * save - redis ä¼æ ¹æ® save éé¡¹ï¼è®©æå¡å¨æ¯éä¸æ®µæ¶é´èªå¨æ§è¡ä¸æ¬¡ bgsave å½ä»¤ã\n\n * stop-writes-on-bgsave-error - å½ bgsave å½ä»¤åºç°éè¯¯æ¶åæ­¢å rdb æä»¶\n\n * rdbcompression - rdb æä»¶å¼å¯åç¼©åè½ã\n\n * rdbchecksum - å¯¹ rdb æä»¶è¿è¡æ ¡éªã\n\n * dbfilename - rdb æä»¶åã\n\n * dir - rdb æä»¶å aof æä»¶çå­å¨è·¯å¾ã\n\n\n# äºãaof\n\n\n# aof ç®ä»\n\naof(append only file) æ¯ä»¥ ææ¬æ¥å¿å½¢å¼ å° ææåå½ä»¤ä»¥ redis å½ä»¤è¯·æ±åè®®æ ¼å¼è¿½å å° aof æä»¶çæ«å°¾ï¼ä»¥æ­¤æ¥è®°å½æ°æ®çååãå½æå¡å¨éå¯æ¶ï¼ä¼éæ°è½½å¥åæ§è¡ aof æä»¶ä¸­çå½ä»¤ï¼å°±å¯ä»¥æ¢å¤åå§çæ°æ®ãaof éåä½ä¸º ç­å¤ã\n\naof å¯ä»¥éè¿ appendonly yes éç½®éé¡¹æ¥å¼å¯ã\n\nå½ä»¤è¯·æ±ä¼åä¿å­å° aof ç¼å²åºä¸­ï¼ä¹ååå®æåå¥å¹¶åæ­¥å° aof æä»¶ã\n\n# aof çä¼ç¹\n\n * å¦æç³»ç»åçæéï¼aof ä¸¢å¤±æ°æ®æ¯ rdb å°ãä½ å¯ä»¥ä½¿ç¨ä¸åç fsync ç­ç¥ï¼æ  fsyncï¼æ¯ç§ fsyncï¼æ¯æ¬¡åçæ¶å fsyncãä½¿ç¨é»è®¤çæ¯ç§ fsync ç­ç¥ï¼redis çæ§è½ä¾ç¶å¾å¥½(fsync æ¯ç±åå°çº¿ç¨è¿è¡å¤çç,ä¸»çº¿ç¨ä¼å°½åå¤çå®¢æ·ç«¯è¯·æ±)ï¼ä¸æ¦åºç°æéï¼ä½ æå¤ä¸¢å¤± 1 ç§çæ°æ®ã\n * aof æä»¶å¯ä¿®å¤ - aof æä»¶æ¯ä¸ä¸ªåªè¿è¡è¿½å çæ¥å¿æä»¶ï¼æä»¥ä¸éè¦åå¥ seekï¼å³ä½¿ç±äºæäºåå (ç£çç©ºé´å·²æ»¡ï¼åçè¿ç¨ä¸­å®æºç­ç­)æªæ§è¡å®æ´çåå¥å½ä»¤ï¼ä½ ä¹ä¹å¯ä½¿ç¨ redis-check-aof å·¥å·ä¿®å¤è¿äºé®é¢ã\n * aof æä»¶å¯åç¼©ãredis å¯ä»¥å¨ aof æä»¶ä½ç§¯åå¾è¿å¤§æ¶ï¼èªå¨å°å¨åå°å¯¹ aof è¿è¡éåï¼éååçæ° aof æä»¶åå«äºæ¢å¤å½åæ°æ®éæéçæå°å½ä»¤éåãæ´ä¸ªéåæä½æ¯ç»å¯¹å®å¨çï¼å ä¸º redis å¨åå»ºæ° aof æä»¶çè¿ç¨ä¸­ï¼ä¼ç»§ç»­å°å½ä»¤è¿½å å°ç°æç aof æä»¶éé¢ï¼å³ä½¿éåè¿ç¨ä¸­åçåæºï¼ç°æç aof æä»¶ä¹ä¸ä¼ä¸¢å¤±ãèä¸æ¦æ° aof æä»¶åå»ºå®æ¯ï¼redis å°±ä¼ä»æ§ aof æä»¶åæ¢å°æ° aof æä»¶ï¼å¹¶å¼å§å¯¹æ° aof æä»¶è¿è¡è¿½å æä½ã\n * aof æä»¶å¯è¯» - aof æä»¶æåºå°ä¿å­äºå¯¹æ°æ®åºæ§è¡çææåå¥æä½ï¼è¿äºåå¥æä½ä»¥ redis å½ä»¤çæ ¼å¼ä¿å­ãå æ­¤ aof æä»¶çåå®¹éå¸¸å®¹æè¢«äººè¯»æï¼å¯¹æä»¶è¿è¡åæï¼parseï¼ä¹å¾è½»æ¾ã å¯¼åºï¼exportï¼ aof æä»¶ä¹éå¸¸ç®åãä¸¾ä¸ªä¾å­ï¼å¦æä½ ä¸å°å¿æ§è¡äº flushall å½ä»¤ï¼ä½åªè¦ aof æä»¶æªè¢«éåï¼é£ä¹åªè¦åæ­¢æå¡å¨ï¼ç§»é¤ aof æä»¶æ«å°¾ç flushall å½ä»¤ï¼å¹¶éå¯ redis ï¼å°±å¯ä»¥å°æ°æ®éæ¢å¤å° flushall æ§è¡ä¹åçç¶æã\n\n# aof çç¼ºç¹\n\n * aof æä»¶ä½ç§¯ä¸è¬æ¯ rdb å¤§ - å¯¹äºç¸åçæ°æ®éæ¥è¯´ï¼aof æä»¶çä½ç§¯éå¸¸è¦å¤§äº rdb æä»¶çä½ç§¯ã\n * æ¢å¤å¤§æ°æ®éæ¶ï¼aof æ¯ rdb æ¢ã - æ ¹æ®æä½¿ç¨ç fsync ç­ç¥ï¼aof çéåº¦å¯è½ä¼æ¢äºå¿«ç§ãå¨ä¸è¬æåµä¸ï¼æ¯ç§ fsync çæ§è½ä¾ç¶éå¸¸é«ï¼èå³é­ fsync å¯ä»¥è®© aof çéåº¦åå¿«ç§ä¸æ ·å¿«ï¼å³ä½¿å¨é«è´è·ä¹ä¸ä¹æ¯å¦æ­¤ãä¸è¿å¨å¤çå·¨å¤§çåå¥è½½å¥æ¶ï¼å¿«ç§å¯ä»¥æä¾æ´æä¿è¯çæå¤§å»¶è¿æ¶é´ï¼latencyï¼ã\n\n\n# aof çåå»º\n\nredis å½ä»¤è¯·æ±ä¼åä¿å­å° aof ç¼å²åºï¼åå®æåå¥å¹¶åæ­¥å° aof æä»¶ã\n\naof çå®ç°å¯ä»¥åä¸ºå½ä»¤è¿½å ï¼appendï¼ãæä»¶åå¥ãæä»¶åæ­¥ï¼syncï¼ä¸ä¸ªæ­¥éª¤ã\n\n * å½ä»¤è¿½å  - å½ redis æå¡å¨å¼å¯ aof åè½æ¶ï¼æå¡å¨å¨æ§è¡å®ä¸ä¸ªåå½ä»¤åï¼ä¼ä»¥ redis å½ä»¤åè®®æ ¼å¼å°è¢«æ§è¡çåå½ä»¤è¿½å å° aof ç¼å²åºçæ«å°¾ã\n * æä»¶åå¥åæä»¶åæ­¥ - redis çæå¡å¨è¿ç¨å°±æ¯ä¸ä¸ªäºä»¶å¾ªç¯ï¼è¿ä¸ªå¾ªç¯ä¸­çæä»¶äºä»¶è´è´£æ¥æ¶å®¢æ·ç«¯çå½ä»¤è¯·æ±ï¼ä»¥ååå®¢æ·ç«¯åéå½ä»¤åå¤ãèæ¶é´äºä»¶åè´è´£æ§è¡å®æ¶è¿è¡çå½æ°ãå ä¸ºæå¡å¨å¨å¤çæä»¶äºä»¶æ¶å¯è½ä¼æ§è¡åå½ä»¤ï¼è¿äºåå½ä»¤ä¼è¢«è¿½å å° aof ç¼å²åºï¼æå¡å¨æ¯æ¬¡ç»æäºä»¶å¾ªç¯åï¼é½ä¼æ ¹æ® appendfsync éé¡¹æ¥å¤æ­ aof ç¼å²åºåå®¹æ¯å¦éè¦åå¥ååæ­¥å° aof æä»¶ä¸­ã\n\nappendfsync ä¸åéé¡¹å³å®äºä¸åçæä¹åè¡ä¸ºï¼\n\n * always - å°ç¼å²åºææåå®¹åå¥å¹¶åæ­¥å° aof æä»¶ã\n * everysec - å°ç¼å²åºææåå®¹åå¥å° aof æä»¶ï¼å¦æä¸æ¬¡åæ­¥ aof æä»¶çæ¶é´è·ç¦»ç°å¨è¶è¿ä¸ç§éï¼é£ä¹åæ¬¡å¯¹ aof æä»¶è¿è¡åæ­¥ï¼è¿ä¸ªåæ­¥æä½æ¯æä¸ä¸ªçº¿ç¨ä¸é¨è´è´£æ§è¡çã\n * no - å°ç¼å²åºææåå®¹åå¥å° aof æä»¶ï¼ä½å¹¶ä¸å¯¹ aof æä»¶è¿è¡åæ­¥ï¼ä½æ¶åæ­¥ç±æä½ç³»ç»å³å®ã\n\n\n# aof çè½½å¥\n\nå ä¸º aof æä»¶ä¸­åå«äºéå»ºæ°æ®åºæéçææåå½ä»¤ï¼æä»¥æå¡å¨åªè¦è½½å¥å¹¶æ§è¡ä¸é aof æä»¶ä¸­ä¿å­çåå½ä»¤ï¼å°±å¯ä»¥è¿åæå¡å¨å³é­åçæ°æ®åºç¶æã\n\naof è½½å¥è¿ç¨å¦ä¸ï¼\n\n 1. æå¡å¨å¯å¨è½½å¥ç¨åºã\n 2. åå»ºä¸ä¸ªä¼ªå®¢æ·ç«¯ãå ä¸º redis å½ä»¤åªè½å¨å®¢æ·ç«¯ä¸ä¸æä¸­æ§è¡ï¼æä»¥éè¦åå»ºä¸ä¸ªä¼ªå®¢æ·ç«¯æ¥è½½å¥ãæ§è¡ aof æä»¶ä¸­è®°å½çå½ä»¤ã\n 3. ä» aof æä»¶ä¸­åæå¹¶è¯»åä¸æ¡åå½ä»¤ã\n 4. ä½¿ç¨ä¼ªå®¢æ·ç«¯æ§è¡åå½ä»¤ã\n 5. å¾ªç¯æ§è¡æ­¥éª¤ 3ã4ï¼ç´å°ææåå½ä»¤é½è¢«å¤çå®æ¯ä¸ºæ­¢ã\n 6. è½½å¥å®æ¯ã\n\n\n\n\n# aof çéå\n\néç redis ä¸æ­è¿è¡ï¼aof çä½ç§¯ä¹ä¼ä¸æ­å¢é¿ï¼è¿å°å¯¼è´ä¸¤ä¸ªé®é¢ï¼\n\n * aof èå°½ç£çå¯ç¨ç©ºé´ã\n * redis éå¯åéè¦æ§è¡ aof æä»¶è®°å½çææåå½ä»¤æ¥è¿åæ°æ®éï¼å¦æ aof è¿å¤§ï¼åè¿åæä½æ§è¡çæ¶é´å°±ä¼éå¸¸é¿ã\n\nä¸ºäºè§£å³ aof ä½ç§¯è¨èé®é¢ï¼redis æä¾äº aof éååè½ï¼æ¥å¯¹ aof æä»¶è¿è¡åç¼©ãaof éåå¯ä»¥äº§çä¸ä¸ªæ°ç aof æä»¶ï¼è¿ä¸ªæ°ç aof æä»¶ååæ¥ç aof æä»¶æä¿å­çæ°æ®åºç¶æä¸è´ï¼ä½ä½ç§¯æ´å°ã\n\naof éåå¹¶éè¯»åååæç°æ aof æä»¶çåå®¹ï¼èæ¯ç´æ¥ä»æ°æ®åºä¸­è¯»åå½åçæ°æ®åºç¶æãå³ä¾æ¬¡è¯»åæ°æ®åºä¸­çæ¯ä¸ªé®å¼å¯¹ï¼ç¶åç¨ä¸æ¡å½ä»¤å»è®°å½è¯¥é®å¼å¯¹ï¼ä»¥æ­¤ä»£æ¿ä¹åå¯è½å­å¨åä½çå½ä»¤ã\n\n# aof åå°éå\n\nä½ä¸ºä¸ç§è¾å©æ§åè½ï¼æ¾ç¶ redis å¹¶ä¸æ³å¨ aof éåæ¶é»å¡ redis æå¡æ¥æ¶å¶ä»å½ä»¤ãå æ­¤ï¼redis å³å®éè¿ bgrewriteaof å½ä»¤åå»ºä¸ä¸ªå­è¿ç¨ï¼ç¶åç±å­è¿ç¨è´è´£å¯¹ aof æä»¶è¿è¡éåï¼è¿ä¸ bgsave åçç±»ä¼¼ã\n\n * å¨æ§è¡ bgrewriteaof å½ä»¤æ¶ï¼redis æå¡å¨ä¼ç»´æ¤ä¸ä¸ª aof éåç¼å²åºãå½ aof éåå­è¿ç¨å¼å§å·¥ä½åï¼redis æ¯æ§è¡å®ä¸ä¸ªåå½ä»¤ï¼ä¼åæ¶å°è¿ä¸ªå½ä»¤åéç» aof ç¼å²åºå aof éåç¼å²åºã\n * ç±äºå½¼æ­¤ä¸æ¯å¨åä¸ä¸ªè¿ç¨ä¸­å·¥ä½ï¼aof éåä¸å½±å aof åå¥ååæ­¥ãå½å­è¿ç¨å®æåå»ºæ° aof æä»¶çå·¥ä½ä¹åï¼æå¡å¨ä¼å°éåç¼å²åºä¸­çææåå®¹è¿½å å°æ° aof æä»¶çæ«å°¾ï¼ä½¿å¾æ°æ§ä¸¤ä¸ª aof æä»¶æä¿å­çæ°æ®åºç¶æä¸è´ã\n * æåï¼æå¡å¨ç¨æ°ç aof æä»¶æ¿æ¢å°±ç aof æä»¶ï¼ä»¥æ­¤æ¥å®æ aof éåæä½ã\n\n\n\nå¯ä»¥éè¿è®¾ç½® auto-aof-rewrite-percentage å auto-aof-rewrite-min-sizeï¼ä½¿å¾ redis å¨æ»¡è¶³æ¡ä»¶æ¶ï¼èªå¨æ§è¡ bgrewriteaofã\n\nåè®¾éç½®å¦ä¸ï¼\n\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\n\n\nè¡¨æï¼å½ aof å¤§äº 64mbï¼ä¸ aof ä½ç§¯æ¯ä¸ä¸æ¬¡éååçä½ç§¯å¤§äºè³å° 100% æ¶ï¼æ§è¡ bgrewriteaofã\n\n\n# aof çéç½®\n\naof çé»è®¤éç½®ï¼\n\nappendonly no\nappendfsync everysec\nno-appendfsync-on-rewrite no\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\n\n\naof æä¹åéè¿å¨ redis.conf ä¸­ç appendonly yes éç½®éé¡¹æ¥å¼å¯ã\n\n * appendonly - å¼å¯ aof åè½ã\n * appendfilename - aof æä»¶åã\n * appendfsync - ç¨äºè®¾ç½®åæ­¥é¢çï¼å®æä»¥ä¸å¯éé¡¹ï¼\n   * always - æ¯ä¸ª redis åå½ä»¤é½è¦åæ­¥åå¥ç¡¬çãè¿æ ·åä¼ä¸¥ééä½ redis çéåº¦ã\n   * everysec - æ¯ç§æ§è¡ä¸æ¬¡åæ­¥ï¼æ¾ç¤ºå°å°å¤ä¸ªåå½ä»¤åæ­¥å°ç¡¬çãä¸ºäºå¼é¡¾æ°æ®å®å¨ååå¥æ§è½ï¼æ¨èä½¿ç¨ appendfsync everysec éé¡¹ãredis æ¯ç§åæ­¥ä¸æ¬¡ aof æä»¶æ¶çæ§è½åä¸ä½¿ç¨ä»»ä½æä¹åç¹æ§æ¶çæ§è½ç¸å·®æ å ã\n   * no - è®©æä½ç³»ç»æ¥å³å®åºè¯¥ä½æ¶è¿è¡åæ­¥ã\n * no-appendfsync-on-rewrite - aof éåæ¶ä¸æ¯æè¿½å å½ä»¤ã\n * auto-aof-rewrite-percentage - aof éåç¾åæ¯ã\n * auto-aof-rewrite-min-size - aof éåæä»¶çæå°å¤§å°ã\n * dir - rdb æä»¶å aof æä»¶çå­å¨è·¯å¾ã\n\n\n# ä¸ãrdb å aof\n\n> å½ redis å¯å¨æ¶ï¼ å¦æ rdb å aof åè½é½å¼å¯äºï¼é£ä¹ç¨åºä¼ä¼åä½¿ç¨ aof æä»¶æ¥æ¢å¤æ°æ®éï¼å ä¸º aof æä»¶æä¿å­çæ°æ®éå¸¸æ¯æå®æ´çã\n\n\n# å¦ä½éæ©æä¹å\n\n * å¦æä¸å³å¿æ°æ®ä¸¢å¤±ï¼å¯ä»¥ä¸æä¹åã\n * å¦æå¯ä»¥æ¿åæ°åéä»¥åçæ°æ®ä¸¢å¤±ï¼å¯ä»¥åªä½¿ç¨ rdbã\n * å¦æä¸è½æ¿åæ°åéä»¥åçæ°æ®ä¸¢å¤±ï¼å¯ä»¥åæ¶ä½¿ç¨ rdb å aofã\n\næå¾å¤ç¨æ·é½åªä½¿ç¨ aof æä¹åï¼ ä½å¹¶ä¸æ¨èè¿ç§æ¹å¼ï¼ å ä¸ºå®æ¶çæ rdb å¿«ç§ï¼snapshotï¼éå¸¸ä¾¿äºè¿è¡æ°æ®åºå¤ä»½ï¼å¹¶ä¸å¿«ç§æ¢å¤æ°æ®éçéåº¦ä¹è¦æ¯ aof æ¢å¤çéåº¦è¦å¿«ï¼é¤æ­¤ä¹å¤ï¼ä½¿ç¨å¿«ç§è¿å¯ä»¥é¿åä¹åæå°ç aof ç¨åºç bug ã\n\n\n# rdb åæ¢ä¸º aof\n\nå¨ redis 2.2 æä»¥ä¸çæ¬ï¼å¯ä»¥å¨ä¸éå¯çæåµä¸ï¼ä» rdb åæ¢ä¸º aof ï¼\n\n * ä¸ºææ°ç dump.rdb æä»¶åå»ºä¸ä¸ªå¤ä»½ã\n * å°å¤ä»½æ¾å°ä¸ä¸ªå®å¨çå°æ¹ã\n * æ§è¡ä»¥ä¸ä¸¤æ¡å½ä»¤:\n * redis-cli config set appendonly yes\n * redis-cli config set save\n * ç¡®ä¿åå½ä»¤ä¼è¢«æ­£ç¡®å°è¿½å å° aof æä»¶çæ«å°¾ã\n * æ§è¡çç¬¬ä¸æ¡å½ä»¤å¼å¯äº aof åè½ï¼ redis ä¼é»å¡ç´å°åå§ aof æä»¶åå»ºå®æä¸ºæ­¢ï¼ ä¹å redis ä¼ç»§ç»­å¤çå½ä»¤è¯·æ±ï¼ å¹¶å¼å§å°åå¥å½ä»¤è¿½å å° aof æä»¶æ«å°¾ã\n\næ§è¡çç¬¬äºæ¡å½ä»¤ç¨äºå³é­å¿«ç§åè½ã è¿ä¸æ­¥æ¯å¯éçï¼ å¦æä½ æ¿æçè¯ï¼ ä¹å¯ä»¥åæ¶ä½¿ç¨å¿«ç§å aof è¿ä¸¤ç§æä¹ååè½ã\n\n> ð éè¦ï¼å«å¿äºå¨ redis.conf ä¸­æå¼ aof åè½ï¼å¦åçè¯ï¼æå¡å¨éå¯ä¹åï¼ä¹åéè¿ config set è®¾ç½®çéç½®å°±ä¼è¢«éå¿ï¼ç¨åºä¼æåæ¥çéç½®æ¥å¯å¨æå¡å¨ã\n\n\n# aof å rdb çç¸äºä½ç¨\n\nbgsave å bgrewriteaof å½ä»¤ä¸å¯ä»¥åæ¶æ§è¡ãè¿æ¯ä¸ºäºé¿åä¸¤ä¸ª redis åå°è¿ç¨åæ¶å¯¹ç£çè¿è¡å¤§éç i/o æä½ã\n\nå¦æ bgsave æ­£å¨æ§è¡ï¼å¹¶ä¸ç¨æ·æ¾ç¤ºå°è°ç¨ bgrewriteaof å½ä»¤ï¼é£ä¹æå¡å¨å°åç¨æ·åå¤ä¸ä¸ª ok ç¶æï¼å¹¶åç¥ç¨æ·ï¼bgrewriteaof å·²ç»è¢«é¢å®æ§è¡ãä¸æ¦ bgsave æ§è¡å®æ¯ï¼ bgrewriteaof å°±ä¼æ­£å¼å¼å§ã\n\n\n# åãredis å¤ä»½\n\nåºè¯¥ç¡®ä¿ redis æ°æ®æå®æ´çå¤ä»½ã\n\nå¤ä»½ redis æ°æ®å»ºè®®éç¨ rdbã\n\n\n# å¤ä»½è¿ç¨\n\n 1. åå»ºä¸ä¸ªå®æä»»å¡ï¼cron jobï¼ï¼æ¯å°æ¶å°ä¸ä¸ª rdb æä»¶å¤ä»½å°ä¸ä¸ªæä»¶å¤¹ï¼å¹¶ä¸æ¯å¤©å°ä¸ä¸ª rdb æä»¶å¤ä»½å°å¦ä¸ä¸ªæä»¶å¤¹ã\n 2. ç¡®ä¿å¿«ç§çå¤ä»½é½å¸¦æç¸åºçæ¥æåæ¶é´ä¿¡æ¯ï¼æ¯æ¬¡æ§è¡å®æä»»å¡èæ¬æ¶ï¼ä½¿ç¨ find å½ä»¤æ¥å é¤è¿æçå¿«ç§ï¼æ¯å¦è¯´ï¼ä½ å¯ä»¥ä¿çæè¿ 48 å°æ¶åçæ¯å°æ¶å¿«ç§ï¼è¿å¯ä»¥ä¿çæè¿ä¸ä¸¤ä¸ªæçæ¯æ¥å¿«ç§ã\n 3. è³å°æ¯å¤©ä¸æ¬¡ï¼å° rdb å¤ä»½å°ä½ çæ°æ®ä¸­å¿ä¹å¤ï¼æèè³å°æ¯å¤ä»½å°ä½ è¿è¡ redis æå¡å¨çç©çæºå¨ä¹å¤ã\n\n\n# å®¹ç¾å¤ä»½\n\nredis çå®¹ç¾å¤ä»½åºæ¬ä¸å°±æ¯å¯¹æ°æ®è¿è¡å¤ä»½ï¼å¹¶å°è¿äºå¤ä»½ä¼ éå°å¤ä¸ªä¸åçå¤é¨æ°æ®ä¸­å¿ã\n\nå®¹ç¾å¤ä»½å¯ä»¥å¨ redis è¿è¡å¹¶äº§çå¿«ç§çä¸»æ°æ®ä¸­å¿åçä¸¥éçé®é¢æ¶ï¼ä»ç¶è®©æ°æ®å¤äºå®å¨ç¶æã\n\n\n# äºãè¦ç¹æ»ç»\n\n\n\n\n# åèèµæ\n\n * å®ç½\n   * redis å®ç½\n   * redis github\n   * redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãredis å®æã\n   * ãredis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * redis å½ä»¤åè",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Redis å¤å¶",frontmatter:{title:"Redis å¤å¶",date:"2020-06-24T10:45:38.000Z",categories:["æ°æ®åº","KVæ°æ®åº","Redis"],tags:["æ°æ®åº","KVæ°æ®åº","Redis","å¤å¶"],permalink:"/pages/379cd8/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/05.KV%E6%95%B0%E6%8D%AE%E5%BA%93/01.Redis/05.Redis%E5%A4%8D%E5%88%B6.html",relativePath:"12.æ°æ®åº/05.KVæ°æ®åº/01.Redis/05.Rediså¤å¶.md",key:"v-26fbb292",path:"/pages/379cd8/",headers:[{level:2,title:"ä¸ãå¤å¶ç®ä»",slug:"ä¸ãå¤å¶ç®ä»",normalizedTitle:"ä¸ãå¤å¶ç®ä»",charIndex:190},{level:2,title:"äºãæ§çå¤å¶",slug:"äºãæ§çå¤å¶",normalizedTitle:"äºãæ§çå¤å¶",charIndex:698},{level:3,title:"åæ­¥",slug:"åæ­¥",normalizedTitle:"åæ­¥",charIndex:172},{level:3,title:"å½ä»¤ä¼ æ­",slug:"å½ä»¤ä¼ æ­",normalizedTitle:"å½ä»¤ä¼ æ­",charIndex:758},{level:3,title:"æ§çå¤å¶çç¼ºé·",slug:"æ§çå¤å¶çç¼ºé·",normalizedTitle:"æ§çå¤å¶çç¼ºé·",charIndex:1265},{level:2,title:"ä¸ãæ°çå¤å¶",slug:"ä¸ãæ°çå¤å¶",normalizedTitle:"ä¸ãæ°çå¤å¶",charIndex:1650},{level:3,title:"é¨åéåæ­¥",slug:"é¨åéåæ­¥",normalizedTitle:"é¨åéåæ­¥",charIndex:169},{level:4,title:"å¤å¶åç§»é",slug:"å¤å¶åç§»é",normalizedTitle:"å¤å¶åç§»é",charIndex:1954},{level:4,title:"å¤å¶ç§¯åç¼å²åº",slug:"å¤å¶ç§¯åç¼å²åº",normalizedTitle:"å¤å¶ç§¯åç¼å²åº",charIndex:1988},{level:4,title:"æå¡å¨çè¿è¡ ID",slug:"æå¡å¨çè¿è¡-id",normalizedTitle:"æå¡å¨çè¿è¡ id",charIndex:2020},{level:3,title:"PSYNC å½ä»¤",slug:"psync-å½ä»¤",normalizedTitle:"psync å½ä»¤",charIndex:1684},{level:2,title:"åãå¿è·³æ£æµ",slug:"åãå¿è·³æ£æµ",normalizedTitle:"åãå¿è·³æ£æµ",charIndex:3306},{level:3,title:"æ£æµä¸»ä»è¿æ¥ç¶æ",slug:"æ£æµä¸»ä»è¿æ¥ç¶æ",normalizedTitle:"æ£æµä¸»ä»è¿æ¥ç¶æ",charIndex:3514},{level:3,title:"è¾å©å®ç° min-slaves éé¡¹",slug:"è¾å©å®ç°-min-slaves-éé¡¹",normalizedTitle:"è¾å©å®ç° min-slaves éé¡¹",charIndex:3479},{level:3,title:"æ£æµå½ä»¤ä¸¢å¤±",slug:"æ£æµå½ä»¤ä¸¢å¤±",normalizedTitle:"æ£æµå½ä»¤ä¸¢å¤±",charIndex:3502},{level:2,title:"äºãå¤å¶çæµç¨",slug:"äºãå¤å¶çæµç¨",normalizedTitle:"äºãå¤å¶çæµç¨",charIndex:4112},{level:3,title:"æ­¥éª¤ 1. è®¾ç½®ä¸»ä»æå¡å¨",slug:"æ­¥éª¤-1-è®¾ç½®ä¸»ä»æå¡å¨",normalizedTitle:"æ­¥éª¤ 1. è®¾ç½®ä¸»ä»æå¡å¨",charIndex:4204},{level:3,title:"æ­¥éª¤ 2. ä¸»ä»æå¡å¨å»ºç« TCP è¿æ¥ã",slug:"æ­¥éª¤-2-ä¸»ä»æå¡å¨å»ºç«-tcp-è¿æ¥ã",normalizedTitle:"æ­¥éª¤ 2. ä¸»ä»æå¡å¨å»ºç« tcp è¿æ¥ã",charIndex:4439},{level:3,title:"æ­¥éª¤ 3. åé PING æ£æ¥éä¿¡ç¶æã",slug:"æ­¥éª¤-3-åé-ping-æ£æ¥éä¿¡ç¶æã",normalizedTitle:"æ­¥éª¤ 3. åé ping æ£æ¥éä¿¡ç¶æã",charIndex:4465},{level:3,title:"æ­¥éª¤ 4. èº«ä»½éªè¯ã",slug:"æ­¥éª¤-4-èº«ä»½éªè¯ã",normalizedTitle:"æ­¥éª¤ 4. èº«ä»½éªè¯ã",charIndex:4491},{level:3,title:"æ­¥éª¤ 5. åéç«¯å£ä¿¡æ¯ã",slug:"æ­¥éª¤-5-åéç«¯å£ä¿¡æ¯ã",normalizedTitle:"æ­¥éª¤ 5. åéç«¯å£ä¿¡æ¯ã",charIndex:4868},{level:3,title:"æ­¥éª¤ 6. åæ­¥ã",slug:"æ­¥éª¤-6-åæ­¥ã",normalizedTitle:"æ­¥éª¤ 6. åæ­¥ã",charIndex:4952},{level:3,title:"æ­¥éª¤ 7. å½ä»¤ä¼ æ­ã",slug:"æ­¥éª¤-7-å½ä»¤ä¼ æ­ã",normalizedTitle:"æ­¥éª¤ 7. å½ä»¤ä¼ æ­ã",charIndex:4980},{level:2,title:"å­ãå¤å¶çéç½®é¡¹",slug:"å­ãå¤å¶çéç½®é¡¹",normalizedTitle:"å­ãå¤å¶çéç½®é¡¹",charIndex:5129},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:5878}],headersStr:"ä¸ãå¤å¶ç®ä» äºãæ§çå¤å¶ åæ­¥ å½ä»¤ä¼ æ­ æ§çå¤å¶çç¼ºé· ä¸ãæ°çå¤å¶ é¨åéåæ­¥ å¤å¶åç§»é å¤å¶ç§¯åç¼å²åº æå¡å¨çè¿è¡ ID PSYNC å½ä»¤ åãå¿è·³æ£æµ æ£æµä¸»ä»è¿æ¥ç¶æ è¾å©å®ç° min-slaves éé¡¹ æ£æµå½ä»¤ä¸¢å¤± äºãå¤å¶çæµç¨ æ­¥éª¤ 1. è®¾ç½®ä¸»ä»æå¡å¨ æ­¥éª¤ 2. ä¸»ä»æå¡å¨å»ºç« TCP è¿æ¥ã æ­¥éª¤ 3. åé PING æ£æ¥éä¿¡ç¶æã æ­¥éª¤ 4. èº«ä»½éªè¯ã æ­¥éª¤ 5. åéç«¯å£ä¿¡æ¯ã æ­¥éª¤ 6. åæ­¥ã æ­¥éª¤ 7. å½ä»¤ä¼ æ­ã å­ãå¤å¶çéç½®é¡¹ åèèµæ",content:"# Redis å¤å¶\n\n> å¨ Redis ä¸­ï¼å¯ä»¥éè¿æ§è¡ SLAVEOF å½ä»¤æè®¾ç½® slaveof éé¡¹ï¼è®©ä¸ä¸ªæå¡å¨å»å¤å¶ï¼replicateï¼å¦ä¸ä¸ªæå¡å¨ï¼å¶ä¸­ï¼åèå«ä¸»æå¡å¨ï¼masterï¼ï¼åèå«ä»æå¡å¨ï¼slaveï¼ã\n> \n> Redis 2.8 ä»¥åçå¤å¶ä¸è½é«æå¤çæ­çº¿åéå¤å¶çæåµï¼è Redis 2.8 æ°æ·»çé¨åéåæ­¥å¯ä»¥è§£å³è¿ä¸ªé®é¢ã\n\n\n\n\n# ä¸ãå¤å¶ç®ä»\n\nRedis éè¿ slaveof host port å½ä»¤æ¥è®©ä¸ä¸ªæå¡å¨æä¸ºå¦ä¸ä¸ªæå¡å¨çä»æå¡å¨ã\n\nä¸ä¸ªä¸»æå¡å¨å¯ä»¥æå¤ä¸ªä»æå¡å¨ãä¸ä»ä¸»æå¡å¨å¯ä»¥æä»æå¡å¨ï¼ä»æå¡å¨ä¹å¯ä»¥æèªå·±çä»æå¡å¨ï¼ å¤ä¸ªä»æå¡å¨ä¹é´å¯ä»¥ææä¸ä¸ªä¸»ä»é¾ã\n\nä¸ä¸ªä»æå¡å¨åªè½æä¸ä¸ªä¸»æå¡å¨ï¼å¹¶ä¸ä¸æ¯æä¸»ä¸»å¤å¶ã\n\nå¯ä»¥éè¿å¤å¶åè½æ¥è®©ä¸»æå¡å¨åäºæ§è¡æä¹åæä½ï¼ åªè¦å³é­ä¸»æå¡å¨çæä¹ååè½ï¼ ç¶åç±ä»æå¡å¨å»æ§è¡æä¹åæä½å³å¯ã\n\nå¨ä½¿ç¨ Redis å¤å¶åè½æ¶çè®¾ç½®ä¸­ï¼å¼ºçå»ºè®®å¨ master åå¨ slave ä¸­å¯ç¨æä¹åãå½ä¸å¯ç¨æ¶ï¼ä¾å¦ç±äºéå¸¸æ¢çç£çæ§è½èå¯¼è´çå»¶è¿é®é¢ï¼åºè¯¥éç½®å®ä¾æ¥é¿åéç½®åèªå¨éå¯ã\n\nä» Redis 2.6 å¼å§ï¼ ä»æå¡å¨æ¯æåªè¯»æ¨¡å¼ï¼ å¹¶ä¸è¯¥æ¨¡å¼ä¸ºä»æå¡å¨çé»è®¤æ¨¡å¼ã\n\n * åªè¯»æ¨¡å¼ç± redis.conf æä»¶ä¸­ç slave-read-only éé¡¹æ§å¶ï¼ ä¹å¯ä»¥éè¿ CONFIG SET parameter value å½ä»¤æ¥å¼å¯æå³é­è¿ä¸ªæ¨¡å¼ã\n * åªè¯»ä»æå¡å¨ä¼æç»æ§è¡ä»»ä½åå½ä»¤ï¼ æä»¥ä¸ä¼åºç°å ä¸ºæä½å¤±è¯¯èå°æ°æ®ä¸å°å¿åå¥å°äºä»æå¡å¨çæåµã\n\n\n# äºãæ§çå¤å¶\n\n> Redis 2.8 çæ¬ä»¥åå®ç°æ¹å¼ï¼SYNC å½ä»¤\n\nRedis çå¤å¶åè½åä¸ºåæ­¥ï¼syncï¼åå½ä»¤ä¼ æ­ï¼command propagateï¼ä¸¤ä¸ªæä½ï¼\n\n * åæ­¥ï¼syncï¼ - ç¨äºå°ä»æå¡å¨çæ°æ®åºç¶ææ´æ°è³ä¸»æå¡å¨å½åçæ°æ®åºç¶æã\n * å½ä»¤ä¼ æ­ï¼command propagateï¼ - å½ä¸»æå¡å¨çæ°æ®åºç¶æè¢«ä¿®æ¹ï¼å¯¼è´ä¸»ä»æ°æ®åºç¶æä¸ä¸è´æ¶ï¼è®©ä¸»ä»æå¡å¨çæ°æ®åºéæ°åå°ä¸è´ç¶æã\n\n\n# åæ­¥\n\nSYNC å½ä»¤çæ§è¡æ­¥éª¤ï¼\n\n 1. ä»æå¡å¨åä¸»æå¡å¨åé SYNC å½ä»¤ã\n 2. æ¶å° SYNC å½ä»¤çä¸»æå¡å¨æ§è¡ BGSAVE å½ä»¤ï¼å¨åå°çæä¸ä¸ª RDB æä»¶ï¼å¹¶ä½¿ç¨ä¸ä¸ªç¼å²åºè®°å½ä»ç°å¨å¼å§æ§è¡çææåå½ä»¤ã\n 3. ä¸»æå¡å¨æ§è¡ BGSAVE å®æ¯åï¼ä¸»æå¡å¨ä¼å°çæç RDB æä»¶åéç»ä»æå¡å¨ãä»æå¡å¨æ¥æ¶å¹¶è½½å¥ RDB æä»¶ï¼æ´æ°èªå·±çæ°æ®åºç¶æã\n 4. ä¸»æå¡å¨å°è®°å½å¨ç¼å²åºä¸­çææåå½ä»¤åéç»ä»æå¡å¨ï¼ä»æå¡å¨æ§è¡è¿äºåå½ä»¤ï¼æ´æ°èªå·±çæ°æ®åºç¶æã\n\n\n\n\n# å½ä»¤ä¼ æ­\n\nåæ­¥æä½å®æåï¼ä¸»ä»æ°æ®åºçæ°æ®åºç¶æå°è¾¾å°ä¸è´ãæ¯å½ä¸»æå¡å¨æ§è¡å®¢æ·ç«¯åéçåå½ä»¤æ¶ï¼ä¸»ä»æ°æ®åºç¶æä¸åä¸è´ãéè¦å°åå½ä»¤åéç»ä»æå¡å¨æ§è¡ï¼ä½¿å¾äºèçæ°æ®åºç¶æéæ°è¾¾å°ä¸è´ã\n\n\n# æ§çå¤å¶çç¼ºé·\n\nä»æå¡å¨å¯¹ä¸»æå¡å¨çå¤å¶å­å¨ä¸¤ç§æåµï¼\n\n * åæ¬¡å¤å¶ - ä»æå¡å¨ä»¥åæ²¡æå¤å¶è¿å°è¦å¤å¶çä¸»æå¡å¨ã\n * æ­çº¿åéå¤å¶ - å¤äºå½ä»¤ä¼ æ­é¶æ®µçä¸»ä»æå¡å¨å ä¸ºç½ç»åå èä¸­æ­äºå¤å¶ï¼å½ä»æå¡å¨éè¿èªå¨éè¿éæ°è¿ä¸äºä¸»æå¡å¨åï¼ç»§ç»­å¤å¶ä¸»æå¡å¨ã\n\nå¯¹äºåæ¬¡å¤å¶ï¼æ§çå¤å¶åè½å¯ç¨å¾å¥½å®æä»»å¡ï¼ä½æ¯å¯¹äºæ­çº¿åéå¤å¶ï¼ç±äºæ¯æ¬¡ä»»ç¶éè¦çæ RDB å¹¶ä¼ è¾ï¼æçå¾ä½ã\n\n> ð æ³¨æï¼SYNC å½ä»¤æ¯ä¸ä¸ªéå¸¸èè´¹èµæºçæä½ã\n> \n>  * ä¸»æå¡å¨æ§è¡ BGSAVE å½ä»¤çæ RDB æä»¶ï¼è¿ä¸ªæä½ä¼èè´¹ä¸»æå¡å¨å¤§éç CPUãåå­åç£ç I/O èµæºã\n>  * ä¸»æå¡å¨ä¼ è¾ RDB æä»¶ç»ä»æå¡å¨ï¼è¿ä¸ªæä½ä¼èè´¹ä¸»ä»æå¡å¨å¤§éçç½ç»èµæºï¼å¹¶å¯¹ä¸»æå¡å¨ååºæ¶å»¶äº§çå½±åã\n>  * ä»æå¡å¨è½½å¥ RDB æä»¶æé´ï¼ä¼é»å¡å¶ä»å½ä»¤è¯·æ±ã\n\n\n# ä¸ãæ°çå¤å¶\n\n> Redis 2.8 çæ¬ä»¥åçæ°å®ç°æ¹å¼ï¼ä½¿ç¨ PSYNC å½ä»¤æ¿ä»£ SYNC å½ä»¤ã\n\nPSYNC å½ä»¤å·æå®æ´éåæ­¥åé¨åéåæ­¥ä¸¤ç§æ¨¡å¼ï¼\n\n * å®æ´éåæ­¥ï¼full resychronizationï¼ - ç¨äºåæ¬¡å¤å¶ãæ§è¡æ­¥éª¤ä¸ SYNC å½ä»¤åºæ¬ä¸è´ã\n * é¨åéåæ­¥ï¼partial resychronizationï¼ - ç¨äºæ­çº¿åéå¤å¶ãå¦ææ¡ä»¶åè®¸ï¼ä¸»æå¡å¨å¯ä»¥å°ä¸»ä»æå¡å¨è¿æ¥æ­å¼æé´æ§è¡çåå½ä»¤åéç»ä»æå¡å¨ï¼ä»æå¡å¨åªéæ¥æ¶å¹¶æ§è¡è¿äºåå½ä»¤ï¼å³å¯å°ä¸»ä»æå¡å¨çæ°æ®åºç¶æä¿æä¸è´ã\n\n\n# é¨åéåæ­¥\n\né¨åéåæ­¥åè½å®ç°ç±ä¸ä¸ªé¨åææï¼\n\n * ä¸»ä»æå¡å¨çå¤å¶åç§»éï¼replication offsetï¼\n * ä¸»æå¡å¨çå¤å¶ç§¯åç¼å²åºï¼replication backlogï¼\n * æå¡å¨çè¿è¡ ID\n\n# å¤å¶åç§»é\n\nä¸»æå¡å¨åä»æå¡å¨ä¼åå«ç»´æ¤ä¸ä¸ªå¤å¶åç§»éã\n\n * å¦æä¸»ä»æå¡å¨çå¤å¶åç§»éç¸åï¼åè¯´æäºèçæ°æ®åºç¶æä¸è´ï¼\n * åä¹ï¼åè¯´æäºèçæ°æ®åºç¶æä¸ä¸è´ã\n\n\n\n# å¤å¶ç§¯åç¼å²åº\n\nå¤å¶ç§¯åç¼å²åºæ¯ä¸»æå¡å¨ç»´æ¤çä¸ä¸ªåºå®é¿åº¦çåè¿ååºï¼FIFOï¼éåï¼é»è®¤å¤§å°ä¸º 1MBã\n\nå¤å¶ç§¯åç¼å²åºä¼ä¿å­ä¸é¨åæè¿ä¼ æ­çåå½ä»¤ï¼å¹¶ä¸å¤å¶ç§¯åç¼å²åºä¼ä¸ºéåä¸­çæ¯ä¸ªå­èè®°å½ç¸åºçå¤å¶åç§»éã\n\nå½ä»æå¡å¨æ­çº¿éè¿ä¸»æå¡æ¶ï¼ä»æå¡å¨ä¼éè¿ PSYNC å½ä»¤å°èªå·±çå¤å¶åç§»é offset åéç»ä¸»æå¡å¨ï¼ä¸»æå¡å¨ä¼æ ¹æ®è¿ä¸ªå¤å¶åç§»éæ¥å³å®å¯¹ä»æå¡å¨æ§è¡ä½ç§åæ­¥æä½ã\n\n * å¦æ offset ä¹åçæ°æ®ä»ç¶å¨å¤å¶ç§¯åç¼å²åºï¼åä¸»æå¡å¨å¯¹ä»æå¡å¨æ§è¡é¨åéåæ­¥æä½ã\n * åä¹ï¼åä¸»æå¡å¨å¯¹ä»æå¡å¨æ§è¡å®æ´éåæ­¥æä½ã\n\n> ð æ³¨æï¼åçè°æ´å¤å¶ç§¯åç¼å²åºçå¤§å°\n> \n>  * Redis å¤å¶ç§¯åç¼å²åºé»è®¤å¤§å°ä¸º 1MBã\n> \n>  * å¤å¶ç§¯åç¼å²åºçæå°å¤§å°å¯ä»¥æ ¹æ®å¬å¼ second * write_size_per_second ä¼°ç®ã\n\n# æå¡å¨çè¿è¡ ID\n\n * æ¯ä¸ª Redis æå¡å¨ï¼é½æè¿è¡ IDï¼ç¨äºå¯ä¸è¯å«èº«ä»½ã\n * è¿è¡ ID å¨æå¡å¨å¯å¨æ¶èªå¨çæï¼ç± 40 ä¸ªéæºçåå­è¿å¶å­ç¬¦ç»æãä¾å¦ï¼132e358005e29741f8d7b0a42d666aace286edda\n\nä»æå¡å¨å¯¹ä¸»æå¡å¨è¿è¡åæ¬¡å¤å¶æ¶ï¼ä¸»æå¡å¨ä¼å°èªå·±çè¿è¡ ID ä¼ éç»ä»æå¡å¨ï¼ä»æå¡å¨ä¼å°è¿ä¸ªè¿è¡ ID ä¿å­ä¸æ¥ã\n\nå½ä»æå¡å¨æ­çº¿éè¿ä¸ä¸ªä¸»æå¡å¨æ¶ï¼ä»æå¡å¨ä¼åéä¹åä¿å­çè¿è¡ IDï¼\n\n * å¦æä¿å­çè¿è¡ ID åå½åä¸»æå¡å¨çè¿è¡ ID ä¸è´ï¼åè¯´æä»æå¡å¨æ­çº¿ä¹åè¿æ¥çå°±æ¯è¿ä¸ªä¸»æå¡å¨ï¼ä¸»æå¡å¨å¯ä»¥ç»§ç»­å°è¯æ§è¡é¨åéåæ­¥æä½ï¼\n * åä¹ï¼è¥è¿è¡ ID ä¸ä¸è´ï¼åè¯´æä»æå¡å¨æ­çº¿ä¹åè¿æ¥çä¸æ¯è¿ä¸ªä¸»æå¡å¨ï¼ä¸»æå¡å¨å°å¯¹ä»æå¡å¨æ§è¡å®æ´éåæ­¥æä½ã\n\n\n# PSYNC å½ä»¤\n\näºè§£äºé¨åéåæ­¥çå®ç°ï¼PSYNC çå®ç°å°±å¾å®¹æçè§£äºï¼å®çåºæ¬å·¥ä½åçå¤§è´å¦ä¸ï¼\n\nå½ä»æå¡æ¥æ¶å° SLAVEOF å½ä»¤æ¶ï¼åå¤æ­ä»æå¡å¨ä»¥åæ¯å¦æ§è¡è¿å¤å¶æä½ã\n\n * å¦ææ²¡æå¤å¶è¿ä»»ä½ä¸»æå¡å¨ï¼åè¦å¤å¶çä¸»æå¡å¨åé PSYNC ? -1 å½ä»¤ï¼ä¸»å¨è¯·æ±è¿è¡å®æ´éåæ­¥ã\n * åä¹ï¼åè¦å¤å¶çä¸»æå¡å¨åé PSYNC <runid> <offset> å½ä»¤ã\n   * runid æ¯ä¸ä¸æ¬¡å¤å¶çä¸»æå¡å¨çè¿è¡ IDã\n   * offset æ¯å¤å¶åç§»éã\n\næ¥æ¶å° PSYNC <runid> <offset> å½ä»¤çä¸»æå¡ä¼è¿è¡åæï¼\n\n * åå¦ä¸»ä»æå¡å¨ç master run id ç¸åï¼å¹¶ä¸æå®çåç§»éï¼offsetï¼å¨åå­ç¼å²åºä¸­è¿ææï¼å¤å¶å°±ä¼ä»ä¸æ¬¡ä¸­æ­çç¹å¼å§ç»§ç»­ã\n * å¦æå¶ä¸­ä¸ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼å°±ä¼è¿è¡å®å¨éæ°åæ­¥ï¼å¨ 2.8 çæ¬ä¹åå°±æ¯ç´æ¥è¿è¡å®å¨éæ°åæ­¥ï¼ã\n\n\n\n\n# åãå¿è·³æ£æµ\n\nå¨å½ä»¤ä¼ æ­é¶æ®µï¼ä»æå¡å¨é»è®¤ä¼ä»¥æ¯ç§ä¸æ¬¡çé¢çï¼åä¸»æå¡å¨åéå½ä»¤ï¼\n\nREPLCONF ACK <replication_offset>\n\n\nå¶ä¸­ï¼replication_offset æ¯ä»æå¡å¨å½åçå¤å¶åç§»éã\n\nåé REPLCONF ACK å½ä»¤å¯¹äºä¸»ä»æå¡å¨æä¸ä¸ªä½ç¨ï¼\n\n * æ£æµä¸»ä»æå¡å¨çç½ç»è¿æ¥ç¶æã\n * è¾å©å®ç° min-slaves éé¡¹ã\n * æ£æµå½ä»¤ä¸¢å¤±ã\n\n\n# æ£æµä¸»ä»è¿æ¥ç¶æ\n\nå¯ä»¥éè¿åéåæ¥æ¶ REPLCONF ACK å½ä»¤æ¥æ£æ¥ä¸»ä»æå¡å¨ä¹é´çç½ç»è¿æ¥æ¯å¦æ­£å¸¸ï¼å¦æä¸»æå¡å¨è¶è¿ä¸ç§æ²¡ææ¶å°ä»æå¡å¨åæ¥ç REPLCONF ACK å½ä»¤ï¼é£ä¹ä¸»æå¡å¨å°±ç¥éä¸»ä»æå¡å¨ä¹é´çè¿æ¥åºç°é®é¢äºã\n\nå¯ä»¥éè¿åä¸»æå¡å¨åé INFO replication å½ä»¤ï¼å¨ååºçä»æå¡å¨åè¡¨ç lag ä¸æ ä¸­ï¼å¯ä»¥çå°ä»æå¡å¨åä¸»æå¡å¨åé REPLCONF ACK å½ä»¤å·²ç»è¿å»å¤å°ç§ã\n\n\n# è¾å©å®ç° min-slaves éé¡¹\n\nRedis ç min-slaves-to-write å min-slaves-max-lag ä¸¤ä¸ªéé¡¹å¯ä»¥é²æ­¢ä¸»æå¡å¨å¨ä¸å®å¨çæåµä¸æ§è¡åå½ä»¤ã\n\nãç¤ºä¾ãmin-slaves éç½®é¡¹\n\nmin-slaves-to-write 3\nmin-slaves-max-lag 10\n\n\nä»¥ä¸éç½®è¡¨ç¤ºï¼ä»æå¡å¨å°äº 3 ä¸ªï¼æä¸ä¸ªä»æå¡å¨çå»¶è¿ï¼lagï¼é½å¤§äºç­äº 10 ç§æ¶ï¼ä¸»æå¡å¨å°æç»æ§è¡åå½ä»¤ã\n\n\n# æ£æµå½ä»¤ä¸¢å¤±\n\nå¦æå ä¸ºç½ç»æéï¼ä¸»æå¡ä¼ æ­ç»ä»æå¡å¨çåå½ä»¤ä¸¢å¤±ï¼é£ä¹ä»æå¡å¨å®æ¶åä¸»æå¡å¨åé REPLCONF ACK å½ä»¤æ¶ï¼ä¸»æå¡å¨å°åè§ä»æå¡å¨çå¤å¶åç§»éå°äºèªå·±çãç¶åï¼ä¸»æå¡å¨å°±ä¼æ ¹æ®ä»æå¡å¨æäº¤çå¤å¶åç§»éï¼å¨å¤å¶ç§¯åç¼å²åºä¸­æ¾å°ä»æå¡å¨ç¼ºå°çæ°æ®ï¼å¹¶å°è¿äºæ°æ®éæ°åéç»ä»æå¡å¨ã\n\n\n# äºãå¤å¶çæµç¨\n\néè¿åä»æå¡å¨åéå¦ä¸ SLAVEOF å½ä»¤ï¼å¯ä»¥è®©ä¸ä¸ªä»æå¡å¨å»å¤å¶ä¸ä¸ªä¸»æå¡å¨ã\n\nSLAVEOF <master_ip> <master_port>\n\n\n\n# æ­¥éª¤ 1. è®¾ç½®ä¸»ä»æå¡å¨\n\néç½®ä¸ä¸ªä»æå¡å¨éå¸¸ç®åï¼ åªè¦å¨éç½®æä»¶ä¸­å¢å ä»¥ä¸çè¿ä¸è¡å°±å¯ä»¥äºï¼\n\nslaveof 127.0.0.1 6379\n\n\nå½ç¶ï¼ ä½ éè¦å°ä»£ç ä¸­ç 127.0.0.1 å 6379 æ¿æ¢æä½ çä¸»æå¡å¨ç IP åç«¯å£å·ã\n\nå¦å¤ä¸ç§æ¹æ³æ¯è°ç¨ SLAVEOF host port å½ä»¤ï¼ è¾å¥ä¸»æå¡å¨ç IP åç«¯å£ï¼ ç¶ååæ­¥å°±ä¼å¼å§ï¼\n\n127.0.0.1:6379> SLAVEOF 127.0.0.1 10086\nOK\n\n\n\n# æ­¥éª¤ 2. ä¸»ä»æå¡å¨å»ºç« TCP è¿æ¥ã\n\n\n# æ­¥éª¤ 3. åé PING æ£æ¥éä¿¡ç¶æã\n\n\n# æ­¥éª¤ 4. èº«ä»½éªè¯ã\n\nå¦æä¸»æå¡å¨æ²¡æè®¾ç½® requirepass ï¼ä»æå¡å¨æ²¡æè®¾ç½® masterauthï¼åä¸è¿è¡èº«ä»½éªè¯ï¼åä¹ï¼åéè¦è¿è¡èº«ä»½éªè¯ãå¦æèº«ä»½éªè¯å¤±è´¥ï¼åæ¾å¼æ§è¡å¤å¶å·¥ä½ã\n\nå¦æä¸»æå¡å¨éè¿ requirepass éé¡¹è®¾ç½®äºå¯ç ï¼ é£ä¹ä¸ºäºè®©ä»æå¡å¨çåæ­¥æä½å¯ä»¥é¡ºå©è¿è¡ï¼ æä»¬ä¹å¿é¡»ä¸ºä»æå¡å¨è¿è¡ç¸åºçèº«ä»½éªè¯è®¾ç½®ã\n\nå¯¹äºä¸ä¸ªæ­£å¨è¿è¡çæå¡å¨ï¼ å¯ä»¥ä½¿ç¨å®¢æ·ç«¯è¾å¥ä»¥ä¸å½ä»¤ï¼\n\nconfig set masterauth <password>\n\n\nè¦æ°¸ä¹å°è®¾ç½®è¿ä¸ªå¯ç ï¼ é£ä¹å¯ä»¥å°å®å å¥å°éç½®æä»¶ä¸­ï¼\n\nmasterauth <password>\n\n\nå¦å¤è¿æå ä¸ªéé¡¹ï¼ å®ä»¬åä¸»æå¡å¨æ§è¡é¨åéåæ­¥æ¶æä½¿ç¨çå¤å¶æµç¼å²åºæå³ï¼ è¯¦ç»çä¿¡æ¯å¯ä»¥åè Redis æºç ä¸­éå¸¦ç redis.conf ç¤ºä¾æä»¶ã\n\n\n# æ­¥éª¤ 5. åéç«¯å£ä¿¡æ¯ã\n\nä»æå¡å¨æ§è¡ REPLCONF listening-port <port-number> ï¼åä¸»æå¡å¨åéä»æå¡å¨ççå¬ç«¯å£å·ã\n\n\n# æ­¥éª¤ 6. åæ­¥ã\n\nåæå·²ä»ç»ï¼æ­¤å¤ä¸èµè¿°ã\n\n\n# æ­¥éª¤ 7. å½ä»¤ä¼ æ­ã\n\nå¨å½ä»¤ä¼ æ­é¶æ®µï¼ä»æå¡å¨é»è®¤ä¼ä»¥æ¯ç§ä¸æ¬¡çé¢çï¼åä¸»æå¡åéå½ä»¤ï¼\n\nREPLCONF ACK <replication_coffset>\n\n\nå½ä»¤çä½ç¨ï¼\n\n * æ£æµä¸»ä»æå¡å¨çç½ç»è¿æ¥ç¶æã\n * è¾å©å®ç° min-slave éé¡¹ã\n * æ£æµå½ä»¤ä¸¢å¤±ã\n\n\n# å­ãå¤å¶çéç½®é¡¹\n\nä» Redis 2.8 å¼å§ï¼ ä¸ºäºä¿è¯æ°æ®çå®å¨æ§ï¼ å¯ä»¥éè¿éç½®ï¼ è®©ä¸»æå¡å¨åªå¨æè³å° N ä¸ªå½åå·²è¿æ¥ä»æå¡å¨çæåµä¸ï¼ ææ§è¡åå½ä»¤ã\n\nä¸è¿ï¼ å ä¸º Redis ä½¿ç¨å¼æ­¥å¤å¶ï¼ æä»¥ä¸»æå¡å¨åéçåæ°æ®å¹¶ä¸ä¸å®ä¼è¢«ä»æå¡å¨æ¥æ¶å°ï¼ å æ­¤ï¼ æ°æ®ä¸¢å¤±çå¯è½æ§ä»ç¶æ¯å­å¨çã\n\nä»¥ä¸æ¯è¿ä¸ªç¹æ§çè¿ä½åçï¼\n\n * ä»æå¡å¨ä»¥æ¯ç§ä¸æ¬¡çé¢ç PING ä¸»æå¡å¨ä¸æ¬¡ï¼ å¹¶æ¥åå¤å¶æµçå¤çæåµã\n * ä¸»æå¡å¨ä¼è®°å½åä¸ªä»æå¡å¨æåä¸æ¬¡åå®åé PING çæ¶é´ã\n * ç¨æ·å¯ä»¥éè¿éç½®ï¼ æå®ç½ç»å»¶è¿çæå¤§å¼ min-slaves-max-lag ï¼ ä»¥åæ§è¡åæä½æéçè³å°ä»æå¡å¨æ°é min-slaves-to-write ã\n\nå¦æè³å°æ min-slaves-to-write ä¸ªä»æå¡å¨ï¼ å¹¶ä¸è¿äºæå¡å¨çå»¶è¿å¼é½å°äº min-slaves-max-lagç§ï¼ é£ä¹ä¸»æå¡å¨å°±ä¼æ§è¡å®¢æ·ç«¯è¯·æ±çåæä½ã\n\nä½ å¯ä»¥å°è¿ä¸ªç¹æ§çä½ CAP çè®ºä¸­ç C çæ¡ä»¶æ¾å®½çæ¬ï¼ å°½ç®¡ä¸è½ä¿è¯åæä½çæä¹æ§ï¼ ä½èµ·ç ä¸¢å¤±æ°æ®ççªå£ä¼è¢«ä¸¥æ ¼éå¶å¨æå®çç§æ°ä¸­ã\n\nå¦ä¸æ¹é¢ï¼ å¦ææ¡ä»¶è¾¾ä¸å° min-slaves-to-write å min-slaves-max-lag ææå®çæ¡ä»¶ï¼ é£ä¹åæä½å°±ä¸ä¼è¢«æ§è¡ï¼ ä¸»æå¡å¨ä¼åè¯·æ±æ§è¡åæä½çå®¢æ·ç«¯è¿åä¸ä¸ªéè¯¯ã\n\nä»¥ä¸æ¯è¿ä¸ªç¹æ§çä¸¤ä¸ªéé¡¹åå®ä»¬æéçåæ°ï¼\n\n * min-slaves-to-write <number of slaves>\n * min-slaves-max-lag <number of seconds>\n\nè¯¦ç»çä¿¡æ¯å¯ä»¥åè Redis æºç ä¸­éå¸¦ç redis.conf ç¤ºä¾æä»¶ã\n\n\n# åèèµæ\n\n * å®ç½\n   * Redis å®ç½\n   * Redis github\n   * Redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãRedis å®æã\n   * ãRedis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * Redis å½ä»¤åè",normalizedContent:"# redis å¤å¶\n\n> å¨ redis ä¸­ï¼å¯ä»¥éè¿æ§è¡ slaveof å½ä»¤æè®¾ç½® slaveof éé¡¹ï¼è®©ä¸ä¸ªæå¡å¨å»å¤å¶ï¼replicateï¼å¦ä¸ä¸ªæå¡å¨ï¼å¶ä¸­ï¼åèå«ä¸»æå¡å¨ï¼masterï¼ï¼åèå«ä»æå¡å¨ï¼slaveï¼ã\n> \n> redis 2.8 ä»¥åçå¤å¶ä¸è½é«æå¤çæ­çº¿åéå¤å¶çæåµï¼è redis 2.8 æ°æ·»çé¨åéåæ­¥å¯ä»¥è§£å³è¿ä¸ªé®é¢ã\n\n\n\n\n# ä¸ãå¤å¶ç®ä»\n\nredis éè¿ slaveof host port å½ä»¤æ¥è®©ä¸ä¸ªæå¡å¨æä¸ºå¦ä¸ä¸ªæå¡å¨çä»æå¡å¨ã\n\nä¸ä¸ªä¸»æå¡å¨å¯ä»¥æå¤ä¸ªä»æå¡å¨ãä¸ä»ä¸»æå¡å¨å¯ä»¥æä»æå¡å¨ï¼ä»æå¡å¨ä¹å¯ä»¥æèªå·±çä»æå¡å¨ï¼ å¤ä¸ªä»æå¡å¨ä¹é´å¯ä»¥ææä¸ä¸ªä¸»ä»é¾ã\n\nä¸ä¸ªä»æå¡å¨åªè½æä¸ä¸ªä¸»æå¡å¨ï¼å¹¶ä¸ä¸æ¯æä¸»ä¸»å¤å¶ã\n\nå¯ä»¥éè¿å¤å¶åè½æ¥è®©ä¸»æå¡å¨åäºæ§è¡æä¹åæä½ï¼ åªè¦å³é­ä¸»æå¡å¨çæä¹ååè½ï¼ ç¶åç±ä»æå¡å¨å»æ§è¡æä¹åæä½å³å¯ã\n\nå¨ä½¿ç¨ redis å¤å¶åè½æ¶çè®¾ç½®ä¸­ï¼å¼ºçå»ºè®®å¨ master åå¨ slave ä¸­å¯ç¨æä¹åãå½ä¸å¯ç¨æ¶ï¼ä¾å¦ç±äºéå¸¸æ¢çç£çæ§è½èå¯¼è´çå»¶è¿é®é¢ï¼åºè¯¥éç½®å®ä¾æ¥é¿åéç½®åèªå¨éå¯ã\n\nä» redis 2.6 å¼å§ï¼ ä»æå¡å¨æ¯æåªè¯»æ¨¡å¼ï¼ å¹¶ä¸è¯¥æ¨¡å¼ä¸ºä»æå¡å¨çé»è®¤æ¨¡å¼ã\n\n * åªè¯»æ¨¡å¼ç± redis.conf æä»¶ä¸­ç slave-read-only éé¡¹æ§å¶ï¼ ä¹å¯ä»¥éè¿ config set parameter value å½ä»¤æ¥å¼å¯æå³é­è¿ä¸ªæ¨¡å¼ã\n * åªè¯»ä»æå¡å¨ä¼æç»æ§è¡ä»»ä½åå½ä»¤ï¼ æä»¥ä¸ä¼åºç°å ä¸ºæä½å¤±è¯¯èå°æ°æ®ä¸å°å¿åå¥å°äºä»æå¡å¨çæåµã\n\n\n# äºãæ§çå¤å¶\n\n> redis 2.8 çæ¬ä»¥åå®ç°æ¹å¼ï¼sync å½ä»¤\n\nredis çå¤å¶åè½åä¸ºåæ­¥ï¼syncï¼åå½ä»¤ä¼ æ­ï¼command propagateï¼ä¸¤ä¸ªæä½ï¼\n\n * åæ­¥ï¼syncï¼ - ç¨äºå°ä»æå¡å¨çæ°æ®åºç¶ææ´æ°è³ä¸»æå¡å¨å½åçæ°æ®åºç¶æã\n * å½ä»¤ä¼ æ­ï¼command propagateï¼ - å½ä¸»æå¡å¨çæ°æ®åºç¶æè¢«ä¿®æ¹ï¼å¯¼è´ä¸»ä»æ°æ®åºç¶æä¸ä¸è´æ¶ï¼è®©ä¸»ä»æå¡å¨çæ°æ®åºéæ°åå°ä¸è´ç¶æã\n\n\n# åæ­¥\n\nsync å½ä»¤çæ§è¡æ­¥éª¤ï¼\n\n 1. ä»æå¡å¨åä¸»æå¡å¨åé sync å½ä»¤ã\n 2. æ¶å° sync å½ä»¤çä¸»æå¡å¨æ§è¡ bgsave å½ä»¤ï¼å¨åå°çæä¸ä¸ª rdb æä»¶ï¼å¹¶ä½¿ç¨ä¸ä¸ªç¼å²åºè®°å½ä»ç°å¨å¼å§æ§è¡çææåå½ä»¤ã\n 3. ä¸»æå¡å¨æ§è¡ bgsave å®æ¯åï¼ä¸»æå¡å¨ä¼å°çæç rdb æä»¶åéç»ä»æå¡å¨ãä»æå¡å¨æ¥æ¶å¹¶è½½å¥ rdb æä»¶ï¼æ´æ°èªå·±çæ°æ®åºç¶æã\n 4. ä¸»æå¡å¨å°è®°å½å¨ç¼å²åºä¸­çææåå½ä»¤åéç»ä»æå¡å¨ï¼ä»æå¡å¨æ§è¡è¿äºåå½ä»¤ï¼æ´æ°èªå·±çæ°æ®åºç¶æã\n\n\n\n\n# å½ä»¤ä¼ æ­\n\nåæ­¥æä½å®æåï¼ä¸»ä»æ°æ®åºçæ°æ®åºç¶æå°è¾¾å°ä¸è´ãæ¯å½ä¸»æå¡å¨æ§è¡å®¢æ·ç«¯åéçåå½ä»¤æ¶ï¼ä¸»ä»æ°æ®åºç¶æä¸åä¸è´ãéè¦å°åå½ä»¤åéç»ä»æå¡å¨æ§è¡ï¼ä½¿å¾äºèçæ°æ®åºç¶æéæ°è¾¾å°ä¸è´ã\n\n\n# æ§çå¤å¶çç¼ºé·\n\nä»æå¡å¨å¯¹ä¸»æå¡å¨çå¤å¶å­å¨ä¸¤ç§æåµï¼\n\n * åæ¬¡å¤å¶ - ä»æå¡å¨ä»¥åæ²¡æå¤å¶è¿å°è¦å¤å¶çä¸»æå¡å¨ã\n * æ­çº¿åéå¤å¶ - å¤äºå½ä»¤ä¼ æ­é¶æ®µçä¸»ä»æå¡å¨å ä¸ºç½ç»åå èä¸­æ­äºå¤å¶ï¼å½ä»æå¡å¨éè¿èªå¨éè¿éæ°è¿ä¸äºä¸»æå¡å¨åï¼ç»§ç»­å¤å¶ä¸»æå¡å¨ã\n\nå¯¹äºåæ¬¡å¤å¶ï¼æ§çå¤å¶åè½å¯ç¨å¾å¥½å®æä»»å¡ï¼ä½æ¯å¯¹äºæ­çº¿åéå¤å¶ï¼ç±äºæ¯æ¬¡ä»»ç¶éè¦çæ rdb å¹¶ä¼ è¾ï¼æçå¾ä½ã\n\n> ð æ³¨æï¼sync å½ä»¤æ¯ä¸ä¸ªéå¸¸èè´¹èµæºçæä½ã\n> \n>  * ä¸»æå¡å¨æ§è¡ bgsave å½ä»¤çæ rdb æä»¶ï¼è¿ä¸ªæä½ä¼èè´¹ä¸»æå¡å¨å¤§éç cpuãåå­åç£ç i/o èµæºã\n>  * ä¸»æå¡å¨ä¼ è¾ rdb æä»¶ç»ä»æå¡å¨ï¼è¿ä¸ªæä½ä¼èè´¹ä¸»ä»æå¡å¨å¤§éçç½ç»èµæºï¼å¹¶å¯¹ä¸»æå¡å¨ååºæ¶å»¶äº§çå½±åã\n>  * ä»æå¡å¨è½½å¥ rdb æä»¶æé´ï¼ä¼é»å¡å¶ä»å½ä»¤è¯·æ±ã\n\n\n# ä¸ãæ°çå¤å¶\n\n> redis 2.8 çæ¬ä»¥åçæ°å®ç°æ¹å¼ï¼ä½¿ç¨ psync å½ä»¤æ¿ä»£ sync å½ä»¤ã\n\npsync å½ä»¤å·æå®æ´éåæ­¥åé¨åéåæ­¥ä¸¤ç§æ¨¡å¼ï¼\n\n * å®æ´éåæ­¥ï¼full resychronizationï¼ - ç¨äºåæ¬¡å¤å¶ãæ§è¡æ­¥éª¤ä¸ sync å½ä»¤åºæ¬ä¸è´ã\n * é¨åéåæ­¥ï¼partial resychronizationï¼ - ç¨äºæ­çº¿åéå¤å¶ãå¦ææ¡ä»¶åè®¸ï¼ä¸»æå¡å¨å¯ä»¥å°ä¸»ä»æå¡å¨è¿æ¥æ­å¼æé´æ§è¡çåå½ä»¤åéç»ä»æå¡å¨ï¼ä»æå¡å¨åªéæ¥æ¶å¹¶æ§è¡è¿äºåå½ä»¤ï¼å³å¯å°ä¸»ä»æå¡å¨çæ°æ®åºç¶æä¿æä¸è´ã\n\n\n# é¨åéåæ­¥\n\né¨åéåæ­¥åè½å®ç°ç±ä¸ä¸ªé¨åææï¼\n\n * ä¸»ä»æå¡å¨çå¤å¶åç§»éï¼replication offsetï¼\n * ä¸»æå¡å¨çå¤å¶ç§¯åç¼å²åºï¼replication backlogï¼\n * æå¡å¨çè¿è¡ id\n\n# å¤å¶åç§»é\n\nä¸»æå¡å¨åä»æå¡å¨ä¼åå«ç»´æ¤ä¸ä¸ªå¤å¶åç§»éã\n\n * å¦æä¸»ä»æå¡å¨çå¤å¶åç§»éç¸åï¼åè¯´æäºèçæ°æ®åºç¶æä¸è´ï¼\n * åä¹ï¼åè¯´æäºèçæ°æ®åºç¶æä¸ä¸è´ã\n\n\n\n# å¤å¶ç§¯åç¼å²åº\n\nå¤å¶ç§¯åç¼å²åºæ¯ä¸»æå¡å¨ç»´æ¤çä¸ä¸ªåºå®é¿åº¦çåè¿ååºï¼fifoï¼éåï¼é»è®¤å¤§å°ä¸º 1mbã\n\nå¤å¶ç§¯åç¼å²åºä¼ä¿å­ä¸é¨åæè¿ä¼ æ­çåå½ä»¤ï¼å¹¶ä¸å¤å¶ç§¯åç¼å²åºä¼ä¸ºéåä¸­çæ¯ä¸ªå­èè®°å½ç¸åºçå¤å¶åç§»éã\n\nå½ä»æå¡å¨æ­çº¿éè¿ä¸»æå¡æ¶ï¼ä»æå¡å¨ä¼éè¿ psync å½ä»¤å°èªå·±çå¤å¶åç§»é offset åéç»ä¸»æå¡å¨ï¼ä¸»æå¡å¨ä¼æ ¹æ®è¿ä¸ªå¤å¶åç§»éæ¥å³å®å¯¹ä»æå¡å¨æ§è¡ä½ç§åæ­¥æä½ã\n\n * å¦æ offset ä¹åçæ°æ®ä»ç¶å¨å¤å¶ç§¯åç¼å²åºï¼åä¸»æå¡å¨å¯¹ä»æå¡å¨æ§è¡é¨åéåæ­¥æä½ã\n * åä¹ï¼åä¸»æå¡å¨å¯¹ä»æå¡å¨æ§è¡å®æ´éåæ­¥æä½ã\n\n> ð æ³¨æï¼åçè°æ´å¤å¶ç§¯åç¼å²åºçå¤§å°\n> \n>  * redis å¤å¶ç§¯åç¼å²åºé»è®¤å¤§å°ä¸º 1mbã\n> \n>  * å¤å¶ç§¯åç¼å²åºçæå°å¤§å°å¯ä»¥æ ¹æ®å¬å¼ second * write_size_per_second ä¼°ç®ã\n\n# æå¡å¨çè¿è¡ id\n\n * æ¯ä¸ª redis æå¡å¨ï¼é½æè¿è¡ idï¼ç¨äºå¯ä¸è¯å«èº«ä»½ã\n * è¿è¡ id å¨æå¡å¨å¯å¨æ¶èªå¨çæï¼ç± 40 ä¸ªéæºçåå­è¿å¶å­ç¬¦ç»æãä¾å¦ï¼132e358005e29741f8d7b0a42d666aace286edda\n\nä»æå¡å¨å¯¹ä¸»æå¡å¨è¿è¡åæ¬¡å¤å¶æ¶ï¼ä¸»æå¡å¨ä¼å°èªå·±çè¿è¡ id ä¼ éç»ä»æå¡å¨ï¼ä»æå¡å¨ä¼å°è¿ä¸ªè¿è¡ id ä¿å­ä¸æ¥ã\n\nå½ä»æå¡å¨æ­çº¿éè¿ä¸ä¸ªä¸»æå¡å¨æ¶ï¼ä»æå¡å¨ä¼åéä¹åä¿å­çè¿è¡ idï¼\n\n * å¦æä¿å­çè¿è¡ id åå½åä¸»æå¡å¨çè¿è¡ id ä¸è´ï¼åè¯´æä»æå¡å¨æ­çº¿ä¹åè¿æ¥çå°±æ¯è¿ä¸ªä¸»æå¡å¨ï¼ä¸»æå¡å¨å¯ä»¥ç»§ç»­å°è¯æ§è¡é¨åéåæ­¥æä½ï¼\n * åä¹ï¼è¥è¿è¡ id ä¸ä¸è´ï¼åè¯´æä»æå¡å¨æ­çº¿ä¹åè¿æ¥çä¸æ¯è¿ä¸ªä¸»æå¡å¨ï¼ä¸»æå¡å¨å°å¯¹ä»æå¡å¨æ§è¡å®æ´éåæ­¥æä½ã\n\n\n# psync å½ä»¤\n\näºè§£äºé¨åéåæ­¥çå®ç°ï¼psync çå®ç°å°±å¾å®¹æçè§£äºï¼å®çåºæ¬å·¥ä½åçå¤§è´å¦ä¸ï¼\n\nå½ä»æå¡æ¥æ¶å° slaveof å½ä»¤æ¶ï¼åå¤æ­ä»æå¡å¨ä»¥åæ¯å¦æ§è¡è¿å¤å¶æä½ã\n\n * å¦ææ²¡æå¤å¶è¿ä»»ä½ä¸»æå¡å¨ï¼åè¦å¤å¶çä¸»æå¡å¨åé psync ? -1 å½ä»¤ï¼ä¸»å¨è¯·æ±è¿è¡å®æ´éåæ­¥ã\n * åä¹ï¼åè¦å¤å¶çä¸»æå¡å¨åé psync <runid> <offset> å½ä»¤ã\n   * runid æ¯ä¸ä¸æ¬¡å¤å¶çä¸»æå¡å¨çè¿è¡ idã\n   * offset æ¯å¤å¶åç§»éã\n\næ¥æ¶å° psync <runid> <offset> å½ä»¤çä¸»æå¡ä¼è¿è¡åæï¼\n\n * åå¦ä¸»ä»æå¡å¨ç master run id ç¸åï¼å¹¶ä¸æå®çåç§»éï¼offsetï¼å¨åå­ç¼å²åºä¸­è¿ææï¼å¤å¶å°±ä¼ä»ä¸æ¬¡ä¸­æ­çç¹å¼å§ç»§ç»­ã\n * å¦æå¶ä¸­ä¸ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼å°±ä¼è¿è¡å®å¨éæ°åæ­¥ï¼å¨ 2.8 çæ¬ä¹åå°±æ¯ç´æ¥è¿è¡å®å¨éæ°åæ­¥ï¼ã\n\n\n\n\n# åãå¿è·³æ£æµ\n\nå¨å½ä»¤ä¼ æ­é¶æ®µï¼ä»æå¡å¨é»è®¤ä¼ä»¥æ¯ç§ä¸æ¬¡çé¢çï¼åä¸»æå¡å¨åéå½ä»¤ï¼\n\nreplconf ack <replication_offset>\n\n\nå¶ä¸­ï¼replication_offset æ¯ä»æå¡å¨å½åçå¤å¶åç§»éã\n\nåé replconf ack å½ä»¤å¯¹äºä¸»ä»æå¡å¨æä¸ä¸ªä½ç¨ï¼\n\n * æ£æµä¸»ä»æå¡å¨çç½ç»è¿æ¥ç¶æã\n * è¾å©å®ç° min-slaves éé¡¹ã\n * æ£æµå½ä»¤ä¸¢å¤±ã\n\n\n# æ£æµä¸»ä»è¿æ¥ç¶æ\n\nå¯ä»¥éè¿åéåæ¥æ¶ replconf ack å½ä»¤æ¥æ£æ¥ä¸»ä»æå¡å¨ä¹é´çç½ç»è¿æ¥æ¯å¦æ­£å¸¸ï¼å¦æä¸»æå¡å¨è¶è¿ä¸ç§æ²¡ææ¶å°ä»æå¡å¨åæ¥ç replconf ack å½ä»¤ï¼é£ä¹ä¸»æå¡å¨å°±ç¥éä¸»ä»æå¡å¨ä¹é´çè¿æ¥åºç°é®é¢äºã\n\nå¯ä»¥éè¿åä¸»æå¡å¨åé info replication å½ä»¤ï¼å¨ååºçä»æå¡å¨åè¡¨ç lag ä¸æ ä¸­ï¼å¯ä»¥çå°ä»æå¡å¨åä¸»æå¡å¨åé replconf ack å½ä»¤å·²ç»è¿å»å¤å°ç§ã\n\n\n# è¾å©å®ç° min-slaves éé¡¹\n\nredis ç min-slaves-to-write å min-slaves-max-lag ä¸¤ä¸ªéé¡¹å¯ä»¥é²æ­¢ä¸»æå¡å¨å¨ä¸å®å¨çæåµä¸æ§è¡åå½ä»¤ã\n\nãç¤ºä¾ãmin-slaves éç½®é¡¹\n\nmin-slaves-to-write 3\nmin-slaves-max-lag 10\n\n\nä»¥ä¸éç½®è¡¨ç¤ºï¼ä»æå¡å¨å°äº 3 ä¸ªï¼æä¸ä¸ªä»æå¡å¨çå»¶è¿ï¼lagï¼é½å¤§äºç­äº 10 ç§æ¶ï¼ä¸»æå¡å¨å°æç»æ§è¡åå½ä»¤ã\n\n\n# æ£æµå½ä»¤ä¸¢å¤±\n\nå¦æå ä¸ºç½ç»æéï¼ä¸»æå¡ä¼ æ­ç»ä»æå¡å¨çåå½ä»¤ä¸¢å¤±ï¼é£ä¹ä»æå¡å¨å®æ¶åä¸»æå¡å¨åé replconf ack å½ä»¤æ¶ï¼ä¸»æå¡å¨å°åè§ä»æå¡å¨çå¤å¶åç§»éå°äºèªå·±çãç¶åï¼ä¸»æå¡å¨å°±ä¼æ ¹æ®ä»æå¡å¨æäº¤çå¤å¶åç§»éï¼å¨å¤å¶ç§¯åç¼å²åºä¸­æ¾å°ä»æå¡å¨ç¼ºå°çæ°æ®ï¼å¹¶å°è¿äºæ°æ®éæ°åéç»ä»æå¡å¨ã\n\n\n# äºãå¤å¶çæµç¨\n\néè¿åä»æå¡å¨åéå¦ä¸ slaveof å½ä»¤ï¼å¯ä»¥è®©ä¸ä¸ªä»æå¡å¨å»å¤å¶ä¸ä¸ªä¸»æå¡å¨ã\n\nslaveof <master_ip> <master_port>\n\n\n\n# æ­¥éª¤ 1. è®¾ç½®ä¸»ä»æå¡å¨\n\néç½®ä¸ä¸ªä»æå¡å¨éå¸¸ç®åï¼ åªè¦å¨éç½®æä»¶ä¸­å¢å ä»¥ä¸çè¿ä¸è¡å°±å¯ä»¥äºï¼\n\nslaveof 127.0.0.1 6379\n\n\nå½ç¶ï¼ ä½ éè¦å°ä»£ç ä¸­ç 127.0.0.1 å 6379 æ¿æ¢æä½ çä¸»æå¡å¨ç ip åç«¯å£å·ã\n\nå¦å¤ä¸ç§æ¹æ³æ¯è°ç¨ slaveof host port å½ä»¤ï¼ è¾å¥ä¸»æå¡å¨ç ip åç«¯å£ï¼ ç¶ååæ­¥å°±ä¼å¼å§ï¼\n\n127.0.0.1:6379> slaveof 127.0.0.1 10086\nok\n\n\n\n# æ­¥éª¤ 2. ä¸»ä»æå¡å¨å»ºç« tcp è¿æ¥ã\n\n\n# æ­¥éª¤ 3. åé ping æ£æ¥éä¿¡ç¶æã\n\n\n# æ­¥éª¤ 4. èº«ä»½éªè¯ã\n\nå¦æä¸»æå¡å¨æ²¡æè®¾ç½® requirepass ï¼ä»æå¡å¨æ²¡æè®¾ç½® masterauthï¼åä¸è¿è¡èº«ä»½éªè¯ï¼åä¹ï¼åéè¦è¿è¡èº«ä»½éªè¯ãå¦æèº«ä»½éªè¯å¤±è´¥ï¼åæ¾å¼æ§è¡å¤å¶å·¥ä½ã\n\nå¦æä¸»æå¡å¨éè¿ requirepass éé¡¹è®¾ç½®äºå¯ç ï¼ é£ä¹ä¸ºäºè®©ä»æå¡å¨çåæ­¥æä½å¯ä»¥é¡ºå©è¿è¡ï¼ æä»¬ä¹å¿é¡»ä¸ºä»æå¡å¨è¿è¡ç¸åºçèº«ä»½éªè¯è®¾ç½®ã\n\nå¯¹äºä¸ä¸ªæ­£å¨è¿è¡çæå¡å¨ï¼ å¯ä»¥ä½¿ç¨å®¢æ·ç«¯è¾å¥ä»¥ä¸å½ä»¤ï¼\n\nconfig set masterauth <password>\n\n\nè¦æ°¸ä¹å°è®¾ç½®è¿ä¸ªå¯ç ï¼ é£ä¹å¯ä»¥å°å®å å¥å°éç½®æä»¶ä¸­ï¼\n\nmasterauth <password>\n\n\nå¦å¤è¿æå ä¸ªéé¡¹ï¼ å®ä»¬åä¸»æå¡å¨æ§è¡é¨åéåæ­¥æ¶æä½¿ç¨çå¤å¶æµç¼å²åºæå³ï¼ è¯¦ç»çä¿¡æ¯å¯ä»¥åè redis æºç ä¸­éå¸¦ç redis.conf ç¤ºä¾æä»¶ã\n\n\n# æ­¥éª¤ 5. åéç«¯å£ä¿¡æ¯ã\n\nä»æå¡å¨æ§è¡ replconf listening-port <port-number> ï¼åä¸»æå¡å¨åéä»æå¡å¨ççå¬ç«¯å£å·ã\n\n\n# æ­¥éª¤ 6. åæ­¥ã\n\nåæå·²ä»ç»ï¼æ­¤å¤ä¸èµè¿°ã\n\n\n# æ­¥éª¤ 7. å½ä»¤ä¼ æ­ã\n\nå¨å½ä»¤ä¼ æ­é¶æ®µï¼ä»æå¡å¨é»è®¤ä¼ä»¥æ¯ç§ä¸æ¬¡çé¢çï¼åä¸»æå¡åéå½ä»¤ï¼\n\nreplconf ack <replication_coffset>\n\n\nå½ä»¤çä½ç¨ï¼\n\n * æ£æµä¸»ä»æå¡å¨çç½ç»è¿æ¥ç¶æã\n * è¾å©å®ç° min-slave éé¡¹ã\n * æ£æµå½ä»¤ä¸¢å¤±ã\n\n\n# å­ãå¤å¶çéç½®é¡¹\n\nä» redis 2.8 å¼å§ï¼ ä¸ºäºä¿è¯æ°æ®çå®å¨æ§ï¼ å¯ä»¥éè¿éç½®ï¼ è®©ä¸»æå¡å¨åªå¨æè³å° n ä¸ªå½åå·²è¿æ¥ä»æå¡å¨çæåµä¸ï¼ ææ§è¡åå½ä»¤ã\n\nä¸è¿ï¼ å ä¸º redis ä½¿ç¨å¼æ­¥å¤å¶ï¼ æä»¥ä¸»æå¡å¨åéçåæ°æ®å¹¶ä¸ä¸å®ä¼è¢«ä»æå¡å¨æ¥æ¶å°ï¼ å æ­¤ï¼ æ°æ®ä¸¢å¤±çå¯è½æ§ä»ç¶æ¯å­å¨çã\n\nä»¥ä¸æ¯è¿ä¸ªç¹æ§çè¿ä½åçï¼\n\n * ä»æå¡å¨ä»¥æ¯ç§ä¸æ¬¡çé¢ç ping ä¸»æå¡å¨ä¸æ¬¡ï¼ å¹¶æ¥åå¤å¶æµçå¤çæåµã\n * ä¸»æå¡å¨ä¼è®°å½åä¸ªä»æå¡å¨æåä¸æ¬¡åå®åé ping çæ¶é´ã\n * ç¨æ·å¯ä»¥éè¿éç½®ï¼ æå®ç½ç»å»¶è¿çæå¤§å¼ min-slaves-max-lag ï¼ ä»¥åæ§è¡åæä½æéçè³å°ä»æå¡å¨æ°é min-slaves-to-write ã\n\nå¦æè³å°æ min-slaves-to-write ä¸ªä»æå¡å¨ï¼ å¹¶ä¸è¿äºæå¡å¨çå»¶è¿å¼é½å°äº min-slaves-max-lagç§ï¼ é£ä¹ä¸»æå¡å¨å°±ä¼æ§è¡å®¢æ·ç«¯è¯·æ±çåæä½ã\n\nä½ å¯ä»¥å°è¿ä¸ªç¹æ§çä½ cap çè®ºä¸­ç c çæ¡ä»¶æ¾å®½çæ¬ï¼ å°½ç®¡ä¸è½ä¿è¯åæä½çæä¹æ§ï¼ ä½èµ·ç ä¸¢å¤±æ°æ®ççªå£ä¼è¢«ä¸¥æ ¼éå¶å¨æå®çç§æ°ä¸­ã\n\nå¦ä¸æ¹é¢ï¼ å¦ææ¡ä»¶è¾¾ä¸å° min-slaves-to-write å min-slaves-max-lag ææå®çæ¡ä»¶ï¼ é£ä¹åæä½å°±ä¸ä¼è¢«æ§è¡ï¼ ä¸»æå¡å¨ä¼åè¯·æ±æ§è¡åæä½çå®¢æ·ç«¯è¿åä¸ä¸ªéè¯¯ã\n\nä»¥ä¸æ¯è¿ä¸ªç¹æ§çä¸¤ä¸ªéé¡¹åå®ä»¬æéçåæ°ï¼\n\n * min-slaves-to-write <number of slaves>\n * min-slaves-max-lag <number of seconds>\n\nè¯¦ç»çä¿¡æ¯å¯ä»¥åè redis æºç ä¸­éå¸¦ç redis.conf ç¤ºä¾æä»¶ã\n\n\n# åèèµæ\n\n * å®ç½\n   * redis å®ç½\n   * redis github\n   * redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãredis å®æã\n   * ãredis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * redis å½ä»¤åè",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Redis å¨åµ",frontmatter:{title:"Redis å¨åµ",date:"2020-06-24T10:45:38.000Z",categories:["æ°æ®åº","KVæ°æ®åº","Redis"],tags:["æ°æ®åº","KVæ°æ®åº","Redis","å¨åµ"],permalink:"/pages/615afe/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/05.KV%E6%95%B0%E6%8D%AE%E5%BA%93/01.Redis/06.Redis%E5%93%A8%E5%85%B5.html",relativePath:"12.æ°æ®åº/05.KVæ°æ®åº/01.Redis/06.Rediså¨åµ.md",key:"v-18f5009d",path:"/pages/615afe/",headers:[{level:2,title:"ä¸ãå¨åµç®ä»",slug:"ä¸ãå¨åµç®ä»",normalizedTitle:"ä¸ãå¨åµç®ä»",charIndex:107},{level:2,title:"äºãå¯å¨å¨åµ",slug:"äºãå¯å¨å¨åµ",normalizedTitle:"äºãå¯å¨å¨åµ",charIndex:711},{level:2,title:"ä¸ãçæ§",slug:"ä¸ãçæ§",normalizedTitle:"ä¸ãçæ§",charIndex:1312},{level:3,title:"æ£æµæå¡å¨ç¶æ",slug:"æ£æµæå¡å¨ç¶æ",normalizedTitle:"æ£æµæå¡å¨ç¶æ",charIndex:1321},{level:3,title:"è·åæå¡å¨ä¿¡æ¯",slug:"è·åæå¡å¨ä¿¡æ¯",normalizedTitle:"è·åæå¡å¨ä¿¡æ¯",charIndex:1813},{level:2,title:"åãéç¥",slug:"åãéç¥",normalizedTitle:"åãéç¥",charIndex:2153},{level:3,title:"åæå¡å¨åéæ¶æ¯",slug:"åæå¡å¨åéæ¶æ¯",normalizedTitle:"åæå¡å¨åéæ¶æ¯",charIndex:2265},{level:3,title:"æ¥æ¶æå¡å¨çæ¶æ¯",slug:"æ¥æ¶æå¡å¨çæ¶æ¯",normalizedTitle:"æ¥æ¶æå¡å¨çæ¶æ¯",charIndex:2479},{level:2,title:"äºãéä¸¾ Leader",slug:"äºãéä¸¾-leader",normalizedTitle:"äºãéä¸¾ leader",charIndex:2648},{level:2,title:"å­ãæéè½¬ç§»",slug:"å­ãæéè½¬ç§»",normalizedTitle:"å­ãæéè½¬ç§»",charIndex:3808},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:4486}],headersStr:"ä¸ãå¨åµç®ä» äºãå¯å¨å¨åµ ä¸ãçæ§ æ£æµæå¡å¨ç¶æ è·åæå¡å¨ä¿¡æ¯ åãéç¥ åæå¡å¨åéæ¶æ¯ æ¥æ¶æå¡å¨çæ¶æ¯ äºãéä¸¾ Leader å­ãæéè½¬ç§» åèèµæ",content:'# Redis å¨åµ\n\n> Redis å¨åµï¼Sentinelï¼æ¯ Redis çé«å¯ç¨æ§ï¼Hight Availabilityï¼è§£å³æ¹æ¡ã\n> \n> Redis å¨åµæ¯ Raft ç®æ³ çå·ä½å®ç°ã\n\n\n\n\n# ä¸ãå¨åµç®ä»\n\nRedis å¨åµï¼Sentinelï¼æ¯ Redis çé«å¯ç¨æ§ï¼Hight Availabilityï¼è§£å³æ¹æ¡ï¼ç±ä¸ä¸ªæå¤ä¸ª Sentinel å®ä¾ç»æç Sentinel ç³»ç»å¯ä»¥çè§ä»»æå¤ä¸ªä¸»æå¡å¨ï¼ä»¥åè¿äºä¸»æå¡å¨çææä»æå¡å¨ï¼å¹¶å¨è¢«çè§çä¸»æå¡å¨è¿å¥ä¸çº¿ç¶ææ¶ï¼èªå¨å°ä¸çº¿ä¸»æå¡å¨çæä¸ªä»æå¡å¨åçº§ä¸ºæ°çä¸»æå¡å¨ï¼ç¶åç±æ°çä¸»æå¡å¨ä»£æ¿å·²ä¸çº¿çä¸»æå¡å¨ç»§ç»­å¤çå½ä»¤è¯·æ±ã\n\n\n\nSentinel çä¸»è¦åè½å¦ä¸ï¼\n\n * çæ§ï¼Monitoringï¼ - Sentinel ä¸æ­æ£æ¥ä¸»ä»æå¡å¨æ¯å¦æ­£å¸¸å¨å·¥ä½ã\n * éç¥ï¼Notificationï¼ - Sentinel å¯ä»¥éè¿ä¸ä¸ª api æ¥éç¥ç³»ç»ç®¡çåæèå¦å¤çåºç¨ç¨åºï¼è¢«çæ§ç Redis å®ä¾æä¸äºé®é¢ã\n * èªå¨æéè½¬ç§»ï¼Automatic Failoverï¼ - å¦æä¸ä¸ªä¸»æå¡å¨ä¸çº¿ï¼Sentinel ä¼å¼å§èªå¨æéè½¬ç§»ï¼æä¸ä¸ªä»èç¹æåä¸ºä¸»èç¹ï¼å¹¶éæ°éç½®å¶ä»çä»èç¹ä½¿ç¨æ°çä¸»èç¹ï¼ä½¿ç¨ Redis æå¡çåºç¨ç¨åºå¨è¿æ¥çæ¶åä¹è¢«éç¥æ°çå°åã\n * éç½®æä¾èï¼Configuration providerï¼ - Sentinel ç»å®¢æ·ç«¯çæå¡åç°æä¾æ¥æºï¼å¯¹äºä¸ä¸ªç»å®çæå¡ï¼å®¢æ·ç«¯è¿æ¥å° Sentinels æ¥å¯»æ¾å½åä¸»èç¹çå°åãå½æéè½¬ç§»åççæ¶åï¼Sentinel å°æ¥åæ°çå°åã\n\n\n# äºãå¯å¨å¨åµ\n\nå¯å¨ä¸ä¸ª Sentinel å¯ä»¥ä½¿ç¨ä¸é¢ä»»æä¸æ¡å½ä»¤ï¼ä¸¤æ¡å½ä»¤ææå®å¨ç¸åã\n\nredis-sentinel /path/to/sentinel.conf\nredis-server /path/to/sentinel.conf --sentinel\n\n\nå½ä¸ä¸ª Sentinel å¯å¨æ¶ï¼å®éè¦æ§è¡ä»¥ä¸æ­¥éª¤ï¼\n\n 1. åå§åæå¡å¨ã\n 2. ä½¿ç¨ Sentinel ä¸ç¨ä»£ç ã\n 3. åå§å Sentinel ç¶æã\n 4. åå§å Sentinel çä¸»æå¡å¨åè¡¨ã\n 5. åå»ºè¿åè¢«çè§çä¸»æå¡å¨çç½ç»è¿æ¥ã\n\nSentinel æ¬è´¨ä¸æ¯ä¸ä¸ªè¿è¡å¨ç¹æ®ç¶æ¨¡å¼ä¸ç Redis æå¡å¨ã\n\nSentinel æ¨¡å¼ä¸ Redis æå¡å¨åªæ¯æ PINGãSENTINELãINFOãSUBSCRIBEãUNSUBSCRIBEãPSUBSCRIBEãPUNSUBSCRIBE ä¸ä¸ªå½ä»¤ã\n\nåå»ºè¿åè¢«çè§çä¸»æå¡å¨çç½ç»è¿æ¥ï¼Sentinel å°æä¸ºä¸»æå¡å¨çå®¢æ·ç«¯ï¼å®å¯ä»¥åä¸»æå¡å¨åéå½ä»¤ï¼å¹¶ä»å½ä»¤åå¤ä¸­è·åç¸å³çä¿¡æ¯ãå¯¹äºæ¯ä¸ªè¢« Sentinel çè§çä¸»æå¡å¨ï¼Sentinel ä¼åå»ºä¸¤ä¸ªè¿åä¸»æå¡å¨çå¼æ­¥ç½ç»ï¼\n\n * å½ä»¤è¿æ¥ï¼ä¸é¨ç¨äºåä¸»æå¡å¨åéå½ä»¤ï¼å¹¶æ¥åå½ä»¤åå¤ã\n * è®¢éè¿æ¥ï¼ä¸é¨ç¨äºè®¢éä¸»æå¡å¨ç __sentinel__:hello é¢éã\n\n\n# ä¸ãçæ§\n\n\n# æ£æµæå¡å¨ç¶æ\n\n> Sentinel å Redis æå¡å¨åé PING å½ä»¤ï¼æ£æ¥å¶ç¶æã\n\né»è®¤æåµä¸ï¼æ¯ä¸ª Sentinel èç¹ä¼ä»¥ æ¯ç§ä¸æ¬¡ çé¢çå¯¹ Redis èç¹å å¶å® ç Sentinel èç¹åé PING å½ä»¤ï¼å¹¶éè¿èç¹ç åå¤ æ¥å¤æ­èç¹æ¯å¦å¨çº¿ã\n\n * ä¸»è§ä¸çº¿ï¼ä¸»è§ä¸çº¿ éç¨äºææ ä¸»èç¹ å ä»èç¹ãå¦æå¨ down-after-milliseconds æ¯«ç§åï¼Sentinel æ²¡ææ¶å° ç®æ èç¹ çææåå¤ï¼åä¼å¤å® è¯¥èç¹ ä¸º ä¸»è§ä¸çº¿ã\n * å®¢è§ä¸çº¿ï¼å®¢è§ä¸çº¿ åªéç¨äº ä¸»èç¹ãå½ Sentinel å°ä¸ä¸ªä¸»æå¡å¨å¤æ­ä¸ºä¸»ç®¡ä¸çº¿åï¼ä¸ºäºç¡®è®¤è¿ä¸ªä¸»æå¡å¨æ¯å¦ççä¸çº¿ï¼ä¼ååæ ·çè§è¿ä¸ä¸»æå¡å¨çå¶ä» Sentinel è¯¢é®ï¼çå®ä»¬æ¯å¦ä¹è®¤ä¸ºä¸»æå¡å¨å·²ç»ä¸çº¿ãå½è¶³å¤æ°éç Sentinel è®¤ä¸ºä¸»æå¡å¨å·²ä¸çº¿ï¼å°±å¤å®å¶ä¸ºå®¢è§ä¸çº¿ï¼å¹¶å¯¹å¶æ§è¡æéè½¬ç§»æä½ã\n   * Sentinel èç¹éè¿ sentinel is-master-down-by-addr å½ä»¤ï¼åå¶å® Sentinel èç¹è¯¢é®å¯¹è¯¥èç¹ç ç¶æå¤æ­ã\n\n\n# è·åæå¡å¨ä¿¡æ¯\n\n> Sentinel åä¸»æå¡å¨åé INFO å½ä»¤ï¼è·åä¸»æå¡å¨åå®çä»æå¡å¨ä¿¡æ¯ã\n\n * è·åä¸»æå¡å¨ä¿¡æ¯ - Sentinel é»è®¤ä¼ä»¥æ¯åç§ä¸æ¬¡çé¢çï¼éè¿å½ä»¤è¿æ¥åè¢«çè§çä¸»æå¡å¨åé INFO å½ä»¤ï¼å¹¶éè¿åæ INFO å½ä»¤çåå¤æ¥è·åä¸»æå¡å¨çå½åä¿¡æ¯ã\n   * ä¸»æå¡èªèº«ä¿¡æ¯ï¼åæ¬ run_id åè®°å½çæå¡å¨è¿è¡ IDï¼ä»¥å role åè®°å½çæå¡å¨è§è²\n   * ä¸»æå¡çä»æå¡å¨ä¿¡æ¯ï¼åæ¬ IP å°ååç«¯å£å·\n * è·åä»æå¡å¨ä¿¡æ¯ - å½ Sentinel åç°ä¸»æå¡å¨ææ°çä»æå¡å¨åºç°æ¶ï¼Sentinel é¤äºä¼ä¸ºè¿ä¸ªæ°çä»æå¡å¨åå»ºç¸åºçå®ä¾ç»æä¹å¤ï¼Sentinel è¿ä¼åå»ºè¿æ¥å°ä»æå¡å¨çå½ä»¤è¿æ¥åè®¢éè¿æ¥ã\n\n\n# åãéç¥\n\nå¯¹äºæ¯ä¸ªä¸ Sentinel è¿æ¥çæå¡å¨ï¼Sentinel æ¢ä¼åæå¡å¨ç __sentinel__:hello é¢éåéæ¶æ¯ï¼ä¹ä¼è®¢éæå¡å¨ç __sentinel__:hello é¢éçæ¶æ¯ã\n\n\n\n\n# åæå¡å¨åéæ¶æ¯\n\nå¨é»è®¤æåµä¸ï¼Sentinel ä¼ä»¥æ¯ä¸¤ç§ä¸æ¬¡çé¢çï¼éè¿å½ä»¤åææè¢«çè§çä¸»æå¡å¨åä»æå¡å¨åéä»¥ä¸æ ¼å¼çå½ä»¤ã\n\nPUBLISH __sentinel__:hello "<s_ip>,<s_port>,<s_runid>,<s_epoch>,<m_name>,<m_ip>,<m_port>,<m_epoch>"\n\n\nè¿æ¡å½ä»¤åæå¡å¨ç __sentinel__:hello é¢éåéä¸æ¡æ¶æ¯ã\n\n\n# æ¥æ¶æå¡å¨çæ¶æ¯\n\nå½ Sentinel ä¸ä¸ä¸ªä¸»æå¡å¨æä»æå¡å¨å»ºç«èµ·è®¢éè¿æ¥åï¼Sentinel å°±ä¼éè¿è®¢éè¿æ¥ï¼åæå¡å¨åéä»¥ä¸å½ä»¤ï¼SUBSCRIBE __sentinel__:helloã\n\nSentinel å¯¹ __sentinel__:hello é¢éçè®¢éä¼ä¸ç´æç»­å° Sentinel ä¸æå¡å¨æ­å¼è¿æ¥ä¸ºæ­¢ã\n\n\n# äºãéä¸¾ Leader\n\n> Redis Sentinel ç³»ç»éä¸¾ Leader çç®æ³æ¯ Raft çå®ç°ã\n> \n> Raft æ¯ä¸ç§å±è¯æ§ç®æ³ï¼æ³äºè§£å¶åçï¼å¯ä»¥åè æ·±å¥åæå±è¯æ§ç®æ³ Raftã\n\nå½ä¸ä¸ªä¸»æå¡å¨è¢«å¤æ­ä¸ºå®¢è§ä¸çº¿æ¶ï¼çè§è¿ä¸ªä¸çº¿ä¸»æå¡å¨çåä¸ª Sentinel ä¼è¿è¡ååï¼éä¸¾åºä¸ä¸ªé¢å¤´ç Sentinelï¼å¹¶ç±é¢å¤´ Sentinel å¯¹ä¸çº¿ä¸»æå¡å¨æ§è¡æéè½¬ç§»æä½ã\n\nææå¨çº¿ Sentinel é½æèµæ ¼è¢«éä¸º Leaderã\n\næ¯ä¸ª Sentinel èç¹é½éè¦ å®ææ§è¡ ä»¥ä¸ä»»å¡ï¼\n\nï¼1ï¼æ¯ä¸ª Sentinel ä»¥ æ¯ç§é ä¸æ¬¡çé¢çï¼åå®æç¥ç ä¸»æå¡å¨ãä»æå¡å¨ ä»¥åå¶ä» Sentinel å®ä¾ åéä¸ä¸ª PING å½ä»¤ã\n\n\n\nï¼2ï¼å¦æä¸ä¸ª å®ä¾ï¼instanceï¼è·ç¦» æåä¸æ¬¡ ææåå¤ PING å½ä»¤çæ¶é´è¶è¿ down-after-milliseconds ææå®çå¼ï¼é£ä¹è¿ä¸ªå®ä¾ä¼è¢« Sentinel æ è®°ä¸º ä¸»è§ä¸çº¿ã\n\n\n\nï¼3ï¼å¦æä¸ä¸ª ä¸»æå¡å¨ è¢«æ è®°ä¸º ä¸»è§ä¸çº¿ï¼é£ä¹æ­£å¨ çè§ è¿ä¸ª ä¸»æå¡å¨ çææ Sentinel èç¹ï¼è¦ä»¥ æ¯ç§ä¸æ¬¡ çé¢çç¡®è®¤ ä¸»æå¡å¨ çç¡®è¿å¥äº ä¸»è§ä¸çº¿ ç¶æã\n\n\n\nï¼4ï¼å¦æä¸ä¸ª ä¸»æå¡å¨ è¢«æ è®°ä¸º ä¸»è§ä¸çº¿ï¼å¹¶ä¸æ è¶³å¤æ°é ç Sentinelï¼è³å°è¦è¾¾å° éç½®æä»¶ æå®çæ°éï¼å¨æå®ç æ¶é´èå´ ååæè¿ä¸å¤æ­ï¼é£ä¹è¿ä¸ª ä¸»æå¡å¨ è¢«æ è®°ä¸º å®¢è§ä¸çº¿ã\n\n\n\nï¼5ï¼å¨ä¸è¬æåµä¸ï¼ æ¯ä¸ª Sentinel ä¼ä»¥æ¯ 10 ç§ä¸æ¬¡çé¢çï¼åå®å·²ç¥çææ ä¸»æå¡å¨ å ä»æå¡å¨ åé INFO å½ä»¤ãå½ä¸ä¸ª ä¸»æå¡å¨ è¢« Sentinel æ è®°ä¸º å®¢è§ä¸çº¿ æ¶ï¼Sentinel å ä¸çº¿ä¸»æå¡å¨ çææ ä»æå¡å¨ åé INFO å½ä»¤çé¢çï¼ä¼ä» 10 ç§ä¸æ¬¡æ¹ä¸º æ¯ç§ä¸æ¬¡ã\n\n\n\nï¼6ï¼Sentinel åå¶ä» Sentinel åå ä¸»èç¹ çç¶æï¼å¦æ ä¸»èç¹ å¤äº SDOWN ç¶æï¼åæç¥¨èªå¨éåºæ°ç ä¸»èç¹ãå°å©ä½ç ä»èç¹ æå æ°çä¸»èç¹ è¿è¡ æ°æ®å¤å¶ã\n\n\n\nï¼7ï¼å½æ²¡æè¶³å¤æ°éç Sentinel åæ ä¸»æå¡å¨ ä¸çº¿æ¶ï¼ ä¸»æå¡å¨ ç å®¢è§ä¸çº¿ç¶æ å°±ä¼è¢«ç§»é¤ãå½ ä¸»æå¡å¨ éæ°å Sentinel ç PING å½ä»¤è¿å ææåå¤ æ¶ï¼ä¸»æå¡å¨ ç ä¸»è§ä¸çº¿ç¶æ å°±ä¼è¢«ç§»é¤ã\n\n\n\n> æ³¨æï¼ä¸ä¸ªææç PING åå¤å¯ä»¥æ¯ï¼+PONGã-LOADING æè -MASTERDOWNãå¦æ æå¡å¨ è¿åé¤ä»¥ä¸ä¸ç§åå¤ä¹å¤çå¶ä»åå¤ï¼åæèå¨ æå®æ¶é´ åæ²¡æåå¤ PING å½ä»¤ï¼ é£ä¹ Sentinel è®¤ä¸ºæå¡å¨è¿åçåå¤ æ æï¼non-validï¼ã\n\n\n# å­ãæéè½¬ç§»\n\nå¨éä¸¾äº§çåº Sentinel Leader åï¼Sentinel Leader å°å¯¹å·²ä¸çº¿çä¸»æå¡å¨æ§è¡æéè½¬ç§»æä½ãæä½å«ä»¥ä¸ä¸ä¸ªæ­¥éª¤ï¼\n\nï¼ä¸ï¼éåºæ°çä¸»æå¡å¨\n\næéè½¬ç§»ç¬¬ä¸æ­¥ï¼æ¯ Sentinel Leader å¨å·²ä¸çº¿ä¸»æå¡å±ä¸çææä»æå¡å¨ä¸­ï¼æéä¸ä¸ªç¶æè¯å¥½ãæ°æ®å®æ´çä»æå¡å¨ãç¶åï¼åè¿ä¸ªä»æå¡å¨åé SLAVEOF no one å½ä»¤ï¼å°å¶è½¬æ¢ä¸ºä¸»æå¡å¨ã\n\nSentinel Leader å¦ä½éåºæ°çä¸»æå¡å¨ï¼\n\n * å é¤åè¡¨ä¸­ææå¤äºä¸çº¿ææ­çº¿ç¶æçä»æå¡å¨ã\n * å é¤åè¡¨ä¸­æææè¿äºç§æ²¡æåå¤è¿ Sentinel Leader ç INFO å½ä»¤çä»æå¡å¨ã\n * å é¤ææä¸å·²ä¸çº¿ä¸»æå¡å¨è¿æ¥æ­å¼è¶è¿ down-after-milliseconds * 10 æ¯«ç§çä»æå¡å¨ï¼down-after-milliseconds æå®äºå¤æ­ä¸»æå¡å¨ä¸çº¿æéçæ¶é´ï¼ã\n * ä¹åï¼ Sentinel Leader åéåºä¼åçº§æé«çä»æå¡å¨ï¼å¦æä¼åçº§ä¸æ ·é«ï¼åéæ©å¤å¶åç§»éæå¤§çä»æå¡å¨ï¼å¦æç»æè¿ä¸å¯ä¸ï¼åéåºè¿è¡ ID æå°çä»æå¡å¨ã\n\nï¼äºï¼ä¿®æ¹ä»æå¡å¨çå¤å¶ç®æ \n\néåºæ°çä¸»æå¡å¨åï¼Sentinel Leader ä¼åææä»æå¡å¨åé SLAVEOF å½ä»¤ï¼è®©å®ä»¬å»å¤å¶æ°çä¸»æå¡å¨ã\n\nï¼ä¸ï¼å°æ§çä¸»æå¡å¨åä¸ºä»æå¡å¨\n\nSentinel Leader å°æ§çä¸»æå¡å¨æ è®°ä¸ºä»æå¡å¨ãå½æ§çä¸»æå¡å¨éæ°ä¸çº¿ï¼Sentinel ä¼åå®åé SLAVEOF å½ä»¤ï¼è®©å¶æä¸ºä»æå¡å¨ã\n\n\n# åèèµæ\n\n * å®ç½\n   * Redis å®ç½\n   * Redis github\n   * Redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãRedis å®æã\n   * ãRedis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * Redis å½ä»¤åè\n * æç« \n   * æ¸è¿å¼è§£æ Redis æºç  - å¨åµ sentinel\n   * æ·±å¥åæ Redis ç³»å(äº) - Redis å¨åµæ¨¡å¼ä¸é«å¯ç¨éç¾¤',normalizedContent:'# redis å¨åµ\n\n> redis å¨åµï¼sentinelï¼æ¯ redis çé«å¯ç¨æ§ï¼hight availabilityï¼è§£å³æ¹æ¡ã\n> \n> redis å¨åµæ¯ raft ç®æ³ çå·ä½å®ç°ã\n\n\n\n\n# ä¸ãå¨åµç®ä»\n\nredis å¨åµï¼sentinelï¼æ¯ redis çé«å¯ç¨æ§ï¼hight availabilityï¼è§£å³æ¹æ¡ï¼ç±ä¸ä¸ªæå¤ä¸ª sentinel å®ä¾ç»æç sentinel ç³»ç»å¯ä»¥çè§ä»»æå¤ä¸ªä¸»æå¡å¨ï¼ä»¥åè¿äºä¸»æå¡å¨çææä»æå¡å¨ï¼å¹¶å¨è¢«çè§çä¸»æå¡å¨è¿å¥ä¸çº¿ç¶ææ¶ï¼èªå¨å°ä¸çº¿ä¸»æå¡å¨çæä¸ªä»æå¡å¨åçº§ä¸ºæ°çä¸»æå¡å¨ï¼ç¶åç±æ°çä¸»æå¡å¨ä»£æ¿å·²ä¸çº¿çä¸»æå¡å¨ç»§ç»­å¤çå½ä»¤è¯·æ±ã\n\n\n\nsentinel çä¸»è¦åè½å¦ä¸ï¼\n\n * çæ§ï¼monitoringï¼ - sentinel ä¸æ­æ£æ¥ä¸»ä»æå¡å¨æ¯å¦æ­£å¸¸å¨å·¥ä½ã\n * éç¥ï¼notificationï¼ - sentinel å¯ä»¥éè¿ä¸ä¸ª api æ¥éç¥ç³»ç»ç®¡çåæèå¦å¤çåºç¨ç¨åºï¼è¢«çæ§ç redis å®ä¾æä¸äºé®é¢ã\n * èªå¨æéè½¬ç§»ï¼automatic failoverï¼ - å¦æä¸ä¸ªä¸»æå¡å¨ä¸çº¿ï¼sentinel ä¼å¼å§èªå¨æéè½¬ç§»ï¼æä¸ä¸ªä»èç¹æåä¸ºä¸»èç¹ï¼å¹¶éæ°éç½®å¶ä»çä»èç¹ä½¿ç¨æ°çä¸»èç¹ï¼ä½¿ç¨ redis æå¡çåºç¨ç¨åºå¨è¿æ¥çæ¶åä¹è¢«éç¥æ°çå°åã\n * éç½®æä¾èï¼configuration providerï¼ - sentinel ç»å®¢æ·ç«¯çæå¡åç°æä¾æ¥æºï¼å¯¹äºä¸ä¸ªç»å®çæå¡ï¼å®¢æ·ç«¯è¿æ¥å° sentinels æ¥å¯»æ¾å½åä¸»èç¹çå°åãå½æéè½¬ç§»åççæ¶åï¼sentinel å°æ¥åæ°çå°åã\n\n\n# äºãå¯å¨å¨åµ\n\nå¯å¨ä¸ä¸ª sentinel å¯ä»¥ä½¿ç¨ä¸é¢ä»»æä¸æ¡å½ä»¤ï¼ä¸¤æ¡å½ä»¤ææå®å¨ç¸åã\n\nredis-sentinel /path/to/sentinel.conf\nredis-server /path/to/sentinel.conf --sentinel\n\n\nå½ä¸ä¸ª sentinel å¯å¨æ¶ï¼å®éè¦æ§è¡ä»¥ä¸æ­¥éª¤ï¼\n\n 1. åå§åæå¡å¨ã\n 2. ä½¿ç¨ sentinel ä¸ç¨ä»£ç ã\n 3. åå§å sentinel ç¶æã\n 4. åå§å sentinel çä¸»æå¡å¨åè¡¨ã\n 5. åå»ºè¿åè¢«çè§çä¸»æå¡å¨çç½ç»è¿æ¥ã\n\nsentinel æ¬è´¨ä¸æ¯ä¸ä¸ªè¿è¡å¨ç¹æ®ç¶æ¨¡å¼ä¸ç redis æå¡å¨ã\n\nsentinel æ¨¡å¼ä¸ redis æå¡å¨åªæ¯æ pingãsentinelãinfoãsubscribeãunsubscribeãpsubscribeãpunsubscribe ä¸ä¸ªå½ä»¤ã\n\nåå»ºè¿åè¢«çè§çä¸»æå¡å¨çç½ç»è¿æ¥ï¼sentinel å°æä¸ºä¸»æå¡å¨çå®¢æ·ç«¯ï¼å®å¯ä»¥åä¸»æå¡å¨åéå½ä»¤ï¼å¹¶ä»å½ä»¤åå¤ä¸­è·åç¸å³çä¿¡æ¯ãå¯¹äºæ¯ä¸ªè¢« sentinel çè§çä¸»æå¡å¨ï¼sentinel ä¼åå»ºä¸¤ä¸ªè¿åä¸»æå¡å¨çå¼æ­¥ç½ç»ï¼\n\n * å½ä»¤è¿æ¥ï¼ä¸é¨ç¨äºåä¸»æå¡å¨åéå½ä»¤ï¼å¹¶æ¥åå½ä»¤åå¤ã\n * è®¢éè¿æ¥ï¼ä¸é¨ç¨äºè®¢éä¸»æå¡å¨ç __sentinel__:hello é¢éã\n\n\n# ä¸ãçæ§\n\n\n# æ£æµæå¡å¨ç¶æ\n\n> sentinel å redis æå¡å¨åé ping å½ä»¤ï¼æ£æ¥å¶ç¶æã\n\né»è®¤æåµä¸ï¼æ¯ä¸ª sentinel èç¹ä¼ä»¥ æ¯ç§ä¸æ¬¡ çé¢çå¯¹ redis èç¹å å¶å® ç sentinel èç¹åé ping å½ä»¤ï¼å¹¶éè¿èç¹ç åå¤ æ¥å¤æ­èç¹æ¯å¦å¨çº¿ã\n\n * ä¸»è§ä¸çº¿ï¼ä¸»è§ä¸çº¿ éç¨äºææ ä¸»èç¹ å ä»èç¹ãå¦æå¨ down-after-milliseconds æ¯«ç§åï¼sentinel æ²¡ææ¶å° ç®æ èç¹ çææåå¤ï¼åä¼å¤å® è¯¥èç¹ ä¸º ä¸»è§ä¸çº¿ã\n * å®¢è§ä¸çº¿ï¼å®¢è§ä¸çº¿ åªéç¨äº ä¸»èç¹ãå½ sentinel å°ä¸ä¸ªä¸»æå¡å¨å¤æ­ä¸ºä¸»ç®¡ä¸çº¿åï¼ä¸ºäºç¡®è®¤è¿ä¸ªä¸»æå¡å¨æ¯å¦ççä¸çº¿ï¼ä¼ååæ ·çè§è¿ä¸ä¸»æå¡å¨çå¶ä» sentinel è¯¢é®ï¼çå®ä»¬æ¯å¦ä¹è®¤ä¸ºä¸»æå¡å¨å·²ç»ä¸çº¿ãå½è¶³å¤æ°éç sentinel è®¤ä¸ºä¸»æå¡å¨å·²ä¸çº¿ï¼å°±å¤å®å¶ä¸ºå®¢è§ä¸çº¿ï¼å¹¶å¯¹å¶æ§è¡æéè½¬ç§»æä½ã\n   * sentinel èç¹éè¿ sentinel is-master-down-by-addr å½ä»¤ï¼åå¶å® sentinel èç¹è¯¢é®å¯¹è¯¥èç¹ç ç¶æå¤æ­ã\n\n\n# è·åæå¡å¨ä¿¡æ¯\n\n> sentinel åä¸»æå¡å¨åé info å½ä»¤ï¼è·åä¸»æå¡å¨åå®çä»æå¡å¨ä¿¡æ¯ã\n\n * è·åä¸»æå¡å¨ä¿¡æ¯ - sentinel é»è®¤ä¼ä»¥æ¯åç§ä¸æ¬¡çé¢çï¼éè¿å½ä»¤è¿æ¥åè¢«çè§çä¸»æå¡å¨åé info å½ä»¤ï¼å¹¶éè¿åæ info å½ä»¤çåå¤æ¥è·åä¸»æå¡å¨çå½åä¿¡æ¯ã\n   * ä¸»æå¡èªèº«ä¿¡æ¯ï¼åæ¬ run_id åè®°å½çæå¡å¨è¿è¡ idï¼ä»¥å role åè®°å½çæå¡å¨è§è²\n   * ä¸»æå¡çä»æå¡å¨ä¿¡æ¯ï¼åæ¬ ip å°ååç«¯å£å·\n * è·åä»æå¡å¨ä¿¡æ¯ - å½ sentinel åç°ä¸»æå¡å¨ææ°çä»æå¡å¨åºç°æ¶ï¼sentinel é¤äºä¼ä¸ºè¿ä¸ªæ°çä»æå¡å¨åå»ºç¸åºçå®ä¾ç»æä¹å¤ï¼sentinel è¿ä¼åå»ºè¿æ¥å°ä»æå¡å¨çå½ä»¤è¿æ¥åè®¢éè¿æ¥ã\n\n\n# åãéç¥\n\nå¯¹äºæ¯ä¸ªä¸ sentinel è¿æ¥çæå¡å¨ï¼sentinel æ¢ä¼åæå¡å¨ç __sentinel__:hello é¢éåéæ¶æ¯ï¼ä¹ä¼è®¢éæå¡å¨ç __sentinel__:hello é¢éçæ¶æ¯ã\n\n\n\n\n# åæå¡å¨åéæ¶æ¯\n\nå¨é»è®¤æåµä¸ï¼sentinel ä¼ä»¥æ¯ä¸¤ç§ä¸æ¬¡çé¢çï¼éè¿å½ä»¤åææè¢«çè§çä¸»æå¡å¨åä»æå¡å¨åéä»¥ä¸æ ¼å¼çå½ä»¤ã\n\npublish __sentinel__:hello "<s_ip>,<s_port>,<s_runid>,<s_epoch>,<m_name>,<m_ip>,<m_port>,<m_epoch>"\n\n\nè¿æ¡å½ä»¤åæå¡å¨ç __sentinel__:hello é¢éåéä¸æ¡æ¶æ¯ã\n\n\n# æ¥æ¶æå¡å¨çæ¶æ¯\n\nå½ sentinel ä¸ä¸ä¸ªä¸»æå¡å¨æä»æå¡å¨å»ºç«èµ·è®¢éè¿æ¥åï¼sentinel å°±ä¼éè¿è®¢éè¿æ¥ï¼åæå¡å¨åéä»¥ä¸å½ä»¤ï¼subscribe __sentinel__:helloã\n\nsentinel å¯¹ __sentinel__:hello é¢éçè®¢éä¼ä¸ç´æç»­å° sentinel ä¸æå¡å¨æ­å¼è¿æ¥ä¸ºæ­¢ã\n\n\n# äºãéä¸¾ leader\n\n> redis sentinel ç³»ç»éä¸¾ leader çç®æ³æ¯ raft çå®ç°ã\n> \n> raft æ¯ä¸ç§å±è¯æ§ç®æ³ï¼æ³äºè§£å¶åçï¼å¯ä»¥åè æ·±å¥åæå±è¯æ§ç®æ³ raftã\n\nå½ä¸ä¸ªä¸»æå¡å¨è¢«å¤æ­ä¸ºå®¢è§ä¸çº¿æ¶ï¼çè§è¿ä¸ªä¸çº¿ä¸»æå¡å¨çåä¸ª sentinel ä¼è¿è¡ååï¼éä¸¾åºä¸ä¸ªé¢å¤´ç sentinelï¼å¹¶ç±é¢å¤´ sentinel å¯¹ä¸çº¿ä¸»æå¡å¨æ§è¡æéè½¬ç§»æä½ã\n\nææå¨çº¿ sentinel é½æèµæ ¼è¢«éä¸º leaderã\n\næ¯ä¸ª sentinel èç¹é½éè¦ å®ææ§è¡ ä»¥ä¸ä»»å¡ï¼\n\nï¼1ï¼æ¯ä¸ª sentinel ä»¥ æ¯ç§é ä¸æ¬¡çé¢çï¼åå®æç¥ç ä¸»æå¡å¨ãä»æå¡å¨ ä»¥åå¶ä» sentinel å®ä¾ åéä¸ä¸ª ping å½ä»¤ã\n\n\n\nï¼2ï¼å¦æä¸ä¸ª å®ä¾ï¼instanceï¼è·ç¦» æåä¸æ¬¡ ææåå¤ ping å½ä»¤çæ¶é´è¶è¿ down-after-milliseconds ææå®çå¼ï¼é£ä¹è¿ä¸ªå®ä¾ä¼è¢« sentinel æ è®°ä¸º ä¸»è§ä¸çº¿ã\n\n\n\nï¼3ï¼å¦æä¸ä¸ª ä¸»æå¡å¨ è¢«æ è®°ä¸º ä¸»è§ä¸çº¿ï¼é£ä¹æ­£å¨ çè§ è¿ä¸ª ä¸»æå¡å¨ çææ sentinel èç¹ï¼è¦ä»¥ æ¯ç§ä¸æ¬¡ çé¢çç¡®è®¤ ä¸»æå¡å¨ çç¡®è¿å¥äº ä¸»è§ä¸çº¿ ç¶æã\n\n\n\nï¼4ï¼å¦æä¸ä¸ª ä¸»æå¡å¨ è¢«æ è®°ä¸º ä¸»è§ä¸çº¿ï¼å¹¶ä¸æ è¶³å¤æ°é ç sentinelï¼è³å°è¦è¾¾å° éç½®æä»¶ æå®çæ°éï¼å¨æå®ç æ¶é´èå´ ååæè¿ä¸å¤æ­ï¼é£ä¹è¿ä¸ª ä¸»æå¡å¨ è¢«æ è®°ä¸º å®¢è§ä¸çº¿ã\n\n\n\nï¼5ï¼å¨ä¸è¬æåµä¸ï¼ æ¯ä¸ª sentinel ä¼ä»¥æ¯ 10 ç§ä¸æ¬¡çé¢çï¼åå®å·²ç¥çææ ä¸»æå¡å¨ å ä»æå¡å¨ åé info å½ä»¤ãå½ä¸ä¸ª ä¸»æå¡å¨ è¢« sentinel æ è®°ä¸º å®¢è§ä¸çº¿ æ¶ï¼sentinel å ä¸çº¿ä¸»æå¡å¨ çææ ä»æå¡å¨ åé info å½ä»¤çé¢çï¼ä¼ä» 10 ç§ä¸æ¬¡æ¹ä¸º æ¯ç§ä¸æ¬¡ã\n\n\n\nï¼6ï¼sentinel åå¶ä» sentinel åå ä¸»èç¹ çç¶æï¼å¦æ ä¸»èç¹ å¤äº sdown ç¶æï¼åæç¥¨èªå¨éåºæ°ç ä¸»èç¹ãå°å©ä½ç ä»èç¹ æå æ°çä¸»èç¹ è¿è¡ æ°æ®å¤å¶ã\n\n\n\nï¼7ï¼å½æ²¡æè¶³å¤æ°éç sentinel åæ ä¸»æå¡å¨ ä¸çº¿æ¶ï¼ ä¸»æå¡å¨ ç å®¢è§ä¸çº¿ç¶æ å°±ä¼è¢«ç§»é¤ãå½ ä¸»æå¡å¨ éæ°å sentinel ç ping å½ä»¤è¿å ææåå¤ æ¶ï¼ä¸»æå¡å¨ ç ä¸»è§ä¸çº¿ç¶æ å°±ä¼è¢«ç§»é¤ã\n\n\n\n> æ³¨æï¼ä¸ä¸ªææç ping åå¤å¯ä»¥æ¯ï¼+pongã-loading æè -masterdownãå¦æ æå¡å¨ è¿åé¤ä»¥ä¸ä¸ç§åå¤ä¹å¤çå¶ä»åå¤ï¼åæèå¨ æå®æ¶é´ åæ²¡æåå¤ ping å½ä»¤ï¼ é£ä¹ sentinel è®¤ä¸ºæå¡å¨è¿åçåå¤ æ æï¼non-validï¼ã\n\n\n# å­ãæéè½¬ç§»\n\nå¨éä¸¾äº§çåº sentinel leader åï¼sentinel leader å°å¯¹å·²ä¸çº¿çä¸»æå¡å¨æ§è¡æéè½¬ç§»æä½ãæä½å«ä»¥ä¸ä¸ä¸ªæ­¥éª¤ï¼\n\nï¼ä¸ï¼éåºæ°çä¸»æå¡å¨\n\næéè½¬ç§»ç¬¬ä¸æ­¥ï¼æ¯ sentinel leader å¨å·²ä¸çº¿ä¸»æå¡å±ä¸çææä»æå¡å¨ä¸­ï¼æéä¸ä¸ªç¶æè¯å¥½ãæ°æ®å®æ´çä»æå¡å¨ãç¶åï¼åè¿ä¸ªä»æå¡å¨åé slaveof no one å½ä»¤ï¼å°å¶è½¬æ¢ä¸ºä¸»æå¡å¨ã\n\nsentinel leader å¦ä½éåºæ°çä¸»æå¡å¨ï¼\n\n * å é¤åè¡¨ä¸­ææå¤äºä¸çº¿ææ­çº¿ç¶æçä»æå¡å¨ã\n * å é¤åè¡¨ä¸­æææè¿äºç§æ²¡æåå¤è¿ sentinel leader ç info å½ä»¤çä»æå¡å¨ã\n * å é¤ææä¸å·²ä¸çº¿ä¸»æå¡å¨è¿æ¥æ­å¼è¶è¿ down-after-milliseconds * 10 æ¯«ç§çä»æå¡å¨ï¼down-after-milliseconds æå®äºå¤æ­ä¸»æå¡å¨ä¸çº¿æéçæ¶é´ï¼ã\n * ä¹åï¼ sentinel leader åéåºä¼åçº§æé«çä»æå¡å¨ï¼å¦æä¼åçº§ä¸æ ·é«ï¼åéæ©å¤å¶åç§»éæå¤§çä»æå¡å¨ï¼å¦æç»æè¿ä¸å¯ä¸ï¼åéåºè¿è¡ id æå°çä»æå¡å¨ã\n\nï¼äºï¼ä¿®æ¹ä»æå¡å¨çå¤å¶ç®æ \n\néåºæ°çä¸»æå¡å¨åï¼sentinel leader ä¼åææä»æå¡å¨åé slaveof å½ä»¤ï¼è®©å®ä»¬å»å¤å¶æ°çä¸»æå¡å¨ã\n\nï¼ä¸ï¼å°æ§çä¸»æå¡å¨åä¸ºä»æå¡å¨\n\nsentinel leader å°æ§çä¸»æå¡å¨æ è®°ä¸ºä»æå¡å¨ãå½æ§çä¸»æå¡å¨éæ°ä¸çº¿ï¼sentinel ä¼åå®åé slaveof å½ä»¤ï¼è®©å¶æä¸ºä»æå¡å¨ã\n\n\n# åèèµæ\n\n * å®ç½\n   * redis å®ç½\n   * redis github\n   * redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãredis å®æã\n   * ãredis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * redis å½ä»¤åè\n * æç« \n   * æ¸è¿å¼è§£æ redis æºç  - å¨åµ sentinel\n   * æ·±å¥åæ redis ç³»å(äº) - redis å¨åµæ¨¡å¼ä¸é«å¯ç¨éç¾¤',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Redis å®æ",frontmatter:{title:"Redis å®æ",date:"2020-06-24T10:45:38.000Z",categories:["æ°æ®åº","KVæ°æ®åº","Redis"],tags:["æ°æ®åº","KVæ°æ®åº","Redis"],permalink:"/pages/1fc9c4/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/05.KV%E6%95%B0%E6%8D%AE%E5%BA%93/01.Redis/08.Redis%E5%AE%9E%E6%88%98.html",relativePath:"12.æ°æ®åº/05.KVæ°æ®åº/01.Redis/08.Rediså®æ.md",key:"v-2ccee58b",path:"/pages/1fc9c4/",headers:[{level:2,title:"ä¸ãåºç¨åºæ¯",slug:"ä¸ãåºç¨åºæ¯",normalizedTitle:"ä¸ãåºç¨åºæ¯",charIndex:15},{level:3,title:"ç¼å­",slug:"ç¼å­",normalizedTitle:"ç¼å­",charIndex:58},{level:3,title:"BitMap å BloomFilter",slug:"bitmap-å-bloomfilter",normalizedTitle:"bitmap å bloomfilter",charIndex:175},{level:3,title:"åå¸å¼é",slug:"åå¸å¼é",normalizedTitle:"åå¸å¼é",charIndex:384},{level:2,title:"äºãæå·§",slug:"äºãæå·§",normalizedTitle:"äºãæå·§",charIndex:597},{level:3,title:"keys å scan",slug:"keys-å-scan",normalizedTitle:"keys å scan",charIndex:638},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:1023}],headersStr:"ä¸ãåºç¨åºæ¯ ç¼å­ BitMap å BloomFilter åå¸å¼é äºãæå·§ keys å scan åèèµæ",content:"# Redis å®æ\n\n\n# ä¸ãåºç¨åºæ¯\n\nRedis å¯ä»¥åºç¨äºå¾å¤åºæ¯ï¼è¿éåä¸¾å ä¸ªç»å¸çåºç¨åºæ¯ã\n\n\n# ç¼å­\n\nç¼å­æ¯ Redis æå¸¸è§çåºç¨åºæ¯ã\n\nRedis æå¤ç§æ°æ®ç±»åï¼ä»¥åä¸°å¯çæä½å½ä»¤ï¼å¹¶ä¸æçé«æ§è½ãé«å¯ç¨çç¹æ§ï¼éå¸¸éåç¨äºåå¸å¼ç¼å­ã\n\n> ç¼å­åºç¨çåºæ¬åçï¼è¯·åè ç¼å­åºæ¬åç ç¬¬å ~ ç¬¬å­èåå®¹ã\n\n\n# BitMap å BloomFilter\n\nRedis é¤äº 5 ç§åºæ¬æ°æ®ç±»åå¤ï¼è¿æ¯æ BitMap å BloomFilterï¼å³å¸éè¿æ»¤å¨ï¼å¯ä»¥éè¿ Redis Module æ¯æï¼ã\n\nBitMap å BloomFilter é½å¯ä»¥ç¨äºè§£å³ç¼å­ç©¿éé®é¢ãè¦ç¹å¨äºï¼è¿æ»¤ä¸äºä¸å¯è½å­å¨çæ°æ®ã\n\n> ä»ä¹æ¯ç¼å­ç©¿éï¼å¯ä»¥åèï¼ç¼å­åºæ¬åç\n\nå°æ°æ®éå¯ä»¥ç¨ BitMapï¼å¤§æ°æ®éå¯ä»¥ç¨å¸éè¿æ»¤å¨ã\n\n\n# åå¸å¼é\n\nä½¿ç¨ Redis ä½ä¸ºåå¸å¼éï¼åºæ¬è¦ç¹å¦ä¸ï¼\n\n * äºæ¥æ§ - ä½¿ç¨ setnx æ¢å éã\n * é¿åæ°¸è¿ä¸éæ¾é - ä½¿ç¨ expire å ä¸ä¸ªè¿ææ¶é´ï¼é¿åä¸ç´ä¸éæ¾éï¼å¯¼è´é»å¡ã\n * åå­æ§ - setnx å expire å¿é¡»åå¹¶ä¸ºä¸ä¸ªåå­æä»¤ï¼é¿å setnx åï¼æºå¨å´©æºï¼æ²¡æ¥å¾åè®¾ç½® expireï¼ä»èå¯¼è´éæ°¸ä¸éæ¾ã\n\n> æ´å¤åå¸å¼éçå®ç°æ¹å¼åç»èï¼è¯·åèï¼åå¸å¼éåºæ¬åç\n\n\n# äºãæå·§\n\næ ¹æ® Redis çç¹æ§ï¼å¨å®éåºç¨ä¸­ï¼å­å¨ä¸äºåºç¨å°æå·§ã\n\n\n# keys å scan\n\nä½¿ç¨ keys æä»¤å¯ä»¥æ«åºæå®æ¨¡å¼ç key åè¡¨ã\n\nå¦æè¿ä¸ª redis æ­£å¨ç»çº¿ä¸çä¸å¡æä¾æå¡ï¼é£ä½¿ç¨ keys æä»¤ä¼æä»ä¹é®é¢ï¼\n\né¦åï¼Redis æ¯åçº¿ç¨çãkeys æä»¤ä¼å¯¼è´çº¿ç¨é»å¡ä¸æ®µæ¶é´ï¼çº¿ä¸æå¡ä¼åé¡¿ï¼ç´å°æä»¤æ§è¡å®æ¯ï¼æå¡æè½æ¢å¤ã\n\nè¿ä¸ªæ¶åå¯ä»¥ä½¿ç¨ scan æä»¤ï¼scan æä»¤å¯ä»¥æ é»å¡çæååºæå®æ¨¡å¼ç key åè¡¨ï¼ä½æ¯ä¼æä¸å®çéå¤æ¦çï¼å¨å®¢æ·ç«¯åä¸æ¬¡å»éå°±å¯ä»¥äºï¼ä½æ¯æ´ä½æè±è´¹çæ¶é´ä¼æ¯ç´æ¥ç¨ keys æä»¤é¿ã\n\nä¸è¿ï¼å¢éå¼è¿­ä»£å½ä»¤ä¹ä¸æ¯æ²¡æç¼ºç¹çï¼ ä¸¾ä¸ªä¾å­ï¼ ä½¿ç¨ SMEMBERS å½ä»¤å¯ä»¥è¿åéåé®å½ååå«çææåç´ ï¼ ä½æ¯å¯¹äº SCAN è¿ç±»å¢éå¼è¿­ä»£å½ä»¤æ¥è¯´ï¼ å ä¸ºå¨å¯¹é®è¿è¡å¢éå¼è¿­ä»£çè¿ç¨ä¸­ï¼ é®å¯è½ä¼è¢«ä¿®æ¹ï¼ æä»¥å¢éå¼è¿­ä»£å½ä»¤åªè½å¯¹è¢«è¿åçåç´ æä¾æéçä¿è¯ ã\n\n\n# åèèµæ\n\n * å®ç½\n   * Redis å®ç½\n   * Redis github\n   * Redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãRedis å®æã\n   * ãRedis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * Redis å½ä»¤åè\n * æç« \n   * ãæä»¬ä¸èµ·è¿å¤§åãç³»å- Redis åºç¡",normalizedContent:"# redis å®æ\n\n\n# ä¸ãåºç¨åºæ¯\n\nredis å¯ä»¥åºç¨äºå¾å¤åºæ¯ï¼è¿éåä¸¾å ä¸ªç»å¸çåºç¨åºæ¯ã\n\n\n# ç¼å­\n\nç¼å­æ¯ redis æå¸¸è§çåºç¨åºæ¯ã\n\nredis æå¤ç§æ°æ®ç±»åï¼ä»¥åä¸°å¯çæä½å½ä»¤ï¼å¹¶ä¸æçé«æ§è½ãé«å¯ç¨çç¹æ§ï¼éå¸¸éåç¨äºåå¸å¼ç¼å­ã\n\n> ç¼å­åºç¨çåºæ¬åçï¼è¯·åè ç¼å­åºæ¬åç ç¬¬å ~ ç¬¬å­èåå®¹ã\n\n\n# bitmap å bloomfilter\n\nredis é¤äº 5 ç§åºæ¬æ°æ®ç±»åå¤ï¼è¿æ¯æ bitmap å bloomfilterï¼å³å¸éè¿æ»¤å¨ï¼å¯ä»¥éè¿ redis module æ¯æï¼ã\n\nbitmap å bloomfilter é½å¯ä»¥ç¨äºè§£å³ç¼å­ç©¿éé®é¢ãè¦ç¹å¨äºï¼è¿æ»¤ä¸äºä¸å¯è½å­å¨çæ°æ®ã\n\n> ä»ä¹æ¯ç¼å­ç©¿éï¼å¯ä»¥åèï¼ç¼å­åºæ¬åç\n\nå°æ°æ®éå¯ä»¥ç¨ bitmapï¼å¤§æ°æ®éå¯ä»¥ç¨å¸éè¿æ»¤å¨ã\n\n\n# åå¸å¼é\n\nä½¿ç¨ redis ä½ä¸ºåå¸å¼éï¼åºæ¬è¦ç¹å¦ä¸ï¼\n\n * äºæ¥æ§ - ä½¿ç¨ setnx æ¢å éã\n * é¿åæ°¸è¿ä¸éæ¾é - ä½¿ç¨ expire å ä¸ä¸ªè¿ææ¶é´ï¼é¿åä¸ç´ä¸éæ¾éï¼å¯¼è´é»å¡ã\n * åå­æ§ - setnx å expire å¿é¡»åå¹¶ä¸ºä¸ä¸ªåå­æä»¤ï¼é¿å setnx åï¼æºå¨å´©æºï¼æ²¡æ¥å¾åè®¾ç½® expireï¼ä»èå¯¼è´éæ°¸ä¸éæ¾ã\n\n> æ´å¤åå¸å¼éçå®ç°æ¹å¼åç»èï¼è¯·åèï¼åå¸å¼éåºæ¬åç\n\n\n# äºãæå·§\n\næ ¹æ® redis çç¹æ§ï¼å¨å®éåºç¨ä¸­ï¼å­å¨ä¸äºåºç¨å°æå·§ã\n\n\n# keys å scan\n\nä½¿ç¨ keys æä»¤å¯ä»¥æ«åºæå®æ¨¡å¼ç key åè¡¨ã\n\nå¦æè¿ä¸ª redis æ­£å¨ç»çº¿ä¸çä¸å¡æä¾æå¡ï¼é£ä½¿ç¨ keys æä»¤ä¼æä»ä¹é®é¢ï¼\n\né¦åï¼redis æ¯åçº¿ç¨çãkeys æä»¤ä¼å¯¼è´çº¿ç¨é»å¡ä¸æ®µæ¶é´ï¼çº¿ä¸æå¡ä¼åé¡¿ï¼ç´å°æä»¤æ§è¡å®æ¯ï¼æå¡æè½æ¢å¤ã\n\nè¿ä¸ªæ¶åå¯ä»¥ä½¿ç¨ scan æä»¤ï¼scan æä»¤å¯ä»¥æ é»å¡çæååºæå®æ¨¡å¼ç key åè¡¨ï¼ä½æ¯ä¼æä¸å®çéå¤æ¦çï¼å¨å®¢æ·ç«¯åä¸æ¬¡å»éå°±å¯ä»¥äºï¼ä½æ¯æ´ä½æè±è´¹çæ¶é´ä¼æ¯ç´æ¥ç¨ keys æä»¤é¿ã\n\nä¸è¿ï¼å¢éå¼è¿­ä»£å½ä»¤ä¹ä¸æ¯æ²¡æç¼ºç¹çï¼ ä¸¾ä¸ªä¾å­ï¼ ä½¿ç¨ smembers å½ä»¤å¯ä»¥è¿åéåé®å½ååå«çææåç´ ï¼ ä½æ¯å¯¹äº scan è¿ç±»å¢éå¼è¿­ä»£å½ä»¤æ¥è¯´ï¼ å ä¸ºå¨å¯¹é®è¿è¡å¢éå¼è¿­ä»£çè¿ç¨ä¸­ï¼ é®å¯è½ä¼è¢«ä¿®æ¹ï¼ æä»¥å¢éå¼è¿­ä»£å½ä»¤åªè½å¯¹è¢«è¿åçåç´ æä¾æéçä¿è¯ ã\n\n\n# åèèµæ\n\n * å®ç½\n   * redis å®ç½\n   * redis github\n   * redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãredis å®æã\n   * ãredis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * redis å½ä»¤åè\n * æç« \n   * ãæä»¬ä¸èµ·è¿å¤§åãç³»å- redis åºç¡",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Redis æç¨",frontmatter:{title:"Redis æç¨",date:"2020-02-10T14:27:39.000Z",categories:["æ°æ®åº","KVæ°æ®åº","Redis"],tags:["æ°æ®åº","KVæ°æ®åº","Redis"],permalink:"/pages/fe3808/",hidden:!0},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/05.KV%E6%95%B0%E6%8D%AE%E5%BA%93/01.Redis/",relativePath:"12.æ°æ®åº/05.KVæ°æ®åº/01.Redis/README.md",key:"v-671a08c2",path:"/pages/fe3808/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:143},{level:3,title:"Redis é¢è¯æ»ç» ð¯",slug:"redis-é¢è¯æ»ç»-ð¯",normalizedTitle:"redis é¢è¯æ»ç» ð¯",charIndex:153},{level:3,title:"Redis åºç¨æå â¡",slug:"redis-åºç¨æå-â¡",normalizedTitle:"redis åºç¨æå â¡",charIndex:171},{level:3,title:"Redis æ°æ®ç±»åååºç¨",slug:"redis-æ°æ®ç±»åååºç¨",normalizedTitle:"redis æ°æ®ç±»åååºç¨",charIndex:217},{level:3,title:"Redis æä¹å",slug:"redis-æä¹å",normalizedTitle:"redis æä¹å",charIndex:293},{level:3,title:"Redis å¤å¶",slug:"redis-å¤å¶",normalizedTitle:"redis å¤å¶",charIndex:348},{level:3,title:"Redis å¨åµ",slug:"redis-å¨åµ",normalizedTitle:"redis å¨åµ",charIndex:402},{level:3,title:"Redis éç¾¤",slug:"redis-éç¾¤",normalizedTitle:"redis éç¾¤",charIndex:540},{level:3,title:"Redis å®æ",slug:"redis-å®æ",normalizedTitle:"redis å®æ",charIndex:621},{level:3,title:"Redis è¿ç»´ ð¨",slug:"redis-è¿ç»´-ð¨",normalizedTitle:"redis è¿ç»´ ð¨",charIndex:655},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:691},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:1123}],headersStr:"ð åå®¹ Redis é¢è¯æ»ç» ð¯ Redis åºç¨æå â¡ Redis æ°æ®ç±»åååºç¨ Redis æä¹å Redis å¤å¶ Redis å¨åµ Redis éç¾¤ Redis å®æ Redis è¿ç»´ ð¨ ð èµæ ðª ä¼ é",content:"# Redis æç¨\n\n> Redis æå¸åçåºç¨åºæ¯æ¯ä½ä¸ºåå¸å¼ç¼å­ã\n> \n> å­¦ä¹  Redisï¼æå¿è¦æ·±å¥çè§£ç¼å­çåçï¼ä»¥å Redis ä½ä¸ºä¸ç§ç¼å­æ¹æ¡ï¼å¨ç³»ç»åºç¨ä¸­çå®ä½ã\n> \n> åèï¼ç¼å­åºæ¬åçï¼æå©äºçè§£ç¼å­çç¹æ§ãåçï¼ä½¿ç¨ç¼å­å¸¸è§çé®é¢åè§£å³æ¹æ¡ã\n\n\n# ð åå®¹\n\n\n# Redis é¢è¯æ»ç» ð¯\n\n\n# Redis åºç¨æå â¡\n\n> å³é®è¯ï¼åå­æ·æ±°ãäºä»¶ãäºå¡ãç®¡éãåå¸ä¸è®¢é\n\n\n\n\n# Redis æ°æ®ç±»åååºç¨\n\n> å³é®è¯ï¼STRINGãHASHãLISTãSETãZSETãBitMapãHyperLogLogãGeo\n\n\n\n\n# Redis æä¹å\n\n> å³é®è¯ï¼RDBãAOFãSAVEãBGSAVEãappendfsync\n\n\n\n\n# Redis å¤å¶\n\n> å³é®è¯ï¼SLAVEOFãSYNCãPSYNCãREPLCONF ACK\n\n\n\n\n# Redis å¨åµ\n\n> Redis å¨åµï¼Sentinelï¼æ¯ Redis çé«å¯ç¨æ§ï¼Hight Availabilityï¼è§£å³æ¹æ¡ã\n> \n> Redis å¨åµæ¯ Raft ç®æ³ çå·ä½å®ç°ã\n> \n> å³é®è¯ï¼SentinelãPINGãINFOãRaft\n\n\n\n\n# Redis éç¾¤\n\n> å³é®è¯ï¼CLUSTER MEETãHash slotãMOVEDãASKãSLAVEOF no oneãredis-trib\n\n\n\n\n# Redis å®æ\n\n> å³é®è¯ï¼ç¼å­ãåå¸å¼éãå¸éè¿æ»¤å¨\n\n\n# Redis è¿ç»´ ð¨\n\n> å³é®è¯ï¼å®è£ãå½ä»¤ãéç¾¤ãå®¢æ·ç«¯\n\n\n# ð èµæ\n\n * å®ç½\n   * Redis å®ç½\n   * Redis github\n   * Redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãRedis å®æã\n   * ãRedis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * Redis å½ä»¤åè\n * æç« \n   * Introduction to Redis\n   * ãæä»¬ä¸èµ·è¿å¤§åãç³»å- Redis åºç¡\n * æºç \n   * ãRedis å®æãéå¥ Python æºç \n * èµæºæ±æ»\n   * awesome-redis\n * Redis Client\n   * spring-data-redis å®æ¹ææ¡£\n   * redisson å®æ¹ææ¡£(ä¸­æ,ç¥ææ»å)\n   * redisson å®æ¹ææ¡£(è±æ)\n   * CRUG | Redisson PRO vs. Jedis: Which Is Faster? ç¿»è¯\n   * redis åå¸é Redisson æ§è½æµè¯\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç IT ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",normalizedContent:"# redis æç¨\n\n> redis æå¸åçåºç¨åºæ¯æ¯ä½ä¸ºåå¸å¼ç¼å­ã\n> \n> å­¦ä¹  redisï¼æå¿è¦æ·±å¥çè§£ç¼å­çåçï¼ä»¥å redis ä½ä¸ºä¸ç§ç¼å­æ¹æ¡ï¼å¨ç³»ç»åºç¨ä¸­çå®ä½ã\n> \n> åèï¼ç¼å­åºæ¬åçï¼æå©äºçè§£ç¼å­çç¹æ§ãåçï¼ä½¿ç¨ç¼å­å¸¸è§çé®é¢åè§£å³æ¹æ¡ã\n\n\n# ð åå®¹\n\n\n# redis é¢è¯æ»ç» ð¯\n\n\n# redis åºç¨æå â¡\n\n> å³é®è¯ï¼åå­æ·æ±°ãäºä»¶ãäºå¡ãç®¡éãåå¸ä¸è®¢é\n\n\n\n\n# redis æ°æ®ç±»åååºç¨\n\n> å³é®è¯ï¼stringãhashãlistãsetãzsetãbitmapãhyperloglogãgeo\n\n\n\n\n# redis æä¹å\n\n> å³é®è¯ï¼rdbãaofãsaveãbgsaveãappendfsync\n\n\n\n\n# redis å¤å¶\n\n> å³é®è¯ï¼slaveofãsyncãpsyncãreplconf ack\n\n\n\n\n# redis å¨åµ\n\n> redis å¨åµï¼sentinelï¼æ¯ redis çé«å¯ç¨æ§ï¼hight availabilityï¼è§£å³æ¹æ¡ã\n> \n> redis å¨åµæ¯ raft ç®æ³ çå·ä½å®ç°ã\n> \n> å³é®è¯ï¼sentinelãpingãinfoãraft\n\n\n\n\n# redis éç¾¤\n\n> å³é®è¯ï¼cluster meetãhash slotãmovedãaskãslaveof no oneãredis-trib\n\n\n\n\n# redis å®æ\n\n> å³é®è¯ï¼ç¼å­ãåå¸å¼éãå¸éè¿æ»¤å¨\n\n\n# redis è¿ç»´ ð¨\n\n> å³é®è¯ï¼å®è£ãå½ä»¤ãéç¾¤ãå®¢æ·ç«¯\n\n\n# ð èµæ\n\n * å®ç½\n   * redis å®ç½\n   * redis github\n   * redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãredis å®æã\n   * ãredis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * redis å½ä»¤åè\n * æç« \n   * introduction to redis\n   * ãæä»¬ä¸èµ·è¿å¤§åãç³»å- redis åºç¡\n * æºç \n   * ãredis å®æãéå¥ python æºç \n * èµæºæ±æ»\n   * awesome-redis\n * redis client\n   * spring-data-redis å®æ¹ææ¡£\n   * redisson å®æ¹ææ¡£(ä¸­æ,ç¥ææ»å)\n   * redisson å®æ¹ææ¡£(è±æ)\n   * crug | redisson pro vs. jedis: which is faster? ç¿»è¯\n   * redis åå¸é redisson æ§è½æµè¯\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç it ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Redis è¿ç»´",frontmatter:{title:"Redis è¿ç»´",date:"2020-06-24T10:45:38.000Z",categories:["æ°æ®åº","KVæ°æ®åº","Redis"],tags:["æ°æ®åº","KVæ°æ®åº","Redis","è¿ç»´"],permalink:"/pages/537098/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/05.KV%E6%95%B0%E6%8D%AE%E5%BA%93/01.Redis/20.Redis%E8%BF%90%E7%BB%B4.html",relativePath:"12.æ°æ®åº/05.KVæ°æ®åº/01.Redis/20.Redisè¿ç»´.md",key:"v-5ed748af",path:"/pages/537098/",headers:[{level:2,title:"ä¸ãRedis å®è£",slug:"ä¸ãredis-å®è£",normalizedTitle:"ä¸ãredis å®è£",charIndex:90},{level:3,title:"Window ä¸å®è£",slug:"window-ä¸å®è£",normalizedTitle:"window ä¸å®è£",charIndex:105},{level:3,title:"Linux ä¸å®è£",slug:"linux-ä¸å®è£",normalizedTitle:"linux ä¸å®è£",charIndex:521},{level:3,title:"Ubuntu ä¸å®è£",slug:"ubuntu-ä¸å®è£",normalizedTitle:"ubuntu ä¸å®è£",charIndex:926},{level:3,title:"å¼æºå¯å¨",slug:"å¼æºå¯å¨",normalizedTitle:"å¼æºå¯å¨",charIndex:1028},{level:3,title:"å¼æ¾é²ç«å¢ç«¯å£",slug:"å¼æ¾é²ç«å¢ç«¯å£",normalizedTitle:"å¼æ¾é²ç«å¢ç«¯å£",charIndex:1116},{level:3,title:"Redis å®è£èæ¬",slug:"redis-å®è£èæ¬",normalizedTitle:"redis å®è£èæ¬",charIndex:1262},{level:2,title:"äºãRedis åæºä½¿ç¨åéç½®",slug:"äºãredis-åæºä½¿ç¨åéç½®",normalizedTitle:"äºãredis åæºä½¿ç¨åéç½®",charIndex:1797},{level:3,title:"å¯å¨ Redis",slug:"å¯å¨-redis",normalizedTitle:"å¯å¨ redis",charIndex:806},{level:3,title:"Redis å¸¸è§éç½®",slug:"redis-å¸¸è§éç½®",normalizedTitle:"redis å¸¸è§éç½®",charIndex:2110},{level:3,title:"è®¾ä¸ºå®æ¤è¿ç¨",slug:"è®¾ä¸ºå®æ¤è¿ç¨",normalizedTitle:"è®¾ä¸ºå®æ¤è¿ç¨",charIndex:2475},{level:4,title:"è¿ç¨è®¿é®",slug:"è¿ç¨è®¿é®",normalizedTitle:"è¿ç¨è®¿é®",charIndex:2547},{level:4,title:"è®¾ç½®å¯ç ",slug:"è®¾ç½®å¯ç ",normalizedTitle:"è®¾ç½®å¯ç ",charIndex:2623},{level:4,title:"éç½®åæ°è¡¨",slug:"éç½®åæ°è¡¨",normalizedTitle:"éç½®åæ°è¡¨",charIndex:2708},{level:3,title:"ååæµè¯",slug:"ååæµè¯",normalizedTitle:"ååæµè¯",charIndex:8470},{level:2,title:"ä¸ãRedis éç¾¤ä½¿ç¨åéç½®",slug:"ä¸ãredis-éç¾¤ä½¿ç¨åéç½®",normalizedTitle:"ä¸ãredis éç¾¤ä½¿ç¨åéç½®",charIndex:8900},{level:3,title:"éç¾¤è§å",slug:"éç¾¤è§å",normalizedTitle:"éç¾¤è§å",charIndex:8940},{level:3,title:"é¨ç½²éç¾¤",slug:"é¨ç½²éç¾¤",normalizedTitle:"é¨ç½²éç¾¤",charIndex:9380},{level:3,title:"é¨ç½²å¨åµ",slug:"é¨ç½²å¨åµ",normalizedTitle:"é¨ç½²å¨åµ",charIndex:14391},{level:3,title:"æ©å®¹",slug:"æ©å®¹",normalizedTitle:"æ©å®¹",charIndex:15521},{level:2,title:"åãRedis å½ä»¤",slug:"åãredis-å½ä»¤",normalizedTitle:"åãredis å½ä»¤",charIndex:20733},{level:3,title:"éç¨å½ä»¤",slug:"éç¨å½ä»¤",normalizedTitle:"éç¨å½ä»¤",charIndex:20748},{level:3,title:"éç¾¤å½ä»¤",slug:"éç¾¤å½ä»¤",normalizedTitle:"éç¾¤å½ä»¤",charIndex:20874},{level:4,title:"éæ°åç",slug:"éæ°åç",normalizedTitle:"éæ°åç",charIndex:21940},{level:2,title:"äºãå®¢æ·ç«¯",slug:"äºãå®¢æ·ç«¯",normalizedTitle:"äºãå®¢æ·ç«¯",charIndex:22085},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:22121}],headersStr:"ä¸ãRedis å®è£ Window ä¸å®è£ Linux ä¸å®è£ Ubuntu ä¸å®è£ å¼æºå¯å¨ å¼æ¾é²ç«å¢ç«¯å£ Redis å®è£èæ¬ äºãRedis åæºä½¿ç¨åéç½® å¯å¨ Redis Redis å¸¸è§éç½® è®¾ä¸ºå®æ¤è¿ç¨ è¿ç¨è®¿é® è®¾ç½®å¯ç  éç½®åæ°è¡¨ ååæµè¯ ä¸ãRedis éç¾¤ä½¿ç¨åéç½® éç¾¤è§å é¨ç½²éç¾¤ é¨ç½²å¨åµ æ©å®¹ åãRedis å½ä»¤ éç¨å½ä»¤ éç¾¤å½ä»¤ éæ°åç äºãå®¢æ·ç«¯ åèèµæ",content:'# Redis è¿ç»´\n\n> Redis æ¯ä¸ä¸ªé«æ§è½ç key-value æ°æ®åºã\n> \n> SET æä½æ¯ç§é 110000 æ¬¡ï¼GET æä½æ¯ç§é 81000 æ¬¡ã\n\n\n# ä¸ãRedis å®è£\n\n\n# Window ä¸å®è£\n\nä¸è½½å°åï¼https://github.com/MSOpenTech/redis/releasesã\n\nRedis æ¯æ 32 ä½å 64 ä½ãè¿ä¸ªéè¦æ ¹æ®ä½ ç³»ç»å¹³å°çå®éæåµéæ©ï¼è¿éæä»¬ä¸è½½ Redis-x64-xxx.zipåç¼©åå° C çï¼è§£ååï¼å°æä»¶å¤¹éæ°å½åä¸º redisã\n\næå¼ä¸ä¸ª cmd çªå£ ä½¿ç¨ cd å½ä»¤åæ¢ç®å½å° C:\\redis è¿è¡ redis-server.exe redis.windows.conf ã\n\nå¦ææ³æ¹ä¾¿çè¯ï¼å¯ä»¥æ redis çè·¯å¾å å°ç³»ç»çç¯å¢åééï¼è¿æ ·å°±çå¾åè¾è·¯å¾äºï¼åé¢çé£ä¸ª redis.windows.conf å¯ä»¥çç¥ï¼å¦æçç¥ï¼ä¼å¯ç¨é»è®¤çã\n\nè¿æ¶åå¦å¯ä¸ä¸ª cmd çªå£ï¼åæ¥çä¸è¦å³é­ï¼ä¸ç¶å°±æ æ³è®¿é®æå¡ç«¯äºã\n\nåæ¢å° redis ç®å½ä¸è¿è¡ redis-cli.exe -h 127.0.0.1 -p 6379 ã\n\n\n# Linux ä¸å®è£\n\nä¸è½½å°åï¼ http://redis.io/downloadï¼ä¸è½½ææ°ææ¡£çæ¬ã\n\nä¸è½½ãè§£åãç¼è¯ Redis\n\nwget http://download.redis.io/releases/redis-5.0.4.tar.gz\ntar xzf redis-5.0.4.tar.gz\ncd redis-5.0.4\nmake\n\n\nä¸ºäºç¼è¯ Redis æºç ï¼ä½ éè¦ gcc-c++å tclãå¦æä½ çç³»ç»æ¯ CentOSï¼å¯ä»¥ç´æ¥æ§è¡å½ä»¤ï¼yum install -y gcc-c++ tcl æ¥å®è£ã\n\nè¿å¥å°è§£ååç src ç®å½ï¼éè¿å¦ä¸å½ä»¤å¯å¨ Redis:\n\nsrc/redis-server\n\n\næ¨å¯ä»¥ä½¿ç¨åç½®çå®¢æ·ç«¯ä¸ Redis è¿è¡äº¤äº:\n\n$ src/redis-cli\nredis> set foo bar\nOK\nredis> get foo\n"bar"\n\n\n\n# Ubuntu ä¸å®è£\n\nå¨ Ubuntu ç³»ç»å®è£ Redis å¯ä»¥ä½¿ç¨ä»¥ä¸å½ä»¤:\n\nsudo apt-get update\nsudo apt-get install redis-server\n\n\n\n# å¼æºå¯å¨\n\n * å¼æºå¯å¨éç½®ï¼echo "/usr/local/bin/redis-server /etc/redis.conf" >> /etc/rc.local\n\n\n# å¼æ¾é²ç«å¢ç«¯å£\n\n * æ·»å è§åï¼iptables -I INPUT -p tcp -m tcp --dport 6379 -j ACCEPT\n * ä¿å­è§åï¼service iptables save\n * éå¯ iptablesï¼service iptables restart\n\n\n# Redis å®è£èæ¬\n\n> CentOS7 ç¯å¢å®è£èæ¬ï¼è½¯ä»¶è¿ç»´éç½®èæ¬éå\n\nå®è£è¯´æ\n\n * éç¨ç¼è¯æ¹å¼å®è£ Redis, å¹¶å°å¶æ³¨åä¸º systemd æå¡\n * å®è£è·¯å¾ä¸ºï¼/usr/local/redis\n * é»è®¤ä¸è½½å®è£ 5.0.4 çæ¬ï¼ç«¯å£å·ä¸ºï¼6379ï¼å¯ç ä¸ºç©º\n\nä½¿ç¨æ¹æ³\n\n * é»è®¤å®è£ - æ§è¡ä»¥ä¸ä»»æå½ä»¤å³å¯ï¼\n\ncurl -o- https://gitee.com/turnon/linux-tutorial/raw/master/codes/linux/soft/redis-install.sh | bash\nwget -qO- https://gitee.com/turnon/linux-tutorial/raw/master/codes/linux/soft/redis-install.sh | bash\n\n\n * èªå®ä¹å®è£ - ä¸è½½èæ¬å°æ¬å°ï¼å¹¶æç§ä»¥ä¸æ ¼å¼æ§è¡ï¼\n\nsh redis-install.sh [version] [port] [password]\n\n\nåæ°è¯´æï¼\n\n * version - redis çæ¬å·\n * port - redis æå¡ç«¯å£å·\n * password - è®¿é®å¯ç \n\n\n# äºãRedis åæºä½¿ç¨åéç½®\n\n\n# å¯å¨ Redis\n\nå¯å¨ redis æå¡\n\ncd /usr/local/redis/src\n./redis-server\n\n\nå¯å¨ redis å®¢æ·ç«¯\n\ncd /usr/local/redis/src\n./redis-cli\n\n\næ¥ç redis æ¯å¦å¯å¨\n\nredis-cli\n\n\nä»¥ä¸å½ä»¤å°æå¼ä»¥ä¸ç»ç«¯ï¼\n\nredis 127.0.0.1:6379>\n\n\n127.0.0.1 æ¯æ¬æº IP ï¼6379 æ¯ redis æå¡ç«¯å£ãç°å¨æä»¬è¾å¥ PING å½ä»¤ã\n\nredis 127.0.0.1:6379> ping\nPONG\n\n\nä»¥ä¸è¯´ææä»¬å·²ç»æåå¯å¨äº redisã\n\n\n# Redis å¸¸è§éç½®\n\n> Redis é»è®¤çéç½®æä»¶æ¯æ ¹ç®å½ä¸ç redis.conf æä»¶ã\n> \n> å¦æéè¦æå®ç¹å®æä»¶ä½ä¸ºéç½®æä»¶ï¼éè¦ä½¿ç¨å½ä»¤ï¼ ./redis-server -c xxx.conf\n> \n> æ¯æ¬¡ä¿®æ¹éç½®åï¼éè¦éå¯æè½çæã\n> \n> Redis å®æ¹é»è®¤éç½®ï¼\n> \n>  * èªæè¿°ææ¡£ redis.conf for Redis 2.8\n>  * èªæè¿°ææ¡£ redis.conf for Redis 2.6.\n>  * èªæè¿°ææ¡£ redis.conf for Redis 2.4.\n> \n> èª Redis2.6 èµ·å°±å¯ä»¥ç´æ¥éè¿å½ä»¤è¡ä¼ é Redis éç½®åæ°ãè¿ç§æ¹æ³å¯ä»¥ç¨äºæµè¯ãèª Redis2.6 èµ·å°±å¯ä»¥ç´æ¥éè¿å½ä»¤è¡ä¼ é Redis éç½®åæ°ãè¿ç§æ¹æ³å¯ä»¥ç¨äºæµè¯ã\n\n\n# è®¾ä¸ºå®æ¤è¿ç¨\n\nRedis é»è®¤ä»¥éå®æ¤è¿ç¨æ¹å¼å¯å¨ï¼èéå¸¸æä»¬ä¼å° Redis è®¾ä¸ºå®æ¤è¿ç¨å¯å¨æ¹å¼ï¼éç½®ï¼daemonize yes\n\n# è¿ç¨è®¿é®\n\nRedis é»è®¤ç»å® 127.0.0.1ï¼è¿æ ·å°±åªè½æ¬æºæè½è®¿é®ï¼è¥è¦ Redis åè®¸è¿ç¨è®¿é®ï¼éè¦éç½®ï¼bind 0.0.0.0\n\n# è®¾ç½®å¯ç \n\nRedis é»è®¤è®¿é®ä¸éè¦å¯ç ï¼å¦æéè¦è®¾ç½®å¯ç ï¼éè¦å¦ä¸éç½®ï¼\n\n * protected-mode yes\n * requirepass <å¯ç >\n\n# éç½®åæ°è¡¨\n\néç½®é¡¹                                                         è¯´æ\ndaemonize no                                                Redis é»è®¤ä¸æ¯ä»¥å®æ¤è¿ç¨çæ¹å¼è¿è¡ï¼å¯ä»¥éè¿è¯¥éç½®é¡¹ä¿®æ¹ï¼ä½¿ç¨ yes å¯ç¨å®æ¤è¿ç¨ï¼Windows\n                                                            ä¸æ¯æå®æ¤çº¿ç¨çéç½®ä¸º no ï¼\npidfile /var/run/redis.pid                                  å½ Redis ä»¥å®æ¤è¿ç¨æ¹å¼è¿è¡æ¶ï¼Redis é»è®¤ä¼æ pid åå¥ /var/run/redis.pid\n                                                            æä»¶ï¼å¯ä»¥éè¿ pidfile æå®\nport 6379                                                   æå® Redis çå¬ç«¯å£ï¼é»è®¤ç«¯å£ä¸º 6379ï¼ä½èå¨èªå·±çä¸ç¯åæä¸­è§£éäºä¸ºä»ä¹éç¨ 6379 ä½ä¸ºé»è®¤ç«¯å£ï¼å ä¸º\n                                                            6379 å¨ææºæé®ä¸ MERZ å¯¹åºçå·ç ï¼è MERZ åèªæå¤§å©æ­å¥³ Alessia Merz çåå­\nbind 127.0.0.1                                              ç»å®çä¸»æºå°å\ntimeout 300                                                 å½å®¢æ·ç«¯é²ç½®å¤é¿æ¶é´åå³é­è¿æ¥ï¼å¦ææå®ä¸º 0ï¼è¡¨ç¤ºå³é­è¯¥åè½\nloglevel notice                                             æå®æ¥å¿è®°å½çº§å«ï¼Redis æ»å±æ¯æåä¸ªçº§å«ï¼debugãverboseãnoticeãwarningï¼é»è®¤ä¸º\n                                                            notice\nlogfile stdout                                              æ¥å¿è®°å½æ¹å¼ï¼é»è®¤ä¸ºæ åè¾åºï¼å¦æéç½® Redis\n                                                            ä¸ºå®æ¤è¿ç¨æ¹å¼è¿è¡ï¼èè¿éåéç½®ä¸ºæ¥å¿è®°å½æ¹å¼ä¸ºæ åè¾åºï¼åæ¥å¿å°ä¼åéç» /dev/null\ndatabases 16                                                è®¾ç½®æ°æ®åºçæ°éï¼é»è®¤æ°æ®åºä¸º 0ï¼å¯ä»¥ä½¿ç¨ SELECT å½ä»¤å¨è¿æ¥ä¸æå®æ°æ®åº id\nsave <seconds> <changes> Redis é»è®¤éç½®æä»¶ä¸­æä¾äºä¸ä¸ªæ¡ä»¶ï¼save 900      æå®å¨å¤é¿æ¶é´åï¼æå¤å°æ¬¡æ´æ°æä½ï¼å°±å°æ°æ®åæ­¥å°æ°æ®æä»¶ï¼å¯ä»¥å¤ä¸ªæ¡ä»¶éå\n1ãsave 300 10ãsave 60 10000 åå«è¡¨ç¤º 900 ç§ï¼15 åéï¼åæ 1 ä¸ªæ´æ¹ï¼300\nç§ï¼5 åéï¼åæ 10 ä¸ªæ´æ¹ä»¥å 60 ç§åæ 10000 ä¸ªæ´æ¹ã\nrdbcompression yes                                          æå®å­å¨è³æ¬å°æ°æ®åºæ¶æ¯å¦åç¼©æ°æ®ï¼é»è®¤ä¸º yesï¼Redis éç¨ LZF åç¼©ï¼å¦æä¸ºäºèç CPU\n                                                            æ¶é´ï¼å¯ä»¥å³é­è¯¥éé¡¹ï¼ä½ä¼å¯¼è´æ°æ®åºæä»¶åçå·¨å¤§\ndbfilename dump.rdb                                         æå®æ¬å°æ°æ®åºæä»¶åï¼é»è®¤å¼ä¸º dump.rdb\ndir ./                                                      æå®æ¬å°æ°æ®åºå­æ¾ç®å½\nslaveof <masterip> <masterport>                             è®¾ç½®å½æ¬æºä¸º slav æå¡æ¶ï¼è®¾ç½® master æå¡ç IP å°ååç«¯å£ï¼å¨ Redis å¯å¨æ¶ï¼å®ä¼èªå¨ä»\n                                                            master è¿è¡æ°æ®åæ­¥\nmasterauth <master-password>                                å½ master æå¡è®¾ç½®äºå¯ç ä¿æ¤æ¶ï¼slav æå¡è¿æ¥ master çå¯ç \nrequirepass foobared                                        è®¾ç½® Redis è¿æ¥å¯ç ï¼å¦æéç½®äºè¿æ¥å¯ç ï¼å®¢æ·ç«¯å¨è¿æ¥ Redis æ¶éè¦éè¿ AUTH <password>\n                                                            å½ä»¤æä¾å¯ç ï¼é»è®¤å³é­\nmaxclients 128                                              è®¾ç½®åä¸æ¶é´æå¤§å®¢æ·ç«¯è¿æ¥æ°ï¼é»è®¤æ éå¶ï¼Redis å¯ä»¥åæ¶æå¼çå®¢æ·ç«¯è¿æ¥æ°ä¸º Redis\n                                                            è¿ç¨å¯ä»¥æå¼çæå¤§æä»¶æè¿°ç¬¦æ°ï¼å¦æè®¾ç½® maxclients 0ï¼è¡¨ç¤ºä¸ä½éå¶ãå½å®¢æ·ç«¯è¿æ¥æ°å°è¾¾éå¶æ¶ï¼Redis\n                                                            ä¼å³é­æ°çè¿æ¥å¹¶åå®¢æ·ç«¯è¿å max number of clients reached éè¯¯ä¿¡æ¯\nmaxmemory <bytes>                                           æå® Redis æå¤§åå­éå¶ï¼Redis å¨å¯å¨æ¶ä¼ææ°æ®å è½½å°åå­ä¸­ï¼è¾¾å°æå¤§åå­åï¼Redis\n                                                            ä¼åå°è¯æ¸é¤å·²å°ææå³å°å°æç Keyï¼å½æ­¤æ¹æ³å¤ç\n                                                            åï¼ä»ç¶å°è¾¾æå¤§åå­è®¾ç½®ï¼å°æ æ³åè¿è¡åå¥æä½ï¼ä½ä»ç¶å¯ä»¥è¿è¡è¯»åæä½ãRedis æ°ç vm æºå¶ï¼ä¼æ Key\n                                                            å­æ¾åå­ï¼Value ä¼å­æ¾å¨ swap åº\nappendonly no                                               æå®æ¯å¦å¨æ¯æ¬¡æ´æ°æä½åè¿è¡æ¥å¿è®°å½ï¼Redis\n                                                            å¨é»è®¤æåµä¸æ¯å¼æ­¥çææ°æ®åå¥ç£çï¼å¦æä¸å¼å¯ï¼å¯è½ä¼å¨æ­çµæ¶å¯¼è´ä¸æ®µæ¶é´åçæ°æ®ä¸¢å¤±ãå ä¸º redis\n                                                            æ¬èº«åæ­¥æ°æ®æä»¶æ¯æä¸é¢ save æ¡ä»¶æ¥åæ­¥çï¼æä»¥æçæ°æ®ä¼å¨ä¸æ®µæ¶é´ååªå­å¨äºåå­ä¸­ãé»è®¤ä¸º no\nappendfilename appendonly.aof                               æå®æ´æ°æ¥å¿æä»¶åï¼é»è®¤ä¸º appendonly.aof\nappendfsync everysec                                        æå®æ´æ°æ¥å¿æ¡ä»¶ï¼å±æ 3\n                                                            ä¸ªå¯éå¼ï¼noï¼è¡¨ç¤ºç­æä½ç³»ç»è¿è¡æ°æ®ç¼å­åæ­¥å°ç£çï¼å¿«ï¼alwaysï¼è¡¨ç¤ºæ¯æ¬¡æ´æ°æä½åæå¨è°ç¨ fsync()\n                                                            å°æ°æ®åå°ç£çï¼æ¢ï¼å®å¨ï¼everysecï¼è¡¨ç¤ºæ¯ç§åæ­¥ä¸æ¬¡ï¼æä¸­ï¼é»è®¤å¼ï¼\nvm-enabled no                                               æå®æ¯å¦å¯ç¨èæåå­æºå¶ï¼é»è®¤å¼ä¸º noï¼ç®åçä»ç»ä¸ä¸ï¼VM æºå¶å°æ°æ®åé¡µå­æ¾ï¼ç± Redis\n                                                            å°è®¿é®éè¾å°çé¡µå³å·æ°æ® swap å°ç£çä¸ï¼è®¿é®å¤çé¡µé¢ç±ç£çèªå¨æ¢åºå°åå­ä¸­ï¼å¨åé¢çæç« æä¼ä»ç»åæ Redis\n                                                            ç VM æºå¶ï¼\nvm-swap-file /tmp/redis.swap                                èæåå­æä»¶è·¯å¾ï¼é»è®¤å¼ä¸º /tmp/redis.swapï¼ä¸å¯å¤ä¸ª Redis å®ä¾å±äº«\nvm-max-memory 0                                             å°ææå¤§äº vm-max-memory çæ°æ®å­å¥èæåå­ï¼æ è®º vm-max-memory\n                                                            è®¾ç½®å¤å°ï¼ææç´¢å¼æ°æ®é½æ¯åå­å­å¨ç(Redis çç´¢å¼æ°æ® å°±æ¯ keys)ï¼ä¹å°±æ¯è¯´ï¼å½ vm-max-memory\n                                                            è®¾ç½®ä¸º 0 çæ¶åï¼å¶å®æ¯ææ value é½å­å¨äºç£çãé»è®¤å¼ä¸º 0\nvm-page-size 32                                             Redis swap æä»¶åæäºå¾å¤ç pageï¼ä¸ä¸ªå¯¹è±¡å¯ä»¥ä¿å­å¨å¤ä¸ª page ä¸é¢ï¼ä½ä¸ä¸ª page\n                                                            ä¸ä¸è½è¢«å¤ä¸ªå¯¹è±¡å±äº«ï¼vm-page-size æ¯è¦æ ¹æ®å­å¨ç æ°æ®å¤§å°æ¥è®¾å®çï¼ä½èå»ºè®®å¦æå­å¨å¾å¤å°å¯¹è±¡ï¼page\n                                                            å¤§å°æå¥½è®¾ç½®ä¸º 32 æè 64bytesï¼å¦æå­å¨å¾å¤§å¤§å¯¹è±¡ï¼åå¯ä»¥ä½¿ç¨æ´å¤§ç pageï¼å¦æä¸ç¡®å®ï¼å°±ä½¿ç¨é»è®¤å¼\nvm-pages 134217728                                          è®¾ç½® swap æä»¶ä¸­ç page æ°éï¼ç±äºé¡µè¡¨ï¼ä¸ç§è¡¨ç¤ºé¡µé¢ç©ºé²æä½¿ç¨ç\n                                                            bitmapï¼æ¯å¨æ¾å¨åå­ä¸­çï¼ï¼å¨ç£çä¸æ¯ 8 ä¸ª pages å°æ¶è 1byte çåå­ã\nvm-max-threads 4                                            è®¾ç½®è®¿é® swap æä»¶ççº¿ç¨æ°,æå¥½ä¸è¦è¶è¿æºå¨çæ ¸æ°,å¦æè®¾ç½®ä¸º 0,é£ä¹ææå¯¹ swap\n                                                            æä»¶çæä½é½æ¯ä¸²è¡çï¼å¯è½ä¼é ææ¯è¾é¿æ¶é´çå»¶è¿ãé»è®¤å¼ä¸º 4\nglueoutputbuf yes                                           è®¾ç½®å¨åå®¢æ·ç«¯åºç­æ¶ï¼æ¯å¦æè¾å°çååå¹¶ä¸ºä¸ä¸ªååéï¼é»è®¤ä¸ºå¼å¯\nhash-max-zipmap-entries 64 hash-max-zipmap-value 512        æå®å¨è¶è¿ä¸å®çæ°éæèæå¤§çåç´ è¶è¿æä¸ä¸´çå¼æ¶ï¼éç¨ä¸ç§ç¹æ®çåå¸ç®æ³\nactiverehashing yes                                         æå®æ¯å¦æ¿æ´»éç½®åå¸ï¼é»è®¤ä¸ºå¼å¯ï¼åé¢å¨ä»ç» Redis çåå¸ç®æ³æ¶å·ä½ä»ç»ï¼\ninclude /path/to/local.conf                                 æå®åå«å¶å®çéç½®æä»¶ï¼å¯ä»¥å¨åä¸ä¸»æºä¸å¤ä¸ª Redis\n                                                            å®ä¾ä¹é´ä½¿ç¨åä¸ä»½éç½®æä»¶ï¼èåæ¶åä¸ªå®ä¾åæ¥æèªå·±çç¹å®éç½®æä»¶\n\n\n# ååæµè¯\n\n> åèå®æ¹ææ¡£ï¼How fast is Redis?\n\nRedis èªå¸¦äºä¸ä¸ªæ§è½æµè¯å·¥å·ï¼redis-benchmark\n\nï¼1ï¼åºæ¬æµè¯\n\nredis-benchmark -q -n 100000\n\n\n * -q è¡¨ç¤ºéé»ï¼quietï¼æ§è¡\n * -n 100000 è¯·æ± 10 ä¸æ¬¡\n\nï¼2ï¼æµè¯æå®è¯»åæä»¤\n\n$ redis-benchmark -t set,lpush -n 100000 -q\nSET: 74239.05 requests per second\nLPUSH: 79239.30 requests per second\n\n\nï¼3ï¼æµè¯ pipeline æ¨¡å¼ä¸æå®è¯»åæä»¤\n\nredis-benchmark -n 1000000 -t set,get -P 16 -q\nSET: 403063.28 requests per second\nGET: 508388.41 requests per second\n\n\n\n# ä¸ãRedis éç¾¤ä½¿ç¨åéç½®\n\nRedis 3.0 åæ¯æéç¾¤æ¨¡å¼ã\n\n\n# éç¾¤è§å\n\nRedis éç¾¤ä¸è¬ç± å¤ä¸ªèç¹ ç»æï¼èç¹æ°éè³å°ä¸º 6 ä¸ªï¼æè½ä¿è¯ç»æ å®æ´é«å¯ç¨ çéç¾¤ã\n\n\n\nçæ³æåµå½ç¶æ¯ææèç¹åèªå¨ä¸åçæºå¨ä¸ï¼é¦åäºèµæºï¼æ¬äººå¨é¨ç½² Redis éç¾¤æ¶ï¼åªå¾å° 3 å°æå¡å¨ãæä»¥ï¼æè®¡åæ¯å°æå¡å¨é¨ç½² 2 ä¸ª Redis èç¹ã\n\nãç¤ºä¾ãæç®é«å¯ç¨ Redis éç¾¤è§å\n\næºå¨éç½®ï¼16G åå­ + 8 æ ¸ CPU + 1T ç£ç\n\nRedis è¿ç¨åé 10 G åå­ãä¸è¬çº¿ä¸çäº§ç¯å¢ï¼Redis çåå­å°½éä¸è¦è¶è¿ 10gï¼è¶è¿ 10g å¯è½ä¼æé®é¢ã\n\néç¾¤ææï¼ä¸ä¸»ä¸ä»ï¼ä¸å¨åµï¼æ¯ä¸ªå¨åµçå¬ææä¸»èç¹ã\n\nä¼°ç®æ§è½ï¼\n\n * å®¹éï¼ä¸ä¸»ï¼å ç¨ 30 G åå­ï¼æä»¥æå¤§å­å¨å®¹éä¸º 30 Gãåè®¾æ¯æ¡æ°æ®è®°å½å¹³å å¤§å°ä¸º 10 Kï¼åæå¤§è½å­å¨ 300 ä¸æ¡æ°æ®ã\n * ååéï¼åæºä¸è¬ TPS/QPS ä¸º äºä¸å°å«ä¸å·¦å³ãåè®¾ä¸ºäºä¸ï¼é£ä¹ä¸ä¸»ä¸ä»æ¶æçè®ºä¸è½è¾¾å° TPS 15 ä¸ï¼QPS 30 ä¸ã\n\n\n# é¨ç½²éç¾¤\n\n> Redis éç¾¤èç¹çå®è£ä¸åèç¹æå¡ç¸åï¼å·®å¼ä»å¨äºé¨ç½²æ¹å¼ã\n> \n> æ³¨æï¼ä¸ºäºæ¼ç¤ºæ¹ä¾¿ï¼æ¬ç¤ºä¾å°ææ Redis éç¾¤èç¹é½é¨ç½²å¨ä¸å°æºå¨ä¸ï¼å®éçäº§ç¯å¢ä¸­ï¼åºæ¬é½ä¼å°èç¹é¨ç½²å¨ä¸åæºå¨ä¸ãè¦æ±æ´é«çï¼å¯è½è¿è¦èèå¤æºæ¿é¨ç½²ã\n\nï¼1ï¼åå»ºèç¹ç®å½\n\næä¸ªäººåå¥½å°è½¯ä»¶æ¾å¨ /opt ç®å½ä¸ï¼å¨æçæºå¨ä¸­ï¼Redis é½å®è£å¨ /usr/local/redis ç®å½ä¸ãæä»¥ï¼ä¸é¢çå½ä»¤åéç½®é½åè®¾ Redis å®è£ç®å½ä¸º /usr/local/redis ã\n\nç¡®ä¿æºå¨ä¸å·²ç»å®è£äº Redis åï¼æ§è¡ä»¥ä¸å½ä»¤ï¼åå»º Redis éç¾¤èç¹å®ä¾ç®å½ï¼\n\nsudo mkdir -p /usr/local/redis/conf/7001\nsudo mkdir -p /usr/local/redis/conf/7002\nsudo mkdir -p /usr/local/redis/conf/7003\nsudo mkdir -p /usr/local/redis/conf/7004\nsudo mkdir -p /usr/local/redis/conf/7005\nsudo mkdir -p /usr/local/redis/conf/7006\n\n\nï¼2ï¼éç½®éç¾¤èç¹\n\næ¯ä¸ªå®ä¾ç®å½ä¸ï¼æ°å»º redis.conf éç½®æä»¶ã\n\nå®ä¾éç½®æ¨¡æ¿ä»¥ 7001 èç¹ä¸ºä¾ï¼å¶ä»èç¹ï¼å®å¨æ¿æ¢éç½®ä¸­çç«¯å£å· 7001 å³å¯ï¼ï¼å¦ä¸ï¼\n\n# ç«¯å£å·\nport 7001\n# ç»å®çä¸»æºç«¯å£ï¼0.0.0.0 è¡¨ç¤ºåè®¸è¿ç¨è®¿é®ï¼\nbind 0.0.0.0\n# ä»¥å®æ¤è¿ç¨æ¹å¼å¯å¨\ndaemonize yes\n\n# å¼å¯éç¾¤æ¨¡å¼\ncluster-enabled yes\n# éç¾¤çéç½®ï¼éç½®æä»¶é¦æ¬¡å¯å¨èªå¨çæ\ncluster-config-file /usr/local/redis/conf/7001/7001.conf\n# è¯·æ±è¶æ¶æ¶é´ï¼è®¾ç½® 10 ç§\ncluster-node-timeout 10000\n\n# å¼å¯ AOF æä¹å\nappendonly yes\n# æ°æ®å­æ¾ç®å½\ndir /usr/local/redis/conf/7001\n# è¿ç¨æä»¶\npidfile /usr/local/redis/conf/7001/7001.pid\n# æ¥å¿æä»¶\nlogfile /usr/local/redis/conf/7001/7001.log\n\n\nï¼3ï¼æ¹éå¯å¨ Redis èç¹\n\nRedis ç utils/create-cluster ç®å½ä¸èªå¸¦äºä¸ä¸ªåä¸º create-cluster çèæ¬å·¥å·ï¼å¯ä»¥å©ç¨å®æ¥æ°å»ºãå¯å¨ãåæ­¢ãéå¯ Redis èç¹ã\n\nèæ¬ä¸­æå ä¸ªå³é®åæ°ï¼\n\n * PORT=30000 - åå§ç«¯å£å·\n * TIMEOUT=2000 - è¶æ¶æ¶é´\n * NODES=6 - èç¹æ°\n * REPLICAS=1 - å¤ä»½æ°\n\nèæ¬ä¸­çæ¯ä¸ªå½ä»¤é¡¹ä¼æ ¹æ®åå§ç«¯å£å·ï¼ä»¥åè®¾ç½®çèç¹æ°ï¼éåçå»æ§è¡æä½ã\n\nç±äºåé¢çè§åä¸­ï¼èç¹ç«¯å£æ¯ä» 7001 ~ 7006ï¼æä»¥éè¦å° PORT åéè®¾ä¸º 7000ã\n\nèæ¬ä¸­å¯å¨æ¯ä¸ª Redis èç¹æ¯éè¿æå®å½ä»¤è¡åæ°æ¥éç½®å±æ§ãæä»¥ï¼æä»¬éè¦æ¹ä¸ä¸ï¼\n\nPORT=7000\nTIMEOUT=2000\nNODES=6\nENDPORT=$((PORT+NODES))\n\n# ...\n\nif [ "$1" == "start" ]\nthen\n    while [ $((PORT < ENDPORT)) != "0" ]; do\n        PORT=$((PORT+1))\n        echo "Starting $PORT"\n        /usr/local/redis/src/redis-server /usr/local/redis/conf/${PORT}/redis.conf\n    done\n    exit 0\nfi\n\n\nå¥½äºï¼å¨æ¯å°æå¡å¨ä¸ï¼é½æ§è¡ ./create-cluster start æ¥å¯å¨èç¹ã\n\nç¶åï¼éè¿ ps å½ä»¤æ¥ç¡®è®¤ Redis è¿ç¨æ¯å¦å·²ç»å·¥ä½ï¼\n\n# root @ dbClusterDev01 in /usr/local/redis/conf [11:07:55]\n$ ps -ef | grep redis\nroot      4604     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7001 [cluster]\nroot      4609     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7002 [cluster]\nroot      4614     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7003 [cluster]\nroot      4619     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7004 [cluster]\nroot      4624     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7005 [cluster]\nroot      4629     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7006 [cluster]\n\n\nï¼4ï¼å¯å¨éç¾¤\n\néè¿ redis-cli --cluster create å½ä»¤å¯ä»¥èªå¨éç½®éç¾¤ï¼å¦ä¸ï¼\n\n./redis-cli --cluster create 127.0.0.1:7001 127.0.0.1:7002 127.0.0.2:7003 127.0.0.2:7004 127.0.0.3:7005 127.0.0.3:7006 --cluster-replicas 1\n\n\nredis-cluster ä¼æ ¹æ®è®¾ç½®çèç¹æ°åå¯æ¬æ°èªå¨åçï¼åé Hash èææ§½ slotï¼ï¼å¦ææ»¡æï¼è¾å¥ yes ï¼ç´æ¥å¼å§åçã\n\n>>> Performing hash slots allocation on 6 nodes...\nMaster[0] -> Slots 0 - 5460\nMaster[1] -> Slots 5461 - 10922\nMaster[2] -> Slots 10923 - 16383\nAdding replica 127.0.0.2:7004 to 127.0.0.1:7001\nAdding replica 127.0.0.3:7006 to 127.0.0.2:7003\nAdding replica 127.0.0.1:7002 to 127.0.0.3:7005\nM: b721235997deb6b9a7a2be690b5b9663db8057c6 127.0.0.1:7001\n   slots:[0-5460] (5461 slots) master\nS: bda9b7036df0bbefe601bda4ce45d3787a2e9bd9 127.0.0.1:7002\n   replicates 3623fff69b5243ed18c02a2fbb6f53069b0f1505\nM: 91523c0391a044da6cc9f53bb965aabe89502187 127.0.0.2:7003\n   slots:[5461-10922] (5462 slots) master\nS: 9d899cbe49dead7b8c4f769920cdb75714a441ae 127.0.0.2:7004\n   replicates b721235997deb6b9a7a2be690b5b9663db8057c6\nM: 3623fff69b5243ed18c02a2fbb6f53069b0f1505 127.0.0.3:7005\n   slots:[10923-16383] (5461 slots) master\nS: a2869dc153ea4977ca790b76483574a5d56cb40e 127.0.0.3:7006\n   replicates 91523c0391a044da6cc9f53bb965aabe89502187\nCan I set the above configuration? (type \'yes\' to accept): yes\n>>> Nodes configuration updated\n>>> Assign a different config epoch to each node\n>>> Sending CLUSTER MEET messages to join the cluster\nWaiting for the cluster to join\n....\n>>> Performing Cluster Check (using node 127.0.0.1:7001)\nM: b721235997deb6b9a7a2be690b5b9663db8057c6 127.0.0.1:7001\n   slots:[0-5460] (5461 slots) master\n   1 additional replica(s)\nS: a2869dc153ea4977ca790b76483574a5d56cb40e 127.0.0.1:7006\n   slots: (0 slots) slave\n   replicates 91523c0391a044da6cc9f53bb965aabe89502187\nM: 91523c0391a044da6cc9f53bb965aabe89502187 127.0.0.1:7003\n   slots:[5461-10922] (5462 slots) master\n   1 additional replica(s)\nM: 3623fff69b5243ed18c02a2fbb6f53069b0f1505 127.0.0.1:7005\n   slots:[10923-16383] (5461 slots) master\n   1 additional replica(s)\nS: 9d899cbe49dead7b8c4f769920cdb75714a441ae 127.0.0.1:7004\n   slots: (0 slots) slave\n   replicates b721235997deb6b9a7a2be690b5b9663db8057c6\nS: bda9b7036df0bbefe601bda4ce45d3787a2e9bd9 127.0.0.1:7002\n   slots: (0 slots) slave\n   replicates 3623fff69b5243ed18c02a2fbb6f53069b0f1505\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\n\n\nï¼5ï¼æ¥å¸¸ç»´æ¤æä½\n\n * å³é­éç¾¤ - ./create-cluster stop\n * æ£æ¥éç¾¤æ¯å¦å¥åº·ï¼æå®ä»»æèç¹å³å¯ï¼ï¼./redis-cli --cluster check <ip:port>\n * å°è¯ä¿®å¤éç¾¤èç¹ï¼./redis-cli --cluster fix <ip:port>\n\n\n# é¨ç½²å¨åµ\n\nredis-cluster å®ç°äº Redis çåçãå¤å¶ã\n\nä½ redis-cluster æ²¡æè§£å³æéè½¬ç§»é®é¢ï¼ä¸æ¦ä»»æåçç Master èç¹å®æºãç½ç»ä¸éï¼å°±ä¼å¯¼è´ redis-cluster çéç¾¤ä¸è½å·¥ä½ãä¸ºäºè§£å³é«å¯ç¨çé®é¢ï¼Redis æä¾äº Redis å¨åµæ¥çæ§ Redis èç¹ç¶æï¼å¹¶ä¸ä¼å¨ Master å®æºæ¶ï¼åèµ·éä¸¾ï¼å°è¿ä¸ª Master çä¸ä¸ª Slave èç¹éä¸¾ä¸º Masterã\n\nï¼1ï¼åå»ºèç¹ç®å½\n\næä¸ªäººåå¥½å°è½¯ä»¶æ¾å¨ /opt ç®å½ä¸ï¼å¨æçæºå¨ä¸­ï¼Redis é½å®è£å¨ /usr/local/redis ç®å½ä¸ãæä»¥ï¼ä¸é¢çå½ä»¤åéç½®é½åè®¾ Redis å®è£ç®å½ä¸º /usr/local/redis ã\n\nç¡®ä¿æºå¨ä¸å·²ç»å®è£äº Redis åï¼æ§è¡ä»¥ä¸å½ä»¤ï¼åå»º Redis éç¾¤èç¹å®ä¾ç®å½ï¼\n\nsudo mkdir -p /usr/local/redis/conf/27001\nsudo mkdir -p /usr/local/redis/conf/27002\nsudo mkdir -p /usr/local/redis/conf/27003\n\n\nï¼2ï¼éç½®éç¾¤èç¹\n\næ¯ä¸ªå®ä¾ç®å½ä¸ï¼æ°å»º redis.conf éç½®æä»¶ã\n\nå®ä¾éç½®æ¨¡æ¿ä»¥ 7001 èç¹ä¸ºä¾ï¼å¶ä»èç¹ï¼å®å¨æ¿æ¢éç½®ä¸­çç«¯å£å· 7001 å³å¯ï¼ï¼å¦ä¸ï¼\n\nport 27001\ndaemonize yes\nsentinel monitor redis-master 172.22.6.3 7001 2\nsentinel down-after-milliseconds redis-master 5000\nsentinel failover-timeout redis-master 900000\nsentinel parallel-syncs redis-master 1\n#sentinel auth-pass redis-master 123456\nlogfile /usr/local/redis/conf/27001/27001.log\n\n\nï¼3ï¼æ¹éå¯å¨å¨åµèç¹\n\n/opt/redis/src/redis-sentinel /usr/local/redis/conf/27001/sentinel.conf\n/opt/redis/src/redis-sentinel /usr/local/redis/conf/27002/sentinel.conf\n/opt/redis/src/redis-sentinel /usr/local/redis/conf/27003/sentinel.conf\n\n\n\n# æ©å®¹\n\nï¼1ï¼æ¥çä¿¡æ¯\n\nè¿å¥ä»»æèç¹\n\n./redis-cli -h 172.22.6.3 -p 7001\n\n\ncluster info æ¥çéç¾¤èç¹ç¶æ\n\n172.22.6.3:7001> cluster nodes\nf158bf70bb2767cac271ce4efcfc14ba0b7ca98b 172.22.6.3:7006@17006 slave e7aa182e756b76ec85b471797db9b66e4b2da725 0 1594528179000 6 connected\nf348e67648460c7a800120d69b4977bf2e4524cb 172.22.6.3:7001@17001 myself,master - 0 1594528179000 1 connected 0-5460\n52601e2d4af0e64b83f4cc6d20e8316d0ac38b99 172.22.6.3:7004@17004 slave 4802fafe897160c46392c6e569d6f5e466cca696 0 1594528178000 4 connected\nc6c6a68674ae8aac3c6ec792c8af4dc1228c6c31 172.22.6.3:7005@17005 slave f348e67648460c7a800120d69b4977bf2e4524cb 0 1594528179852 5 connected\ne7aa182e756b76ec85b471797db9b66e4b2da725 172.22.6.3:7002@17002 master - 0 1594528178000 2 connected 5461-10922\n4802fafe897160c46392c6e569d6f5e466cca696 172.22.6.3:7003@17003 master - 0 1594528178000 3 connected 10923-16383\n\n\ncluster info æ¥çéç¾¤ä¿¡æ¯\n\n172.22.6.3:7001> cluster info\ncluster_state:ok\ncluster_slots_assigned:16384\ncluster_slots_ok:16384\ncluster_slots_pfail:0\ncluster_slots_fail:0\ncluster_known_nodes:6\ncluster_size:3\ncluster_current_epoch:6\ncluster_my_epoch:1\ncluster_stats_messages_ping_sent:3406\ncluster_stats_messages_pong_sent:3569\ncluster_stats_messages_publish_sent:5035\ncluster_stats_messages_sent:12010\ncluster_stats_messages_ping_received:3564\ncluster_stats_messages_pong_received:3406\ncluster_stats_messages_meet_received:5\ncluster_stats_messages_publish_received:5033\ncluster_stats_messages_received:12008\n\n\nï¼2ï¼æ·»å èç¹å°éç¾¤\n\nå°å·²å¯å¨çèç¹å®ä¾æ·»å å°éç¾¤ä¸­\n\nredis-cli --cluster add-node 127.0.0.1:7007 127.0.0.1:7008\n\n\næ·»å ä¸»èç¹\n\næ·»å ä¸ç»ä¸»èç¹\n\n./redis-cli --cluster add-node 172.22.6.3:7007 172.22.6.3:7001\n./redis-cli --cluster add-node 172.22.6.3:7008 172.22.6.3:7001\n./redis-cli --cluster add-node 172.22.6.3:7009 172.22.6.3:7001\n\n\næ¥çèç¹ç¶æ\n\n172.22.6.3:7001> cluster nodes\nf158bf70bb2767cac271ce4efcfc14ba0b7ca98b 172.22.6.3:7006@17006 slave e7aa182e756b76ec85b471797db9b66e4b2da725 0 1594529342575 6 connected\nf348e67648460c7a800120d69b4977bf2e4524cb 172.22.6.3:7001@17001 myself,master - 0 1594529340000 1 connected 0-5460\n55cacf121662833a4a19dbeb4a5df712cfedf77f 172.22.6.3:7009@17009 master - 0 1594529342000 0 connected\nc6c6a68674ae8aac3c6ec792c8af4dc1228c6c31 172.22.6.3:7005@17005 slave f348e67648460c7a800120d69b4977bf2e4524cb 0 1594529341573 5 connected\n4802fafe897160c46392c6e569d6f5e466cca696 172.22.6.3:7003@17003 master - 0 1594529343577 3 connected 10923-16383\ne7aa182e756b76ec85b471797db9b66e4b2da725 172.22.6.3:7002@17002 master - 0 1594529342000 2 connected 5461-10922\ne5ba78fe629115977a74fbbe1478caf8868d6d55 172.22.6.3:7007@17007 master - 0 1594529341000 0 connected\n52601e2d4af0e64b83f4cc6d20e8316d0ac38b99 172.22.6.3:7004@17004 slave 4802fafe897160c46392c6e569d6f5e466cca696 0 1594529340000 4 connected\n79d4fffc2cec210556c3b4c44e63ab506e87eda3 172.22.6.3:7008@17008 master - 0 1594529340000 7 connected\n\n\nå¯ä»¥åç°ï¼æ°å å¥çä¸ä¸ªä¸»èç¹ï¼è¿æ²¡æåéåå¸æ§½ï¼æä»¥ï¼ææ¶è¿æ æ³è®¿é®ã\n\næ·»å ä»èç¹\n\n--slaveï¼è®¾ç½®è¯¥åæ°ï¼åæ°èç¹ä»¥ slave çè§è²å å¥éç¾¤\n--master-idï¼è¿ä¸ªåæ°éè¦è®¾ç½®äº--slave æè½çæï¼--master-id ç¨æ¥æå®æ°èç¹ç master èç¹ãå¦æä¸è®¾ç½®è¯¥åæ°ï¼åä¼éæºä¸ºèç¹éæ© master èç¹ã\n\nè¯­æ³\n\nredis-cli --cluster add-node  æ°èç¹IPå°åï¼ç«¯å£    å­å¨èç¹IPï¼ç«¯å£ --cluster-slave ï¼ä»èç¹ï¼ --cluster-master-id ï¼masterèç¹çIDï¼\nredis-cli --cluster add-node   10.42.141.119:6379  10.42.166.105:6379  --cluster-slave   --cluster-master-id  dfa238fff8a7a49230cff7eb74f573f5645c8ec5\n\n\nç¤ºä¾\n\n./redis-cli --cluster add-node 172.22.6.3:7010 172.22.6.3:7007 --cluster-slave\n./redis-cli --cluster add-node 172.22.6.3:7011 172.22.6.3:7008 --cluster-slave\n./redis-cli --cluster add-node 172.22.6.3:7012 172.22.6.3:7009 --cluster-slave\n\n\næ¥çç¶æ\n\n172.22.6.3:7001> cluster nodes\nef5c1b9ce4cc795dc12b2c1e8736a572647b4c3e 172.22.6.3:7011@17011 slave 79d4fffc2cec210556c3b4c44e63ab506e87eda3 0 1594529492043 7 connected\nf158bf70bb2767cac271ce4efcfc14ba0b7ca98b 172.22.6.3:7006@17006 slave e7aa182e756b76ec85b471797db9b66e4b2da725 0 1594529491943 6 connected\nf348e67648460c7a800120d69b4977bf2e4524cb 172.22.6.3:7001@17001 myself,master - 0 1594529488000 1 connected 0-5460\n5140d1129ed850df59c51cf818c4eb74545d9959 172.22.6.3:7010@17010 slave e5ba78fe629115977a74fbbe1478caf8868d6d55 0 1594529488000 0 connected\n55cacf121662833a4a19dbeb4a5df712cfedf77f 172.22.6.3:7009@17009 master - 0 1594529488000 8 connected\nc6c6a68674ae8aac3c6ec792c8af4dc1228c6c31 172.22.6.3:7005@17005 slave f348e67648460c7a800120d69b4977bf2e4524cb 0 1594529490000 5 connected\n4802fafe897160c46392c6e569d6f5e466cca696 172.22.6.3:7003@17003 master - 0 1594529489939 3 connected 10923-16383\ne7aa182e756b76ec85b471797db9b66e4b2da725 172.22.6.3:7002@17002 master - 0 1594529491000 2 connected 5461-10922\ne5ba78fe629115977a74fbbe1478caf8868d6d55 172.22.6.3:7007@17007 master - 0 1594529490942 0 connected\n52601e2d4af0e64b83f4cc6d20e8316d0ac38b99 172.22.6.3:7004@17004 slave 4802fafe897160c46392c6e569d6f5e466cca696 0 1594529491000 4 connected\n02e9f57b5b45c350dc57acf1c8efa8db136db7b7 172.22.6.3:7012@17012 master - 0 1594529489000 0 connected\n79d4fffc2cec210556c3b4c44e63ab506e87eda3 172.22.6.3:7008@17008 master - 0 1594529489000 7 connected\n\n\nåéåå¸æ§½\n\næ§è¡ ./redis-cli --cluster rebalance 172.22.6.3:7001 --cluster-threshold 1 --cluster-use-empty-masters\n\nåæ°è¯´æï¼\n\nrebalanceï¼è¡¨æè®© Redis èªå¨æ ¹æ®èç¹æ°è¿è¡åè¡¡åå¸æ§½åéã\n\n--cluster-use-empty-mastersï¼è¡¨æ\n\n\n\næ§è¡ç»æåï¼æ¥çç¶æï¼\n\n\n\n\n# åãRedis å½ä»¤\n\n\n# éç¨å½ä»¤\n\n> å½ä»¤è¯¦ç»ç¨æ³ï¼è¯·åè Redis å½ä»¤å®æ¹ææ¡£\n> \n> æ¬è¿ä¸¤å¼  cheat sheet å¾ï¼ååï¼https://www.cheatography.com/tasjaevan/cheat-sheets/redis/\n\n\n\n\n\n\n# éç¾¤å½ä»¤\n\n * éç¾¤\n   * cluster info - æå°éç¾¤çä¿¡æ¯\n   * cluster nodes - ååºéç¾¤å½åå·²ç¥çææèç¹ï¼ nodeï¼ï¼ä»¥åè¿äºèç¹çç¸å³ä¿¡æ¯ã\n * èç¹\n   * cluster meet <ip> <port> - å° ip å port ææå®çèç¹æ·»å å°éç¾¤å½ä¸­ï¼è®©å®æä¸ºéç¾¤çä¸ä»½å­ã\n   * cluster forget <node_id> - ä»éç¾¤ä¸­ç§»é¤ node_id æå®çèç¹ã\n   * cluster replicate <node_id> - å°å½åèç¹è®¾ç½®ä¸º node_id æå®çèç¹çä»èç¹ã\n   * cluster saveconfig - å°èç¹çéç½®æä»¶ä¿å­å°ç¡¬çéé¢ã\n * æ§½(slot)\n   * cluster addslots <slot> [slot ...] - å°ä¸ä¸ªæå¤ä¸ªæ§½ï¼ slotï¼ææ´¾ï¼ assignï¼ç»å½åèç¹ã\n   * cluster delslots <slot> [slot ...] - ç§»é¤ä¸ä¸ªæå¤ä¸ªæ§½å¯¹å½åèç¹çææ´¾ã\n   * cluster flushslots - ç§»é¤ææ´¾ç»å½åèç¹çæææ§½ï¼è®©å½åèç¹åæä¸ä¸ªæ²¡æææ´¾ä»»ä½æ§½çèç¹ã\n   * cluster setslot <slot> node <node_id> - å°æ§½ slot ææ´¾ç» node_id æå®çèç¹ï¼å¦ææ§½å·²ç»ææ´¾ç»å¦ä¸ä¸ªèç¹ï¼é£ä¹åè®©å¦ä¸ä¸ªèç¹å é¤è¯¥æ§½>ï¼ç¶ååè¿è¡ææ´¾ã\n   * cluster setslot <slot> migrating <node_id> - å°æ¬èç¹çæ§½ slot è¿ç§»å° node_id æå®çèç¹ä¸­ã\n   * cluster setslot <slot> importing <node_id> - ä» node_id æå®çèç¹ä¸­å¯¼å¥æ§½ slot å°æ¬èç¹ã\n   * cluster setslot <slot> stable - åæ¶å¯¹æ§½ slot çå¯¼å¥ï¼ importï¼æèè¿ç§»ï¼ migrateï¼ã\n * é®\n   * cluster keyslot <key> - è®¡ç®é® key åºè¯¥è¢«æ¾ç½®å¨åªä¸ªæ§½ä¸ã\n   * cluster countkeysinslot <slot> - è¿åæ§½ slot ç®ååå«çé®å¼å¯¹æ°éã\n   * cluster getkeysinslot <slot> <count> - è¿å count ä¸ª slot æ§½ä¸­çé®ã\n\n# éæ°åç\n\næ·»å èç¹ï¼./redis-cli --cluster add-node 192.168.1.136:7007 192.168.1.136:7001 --cluster-slave\n\nredis-cli --cluster reshard 172.22.6.3 7001\n\n\n# äºãå®¢æ·ç«¯\n\næ¨èä½¿ç¨ RedisDesktopManager\n\n\n# åèèµæ\n\n * å®ç½\n   * Redis å®ç½\n   * Redis github\n   * Redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãRedis å®æã\n   * ãRedis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * Redis å½ä»¤åè\n * æç« \n   * æ·±å¥åæ Redis ç³»å(ä¸) - Redis éç¾¤æ¨¡å¼æ­å»ºä¸åçè¯¦è§£',normalizedContent:'# redis è¿ç»´\n\n> redis æ¯ä¸ä¸ªé«æ§è½ç key-value æ°æ®åºã\n> \n> set æä½æ¯ç§é 110000 æ¬¡ï¼get æä½æ¯ç§é 81000 æ¬¡ã\n\n\n# ä¸ãredis å®è£\n\n\n# window ä¸å®è£\n\nä¸è½½å°åï¼https://github.com/msopentech/redis/releasesã\n\nredis æ¯æ 32 ä½å 64 ä½ãè¿ä¸ªéè¦æ ¹æ®ä½ ç³»ç»å¹³å°çå®éæåµéæ©ï¼è¿éæä»¬ä¸è½½ redis-x64-xxx.zipåç¼©åå° c çï¼è§£ååï¼å°æä»¶å¤¹éæ°å½åä¸º redisã\n\næå¼ä¸ä¸ª cmd çªå£ ä½¿ç¨ cd å½ä»¤åæ¢ç®å½å° c:\\redis è¿è¡ redis-server.exe redis.windows.conf ã\n\nå¦ææ³æ¹ä¾¿çè¯ï¼å¯ä»¥æ redis çè·¯å¾å å°ç³»ç»çç¯å¢åééï¼è¿æ ·å°±çå¾åè¾è·¯å¾äºï¼åé¢çé£ä¸ª redis.windows.conf å¯ä»¥çç¥ï¼å¦æçç¥ï¼ä¼å¯ç¨é»è®¤çã\n\nè¿æ¶åå¦å¯ä¸ä¸ª cmd çªå£ï¼åæ¥çä¸è¦å³é­ï¼ä¸ç¶å°±æ æ³è®¿é®æå¡ç«¯äºã\n\nåæ¢å° redis ç®å½ä¸è¿è¡ redis-cli.exe -h 127.0.0.1 -p 6379 ã\n\n\n# linux ä¸å®è£\n\nä¸è½½å°åï¼ http://redis.io/downloadï¼ä¸è½½ææ°ææ¡£çæ¬ã\n\nä¸è½½ãè§£åãç¼è¯ redis\n\nwget http://download.redis.io/releases/redis-5.0.4.tar.gz\ntar xzf redis-5.0.4.tar.gz\ncd redis-5.0.4\nmake\n\n\nä¸ºäºç¼è¯ redis æºç ï¼ä½ éè¦ gcc-c++å tclãå¦æä½ çç³»ç»æ¯ centosï¼å¯ä»¥ç´æ¥æ§è¡å½ä»¤ï¼yum install -y gcc-c++ tcl æ¥å®è£ã\n\nè¿å¥å°è§£ååç src ç®å½ï¼éè¿å¦ä¸å½ä»¤å¯å¨ redis:\n\nsrc/redis-server\n\n\næ¨å¯ä»¥ä½¿ç¨åç½®çå®¢æ·ç«¯ä¸ redis è¿è¡äº¤äº:\n\n$ src/redis-cli\nredis> set foo bar\nok\nredis> get foo\n"bar"\n\n\n\n# ubuntu ä¸å®è£\n\nå¨ ubuntu ç³»ç»å®è£ redis å¯ä»¥ä½¿ç¨ä»¥ä¸å½ä»¤:\n\nsudo apt-get update\nsudo apt-get install redis-server\n\n\n\n# å¼æºå¯å¨\n\n * å¼æºå¯å¨éç½®ï¼echo "/usr/local/bin/redis-server /etc/redis.conf" >> /etc/rc.local\n\n\n# å¼æ¾é²ç«å¢ç«¯å£\n\n * æ·»å è§åï¼iptables -i input -p tcp -m tcp --dport 6379 -j accept\n * ä¿å­è§åï¼service iptables save\n * éå¯ iptablesï¼service iptables restart\n\n\n# redis å®è£èæ¬\n\n> centos7 ç¯å¢å®è£èæ¬ï¼è½¯ä»¶è¿ç»´éç½®èæ¬éå\n\nå®è£è¯´æ\n\n * éç¨ç¼è¯æ¹å¼å®è£ redis, å¹¶å°å¶æ³¨åä¸º systemd æå¡\n * å®è£è·¯å¾ä¸ºï¼/usr/local/redis\n * é»è®¤ä¸è½½å®è£ 5.0.4 çæ¬ï¼ç«¯å£å·ä¸ºï¼6379ï¼å¯ç ä¸ºç©º\n\nä½¿ç¨æ¹æ³\n\n * é»è®¤å®è£ - æ§è¡ä»¥ä¸ä»»æå½ä»¤å³å¯ï¼\n\ncurl -o- https://gitee.com/turnon/linux-tutorial/raw/master/codes/linux/soft/redis-install.sh | bash\nwget -qo- https://gitee.com/turnon/linux-tutorial/raw/master/codes/linux/soft/redis-install.sh | bash\n\n\n * èªå®ä¹å®è£ - ä¸è½½èæ¬å°æ¬å°ï¼å¹¶æç§ä»¥ä¸æ ¼å¼æ§è¡ï¼\n\nsh redis-install.sh [version] [port] [password]\n\n\nåæ°è¯´æï¼\n\n * version - redis çæ¬å·\n * port - redis æå¡ç«¯å£å·\n * password - è®¿é®å¯ç \n\n\n# äºãredis åæºä½¿ç¨åéç½®\n\n\n# å¯å¨ redis\n\nå¯å¨ redis æå¡\n\ncd /usr/local/redis/src\n./redis-server\n\n\nå¯å¨ redis å®¢æ·ç«¯\n\ncd /usr/local/redis/src\n./redis-cli\n\n\næ¥ç redis æ¯å¦å¯å¨\n\nredis-cli\n\n\nä»¥ä¸å½ä»¤å°æå¼ä»¥ä¸ç»ç«¯ï¼\n\nredis 127.0.0.1:6379>\n\n\n127.0.0.1 æ¯æ¬æº ip ï¼6379 æ¯ redis æå¡ç«¯å£ãç°å¨æä»¬è¾å¥ ping å½ä»¤ã\n\nredis 127.0.0.1:6379> ping\npong\n\n\nä»¥ä¸è¯´ææä»¬å·²ç»æåå¯å¨äº redisã\n\n\n# redis å¸¸è§éç½®\n\n> redis é»è®¤çéç½®æä»¶æ¯æ ¹ç®å½ä¸ç redis.conf æä»¶ã\n> \n> å¦æéè¦æå®ç¹å®æä»¶ä½ä¸ºéç½®æä»¶ï¼éè¦ä½¿ç¨å½ä»¤ï¼ ./redis-server -c xxx.conf\n> \n> æ¯æ¬¡ä¿®æ¹éç½®åï¼éè¦éå¯æè½çæã\n> \n> redis å®æ¹é»è®¤éç½®ï¼\n> \n>  * èªæè¿°ææ¡£ redis.conf for redis 2.8\n>  * èªæè¿°ææ¡£ redis.conf for redis 2.6.\n>  * èªæè¿°ææ¡£ redis.conf for redis 2.4.\n> \n> èª redis2.6 èµ·å°±å¯ä»¥ç´æ¥éè¿å½ä»¤è¡ä¼ é redis éç½®åæ°ãè¿ç§æ¹æ³å¯ä»¥ç¨äºæµè¯ãèª redis2.6 èµ·å°±å¯ä»¥ç´æ¥éè¿å½ä»¤è¡ä¼ é redis éç½®åæ°ãè¿ç§æ¹æ³å¯ä»¥ç¨äºæµè¯ã\n\n\n# è®¾ä¸ºå®æ¤è¿ç¨\n\nredis é»è®¤ä»¥éå®æ¤è¿ç¨æ¹å¼å¯å¨ï¼èéå¸¸æä»¬ä¼å° redis è®¾ä¸ºå®æ¤è¿ç¨å¯å¨æ¹å¼ï¼éç½®ï¼daemonize yes\n\n# è¿ç¨è®¿é®\n\nredis é»è®¤ç»å® 127.0.0.1ï¼è¿æ ·å°±åªè½æ¬æºæè½è®¿é®ï¼è¥è¦ redis åè®¸è¿ç¨è®¿é®ï¼éè¦éç½®ï¼bind 0.0.0.0\n\n# è®¾ç½®å¯ç \n\nredis é»è®¤è®¿é®ä¸éè¦å¯ç ï¼å¦æéè¦è®¾ç½®å¯ç ï¼éè¦å¦ä¸éç½®ï¼\n\n * protected-mode yes\n * requirepass <å¯ç >\n\n# éç½®åæ°è¡¨\n\néç½®é¡¹                                                         è¯´æ\ndaemonize no                                                redis é»è®¤ä¸æ¯ä»¥å®æ¤è¿ç¨çæ¹å¼è¿è¡ï¼å¯ä»¥éè¿è¯¥éç½®é¡¹ä¿®æ¹ï¼ä½¿ç¨ yes å¯ç¨å®æ¤è¿ç¨ï¼windows\n                                                            ä¸æ¯æå®æ¤çº¿ç¨çéç½®ä¸º no ï¼\npidfile /var/run/redis.pid                                  å½ redis ä»¥å®æ¤è¿ç¨æ¹å¼è¿è¡æ¶ï¼redis é»è®¤ä¼æ pid åå¥ /var/run/redis.pid\n                                                            æä»¶ï¼å¯ä»¥éè¿ pidfile æå®\nport 6379                                                   æå® redis çå¬ç«¯å£ï¼é»è®¤ç«¯å£ä¸º 6379ï¼ä½èå¨èªå·±çä¸ç¯åæä¸­è§£éäºä¸ºä»ä¹éç¨ 6379 ä½ä¸ºé»è®¤ç«¯å£ï¼å ä¸º\n                                                            6379 å¨ææºæé®ä¸ merz å¯¹åºçå·ç ï¼è merz åèªæå¤§å©æ­å¥³ alessia merz çåå­\nbind 127.0.0.1                                              ç»å®çä¸»æºå°å\ntimeout 300                                                 å½å®¢æ·ç«¯é²ç½®å¤é¿æ¶é´åå³é­è¿æ¥ï¼å¦ææå®ä¸º 0ï¼è¡¨ç¤ºå³é­è¯¥åè½\nloglevel notice                                             æå®æ¥å¿è®°å½çº§å«ï¼redis æ»å±æ¯æåä¸ªçº§å«ï¼debugãverboseãnoticeãwarningï¼é»è®¤ä¸º\n                                                            notice\nlogfile stdout                                              æ¥å¿è®°å½æ¹å¼ï¼é»è®¤ä¸ºæ åè¾åºï¼å¦æéç½® redis\n                                                            ä¸ºå®æ¤è¿ç¨æ¹å¼è¿è¡ï¼èè¿éåéç½®ä¸ºæ¥å¿è®°å½æ¹å¼ä¸ºæ åè¾åºï¼åæ¥å¿å°ä¼åéç» /dev/null\ndatabases 16                                                è®¾ç½®æ°æ®åºçæ°éï¼é»è®¤æ°æ®åºä¸º 0ï¼å¯ä»¥ä½¿ç¨ select å½ä»¤å¨è¿æ¥ä¸æå®æ°æ®åº id\nsave <seconds> <changes> redis é»è®¤éç½®æä»¶ä¸­æä¾äºä¸ä¸ªæ¡ä»¶ï¼save 900      æå®å¨å¤é¿æ¶é´åï¼æå¤å°æ¬¡æ´æ°æä½ï¼å°±å°æ°æ®åæ­¥å°æ°æ®æä»¶ï¼å¯ä»¥å¤ä¸ªæ¡ä»¶éå\n1ãsave 300 10ãsave 60 10000 åå«è¡¨ç¤º 900 ç§ï¼15 åéï¼åæ 1 ä¸ªæ´æ¹ï¼300\nç§ï¼5 åéï¼åæ 10 ä¸ªæ´æ¹ä»¥å 60 ç§åæ 10000 ä¸ªæ´æ¹ã\nrdbcompression yes                                          æå®å­å¨è³æ¬å°æ°æ®åºæ¶æ¯å¦åç¼©æ°æ®ï¼é»è®¤ä¸º yesï¼redis éç¨ lzf åç¼©ï¼å¦æä¸ºäºèç cpu\n                                                            æ¶é´ï¼å¯ä»¥å³é­è¯¥éé¡¹ï¼ä½ä¼å¯¼è´æ°æ®åºæä»¶åçå·¨å¤§\ndbfilename dump.rdb                                         æå®æ¬å°æ°æ®åºæä»¶åï¼é»è®¤å¼ä¸º dump.rdb\ndir ./                                                      æå®æ¬å°æ°æ®åºå­æ¾ç®å½\nslaveof <masterip> <masterport>                             è®¾ç½®å½æ¬æºä¸º slav æå¡æ¶ï¼è®¾ç½® master æå¡ç ip å°ååç«¯å£ï¼å¨ redis å¯å¨æ¶ï¼å®ä¼èªå¨ä»\n                                                            master è¿è¡æ°æ®åæ­¥\nmasterauth <master-password>                                å½ master æå¡è®¾ç½®äºå¯ç ä¿æ¤æ¶ï¼slav æå¡è¿æ¥ master çå¯ç \nrequirepass foobared                                        è®¾ç½® redis è¿æ¥å¯ç ï¼å¦æéç½®äºè¿æ¥å¯ç ï¼å®¢æ·ç«¯å¨è¿æ¥ redis æ¶éè¦éè¿ auth <password>\n                                                            å½ä»¤æä¾å¯ç ï¼é»è®¤å³é­\nmaxclients 128                                              è®¾ç½®åä¸æ¶é´æå¤§å®¢æ·ç«¯è¿æ¥æ°ï¼é»è®¤æ éå¶ï¼redis å¯ä»¥åæ¶æå¼çå®¢æ·ç«¯è¿æ¥æ°ä¸º redis\n                                                            è¿ç¨å¯ä»¥æå¼çæå¤§æä»¶æè¿°ç¬¦æ°ï¼å¦æè®¾ç½® maxclients 0ï¼è¡¨ç¤ºä¸ä½éå¶ãå½å®¢æ·ç«¯è¿æ¥æ°å°è¾¾éå¶æ¶ï¼redis\n                                                            ä¼å³é­æ°çè¿æ¥å¹¶åå®¢æ·ç«¯è¿å max number of clients reached éè¯¯ä¿¡æ¯\nmaxmemory <bytes>                                           æå® redis æå¤§åå­éå¶ï¼redis å¨å¯å¨æ¶ä¼ææ°æ®å è½½å°åå­ä¸­ï¼è¾¾å°æå¤§åå­åï¼redis\n                                                            ä¼åå°è¯æ¸é¤å·²å°ææå³å°å°æç keyï¼å½æ­¤æ¹æ³å¤ç\n                                                            åï¼ä»ç¶å°è¾¾æå¤§åå­è®¾ç½®ï¼å°æ æ³åè¿è¡åå¥æä½ï¼ä½ä»ç¶å¯ä»¥è¿è¡è¯»åæä½ãredis æ°ç vm æºå¶ï¼ä¼æ key\n                                                            å­æ¾åå­ï¼value ä¼å­æ¾å¨ swap åº\nappendonly no                                               æå®æ¯å¦å¨æ¯æ¬¡æ´æ°æä½åè¿è¡æ¥å¿è®°å½ï¼redis\n                                                            å¨é»è®¤æåµä¸æ¯å¼æ­¥çææ°æ®åå¥ç£çï¼å¦æä¸å¼å¯ï¼å¯è½ä¼å¨æ­çµæ¶å¯¼è´ä¸æ®µæ¶é´åçæ°æ®ä¸¢å¤±ãå ä¸º redis\n                                                            æ¬èº«åæ­¥æ°æ®æä»¶æ¯æä¸é¢ save æ¡ä»¶æ¥åæ­¥çï¼æä»¥æçæ°æ®ä¼å¨ä¸æ®µæ¶é´ååªå­å¨äºåå­ä¸­ãé»è®¤ä¸º no\nappendfilename appendonly.aof                               æå®æ´æ°æ¥å¿æä»¶åï¼é»è®¤ä¸º appendonly.aof\nappendfsync everysec                                        æå®æ´æ°æ¥å¿æ¡ä»¶ï¼å±æ 3\n                                                            ä¸ªå¯éå¼ï¼noï¼è¡¨ç¤ºç­æä½ç³»ç»è¿è¡æ°æ®ç¼å­åæ­¥å°ç£çï¼å¿«ï¼alwaysï¼è¡¨ç¤ºæ¯æ¬¡æ´æ°æä½åæå¨è°ç¨ fsync()\n                                                            å°æ°æ®åå°ç£çï¼æ¢ï¼å®å¨ï¼everysecï¼è¡¨ç¤ºæ¯ç§åæ­¥ä¸æ¬¡ï¼æä¸­ï¼é»è®¤å¼ï¼\nvm-enabled no                                               æå®æ¯å¦å¯ç¨èæåå­æºå¶ï¼é»è®¤å¼ä¸º noï¼ç®åçä»ç»ä¸ä¸ï¼vm æºå¶å°æ°æ®åé¡µå­æ¾ï¼ç± redis\n                                                            å°è®¿é®éè¾å°çé¡µå³å·æ°æ® swap å°ç£çä¸ï¼è®¿é®å¤çé¡µé¢ç±ç£çèªå¨æ¢åºå°åå­ä¸­ï¼å¨åé¢çæç« æä¼ä»ç»åæ redis\n                                                            ç vm æºå¶ï¼\nvm-swap-file /tmp/redis.swap                                èæåå­æä»¶è·¯å¾ï¼é»è®¤å¼ä¸º /tmp/redis.swapï¼ä¸å¯å¤ä¸ª redis å®ä¾å±äº«\nvm-max-memory 0                                             å°ææå¤§äº vm-max-memory çæ°æ®å­å¥èæåå­ï¼æ è®º vm-max-memory\n                                                            è®¾ç½®å¤å°ï¼ææç´¢å¼æ°æ®é½æ¯åå­å­å¨ç(redis çç´¢å¼æ°æ® å°±æ¯ keys)ï¼ä¹å°±æ¯è¯´ï¼å½ vm-max-memory\n                                                            è®¾ç½®ä¸º 0 çæ¶åï¼å¶å®æ¯ææ value é½å­å¨äºç£çãé»è®¤å¼ä¸º 0\nvm-page-size 32                                             redis swap æä»¶åæäºå¾å¤ç pageï¼ä¸ä¸ªå¯¹è±¡å¯ä»¥ä¿å­å¨å¤ä¸ª page ä¸é¢ï¼ä½ä¸ä¸ª page\n                                                            ä¸ä¸è½è¢«å¤ä¸ªå¯¹è±¡å±äº«ï¼vm-page-size æ¯è¦æ ¹æ®å­å¨ç æ°æ®å¤§å°æ¥è®¾å®çï¼ä½èå»ºè®®å¦æå­å¨å¾å¤å°å¯¹è±¡ï¼page\n                                                            å¤§å°æå¥½è®¾ç½®ä¸º 32 æè 64bytesï¼å¦æå­å¨å¾å¤§å¤§å¯¹è±¡ï¼åå¯ä»¥ä½¿ç¨æ´å¤§ç pageï¼å¦æä¸ç¡®å®ï¼å°±ä½¿ç¨é»è®¤å¼\nvm-pages 134217728                                          è®¾ç½® swap æä»¶ä¸­ç page æ°éï¼ç±äºé¡µè¡¨ï¼ä¸ç§è¡¨ç¤ºé¡µé¢ç©ºé²æä½¿ç¨ç\n                                                            bitmapï¼æ¯å¨æ¾å¨åå­ä¸­çï¼ï¼å¨ç£çä¸æ¯ 8 ä¸ª pages å°æ¶è 1byte çåå­ã\nvm-max-threads 4                                            è®¾ç½®è®¿é® swap æä»¶ççº¿ç¨æ°,æå¥½ä¸è¦è¶è¿æºå¨çæ ¸æ°,å¦æè®¾ç½®ä¸º 0,é£ä¹ææå¯¹ swap\n                                                            æä»¶çæä½é½æ¯ä¸²è¡çï¼å¯è½ä¼é ææ¯è¾é¿æ¶é´çå»¶è¿ãé»è®¤å¼ä¸º 4\nglueoutputbuf yes                                           è®¾ç½®å¨åå®¢æ·ç«¯åºç­æ¶ï¼æ¯å¦æè¾å°çååå¹¶ä¸ºä¸ä¸ªååéï¼é»è®¤ä¸ºå¼å¯\nhash-max-zipmap-entries 64 hash-max-zipmap-value 512        æå®å¨è¶è¿ä¸å®çæ°éæèæå¤§çåç´ è¶è¿æä¸ä¸´çå¼æ¶ï¼éç¨ä¸ç§ç¹æ®çåå¸ç®æ³\nactiverehashing yes                                         æå®æ¯å¦æ¿æ´»éç½®åå¸ï¼é»è®¤ä¸ºå¼å¯ï¼åé¢å¨ä»ç» redis çåå¸ç®æ³æ¶å·ä½ä»ç»ï¼\ninclude /path/to/local.conf                                 æå®åå«å¶å®çéç½®æä»¶ï¼å¯ä»¥å¨åä¸ä¸»æºä¸å¤ä¸ª redis\n                                                            å®ä¾ä¹é´ä½¿ç¨åä¸ä»½éç½®æä»¶ï¼èåæ¶åä¸ªå®ä¾åæ¥æèªå·±çç¹å®éç½®æä»¶\n\n\n# ååæµè¯\n\n> åèå®æ¹ææ¡£ï¼how fast is redis?\n\nredis èªå¸¦äºä¸ä¸ªæ§è½æµè¯å·¥å·ï¼redis-benchmark\n\nï¼1ï¼åºæ¬æµè¯\n\nredis-benchmark -q -n 100000\n\n\n * -q è¡¨ç¤ºéé»ï¼quietï¼æ§è¡\n * -n 100000 è¯·æ± 10 ä¸æ¬¡\n\nï¼2ï¼æµè¯æå®è¯»åæä»¤\n\n$ redis-benchmark -t set,lpush -n 100000 -q\nset: 74239.05 requests per second\nlpush: 79239.30 requests per second\n\n\nï¼3ï¼æµè¯ pipeline æ¨¡å¼ä¸æå®è¯»åæä»¤\n\nredis-benchmark -n 1000000 -t set,get -p 16 -q\nset: 403063.28 requests per second\nget: 508388.41 requests per second\n\n\n\n# ä¸ãredis éç¾¤ä½¿ç¨åéç½®\n\nredis 3.0 åæ¯æéç¾¤æ¨¡å¼ã\n\n\n# éç¾¤è§å\n\nredis éç¾¤ä¸è¬ç± å¤ä¸ªèç¹ ç»æï¼èç¹æ°éè³å°ä¸º 6 ä¸ªï¼æè½ä¿è¯ç»æ å®æ´é«å¯ç¨ çéç¾¤ã\n\n\n\nçæ³æåµå½ç¶æ¯ææèç¹åèªå¨ä¸åçæºå¨ä¸ï¼é¦åäºèµæºï¼æ¬äººå¨é¨ç½² redis éç¾¤æ¶ï¼åªå¾å° 3 å°æå¡å¨ãæä»¥ï¼æè®¡åæ¯å°æå¡å¨é¨ç½² 2 ä¸ª redis èç¹ã\n\nãç¤ºä¾ãæç®é«å¯ç¨ redis éç¾¤è§å\n\næºå¨éç½®ï¼16g åå­ + 8 æ ¸ cpu + 1t ç£ç\n\nredis è¿ç¨åé 10 g åå­ãä¸è¬çº¿ä¸çäº§ç¯å¢ï¼redis çåå­å°½éä¸è¦è¶è¿ 10gï¼è¶è¿ 10g å¯è½ä¼æé®é¢ã\n\néç¾¤ææï¼ä¸ä¸»ä¸ä»ï¼ä¸å¨åµï¼æ¯ä¸ªå¨åµçå¬ææä¸»èç¹ã\n\nä¼°ç®æ§è½ï¼\n\n * å®¹éï¼ä¸ä¸»ï¼å ç¨ 30 g åå­ï¼æä»¥æå¤§å­å¨å®¹éä¸º 30 gãåè®¾æ¯æ¡æ°æ®è®°å½å¹³å å¤§å°ä¸º 10 kï¼åæå¤§è½å­å¨ 300 ä¸æ¡æ°æ®ã\n * ååéï¼åæºä¸è¬ tps/qps ä¸º äºä¸å°å«ä¸å·¦å³ãåè®¾ä¸ºäºä¸ï¼é£ä¹ä¸ä¸»ä¸ä»æ¶æçè®ºä¸è½è¾¾å° tps 15 ä¸ï¼qps 30 ä¸ã\n\n\n# é¨ç½²éç¾¤\n\n> redis éç¾¤èç¹çå®è£ä¸åèç¹æå¡ç¸åï¼å·®å¼ä»å¨äºé¨ç½²æ¹å¼ã\n> \n> æ³¨æï¼ä¸ºäºæ¼ç¤ºæ¹ä¾¿ï¼æ¬ç¤ºä¾å°ææ redis éç¾¤èç¹é½é¨ç½²å¨ä¸å°æºå¨ä¸ï¼å®éçäº§ç¯å¢ä¸­ï¼åºæ¬é½ä¼å°èç¹é¨ç½²å¨ä¸åæºå¨ä¸ãè¦æ±æ´é«çï¼å¯è½è¿è¦èèå¤æºæ¿é¨ç½²ã\n\nï¼1ï¼åå»ºèç¹ç®å½\n\næä¸ªäººåå¥½å°è½¯ä»¶æ¾å¨ /opt ç®å½ä¸ï¼å¨æçæºå¨ä¸­ï¼redis é½å®è£å¨ /usr/local/redis ç®å½ä¸ãæä»¥ï¼ä¸é¢çå½ä»¤åéç½®é½åè®¾ redis å®è£ç®å½ä¸º /usr/local/redis ã\n\nç¡®ä¿æºå¨ä¸å·²ç»å®è£äº redis åï¼æ§è¡ä»¥ä¸å½ä»¤ï¼åå»º redis éç¾¤èç¹å®ä¾ç®å½ï¼\n\nsudo mkdir -p /usr/local/redis/conf/7001\nsudo mkdir -p /usr/local/redis/conf/7002\nsudo mkdir -p /usr/local/redis/conf/7003\nsudo mkdir -p /usr/local/redis/conf/7004\nsudo mkdir -p /usr/local/redis/conf/7005\nsudo mkdir -p /usr/local/redis/conf/7006\n\n\nï¼2ï¼éç½®éç¾¤èç¹\n\næ¯ä¸ªå®ä¾ç®å½ä¸ï¼æ°å»º redis.conf éç½®æä»¶ã\n\nå®ä¾éç½®æ¨¡æ¿ä»¥ 7001 èç¹ä¸ºä¾ï¼å¶ä»èç¹ï¼å®å¨æ¿æ¢éç½®ä¸­çç«¯å£å· 7001 å³å¯ï¼ï¼å¦ä¸ï¼\n\n# ç«¯å£å·\nport 7001\n# ç»å®çä¸»æºç«¯å£ï¼0.0.0.0 è¡¨ç¤ºåè®¸è¿ç¨è®¿é®ï¼\nbind 0.0.0.0\n# ä»¥å®æ¤è¿ç¨æ¹å¼å¯å¨\ndaemonize yes\n\n# å¼å¯éç¾¤æ¨¡å¼\ncluster-enabled yes\n# éç¾¤çéç½®ï¼éç½®æä»¶é¦æ¬¡å¯å¨èªå¨çæ\ncluster-config-file /usr/local/redis/conf/7001/7001.conf\n# è¯·æ±è¶æ¶æ¶é´ï¼è®¾ç½® 10 ç§\ncluster-node-timeout 10000\n\n# å¼å¯ aof æä¹å\nappendonly yes\n# æ°æ®å­æ¾ç®å½\ndir /usr/local/redis/conf/7001\n# è¿ç¨æä»¶\npidfile /usr/local/redis/conf/7001/7001.pid\n# æ¥å¿æä»¶\nlogfile /usr/local/redis/conf/7001/7001.log\n\n\nï¼3ï¼æ¹éå¯å¨ redis èç¹\n\nredis ç utils/create-cluster ç®å½ä¸èªå¸¦äºä¸ä¸ªåä¸º create-cluster çèæ¬å·¥å·ï¼å¯ä»¥å©ç¨å®æ¥æ°å»ºãå¯å¨ãåæ­¢ãéå¯ redis èç¹ã\n\nèæ¬ä¸­æå ä¸ªå³é®åæ°ï¼\n\n * port=30000 - åå§ç«¯å£å·\n * timeout=2000 - è¶æ¶æ¶é´\n * nodes=6 - èç¹æ°\n * replicas=1 - å¤ä»½æ°\n\nèæ¬ä¸­çæ¯ä¸ªå½ä»¤é¡¹ä¼æ ¹æ®åå§ç«¯å£å·ï¼ä»¥åè®¾ç½®çèç¹æ°ï¼éåçå»æ§è¡æä½ã\n\nç±äºåé¢çè§åä¸­ï¼èç¹ç«¯å£æ¯ä» 7001 ~ 7006ï¼æä»¥éè¦å° port åéè®¾ä¸º 7000ã\n\nèæ¬ä¸­å¯å¨æ¯ä¸ª redis èç¹æ¯éè¿æå®å½ä»¤è¡åæ°æ¥éç½®å±æ§ãæä»¥ï¼æä»¬éè¦æ¹ä¸ä¸ï¼\n\nport=7000\ntimeout=2000\nnodes=6\nendport=$((port+nodes))\n\n# ...\n\nif [ "$1" == "start" ]\nthen\n    while [ $((port < endport)) != "0" ]; do\n        port=$((port+1))\n        echo "starting $port"\n        /usr/local/redis/src/redis-server /usr/local/redis/conf/${port}/redis.conf\n    done\n    exit 0\nfi\n\n\nå¥½äºï¼å¨æ¯å°æå¡å¨ä¸ï¼é½æ§è¡ ./create-cluster start æ¥å¯å¨èç¹ã\n\nç¶åï¼éè¿ ps å½ä»¤æ¥ç¡®è®¤ redis è¿ç¨æ¯å¦å·²ç»å·¥ä½ï¼\n\n# root @ dbclusterdev01 in /usr/local/redis/conf [11:07:55]\n$ ps -ef | grep redis\nroot      4604     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7001 [cluster]\nroot      4609     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7002 [cluster]\nroot      4614     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7003 [cluster]\nroot      4619     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7004 [cluster]\nroot      4624     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7005 [cluster]\nroot      4629     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7006 [cluster]\n\n\nï¼4ï¼å¯å¨éç¾¤\n\néè¿ redis-cli --cluster create å½ä»¤å¯ä»¥èªå¨éç½®éç¾¤ï¼å¦ä¸ï¼\n\n./redis-cli --cluster create 127.0.0.1:7001 127.0.0.1:7002 127.0.0.2:7003 127.0.0.2:7004 127.0.0.3:7005 127.0.0.3:7006 --cluster-replicas 1\n\n\nredis-cluster ä¼æ ¹æ®è®¾ç½®çèç¹æ°åå¯æ¬æ°èªå¨åçï¼åé hash èææ§½ slotï¼ï¼å¦ææ»¡æï¼è¾å¥ yes ï¼ç´æ¥å¼å§åçã\n\n>>> performing hash slots allocation on 6 nodes...\nmaster[0] -> slots 0 - 5460\nmaster[1] -> slots 5461 - 10922\nmaster[2] -> slots 10923 - 16383\nadding replica 127.0.0.2:7004 to 127.0.0.1:7001\nadding replica 127.0.0.3:7006 to 127.0.0.2:7003\nadding replica 127.0.0.1:7002 to 127.0.0.3:7005\nm: b721235997deb6b9a7a2be690b5b9663db8057c6 127.0.0.1:7001\n   slots:[0-5460] (5461 slots) master\ns: bda9b7036df0bbefe601bda4ce45d3787a2e9bd9 127.0.0.1:7002\n   replicates 3623fff69b5243ed18c02a2fbb6f53069b0f1505\nm: 91523c0391a044da6cc9f53bb965aabe89502187 127.0.0.2:7003\n   slots:[5461-10922] (5462 slots) master\ns: 9d899cbe49dead7b8c4f769920cdb75714a441ae 127.0.0.2:7004\n   replicates b721235997deb6b9a7a2be690b5b9663db8057c6\nm: 3623fff69b5243ed18c02a2fbb6f53069b0f1505 127.0.0.3:7005\n   slots:[10923-16383] (5461 slots) master\ns: a2869dc153ea4977ca790b76483574a5d56cb40e 127.0.0.3:7006\n   replicates 91523c0391a044da6cc9f53bb965aabe89502187\ncan i set the above configuration? (type \'yes\' to accept): yes\n>>> nodes configuration updated\n>>> assign a different config epoch to each node\n>>> sending cluster meet messages to join the cluster\nwaiting for the cluster to join\n....\n>>> performing cluster check (using node 127.0.0.1:7001)\nm: b721235997deb6b9a7a2be690b5b9663db8057c6 127.0.0.1:7001\n   slots:[0-5460] (5461 slots) master\n   1 additional replica(s)\ns: a2869dc153ea4977ca790b76483574a5d56cb40e 127.0.0.1:7006\n   slots: (0 slots) slave\n   replicates 91523c0391a044da6cc9f53bb965aabe89502187\nm: 91523c0391a044da6cc9f53bb965aabe89502187 127.0.0.1:7003\n   slots:[5461-10922] (5462 slots) master\n   1 additional replica(s)\nm: 3623fff69b5243ed18c02a2fbb6f53069b0f1505 127.0.0.1:7005\n   slots:[10923-16383] (5461 slots) master\n   1 additional replica(s)\ns: 9d899cbe49dead7b8c4f769920cdb75714a441ae 127.0.0.1:7004\n   slots: (0 slots) slave\n   replicates b721235997deb6b9a7a2be690b5b9663db8057c6\ns: bda9b7036df0bbefe601bda4ce45d3787a2e9bd9 127.0.0.1:7002\n   slots: (0 slots) slave\n   replicates 3623fff69b5243ed18c02a2fbb6f53069b0f1505\n[ok] all nodes agree about slots configuration.\n>>> check for open slots...\n>>> check slots coverage...\n[ok] all 16384 slots covered.\n\n\nï¼5ï¼æ¥å¸¸ç»´æ¤æä½\n\n * å³é­éç¾¤ - ./create-cluster stop\n * æ£æ¥éç¾¤æ¯å¦å¥åº·ï¼æå®ä»»æèç¹å³å¯ï¼ï¼./redis-cli --cluster check <ip:port>\n * å°è¯ä¿®å¤éç¾¤èç¹ï¼./redis-cli --cluster fix <ip:port>\n\n\n# é¨ç½²å¨åµ\n\nredis-cluster å®ç°äº redis çåçãå¤å¶ã\n\nä½ redis-cluster æ²¡æè§£å³æéè½¬ç§»é®é¢ï¼ä¸æ¦ä»»æåçç master èç¹å®æºãç½ç»ä¸éï¼å°±ä¼å¯¼è´ redis-cluster çéç¾¤ä¸è½å·¥ä½ãä¸ºäºè§£å³é«å¯ç¨çé®é¢ï¼redis æä¾äº redis å¨åµæ¥çæ§ redis èç¹ç¶æï¼å¹¶ä¸ä¼å¨ master å®æºæ¶ï¼åèµ·éä¸¾ï¼å°è¿ä¸ª master çä¸ä¸ª slave èç¹éä¸¾ä¸º masterã\n\nï¼1ï¼åå»ºèç¹ç®å½\n\næä¸ªäººåå¥½å°è½¯ä»¶æ¾å¨ /opt ç®å½ä¸ï¼å¨æçæºå¨ä¸­ï¼redis é½å®è£å¨ /usr/local/redis ç®å½ä¸ãæä»¥ï¼ä¸é¢çå½ä»¤åéç½®é½åè®¾ redis å®è£ç®å½ä¸º /usr/local/redis ã\n\nç¡®ä¿æºå¨ä¸å·²ç»å®è£äº redis åï¼æ§è¡ä»¥ä¸å½ä»¤ï¼åå»º redis éç¾¤èç¹å®ä¾ç®å½ï¼\n\nsudo mkdir -p /usr/local/redis/conf/27001\nsudo mkdir -p /usr/local/redis/conf/27002\nsudo mkdir -p /usr/local/redis/conf/27003\n\n\nï¼2ï¼éç½®éç¾¤èç¹\n\næ¯ä¸ªå®ä¾ç®å½ä¸ï¼æ°å»º redis.conf éç½®æä»¶ã\n\nå®ä¾éç½®æ¨¡æ¿ä»¥ 7001 èç¹ä¸ºä¾ï¼å¶ä»èç¹ï¼å®å¨æ¿æ¢éç½®ä¸­çç«¯å£å· 7001 å³å¯ï¼ï¼å¦ä¸ï¼\n\nport 27001\ndaemonize yes\nsentinel monitor redis-master 172.22.6.3 7001 2\nsentinel down-after-milliseconds redis-master 5000\nsentinel failover-timeout redis-master 900000\nsentinel parallel-syncs redis-master 1\n#sentinel auth-pass redis-master 123456\nlogfile /usr/local/redis/conf/27001/27001.log\n\n\nï¼3ï¼æ¹éå¯å¨å¨åµèç¹\n\n/opt/redis/src/redis-sentinel /usr/local/redis/conf/27001/sentinel.conf\n/opt/redis/src/redis-sentinel /usr/local/redis/conf/27002/sentinel.conf\n/opt/redis/src/redis-sentinel /usr/local/redis/conf/27003/sentinel.conf\n\n\n\n# æ©å®¹\n\nï¼1ï¼æ¥çä¿¡æ¯\n\nè¿å¥ä»»æèç¹\n\n./redis-cli -h 172.22.6.3 -p 7001\n\n\ncluster info æ¥çéç¾¤èç¹ç¶æ\n\n172.22.6.3:7001> cluster nodes\nf158bf70bb2767cac271ce4efcfc14ba0b7ca98b 172.22.6.3:7006@17006 slave e7aa182e756b76ec85b471797db9b66e4b2da725 0 1594528179000 6 connected\nf348e67648460c7a800120d69b4977bf2e4524cb 172.22.6.3:7001@17001 myself,master - 0 1594528179000 1 connected 0-5460\n52601e2d4af0e64b83f4cc6d20e8316d0ac38b99 172.22.6.3:7004@17004 slave 4802fafe897160c46392c6e569d6f5e466cca696 0 1594528178000 4 connected\nc6c6a68674ae8aac3c6ec792c8af4dc1228c6c31 172.22.6.3:7005@17005 slave f348e67648460c7a800120d69b4977bf2e4524cb 0 1594528179852 5 connected\ne7aa182e756b76ec85b471797db9b66e4b2da725 172.22.6.3:7002@17002 master - 0 1594528178000 2 connected 5461-10922\n4802fafe897160c46392c6e569d6f5e466cca696 172.22.6.3:7003@17003 master - 0 1594528178000 3 connected 10923-16383\n\n\ncluster info æ¥çéç¾¤ä¿¡æ¯\n\n172.22.6.3:7001> cluster info\ncluster_state:ok\ncluster_slots_assigned:16384\ncluster_slots_ok:16384\ncluster_slots_pfail:0\ncluster_slots_fail:0\ncluster_known_nodes:6\ncluster_size:3\ncluster_current_epoch:6\ncluster_my_epoch:1\ncluster_stats_messages_ping_sent:3406\ncluster_stats_messages_pong_sent:3569\ncluster_stats_messages_publish_sent:5035\ncluster_stats_messages_sent:12010\ncluster_stats_messages_ping_received:3564\ncluster_stats_messages_pong_received:3406\ncluster_stats_messages_meet_received:5\ncluster_stats_messages_publish_received:5033\ncluster_stats_messages_received:12008\n\n\nï¼2ï¼æ·»å èç¹å°éç¾¤\n\nå°å·²å¯å¨çèç¹å®ä¾æ·»å å°éç¾¤ä¸­\n\nredis-cli --cluster add-node 127.0.0.1:7007 127.0.0.1:7008\n\n\næ·»å ä¸»èç¹\n\næ·»å ä¸ç»ä¸»èç¹\n\n./redis-cli --cluster add-node 172.22.6.3:7007 172.22.6.3:7001\n./redis-cli --cluster add-node 172.22.6.3:7008 172.22.6.3:7001\n./redis-cli --cluster add-node 172.22.6.3:7009 172.22.6.3:7001\n\n\næ¥çèç¹ç¶æ\n\n172.22.6.3:7001> cluster nodes\nf158bf70bb2767cac271ce4efcfc14ba0b7ca98b 172.22.6.3:7006@17006 slave e7aa182e756b76ec85b471797db9b66e4b2da725 0 1594529342575 6 connected\nf348e67648460c7a800120d69b4977bf2e4524cb 172.22.6.3:7001@17001 myself,master - 0 1594529340000 1 connected 0-5460\n55cacf121662833a4a19dbeb4a5df712cfedf77f 172.22.6.3:7009@17009 master - 0 1594529342000 0 connected\nc6c6a68674ae8aac3c6ec792c8af4dc1228c6c31 172.22.6.3:7005@17005 slave f348e67648460c7a800120d69b4977bf2e4524cb 0 1594529341573 5 connected\n4802fafe897160c46392c6e569d6f5e466cca696 172.22.6.3:7003@17003 master - 0 1594529343577 3 connected 10923-16383\ne7aa182e756b76ec85b471797db9b66e4b2da725 172.22.6.3:7002@17002 master - 0 1594529342000 2 connected 5461-10922\ne5ba78fe629115977a74fbbe1478caf8868d6d55 172.22.6.3:7007@17007 master - 0 1594529341000 0 connected\n52601e2d4af0e64b83f4cc6d20e8316d0ac38b99 172.22.6.3:7004@17004 slave 4802fafe897160c46392c6e569d6f5e466cca696 0 1594529340000 4 connected\n79d4fffc2cec210556c3b4c44e63ab506e87eda3 172.22.6.3:7008@17008 master - 0 1594529340000 7 connected\n\n\nå¯ä»¥åç°ï¼æ°å å¥çä¸ä¸ªä¸»èç¹ï¼è¿æ²¡æåéåå¸æ§½ï¼æä»¥ï¼ææ¶è¿æ æ³è®¿é®ã\n\næ·»å ä»èç¹\n\n--slaveï¼è®¾ç½®è¯¥åæ°ï¼åæ°èç¹ä»¥ slave çè§è²å å¥éç¾¤\n--master-idï¼è¿ä¸ªåæ°éè¦è®¾ç½®äº--slave æè½çæï¼--master-id ç¨æ¥æå®æ°èç¹ç master èç¹ãå¦æä¸è®¾ç½®è¯¥åæ°ï¼åä¼éæºä¸ºèç¹éæ© master èç¹ã\n\nè¯­æ³\n\nredis-cli --cluster add-node  æ°èç¹ipå°åï¼ç«¯å£    å­å¨èç¹ipï¼ç«¯å£ --cluster-slave ï¼ä»èç¹ï¼ --cluster-master-id ï¼masterèç¹çidï¼\nredis-cli --cluster add-node   10.42.141.119:6379  10.42.166.105:6379  --cluster-slave   --cluster-master-id  dfa238fff8a7a49230cff7eb74f573f5645c8ec5\n\n\nç¤ºä¾\n\n./redis-cli --cluster add-node 172.22.6.3:7010 172.22.6.3:7007 --cluster-slave\n./redis-cli --cluster add-node 172.22.6.3:7011 172.22.6.3:7008 --cluster-slave\n./redis-cli --cluster add-node 172.22.6.3:7012 172.22.6.3:7009 --cluster-slave\n\n\næ¥çç¶æ\n\n172.22.6.3:7001> cluster nodes\nef5c1b9ce4cc795dc12b2c1e8736a572647b4c3e 172.22.6.3:7011@17011 slave 79d4fffc2cec210556c3b4c44e63ab506e87eda3 0 1594529492043 7 connected\nf158bf70bb2767cac271ce4efcfc14ba0b7ca98b 172.22.6.3:7006@17006 slave e7aa182e756b76ec85b471797db9b66e4b2da725 0 1594529491943 6 connected\nf348e67648460c7a800120d69b4977bf2e4524cb 172.22.6.3:7001@17001 myself,master - 0 1594529488000 1 connected 0-5460\n5140d1129ed850df59c51cf818c4eb74545d9959 172.22.6.3:7010@17010 slave e5ba78fe629115977a74fbbe1478caf8868d6d55 0 1594529488000 0 connected\n55cacf121662833a4a19dbeb4a5df712cfedf77f 172.22.6.3:7009@17009 master - 0 1594529488000 8 connected\nc6c6a68674ae8aac3c6ec792c8af4dc1228c6c31 172.22.6.3:7005@17005 slave f348e67648460c7a800120d69b4977bf2e4524cb 0 1594529490000 5 connected\n4802fafe897160c46392c6e569d6f5e466cca696 172.22.6.3:7003@17003 master - 0 1594529489939 3 connected 10923-16383\ne7aa182e756b76ec85b471797db9b66e4b2da725 172.22.6.3:7002@17002 master - 0 1594529491000 2 connected 5461-10922\ne5ba78fe629115977a74fbbe1478caf8868d6d55 172.22.6.3:7007@17007 master - 0 1594529490942 0 connected\n52601e2d4af0e64b83f4cc6d20e8316d0ac38b99 172.22.6.3:7004@17004 slave 4802fafe897160c46392c6e569d6f5e466cca696 0 1594529491000 4 connected\n02e9f57b5b45c350dc57acf1c8efa8db136db7b7 172.22.6.3:7012@17012 master - 0 1594529489000 0 connected\n79d4fffc2cec210556c3b4c44e63ab506e87eda3 172.22.6.3:7008@17008 master - 0 1594529489000 7 connected\n\n\nåéåå¸æ§½\n\næ§è¡ ./redis-cli --cluster rebalance 172.22.6.3:7001 --cluster-threshold 1 --cluster-use-empty-masters\n\nåæ°è¯´æï¼\n\nrebalanceï¼è¡¨æè®© redis èªå¨æ ¹æ®èç¹æ°è¿è¡åè¡¡åå¸æ§½åéã\n\n--cluster-use-empty-mastersï¼è¡¨æ\n\n\n\næ§è¡ç»æåï¼æ¥çç¶æï¼\n\n\n\n\n# åãredis å½ä»¤\n\n\n# éç¨å½ä»¤\n\n> å½ä»¤è¯¦ç»ç¨æ³ï¼è¯·åè redis å½ä»¤å®æ¹ææ¡£\n> \n> æ¬è¿ä¸¤å¼  cheat sheet å¾ï¼ååï¼https://www.cheatography.com/tasjaevan/cheat-sheets/redis/\n\n\n\n\n\n\n# éç¾¤å½ä»¤\n\n * éç¾¤\n   * cluster info - æå°éç¾¤çä¿¡æ¯\n   * cluster nodes - ååºéç¾¤å½åå·²ç¥çææèç¹ï¼ nodeï¼ï¼ä»¥åè¿äºèç¹çç¸å³ä¿¡æ¯ã\n * èç¹\n   * cluster meet <ip> <port> - å° ip å port ææå®çèç¹æ·»å å°éç¾¤å½ä¸­ï¼è®©å®æä¸ºéç¾¤çä¸ä»½å­ã\n   * cluster forget <node_id> - ä»éç¾¤ä¸­ç§»é¤ node_id æå®çèç¹ã\n   * cluster replicate <node_id> - å°å½åèç¹è®¾ç½®ä¸º node_id æå®çèç¹çä»èç¹ã\n   * cluster saveconfig - å°èç¹çéç½®æä»¶ä¿å­å°ç¡¬çéé¢ã\n * æ§½(slot)\n   * cluster addslots <slot> [slot ...] - å°ä¸ä¸ªæå¤ä¸ªæ§½ï¼ slotï¼ææ´¾ï¼ assignï¼ç»å½åèç¹ã\n   * cluster delslots <slot> [slot ...] - ç§»é¤ä¸ä¸ªæå¤ä¸ªæ§½å¯¹å½åèç¹çææ´¾ã\n   * cluster flushslots - ç§»é¤ææ´¾ç»å½åèç¹çæææ§½ï¼è®©å½åèç¹åæä¸ä¸ªæ²¡æææ´¾ä»»ä½æ§½çèç¹ã\n   * cluster setslot <slot> node <node_id> - å°æ§½ slot ææ´¾ç» node_id æå®çèç¹ï¼å¦ææ§½å·²ç»ææ´¾ç»å¦ä¸ä¸ªèç¹ï¼é£ä¹åè®©å¦ä¸ä¸ªèç¹å é¤è¯¥æ§½>ï¼ç¶ååè¿è¡ææ´¾ã\n   * cluster setslot <slot> migrating <node_id> - å°æ¬èç¹çæ§½ slot è¿ç§»å° node_id æå®çèç¹ä¸­ã\n   * cluster setslot <slot> importing <node_id> - ä» node_id æå®çèç¹ä¸­å¯¼å¥æ§½ slot å°æ¬èç¹ã\n   * cluster setslot <slot> stable - åæ¶å¯¹æ§½ slot çå¯¼å¥ï¼ importï¼æèè¿ç§»ï¼ migrateï¼ã\n * é®\n   * cluster keyslot <key> - è®¡ç®é® key åºè¯¥è¢«æ¾ç½®å¨åªä¸ªæ§½ä¸ã\n   * cluster countkeysinslot <slot> - è¿åæ§½ slot ç®ååå«çé®å¼å¯¹æ°éã\n   * cluster getkeysinslot <slot> <count> - è¿å count ä¸ª slot æ§½ä¸­çé®ã\n\n# éæ°åç\n\næ·»å èç¹ï¼./redis-cli --cluster add-node 192.168.1.136:7007 192.168.1.136:7001 --cluster-slave\n\nredis-cli --cluster reshard 172.22.6.3 7001\n\n\n# äºãå®¢æ·ç«¯\n\næ¨èä½¿ç¨ redisdesktopmanager\n\n\n# åèèµæ\n\n * å®ç½\n   * redis å®ç½\n   * redis github\n   * redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãredis å®æã\n   * ãredis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * redis å½ä»¤åè\n * æç« \n   * æ·±å¥åæ redis ç³»å(ä¸) - redis éç¾¤æ¨¡å¼æ­å»ºä¸åçè¯¦è§£',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Redis éç¾¤",frontmatter:{title:"Redis éç¾¤",date:"2020-06-24T10:45:38.000Z",categories:["æ°æ®åº","KVæ°æ®åº","Redis"],tags:["æ°æ®åº","KVæ°æ®åº","Redis","éç¾¤"],permalink:"/pages/77dfbe/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/05.KV%E6%95%B0%E6%8D%AE%E5%BA%93/01.Redis/07.Redis%E9%9B%86%E7%BE%A4.html",relativePath:"12.æ°æ®åº/05.KVæ°æ®åº/01.Redis/07.Rediséç¾¤.md",key:"v-5b5c3224",path:"/pages/77dfbe/",headers:[{level:2,title:"1. Redis Cluster ååº",slug:"_1-redis-cluster-ååº",normalizedTitle:"1. redis cluster ååº",charIndex:320},{level:3,title:"1.1. éç¾¤èç¹",slug:"_1-1-éç¾¤èç¹",normalizedTitle:"1.1. éç¾¤èç¹",charIndex:344},{level:3,title:"1.2. åé Hash æ§½",slug:"_1-2-åé-hash-æ§½",normalizedTitle:"1.2. åé hash æ§½",charIndex:639},{level:3,title:"1.3. å¯»å",slug:"_1-3-å¯»å",normalizedTitle:"1.3. å¯»å",charIndex:1104},{level:4,title:"1.3.1. è®¡ç®é®å±äºåªä¸ªæ§½",slug:"_1-3-1-è®¡ç®é®å±äºåªä¸ªæ§½",normalizedTitle:"1.3.1. è®¡ç®é®å±äºåªä¸ªæ§½",charIndex:1274},{level:4,title:"1.3.2. MOVED éè¯¯",slug:"_1-3-2-moved-éè¯¯",normalizedTitle:"1.3.2. moved éè¯¯",charIndex:1470},{level:3,title:"1.4. éæ°ååº",slug:"_1-4-éæ°ååº",normalizedTitle:"1.4. éæ°ååº",charIndex:1631},{level:3,title:"1.5. ASK éè¯¯",slug:"_1-5-ask-éè¯¯",normalizedTitle:"1.5. ask éè¯¯",charIndex:1888},{level:2,title:"2. Redis Cluster æéè½¬ç§»",slug:"_2-redis-cluster-æéè½¬ç§»",normalizedTitle:"2. redis cluster æéè½¬ç§»",charIndex:2129},{level:3,title:"2.1. å¤å¶",slug:"_2-1-å¤å¶",normalizedTitle:"2.1. å¤å¶",charIndex:2155},{level:3,title:"2.2. æéæ£æµ",slug:"_2-2-æéæ£æµ",normalizedTitle:"2.2. æéæ£æµ",charIndex:2192},{level:3,title:"2.3. æéè½¬ç§»",slug:"_2-3-æéè½¬ç§»",normalizedTitle:"2.3. æéè½¬ç§»",charIndex:2332},{level:3,title:"2.4. éä¸¾æ°çä¸»èç¹",slug:"_2-4-éä¸¾æ°çä¸»èç¹",normalizedTitle:"2.4. éä¸¾æ°çä¸»èç¹",charIndex:2502},{level:2,title:"3. Redis Cluster éä¿¡",slug:"_3-redis-cluster-éä¿¡",normalizedTitle:"3. redis cluster éä¿¡",charIndex:2549},{level:2,title:"4. Redis Cluster åºç¨",slug:"_4-redis-cluster-åºç¨",normalizedTitle:"4. redis cluster åºç¨",charIndex:2998},{level:3,title:"4.1. éç¾¤åè½éå¶",slug:"_4-1-éç¾¤åè½éå¶",normalizedTitle:"4.1. éç¾¤åè½éå¶",charIndex:3022},{level:3,title:"4.2. éç¾¤è§æ¨¡éå¶",slug:"_4-2-éç¾¤è§æ¨¡éå¶",normalizedTitle:"4.2. éç¾¤è§æ¨¡éå¶",charIndex:3464},{level:3,title:"4.3. éç¾¤éç½®",slug:"_4-3-éç¾¤éç½®",normalizedTitle:"4.3. éç¾¤éç½®",charIndex:3887},{level:2,title:"5. å¶ä» Redis éç¾¤æ¹æ¡",slug:"_5-å¶ä»-redis-éç¾¤æ¹æ¡",normalizedTitle:"5. å¶ä» redis éç¾¤æ¹æ¡",charIndex:4968},{level:3,title:"5.1. å®¢æ·ç«¯ååºæ¹æ¡",slug:"_5-1-å®¢æ·ç«¯ååºæ¹æ¡",normalizedTitle:"5.1. å®¢æ·ç«¯ååºæ¹æ¡",charIndex:5088},{level:3,title:"5.2. ä»£çååºæ¹æ¡",slug:"_5-2-ä»£çååºæ¹æ¡",normalizedTitle:"5.2. ä»£çååºæ¹æ¡",charIndex:5523},{level:4,title:"5.2.1. Twemproxy",slug:"_5-2-1-twemproxy",normalizedTitle:"5.2.1. twemproxy",charIndex:5718},{level:4,title:"5.2.2. Codis",slug:"_5-2-2-codis",normalizedTitle:"5.2.2. codis",charIndex:6004},{level:3,title:"5.3. æ¥è¯¢è·¯ç±æ¹æ¡",slug:"_5-3-æ¥è¯¢è·¯ç±æ¹æ¡",normalizedTitle:"5.3. æ¥è¯¢è·¯ç±æ¹æ¡",charIndex:6322},{level:2,title:"6. åèèµæ",slug:"_6-åèèµæ",normalizedTitle:"6. åèèµæ",charIndex:6766}],headersStr:"1. Redis Cluster ååº 1.1. éç¾¤èç¹ 1.2. åé Hash æ§½ 1.3. å¯»å 1.3.1. è®¡ç®é®å±äºåªä¸ªæ§½ 1.3.2. MOVED éè¯¯ 1.4. éæ°ååº 1.5. ASK éè¯¯ 2. Redis Cluster æéè½¬ç§» 2.1. å¤å¶ 2.2. æéæ£æµ 2.3. æéè½¬ç§» 2.4. éä¸¾æ°çä¸»èç¹ 3. Redis Cluster éä¿¡ 4. Redis Cluster åºç¨ 4.1. éç¾¤åè½éå¶ 4.2. éç¾¤è§æ¨¡éå¶ 4.3. éç¾¤éç½® 5. å¶ä» Redis éç¾¤æ¹æ¡ 5.1. å®¢æ·ç«¯ååºæ¹æ¡ 5.2. ä»£çååºæ¹æ¡ 5.2.1. Twemproxy 5.2.2. Codis 5.3. æ¥è¯¢è·¯ç±æ¹æ¡ 6. åèèµæ",content:"# Redis éç¾¤\n\n> Redis éç¾¤ï¼Redis Clusterï¼ æ¯ Redis å®æ¹æä¾çåå¸å¼æ°æ®åºæ¹æ¡ã\n> \n> æ¢ç¶æ¯åå¸å¼ï¼èªç¶å·å¤åå¸å¼ç³»ç»çåºæ¬ç¹æ§ï¼å¯æ©å±ãé«å¯ç¨ãä¸è´æ§ã\n> \n>  * Redis éç¾¤éè¿åå hash æ§½æ¥ååºï¼è¿è¡æ°æ®åäº«ã\n>  * Redis éç¾¤éç¨ä¸»ä»æ¨¡åï¼æä¾å¤å¶åæéè½¬ç§»åè½ï¼æ¥ä¿è¯ Redis éç¾¤çé«å¯ç¨ã\n>  * æ ¹æ® CAP çè®ºï¼ConsistencyãAvailabilityãPartition tolerance ä¸èä¸å¯å¼å¾ï¼è Redis éç¾¤çéæ©æ¯ APãRedis éç¾¤èç¹é´éç¨å¼æ­¥éä¿¡æ¹å¼ï¼ä¸ä¿è¯å¼ºä¸è´æ§ï¼å°½åè¾¾å°æç»ä¸è´æ§ã\n\n\n\n\n# 1. Redis Cluster ååº\n\n\n# 1.1. éç¾¤èç¹\n\nRedis éç¾¤ç±å¤ä¸ªèç¹ç»æï¼èç¹åå¯å¨æ¶ï¼å½¼æ­¤æ¯ç¸äºç¬ç«çãèç¹éè¿æ¡æï¼ CLUSTER MEET å½ä»¤ï¼æ¥å°å¶ä»èç¹æ·»å å°èªå·±æå¤çéç¾¤ä¸­ã\n\nåä¸ä¸ªèç¹åé CLUSTER MEET å½ä»¤ï¼å¯ä»¥è®©å½åèç¹ä¸æå® IPãPORT çèç¹è¿è¡æ¡æï¼æ¡ææåæ¶ï¼å½åèç¹ä¼å°æå®èç¹å å¥æå¨éç¾¤ã\n\néç¾¤èç¹ä¿å­é®å¼å¯¹ä»¥åè¿ææ¶é´çæ¹å¼ä¸åæº Redis æå¡å®å¨ç¸åã\n\nRedis éç¾¤èç¹åä¸ºä¸»èç¹ï¼masterï¼åä»èç¹ï¼slaveï¼ï¼å¶ä¸­ä¸»èç¹ç¨äºå¤çæ§½ï¼èä»èç¹åç¨äºå¤å¶æä¸ªä¸»èç¹ï¼å¹¶å¨è¢«å¤å¶çä¸»èç¹ä¸çº¿æ¶ï¼ä»£æ¿ä¸çº¿ä¸»èç¹ç»§ç»­å¤çå½ä»¤è¯·æ±ã\n\n\n# 1.2. åé Hash æ§½\n\nåå¸å¼å­å¨éè¦è§£å³çé¦è¦é®é¢æ¯æ æ´ä¸ªæ°æ®é æç§ ååºè§å æ å°å° å¤ä¸ªèç¹ çé®é¢ï¼å³æ æ°æ®é ååå° å¤ä¸ªèç¹ ä¸ï¼æ¯ä¸ªèç¹è´è´£ æ´ä½æ°æ® çä¸ä¸ª å­éã\n\nRedis éç¾¤éè¿åå hash æ§½æ¥å°æ°æ®ååºãRedis éç¾¤éè¿ååºçæ¹å¼æ¥ä¿å­æ°æ®åºçé®å¼å¯¹ï¼éç¾¤çæ´ä¸ªæ°æ®åºè¢«åä¸º 16384 ä¸ªåå¸æ§½ï¼slotï¼ï¼æ°æ®åºä¸­çæ¯ä¸ªé®é½å±äºè¿ 16384 ä¸ªæ§½çå¶ä¸­ä¸ä¸ªï¼éç¾¤ä¸­çæ¯ä¸ªèç¹å¯ä»¥å¤ç 0 ä¸ªææå¤ 16384 ä¸ªæ§½ãå¦ææ°æ®åºä¸­æä»»ä½ä¸ä¸ªæ§½æ²¡æå¾å°å¤çï¼é£ä¹éç¾¤å¤äºä¸çº¿ç¶æã\n\néè¿åèç¹åé CLUSTER ADDSLOTS å½ä»¤ï¼å¯ä»¥å°ä¸ä¸ªæå¤ä¸ªæ§½ææ´¾ç»èç¹è´è´£ã\n\n> CLUSTER ADDSLOTS 1 2 3\nOK\n\n\néç¾¤ä¸­çæ¯ä¸ªèç¹è´è´£ä¸é¨ååå¸æ§½ï¼æ¯å¦éç¾¤ä¸­æï¼ä¸ªèç¹ï¼åï¼\n\n * èç¹ï¼¡å­å¨çåå¸æ§½èå´æ¯ï¼0 â 5500\n * èç¹ï¼¢å­å¨çåå¸æ§½èå´æ¯ï¼5501 â 11000\n * èç¹ï¼£å­å¨çåå¸æ§½èå´æ¯ï¼11001 â 16384\n\n\n# 1.3. å¯»å\n\nå½å®¢æ·ç«¯åèç¹åéä¸æ°æ®åºé®æå³çå½ä»¤æ¶ï¼æ¥åå½ä»¤çèç¹ä¼è®¡ç®åºå½ä»¤è¦å¤ççæ°æ®åºå±äºåªä¸ªæ§½ï¼å¹¶æ£æ¥è¿ä¸ªæ§½æ¯å¦ææ´¾ç»äºèªå·±ï¼\n\n * å¦æé®æå¨çæ§½æ­£å¥½ææ´¾ç»äºå½åèç¹ï¼é£ä¹å½åèç¹ç´æ¥æ§è¡å½ä»¤ã\n * å¦æé®æå¨çæ§½æ²¡æææ´¾ç»å½åèç¹ï¼é£ä¹èç¹ä¼åå®¢æ·ç«¯è¿åä¸ä¸ª MOVED éè¯¯ï¼æå¼å®¢æ·ç«¯éå®åè³æ­£ç¡®çèç¹ã\n\n# 1.3.1. è®¡ç®é®å±äºåªä¸ªæ§½\n\nå³å®ä¸ä¸ª key åºè¯¥åéå°é£ä¸ªæ§½çç®æ³æ¯ï¼è®¡ç®è¯¥ key ç CRC16 ç»æåæ¨¡ 16834ã\n\nHASH_SLOT = CRC16(KEY) mod 16384\n\n\nå½èç¹è®¡ç®åº key æå±çæ§½ä¸º i ä¹åï¼èç¹ä¼æ ¹æ®ä»¥ä¸æ¡ä»¶å¤æ­æ§½æ¯å¦ç±èªå·±è´è´£ï¼\n\nclusterState.slots[i] == clusterState.myself\n\n\n# 1.3.2. MOVED éè¯¯\n\nå½èç¹åç°é®æå¨çæ§½å¹¶éèªå·±è´è´£å¤ççæ¶åï¼èç¹å°±ä¼åå®¢æ·ç«¯è¿åä¸ä¸ª MOVED éè¯¯ï¼æå¼å®¢æ·ç«¯è½¬åæ­£å¨è´è´£æ§½çèç¹ã\n\nMOVED éè¯¯çæ ¼å¼ä¸ºï¼\n\nMOVED <slot> <ip>:<port>\n\n\n> ä¸ªäººçè§£ï¼MOVED è¿ç§æä½æç¹ç±»ä¼¼ HTTP åè®®ä¸­çéå®åã\n\n\n# 1.4. éæ°ååº\n\nRedis éç¾¤çéæ°ååºæä½å¯ä»¥å°ä»»ææ°éçå·²ç»ææ´¾ç»æä¸ªèç¹ï¼æºèç¹ï¼çæ§½æ¹ä¸ºææ´¾ç»å¦ä¸ä¸ªèç¹ï¼ç®æ èç¹ï¼ï¼å¹¶ä¸ç¸å³æ§½æå±çé®å¼å¯¹ä¹ä¼ä»æºèç¹è¢«ç§»å¨å°ç®æ èç¹ã\n\néæ°ååºæä½å¯ä»¥å¨çº¿è¿è¡ï¼å¨éæ°ååºçè¿ç¨ä¸­ï¼éç¾¤ä¸éè¦ä¸çº¿ï¼å¹¶ä¸æºèç¹åç®æ èç¹é½å¯ä»¥ç»§ç»­å¤çå½ä»¤è¯·æ±ã\n\nRedis éç¾¤çéæ°ååºæä½ç± Redis éç¾¤ç®¡çè½¯ä»¶ redis-trib è´è´£æ§è¡çï¼redis-trib éè¿åæºèç¹åç®æ èç¹åéå½ä»¤æ¥è¿è¡éæ°ååºæä½ã\n\néæ°ååºçå®ç°åçå¦ä¸å¾æç¤ºï¼\n\n\n\n\n# 1.5. ASK éè¯¯\n\nASK éè¯¯ä¸ MOVED çåºå«å¨äºï¼ASK éè¯¯åªæ¯ä¸¤ä¸ªèç¹å¨è¿ç§»æ§½çè¿ç¨ä¸­ä½¿ç¨çä¸ç§ä¸´æ¶æªæ½ï¼å¨å®¢æ·ç«¯æ¶å°å³äºæ§½ X ç ASK éè¯¯ä¹åï¼å®¢æ·ç«¯åªä¼å¨æ¥ä¸æ¥çä¸æ¬¡å½ä»¤è¯·æ±ä¸­å°å³äºæ§½ X çå½ä»¤è¯·æ±åéè³ ASK éè¯¯ææç¤ºçèç¹ï¼ä½è¿ç§è½¬åä¸ä¼å¯¹å®¢æ·ç«¯ä»ååéå³äºæ§½ X çå½ä»¤è¯·æ±äº§çä»»ä½å½±åï¼å®¢æ·ç«¯ä»ç¶ä¼å°å³äºæ§½ X çå½ä»¤è¯·æ±åéè³ç®åè´è´£å¤çæ§½ X çèç¹ï¼é¤é ASK éè¯¯åæ¬¡åºç°ã\n\nå¤æ­ ASK éè¯¯çè¿ç¨å¦ä¸å¾æç¤ºï¼\n\n\n\n\n# 2. Redis Cluster æéè½¬ç§»\n\n\n# 2.1. å¤å¶\n\nRedis å¤å¶æºå¶å¯ä»¥åèï¼Redis å¤å¶\n\n\n# 2.2. æéæ£æµ\n\néç¾¤ä¸­æ¯ä¸ªèç¹é½ä¼å®æåéç¾¤ä¸­çå¶ä»èç¹åé PING æ¶æ¯ï¼ä»¥æ­¤æ¥æ£æµå¯¹æ¹æ¯å¦å¨çº¿ã\n\nèç¹çç¶æä¿¡æ¯å¯ä»¥åä¸ºï¼\n\n * å¨çº¿ç¶æï¼\n\n * ä¸çº¿ç¶æï¼FAILï¼;\n\n * çä¼¼ä¸çº¿ç¶æï¼PFAILï¼ï¼å³å¨è§å®çæ¶é´åï¼æ²¡æåºç­ PING æ¶æ¯ï¼\n\n\n# 2.3. æéè½¬ç§»\n\n 1. ä¸çº¿ä¸»èç¹çææä»èç¹ä¸­ï¼ä¼æä¸ä¸ªä»èç¹è¢«éä¸­ã\n 2. è¢«éä¸­çä»èç¹ä¼æ§è¡ SLAVEOF no one å½ä»¤ï¼æä¸ºæ°çä¸»èç¹ã\n 3. æ°çä¸»èç¹ä¼æ¤éææå¯¹å·²ä¸çº¿ä¸»èç¹çæ§½ææ´¾ï¼å¹¶å°è¿äºæ§½å¨é¨ææ´¾ç»èªå·±ã\n 4. æ°çä¸»èç¹åéç¾¤å¹¿æ­ä¸æ¡ PONG æ¶æ¯ï¼åç¥å¶ä»èç¹è¿ä¸ªä»èç¹å·²åæä¸»èç¹ã\n\n\n# 2.4. éä¸¾æ°çä¸»èç¹\n\nRedis éç¾¤éä¸¾æ°çä¸»èç¹æµç¨åºäºå±è¯ç®æ³ï¼Raft\n\n\n# 3. Redis Cluster éä¿¡\n\néç¾¤ä¸­çèç¹éè¿åéåæ¥æ¶æ¶æ¯æ¥è¿è¡éä¿¡ã\n\nRedis éç¾¤èç¹åéçæ¶æ¯ä¸»è¦æä»¥ä¸äºç§ï¼\n\n * MEET - è¯·æ±æ¥æ¶æ¹å å¥åéæ¹æå¨çéç¾¤ã\n * PING - éç¾¤ä¸­æ¯ä¸ªèç¹æ¯éä¸æ®µæ¶é´ï¼é»è®¤ä¸ºä¸ç§ï¼ä»å·²ç¥èç¹åè¡¨ä¸­éæºéåºäºä¸ªèç¹ï¼ç¶åå¯¹è¿äºä¸ªèç¹ä¸­æä¹æ²¡èç³»çèç¹åé PING æ¶æ¯ï¼ä»¥æ­¤æ£æµè¢«éä¸­çèç¹æ¯å¦å¨çº¿ã\n * PONG - å½æ¥æ¶æ¹æ¶å°åéæ¹åæ¥ç MEET æ¶æ¯æ PING æ¶æ¯æ¶ï¼ä¼è¿åä¸æ¡ PONG æ¶æ¯ä½ä¸ºåºç­ã\n * FAIL - å½ä¸ä¸ªä¸»èç¹ A å¤æ­å¦ä¸ä¸ªä¸»èç¹ B å·²ç»è¿å¥ FAIL ç¶ææ¶ï¼èç¹ A ä¼åéç¾¤å¹¿æ­ä¸æ¡å³äºèç¹ B ç FAIL æ¶æ¯ï¼æææ¶å°è¿æ¡æ¶æ¯çèç¹é½ä¼ç«å³å°èç¹ B æ è®°ä¸ºå·²ä¸çº¿ã\n * PUBLISH - å½èç¹æ¶å°ä¸ä¸ª PUBLISH å½ä»¤æ¶ï¼èç¹ä¼æ§è¡è¿ä¸ªå½ä»¤ï¼å¹¶åéç¾¤å¹¿æ­ä¸æ¡ PUBLISH æ¶æ¯ï¼æææ¥åå°è¿æ¡æ¶æ¯çèç¹é½ä¼æ§è¡ç¸åç PUBLISH å½ä»¤ã\n\n\n# 4. Redis Cluster åºç¨\n\n\n# 4.1. éç¾¤åè½éå¶\n\nRedis éç¾¤ç¸å¯¹ åæºï¼å­å¨ä¸äºåè½éå¶ï¼éè¦ å¼åäººå æåäºè§£ï¼å¨ä½¿ç¨æ¶åå¥½è§é¿ã\n\n * key æ¹éæä½ æ¯ææéï¼ç±»ä¼¼ msetãmget æä½ï¼ç®ååªæ¯æå¯¹å·æç¸å slot å¼ç key æ§è¡ æ¹éæä½ãå¯¹äº æ å°ä¸ºä¸å slot å¼ç key ç±äºæ§è¡ mgetãmget ç­æä½å¯è½å­å¨äºå¤ä¸ªèç¹ä¸ï¼å æ­¤ä¸è¢«æ¯æã\n\n * key äºå¡æä½ æ¯ææéï¼åªæ¯æ å¤ key å¨ åä¸èç¹ä¸ ç äºå¡æä½ï¼å½å¤ä¸ª key åå¸å¨ ä¸å çèç¹ä¸æ¶ æ æ³ ä½¿ç¨äºå¡åè½ã\n\n * key ä½ä¸º æ°æ®ååº çæå°ç²åº¦ï¼ä¸è½å°ä¸ä¸ª å¤§çé®å¼ å¯¹è±¡å¦ hashãlist ç­æ å°å° ä¸åçèç¹ã\n\n * ä¸æ¯æ å¤æ°æ®åºç©ºé´ï¼åæº ä¸ç Redis å¯ä»¥æ¯æ 16 ä¸ªæ°æ®åºï¼db0 ~ db15ï¼ï¼éç¾¤æ¨¡å¼ ä¸åªè½ä½¿ç¨ ä¸ä¸ª æ°æ®åºç©ºé´ï¼å³ db0ã\n\n * å¤å¶ç»æ åªæ¯æä¸å±ï¼ä»èç¹ åªè½å¤å¶ ä¸»èç¹ï¼ä¸æ¯æ åµå¥æ ç¶å¤å¶ ç»æã\n\n\n# 4.2. éç¾¤è§æ¨¡éå¶\n\nRedis Cluster çä¼ç¹æ¯æäºä½¿ç¨ãååºãä¸»ä»å¤å¶ãå¼¹æ§æ©å®¹è¿äºåè½é½å¯ä»¥åå°èªå¨åï¼éè¿ç®åçé¨ç½²å°±å¯ä»¥è·å¾ä¸ä¸ªå¤§å®¹éãé«å¯é ãé«å¯ç¨ç Redis éç¾¤ï¼å¹¶ä¸å¯¹äºåºç¨æ¥è¯´ï¼è¿ä¹äºæ¯éæçã\n\næä»¥ï¼Redis Cluster éå¸¸éåæå»ºä¸­å°è§æ¨¡ Redis éç¾¤ï¼è¿éçä¸­å°è§æ¨¡æçæ¯ï¼å¤§æ¦å ä¸ªå°å åä¸ªèç¹è¿æ ·è§æ¨¡ç Redis éç¾¤ã\n\nä½æ¯ Redis Cluster ä¸å¤ªéåæå»ºè¶å¤§è§æ¨¡éç¾¤ï¼ä¸»è¦åå æ¯ï¼å®éç¨äºå»ä¸­å¿åçè®¾è®¡ã\n\nRedis çæ¯ä¸ªèç¹ä¸ï¼é½ä¿å­äºæææ§½åèç¹çæ å°å³ç³»è¡¨ï¼å®¢æ·ç«¯å¯ä»¥è®¿é®ä»»æä¸ä¸ªèç¹ï¼åéè¿éå®åå½ä»¤ï¼æ¾å°æ°æ®æå¨çé£ä¸ªèç¹ãé£ä¹ï¼è¿ä¸ªæ å°å³ç³»è¡¨æ¯å¦ä½æ´æ°çå¢ï¼Redis Cluster éç¨äºä¸ç§å»ä¸­å¿åçæµè¨ (Gossip) åè®®æ¥ä¼ æ­éç¾¤éç½®çååã\n\nGossip åè®®çä¼ç¹æ¯å»ä¸­å¿åï¼ç¼ºç¹æ¯ä¼ æ­éåº¦æ¢ï¼å¹¶ä¸æ¯éç¾¤è§æ¨¡è¶å¤§ï¼ä¼ æ­çè¶æ¢ã\n\n\n# 4.3. éç¾¤éç½®\n\næä»¬åé¢ä¼é¨ç½²ä¸ä¸ª Redis éç¾¤ä½ä¸ºä¾å­ï¼å¨é£ä¹åï¼åä»ç»ä¸ä¸éç¾¤å¨ redis.conf ä¸­çåæ°ã\n\n * cluster-enabled <yes/no> - å¦æéç½®âyesâåå¼å¯éç¾¤åè½ï¼æ­¤ redis å®ä¾ä½ä¸ºéç¾¤çä¸ä¸ªèç¹ï¼å¦åï¼å®æ¯ä¸ä¸ªæ®éçåä¸ç redis å®ä¾ã\n * cluster-config-file <filename> - æ³¨æï¼è½ç¶æ­¤éç½®çåå­å«âéç¾¤éç½®æä»¶âï¼ä½æ¯æ­¤éç½®æä»¶ä¸è½äººå·¥ç¼è¾ï¼å®æ¯éç¾¤èç¹èªå¨ç»´æ¤çæä»¶ï¼ä¸»è¦ç¨äºè®°å½éç¾¤ä¸­æåªäºèç¹ãä»ä»¬çç¶æä»¥åä¸äºæä¹ååæ°ç­ï¼æ¹ä¾¿å¨éå¯æ¶æ¢å¤è¿äºç¶æãéå¸¸æ¯å¨æ¶å°è¯·æ±ä¹åè¿ä¸ªæä»¶å°±ä¼è¢«æ´æ°ã\n * cluster-node-timeout <milliseconds> - è¿æ¯éç¾¤ä¸­çèç¹è½å¤å¤±èçæå¤§æ¶é´ï¼è¶è¿è¿ä¸ªæ¶é´ï¼è¯¥èç¹å°±ä¼è¢«è®¤ä¸ºæéãå¦æä¸»èç¹è¶è¿è¿ä¸ªæ¶é´è¿æ¯ä¸å¯è¾¾ï¼åç¨å®çä»èç¹å°å¯å¨æéè¿ç§»ï¼åçº§æä¸»èç¹ãæ³¨æï¼ä»»ä½ä¸ä¸ªèç¹å¨è¿ä¸ªæ¶é´ä¹åå¦æè¿æ¯æ²¡æè¿ä¸å¤§é¨åçä¸»èç¹ï¼åæ­¤èç¹å°åæ­¢æ¥æ¶ä»»ä½è¯·æ±ã\n * cluster-slave-validity-factor <factor> - å¦æè®¾ç½®æï¼ï¼åæ è®ºä»èç¹ä¸ä¸»èç¹å¤±èå¤ä¹ï¼ä»èç¹é½ä¼å°è¯åçº§æä¸»èç¹ãå¦æè®¾ç½®ææ­£æ°ï¼å cluster-node-timeout ä¹ä»¥ cluster-slave-validity-factor å¾å°çæ¶é´ï¼æ¯ä»èç¹ä¸ä¸»èç¹å¤±èåï¼æ­¤ä»èç¹æ°æ®ææçæé¿æ¶é´ï¼è¶è¿è¿ä¸ªæ¶é´ï¼ä»èç¹ä¸ä¼å¯å¨æéè¿ç§»ãåè®¾ cluster-node-timeout=5ï¼cluster-slave-validity-factor=10ï¼åå¦æä»èç¹è·ä¸»èç¹å¤±èè¶è¿ 50 ç§ï¼æ­¤ä»èç¹ä¸è½æä¸ºä¸»èç¹ãæ³¨æï¼å¦ææ­¤åæ°éç½®ä¸ºé 0ï¼å°å¯è½åºç°ç±äºæä¸»èç¹å¤±èå´æ²¡æä»èç¹è½é¡¶ä¸çæåµï¼ä»èå¯¼è´éç¾¤ä¸è½æ­£å¸¸å·¥ä½ï¼å¨è¿ç§æåµä¸ï¼åªæç­å°åæ¥çä¸»èç¹éæ°åå½å°éç¾¤ï¼éç¾¤ææ¢å¤è¿ä½ã\n * cluster-migration-barrier <count> - ä¸»èç¹éè¦çæå°ä»èç¹æ°ï¼åªæè¾¾å°è¿ä¸ªæ°ï¼ä¸»èç¹å¤±è´¥æ¶ï¼å®ä»èç¹æä¼è¿è¡è¿ç§»ãæ´è¯¦ç»ä»ç»å¯ä»¥çæ¬æç¨åé¢å³äºå¯æ¬è¿ç§»å°é¨åã\n * cluster-require-full-coverage <yes/no> - å¨é¨å key æå¨çèç¹ä¸å¯ç¨æ¶ï¼å¦ææ­¤åæ°è®¾ç½®ä¸ºâyesâ(é»è®¤å¼), åæ´ä¸ªéç¾¤åæ­¢æ¥åæä½ï¼å¦ææ­¤åæ°è®¾ç½®ä¸ºânoâï¼åéç¾¤ä¾ç¶ä¸ºå¯è¾¾èç¹ä¸ç key æä¾è¯»æä½ã\n\n\n# 5. å¶ä» Redis éç¾¤æ¹æ¡\n\nRedis Cluster ä¸å¤ªéåç¨äºå¤§è§æ¨¡éç¾¤ï¼æä»¥ï¼å¦æè¦æå»ºè¶å¤§ Redis éç¾¤ï¼éè¦éæ©æ¿ä»£æ¹æ¡ãä¸è¬æä¸ç§æ¹æ¡ç±»åï¼\n\n * å®¢æ·ç«¯ååºæ¹æ¡\n * ä»£çååºæ¹æ¡\n * æ¥è¯¢è·¯ç±æ¹æ¡\n\n\n# 5.1. å®¢æ·ç«¯ååºæ¹æ¡\n\nå®¢æ·ç«¯ å°±å·²ç»å³å®æ°æ®ä¼è¢« å­å¨ å°åªä¸ª Redis èç¹æèä»åªä¸ª Redis èç¹ è¯»åæ°æ®ãå¶ä¸»è¦ææ³æ¯éç¨ åå¸ç®æ³ å° Redis æ°æ®ç key è¿è¡æ£åï¼éè¿ hash å½æ°ï¼ç¹å®ç keyä¼ æ å° å°ç¹å®ç Redis èç¹ä¸ã\n\nå®¢æ·ç«¯ååºæ¹æ¡ çä»£è¡¨ä¸º Redis Shardingï¼Redis Sharding æ¯ Redis Cluster åºæ¥ä¹åï¼ä¸çæ®éä½¿ç¨ç Redis å¤å®ä¾éç¾¤ æ¹æ³ãJava ç Redis å®¢æ·ç«¯é©±å¨åº Jedisï¼æ¯æ Redis Sharding åè½ï¼å³ ShardedJedis ä»¥å ç»åç¼å­æ±  ç ShardedJedisPoolã\n\n * ä¼ç¹ï¼ä¸ä½¿ç¨ ç¬¬ä¸æ¹ä¸­é´ä»¶ï¼ååºé»è¾ å¯æ§ï¼éç½® ç®åï¼èç¹ä¹é´æ å³èï¼å®¹æ çº¿æ§æ©å±ï¼çµæ´»æ§å¼ºã\n\n * ç¼ºç¹ï¼å®¢æ·ç«¯ æ æ³ å¨æå¢å  æå¡èç¹ï¼å®¢æ·ç«¯éè¦èªè¡ç»´æ¤ ååé»è¾ï¼å®¢æ·ç«¯ä¹é´ æ è¿æ¥å±äº«ï¼ä¼é æ è¿æ¥æµªè´¹ã\n\n\n# 5.2. ä»£çååºæ¹æ¡\n\nå®¢æ·ç«¯ åéè¯·æ±å°ä¸ä¸ª ä»£çç»ä»¶ï¼ä»£ç è§£æ å®¢æ·ç«¯ çæ°æ®ï¼å¹¶å°è¯·æ±è½¬åè³æ­£ç¡®çèç¹ï¼æåå°ç»æåå¤ç»å®¢æ·ç«¯ã\n\n * ä¼ç¹ï¼ç®å å®¢æ·ç«¯ çåå¸å¼é»è¾ï¼å®¢æ·ç«¯ éææ¥å¥ï¼åæ¢ææ¬ä½ï¼ä»£çç è½¬å å å­å¨ åç¦»ã\n * ç¼ºç¹ï¼å¤äºä¸å± ä»£çå±ï¼å éäº æ¶æé¨ç½²å¤æåº¦ å æ§è½æèã\n\nä»£çååº ä¸»æµå®ç°çææ¹æ¡æ Twemproxy å Codisã\n\n# 5.2.1. Twemproxy\n\nTwemproxy ä¹å« nutcrakerï¼æ¯ Twitter å¼æºçä¸ä¸ª Redis å Memcache ç ä¸­é´ä»£çæå¡å¨ ç¨åºã\n\nTwemproxy ä½ä¸º ä»£çï¼å¯æ¥åæ¥èªå¤ä¸ªç¨åºçè®¿é®ï¼æç§ è·¯ç±è§åï¼è½¬åç»åå°çåä¸ª Redis æå¡å¨ï¼ååè·¯è¿åãTwemproxy å­å¨ åç¹æé é®é¢ï¼éè¦ç»å Lvs å Keepalived å é«å¯ç¨æ¹æ¡ã\n\n * ä¼ç¹ï¼åºç¨èå´å¹¿ï¼ç¨³å®æ§è¾é«ï¼ä¸­é´ä»£çå± é«å¯ç¨ã\n * ç¼ºç¹ï¼æ æ³å¹³æ»å° æ°´å¹³æ©å®¹/ç¼©å®¹ï¼æ  å¯è§åç®¡ççé¢ï¼è¿ç»´ä¸åå¥½ï¼åºç°æéï¼ä¸è½ èªå¨è½¬ç§»ã\n\n# 5.2.2. Codis\n\nCodis æ¯ä¸ä¸ª åå¸å¼ Redis è§£å³æ¹æ¡ï¼å¯¹äºä¸å±åºç¨æ¥è¯´ï¼è¿æ¥ Codis-Proxy åç´æ¥è¿æ¥ åçç Redis-Server æ²¡æçåºå«ãCodis åºå±ä¼ å¤çè¯·æ±çè½¬åï¼ä¸åæºçè¿è¡ æ°æ®è¿ç§» ç­å·¥ä½ãCodis éç¨äºæ ç¶æç ä»£çå±ï¼å¯¹äº å®¢æ·ç«¯ æ¥è¯´ï¼ä¸åé½æ¯éæçã\n\n * ä¼ç¹ï¼å®ç°äºä¸å± Proxy ååºå± Redis ç é«å¯ç¨ï¼æ°æ®ååº å èªå¨å¹³è¡¡ï¼æä¾ å½ä»¤è¡æ¥å£ å RESTful APIï¼æä¾ çæ§ å ç®¡ç çé¢ï¼å¯ä»¥å¨æ æ·»å  å å é¤ Redis èç¹ã\n\n * ç¼ºç¹ï¼é¨ç½²æ¶æ å éç½® å¤æï¼ä¸æ¯æ è·¨æºæ¿ å å¤ç§æ·ï¼ä¸æ¯æ é´æç®¡çã\n\n\n# 5.3. æ¥è¯¢è·¯ç±æ¹æ¡\n\nå®¢æ·ç«¯éæºå° è¯·æ±ä»»æä¸ä¸ª Redis å®ä¾ï¼ç¶åç± Redis å°è¯·æ± è½¬å ç» æ­£ç¡® ç Redis èç¹ãRedis Cluster å®ç°äºä¸ç§ æ··åå½¢å¼ ç æ¥è¯¢è·¯ç±ï¼ä½å¹¶ä¸æ¯ ç´æ¥ å°è¯·æ±ä»ä¸ä¸ª Redis èç¹ è½¬å å°å¦ä¸ä¸ª Redis èç¹ï¼èæ¯å¨ å®¢æ·ç«¯ çå¸®å©ä¸ç´æ¥ éå®åï¼ redirectedï¼å°æ­£ç¡®ç Redis èç¹ã\n\n * ä¼ç¹ï¼å»ä¸­å¿åï¼æ°æ®æç§ æ§½ å­å¨åå¸å¨å¤ä¸ª Redis å®ä¾ä¸ï¼å¯ä»¥å¹³æ»çè¿è¡èç¹ æ©å®¹/ç¼©å®¹ï¼æ¯æ é«å¯ç¨ å èªå¨æéè½¬ç§»ï¼è¿ç»´ææ¬ä½ã\n\n * ç¼ºç¹ï¼éåº¦ä¾èµ Redis-trib å·¥å·ï¼ç¼ºä¹ çæ§ç®¡çï¼éè¦ä¾èµ Smart Client (ç»´æ¤è¿æ¥ï¼ç¼å­è·¯ç±è¡¨ï¼MultiOp å Pipeline æ¯æ)ãFailover èç¹ç æ£æµè¿æ¢ï¼ä¸å¦æ ä¸­å¿èç¹ çéç¾¤åæ¶ï¼å¦ ZooKeeperï¼ãGossip æ¶æ¯éç¨å¹¿æ­æ¹å¼ï¼éç¾¤è§æ¨¡è¶å¤§ï¼å¼éè¶å¤§ãæ æ³æ ¹æ®ç»è®¡åºå å·ç­æ°æ®ã\n\n\n# 6. åèèµæ\n\n * å®ç½\n   * Redis å®ç½\n   * Redis github\n   * Redis å®æ¹ææ¡£ä¸­æç\n * ä¸­é´ä»¶\n   * Twemproxy\n   * Codis\n * ä¹¦ç±\n   * ãRedis å®æã\n   * ãRedis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * åç«¯å­å¨å®æè¯¾\n * æç« \n   * Redis éç¾¤æç¨\n   * Redis éç¾¤çåçåæ­å»º\n   * æ·±å¥åæ Redis ç³»å(ä¸) - Redis éç¾¤æ¨¡å¼æ­å»ºä¸åçè¯¦è§£",normalizedContent:"# redis éç¾¤\n\n> redis éç¾¤ï¼redis clusterï¼ æ¯ redis å®æ¹æä¾çåå¸å¼æ°æ®åºæ¹æ¡ã\n> \n> æ¢ç¶æ¯åå¸å¼ï¼èªç¶å·å¤åå¸å¼ç³»ç»çåºæ¬ç¹æ§ï¼å¯æ©å±ãé«å¯ç¨ãä¸è´æ§ã\n> \n>  * redis éç¾¤éè¿åå hash æ§½æ¥ååºï¼è¿è¡æ°æ®åäº«ã\n>  * redis éç¾¤éç¨ä¸»ä»æ¨¡åï¼æä¾å¤å¶åæéè½¬ç§»åè½ï¼æ¥ä¿è¯ redis éç¾¤çé«å¯ç¨ã\n>  * æ ¹æ® cap çè®ºï¼consistencyãavailabilityãpartition tolerance ä¸èä¸å¯å¼å¾ï¼è redis éç¾¤çéæ©æ¯ apãredis éç¾¤èç¹é´éç¨å¼æ­¥éä¿¡æ¹å¼ï¼ä¸ä¿è¯å¼ºä¸è´æ§ï¼å°½åè¾¾å°æç»ä¸è´æ§ã\n\n\n\n\n# 1. redis cluster ååº\n\n\n# 1.1. éç¾¤èç¹\n\nredis éç¾¤ç±å¤ä¸ªèç¹ç»æï¼èç¹åå¯å¨æ¶ï¼å½¼æ­¤æ¯ç¸äºç¬ç«çãèç¹éè¿æ¡æï¼ cluster meet å½ä»¤ï¼æ¥å°å¶ä»èç¹æ·»å å°èªå·±æå¤çéç¾¤ä¸­ã\n\nåä¸ä¸ªèç¹åé cluster meet å½ä»¤ï¼å¯ä»¥è®©å½åèç¹ä¸æå® ipãport çèç¹è¿è¡æ¡æï¼æ¡ææåæ¶ï¼å½åèç¹ä¼å°æå®èç¹å å¥æå¨éç¾¤ã\n\néç¾¤èç¹ä¿å­é®å¼å¯¹ä»¥åè¿ææ¶é´çæ¹å¼ä¸åæº redis æå¡å®å¨ç¸åã\n\nredis éç¾¤èç¹åä¸ºä¸»èç¹ï¼masterï¼åä»èç¹ï¼slaveï¼ï¼å¶ä¸­ä¸»èç¹ç¨äºå¤çæ§½ï¼èä»èç¹åç¨äºå¤å¶æä¸ªä¸»èç¹ï¼å¹¶å¨è¢«å¤å¶çä¸»èç¹ä¸çº¿æ¶ï¼ä»£æ¿ä¸çº¿ä¸»èç¹ç»§ç»­å¤çå½ä»¤è¯·æ±ã\n\n\n# 1.2. åé hash æ§½\n\nåå¸å¼å­å¨éè¦è§£å³çé¦è¦é®é¢æ¯æ æ´ä¸ªæ°æ®é æç§ ååºè§å æ å°å° å¤ä¸ªèç¹ çé®é¢ï¼å³æ æ°æ®é ååå° å¤ä¸ªèç¹ ä¸ï¼æ¯ä¸ªèç¹è´è´£ æ´ä½æ°æ® çä¸ä¸ª å­éã\n\nredis éç¾¤éè¿åå hash æ§½æ¥å°æ°æ®ååºãredis éç¾¤éè¿ååºçæ¹å¼æ¥ä¿å­æ°æ®åºçé®å¼å¯¹ï¼éç¾¤çæ´ä¸ªæ°æ®åºè¢«åä¸º 16384 ä¸ªåå¸æ§½ï¼slotï¼ï¼æ°æ®åºä¸­çæ¯ä¸ªé®é½å±äºè¿ 16384 ä¸ªæ§½çå¶ä¸­ä¸ä¸ªï¼éç¾¤ä¸­çæ¯ä¸ªèç¹å¯ä»¥å¤ç 0 ä¸ªææå¤ 16384 ä¸ªæ§½ãå¦ææ°æ®åºä¸­æä»»ä½ä¸ä¸ªæ§½æ²¡æå¾å°å¤çï¼é£ä¹éç¾¤å¤äºä¸çº¿ç¶æã\n\néè¿åèç¹åé cluster addslots å½ä»¤ï¼å¯ä»¥å°ä¸ä¸ªæå¤ä¸ªæ§½ææ´¾ç»èç¹è´è´£ã\n\n> cluster addslots 1 2 3\nok\n\n\néç¾¤ä¸­çæ¯ä¸ªèç¹è´è´£ä¸é¨ååå¸æ§½ï¼æ¯å¦éç¾¤ä¸­æï¼ä¸ªèç¹ï¼åï¼\n\n * èç¹ï½å­å¨çåå¸æ§½èå´æ¯ï¼0 â 5500\n * èç¹ï½å­å¨çåå¸æ§½èå´æ¯ï¼5501 â 11000\n * èç¹ï½å­å¨çåå¸æ§½èå´æ¯ï¼11001 â 16384\n\n\n# 1.3. å¯»å\n\nå½å®¢æ·ç«¯åèç¹åéä¸æ°æ®åºé®æå³çå½ä»¤æ¶ï¼æ¥åå½ä»¤çèç¹ä¼è®¡ç®åºå½ä»¤è¦å¤ççæ°æ®åºå±äºåªä¸ªæ§½ï¼å¹¶æ£æ¥è¿ä¸ªæ§½æ¯å¦ææ´¾ç»äºèªå·±ï¼\n\n * å¦æé®æå¨çæ§½æ­£å¥½ææ´¾ç»äºå½åèç¹ï¼é£ä¹å½åèç¹ç´æ¥æ§è¡å½ä»¤ã\n * å¦æé®æå¨çæ§½æ²¡æææ´¾ç»å½åèç¹ï¼é£ä¹èç¹ä¼åå®¢æ·ç«¯è¿åä¸ä¸ª moved éè¯¯ï¼æå¼å®¢æ·ç«¯éå®åè³æ­£ç¡®çèç¹ã\n\n# 1.3.1. è®¡ç®é®å±äºåªä¸ªæ§½\n\nå³å®ä¸ä¸ª key åºè¯¥åéå°é£ä¸ªæ§½çç®æ³æ¯ï¼è®¡ç®è¯¥ key ç crc16 ç»æåæ¨¡ 16834ã\n\nhash_slot = crc16(key) mod 16384\n\n\nå½èç¹è®¡ç®åº key æå±çæ§½ä¸º i ä¹åï¼èç¹ä¼æ ¹æ®ä»¥ä¸æ¡ä»¶å¤æ­æ§½æ¯å¦ç±èªå·±è´è´£ï¼\n\nclusterstate.slots[i] == clusterstate.myself\n\n\n# 1.3.2. moved éè¯¯\n\nå½èç¹åç°é®æå¨çæ§½å¹¶éèªå·±è´è´£å¤ççæ¶åï¼èç¹å°±ä¼åå®¢æ·ç«¯è¿åä¸ä¸ª moved éè¯¯ï¼æå¼å®¢æ·ç«¯è½¬åæ­£å¨è´è´£æ§½çèç¹ã\n\nmoved éè¯¯çæ ¼å¼ä¸ºï¼\n\nmoved <slot> <ip>:<port>\n\n\n> ä¸ªäººçè§£ï¼moved è¿ç§æä½æç¹ç±»ä¼¼ http åè®®ä¸­çéå®åã\n\n\n# 1.4. éæ°ååº\n\nredis éç¾¤çéæ°ååºæä½å¯ä»¥å°ä»»ææ°éçå·²ç»ææ´¾ç»æä¸ªèç¹ï¼æºèç¹ï¼çæ§½æ¹ä¸ºææ´¾ç»å¦ä¸ä¸ªèç¹ï¼ç®æ èç¹ï¼ï¼å¹¶ä¸ç¸å³æ§½æå±çé®å¼å¯¹ä¹ä¼ä»æºèç¹è¢«ç§»å¨å°ç®æ èç¹ã\n\néæ°ååºæä½å¯ä»¥å¨çº¿è¿è¡ï¼å¨éæ°ååºçè¿ç¨ä¸­ï¼éç¾¤ä¸éè¦ä¸çº¿ï¼å¹¶ä¸æºèç¹åç®æ èç¹é½å¯ä»¥ç»§ç»­å¤çå½ä»¤è¯·æ±ã\n\nredis éç¾¤çéæ°ååºæä½ç± redis éç¾¤ç®¡çè½¯ä»¶ redis-trib è´è´£æ§è¡çï¼redis-trib éè¿åæºèç¹åç®æ èç¹åéå½ä»¤æ¥è¿è¡éæ°ååºæä½ã\n\néæ°ååºçå®ç°åçå¦ä¸å¾æç¤ºï¼\n\n\n\n\n# 1.5. ask éè¯¯\n\nask éè¯¯ä¸ moved çåºå«å¨äºï¼ask éè¯¯åªæ¯ä¸¤ä¸ªèç¹å¨è¿ç§»æ§½çè¿ç¨ä¸­ä½¿ç¨çä¸ç§ä¸´æ¶æªæ½ï¼å¨å®¢æ·ç«¯æ¶å°å³äºæ§½ x ç ask éè¯¯ä¹åï¼å®¢æ·ç«¯åªä¼å¨æ¥ä¸æ¥çä¸æ¬¡å½ä»¤è¯·æ±ä¸­å°å³äºæ§½ x çå½ä»¤è¯·æ±åéè³ ask éè¯¯ææç¤ºçèç¹ï¼ä½è¿ç§è½¬åä¸ä¼å¯¹å®¢æ·ç«¯ä»ååéå³äºæ§½ x çå½ä»¤è¯·æ±äº§çä»»ä½å½±åï¼å®¢æ·ç«¯ä»ç¶ä¼å°å³äºæ§½ x çå½ä»¤è¯·æ±åéè³ç®åè´è´£å¤çæ§½ x çèç¹ï¼é¤é ask éè¯¯åæ¬¡åºç°ã\n\nå¤æ­ ask éè¯¯çè¿ç¨å¦ä¸å¾æç¤ºï¼\n\n\n\n\n# 2. redis cluster æéè½¬ç§»\n\n\n# 2.1. å¤å¶\n\nredis å¤å¶æºå¶å¯ä»¥åèï¼redis å¤å¶\n\n\n# 2.2. æéæ£æµ\n\néç¾¤ä¸­æ¯ä¸ªèç¹é½ä¼å®æåéç¾¤ä¸­çå¶ä»èç¹åé ping æ¶æ¯ï¼ä»¥æ­¤æ¥æ£æµå¯¹æ¹æ¯å¦å¨çº¿ã\n\nèç¹çç¶æä¿¡æ¯å¯ä»¥åä¸ºï¼\n\n * å¨çº¿ç¶æï¼\n\n * ä¸çº¿ç¶æï¼failï¼;\n\n * çä¼¼ä¸çº¿ç¶æï¼pfailï¼ï¼å³å¨è§å®çæ¶é´åï¼æ²¡æåºç­ ping æ¶æ¯ï¼\n\n\n# 2.3. æéè½¬ç§»\n\n 1. ä¸çº¿ä¸»èç¹çææä»èç¹ä¸­ï¼ä¼æä¸ä¸ªä»èç¹è¢«éä¸­ã\n 2. è¢«éä¸­çä»èç¹ä¼æ§è¡ slaveof no one å½ä»¤ï¼æä¸ºæ°çä¸»èç¹ã\n 3. æ°çä¸»èç¹ä¼æ¤éææå¯¹å·²ä¸çº¿ä¸»èç¹çæ§½ææ´¾ï¼å¹¶å°è¿äºæ§½å¨é¨ææ´¾ç»èªå·±ã\n 4. æ°çä¸»èç¹åéç¾¤å¹¿æ­ä¸æ¡ pong æ¶æ¯ï¼åç¥å¶ä»èç¹è¿ä¸ªä»èç¹å·²åæä¸»èç¹ã\n\n\n# 2.4. éä¸¾æ°çä¸»èç¹\n\nredis éç¾¤éä¸¾æ°çä¸»èç¹æµç¨åºäºå±è¯ç®æ³ï¼raft\n\n\n# 3. redis cluster éä¿¡\n\néç¾¤ä¸­çèç¹éè¿åéåæ¥æ¶æ¶æ¯æ¥è¿è¡éä¿¡ã\n\nredis éç¾¤èç¹åéçæ¶æ¯ä¸»è¦æä»¥ä¸äºç§ï¼\n\n * meet - è¯·æ±æ¥æ¶æ¹å å¥åéæ¹æå¨çéç¾¤ã\n * ping - éç¾¤ä¸­æ¯ä¸ªèç¹æ¯éä¸æ®µæ¶é´ï¼é»è®¤ä¸ºä¸ç§ï¼ä»å·²ç¥èç¹åè¡¨ä¸­éæºéåºäºä¸ªèç¹ï¼ç¶åå¯¹è¿äºä¸ªèç¹ä¸­æä¹æ²¡èç³»çèç¹åé ping æ¶æ¯ï¼ä»¥æ­¤æ£æµè¢«éä¸­çèç¹æ¯å¦å¨çº¿ã\n * pong - å½æ¥æ¶æ¹æ¶å°åéæ¹åæ¥ç meet æ¶æ¯æ ping æ¶æ¯æ¶ï¼ä¼è¿åä¸æ¡ pong æ¶æ¯ä½ä¸ºåºç­ã\n * fail - å½ä¸ä¸ªä¸»èç¹ a å¤æ­å¦ä¸ä¸ªä¸»èç¹ b å·²ç»è¿å¥ fail ç¶ææ¶ï¼èç¹ a ä¼åéç¾¤å¹¿æ­ä¸æ¡å³äºèç¹ b ç fail æ¶æ¯ï¼æææ¶å°è¿æ¡æ¶æ¯çèç¹é½ä¼ç«å³å°èç¹ b æ è®°ä¸ºå·²ä¸çº¿ã\n * publish - å½èç¹æ¶å°ä¸ä¸ª publish å½ä»¤æ¶ï¼èç¹ä¼æ§è¡è¿ä¸ªå½ä»¤ï¼å¹¶åéç¾¤å¹¿æ­ä¸æ¡ publish æ¶æ¯ï¼æææ¥åå°è¿æ¡æ¶æ¯çèç¹é½ä¼æ§è¡ç¸åç publish å½ä»¤ã\n\n\n# 4. redis cluster åºç¨\n\n\n# 4.1. éç¾¤åè½éå¶\n\nredis éç¾¤ç¸å¯¹ åæºï¼å­å¨ä¸äºåè½éå¶ï¼éè¦ å¼åäººå æåäºè§£ï¼å¨ä½¿ç¨æ¶åå¥½è§é¿ã\n\n * key æ¹éæä½ æ¯ææéï¼ç±»ä¼¼ msetãmget æä½ï¼ç®ååªæ¯æå¯¹å·æç¸å slot å¼ç key æ§è¡ æ¹éæä½ãå¯¹äº æ å°ä¸ºä¸å slot å¼ç key ç±äºæ§è¡ mgetãmget ç­æä½å¯è½å­å¨äºå¤ä¸ªèç¹ä¸ï¼å æ­¤ä¸è¢«æ¯æã\n\n * key äºå¡æä½ æ¯ææéï¼åªæ¯æ å¤ key å¨ åä¸èç¹ä¸ ç äºå¡æä½ï¼å½å¤ä¸ª key åå¸å¨ ä¸å çèç¹ä¸æ¶ æ æ³ ä½¿ç¨äºå¡åè½ã\n\n * key ä½ä¸º æ°æ®ååº çæå°ç²åº¦ï¼ä¸è½å°ä¸ä¸ª å¤§çé®å¼ å¯¹è±¡å¦ hashãlist ç­æ å°å° ä¸åçèç¹ã\n\n * ä¸æ¯æ å¤æ°æ®åºç©ºé´ï¼åæº ä¸ç redis å¯ä»¥æ¯æ 16 ä¸ªæ°æ®åºï¼db0 ~ db15ï¼ï¼éç¾¤æ¨¡å¼ ä¸åªè½ä½¿ç¨ ä¸ä¸ª æ°æ®åºç©ºé´ï¼å³ db0ã\n\n * å¤å¶ç»æ åªæ¯æä¸å±ï¼ä»èç¹ åªè½å¤å¶ ä¸»èç¹ï¼ä¸æ¯æ åµå¥æ ç¶å¤å¶ ç»æã\n\n\n# 4.2. éç¾¤è§æ¨¡éå¶\n\nredis cluster çä¼ç¹æ¯æäºä½¿ç¨ãååºãä¸»ä»å¤å¶ãå¼¹æ§æ©å®¹è¿äºåè½é½å¯ä»¥åå°èªå¨åï¼éè¿ç®åçé¨ç½²å°±å¯ä»¥è·å¾ä¸ä¸ªå¤§å®¹éãé«å¯é ãé«å¯ç¨ç redis éç¾¤ï¼å¹¶ä¸å¯¹äºåºç¨æ¥è¯´ï¼è¿ä¹äºæ¯éæçã\n\næä»¥ï¼redis cluster éå¸¸éåæå»ºä¸­å°è§æ¨¡ redis éç¾¤ï¼è¿éçä¸­å°è§æ¨¡æçæ¯ï¼å¤§æ¦å ä¸ªå°å åä¸ªèç¹è¿æ ·è§æ¨¡ç redis éç¾¤ã\n\nä½æ¯ redis cluster ä¸å¤ªéåæå»ºè¶å¤§è§æ¨¡éç¾¤ï¼ä¸»è¦åå æ¯ï¼å®éç¨äºå»ä¸­å¿åçè®¾è®¡ã\n\nredis çæ¯ä¸ªèç¹ä¸ï¼é½ä¿å­äºæææ§½åèç¹çæ å°å³ç³»è¡¨ï¼å®¢æ·ç«¯å¯ä»¥è®¿é®ä»»æä¸ä¸ªèç¹ï¼åéè¿éå®åå½ä»¤ï¼æ¾å°æ°æ®æå¨çé£ä¸ªèç¹ãé£ä¹ï¼è¿ä¸ªæ å°å³ç³»è¡¨æ¯å¦ä½æ´æ°çå¢ï¼redis cluster éç¨äºä¸ç§å»ä¸­å¿åçæµè¨ (gossip) åè®®æ¥ä¼ æ­éç¾¤éç½®çååã\n\ngossip åè®®çä¼ç¹æ¯å»ä¸­å¿åï¼ç¼ºç¹æ¯ä¼ æ­éåº¦æ¢ï¼å¹¶ä¸æ¯éç¾¤è§æ¨¡è¶å¤§ï¼ä¼ æ­çè¶æ¢ã\n\n\n# 4.3. éç¾¤éç½®\n\næä»¬åé¢ä¼é¨ç½²ä¸ä¸ª redis éç¾¤ä½ä¸ºä¾å­ï¼å¨é£ä¹åï¼åä»ç»ä¸ä¸éç¾¤å¨ redis.conf ä¸­çåæ°ã\n\n * cluster-enabled <yes/no> - å¦æéç½®âyesâåå¼å¯éç¾¤åè½ï¼æ­¤ redis å®ä¾ä½ä¸ºéç¾¤çä¸ä¸ªèç¹ï¼å¦åï¼å®æ¯ä¸ä¸ªæ®éçåä¸ç redis å®ä¾ã\n * cluster-config-file <filename> - æ³¨æï¼è½ç¶æ­¤éç½®çåå­å«âéç¾¤éç½®æä»¶âï¼ä½æ¯æ­¤éç½®æä»¶ä¸è½äººå·¥ç¼è¾ï¼å®æ¯éç¾¤èç¹èªå¨ç»´æ¤çæä»¶ï¼ä¸»è¦ç¨äºè®°å½éç¾¤ä¸­æåªäºèç¹ãä»ä»¬çç¶æä»¥åä¸äºæä¹ååæ°ç­ï¼æ¹ä¾¿å¨éå¯æ¶æ¢å¤è¿äºç¶æãéå¸¸æ¯å¨æ¶å°è¯·æ±ä¹åè¿ä¸ªæä»¶å°±ä¼è¢«æ´æ°ã\n * cluster-node-timeout <milliseconds> - è¿æ¯éç¾¤ä¸­çèç¹è½å¤å¤±èçæå¤§æ¶é´ï¼è¶è¿è¿ä¸ªæ¶é´ï¼è¯¥èç¹å°±ä¼è¢«è®¤ä¸ºæéãå¦æä¸»èç¹è¶è¿è¿ä¸ªæ¶é´è¿æ¯ä¸å¯è¾¾ï¼åç¨å®çä»èç¹å°å¯å¨æéè¿ç§»ï¼åçº§æä¸»èç¹ãæ³¨æï¼ä»»ä½ä¸ä¸ªèç¹å¨è¿ä¸ªæ¶é´ä¹åå¦æè¿æ¯æ²¡æè¿ä¸å¤§é¨åçä¸»èç¹ï¼åæ­¤èç¹å°åæ­¢æ¥æ¶ä»»ä½è¯·æ±ã\n * cluster-slave-validity-factor <factor> - å¦æè®¾ç½®æï¼ï¼åæ è®ºä»èç¹ä¸ä¸»èç¹å¤±èå¤ä¹ï¼ä»èç¹é½ä¼å°è¯åçº§æä¸»èç¹ãå¦æè®¾ç½®ææ­£æ°ï¼å cluster-node-timeout ä¹ä»¥ cluster-slave-validity-factor å¾å°çæ¶é´ï¼æ¯ä»èç¹ä¸ä¸»èç¹å¤±èåï¼æ­¤ä»èç¹æ°æ®ææçæé¿æ¶é´ï¼è¶è¿è¿ä¸ªæ¶é´ï¼ä»èç¹ä¸ä¼å¯å¨æéè¿ç§»ãåè®¾ cluster-node-timeout=5ï¼cluster-slave-validity-factor=10ï¼åå¦æä»èç¹è·ä¸»èç¹å¤±èè¶è¿ 50 ç§ï¼æ­¤ä»èç¹ä¸è½æä¸ºä¸»èç¹ãæ³¨æï¼å¦ææ­¤åæ°éç½®ä¸ºé 0ï¼å°å¯è½åºç°ç±äºæä¸»èç¹å¤±èå´æ²¡æä»èç¹è½é¡¶ä¸çæåµï¼ä»èå¯¼è´éç¾¤ä¸è½æ­£å¸¸å·¥ä½ï¼å¨è¿ç§æåµä¸ï¼åªæç­å°åæ¥çä¸»èç¹éæ°åå½å°éç¾¤ï¼éç¾¤ææ¢å¤è¿ä½ã\n * cluster-migration-barrier <count> - ä¸»èç¹éè¦çæå°ä»èç¹æ°ï¼åªæè¾¾å°è¿ä¸ªæ°ï¼ä¸»èç¹å¤±è´¥æ¶ï¼å®ä»èç¹æä¼è¿è¡è¿ç§»ãæ´è¯¦ç»ä»ç»å¯ä»¥çæ¬æç¨åé¢å³äºå¯æ¬è¿ç§»å°é¨åã\n * cluster-require-full-coverage <yes/no> - å¨é¨å key æå¨çèç¹ä¸å¯ç¨æ¶ï¼å¦ææ­¤åæ°è®¾ç½®ä¸ºâyesâ(é»è®¤å¼), åæ´ä¸ªéç¾¤åæ­¢æ¥åæä½ï¼å¦ææ­¤åæ°è®¾ç½®ä¸ºânoâï¼åéç¾¤ä¾ç¶ä¸ºå¯è¾¾èç¹ä¸ç key æä¾è¯»æä½ã\n\n\n# 5. å¶ä» redis éç¾¤æ¹æ¡\n\nredis cluster ä¸å¤ªéåç¨äºå¤§è§æ¨¡éç¾¤ï¼æä»¥ï¼å¦æè¦æå»ºè¶å¤§ redis éç¾¤ï¼éè¦éæ©æ¿ä»£æ¹æ¡ãä¸è¬æä¸ç§æ¹æ¡ç±»åï¼\n\n * å®¢æ·ç«¯ååºæ¹æ¡\n * ä»£çååºæ¹æ¡\n * æ¥è¯¢è·¯ç±æ¹æ¡\n\n\n# 5.1. å®¢æ·ç«¯ååºæ¹æ¡\n\nå®¢æ·ç«¯ å°±å·²ç»å³å®æ°æ®ä¼è¢« å­å¨ å°åªä¸ª redis èç¹æèä»åªä¸ª redis èç¹ è¯»åæ°æ®ãå¶ä¸»è¦ææ³æ¯éç¨ åå¸ç®æ³ å° redis æ°æ®ç key è¿è¡æ£åï¼éè¿ hash å½æ°ï¼ç¹å®ç keyä¼ æ å° å°ç¹å®ç redis èç¹ä¸ã\n\nå®¢æ·ç«¯ååºæ¹æ¡ çä»£è¡¨ä¸º redis shardingï¼redis sharding æ¯ redis cluster åºæ¥ä¹åï¼ä¸çæ®éä½¿ç¨ç redis å¤å®ä¾éç¾¤ æ¹æ³ãjava ç redis å®¢æ·ç«¯é©±å¨åº jedisï¼æ¯æ redis sharding åè½ï¼å³ shardedjedis ä»¥å ç»åç¼å­æ±  ç shardedjedispoolã\n\n * ä¼ç¹ï¼ä¸ä½¿ç¨ ç¬¬ä¸æ¹ä¸­é´ä»¶ï¼ååºé»è¾ å¯æ§ï¼éç½® ç®åï¼èç¹ä¹é´æ å³èï¼å®¹æ çº¿æ§æ©å±ï¼çµæ´»æ§å¼ºã\n\n * ç¼ºç¹ï¼å®¢æ·ç«¯ æ æ³ å¨æå¢å  æå¡èç¹ï¼å®¢æ·ç«¯éè¦èªè¡ç»´æ¤ ååé»è¾ï¼å®¢æ·ç«¯ä¹é´ æ è¿æ¥å±äº«ï¼ä¼é æ è¿æ¥æµªè´¹ã\n\n\n# 5.2. ä»£çååºæ¹æ¡\n\nå®¢æ·ç«¯ åéè¯·æ±å°ä¸ä¸ª ä»£çç»ä»¶ï¼ä»£ç è§£æ å®¢æ·ç«¯ çæ°æ®ï¼å¹¶å°è¯·æ±è½¬åè³æ­£ç¡®çèç¹ï¼æåå°ç»æåå¤ç»å®¢æ·ç«¯ã\n\n * ä¼ç¹ï¼ç®å å®¢æ·ç«¯ çåå¸å¼é»è¾ï¼å®¢æ·ç«¯ éææ¥å¥ï¼åæ¢ææ¬ä½ï¼ä»£çç è½¬å å å­å¨ åç¦»ã\n * ç¼ºç¹ï¼å¤äºä¸å± ä»£çå±ï¼å éäº æ¶æé¨ç½²å¤æåº¦ å æ§è½æèã\n\nä»£çååº ä¸»æµå®ç°çææ¹æ¡æ twemproxy å codisã\n\n# 5.2.1. twemproxy\n\ntwemproxy ä¹å« nutcrakerï¼æ¯ twitter å¼æºçä¸ä¸ª redis å memcache ç ä¸­é´ä»£çæå¡å¨ ç¨åºã\n\ntwemproxy ä½ä¸º ä»£çï¼å¯æ¥åæ¥èªå¤ä¸ªç¨åºçè®¿é®ï¼æç§ è·¯ç±è§åï¼è½¬åç»åå°çåä¸ª redis æå¡å¨ï¼ååè·¯è¿åãtwemproxy å­å¨ åç¹æé é®é¢ï¼éè¦ç»å lvs å keepalived å é«å¯ç¨æ¹æ¡ã\n\n * ä¼ç¹ï¼åºç¨èå´å¹¿ï¼ç¨³å®æ§è¾é«ï¼ä¸­é´ä»£çå± é«å¯ç¨ã\n * ç¼ºç¹ï¼æ æ³å¹³æ»å° æ°´å¹³æ©å®¹/ç¼©å®¹ï¼æ  å¯è§åç®¡ççé¢ï¼è¿ç»´ä¸åå¥½ï¼åºç°æéï¼ä¸è½ èªå¨è½¬ç§»ã\n\n# 5.2.2. codis\n\ncodis æ¯ä¸ä¸ª åå¸å¼ redis è§£å³æ¹æ¡ï¼å¯¹äºä¸å±åºç¨æ¥è¯´ï¼è¿æ¥ codis-proxy åç´æ¥è¿æ¥ åçç redis-server æ²¡æçåºå«ãcodis åºå±ä¼ å¤çè¯·æ±çè½¬åï¼ä¸åæºçè¿è¡ æ°æ®è¿ç§» ç­å·¥ä½ãcodis éç¨äºæ ç¶æç ä»£çå±ï¼å¯¹äº å®¢æ·ç«¯ æ¥è¯´ï¼ä¸åé½æ¯éæçã\n\n * ä¼ç¹ï¼å®ç°äºä¸å± proxy ååºå± redis ç é«å¯ç¨ï¼æ°æ®ååº å èªå¨å¹³è¡¡ï¼æä¾ å½ä»¤è¡æ¥å£ å restful apiï¼æä¾ çæ§ å ç®¡ç çé¢ï¼å¯ä»¥å¨æ æ·»å  å å é¤ redis èç¹ã\n\n * ç¼ºç¹ï¼é¨ç½²æ¶æ å éç½® å¤æï¼ä¸æ¯æ è·¨æºæ¿ å å¤ç§æ·ï¼ä¸æ¯æ é´æç®¡çã\n\n\n# 5.3. æ¥è¯¢è·¯ç±æ¹æ¡\n\nå®¢æ·ç«¯éæºå° è¯·æ±ä»»æä¸ä¸ª redis å®ä¾ï¼ç¶åç± redis å°è¯·æ± è½¬å ç» æ­£ç¡® ç redis èç¹ãredis cluster å®ç°äºä¸ç§ æ··åå½¢å¼ ç æ¥è¯¢è·¯ç±ï¼ä½å¹¶ä¸æ¯ ç´æ¥ å°è¯·æ±ä»ä¸ä¸ª redis èç¹ è½¬å å°å¦ä¸ä¸ª redis èç¹ï¼èæ¯å¨ å®¢æ·ç«¯ çå¸®å©ä¸ç´æ¥ éå®åï¼ redirectedï¼å°æ­£ç¡®ç redis èç¹ã\n\n * ä¼ç¹ï¼å»ä¸­å¿åï¼æ°æ®æç§ æ§½ å­å¨åå¸å¨å¤ä¸ª redis å®ä¾ä¸ï¼å¯ä»¥å¹³æ»çè¿è¡èç¹ æ©å®¹/ç¼©å®¹ï¼æ¯æ é«å¯ç¨ å èªå¨æéè½¬ç§»ï¼è¿ç»´ææ¬ä½ã\n\n * ç¼ºç¹ï¼éåº¦ä¾èµ redis-trib å·¥å·ï¼ç¼ºä¹ çæ§ç®¡çï¼éè¦ä¾èµ smart client (ç»´æ¤è¿æ¥ï¼ç¼å­è·¯ç±è¡¨ï¼multiop å pipeline æ¯æ)ãfailover èç¹ç æ£æµè¿æ¢ï¼ä¸å¦æ ä¸­å¿èç¹ çéç¾¤åæ¶ï¼å¦ zookeeperï¼ãgossip æ¶æ¯éç¨å¹¿æ­æ¹å¼ï¼éç¾¤è§æ¨¡è¶å¤§ï¼å¼éè¶å¤§ãæ æ³æ ¹æ®ç»è®¡åºå å·ç­æ°æ®ã\n\n\n# 6. åèèµæ\n\n * å®ç½\n   * redis å®ç½\n   * redis github\n   * redis å®æ¹ææ¡£ä¸­æç\n * ä¸­é´ä»¶\n   * twemproxy\n   * codis\n * ä¹¦ç±\n   * ãredis å®æã\n   * ãredis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * åç«¯å­å¨å®æè¯¾\n * æç« \n   * redis éç¾¤æç¨\n   * redis éç¾¤çåçåæ­å»º\n   * æ·±å¥åæ redis ç³»å(ä¸) - redis éç¾¤æ¨¡å¼æ­å»ºä¸åçè¯¦è§£",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"HBase æ°æ®æ¨¡å",frontmatter:{title:"HBase æ°æ®æ¨¡å",date:"2023-03-16T15:58:10.000Z",categories:["æ°æ®åº","åå¼æ°æ®åº","HBase"],tags:["æ°æ®åº","åå¼æ°æ®åº","å¤§æ°æ®","HBase"],permalink:"/pages/c8cfeb/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/06.%E5%88%97%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93/01.HBase/02.HBase%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B.html",relativePath:"12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/02.HBaseæ°æ®æ¨¡å.md",key:"v-3aca0c7e",path:"/pages/c8cfeb/",headers:[{level:2,title:"HBase é»è¾å­å¨ç»æ",slug:"hbase-é»è¾å­å¨ç»æ",normalizedTitle:"hbase é»è¾å­å¨ç»æ",charIndex:160},{level:2,title:"HBase ç©çå­å¨ç»æ",slug:"hbase-ç©çå­å¨ç»æ",normalizedTitle:"hbase ç©çå­å¨ç»æ",charIndex:1475},{level:2,title:"HBase æ°æ®æ¨¡åç¤ºä¾",slug:"hbase-æ°æ®æ¨¡åç¤ºä¾",normalizedTitle:"hbase æ°æ®æ¨¡åç¤ºä¾",charIndex:1742},{level:2,title:"HBase è¡¨ç¹æ§",slug:"hbase-è¡¨ç¹æ§",normalizedTitle:"hbase è¡¨ç¹æ§",charIndex:1995},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:2234}],headersStr:"HBase é»è¾å­å¨ç»æ HBase ç©çå­å¨ç»æ HBase æ°æ®æ¨¡åç¤ºä¾ HBase è¡¨ç¹æ§ åèèµæ",content:"# HBase æ°æ®æ¨¡å\n\nHBase æ¯ä¸ä¸ªé¢å å çæ°æ®åºç®¡çç³»ç»ï¼è¿éæ´ä¸ºç¡®åçèè¯´ï¼HBase æ¯ä¸ä¸ªé¢å åæ çæ°æ®åºç®¡çç³»ç»ãè¡¨ schema ä»å®ä¹åæï¼è¡¨å·æå¤ä¸ªåæï¼æ¯ä¸ªåæå¯ä»¥åå«ä»»ææ°éçåï¼åç±å¤ä¸ªååæ ¼ï¼cellï¼ç»æï¼ååæ ¼å¯ä»¥å­å¨å¤ä¸ªçæ¬çæ°æ®ï¼å¤ä¸ªçæ¬æ°æ®ä»¥æ¶é´æ³è¿è¡åºåã\n\n\n# HBase é»è¾å­å¨ç»æ\n\n * Tableï¼Table ç± Row å Column ç»æã\n * Rowï¼Row æ¯åæï¼Column Familyï¼çéåã\n * Row Keyï¼Row Key æ¯ç¨æ¥æ£ç´¢è®°å½çä¸»é®ã\n   * Row Key æ¯æªè§£éçå­èæ°ç»ï¼æä»¥çè®ºä¸ï¼ä»»ä½æ°æ®é½å¯ä»¥éè¿åºååè¡¨ç¤ºæå­ç¬¦ä¸²æäºè¿å¶ï¼ä»èå­ä¸º HBase çé®å¼ã\n   * è¡¨ä¸­çè¡ï¼æ¯æç§ Row Key çå­å¸åºè¿è¡æåºãè¿ééè¦æ³¨æä»¥ä¸ä¸¤ç¹ï¼\n     * å ä¸ºå­å¸åºå¯¹ Int æåºçç»ææ¯ 1,10,100,11,12,13,14,15,16,17,18,19,2,20,21,â¦,9,91,92,93,94,95,96,97,98,99ãå¦æä½ ä½¿ç¨æ´åçå­ç¬¦ä¸²ä½ä¸ºè¡é®ï¼é£ä¹ä¸ºäºä¿ææ´åçèªç¶åºï¼è¡é®å¿é¡»ç¨ 0 ä½å·¦å¡«åã\n     * è¡çä¸æ¬¡è¯»åæä½æ¯åå­æ§ç (ä¸è®ºä¸æ¬¡è¯»åå¤å°å)ã\n   * ææå¯¹è¡¨çè®¿é®é½è¦éè¿ Row Keyï¼æä»¥ä¸ä¸ç§æ¹å¼ï¼\n     * éè¿æå®ç Row Key è¿è¡è®¿é®ï¼\n     * éè¿ Row Key ç range è¿è¡è®¿é®ï¼å³è®¿é®æå®èå´åçè¡ï¼\n     * è¿è¡å¨è¡¨æ«æã\n * Column Familyï¼å³åæãHBase è¡¨ä¸­çæ¯ä¸ªåï¼é½å½å±äºæä¸ªåæãåææ¯è¡¨ç Schema çä¸é¨åï¼æä»¥åæéè¦å¨åå»ºè¡¨æ¶è¿è¡å®ä¹ã\n   * ä¸ä¸ªè¡¨çåæå¿é¡»ä½ä¸ºè¡¨æ¨¡å¼å®ä¹çä¸é¨åé¢åç»åºï¼ä½æ¯æ°çåææåå¯ä»¥éåæéå å¥ã\n   * åä¸ä¸ªåæçæææåå·æç¸åçåç¼ï¼ä¾å¦ info:formatï¼info:geo é½å±äº info è¿ä¸ªåæã\n * Column Qualifierï¼åéå®ç¬¦ãå¯ä»¥çè§£ä¸ºæ¯å·ä½çååï¼ä¾å¦ info:formatï¼info:geo é½å±äº info è¿ä¸ªåæï¼å®ä»¬çåéå®ç¬¦åå«æ¯ format å geoãåæååéå®ç¬¦ä¹é´å§ç»ä»¥åå·åéãéè¦æ³¨æçæ¯åéå®ç¬¦ä¸æ¯è¡¨ Schema çä¸é¨åï¼ä½ å¯ä»¥å¨æå¥æ°æ®çè¿ç¨ä¸­å¨æåå»ºåã\n * Columnï¼HBase ä¸­çåç±åæååéå®ç¬¦ç»æï¼ç± :(åå·) è¿è¡åéï¼å³ä¸ä¸ªå®æ´çåååºè¯¥è¡¨è¿°ä¸º åæå ï¼åéå®ç¬¦ã\n * Cellï¼Cell æ¯è¡ï¼åæååéå®ç¬¦çç»åï¼å¹¶åå«å¼åæ¶é´æ³ãHBase ä¸­éè¿ row key å column ç¡®å®çä¸ºä¸ä¸ªå­å¨ååç§°ä¸º Cellï¼ä½ å¯ä»¥ç­ä»·çè§£ä¸ºå³ç³»åæ°æ®åºä¸­ç±æå®è¡åæå®åç¡®å®çä¸ä¸ªååæ ¼ï¼ä½ä¸åçæ¯ HBase ä¸­çä¸ä¸ªååæ ¼æ¯ç±å¤ä¸ªçæ¬çæ°æ®ç»æçï¼æ¯ä¸ªçæ¬çæ°æ®ç¨æ¶é´æ³è¿è¡åºåã\n   * Cell ç±è¡ååçåæ äº¤åå³å®ï¼æ¯æçæ¬çãé»è®¤æåµä¸ï¼çæ¬å·æ¯èªå¨åéçï¼ä¸º HBase æå¥ Cell æ¶çæ¶é´æ³ãCell çåå®¹æ¯æªè§£éçå­èæ°ç»ã\n   * \n * Timestampï¼Cell ççæ¬éè¿æ¶é´æ³æ¥ç´¢å¼ï¼æ¶é´æ³çç±»åæ¯ 64 ä½æ´åï¼æ¶é´æ³å¯ä»¥ç± HBase å¨æ°æ®åå¥æ¶èªå¨èµå¼ï¼ä¹å¯ä»¥ç±å®¢æ·æ¾å¼æå®ãæ¯ä¸ª Cell ä¸­ï¼ä¸åçæ¬çæ°æ®æç§æ¶é´æ³ååºæåï¼å³ææ°çæ°æ®æå¨æåé¢ã\n\n\n\n\n# HBase ç©çå­å¨ç»æ\n\nHBase èªå¨å°è¡¨æ°´å¹³ååæåºåï¼Regionï¼ãæ¯ä¸ª Region ç±è¡¨ä¸­ Row çå­éææãæ¯ä¸ª Region ç±å®æå±çè¡¨çèµ·å§èå´æ¥è¡¨ç¤ºï¼åå«çç¬¬ä¸è¡åæåä¸è¡ï¼ãåå§æ¶ï¼ä¸ä¸ªè¡¨åªæä¸ä¸ª Regionï¼éç Region è¨èï¼å½è¶è¿ä¸å®éå¼æ¶ï¼ä¼å¨æè¡çè¾¹çä¸åè£æä¸¤ä¸ªå¤§å°åºæ¬ç¸åçæ° Regionãå¨ç¬¬ä¸æ¬¡ååä¹åï¼ææå è½½çæ°æ®é½æ¾å¨åå§ Region æå¨çé£å°æå¡å¨ä¸ãéçè¡¨åå¤§ï¼Region ä¸ªæ°ä¹ä¼éæ¸å¢å ãRegion æ¯å¨ HBase éç¾¤ä¸åå¸æ°æ®çæå°åä½ã\n\n\n# HBase æ°æ®æ¨¡åç¤ºä¾\n\nä¸å¾ä¸º HBase ä¸­ä¸å¼ è¡¨çï¼\n\n * RowKey ä¸ºè¡çå¯ä¸æ è¯ï¼ææè¡æç§ RowKey çå­å¸åºè¿è¡æåºï¼\n * è¯¥è¡¨å·æä¸¤ä¸ªåæï¼åå«æ¯ personal å office;\n * å¶ä¸­åæ personal æ¥æ nameãcityãphone ä¸ä¸ªåï¼åæ office æ¥æ telãaddres ä¸¤ä¸ªåã\n\n\n\n> å¾çå¼ç¨èª : HBase æ¯åå¼å­å¨æ°æ®åºå https://www.iteblog.com/archives/2498.html\n\n\n# HBase è¡¨ç¹æ§\n\nHbase çè¡¨å·æä»¥ä¸ç¹ç¹ï¼\n\n * å®¹éå¤§ï¼ä¸ä¸ªè¡¨å¯ä»¥ææ°åäº¿è¡ï¼ä¸ç¾ä¸åï¼\n * é¢ååï¼æ°æ®æ¯æç§åå­å¨ï¼æ¯ä¸åé½åç¬å­æ¾ï¼æ°æ®å³ç´¢å¼ï¼å¨æ¥è¯¢æ¶å¯ä»¥åªè®¿é®æå®åçæ°æ®ï¼ææå°éä½äºç³»ç»ç I/O è´æï¼\n * ç¨çæ§ï¼ç©º (null) åå¹¶ä¸å ç¨å­å¨ç©ºé´ï¼è¡¨å¯ä»¥è®¾è®¡çéå¸¸ç¨ç ï¼\n * æ°æ®å¤çæ¬ï¼æ¯ä¸ªååä¸­çæ°æ®å¯ä»¥æå¤ä¸ªçæ¬ï¼æç§æ¶é´æ³æåºï¼æ°çæ°æ®å¨æä¸é¢ï¼\n * å­å¨ç±»åï¼æææ°æ®çåºå±å­å¨æ ¼å¼é½æ¯å­èæ°ç» (byte[])ã\n\n\n# åèèµæ\n\n * å®æ¹\n   * HBase å®ç½\n   * HBase å®æ¹ææ¡£\n   * HBase å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * Hadoop æå¨æå\n * æç« \n   * Bigtable: A Distributed Storage System for Structured Data\n   * An In-Depth Look at the HBase Architecture\n * æç¨\n   * https://github.com/heibaiying/BigData-Notes\n   * https://www.cloudduggu.com/hbase/introduction/",normalizedContent:"# hbase æ°æ®æ¨¡å\n\nhbase æ¯ä¸ä¸ªé¢å å çæ°æ®åºç®¡çç³»ç»ï¼è¿éæ´ä¸ºç¡®åçèè¯´ï¼hbase æ¯ä¸ä¸ªé¢å åæ çæ°æ®åºç®¡çç³»ç»ãè¡¨ schema ä»å®ä¹åæï¼è¡¨å·æå¤ä¸ªåæï¼æ¯ä¸ªåæå¯ä»¥åå«ä»»ææ°éçåï¼åç±å¤ä¸ªååæ ¼ï¼cellï¼ç»æï¼ååæ ¼å¯ä»¥å­å¨å¤ä¸ªçæ¬çæ°æ®ï¼å¤ä¸ªçæ¬æ°æ®ä»¥æ¶é´æ³è¿è¡åºåã\n\n\n# hbase é»è¾å­å¨ç»æ\n\n * tableï¼table ç± row å column ç»æã\n * rowï¼row æ¯åæï¼column familyï¼çéåã\n * row keyï¼row key æ¯ç¨æ¥æ£ç´¢è®°å½çä¸»é®ã\n   * row key æ¯æªè§£éçå­èæ°ç»ï¼æä»¥çè®ºä¸ï¼ä»»ä½æ°æ®é½å¯ä»¥éè¿åºååè¡¨ç¤ºæå­ç¬¦ä¸²æäºè¿å¶ï¼ä»èå­ä¸º hbase çé®å¼ã\n   * è¡¨ä¸­çè¡ï¼æ¯æç§ row key çå­å¸åºè¿è¡æåºãè¿ééè¦æ³¨æä»¥ä¸ä¸¤ç¹ï¼\n     * å ä¸ºå­å¸åºå¯¹ int æåºçç»ææ¯ 1,10,100,11,12,13,14,15,16,17,18,19,2,20,21,â¦,9,91,92,93,94,95,96,97,98,99ãå¦æä½ ä½¿ç¨æ´åçå­ç¬¦ä¸²ä½ä¸ºè¡é®ï¼é£ä¹ä¸ºäºä¿ææ´åçèªç¶åºï¼è¡é®å¿é¡»ç¨ 0 ä½å·¦å¡«åã\n     * è¡çä¸æ¬¡è¯»åæä½æ¯åå­æ§ç (ä¸è®ºä¸æ¬¡è¯»åå¤å°å)ã\n   * ææå¯¹è¡¨çè®¿é®é½è¦éè¿ row keyï¼æä»¥ä¸ä¸ç§æ¹å¼ï¼\n     * éè¿æå®ç row key è¿è¡è®¿é®ï¼\n     * éè¿ row key ç range è¿è¡è®¿é®ï¼å³è®¿é®æå®èå´åçè¡ï¼\n     * è¿è¡å¨è¡¨æ«æã\n * column familyï¼å³åæãhbase è¡¨ä¸­çæ¯ä¸ªåï¼é½å½å±äºæä¸ªåæãåææ¯è¡¨ç schema çä¸é¨åï¼æä»¥åæéè¦å¨åå»ºè¡¨æ¶è¿è¡å®ä¹ã\n   * ä¸ä¸ªè¡¨çåæå¿é¡»ä½ä¸ºè¡¨æ¨¡å¼å®ä¹çä¸é¨åé¢åç»åºï¼ä½æ¯æ°çåææåå¯ä»¥éåæéå å¥ã\n   * åä¸ä¸ªåæçæææåå·æç¸åçåç¼ï¼ä¾å¦ info:formatï¼info:geo é½å±äº info è¿ä¸ªåæã\n * column qualifierï¼åéå®ç¬¦ãå¯ä»¥çè§£ä¸ºæ¯å·ä½çååï¼ä¾å¦ info:formatï¼info:geo é½å±äº info è¿ä¸ªåæï¼å®ä»¬çåéå®ç¬¦åå«æ¯ format å geoãåæååéå®ç¬¦ä¹é´å§ç»ä»¥åå·åéãéè¦æ³¨æçæ¯åéå®ç¬¦ä¸æ¯è¡¨ schema çä¸é¨åï¼ä½ å¯ä»¥å¨æå¥æ°æ®çè¿ç¨ä¸­å¨æåå»ºåã\n * columnï¼hbase ä¸­çåç±åæååéå®ç¬¦ç»æï¼ç± :(åå·) è¿è¡åéï¼å³ä¸ä¸ªå®æ´çåååºè¯¥è¡¨è¿°ä¸º åæå ï¼åéå®ç¬¦ã\n * cellï¼cell æ¯è¡ï¼åæååéå®ç¬¦çç»åï¼å¹¶åå«å¼åæ¶é´æ³ãhbase ä¸­éè¿ row key å column ç¡®å®çä¸ºä¸ä¸ªå­å¨ååç§°ä¸º cellï¼ä½ å¯ä»¥ç­ä»·çè§£ä¸ºå³ç³»åæ°æ®åºä¸­ç±æå®è¡åæå®åç¡®å®çä¸ä¸ªååæ ¼ï¼ä½ä¸åçæ¯ hbase ä¸­çä¸ä¸ªååæ ¼æ¯ç±å¤ä¸ªçæ¬çæ°æ®ç»æçï¼æ¯ä¸ªçæ¬çæ°æ®ç¨æ¶é´æ³è¿è¡åºåã\n   * cell ç±è¡ååçåæ äº¤åå³å®ï¼æ¯æçæ¬çãé»è®¤æåµä¸ï¼çæ¬å·æ¯èªå¨åéçï¼ä¸º hbase æå¥ cell æ¶çæ¶é´æ³ãcell çåå®¹æ¯æªè§£éçå­èæ°ç»ã\n   * \n * timestampï¼cell ççæ¬éè¿æ¶é´æ³æ¥ç´¢å¼ï¼æ¶é´æ³çç±»åæ¯ 64 ä½æ´åï¼æ¶é´æ³å¯ä»¥ç± hbase å¨æ°æ®åå¥æ¶èªå¨èµå¼ï¼ä¹å¯ä»¥ç±å®¢æ·æ¾å¼æå®ãæ¯ä¸ª cell ä¸­ï¼ä¸åçæ¬çæ°æ®æç§æ¶é´æ³ååºæåï¼å³ææ°çæ°æ®æå¨æåé¢ã\n\n\n\n\n# hbase ç©çå­å¨ç»æ\n\nhbase èªå¨å°è¡¨æ°´å¹³ååæåºåï¼regionï¼ãæ¯ä¸ª region ç±è¡¨ä¸­ row çå­éææãæ¯ä¸ª region ç±å®æå±çè¡¨çèµ·å§èå´æ¥è¡¨ç¤ºï¼åå«çç¬¬ä¸è¡åæåä¸è¡ï¼ãåå§æ¶ï¼ä¸ä¸ªè¡¨åªæä¸ä¸ª regionï¼éç region è¨èï¼å½è¶è¿ä¸å®éå¼æ¶ï¼ä¼å¨æè¡çè¾¹çä¸åè£æä¸¤ä¸ªå¤§å°åºæ¬ç¸åçæ° regionãå¨ç¬¬ä¸æ¬¡ååä¹åï¼ææå è½½çæ°æ®é½æ¾å¨åå§ region æå¨çé£å°æå¡å¨ä¸ãéçè¡¨åå¤§ï¼region ä¸ªæ°ä¹ä¼éæ¸å¢å ãregion æ¯å¨ hbase éç¾¤ä¸åå¸æ°æ®çæå°åä½ã\n\n\n# hbase æ°æ®æ¨¡åç¤ºä¾\n\nä¸å¾ä¸º hbase ä¸­ä¸å¼ è¡¨çï¼\n\n * rowkey ä¸ºè¡çå¯ä¸æ è¯ï¼ææè¡æç§ rowkey çå­å¸åºè¿è¡æåºï¼\n * è¯¥è¡¨å·æä¸¤ä¸ªåæï¼åå«æ¯ personal å office;\n * å¶ä¸­åæ personal æ¥æ nameãcityãphone ä¸ä¸ªåï¼åæ office æ¥æ telãaddres ä¸¤ä¸ªåã\n\n\n\n> å¾çå¼ç¨èª : hbase æ¯åå¼å­å¨æ°æ®åºå https://www.iteblog.com/archives/2498.html\n\n\n# hbase è¡¨ç¹æ§\n\nhbase çè¡¨å·æä»¥ä¸ç¹ç¹ï¼\n\n * å®¹éå¤§ï¼ä¸ä¸ªè¡¨å¯ä»¥ææ°åäº¿è¡ï¼ä¸ç¾ä¸åï¼\n * é¢ååï¼æ°æ®æ¯æç§åå­å¨ï¼æ¯ä¸åé½åç¬å­æ¾ï¼æ°æ®å³ç´¢å¼ï¼å¨æ¥è¯¢æ¶å¯ä»¥åªè®¿é®æå®åçæ°æ®ï¼ææå°éä½äºç³»ç»ç i/o è´æï¼\n * ç¨çæ§ï¼ç©º (null) åå¹¶ä¸å ç¨å­å¨ç©ºé´ï¼è¡¨å¯ä»¥è®¾è®¡çéå¸¸ç¨ç ï¼\n * æ°æ®å¤çæ¬ï¼æ¯ä¸ªååä¸­çæ°æ®å¯ä»¥æå¤ä¸ªçæ¬ï¼æç§æ¶é´æ³æåºï¼æ°çæ°æ®å¨æä¸é¢ï¼\n * å­å¨ç±»åï¼æææ°æ®çåºå±å­å¨æ ¼å¼é½æ¯å­èæ°ç» (byte[])ã\n\n\n# åèèµæ\n\n * å®æ¹\n   * hbase å®ç½\n   * hbase å®æ¹ææ¡£\n   * hbase å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * hadoop æå¨æå\n * æç« \n   * bigtable: a distributed storage system for structured data\n   * an in-depth look at the hbase architecture\n * æç¨\n   * https://github.com/heibaiying/bigdata-notes\n   * https://www.cloudduggu.com/hbase/introduction/",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"HBase å¿«éå¥é¨",frontmatter:{title:"HBase å¿«éå¥é¨",date:"2020-02-10T14:27:39.000Z",categories:["æ°æ®åº","åå¼æ°æ®åº","HBase"],tags:["æ°æ®åº","åå¼æ°æ®åº","å¤§æ°æ®","HBase"],permalink:"/pages/7ab03c/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/06.%E5%88%97%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93/01.HBase/01.HBase%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.html",relativePath:"12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/01.HBaseå¿«éå¥é¨.md",key:"v-d46acfd6",path:"/pages/7ab03c/",headers:[{level:2,title:"HBase ç®ä»",slug:"hbase-ç®ä»",normalizedTitle:"hbase ç®ä»",charIndex:17},{level:3,title:"ä¸ºä»ä¹éè¦ HBase",slug:"ä¸ºä»ä¹éè¦-hbase",normalizedTitle:"ä¸ºä»ä¹éè¦ hbase",charIndex:30},{level:3,title:"ä»ä¹æ¯ HBase",slug:"ä»ä¹æ¯-hbase",normalizedTitle:"ä»ä¹æ¯ hbase",charIndex:617},{level:3,title:"ä»ä¹æ¶åä½¿ç¨ HBase",slug:"ä»ä¹æ¶åä½¿ç¨-hbase",normalizedTitle:"ä»ä¹æ¶åä½¿ç¨ hbase",charIndex:1321},{level:3,title:"HBase æ°æ®æ¨¡åç®ä»",slug:"hbase-æ°æ®æ¨¡åç®ä»",normalizedTitle:"hbase æ°æ®æ¨¡åç®ä»",charIndex:1668},{level:3,title:"ç¹æ§æ¯è¾",slug:"ç¹æ§æ¯è¾",normalizedTitle:"ç¹æ§æ¯è¾",charIndex:2420},{level:4,title:"HBase vs. RDBMS",slug:"hbase-vs-rdbms",normalizedTitle:"hbase vs. rdbms",charIndex:2428},{level:4,title:"HBase vs. HDFS",slug:"hbase-vs-hdfs",normalizedTitle:"hbase vs. hdfs",charIndex:2825},{level:4,title:"è¡å¼æ°æ®åº vs. åå¼æ°æ®åº",slug:"è¡å¼æ°æ®åº-vs-åå¼æ°æ®åº",normalizedTitle:"è¡å¼æ°æ®åº vs. åå¼æ°æ®åº",charIndex:3164},{level:2,title:"HBase å®è£",slug:"hbase-å®è£",normalizedTitle:"hbase å®è£",charIndex:3569},{level:2,title:"HBase Hello World ç¤ºä¾",slug:"hbase-hello-world-ç¤ºä¾",normalizedTitle:"hbase hello world ç¤ºä¾",charIndex:3624},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:6398}],headersStr:"HBase ç®ä» ä¸ºä»ä¹éè¦ HBase ä»ä¹æ¯ HBase ä»ä¹æ¶åä½¿ç¨ HBase HBase æ°æ®æ¨¡åç®ä» ç¹æ§æ¯è¾ HBase vs. RDBMS HBase vs. HDFS è¡å¼æ°æ®åº vs. åå¼æ°æ®åº HBase å®è£ HBase Hello World ç¤ºä¾ åèèµæ",content:"# HBase å¿«éå¥é¨\n\n\n# HBase ç®ä»\n\n\n# ä¸ºä»ä¹éè¦ HBase\n\nå¨ä»ç» HBase ä¹åï¼æä»¬ä¸å¦¨åäºè§£ä¸ä¸ä¸ºä»ä¹éè¦ HBaseï¼æèè¯´ HBase æ¯ä¸ºäºè¾¾å°ä»ä¹ç®çèäº§çã\n\nå¨ HBase è¯çä¹åï¼Hadoop å¯ä»¥éè¿ HDFS æ¥å­å¨ç»æåãåç»æçè³éç»æåçæ°æ®ï¼å®æ¯ä¼ ç»æ°æ®åºçè¡¥åï¼æ¯æµ·éæ°æ®å­å¨çæä½³æ¹æ³ï¼å®éå¯¹å¤§æä»¶çå­å¨ï¼æ¹éè®¿é®åæµå¼è®¿é®é½åäºä¼åï¼åæ¶ä¹éè¿å¤å¯æ¬è§£å³äºå®¹ç¾é®é¢ã\n\nHadoop çç¼ºé·å¨äºï¼å®åªè½æ§è¡æ¹å¤çï¼å¹¶ä¸åªè½ä»¥é¡ºåºæ¹å¼è®¿é®æ°æ®ãè¿æå³çå³ä½¿æ¯æç®åçå·¥ä½ï¼ä¹å¿é¡»æç´¢æ´ä¸ªæ°æ®éï¼å³ï¼Hadoop æ æ³å®ç°å¯¹æ°æ®çéæºè®¿é®ãå®ç°æ°æ®çéæºè®¿é®æ¯ä¼ ç»çå³ç³»åæ°æ®åºææé¿çï¼ä½å®ä»¬å´ä¸è½ç¨äºæµ·éæ°æ®çå­å¨ãå¨è¿ç§æåµä¸ï¼å¿é¡»æä¸ç§æ°çæ¹æ¡æ¥åæ¶è§£å³æµ·éæ°æ®å­å¨åéæºè®¿é®çé®é¢ï¼HBase å°±æ¯å¶ä¸­ä¹ä¸ (HBaseï¼Cassandraï¼couchDBï¼Dynamo å MongoDB é½è½å­å¨æµ·éæ°æ®å¹¶æ¯æéæºè®¿é®)ã\n\n> æ³¨ï¼æ°æ®ç»æåç±»ï¼\n> \n>  * ç»æåæ°æ®ï¼å³ä»¥å³ç³»åæ°æ®åºè¡¨å½¢å¼ç®¡ççæ°æ®ï¼\n>  * åç»æåæ°æ®ï¼éå³ç³»æ¨¡åçï¼æåºæ¬åºå®ç»ææ¨¡å¼çæ°æ®ï¼ä¾å¦æ¥å¿æä»¶ãXML ææ¡£ãJSON ææ¡£ãEmail ç­ï¼\n>  * éç»æåæ°æ®ï¼æ²¡æåºå®æ¨¡å¼çæ°æ®ï¼å¦ WORDãPDFãPPTãEXLï¼åç§æ ¼å¼çå¾çãè§é¢ç­ã\n\n\n# ä»ä¹æ¯ HBase\n\nHBase æ¯ä¸ä¸ªæå»ºå¨ HDFSï¼Hadoop æä»¶ç³»ç»ï¼ä¹ä¸çåå¼æ°æ®åºã\n\nHBase æ¯ä¸ç§ç±»ä¼¼äº Googleâs Big Table çæ°æ®æ¨¡åï¼å®æ¯ Hadoop çæç³»ç»çä¸é¨åï¼å®å°æ°æ®å­å¨å¨ HDFS ä¸ï¼å®¢æ·ç«¯å¯ä»¥éè¿ HBase å®ç°å¯¹ HDFS ä¸æ°æ®çéæºè®¿é®ã\n\n\n\nHBase çæ ¸å¿ç¹æ§å¦ä¸ï¼\n\n * åå¸å¼\n   * ä¼¸ç¼©æ§ï¼æ¯æéè¿å¢åæºå¨è¿è¡æ°´å¹³æ©å±ï¼ä»¥æåæ´ä½å®¹éåæ§è½\n   * é«å¯ç¨ï¼æ¯æ RegionServers ä¹é´çèªå¨æéè½¬ç§»\n   * èªå¨ååºï¼Region åæ£å¨éç¾¤ä¸­ï¼å½è¡æ°å¢é¿çæ¶åï¼Region ä¹ä¼èªå¨çååºååè¡¡\n * è¶å¤§æ°æ®éï¼HBase è¢«è®¾è®¡ç¨æ¥è¯»åè¶å¤§è§æ¨¡çæ°æ®éï¼æ°åäº¿è¡è³æ°ç¾äº¿è¡çè¡¨ï¼\n * æ¯æç»æåãåç»æååéç»æåçæ°æ®ï¼ç±äº HBase åºäº HDFS æå»ºï¼æä»¥å HDFS ä¸æ ·ï¼æ¯æç»æåãåç»æååéç»æåçæ°æ®\n * éå³ç³»åæ°æ®åº\n   * ä¸æ¯ææ å SQL è¯­æ³\n   * æ²¡æçæ­£çç´¢å¼\n   * ä¸æ¯æå¤æçäºå¡ï¼åªæ¯æè¡çº§äºå¡ï¼å³åè¡æ°æ®çè¯»åé½æ¯åå­æ§ç\n\nHBase çå¶ä»ç¹æ§\n\n * è¯»åæä½éµå¾ªå¼ºä¸è´æ§\n * è¿æ»¤å¨æ¯æè°è¯ä¸æ¨\n * æäºä½¿ç¨ç Java å®¢æ·ç«¯ API\n * å®æ¯æçº¿æ§åæ¨¡ååå¯æ©å±æ§ã\n * HBase è¡¨æ¯æ Hadoop MapReduce ä½ä¸çä¾¿æ·åºç±»\n * å¾å®¹æä½¿ç¨ Java API è¿è¡å®¢æ·ç«¯è®¿é®\n * ä¸ºå®æ¶æ¥è¯¢æä¾åç¼å­ BlockCache åå¸éè¿æ»¤å¨\n * å®éè¿æå¡å¨ç«¯è¿æ»¤å¨æä¾æ¥è¯¢è°è¯ä¸æ¨\n\n\n# ä»ä¹æ¶åä½¿ç¨ HBase\n\næ ¹æ®ä¸ä¸èå¯¹äº HBase ç¹æ§çä»ç»ï¼æä»¬å¯ä»¥æ¢³çåº HBase éç¨ãä¸éç¨çåºæ¯ï¼\n\nHBase ä¸éç¨åºæ¯ï¼\n\n * éè¦ç´¢å¼\n * éè¦å¤æçäºå¡\n * æ°æ®éè¾å°ï¼æ¯å¦ï¼æ°æ®éä¸è¶³å ç¾ä¸è¡ï¼\n\nHBase éç¨åºæ¯ï¼\n\n * è½å­å¨æµ·éæ°æ®å¹¶æ¯æéæºè®¿é®ï¼æ¯å¦ï¼æ°æ®éçº§è¾¾å°åäº¿çº§è³ç¾äº¿çº§ï¼\n * å­å¨ç»æåãåç»æåæ°æ®\n * ç¡¬ä»¶èµæºåè¶³\n\n> ä¸è¨ä»¥è½ä¹ââHBase éç¨çåºæ¯æ¯ï¼å®æ¶å°éæºè®¿é®è¶å¤§æ°æ®éã\n\nHBase çå¸ååºç¨åºæ¯\n\n * å­å¨çæ§æ°æ®\n * å­å¨ç¨æ·/è½¦è¾ GPS ä¿¡æ¯\n * å­å¨ç¨æ·è¡ä¸ºæ°æ®\n * å­å¨åç§æ¥å¿æ°æ®ï¼å¦ï¼è®¿é®æ¥å¿ãæä½æ¥å¿ãæ¨éæ¥å¿ç­ã\n * å­å¨ç­ä¿¡ãé®ä»¶ç­æ¶æ¯ç±»æ°æ®\n * å­å¨ç½é¡µæ°æ®\n\n\n# HBase æ°æ®æ¨¡åç®ä»\n\nåé¢å·²ç»æåï¼HBase æ¯ä¸ä¸ªåå¼æ°æ®åºï¼å¶æ°æ®æ¨¡ååå³ç³»åæ°æ®åºææä¸åãå¶æ°æ®æ¨¡åçå³é®æ¯è¯­å¦ä¸ï¼\n\n * Tableï¼HBase è¡¨ç±å¤è¡ç»æã\n * Rowï¼HBase ä¸­çä¸è¡ç±ä¸ä¸ªè¡é®åä¸ä¸ªæå¤ä¸ªåä»¥åä¸ä¹å³èçå¼ç»æã è¡å¨å­å¨æ¶æè¡é®çå­æ¯é¡ºåºæåºã ä¸ºæ­¤ï¼è¡é®çè®¾è®¡éå¸¸éè¦ã ç®æ æ¯ä»¥ç¸å³è¡å½¼æ­¤é è¿çæ¹å¼å­å¨æ°æ®ã å¸¸è§çè¡é®æ¨¡å¼æ¯ç½ç«åã å¦ææ¨çè¡é®æ¯åï¼æ¨åºè¯¥å°å®ä»¬ååå­å¨ï¼org.apache.wwwãorg.apache.mailãorg.apache.jiraï¼ã è¿æ ·ï¼ææ Apache åå¨è¡¨ä¸­å½¼æ­¤é è¿ï¼èä¸æ¯æ ¹æ®å­åçç¬¬ä¸ä¸ªå­æ¯å±å¼ã\n * Columnï¼HBase ä¸­çåç±åæååéå®ç¬¦ç»æï¼å®ä»¬ç± :ï¼åå·ï¼å­ç¬¦åéã\n * Column Familyï¼éå¸¸åºäºæ§è½åå ï¼åæå¨ç©çä¸å°ä¸ç»ååå¶å¼æ¾å¨ä¸èµ·ã æ¯ä¸ªåæé½æä¸ç»å­å¨å±æ§ï¼ä¾å¦å®çå¼æ¯å¦åºè¯¥ç¼å­å¨åå­ä¸­ï¼å®çæ°æ®æ¯å¦ä½åç¼©çï¼å®çè¡é®æ¯å¦ä½ç¼ç çï¼ç­ç­ã è¡¨ä¸­çæ¯ä¸è¡é½æç¸åçåæï¼å°½ç®¡ç»å®çè¡å¯è½ä¸å¨ç»å®çåæä¸­å­å¨ä»»ä½åå®¹ã\n * åéå®ç¬¦ï¼å°åéå®ç¬¦æ·»å å°åæä»¥æä¾ç»å®æ°æ®çæ®µçç´¢å¼ã ç»å®åæåå®¹ï¼åéå®ç¬¦å¯è½æ¯ content:htmlï¼å¦ä¸ä¸ªå¯è½æ¯ content:pdfã å°½ç®¡åæå¨è¡¨åå»ºæ¶æ¯åºå®çï¼ä½åéå®ç¬¦æ¯å¯åçï¼å¹¶ä¸è¡ä¹é´å¯è½æå¾å¤§å·®å¼ã\n * Cellï¼ååæ ¼æ¯è¡ãåæååéå®ç¬¦çç»åï¼åå«ä¸ä¸ªå¼åä¸ä¸ªæ¶é´æ³ï¼ä»£è¡¨å¼ççæ¬ã\n * Timestampï¼æ¶é´æ³åå¨æ¯ä¸ªå¼æè¾¹ï¼æ¯ç»å®çæ¬å¼çæ è¯ç¬¦ã é»è®¤æåµä¸ï¼æ¶é´æ³è¡¨ç¤ºåå¥æ°æ®æ¶ RegionServer ä¸çæ¶é´ï¼ä½æ¨å¯ä»¥å¨å°æ°æ®æ¾å¥ååæ ¼æ¶æå®ä¸åçæ¶é´æ³å¼ã\n\n\n\n\n# ç¹æ§æ¯è¾\n\n# HBase vs. RDBMS\n\nRDBMS                     HBASE\nRDBMS æå®çæ¨¡å¼ï¼æè¿°è¡¨çæ´ä½ç»æççº¦æ   HBase æ æ¨¡å¼ï¼å®ä¸å·æåºå®åæ¨¡å¼çæ¦å¿µï¼ä»å®ä¹åæ\næ¯æçæä»¶ç³»ç»æ FATãNTFS å EXT   æ¯æçæä»¶ç³»ç»åªæ HDFS\nä½¿ç¨æäº¤æ¥å¿æ¥å­å¨æ¥å¿               ä½¿ç¨é¢åæ¥å¿ (WAL) æ¥å­å¨æ¥å¿\nä½¿ç¨ç¹å®çåè°ç³»ç»æ¥åè°éç¾¤            ä½¿ç¨ ZooKeeper æ¥åè°éç¾¤\nå­å¨çé½æ¯ä¸­å°è§æ¨¡çæ°æ®è¡¨             å­å¨çæ¯è¶å¤§è§æ¨¡çæ°æ®è¡¨ï¼å¹¶ä¸éåå­å¨å®½è¡¨\néå¸¸æ¯æå¤æçäºå¡                 ä»æ¯æè¡çº§äºå¡\néç¨äºç»æåæ°æ®                  éç¨äºåç»æåãç»æåæ°æ®\nä½¿ç¨ä¸»é®                      ä½¿ç¨ row key\n\n# HBase vs. HDFS\n\nHDFS                      HBASE\nHDFS æä¾äºä¸ä¸ªç¨äºåå¸å¼å­å¨çæä»¶ç³»ç»ã   HBase æä¾é¢åè¡¨æ ¼åçæ°æ®å­å¨ã\nHDFS ä¸ºå¤§æä»¶æä¾ä¼åå­å¨ã          HBase ä¸ºè¡¨æ ¼æ°æ®æä¾äºä¼åã\nHDFS ä½¿ç¨åæä»¶ã               HBase ä½¿ç¨é®å¼å¯¹æ°æ®ã\nHDFS æ°æ®æ¨¡åä¸çµæ´»ã             HBase æä¾äºä¸ä¸ªçµæ´»çæ°æ®æ¨¡åã\nHDFS ä½¿ç¨æä»¶ç³»ç»åå¤çæ¡æ¶ã         HBase ä½¿ç¨å¸¦æåç½® Hadoop MapReduce æ¯æçè¡¨æ ¼å­å¨ã\nHDFS ä¸»è¦éå¯¹ä¸æ¬¡åå¥å¤æ¬¡è¯»åè¿è¡äºä¼åã   HBase éå¯¹è¯»/åè®¸å¤è¿è¡äºä¼åã\n\n# è¡å¼æ°æ®åº vs. åå¼æ°æ®åº\n\nè¡å¼æ°æ®åº               åå¼æ°æ®åº\nå¯¹äºæ·»å /ä¿®æ¹æä½æ´é«æ        å¯¹äºè¯»åæä½æ´é«æ\nè¯»åæ´è¡æ°æ®              ä»è¯»åå¿è¦çåæ°æ®\næéåå¨çº¿äºå¡å¤çç³»ç»ï¼OLTPï¼   ä¸éåå¨çº¿äºå¡å¤çç³»ç»ï¼OLTPï¼\nå°è¡æ°æ®å­å¨å¨è¿ç»­çé¡µåå­ä¸­      å°åæ°æ®å­å¨å¨éè¿ç»­çé¡µåå­ä¸­\n\nåå¼æ°æ®åºçä¼ç¹ï¼\n\n * æ¯ææ°æ®åç¼©\n * æ¯æå¿«éæ°æ®æ£ç´¢\n * ç®åäºç®¡çåéç½®\n * æå©äºèåæ¥è¯¢ï¼ä¾å¦ COUNTãSUMãAVGãMIN å MAXï¼çé«æ§è½\n * ååºæçå¾é«ï¼å ä¸ºå®æä¾äºèªå¨åçæºå¶çåè½ï¼å¯ä»¥å°è¾å¤§çåºååéç»è¾å°çåºå\n\nåå¼æ°æ®åºçç¼ºç¹ï¼\n\n * JOIN æ¥è¯¢åæ¥èªå¤ä¸ªè¡¨çæ°æ®æªä¼å\n * å¿é¡»ä¸ºé¢ç¹çå é¤åæ´æ°åå»ºæåï¼å æ­¤éä½äºå­å¨æç\n * ç±äºéå³ç³»æ°æ®åºçç¹æ§ï¼ååºåç´¢å¼çè®¾è®¡éå¸¸å°é¾\n\n\n# HBase å®è£\n\n * ç¬ç«æ¨¡å¼\n * ä¼ªåå¸å¼æ¨¡å¼\n * å¨åå¸å¼æ¨¡å¼\n * Docker é¨ç½²\n\n\n# HBase Hello World ç¤ºä¾\n\n 1.  è¿æ¥ HBase\n     \n     å¨ HBase å®è£ç®å½ç /bin ç®å½ä¸æ§è¡ hbase shell å½ä»¤è¿å¥ HBase æ§å¶å°ã\n     \n     $ ./bin/hbase shell\n     hbase(main):001:0>\n     \n\n 2.  è¾å¥ help å¯ä»¥æ¥ç HBase Shell å½ä»¤ã\n\n 3.  åå»ºè¡¨\n     \n     å¯ä»¥ä½¿ç¨ create å½ä»¤åå»ºä¸å¼ æ°è¡¨ãå¿é¡»è¦æå®è¡¨åå Column Familyã\n     \n     hbase(main):001:0> create 'test', 'cf'\n     0 row(s) in 0.4170 seconds\n     \n     => Hbase::Table - test\n     \n\n 4.  ååºè¡¨ä¿¡æ¯\n     \n     ä½¿ç¨ list å½ä»¤æ¥ç¡®è®¤æ°å»ºçè¡¨å·²å­å¨ã\n     \n     hbase(main):002:0> list 'test'\n     TABLE\n     test\n     1 row(s) in 0.0180 seconds\n     \n     => [\"test\"]\n     \n     \n     å¯ä»¥ä½¿ç¨ describe å½ä»¤å¯ä»¥æ¥çè¡¨çç»èä¿¡æ¯ï¼åæ¬éç½®ä¿¡æ¯\n     \n     hbase(main):003:0> describe 'test'\n     Table test is ENABLED\n     test\n     COLUMN FAMILIES DESCRIPTION\n     {NAME => 'cf', VERSIONS => '1', EVICT_BLOCKS_ON_CLOSE => 'false', NEW_VERSION_BEHAVIOR => 'false', KEEP_DELETED_CELLS => 'FALSE', CACHE_DATA_ON_WRITE =>\n     'false', DATA_BLOCK_ENCODING => 'NONE', TTL => 'FOREVER', MIN_VERSIONS => '0', REPLICATION_SCOPE => '0', BLOOMFILTER => 'ROW', CACHE_INDEX_ON_WRITE => 'f\n     alse', IN_MEMORY => 'false', CACHE_BLOOMS_ON_WRITE => 'false', PREFETCH_BLOCKS_ON_OPEN => 'false', COMPRESSION => 'NONE', BLOCKCACHE => 'true', BLOCKSIZE\n      => '65536'}\n     1 row(s)\n     Took 0.9998 seconds\n     \n\n 5.  åè¡¨ä¸­åæ°æ®\n     \n     å¯ä»¥ä½¿ç¨ put å½ä»¤å HBase è¡¨ä¸­åæ°æ®ã\n     \n     hbase(main):003:0> put 'test', 'row1', 'cf:a', 'value1'\n     0 row(s) in 0.0850 seconds\n     \n     hbase(main):004:0> put 'test', 'row2', 'cf:b', 'value2'\n     0 row(s) in 0.0110 seconds\n     \n     hbase(main):005:0> put 'test', 'row3', 'cf:c', 'value3'\n     0 row(s) in 0.0100 seconds\n     \n\n 6.  ä¸æ¬¡æ§æ«æè¡¨çæææ°æ®\n     \n     ä½¿ç¨ scan å½ä»¤æ¥æ«æè¡¨æ°æ®ã\n     \n     hbase(main):006:0> scan 'test'\n     ROW                                      COLUMN+CELL\n      row1                                    column=cf:a, timestamp=1421762485768, value=value1\n      row2                                    column=cf:b, timestamp=1421762491785, value=value2\n      row3                                    column=cf:c, timestamp=1421762496210, value=value3\n     3 row(s) in 0.0230 seconds\n     \n\n 7.  æ¥çä¸è¡æ°æ®\n     \n     ä½¿ç¨ get å½ä»¤å¯ä»¥æ¥çä¸è¡è¡¨æ°æ®ã\n     \n     hbase(main):007:0> get 'test', 'row1'\n     COLUMN                                   CELL\n      cf:a                                    timestamp=1421762485768, value=value1\n     1 row(s) in 0.0350 seconds\n     \n\n 8.  ç¦ç¨è¡¨\n     \n     å¦ææ³è¦å é¤è¡¨æä¿®æ¹è¡¨è®¾ç½®ï¼å¿é¡»åä½¿ç¨ disable å½ä»¤ç¦ç¨è¡¨ãå¦ææ³åæ¬¡å¯ç¨è¡¨ï¼å¯ä»¥ä½¿ç¨ enable å½ä»¤ã\n     \n     hbase(main):008:0> disable 'test'\n     0 row(s) in 1.1820 seconds\n     \n     hbase(main):009:0> enable 'test'\n     0 row(s) in 0.1770 seconds\n     \n\n 9.  å é¤è¡¨\n     \n     ä½¿ç¨ drop å½ä»¤å¯ä»¥å é¤è¡¨ã\n     \n     hbase(main):011:0> drop 'test'\n     0 row(s) in 0.1370 seconds\n     \n\n 10. éåº HBase Shell\n     \n     ä½¿ç¨ quit å½ä»¤ï¼å°±è½éåº HBase Shell æ§å¶å°ã\n\n\n# åèèµæ\n\n * å®æ¹\n   * HBase å®ç½\n   * HBase å®æ¹ææ¡£\n   * HBase å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * Hadoop æå¨æå\n * æç« \n   * Bigtable: A Distributed Storage System for Structured Data\n   * An In-Depth Look at the HBase Architecture\n * æç¨\n   * https://github.com/heibaiying/BigData-Notes\n   * https://www.cloudduggu.com/hbase/introduction/",normalizedContent:"# hbase å¿«éå¥é¨\n\n\n# hbase ç®ä»\n\n\n# ä¸ºä»ä¹éè¦ hbase\n\nå¨ä»ç» hbase ä¹åï¼æä»¬ä¸å¦¨åäºè§£ä¸ä¸ä¸ºä»ä¹éè¦ hbaseï¼æèè¯´ hbase æ¯ä¸ºäºè¾¾å°ä»ä¹ç®çèäº§çã\n\nå¨ hbase è¯çä¹åï¼hadoop å¯ä»¥éè¿ hdfs æ¥å­å¨ç»æåãåç»æçè³éç»æåçæ°æ®ï¼å®æ¯ä¼ ç»æ°æ®åºçè¡¥åï¼æ¯æµ·éæ°æ®å­å¨çæä½³æ¹æ³ï¼å®éå¯¹å¤§æä»¶çå­å¨ï¼æ¹éè®¿é®åæµå¼è®¿é®é½åäºä¼åï¼åæ¶ä¹éè¿å¤å¯æ¬è§£å³äºå®¹ç¾é®é¢ã\n\nhadoop çç¼ºé·å¨äºï¼å®åªè½æ§è¡æ¹å¤çï¼å¹¶ä¸åªè½ä»¥é¡ºåºæ¹å¼è®¿é®æ°æ®ãè¿æå³çå³ä½¿æ¯æç®åçå·¥ä½ï¼ä¹å¿é¡»æç´¢æ´ä¸ªæ°æ®éï¼å³ï¼hadoop æ æ³å®ç°å¯¹æ°æ®çéæºè®¿é®ãå®ç°æ°æ®çéæºè®¿é®æ¯ä¼ ç»çå³ç³»åæ°æ®åºææé¿çï¼ä½å®ä»¬å´ä¸è½ç¨äºæµ·éæ°æ®çå­å¨ãå¨è¿ç§æåµä¸ï¼å¿é¡»æä¸ç§æ°çæ¹æ¡æ¥åæ¶è§£å³æµ·éæ°æ®å­å¨åéæºè®¿é®çé®é¢ï¼hbase å°±æ¯å¶ä¸­ä¹ä¸ (hbaseï¼cassandraï¼couchdbï¼dynamo å mongodb é½è½å­å¨æµ·éæ°æ®å¹¶æ¯æéæºè®¿é®)ã\n\n> æ³¨ï¼æ°æ®ç»æåç±»ï¼\n> \n>  * ç»æåæ°æ®ï¼å³ä»¥å³ç³»åæ°æ®åºè¡¨å½¢å¼ç®¡ççæ°æ®ï¼\n>  * åç»æåæ°æ®ï¼éå³ç³»æ¨¡åçï¼æåºæ¬åºå®ç»ææ¨¡å¼çæ°æ®ï¼ä¾å¦æ¥å¿æä»¶ãxml ææ¡£ãjson ææ¡£ãemail ç­ï¼\n>  * éç»æåæ°æ®ï¼æ²¡æåºå®æ¨¡å¼çæ°æ®ï¼å¦ wordãpdfãpptãexlï¼åç§æ ¼å¼çå¾çãè§é¢ç­ã\n\n\n# ä»ä¹æ¯ hbase\n\nhbase æ¯ä¸ä¸ªæå»ºå¨ hdfsï¼hadoop æä»¶ç³»ç»ï¼ä¹ä¸çåå¼æ°æ®åºã\n\nhbase æ¯ä¸ç§ç±»ä¼¼äº googleâs big table çæ°æ®æ¨¡åï¼å®æ¯ hadoop çæç³»ç»çä¸é¨åï¼å®å°æ°æ®å­å¨å¨ hdfs ä¸ï¼å®¢æ·ç«¯å¯ä»¥éè¿ hbase å®ç°å¯¹ hdfs ä¸æ°æ®çéæºè®¿é®ã\n\n\n\nhbase çæ ¸å¿ç¹æ§å¦ä¸ï¼\n\n * åå¸å¼\n   * ä¼¸ç¼©æ§ï¼æ¯æéè¿å¢åæºå¨è¿è¡æ°´å¹³æ©å±ï¼ä»¥æåæ´ä½å®¹éåæ§è½\n   * é«å¯ç¨ï¼æ¯æ regionservers ä¹é´çèªå¨æéè½¬ç§»\n   * èªå¨ååºï¼region åæ£å¨éç¾¤ä¸­ï¼å½è¡æ°å¢é¿çæ¶åï¼region ä¹ä¼èªå¨çååºååè¡¡\n * è¶å¤§æ°æ®éï¼hbase è¢«è®¾è®¡ç¨æ¥è¯»åè¶å¤§è§æ¨¡çæ°æ®éï¼æ°åäº¿è¡è³æ°ç¾äº¿è¡çè¡¨ï¼\n * æ¯æç»æåãåç»æååéç»æåçæ°æ®ï¼ç±äº hbase åºäº hdfs æå»ºï¼æä»¥å hdfs ä¸æ ·ï¼æ¯æç»æåãåç»æååéç»æåçæ°æ®\n * éå³ç³»åæ°æ®åº\n   * ä¸æ¯ææ å sql è¯­æ³\n   * æ²¡æçæ­£çç´¢å¼\n   * ä¸æ¯æå¤æçäºå¡ï¼åªæ¯æè¡çº§äºå¡ï¼å³åè¡æ°æ®çè¯»åé½æ¯åå­æ§ç\n\nhbase çå¶ä»ç¹æ§\n\n * è¯»åæä½éµå¾ªå¼ºä¸è´æ§\n * è¿æ»¤å¨æ¯æè°è¯ä¸æ¨\n * æäºä½¿ç¨ç java å®¢æ·ç«¯ api\n * å®æ¯æçº¿æ§åæ¨¡ååå¯æ©å±æ§ã\n * hbase è¡¨æ¯æ hadoop mapreduce ä½ä¸çä¾¿æ·åºç±»\n * å¾å®¹æä½¿ç¨ java api è¿è¡å®¢æ·ç«¯è®¿é®\n * ä¸ºå®æ¶æ¥è¯¢æä¾åç¼å­ blockcache åå¸éè¿æ»¤å¨\n * å®éè¿æå¡å¨ç«¯è¿æ»¤å¨æä¾æ¥è¯¢è°è¯ä¸æ¨\n\n\n# ä»ä¹æ¶åä½¿ç¨ hbase\n\næ ¹æ®ä¸ä¸èå¯¹äº hbase ç¹æ§çä»ç»ï¼æä»¬å¯ä»¥æ¢³çåº hbase éç¨ãä¸éç¨çåºæ¯ï¼\n\nhbase ä¸éç¨åºæ¯ï¼\n\n * éè¦ç´¢å¼\n * éè¦å¤æçäºå¡\n * æ°æ®éè¾å°ï¼æ¯å¦ï¼æ°æ®éä¸è¶³å ç¾ä¸è¡ï¼\n\nhbase éç¨åºæ¯ï¼\n\n * è½å­å¨æµ·éæ°æ®å¹¶æ¯æéæºè®¿é®ï¼æ¯å¦ï¼æ°æ®éçº§è¾¾å°åäº¿çº§è³ç¾äº¿çº§ï¼\n * å­å¨ç»æåãåç»æåæ°æ®\n * ç¡¬ä»¶èµæºåè¶³\n\n> ä¸è¨ä»¥è½ä¹ââhbase éç¨çåºæ¯æ¯ï¼å®æ¶å°éæºè®¿é®è¶å¤§æ°æ®éã\n\nhbase çå¸ååºç¨åºæ¯\n\n * å­å¨çæ§æ°æ®\n * å­å¨ç¨æ·/è½¦è¾ gps ä¿¡æ¯\n * å­å¨ç¨æ·è¡ä¸ºæ°æ®\n * å­å¨åç§æ¥å¿æ°æ®ï¼å¦ï¼è®¿é®æ¥å¿ãæä½æ¥å¿ãæ¨éæ¥å¿ç­ã\n * å­å¨ç­ä¿¡ãé®ä»¶ç­æ¶æ¯ç±»æ°æ®\n * å­å¨ç½é¡µæ°æ®\n\n\n# hbase æ°æ®æ¨¡åç®ä»\n\nåé¢å·²ç»æåï¼hbase æ¯ä¸ä¸ªåå¼æ°æ®åºï¼å¶æ°æ®æ¨¡ååå³ç³»åæ°æ®åºææä¸åãå¶æ°æ®æ¨¡åçå³é®æ¯è¯­å¦ä¸ï¼\n\n * tableï¼hbase è¡¨ç±å¤è¡ç»æã\n * rowï¼hbase ä¸­çä¸è¡ç±ä¸ä¸ªè¡é®åä¸ä¸ªæå¤ä¸ªåä»¥åä¸ä¹å³èçå¼ç»æã è¡å¨å­å¨æ¶æè¡é®çå­æ¯é¡ºåºæåºã ä¸ºæ­¤ï¼è¡é®çè®¾è®¡éå¸¸éè¦ã ç®æ æ¯ä»¥ç¸å³è¡å½¼æ­¤é è¿çæ¹å¼å­å¨æ°æ®ã å¸¸è§çè¡é®æ¨¡å¼æ¯ç½ç«åã å¦ææ¨çè¡é®æ¯åï¼æ¨åºè¯¥å°å®ä»¬ååå­å¨ï¼org.apache.wwwãorg.apache.mailãorg.apache.jiraï¼ã è¿æ ·ï¼ææ apache åå¨è¡¨ä¸­å½¼æ­¤é è¿ï¼èä¸æ¯æ ¹æ®å­åçç¬¬ä¸ä¸ªå­æ¯å±å¼ã\n * columnï¼hbase ä¸­çåç±åæååéå®ç¬¦ç»æï¼å®ä»¬ç± :ï¼åå·ï¼å­ç¬¦åéã\n * column familyï¼éå¸¸åºäºæ§è½åå ï¼åæå¨ç©çä¸å°ä¸ç»ååå¶å¼æ¾å¨ä¸èµ·ã æ¯ä¸ªåæé½æä¸ç»å­å¨å±æ§ï¼ä¾å¦å®çå¼æ¯å¦åºè¯¥ç¼å­å¨åå­ä¸­ï¼å®çæ°æ®æ¯å¦ä½åç¼©çï¼å®çè¡é®æ¯å¦ä½ç¼ç çï¼ç­ç­ã è¡¨ä¸­çæ¯ä¸è¡é½æç¸åçåæï¼å°½ç®¡ç»å®çè¡å¯è½ä¸å¨ç»å®çåæä¸­å­å¨ä»»ä½åå®¹ã\n * åéå®ç¬¦ï¼å°åéå®ç¬¦æ·»å å°åæä»¥æä¾ç»å®æ°æ®çæ®µçç´¢å¼ã ç»å®åæåå®¹ï¼åéå®ç¬¦å¯è½æ¯ content:htmlï¼å¦ä¸ä¸ªå¯è½æ¯ content:pdfã å°½ç®¡åæå¨è¡¨åå»ºæ¶æ¯åºå®çï¼ä½åéå®ç¬¦æ¯å¯åçï¼å¹¶ä¸è¡ä¹é´å¯è½æå¾å¤§å·®å¼ã\n * cellï¼ååæ ¼æ¯è¡ãåæååéå®ç¬¦çç»åï¼åå«ä¸ä¸ªå¼åä¸ä¸ªæ¶é´æ³ï¼ä»£è¡¨å¼ççæ¬ã\n * timestampï¼æ¶é´æ³åå¨æ¯ä¸ªå¼æè¾¹ï¼æ¯ç»å®çæ¬å¼çæ è¯ç¬¦ã é»è®¤æåµä¸ï¼æ¶é´æ³è¡¨ç¤ºåå¥æ°æ®æ¶ regionserver ä¸çæ¶é´ï¼ä½æ¨å¯ä»¥å¨å°æ°æ®æ¾å¥ååæ ¼æ¶æå®ä¸åçæ¶é´æ³å¼ã\n\n\n\n\n# ç¹æ§æ¯è¾\n\n# hbase vs. rdbms\n\nrdbms                     hbase\nrdbms æå®çæ¨¡å¼ï¼æè¿°è¡¨çæ´ä½ç»æççº¦æ   hbase æ æ¨¡å¼ï¼å®ä¸å·æåºå®åæ¨¡å¼çæ¦å¿µï¼ä»å®ä¹åæ\næ¯æçæä»¶ç³»ç»æ fatãntfs å ext   æ¯æçæä»¶ç³»ç»åªæ hdfs\nä½¿ç¨æäº¤æ¥å¿æ¥å­å¨æ¥å¿               ä½¿ç¨é¢åæ¥å¿ (wal) æ¥å­å¨æ¥å¿\nä½¿ç¨ç¹å®çåè°ç³»ç»æ¥åè°éç¾¤            ä½¿ç¨ zookeeper æ¥åè°éç¾¤\nå­å¨çé½æ¯ä¸­å°è§æ¨¡çæ°æ®è¡¨             å­å¨çæ¯è¶å¤§è§æ¨¡çæ°æ®è¡¨ï¼å¹¶ä¸éåå­å¨å®½è¡¨\néå¸¸æ¯æå¤æçäºå¡                 ä»æ¯æè¡çº§äºå¡\néç¨äºç»æåæ°æ®                  éç¨äºåç»æåãç»æåæ°æ®\nä½¿ç¨ä¸»é®                      ä½¿ç¨ row key\n\n# hbase vs. hdfs\n\nhdfs                      hbase\nhdfs æä¾äºä¸ä¸ªç¨äºåå¸å¼å­å¨çæä»¶ç³»ç»ã   hbase æä¾é¢åè¡¨æ ¼åçæ°æ®å­å¨ã\nhdfs ä¸ºå¤§æä»¶æä¾ä¼åå­å¨ã          hbase ä¸ºè¡¨æ ¼æ°æ®æä¾äºä¼åã\nhdfs ä½¿ç¨åæä»¶ã               hbase ä½¿ç¨é®å¼å¯¹æ°æ®ã\nhdfs æ°æ®æ¨¡åä¸çµæ´»ã             hbase æä¾äºä¸ä¸ªçµæ´»çæ°æ®æ¨¡åã\nhdfs ä½¿ç¨æä»¶ç³»ç»åå¤çæ¡æ¶ã         hbase ä½¿ç¨å¸¦æåç½® hadoop mapreduce æ¯æçè¡¨æ ¼å­å¨ã\nhdfs ä¸»è¦éå¯¹ä¸æ¬¡åå¥å¤æ¬¡è¯»åè¿è¡äºä¼åã   hbase éå¯¹è¯»/åè®¸å¤è¿è¡äºä¼åã\n\n# è¡å¼æ°æ®åº vs. åå¼æ°æ®åº\n\nè¡å¼æ°æ®åº               åå¼æ°æ®åº\nå¯¹äºæ·»å /ä¿®æ¹æä½æ´é«æ        å¯¹äºè¯»åæä½æ´é«æ\nè¯»åæ´è¡æ°æ®              ä»è¯»åå¿è¦çåæ°æ®\næéåå¨çº¿äºå¡å¤çç³»ç»ï¼oltpï¼   ä¸éåå¨çº¿äºå¡å¤çç³»ç»ï¼oltpï¼\nå°è¡æ°æ®å­å¨å¨è¿ç»­çé¡µåå­ä¸­      å°åæ°æ®å­å¨å¨éè¿ç»­çé¡µåå­ä¸­\n\nåå¼æ°æ®åºçä¼ç¹ï¼\n\n * æ¯ææ°æ®åç¼©\n * æ¯æå¿«éæ°æ®æ£ç´¢\n * ç®åäºç®¡çåéç½®\n * æå©äºèåæ¥è¯¢ï¼ä¾å¦ countãsumãavgãmin å maxï¼çé«æ§è½\n * ååºæçå¾é«ï¼å ä¸ºå®æä¾äºèªå¨åçæºå¶çåè½ï¼å¯ä»¥å°è¾å¤§çåºååéç»è¾å°çåºå\n\nåå¼æ°æ®åºçç¼ºç¹ï¼\n\n * join æ¥è¯¢åæ¥èªå¤ä¸ªè¡¨çæ°æ®æªä¼å\n * å¿é¡»ä¸ºé¢ç¹çå é¤åæ´æ°åå»ºæåï¼å æ­¤éä½äºå­å¨æç\n * ç±äºéå³ç³»æ°æ®åºçç¹æ§ï¼ååºåç´¢å¼çè®¾è®¡éå¸¸å°é¾\n\n\n# hbase å®è£\n\n * ç¬ç«æ¨¡å¼\n * ä¼ªåå¸å¼æ¨¡å¼\n * å¨åå¸å¼æ¨¡å¼\n * docker é¨ç½²\n\n\n# hbase hello world ç¤ºä¾\n\n 1.  è¿æ¥ hbase\n     \n     å¨ hbase å®è£ç®å½ç /bin ç®å½ä¸æ§è¡ hbase shell å½ä»¤è¿å¥ hbase æ§å¶å°ã\n     \n     $ ./bin/hbase shell\n     hbase(main):001:0>\n     \n\n 2.  è¾å¥ help å¯ä»¥æ¥ç hbase shell å½ä»¤ã\n\n 3.  åå»ºè¡¨\n     \n     å¯ä»¥ä½¿ç¨ create å½ä»¤åå»ºä¸å¼ æ°è¡¨ãå¿é¡»è¦æå®è¡¨åå column familyã\n     \n     hbase(main):001:0> create 'test', 'cf'\n     0 row(s) in 0.4170 seconds\n     \n     => hbase::table - test\n     \n\n 4.  ååºè¡¨ä¿¡æ¯\n     \n     ä½¿ç¨ list å½ä»¤æ¥ç¡®è®¤æ°å»ºçè¡¨å·²å­å¨ã\n     \n     hbase(main):002:0> list 'test'\n     table\n     test\n     1 row(s) in 0.0180 seconds\n     \n     => [\"test\"]\n     \n     \n     å¯ä»¥ä½¿ç¨ describe å½ä»¤å¯ä»¥æ¥çè¡¨çç»èä¿¡æ¯ï¼åæ¬éç½®ä¿¡æ¯\n     \n     hbase(main):003:0> describe 'test'\n     table test is enabled\n     test\n     column families description\n     {name => 'cf', versions => '1', evict_blocks_on_close => 'false', new_version_behavior => 'false', keep_deleted_cells => 'false', cache_data_on_write =>\n     'false', data_block_encoding => 'none', ttl => 'forever', min_versions => '0', replication_scope => '0', bloomfilter => 'row', cache_index_on_write => 'f\n     alse', in_memory => 'false', cache_blooms_on_write => 'false', prefetch_blocks_on_open => 'false', compression => 'none', blockcache => 'true', blocksize\n      => '65536'}\n     1 row(s)\n     took 0.9998 seconds\n     \n\n 5.  åè¡¨ä¸­åæ°æ®\n     \n     å¯ä»¥ä½¿ç¨ put å½ä»¤å hbase è¡¨ä¸­åæ°æ®ã\n     \n     hbase(main):003:0> put 'test', 'row1', 'cf:a', 'value1'\n     0 row(s) in 0.0850 seconds\n     \n     hbase(main):004:0> put 'test', 'row2', 'cf:b', 'value2'\n     0 row(s) in 0.0110 seconds\n     \n     hbase(main):005:0> put 'test', 'row3', 'cf:c', 'value3'\n     0 row(s) in 0.0100 seconds\n     \n\n 6.  ä¸æ¬¡æ§æ«æè¡¨çæææ°æ®\n     \n     ä½¿ç¨ scan å½ä»¤æ¥æ«æè¡¨æ°æ®ã\n     \n     hbase(main):006:0> scan 'test'\n     row                                      column+cell\n      row1                                    column=cf:a, timestamp=1421762485768, value=value1\n      row2                                    column=cf:b, timestamp=1421762491785, value=value2\n      row3                                    column=cf:c, timestamp=1421762496210, value=value3\n     3 row(s) in 0.0230 seconds\n     \n\n 7.  æ¥çä¸è¡æ°æ®\n     \n     ä½¿ç¨ get å½ä»¤å¯ä»¥æ¥çä¸è¡è¡¨æ°æ®ã\n     \n     hbase(main):007:0> get 'test', 'row1'\n     column                                   cell\n      cf:a                                    timestamp=1421762485768, value=value1\n     1 row(s) in 0.0350 seconds\n     \n\n 8.  ç¦ç¨è¡¨\n     \n     å¦ææ³è¦å é¤è¡¨æä¿®æ¹è¡¨è®¾ç½®ï¼å¿é¡»åä½¿ç¨ disable å½ä»¤ç¦ç¨è¡¨ãå¦ææ³åæ¬¡å¯ç¨è¡¨ï¼å¯ä»¥ä½¿ç¨ enable å½ä»¤ã\n     \n     hbase(main):008:0> disable 'test'\n     0 row(s) in 1.1820 seconds\n     \n     hbase(main):009:0> enable 'test'\n     0 row(s) in 0.1770 seconds\n     \n\n 9.  å é¤è¡¨\n     \n     ä½¿ç¨ drop å½ä»¤å¯ä»¥å é¤è¡¨ã\n     \n     hbase(main):011:0> drop 'test'\n     0 row(s) in 0.1370 seconds\n     \n\n 10. éåº hbase shell\n     \n     ä½¿ç¨ quit å½ä»¤ï¼å°±è½éåº hbase shell æ§å¶å°ã\n\n\n# åèèµæ\n\n * å®æ¹\n   * hbase å®ç½\n   * hbase å®æ¹ææ¡£\n   * hbase å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * hadoop æå¨æå\n * æç« \n   * bigtable: a distributed storage system for structured data\n   * an in-depth look at the hbase architecture\n * æç¨\n   * https://github.com/heibaiying/bigdata-notes\n   * https://www.cloudduggu.com/hbase/introduction/",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"HBase Schema è®¾è®¡",frontmatter:{title:"HBase Schema è®¾è®¡",date:"2023-03-15T20:28:32.000Z",categories:["æ°æ®åº","åå¼æ°æ®åº","HBase"],tags:["å¤§æ°æ®","HBase"],permalink:"/pages/a69528/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/06.%E5%88%97%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93/01.HBase/03.HBaseSchema%E8%AE%BE%E8%AE%A1.html",relativePath:"12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/03.HBaseSchemaè®¾è®¡.md",key:"v-644c6036",path:"/pages/a69528/",headers:[{level:2,title:"HBase Schema è®¾è®¡è¦ç´ ",slug:"hbase-schema-è®¾è®¡è¦ç´ ",normalizedTitle:"hbase schema è®¾è®¡è¦ç´ ",charIndex:22},{level:2,title:"Row Key è®¾è®¡",slug:"row-key-è®¾è®¡",normalizedTitle:"row key è®¾è®¡",charIndex:212},{level:3,title:"Row Key çä½ç¨",slug:"row-key-çä½ç¨",normalizedTitle:"row key çä½ç¨",charIndex:227},{level:3,title:"Row Key çè®¾è®¡åå",slug:"row-key-çè®¾è®¡åå",normalizedTitle:"row key çè®¾è®¡åå",charIndex:458},{level:3,title:"ç­ç¹é®é¢",slug:"ç­ç¹é®é¢",normalizedTitle:"ç­ç¹é®é¢",charIndex:1053},{level:4,title:"åè½¬ï¼Reversingï¼",slug:"åè½¬-reversing",normalizedTitle:"åè½¬ï¼reversingï¼",charIndex:1283},{level:4,title:"å çï¼Saltingï¼",slug:"å ç-salting",normalizedTitle:"å çï¼saltingï¼",charIndex:1570},{level:4,title:"åå¸ï¼Hashingï¼",slug:"åå¸-hashing",normalizedTitle:"åå¸ï¼hashingï¼",charIndex:1757},{level:2,title:"HBase Schema è®¾è®¡è§å",slug:"hbase-schema-è®¾è®¡è§å",normalizedTitle:"hbase schema è®¾è®¡è§å",charIndex:1876},{level:3,title:"Column Family è®¾è®¡",slug:"column-family-è®¾è®¡",normalizedTitle:"column family è®¾è®¡",charIndex:1898},{level:3,title:"Row è®¾è®¡",slug:"row-è®¾è®¡",normalizedTitle:"row è®¾è®¡",charIndex:2476},{level:3,title:"Version è®¾è®¡",slug:"version-è®¾è®¡",normalizedTitle:"version è®¾è®¡",charIndex:3138},{level:3,title:"TTL è®¾è®¡",slug:"ttl-è®¾è®¡",normalizedTitle:"ttl è®¾è®¡",charIndex:3297},{level:3,title:"Column Family å±æ§éç½®",slug:"column-family-å±æ§éç½®",normalizedTitle:"column family å±æ§éç½®",charIndex:3538},{level:2,title:"Schema è®¾è®¡æ¡ä¾",slug:"schema-è®¾è®¡æ¡ä¾",normalizedTitle:"schema è®¾è®¡æ¡ä¾",charIndex:3991},{level:3,title:"æ¡ä¾ï¼æ¥å¿æ°æ®åæ¶åºæ°æ®",slug:"æ¡ä¾-æ¥å¿æ°æ®åæ¶åºæ°æ®",normalizedTitle:"æ¡ä¾ï¼æ¥å¿æ°æ®åæ¶åºæ°æ®",charIndex:4007},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:5073}],headersStr:"HBase Schema è®¾è®¡è¦ç´  Row Key è®¾è®¡ Row Key çä½ç¨ Row Key çè®¾è®¡åå ç­ç¹é®é¢ åè½¬ï¼Reversingï¼ å çï¼Saltingï¼ åå¸ï¼Hashingï¼ HBase Schema è®¾è®¡è§å Column Family è®¾è®¡ Row è®¾è®¡ Version è®¾è®¡ TTL è®¾è®¡ Column Family å±æ§éç½® Schema è®¾è®¡æ¡ä¾ æ¡ä¾ï¼æ¥å¿æ°æ®åæ¶åºæ°æ® åèèµæ",content:"# HBase Schema è®¾è®¡\n\n\n# HBase Schema è®¾è®¡è¦ç´ \n\n * è¿ä¸ªè¡¨åºè¯¥æå¤å° Column Family\n * Column Family ä½¿ç¨ä»ä¹æ°æ®\n * æ¯ä¸ª Column Family ææå¤å°å\n * ååæ¯ä»ä¹ï¼å°½ç®¡ååä¸å¿å¨å»ºè¡¨æ¶å®ä¹ï¼ä½è¯»åæ°æ®æ¯è¦ç¥éç\n * åååºè¯¥å­æ¾ä»ä¹æ°æ®\n * æ¯ä¸ªååå­å¨å¤å°æ¶é´çæ¬\n * è¡å¥(rowKey)ç»ææ¯ä»ä¹ï¼åºè¯¥åå«ä»ä¹ä¿¡æ¯\n\n\n# Row Key è®¾è®¡\n\n\n# Row Key çä½ç¨\n\nå¨ HBase ä¸­ï¼ææå¯¹è¡¨çè®¿é®é½è¦éè¿ Row Keyï¼æä¸ç§è®¿é®æ¹å¼ï¼\n\n * ä½¿ç¨ get å½ä»¤ï¼æ¥è¯¢æå®ç Row Keyï¼å³ç²¾ç¡®æ¥æ¾ã\n * ä½¿ç¨ scan å½ä»¤ï¼æ ¹æ® Row Key è¿è¡èå´æ¥æ¾ã\n * å¨è¡¨æ«æï¼å³ç´æ¥æ«æè¡¨ä¸­ææè¡è®°å½ã\n\næ­¤å¤ï¼å¨ HBase ä¸­ï¼è¡¨ä¸­çè¡ï¼æ¯æç§ Row Key çå­å¸åºè¿è¡æåºçã\n\nç±æ­¤ï¼å¯è§ï¼Row Key çè¯å¥½è®¾è®¡å¯¹äº HBase CRUD çæ§è½è³å³éè¦ã\n\n\n# Row Key çè®¾è®¡åå\n\né¿åº¦åå\n\nRowKey æ¯ä¸ä¸ªäºè¿å¶ç æµï¼å¯ä»¥æ¯ä»»æå­ç¬¦ä¸²ï¼æå¤§é¿åº¦ä¸º 64kbï¼å®éåºç¨ä¸­ä¸è¬ä¸º 10-100byteï¼ä»¥ byte[]å½¢å¼ä¿å­ï¼ä¸è¬è®¾è®¡æå®é¿ãå»ºè®®è¶ç­è¶å¥½ï¼ä¸è¦è¶è¿ 16 ä¸ªå­èï¼åå å¦ä¸ï¼\n\n 1. æ°æ®çæä¹åæä»¶ HFile ä¸­æ¶æç§ Key-Value å­å¨çï¼å¦æ RowKey è¿é¿ï¼ä¾å¦è¶è¿ 100byteï¼é£ä¹ 1000w è¡çè®°å½ï¼ä» RowKey å°±éå ç¨è¿ 1GB çç©ºé´ãè¿æ ·ä¼æå¤§å½±å HFile çå­å¨æçã\n 2. MemStore ä¼ç¼å­é¨åæ°æ®å°åå­ä¸­ï¼è¥ RowKey å­æ®µè¿é¿ï¼åå­çææå©ç¨çå°±ä¼éä½ï¼å°±ä¸è½ç¼å­æ´å¤çæ°æ®ï¼ä»èéä½æ£ç´¢æçã\n 3. ç®åæä½ç³»ç»é½æ¯ 64 ä½ç³»ç»ï¼åå­ 8 å­èå¯¹é½ï¼æ§å¶å¨ 16 å­èï¼8 å­èçæ´æ°åå©ç¨äºæä½ç³»ç»çæä½³ç¹æ§ã\n\nå¯ä¸åå\n\nå¿é¡»å¨è®¾è®¡ä¸ä¿è¯ RowKey çå¯ä¸æ§ãç±äºå¨ HBase ä¸­æ°æ®å­å¨æ¯ Key-Value å½¢å¼ï¼è¥å HBase ä¸­åä¸å¼ è¡¨æå¥ç¸å RowKey çæ°æ®ï¼åååå­å¨çæ°æ®ä¼è¢«æ°çæ°æ®è¦çã\n\næåºåå\n\nHBase ç RowKey æ¯æç§ ASCII æåºæåºçï¼å æ­¤æä»¬å¨è®¾è®¡ RowKey çæ¶åè¦ååå©ç¨è¿ç¹ã\n\næ£ååå\n\nè®¾è®¡ç RowKey åºååçåå¸å¨åä¸ª HBase èç¹ä¸ã\n\n\n# ç­ç¹é®é¢\n\nRegion æ¯å¨ HBase éç¾¤ä¸åå¸æ°æ®çæå°åä½ãæ¯ä¸ª Region ç±å®æå±çè¡¨çèµ·å§èå´æ¥è¡¨ç¤ºï¼å³èµ·å§ Row Key åç»æ Row Keyï¼ã\n\nå¦æï¼Row Key ä½¿ç¨åè°éå¢çæ´æ°ææ¶é´æ³ï¼å°±ä¼äº§çä¸ä¸ªé®é¢ï¼å ä¸º Hbase ç Row Key æ¯å°±è¿å­å¨çï¼è¿ä¼å¯¼è´ä¸æ®µæ¶é´åå¤§é¨åè¯»åéä¸­å¨æä¸ä¸ª Region æå°æ° Region ä¸ï¼æ ¹æ®äºå«ååï¼æè¿äº§ççæ°æ®ï¼å¾å¾æ¯è¯»åé¢çæé«çæ°æ®ï¼ï¼å³æè° ç­ç¹é®é¢ã\n\n# åè½¬ï¼Reversingï¼\n\nç¬¬ä¸ç§å±ä»¬è¦åæçæ¹æ³æ¯åè½¬ï¼é¡¾åæä¹å®å°±æ¯æåºå®é¿åº¦æèæ°å­æ ¼å¼ç RowKey è¿è¡åè½¬ï¼åè½¬åä¸ºä¸è¬æ°æ®åè½¬åæ¶é´æ³åè½¬ï¼å¶ä¸­ä»¥æ¶é´æ³åè½¬è¾å¸¸è§ã\n\n * åè½¬åºå®æ ¼å¼çæ°å¼ - ä»¥ææºå·ä¸ºä¾ï¼ææºå·çåç¼ååæ¯è¾å°ï¼å¦ 152ã185 ç­ï¼ï¼ä½ååé¨åååå¾å¤ãå¦æå°å®åè½¬è¿æ¥ï¼å¯ä»¥ææå°é¿åç­ç¹ãä¸è¿å¶ç¼ºç¹å°±æ¯å¤±å»äºæåºæ§ã\n * åè½¬æ¶é´ - å¦ææ°æ®è®¿é®ä»¥æ¥æ¾æè¿çæ°æ®ä¸ºä¸»ï¼å¯ä»¥å°æ¶é´æ³å­å¨ä¸ºååæ¶é´æ³ï¼ä¾å¦ï¼ timestamp = Long.MAX_VALUE â timestampï¼ï¼è¿æ ·æå©äºæ«ææè¿çæ°æ®ã\n\n# å çï¼Saltingï¼\n\nè¿éçâå çâä¸å¯ç å­¦ä¸­çâå çâä¸æ¯ä¸åäºãå®æ¯æå¨ RowKey çåé¢å¢å ä¸äºåç¼ï¼å ççåç¼ç§ç±»è¶å¤ï¼RowKey å°±è¢«æå¾è¶æ£ã\n\néè¦æ³¨æçæ¯åéçéæºåç¼çç§ç±»æ°éåºè¯¥åæä»¬æ³ææ°æ®åæ£å°çé£äº region çæ°éä¸è´ãåªæè¿æ ·ï¼å çä¹åç rowkey æä¼æ ¹æ®éæºçæçåç¼åæ£å°åä¸ª region ä¸­ï¼é¿åäºç­ç¹ç°è±¡ã\n\n# åå¸ï¼Hashingï¼\n\nå¶å®åå¸åå ççéç¨åºæ¯ç±»ä¼¼ï¼ä½æä»¬åç¼ä¸å¯ä»¥æ¯éæºçï¼å ä¸ºå¿é¡»è¦è®©å®¢æ·ç«¯è½å¤å®æ´å°éæ RowKeyãæä»¥ä¸è¬ä¼æ¿å RowKey æå¶ä¸é¨åè®¡ç® Hash å¼ï¼ç¶ååå¯¹ Hash å¼åè¿ç®ä½ä¸ºåç¼ã\n\n\n# HBase Schema è®¾è®¡è§å\n\n\n# Column Family è®¾è®¡\n\nHBase ä¸è½å¾å¥½å¤ç 2 ~ 3 ä¸ªä»¥ä¸ç Column Familyï¼æä»¥ HBase è¡¨åºå°½å¯è½åå° Column Family æ°ãå¦æå¯ä»¥ï¼è¯·åªä½¿ç¨ä¸ä¸ªåæï¼åªæéè¦ç»å¸¸æ§è¡ Column èå´æ¥è¯¢æ¶ï¼æå¼å¥å¤åæãä¹å°±æ¯è¯´ï¼å°½éé¿ååæ¶æ¥è¯¢å¤ä¸ªåæã\n\n * Column Family æ°éå¤ï¼ä¼å½±åæ°æ®å·æ°ãHBase çæ°æ®å·æ°æ¯å¨æ¯ä¸ª Region çåºç¡ä¸å®æçãå æ­¤ï¼å¦æä¸ä¸ª Column Family æºå¸¦å¤§éå¯¼è´å·æ°çæ°æ®ï¼é£ä¹ç¸é»çåæå³ä½¿æºå¸¦çæ°æ®éå¾å°ï¼ä¹ä¼è¢«å·æ°ãå½å­å¨è®¸å¤ Column Family æ¶ï¼å·æ°äº¤äºä¼å¯¼è´ä¸å ä¸å¿è¦ç IOã æ­¤å¤ï¼å¨è¡¨/åºåçº§å«çåç¼©æä½ä¹ä¼å¨æ¯ä¸ªå­å¨ä¸­åçã\n * Column Family æ°éå¤ï¼ä¼å½±åæ¥æ¾æçãå¦ï¼Column Family A æ 100 ä¸è¡ï¼Column Family B æ 10 äº¿è¡ï¼é£ä¹ Column Family A çæ°æ®å¯è½ä¼åå¸å¨å¾å¤å¾å¤åºåï¼å RegionServersï¼ã è¿ä¼éä½ Column Family A çæ¹éæ«ææçã\n\nColumn Family åå°½éç®ç­ï¼æå¥½æ¯ä¸ä¸ªå­ç¬¦ãColumn Family ä¼å¨åéå®ç¬¦ä¸­è¢«é¢ç¹ä½¿ç¨ï¼ç¼©ç­é¿åº¦æå©äºèçç©ºé´å¹¶æåæçã\n\n\n# Row è®¾è®¡\n\nHBase ä¸­ç Row æ Row Key çå­å¸é¡ºåºæåºã\n\n * ä¸è¦å° Row Key è®¾è®¡ä¸ºåè°éå¢çï¼ä¾å¦ï¼éå¢çæ´æ°ææ¶é´æ³\n   \n   * é®é¢ï¼å ä¸º Hbase ç Row Key æ¯å°±è¿å­å¨çï¼è¿æ ·ä¼å¯¼è´ä¸æ®µæ¶é´åå¤§é¨ååå¥éä¸­å¨æä¸ä¸ª Region ä¸ï¼å³æè°ç­ç¹é®é¢ã\n   \n   * è§£å³æ¹æ³ä¸ãå çï¼è¿éçä¸æ¯æå¯ç å­¦çå çï¼èæ¯æå°éæºåéçåç¼æ·»å å°è¡é®çå¼å¤´ãè¿ä¹åæ¯ä¸ºäºé¿åç¸ååç¼ç Row Key æ°æ®è¢«å­å¨å¨ç¸é»ä½ç½®ï¼ä»èå¯¼è´ç­ç¹é®é¢ãç¤ºä¾å¦ä¸ï¼\n     \n     * foo0001\n       foo0002\n       foo0003\n       foo0004\n       \n       æ¹ä¸º\n       \n       a-foo0003\n       b-foo0001\n       c-foo0003\n       c-foo0004\n       d-foo0002\n       \n   \n   * è§£å³æ¹æ³äºãHashï¼Row Key çåç¼ä½¿ç¨ Hash\n\n * å°½éåå°è¡ååçé¿åº¦\n\n * ååæ¶é´æ³ï¼ååæ¶é´æ³å¯ä»¥æå¤§å°å¸®å©å¿«éæ¾å°å¼çææ°çæ¬ã\n\n * è¡å¥ä¸è½æ¹åï¼å¯ä¸å¯ä»¥æ¹åçæ¹å¼æ¯åå é¤åæå¥ã\n\n * Row Key å Column Familyï¼Row Key ä»å±äº Column Familyï¼å æ­¤ï¼ç¸åç Row Key å¯ä»¥å­å¨æ¯ä¸ä¸ª Column Family ä¸­èä¸ä¼åºç°å²çªã\n\n\n# Version è®¾è®¡\n\næå¤§ãæå° Row çæ¬å·ï¼è¡¨ç¤º HBase ä¼ä¿çççæ¬å·æ°çä¸ä¸éãåå¯ä»¥éè¿ HColumnDescriptor å¯¹æ¯ä¸ªåæè¿è¡éç½®\n\nRow çæ¬å·è¿å¤§ï¼ä¼å¤§å¤§å¢å  StoreFile çå¤§å°ï¼æä»¥ï¼æå¤§ Row çæ¬å·åºæéè®¾ç½®ãHBase ä¼å¨ä¸»è¦åç¼©æ¶ï¼å é¤å¤ä½ççæ¬ã\n\n\n# TTL è®¾è®¡\n\nColumn Family ä¼è®¾ç½®ä¸ä¸ªä»¥ç§ä¸ºåä½ç TTLï¼ä¸æ¦è¾¾å° TTL æ¶ï¼HBase ä¼èªå¨å é¤è¡è®°å½ã\n\nä»åå«è¿æè¡çå­å¨æä»¶å¨æ¬¡è¦åç¼©æ¶è¢«å é¤ã å° hbase.store.delete.expired.storefile è®¾ç½®ä¸º false ä¼ç¦ç¨æ­¤åè½ãå°æå°çæ¬æ°è®¾ç½®ä¸º 0 ä»¥å¤çå¼ä¹ä¼ç¦ç¨æ­¤åè½ã\n\nå¨è¾æ°çæ¬ç HBase ä¸ï¼è¿æ¯æå¨ Cell ä¸è®¾ç½® TTLï¼ä¸ Column Family ç TTL ä¸åçæ¯ï¼åä½æ¯æ¯«ç§ã\n\n\n# Column Family å±æ§éç½®\n\n * HFile æ°æ®åï¼é»è®¤æ¯ 64KBï¼æ°æ®åºçå¤§å°å½±åæ°æ®åç´¢å¼çå¤§å°ãæ°æ®åå¤§çè¯ä¸æ¬¡å è½½è¿åå­çæ°æ®è¶å¤ï¼æ«ææ¥è¯¢ææè¶å¥½ãä½æ¯æ°æ®åå°çè¯ï¼éæºæ¥è¯¢æ§è½æ´å¥½\n\n> create 'mytable',{NAME => 'cf1', BLOCKSIZE => '65536'}\nå¤å¶ä»£ç \n\n\n * æ°æ®åç¼å­ï¼æ°æ®åç¼å­é»è®¤æ¯æå¼çï¼å¦æä¸äºæ¯è¾å°è®¿é®çæ°æ®å¯ä»¥éæ©å³é­ç¼å­\n\n> create 'mytable',{NAME => 'cf1', BLOCKCACHE => 'FALSE'}\nå¤å¶ä»£ç \n\n\n * æ°æ®åç¼©ï¼åç¼©ä¼æé«ç£çå©ç¨çï¼ä½æ¯ä¼å¢å  CPU çè´è½½ï¼çæåµè¿è¡æ§å¶\n\n> create 'mytable',{NAME => 'cf1', COMPRESSION => 'SNAPPY'}\nå¤å¶ä»£ç \n\n\nHbase è¡¨è®¾è®¡æ¯åéæ±ç¸å³çï¼ä½æ¯éµå®è¡¨è®¾è®¡çä¸äºç¡¬æ§ææ å¯¹æ§è½çæåè¿æ¯å¾æå¸®å©çï¼è¿éæ´çäºä¸äºè®¾è®¡æ¶ç¨å°çè¦ç¹ã\n\n\n# Schema è®¾è®¡æ¡ä¾\n\n\n# æ¡ä¾ï¼æ¥å¿æ°æ®åæ¶åºæ°æ®\n\nåè®¾ééä»¥ä¸æ°æ®\n\n * Hostname\n * Timestamp\n * Log event\n * Value/message\n\nåºè¯¥å¦ä½è®¾è®¡ Row Keyï¼\n\nï¼1ï¼Timestamp å¨ Row Key å¤´é¨\n\nå¦æ Row Key è®¾è®¡ä¸º [timestamp][hostname][log-event] å½¢å¼ï¼ä¼åºç°ç­ç¹é®é¢ã\n\nå¦æéå¯¹æ¶é´çæ«æå¾éè¦ï¼å¯ä»¥éç¨æ¶é´æ³åæ¡¶ç­ç¥ï¼å³\n\nbucket = timestamp % bucketNum\n\n\nè®¡ç®åºæ¡¶å·åï¼å° Row Key æå®ä¸ºï¼[bucket][timestamp][hostname][log-event]\n\nå¦ä¸æè¿°ï¼è¦ä¸ºç¹å®æ¶é´èå´éæ©æ°æ®ï¼éè¦å¯¹æ¯ä¸ªæ¡¶æ§è¡æ«æã ä¾å¦ï¼100 ä¸ªæ¡¶å°å¨é®ç©ºé´ä¸­æä¾å¹¿æ³çåå¸ï¼ä½éè¦ 100 æ¬¡æ«ææè½è·ååä¸ªæ¶é´æ³çæ°æ®ï¼å æ­¤éè¦æè¡¡åèã\n\nï¼2ï¼Hostname å¨ Row Key å¤´é¨\n\nå¦æä¸»æºæ ·æ¬éå¾å¤§ï¼å° Row Key è®¾è®¡ä¸º [hostname][log-event][timestamp]ï¼è¿æ ·æå©äºæ«æ hostnameã\n\nï¼3ï¼Timestamp è¿æ¯åå Timestamp\n\nå¦ææ°æ®è®¿é®ä»¥æ¥æ¾æè¿çæ°æ®ä¸ºä¸»ï¼å¯ä»¥å°æ¶é´æ³å­å¨ä¸ºååæ¶é´æ³ï¼ä¾å¦ï¼ timestamp = Long.MAX_VALUE â timestampï¼ï¼è¿æ ·æå©äºæ«ææè¿çæ°æ®ã\n\nï¼4ï¼Row Key æ¯å¯åé¿åº¦è¿æ¯åºå®é¿åº¦\n\næ¼æ¥ Row Key çå³é®å­é¿åº¦ä¸ä¸å®æ¯åºå®çï¼ä¾å¦ hostname æå¯è½å¾é¿ï¼ä¹æå¯è½å¾ç­ãå¦ææ³è¦ç»ä¸é¿åº¦ï¼å¯ä»¥åèä»¥ä¸åæ³ï¼\n\n * å°å³é®å­ Hash ç¼ç ï¼ä½¿ç¨æç§ Hash ç®æ³è®¡ç®å³é®å­ï¼å¹¶ååºå®é¿åº¦çå¼ï¼ä¾å¦ï¼8 ä½æ 16 ä½ï¼ã\n * ä½¿ç¨æ°å­æ¿ä»£å³é®å­ï¼ä¾å¦ï¼ä½¿ç¨äºä»¶ç±»å Code æ¿æ¢äºä»¶ç±»åï¼hostname å¦ææ¯ IPï¼å¯ä»¥è½¬æ¢ä¸º long\n * æªåå³é®å­ï¼æªååçå³é®å­éè¦æè¶³å¤çè¾¨è¯åº¦ï¼é¿åº¦å¤§å°æ ¹æ®å·ä½æåµæè¡¡ã\n\nï¼5ï¼æ¶é´åç\n\n[hostname][log-event][timestamp1]\n[hostname][log-event][timestamp2]\n[hostname][log-event][timestamp3]\n\n\nä¸é¢çä¾å­ä¸­ï¼æ¯ä¸ªè¯¦ç»äºä»¶é½æåç¬çè¡é®ï¼å¯ä»¥éåå¦ä¸ï¼å³æ¯ä¸ªæ¶é´æ®µå­å¨ä¸æ¬¡ï¼\n\n[hostname][log-event][timerange]\n\n\n\n# åèèµæ\n\n * HBase å®æ¹ææ¡£ä¹ HBase and Schema Design",normalizedContent:"# hbase schema è®¾è®¡\n\n\n# hbase schema è®¾è®¡è¦ç´ \n\n * è¿ä¸ªè¡¨åºè¯¥æå¤å° column family\n * column family ä½¿ç¨ä»ä¹æ°æ®\n * æ¯ä¸ª column family ææå¤å°å\n * ååæ¯ä»ä¹ï¼å°½ç®¡ååä¸å¿å¨å»ºè¡¨æ¶å®ä¹ï¼ä½è¯»åæ°æ®æ¯è¦ç¥éç\n * åååºè¯¥å­æ¾ä»ä¹æ°æ®\n * æ¯ä¸ªååå­å¨å¤å°æ¶é´çæ¬\n * è¡å¥(rowkey)ç»ææ¯ä»ä¹ï¼åºè¯¥åå«ä»ä¹ä¿¡æ¯\n\n\n# row key è®¾è®¡\n\n\n# row key çä½ç¨\n\nå¨ hbase ä¸­ï¼ææå¯¹è¡¨çè®¿é®é½è¦éè¿ row keyï¼æä¸ç§è®¿é®æ¹å¼ï¼\n\n * ä½¿ç¨ get å½ä»¤ï¼æ¥è¯¢æå®ç row keyï¼å³ç²¾ç¡®æ¥æ¾ã\n * ä½¿ç¨ scan å½ä»¤ï¼æ ¹æ® row key è¿è¡èå´æ¥æ¾ã\n * å¨è¡¨æ«æï¼å³ç´æ¥æ«æè¡¨ä¸­ææè¡è®°å½ã\n\næ­¤å¤ï¼å¨ hbase ä¸­ï¼è¡¨ä¸­çè¡ï¼æ¯æç§ row key çå­å¸åºè¿è¡æåºçã\n\nç±æ­¤ï¼å¯è§ï¼row key çè¯å¥½è®¾è®¡å¯¹äº hbase crud çæ§è½è³å³éè¦ã\n\n\n# row key çè®¾è®¡åå\n\né¿åº¦åå\n\nrowkey æ¯ä¸ä¸ªäºè¿å¶ç æµï¼å¯ä»¥æ¯ä»»æå­ç¬¦ä¸²ï¼æå¤§é¿åº¦ä¸º 64kbï¼å®éåºç¨ä¸­ä¸è¬ä¸º 10-100byteï¼ä»¥ byte[]å½¢å¼ä¿å­ï¼ä¸è¬è®¾è®¡æå®é¿ãå»ºè®®è¶ç­è¶å¥½ï¼ä¸è¦è¶è¿ 16 ä¸ªå­èï¼åå å¦ä¸ï¼\n\n 1. æ°æ®çæä¹åæä»¶ hfile ä¸­æ¶æç§ key-value å­å¨çï¼å¦æ rowkey è¿é¿ï¼ä¾å¦è¶è¿ 100byteï¼é£ä¹ 1000w è¡çè®°å½ï¼ä» rowkey å°±éå ç¨è¿ 1gb çç©ºé´ãè¿æ ·ä¼æå¤§å½±å hfile çå­å¨æçã\n 2. memstore ä¼ç¼å­é¨åæ°æ®å°åå­ä¸­ï¼è¥ rowkey å­æ®µè¿é¿ï¼åå­çææå©ç¨çå°±ä¼éä½ï¼å°±ä¸è½ç¼å­æ´å¤çæ°æ®ï¼ä»èéä½æ£ç´¢æçã\n 3. ç®åæä½ç³»ç»é½æ¯ 64 ä½ç³»ç»ï¼åå­ 8 å­èå¯¹é½ï¼æ§å¶å¨ 16 å­èï¼8 å­èçæ´æ°åå©ç¨äºæä½ç³»ç»çæä½³ç¹æ§ã\n\nå¯ä¸åå\n\nå¿é¡»å¨è®¾è®¡ä¸ä¿è¯ rowkey çå¯ä¸æ§ãç±äºå¨ hbase ä¸­æ°æ®å­å¨æ¯ key-value å½¢å¼ï¼è¥å hbase ä¸­åä¸å¼ è¡¨æå¥ç¸å rowkey çæ°æ®ï¼åååå­å¨çæ°æ®ä¼è¢«æ°çæ°æ®è¦çã\n\næåºåå\n\nhbase ç rowkey æ¯æç§ ascii æåºæåºçï¼å æ­¤æä»¬å¨è®¾è®¡ rowkey çæ¶åè¦ååå©ç¨è¿ç¹ã\n\næ£ååå\n\nè®¾è®¡ç rowkey åºååçåå¸å¨åä¸ª hbase èç¹ä¸ã\n\n\n# ç­ç¹é®é¢\n\nregion æ¯å¨ hbase éç¾¤ä¸åå¸æ°æ®çæå°åä½ãæ¯ä¸ª region ç±å®æå±çè¡¨çèµ·å§èå´æ¥è¡¨ç¤ºï¼å³èµ·å§ row key åç»æ row keyï¼ã\n\nå¦æï¼row key ä½¿ç¨åè°éå¢çæ´æ°ææ¶é´æ³ï¼å°±ä¼äº§çä¸ä¸ªé®é¢ï¼å ä¸º hbase ç row key æ¯å°±è¿å­å¨çï¼è¿ä¼å¯¼è´ä¸æ®µæ¶é´åå¤§é¨åè¯»åéä¸­å¨æä¸ä¸ª region æå°æ° region ä¸ï¼æ ¹æ®äºå«ååï¼æè¿äº§ççæ°æ®ï¼å¾å¾æ¯è¯»åé¢çæé«çæ°æ®ï¼ï¼å³æè° ç­ç¹é®é¢ã\n\n# åè½¬ï¼reversingï¼\n\nç¬¬ä¸ç§å±ä»¬è¦åæçæ¹æ³æ¯åè½¬ï¼é¡¾åæä¹å®å°±æ¯æåºå®é¿åº¦æèæ°å­æ ¼å¼ç rowkey è¿è¡åè½¬ï¼åè½¬åä¸ºä¸è¬æ°æ®åè½¬åæ¶é´æ³åè½¬ï¼å¶ä¸­ä»¥æ¶é´æ³åè½¬è¾å¸¸è§ã\n\n * åè½¬åºå®æ ¼å¼çæ°å¼ - ä»¥ææºå·ä¸ºä¾ï¼ææºå·çåç¼ååæ¯è¾å°ï¼å¦ 152ã185 ç­ï¼ï¼ä½ååé¨åååå¾å¤ãå¦æå°å®åè½¬è¿æ¥ï¼å¯ä»¥ææå°é¿åç­ç¹ãä¸è¿å¶ç¼ºç¹å°±æ¯å¤±å»äºæåºæ§ã\n * åè½¬æ¶é´ - å¦ææ°æ®è®¿é®ä»¥æ¥æ¾æè¿çæ°æ®ä¸ºä¸»ï¼å¯ä»¥å°æ¶é´æ³å­å¨ä¸ºååæ¶é´æ³ï¼ä¾å¦ï¼ timestamp = long.max_value â timestampï¼ï¼è¿æ ·æå©äºæ«ææè¿çæ°æ®ã\n\n# å çï¼saltingï¼\n\nè¿éçâå çâä¸å¯ç å­¦ä¸­çâå çâä¸æ¯ä¸åäºãå®æ¯æå¨ rowkey çåé¢å¢å ä¸äºåç¼ï¼å ççåç¼ç§ç±»è¶å¤ï¼rowkey å°±è¢«æå¾è¶æ£ã\n\néè¦æ³¨æçæ¯åéçéæºåç¼çç§ç±»æ°éåºè¯¥åæä»¬æ³ææ°æ®åæ£å°çé£äº region çæ°éä¸è´ãåªæè¿æ ·ï¼å çä¹åç rowkey æä¼æ ¹æ®éæºçæçåç¼åæ£å°åä¸ª region ä¸­ï¼é¿åäºç­ç¹ç°è±¡ã\n\n# åå¸ï¼hashingï¼\n\nå¶å®åå¸åå ççéç¨åºæ¯ç±»ä¼¼ï¼ä½æä»¬åç¼ä¸å¯ä»¥æ¯éæºçï¼å ä¸ºå¿é¡»è¦è®©å®¢æ·ç«¯è½å¤å®æ´å°éæ rowkeyãæä»¥ä¸è¬ä¼æ¿å rowkey æå¶ä¸é¨åè®¡ç® hash å¼ï¼ç¶ååå¯¹ hash å¼åè¿ç®ä½ä¸ºåç¼ã\n\n\n# hbase schema è®¾è®¡è§å\n\n\n# column family è®¾è®¡\n\nhbase ä¸è½å¾å¥½å¤ç 2 ~ 3 ä¸ªä»¥ä¸ç column familyï¼æä»¥ hbase è¡¨åºå°½å¯è½åå° column family æ°ãå¦æå¯ä»¥ï¼è¯·åªä½¿ç¨ä¸ä¸ªåæï¼åªæéè¦ç»å¸¸æ§è¡ column èå´æ¥è¯¢æ¶ï¼æå¼å¥å¤åæãä¹å°±æ¯è¯´ï¼å°½éé¿ååæ¶æ¥è¯¢å¤ä¸ªåæã\n\n * column family æ°éå¤ï¼ä¼å½±åæ°æ®å·æ°ãhbase çæ°æ®å·æ°æ¯å¨æ¯ä¸ª region çåºç¡ä¸å®æçãå æ­¤ï¼å¦æä¸ä¸ª column family æºå¸¦å¤§éå¯¼è´å·æ°çæ°æ®ï¼é£ä¹ç¸é»çåæå³ä½¿æºå¸¦çæ°æ®éå¾å°ï¼ä¹ä¼è¢«å·æ°ãå½å­å¨è®¸å¤ column family æ¶ï¼å·æ°äº¤äºä¼å¯¼è´ä¸å ä¸å¿è¦ç ioã æ­¤å¤ï¼å¨è¡¨/åºåçº§å«çåç¼©æä½ä¹ä¼å¨æ¯ä¸ªå­å¨ä¸­åçã\n * column family æ°éå¤ï¼ä¼å½±åæ¥æ¾æçãå¦ï¼column family a æ 100 ä¸è¡ï¼column family b æ 10 äº¿è¡ï¼é£ä¹ column family a çæ°æ®å¯è½ä¼åå¸å¨å¾å¤å¾å¤åºåï¼å regionserversï¼ã è¿ä¼éä½ column family a çæ¹éæ«ææçã\n\ncolumn family åå°½éç®ç­ï¼æå¥½æ¯ä¸ä¸ªå­ç¬¦ãcolumn family ä¼å¨åéå®ç¬¦ä¸­è¢«é¢ç¹ä½¿ç¨ï¼ç¼©ç­é¿åº¦æå©äºèçç©ºé´å¹¶æåæçã\n\n\n# row è®¾è®¡\n\nhbase ä¸­ç row æ row key çå­å¸é¡ºåºæåºã\n\n * ä¸è¦å° row key è®¾è®¡ä¸ºåè°éå¢çï¼ä¾å¦ï¼éå¢çæ´æ°ææ¶é´æ³\n   \n   * é®é¢ï¼å ä¸º hbase ç row key æ¯å°±è¿å­å¨çï¼è¿æ ·ä¼å¯¼è´ä¸æ®µæ¶é´åå¤§é¨ååå¥éä¸­å¨æä¸ä¸ª region ä¸ï¼å³æè°ç­ç¹é®é¢ã\n   \n   * è§£å³æ¹æ³ä¸ãå çï¼è¿éçä¸æ¯æå¯ç å­¦çå çï¼èæ¯æå°éæºåéçåç¼æ·»å å°è¡é®çå¼å¤´ãè¿ä¹åæ¯ä¸ºäºé¿åç¸ååç¼ç row key æ°æ®è¢«å­å¨å¨ç¸é»ä½ç½®ï¼ä»èå¯¼è´ç­ç¹é®é¢ãç¤ºä¾å¦ä¸ï¼\n     \n     * foo0001\n       foo0002\n       foo0003\n       foo0004\n       \n       æ¹ä¸º\n       \n       a-foo0003\n       b-foo0001\n       c-foo0003\n       c-foo0004\n       d-foo0002\n       \n   \n   * è§£å³æ¹æ³äºãhashï¼row key çåç¼ä½¿ç¨ hash\n\n * å°½éåå°è¡ååçé¿åº¦\n\n * ååæ¶é´æ³ï¼ååæ¶é´æ³å¯ä»¥æå¤§å°å¸®å©å¿«éæ¾å°å¼çææ°çæ¬ã\n\n * è¡å¥ä¸è½æ¹åï¼å¯ä¸å¯ä»¥æ¹åçæ¹å¼æ¯åå é¤åæå¥ã\n\n * row key å column familyï¼row key ä»å±äº column familyï¼å æ­¤ï¼ç¸åç row key å¯ä»¥å­å¨æ¯ä¸ä¸ª column family ä¸­èä¸ä¼åºç°å²çªã\n\n\n# version è®¾è®¡\n\næå¤§ãæå° row çæ¬å·ï¼è¡¨ç¤º hbase ä¼ä¿çççæ¬å·æ°çä¸ä¸éãåå¯ä»¥éè¿ hcolumndescriptor å¯¹æ¯ä¸ªåæè¿è¡éç½®\n\nrow çæ¬å·è¿å¤§ï¼ä¼å¤§å¤§å¢å  storefile çå¤§å°ï¼æä»¥ï¼æå¤§ row çæ¬å·åºæéè®¾ç½®ãhbase ä¼å¨ä¸»è¦åç¼©æ¶ï¼å é¤å¤ä½ççæ¬ã\n\n\n# ttl è®¾è®¡\n\ncolumn family ä¼è®¾ç½®ä¸ä¸ªä»¥ç§ä¸ºåä½ç ttlï¼ä¸æ¦è¾¾å° ttl æ¶ï¼hbase ä¼èªå¨å é¤è¡è®°å½ã\n\nä»åå«è¿æè¡çå­å¨æä»¶å¨æ¬¡è¦åç¼©æ¶è¢«å é¤ã å° hbase.store.delete.expired.storefile è®¾ç½®ä¸º false ä¼ç¦ç¨æ­¤åè½ãå°æå°çæ¬æ°è®¾ç½®ä¸º 0 ä»¥å¤çå¼ä¹ä¼ç¦ç¨æ­¤åè½ã\n\nå¨è¾æ°çæ¬ç hbase ä¸ï¼è¿æ¯æå¨ cell ä¸è®¾ç½® ttlï¼ä¸ column family ç ttl ä¸åçæ¯ï¼åä½æ¯æ¯«ç§ã\n\n\n# column family å±æ§éç½®\n\n * hfile æ°æ®åï¼é»è®¤æ¯ 64kbï¼æ°æ®åºçå¤§å°å½±åæ°æ®åç´¢å¼çå¤§å°ãæ°æ®åå¤§çè¯ä¸æ¬¡å è½½è¿åå­çæ°æ®è¶å¤ï¼æ«ææ¥è¯¢ææè¶å¥½ãä½æ¯æ°æ®åå°çè¯ï¼éæºæ¥è¯¢æ§è½æ´å¥½\n\n> create 'mytable',{name => 'cf1', blocksize => '65536'}\nå¤å¶ä»£ç \n\n\n * æ°æ®åç¼å­ï¼æ°æ®åç¼å­é»è®¤æ¯æå¼çï¼å¦æä¸äºæ¯è¾å°è®¿é®çæ°æ®å¯ä»¥éæ©å³é­ç¼å­\n\n> create 'mytable',{name => 'cf1', blockcache => 'false'}\nå¤å¶ä»£ç \n\n\n * æ°æ®åç¼©ï¼åç¼©ä¼æé«ç£çå©ç¨çï¼ä½æ¯ä¼å¢å  cpu çè´è½½ï¼çæåµè¿è¡æ§å¶\n\n> create 'mytable',{name => 'cf1', compression => 'snappy'}\nå¤å¶ä»£ç \n\n\nhbase è¡¨è®¾è®¡æ¯åéæ±ç¸å³çï¼ä½æ¯éµå®è¡¨è®¾è®¡çä¸äºç¡¬æ§ææ å¯¹æ§è½çæåè¿æ¯å¾æå¸®å©çï¼è¿éæ´çäºä¸äºè®¾è®¡æ¶ç¨å°çè¦ç¹ã\n\n\n# schema è®¾è®¡æ¡ä¾\n\n\n# æ¡ä¾ï¼æ¥å¿æ°æ®åæ¶åºæ°æ®\n\nåè®¾ééä»¥ä¸æ°æ®\n\n * hostname\n * timestamp\n * log event\n * value/message\n\nåºè¯¥å¦ä½è®¾è®¡ row keyï¼\n\nï¼1ï¼timestamp å¨ row key å¤´é¨\n\nå¦æ row key è®¾è®¡ä¸º [timestamp][hostname][log-event] å½¢å¼ï¼ä¼åºç°ç­ç¹é®é¢ã\n\nå¦æéå¯¹æ¶é´çæ«æå¾éè¦ï¼å¯ä»¥éç¨æ¶é´æ³åæ¡¶ç­ç¥ï¼å³\n\nbucket = timestamp % bucketnum\n\n\nè®¡ç®åºæ¡¶å·åï¼å° row key æå®ä¸ºï¼[bucket][timestamp][hostname][log-event]\n\nå¦ä¸æè¿°ï¼è¦ä¸ºç¹å®æ¶é´èå´éæ©æ°æ®ï¼éè¦å¯¹æ¯ä¸ªæ¡¶æ§è¡æ«æã ä¾å¦ï¼100 ä¸ªæ¡¶å°å¨é®ç©ºé´ä¸­æä¾å¹¿æ³çåå¸ï¼ä½éè¦ 100 æ¬¡æ«ææè½è·ååä¸ªæ¶é´æ³çæ°æ®ï¼å æ­¤éè¦æè¡¡åèã\n\nï¼2ï¼hostname å¨ row key å¤´é¨\n\nå¦æä¸»æºæ ·æ¬éå¾å¤§ï¼å° row key è®¾è®¡ä¸º [hostname][log-event][timestamp]ï¼è¿æ ·æå©äºæ«æ hostnameã\n\nï¼3ï¼timestamp è¿æ¯åå timestamp\n\nå¦ææ°æ®è®¿é®ä»¥æ¥æ¾æè¿çæ°æ®ä¸ºä¸»ï¼å¯ä»¥å°æ¶é´æ³å­å¨ä¸ºååæ¶é´æ³ï¼ä¾å¦ï¼ timestamp = long.max_value â timestampï¼ï¼è¿æ ·æå©äºæ«ææè¿çæ°æ®ã\n\nï¼4ï¼row key æ¯å¯åé¿åº¦è¿æ¯åºå®é¿åº¦\n\næ¼æ¥ row key çå³é®å­é¿åº¦ä¸ä¸å®æ¯åºå®çï¼ä¾å¦ hostname æå¯è½å¾é¿ï¼ä¹æå¯è½å¾ç­ãå¦ææ³è¦ç»ä¸é¿åº¦ï¼å¯ä»¥åèä»¥ä¸åæ³ï¼\n\n * å°å³é®å­ hash ç¼ç ï¼ä½¿ç¨æç§ hash ç®æ³è®¡ç®å³é®å­ï¼å¹¶ååºå®é¿åº¦çå¼ï¼ä¾å¦ï¼8 ä½æ 16 ä½ï¼ã\n * ä½¿ç¨æ°å­æ¿ä»£å³é®å­ï¼ä¾å¦ï¼ä½¿ç¨äºä»¶ç±»å code æ¿æ¢äºä»¶ç±»åï¼hostname å¦ææ¯ ipï¼å¯ä»¥è½¬æ¢ä¸º long\n * æªåå³é®å­ï¼æªååçå³é®å­éè¦æè¶³å¤çè¾¨è¯åº¦ï¼é¿åº¦å¤§å°æ ¹æ®å·ä½æåµæè¡¡ã\n\nï¼5ï¼æ¶é´åç\n\n[hostname][log-event][timestamp1]\n[hostname][log-event][timestamp2]\n[hostname][log-event][timestamp3]\n\n\nä¸é¢çä¾å­ä¸­ï¼æ¯ä¸ªè¯¦ç»äºä»¶é½æåç¬çè¡é®ï¼å¯ä»¥éåå¦ä¸ï¼å³æ¯ä¸ªæ¶é´æ®µå­å¨ä¸æ¬¡ï¼\n\n[hostname][log-event][timerange]\n\n\n\n# åèèµæ\n\n * hbase å®æ¹ææ¡£ä¹ hbase and schema design",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"HBase æ¶æ",frontmatter:{title:"HBase æ¶æ",date:"2020-07-24T06:52:07.000Z",categories:["æ°æ®åº","åå¼æ°æ®åº","HBase"],tags:["å¤§æ°æ®","HBase"],permalink:"/pages/62f8d9/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/06.%E5%88%97%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93/01.HBase/04.HBase%E6%9E%B6%E6%9E%84.html",relativePath:"12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/04.HBaseæ¶æ.md",key:"v-53db1c34",path:"/pages/62f8d9/",headers:[{level:2,title:"HBase å­å¨æ¶æ",slug:"hbase-å­å¨æ¶æ",normalizedTitle:"hbase å­å¨æ¶æ",charIndex:50},{level:3,title:"æ¦è§",slug:"æ¦è§",normalizedTitle:"æ¦è§",charIndex:196},{level:3,title:"Region",slug:"region",normalizedTitle:"region",charIndex:108},{level:3,title:"Region Server",slug:"region-server",normalizedTitle:"region server",charIndex:773},{level:2,title:"HBase ç³»ç»æ¶æ",slug:"hbase-ç³»ç»æ¶æ",normalizedTitle:"hbase ç³»ç»æ¶æ",charIndex:2010},{level:3,title:"Master Server",slug:"master-server",normalizedTitle:"master server",charIndex:2377},{level:3,title:"Region Server",slug:"region-server-2",normalizedTitle:"region server",charIndex:773},{level:3,title:"ZooKeeper",slug:"zookeeper",normalizedTitle:"zookeeper",charIndex:256},{level:2,title:"HBase è¯»åæµç¨",slug:"hbase-è¯»åæµç¨",normalizedTitle:"hbase è¯»åæµç¨",charIndex:3580},{level:3,title:"åå¥æ°æ®çæµç¨",slug:"åå¥æ°æ®çæµç¨",normalizedTitle:"åå¥æ°æ®çæµç¨",charIndex:3595},{level:3,title:"è¯»åæ°æ®çæµç¨",slug:"è¯»åæ°æ®çæµç¨",normalizedTitle:"è¯»åæ°æ®çæµç¨",charIndex:3865},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:4324}],headersStr:"HBase å­å¨æ¶æ æ¦è§ Region Region Server HBase ç³»ç»æ¶æ Master Server Region Server ZooKeeper HBase è¯»åæµç¨ åå¥æ°æ®çæµç¨ è¯»åæ°æ®çæµç¨ åèèµæ",content:"# HBase æ¶æ\n\n> HBase æ¯ä¸ä¸ªå¨ HDFS ä¸å¼åçé¢ååçåå¸å¼æ°æ®åºã\n\n\n# HBase å­å¨æ¶æ\n\n> å¨ HBase ä¸­ï¼è¡¨è¢«åå²æå¤ä¸ªæ´å°çåç¶ååæ£çå­å¨å¨ä¸åçæå¡å¨ä¸ï¼è¿äºå°åå«å Regionsï¼å­æ¾ Regions çå°æ¹å«å RegionServerãMaster è¿ç¨è´è´£å¤çä¸åç RegionServer ä¹é´ç Region çååã\n\n\n# æ¦è§\n\n\n\nHBase ä¸»è¦å¤çä¸¤ç§æä»¶ï¼é¢åæ¥å¿ï¼WALï¼åå®éæ°æ®æä»¶ HFileãä¸ä¸ªåºæ¬çæµç¨æ¯å®¢æ·ç«¯é¦åèç³» ZooKeeper éç¾¤æ¥æ¾è¡é®ãä¸è¿°è¿ç¨æ¯éè¿ ZooKeeper è·åæ¬§å«æ -ROOT- ç region æå¡å¨æ¥å®æçãéè¿å«æ -ROOT- ç region æå¡å¨å¯ä»¥æ¥è¯¢å°å«æ .META. è¡¨ä¸­å¯¹åºç region æå¡å¨åï¼å¶ä¸­åå«è¯·æ±çè¡é®ä¿¡æ¯ãè¿ä¸¤ç§åå®¹é½ä¼è¢«ç¼å­ä¸æ¥ï¼å¹¶ä¸åªæ¥è¯¢ä¸æ¬¡ãæç»ï¼éè¿æ¥è¯¢ .META. æå¡å¨æ¥è·åå®¢æ·ç«¯æ¥è¯¢çè¡é®æ°æ®æå¨ region çæå¡å¨åã\n\n\n# Region\n\nHBase Table ä¸­çææè¡æç§ Row Key çå­å¸åºæåãHBase Table æ ¹æ® Row Key çèå´åçï¼æ¯ä¸ªåçå«å Regionãä¸ä¸ª Region åå«äºå¨ start key å end key ä¹é´çææè¡ã\n\n\n\nHBase æ¯æèªå¨ååºï¼æ¯ä¸ªè¡¨åå§åªæä¸ä¸ª Regionï¼éçæ°æ®ä¸æ­å¢å ï¼Region ä¼ä¸æ­å¢å¤§ï¼å½å¢å¤§å°ä¸ä¸ªéå¼çæ¶åï¼Region å°±ä¼åè£ä¸ºä¸¤ä¸ªæ°ç Regionãå½ Table ä¸­çè¡ä¸æ­å¢å¤ï¼å°±ä¼æè¶æ¥è¶å¤ç Regionã\n\nRegion æ¯ HBase ä¸­åå¸å¼å­å¨åè´è½½åè¡¡çæå°ååãè¿æå³çä¸åç Region å¯ä»¥åå¸å¨ä¸åç Region Server ä¸ãä½ä¸ä¸ª Region æ¯ä¸ä¼æåå°å¤ä¸ª Server ä¸çã\n\n\n\n\n# Region Server\n\nRegion åªä¸è¿æ¯è¡¨è¢«æåï¼å¹¶åå¸å¨ Region Serverã\n\nRegion Server è¿è¡å¨ HDFS ç DataNode ä¸ãå®å·æä»¥ä¸ç»ä»¶ï¼\n\n * WAL(Write Ahead Logï¼é¢åæ¥å¿)ï¼ç¨äºå­å¨å°æªè¿æä¹åå­å¨çæ°æ®è®°å½ï¼ä»¥ä¾¿å¨åçæéæ¶è¿è¡æ¢å¤ãå¦æå WAL å¤±è´¥äºï¼é£ä¹ä¿®æ¹æ°æ®çå®æ´æä½å°±æ¯å¤±è´¥çã\n   * éå¸¸æåµï¼æ¯ä¸ª RegionServer åªæä¸ä¸ª WAL å®ä¾ãå¨ 2.0 ä¹åï¼WAL çå®ç°å«å HLog\n   * WAL ä½äº /hbase/WALs/ ç®å½ä¸\n   * å¦ææ¯ä¸ª RegionServer åªæä¸ä¸ª WALï¼ç±äº HDFS å¿é¡»æ¯è¿ç»­çï¼å¯¼è´å¿é¡»å WAL è¿ç»­çï¼ç¶ååºç°æ§è½é®é¢ãMultiWAL å¯ä»¥è®© RegionServer åæ¶åå¤ä¸ª WAL å¹¶è¡çï¼éè¿ HDFS åºå±çå¤ç®¡éï¼æç»æåæ»çååéï¼ä½æ¯ä¸ä¼æååä¸ª Region çååéã\n * BlockCacheï¼è¯»ç¼å­ãå®å°é¢ç¹è¯»åçæ°æ®å­å¨å¨åå­ä¸­ï¼å¦æå­å¨ä¸è¶³ï¼å®å°æç§ æè¿æå°ä½¿ç¨åå æ¸é¤å¤ä½çæ°æ®ã\n * MemStoreï¼åç¼å­ãå®å­å¨å°æªåå¥ç£ççæ°æ°æ®ï¼å¹¶ä¼å¨æ°æ®åå¥ç£çä¹åå¯¹å¶è¿è¡æåºãæ¯ä¸ª Region ä¸çæ¯ä¸ªåæé½æä¸ä¸ª MemStoreã\n * HFileï¼å°è¡æ°æ®æç§ Key/Values çå½¢å¼å­å¨å¨æä»¶ç³»ç»ä¸ãHFile æ¯ HBase å¨ HDFS ä¸­å­å¨æ°æ®çæ ¼å¼ï¼å®åå«å¤å±çç´¢å¼ï¼è¿æ ·å¨ HBase æ£ç´¢æ°æ®çæ¶åå°±ä¸ç¨å®å¨çå è½½æ´ä¸ªæä»¶ãHFile å­å¨çæ ¹ç®å½é»è®¤ä¸ºä¸º /hbaseãç´¢å¼çå¤§å°(keys çå¤§å°ï¼æ°æ®éçå¤§å°)å½±å block çå¤§å°ï¼å¨å¤§æ°æ®éçæåµä¸ï¼block çå¤§å°è®¾ç½®ä¸ºæ¯ä¸ª RegionServer 1GB ä¹æ¯å¸¸è§çã\n   * èµ·åï¼HFile ä¸­å¹¶æ²¡æä»»ä½ Blockï¼æ°æ®è¿å­å¨äº MemStore ä¸­ã\n   * Flush åçæ¶ï¼åå»º HFile Writerï¼ç¬¬ä¸ä¸ªç©ºç Data Block åºç°ï¼åå§ååç Data Block ä¸­ä¸º Header é¨åé¢çäºç©ºé´ï¼Header é¨åç¨æ¥å­æ¾ä¸ä¸ª Data Block çåæ°æ®ä¿¡æ¯ã\n   * èåï¼ä½äº MemStore ä¸­ç KeyValues è¢«ä¸ä¸ªä¸ª append å°ä½äºåå­ä¸­çç¬¬ä¸ä¸ª Data Block ä¸­ï¼\n\n\n\nRegion Server å­åä¸ä¸ªå­è¡¨æ¶ï¼ä¼åå»ºä¸ä¸ª Region å¯¹è±¡ï¼ç¶åå¯¹è¡¨çæ¯ä¸ªåæåå»ºä¸ä¸ª Store å®ä¾ï¼æ¯ä¸ª Store ä¼æ 0 ä¸ªæå¤ä¸ª StoreFile ä¸ä¹å¯¹åºï¼æ¯ä¸ª StoreFile åå¯¹åºä¸ä¸ª HFileï¼HFile å°±æ¯å®éå­å¨å¨ HDFS ä¸çæä»¶ã\n\n\n# HBase ç³»ç»æ¶æ\n\n\n\nå HDFSãYARN ä¸æ ·ï¼HBase ä¹éµå¾ª master / slave æ¶æï¼\n\n * HBase æä¸ä¸ª master èç¹ãmaster èç¹è´è´£åè°ç®¡ç region server èç¹ã\n   * master è´è´£å° region åéç» region server èç¹ï¼\n   * master è´è´£æ¢å¤ region server èç¹çæéã\n * HBase æå¤ä¸ª region server èç¹ãregion server èç¹è´è´£é¶ä¸ªæå¤ä¸ª region çç®¡çå¹¶ååºå®¢æ·ç«¯çè¯»åè¯·æ±ãregion server èç¹è¿è´è´£ region çååå¹¶éç¥ master èç¹æäºæ°çå­ regionã\n * HBase ä¾èµ ZooKeeper æ¥å®ç°æéæ¢å¤ã\n\n\n# Master Server\n\nMaster Server è´è´£åè° Region Serverãå·ä½èè´£å¦ä¸ï¼\n\n * ä¸º Region Server åé Region ï¼\n * è´è´£ Region Server çè´è½½åè¡¡ ï¼\n * åç°å¤±æç Region Server å¹¶éæ°åéå¶ä¸ç Regionï¼\n * GFS ä¸çåå¾æä»¶åæ¶ï¼\n * å¤ç Schema çæ´æ°è¯·æ±ã\n\n\n\n\n# Region Server\n\n * Region Server è´è´£ç»´æ¤ Master Server åéç»å®ç Regionï¼å¹¶å¤çåéå° Region ä¸ç IO è¯·æ±ï¼\n * å½ Region è¿å¤§ï¼Region Server è´è´£èªå¨ååºï¼å¹¶éç¥ Master Server è®°å½æ´æ°ã\n\n\n\n\n# ZooKeeper\n\nHBase ä¾èµ ZooKeeper ä½ä¸ºåå¸å¼åè°æå¡æ¥ç»´æ¤éç¾¤ä¸­çæå¡å¨ç¶æãZookeeper ç»´æ¤åªäºæå¡å¨æ¯æ´»å¨çåå¯ç¨çï¼å¹¶æä¾æå¡å¨æééç¥ãéç¾¤è³å°åºè¯¥æ 3 ä¸ªèç¹ã\n\nZooKeeper çä½ç¨ï¼\n\n * ä¿è¯ä»»ä½æ¶åï¼éç¾¤ä¸­åªæä¸ä¸ª Masterï¼\n * å­å¨ææ Region çå¯»åå¥å£ï¼\n * å®æ¶çæ§ Region Server çç¶æï¼å° Region Server çä¸çº¿åä¸çº¿ä¿¡æ¯å®æ¶éç¥ç» Masterï¼\n * å­å¨ HBase ç Schemaï¼åæ¬æåªäº Tableï¼æ¯ä¸ª Table æåªäº Column Family ç­ä¿¡æ¯ã\n\n\n\nä»¥ä¸ï¼æéè¦çä¸ç¹æ¯ ZooKeeper å¦ä½ä¿è¯ HBase éç¾¤ä¸­åªæä¸ä¸ª Master Server çå¢ï¼\n\n * ææ Master Server ä¼ç«äº Zookeeper ç znode éï¼ä¸ä¸ªä¸´æ¶èç¹ï¼ï¼åªæä¸ä¸ª Master Server è½å¤åå»ºæåï¼æ­¤æ¶è¯¥ Master å°±æ¯ä¸» Masterã\n * ä¸» Master ä¼å®æå Zookeeper åéå¿è·³ãä» Master åéè¿ Watcher æºå¶å¯¹ä¸» Master æå¨èç¹è¿è¡çå¬ã\n * å¦æï¼ä¸» Master æªè½åæ¶åéå¿è·³ï¼åå¶ææç ZooKeeper ä¼è¯ä¼è¿æï¼ç¸åºç znode éï¼ä¸ä¸ªä¸´æ¶èç¹ï¼ä¼è¢«èªå¨å é¤ãè¿ä¼è§¦åå®ä¹å¨è¯¥èç¹ä¸ç Watcher äºä»¶ï¼ææä» Master ä¼å¾å°éç¥ï¼å¹¶åæ¬¡å¼å§ç«äº znode éï¼ç´å°å®æä¸» Master çéä¸¾ã\n\nHBase åé¨ä¿çåä¸º hbase:meta çç¹æ®ç®å½è¡¨ï¼catalog tableï¼ãå®ç»´æ¤çå½åéç¾¤ä¸ææ region çåè¡¨ãç¶æåä½ç½®ãhbase:meta è¡¨ä¸­çé¡¹ä½¿ç¨ region ä½ä¸ºé®ãregion åç±æå±çè¡¨åãregion çèµ·å§è¡ãregionçåå»ºæ¶é´ä»¥ååºäºæ´ä½è®¡ç®å¾åºç MD5 ç»æã\n\n\n# HBase è¯»åæµç¨\n\n\n# åå¥æ°æ®çæµç¨\n\n 1. Client å Region Server æäº¤åè¯·æ±ï¼\n 2. Region Server æ¾å°ç®æ  Regionï¼\n 3. Region æ£æ¥æ°æ®æ¯å¦ä¸ Schema ä¸è´ï¼\n 4. å¦æå®¢æ·ç«¯æ²¡ææå®çæ¬ï¼åè·åå½åç³»ç»æ¶é´ä½ä¸ºæ°æ®çæ¬ï¼\n 5. å°æ´æ°åå¥ WAL Logï¼\n 6. å°æ´æ°åå¥ Memstoreï¼\n 7. å¤æ­ Memstore å­å¨æ¯å¦å·²æ»¡ï¼å¦æå­å¨å·²æ»¡åéè¦ flush ä¸º Store Hfile æä»¶ã\n\n> æ´ä¸ºè¯¦ç»åå¥æµç¨å¯ä»¥åèï¼HBase ï¼ æ°æ®åå¥æµç¨è§£æ\n\n\n# è¯»åæ°æ®çæµç¨\n\nä»¥ä¸æ¯å®¢æ·ç«¯é¦æ¬¡è¯»å HBase ä¸æ°æ®çæµç¨ï¼\n\n 1. å®¢æ·ç«¯ä» Zookeeper è·å META è¡¨æå¨ç Region Serverï¼\n 2. å®¢æ·ç«¯è®¿é® META è¡¨æå¨ç Region Serverï¼ä» META è¡¨ä¸­æ¥è¯¢å°è®¿é®è¡é®æå¨ç Region Serverï¼ä¹åå®¢æ·ç«¯å°ç¼å­è¿äºä¿¡æ¯ä»¥å META è¡¨çä½ç½®ï¼\n 3. å®¢æ·ç«¯ä»è¡é®æå¨ç Region Server ä¸è·åæ°æ®ã\n\nå¦æåæ¬¡è¯»åï¼å®¢æ·ç«¯å°ä»ç¼å­ä¸­è·åè¡é®æå¨ç Region Serverãè¿æ ·å®¢æ·ç«¯å°±ä¸éè¦åæ¬¡æ¥è¯¢ META è¡¨ï¼é¤é Region ç§»å¨å¯¼è´ç¼å­å¤±æï¼è¿æ ·çè¯ï¼åå°ä¼éæ°æ¥è¯¢å¹¶æ´æ°ç¼å­ã\n\næ³¨ï¼META è¡¨æ¯ HBase ä¸­ä¸å¼ ç¹æ®çè¡¨ï¼å®ä¿å­äºææ Region çä½ç½®ä¿¡æ¯ï¼META è¡¨èªå·±çä½ç½®ä¿¡æ¯åå­å¨å¨ ZooKeeper ä¸ã\n\n\n\n> æ´ä¸ºè¯¦ç»è¯»åæ°æ®æµç¨åèï¼\n> \n> HBase åçï¼æ°æ®è¯»åæµç¨è§£æ\n> \n> HBase åçï¼è¿å°çâæ°æ®è¯»åæµç¨é¨åç»è\n\n\n# åèèµæ\n\n * å®æ¹\n   * HBase å®ç½\n   * HBase å®æ¹ææ¡£\n   * HBase å®æ¹ææ¡£ä¸­æç\n   * HBase API\n * æç¨\n   * BigData-Notes\n * æç« \n   * Bigtable: A Distributed Storage System for Structured Data\n   * An In-Depth Look at the HBase Architecture\n   * å¥é¨ HBaseï¼çè¿ä¸ç¯å°±å¤äº\n   * https://bighadoop.wordpress.com/tag/hbase/",normalizedContent:"# hbase æ¶æ\n\n> hbase æ¯ä¸ä¸ªå¨ hdfs ä¸å¼åçé¢ååçåå¸å¼æ°æ®åºã\n\n\n# hbase å­å¨æ¶æ\n\n> å¨ hbase ä¸­ï¼è¡¨è¢«åå²æå¤ä¸ªæ´å°çåç¶ååæ£çå­å¨å¨ä¸åçæå¡å¨ä¸ï¼è¿äºå°åå«å regionsï¼å­æ¾ regions çå°æ¹å«å regionserverãmaster è¿ç¨è´è´£å¤çä¸åç regionserver ä¹é´ç region çååã\n\n\n# æ¦è§\n\n\n\nhbase ä¸»è¦å¤çä¸¤ç§æä»¶ï¼é¢åæ¥å¿ï¼walï¼åå®éæ°æ®æä»¶ hfileãä¸ä¸ªåºæ¬çæµç¨æ¯å®¢æ·ç«¯é¦åèç³» zookeeper éç¾¤æ¥æ¾è¡é®ãä¸è¿°è¿ç¨æ¯éè¿ zookeeper è·åæ¬§å«æ -root- ç region æå¡å¨æ¥å®æçãéè¿å«æ -root- ç region æå¡å¨å¯ä»¥æ¥è¯¢å°å«æ .meta. è¡¨ä¸­å¯¹åºç region æå¡å¨åï¼å¶ä¸­åå«è¯·æ±çè¡é®ä¿¡æ¯ãè¿ä¸¤ç§åå®¹é½ä¼è¢«ç¼å­ä¸æ¥ï¼å¹¶ä¸åªæ¥è¯¢ä¸æ¬¡ãæç»ï¼éè¿æ¥è¯¢ .meta. æå¡å¨æ¥è·åå®¢æ·ç«¯æ¥è¯¢çè¡é®æ°æ®æå¨ region çæå¡å¨åã\n\n\n# region\n\nhbase table ä¸­çææè¡æç§ row key çå­å¸åºæåãhbase table æ ¹æ® row key çèå´åçï¼æ¯ä¸ªåçå«å regionãä¸ä¸ª region åå«äºå¨ start key å end key ä¹é´çææè¡ã\n\n\n\nhbase æ¯æèªå¨ååºï¼æ¯ä¸ªè¡¨åå§åªæä¸ä¸ª regionï¼éçæ°æ®ä¸æ­å¢å ï¼region ä¼ä¸æ­å¢å¤§ï¼å½å¢å¤§å°ä¸ä¸ªéå¼çæ¶åï¼region å°±ä¼åè£ä¸ºä¸¤ä¸ªæ°ç regionãå½ table ä¸­çè¡ä¸æ­å¢å¤ï¼å°±ä¼æè¶æ¥è¶å¤ç regionã\n\nregion æ¯ hbase ä¸­åå¸å¼å­å¨åè´è½½åè¡¡çæå°ååãè¿æå³çä¸åç region å¯ä»¥åå¸å¨ä¸åç region server ä¸ãä½ä¸ä¸ª region æ¯ä¸ä¼æåå°å¤ä¸ª server ä¸çã\n\n\n\n\n# region server\n\nregion åªä¸è¿æ¯è¡¨è¢«æåï¼å¹¶åå¸å¨ region serverã\n\nregion server è¿è¡å¨ hdfs ç datanode ä¸ãå®å·æä»¥ä¸ç»ä»¶ï¼\n\n * wal(write ahead logï¼é¢åæ¥å¿)ï¼ç¨äºå­å¨å°æªè¿æä¹åå­å¨çæ°æ®è®°å½ï¼ä»¥ä¾¿å¨åçæéæ¶è¿è¡æ¢å¤ãå¦æå wal å¤±è´¥äºï¼é£ä¹ä¿®æ¹æ°æ®çå®æ´æä½å°±æ¯å¤±è´¥çã\n   * éå¸¸æåµï¼æ¯ä¸ª regionserver åªæä¸ä¸ª wal å®ä¾ãå¨ 2.0 ä¹åï¼wal çå®ç°å«å hlog\n   * wal ä½äº /hbase/wals/ ç®å½ä¸\n   * å¦ææ¯ä¸ª regionserver åªæä¸ä¸ª walï¼ç±äº hdfs å¿é¡»æ¯è¿ç»­çï¼å¯¼è´å¿é¡»å wal è¿ç»­çï¼ç¶ååºç°æ§è½é®é¢ãmultiwal å¯ä»¥è®© regionserver åæ¶åå¤ä¸ª wal å¹¶è¡çï¼éè¿ hdfs åºå±çå¤ç®¡éï¼æç»æåæ»çååéï¼ä½æ¯ä¸ä¼æååä¸ª region çååéã\n * blockcacheï¼è¯»ç¼å­ãå®å°é¢ç¹è¯»åçæ°æ®å­å¨å¨åå­ä¸­ï¼å¦æå­å¨ä¸è¶³ï¼å®å°æç§ æè¿æå°ä½¿ç¨åå æ¸é¤å¤ä½çæ°æ®ã\n * memstoreï¼åç¼å­ãå®å­å¨å°æªåå¥ç£ççæ°æ°æ®ï¼å¹¶ä¼å¨æ°æ®åå¥ç£çä¹åå¯¹å¶è¿è¡æåºãæ¯ä¸ª region ä¸çæ¯ä¸ªåæé½æä¸ä¸ª memstoreã\n * hfileï¼å°è¡æ°æ®æç§ key/values çå½¢å¼å­å¨å¨æä»¶ç³»ç»ä¸ãhfile æ¯ hbase å¨ hdfs ä¸­å­å¨æ°æ®çæ ¼å¼ï¼å®åå«å¤å±çç´¢å¼ï¼è¿æ ·å¨ hbase æ£ç´¢æ°æ®çæ¶åå°±ä¸ç¨å®å¨çå è½½æ´ä¸ªæä»¶ãhfile å­å¨çæ ¹ç®å½é»è®¤ä¸ºä¸º /hbaseãç´¢å¼çå¤§å°(keys çå¤§å°ï¼æ°æ®éçå¤§å°)å½±å block çå¤§å°ï¼å¨å¤§æ°æ®éçæåµä¸ï¼block çå¤§å°è®¾ç½®ä¸ºæ¯ä¸ª regionserver 1gb ä¹æ¯å¸¸è§çã\n   * èµ·åï¼hfile ä¸­å¹¶æ²¡æä»»ä½ blockï¼æ°æ®è¿å­å¨äº memstore ä¸­ã\n   * flush åçæ¶ï¼åå»º hfile writerï¼ç¬¬ä¸ä¸ªç©ºç data block åºç°ï¼åå§ååç data block ä¸­ä¸º header é¨åé¢çäºç©ºé´ï¼header é¨åç¨æ¥å­æ¾ä¸ä¸ª data block çåæ°æ®ä¿¡æ¯ã\n   * èåï¼ä½äº memstore ä¸­ç keyvalues è¢«ä¸ä¸ªä¸ª append å°ä½äºåå­ä¸­çç¬¬ä¸ä¸ª data block ä¸­ï¼\n\n\n\nregion server å­åä¸ä¸ªå­è¡¨æ¶ï¼ä¼åå»ºä¸ä¸ª region å¯¹è±¡ï¼ç¶åå¯¹è¡¨çæ¯ä¸ªåæåå»ºä¸ä¸ª store å®ä¾ï¼æ¯ä¸ª store ä¼æ 0 ä¸ªæå¤ä¸ª storefile ä¸ä¹å¯¹åºï¼æ¯ä¸ª storefile åå¯¹åºä¸ä¸ª hfileï¼hfile å°±æ¯å®éå­å¨å¨ hdfs ä¸çæä»¶ã\n\n\n# hbase ç³»ç»æ¶æ\n\n\n\nå hdfsãyarn ä¸æ ·ï¼hbase ä¹éµå¾ª master / slave æ¶æï¼\n\n * hbase æä¸ä¸ª master èç¹ãmaster èç¹è´è´£åè°ç®¡ç region server èç¹ã\n   * master è´è´£å° region åéç» region server èç¹ï¼\n   * master è´è´£æ¢å¤ region server èç¹çæéã\n * hbase æå¤ä¸ª region server èç¹ãregion server èç¹è´è´£é¶ä¸ªæå¤ä¸ª region çç®¡çå¹¶ååºå®¢æ·ç«¯çè¯»åè¯·æ±ãregion server èç¹è¿è´è´£ region çååå¹¶éç¥ master èç¹æäºæ°çå­ regionã\n * hbase ä¾èµ zookeeper æ¥å®ç°æéæ¢å¤ã\n\n\n# master server\n\nmaster server è´è´£åè° region serverãå·ä½èè´£å¦ä¸ï¼\n\n * ä¸º region server åé region ï¼\n * è´è´£ region server çè´è½½åè¡¡ ï¼\n * åç°å¤±æç region server å¹¶éæ°åéå¶ä¸ç regionï¼\n * gfs ä¸çåå¾æä»¶åæ¶ï¼\n * å¤ç schema çæ´æ°è¯·æ±ã\n\n\n\n\n# region server\n\n * region server è´è´£ç»´æ¤ master server åéç»å®ç regionï¼å¹¶å¤çåéå° region ä¸ç io è¯·æ±ï¼\n * å½ region è¿å¤§ï¼region server è´è´£èªå¨ååºï¼å¹¶éç¥ master server è®°å½æ´æ°ã\n\n\n\n\n# zookeeper\n\nhbase ä¾èµ zookeeper ä½ä¸ºåå¸å¼åè°æå¡æ¥ç»´æ¤éç¾¤ä¸­çæå¡å¨ç¶æãzookeeper ç»´æ¤åªäºæå¡å¨æ¯æ´»å¨çåå¯ç¨çï¼å¹¶æä¾æå¡å¨æééç¥ãéç¾¤è³å°åºè¯¥æ 3 ä¸ªèç¹ã\n\nzookeeper çä½ç¨ï¼\n\n * ä¿è¯ä»»ä½æ¶åï¼éç¾¤ä¸­åªæä¸ä¸ª masterï¼\n * å­å¨ææ region çå¯»åå¥å£ï¼\n * å®æ¶çæ§ region server çç¶æï¼å° region server çä¸çº¿åä¸çº¿ä¿¡æ¯å®æ¶éç¥ç» masterï¼\n * å­å¨ hbase ç schemaï¼åæ¬æåªäº tableï¼æ¯ä¸ª table æåªäº column family ç­ä¿¡æ¯ã\n\n\n\nä»¥ä¸ï¼æéè¦çä¸ç¹æ¯ zookeeper å¦ä½ä¿è¯ hbase éç¾¤ä¸­åªæä¸ä¸ª master server çå¢ï¼\n\n * ææ master server ä¼ç«äº zookeeper ç znode éï¼ä¸ä¸ªä¸´æ¶èç¹ï¼ï¼åªæä¸ä¸ª master server è½å¤åå»ºæåï¼æ­¤æ¶è¯¥ master å°±æ¯ä¸» masterã\n * ä¸» master ä¼å®æå zookeeper åéå¿è·³ãä» master åéè¿ watcher æºå¶å¯¹ä¸» master æå¨èç¹è¿è¡çå¬ã\n * å¦æï¼ä¸» master æªè½åæ¶åéå¿è·³ï¼åå¶ææç zookeeper ä¼è¯ä¼è¿æï¼ç¸åºç znode éï¼ä¸ä¸ªä¸´æ¶èç¹ï¼ä¼è¢«èªå¨å é¤ãè¿ä¼è§¦åå®ä¹å¨è¯¥èç¹ä¸ç watcher äºä»¶ï¼ææä» master ä¼å¾å°éç¥ï¼å¹¶åæ¬¡å¼å§ç«äº znode éï¼ç´å°å®æä¸» master çéä¸¾ã\n\nhbase åé¨ä¿çåä¸º hbase:meta çç¹æ®ç®å½è¡¨ï¼catalog tableï¼ãå®ç»´æ¤çå½åéç¾¤ä¸ææ region çåè¡¨ãç¶æåä½ç½®ãhbase:meta è¡¨ä¸­çé¡¹ä½¿ç¨ region ä½ä¸ºé®ãregion åç±æå±çè¡¨åãregion çèµ·å§è¡ãregionçåå»ºæ¶é´ä»¥ååºäºæ´ä½è®¡ç®å¾åºç md5 ç»æã\n\n\n# hbase è¯»åæµç¨\n\n\n# åå¥æ°æ®çæµç¨\n\n 1. client å region server æäº¤åè¯·æ±ï¼\n 2. region server æ¾å°ç®æ  regionï¼\n 3. region æ£æ¥æ°æ®æ¯å¦ä¸ schema ä¸è´ï¼\n 4. å¦æå®¢æ·ç«¯æ²¡ææå®çæ¬ï¼åè·åå½åç³»ç»æ¶é´ä½ä¸ºæ°æ®çæ¬ï¼\n 5. å°æ´æ°åå¥ wal logï¼\n 6. å°æ´æ°åå¥ memstoreï¼\n 7. å¤æ­ memstore å­å¨æ¯å¦å·²æ»¡ï¼å¦æå­å¨å·²æ»¡åéè¦ flush ä¸º store hfile æä»¶ã\n\n> æ´ä¸ºè¯¦ç»åå¥æµç¨å¯ä»¥åèï¼hbase ï¼ æ°æ®åå¥æµç¨è§£æ\n\n\n# è¯»åæ°æ®çæµç¨\n\nä»¥ä¸æ¯å®¢æ·ç«¯é¦æ¬¡è¯»å hbase ä¸æ°æ®çæµç¨ï¼\n\n 1. å®¢æ·ç«¯ä» zookeeper è·å meta è¡¨æå¨ç region serverï¼\n 2. å®¢æ·ç«¯è®¿é® meta è¡¨æå¨ç region serverï¼ä» meta è¡¨ä¸­æ¥è¯¢å°è®¿é®è¡é®æå¨ç region serverï¼ä¹åå®¢æ·ç«¯å°ç¼å­è¿äºä¿¡æ¯ä»¥å meta è¡¨çä½ç½®ï¼\n 3. å®¢æ·ç«¯ä»è¡é®æå¨ç region server ä¸è·åæ°æ®ã\n\nå¦æåæ¬¡è¯»åï¼å®¢æ·ç«¯å°ä»ç¼å­ä¸­è·åè¡é®æå¨ç region serverãè¿æ ·å®¢æ·ç«¯å°±ä¸éè¦åæ¬¡æ¥è¯¢ meta è¡¨ï¼é¤é region ç§»å¨å¯¼è´ç¼å­å¤±æï¼è¿æ ·çè¯ï¼åå°ä¼éæ°æ¥è¯¢å¹¶æ´æ°ç¼å­ã\n\næ³¨ï¼meta è¡¨æ¯ hbase ä¸­ä¸å¼ ç¹æ®çè¡¨ï¼å®ä¿å­äºææ region çä½ç½®ä¿¡æ¯ï¼meta è¡¨èªå·±çä½ç½®ä¿¡æ¯åå­å¨å¨ zookeeper ä¸ã\n\n\n\n> æ´ä¸ºè¯¦ç»è¯»åæ°æ®æµç¨åèï¼\n> \n> hbase åçï¼æ°æ®è¯»åæµç¨è§£æ\n> \n> hbase åçï¼è¿å°çâæ°æ®è¯»åæµç¨é¨åç»è\n\n\n# åèèµæ\n\n * å®æ¹\n   * hbase å®ç½\n   * hbase å®æ¹ææ¡£\n   * hbase å®æ¹ææ¡£ä¸­æç\n   * hbase api\n * æç¨\n   * bigdata-notes\n * æç« \n   * bigtable: a distributed storage system for structured data\n   * an in-depth look at the hbase architecture\n   * å¥é¨ hbaseï¼çè¿ä¸ç¯å°±å¤äº\n   * https://bighadoop.wordpress.com/tag/hbase/",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"HBase Java API åºç¡ç¹æ§",frontmatter:{title:"HBase Java API åºç¡ç¹æ§",date:"2023-03-15T20:28:32.000Z",categories:["æ°æ®åº","åå¼æ°æ®åº","HBase"],tags:["å¤§æ°æ®","HBase"],permalink:"/pages/a8cad3/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/06.%E5%88%97%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93/01.HBase/10.HBaseJavaApi%E5%9F%BA%E7%A1%80%E7%89%B9%E6%80%A7.html",relativePath:"12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/10.HBaseJavaApiåºç¡ç¹æ§.md",key:"v-5bd38cef",path:"/pages/a8cad3/",headers:[{level:2,title:"HBase Client API",slug:"hbase-client-api",normalizedTitle:"hbase client api",charIndex:26},{level:3,title:"HBase Java API ç¤ºä¾",slug:"hbase-java-api-ç¤ºä¾",normalizedTitle:"hbase java api ç¤ºä¾",charIndex:47},{level:2,title:"æ°æ®åºè¿æ¥",slug:"æ°æ®åºè¿æ¥",normalizedTitle:"æ°æ®åºè¿æ¥",charIndex:8039},{level:2,title:"æ¦è¿°",slug:"æ¦è¿°",normalizedTitle:"æ¦è¿°",charIndex:10713},{level:2,title:"CRUD æä½",slug:"crud-æä½",normalizedTitle:"crud æä½",charIndex:11087},{level:3,title:"put",slug:"put",normalizedTitle:"put",charIndex:2485},{level:4,title:"KeyValue ç±»",slug:"keyvalue-ç±»",normalizedTitle:"keyvalue ç±»",charIndex:11469},{level:4,title:"å®¢æ·ç«¯çåç¼å²åº",slug:"å®¢æ·ç«¯çåç¼å²åº",normalizedTitle:"å®¢æ·ç«¯çåç¼å²åº",charIndex:11811},{level:4,title:"Put åè¡¨",slug:"put-åè¡¨",normalizedTitle:"put åè¡¨",charIndex:12055},{level:4,title:"åå­æ§æä½ compare-and-set",slug:"åå­æ§æä½-compare-and-set",normalizedTitle:"åå­æ§æä½ compare-and-set",charIndex:12145},{level:3,title:"get",slug:"get",normalizedTitle:"get",charIndex:971},{level:4,title:"Result ç±»",slug:"result-ç±»",normalizedTitle:"result ç±»",charIndex:12387},{level:2,title:"delete",slug:"delete",normalizedTitle:"delete",charIndex:1885},{level:2,title:"æ¹å¤çæä½",slug:"æ¹å¤çæä½",normalizedTitle:"æ¹å¤çæä½",charIndex:12977},{level:2,title:"è¡é",slug:"è¡é",normalizedTitle:"è¡é",charIndex:13178},{level:2,title:"æ«æ",slug:"æ«æ",normalizedTitle:"æ«æ",charIndex:10985},{level:3,title:"ResultScanner",slug:"resultscanner",normalizedTitle:"resultscanner",charIndex:5276},{level:3,title:"ç¼å­ä¸æ¹éå¤ç",slug:"ç¼å­ä¸æ¹éå¤ç",normalizedTitle:"ç¼å­ä¸æ¹éå¤ç",charIndex:13698},{level:2,title:"åç§ç¹æ§",slug:"åç§ç¹æ§",normalizedTitle:"åç§ç¹æ§",charIndex:13931},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:13977}],headersStr:"HBase Client API HBase Java API ç¤ºä¾ æ°æ®åºè¿æ¥ æ¦è¿° CRUD æä½ put KeyValue ç±» å®¢æ·ç«¯çåç¼å²åº Put åè¡¨ åå­æ§æä½ compare-and-set get Result ç±» delete æ¹å¤çæä½ è¡é æ«æ ResultScanner ç¼å­ä¸æ¹éå¤ç åç§ç¹æ§ åèèµæ",content:'# HBase Java API åºç¡ç¹æ§\n\n\n# HBase Client API\n\n\n# HBase Java API ç¤ºä¾\n\nå¼å¥ä¾èµ\n\n<dependency>\n    <groupId>org.apache.hbase</groupId>\n    <artifactId>hbase-client</artifactId>\n    <version>2.1.4</version>\n</dependency>\n\n\nç¤ºä¾\n\npublic class HBaseUtils {\n\n    private static Connection connection;\n\n    static {\n        Configuration configuration = HBaseConfiguration.create();\n        configuration.set("hbase.zookeeper.property.clientPort", "2181");\n        // å¦ææ¯éç¾¤ åä¸»æºåç¨éå·åé\n        configuration.set("hbase.zookeeper.quorum", "hadoop001");\n        try {\n            connection = ConnectionFactory.createConnection(configuration);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n\n    /**\n     * åå»º HBase è¡¨\n     *\n     * @param tableName      è¡¨å\n     * @param columnFamilies åæçæ°ç»\n     */\n    public static boolean createTable(String tableName, List<String> columnFamilies) {\n        try {\n            HBaseAdmin admin = (HBaseAdmin) connection.getAdmin();\n            if (admin.tableExists(TableName.valueOf(tableName))) {\n                return false;\n            }\n            TableDescriptorBuilder tableDescriptor = TableDescriptorBuilder.newBuilder(TableName.valueOf(tableName));\n            columnFamilies.forEach(columnFamily -> {\n                ColumnFamilyDescriptorBuilder cfDescriptorBuilder = ColumnFamilyDescriptorBuilder.newBuilder(Bytes.toBytes(columnFamily));\n                cfDescriptorBuilder.setMaxVersions(1);\n                ColumnFamilyDescriptor familyDescriptor = cfDescriptorBuilder.build();\n                tableDescriptor.setColumnFamily(familyDescriptor);\n            });\n            admin.createTable(tableDescriptor.build());\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        return true;\n    }\n\n\n    /**\n     * å é¤ hBase è¡¨\n     *\n     * @param tableName è¡¨å\n     */\n    public static boolean deleteTable(String tableName) {\n        try {\n            HBaseAdmin admin = (HBaseAdmin) connection.getAdmin();\n            // å é¤è¡¨åéè¦åç¦ç¨è¡¨\n            admin.disableTable(TableName.valueOf(tableName));\n            admin.deleteTable(TableName.valueOf(tableName));\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        return true;\n    }\n\n    /**\n     * æå¥æ°æ®\n     *\n     * @param tableName        è¡¨å\n     * @param rowKey           å¯ä¸æ è¯\n     * @param columnFamilyName åæå\n     * @param qualifier        åæ è¯\n     * @param value            æ°æ®\n     */\n    public static boolean putRow(String tableName, String rowKey, String columnFamilyName, String qualifier,\n                                 String value) {\n        try {\n            Table table = connection.getTable(TableName.valueOf(tableName));\n            Put put = new Put(Bytes.toBytes(rowKey));\n            put.addColumn(Bytes.toBytes(columnFamilyName), Bytes.toBytes(qualifier), Bytes.toBytes(value));\n            table.put(put);\n            table.close();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        return true;\n    }\n\n\n    /**\n     * æå¥æ°æ®\n     *\n     * @param tableName        è¡¨å\n     * @param rowKey           å¯ä¸æ è¯\n     * @param columnFamilyName åæå\n     * @param pairList         åæ è¯åå¼çéå\n     */\n    public static boolean putRow(String tableName, String rowKey, String columnFamilyName, List<Pair<String, String>> pairList) {\n        try {\n            Table table = connection.getTable(TableName.valueOf(tableName));\n            Put put = new Put(Bytes.toBytes(rowKey));\n            pairList.forEach(pair -> put.addColumn(Bytes.toBytes(columnFamilyName), Bytes.toBytes(pair.getKey()), Bytes.toBytes(pair.getValue())));\n            table.put(put);\n            table.close();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        return true;\n    }\n\n\n    /**\n     * æ ¹æ® rowKey è·åæå®è¡çæ°æ®\n     *\n     * @param tableName è¡¨å\n     * @param rowKey    å¯ä¸æ è¯\n     */\n    public static Result getRow(String tableName, String rowKey) {\n        try {\n            Table table = connection.getTable(TableName.valueOf(tableName));\n            Get get = new Get(Bytes.toBytes(rowKey));\n            return table.get(get);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        return null;\n    }\n\n\n    /**\n     * è·åæå®è¡æå®å (cell) çææ°çæ¬çæ°æ®\n     *\n     * @param tableName    è¡¨å\n     * @param rowKey       å¯ä¸æ è¯\n     * @param columnFamily åæ\n     * @param qualifier    åæ è¯\n     */\n    public static String getCell(String tableName, String rowKey, String columnFamily, String qualifier) {\n        try {\n            Table table = connection.getTable(TableName.valueOf(tableName));\n            Get get = new Get(Bytes.toBytes(rowKey));\n            if (!get.isCheckExistenceOnly()) {\n                get.addColumn(Bytes.toBytes(columnFamily), Bytes.toBytes(qualifier));\n                Result result = table.get(get);\n                byte[] resultValue = result.getValue(Bytes.toBytes(columnFamily), Bytes.toBytes(qualifier));\n                return Bytes.toString(resultValue);\n            } else {\n                return null;\n            }\n\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        return null;\n    }\n\n\n    /**\n     * æ£ç´¢å¨è¡¨\n     *\n     * @param tableName è¡¨å\n     */\n    public static ResultScanner getScanner(String tableName) {\n        try {\n            Table table = connection.getTable(TableName.valueOf(tableName));\n            Scan scan = new Scan();\n            return table.getScanner(scan);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        return null;\n    }\n\n\n    /**\n     * æ£ç´¢è¡¨ä¸­æå®æ°æ®\n     *\n     * @param tableName  è¡¨å\n     * @param filterList è¿æ»¤å¨\n     */\n\n    public static ResultScanner getScanner(String tableName, FilterList filterList) {\n        try {\n            Table table = connection.getTable(TableName.valueOf(tableName));\n            Scan scan = new Scan();\n            scan.setFilter(filterList);\n            return table.getScanner(scan);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        return null;\n    }\n\n    /**\n     * æ£ç´¢è¡¨ä¸­æå®æ°æ®\n     *\n     * @param tableName   è¡¨å\n     * @param startRowKey èµ·å§ RowKey\n     * @param endRowKey   ç»æ­¢ RowKey\n     * @param filterList  è¿æ»¤å¨\n     */\n\n    public static ResultScanner getScanner(String tableName, String startRowKey, String endRowKey,\n                                           FilterList filterList) {\n        try {\n            Table table = connection.getTable(TableName.valueOf(tableName));\n            Scan scan = new Scan();\n            scan.withStartRow(Bytes.toBytes(startRowKey));\n            scan.withStopRow(Bytes.toBytes(endRowKey));\n            scan.setFilter(filterList);\n            return table.getScanner(scan);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        return null;\n    }\n\n    /**\n     * å é¤æå®è¡è®°å½\n     *\n     * @param tableName è¡¨å\n     * @param rowKey    å¯ä¸æ è¯\n     */\n    public static boolean deleteRow(String tableName, String rowKey) {\n        try {\n            Table table = connection.getTable(TableName.valueOf(tableName));\n            Delete delete = new Delete(Bytes.toBytes(rowKey));\n            table.delete(delete);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        return true;\n    }\n\n\n    /**\n     * å é¤æå®è¡æå®å\n     *\n     * @param tableName  è¡¨å\n     * @param rowKey     å¯ä¸æ è¯\n     * @param familyName åæ\n     * @param qualifier  åæ è¯\n     */\n    public static boolean deleteColumn(String tableName, String rowKey, String familyName,\n                                          String qualifier) {\n        try {\n            Table table = connection.getTable(TableName.valueOf(tableName));\n            Delete delete = new Delete(Bytes.toBytes(rowKey));\n            delete.addColumn(Bytes.toBytes(familyName), Bytes.toBytes(qualifier));\n            table.delete(delete);\n            table.close();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        return true;\n    }\n\n}\n\n\n\n# æ°æ®åºè¿æ¥\n\nå¨ä¸é¢çä»£ç ä¸­ï¼å¨ç±»å è½½æ¶å°±åå§åäº Connection è¿æ¥ï¼å¹¶ä¸ä¹åçæ¹æ³é½æ¯å¤ç¨è¿ä¸ª Connectionï¼è¿æ¶æä»¬å¯è½ä¼èèæ¯å¦å¯ä»¥ä½¿ç¨èªå®ä¹è¿æ¥æ± æ¥è·åæ´å¥½çæ§è½è¡¨ç°ï¼å®éä¸è¿æ¯æ²¡æå¿è¦çã\n\né¦åå®æ¹å¯¹äº Connection çä½¿ç¨è¯´æå¦ä¸ï¼\n\nConnection Pooling For applications which require high-end multithreaded\naccess (e.g., web-servers or  application servers  that may serve many\napplication threads in a single JVM), you can pre-create a Connection,\nas shown in the following example:\n\nå¯¹äºé«å¹¶åå¤çº¿ç¨è®¿é®çåºç¨ç¨åºï¼ä¾å¦ï¼å¨åä¸ª JVM ä¸­å­å¨çä¸ºå¤ä¸ªçº¿ç¨æå¡ç Web æå¡å¨æåºç¨ç¨åºæå¡å¨ï¼ï¼\næ¨åªéè¦é¢ååå»ºä¸ä¸ª Connectionãä¾å­å¦ä¸ï¼\n\n// Create a connection to the cluster.\nConfiguration conf = HBaseConfiguration.create();\ntry (Connection connection = ConnectionFactory.createConnection(conf);\n     Table table = connection.getTable(TableName.valueOf(tablename))) {\n  // use table as needed, the table returned is lightweight\n}\n\n\nä¹æä»¥è½è¿æ ·ä½¿ç¨ï¼è¿æ¯å ä¸º Connection å¹¶ä¸æ¯ä¸ä¸ªç®åç socket è¿æ¥ï¼æ¥å£ææ¡£ ä¸­å¯¹ Connection çè¡¨è¿°æ¯ï¼\n\nA cluster connection encapsulating lower level individual connections to actual servers and a\nconnection to zookeeper.  Connections are instantiated through the ConnectionFactory class.\nThe lifecycle of the connection is managed by the caller,  who has to close() the connection\nto release the resources.\n\nConnection æ¯ä¸ä¸ªéç¾¤è¿æ¥ï¼å°è£äºä¸å¤å°æå¡å¨ï¼Matser/Region Serverï¼çåºå±è¿æ¥ä»¥åä¸ zookeeper çè¿æ¥ã\nè¿æ¥éè¿ ConnectionFactory  ç±»å®ä¾åãè¿æ¥ççå½å¨æç±è°ç¨èç®¡çï¼è°ç¨èå¿é¡»ä½¿ç¨ close() å³é­è¿æ¥ä»¥éæ¾èµæºã\n\n\nä¹æä»¥å°è£è¿äºè¿æ¥ï¼æ¯å ä¸º HBase å®¢æ·ç«¯éè¦è¿æ¥ä¸ä¸ªä¸åçæå¡è§è²ï¼\n\n * Zookeeper ï¼ä¸»è¦ç¨äºè·å meta è¡¨çä½ç½®ä¿¡æ¯ï¼Master çä¿¡æ¯ï¼\n * HBase Master ï¼ä¸»è¦ç¨äºæ§è¡ HBaseAdmin æ¥å£çä¸äºæä½ï¼ä¾å¦å»ºè¡¨ç­ï¼\n * HBase RegionServer ï¼ç¨äºè¯»ãåæ°æ®ã\n\n\n\nConnection å¯¹è±¡åå®éç Socket è¿æ¥ä¹é´çå¯¹åºå³ç³»å¦ä¸å¾ï¼\n\n\n\nå¨ HBase å®¢æ·ç«¯ä»£ç ä¸­ï¼çæ­£å¯¹åº Socket è¿æ¥çæ¯ RpcConnection å¯¹è±¡ãHBase ä½¿ç¨ PoolMap è¿ç§æ°æ®ç»ææ¥å­å¨å®¢æ·ç«¯å° HBase æå¡å¨ä¹é´çè¿æ¥ãPoolMap çåé¨æä¸ä¸ª ConcurrentHashMap å®ä¾ï¼å¶ key æ¯ ConnectionId(å°è£äºæå¡å¨å°ååç¨æ· ticket)ï¼value æ¯ä¸ä¸ª RpcConnection å¯¹è±¡çèµæºæ± ãå½ HBase éè¦è¿æ¥ä¸ä¸ªæå¡å¨æ¶ï¼é¦åä¼æ ¹æ® ConnectionId æ¾å°å¯¹åºçè¿æ¥æ± ï¼ç¶åä»è¿æ¥æ± ä¸­ååºä¸ä¸ªè¿æ¥å¯¹è±¡ã\n\n@InterfaceAudience.Private\npublic class PoolMap<K, V> implements Map<K, V> {\n  private PoolType poolType;\n\n  private int poolMaxSize;\n\n  private Map<K, Pool<V>> pools = new ConcurrentHashMap<>();\n\n  public PoolMap(PoolType poolType) {\n    this.poolType = poolType;\n  }\n  .....\n\n\nHBase ä¸­æä¾äºä¸ç§èµæºæ± çå®ç°ï¼åå«æ¯ Reusableï¼RoundRobin å ThreadLocalãå·ä½å®ç°å¯ä»¥é hbase.client.ipc.pool.type éç½®é¡¹æå®ï¼é»è®¤ä¸º Reusableãè¿æ¥æ± çå¤§å°ä¹å¯ä»¥éè¿ hbase.client.ipc.pool.size éç½®é¡¹æå®ï¼é»è®¤ä¸º 1ï¼å³æ¯ä¸ª Server 1 ä¸ªè¿æ¥ãä¹å¯ä»¥éè¿ä¿®æ¹éç½®å®ç°ï¼\n\nconfig.set("hbase.client.ipc.pool.type",...);\nconfig.set("hbase.client.ipc.pool.size",...);\nconnection = ConnectionFactory.createConnection(config);\n\n\nç±æ­¤å¯ä»¥çåº HBase ä¸­ Connection ç±»å·²ç»å®ç°äºå¯¹è¿æ¥çç®¡çåè½ï¼æä»¥æä»¬ä¸å¿å¨ Connection ä¸å¨åé¢å¤çç®¡çã\n\nå¦å¤ï¼Connection æ¯çº¿ç¨å®å¨çï¼ä½ Table å Admin å´ä¸æ¯çº¿ç¨å®å¨çï¼å æ­¤æ­£ç¡®çåæ³æ¯ä¸ä¸ªè¿ç¨å±ç¨ä¸ä¸ª Connection å¯¹è±¡ï¼èå¨ä¸åççº¿ç¨ä¸­ä½¿ç¨åç¬ç Table å Admin å¯¹è±¡ãTable å Admin çè·åæä½ getTable() å getAdmin() é½æ¯è½»éçº§ï¼æä»¥ä¸å¿æå¿æ§è½çæ¶èï¼åæ¶å»ºè®®å¨ä½¿ç¨å®æåæ¾ç¤ºçè°ç¨ close() æ¹æ³æ¥å³é­å®ä»¬ã\n\n\n# æ¦è¿°\n\nHBase çä¸»è¦å®¢æ·ç«¯æä½æ¯ç± org.apache.hadoop.hbase.client.HTable æä¾çãåå»º HTable å®ä¾éå¸¸èæ¶ï¼æä»¥ï¼å»ºè®®æ¯ä¸ªçº¿ç¨åªåå»ºä¸æ¬¡ HTable å®ä¾ã\n\nHBase ææä¿®æ¹æ°æ®çæä½é½ä¿è¯äºè¡çº§å«çåå­æ§ãè¦ä¹è¯»å°ææ°çä¿®æ¹ï¼è¦ä¹ç­å¾ç³»ç»åè®¸åå¥æ¹è¡ä¿®æ¹\n\nç¨æ·è¦å°½éä½¿ç¨æ¹å¤ç(batch)æ´æ°æ¥åå°åç¬æä½åä¸è¡æ°æ®çæ¬¡æ°\n\nåæä½ä¸­è®¾è®¡çåçæ°ç®å¹¶ä¸ä¼å½±åè¯¥è¡æ°æ®çåå­æ§ï¼è¡åå­æ§ä¼åæ¶ä¿æ¤å°ææå\n\nåå»º HTable å®ä¾ï¼æçæ¯å¨ java ä¸­æ°å»ºè¯¥ç±»ï¼ï¼æ¯ä¸ªå®ä¾é½è¦æ«æ.META. è¡¨ï¼ä»¥æ£æ¥è¯¥è¡¨æ¯å¦å­å¨ï¼æ¨èç¨æ·åªåå»ºä¸æ¬¡ HTable å®ä¾ï¼èä¸æ¯æ¯ä¸ªçº¿ç¨åå»ºä¸ä¸ª\n\nå¦æç¨æ·éè¦å¤ä¸ª HTable å®ä¾ï¼å»ºè®®ä½¿ç¨ HTablePool ç±»ï¼ç±»ä¼¼è¿æ¥æ± ï¼\n\n\n# CRUD æä½\n\n\n# put\n\nTable æ¥å£æä¾äºä¸¤ä¸ª put æ¹æ³\n\n// åå¥åè¡ put\nvoid put(Put put) throws IOException;\n// æ¹éåå¥ put\nvoid put(List<Put> puts) throws IOException;\n\n\nPut ç±»æä¾äºå¤ç§æé å¨æ¹æ³ç¨æ¥åå§åå®ä¾ã\n\nPut ç±»è¿æä¾äºä¸ç³»åæç¨çæ¹æ³ï¼\n\nå¤ä¸ª add æ¹æ³ï¼ç¨äºæ·»å æå®çåæ°æ®ã\n\nhas æ¹æ³ï¼ç¨äºæ£æ¥æ¯å¦å­å¨ç¹å®çååæ ¼ï¼èä¸éè¦éåæ´ä¸ªéå\n\ngetFamilyMap æ¹æ³ï¼å¯ä»¥éå Put å®ä¾ä¸­æ¯ä¸ä¸ªå¯ç¨ç KeyValue å®ä¾\n\ngetRow æ¹æ³ï¼ç¨äºè·å rowkey Put.heapSize() å¯ä»¥è®¡ç®å½å Put å®ä¾æéçå å¤§å°ï¼æ¢åå«å¶ä¸­çæ°æ®ï¼ä¹åå«åé¨æ°æ®ç»ææéçç©ºé´\n\n# KeyValue ç±»\n\nç¹å®ååæ ¼çæ°æ®ä»¥ååæ ï¼åæ åæ¬è¡é®ãåæåãåéå®ç¬¦ä»¥åæ¶é´æ³ KeyValue(byte[] row, int roffset, int rlength, byte[] family, int foffoset, int flength, byte[] qualifier, int qoffset, int qlength, long timestamp, Type type, byte[] value, int voffset, int vlength) æ¯ä¸ä¸ªå­èæ°ç»é½æä¸ä¸ª offset åæ°åä¸ä¸ª length åæ°ï¼åè®¸ç¨æ·æäº¤ä¸ä¸ªå·²ç»å­å¨çå­èæ°ç»è¿è¡å­èçº§å«æä½ã è¡ç®åæ¥è¯´æçæ¯è¡é®ï¼å³ Put æé å¨éç row åæ°ã\n\n# å®¢æ·ç«¯çåç¼å²åº\n\næ¯ä¸ä¸ª put æä½å®éä¸é½æ¯ä¸ä¸ª RPC æä½ï¼å®å°å®¢æ·ç«¯æ°æ®ä¼ éå°æå¡å¨ç¶åè¿åã\n\nHBase ç API éå¤äºä¸ä¸ªå®¢æ·ç«¯çåç¼å²åºï¼ç¼å²åºè´è´£æ¶é put æä½ï¼ç¶åè°ç¨ RPC æä½ä¸æ¬¡æ§å° put éå¾æå¡å¨ã\n\nvoid setAutoFlush(boolean autoFlush)\nboolean isAutoFlush()\n\n\né»è®¤æåµä¸ï¼å®¢æ·ç«¯ç¼å²åºæ¯ç¦ç¨çãå¯ä»¥éè¿ table.setAutoFlush(false) æ¥æ¿æ´»ç¼å²åºã\n\n# Put åè¡¨\n\næ¹éæäº¤ put åè¡¨ï¼\n\nvoid put(List<Put> puts) throws IOException\n\n\næ³¨æï¼æ¹éæäº¤å¯è½ä¼æé¨åä¿®æ¹å¤±è´¥ã\n\n# åå­æ§æä½ compare-and-set\n\ncheckAndPut æ¹æ³æä¾äº CAS æºå¶æ¥ä¿è¯ put æä½çåå­æ§ã\n\n\n# get\n\nResult get(Get get) throws IOException\n\n\nGet(byte[] row)\nGet(byte[] row, RowLock rowLock)\nGet addColumn(byte[] family, byte[] qualifier)\nGet addFamily(byte[] family)\n\n\n# Result ç±»\n\nå½ç¨æ·ä½¿ç¨ get() æ¹æ³è·åæ°æ®ï¼HBase è¿åçç»æåå«ææå¹éçååæ ¼æ°æ®ï¼è¿äºæ°æ®è¢«å°è£å¨ä¸ä¸ª Result å®ä¾ä¸­è¿åç»ç¨æ·ã\n\nResult ç±»æä¾çæ¹æ³å¦ä¸ï¼\n\nbyte[] getValue(byte[] family, byte[] qualifier)\nbyte[] value()\nbyte[] getRow()\nint size()\nboolean isEmpty()\nKeyValue[] raw()\nList<KeyValue> list()\n\n\n\n# delete\n\nvoid delete(Delete delete) throws IOException\n\n\nDelte(byte[] row)\nDelete(byte[] row, long timestamp, RowLock rowLock)\n\n\nDelete deleteFamily(byte[] family)\nDelete deleteFamily(byte[] family, long timestamp)\nDelete deleteColumns(byte[] family, byte[] qualifier)\nDelete deleteColumn(byte[] family, byte[] qualifier) // åªå é¤ææ°çæ¬\n\n\n\n# æ¹å¤çæä½\n\nRow æ¯ PutãGetãDelete çç¶ç±»ã\n\nvoid batch(List<Row> actions, Object[] results) throws IOException, InterruptedException\nObject batch(List<Row> actions) throws IOException, InterruptedException\n\n\n\n# è¡é\n\nregion æå¡å¨æä¾äºè¡éç¹æ§ï¼è¿ä¸ªç¹æ§ä¿è¯äºåªæä¸ä¸ªå®¢æ·ç«¯è½è·åä¸è¡æ°æ®ç¸åºçéï¼åæ¶å¯¹è¯¥è¡è¿è¡ä¿®æ¹ã\n\nå¦æä¸æ¾ç¤ºæå®éï¼æå¡å¨ä¼éå¼å éã\n\n\n# æ«æ\n\nscanï¼ç±»ä¼¼æ°æ®åºç³»ç»ä¸­ç cursorï¼å©ç¨äº HBase æä¾çåºå±é¡ºåºå­å¨çæ°æ®ç»æã\n\nè°ç¨ HTable ç getScanner å°±å¯ä»¥è¿åæ«æå¨\n\nResultScanner getScanner(Scan scan) throws IOException\nResultScanner getScanner(byte[] family) throws IOException\n\n\nScan ç±»æé å¨å¯ä»¥æ startRowï¼åºé´ä¸è¬ä¸º [startRow, stopRow)\n\nScan(byte[] startRow, Filter filter)\nScan(byte[] startRow)\n\n\n\n# ResultScanner\n\nä»¥è¡ä¸ºåä½è¿è¡è¿å\n\nResult next() throws IOException\nResult[] next(int nbRows) throws IOException\nvoid close()\n\n\n\n# ç¼å­ä¸æ¹éå¤ç\n\næ¯ä¸ä¸ª next()è°ç¨é½ä¼ä¸ºæ¯è¡æ°æ®çæä¸ä¸ªåç¬ç RPC è¯·æ±\n\nå¯ä»¥è®¾ç½®æ«æå¨ç¼å­\n\nvoid setScannerCaching(itn scannerCaching)\nint getScannerCaching()\n\n\nç¼å­æ¯é¢åè¡ä¸çº§æä½ï¼æ¹éæ¯é¢ååä¸çº§æä½\n\nvoid setBatch(int batch)\nint getBatch\n\n\nRPC è¯·æ±çæ¬¡æ°=(è¡æ°*æ¯è¡åæ°)/Min(æ¯è¡çåæ°ï¼æ¹éå¤§å°)/æ«æå¨ç¼å­\n\n\n# åç§ç¹æ§\n\nBytes ç±»æä¾äºä¸ç³»åå°åç Java ç±»ååå­èæ°ç»äºè½¬çæ¹æ³ã\n\n\n# åèèµæ\n\n * ãHBase æå¨æåã\n * ãHBase æå¨æåãå®æ¹æºç ',normalizedContent:'# hbase java api åºç¡ç¹æ§\n\n\n# hbase client api\n\n\n# hbase java api ç¤ºä¾\n\nå¼å¥ä¾èµ\n\n<dependency>\n    <groupid>org.apache.hbase</groupid>\n    <artifactid>hbase-client</artifactid>\n    <version>2.1.4</version>\n</dependency>\n\n\nç¤ºä¾\n\npublic class hbaseutils {\n\n    private static connection connection;\n\n    static {\n        configuration configuration = hbaseconfiguration.create();\n        configuration.set("hbase.zookeeper.property.clientport", "2181");\n        // å¦ææ¯éç¾¤ åä¸»æºåç¨éå·åé\n        configuration.set("hbase.zookeeper.quorum", "hadoop001");\n        try {\n            connection = connectionfactory.createconnection(configuration);\n        } catch (ioexception e) {\n            e.printstacktrace();\n        }\n    }\n\n    /**\n     * åå»º hbase è¡¨\n     *\n     * @param tablename      è¡¨å\n     * @param columnfamilies åæçæ°ç»\n     */\n    public static boolean createtable(string tablename, list<string> columnfamilies) {\n        try {\n            hbaseadmin admin = (hbaseadmin) connection.getadmin();\n            if (admin.tableexists(tablename.valueof(tablename))) {\n                return false;\n            }\n            tabledescriptorbuilder tabledescriptor = tabledescriptorbuilder.newbuilder(tablename.valueof(tablename));\n            columnfamilies.foreach(columnfamily -> {\n                columnfamilydescriptorbuilder cfdescriptorbuilder = columnfamilydescriptorbuilder.newbuilder(bytes.tobytes(columnfamily));\n                cfdescriptorbuilder.setmaxversions(1);\n                columnfamilydescriptor familydescriptor = cfdescriptorbuilder.build();\n                tabledescriptor.setcolumnfamily(familydescriptor);\n            });\n            admin.createtable(tabledescriptor.build());\n        } catch (ioexception e) {\n            e.printstacktrace();\n        }\n        return true;\n    }\n\n\n    /**\n     * å é¤ hbase è¡¨\n     *\n     * @param tablename è¡¨å\n     */\n    public static boolean deletetable(string tablename) {\n        try {\n            hbaseadmin admin = (hbaseadmin) connection.getadmin();\n            // å é¤è¡¨åéè¦åç¦ç¨è¡¨\n            admin.disabletable(tablename.valueof(tablename));\n            admin.deletetable(tablename.valueof(tablename));\n        } catch (exception e) {\n            e.printstacktrace();\n        }\n        return true;\n    }\n\n    /**\n     * æå¥æ°æ®\n     *\n     * @param tablename        è¡¨å\n     * @param rowkey           å¯ä¸æ è¯\n     * @param columnfamilyname åæå\n     * @param qualifier        åæ è¯\n     * @param value            æ°æ®\n     */\n    public static boolean putrow(string tablename, string rowkey, string columnfamilyname, string qualifier,\n                                 string value) {\n        try {\n            table table = connection.gettable(tablename.valueof(tablename));\n            put put = new put(bytes.tobytes(rowkey));\n            put.addcolumn(bytes.tobytes(columnfamilyname), bytes.tobytes(qualifier), bytes.tobytes(value));\n            table.put(put);\n            table.close();\n        } catch (ioexception e) {\n            e.printstacktrace();\n        }\n        return true;\n    }\n\n\n    /**\n     * æå¥æ°æ®\n     *\n     * @param tablename        è¡¨å\n     * @param rowkey           å¯ä¸æ è¯\n     * @param columnfamilyname åæå\n     * @param pairlist         åæ è¯åå¼çéå\n     */\n    public static boolean putrow(string tablename, string rowkey, string columnfamilyname, list<pair<string, string>> pairlist) {\n        try {\n            table table = connection.gettable(tablename.valueof(tablename));\n            put put = new put(bytes.tobytes(rowkey));\n            pairlist.foreach(pair -> put.addcolumn(bytes.tobytes(columnfamilyname), bytes.tobytes(pair.getkey()), bytes.tobytes(pair.getvalue())));\n            table.put(put);\n            table.close();\n        } catch (ioexception e) {\n            e.printstacktrace();\n        }\n        return true;\n    }\n\n\n    /**\n     * æ ¹æ® rowkey è·åæå®è¡çæ°æ®\n     *\n     * @param tablename è¡¨å\n     * @param rowkey    å¯ä¸æ è¯\n     */\n    public static result getrow(string tablename, string rowkey) {\n        try {\n            table table = connection.gettable(tablename.valueof(tablename));\n            get get = new get(bytes.tobytes(rowkey));\n            return table.get(get);\n        } catch (ioexception e) {\n            e.printstacktrace();\n        }\n        return null;\n    }\n\n\n    /**\n     * è·åæå®è¡æå®å (cell) çææ°çæ¬çæ°æ®\n     *\n     * @param tablename    è¡¨å\n     * @param rowkey       å¯ä¸æ è¯\n     * @param columnfamily åæ\n     * @param qualifier    åæ è¯\n     */\n    public static string getcell(string tablename, string rowkey, string columnfamily, string qualifier) {\n        try {\n            table table = connection.gettable(tablename.valueof(tablename));\n            get get = new get(bytes.tobytes(rowkey));\n            if (!get.ischeckexistenceonly()) {\n                get.addcolumn(bytes.tobytes(columnfamily), bytes.tobytes(qualifier));\n                result result = table.get(get);\n                byte[] resultvalue = result.getvalue(bytes.tobytes(columnfamily), bytes.tobytes(qualifier));\n                return bytes.tostring(resultvalue);\n            } else {\n                return null;\n            }\n\n        } catch (ioexception e) {\n            e.printstacktrace();\n        }\n        return null;\n    }\n\n\n    /**\n     * æ£ç´¢å¨è¡¨\n     *\n     * @param tablename è¡¨å\n     */\n    public static resultscanner getscanner(string tablename) {\n        try {\n            table table = connection.gettable(tablename.valueof(tablename));\n            scan scan = new scan();\n            return table.getscanner(scan);\n        } catch (ioexception e) {\n            e.printstacktrace();\n        }\n        return null;\n    }\n\n\n    /**\n     * æ£ç´¢è¡¨ä¸­æå®æ°æ®\n     *\n     * @param tablename  è¡¨å\n     * @param filterlist è¿æ»¤å¨\n     */\n\n    public static resultscanner getscanner(string tablename, filterlist filterlist) {\n        try {\n            table table = connection.gettable(tablename.valueof(tablename));\n            scan scan = new scan();\n            scan.setfilter(filterlist);\n            return table.getscanner(scan);\n        } catch (ioexception e) {\n            e.printstacktrace();\n        }\n        return null;\n    }\n\n    /**\n     * æ£ç´¢è¡¨ä¸­æå®æ°æ®\n     *\n     * @param tablename   è¡¨å\n     * @param startrowkey èµ·å§ rowkey\n     * @param endrowkey   ç»æ­¢ rowkey\n     * @param filterlist  è¿æ»¤å¨\n     */\n\n    public static resultscanner getscanner(string tablename, string startrowkey, string endrowkey,\n                                           filterlist filterlist) {\n        try {\n            table table = connection.gettable(tablename.valueof(tablename));\n            scan scan = new scan();\n            scan.withstartrow(bytes.tobytes(startrowkey));\n            scan.withstoprow(bytes.tobytes(endrowkey));\n            scan.setfilter(filterlist);\n            return table.getscanner(scan);\n        } catch (ioexception e) {\n            e.printstacktrace();\n        }\n        return null;\n    }\n\n    /**\n     * å é¤æå®è¡è®°å½\n     *\n     * @param tablename è¡¨å\n     * @param rowkey    å¯ä¸æ è¯\n     */\n    public static boolean deleterow(string tablename, string rowkey) {\n        try {\n            table table = connection.gettable(tablename.valueof(tablename));\n            delete delete = new delete(bytes.tobytes(rowkey));\n            table.delete(delete);\n        } catch (ioexception e) {\n            e.printstacktrace();\n        }\n        return true;\n    }\n\n\n    /**\n     * å é¤æå®è¡æå®å\n     *\n     * @param tablename  è¡¨å\n     * @param rowkey     å¯ä¸æ è¯\n     * @param familyname åæ\n     * @param qualifier  åæ è¯\n     */\n    public static boolean deletecolumn(string tablename, string rowkey, string familyname,\n                                          string qualifier) {\n        try {\n            table table = connection.gettable(tablename.valueof(tablename));\n            delete delete = new delete(bytes.tobytes(rowkey));\n            delete.addcolumn(bytes.tobytes(familyname), bytes.tobytes(qualifier));\n            table.delete(delete);\n            table.close();\n        } catch (ioexception e) {\n            e.printstacktrace();\n        }\n        return true;\n    }\n\n}\n\n\n\n# æ°æ®åºè¿æ¥\n\nå¨ä¸é¢çä»£ç ä¸­ï¼å¨ç±»å è½½æ¶å°±åå§åäº connection è¿æ¥ï¼å¹¶ä¸ä¹åçæ¹æ³é½æ¯å¤ç¨è¿ä¸ª connectionï¼è¿æ¶æä»¬å¯è½ä¼èèæ¯å¦å¯ä»¥ä½¿ç¨èªå®ä¹è¿æ¥æ± æ¥è·åæ´å¥½çæ§è½è¡¨ç°ï¼å®éä¸è¿æ¯æ²¡æå¿è¦çã\n\né¦åå®æ¹å¯¹äº connection çä½¿ç¨è¯´æå¦ä¸ï¼\n\nconnection pooling for applications which require high-end multithreaded\naccess (e.g., web-servers or  application servers  that may serve many\napplication threads in a single jvm), you can pre-create a connection,\nas shown in the following example:\n\nå¯¹äºé«å¹¶åå¤çº¿ç¨è®¿é®çåºç¨ç¨åºï¼ä¾å¦ï¼å¨åä¸ª jvm ä¸­å­å¨çä¸ºå¤ä¸ªçº¿ç¨æå¡ç web æå¡å¨æåºç¨ç¨åºæå¡å¨ï¼ï¼\næ¨åªéè¦é¢ååå»ºä¸ä¸ª connectionãä¾å­å¦ä¸ï¼\n\n// create a connection to the cluster.\nconfiguration conf = hbaseconfiguration.create();\ntry (connection connection = connectionfactory.createconnection(conf);\n     table table = connection.gettable(tablename.valueof(tablename))) {\n  // use table as needed, the table returned is lightweight\n}\n\n\nä¹æä»¥è½è¿æ ·ä½¿ç¨ï¼è¿æ¯å ä¸º connection å¹¶ä¸æ¯ä¸ä¸ªç®åç socket è¿æ¥ï¼æ¥å£ææ¡£ ä¸­å¯¹ connection çè¡¨è¿°æ¯ï¼\n\na cluster connection encapsulating lower level individual connections to actual servers and a\nconnection to zookeeper.  connections are instantiated through the connectionfactory class.\nthe lifecycle of the connection is managed by the caller,  who has to close() the connection\nto release the resources.\n\nconnection æ¯ä¸ä¸ªéç¾¤è¿æ¥ï¼å°è£äºä¸å¤å°æå¡å¨ï¼matser/region serverï¼çåºå±è¿æ¥ä»¥åä¸ zookeeper çè¿æ¥ã\nè¿æ¥éè¿ connectionfactory  ç±»å®ä¾åãè¿æ¥ççå½å¨æç±è°ç¨èç®¡çï¼è°ç¨èå¿é¡»ä½¿ç¨ close() å³é­è¿æ¥ä»¥éæ¾èµæºã\n\n\nä¹æä»¥å°è£è¿äºè¿æ¥ï¼æ¯å ä¸º hbase å®¢æ·ç«¯éè¦è¿æ¥ä¸ä¸ªä¸åçæå¡è§è²ï¼\n\n * zookeeper ï¼ä¸»è¦ç¨äºè·å meta è¡¨çä½ç½®ä¿¡æ¯ï¼master çä¿¡æ¯ï¼\n * hbase master ï¼ä¸»è¦ç¨äºæ§è¡ hbaseadmin æ¥å£çä¸äºæä½ï¼ä¾å¦å»ºè¡¨ç­ï¼\n * hbase regionserver ï¼ç¨äºè¯»ãåæ°æ®ã\n\n\n\nconnection å¯¹è±¡åå®éç socket è¿æ¥ä¹é´çå¯¹åºå³ç³»å¦ä¸å¾ï¼\n\n\n\nå¨ hbase å®¢æ·ç«¯ä»£ç ä¸­ï¼çæ­£å¯¹åº socket è¿æ¥çæ¯ rpcconnection å¯¹è±¡ãhbase ä½¿ç¨ poolmap è¿ç§æ°æ®ç»ææ¥å­å¨å®¢æ·ç«¯å° hbase æå¡å¨ä¹é´çè¿æ¥ãpoolmap çåé¨æä¸ä¸ª concurrenthashmap å®ä¾ï¼å¶ key æ¯ connectionid(å°è£äºæå¡å¨å°ååç¨æ· ticket)ï¼value æ¯ä¸ä¸ª rpcconnection å¯¹è±¡çèµæºæ± ãå½ hbase éè¦è¿æ¥ä¸ä¸ªæå¡å¨æ¶ï¼é¦åä¼æ ¹æ® connectionid æ¾å°å¯¹åºçè¿æ¥æ± ï¼ç¶åä»è¿æ¥æ± ä¸­ååºä¸ä¸ªè¿æ¥å¯¹è±¡ã\n\n@interfaceaudience.private\npublic class poolmap<k, v> implements map<k, v> {\n  private pooltype pooltype;\n\n  private int poolmaxsize;\n\n  private map<k, pool<v>> pools = new concurrenthashmap<>();\n\n  public poolmap(pooltype pooltype) {\n    this.pooltype = pooltype;\n  }\n  .....\n\n\nhbase ä¸­æä¾äºä¸ç§èµæºæ± çå®ç°ï¼åå«æ¯ reusableï¼roundrobin å threadlocalãå·ä½å®ç°å¯ä»¥é hbase.client.ipc.pool.type éç½®é¡¹æå®ï¼é»è®¤ä¸º reusableãè¿æ¥æ± çå¤§å°ä¹å¯ä»¥éè¿ hbase.client.ipc.pool.size éç½®é¡¹æå®ï¼é»è®¤ä¸º 1ï¼å³æ¯ä¸ª server 1 ä¸ªè¿æ¥ãä¹å¯ä»¥éè¿ä¿®æ¹éç½®å®ç°ï¼\n\nconfig.set("hbase.client.ipc.pool.type",...);\nconfig.set("hbase.client.ipc.pool.size",...);\nconnection = connectionfactory.createconnection(config);\n\n\nç±æ­¤å¯ä»¥çåº hbase ä¸­ connection ç±»å·²ç»å®ç°äºå¯¹è¿æ¥çç®¡çåè½ï¼æä»¥æä»¬ä¸å¿å¨ connection ä¸å¨åé¢å¤çç®¡çã\n\nå¦å¤ï¼connection æ¯çº¿ç¨å®å¨çï¼ä½ table å admin å´ä¸æ¯çº¿ç¨å®å¨çï¼å æ­¤æ­£ç¡®çåæ³æ¯ä¸ä¸ªè¿ç¨å±ç¨ä¸ä¸ª connection å¯¹è±¡ï¼èå¨ä¸åççº¿ç¨ä¸­ä½¿ç¨åç¬ç table å admin å¯¹è±¡ãtable å admin çè·åæä½ gettable() å getadmin() é½æ¯è½»éçº§ï¼æä»¥ä¸å¿æå¿æ§è½çæ¶èï¼åæ¶å»ºè®®å¨ä½¿ç¨å®æåæ¾ç¤ºçè°ç¨ close() æ¹æ³æ¥å³é­å®ä»¬ã\n\n\n# æ¦è¿°\n\nhbase çä¸»è¦å®¢æ·ç«¯æä½æ¯ç± org.apache.hadoop.hbase.client.htable æä¾çãåå»º htable å®ä¾éå¸¸èæ¶ï¼æä»¥ï¼å»ºè®®æ¯ä¸ªçº¿ç¨åªåå»ºä¸æ¬¡ htable å®ä¾ã\n\nhbase ææä¿®æ¹æ°æ®çæä½é½ä¿è¯äºè¡çº§å«çåå­æ§ãè¦ä¹è¯»å°ææ°çä¿®æ¹ï¼è¦ä¹ç­å¾ç³»ç»åè®¸åå¥æ¹è¡ä¿®æ¹\n\nç¨æ·è¦å°½éä½¿ç¨æ¹å¤ç(batch)æ´æ°æ¥åå°åç¬æä½åä¸è¡æ°æ®çæ¬¡æ°\n\nåæä½ä¸­è®¾è®¡çåçæ°ç®å¹¶ä¸ä¼å½±åè¯¥è¡æ°æ®çåå­æ§ï¼è¡åå­æ§ä¼åæ¶ä¿æ¤å°ææå\n\nåå»º htable å®ä¾ï¼æçæ¯å¨ java ä¸­æ°å»ºè¯¥ç±»ï¼ï¼æ¯ä¸ªå®ä¾é½è¦æ«æ.meta. è¡¨ï¼ä»¥æ£æ¥è¯¥è¡¨æ¯å¦å­å¨ï¼æ¨èç¨æ·åªåå»ºä¸æ¬¡ htable å®ä¾ï¼èä¸æ¯æ¯ä¸ªçº¿ç¨åå»ºä¸ä¸ª\n\nå¦æç¨æ·éè¦å¤ä¸ª htable å®ä¾ï¼å»ºè®®ä½¿ç¨ htablepool ç±»ï¼ç±»ä¼¼è¿æ¥æ± ï¼\n\n\n# crud æä½\n\n\n# put\n\ntable æ¥å£æä¾äºä¸¤ä¸ª put æ¹æ³\n\n// åå¥åè¡ put\nvoid put(put put) throws ioexception;\n// æ¹éåå¥ put\nvoid put(list<put> puts) throws ioexception;\n\n\nput ç±»æä¾äºå¤ç§æé å¨æ¹æ³ç¨æ¥åå§åå®ä¾ã\n\nput ç±»è¿æä¾äºä¸ç³»åæç¨çæ¹æ³ï¼\n\nå¤ä¸ª add æ¹æ³ï¼ç¨äºæ·»å æå®çåæ°æ®ã\n\nhas æ¹æ³ï¼ç¨äºæ£æ¥æ¯å¦å­å¨ç¹å®çååæ ¼ï¼èä¸éè¦éåæ´ä¸ªéå\n\ngetfamilymap æ¹æ³ï¼å¯ä»¥éå put å®ä¾ä¸­æ¯ä¸ä¸ªå¯ç¨ç keyvalue å®ä¾\n\ngetrow æ¹æ³ï¼ç¨äºè·å rowkey put.heapsize() å¯ä»¥è®¡ç®å½å put å®ä¾æéçå å¤§å°ï¼æ¢åå«å¶ä¸­çæ°æ®ï¼ä¹åå«åé¨æ°æ®ç»ææéçç©ºé´\n\n# keyvalue ç±»\n\nç¹å®ååæ ¼çæ°æ®ä»¥ååæ ï¼åæ åæ¬è¡é®ãåæåãåéå®ç¬¦ä»¥åæ¶é´æ³ keyvalue(byte[] row, int roffset, int rlength, byte[] family, int foffoset, int flength, byte[] qualifier, int qoffset, int qlength, long timestamp, type type, byte[] value, int voffset, int vlength) æ¯ä¸ä¸ªå­èæ°ç»é½æä¸ä¸ª offset åæ°åä¸ä¸ª length åæ°ï¼åè®¸ç¨æ·æäº¤ä¸ä¸ªå·²ç»å­å¨çå­èæ°ç»è¿è¡å­èçº§å«æä½ã è¡ç®åæ¥è¯´æçæ¯è¡é®ï¼å³ put æé å¨éç row åæ°ã\n\n# å®¢æ·ç«¯çåç¼å²åº\n\næ¯ä¸ä¸ª put æä½å®éä¸é½æ¯ä¸ä¸ª rpc æä½ï¼å®å°å®¢æ·ç«¯æ°æ®ä¼ éå°æå¡å¨ç¶åè¿åã\n\nhbase ç api éå¤äºä¸ä¸ªå®¢æ·ç«¯çåç¼å²åºï¼ç¼å²åºè´è´£æ¶é put æä½ï¼ç¶åè°ç¨ rpc æä½ä¸æ¬¡æ§å° put éå¾æå¡å¨ã\n\nvoid setautoflush(boolean autoflush)\nboolean isautoflush()\n\n\né»è®¤æåµä¸ï¼å®¢æ·ç«¯ç¼å²åºæ¯ç¦ç¨çãå¯ä»¥éè¿ table.setautoflush(false) æ¥æ¿æ´»ç¼å²åºã\n\n# put åè¡¨\n\næ¹éæäº¤ put åè¡¨ï¼\n\nvoid put(list<put> puts) throws ioexception\n\n\næ³¨æï¼æ¹éæäº¤å¯è½ä¼æé¨åä¿®æ¹å¤±è´¥ã\n\n# åå­æ§æä½ compare-and-set\n\ncheckandput æ¹æ³æä¾äº cas æºå¶æ¥ä¿è¯ put æä½çåå­æ§ã\n\n\n# get\n\nresult get(get get) throws ioexception\n\n\nget(byte[] row)\nget(byte[] row, rowlock rowlock)\nget addcolumn(byte[] family, byte[] qualifier)\nget addfamily(byte[] family)\n\n\n# result ç±»\n\nå½ç¨æ·ä½¿ç¨ get() æ¹æ³è·åæ°æ®ï¼hbase è¿åçç»æåå«ææå¹éçååæ ¼æ°æ®ï¼è¿äºæ°æ®è¢«å°è£å¨ä¸ä¸ª result å®ä¾ä¸­è¿åç»ç¨æ·ã\n\nresult ç±»æä¾çæ¹æ³å¦ä¸ï¼\n\nbyte[] getvalue(byte[] family, byte[] qualifier)\nbyte[] value()\nbyte[] getrow()\nint size()\nboolean isempty()\nkeyvalue[] raw()\nlist<keyvalue> list()\n\n\n\n# delete\n\nvoid delete(delete delete) throws ioexception\n\n\ndelte(byte[] row)\ndelete(byte[] row, long timestamp, rowlock rowlock)\n\n\ndelete deletefamily(byte[] family)\ndelete deletefamily(byte[] family, long timestamp)\ndelete deletecolumns(byte[] family, byte[] qualifier)\ndelete deletecolumn(byte[] family, byte[] qualifier) // åªå é¤ææ°çæ¬\n\n\n\n# æ¹å¤çæä½\n\nrow æ¯ putãgetãdelete çç¶ç±»ã\n\nvoid batch(list<row> actions, object[] results) throws ioexception, interruptedexception\nobject batch(list<row> actions) throws ioexception, interruptedexception\n\n\n\n# è¡é\n\nregion æå¡å¨æä¾äºè¡éç¹æ§ï¼è¿ä¸ªç¹æ§ä¿è¯äºåªæä¸ä¸ªå®¢æ·ç«¯è½è·åä¸è¡æ°æ®ç¸åºçéï¼åæ¶å¯¹è¯¥è¡è¿è¡ä¿®æ¹ã\n\nå¦æä¸æ¾ç¤ºæå®éï¼æå¡å¨ä¼éå¼å éã\n\n\n# æ«æ\n\nscanï¼ç±»ä¼¼æ°æ®åºç³»ç»ä¸­ç cursorï¼å©ç¨äº hbase æä¾çåºå±é¡ºåºå­å¨çæ°æ®ç»æã\n\nè°ç¨ htable ç getscanner å°±å¯ä»¥è¿åæ«æå¨\n\nresultscanner getscanner(scan scan) throws ioexception\nresultscanner getscanner(byte[] family) throws ioexception\n\n\nscan ç±»æé å¨å¯ä»¥æ startrowï¼åºé´ä¸è¬ä¸º [startrow, stoprow)\n\nscan(byte[] startrow, filter filter)\nscan(byte[] startrow)\n\n\n\n# resultscanner\n\nä»¥è¡ä¸ºåä½è¿è¡è¿å\n\nresult next() throws ioexception\nresult[] next(int nbrows) throws ioexception\nvoid close()\n\n\n\n# ç¼å­ä¸æ¹éå¤ç\n\næ¯ä¸ä¸ª next()è°ç¨é½ä¼ä¸ºæ¯è¡æ°æ®çæä¸ä¸ªåç¬ç rpc è¯·æ±\n\nå¯ä»¥è®¾ç½®æ«æå¨ç¼å­\n\nvoid setscannercaching(itn scannercaching)\nint getscannercaching()\n\n\nç¼å­æ¯é¢åè¡ä¸çº§æä½ï¼æ¹éæ¯é¢ååä¸çº§æä½\n\nvoid setbatch(int batch)\nint getbatch\n\n\nrpc è¯·æ±çæ¬¡æ°=(è¡æ°*æ¯è¡åæ°)/min(æ¯è¡çåæ°ï¼æ¹éå¤§å°)/æ«æå¨ç¼å­\n\n\n# åç§ç¹æ§\n\nbytes ç±»æä¾äºä¸ç³»åå°åç java ç±»ååå­èæ°ç»äºè½¬çæ¹æ³ã\n\n\n# åèèµæ\n\n * ãhbase æå¨æåã\n * ãhbase æå¨æåãå®æ¹æºç ',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"HBase Java API é«çº§ç¹æ§ä¹åå¤çå¨",frontmatter:{title:"HBase Java API é«çº§ç¹æ§ä¹åå¤çå¨",date:"2023-03-16T09:46:37.000Z",categories:["æ°æ®åº","åå¼æ°æ®åº","HBase"],tags:["å¤§æ°æ®","HBase","API"],permalink:"/pages/5f1bc3/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/06.%E5%88%97%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93/01.HBase/12.HBaseJavaApi%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7%E4%B9%8B%E5%8D%8F%E5%A4%84%E7%90%86%E5%99%A8.html",relativePath:"12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/12.HBaseJavaApié«çº§ç¹æ§ä¹åå¤çå¨.md",key:"v-458ab807",path:"/pages/5f1bc3/",headers:[{level:2,title:"ç®è¿°",slug:"ç®è¿°",normalizedTitle:"ç®è¿°",charIndex:31},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:283}],headersStr:"ç®è¿° åèèµæ",content:"# HBase Java API é«çº§ç¹æ§ä¹åå¤çå¨\n\n\n# ç®è¿°\n\nå¨ä½¿ç¨ HBase æ¶ï¼å¦æä½ çæ°æ®éè¾¾å°äºæ°åäº¿è¡ææ°ç¾ä¸åï¼æ­¤æ¶è½å¦å¨æ¥è¯¢ä¸­è¿åå¤§éæ°æ®å°åå¶äºç½ç»çå¸¦å®½ï¼å³ä¾¿ç½ç»ç¶åµåè®¸ï¼ä½æ¯å®¢æ·ç«¯çè®¡ç®å¤çä¹æªå¿è½å¤æ»¡è¶³è¦æ±ãå¨è¿ç§æåµä¸ï¼åå¤çå¨ï¼Coprocessorsï¼åºè¿èçãå®åè®¸ä½ å°ä¸å¡è®¡ç®ä»£ç æ¾å¥å¨ RegionServer çåå¤çå¨ä¸­ï¼å°å¤çå¥½çæ°æ®åè¿åç»å®¢æ·ç«¯ï¼è¿å¯ä»¥æå¤§å°éä½éè¦ä¼ è¾çæ°æ®éï¼ä»èè·å¾æ§è½ä¸çæåãåæ¶åå¤çå¨ä¹åè®¸ç¨æ·æ©å±å®ç° HBase ç®åæä¸å·å¤çåè½ï¼å¦æéæ ¡éªãäºçº§ç´¢å¼ãå®æ´æ§çº¦æç­ã\n\n\n# åèèµæ\n\n * ãHBase æå¨æåã\n * ãHBase æå¨æåãå®æ¹æºç ",normalizedContent:"# hbase java api é«çº§ç¹æ§ä¹åå¤çå¨\n\n\n# ç®è¿°\n\nå¨ä½¿ç¨ hbase æ¶ï¼å¦æä½ çæ°æ®éè¾¾å°äºæ°åäº¿è¡ææ°ç¾ä¸åï¼æ­¤æ¶è½å¦å¨æ¥è¯¢ä¸­è¿åå¤§éæ°æ®å°åå¶äºç½ç»çå¸¦å®½ï¼å³ä¾¿ç½ç»ç¶åµåè®¸ï¼ä½æ¯å®¢æ·ç«¯çè®¡ç®å¤çä¹æªå¿è½å¤æ»¡è¶³è¦æ±ãå¨è¿ç§æåµä¸ï¼åå¤çå¨ï¼coprocessorsï¼åºè¿èçãå®åè®¸ä½ å°ä¸å¡è®¡ç®ä»£ç æ¾å¥å¨ regionserver çåå¤çå¨ä¸­ï¼å°å¤çå¥½çæ°æ®åè¿åç»å®¢æ·ç«¯ï¼è¿å¯ä»¥æå¤§å°éä½éè¦ä¼ è¾çæ°æ®éï¼ä»èè·å¾æ§è½ä¸çæåãåæ¶åå¤çå¨ä¹åè®¸ç¨æ·æ©å±å®ç° hbase ç®åæä¸å·å¤çåè½ï¼å¦æéæ ¡éªãäºçº§ç´¢å¼ãå®æ´æ§çº¦æç­ã\n\n\n# åèèµæ\n\n * ãhbase æå¨æåã\n * ãhbase æå¨æåãå®æ¹æºç ",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"HBase Java API é«çº§ç¹æ§ä¹è¿æ»¤å¨",frontmatter:{title:"HBase Java API é«çº§ç¹æ§ä¹è¿æ»¤å¨",date:"2023-03-16T09:45:10.000Z",categories:["æ°æ®åº","åå¼æ°æ®åº","HBase"],tags:["å¤§æ°æ®","HBase","API"],permalink:"/pages/a3347e/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/06.%E5%88%97%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93/01.HBase/11.HBaseJavaApi%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7%E4%B9%8B%E8%BF%87%E6%BB%A4%E5%99%A8.html",relativePath:"12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/11.HBaseJavaApié«çº§ç¹æ§ä¹è¿æ»¤å¨.md",key:"v-8b6e004c",path:"/pages/a3347e/",headers:[{level:2,title:"æ¯è¾è¿æ»¤å¨",slug:"æ¯è¾è¿æ»¤å¨",normalizedTitle:"æ¯è¾è¿æ»¤å¨",charIndex:377},{level:3,title:"æ¯è¾è¿ç®ç¬¦",slug:"æ¯è¾è¿ç®ç¬¦",normalizedTitle:"æ¯è¾è¿ç®ç¬¦",charIndex:472},{level:3,title:"æ¯è¾å¨",slug:"æ¯è¾å¨",normalizedTitle:"æ¯è¾å¨",charIndex:478},{level:3,title:"æ¯è¾è¿æ»¤å¨ç§ç±»",slug:"æ¯è¾è¿æ»¤å¨ç§ç±»",normalizedTitle:"æ¯è¾è¿æ»¤å¨ç§ç±»",charIndex:1822},{level:3,title:"DependentColumnFilter",slug:"dependentcolumnfilter",normalizedTitle:"dependentcolumnfilter",charIndex:2001},{level:2,title:"ä¸ç¨è¿æ»¤å¨",slug:"ä¸ç¨è¿æ»¤å¨",normalizedTitle:"ä¸ç¨è¿æ»¤å¨",charIndex:3320},{level:3,title:"åååå¼è¿æ»¤å¨ (SingleColumnValueFilter)",slug:"åååå¼è¿æ»¤å¨-singlecolumnvaluefilter",normalizedTitle:"åååå¼è¿æ»¤å¨ (singlecolumnvaluefilter)",charIndex:3365},{level:3,title:"åååå¼æé¤å¨ (SingleColumnValueExcludeFilter)",slug:"åååå¼æé¤å¨-singlecolumnvalueexcludefilter",normalizedTitle:"åååå¼æé¤å¨ (singlecolumnvalueexcludefilter)",charIndex:3976},{level:3,title:"è¡é®åç¼è¿æ»¤å¨ (PrefixFilter)",slug:"è¡é®åç¼è¿æ»¤å¨-prefixfilter",normalizedTitle:"è¡é®åç¼è¿æ»¤å¨ (prefixfilter)",charIndex:4094},{level:3,title:"åååç¼è¿æ»¤å¨ (ColumnPrefixFilter)",slug:"åååç¼è¿æ»¤å¨-columnprefixfilter",normalizedTitle:"åååç¼è¿æ»¤å¨ (columnprefixfilter)",charIndex:4246},{level:3,title:"åé¡µè¿æ»¤å¨ (PageFilter)",slug:"åé¡µè¿æ»¤å¨-pagefilter",normalizedTitle:"åé¡µè¿æ»¤å¨ (pagefilter)",charIndex:4428},{level:3,title:"æ¶é´æ³è¿æ»¤å¨ (TimestampsFilter)",slug:"æ¶é´æ³è¿æ»¤å¨-timestampsfilter",normalizedTitle:"æ¶é´æ³è¿æ»¤å¨ (timestampsfilter)",charIndex:6373},{level:3,title:"é¦æ¬¡è¡é®è¿æ»¤å¨ (FirstKeyOnlyFilter)",slug:"é¦æ¬¡è¡é®è¿æ»¤å¨-firstkeyonlyfilter",normalizedTitle:"é¦æ¬¡è¡é®è¿æ»¤å¨ (firstkeyonlyfilter)",charIndex:6566},{level:2,title:"åè£è¿æ»¤å¨",slug:"åè£è¿æ»¤å¨",normalizedTitle:"åè£è¿æ»¤å¨",charIndex:6801},{level:3,title:"SkipFilter è¿æ»¤å¨",slug:"skipfilter-è¿æ»¤å¨",normalizedTitle:"skipfilter è¿æ»¤å¨",charIndex:6840},{level:3,title:"WhileMatchFilter è¿æ»¤å¨",slug:"whilematchfilter-è¿æ»¤å¨",normalizedTitle:"whilematchfilter è¿æ»¤å¨",charIndex:7130},{level:2,title:"FilterList",slug:"filterlist",normalizedTitle:"filterlist",charIndex:8719},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:10039}],headersStr:"æ¯è¾è¿æ»¤å¨ æ¯è¾è¿ç®ç¬¦ æ¯è¾å¨ æ¯è¾è¿æ»¤å¨ç§ç±» DependentColumnFilter ä¸ç¨è¿æ»¤å¨ åååå¼è¿æ»¤å¨ (SingleColumnValueFilter) åååå¼æé¤å¨ (SingleColumnValueExcludeFilter) è¡é®åç¼è¿æ»¤å¨ (PrefixFilter) åååç¼è¿æ»¤å¨ (ColumnPrefixFilter) åé¡µè¿æ»¤å¨ (PageFilter) æ¶é´æ³è¿æ»¤å¨ (TimestampsFilter) é¦æ¬¡è¡é®è¿æ»¤å¨ (FirstKeyOnlyFilter) åè£è¿æ»¤å¨ SkipFilter è¿æ»¤å¨ WhileMatchFilter è¿æ»¤å¨ FilterList åèèµæ",content:'# HBase Java API é«çº§ç¹æ§ä¹è¿æ»¤å¨\n\nHBase ä¸­ä¸¤ç§ä¸»è¦çæ°æ®è¯»åæ¹æ³æ¯ get() å scan()ï¼å®ä»¬é½æ¯æç´æ¥è®¿é®æ°æ®åéè¿æå®èµ·æ­¢ row key è®¿é®æ°æ®ãæ­¤å¤ï¼å¯ä»¥æå®åæãåãæ¶é´æ³åçæ¬å·æ¥è¿è¡æ¡ä»¶æ¥è¯¢ãå®ä»¬çç¼ºç¹æ¯ä¸æ¯æç»ç²åº¦çç­éåè½ãä¸ºäºå¼¥è¡¥è¿ç§ä¸è¶³ï¼Get å Scan æ¯æéè¿è¿æ»¤å¨ï¼Filterï¼å¯¹ row keyãåæåå¼è¿è¡è¿æ»¤ã\n\nHBase æä¾äºä¸äºåç½®è¿æ»¤å¨ï¼ä¹åè®¸ç¨æ·éè¿ç»§æ¿ Filter ç±»æ¥èªå®ä¹è¿æ»¤å¨ãææçè¿æ»¤å¨é½å¨æå¡ç«¯çæï¼ç§°ä¸º è°è¯ä¸æ¨ãè¿æ ·å¯ä»¥ä¿è¯è¢«è¿æ»¤æçæ°æ®ä¸ä¼è¢«ä¼ å°å®¢æ·ç«¯ã\n\n\n\nå¾çæ¥èª HBase æå¨æå\n\nHBase è¿æ»¤å¨å±æ¬¡ç»æçæåºå±æ¯ Filter æ¥å£å FilterBase æ½è±¡ç±»ãå¤§é¨åè¿æ»¤å¨é½ç´æ¥ç»§æ¿èª FilterBaseã\n\n\n# æ¯è¾è¿æ»¤å¨\n\næææ¯è¾è¿æ»¤å¨åç»§æ¿èª CompareFilterãCompareFilter æ¯ FilterBase å¤äºä¸ä¸ª compare() æ¹æ³ï¼å®éè¦ä¼ å¥åæ°å®ä¹æ¯è¾æä½çè¿ç¨ï¼æ¯è¾è¿ç®ç¬¦åæ¯è¾å¨ã\n\nåå»ºä¸ä¸ªæ¯è¾è¿æ»¤å¨éè¦ä¸¤ä¸ªåæ°ï¼åå«æ¯æ¯è¾è¿ç®ç¬¦åæ¯è¾å¨å®ä¾ã\n\n public CompareFilter(final CompareOp compareOp,final ByteArrayComparable comparator) {\n    this.compareOp = compareOp;\n    this.comparator = comparator;\n  }\n\n\n\n# æ¯è¾è¿ç®ç¬¦\n\n * LESS (<)\n * LESS_OR_EQUAL (<=)\n * EQUAL (=)\n * NOT_EQUAL (!=)\n * GREATER_OR_EQUAL (>=)\n * GREATER (>)\n * NO_OP (æé¤ææç¬¦åæ¡ä»¶çå¼)\n\næ¯è¾è¿ç®ç¬¦åå®ä¹å¨æä¸¾ç±» CompareOperator ä¸­\n\n@InterfaceAudience.Public\npublic enum CompareOperator {\n  LESS,\n  LESS_OR_EQUAL,\n  EQUAL,\n  NOT_EQUAL,\n  GREATER_OR_EQUAL,\n  GREATER,\n  NO_OP,\n}\n\n\n> æ³¨æï¼å¨ 1.x çæ¬ç HBase ä¸­ï¼æ¯è¾è¿ç®ç¬¦å®ä¹å¨ CompareFilter.CompareOp æä¸¾ç±»ä¸­ï¼ä½å¨ 2.0 ä¹åè¿ä¸ªç±»å°±è¢«æ è¯ä¸º @deprecated ï¼å¹¶ä¼å¨ 3.0 ç§»é¤ãæä»¥ 2.0 ä¹åçæ¬ç HBase éè¦ä½¿ç¨ CompareOperator è¿ä¸ªæä¸¾ç±»ã\n\n\n# æ¯è¾å¨\n\næææ¯è¾å¨åç»§æ¿èª ByteArrayComparable æ½è±¡ç±»ï¼å¸¸ç¨çæä»¥ä¸å ç§ï¼\n\n * BinaryComparator : ä½¿ç¨ Bytes.compareTo(byte []ï¼byte []) æå­å¸åºæ¯è¾æå®çå­èæ°ç»ã\n * BinaryPrefixComparator : æå­å¸åºä¸æå®çå­èæ°ç»è¿è¡æ¯è¾ï¼ä½åªæ¯è¾å°è¿ä¸ªå­èæ°ç»çé¿åº¦ã\n * RegexStringComparator : ä½¿ç¨ç»å®çæ­£åè¡¨è¾¾å¼ä¸æå®çå­èæ°ç»è¿è¡æ¯è¾ãä»æ¯æ EQUAL å NOT_EQUAL æä½ã\n * SubStringComparator : æµè¯ç»å®çå­å­ç¬¦ä¸²æ¯å¦åºç°å¨æå®çå­èæ°ç»ä¸­ï¼æ¯è¾ä¸åºåå¤§å°åãä»æ¯æ EQUAL å NOT_EQUAL æä½ã\n * NullComparator ï¼å¤æ­ç»å®çå¼æ¯å¦ä¸ºç©ºã\n * BitComparator ï¼æä½è¿è¡æ¯è¾ã\n\nBinaryPrefixComparator å BinaryComparator çåºå«ä¸æ¯å¾å¥½çè§£ï¼è¿éä¸¾ä¾è¯´æä¸ä¸ï¼\n\nå¨è¿è¡ EQUAL çæ¯è¾æ¶ï¼å¦ææ¯è¾å¨ä¼ å¥çæ¯ abcd çå­èæ°ç»ï¼ä½æ¯å¾æ¯è¾æ°æ®æ¯ abcdefghï¼\n\n * å¦æä½¿ç¨çæ¯ BinaryPrefixComparator æ¯è¾å¨ï¼åæ¯è¾ä»¥ abcd å­èæ°ç»çé¿åº¦ä¸ºåï¼å³ efgh ä¸ä¼åä¸æ¯è¾ï¼è¿æ¶åè®¤ä¸º abcd ä¸ abcdefgh æ¯æ»¡è¶³ EQUAL æ¡ä»¶çï¼\n * å¦æä½¿ç¨çæ¯ BinaryComparator æ¯è¾å¨ï¼åè®¤ä¸ºå¶æ¯ä¸ç¸ç­çã\n\n\n# æ¯è¾è¿æ»¤å¨ç§ç±»\n\næ¯è¾è¿æ»¤å¨å±æäºä¸ªï¼Hbase 1.x çæ¬å 2.x çæ¬ç¸åï¼ï¼\n\n * RowFilter ï¼åºäºè¡é®æ¥è¿æ»¤æ°æ®ï¼\n * FamilyFilterr ï¼åºäºåææ¥è¿æ»¤æ°æ®ï¼\n * QualifierFilterr ï¼åºäºåéå®ç¬¦ï¼ååï¼æ¥è¿æ»¤æ°æ®ï¼\n * ValueFilterr ï¼åºäºååæ ¼ (cell) çå¼æ¥è¿æ»¤æ°æ®ï¼\n * DependentColumnFilter ï¼æå®ä¸ä¸ªåèåæ¥è¿æ»¤å¶ä»åçè¿æ»¤å¨ï¼è¿æ»¤çååæ¯åºäºåèåçæ¶é´æ³æ¥è¿è¡ç­é ã\n\nååç§è¿æ»¤å¨çä½¿ç¨æ¹æ³ç¸åï¼ååªè¦ä¼ éæ¯è¾è¿ç®ç¬¦åè¿ç®å¨å®ä¾å³å¯æå»ºï¼ç¶åéè¿ setFilter æ¹æ³ä¼ éç» scanï¼\n\n Filter filter  = new RowFilter(CompareOperator.LESS_OR_EQUAL,\n                                new BinaryComparator(Bytes.toBytes("xxx")));\n  scan.setFilter(filter);\n\n\nDependentColumnFilter çä½¿ç¨ç¨å¾®å¤æä¸ç¹ï¼è¿éåç¬åä¸è¯´æã\n\n\n# DependentColumnFilter\n\nå¯ä»¥æ DependentColumnFilter çè§£ä¸ºä¸ä¸ª valueFilter åä¸ä¸ªæ¶é´æ³è¿æ»¤å¨çç»åãDependentColumnFilter æä¸ä¸ªå¸¦åæé å¨ï¼è¿ééæ©ä¸ä¸ªåæ°æå¨çè¿è¡è¯´æï¼\n\nDependentColumnFilter(final byte [] family, final byte[] qualifier,\n                               final boolean dropDependentColumn, final CompareOperator op,\n                               final ByteArrayComparable valueComparator)\n\n\n * family ï¼åæ\n * qualifier ï¼åéå®ç¬¦ï¼ååï¼\n * dropDependentColumn ï¼å³å®åèåæ¯å¦è¢«åå«å¨è¿åç»æåï¼ä¸º true æ¶è¡¨ç¤ºåèåè¢«è¿åï¼ä¸º false æ¶è¡¨ç¤ºè¢«ä¸¢å¼\n * op ï¼æ¯è¾è¿ç®ç¬¦\n * valueComparator ï¼æ¯è¾å¨\n\nè¿éä¸¾ä¾è¿è¡è¯´æï¼\n\nDependentColumnFilter dependentColumnFilter = new DependentColumnFilter(\n    Bytes.toBytes("student"),\n    Bytes.toBytes("name"),\n    false,\n    CompareOperator.EQUAL,\n    new BinaryPrefixComparator(Bytes.toBytes("xiaolan")));\n\n\n * é¦åä¼å»æ¥æ¾ student:name ä¸­å¼ä»¥ xiaolan å¼å¤´çæææ°æ®è·å¾ åèæ°æ®éï¼è¿ä¸æ­¥ç­åäº valueFilter è¿æ»¤å¨ï¼\n * å¶æ¬¡åç¨åèæ°æ®éä¸­æææ°æ®çæ¶é´æ³å»æ£ç´¢å¶ä»åï¼è·å¾æ¶é´æ³ç¸åçå¶ä»åçæ°æ®ä½ä¸º ç»ææ°æ®éï¼è¿ä¸æ­¥ç­åäºæ¶é´æ³è¿æ»¤å¨ï¼\n * æåå¦æ dropDependentColumn ä¸º trueï¼åè¿å åèæ°æ®é+ç»ææ°æ®éï¼è¥ä¸º falseï¼åæå¼åèæ°æ®éï¼åªè¿å ç»ææ°æ®éã\n\n\n# ä¸ç¨è¿æ»¤å¨\n\nä¸ç¨è¿æ»¤å¨éå¸¸ç´æ¥ç»§æ¿èª FilterBaseï¼ç¨äºæ´ç¹å®çåºæ¯ã\n\n\n# åååå¼è¿æ»¤å¨ (SingleColumnValueFilter)\n\nåºäºæåï¼åèåï¼çå¼å³å®æè¡æ°æ®æ¯å¦è¢«è¿æ»¤ãå¶å®ä¾æä»¥ä¸æ¹æ³ï¼\n\n * setFilterIfMissing(boolean filterIfMissing) ï¼é»è®¤å¼ä¸º falseï¼å³å¦æè¯¥è¡æ°æ®ä¸åå«åèåï¼å¶ä¾ç¶è¢«åå«å¨æåçç»æä¸­ï¼è®¾ç½®ä¸º true æ¶ï¼åä¸åå«ï¼\n * setLatestVersionOnly(boolean latestVersionOnly) ï¼é»è®¤ä¸º trueï¼å³åªæ£ç´¢åèåçææ°çæ¬æ°æ®ï¼è®¾ç½®ä¸º falseï¼åæ£ç´¢ææçæ¬æ°æ®ã\n\nSingleColumnValueFilter singleColumnValueFilter = new SingleColumnValueFilter(\n                "student".getBytes(),\n                "name".getBytes(),\n                CompareOperator.EQUAL,\n                new SubstringComparator("xiaolan"));\nsingleColumnValueFilter.setFilterIfMissing(true);\nscan.setFilter(singleColumnValueFilter);\n\n\n\n# åååå¼æé¤å¨ (SingleColumnValueExcludeFilter)\n\nSingleColumnValueExcludeFilter ç»§æ¿èªä¸é¢ç SingleColumnValueFilterï¼è¿æ»¤è¡ä¸ºä¸å¶ç¸åã\n\n\n# è¡é®åç¼è¿æ»¤å¨ (PrefixFilter)\n\nåºäº RowKey å¼å³å®æè¡æ°æ®æ¯å¦è¢«è¿æ»¤ã\n\nPrefixFilter prefixFilter = new PrefixFilter(Bytes.toBytes("xxx"));\nscan.setFilter(prefixFilter);\n\n\n\n# åååç¼è¿æ»¤å¨ (ColumnPrefixFilter)\n\nåºäºåéå®ç¬¦ï¼ååï¼å³å®æè¡æ°æ®æ¯å¦è¢«è¿æ»¤ã\n\nColumnPrefixFilter columnPrefixFilter = new ColumnPrefixFilter(Bytes.toBytes("xxx"));\n scan.setFilter(columnPrefixFilter);\n\n\n\n# åé¡µè¿æ»¤å¨ (PageFilter)\n\nå¯ä»¥ä½¿ç¨è¿ä¸ªè¿æ»¤å¨å®ç°å¯¹ç»ææè¡è¿è¡åé¡µï¼åå»º PageFilter å®ä¾çæ¶åéè¦ä¼ å¥æ¯é¡µçè¡æ°ã\n\npublic PageFilter(final long pageSize) {\n    Preconditions.checkArgument(pageSize >= 0, "must be positive %s", pageSize);\n    this.pageSize = pageSize;\n  }\n\n\nä¸é¢çä»£ç ä½ç°äºå®¢æ·ç«¯å®ç°åé¡µæ¥è¯¢çä¸»è¦é»è¾ï¼è¿éå¯¹å¶è¿è¡ä¸ä¸è§£éè¯´æï¼\n\nå®¢æ·ç«¯è¿è¡åé¡µæ¥è¯¢ï¼éè¦ä¼ é startRow(èµ·å§ RowKey)ï¼ç¥éèµ·å§ startRow åï¼å°±å¯ä»¥è¿åå¯¹åºç pageSize è¡æ°æ®ãè¿éå¯ä¸çé®é¢å°±æ¯ï¼å¯¹äºç¬¬ä¸æ¬¡æ¥è¯¢ï¼æ¾ç¶ startRow å°±æ¯è¡¨æ ¼çç¬¬ä¸è¡æ°æ®ï¼ä½æ¯ä¹åç¬¬äºæ¬¡ãç¬¬ä¸æ¬¡æ¥è¯¢æä»¬å¹¶ä¸ç¥é startRowï¼åªè½ç¥éä¸ä¸æ¬¡æ¥è¯¢çæåä¸æ¡æ°æ®ç RowKeyï¼ç®åç§°ä¹ä¸º lastRowï¼ã\n\næä»¬ä¸è½å° lastRow ä½ä¸ºæ°ä¸æ¬¡æ¥è¯¢ç startRow ä¼ å¥ï¼å ä¸º scan çæ¥è¯¢åºé´æ¯[startRowï¼endRow) ï¼å³åå¼åé­åºé´ï¼è¿æ · startRow å¨æ°çæ¥è¯¢ä¹ä¼è¢«è¿åï¼è¿æ¡æ°æ®å°±éå¤äºã\n\nåæ¶å¨ä¸ä½¿ç¨ç¬¬ä¸æ¹æ°æ®åºå­å¨ RowKey çæåµä¸ï¼æä»¬æ¯æ æ³éè¿ç¥é lastRow çä¸ä¸ä¸ª RowKey çï¼å ä¸º RowKey çè®¾è®¡å¯è½æ¯è¿ç»­çä¹æå¯è½æ¯ä¸è¿ç»­çã\n\nç±äº Hbase ç RowKey æ¯æç§å­å¸åºè¿è¡æåºçãè¿ç§æåµä¸ï¼å°±å¯ä»¥å¨ lastRow åé¢å ä¸ 0 ï¼ä½ä¸º startRow ä¼ å¥ï¼å ä¸ºæç§å­å¸åºçè§åï¼æä¸ªå¼å ä¸ 0 åçæ°å¼ï¼å¨å­å¸åºä¸ä¸å®æ¯è¿ä¸ªå¼çä¸ä¸ä¸ªå¼ï¼å¯¹äº HBase æ¥è¯´ä¸ä¸ä¸ª RowKey å¨å­å¸åºä¸ä¸å®ä¹æ¯ç­äºæèå¤§äºè¿ä¸ªæ°å¼çã\n\næä»¥æåä¼ å¥ lastRow+0ï¼å¦æç­äºè¿ä¸ªå¼ç RowKey å­å¨å°±ä»è¿ä¸ªå¼å¼å§ scan,å¦åä»å­å¸åºçä¸ä¸ä¸ª RowKey å¼å§ scanã\n\n> 25 ä¸ªå­æ¯ä»¥åæ°å­å­ç¬¦ï¼å­å¸æåºå¦ä¸:\n> \n> \'0\' < \'1\' < \'2\' < ... < \'9\' < \'a\' < \'b\' < ... < \'z\'\n\nåé¡µæ¥è¯¢ä¸»è¦å®ç°é»è¾ï¼\n\nbyte[] POSTFIX = new byte[] { 0x00 };\nFilter filter = new PageFilter(15);\n\nint totalRows = 0;\nbyte[] lastRow = null;\nwhile (true) {\n    Scan scan = new Scan();\n    scan.setFilter(filter);\n    if (lastRow != null) {\n        // å¦æä¸æ¯é¦è¡ å lastRow + 0\n        byte[] startRow = Bytes.add(lastRow, POSTFIX);\n        System.out.println("start row: " +\n                           Bytes.toStringBinary(startRow));\n        scan.withStartRow(startRow);\n    }\n    ResultScanner scanner = table.getScanner(scan);\n    int localRows = 0;\n    Result result;\n    while ((result = scanner.next()) != null) {\n        System.out.println(localRows++ + ": " + result);\n        totalRows++;\n        lastRow = result.getRow();\n    }\n    scanner.close();\n    //æåä¸é¡µï¼æ¥è¯¢ç»æ\n    if (localRows == 0) break;\n}\nSystem.out.println("total rows: " + totalRows);\n\n\n> éè¦æ³¨æçæ¯å¨å¤å° Regin Services ä¸æ§è¡åé¡µè¿æ»¤çæ¶åï¼ç±äºå¹¶è¡æ§è¡çè¿æ»¤å¨ä¸è½å±äº«å®ä»¬çç¶æåè¾¹çï¼æä»¥æå¯è½æ¯ä¸ªè¿æ»¤å¨é½ä¼å¨å®ææ«æåè·åäº PageCount è¡çç»æï¼è¿ç§æåµä¸ä¼è¿åæ¯åé¡µæ¡æ°æ´å¤çæ°æ®ï¼åé¡µè¿æ»¤å¨å°±æå¤±æçå¯è½ã\n\n\n# æ¶é´æ³è¿æ»¤å¨ (TimestampsFilter)\n\nList<Long> list = new ArrayList<>();\nlist.add(1554975573000L);\nTimestampsFilter timestampsFilter = new TimestampsFilter(list);\nscan.setFilter(timestampsFilter);\n\n\n\n# é¦æ¬¡è¡é®è¿æ»¤å¨ (FirstKeyOnlyFilter)\n\nFirstKeyOnlyFilter åªæ«ææ¯è¡çç¬¬ä¸åï¼æ«æå®ç¬¬ä¸ååå°±ç»æå¯¹å½åè¡çæ«æï¼å¹¶è·³è½¬å°ä¸ä¸è¡ãç¸æ¯äºå¨è¡¨æ«æï¼å¶æ§è½æ´å¥½ï¼éå¸¸ç¨äºè¡æ°ç»è®¡çåºæ¯ï¼å ä¸ºå¦ææä¸è¡å­å¨ï¼åè¡ä¸­å¿ç¶è³å°æä¸åã\n\nFirstKeyOnlyFilter firstKeyOnlyFilter = new FirstKeyOnlyFilter();\nscan.set(firstKeyOnlyFilter);\n\n\n\n# åè£è¿æ»¤å¨\n\nåè£è¿æ»¤å¨å°±æ¯éè¿åè£å¶ä»è¿æ»¤å¨ä»¥å®ç°æäºæå±çåè½ã\n\n\n# SkipFilter è¿æ»¤å¨\n\nSkipFilter åè£ä¸ä¸ªè¿æ»¤å¨ï¼å½è¢«åè£çè¿æ»¤å¨éå°ä¸ä¸ªéè¦è¿æ»¤ç KeyValue å®ä¾æ¶ï¼åæå±è¿æ»¤æ´è¡æ°æ®ãä¸é¢æ¯ä¸ä¸ªä½¿ç¨ç¤ºä¾ï¼\n\n// å®ä¹ ValueFilter è¿æ»¤å¨\nFilter filter1 = new ValueFilter(CompareOperator.NOT_EQUAL,\n      new BinaryComparator(Bytes.toBytes("xxx")));\n// ä½¿ç¨ SkipFilter è¿è¡åè£\nFilter filter2 = new SkipFilter(filter1);\n\n\n\n# WhileMatchFilter è¿æ»¤å¨\n\nWhileMatchFilter åè£ä¸ä¸ªè¿æ»¤å¨ï¼å½è¢«åè£çè¿æ»¤å¨éå°ä¸ä¸ªéè¦è¿æ»¤ç KeyValue å®ä¾æ¶ï¼WhileMatchFilter åç»ææ¬æ¬¡æ«æï¼è¿åå·²ç»æ«æå°çç»æãä¸é¢æ¯å¶ä½¿ç¨ç¤ºä¾ï¼\n\nFilter filter1 = new RowFilter(CompareOperator.NOT_EQUAL,\n                               new BinaryComparator(Bytes.toBytes("rowKey4")));\n\nScan scan = new Scan();\nscan.setFilter(filter1);\nResultScanner scanner1 = table.getScanner(scan);\nfor (Result result : scanner1) {\n    for (Cell cell : result.listCells()) {\n        System.out.println(cell);\n    }\n}\nscanner1.close();\n\nSystem.out.println("--------------------");\n\n// ä½¿ç¨ WhileMatchFilter è¿è¡åè£\nFilter filter2 = new WhileMatchFilter(filter1);\n\nscan.setFilter(filter2);\nResultScanner scanner2 = table.getScanner(scan);\nfor (Result result : scanner1) {\n    for (Cell cell : result.listCells()) {\n        System.out.println(cell);\n    }\n}\nscanner2.close();\nrowKey0/student:name/1555035006994/Put/vlen=8/seqid=0\nrowKey1/student:name/1555035007019/Put/vlen=8/seqid=0\nrowKey2/student:name/1555035007025/Put/vlen=8/seqid=0\nrowKey3/student:name/1555035007037/Put/vlen=8/seqid=0\nrowKey5/student:name/1555035007051/Put/vlen=8/seqid=0\nrowKey6/student:name/1555035007057/Put/vlen=8/seqid=0\nrowKey7/student:name/1555035007062/Put/vlen=8/seqid=0\nrowKey8/student:name/1555035007068/Put/vlen=8/seqid=0\nrowKey9/student:name/1555035007073/Put/vlen=8/seqid=0\n--------------------\nrowKey0/student:name/1555035006994/Put/vlen=8/seqid=0\nrowKey1/student:name/1555035007019/Put/vlen=8/seqid=0\nrowKey2/student:name/1555035007025/Put/vlen=8/seqid=0\nrowKey3/student:name/1555035007037/Put/vlen=8/seqid=0\n\n\nå¯ä»¥çå°è¢«åè£åï¼åªè¿åäº rowKey4 ä¹åçæ°æ®ã\n\n\n# FilterList\n\nä»¥ä¸é½æ¯è®²è§£åä¸ªè¿æ»¤å¨çä½ç¨ï¼å½éè¦å¤ä¸ªè¿æ»¤å¨å±åä½ç¨äºä¸æ¬¡æ¥è¯¢çæ¶åï¼å°±éè¦ä½¿ç¨ FilterListãFilterList æ¯æéè¿æé å¨æè addFilter æ¹æ³ä¼ å¥å¤ä¸ªè¿æ»¤å¨ã\n\n// æé å¨ä¼ å¥\npublic FilterList(final Operator operator, final List<Filter> filters)\npublic FilterList(final List<Filter> filters)\npublic FilterList(final Filter... filters)\n\n// æ¹æ³ä¼ å¥\n public void addFilter(List<Filter> filters)\n public void addFilter(Filter filter)\n\n\nå¤ä¸ªè¿æ»¤å¨ç»åçç»æç± operator åæ°å®ä¹ ï¼å¶å¯éåæ°å®ä¹å¨ Operator æä¸¾ç±»ä¸­ãåªæ MUST_PASS_ALL å MUST_PASS_ONE ä¸¤ä¸ªå¯éçå¼ï¼\n\n * MUST_PASS_ALL ï¼ç¸å½äº ANDï¼å¿é¡»ææçè¿æ»¤å¨é½éè¿æè®¤ä¸ºéè¿ï¼\n * MUST_PASS_ONE ï¼ç¸å½äº ORï¼åªæè¦ä¸ä¸ªè¿æ»¤å¨éè¿åè®¤ä¸ºéè¿ã\n\n@InterfaceAudience.Public\n  public enum Operator {\n    /** !AND */\n    MUST_PASS_ALL,\n    /** !OR */\n    MUST_PASS_ONE\n  }\n\n\nä½¿ç¨ç¤ºä¾å¦ä¸ï¼\n\nList<Filter> filters = new ArrayList<Filter>();\n\nFilter filter1 = new RowFilter(CompareOperator.GREATER_OR_EQUAL,\n                               new BinaryComparator(Bytes.toBytes("XXX")));\nfilters.add(filter1);\n\nFilter filter2 = new RowFilter(CompareOperator.LESS_OR_EQUAL,\n                               new BinaryComparator(Bytes.toBytes("YYY")));\nfilters.add(filter2);\n\nFilter filter3 = new QualifierFilter(CompareOperator.EQUAL,\n                                     new RegexStringComparator("ZZZ"));\nfilters.add(filter3);\n\nFilterList filterList = new FilterList(filters);\n\nScan scan = new Scan();\nscan.setFilter(filterList);\n\n\n\n# åèèµæ\n\n * ãHBase æå¨æåã\n * ãHBase æå¨æåãå®æ¹æºç ',normalizedContent:'# hbase java api é«çº§ç¹æ§ä¹è¿æ»¤å¨\n\nhbase ä¸­ä¸¤ç§ä¸»è¦çæ°æ®è¯»åæ¹æ³æ¯ get() å scan()ï¼å®ä»¬é½æ¯æç´æ¥è®¿é®æ°æ®åéè¿æå®èµ·æ­¢ row key è®¿é®æ°æ®ãæ­¤å¤ï¼å¯ä»¥æå®åæãåãæ¶é´æ³åçæ¬å·æ¥è¿è¡æ¡ä»¶æ¥è¯¢ãå®ä»¬çç¼ºç¹æ¯ä¸æ¯æç»ç²åº¦çç­éåè½ãä¸ºäºå¼¥è¡¥è¿ç§ä¸è¶³ï¼get å scan æ¯æéè¿è¿æ»¤å¨ï¼filterï¼å¯¹ row keyãåæåå¼è¿è¡è¿æ»¤ã\n\nhbase æä¾äºä¸äºåç½®è¿æ»¤å¨ï¼ä¹åè®¸ç¨æ·éè¿ç»§æ¿ filter ç±»æ¥èªå®ä¹è¿æ»¤å¨ãææçè¿æ»¤å¨é½å¨æå¡ç«¯çæï¼ç§°ä¸º è°è¯ä¸æ¨ãè¿æ ·å¯ä»¥ä¿è¯è¢«è¿æ»¤æçæ°æ®ä¸ä¼è¢«ä¼ å°å®¢æ·ç«¯ã\n\n\n\nå¾çæ¥èª hbase æå¨æå\n\nhbase è¿æ»¤å¨å±æ¬¡ç»æçæåºå±æ¯ filter æ¥å£å filterbase æ½è±¡ç±»ãå¤§é¨åè¿æ»¤å¨é½ç´æ¥ç»§æ¿èª filterbaseã\n\n\n# æ¯è¾è¿æ»¤å¨\n\næææ¯è¾è¿æ»¤å¨åç»§æ¿èª comparefilterãcomparefilter æ¯ filterbase å¤äºä¸ä¸ª compare() æ¹æ³ï¼å®éè¦ä¼ å¥åæ°å®ä¹æ¯è¾æä½çè¿ç¨ï¼æ¯è¾è¿ç®ç¬¦åæ¯è¾å¨ã\n\nåå»ºä¸ä¸ªæ¯è¾è¿æ»¤å¨éè¦ä¸¤ä¸ªåæ°ï¼åå«æ¯æ¯è¾è¿ç®ç¬¦åæ¯è¾å¨å®ä¾ã\n\n public comparefilter(final compareop compareop,final bytearraycomparable comparator) {\n    this.compareop = compareop;\n    this.comparator = comparator;\n  }\n\n\n\n# æ¯è¾è¿ç®ç¬¦\n\n * less (<)\n * less_or_equal (<=)\n * equal (=)\n * not_equal (!=)\n * greater_or_equal (>=)\n * greater (>)\n * no_op (æé¤ææç¬¦åæ¡ä»¶çå¼)\n\næ¯è¾è¿ç®ç¬¦åå®ä¹å¨æä¸¾ç±» compareoperator ä¸­\n\n@interfaceaudience.public\npublic enum compareoperator {\n  less,\n  less_or_equal,\n  equal,\n  not_equal,\n  greater_or_equal,\n  greater,\n  no_op,\n}\n\n\n> æ³¨æï¼å¨ 1.x çæ¬ç hbase ä¸­ï¼æ¯è¾è¿ç®ç¬¦å®ä¹å¨ comparefilter.compareop æä¸¾ç±»ä¸­ï¼ä½å¨ 2.0 ä¹åè¿ä¸ªç±»å°±è¢«æ è¯ä¸º @deprecated ï¼å¹¶ä¼å¨ 3.0 ç§»é¤ãæä»¥ 2.0 ä¹åçæ¬ç hbase éè¦ä½¿ç¨ compareoperator è¿ä¸ªæä¸¾ç±»ã\n\n\n# æ¯è¾å¨\n\næææ¯è¾å¨åç»§æ¿èª bytearraycomparable æ½è±¡ç±»ï¼å¸¸ç¨çæä»¥ä¸å ç§ï¼\n\n * binarycomparator : ä½¿ç¨ bytes.compareto(byte []ï¼byte []) æå­å¸åºæ¯è¾æå®çå­èæ°ç»ã\n * binaryprefixcomparator : æå­å¸åºä¸æå®çå­èæ°ç»è¿è¡æ¯è¾ï¼ä½åªæ¯è¾å°è¿ä¸ªå­èæ°ç»çé¿åº¦ã\n * regexstringcomparator : ä½¿ç¨ç»å®çæ­£åè¡¨è¾¾å¼ä¸æå®çå­èæ°ç»è¿è¡æ¯è¾ãä»æ¯æ equal å not_equal æä½ã\n * substringcomparator : æµè¯ç»å®çå­å­ç¬¦ä¸²æ¯å¦åºç°å¨æå®çå­èæ°ç»ä¸­ï¼æ¯è¾ä¸åºåå¤§å°åãä»æ¯æ equal å not_equal æä½ã\n * nullcomparator ï¼å¤æ­ç»å®çå¼æ¯å¦ä¸ºç©ºã\n * bitcomparator ï¼æä½è¿è¡æ¯è¾ã\n\nbinaryprefixcomparator å binarycomparator çåºå«ä¸æ¯å¾å¥½çè§£ï¼è¿éä¸¾ä¾è¯´æä¸ä¸ï¼\n\nå¨è¿è¡ equal çæ¯è¾æ¶ï¼å¦ææ¯è¾å¨ä¼ å¥çæ¯ abcd çå­èæ°ç»ï¼ä½æ¯å¾æ¯è¾æ°æ®æ¯ abcdefghï¼\n\n * å¦æä½¿ç¨çæ¯ binaryprefixcomparator æ¯è¾å¨ï¼åæ¯è¾ä»¥ abcd å­èæ°ç»çé¿åº¦ä¸ºåï¼å³ efgh ä¸ä¼åä¸æ¯è¾ï¼è¿æ¶åè®¤ä¸º abcd ä¸ abcdefgh æ¯æ»¡è¶³ equal æ¡ä»¶çï¼\n * å¦æä½¿ç¨çæ¯ binarycomparator æ¯è¾å¨ï¼åè®¤ä¸ºå¶æ¯ä¸ç¸ç­çã\n\n\n# æ¯è¾è¿æ»¤å¨ç§ç±»\n\næ¯è¾è¿æ»¤å¨å±æäºä¸ªï¼hbase 1.x çæ¬å 2.x çæ¬ç¸åï¼ï¼\n\n * rowfilter ï¼åºäºè¡é®æ¥è¿æ»¤æ°æ®ï¼\n * familyfilterr ï¼åºäºåææ¥è¿æ»¤æ°æ®ï¼\n * qualifierfilterr ï¼åºäºåéå®ç¬¦ï¼ååï¼æ¥è¿æ»¤æ°æ®ï¼\n * valuefilterr ï¼åºäºååæ ¼ (cell) çå¼æ¥è¿æ»¤æ°æ®ï¼\n * dependentcolumnfilter ï¼æå®ä¸ä¸ªåèåæ¥è¿æ»¤å¶ä»åçè¿æ»¤å¨ï¼è¿æ»¤çååæ¯åºäºåèåçæ¶é´æ³æ¥è¿è¡ç­é ã\n\nååç§è¿æ»¤å¨çä½¿ç¨æ¹æ³ç¸åï¼ååªè¦ä¼ éæ¯è¾è¿ç®ç¬¦åè¿ç®å¨å®ä¾å³å¯æå»ºï¼ç¶åéè¿ setfilter æ¹æ³ä¼ éç» scanï¼\n\n filter filter  = new rowfilter(compareoperator.less_or_equal,\n                                new binarycomparator(bytes.tobytes("xxx")));\n  scan.setfilter(filter);\n\n\ndependentcolumnfilter çä½¿ç¨ç¨å¾®å¤æä¸ç¹ï¼è¿éåç¬åä¸è¯´æã\n\n\n# dependentcolumnfilter\n\nå¯ä»¥æ dependentcolumnfilter çè§£ä¸ºä¸ä¸ª valuefilter åä¸ä¸ªæ¶é´æ³è¿æ»¤å¨çç»åãdependentcolumnfilter æä¸ä¸ªå¸¦åæé å¨ï¼è¿ééæ©ä¸ä¸ªåæ°æå¨çè¿è¡è¯´æï¼\n\ndependentcolumnfilter(final byte [] family, final byte[] qualifier,\n                               final boolean dropdependentcolumn, final compareoperator op,\n                               final bytearraycomparable valuecomparator)\n\n\n * family ï¼åæ\n * qualifier ï¼åéå®ç¬¦ï¼ååï¼\n * dropdependentcolumn ï¼å³å®åèåæ¯å¦è¢«åå«å¨è¿åç»æåï¼ä¸º true æ¶è¡¨ç¤ºåèåè¢«è¿åï¼ä¸º false æ¶è¡¨ç¤ºè¢«ä¸¢å¼\n * op ï¼æ¯è¾è¿ç®ç¬¦\n * valuecomparator ï¼æ¯è¾å¨\n\nè¿éä¸¾ä¾è¿è¡è¯´æï¼\n\ndependentcolumnfilter dependentcolumnfilter = new dependentcolumnfilter(\n    bytes.tobytes("student"),\n    bytes.tobytes("name"),\n    false,\n    compareoperator.equal,\n    new binaryprefixcomparator(bytes.tobytes("xiaolan")));\n\n\n * é¦åä¼å»æ¥æ¾ student:name ä¸­å¼ä»¥ xiaolan å¼å¤´çæææ°æ®è·å¾ åèæ°æ®éï¼è¿ä¸æ­¥ç­åäº valuefilter è¿æ»¤å¨ï¼\n * å¶æ¬¡åç¨åèæ°æ®éä¸­æææ°æ®çæ¶é´æ³å»æ£ç´¢å¶ä»åï¼è·å¾æ¶é´æ³ç¸åçå¶ä»åçæ°æ®ä½ä¸º ç»ææ°æ®éï¼è¿ä¸æ­¥ç­åäºæ¶é´æ³è¿æ»¤å¨ï¼\n * æåå¦æ dropdependentcolumn ä¸º trueï¼åè¿å åèæ°æ®é+ç»ææ°æ®éï¼è¥ä¸º falseï¼åæå¼åèæ°æ®éï¼åªè¿å ç»ææ°æ®éã\n\n\n# ä¸ç¨è¿æ»¤å¨\n\nä¸ç¨è¿æ»¤å¨éå¸¸ç´æ¥ç»§æ¿èª filterbaseï¼ç¨äºæ´ç¹å®çåºæ¯ã\n\n\n# åååå¼è¿æ»¤å¨ (singlecolumnvaluefilter)\n\nåºäºæåï¼åèåï¼çå¼å³å®æè¡æ°æ®æ¯å¦è¢«è¿æ»¤ãå¶å®ä¾æä»¥ä¸æ¹æ³ï¼\n\n * setfilterifmissing(boolean filterifmissing) ï¼é»è®¤å¼ä¸º falseï¼å³å¦æè¯¥è¡æ°æ®ä¸åå«åèåï¼å¶ä¾ç¶è¢«åå«å¨æåçç»æä¸­ï¼è®¾ç½®ä¸º true æ¶ï¼åä¸åå«ï¼\n * setlatestversiononly(boolean latestversiononly) ï¼é»è®¤ä¸º trueï¼å³åªæ£ç´¢åèåçææ°çæ¬æ°æ®ï¼è®¾ç½®ä¸º falseï¼åæ£ç´¢ææçæ¬æ°æ®ã\n\nsinglecolumnvaluefilter singlecolumnvaluefilter = new singlecolumnvaluefilter(\n                "student".getbytes(),\n                "name".getbytes(),\n                compareoperator.equal,\n                new substringcomparator("xiaolan"));\nsinglecolumnvaluefilter.setfilterifmissing(true);\nscan.setfilter(singlecolumnvaluefilter);\n\n\n\n# åååå¼æé¤å¨ (singlecolumnvalueexcludefilter)\n\nsinglecolumnvalueexcludefilter ç»§æ¿èªä¸é¢ç singlecolumnvaluefilterï¼è¿æ»¤è¡ä¸ºä¸å¶ç¸åã\n\n\n# è¡é®åç¼è¿æ»¤å¨ (prefixfilter)\n\nåºäº rowkey å¼å³å®æè¡æ°æ®æ¯å¦è¢«è¿æ»¤ã\n\nprefixfilter prefixfilter = new prefixfilter(bytes.tobytes("xxx"));\nscan.setfilter(prefixfilter);\n\n\n\n# åååç¼è¿æ»¤å¨ (columnprefixfilter)\n\nåºäºåéå®ç¬¦ï¼ååï¼å³å®æè¡æ°æ®æ¯å¦è¢«è¿æ»¤ã\n\ncolumnprefixfilter columnprefixfilter = new columnprefixfilter(bytes.tobytes("xxx"));\n scan.setfilter(columnprefixfilter);\n\n\n\n# åé¡µè¿æ»¤å¨ (pagefilter)\n\nå¯ä»¥ä½¿ç¨è¿ä¸ªè¿æ»¤å¨å®ç°å¯¹ç»ææè¡è¿è¡åé¡µï¼åå»º pagefilter å®ä¾çæ¶åéè¦ä¼ å¥æ¯é¡µçè¡æ°ã\n\npublic pagefilter(final long pagesize) {\n    preconditions.checkargument(pagesize >= 0, "must be positive %s", pagesize);\n    this.pagesize = pagesize;\n  }\n\n\nä¸é¢çä»£ç ä½ç°äºå®¢æ·ç«¯å®ç°åé¡µæ¥è¯¢çä¸»è¦é»è¾ï¼è¿éå¯¹å¶è¿è¡ä¸ä¸è§£éè¯´æï¼\n\nå®¢æ·ç«¯è¿è¡åé¡µæ¥è¯¢ï¼éè¦ä¼ é startrow(èµ·å§ rowkey)ï¼ç¥éèµ·å§ startrow åï¼å°±å¯ä»¥è¿åå¯¹åºç pagesize è¡æ°æ®ãè¿éå¯ä¸çé®é¢å°±æ¯ï¼å¯¹äºç¬¬ä¸æ¬¡æ¥è¯¢ï¼æ¾ç¶ startrow å°±æ¯è¡¨æ ¼çç¬¬ä¸è¡æ°æ®ï¼ä½æ¯ä¹åç¬¬äºæ¬¡ãç¬¬ä¸æ¬¡æ¥è¯¢æä»¬å¹¶ä¸ç¥é startrowï¼åªè½ç¥éä¸ä¸æ¬¡æ¥è¯¢çæåä¸æ¡æ°æ®ç rowkeyï¼ç®åç§°ä¹ä¸º lastrowï¼ã\n\næä»¬ä¸è½å° lastrow ä½ä¸ºæ°ä¸æ¬¡æ¥è¯¢ç startrow ä¼ å¥ï¼å ä¸º scan çæ¥è¯¢åºé´æ¯[startrowï¼endrow) ï¼å³åå¼åé­åºé´ï¼è¿æ · startrow å¨æ°çæ¥è¯¢ä¹ä¼è¢«è¿åï¼è¿æ¡æ°æ®å°±éå¤äºã\n\nåæ¶å¨ä¸ä½¿ç¨ç¬¬ä¸æ¹æ°æ®åºå­å¨ rowkey çæåµä¸ï¼æä»¬æ¯æ æ³éè¿ç¥é lastrow çä¸ä¸ä¸ª rowkey çï¼å ä¸º rowkey çè®¾è®¡å¯è½æ¯è¿ç»­çä¹æå¯è½æ¯ä¸è¿ç»­çã\n\nç±äº hbase ç rowkey æ¯æç§å­å¸åºè¿è¡æåºçãè¿ç§æåµä¸ï¼å°±å¯ä»¥å¨ lastrow åé¢å ä¸ 0 ï¼ä½ä¸º startrow ä¼ å¥ï¼å ä¸ºæç§å­å¸åºçè§åï¼æä¸ªå¼å ä¸ 0 åçæ°å¼ï¼å¨å­å¸åºä¸ä¸å®æ¯è¿ä¸ªå¼çä¸ä¸ä¸ªå¼ï¼å¯¹äº hbase æ¥è¯´ä¸ä¸ä¸ª rowkey å¨å­å¸åºä¸ä¸å®ä¹æ¯ç­äºæèå¤§äºè¿ä¸ªæ°å¼çã\n\næä»¥æåä¼ å¥ lastrow+0ï¼å¦æç­äºè¿ä¸ªå¼ç rowkey å­å¨å°±ä»è¿ä¸ªå¼å¼å§ scan,å¦åä»å­å¸åºçä¸ä¸ä¸ª rowkey å¼å§ scanã\n\n> 25 ä¸ªå­æ¯ä»¥åæ°å­å­ç¬¦ï¼å­å¸æåºå¦ä¸:\n> \n> \'0\' < \'1\' < \'2\' < ... < \'9\' < \'a\' < \'b\' < ... < \'z\'\n\nåé¡µæ¥è¯¢ä¸»è¦å®ç°é»è¾ï¼\n\nbyte[] postfix = new byte[] { 0x00 };\nfilter filter = new pagefilter(15);\n\nint totalrows = 0;\nbyte[] lastrow = null;\nwhile (true) {\n    scan scan = new scan();\n    scan.setfilter(filter);\n    if (lastrow != null) {\n        // å¦æä¸æ¯é¦è¡ å lastrow + 0\n        byte[] startrow = bytes.add(lastrow, postfix);\n        system.out.println("start row: " +\n                           bytes.tostringbinary(startrow));\n        scan.withstartrow(startrow);\n    }\n    resultscanner scanner = table.getscanner(scan);\n    int localrows = 0;\n    result result;\n    while ((result = scanner.next()) != null) {\n        system.out.println(localrows++ + ": " + result);\n        totalrows++;\n        lastrow = result.getrow();\n    }\n    scanner.close();\n    //æåä¸é¡µï¼æ¥è¯¢ç»æ\n    if (localrows == 0) break;\n}\nsystem.out.println("total rows: " + totalrows);\n\n\n> éè¦æ³¨æçæ¯å¨å¤å° regin services ä¸æ§è¡åé¡µè¿æ»¤çæ¶åï¼ç±äºå¹¶è¡æ§è¡çè¿æ»¤å¨ä¸è½å±äº«å®ä»¬çç¶æåè¾¹çï¼æä»¥æå¯è½æ¯ä¸ªè¿æ»¤å¨é½ä¼å¨å®ææ«æåè·åäº pagecount è¡çç»æï¼è¿ç§æåµä¸ä¼è¿åæ¯åé¡µæ¡æ°æ´å¤çæ°æ®ï¼åé¡µè¿æ»¤å¨å°±æå¤±æçå¯è½ã\n\n\n# æ¶é´æ³è¿æ»¤å¨ (timestampsfilter)\n\nlist<long> list = new arraylist<>();\nlist.add(1554975573000l);\ntimestampsfilter timestampsfilter = new timestampsfilter(list);\nscan.setfilter(timestampsfilter);\n\n\n\n# é¦æ¬¡è¡é®è¿æ»¤å¨ (firstkeyonlyfilter)\n\nfirstkeyonlyfilter åªæ«ææ¯è¡çç¬¬ä¸åï¼æ«æå®ç¬¬ä¸ååå°±ç»æå¯¹å½åè¡çæ«æï¼å¹¶è·³è½¬å°ä¸ä¸è¡ãç¸æ¯äºå¨è¡¨æ«æï¼å¶æ§è½æ´å¥½ï¼éå¸¸ç¨äºè¡æ°ç»è®¡çåºæ¯ï¼å ä¸ºå¦ææä¸è¡å­å¨ï¼åè¡ä¸­å¿ç¶è³å°æä¸åã\n\nfirstkeyonlyfilter firstkeyonlyfilter = new firstkeyonlyfilter();\nscan.set(firstkeyonlyfilter);\n\n\n\n# åè£è¿æ»¤å¨\n\nåè£è¿æ»¤å¨å°±æ¯éè¿åè£å¶ä»è¿æ»¤å¨ä»¥å®ç°æäºæå±çåè½ã\n\n\n# skipfilter è¿æ»¤å¨\n\nskipfilter åè£ä¸ä¸ªè¿æ»¤å¨ï¼å½è¢«åè£çè¿æ»¤å¨éå°ä¸ä¸ªéè¦è¿æ»¤ç keyvalue å®ä¾æ¶ï¼åæå±è¿æ»¤æ´è¡æ°æ®ãä¸é¢æ¯ä¸ä¸ªä½¿ç¨ç¤ºä¾ï¼\n\n// å®ä¹ valuefilter è¿æ»¤å¨\nfilter filter1 = new valuefilter(compareoperator.not_equal,\n      new binarycomparator(bytes.tobytes("xxx")));\n// ä½¿ç¨ skipfilter è¿è¡åè£\nfilter filter2 = new skipfilter(filter1);\n\n\n\n# whilematchfilter è¿æ»¤å¨\n\nwhilematchfilter åè£ä¸ä¸ªè¿æ»¤å¨ï¼å½è¢«åè£çè¿æ»¤å¨éå°ä¸ä¸ªéè¦è¿æ»¤ç keyvalue å®ä¾æ¶ï¼whilematchfilter åç»ææ¬æ¬¡æ«æï¼è¿åå·²ç»æ«æå°çç»æãä¸é¢æ¯å¶ä½¿ç¨ç¤ºä¾ï¼\n\nfilter filter1 = new rowfilter(compareoperator.not_equal,\n                               new binarycomparator(bytes.tobytes("rowkey4")));\n\nscan scan = new scan();\nscan.setfilter(filter1);\nresultscanner scanner1 = table.getscanner(scan);\nfor (result result : scanner1) {\n    for (cell cell : result.listcells()) {\n        system.out.println(cell);\n    }\n}\nscanner1.close();\n\nsystem.out.println("--------------------");\n\n// ä½¿ç¨ whilematchfilter è¿è¡åè£\nfilter filter2 = new whilematchfilter(filter1);\n\nscan.setfilter(filter2);\nresultscanner scanner2 = table.getscanner(scan);\nfor (result result : scanner1) {\n    for (cell cell : result.listcells()) {\n        system.out.println(cell);\n    }\n}\nscanner2.close();\nrowkey0/student:name/1555035006994/put/vlen=8/seqid=0\nrowkey1/student:name/1555035007019/put/vlen=8/seqid=0\nrowkey2/student:name/1555035007025/put/vlen=8/seqid=0\nrowkey3/student:name/1555035007037/put/vlen=8/seqid=0\nrowkey5/student:name/1555035007051/put/vlen=8/seqid=0\nrowkey6/student:name/1555035007057/put/vlen=8/seqid=0\nrowkey7/student:name/1555035007062/put/vlen=8/seqid=0\nrowkey8/student:name/1555035007068/put/vlen=8/seqid=0\nrowkey9/student:name/1555035007073/put/vlen=8/seqid=0\n--------------------\nrowkey0/student:name/1555035006994/put/vlen=8/seqid=0\nrowkey1/student:name/1555035007019/put/vlen=8/seqid=0\nrowkey2/student:name/1555035007025/put/vlen=8/seqid=0\nrowkey3/student:name/1555035007037/put/vlen=8/seqid=0\n\n\nå¯ä»¥çå°è¢«åè£åï¼åªè¿åäº rowkey4 ä¹åçæ°æ®ã\n\n\n# filterlist\n\nä»¥ä¸é½æ¯è®²è§£åä¸ªè¿æ»¤å¨çä½ç¨ï¼å½éè¦å¤ä¸ªè¿æ»¤å¨å±åä½ç¨äºä¸æ¬¡æ¥è¯¢çæ¶åï¼å°±éè¦ä½¿ç¨ filterlistãfilterlist æ¯æéè¿æé å¨æè addfilter æ¹æ³ä¼ å¥å¤ä¸ªè¿æ»¤å¨ã\n\n// æé å¨ä¼ å¥\npublic filterlist(final operator operator, final list<filter> filters)\npublic filterlist(final list<filter> filters)\npublic filterlist(final filter... filters)\n\n// æ¹æ³ä¼ å¥\n public void addfilter(list<filter> filters)\n public void addfilter(filter filter)\n\n\nå¤ä¸ªè¿æ»¤å¨ç»åçç»æç± operator åæ°å®ä¹ ï¼å¶å¯éåæ°å®ä¹å¨ operator æä¸¾ç±»ä¸­ãåªæ must_pass_all å must_pass_one ä¸¤ä¸ªå¯éçå¼ï¼\n\n * must_pass_all ï¼ç¸å½äº andï¼å¿é¡»ææçè¿æ»¤å¨é½éè¿æè®¤ä¸ºéè¿ï¼\n * must_pass_one ï¼ç¸å½äº orï¼åªæè¦ä¸ä¸ªè¿æ»¤å¨éè¿åè®¤ä¸ºéè¿ã\n\n@interfaceaudience.public\n  public enum operator {\n    /** !and */\n    must_pass_all,\n    /** !or */\n    must_pass_one\n  }\n\n\nä½¿ç¨ç¤ºä¾å¦ä¸ï¼\n\nlist<filter> filters = new arraylist<filter>();\n\nfilter filter1 = new rowfilter(compareoperator.greater_or_equal,\n                               new binarycomparator(bytes.tobytes("xxx")));\nfilters.add(filter1);\n\nfilter filter2 = new rowfilter(compareoperator.less_or_equal,\n                               new binarycomparator(bytes.tobytes("yyy")));\nfilters.add(filter2);\n\nfilter filter3 = new qualifierfilter(compareoperator.equal,\n                                     new regexstringcomparator("zzz"));\nfilters.add(filter3);\n\nfilterlist filterlist = new filterlist(filters);\n\nscan scan = new scan();\nscan.setfilter(filterlist);\n\n\n\n# åèèµæ\n\n * ãhbase æå¨æåã\n * ãhbase æå¨æåãå®æ¹æºç ',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"HBase Java API å¶ä»é«çº§ç¹æ§",frontmatter:{title:"HBase Java API å¶ä»é«çº§ç¹æ§",date:"2023-03-31T16:20:27.000Z",categories:["æ°æ®åº","åå¼æ°æ®åº","HBase"],tags:["å¤§æ°æ®","HBase","API"],permalink:"/pages/ce5ca0/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/06.%E5%88%97%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93/01.HBase/13.HBaseJavaApi%E5%85%B6%E4%BB%96%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7.html",relativePath:"12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/13.HBaseJavaApiå¶ä»é«çº§ç¹æ§.md",key:"v-2bc9cd70",path:"/pages/ce5ca0/",headers:[{level:2,title:"è®¡æ°å¨",slug:"è®¡æ°å¨",normalizedTitle:"è®¡æ°å¨",charIndex:28},{level:3,title:"è®¡æ°å¨ä½¿ç¨ Shell å½ä»¤è¡",slug:"è®¡æ°å¨ä½¿ç¨-shell-å½ä»¤è¡",normalizedTitle:"è®¡æ°å¨ä½¿ç¨ shell å½ä»¤è¡",charIndex:306},{level:3,title:"åè®¡æ°å¨",slug:"åè®¡æ°å¨",normalizedTitle:"åè®¡æ°å¨",charIndex:1082},{level:3,title:"å¤è®¡æ°å¨",slug:"å¤è®¡æ°å¨",normalizedTitle:"å¤è®¡æ°å¨",charIndex:1560},{level:2,title:"è¿æ¥ç®¡ç",slug:"è¿æ¥ç®¡ç",normalizedTitle:"è¿æ¥ç®¡ç",charIndex:2220},{level:3,title:"è¿æ¥ç®¡çç®ä»",slug:"è¿æ¥ç®¡çç®ä»",normalizedTitle:"è¿æ¥ç®¡çç®ä»",charIndex:2229},{level:3,title:"è¿æ¥æ± ",slug:"è¿æ¥æ± ",normalizedTitle:"è¿æ¥æ± ",charIndex:2726},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:3354}],headersStr:"è®¡æ°å¨ è®¡æ°å¨ä½¿ç¨ Shell å½ä»¤è¡ åè®¡æ°å¨ å¤è®¡æ°å¨ è¿æ¥ç®¡ç è¿æ¥ç®¡çç®ä» è¿æ¥æ±  åèèµæ",content:"# HBase Java API å¶ä»é«çº§ç¹æ§\n\n\n# è®¡æ°å¨\n\nHBase æä¾äºä¸ç§é«çº§åè½ï¼è®¡æ°å¨ï¼counterï¼ãHBase è®¡æ°å¨å¯ä»¥ç¨äºå®æ¶ç»è®¡ï¼æ éå»¶æ¶è¾é«çæ¹éå¤çæä½ãHBase æä¸ç§æºå¶å¯ä»¥å°åå½ä½è®¡æ°å¨ï¼å³è¯»åå¹¶ä¿®æ¹ï¼å¶å®å°±æ¯ä¸ç§ CAS æ¨¡å¼ï¼ï¼å¶ä¿è¯äºå¨ä¸æ¬¡æä½ä¸­çåå­æ§ãå¦åï¼ç¨æ·éè¦å¯¹ä¸è¡æ°æ®å éï¼ç¶åè¯»åæ°æ®ï¼åå¯¹å½åæ°æ®åå æ³ï¼æååå HBase å¹¶éæ¾è¡éï¼è¿ä¸ç³»åæä½ä¼å¼èµ·å¤§éçèµæºç«äºé®é¢ã\n\næ©æç HBase çæ¬ä¼å¨æ¯æ¬¡è®¡æ°å¨æ´æ°æä½è°ç¨ä¸æ¬¡ RPC è¯·æ±ï¼æ°çæ¬ä¸­å¯ä»¥å¨ä¸æ¬¡ RPC è¯·æ±ä¸­å®æå¤ä¸ªè®¡æ°å¨çæ´æ°æä½ï¼ä½æ¯å¤ä¸ªè®¡æ°å¨å¿é¡»å¨åä¸è¡ã\n\n\n# è®¡æ°å¨ä½¿ç¨ Shell å½ä»¤è¡\n\nè®¡æ°å¨ä¸éè¦åå§åï¼åå»ºä¸ä¸ªæ°åæ¶åå§å¼ä¸º 0ï¼ç¬¬ä¸æ¬¡ incr æä½è¿å 1ã\n\nè®¡æ°å¨ä½¿ç¨ incr å½ä»¤ï¼å¢éå¯ä»¥æ¯æ­£æ°ä¹å¯ä»¥æ¯è´æ°ï¼ä½æ¯å¿é¡»æ¯é¿æ´æ° Longï¼\n\nincr '<table>','<row>','<column>',['<increment-value>']\n\n\nè®¡æ°å¨ä½¿ç¨çä¾å­ï¼\n\nhbase(main):001:0> create 'counters','daily','weekly','monthly'\n0 row(s) in 1.2260 seconds\n\nhbase(main):002:0> incr 'counters','20190301','daily:hites',1\nCOUNTER VALUE = 1\n\nhbase(main):003:0> incr'counters','20190301','daily:hites',1\nCOUNTER VALUE = 2\n\nhbase(main):004:0> get_counter 'counters','20190301','daily:hites'\nCOUNTER VALUE = 2\n\n\néè¦æ³¨æçæ¯ï¼å¢å çåæ°å¿é¡»æ¯é¿æ´å Longï¼å¦ææç§éè¯¯çæ ¼å¼æ´æ°äºè®¡æ°å¨ï¼å¦å­ç¬¦ä¸²æ ¼å¼ï¼ï¼ä¸æ¬¡è°ç¨ incr ä¼å¾å°éè¯¯çç»æï¼\n\nhbase(main):005:0> put 'counters','20190301','daily:clicks','1'\n0 row(s) in 1.3250 seconds\n\nhbase(main):006:0> incr'counters','20190301','daily:clicks',1\nCOUNTER VALUE = 3530822107858468865\n\n\n\n# åè®¡æ°å¨\n\næä½ä¸ä¸ªè®¡æ°å¨ï¼ç±»ä¼¼ shell å½ä»¤ incr\n\nHTable table  = new HTable(conf, \"counters\");\n\nlong cnt1 = table.incrementColumnValue(Bytes.toBytes(\"20190301\"),\n    Bytes.toBytes(\"daily\"),\n    Bytes.toBytes(\"hits\"),\n    1L);\n\nlong cnt2 = table.incrementColumnValue(Bytes.toBytes(\"20190301\"),\n    Bytes.toBytes(\"daily\"),\n    Bytes.toBytes(\"hits\"),\n    1L);\n\nlong current = table.incrementColumnValue(Bytes.toBytes(\"20190301\"),\n    Bytes.toBytes(\"daily\"),\n    Bytes.toBytes(\"hits\"),\n    0);\n\n\n\n# å¤è®¡æ°å¨\n\nä½¿ç¨ Table ç increment() æ¹æ³å¯ä»¥æä½ä¸è¡çå¤ä¸ªè®¡æ°å¨ï¼éè¦æå»º Increment å®ä¾ï¼å¹¶ä¸æå®è¡é®ï¼\n\nHTable table  = new HTable(conf, \"counters\");\n\nIncrement incr1 = new Increment(Bytes.toBytes(\"20190301\"));\nincr1.addColumn(Bytes.toBytes(\"daily\"), Bytes.toBytes(\"clicks\"),1);\nincr1.addColumn(Bytes.toBytes(\"daily\"), Bytes.toBytes(\"hits\"), 1);\nincr1.addColumn(Bytes.toBytes(\"weekly\"), Bytes.toBytes(\"clicks\"), 2);\nincr1.addColumn(Bytes.toBytes(\"weekly\"), Bytes.toBytes(\"hits\"), 2);\n\nResult result = table.increment(incr1);\nfor(Cell cell : result.rawCells()) {\n    // ...\n}\n\n\nIncrement ç±»è¿æä¸ç§æé å¨ï¼\n\nIncrement(byte[] row, RowLock rowLock)\n\n\nrowLock åæ°å¯éï¼å¯ä»¥è®¾ç½®ç¨æ·èªå®ä¹éï¼å¯ä»¥éå¶å¶ä»åç¨åºæä½æ­¤è¡ï¼ä½æ¯ä¸ä¿è¯è¯»çæä½æ§ã\n\n\n# è¿æ¥ç®¡ç\n\n\n# è¿æ¥ç®¡çç®ä»\n\nå¨ HBase Java API ä¸­ï¼Connection ç±»ä»£è¡¨äºä¸ä¸ªéç¾¤è¿æ¥ï¼å°è£äºä¸å¤å°æå¡å¨ï¼Matser/Region Serverï¼çåºå±è¿æ¥ä»¥åä¸ zookeeper çè¿æ¥ãConnection éè¿ ConnectionFactory ç±»å®ä¾åï¼èè¿æ¥ççå½å¨æåç±è°ç¨èç®¡çï¼è°ç¨èå¿é¡»æ¾ç¤ºè°ç¨ close() æ¥éæ¾è¿æ¥ãConnection æ¯çº¿ç¨å®å¨çãåå»º Connection å®ä¾çå¼éå¾é«ï¼å æ­¤ä¸ä¸ªè¿ç¨åªéè¦å®ä¾åä¸ä¸ª Connection å³å¯ã\n\nTable æ¥å£ç¨äºå¯¹æå®ç HBase è¡¨è¿è¡ CRUD æä½ãä¸è¬ï¼éè¿ Connection è·å Table å®ä¾ï¼ç¨å®åï¼è°ç¨ close() éæ¾è¿æ¥ã\n\nAdmin æ¥å£ä¸»è¦ç¨äºåå»ºãå é¤ãæ¥çãå¯ç¨/ç¦ç¨ HBase è¡¨ï¼ä»¥åä¸äºå¶ä»ç®¡çæä½ãä¸è¬ï¼éè¿ Connection è·å Admin å®ä¾ï¼ç¨å®åï¼è°ç¨ close() éæ¾è¿æ¥ã\n\nTable å Admin å®ä¾é½æ¯è½»éçº§ä¸å¹¶éçº¿ç¨å®å¨çãå»ºè®®æ¯ä¸ªçº¿ç¨åªå®ä¾åä¸ä¸ª Table æ Admin å®ä¾ã\n\n\n# è¿æ¥æ± \n\né®é¢ï¼HBase ä¸ºä»ä¹æ²¡ææä¾ Connection çè¿æ¥æ± æ¥è·åæ´å¥½çæ§è½ï¼æ¯å¦éè¦èªå®ä¹ Connection è¿æ¥æ± ï¼\n\nç­ï¼ä¸éè¦ãå®æ¹å¯¹äº Connection çä½¿ç¨è¯´æä¸­ï¼æç¡®æåºï¼å¯¹äºé«å¹¶åå¤çº¿ç¨è®¿é®çåºç¨ç¨åºï¼ä¸ä¸ªè¿ç¨ä¸­åªéè¦é¢ååå»ºä¸ä¸ª Connectionã\n\né®é¢ï¼HBase èçæ¬ä¸­ HTablePool ä¸ºä»ä¹åºå¼ï¼æ¯å¦éè¦èªå®ä¹ Table çè¿æ¥æ± ï¼\n\nç­ï¼ä¸éè¦ãTable å Admin çè¿æ¥æ¬è´¨ä¸æ¯å¤ç¨ Connectionï¼å®ä¾åæ¯ä¸ä¸ªè¾ä¸ºè½»éçº§çæä½ï¼å æ­¤ï¼å¹¶ä¸éè¦ç¼å­ææ± åãå®éä¸ï¼HBase Java API å®æ¹å°±æ¯è¿ä¹å»ºè®®çã\n\nä¸é¢æ¯ç®¡ç HBase è¿æ¥çä¸ä¸ªæ­£ç¡®ç¼ç¨æ¨¡å\n\n// ææè¿ç¨å±ç¨ä¸ä¸ª connection å¯¹è±¡\nconnection = ConnectionFactory.createConnection(config);\n\n// æ¯ä¸ªçº¿ç¨ä½¿ç¨åç¬ç table å¯¹è±¡\nTable table = connection.getTable(TableName.valueOf(\"tableName\"));\ntry {\n\t...\n} finally {\n   table.close();\n}\n\nAdmin admin = connection.getAdmin();\ntry {\n\t...\n} finally {\n   admin.close();\n}\n\n\n\n# åèèµæ\n\n * ãHBase æå¨æåã\n * ãHBase æå¨æåãå®æ¹æºç \n * è¿æ¥ HBase çæ­£ç¡®å§¿å¿",normalizedContent:"# hbase java api å¶ä»é«çº§ç¹æ§\n\n\n# è®¡æ°å¨\n\nhbase æä¾äºä¸ç§é«çº§åè½ï¼è®¡æ°å¨ï¼counterï¼ãhbase è®¡æ°å¨å¯ä»¥ç¨äºå®æ¶ç»è®¡ï¼æ éå»¶æ¶è¾é«çæ¹éå¤çæä½ãhbase æä¸ç§æºå¶å¯ä»¥å°åå½ä½è®¡æ°å¨ï¼å³è¯»åå¹¶ä¿®æ¹ï¼å¶å®å°±æ¯ä¸ç§ cas æ¨¡å¼ï¼ï¼å¶ä¿è¯äºå¨ä¸æ¬¡æä½ä¸­çåå­æ§ãå¦åï¼ç¨æ·éè¦å¯¹ä¸è¡æ°æ®å éï¼ç¶åè¯»åæ°æ®ï¼åå¯¹å½åæ°æ®åå æ³ï¼æååå hbase å¹¶éæ¾è¡éï¼è¿ä¸ç³»åæä½ä¼å¼èµ·å¤§éçèµæºç«äºé®é¢ã\n\næ©æç hbase çæ¬ä¼å¨æ¯æ¬¡è®¡æ°å¨æ´æ°æä½è°ç¨ä¸æ¬¡ rpc è¯·æ±ï¼æ°çæ¬ä¸­å¯ä»¥å¨ä¸æ¬¡ rpc è¯·æ±ä¸­å®æå¤ä¸ªè®¡æ°å¨çæ´æ°æä½ï¼ä½æ¯å¤ä¸ªè®¡æ°å¨å¿é¡»å¨åä¸è¡ã\n\n\n# è®¡æ°å¨ä½¿ç¨ shell å½ä»¤è¡\n\nè®¡æ°å¨ä¸éè¦åå§åï¼åå»ºä¸ä¸ªæ°åæ¶åå§å¼ä¸º 0ï¼ç¬¬ä¸æ¬¡ incr æä½è¿å 1ã\n\nè®¡æ°å¨ä½¿ç¨ incr å½ä»¤ï¼å¢éå¯ä»¥æ¯æ­£æ°ä¹å¯ä»¥æ¯è´æ°ï¼ä½æ¯å¿é¡»æ¯é¿æ´æ° longï¼\n\nincr '<table>','<row>','<column>',['<increment-value>']\n\n\nè®¡æ°å¨ä½¿ç¨çä¾å­ï¼\n\nhbase(main):001:0> create 'counters','daily','weekly','monthly'\n0 row(s) in 1.2260 seconds\n\nhbase(main):002:0> incr 'counters','20190301','daily:hites',1\ncounter value = 1\n\nhbase(main):003:0> incr'counters','20190301','daily:hites',1\ncounter value = 2\n\nhbase(main):004:0> get_counter 'counters','20190301','daily:hites'\ncounter value = 2\n\n\néè¦æ³¨æçæ¯ï¼å¢å çåæ°å¿é¡»æ¯é¿æ´å longï¼å¦ææç§éè¯¯çæ ¼å¼æ´æ°äºè®¡æ°å¨ï¼å¦å­ç¬¦ä¸²æ ¼å¼ï¼ï¼ä¸æ¬¡è°ç¨ incr ä¼å¾å°éè¯¯çç»æï¼\n\nhbase(main):005:0> put 'counters','20190301','daily:clicks','1'\n0 row(s) in 1.3250 seconds\n\nhbase(main):006:0> incr'counters','20190301','daily:clicks',1\ncounter value = 3530822107858468865\n\n\n\n# åè®¡æ°å¨\n\næä½ä¸ä¸ªè®¡æ°å¨ï¼ç±»ä¼¼ shell å½ä»¤ incr\n\nhtable table  = new htable(conf, \"counters\");\n\nlong cnt1 = table.incrementcolumnvalue(bytes.tobytes(\"20190301\"),\n    bytes.tobytes(\"daily\"),\n    bytes.tobytes(\"hits\"),\n    1l);\n\nlong cnt2 = table.incrementcolumnvalue(bytes.tobytes(\"20190301\"),\n    bytes.tobytes(\"daily\"),\n    bytes.tobytes(\"hits\"),\n    1l);\n\nlong current = table.incrementcolumnvalue(bytes.tobytes(\"20190301\"),\n    bytes.tobytes(\"daily\"),\n    bytes.tobytes(\"hits\"),\n    0);\n\n\n\n# å¤è®¡æ°å¨\n\nä½¿ç¨ table ç increment() æ¹æ³å¯ä»¥æä½ä¸è¡çå¤ä¸ªè®¡æ°å¨ï¼éè¦æå»º increment å®ä¾ï¼å¹¶ä¸æå®è¡é®ï¼\n\nhtable table  = new htable(conf, \"counters\");\n\nincrement incr1 = new increment(bytes.tobytes(\"20190301\"));\nincr1.addcolumn(bytes.tobytes(\"daily\"), bytes.tobytes(\"clicks\"),1);\nincr1.addcolumn(bytes.tobytes(\"daily\"), bytes.tobytes(\"hits\"), 1);\nincr1.addcolumn(bytes.tobytes(\"weekly\"), bytes.tobytes(\"clicks\"), 2);\nincr1.addcolumn(bytes.tobytes(\"weekly\"), bytes.tobytes(\"hits\"), 2);\n\nresult result = table.increment(incr1);\nfor(cell cell : result.rawcells()) {\n    // ...\n}\n\n\nincrement ç±»è¿æä¸ç§æé å¨ï¼\n\nincrement(byte[] row, rowlock rowlock)\n\n\nrowlock åæ°å¯éï¼å¯ä»¥è®¾ç½®ç¨æ·èªå®ä¹éï¼å¯ä»¥éå¶å¶ä»åç¨åºæä½æ­¤è¡ï¼ä½æ¯ä¸ä¿è¯è¯»çæä½æ§ã\n\n\n# è¿æ¥ç®¡ç\n\n\n# è¿æ¥ç®¡çç®ä»\n\nå¨ hbase java api ä¸­ï¼connection ç±»ä»£è¡¨äºä¸ä¸ªéç¾¤è¿æ¥ï¼å°è£äºä¸å¤å°æå¡å¨ï¼matser/region serverï¼çåºå±è¿æ¥ä»¥åä¸ zookeeper çè¿æ¥ãconnection éè¿ connectionfactory ç±»å®ä¾åï¼èè¿æ¥ççå½å¨æåç±è°ç¨èç®¡çï¼è°ç¨èå¿é¡»æ¾ç¤ºè°ç¨ close() æ¥éæ¾è¿æ¥ãconnection æ¯çº¿ç¨å®å¨çãåå»º connection å®ä¾çå¼éå¾é«ï¼å æ­¤ä¸ä¸ªè¿ç¨åªéè¦å®ä¾åä¸ä¸ª connection å³å¯ã\n\ntable æ¥å£ç¨äºå¯¹æå®ç hbase è¡¨è¿è¡ crud æä½ãä¸è¬ï¼éè¿ connection è·å table å®ä¾ï¼ç¨å®åï¼è°ç¨ close() éæ¾è¿æ¥ã\n\nadmin æ¥å£ä¸»è¦ç¨äºåå»ºãå é¤ãæ¥çãå¯ç¨/ç¦ç¨ hbase è¡¨ï¼ä»¥åä¸äºå¶ä»ç®¡çæä½ãä¸è¬ï¼éè¿ connection è·å admin å®ä¾ï¼ç¨å®åï¼è°ç¨ close() éæ¾è¿æ¥ã\n\ntable å admin å®ä¾é½æ¯è½»éçº§ä¸å¹¶éçº¿ç¨å®å¨çãå»ºè®®æ¯ä¸ªçº¿ç¨åªå®ä¾åä¸ä¸ª table æ admin å®ä¾ã\n\n\n# è¿æ¥æ± \n\né®é¢ï¼hbase ä¸ºä»ä¹æ²¡ææä¾ connection çè¿æ¥æ± æ¥è·åæ´å¥½çæ§è½ï¼æ¯å¦éè¦èªå®ä¹ connection è¿æ¥æ± ï¼\n\nç­ï¼ä¸éè¦ãå®æ¹å¯¹äº connection çä½¿ç¨è¯´æä¸­ï¼æç¡®æåºï¼å¯¹äºé«å¹¶åå¤çº¿ç¨è®¿é®çåºç¨ç¨åºï¼ä¸ä¸ªè¿ç¨ä¸­åªéè¦é¢ååå»ºä¸ä¸ª connectionã\n\né®é¢ï¼hbase èçæ¬ä¸­ htablepool ä¸ºä»ä¹åºå¼ï¼æ¯å¦éè¦èªå®ä¹ table çè¿æ¥æ± ï¼\n\nç­ï¼ä¸éè¦ãtable å admin çè¿æ¥æ¬è´¨ä¸æ¯å¤ç¨ connectionï¼å®ä¾åæ¯ä¸ä¸ªè¾ä¸ºè½»éçº§çæä½ï¼å æ­¤ï¼å¹¶ä¸éè¦ç¼å­ææ± åãå®éä¸ï¼hbase java api å®æ¹å°±æ¯è¿ä¹å»ºè®®çã\n\nä¸é¢æ¯ç®¡ç hbase è¿æ¥çä¸ä¸ªæ­£ç¡®ç¼ç¨æ¨¡å\n\n// ææè¿ç¨å±ç¨ä¸ä¸ª connection å¯¹è±¡\nconnection = connectionfactory.createconnection(config);\n\n// æ¯ä¸ªçº¿ç¨ä½¿ç¨åç¬ç table å¯¹è±¡\ntable table = connection.gettable(tablename.valueof(\"tablename\"));\ntry {\n\t...\n} finally {\n   table.close();\n}\n\nadmin admin = connection.getadmin();\ntry {\n\t...\n} finally {\n   admin.close();\n}\n\n\n\n# åèèµæ\n\n * ãhbase æå¨æåã\n * ãhbase æå¨æåãå®æ¹æºç \n * è¿æ¥ hbase çæ­£ç¡®å§¿å¿",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"HBase Java API ç®¡çåè½",frontmatter:{title:"HBase Java API ç®¡çåè½",date:"2023-04-13T16:36:48.000Z",categories:["æ°æ®åº","åå¼æ°æ®åº","HBase"],tags:["å¤§æ°æ®","HBase","API"],permalink:"/pages/b59ba2/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/06.%E5%88%97%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93/01.HBase/14.HBaseJavaApi%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD.html",relativePath:"12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/14.HBaseJavaApiç®¡çåè½.md",key:"v-a7ca3eb4",path:"/pages/b59ba2/",headers:[{level:2,title:"åå§å Admin å®ä¾",slug:"åå§å-admin-å®ä¾",normalizedTitle:"åå§å admin å®ä¾",charIndex:26},{level:2,title:"ç®¡çå½åç©ºé´",slug:"ç®¡çå½åç©ºé´",normalizedTitle:"ç®¡çå½åç©ºé´",charIndex:198},{level:3,title:"æ¥çå½åç©ºé´",slug:"æ¥çå½åç©ºé´",normalizedTitle:"æ¥çå½åç©ºé´",charIndex:209},{level:3,title:"åå»ºå½åç©ºé´",slug:"åå»ºå½åç©ºé´",normalizedTitle:"åå»ºå½åç©ºé´",charIndex:376},{level:3,title:"ä¿®æ¹å½åç©ºé´",slug:"ä¿®æ¹å½åç©ºé´",normalizedTitle:"ä¿®æ¹å½åç©ºé´",charIndex:499},{level:3,title:"å é¤å½åç©ºé´",slug:"å é¤å½åç©ºé´",normalizedTitle:"å é¤å½åç©ºé´",charIndex:776},{level:2,title:"ç®¡çè¡¨",slug:"ç®¡çè¡¨",normalizedTitle:"ç®¡çè¡¨",charIndex:820},{level:3,title:"åå»ºè¡¨",slug:"åå»ºè¡¨",normalizedTitle:"åå»ºè¡¨",charIndex:828},{level:3,title:"å é¤è¡¨",slug:"å é¤è¡¨",normalizedTitle:"å é¤è¡¨",charIndex:1122},{level:3,title:"ä¿®æ¹è¡¨",slug:"ä¿®æ¹è¡¨",normalizedTitle:"ä¿®æ¹è¡¨",charIndex:1183},{level:3,title:"ç¦ç¨è¡¨",slug:"ç¦ç¨è¡¨",normalizedTitle:"ç¦ç¨è¡¨",charIndex:1969},{level:3,title:"å¯ç¨è¡¨",slug:"å¯ç¨è¡¨",normalizedTitle:"å¯ç¨è¡¨",charIndex:2056},{level:3,title:"æ¥çè¡¨æ¯å¦ææ",slug:"æ¥çè¡¨æ¯å¦ææ",normalizedTitle:"æ¥çè¡¨æ¯å¦ææ",charIndex:2117},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:2229}],headersStr:"åå§å Admin å®ä¾ ç®¡çå½åç©ºé´ æ¥çå½åç©ºé´ åå»ºå½åç©ºé´ ä¿®æ¹å½åç©ºé´ å é¤å½åç©ºé´ ç®¡çè¡¨ åå»ºè¡¨ å é¤è¡¨ ä¿®æ¹è¡¨ ç¦ç¨è¡¨ å¯ç¨è¡¨ æ¥çè¡¨æ¯å¦ææ åèèµæ",content:'# HBase Java API ç®¡çåè½\n\n\n# åå§å Admin å®ä¾\n\nConfiguration conf = HBaseConfiguration.create();\nConnection connection = ConnectionFactory.createConnection(conf);\nAdmin admin = connection.getAdmin();\n\n\n\n# ç®¡çå½åç©ºé´\n\n\n# æ¥çå½åç©ºé´\n\nTableName[] tableNames = admin.listTableNamesByNamespace("test");\nfor (TableName tableName : tableNames) {\n    System.out.println(tableName.getName());\n}\n\n\n\n# åå»ºå½åç©ºé´\n\nNamespaceDescriptor namespace = NamespaceDescriptor.create("test").build();\nadmin.createNamespace(namespace);\n\n\n\n# ä¿®æ¹å½åç©ºé´\n\nNamespaceDescriptor namespace = NamespaceDescriptor.create("test")\n                                                   .addConfiguration("Description", "Test Namespace")\n                                                   .build();\nadmin.modifyNamespace(namespace);\n\n\n\n# å é¤å½åç©ºé´\n\nadmin.deleteNamespace("test");\n\n\n\n# ç®¡çè¡¨\n\n\n# åå»ºè¡¨\n\nTableName tableName = TableName.valueOf("test:test");\nHTableDescriptor tableDescriptor = new HTableDescriptor(tableName);\nHColumnDescriptor columnDescriptor = new HColumnDescriptor(Bytes.toBytes("cf"));\ntableDescriptor.addFamily(columnDescriptor);\nadmin.createTable(tableDescriptor);\n\n\n\n# å é¤è¡¨\n\nadmin.deleteTable(TableName.valueOf("test:test"));\n\n\n\n# ä¿®æ¹è¡¨\n\n// åå§è¡¨\nTableName tableName = TableName.valueOf("test:test");\nHColumnDescriptor columnDescriptor = new HColumnDescriptor("cf1");\nHTableDescriptor tableDescriptor = new HTableDescriptor(tableName)\n    .addFamily(columnDescriptor)\n    .setValue("Description", "Original Table");\nadmin.createTable(tableDescriptor, Bytes.toBytes(1L), Bytes.toBytes(10000L), 50);\n\n// ä¿®æ¹è¡¨\nHTableDescriptor newTableDescriptor = admin.getTableDescriptor(tableName);\nHColumnDescriptor newColumnDescriptor = new HColumnDescriptor("cf2");\nnewTableDescriptor.addFamily(newColumnDescriptor)\n                  .setMaxFileSize(1024 * 1024 * 1024L)\n                  .setValue("Description", "Modified Table");\n\n// ä¿®æ¹è¡¨å¿é¡»åç¦ç¨åæ³ä¿®æ¹\nadmin.disableTable(tableName);\nadmin.modifyTable(tableName, newTableDescriptor);\n\n\n\n# ç¦ç¨è¡¨\n\néè¦æ³¨æï¼HBase è¡¨å¨å é¤åï¼å¿é¡»åç¦ç¨ã\n\nadmin.disableTable(TableName.valueOf("test:test"));\n\n\n\n# å¯ç¨è¡¨\n\nadmin.enableTable(TableName.valueOf("test:test"));\n\n\n\n# æ¥çè¡¨æ¯å¦ææ\n\nboolean isOk = admin.isTableAvailable(tableName);\nSystem.out.println("Table available: " + isOk);\n\n\n\n# åèèµæ\n\n * ãHBase æå¨æåã\n * ãHBase æå¨æåãå®æ¹æºç \n * è¿æ¥ HBase çæ­£ç¡®å§¿å¿',normalizedContent:'# hbase java api ç®¡çåè½\n\n\n# åå§å admin å®ä¾\n\nconfiguration conf = hbaseconfiguration.create();\nconnection connection = connectionfactory.createconnection(conf);\nadmin admin = connection.getadmin();\n\n\n\n# ç®¡çå½åç©ºé´\n\n\n# æ¥çå½åç©ºé´\n\ntablename[] tablenames = admin.listtablenamesbynamespace("test");\nfor (tablename tablename : tablenames) {\n    system.out.println(tablename.getname());\n}\n\n\n\n# åå»ºå½åç©ºé´\n\nnamespacedescriptor namespace = namespacedescriptor.create("test").build();\nadmin.createnamespace(namespace);\n\n\n\n# ä¿®æ¹å½åç©ºé´\n\nnamespacedescriptor namespace = namespacedescriptor.create("test")\n                                                   .addconfiguration("description", "test namespace")\n                                                   .build();\nadmin.modifynamespace(namespace);\n\n\n\n# å é¤å½åç©ºé´\n\nadmin.deletenamespace("test");\n\n\n\n# ç®¡çè¡¨\n\n\n# åå»ºè¡¨\n\ntablename tablename = tablename.valueof("test:test");\nhtabledescriptor tabledescriptor = new htabledescriptor(tablename);\nhcolumndescriptor columndescriptor = new hcolumndescriptor(bytes.tobytes("cf"));\ntabledescriptor.addfamily(columndescriptor);\nadmin.createtable(tabledescriptor);\n\n\n\n# å é¤è¡¨\n\nadmin.deletetable(tablename.valueof("test:test"));\n\n\n\n# ä¿®æ¹è¡¨\n\n// åå§è¡¨\ntablename tablename = tablename.valueof("test:test");\nhcolumndescriptor columndescriptor = new hcolumndescriptor("cf1");\nhtabledescriptor tabledescriptor = new htabledescriptor(tablename)\n    .addfamily(columndescriptor)\n    .setvalue("description", "original table");\nadmin.createtable(tabledescriptor, bytes.tobytes(1l), bytes.tobytes(10000l), 50);\n\n// ä¿®æ¹è¡¨\nhtabledescriptor newtabledescriptor = admin.gettabledescriptor(tablename);\nhcolumndescriptor newcolumndescriptor = new hcolumndescriptor("cf2");\nnewtabledescriptor.addfamily(newcolumndescriptor)\n                  .setmaxfilesize(1024 * 1024 * 1024l)\n                  .setvalue("description", "modified table");\n\n// ä¿®æ¹è¡¨å¿é¡»åç¦ç¨åæ³ä¿®æ¹\nadmin.disabletable(tablename);\nadmin.modifytable(tablename, newtabledescriptor);\n\n\n\n# ç¦ç¨è¡¨\n\néè¦æ³¨æï¼hbase è¡¨å¨å é¤åï¼å¿é¡»åç¦ç¨ã\n\nadmin.disabletable(tablename.valueof("test:test"));\n\n\n\n# å¯ç¨è¡¨\n\nadmin.enabletable(tablename.valueof("test:test"));\n\n\n\n# æ¥çè¡¨æ¯å¦ææ\n\nboolean isok = admin.istableavailable(tablename);\nsystem.out.println("table available: " + isok);\n\n\n\n# åèèµæ\n\n * ãhbase æå¨æåã\n * ãhbase æå¨æåãå®æ¹æºç \n * è¿æ¥ hbase çæ­£ç¡®å§¿å¿',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"HBase è¿ç»´",frontmatter:{title:"HBase è¿ç»´",date:"2019-05-07T20:19:25.000Z",categories:["æ°æ®åº","åå¼æ°æ®åº","HBase"],tags:["å¤§æ°æ®","HBase","è¿ç»´"],permalink:"/pages/f808fc/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/06.%E5%88%97%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93/01.HBase/21.HBase%E8%BF%90%E7%BB%B4.html",relativePath:"12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/21.HBaseè¿ç»´.md",key:"v-735c9d66",path:"/pages/f808fc/",headers:[{level:2,title:"éç½®æä»¶",slug:"éç½®æä»¶",normalizedTitle:"éç½®æä»¶",charIndex:15},{level:2,title:"ç¯å¢è¦æ±",slug:"ç¯å¢è¦æ±",normalizedTitle:"ç¯å¢è¦æ±",charIndex:697},{level:2,title:"è¿è¡æ¨¡å¼",slug:"è¿è¡æ¨¡å¼",normalizedTitle:"è¿è¡æ¨¡å¼",charIndex:953},{level:3,title:"åç¹",slug:"åç¹",normalizedTitle:"åç¹",charIndex:962},{level:3,title:"åå¸å¼",slug:"åå¸å¼",normalizedTitle:"åå¸å¼",charIndex:1237},{level:2,title:"å¼ç¨åå¼ç³",slug:"å¼ç¨åå¼ç³",normalizedTitle:"å¼ç¨åå¼ç³",charIndex:1654},{level:3,title:"æ©å±éè¯»",slug:"æ©å±éè¯»",normalizedTitle:"æ©å±éè¯»",charIndex:1664}],headersStr:"éç½®æä»¶ ç¯å¢è¦æ± è¿è¡æ¨¡å¼ åç¹ åå¸å¼ å¼ç¨åå¼ç³ æ©å±éè¯»",content:"# HBase è¿ç»´\n\n\n# éç½®æä»¶\n\n * backup-masters - é»è®¤æåµä¸ä¸å­å¨ãååºä¸»æå¡å¨åºå¨å¶ä¸å¯å¨å¤ä»½ä¸»è¿ç¨çä¸»æºï¼æ¯è¡ä¸ä¸ªä¸»æºã\n * hadoop-metrics2-hbase.properties - ç¨äºè¿æ¥ HBase Hadoop ç Metrics2 æ¡æ¶ã\n * hbase-env.cmd and hbase-env.sh - ç¨äº Windows å Linux / Unix ç¯å¢çèæ¬ï¼ç¨äºè®¾ç½® HBase çå·¥ä½ç¯å¢ï¼åæ¬ Javaï¼Java éé¡¹åå¶ä»ç¯å¢åéçä½ç½®ã\n * hbase-policy.xml - RPC æå¡å¨ç¨äºå¯¹å®¢æ·ç«¯è¯·æ±è¿è¡ææå³ç­çé»è®¤ç­ç¥éç½®æä»¶ãä»å¨å¯ç¨ HBase å®å¨æ§æ¶ä½¿ç¨ã\n * hbase-site.xml - ä¸»è¦ç HBase éç½®æä»¶ãæ­¤æä»¶æå®è¦ç HBase é»è®¤éç½®çéç½®éé¡¹ãæ¨å¯ä»¥å¨ docs / hbase-default.xml ä¸­æ¥çï¼ä½ä¸è¦ç¼è¾ï¼é»è®¤éç½®æä»¶ãæ¨è¿å¯ä»¥å¨ HBase Web UI ç HBase éç½®éé¡¹å¡ä¸­æ¥çç¾¤éçæ´ä¸ªææéç½®ï¼é»è®¤å¼åè¦çï¼ã\n * log4j.properties - log4j æ¥å¿éç½®ã\n * regionservers - åå«åºå¨ HBase éç¾¤ä¸­è¿è¡ RegionServer çä¸»æºåè¡¨ãé»è®¤æåµä¸ï¼æ­¤æä»¶åå«åä¸ªæ¡ç® localhostãå®åºåå«ä¸»æºåæ IP å°ååè¡¨ï¼æ¯è¡ä¸ä¸ªï¼å¹¶ä¸å¦æç¾¤éä¸­çæ¯ä¸ªèç¹å°å¨å¶ localhost æ¥å£ä¸è¿è¡ RegionServerï¼ååºä»åå« localhostã\n\n\n# ç¯å¢è¦æ±\n\n * Java\n   * HBase 2.0+ è¦æ± JDK8+\n   * HBase 1.2+ è¦æ± JDK7+\n * SSH - ç¯å¢è¦æ¯æ SSH\n * DNS - ç¯å¢ä¸­è¦å¨ hosts éç½®æ¬æº hostname åæ¬æº IP\n * NTP - HBase éç¾¤çæ¶é´è¦åæ­¥ï¼å¯ä»¥éç½®ç»ä¸ç NTP\n * å¹³å° - çäº§ç¯å¢ä¸æ¨èé¨ç½²å¨ Windows ç³»ç»ä¸­\n * Hadoop - ä¾èµ Hadoop éå¥çæ¬\n * Zookeeper - ä¾èµ Zookeeper éå¥çæ¬\n\n\n# è¿è¡æ¨¡å¼\n\n\n# åç¹\n\nhbase-site.xml éç½®å¦ä¸ï¼\n\n<configuration>\n  <property>\n    <name>hbase.rootdir</name>\n    <value>hdfs://namenode.example.org:8020/hbase</value>\n  </property>\n  <property>\n    <name>hbase.cluster.distributed</name>\n    <value>false</value>\n  </property>\n</configuration>\n\n\n\n# åå¸å¼\n\nhbase-site.xm éç½®å¦ä¸ï¼\n\n<configuration>\n  <property>\n    <name>hbase.rootdir</name>\n    <value>hdfs://namenode.example.org:8020/hbase</value>\n  </property>\n  <property>\n    <name>hbase.cluster.distributed</name>\n    <value>true</value>\n  </property>\n  <property>\n    <name>hbase.zookeeper.quorum</name>\n    <value>node-a.example.com,node-b.example.com,node-c.example.com</value>\n  </property>\n</configuration>\n\n\n\n# å¼ç¨åå¼ç³\n\n\n# æ©å±éè¯»\n\n * Apache HBase Configuration",normalizedContent:"# hbase è¿ç»´\n\n\n# éç½®æä»¶\n\n * backup-masters - é»è®¤æåµä¸ä¸å­å¨ãååºä¸»æå¡å¨åºå¨å¶ä¸å¯å¨å¤ä»½ä¸»è¿ç¨çä¸»æºï¼æ¯è¡ä¸ä¸ªä¸»æºã\n * hadoop-metrics2-hbase.properties - ç¨äºè¿æ¥ hbase hadoop ç metrics2 æ¡æ¶ã\n * hbase-env.cmd and hbase-env.sh - ç¨äº windows å linux / unix ç¯å¢çèæ¬ï¼ç¨äºè®¾ç½® hbase çå·¥ä½ç¯å¢ï¼åæ¬ javaï¼java éé¡¹åå¶ä»ç¯å¢åéçä½ç½®ã\n * hbase-policy.xml - rpc æå¡å¨ç¨äºå¯¹å®¢æ·ç«¯è¯·æ±è¿è¡ææå³ç­çé»è®¤ç­ç¥éç½®æä»¶ãä»å¨å¯ç¨ hbase å®å¨æ§æ¶ä½¿ç¨ã\n * hbase-site.xml - ä¸»è¦ç hbase éç½®æä»¶ãæ­¤æä»¶æå®è¦ç hbase é»è®¤éç½®çéç½®éé¡¹ãæ¨å¯ä»¥å¨ docs / hbase-default.xml ä¸­æ¥çï¼ä½ä¸è¦ç¼è¾ï¼é»è®¤éç½®æä»¶ãæ¨è¿å¯ä»¥å¨ hbase web ui ç hbase éç½®éé¡¹å¡ä¸­æ¥çç¾¤éçæ´ä¸ªææéç½®ï¼é»è®¤å¼åè¦çï¼ã\n * log4j.properties - log4j æ¥å¿éç½®ã\n * regionservers - åå«åºå¨ hbase éç¾¤ä¸­è¿è¡ regionserver çä¸»æºåè¡¨ãé»è®¤æåµä¸ï¼æ­¤æä»¶åå«åä¸ªæ¡ç® localhostãå®åºåå«ä¸»æºåæ ip å°ååè¡¨ï¼æ¯è¡ä¸ä¸ªï¼å¹¶ä¸å¦æç¾¤éä¸­çæ¯ä¸ªèç¹å°å¨å¶ localhost æ¥å£ä¸è¿è¡ regionserverï¼ååºä»åå« localhostã\n\n\n# ç¯å¢è¦æ±\n\n * java\n   * hbase 2.0+ è¦æ± jdk8+\n   * hbase 1.2+ è¦æ± jdk7+\n * ssh - ç¯å¢è¦æ¯æ ssh\n * dns - ç¯å¢ä¸­è¦å¨ hosts éç½®æ¬æº hostname åæ¬æº ip\n * ntp - hbase éç¾¤çæ¶é´è¦åæ­¥ï¼å¯ä»¥éç½®ç»ä¸ç ntp\n * å¹³å° - çäº§ç¯å¢ä¸æ¨èé¨ç½²å¨ windows ç³»ç»ä¸­\n * hadoop - ä¾èµ hadoop éå¥çæ¬\n * zookeeper - ä¾èµ zookeeper éå¥çæ¬\n\n\n# è¿è¡æ¨¡å¼\n\n\n# åç¹\n\nhbase-site.xml éç½®å¦ä¸ï¼\n\n<configuration>\n  <property>\n    <name>hbase.rootdir</name>\n    <value>hdfs://namenode.example.org:8020/hbase</value>\n  </property>\n  <property>\n    <name>hbase.cluster.distributed</name>\n    <value>false</value>\n  </property>\n</configuration>\n\n\n\n# åå¸å¼\n\nhbase-site.xm éç½®å¦ä¸ï¼\n\n<configuration>\n  <property>\n    <name>hbase.rootdir</name>\n    <value>hdfs://namenode.example.org:8020/hbase</value>\n  </property>\n  <property>\n    <name>hbase.cluster.distributed</name>\n    <value>true</value>\n  </property>\n  <property>\n    <name>hbase.zookeeper.quorum</name>\n    <value>node-a.example.com,node-b.example.com,node-c.example.com</value>\n  </property>\n</configuration>\n\n\n\n# å¼ç¨åå¼ç³\n\n\n# æ©å±éè¯»\n\n * apache hbase configuration",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"HBase å½ä»¤",frontmatter:{title:"HBase å½ä»¤",date:"2020-06-02T22:28:18.000Z",categories:["æ°æ®åº","åå¼æ°æ®åº","HBase"],tags:["å¤§æ°æ®","HBase"],permalink:"/pages/263c40/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/06.%E5%88%97%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93/01.HBase/22.HBase%E5%91%BD%E4%BB%A4.html",relativePath:"12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/22.HBaseå½ä»¤.md",key:"v-6479bc9f",path:"/pages/263c40/",headers:[{level:2,title:"åºæ¬å½ä»¤",slug:"åºæ¬å½ä»¤",normalizedTitle:"åºæ¬å½ä»¤",charIndex:160},{level:2,title:"DDL",slug:"ddl",normalizedTitle:"ddl",charIndex:269},{level:3,title:"åå»ºè¡¨",slug:"åå»ºè¡¨",normalizedTitle:"åå»ºè¡¨",charIndex:277},{level:3,title:"å¯ç¨ãç¦ç¨è¡¨",slug:"å¯ç¨ãç¦ç¨è¡¨",normalizedTitle:"å¯ç¨ãç¦ç¨è¡¨",charIndex:443},{level:3,title:"å é¤è¡¨",slug:"å é¤è¡¨",normalizedTitle:"å é¤è¡¨",charIndex:559},{level:3,title:"ä¿®æ¹è¡¨",slug:"ä¿®æ¹è¡¨",normalizedTitle:"ä¿®æ¹è¡¨",charIndex:611},{level:4,title:"æ·»å åæ",slug:"æ·»å åæ",normalizedTitle:"æ·»å åæ",charIndex:618},{level:4,title:"å é¤åæ",slug:"å é¤åæ",normalizedTitle:"å é¤åæ",charIndex:681},{level:4,title:"æ´æ¹åæå­å¨çæ¬çéå¶",slug:"æ´æ¹åæå­å¨çæ¬çéå¶",normalizedTitle:"æ´æ¹åæå­å¨çæ¬çéå¶",charIndex:803},{level:3,title:"æ¥çè¡¨",slug:"æ¥çè¡¨",normalizedTitle:"æ¥çè¡¨",charIndex:933},{level:2,title:"å¢å æ¹",slug:"å¢å æ¹",normalizedTitle:"å¢å æ¹",charIndex:1009},{level:3,title:"æå¥æ°æ®",slug:"æå¥æ°æ®",normalizedTitle:"æå¥æ°æ®",charIndex:1017},{level:3,title:"è·åæå®è¡ãåæãå",slug:"è·åæå®è¡ãåæãå",normalizedTitle:"è·åæå®è¡ãåæãå",charIndex:1715},{level:3,title:"å é¤æå®è¡ãå",slug:"å é¤æå®è¡ãå",normalizedTitle:"å é¤æå®è¡ãå",charIndex:1887},{level:2,title:"æ¥è¯¢",slug:"æ¥è¯¢",normalizedTitle:"æ¥è¯¢",charIndex:1991},{level:3,title:"get æ¥è¯¢",slug:"get-æ¥è¯¢",normalizedTitle:"get æ¥è¯¢",charIndex:2146},{level:3,title:"scan æ¥è¯¢",slug:"scan-æ¥è¯¢",normalizedTitle:"scan æ¥è¯¢",charIndex:2314},{level:4,title:"æ¥è¯¢æ´è¡¨æ°æ®",slug:"æ¥è¯¢æ´è¡¨æ°æ®",normalizedTitle:"æ¥è¯¢æ´è¡¨æ°æ®",charIndex:2325},{level:4,title:"æ¥è¯¢æå®åç°çæ°æ®",slug:"æ¥è¯¢æå®åç°çæ°æ®",normalizedTitle:"æ¥è¯¢æå®åç°çæ°æ®",charIndex:2349},{level:4,title:"æ¡ä»¶æ¥è¯¢",slug:"æ¡ä»¶æ¥è¯¢",normalizedTitle:"æ¡ä»¶æ¥è¯¢",charIndex:2403},{level:4,title:"æ¡ä»¶è¿æ»¤",slug:"æ¡ä»¶è¿æ»¤",normalizedTitle:"æ¡ä»¶è¿æ»¤",charIndex:2615},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:3273}],headersStr:"åºæ¬å½ä»¤ DDL åå»ºè¡¨ å¯ç¨ãç¦ç¨è¡¨ å é¤è¡¨ ä¿®æ¹è¡¨ æ·»å åæ å é¤åæ æ´æ¹åæå­å¨çæ¬çéå¶ æ¥çè¡¨ å¢å æ¹ æå¥æ°æ® è·åæå®è¡ãåæãå å é¤æå®è¡ãå æ¥è¯¢ get æ¥è¯¢ scan æ¥è¯¢ æ¥è¯¢æ´è¡¨æ°æ® æ¥è¯¢æå®åç°çæ°æ® æ¡ä»¶æ¥è¯¢ æ¡ä»¶è¿æ»¤ åèèµæ",content:"# HBase å½ä»¤\n\n> è¿å¥ HBase Shell æ§å¶å°ï¼./bin/hbase shell\n> \n> å¦ææ kerberos è®¤è¯ï¼éè¦äºåä½¿ç¨ç¸åºç keytab è¿è¡ä¸ä¸è®¤è¯ï¼ä½¿ç¨ kinit å½ä»¤ï¼ï¼è®¤è¯æåä¹ååä½¿ç¨ hbase shell è¿å¥å¯ä»¥ä½¿ç¨ whoami å½ä»¤å¯æ¥çå½åç¨æ·.\n\n\n# åºæ¬å½ä»¤\n\n * è·åå¸®å©ä¿¡æ¯ï¼help\n * è·åå½ä»¤çè¯¦ç»å¸®å©ä¿¡æ¯ï¼help 'status'\n * æ¥çæå¡å¨ç¶æï¼status\n * æ¥ççæ¬ä¿¡æ¯ï¼version\n * æ¥çå½åç»å½ç¨æ·ï¼whoami\n\n\n# DDL\n\n\n# åå»ºè¡¨\n\nãè¯­æ³ãcreate 'è¡¨åç§°','åæåç§° 1','åæåç§° 2','ååç§° N'\n\nãç¤ºä¾ã\n\n# åå»ºä¸å¼ åä¸º test çè¡¨ï¼columnFamliy1ãcolumnFamliy2 æ¯ table1 è¡¨çåæã\ncreate 'test','columnFamliy1','columnFamliy2'\n\n\n\n# å¯ç¨ãç¦ç¨è¡¨\n\n * å¯ç¨è¡¨ï¼enable 'test'\n * ç¦ç¨è¡¨ï¼disable 'test'\n * æ£æ¥è¡¨æ¯å¦è¢«å¯ç¨ï¼is_enabled 'test'\n * æ£æ¥è¡¨æ¯å¦è¢«ç¦ç¨ï¼is_disabled 'test'\n\n\n# å é¤è¡¨\n\næ³¨æï¼å é¤è¡¨åéè¦åç¦ç¨è¡¨\n\ndisable 'test'\ndrop 'test'\n\n\n\n# ä¿®æ¹è¡¨\n\n# æ·»å åæ\n\nå½ä»¤æ ¼å¼ï¼ alter 'è¡¨å', 'åæå'\n\nalter 'test', 'teacherInfo'\n\n\n# å é¤åæ\n\nå½ä»¤æ ¼å¼ï¼alter 'è¡¨å', {NAME => 'åæå', METHOD => 'delete'}\n\nalter 'test', {NAME => 'teacherInfo', METHOD => 'delete'}\n\n\n# æ´æ¹åæå­å¨çæ¬çéå¶\n\né»è®¤æåµä¸ï¼åæåªå­å¨ä¸ä¸ªçæ¬çæ°æ®ï¼å¦æéè¦å­å¨å¤ä¸ªçæ¬çæ°æ®ï¼åéè¦ä¿®æ¹åæçå±æ§ãä¿®æ¹åå¯éè¿ desc å½ä»¤æ¥çã\n\nalter 'test',{NAME=>'columnFamliy1',VERSIONS=>3}\n\n\n\n# æ¥çè¡¨\n\n * æ¥çææè¡¨ï¼list\n * æ¥çè¡¨çè¯¦ç»ä¿¡æ¯ï¼describe 'test'\n * æ£æ¥è¡¨æ¯å¦å­å¨ï¼exists 'test'\n\n\n# å¢å æ¹\n\n\n# æå¥æ°æ®\n\nå½ä»¤æ ¼å¼ï¼put 'è¡¨å', 'è¡é®','åæ:å','å¼'\n\næ³¨æï¼å¦ææ°å¢æ°æ®çè¡é®å¼ãåæåãååä¸åææ°æ®å®å¨ç¸åï¼åç¸å½äºæ´æ°æä½\n\nput 'test', 'rowkey1', 'columnFamliy1:a', 'valueA'\nput 'test', 'rowkey1', 'columnFamliy1:b', 'valueB'\nput 'test', 'rowkey1', 'columnFamliy1:c', 'valueC'\n\nput 'test', 'rowkey2', 'columnFamliy1:a', 'valueA'\nput 'test', 'rowkey2', 'columnFamliy1:b', 'valueB'\nput 'test', 'rowkey2', 'columnFamliy1:c', 'valueC'\n\nput 'test', 'rowkey3', 'columnFamliy1:a', 'valueA'\nput 'test', 'rowkey3', 'columnFamliy1:b', 'valueB'\nput 'test', 'rowkey3', 'columnFamliy1:c', 'valueC'\n\nput 'test', 'rowkey1', 'columnFamliy2:a', 'valueA'\nput 'test', 'rowkey1', 'columnFamliy2:b', 'valueB'\nput 'test', 'rowkey1', 'columnFamliy2:c', 'valueC'\n\n\n\n# è·åæå®è¡ãåæãå\n\n * è·åæå®è¡ä¸­ææåçæ°æ®ä¿¡æ¯ï¼get 'test','rowkey2'\n * è·åæå®è¡ä¸­æå®åæä¸ææåçæ°æ®ä¿¡æ¯ï¼get 'test','rowkey2','columnFamliy1'\n * è·åæå®è¡ä¸­æå®åçæ°æ®ä¿¡æ¯ï¼get 'test','rowkey2','columnFamliy1:a'\n\n\n# å é¤æå®è¡ãå\n\n * å é¤æå®è¡ï¼delete 'test','rowkey2'\n * å é¤æå®è¡ä¸­æå®åçæ°æ®ï¼delete 'test','rowkey2','columnFamliy1:a'\n\n\n# æ¥è¯¢\n\nhbase ä¸­è®¿é®æ°æ®æä¸¤ç§åºæ¬çæ¹å¼ï¼\n\n * ææå® rowkey è·åæ°æ®ï¼get æ¹æ³ï¼\n * ææå®æ¡ä»¶è·åæ°æ®ï¼scan æ¹æ³ã\n\nscan å¯ä»¥è®¾ç½® begin å end åæ°æ¥è®¿é®ä¸ä¸ªèå´åææçæ°æ®ãget æ¬è´¨ä¸å°±æ¯ begin å end ç¸ç­çä¸ç§ç¹æ®ç scanã\n\n\n# get æ¥è¯¢\n\n * è·åæå®è¡ä¸­ææåçæ°æ®ä¿¡æ¯ï¼get 'test','rowkey2'\n * è·åæå®è¡ä¸­æå®åæä¸ææåçæ°æ®ä¿¡æ¯ï¼get 'test','rowkey2','columnFamliy1'\n * è·åæå®è¡ä¸­æå®åçæ°æ®ä¿¡æ¯ï¼get 'test','rowkey2','columnFamliy1:a'\n\n\n# scan æ¥è¯¢\n\n# æ¥è¯¢æ´è¡¨æ°æ®\n\nscan 'test'\n\n\n# æ¥è¯¢æå®åç°çæ°æ®\n\nscan 'test', {COLUMN=>'columnFamliy1'}\n\n\n# æ¡ä»¶æ¥è¯¢\n\n# æ¥è¯¢æå®åçæ°æ®\nscan 'test', {COLUMNS=> 'columnFamliy1:a'}\n\n\né¤äºå ï¼COLUMNSï¼ ä¿®é¥°è¯å¤ï¼HBase è¿æ¯æ Limitï¼éå¶æ¥è¯¢ç»æè¡æ°ï¼ï¼STARTROWï¼ROWKEY èµ·å§è¡ï¼ä¼åæ ¹æ®è¿ä¸ª key å®ä½å° regionï¼åååæ«æï¼ãSTOPROW(ç»æè¡)ãTIMERANGEï¼éå®æ¶é´æ³èå´ï¼ãVERSIONSï¼çæ¬æ°ï¼ãå FILTERï¼ææ¡ä»¶è¿æ»¤è¡ï¼ç­ã\n\nå¦ä¸ä»£è¡¨ä» rowkey2 è¿ä¸ª rowkey å¼å§ï¼æ¥æ¾ä¸ä¸¤ä¸ªè¡çææ° 3 ä¸ªçæ¬ç name åçæ°æ®ï¼\n\nscan 'test', {COLUMNS=> 'columnFamliy1:a',STARTROW => 'rowkey2',STOPROW => 'rowkey3',LIMIT=>2, VERSIONS=>3}\n\n\n# æ¡ä»¶è¿æ»¤\n\nFilter å¯ä»¥è®¾å®ä¸ç³»åæ¡ä»¶æ¥è¿è¡è¿æ»¤ãå¦æä»¬è¦æ¥è¯¢å¼ç­äº 24 çæææ°æ®ï¼\n\nscan 'test', FILTER=>\"ValueFilter(=,'binary:24')\"\n\n\nå¼åå« valueA çæææ°æ®ï¼\n\nscan 'test', FILTER=>\"ValueFilter(=,'substring:valueA')\"\n\n\nååä¸­çåç¼ä¸º b çï¼\n\nscan 'test', FILTER=>\"ColumnPrefixFilter('b')\"\n\n\nFILTER ä¸­æ¯æå¤ä¸ªè¿æ»¤æ¡ä»¶éè¿æ¬å·ãAND å OR è¿è¡ç»åï¼\n\n# ååä¸­çåç¼ä¸º b ä¸åå¼ä¸­åå«1998çæ°æ®\nscan 'test', FILTER=>\"ColumnPrefixFilter('b') AND ValueFilter ValueFilter(=,'substring:A')\"\n\n\nPrefixFilter ç¨äºå¯¹ Rowkey çåç¼è¿è¡å¤æ­ï¼\n\nscan 'test', FILTER=>\"PrefixFilter('wr')\"\n\n\n\n# åèèµæ\n\n * Hbase å¸¸ç¨ Shell å½ä»¤",normalizedContent:"# hbase å½ä»¤\n\n> è¿å¥ hbase shell æ§å¶å°ï¼./bin/hbase shell\n> \n> å¦ææ kerberos è®¤è¯ï¼éè¦äºåä½¿ç¨ç¸åºç keytab è¿è¡ä¸ä¸è®¤è¯ï¼ä½¿ç¨ kinit å½ä»¤ï¼ï¼è®¤è¯æåä¹ååä½¿ç¨ hbase shell è¿å¥å¯ä»¥ä½¿ç¨ whoami å½ä»¤å¯æ¥çå½åç¨æ·.\n\n\n# åºæ¬å½ä»¤\n\n * è·åå¸®å©ä¿¡æ¯ï¼help\n * è·åå½ä»¤çè¯¦ç»å¸®å©ä¿¡æ¯ï¼help 'status'\n * æ¥çæå¡å¨ç¶æï¼status\n * æ¥ççæ¬ä¿¡æ¯ï¼version\n * æ¥çå½åç»å½ç¨æ·ï¼whoami\n\n\n# ddl\n\n\n# åå»ºè¡¨\n\nãè¯­æ³ãcreate 'è¡¨åç§°','åæåç§° 1','åæåç§° 2','ååç§° n'\n\nãç¤ºä¾ã\n\n# åå»ºä¸å¼ åä¸º test çè¡¨ï¼columnfamliy1ãcolumnfamliy2 æ¯ table1 è¡¨çåæã\ncreate 'test','columnfamliy1','columnfamliy2'\n\n\n\n# å¯ç¨ãç¦ç¨è¡¨\n\n * å¯ç¨è¡¨ï¼enable 'test'\n * ç¦ç¨è¡¨ï¼disable 'test'\n * æ£æ¥è¡¨æ¯å¦è¢«å¯ç¨ï¼is_enabled 'test'\n * æ£æ¥è¡¨æ¯å¦è¢«ç¦ç¨ï¼is_disabled 'test'\n\n\n# å é¤è¡¨\n\næ³¨æï¼å é¤è¡¨åéè¦åç¦ç¨è¡¨\n\ndisable 'test'\ndrop 'test'\n\n\n\n# ä¿®æ¹è¡¨\n\n# æ·»å åæ\n\nå½ä»¤æ ¼å¼ï¼ alter 'è¡¨å', 'åæå'\n\nalter 'test', 'teacherinfo'\n\n\n# å é¤åæ\n\nå½ä»¤æ ¼å¼ï¼alter 'è¡¨å', {name => 'åæå', method => 'delete'}\n\nalter 'test', {name => 'teacherinfo', method => 'delete'}\n\n\n# æ´æ¹åæå­å¨çæ¬çéå¶\n\né»è®¤æåµä¸ï¼åæåªå­å¨ä¸ä¸ªçæ¬çæ°æ®ï¼å¦æéè¦å­å¨å¤ä¸ªçæ¬çæ°æ®ï¼åéè¦ä¿®æ¹åæçå±æ§ãä¿®æ¹åå¯éè¿ desc å½ä»¤æ¥çã\n\nalter 'test',{name=>'columnfamliy1',versions=>3}\n\n\n\n# æ¥çè¡¨\n\n * æ¥çææè¡¨ï¼list\n * æ¥çè¡¨çè¯¦ç»ä¿¡æ¯ï¼describe 'test'\n * æ£æ¥è¡¨æ¯å¦å­å¨ï¼exists 'test'\n\n\n# å¢å æ¹\n\n\n# æå¥æ°æ®\n\nå½ä»¤æ ¼å¼ï¼put 'è¡¨å', 'è¡é®','åæ:å','å¼'\n\næ³¨æï¼å¦ææ°å¢æ°æ®çè¡é®å¼ãåæåãååä¸åææ°æ®å®å¨ç¸åï¼åç¸å½äºæ´æ°æä½\n\nput 'test', 'rowkey1', 'columnfamliy1:a', 'valuea'\nput 'test', 'rowkey1', 'columnfamliy1:b', 'valueb'\nput 'test', 'rowkey1', 'columnfamliy1:c', 'valuec'\n\nput 'test', 'rowkey2', 'columnfamliy1:a', 'valuea'\nput 'test', 'rowkey2', 'columnfamliy1:b', 'valueb'\nput 'test', 'rowkey2', 'columnfamliy1:c', 'valuec'\n\nput 'test', 'rowkey3', 'columnfamliy1:a', 'valuea'\nput 'test', 'rowkey3', 'columnfamliy1:b', 'valueb'\nput 'test', 'rowkey3', 'columnfamliy1:c', 'valuec'\n\nput 'test', 'rowkey1', 'columnfamliy2:a', 'valuea'\nput 'test', 'rowkey1', 'columnfamliy2:b', 'valueb'\nput 'test', 'rowkey1', 'columnfamliy2:c', 'valuec'\n\n\n\n# è·åæå®è¡ãåæãå\n\n * è·åæå®è¡ä¸­ææåçæ°æ®ä¿¡æ¯ï¼get 'test','rowkey2'\n * è·åæå®è¡ä¸­æå®åæä¸ææåçæ°æ®ä¿¡æ¯ï¼get 'test','rowkey2','columnfamliy1'\n * è·åæå®è¡ä¸­æå®åçæ°æ®ä¿¡æ¯ï¼get 'test','rowkey2','columnfamliy1:a'\n\n\n# å é¤æå®è¡ãå\n\n * å é¤æå®è¡ï¼delete 'test','rowkey2'\n * å é¤æå®è¡ä¸­æå®åçæ°æ®ï¼delete 'test','rowkey2','columnfamliy1:a'\n\n\n# æ¥è¯¢\n\nhbase ä¸­è®¿é®æ°æ®æä¸¤ç§åºæ¬çæ¹å¼ï¼\n\n * ææå® rowkey è·åæ°æ®ï¼get æ¹æ³ï¼\n * ææå®æ¡ä»¶è·åæ°æ®ï¼scan æ¹æ³ã\n\nscan å¯ä»¥è®¾ç½® begin å end åæ°æ¥è®¿é®ä¸ä¸ªèå´åææçæ°æ®ãget æ¬è´¨ä¸å°±æ¯ begin å end ç¸ç­çä¸ç§ç¹æ®ç scanã\n\n\n# get æ¥è¯¢\n\n * è·åæå®è¡ä¸­ææåçæ°æ®ä¿¡æ¯ï¼get 'test','rowkey2'\n * è·åæå®è¡ä¸­æå®åæä¸ææåçæ°æ®ä¿¡æ¯ï¼get 'test','rowkey2','columnfamliy1'\n * è·åæå®è¡ä¸­æå®åçæ°æ®ä¿¡æ¯ï¼get 'test','rowkey2','columnfamliy1:a'\n\n\n# scan æ¥è¯¢\n\n# æ¥è¯¢æ´è¡¨æ°æ®\n\nscan 'test'\n\n\n# æ¥è¯¢æå®åç°çæ°æ®\n\nscan 'test', {column=>'columnfamliy1'}\n\n\n# æ¡ä»¶æ¥è¯¢\n\n# æ¥è¯¢æå®åçæ°æ®\nscan 'test', {columns=> 'columnfamliy1:a'}\n\n\né¤äºå ï¼columnsï¼ ä¿®é¥°è¯å¤ï¼hbase è¿æ¯æ limitï¼éå¶æ¥è¯¢ç»æè¡æ°ï¼ï¼startrowï¼rowkey èµ·å§è¡ï¼ä¼åæ ¹æ®è¿ä¸ª key å®ä½å° regionï¼åååæ«æï¼ãstoprow(ç»æè¡)ãtimerangeï¼éå®æ¶é´æ³èå´ï¼ãversionsï¼çæ¬æ°ï¼ãå filterï¼ææ¡ä»¶è¿æ»¤è¡ï¼ç­ã\n\nå¦ä¸ä»£è¡¨ä» rowkey2 è¿ä¸ª rowkey å¼å§ï¼æ¥æ¾ä¸ä¸¤ä¸ªè¡çææ° 3 ä¸ªçæ¬ç name åçæ°æ®ï¼\n\nscan 'test', {columns=> 'columnfamliy1:a',startrow => 'rowkey2',stoprow => 'rowkey3',limit=>2, versions=>3}\n\n\n# æ¡ä»¶è¿æ»¤\n\nfilter å¯ä»¥è®¾å®ä¸ç³»åæ¡ä»¶æ¥è¿è¡è¿æ»¤ãå¦æä»¬è¦æ¥è¯¢å¼ç­äº 24 çæææ°æ®ï¼\n\nscan 'test', filter=>\"valuefilter(=,'binary:24')\"\n\n\nå¼åå« valuea çæææ°æ®ï¼\n\nscan 'test', filter=>\"valuefilter(=,'substring:valuea')\"\n\n\nååä¸­çåç¼ä¸º b çï¼\n\nscan 'test', filter=>\"columnprefixfilter('b')\"\n\n\nfilter ä¸­æ¯æå¤ä¸ªè¿æ»¤æ¡ä»¶éè¿æ¬å·ãand å or è¿è¡ç»åï¼\n\n# ååä¸­çåç¼ä¸º b ä¸åå¼ä¸­åå«1998çæ°æ®\nscan 'test', filter=>\"columnprefixfilter('b') and valuefilter valuefilter(=,'substring:a')\"\n\n\nprefixfilter ç¨äºå¯¹ rowkey çåç¼è¿è¡å¤æ­ï¼\n\nscan 'test', filter=>\"prefixfilter('wr')\"\n\n\n\n# åèèµæ\n\n * hbase å¸¸ç¨ shell å½ä»¤",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"HBase æç¨",frontmatter:{title:"HBase æç¨",date:"2020-09-09T17:53:08.000Z",categories:["æ°æ®åº","åå¼æ°æ®åº","HBase"],tags:["å¤§æ°æ®","HBase"],permalink:"/pages/417be6/",hidden:!0},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/06.%E5%88%97%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93/01.HBase/",relativePath:"12.æ°æ®åº/06.åå¼æ°æ®åº/01.HBase/README.md",key:"v-2cf1626a",path:"/pages/417be6/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:15},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:236},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:481}],headersStr:"ð åå®¹ ð èµæ ðª ä¼ é",content:"# HBase æç¨\n\n\n# ð åå®¹\n\n * HBase å¿«éå¥é¨\n * HBase æ°æ®æ¨¡å\n * HBase Schema è®¾è®¡\n * HBase æ¶æ\n * HBase Java API åºç¡ç¹æ§\n * HBase Java API é«çº§ç¹æ§ä¹è¿æ»¤å¨\n * HBase Java API é«çº§ç¹æ§ä¹åå¤çå¨\n * HBase Java API å¶ä»é«çº§ç¹æ§\n * HBase è¿ç»´\n * HBase å½ä»¤\n * HBase éç½®\n * HBase ç¾å¤\n\n\n# ð èµæ\n\n * å®æ¹\n   * HBase å®ç½\n   * HBase å®æ¹ææ¡£\n   * HBase å®æ¹ææ¡£ä¸­æç\n   * HBase API\n * æç¨\n   * BigData-Notes\n * ä¹¦ç±\n   * ãHadoop æå¨æåï¼ç¬¬åçï¼ã\n * æç« \n   * Bigtable: A Distributed Storage System for Structured Data\n   * Intro to HBase\n   * æ·±å¥çè§£ Hbase æ¶æ\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç IT ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",normalizedContent:"# hbase æç¨\n\n\n# ð åå®¹\n\n * hbase å¿«éå¥é¨\n * hbase æ°æ®æ¨¡å\n * hbase schema è®¾è®¡\n * hbase æ¶æ\n * hbase java api åºç¡ç¹æ§\n * hbase java api é«çº§ç¹æ§ä¹è¿æ»¤å¨\n * hbase java api é«çº§ç¹æ§ä¹åå¤çå¨\n * hbase java api å¶ä»é«çº§ç¹æ§\n * hbase è¿ç»´\n * hbase å½ä»¤\n * hbase éç½®\n * hbase ç¾å¤\n\n\n# ð èµæ\n\n * å®æ¹\n   * hbase å®ç½\n   * hbase å®æ¹ææ¡£\n   * hbase å®æ¹ææ¡£ä¸­æç\n   * hbase api\n * æç¨\n   * bigdata-notes\n * ä¹¦ç±\n   * ãhadoop æå¨æåï¼ç¬¬åçï¼ã\n * æç« \n   * bigtable: a distributed storage system for structured data\n   * intro to hbase\n   * æ·±å¥çè§£ hbase æ¶æ\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç it ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Cassandra",frontmatter:{title:"Cassandra",date:"2019-08-22T09:02:39.000Z",categories:["æ°æ®åº","åå¼æ°æ®åº"],tags:["æ°æ®åº","åå¼æ°æ®åº","Cassandra"],permalink:"/pages/ca3ca5/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/06.%E5%88%97%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93/02.Cassandra.html",relativePath:"12.æ°æ®åº/06.åå¼æ°æ®åº/02.Cassandra.md",key:"v-1c459100",path:"/pages/ca3ca5/",headers:[{level:2,title:"Quick Start",slug:"quick-start",normalizedTitle:"quick start",charIndex:81},{level:3,title:"å®è£",slug:"å®è£",normalizedTitle:"å®è£",charIndex:97},{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:142},{level:3,title:"ç¹æ§",slug:"ç¹æ§",normalizedTitle:"ç¹æ§",charIndex:220},{level:4,title:"ä¸»è¦ç¹æ§",slug:"ä¸»è¦ç¹æ§",normalizedTitle:"ä¸»è¦ç¹æ§",charIndex:226},{level:4,title:"çªåºç¹æ§",slug:"çªåºç¹æ§",normalizedTitle:"çªåºç¹æ§",charIndex:435},{level:2,title:"æ´å¤åå®¹",slug:"æ´å¤åå®¹",normalizedTitle:"æ´å¤åå®¹",charIndex:810},{level:2,title:"ðª ä¼ éé¨",slug:"ä¼ éé¨",normalizedTitle:"ðª ä¼ éé¨",charIndex:856}],headersStr:"Quick Start å®è£ ç®ä» ç¹æ§ ä¸»è¦ç¹æ§ çªåºç¹æ§ æ´å¤åå®¹ ðª ä¼ éé¨",content:"# Cassandra\n\n> Apache Cassandra æ¯ä¸ä¸ªé«åº¦å¯æ©å±çååºè¡å­å¨ãè¡è¢«ç»ç»æå·ææéä¸»é®çè¡¨ã\n> \n> ææ°çæ¬ï¼v4.0\n\n\n# Quick Start\n\n\n# å®è£\n\n> åå³æ¡ä»¶\n> \n>  * JDK8+\n>  * Python 2.7\n\n\n# ç®ä»\n\nApache Cassandra æ¯ä¸å¥å¼æºåå¸å¼ Key-Value å­å¨ç³»ç»ãå®æåç± Facebook å¼åï¼ç¨äºå¨å­ç¹å«å¤§çæ°æ®ã\n\n\n# ç¹æ§\n\n# ä¸»è¦ç¹æ§\n\n * åå¸å¼\n * åºäº column çç»æå\n * é«ä¼¸å±æ§\n\nCassandra çä¸»è¦ç¹ç¹å°±æ¯å®ä¸æ¯ä¸ä¸ªæ°æ®åºï¼èæ¯ç±ä¸å æ°æ®åºèç¹å±åææçä¸ä¸ªåå¸å¼ç½ç»æå¡ï¼å¯¹ Cassandra çä¸ä¸ªåæä½ï¼ä¼è¢«å¤å¶å°å¶ä»èç¹ä¸å»ï¼å¯¹ Cassandra çè¯»æä½ï¼ä¹ä¼è¢«è·¯ç±å°æä¸ªèç¹ä¸é¢å»è¯»åãå¯¹äºä¸ä¸ª Cassandra ç¾¤éæ¥è¯´ï¼æ©å±æ§è½ æ¯æ¯è¾ç®åçäºæï¼åªç®¡å¨ç¾¤ééé¢æ·»å èç¹å°±å¯ä»¥äºã\n\n# çªåºç¹æ§\n\n * æ¨¡å¼çµæ´» - ä½¿ç¨ Cassandraï¼åææ¡£å­å¨ï¼ä¸å¿æåè§£å³è®°å½ä¸­çå­æ®µãä½ å¯ä»¥å¨ç³»ç»è¿è¡æ¶éæçæ·»å æç§»é¤å­æ®µãè¿æ¯ä¸ä¸ªæäººçæçæåï¼ç¹å«æ¯å¨å¤§åé¨ç½²ä¸ã\n * çæ­£çå¯æ©å±æ§ - Cassandra æ¯çº¯ç²¹æä¹ä¸çæ°´å¹³æ©å±ãä¸ºç»éç¾¤æ·»å æ´å¤å®¹éï¼å¯ä»¥æåå¦ä¸å°çµèãä½ ä¸å¿éå¯ä»»ä½è¿ç¨ï¼æ¹ååºç¨æ¥è¯¢ï¼ææå¨è¿ç§»ä»»ä½æ°æ®ã\n * å¤æ°æ®ä¸­å¿è¯å« - ä½ å¯ä»¥è°æ´ä½ çèç¹å¸å±æ¥é¿åæä¸ä¸ªæ°æ®ä¸­å¿èµ·ç«ï¼ä¸ä¸ªå¤ç¨çæ°æ®ä¸­å¿å°è³å°ææ¯æ¡è®°å½çå®å¨å¤å¶ã\n * èå´æ¥è¯¢ - å¦æä½ ä¸åæ¬¢å¨é¨çé®å¼æ¥è¯¢ï¼åå¯ä»¥è®¾ç½®é®çèå´æ¥æ¥è¯¢ã\n * åè¡¨æ°æ®ç»æ - å¨æ··åæ¨¡å¼å¯ä»¥å°è¶çº§åæ·»å å° 5 ç»´ãå¯¹äºæ¯ä¸ªç¨æ·çç´¢å¼ï¼è¿æ¯éå¸¸æ¹ä¾¿çã\n * åå¸å¼åæä½ - æå¯ä»¥å¨ä»»ä½å°æ¹ä»»ä½æ¶é´éä¸­è¯»æåä»»ä½æ°æ®ãå¹¶ä¸ä¸ä¼æä»»ä½åç¹å¤±è´¥ã\n\n\n# æ´å¤åå®¹\n\n * Cassandra å®ç½\n * Cassandra Github\n\n\n# ðª ä¼ éé¨\n\n| éæçåå®¢ | db-tutorial é¦é¡µ |",normalizedContent:"# cassandra\n\n> apache cassandra æ¯ä¸ä¸ªé«åº¦å¯æ©å±çååºè¡å­å¨ãè¡è¢«ç»ç»æå·ææéä¸»é®çè¡¨ã\n> \n> ææ°çæ¬ï¼v4.0\n\n\n# quick start\n\n\n# å®è£\n\n> åå³æ¡ä»¶\n> \n>  * jdk8+\n>  * python 2.7\n\n\n# ç®ä»\n\napache cassandra æ¯ä¸å¥å¼æºåå¸å¼ key-value å­å¨ç³»ç»ãå®æåç± facebook å¼åï¼ç¨äºå¨å­ç¹å«å¤§çæ°æ®ã\n\n\n# ç¹æ§\n\n# ä¸»è¦ç¹æ§\n\n * åå¸å¼\n * åºäº column çç»æå\n * é«ä¼¸å±æ§\n\ncassandra çä¸»è¦ç¹ç¹å°±æ¯å®ä¸æ¯ä¸ä¸ªæ°æ®åºï¼èæ¯ç±ä¸å æ°æ®åºèç¹å±åææçä¸ä¸ªåå¸å¼ç½ç»æå¡ï¼å¯¹ cassandra çä¸ä¸ªåæä½ï¼ä¼è¢«å¤å¶å°å¶ä»èç¹ä¸å»ï¼å¯¹ cassandra çè¯»æä½ï¼ä¹ä¼è¢«è·¯ç±å°æä¸ªèç¹ä¸é¢å»è¯»åãå¯¹äºä¸ä¸ª cassandra ç¾¤éæ¥è¯´ï¼æ©å±æ§è½ æ¯æ¯è¾ç®åçäºæï¼åªç®¡å¨ç¾¤ééé¢æ·»å èç¹å°±å¯ä»¥äºã\n\n# çªåºç¹æ§\n\n * æ¨¡å¼çµæ´» - ä½¿ç¨ cassandraï¼åææ¡£å­å¨ï¼ä¸å¿æåè§£å³è®°å½ä¸­çå­æ®µãä½ å¯ä»¥å¨ç³»ç»è¿è¡æ¶éæçæ·»å æç§»é¤å­æ®µãè¿æ¯ä¸ä¸ªæäººçæçæåï¼ç¹å«æ¯å¨å¤§åé¨ç½²ä¸ã\n * çæ­£çå¯æ©å±æ§ - cassandra æ¯çº¯ç²¹æä¹ä¸çæ°´å¹³æ©å±ãä¸ºç»éç¾¤æ·»å æ´å¤å®¹éï¼å¯ä»¥æåå¦ä¸å°çµèãä½ ä¸å¿éå¯ä»»ä½è¿ç¨ï¼æ¹ååºç¨æ¥è¯¢ï¼ææå¨è¿ç§»ä»»ä½æ°æ®ã\n * å¤æ°æ®ä¸­å¿è¯å« - ä½ å¯ä»¥è°æ´ä½ çèç¹å¸å±æ¥é¿åæä¸ä¸ªæ°æ®ä¸­å¿èµ·ç«ï¼ä¸ä¸ªå¤ç¨çæ°æ®ä¸­å¿å°è³å°ææ¯æ¡è®°å½çå®å¨å¤å¶ã\n * èå´æ¥è¯¢ - å¦æä½ ä¸åæ¬¢å¨é¨çé®å¼æ¥è¯¢ï¼åå¯ä»¥è®¾ç½®é®çèå´æ¥æ¥è¯¢ã\n * åè¡¨æ°æ®ç»æ - å¨æ··åæ¨¡å¼å¯ä»¥å°è¶çº§åæ·»å å° 5 ç»´ãå¯¹äºæ¯ä¸ªç¨æ·çç´¢å¼ï¼è¿æ¯éå¸¸æ¹ä¾¿çã\n * åå¸å¼åæä½ - æå¯ä»¥å¨ä»»ä½å°æ¹ä»»ä½æ¶é´éä¸­è¯»æåä»»ä½æ°æ®ãå¹¶ä¸ä¸ä¼æä»»ä½åç¹å¤±è´¥ã\n\n\n# æ´å¤åå®¹\n\n * cassandra å®ç½\n * cassandra github\n\n\n# ðª ä¼ éé¨\n\n| éæçåå®¢ | db-tutorial é¦é¡µ |",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Elasticsearch é¢è¯æ»ç»",frontmatter:{title:"Elasticsearch é¢è¯æ»ç»",date:"2020-06-16T07:10:44.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","é¢è¯"],permalink:"/pages/0cb563/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/01.Elasticsearch%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/01.Elasticsearché¢è¯æ»ç».md",key:"v-04b75150",path:"/pages/0cb563/",headers:[{level:2,title:"éç¾¤é¨ç½²",slug:"éç¾¤é¨ç½²",normalizedTitle:"éç¾¤é¨ç½²",charIndex:25},{level:2,title:"æ§è½ä¼å",slug:"æ§è½ä¼å",normalizedTitle:"æ§è½ä¼å",charIndex:127},{level:3,title:"filesystem cache",slug:"filesystem-cache",normalizedTitle:"filesystem cache",charIndex:136},{level:3,title:"æ°æ®é¢ç­",slug:"æ°æ®é¢ç­",normalizedTitle:"æ°æ®é¢ç­",charIndex:1707},{level:3,title:"å·ç­åç¦»",slug:"å·ç­åç¦»",normalizedTitle:"å·ç­åç¦»",charIndex:2177},{level:3,title:"document æ¨¡åè®¾è®¡",slug:"document-æ¨¡åè®¾è®¡",normalizedTitle:"document æ¨¡åè®¾è®¡",charIndex:2652},{level:3,title:"åé¡µæ§è½ä¼å",slug:"åé¡µæ§è½ä¼å",normalizedTitle:"åé¡µæ§è½ä¼å",charIndex:3002},{level:4,title:"ä¸åè®¸æ·±åº¦åé¡µï¼é»è®¤æ·±åº¦åé¡µæ§è½å¾å·®ï¼",slug:"ä¸åè®¸æ·±åº¦åé¡µ-é»è®¤æ·±åº¦åé¡µæ§è½å¾å·®",normalizedTitle:"ä¸åè®¸æ·±åº¦åé¡µï¼é»è®¤æ·±åº¦åé¡µæ§è½å¾å·®ï¼",charIndex:3493},{level:4,title:"ç±»ä¼¼äº app éçæ¨èååä¸æ­ä¸æåºæ¥ä¸é¡µä¸é¡µç",slug:"ç±»ä¼¼äº-app-éçæ¨èååä¸æ­ä¸æåºæ¥ä¸é¡µä¸é¡µç",normalizedTitle:"ç±»ä¼¼äº app éçæ¨èååä¸æ­ä¸æåºæ¥ä¸é¡µä¸é¡µç",charIndex:3551},{level:2,title:"å·¥ä½åç",slug:"å·¥ä½åç",normalizedTitle:"å·¥ä½åç",charIndex:4678},{level:3,title:"es åæ°æ®è¿ç¨",slug:"es-åæ°æ®è¿ç¨",normalizedTitle:"es åæ°æ®è¿ç¨",charIndex:4687},{level:3,title:"es è¯»æ°æ®è¿ç¨",slug:"es-è¯»æ°æ®è¿ç¨",normalizedTitle:"es è¯»æ°æ®è¿ç¨",charIndex:4966},{level:3,title:"es æç´¢æ°æ®è¿ç¨",slug:"es-æç´¢æ°æ®è¿ç¨",normalizedTitle:"es æç´¢æ°æ®è¿ç¨",charIndex:5311},{level:3,title:"åæ°æ®åºå±åç",slug:"åæ°æ®åºå±åç",normalizedTitle:"åæ°æ®åºå±åç",charIndex:5805},{level:3,title:"å é¤/æ´æ°æ°æ®åºå±åç",slug:"å é¤-æ´æ°æ°æ®åºå±åç",normalizedTitle:"å é¤/æ´æ°æ°æ®åºå±åç",charIndex:8075},{level:3,title:"åºå± lucene",slug:"åºå±-lucene",normalizedTitle:"åºå± lucene",charIndex:8520},{level:3,title:"åæç´¢å¼",slug:"åæç´¢å¼",normalizedTitle:"åæç´¢å¼",charIndex:4542},{level:2,title:"elasticsearch çåæç´¢å¼æ¯ä»ä¹",slug:"elasticsearch-çåæç´¢å¼æ¯ä»ä¹",normalizedTitle:"elasticsearch çåæç´¢å¼æ¯ä»ä¹",charIndex:9624},{level:2,title:"3ãelasticsearch ç´¢å¼æ°æ®å¤äºæä¹åï¼å¦ä½è°ä¼ï¼é¨ç½²",slug:"_3ãelasticsearch-ç´¢å¼æ°æ®å¤äºæä¹å-å¦ä½è°ä¼-é¨ç½²",normalizedTitle:"3ãelasticsearch ç´¢å¼æ°æ®å¤äºæä¹åï¼å¦ä½è°ä¼ï¼é¨ç½²",charIndex:10036},{level:2,title:"4ãelasticsearch æ¯å¦ä½å®ç° master éä¸¾ç",slug:"_4ãelasticsearch-æ¯å¦ä½å®ç°-master-éä¸¾ç",normalizedTitle:"4ãelasticsearch æ¯å¦ä½å®ç° master éä¸¾ç",charIndex:10603},{level:2,title:"è¯¦ç»æè¿°ä¸ä¸ Elasticsearch ç´¢å¼ææ¡£çè¿ç¨",slug:"è¯¦ç»æè¿°ä¸ä¸-elasticsearch-ç´¢å¼ææ¡£çè¿ç¨",normalizedTitle:"è¯¦ç»æè¿°ä¸ä¸ elasticsearch ç´¢å¼ææ¡£çè¿ç¨",charIndex:11110},{level:2,title:"è¯¦ç»æè¿°ä¸ä¸ Elasticsearch æç´¢çè¿ç¨ï¼",slug:"è¯¦ç»æè¿°ä¸ä¸-elasticsearch-æç´¢çè¿ç¨",normalizedTitle:"è¯¦ç»æè¿°ä¸ä¸ elasticsearch æç´¢çè¿ç¨ï¼",charIndex:11636},{level:2,title:"Elasticsearch å¨é¨ç½²æ¶ï¼å¯¹ Linux çè®¾ç½®æåªäºä¼åæ¹æ³",slug:"elasticsearch-å¨é¨ç½²æ¶-å¯¹-linux-çè®¾ç½®æåªäºä¼åæ¹æ³",normalizedTitle:"elasticsearch å¨é¨ç½²æ¶ï¼å¯¹ linux çè®¾ç½®æåªäºä¼åæ¹æ³",charIndex:11931},{level:2,title:"lucence åé¨ç»ææ¯ä»ä¹ï¼",slug:"lucence-åé¨ç»ææ¯ä»ä¹",normalizedTitle:"lucence åé¨ç»ææ¯ä»ä¹ï¼",charIndex:12136},{level:2,title:"Elasticsearch æ¯å¦ä½å®ç° Master éä¸¾çï¼",slug:"elasticsearch-æ¯å¦ä½å®ç°-master-éä¸¾ç",normalizedTitle:"elasticsearch æ¯å¦ä½å®ç° master éä¸¾çï¼",charIndex:12237},{level:2,title:"10ãElasticsearch ä¸­çèç¹ï¼æ¯å¦å± 20 ä¸ªï¼ï¼å¶ä¸­ç 10 ä¸ª",slug:"_10ãelasticsearch-ä¸­çèç¹-æ¯å¦å±-20-ä¸ª-å¶ä¸­ç-10-ä¸ª",normalizedTitle:"10ãelasticsearch ä¸­çèç¹ï¼æ¯å¦å± 20 ä¸ªï¼ï¼å¶ä¸­ç 10 ä¸ª",charIndex:12659},{level:2,title:"å®¢æ·ç«¯å¨åéç¾¤è¿æ¥æ¶ï¼å¦ä½éæ©ç¹å®çèç¹æ§è¡è¯·æ±çï¼",slug:"å®¢æ·ç«¯å¨åéç¾¤è¿æ¥æ¶-å¦ä½éæ©ç¹å®çèç¹æ§è¡è¯·æ±ç",normalizedTitle:"å®¢æ·ç«¯å¨åéç¾¤è¿æ¥æ¶ï¼å¦ä½éæ©ç¹å®çèç¹æ§è¡è¯·æ±çï¼",charIndex:12897},{level:2,title:"è¯¦ç»æè¿°ä¸ä¸ Elasticsearch ç´¢å¼ææ¡£çè¿ç¨ã",slug:"è¯¦ç»æè¿°ä¸ä¸-elasticsearch-ç´¢å¼ææ¡£çè¿ç¨ã",normalizedTitle:"è¯¦ç»æè¿°ä¸ä¸ elasticsearch ç´¢å¼ææ¡£çè¿ç¨ã",charIndex:13045},{level:2,title:"è¯¦ç»æè¿°ä¸ä¸ Elasticsearch æ´æ°åå é¤ææ¡£çè¿ç¨ã",slug:"è¯¦ç»æè¿°ä¸ä¸-elasticsearch-æ´æ°åå é¤ææ¡£çè¿ç¨ã",normalizedTitle:"è¯¦ç»æè¿°ä¸ä¸ elasticsearch æ´æ°åå é¤ææ¡£çè¿ç¨ã",charIndex:13899},{level:2,title:"è¯¦ç»æè¿°ä¸ä¸ Elasticsearch æç´¢çè¿ç¨ã",slug:"è¯¦ç»æè¿°ä¸ä¸-elasticsearch-æç´¢çè¿ç¨ã",normalizedTitle:"è¯¦ç»æè¿°ä¸ä¸ elasticsearch æç´¢çè¿ç¨ã",charIndex:14231},{level:2,title:"å¨ Elasticsearch ä¸­ï¼æ¯æä¹æ ¹æ®ä¸ä¸ªè¯æ¾å°å¯¹åºçåæç´¢å¼çï¼",slug:"å¨-elasticsearch-ä¸­-æ¯æä¹æ ¹æ®ä¸ä¸ªè¯æ¾å°å¯¹åºçåæç´¢å¼ç",normalizedTitle:"å¨ elasticsearch ä¸­ï¼æ¯æä¹æ ¹æ®ä¸ä¸ªè¯æ¾å°å¯¹åºçåæç´¢å¼çï¼",charIndex:14793},{level:2,title:"Elasticsearch å¨é¨ç½²æ¶ï¼å¯¹ Linux çè®¾ç½®æåªäºä¼åæ¹æ³ï¼",slug:"elasticsearch-å¨é¨ç½²æ¶-å¯¹-linux-çè®¾ç½®æåªäºä¼åæ¹æ³-2",normalizedTitle:"elasticsearch å¨é¨ç½²æ¶ï¼å¯¹ linux çè®¾ç½®æåªäºä¼åæ¹æ³ï¼",charIndex:14942},{level:2,title:"å¯¹äº GC æ¹é¢ï¼å¨ä½¿ç¨ Elasticsearch æ¶è¦æ³¨æä»ä¹ï¼",slug:"å¯¹äº-gc-æ¹é¢-å¨ä½¿ç¨-elasticsearch-æ¶è¦æ³¨æä»ä¹",normalizedTitle:"å¯¹äº gc æ¹é¢ï¼å¨ä½¿ç¨ elasticsearch æ¶è¦æ³¨æä»ä¹ï¼",charIndex:16250},{level:2,title:"18ãElasticsearch å¯¹äºå¤§æ°æ®éï¼ä¸äº¿éçº§ï¼çèåå¦ä½å®ç°ï¼",slug:"_18ãelasticsearch-å¯¹äºå¤§æ°æ®é-ä¸äº¿éçº§-çèåå¦ä½å®ç°",normalizedTitle:"18ãelasticsearch å¯¹äºå¤§æ°æ®éï¼ä¸äº¿éçº§ï¼çèåå¦ä½å®ç°ï¼",charIndex:16751},{level:2,title:"19ãå¨å¹¶åæåµä¸ï¼Elasticsearch å¦æä¿è¯è¯»åä¸è´ï¼",slug:"_19ãå¨å¹¶åæåµä¸-elasticsearch-å¦æä¿è¯è¯»åä¸è´",normalizedTitle:"19ãå¨å¹¶åæåµä¸ï¼elasticsearch å¦æä¿è¯è¯»åä¸è´ï¼",charIndex:17043},{level:2,title:"20ãå¦ä½çæ§ Elasticsearch éç¾¤ç¶æï¼",slug:"_20ãå¦ä½çæ§-elasticsearch-éç¾¤ç¶æ",normalizedTitle:"20ãå¦ä½çæ§ elasticsearch éç¾¤ç¶æï¼",charIndex:17394},{level:2,title:"21ãä»ç»ä¸ä½ ä»¬çµåæç´¢çæ´ä½ææ¯æ¶æã",slug:"_21ãä»ç»ä¸ä½ ä»¬çµåæç´¢çæ´ä½ææ¯æ¶æã",normalizedTitle:"21ãä»ç»ä¸ä½ ä»¬çµåæç´¢çæ´ä½ææ¯æ¶æã",charIndex:17508},{level:2,title:"ä»ç»ä¸ä¸ä½ ä»¬çä¸ªæ§åæç´¢æ¹æ¡ï¼",slug:"ä»ç»ä¸ä¸ä½ ä»¬çä¸ªæ§åæç´¢æ¹æ¡",normalizedTitle:"ä»ç»ä¸ä¸ä½ ä»¬çä¸ªæ§åæç´¢æ¹æ¡ï¼",charIndex:17535},{level:2,title:"æ¯å¦äºè§£å­å¸æ ï¼",slug:"æ¯å¦äºè§£å­å¸æ ",normalizedTitle:"æ¯å¦äºè§£å­å¸æ ï¼",charIndex:17816},{level:2,title:"æ¼åçº éæ¯å¦ä½å®ç°çï¼",slug:"æ¼åçº éæ¯å¦ä½å®ç°ç",normalizedTitle:"æ¼åçº éæ¯å¦ä½å®ç°çï¼",charIndex:18209}],headersStr:"éç¾¤é¨ç½² æ§è½ä¼å filesystem cache æ°æ®é¢ç­ å·ç­åç¦» document æ¨¡åè®¾è®¡ åé¡µæ§è½ä¼å ä¸åè®¸æ·±åº¦åé¡µï¼é»è®¤æ·±åº¦åé¡µæ§è½å¾å·®ï¼ ç±»ä¼¼äº app éçæ¨èååä¸æ­ä¸æåºæ¥ä¸é¡µä¸é¡µç å·¥ä½åç es åæ°æ®è¿ç¨ es è¯»æ°æ®è¿ç¨ es æç´¢æ°æ®è¿ç¨ åæ°æ®åºå±åç å é¤/æ´æ°æ°æ®åºå±åç åºå± lucene åæç´¢å¼ elasticsearch çåæç´¢å¼æ¯ä»ä¹ 3ãelasticsearch ç´¢å¼æ°æ®å¤äºæä¹åï¼å¦ä½è°ä¼ï¼é¨ç½² 4ãelasticsearch æ¯å¦ä½å®ç° master éä¸¾ç è¯¦ç»æè¿°ä¸ä¸ Elasticsearch ç´¢å¼ææ¡£çè¿ç¨ è¯¦ç»æè¿°ä¸ä¸ Elasticsearch æç´¢çè¿ç¨ï¼ Elasticsearch å¨é¨ç½²æ¶ï¼å¯¹ Linux çè®¾ç½®æåªäºä¼åæ¹æ³ lucence åé¨ç»ææ¯ä»ä¹ï¼ Elasticsearch æ¯å¦ä½å®ç° Master éä¸¾çï¼ 10ãElasticsearch ä¸­çèç¹ï¼æ¯å¦å± 20 ä¸ªï¼ï¼å¶ä¸­ç 10 ä¸ª å®¢æ·ç«¯å¨åéç¾¤è¿æ¥æ¶ï¼å¦ä½éæ©ç¹å®çèç¹æ§è¡è¯·æ±çï¼ è¯¦ç»æè¿°ä¸ä¸ Elasticsearch ç´¢å¼ææ¡£çè¿ç¨ã è¯¦ç»æè¿°ä¸ä¸ Elasticsearch æ´æ°åå é¤ææ¡£çè¿ç¨ã è¯¦ç»æè¿°ä¸ä¸ Elasticsearch æç´¢çè¿ç¨ã å¨ Elasticsearch ä¸­ï¼æ¯æä¹æ ¹æ®ä¸ä¸ªè¯æ¾å°å¯¹åºçåæç´¢å¼çï¼ Elasticsearch å¨é¨ç½²æ¶ï¼å¯¹ Linux çè®¾ç½®æåªäºä¼åæ¹æ³ï¼ å¯¹äº GC æ¹é¢ï¼å¨ä½¿ç¨ Elasticsearch æ¶è¦æ³¨æä»ä¹ï¼ 18ãElasticsearch å¯¹äºå¤§æ°æ®éï¼ä¸äº¿éçº§ï¼çèåå¦ä½å®ç°ï¼ 19ãå¨å¹¶åæåµä¸ï¼Elasticsearch å¦æä¿è¯è¯»åä¸è´ï¼ 20ãå¦ä½çæ§ Elasticsearch éç¾¤ç¶æï¼ 21ãä»ç»ä¸ä½ ä»¬çµåæç´¢çæ´ä½ææ¯æ¶æã ä»ç»ä¸ä¸ä½ ä»¬çä¸ªæ§åæç´¢æ¹æ¡ï¼ æ¯å¦äºè§£å­å¸æ ï¼ æ¼åçº éæ¯å¦ä½å®ç°çï¼",content:"# Elasticsearch é¢è¯æ»ç»\n\n\n# éç¾¤é¨ç½²\n\nES é¨ç½²æåµï¼\n\n5 èç¹ï¼éç½®ï¼8 æ ¸ 64 G 1Tï¼ï¼æ»è®¡ 320 Gï¼5 Tã\n\nçº¦ 10+ ç´¢å¼ï¼5 åçï¼æ¯æ¥æ°å¢æ°æ®éçº¦ä¸º 2Gï¼4000w æ¡ãè®°å½ä¿å­ 30 å¤©ã\n\n\n# æ§è½ä¼å\n\n\n# filesystem cache\n\nä½ å¾ es éåçæ°æ®ï¼å®éä¸é½åå°ç£çæä»¶éå»äºï¼æ¥è¯¢çæ¶åï¼æä½ç³»ç»ä¼å°ç£çæä»¶éçæ°æ®èªå¨ç¼å­å° filesystem cache éé¢å»ã\n\n\n\nes çæç´¢å¼æä¸¥éä¾èµäºåºå±ç filesystem cache ï¼ä½ å¦æç» filesystem cache æ´å¤çåå­ï¼å°½éè®©åå­å¯ä»¥å®¹çº³ææç idx segment fileç´¢å¼æ°æ®æä»¶ï¼é£ä¹ä½ æç´¢çæ¶åå°±åºæ¬é½æ¯èµ°åå­çï¼æ§è½ä¼éå¸¸é«ã\n\næ§è½å·®è·ç©¶ç«å¯ä»¥æå¤å¤§ï¼æä»¬ä¹åå¾å¤çæµè¯ååæµï¼å¦æèµ°ç£çä¸è¬è¯å®ä¸ç§ï¼æç´¢æ§è½ç»å¯¹æ¯ç§çº§å«çï¼1 ç§ã5 ç§ã10 ç§ãä½å¦ææ¯èµ° filesystem cache ï¼æ¯èµ°çº¯åå­çï¼é£ä¹ä¸è¬æ¥è¯´æ§è½æ¯èµ°ç£çè¦é«ä¸ä¸ªæ°éçº§ï¼åºæ¬ä¸å°±æ¯æ¯«ç§çº§çï¼ä»å æ¯«ç§å°å ç¾æ¯«ç§ä¸ç­ã\n\nè¿éæä¸ªçå®çæ¡ä¾ãæä¸ªå¬å¸ es èç¹æ 3 å°æºå¨ï¼æ¯å°æºå¨çèµ·æ¥åå­å¾å¤ï¼64Gï¼æ»åå­å°±æ¯ 64 * 3 = 192G ãæ¯å°æºå¨ç» es jvm heap æ¯ 32G ï¼é£ä¹å©ä¸æ¥çç» filesystem cache çå°±æ¯æ¯å°æºå¨æ 32G ï¼æ»å±éç¾¤éç» filesystem cache çå°±æ¯ 32 * 3 = 96G åå­ãèæ­¤æ¶ï¼æ´ä¸ªç£çä¸ç´¢å¼æ°æ®æä»¶ï¼å¨ 3 å°æºå¨ä¸ä¸å±å ç¨äº 1T çç£çå®¹éï¼es æ°æ®éæ¯ 1T ï¼é£ä¹æ¯å°æºå¨çæ°æ®éæ¯ 300G ãè¿æ ·æ§è½å¥½åï¼ filesystem cache çåå­æ 100Gï¼ååä¹ä¸çæ°æ®å¯ä»¥æ¾åå­ï¼å¶ä»çé½å¨ç£çï¼ç¶åä½ æ§è¡æç´¢æä½ï¼å¤§é¨åæä½é½æ¯èµ°ç£çï¼æ§è½è¯å®å·®ã\n\nå½æ ¹ç»åºï¼ä½ è¦è®© es æ§è½è¦å¥½ï¼æä½³çæåµä¸ï¼å°±æ¯ä½ çæºå¨çåå­ï¼è³å°å¯ä»¥å®¹çº³ä½ çæ»æ°æ®éçä¸åã\n\næ ¹æ®æä»¬èªå·±ççäº§ç¯å¢å®è·µç»éªï¼æä½³çæåµä¸ï¼æ¯ä»ä»å¨ es ä¸­å°±å­å°éçæ°æ®ï¼å°±æ¯ä½ è¦ç¨æ¥æç´¢çé£äºç´¢å¼ï¼å¦æåå­çç» filesystem cache çæ¯ 100Gï¼é£ä¹ä½ å°±å°ç´¢å¼æ°æ®æ§å¶å¨ 100G ä»¥åï¼è¿æ ·çè¯ï¼ä½ çæ°æ®å ä¹å¨é¨èµ°åå­æ¥æç´¢ï¼æ§è½éå¸¸ä¹é«ï¼ä¸è¬å¯ä»¥å¨ 1 ç§ä»¥åã\n\næ¯å¦è¯´ä½ ç°å¨æä¸è¡æ°æ®ã id,name,age .... 30 ä¸ªå­æ®µãä½æ¯ä½ ç°å¨æç´¢ï¼åªéè¦æ ¹æ® id,name,age ä¸ä¸ªå­æ®µæ¥æç´¢ãå¦æä½ å»ä¹ä¹å¾ es éåå¥ä¸è¡æ°æ®ææçå­æ®µï¼å°±ä¼å¯¼è´è¯´ 90% çæ°æ®æ¯ä¸ç¨æ¥æç´¢çï¼ç»æç¡¬æ¯å æ®äº es æºå¨ä¸ç filesystem cache çç©ºé´ï¼åæ¡æ°æ®çæ°æ®éè¶å¤§ï¼å°±ä¼å¯¼è´ filesystem cahce è½ç¼å­çæ°æ®å°±è¶å°ãå¶å®ï¼ä»ä»åå¥ es ä¸­è¦ç¨æ¥æ£ç´¢çå°æ°å ä¸ªå­æ®µå°±å¯ä»¥äºï¼æ¯å¦è¯´å°±åå¥ es id,name,age ä¸ä¸ªå­æ®µï¼ç¶åä½ å¯ä»¥æå¶ä»çå­æ®µæ°æ®å­å¨ mysql/hbase éï¼æä»¬ä¸è¬æ¯å»ºè®®ç¨ es + hbase è¿ä¹ä¸ä¸ªæ¶æã\n\nhbase çç¹ç¹æ¯éç¨äºæµ·éæ°æ®çå¨çº¿å­å¨ï¼å°±æ¯å¯¹ hbase å¯ä»¥åå¥æµ·éæ°æ®ï¼ä½æ¯ä¸è¦åå¤æçæç´¢ï¼åå¾ç®åçä¸äºæ ¹æ® id æèèå´è¿è¡æ¥è¯¢çè¿ä¹ä¸ä¸ªæä½å°±å¯ä»¥äºãä» es ä¸­æ ¹æ® name å age å»æç´¢ï¼æ¿å°çç»æå¯è½å°± 20 ä¸ª doc id ï¼ç¶åæ ¹æ® doc id å° hbase éå»æ¥è¯¢æ¯ä¸ª doc id å¯¹åºçå®æ´çæ°æ®ï¼ç»æ¥åºæ¥ï¼åè¿åç»åç«¯ã\n\nåå¥ es çæ°æ®æå¥½å°äºç­äºï¼æèæ¯ç¥å¾®å¤§äº es ç filesystem cache çåå­å®¹éãç¶åä½ ä» es æ£ç´¢å¯è½å°±è±è´¹ 20msï¼ç¶ååæ ¹æ® es è¿åç id å» hbase éæ¥è¯¢ï¼æ¥ 20 æ¡æ°æ®ï¼å¯è½ä¹å°±èè´¹ä¸ª 30msï¼å¯è½ä½ åæ¥é£ä¹ç©å¿ï¼1T æ°æ®é½æ¾ esï¼ä¼æ¯æ¬¡æ¥è¯¢é½æ¯ 5~10sï¼ç°å¨å¯è½æ§è½å°±ä¼å¾é«ï¼æ¯æ¬¡æ¥è¯¢å°±æ¯ 50msã\n\n\n# æ°æ®é¢ç­\n\nåå¦è¯´ï¼åªææ¯ä½ å°±æç§ä¸è¿°çæ¹æ¡å»åäºï¼es éç¾¤ä¸­æ¯ä¸ªæºå¨åå¥çæ°æ®éè¿æ¯è¶è¿äº filesystem cache ä¸åï¼æ¯å¦è¯´ä½ åå¥ä¸å°æºå¨ 60G æ°æ®ï¼ç»æ filesystem cache å°± 30Gï¼è¿æ¯æ 30G æ°æ®çå¨äºç£çä¸ã\n\nå¶å®å¯ä»¥åæ°æ®é¢ç­ã\n\nä¸¾ä¸ªä¾å­ï¼æ¿å¾®åæ¥è¯´ï¼ä½ å¯ä»¥æä¸äºå¤§ Vï¼å¹³æ¶ççäººå¾å¤çæ°æ®ï¼ä½ èªå·±æååå°æä¸ªç³»ç»ï¼æ¯éä¸ä¼å¿ï¼èªå·±çåå°ç³»ç»å»æç´¢ä¸ä¸ç­æ°æ®ï¼å·å° filesystem cache éå»ï¼åé¢ç¨æ·å®éä¸æ¥çè¿ä¸ªç­æ°æ®çæ¶åï¼ä»ä»¬å°±æ¯ç´æ¥ä»åå­éæç´¢äºï¼å¾å¿«ã\n\næèæ¯çµåï¼ä½ å¯ä»¥å°å¹³æ¶æ¥çæå¤çä¸äºååï¼æ¯å¦è¯´ iphone 8ï¼ç­æ°æ®æååå°æä¸ªç¨åºï¼æ¯é 1 åéèªå·±ä¸»å¨è®¿é®ä¸æ¬¡ï¼å·å° filesystem cache éå»ã\n\nå¯¹äºé£äºä½ è§å¾æ¯è¾ç­çãç»å¸¸ä¼æäººè®¿é®çæ°æ®ï¼æå¥½åä¸ä¸ªä¸é¨çç¼å­é¢ç­å­ç³»ç»ï¼å°±æ¯å¯¹ç­æ°æ®æ¯éä¸æ®µæ¶é´ï¼å°±æåè®¿é®ä¸ä¸ï¼è®©æ°æ®è¿å¥ filesystem cache éé¢å»ãè¿æ ·ä¸æ¬¡å«äººè®¿é®çæ¶åï¼æ§è½ä¸å®ä¼å¥½å¾å¤ã\n\n\n# å·ç­åç¦»\n\nes å¯ä»¥åç±»ä¼¼äº mysql çæ°´å¹³æåï¼å°±æ¯è¯´å°å¤§éçè®¿é®å¾å°ãé¢çå¾ä½çæ°æ®ï¼åç¬åä¸ä¸ªç´¢å¼ï¼ç¶åå°è®¿é®å¾é¢ç¹çç­æ°æ®åç¬åä¸ä¸ªç´¢å¼ãæå¥½æ¯å°å·æ°æ®åå¥ä¸ä¸ªç´¢å¼ä¸­ï¼ç¶åç­æ°æ®åå¥å¦å¤ä¸ä¸ªç´¢å¼ä¸­ï¼è¿æ ·å¯ä»¥ç¡®ä¿ç­æ°æ®å¨è¢«é¢ç­ä¹åï¼å°½éé½è®©ä»ä»¬çå¨ filesystem os cache éï¼å«è®©å·æ°æ®ç»å²å·æã\n\nä½ çï¼åè®¾ä½ æ 6 å°æºå¨ï¼2 ä¸ªç´¢å¼ï¼ä¸ä¸ªæ¾å·æ°æ®ï¼ä¸ä¸ªæ¾ç­æ°æ®ï¼æ¯ä¸ªç´¢å¼ 3 ä¸ª shardã3 å°æºå¨æ¾ç­æ°æ® indexï¼å¦å¤ 3 å°æºå¨æ¾å·æ°æ® indexãç¶åè¿æ ·çè¯ï¼ä½ å¤§éçæ¶é´æ¯å¨è®¿é®ç­æ°æ® indexï¼ç­æ°æ®å¯è½å°±å æ»æ°æ®éç 10%ï¼æ­¤æ¶æ°æ®éå¾å°ï¼å ä¹å¨é½ä¿çå¨ filesystem cache éé¢äºï¼å°±å¯ä»¥ç¡®ä¿ç­æ°æ®çè®¿é®æ§è½æ¯å¾é«çãä½æ¯å¯¹äºå·æ°æ®èè¨ï¼æ¯å¨å«ç index éçï¼è·ç­æ°æ® index ä¸å¨ç¸åçæºå¨ä¸ï¼å¤§å®¶äºç¸ä¹é´é½æ²¡ä»ä¹èç³»äºãå¦ææäººè®¿é®å·æ°æ®ï¼å¯è½å¤§éæ°æ®æ¯å¨ç£çä¸çï¼æ­¤æ¶æ§è½å·®ç¹ï¼å°± 10% çäººå»è®¿é®å·æ°æ®ï¼90% çäººå¨è®¿é®ç­æ°æ®ï¼ä¹æ æè°äºã\n\n\n# document æ¨¡åè®¾è®¡\n\nå¯¹äº MySQLï¼æä»¬ç»å¸¸æä¸äºå¤æçå³èæ¥è¯¢ãå¨ es éè¯¥æä¹ç©å¿ï¼es éé¢çå¤æçå³èæ¥è¯¢å°½éå«ç¨ï¼ä¸æ¦ç¨äºæ§è½ä¸è¬é½ä¸å¤ªå¥½ã\n\næå¥½æ¯åå¨ Java ç³»ç»éå°±å®æå³èï¼å°å³èå¥½çæ°æ®ç´æ¥åå¥ es ä¸­ãæç´¢çæ¶åï¼å°±ä¸éè¦å©ç¨ es çæç´¢è¯­æ³æ¥å®æ join ä¹ç±»çå³èæç´¢äºã\n\ndocument æ¨¡åè®¾è®¡æ¯éå¸¸éè¦çï¼å¾å¤æä½ï¼ä¸è¦å¨æç´¢çæ¶åææ³å»æ§è¡åç§å¤æçä¹±ä¸å«ç³çæä½ães è½æ¯æçæä½å°±é£ä¹å¤ï¼ä¸è¦èèç¨ es åä¸äºå®ä¸å¥½æä½çäºæãå¦æççæé£ç§æä½ï¼å°½éå¨ document æ¨¡åè®¾è®¡çæ¶åï¼åå¥çæ¶åå°±å®æãå¦å¤å¯¹äºä¸äºå¤ªå¤æçæä½ï¼æ¯å¦ join/nested/parent-child æç´¢é½è¦å°½éé¿åï¼æ§è½é½å¾å·®çã\n\n\n# åé¡µæ§è½ä¼å\n\nes çåé¡µæ¯è¾åçï¼ä¸ºå¥å¢ï¼ä¸¾ä¸ªä¾å­å§ï¼åå¦ä½ æ¯é¡µæ¯ 10 æ¡æ°æ®ï¼ä½ ç°å¨è¦æ¥è¯¢ç¬¬ 100 é¡µï¼å®éä¸æ¯ä¼ææ¯ä¸ª shard ä¸å­å¨çå 1000 æ¡æ°æ®é½æ¥å°ä¸ä¸ªåè°èç¹ä¸ï¼å¦æä½ æä¸ª 5 ä¸ª shardï¼é£ä¹å°±æ 5000 æ¡æ°æ®ï¼æ¥çåè°èç¹å¯¹è¿ 5000 æ¡æ°æ®è¿è¡ä¸äºåå¹¶ãå¤çï¼åè·åå°æç»ç¬¬ 100 é¡µç 10 æ¡æ°æ®ã\n\nåå¸å¼çï¼ä½ è¦æ¥ç¬¬ 100 é¡µç 10 æ¡æ°æ®ï¼ä¸å¯è½è¯´ä» 5 ä¸ª shardï¼æ¯ä¸ª shard å°±æ¥ 2 æ¡æ°æ®ï¼æåå°åè°èç¹åå¹¶æ 10 æ¡æ°æ®å§ï¼ä½ å¿é¡»å¾ä»æ¯ä¸ª shard é½æ¥ 1000 æ¡æ°æ®è¿æ¥ï¼ç¶åæ ¹æ®ä½ çéæ±è¿è¡æåºãç­éç­ç­æä½ï¼æååæ¬¡åé¡µï¼æ¿å°éé¢ç¬¬ 100 é¡µçæ°æ®ãä½ ç¿»é¡µçæ¶åï¼ç¿»çè¶æ·±ï¼æ¯ä¸ª shard è¿åçæ°æ®å°±è¶å¤ï¼èä¸åè°èç¹å¤ççæ¶é´è¶é¿ï¼éå¸¸åç¹ãæä»¥ç¨ es ååé¡µçæ¶åï¼ä½ ä¼åç°è¶ç¿»å°åé¢ï¼å°±è¶æ¯æ¢ã\n\næä»¬ä¹åä¹æ¯éå°è¿è¿ä¸ªé®é¢ï¼ç¨ es ä½åé¡µï¼åå é¡µå°±å åæ¯«ç§ï¼ç¿»å° 10 é¡µæèå åé¡µçæ¶åï¼åºæ¬ä¸å°±è¦ 5~10 ç§æè½æ¥åºæ¥ä¸é¡µæ°æ®äºã\n\næä»ä¹è§£å³æ¹æ¡åï¼\n\n# ä¸åè®¸æ·±åº¦åé¡µï¼é»è®¤æ·±åº¦åé¡µæ§è½å¾å·®ï¼\n\nè·äº§åç»çè¯´ï¼ä½ ç³»ç»ä¸åè®¸ç¿»é£ä¹æ·±çé¡µï¼é»è®¤ç¿»çè¶æ·±ï¼æ§è½å°±è¶å·®ã\n\n# ç±»ä¼¼äº app éçæ¨èååä¸æ­ä¸æåºæ¥ä¸é¡µä¸é¡µç\n\nç±»ä¼¼äºå¾®åä¸­ï¼ä¸æå·å¾®åï¼å·åºæ¥ä¸é¡µä¸é¡µçï¼ä½ å¯ä»¥ç¨ scroll api ï¼å³äºå¦ä½ä½¿ç¨ï¼èªè¡ä¸ç½æç´¢ã\n\nscroll ä¼ä¸æ¬¡æ§ç»ä½ çææææ°æ®çä¸ä¸ªå¿«ç§ï¼ç¶åæ¯æ¬¡æ»å¨ååç¿»é¡µå°±æ¯éè¿æ¸¸æ  scroll_id ç§»å¨ï¼è·åä¸ä¸é¡µä¸ä¸é¡µè¿æ ·å­ï¼æ§è½ä¼æ¯ä¸é¢è¯´çé£ç§åé¡µæ§è½è¦é«å¾å¤å¾å¤ï¼åºæ¬ä¸é½æ¯æ¯«ç§çº§çã\n\nä½æ¯ï¼å¯ä¸çä¸ç¹å°±æ¯ï¼è¿ä¸ªéåäºé£ç§ç±»ä¼¼å¾®åä¸æç¿»é¡µçï¼ä¸è½éæè·³å°ä»»ä½ä¸é¡µçåºæ¯ãä¹å°±æ¯è¯´ï¼ä½ ä¸è½åè¿å¥ç¬¬ 10 é¡µï¼ç¶åå»ç¬¬ 120 é¡µï¼ç¶åååå°ç¬¬ 58 é¡µï¼ä¸è½éæä¹±è·³é¡µãæä»¥ç°å¨å¾å¤äº§åï¼é½æ¯ä¸åè®¸ä½ éæç¿»é¡µçï¼appï¼ä¹æä¸äºç½ç«ï¼åçå°±æ¯ä½ åªè½å¾ä¸æï¼ä¸é¡µä¸é¡µçç¿»ã\n\nåå§åæ¶å¿é¡»æå® scroll åæ°ï¼åè¯ es è¦ä¿å­æ­¤æ¬¡æç´¢çä¸ä¸æå¤é¿æ¶é´ãä½ éè¦ç¡®ä¿ç¨æ·ä¸ä¼æç»­ä¸æ­ç¿»é¡µç¿»å ä¸ªå°æ¶ï¼å¦åå¯è½å ä¸ºè¶æ¶èå¤±è´¥ã\n\né¤äºç¨ scroll api ï¼ä½ ä¹å¯ä»¥ç¨ search_after æ¥åï¼ search_after çææ³æ¯ä½¿ç¨åä¸é¡µçç»ææ¥å¸®å©æ£ç´¢ä¸ä¸é¡µçæ°æ®ï¼æ¾ç¶ï¼è¿ç§æ¹å¼ä¹ä¸åè®¸ä½ éæç¿»é¡µï¼ä½ åªè½ä¸é¡µé¡µå¾åç¿»ãåå§åæ¶ï¼éè¦ä½¿ç¨ä¸ä¸ªå¯ä¸å¼çå­æ®µä½ä¸º sort å­æ®µã\n\n1.1ãè®¾è®¡é¶æ®µè°ä¼\n\nï¼1ï¼æ ¹æ®ä¸å¡å¢ééæ±ï¼éååºäºæ¥ææ¨¡æ¿åå»ºç´¢å¼ï¼éè¿ roll over API æ»å¨ç´¢å¼ï¼\n\nï¼2ï¼ä½¿ç¨å«åè¿è¡ç´¢å¼ç®¡çï¼\n\nï¼3ï¼æ¯å¤©åæ¨å®æ¶å¯¹ç´¢å¼å force_merge æä½ï¼ä»¥éæ¾ç©ºé´ï¼\n\nï¼4ï¼éåå·ç­åç¦»æºå¶ï¼ç­æ°æ®å­å¨å° SSDï¼æé«æ£ç´¢æçï¼å·æ°æ®å®æè¿è¡ shrink æä½ï¼ä»¥ç¼©åå­å¨ï¼\n\nï¼5ï¼éå curator è¿è¡ç´¢å¼ççå½å¨æç®¡çï¼\n\nï¼6ï¼ä»éå¯¹éè¦åè¯çå­æ®µï¼åççè®¾ç½®åè¯å¨ï¼\n\nï¼7ï¼Mapping é¶æ®µååç»ååä¸ªå­æ®µçå±æ§ï¼æ¯å¦éè¦æ£ç´¢ãæ¯å¦éè¦å­å¨ç­ãâ¦â¦..\n\n1.2ãåå¥è°ä¼\n\nï¼1ï¼åå¥åå¯æ¬æ°è®¾ç½®ä¸º 0ï¼\n\nï¼2ï¼åå¥åå³é­ refresh_interval è®¾ç½®ä¸º-1ï¼ç¦ç¨å·æ°æºå¶ï¼\n\nï¼3ï¼åå¥è¿ç¨ä¸­ï¼éå bulk æ¹éåå¥ï¼\n\nï¼4ï¼åå¥åæ¢å¤å¯æ¬æ°åå·æ°é´éï¼\n\nï¼5ï¼å°½éä½¿ç¨èªå¨çæç idã\n\n1.3ãæ¥è¯¢è°ä¼\n\nï¼1ï¼ç¦ç¨ wildcardï¼\n\nï¼2ï¼ç¦ç¨æ¹é termsï¼æç¾ä¸åçåºæ¯ï¼ï¼\n\nï¼3ï¼ååå©ç¨åæç´¢å¼æºå¶ï¼è½ keyword ç±»åå°½é keywordï¼\n\nï¼4ï¼æ°æ®éå¤§æ¶åï¼å¯ä»¥ååºäºæ¶é´æ²å®ç´¢å¼åæ£ç´¢ï¼\n\nï¼5ï¼è®¾ç½®åççè·¯ç±æºå¶ã\n\n1.4ãå¶ä»è°ä¼\n\né¨ç½²è°ä¼ï¼ä¸å¡è°ä¼ç­ã\n\nä¸é¢çæåä¸é¨åï¼é¢è¯èå°±åºæ¬å¯¹ä½ ä¹åçå®è·µæèè¿ç»´ç»éªææè¯ä¼°äºã\n\n\n# å·¥ä½åç\n\n\n# es åæ°æ®è¿ç¨\n\n * å®¢æ·ç«¯éæ©ä¸ä¸ª node åéè¯·æ±è¿å»ï¼è¿ä¸ª node å°±æ¯ coordinating node ï¼åè°èç¹ï¼ã\n * coordinating node å¯¹ document è¿è¡è·¯ç±ï¼å°è¯·æ±è½¬åç»å¯¹åºç nodeï¼æ primary shardï¼ã\n * å®éç node ä¸ç primary shard å¤çè¯·æ±ï¼ç¶åå°æ°æ®åæ­¥å° replica node ã\n * coordinating node å¦æåç° primary node åææ replica node é½æå®ä¹åï¼å°±è¿åååºç»æç»å®¢æ·ç«¯ã\n\n\n\n\n# es è¯»æ°æ®è¿ç¨\n\nå¯ä»¥éè¿ doc id æ¥æ¥è¯¢ï¼ä¼æ ¹æ® doc id è¿è¡ hashï¼å¤æ­åºæ¥å½æ¶æ doc id åéå°äºåªä¸ª shard ä¸é¢å»ï¼ä»é£ä¸ª shard å»æ¥è¯¢ã\n\n * å®¢æ·ç«¯åéè¯·æ±å°ä»»æä¸ä¸ª nodeï¼æä¸º coordinate node ã\n * coordinate node å¯¹ doc id è¿è¡åå¸è·¯ç±ï¼å°è¯·æ±è½¬åå°å¯¹åºç nodeï¼æ­¤æ¶ä¼ä½¿ç¨ round-robin éæºè½®è¯¢ç®æ³ï¼å¨ primary shard ä»¥åå¶ææ replica ä¸­éæºéæ©ä¸ä¸ªï¼è®©è¯»è¯·æ±è´è½½åè¡¡ã\n * æ¥æ¶è¯·æ±ç node è¿å document ç» coordinate node ã\n * coordinate node è¿å document ç»å®¢æ·ç«¯ã\n\n\n# es æç´¢æ°æ®è¿ç¨\n\nes æå¼ºå¤§çæ¯åå¨ææ£ç´¢ï¼å°±æ¯æ¯å¦ä½ æä¸æ¡æ°æ®ï¼\n\njavaçå¥½ç©å¿å\njavaå¥½é¾å­¦å\nj2eeç¹å«ç\n\n\nä½ æ ¹æ® java å³é®è¯æ¥æç´¢ï¼å°åå« java ç document ç»æç´¢åºæ¥ães å°±ä¼ç»ä½ è¿åï¼java çå¥½ç©å¿åï¼java å¥½é¾å­¦åã\n\n * å®¢æ·ç«¯åéè¯·æ±å°ä¸ä¸ª coordinate node ã\n * åè°èç¹å°æç´¢è¯·æ±è½¬åå°ææç shard å¯¹åºç primary shard æ replica shard ï¼é½å¯ä»¥ã\n * query phaseï¼æ¯ä¸ª shard å°èªå·±çæç´¢ç»æï¼å¶å®å°±æ¯ä¸äº doc id ï¼è¿åç»åè°èç¹ï¼ç±åè°èç¹è¿è¡æ°æ®çåå¹¶ãæåºãåé¡µç­æä½ï¼äº§åºæç»ç»æã\n * fetch phaseï¼æ¥çç±åè°èç¹æ ¹æ® doc id å»åä¸ªèç¹ä¸æåå®éç document æ°æ®ï¼æç»è¿åç»å®¢æ·ç«¯ã\n\n> åè¯·æ±æ¯åå¥ primary shardï¼ç¶ååæ­¥ç»ææç replica shardï¼è¯»è¯·æ±å¯ä»¥ä» primary shard æ replica shard è¯»åï¼éç¨çæ¯éæºè½®è¯¢ç®æ³ã\n\n\n# åæ°æ®åºå±åç\n\n\n\nååå¥åå­ bufferï¼å¨ buffer éçæ¶åæ°æ®æ¯æç´¢ä¸å°çï¼åæ¶å°æ°æ®åå¥ translog æ¥å¿æä»¶ã\n\nå¦æ buffer å¿«æ»¡äºï¼æèå°ä¸å®æ¶é´ï¼å°±ä¼å°åå­ buffer æ°æ® refresh å°ä¸ä¸ªæ°ç segment file ä¸­ï¼ä½æ¯æ­¤æ¶æ°æ®ä¸æ¯ç´æ¥è¿å¥ segment file ç£çæä»¶ï¼èæ¯åè¿å¥ os cache ãè¿ä¸ªè¿ç¨å°±æ¯ refresh ã\n\næ¯é 1 ç§éï¼es å° buffer ä¸­çæ°æ®åå¥ä¸ä¸ªæ°ç segment file ï¼æ¯ç§éä¼äº§çä¸ä¸ªæ°çç£çæä»¶ segment file ï¼è¿ä¸ª segment file ä¸­å°±å­å¨æè¿ 1 ç§å buffer ä¸­åå¥çæ°æ®ã\n\nä½æ¯å¦æ buffer éé¢æ­¤æ¶æ²¡ææ°æ®ï¼é£å½ç¶ä¸ä¼æ§è¡ refresh æä½ï¼å¦æ buffer éé¢ææ°æ®ï¼é»è®¤ 1 ç§éæ§è¡ä¸æ¬¡ refresh æä½ï¼å·å¥ä¸ä¸ªæ°ç segment file ä¸­ã\n\næä½ç³»ç»éé¢ï¼ç£çæä»¶å¶å®é½æä¸ä¸ªä¸è¥¿ï¼å«å os cache ï¼å³æä½ç³»ç»ç¼å­ï¼å°±æ¯è¯´æ°æ®åå¥ç£çæä»¶ä¹åï¼ä¼åè¿å¥ os cache ï¼åè¿å¥æä½ç³»ç»çº§å«çä¸ä¸ªåå­ç¼å­ä¸­å»ãåªè¦ buffer ä¸­çæ°æ®è¢« refresh æä½å·å¥ os cache ä¸­ï¼è¿ä¸ªæ°æ®å°±å¯ä»¥è¢«æç´¢å°äºã\n\nä¸ºä»ä¹å« es æ¯åå®æ¶çï¼ NRT ï¼å¨ç§° near real-time ãé»è®¤æ¯æ¯é 1 ç§ refresh ä¸æ¬¡çï¼æä»¥ es æ¯åå®æ¶çï¼å ä¸ºåå¥çæ°æ® 1 ç§ä¹åæè½è¢«çå°ãå¯ä»¥éè¿ es ç restful api æè java api ï¼æå¨æ§è¡ä¸æ¬¡ refresh æä½ï¼å°±æ¯æå¨å° buffer ä¸­çæ°æ®å·å¥ os cache ä¸­ï¼è®©æ°æ®ç«é©¬å°±å¯ä»¥è¢«æç´¢å°ãåªè¦æ°æ®è¢«è¾å¥ os cache ä¸­ï¼buffer å°±ä¼è¢«æ¸ç©ºäºï¼å ä¸ºä¸éè¦ä¿ç buffer äºï¼æ°æ®å¨ translog éé¢å·²ç»æä¹åå°ç£çå»ä¸ä»½äºã\n\néå¤ä¸é¢çæ­¥éª¤ï¼æ°çæ°æ®ä¸æ­è¿å¥ buffer å translogï¼ä¸æ­å° buffer æ°æ®åå¥ä¸ä¸ªåä¸ä¸ªæ°ç segment file ä¸­å»ï¼æ¯æ¬¡ refresh å® buffer æ¸ç©ºï¼translog ä¿çãéçè¿ä¸ªè¿ç¨æ¨è¿ï¼translog ä¼åå¾è¶æ¥è¶å¤§ãå½ translog è¾¾å°ä¸å®é¿åº¦çæ¶åï¼å°±ä¼è§¦å commit æä½ã\n\ncommit æä½åçç¬¬ä¸æ­¥ï¼å°±æ¯å° buffer ä¸­ç°ææ°æ® refresh å° os cache ä¸­å»ï¼æ¸ç©º bufferãç¶åï¼å°ä¸ä¸ª commit point åå¥ç£çæä»¶ï¼éé¢æ è¯çè¿ä¸ª commit point å¯¹åºçææ segment file ï¼åæ¶å¼ºè¡å° os cache ä¸­ç®åææçæ°æ®é½ fsync å°ç£çæä»¶ä¸­å»ãæåæ¸ç©º ç°æ translog æ¥å¿æä»¶ï¼éå¯ä¸ä¸ª translogï¼æ­¤æ¶ commit æä½å®æã\n\nè¿ä¸ª commit æä½å«å flush ãé»è®¤ 30 åéèªå¨æ§è¡ä¸æ¬¡ flush ï¼ä½å¦æ translog è¿å¤§ï¼ä¹ä¼è§¦å flush ãflush æä½å°±å¯¹åºç commit çå¨è¿ç¨ï¼æä»¬å¯ä»¥éè¿ es apiï¼æå¨æ§è¡ flush æä½ï¼æå¨å° os cache ä¸­çæ°æ® fsync å¼ºå·å°ç£çä¸å»ã\n\ntranslog æ¥å¿æä»¶çä½ç¨æ¯ä»ä¹ï¼ä½ æ§è¡ commit æä½ä¹åï¼æ°æ®è¦ä¹æ¯åçå¨ buffer ä¸­ï¼è¦ä¹æ¯åçå¨ os cache ä¸­ï¼æ è®ºæ¯ buffer è¿æ¯ os cache é½æ¯åå­ï¼ä¸æ¦è¿å°æºå¨æ­»äºï¼åå­ä¸­çæ°æ®å°±å¨ä¸¢äºãæä»¥éè¦å°æ°æ®å¯¹åºçæä½åå¥ä¸ä¸ªä¸é¨çæ¥å¿æä»¶ translog ä¸­ï¼ä¸æ¦æ­¤æ¶æºå¨å®æºï¼åæ¬¡éå¯çæ¶åï¼es ä¼èªå¨è¯»å translog æ¥å¿æä»¶ä¸­çæ°æ®ï¼æ¢å¤å°åå­ buffer å os cache ä¸­å»ã\n\ntranslog å¶å®ä¹æ¯ååå¥ os cache çï¼é»è®¤æ¯é 5 ç§å·ä¸æ¬¡å°ç£çä¸­å»ï¼æä»¥é»è®¤æåµä¸ï¼å¯è½æ 5 ç§çæ°æ®ä¼ä»ä»åçå¨ buffer æè translog æä»¶ç os cache ä¸­ï¼å¦ææ­¤æ¶æºå¨æäºï¼ä¼ä¸¢å¤± 5 ç§éçæ°æ®ãä½æ¯è¿æ ·æ§è½æ¯è¾å¥½ï¼æå¤ä¸¢ 5 ç§çæ°æ®ãä¹å¯ä»¥å° translog è®¾ç½®ææ¯æ¬¡åæä½å¿é¡»æ¯ç´æ¥ fsync å°ç£çï¼ä½æ¯æ§è½ä¼å·®å¾å¤ã\n\nå®éä¸ä½ å¨è¿éï¼å¦æé¢è¯å®æ²¡æé®ä½  es ä¸¢æ°æ®çé®é¢ï¼ä½ å¯ä»¥å¨è¿éç»é¢è¯å®ç«ä¸æï¼ä½ è¯´ï¼å¶å® es ç¬¬ä¸æ¯åå®æ¶çï¼æ°æ®åå¥ 1 ç§åå¯ä»¥æç´¢å°ï¼å¯è½ä¼ä¸¢å¤±æ°æ®çãæ 5 ç§çæ°æ®ï¼åçå¨ bufferãtranslog os cacheãsegment file os cache ä¸­ï¼èä¸å¨ç£çä¸ï¼æ­¤æ¶å¦æå®æºï¼ä¼å¯¼è´ 5 ç§çæ°æ®ä¸¢å¤±ã\n\næ»ç»ä¸ä¸ï¼æ°æ®ååå¥åå­ bufferï¼ç¶åæ¯é 1sï¼å°æ°æ® refresh å° os cacheï¼å°äº os cache æ°æ®å°±è½è¢«æç´¢å°ï¼æä»¥æä»¬æè¯´ es ä»åå¥å°è½è¢«æç´¢å°ï¼ä¸­é´æ 1s çå»¶è¿ï¼ãæ¯é 5sï¼å°æ°æ®åå¥ translog æä»¶ï¼è¿æ ·å¦ææºå¨å®æºï¼åå­æ°æ®å¨æ²¡ï¼æå¤ä¼æ 5s çæ°æ®ä¸¢å¤±ï¼ï¼translog å¤§å°ä¸å®ç¨åº¦ï¼æèé»è®¤æ¯é 30minsï¼ä¼è§¦å commit æä½ï¼å°ç¼å²åºçæ°æ®é½ flush å° segment file ç£çæä»¶ä¸­ã\n\n> æ°æ®åå¥ segment file ä¹åï¼åæ¶å°±å»ºç«å¥½äºåæç´¢å¼ã\n\n\n# å é¤/æ´æ°æ°æ®åºå±åç\n\nå¦ææ¯å é¤æä½ï¼commit çæ¶åä¼çæä¸ä¸ª .del æä»¶ï¼éé¢å°æä¸ª doc æ è¯ä¸º deleted ç¶æï¼é£ä¹æç´¢çæ¶åæ ¹æ® .del æä»¶å°±ç¥éè¿ä¸ª doc æ¯å¦è¢«å é¤äºã\n\nå¦ææ¯æ´æ°æä½ï¼å°±æ¯å°åæ¥ç doc æ è¯ä¸º deleted ç¶æï¼ç¶åæ°åå¥ä¸æ¡æ°æ®ã\n\nbuffer æ¯ refresh ä¸æ¬¡ï¼å°±ä¼äº§çä¸ä¸ª segment file ï¼æä»¥é»è®¤æåµä¸æ¯ 1 ç§éä¸ä¸ª segment file ï¼è¿æ ·ä¸æ¥ segment file ä¼è¶æ¥è¶å¤ï¼æ­¤æ¶ä¼å®ææ§è¡ mergeãæ¯æ¬¡ merge çæ¶åï¼ä¼å°å¤ä¸ª segment file åå¹¶æä¸ä¸ªï¼åæ¶è¿éä¼å°æ è¯ä¸º deleted ç doc ç»ç©çå é¤æï¼ç¶åå°æ°ç segment file åå¥ç£çï¼è¿éä¼åä¸ä¸ª commit point ï¼æ è¯æææ°ç segment file ï¼ç¶åæå¼ segment file ä¾æç´¢ä½¿ç¨ï¼åæ¶å é¤æ§ç segment file ã\n\n\n# åºå± lucene\n\nç®åæ¥è¯´ï¼lucene å°±æ¯ä¸ä¸ª jar åï¼éé¢åå«äºå°è£å¥½çåç§å»ºç«åæç´¢å¼çç®æ³ä»£ç ãæä»¬ç¨ Java å¼åçæ¶åï¼å¼å¥ lucene jarï¼ç¶ååºäº lucene ç api å»å¼åå°±å¯ä»¥äºã\n\néè¿ luceneï¼æä»¬å¯ä»¥å°å·²æçæ°æ®å»ºç«ç´¢å¼ï¼lucene ä¼å¨æ¬å°ç£çä¸é¢ï¼ç»æä»¬ç»ç»ç´¢å¼çæ°æ®ç»æã\n\n\n# åæç´¢å¼\n\nå¨æç´¢å¼æä¸­ï¼æ¯ä¸ªææ¡£é½æä¸ä¸ªå¯¹åºçææ¡£ IDï¼ææ¡£åå®¹è¢«è¡¨ç¤ºä¸ºä¸ç³»åå³é®è¯çéåãä¾å¦ï¼ææ¡£ 1 ç»è¿åè¯ï¼æåäº 20 ä¸ªå³é®è¯ï¼æ¯ä¸ªå³é®è¯é½ä¼è®°å½å®å¨ææ¡£ä¸­åºç°çæ¬¡æ°ååºç°ä½ç½®ã\n\né£ä¹ï¼åæç´¢å¼å°±æ¯å³é®è¯å°ææ¡£ ID çæ å°ï¼æ¯ä¸ªå³é®è¯é½å¯¹åºçä¸ç³»åçæä»¶ï¼è¿äºæä»¶ä¸­é½åºç°äºå³é®è¯ã\n\nä¸¾ä¸ªæ å­ã\n\næä»¥ä¸ææ¡£ï¼\n\nDOCID   DOC\n1       è°·æ­å°å¾ä¹ç¶è·³æ§½ Facebook\n2       è°·æ­å°å¾ä¹ç¶å ç Facebook\n3       è°·æ­å°å¾åå§äººææ¯ç¦»å¼è°·æ­å ç Facebook\n4       è°·æ­å°å¾ä¹ç¶è·³æ§½ Facebook ä¸ Wave é¡¹ç®åæ¶æå³\n5       è°·æ­å°å¾ä¹ç¶ææ¯å çç¤¾äº¤ç½ç« Facebook\n\nå¯¹ææ¡£è¿è¡åè¯ä¹åï¼å¾å°ä»¥ä¸åæç´¢å¼ã\n\nWORDID   WORD       DOCIDS\n1        è°·æ­         1, 2, 3, 4, 5\n2        å°å¾         1, 2, 3, 4, 5\n3        ä¹ç¶         1, 2, 4, 5\n4        è·³æ§½         1, 4\n5        Facebook   1, 2, 3, 4, 5\n6        å ç         2, 3, 5\n7        åå§äºº        3\n8        ææ¯         3, 5\n9        ç¦»å¼         3\n10       ä¸          4\n..       ..         ..\n\nå¦å¤ï¼å®ç¨çåæç´¢å¼è¿å¯ä»¥è®°å½æ´å¤çä¿¡æ¯ï¼æ¯å¦ææ¡£é¢çä¿¡æ¯ï¼è¡¨ç¤ºå¨ææ¡£éåä¸­æå¤å°ä¸ªææ¡£åå«æä¸ªåè¯ã\n\né£ä¹ï¼æäºåæç´¢å¼ï¼æç´¢å¼æå¯ä»¥å¾æ¹ä¾¿å°ååºç¨æ·çæ¥è¯¢ãæ¯å¦ç¨æ·è¾å¥æ¥è¯¢ Facebook ï¼æç´¢ç³»ç»æ¥æ¾åæç´¢å¼ï¼ä»ä¸­è¯»åºåå«è¿ä¸ªåè¯çææ¡£ï¼è¿äºææ¡£å°±æ¯æä¾ç»ç¨æ·çæç´¢ç»æã\n\nè¦æ³¨æåæç´¢å¼çä¸¤ä¸ªéè¦ç»èï¼\n\n * åæç´¢å¼ä¸­çææè¯é¡¹å¯¹åºä¸ä¸ªæå¤ä¸ªææ¡£ï¼\n * åæç´¢å¼ä¸­çè¯é¡¹æ ¹æ®å­å¸é¡ºåºååºæå\n\n> ä¸é¢åªæ¯ä¸ä¸ªç®åçæ å­ï¼å¹¶æ²¡æä¸¥æ ¼æç§å­å¸é¡ºåºååºæåã\n\n\n# elasticsearch çåæç´¢å¼æ¯ä»ä¹\n\né¢è¯å®ï¼æ³äºè§£ä½ å¯¹åºç¡æ¦å¿µçè®¤ç¥ã\n\nè§£ç­ï¼éä¿è§£éä¸ä¸å°±å¯ä»¥ã\n\nä¼ ç»çæä»¬çæ£ç´¢æ¯éè¿æç« ï¼éä¸ªéåæ¾å°å¯¹åºå³é®è¯çä½ç½®ã\n\nèåæç´¢å¼ï¼æ¯éè¿åè¯ç­ç¥ï¼å½¢æäºè¯åæç« çæ å°å³ç³»è¡¨ï¼è¿ç§è¯å¸+æ å°è¡¨å³ä¸ºåæç´¢å¼ãæäºåæç´¢å¼ï¼å°±è½å®ç° oï¼1ï¼æ¶é´å¤æåº¦çæçæ£ç´¢æç« äºï¼æå¤§çæé«äºæ£ç´¢æçã\n\n\n\nå­¦æ¯çè§£ç­æ¹å¼ï¼\n\nåæç´¢å¼ï¼ç¸åäºä¸ç¯æç« åå«äºåªäºè¯ï¼å®ä»è¯åºåï¼è®°è½½äºè¿ä¸ªè¯å¨åªäºææ¡£ä¸­åºç°è¿ï¼ç±ä¸¤é¨åç»æââè¯å¸ååæè¡¨ã\n\nå åé¡¹ï¼åæç´¢å¼çåºå±å®ç°æ¯åºäºï¼FSTï¼Finite State Transducerï¼æ°æ®ç»æã\n\nlucene ä» 4+çæ¬åå¼å§å¤§éä½¿ç¨çæ°æ®ç»ææ¯ FSTãFST æä¸¤ä¸ªä¼ç¹ï¼\n\nï¼1ï¼ç©ºé´å ç¨å°ãéè¿å¯¹è¯å¸ä¸­åè¯åç¼ååç¼çéå¤å©ç¨ï¼åç¼©äºå­å¨ç©ºé´ï¼\n\nï¼2ï¼æ¥è¯¢éåº¦å¿«ãO(len(str))çæ¥è¯¢æ¶é´å¤æåº¦ã\n\n\n# 3ãelasticsearch ç´¢å¼æ°æ®å¤äºæä¹åï¼å¦ä½è°ä¼ï¼é¨ç½²\n\né¢è¯å®ï¼æ³äºè§£å¤§æ°æ®éçè¿ç»´è½åã\n\nè§£ç­ï¼ç´¢å¼æ°æ®çè§åï¼åºå¨åæåå¥½è§åï¼æ­£æè°âè®¾è®¡åè¡ï¼ç¼ç å¨åâï¼è¿æ ·æè½ææçé¿åçªå¦å¶æ¥çæ°æ®æ¿å¢å¯¼è´éç¾¤å¤çè½åä¸è¶³å¼åççº¿ä¸å®¢æ·æ£ç´¢æèå¶ä»ä¸å¡åå°å½±åã\n\nå¦ä½è°ä¼ï¼æ­£å¦é®é¢ 1 æè¯´ï¼è¿éç»åä¸ä¸ï¼\n\n3.1 å¨æç´¢å¼å±é¢\n\nåºäºæ¨¡æ¿+æ¶é´+rollover api æ»å¨åå»ºç´¢å¼ï¼ä¸¾ä¾ï¼è®¾è®¡é¶æ®µå®ä¹ï¼blog ç´¢å¼çæ¨¡æ¿æ ¼å¼ä¸ºï¼blogindexæ¶é´æ³çå½¢å¼ï¼æ¯å¤©éå¢æ°æ®ãè¿æ ·åçå¥½å¤ï¼ä¸è³äºæ°æ®éæ¿å¢å¯¼è´åä¸ªç´¢å¼æ°æ®ééå¸¸å¤§ï¼æ¥è¿äºä¸çº¿ 2 ç 32 æ¬¡å¹-1ï¼ç´¢å¼å­å¨è¾¾å°äº TB+çè³æ´å¤§ã\n\nä¸æ¦åä¸ªç´¢å¼å¾å¤§ï¼å­å¨ç­åç§é£é©ä¹éä¹èæ¥ï¼æä»¥è¦æåèè+åæ©é¿åã\n\n3.2 å­å¨å±é¢\n\nå·ç­æ°æ®åç¦»å­å¨ï¼ç­æ°æ®ï¼æ¯å¦æè¿ 3 å¤©æèä¸å¨çæ°æ®ï¼ï¼å¶ä½ä¸ºå·æ°æ®ã\n\nå¯¹äºå·æ°æ®ä¸ä¼ååå¥æ°æ°æ®ï¼å¯ä»¥èèå®æ force_merge å  shrink åç¼©æä½ï¼èçå­å¨ç©ºé´åæ£ç´¢æçã\n\n3.3 é¨ç½²å±é¢\n\nä¸æ¦ä¹åæ²¡æè§åï¼è¿éå°±å±äºåºæ¥ç­ç¥ã\n\nç»å ES èªèº«çæ¯æå¨ææ©å±çç¹ç¹ï¼å¨ææ°å¢æºå¨çæ¹å¼å¯ä»¥ç¼è§£éç¾¤ååï¼æ³¨æï¼å¦æä¹åä¸»èç¹ç­è§ååçï¼ä¸éè¦éå¯éç¾¤ä¹è½å®æå¨ææ°å¢çã\n\n\n# 4ãelasticsearch æ¯å¦ä½å®ç° master éä¸¾ç\n\né¢è¯å®ï¼æ³äºè§£ ES éç¾¤çåºå±åçï¼ä¸ååªå³æ³¨ä¸å¡å±é¢äºã\n\nè§£ç­ï¼\n\nåç½®åæï¼\n\nï¼1ï¼åªæåéä¸»èç¹ï¼masterï¼trueï¼çèç¹æè½æä¸ºä¸»èç¹ã\n\nï¼2ï¼æå°ä¸»èç¹æ°ï¼min_master_nodesï¼çç®çæ¯é²æ­¢èè£ã\n\næ ¸å¯¹äºä¸ä¸ä»£ç ï¼æ ¸å¿å¥å£ä¸º findMasterï¼éæ©ä¸»èç¹æåè¿åå¯¹åº Masterï¼å¦åè¿å nullãéä¸¾æµç¨å¤§è´æè¿°å¦ä¸ï¼\n\nç¬¬ä¸æ­¥ï¼ç¡®è®¤åéä¸»èç¹æ°è¾¾æ ï¼elasticsearch.yml è®¾ç½®çå¼\n\ndiscovery.zen.minimum_master_nodesï¼\n\nç¬¬äºæ­¥ï¼æ¯è¾ï¼åå¤å®æ¯å¦å·å¤ master èµæ ¼ï¼å·å¤åéä¸»èç¹èµæ ¼çä¼åè¿åï¼\n\nè¥ä¸¤èç¹é½ä¸ºåéä¸»èç¹ï¼å id å°çå¼ä¼ä¸»èç¹ãæ³¨æè¿éç id ä¸º string ç±»åã\n\né¢å¤è¯ï¼è·åèç¹ id çæ¹æ³ã\n\n1GET /_cat/nodes?v&amp;h=ip,port,heapPercent,heapMax,id,name\n\n2ip port heapPercent heapMax id name\n\n\n\n# è¯¦ç»æè¿°ä¸ä¸ Elasticsearch ç´¢å¼ææ¡£çè¿ç¨\n\né¢è¯å®ï¼æ³äºè§£ ES çåºå±åçï¼ä¸ååªå³æ³¨ä¸å¡å±é¢äºã\n\nè§£ç­ï¼\n\nè¿éçç´¢å¼ææ¡£åºè¯¥çè§£ä¸ºææ¡£åå¥ ESï¼åå»ºç´¢å¼çè¿ç¨ã\n\nææ¡£åå¥åå«ï¼åææ¡£åå¥åæ¹é bulk åå¥ï¼è¿éåªè§£éä¸ä¸ï¼åææ¡£åå¥æµç¨ã\n\nè®°ä½å®æ¹ææ¡£ä¸­çè¿ä¸ªå¾ã\n\n\n\nç¬¬ä¸æ­¥ï¼å®¢æ·åéç¾¤æèç¹åå¥æ°æ®ï¼åéè¯·æ±ãï¼å¦ææ²¡ææå®è·¯ç±/åè°èç¹ï¼è¯·æ±çèç¹æ®æ¼è·¯ç±èç¹çè§è²ãï¼\n\nç¬¬äºæ­¥ï¼èç¹ 1 æ¥åå°è¯·æ±åï¼ä½¿ç¨ææ¡£_id æ¥ç¡®å®ææ¡£å±äºåç 0ãè¯·æ±ä¼è¢«è½¬å°å¦å¤çèç¹ï¼åå®èç¹ 3ãå æ­¤åç 0 çä¸»åçåéå°èç¹ 3 ä¸ã\n\nç¬¬ä¸æ­¥ï¼èç¹ 3 å¨ä¸»åçä¸æ§è¡åæä½ï¼å¦ææåï¼åå°è¯·æ±å¹¶è¡è½¬åå°èç¹ 1 åèç¹ 2 çå¯æ¬åçä¸ï¼ç­å¾ç»æè¿åãææçå¯æ¬åçé½æ¥åæåï¼èç¹ 3 å°ååè°èç¹ï¼èç¹ 1ï¼æ¥åæåï¼èç¹ 1 åè¯·æ±å®¢æ·ç«¯æ¥ååå¥æåã\n\nå¦æé¢è¯å®åé®ï¼ç¬¬äºæ­¥ä¸­çææ¡£è·ååççè¿ç¨ï¼\n\nåç­ï¼åå©è·¯ç±ç®æ³è·åï¼è·¯ç±ç®æ³å°±æ¯æ ¹æ®è·¯ç±åææ¡£ id è®¡ç®ç®æ çåç id çè¿ç¨ã\n\n1shard = hash(_routing) % (num_of_primary_shards)\n\n\n\n# è¯¦ç»æè¿°ä¸ä¸ Elasticsearch æç´¢çè¿ç¨ï¼\n\né¢è¯å®ï¼æ³äºè§£ ES æç´¢çåºå±åçï¼ä¸ååªå³æ³¨ä¸å¡å±é¢äºã\n\nè§£ç­ï¼\n\næç´¢æè§£ä¸ºâquery then fetchâ ä¸¤ä¸ªé¶æ®µã\n\nquery é¶æ®µçç®çï¼å®ä½å°ä½ç½®ï¼ä½ä¸åã\n\næ­¥éª¤æè§£å¦ä¸ï¼\n\nï¼1ï¼åè®¾ä¸ä¸ªç´¢å¼æ°æ®æ 5 ä¸»+1 å¯æ¬ å± 10 åçï¼ä¸æ¬¡è¯·æ±ä¼å½ä¸­ï¼ä¸»æèå¯æ¬åçä¸­ï¼çä¸ä¸ªã\n\nï¼2ï¼æ¯ä¸ªåçå¨æ¬å°è¿è¡æ¥è¯¢ï¼ç»æè¿åå°æ¬å°æåºçä¼åéåä¸­ã\n\nï¼3ï¼ç¬¬ 2ï¼æ­¥éª¤çç»æåéå°åè°èç¹ï¼åè°èç¹äº§çä¸ä¸ªå¨å±çæåºåè¡¨ã\n\nfetch é¶æ®µçç®çï¼åæ°æ®ã\n\nè·¯ç±èç¹è·åææææ¡£ï¼è¿åç»å®¢æ·ç«¯ã\n\n\n# Elasticsearch å¨é¨ç½²æ¶ï¼å¯¹ Linux çè®¾ç½®æåªäºä¼åæ¹æ³\n\né¢è¯å®ï¼æ³äºè§£å¯¹ ES éç¾¤çè¿ç»´è½åã\n\nè§£ç­ï¼\n\nï¼1ï¼å³é­ç¼å­ swap;\n\nï¼2ï¼å åå­è®¾ç½®ä¸ºï¼Minï¼èç¹åå­/2, 32GBï¼;\n\nï¼3ï¼è®¾ç½®æå¤§æä»¶å¥ææ°ï¼\n\nï¼4ï¼çº¿ç¨æ± +éåå¤§å°æ ¹æ®ä¸å¡éè¦åè°æ´ï¼\n\nï¼5ï¼ç£çå­å¨ raid æ¹å¼ââå­å¨ææ¡ä»¶ä½¿ç¨ RAID10ï¼å¢å åèç¹æ§è½ä»¥åé¿ååèç¹å­å¨æéã\n\n\n# lucence åé¨ç»ææ¯ä»ä¹ï¼\n\né¢è¯å®ï¼æ³äºè§£ä½ çç¥è¯é¢çå¹¿åº¦åæ·±åº¦ã\n\nè§£ç­ï¼\n\n\n\nLucene æ¯æç´¢å¼åæç´¢çä¸¤ä¸ªè¿ç¨ï¼åå«ç´¢å¼åå»ºï¼ç´¢å¼ï¼æç´¢ä¸ä¸ªè¦ç¹ãå¯ä»¥åºäºè¿ä¸ªèç»å±å¼ä¸äºã\n\n\n# Elasticsearch æ¯å¦ä½å®ç° Master éä¸¾çï¼\n\nï¼1ï¼Elasticsearch çéä¸»æ¯ ZenDiscovery æ¨¡åè´è´£çï¼ä¸»è¦åå« Pingï¼èç¹ä¹é´éè¿è¿ä¸ª RPC æ¥åç°å½¼æ­¤ï¼å Unicastï¼åæ­æ¨¡ååå«ä¸ä¸ªä¸»æºåè¡¨ä»¥æ§å¶åªäºèç¹éè¦ ping éï¼è¿ä¸¤é¨åï¼\n\nï¼2ï¼å¯¹ææå¯ä»¥æä¸º master çèç¹ï¼node.master: trueï¼æ ¹æ® nodeId å­å¸æåºï¼æ¯æ¬¡éä¸¾æ¯ä¸ªèç¹é½æèªå·±æç¥éèç¹æä¸æ¬¡åºï¼ç¶åéåºç¬¬ä¸ä¸ªï¼ç¬¬ 0 ä½ï¼èç¹ï¼æä¸è®¤ä¸ºå®æ¯ master èç¹ã\n\nï¼3ï¼å¦æå¯¹æä¸ªèç¹çæç¥¨æ°è¾¾å°ä¸å®çå¼ï¼å¯ä»¥æä¸º master èç¹æ° n/2+1ï¼å¹¶ä¸è¯¥èç¹èªå·±ä¹éä¸¾èªå·±ï¼é£è¿ä¸ªèç¹å°±æ¯ masterãå¦åéæ°éä¸¾ä¸ç´å°æ»¡è¶³ä¸è¿°æ¡ä»¶ã\n\nï¼4ï¼è¡¥åï¼master èç¹çèè´£ä¸»è¦åæ¬éç¾¤ãèç¹åç´¢å¼çç®¡çï¼ä¸è´è´£ææ¡£çº§å«çç®¡çï¼data èç¹å¯ä»¥å³é­ http åè½*ã\n\n\n# 10ãElasticsearch ä¸­çèç¹ï¼æ¯å¦å± 20 ä¸ªï¼ï¼å¶ä¸­ç 10 ä¸ª\n\néäºä¸ä¸ª masterï¼å¦å¤ 10 ä¸ªéäºå¦ä¸ä¸ª masterï¼æä¹åï¼\n\nï¼1ï¼å½éç¾¤ master åéæ°éä¸å°äº 3 ä¸ªæ¶ï¼å¯ä»¥éè¿è®¾ç½®æå°æç¥¨éè¿æ°éï¼discovery.zen.minimum_master_nodesï¼è¶è¿ææåéèç¹ä¸åä»¥ä¸æ¥è§£å³èè£é®é¢ï¼\n\nï¼3ï¼å½åéæ°éä¸ºä¸¤ä¸ªæ¶ï¼åªè½ä¿®æ¹ä¸ºå¯ä¸çä¸ä¸ª master åéï¼å¶ä»ä½ä¸º data èç¹ï¼é¿åèè£é®é¢ã\n\n\n# å®¢æ·ç«¯å¨åéç¾¤è¿æ¥æ¶ï¼å¦ä½éæ©ç¹å®çèç¹æ§è¡è¯·æ±çï¼\n\nTransportClient å©ç¨ transport æ¨¡åè¿ç¨è¿æ¥ä¸ä¸ª elasticsearch éç¾¤ãå®å¹¶ä¸å å¥å°éç¾¤ä¸­ï¼åªæ¯ç®åçè·å¾ä¸ä¸ªæèå¤ä¸ªåå§åç transport å°åï¼å¹¶ä»¥ è½®è¯¢ çæ¹å¼ä¸è¿äºå°åè¿è¡éä¿¡ã\n\n\n# è¯¦ç»æè¿°ä¸ä¸ Elasticsearch ç´¢å¼ææ¡£çè¿ç¨ã\n\nåè°èç¹é»è®¤ä½¿ç¨ææ¡£ ID åä¸è®¡ç®ï¼ä¹æ¯æéè¿ routingï¼ï¼ä»¥ä¾¿ä¸ºè·¯ç±æä¾åéçåçã\n\nshard = hash(document_id) % (num_of_primary_shards)\n\n\nï¼1ï¼å½åçæå¨çèç¹æ¥æ¶å°æ¥èªåè°èç¹çè¯·æ±åï¼ä¼å°è¯·æ±åå¥å° MemoryBufferï¼ç¶åå®æ¶ï¼é»è®¤æ¯æ¯é 1 ç§ï¼åå¥å° Filesystem Cacheï¼è¿ä¸ªä» MomeryBuffer å° Filesystem Cache çè¿ç¨å°±å«å refreshï¼\n\nï¼2ï¼å½ç¶å¨æäºæåµä¸ï¼å­å¨ Momery Buffer å Filesystem Cache çæ°æ®å¯è½ä¼ä¸¢å¤±ï¼ES æ¯éè¿ translog çæºå¶æ¥ä¿è¯æ°æ®çå¯é æ§çãå¶å®ç°æºå¶æ¯æ¥æ¶å°è¯·æ±åï¼åæ¶ä¹ä¼åå¥å° translog ä¸­ ï¼å½ Filesystem cache ä¸­çæ°æ®åå¥å°ç£çä¸­æ¶ï¼æä¼æ¸é¤æï¼è¿ä¸ªè¿ç¨å«å flushï¼\n\nï¼3ï¼å¨ flush è¿ç¨ä¸­ï¼åå­ä¸­çç¼å²å°è¢«æ¸é¤ï¼åå®¹è¢«åå¥ä¸ä¸ªæ°æ®µï¼æ®µç fsync å°åå»ºä¸ä¸ªæ°çæäº¤ç¹ï¼å¹¶å°åå®¹å·æ°å°ç£çï¼æ§ç translog å°è¢«å é¤å¹¶å¼å§ä¸ä¸ªæ°ç translogã\n\nï¼4ï¼flush è§¦åçæ¶æºæ¯å®æ¶è§¦åï¼é»è®¤ 30 åéï¼æè translog åå¾å¤ªå¤§ï¼é»è®¤ä¸º 512Mï¼æ¶ï¼\n\n\n\nè¡¥åï¼å³äº Lucene ç Segementï¼\n\nï¼1ï¼Lucene ç´¢å¼æ¯ç±å¤ä¸ªæ®µç»æï¼æ®µæ¬èº«æ¯ä¸ä¸ªåè½é½å¨çåæç´¢å¼ã\n\nï¼2ï¼æ®µæ¯ä¸å¯åçï¼åè®¸ Lucene å°æ°çææ¡£å¢éå°æ·»å å°ç´¢å¼ä¸­ï¼èä¸ç¨ä»å¤´éå»ºç´¢å¼ã\n\nï¼3ï¼å¯¹äºæ¯ä¸ä¸ªæç´¢è¯·æ±èè¨ï¼ç´¢å¼ä¸­çæææ®µé½ä¼è¢«æç´¢ï¼å¹¶ä¸æ¯ä¸ªæ®µä¼æ¶è CPU çæ¶éå¨ãæä»¶å¥æååå­ãè¿æå³çæ®µçæ°éè¶å¤ï¼æç´¢æ§è½ä¼è¶ä½ã\n\nï¼4ï¼ä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼Elasticsearch ä¼åå¹¶å°æ®µå°ä¸ä¸ªè¾å¤§çæ®µï¼æäº¤æ°çåå¹¶æ®µå°ç£çï¼å¹¶å é¤é£äºæ§çå°æ®µã\n\n\n# è¯¦ç»æè¿°ä¸ä¸ Elasticsearch æ´æ°åå é¤ææ¡£çè¿ç¨ã\n\nï¼1ï¼å é¤åæ´æ°ä¹é½æ¯åæä½ï¼ä½æ¯ Elasticsearch ä¸­çææ¡£æ¯ä¸å¯åçï¼å æ­¤ä¸è½è¢«å é¤æèæ¹å¨ä»¥å±ç¤ºå¶åæ´ï¼\n\nï¼2ï¼ç£çä¸çæ¯ä¸ªæ®µé½æä¸ä¸ªç¸åºç.del æä»¶ãå½å é¤è¯·æ±åéåï¼ææ¡£å¹¶æ²¡æççè¢«å é¤ï¼èæ¯å¨.del æä»¶ä¸­è¢«æ è®°ä¸ºå é¤ãè¯¥ææ¡£ä¾ç¶è½å¹éæ¥è¯¢ï¼ä½æ¯ä¼å¨ç»æä¸­è¢«è¿æ»¤æãå½æ®µåå¹¶æ¶ï¼å¨.del æä»¶ä¸­è¢«æ è®°ä¸ºå é¤çææ¡£å°ä¸ä¼è¢«åå¥æ°æ®µã\n\nï¼3ï¼å¨æ°çææ¡£è¢«åå»ºæ¶ï¼Elasticsearch ä¼ä¸ºè¯¥ææ¡£æå®ä¸ä¸ªçæ¬å·ï¼å½æ§è¡æ´æ°æ¶ï¼æ§çæ¬çææ¡£å¨.del æä»¶ä¸­è¢«æ è®°ä¸ºå é¤ï¼æ°çæ¬çææ¡£è¢«ç´¢å¼å°ä¸ä¸ªæ°æ®µãæ§çæ¬çææ¡£ä¾ç¶è½å¹éæ¥è¯¢ï¼ä½æ¯ä¼å¨ç»æä¸­è¢«è¿æ»¤æã\n\n\n# è¯¦ç»æè¿°ä¸ä¸ Elasticsearch æç´¢çè¿ç¨ã\n\nï¼1ï¼æç´¢è¢«æ§è¡æä¸ä¸ªä¸¤é¶æ®µè¿ç¨ï¼æä»¬ç§°ä¹ä¸º Query Then Fetchï¼\n\nï¼2ï¼å¨åå§æ¥è¯¢é¶æ®µæ¶ï¼æ¥è¯¢ä¼å¹¿æ­å°ç´¢å¼ä¸­æ¯ä¸ä¸ªåçæ·è´ï¼ä¸»åçæèå¯æ¬åçï¼ã æ¯ä¸ªåçå¨æ¬å°æ§è¡æç´¢å¹¶æå»ºä¸ä¸ªå¹éææ¡£çå¤§å°ä¸º from + size çä¼åéåã\n\nPSï¼å¨æç´¢çæ¶åæ¯ä¼æ¥è¯¢ Filesystem Cache çï¼ä½æ¯æé¨åæ°æ®è¿å¨ MemoryBufferï¼æä»¥æç´¢æ¯è¿å®æ¶çã\n\nï¼3ï¼æ¯ä¸ªåçè¿ååèªä¼åéåä¸­ ææææ¡£ç ID åæåºå¼ ç»åè°èç¹ï¼å®åå¹¶è¿äºå¼å°èªå·±çä¼åéåä¸­æ¥äº§çä¸ä¸ªå¨å±æåºåçç»æåè¡¨ã\n\nï¼4ï¼æ¥ä¸æ¥å°±æ¯ ååé¶æ®µï¼åè°èç¹è¾¨å«åºåªäºææ¡£éè¦è¢«ååå¹¶åç¸å³çåçæäº¤å¤ä¸ª GET è¯·æ±ãæ¯ä¸ªåçå è½½å¹¶ ä¸° å¯ ææ¡£ï¼å¦ææéè¦çè¯ï¼æ¥çè¿åææ¡£ç»åè°èç¹ãä¸æ¦ææçææ¡£é½è¢«ååäºï¼åè°èç¹è¿åç»æç»å®¢æ·ç«¯ã\n\nï¼5ï¼è¡¥åï¼Query Then Fetch çæç´¢ç±»åå¨ææ¡£ç¸å³æ§æåçæ¶ååèçæ¯æ¬åççæ°æ®ï¼è¿æ ·å¨ææ¡£æ°éè¾å°çæ¶åå¯è½ä¸å¤åç¡®ï¼DFS Query Then Fetch å¢å äºä¸ä¸ªé¢æ¥è¯¢çå¤çï¼è¯¢é® Term å Document frequencyï¼è¿ä¸ªè¯åæ´åç¡®ï¼ä½æ¯æ§è½ä¼åå·®ã*\n\n\n\n\n# å¨ Elasticsearch ä¸­ï¼æ¯æä¹æ ¹æ®ä¸ä¸ªè¯æ¾å°å¯¹åºçåæç´¢å¼çï¼\n\nï¼1ï¼Lucene çç´¢å¼è¿ç¨ï¼å°±æ¯æç§å¨ææ£ç´¢çåºæ¬è¿ç¨ï¼å°åæè¡¨åææ­¤æä»¶æ ¼å¼çè¿ç¨ã\n\nï¼2ï¼Lucene çæç´¢è¿ç¨ï¼å°±æ¯æç§æ­¤æä»¶æ ¼å¼å°ç´¢å¼è¿å»çä¿¡æ¯è¯»åºæ¥ï¼ç¶åè®¡ç®æ¯ç¯ææ¡£æå(score)çè¿ç¨ã\n\n\n# Elasticsearch å¨é¨ç½²æ¶ï¼å¯¹ Linux çè®¾ç½®æåªäºä¼åæ¹æ³ï¼\n\nï¼1ï¼64 GB åå­çæºå¨æ¯éå¸¸çæ³çï¼ ä½æ¯ 32 GB å 16 GB æºå¨ä¹æ¯å¾å¸¸è§çãå°äº 8 GB ä¼éå¾å¶åã\n\nï¼2ï¼å¦æä½ è¦å¨æ´å¿«ç CPUs åæ´å¤çæ ¸å¿ä¹é´éæ©ï¼éæ©æ´å¤çæ ¸å¿æ´å¥½ãå¤ä¸ªåæ ¸æä¾çé¢å¤å¹¶åè¿èè¿ç¨å¾®å¿«ä¸ç¹ç¹çæ¶éé¢çã\n\nï¼3ï¼å¦æä½ è´æå¾èµ· SSDï¼å®å°è¿è¿è¶åºä»»ä½æè½¬ä»è´¨ã åºäº SSD çèç¹ï¼æ¥è¯¢åç´¢å¼æ§è½é½ææåãå¦æä½ è´æå¾èµ·ï¼SSD æ¯ä¸ä¸ªå¥½çéæ©ã\n\nï¼4ï¼å³ä½¿æ°æ®ä¸­å¿ä»¬è¿å¨å«å°ºï¼ä¹è¦é¿åéç¾¤è·¨è¶å¤ä¸ªæ°æ®ä¸­å¿ãç»å¯¹è¦é¿åéç¾¤è·¨è¶å¤§çå°çè·ç¦»ã\n\nï¼5ï¼è¯·ç¡®ä¿è¿è¡ä½ åºç¨ç¨åºç JVM åæå¡å¨ç JVM æ¯å®å¨ä¸æ ·çã å¨ Elasticsearch çå ä¸ªå°æ¹ï¼ä½¿ç¨ Java çæ¬å°åºååã\n\nï¼6ï¼éè¿è®¾ç½® gateway.recover_after_nodesãgateway.expected_nodesãgateway.recover_after_time å¯ä»¥å¨éç¾¤éå¯çæ¶åé¿åè¿å¤çåçäº¤æ¢ï¼è¿å¯è½ä¼è®©æ°æ®æ¢å¤ä»æ°ä¸ªå°æ¶ç¼©ç­ä¸ºå ç§éã\n\nï¼7ï¼Elasticsearch é»è®¤è¢«éç½®ä¸ºä½¿ç¨åæ­åç°ï¼ä»¥é²æ­¢èç¹æ æä¸­å å¥éç¾¤ãåªæå¨åä¸å°æºå¨ä¸è¿è¡çèç¹æä¼èªå¨ç»æéç¾¤ãæå¥½ä½¿ç¨åæ­ä»£æ¿ç»æ­ã\n\nï¼8ï¼ä¸è¦éæä¿®æ¹åå¾åæ¶å¨ï¼CMSï¼ååä¸ªçº¿ç¨æ± çå¤§å°ã\n\nï¼9ï¼æä½ çåå­çï¼å°äºï¼ä¸åç» Luceneï¼ä½ä¸è¦è¶è¿ 32 GBï¼ï¼ï¼éè¿ ES_HEAP_SIZE ç¯å¢åéè®¾ç½®ã\n\nï¼10ï¼åå­äº¤æ¢å°ç£çå¯¹æå¡å¨æ§è½æ¥è¯´æ¯è´å½çãå¦æåå­äº¤æ¢å°ç£çä¸ï¼ä¸ä¸ª 100 å¾®ç§çæä½å¯è½åæ 10 æ¯«ç§ã åæ³æ³é£ä¹å¤ 10 å¾®ç§çæä½æ¶å»¶ç´¯å èµ·æ¥ã ä¸é¾çåº swapping å¯¹äºæ§è½æ¯å¤ä¹å¯æã\n\nï¼11ï¼Lucene ä½¿ç¨äºå¤§ é çæä»¶ãåæ¶ï¼Elasticsearch å¨èç¹å HTTP å®¢æ·ç«¯ä¹é´è¿è¡éä¿¡ä¹ä½¿ç¨äºå¤§éçå¥æ¥å­ã ææè¿ä¸åé½éè¦è¶³å¤çæä»¶æè¿°ç¬¦ãä½ åºè¯¥å¢å ä½ çæä»¶æè¿°ç¬¦ï¼è®¾ç½®ä¸ä¸ªå¾å¤§çå¼ï¼å¦ 64,000ã\n\nè¡¥åï¼ç´¢å¼é¶æ®µæ§è½æåæ¹æ³\n\nï¼1ï¼ä½¿ç¨æ¹éè¯·æ±å¹¶è°æ´å¶å¤§å°ï¼æ¯æ¬¡æ¹éæ°æ® 5â15 MB å¤§æ¯ä¸ªä¸éçèµ·å§ç¹ã\n\nï¼2ï¼å­å¨ï¼ä½¿ç¨ SSD\n\nï¼3ï¼æ®µååå¹¶ï¼Elasticsearch é»è®¤å¼æ¯ 20 MB/sï¼å¯¹æºæ¢°ç£çåºè¯¥æ¯ä¸ªä¸éçè®¾ç½®ãå¦æä½ ç¨çæ¯ SSDï¼å¯ä»¥èèæé«å° 100â200 MB/sãå¦æä½ å¨åæ¹éå¯¼å¥ï¼å®å¨ä¸å¨ææç´¢ï¼ä½ å¯ä»¥å½»åºå³æåå¹¶éæµãå¦å¤è¿å¯ä»¥å¢å  index.translog.flush_threshold_size è®¾ç½®ï¼ä»é»è®¤ç 512 MB å°æ´å¤§ä¸äºçå¼ï¼æ¯å¦ 1 GBï¼è¿å¯ä»¥å¨ä¸æ¬¡æ¸ç©ºè§¦åçæ¶åå¨äºå¡æ¥å¿éç§¯ç´¯åºæ´å¤§çæ®µã\n\nï¼4ï¼å¦æä½ çæç´¢ç»æä¸éè¦è¿å®æ¶çåç¡®åº¦ï¼èèææ¯ä¸ªç´¢å¼ç index.refresh_interval æ¹å° 30sã\n\nï¼5ï¼å¦æä½ å¨åå¤§æ¹éå¯¼å¥ï¼èèéè¿è®¾ç½® index.number_of_replicas: 0 å³é­å¯æ¬ã\n\n\n# å¯¹äº GC æ¹é¢ï¼å¨ä½¿ç¨ Elasticsearch æ¶è¦æ³¨æä»ä¹ï¼\n\nï¼1ï¼åæè¯å¸çç´¢å¼éè¦å¸¸é©»åå­ï¼æ æ³ GCï¼éè¦çæ§ data node ä¸ segmentmemory å¢é¿è¶å¿ã\n\nï¼2ï¼åç±»ç¼å­ï¼field cache, filter cache, indexing cache, bulk queue ç­ç­ï¼è¦è®¾ç½®åççå¤§å°ï¼å¹¶ä¸è¦åºè¯¥æ ¹æ®æåçæåµæ¥ç heap æ¯å¦å¤ç¨ï¼ä¹å°±æ¯åç±»ç¼å­å¨é¨å æ»¡çæ¶åï¼è¿æ heap ç©ºé´å¯ä»¥åéç»å¶ä»ä»»å¡åï¼é¿åéç¨ clear cache ç­âèªæ¬ºæ¬ºäººâçæ¹å¼æ¥éæ¾åå­ã\n\nï¼3ï¼é¿åè¿åå¤§éç»æéçæç´¢ä¸èåãç¡®å®éè¦å¤§éæåæ°æ®çåºæ¯ï¼å¯ä»¥éç¨ scan & scroll api æ¥å®ç°ã\n\nï¼4ï¼cluster stats é©»çåå­å¹¶æ æ³æ°´å¹³æ©å±ï¼è¶å¤§è§æ¨¡éç¾¤å¯ä»¥èèåææå¤ä¸ªéç¾¤éè¿ tribe node è¿æ¥ã\n\nï¼5ï¼æ³ç¥é heap å¤ä¸å¤ï¼å¿é¡»ç»åå®éåºç¨åºæ¯ï¼å¹¶å¯¹éç¾¤ç heap ä½¿ç¨æåµåæç»­ççæ§ã\n\nï¼6ï¼æ ¹æ®çæ§æ°æ®çè§£åå­éæ±ï¼åçéç½®åç±» circuit breakerï¼å°åå­æº¢åºé£é©éä½å°æä½\n\n\n# 18ãElasticsearch å¯¹äºå¤§æ°æ®éï¼ä¸äº¿éçº§ï¼çèåå¦ä½å®ç°ï¼\n\nElasticsearch æä¾çé¦ä¸ªè¿ä¼¼èåæ¯ cardinality åº¦éãå®æä¾ä¸ä¸ªå­æ®µçåºæ°ï¼å³è¯¥å­æ®µç distinct æè unique å¼çæ°ç®ãå®æ¯åºäº HLL ç®æ³çãHLL ä¼åå¯¹æä»¬çè¾å¥ä½åå¸è¿ç®ï¼ç¶åæ ¹æ®åå¸è¿ç®çç»æä¸­ç bits åæ¦çä¼°ç®ä»èå¾å°åºæ°ãå¶ç¹ç¹æ¯ï¼å¯éç½®çç²¾åº¦ï¼ç¨æ¥æ§å¶åå­çä½¿ç¨ï¼æ´ç²¾ç¡® ï¼ æ´å¤åå­ï¼ï¼å°çæ°æ®éç²¾åº¦æ¯éå¸¸é«çï¼æä»¬å¯ä»¥éè¿éç½®åæ°ï¼æ¥è®¾ç½®å»ééè¦çåºå®åå­ä½¿ç¨éãæ è®ºæ°åè¿æ¯æ°åäº¿çå¯ä¸å¼ï¼åå­ä½¿ç¨éåªä¸ä½ éç½®çç²¾ç¡®åº¦ç¸å³ã\n\n\n# 19ãå¨å¹¶åæåµä¸ï¼Elasticsearch å¦æä¿è¯è¯»åä¸è´ï¼\n\nï¼1ï¼å¯ä»¥éè¿çæ¬å·ä½¿ç¨ä¹è§å¹¶åæ§å¶ï¼ä»¥ç¡®ä¿æ°çæ¬ä¸ä¼è¢«æ§çæ¬è¦çï¼ç±åºç¨å±æ¥å¤çå·ä½çå²çªï¼\n\nï¼2ï¼å¦å¤å¯¹äºåæä½ï¼ä¸è´æ§çº§å«æ¯æ quorum/one/allï¼é»è®¤ä¸º quorumï¼å³åªæå½å¤§å¤æ°åçå¯ç¨æ¶æåè®¸åæä½ãä½å³ä½¿å¤§å¤æ°å¯ç¨ï¼ä¹å¯è½å­å¨å ä¸ºç½ç»ç­åå å¯¼è´åå¥å¯æ¬å¤±è´¥ï¼è¿æ ·è¯¥å¯æ¬è¢«è®¤ä¸ºæéï¼åçå°ä¼å¨ä¸ä¸ªä¸åçèç¹ä¸éå»ºã\n\nï¼3ï¼å¯¹äºè¯»æä½ï¼å¯ä»¥è®¾ç½® replication ä¸º sync(é»è®¤)ï¼è¿ä½¿å¾æä½å¨ä¸»åçåå¯æ¬åçé½å®æåæä¼è¿åï¼å¦æè®¾ç½® replication ä¸º async æ¶ï¼ä¹å¯ä»¥éè¿è®¾ç½®æç´¢è¯·æ±åæ°_preference ä¸º primary æ¥æ¥è¯¢ä¸»åçï¼ç¡®ä¿ææ¡£æ¯ææ°çæ¬ã\n\n\n# 20ãå¦ä½çæ§ Elasticsearch éç¾¤ç¶æï¼\n\nMarvel è®©ä½ å¯ä»¥å¾ç®åçéè¿ Kibana çæ§ Elasticsearchãä½ å¯ä»¥å®æ¶æ¥çä½ çéç¾¤å¥åº·ç¶æåæ§è½ï¼ä¹å¯ä»¥åæè¿å»çéç¾¤ãç´¢å¼åèç¹ææ ã\n\n\n# 21ãä»ç»ä¸ä½ ä»¬çµåæç´¢çæ´ä½ææ¯æ¶æã\n\n\n\n\n# ä»ç»ä¸ä¸ä½ ä»¬çä¸ªæ§åæç´¢æ¹æ¡ï¼\n\nåºäº word2vec å Elasticsearch å®ç°ä¸ªæ§åæç´¢\n\nï¼1ï¼åºäº word2vecãElasticsearch åèªå®ä¹çèæ¬æä»¶ï¼æä»¬å°±å®ç°äºä¸ä¸ªä¸ªæ§åçæç´¢æå¡ï¼ç¸å¯¹äºåæçå®ç°ï¼æ°ççç¹å»çåè½¬åçé½æå¤§å¹çæåï¼\n\nï¼2ï¼åºäº word2vec çåååéè¿æä¸ä¸ªå¯ç¨ä¹å¤ï¼å°±æ¯å¯ä»¥ç¨æ¥å®ç°ç¸ä¼¼ååçæ¨èï¼\n\nï¼3ï¼ä½¿ç¨ word2vec æ¥å®ç°ä¸ªæ§åæç´¢æä¸ªæ§åæ¨èæ¯æä¸å®å±éæ§çï¼å ä¸ºå®åªè½å¤çç¨æ·ç¹å»åå²è¿æ ·çæ¶åºæ°æ®ï¼èæ æ³å¨é¢çå»èèç¨æ·åå¥½ï¼è¿ä¸ªè¿æ¯æå¾å¤§çæ¹è¿åæåçç©ºé´ï¼\n\n\n# æ¯å¦äºè§£å­å¸æ ï¼\n\nå¸¸ç¨å­å¸æ°æ®ç»æå¦ä¸æç¤ºï¼\n\n\n\nTrie çæ ¸å¿ææ³æ¯ç©ºé´æ¢æ¶é´ï¼å©ç¨å­ç¬¦ä¸²çå¬å±åç¼æ¥éä½æ¥è¯¢æ¶é´çå¼éä»¥è¾¾å°æé«æççç®çãå®æ 3 ä¸ªåºæ¬æ§è´¨ï¼\n\n1ï¼æ ¹èç¹ä¸åå«å­ç¬¦ï¼é¤æ ¹èç¹å¤æ¯ä¸ä¸ªèç¹é½åªåå«ä¸ä¸ªå­ç¬¦ã\n\n2ï¼ä»æ ¹èç¹å°æä¸èç¹ï¼è·¯å¾ä¸ç»è¿çå­ç¬¦è¿æ¥èµ·æ¥ï¼ä¸ºè¯¥èç¹å¯¹åºçå­ç¬¦ä¸²ã\n\n3ï¼æ¯ä¸ªèç¹çææå­èç¹åå«çå­ç¬¦é½ä¸ç¸åã\n\n\n\nï¼1ï¼å¯ä»¥çå°ï¼trie æ æ¯ä¸å±çèç¹æ°æ¯ 26^i çº§å«çãæä»¥ä¸ºäºèçç©ºé´ï¼æä»¬è¿å¯ä»¥ç¨å¨æé¾è¡¨ï¼æèç¨æ°ç»æ¥æ¨¡æå¨æãèç©ºé´çè±è´¹ï¼ä¸ä¼è¶è¿åè¯æ° Ã åè¯é¿åº¦ã\n\nï¼2ï¼å®ç°ï¼å¯¹æ¯ä¸ªç»ç¹å¼ä¸ä¸ªå­æ¯éå¤§å°çæ°ç»ï¼æ¯ä¸ªç»ç¹æä¸ä¸ªé¾è¡¨ï¼ä½¿ç¨å·¦å¿å­å³åå¼è¡¨ç¤ºæ³è®°å½è¿æ£µæ ï¼\n\nï¼3ï¼å¯¹äºä¸­æçå­å¸æ ï¼æ¯ä¸ªèç¹çå­èç¹ç¨ä¸ä¸ªåå¸è¡¨å­å¨ï¼è¿æ ·å°±ä¸ç¨æµªè´¹å¤ªå¤§çç©ºé´ï¼èä¸æ¥è¯¢éåº¦ä¸å¯ä»¥ä¿çåå¸çå¤æåº¦ O(1)ã\n\n\n# æ¼åçº éæ¯å¦ä½å®ç°çï¼\n\nï¼1ï¼æ¼åçº éæ¯åºäºç¼è¾è·ç¦»æ¥å®ç°ï¼ç¼è¾è·ç¦»æ¯ä¸ç§æ åçæ¹æ³ï¼å®ç¨æ¥è¡¨ç¤ºç»è¿æå¥ãå é¤åæ¿æ¢æä½ä»ä¸ä¸ªå­ç¬¦ä¸²è½¬æ¢å°å¦å¤ä¸ä¸ªå­ç¬¦ä¸²çæå°æä½æ­¥æ°ï¼\n\nï¼2ï¼ç¼è¾è·ç¦»çè®¡ç®è¿ç¨ï¼æ¯å¦è¦è®¡ç® batyu å beauty çç¼è¾è·ç¦»ï¼ååå»ºä¸ä¸ª 7Ã8 çè¡¨ï¼batyu é¿åº¦ä¸º 5ï¼coffee é¿åº¦ä¸º 6ï¼åå  2ï¼ï¼æ¥çï¼å¨å¦ä¸ä½ç½®å¡«å¥é»è²æ°å­ãå¶ä»æ ¼çè®¡ç®è¿ç¨æ¯åä»¥ä¸ä¸ä¸ªå¼çæå°å¼ï¼\n\nå¦ææä¸æ¹çå­ç¬¦ç­äºæå·¦æ¹çå­ç¬¦ï¼åä¸ºå·¦ä¸æ¹çæ°å­ãå¦åä¸ºå·¦ä¸æ¹çæ°å­+1ãï¼å¯¹äº 3,3 æ¥è¯´ä¸º 0ï¼\n\nå·¦æ¹æ°å­+1ï¼å¯¹äº 3,3 æ ¼æ¥è¯´ä¸º 2ï¼\n\nä¸æ¹æ°å­+1ï¼å¯¹äº 3,3 æ ¼æ¥è¯´ä¸º 2ï¼\n\næç»åå³ä¸è§çå¼å³ä¸ºç¼è¾è·ç¦»çå¼ 3ã\n\n\n\nå¯¹äºæ¼åçº éï¼æä»¬èèæé ä¸ä¸ªåº¦éç©ºé´ï¼Metric Spaceï¼ï¼è¯¥ç©ºé´åä»»ä½å³ç³»æ»¡è¶³ä»¥ä¸ä¸æ¡åºæ¬æ¡ä»¶ï¼\n\nd(x,y) = 0 -- åå¦ x ä¸ y çè·ç¦»ä¸º 0ï¼å x=y\n\nd(x,y) = d(y,x) -- x å° y çè·ç¦»ç­åäº y å° x çè·ç¦»\n\nd(x,y) + d(y,z) >= d(x,z) -- ä¸è§ä¸ç­å¼\n\nï¼1ï¼æ ¹æ®ä¸è§ä¸ç­å¼ï¼åæ»¡è¶³ä¸ query è·ç¦»å¨ n èå´åçå¦ä¸ä¸ªå­ç¬¦è½¬ Bï¼å¶ä¸ A çè·ç¦»æå¤§ä¸º d+nï¼æå°ä¸º d-nã\n\nï¼2ï¼BK æ çæé å°±è¿ç¨å¦ä¸ï¼æ¯ä¸ªèç¹æä»»æä¸ªå­èç¹ï¼æ¯æ¡è¾¹æä¸ªå¼è¡¨ç¤ºç¼è¾è·ç¦»ãææå­èç¹å°ç¶èç¹çè¾¹ä¸æ æ³¨ n è¡¨ç¤ºç¼è¾è·ç¦»æ°å¥½ä¸º nãæ¯å¦ï¼æä»¬ææ£µæ ç¶èç¹æ¯âbookâåä¸¤ä¸ªå­èç¹âcakeâåâbooksâï¼âbookâå°âbooksâçè¾¹æ å· 1ï¼âbookâå°âcakeâçè¾¹ä¸æ å· 4ãä»å­å¸éæé å¥½æ åï¼æ è®ºä½æ¶ä½ æ³æå¥æ°åè¯æ¶ï¼è®¡ç®è¯¥åè¯ä¸æ ¹èç¹çç¼è¾è·ç¦»ï¼å¹¶ä¸æ¥æ¾æ°å¼ä¸º d(neweord, root)çè¾¹ãéå½å¾ä¸åå­èç¹è¿è¡æ¯è¾ï¼ç´å°æ²¡æå­èç¹ï¼ä½ å°±å¯ä»¥åå»ºæ°çå­èç¹å¹¶å°æ°åè¯ä¿å­å¨é£ãæ¯å¦ï¼æå¥âbooâå°åæä¸è¿°ä¾å­çæ ä¸­ï¼æä»¬åæ£æ¥æ ¹èç¹ï¼æ¥æ¾ d(âbookâ, âbooâ) = 1 çè¾¹ï¼ç¶åæ£æ¥æ å·ä¸º 1 çè¾¹çå­èç¹ï¼å¾å°åè¯âbooksâãæä»¬åè®¡ç®è·ç¦» d(âbooksâ, âbooâ)=2ï¼åå°æ°åè¯æå¨âbooksâä¹åï¼è¾¹æ å·ä¸º 2ã\n\nï¼3ï¼æ¥è¯¢ç¸ä¼¼è¯å¦ä¸ï¼è®¡ç®åè¯ä¸æ ¹èç¹çç¼è¾è·ç¦» dï¼ç¶åéå½æ¥æ¾æ¯ä¸ªå­èç¹æ å·ä¸º d-n å° d+nï¼åå«ï¼çè¾¹ãåå¦è¢«æ£æ¥çèç¹ä¸æç´¢åè¯çè·ç¦» d å°äº nï¼åè¿åè¯¥èç¹å¹¶ç»§ç»­æ¥è¯¢ãæ¯å¦è¾å¥ cape ä¸æå¤§å®¹å¿è·ç¦»ä¸º 1ï¼ååè®¡ç®åæ ¹çç¼è¾è·ç¦» d(âbookâ, âcapeâ)=4ï¼ç¶åæ¥çæ¾åæ ¹èç¹ä¹é´ç¼è¾è·ç¦»ä¸º 3 å° 5 çï¼è¿ä¸ªå°±æ¾å°äº cake è¿ä¸ªèç¹ï¼è®¡ç® d(âcakeâ, âcapeâ)=1ï¼æ»¡è¶³æ¡ä»¶æä»¥è¿å cakeï¼ç¶ååæ¾å cake èç¹ç¼è¾è·ç¦»æ¯ 0 å° 2 çï¼åå«æ¾å° cape å cart èç¹ï¼è¿æ ·å°±å¾å° cape è¿ä¸ªæ»¡è¶³æ¡ä»¶çç»æã\n\n",normalizedContent:"# elasticsearch é¢è¯æ»ç»\n\n\n# éç¾¤é¨ç½²\n\nes é¨ç½²æåµï¼\n\n5 èç¹ï¼éç½®ï¼8 æ ¸ 64 g 1tï¼ï¼æ»è®¡ 320 gï¼5 tã\n\nçº¦ 10+ ç´¢å¼ï¼5 åçï¼æ¯æ¥æ°å¢æ°æ®éçº¦ä¸º 2gï¼4000w æ¡ãè®°å½ä¿å­ 30 å¤©ã\n\n\n# æ§è½ä¼å\n\n\n# filesystem cache\n\nä½ å¾ es éåçæ°æ®ï¼å®éä¸é½åå°ç£çæä»¶éå»äºï¼æ¥è¯¢çæ¶åï¼æä½ç³»ç»ä¼å°ç£çæä»¶éçæ°æ®èªå¨ç¼å­å° filesystem cache éé¢å»ã\n\n\n\nes çæç´¢å¼æä¸¥éä¾èµäºåºå±ç filesystem cache ï¼ä½ å¦æç» filesystem cache æ´å¤çåå­ï¼å°½éè®©åå­å¯ä»¥å®¹çº³ææç idx segment fileç´¢å¼æ°æ®æä»¶ï¼é£ä¹ä½ æç´¢çæ¶åå°±åºæ¬é½æ¯èµ°åå­çï¼æ§è½ä¼éå¸¸é«ã\n\næ§è½å·®è·ç©¶ç«å¯ä»¥æå¤å¤§ï¼æä»¬ä¹åå¾å¤çæµè¯ååæµï¼å¦æèµ°ç£çä¸è¬è¯å®ä¸ç§ï¼æç´¢æ§è½ç»å¯¹æ¯ç§çº§å«çï¼1 ç§ã5 ç§ã10 ç§ãä½å¦ææ¯èµ° filesystem cache ï¼æ¯èµ°çº¯åå­çï¼é£ä¹ä¸è¬æ¥è¯´æ§è½æ¯èµ°ç£çè¦é«ä¸ä¸ªæ°éçº§ï¼åºæ¬ä¸å°±æ¯æ¯«ç§çº§çï¼ä»å æ¯«ç§å°å ç¾æ¯«ç§ä¸ç­ã\n\nè¿éæä¸ªçå®çæ¡ä¾ãæä¸ªå¬å¸ es èç¹æ 3 å°æºå¨ï¼æ¯å°æºå¨çèµ·æ¥åå­å¾å¤ï¼64gï¼æ»åå­å°±æ¯ 64 * 3 = 192g ãæ¯å°æºå¨ç» es jvm heap æ¯ 32g ï¼é£ä¹å©ä¸æ¥çç» filesystem cache çå°±æ¯æ¯å°æºå¨æ 32g ï¼æ»å±éç¾¤éç» filesystem cache çå°±æ¯ 32 * 3 = 96g åå­ãèæ­¤æ¶ï¼æ´ä¸ªç£çä¸ç´¢å¼æ°æ®æä»¶ï¼å¨ 3 å°æºå¨ä¸ä¸å±å ç¨äº 1t çç£çå®¹éï¼es æ°æ®éæ¯ 1t ï¼é£ä¹æ¯å°æºå¨çæ°æ®éæ¯ 300g ãè¿æ ·æ§è½å¥½åï¼ filesystem cache çåå­æ 100gï¼ååä¹ä¸çæ°æ®å¯ä»¥æ¾åå­ï¼å¶ä»çé½å¨ç£çï¼ç¶åä½ æ§è¡æç´¢æä½ï¼å¤§é¨åæä½é½æ¯èµ°ç£çï¼æ§è½è¯å®å·®ã\n\nå½æ ¹ç»åºï¼ä½ è¦è®© es æ§è½è¦å¥½ï¼æä½³çæåµä¸ï¼å°±æ¯ä½ çæºå¨çåå­ï¼è³å°å¯ä»¥å®¹çº³ä½ çæ»æ°æ®éçä¸åã\n\næ ¹æ®æä»¬èªå·±ççäº§ç¯å¢å®è·µç»éªï¼æä½³çæåµä¸ï¼æ¯ä»ä»å¨ es ä¸­å°±å­å°éçæ°æ®ï¼å°±æ¯ä½ è¦ç¨æ¥æç´¢çé£äºç´¢å¼ï¼å¦æåå­çç» filesystem cache çæ¯ 100gï¼é£ä¹ä½ å°±å°ç´¢å¼æ°æ®æ§å¶å¨ 100g ä»¥åï¼è¿æ ·çè¯ï¼ä½ çæ°æ®å ä¹å¨é¨èµ°åå­æ¥æç´¢ï¼æ§è½éå¸¸ä¹é«ï¼ä¸è¬å¯ä»¥å¨ 1 ç§ä»¥åã\n\næ¯å¦è¯´ä½ ç°å¨æä¸è¡æ°æ®ã id,name,age .... 30 ä¸ªå­æ®µãä½æ¯ä½ ç°å¨æç´¢ï¼åªéè¦æ ¹æ® id,name,age ä¸ä¸ªå­æ®µæ¥æç´¢ãå¦æä½ å»ä¹ä¹å¾ es éåå¥ä¸è¡æ°æ®ææçå­æ®µï¼å°±ä¼å¯¼è´è¯´ 90% çæ°æ®æ¯ä¸ç¨æ¥æç´¢çï¼ç»æç¡¬æ¯å æ®äº es æºå¨ä¸ç filesystem cache çç©ºé´ï¼åæ¡æ°æ®çæ°æ®éè¶å¤§ï¼å°±ä¼å¯¼è´ filesystem cahce è½ç¼å­çæ°æ®å°±è¶å°ãå¶å®ï¼ä»ä»åå¥ es ä¸­è¦ç¨æ¥æ£ç´¢çå°æ°å ä¸ªå­æ®µå°±å¯ä»¥äºï¼æ¯å¦è¯´å°±åå¥ es id,name,age ä¸ä¸ªå­æ®µï¼ç¶åä½ å¯ä»¥æå¶ä»çå­æ®µæ°æ®å­å¨ mysql/hbase éï¼æä»¬ä¸è¬æ¯å»ºè®®ç¨ es + hbase è¿ä¹ä¸ä¸ªæ¶æã\n\nhbase çç¹ç¹æ¯éç¨äºæµ·éæ°æ®çå¨çº¿å­å¨ï¼å°±æ¯å¯¹ hbase å¯ä»¥åå¥æµ·éæ°æ®ï¼ä½æ¯ä¸è¦åå¤æçæç´¢ï¼åå¾ç®åçä¸äºæ ¹æ® id æèèå´è¿è¡æ¥è¯¢çè¿ä¹ä¸ä¸ªæä½å°±å¯ä»¥äºãä» es ä¸­æ ¹æ® name å age å»æç´¢ï¼æ¿å°çç»æå¯è½å°± 20 ä¸ª doc id ï¼ç¶åæ ¹æ® doc id å° hbase éå»æ¥è¯¢æ¯ä¸ª doc id å¯¹åºçå®æ´çæ°æ®ï¼ç»æ¥åºæ¥ï¼åè¿åç»åç«¯ã\n\nåå¥ es çæ°æ®æå¥½å°äºç­äºï¼æèæ¯ç¥å¾®å¤§äº es ç filesystem cache çåå­å®¹éãç¶åä½ ä» es æ£ç´¢å¯è½å°±è±è´¹ 20msï¼ç¶ååæ ¹æ® es è¿åç id å» hbase éæ¥è¯¢ï¼æ¥ 20 æ¡æ°æ®ï¼å¯è½ä¹å°±èè´¹ä¸ª 30msï¼å¯è½ä½ åæ¥é£ä¹ç©å¿ï¼1t æ°æ®é½æ¾ esï¼ä¼æ¯æ¬¡æ¥è¯¢é½æ¯ 5~10sï¼ç°å¨å¯è½æ§è½å°±ä¼å¾é«ï¼æ¯æ¬¡æ¥è¯¢å°±æ¯ 50msã\n\n\n# æ°æ®é¢ç­\n\nåå¦è¯´ï¼åªææ¯ä½ å°±æç§ä¸è¿°çæ¹æ¡å»åäºï¼es éç¾¤ä¸­æ¯ä¸ªæºå¨åå¥çæ°æ®éè¿æ¯è¶è¿äº filesystem cache ä¸åï¼æ¯å¦è¯´ä½ åå¥ä¸å°æºå¨ 60g æ°æ®ï¼ç»æ filesystem cache å°± 30gï¼è¿æ¯æ 30g æ°æ®çå¨äºç£çä¸ã\n\nå¶å®å¯ä»¥åæ°æ®é¢ç­ã\n\nä¸¾ä¸ªä¾å­ï¼æ¿å¾®åæ¥è¯´ï¼ä½ å¯ä»¥æä¸äºå¤§ vï¼å¹³æ¶ççäººå¾å¤çæ°æ®ï¼ä½ èªå·±æååå°æä¸ªç³»ç»ï¼æ¯éä¸ä¼å¿ï¼èªå·±çåå°ç³»ç»å»æç´¢ä¸ä¸ç­æ°æ®ï¼å·å° filesystem cache éå»ï¼åé¢ç¨æ·å®éä¸æ¥çè¿ä¸ªç­æ°æ®çæ¶åï¼ä»ä»¬å°±æ¯ç´æ¥ä»åå­éæç´¢äºï¼å¾å¿«ã\n\næèæ¯çµåï¼ä½ å¯ä»¥å°å¹³æ¶æ¥çæå¤çä¸äºååï¼æ¯å¦è¯´ iphone 8ï¼ç­æ°æ®æååå°æä¸ªç¨åºï¼æ¯é 1 åéèªå·±ä¸»å¨è®¿é®ä¸æ¬¡ï¼å·å° filesystem cache éå»ã\n\nå¯¹äºé£äºä½ è§å¾æ¯è¾ç­çãç»å¸¸ä¼æäººè®¿é®çæ°æ®ï¼æå¥½åä¸ä¸ªä¸é¨çç¼å­é¢ç­å­ç³»ç»ï¼å°±æ¯å¯¹ç­æ°æ®æ¯éä¸æ®µæ¶é´ï¼å°±æåè®¿é®ä¸ä¸ï¼è®©æ°æ®è¿å¥ filesystem cache éé¢å»ãè¿æ ·ä¸æ¬¡å«äººè®¿é®çæ¶åï¼æ§è½ä¸å®ä¼å¥½å¾å¤ã\n\n\n# å·ç­åç¦»\n\nes å¯ä»¥åç±»ä¼¼äº mysql çæ°´å¹³æåï¼å°±æ¯è¯´å°å¤§éçè®¿é®å¾å°ãé¢çå¾ä½çæ°æ®ï¼åç¬åä¸ä¸ªç´¢å¼ï¼ç¶åå°è®¿é®å¾é¢ç¹çç­æ°æ®åç¬åä¸ä¸ªç´¢å¼ãæå¥½æ¯å°å·æ°æ®åå¥ä¸ä¸ªç´¢å¼ä¸­ï¼ç¶åç­æ°æ®åå¥å¦å¤ä¸ä¸ªç´¢å¼ä¸­ï¼è¿æ ·å¯ä»¥ç¡®ä¿ç­æ°æ®å¨è¢«é¢ç­ä¹åï¼å°½éé½è®©ä»ä»¬çå¨ filesystem os cache éï¼å«è®©å·æ°æ®ç»å²å·æã\n\nä½ çï¼åè®¾ä½ æ 6 å°æºå¨ï¼2 ä¸ªç´¢å¼ï¼ä¸ä¸ªæ¾å·æ°æ®ï¼ä¸ä¸ªæ¾ç­æ°æ®ï¼æ¯ä¸ªç´¢å¼ 3 ä¸ª shardã3 å°æºå¨æ¾ç­æ°æ® indexï¼å¦å¤ 3 å°æºå¨æ¾å·æ°æ® indexãç¶åè¿æ ·çè¯ï¼ä½ å¤§éçæ¶é´æ¯å¨è®¿é®ç­æ°æ® indexï¼ç­æ°æ®å¯è½å°±å æ»æ°æ®éç 10%ï¼æ­¤æ¶æ°æ®éå¾å°ï¼å ä¹å¨é½ä¿çå¨ filesystem cache éé¢äºï¼å°±å¯ä»¥ç¡®ä¿ç­æ°æ®çè®¿é®æ§è½æ¯å¾é«çãä½æ¯å¯¹äºå·æ°æ®èè¨ï¼æ¯å¨å«ç index éçï¼è·ç­æ°æ® index ä¸å¨ç¸åçæºå¨ä¸ï¼å¤§å®¶äºç¸ä¹é´é½æ²¡ä»ä¹èç³»äºãå¦ææäººè®¿é®å·æ°æ®ï¼å¯è½å¤§éæ°æ®æ¯å¨ç£çä¸çï¼æ­¤æ¶æ§è½å·®ç¹ï¼å°± 10% çäººå»è®¿é®å·æ°æ®ï¼90% çäººå¨è®¿é®ç­æ°æ®ï¼ä¹æ æè°äºã\n\n\n# document æ¨¡åè®¾è®¡\n\nå¯¹äº mysqlï¼æä»¬ç»å¸¸æä¸äºå¤æçå³èæ¥è¯¢ãå¨ es éè¯¥æä¹ç©å¿ï¼es éé¢çå¤æçå³èæ¥è¯¢å°½éå«ç¨ï¼ä¸æ¦ç¨äºæ§è½ä¸è¬é½ä¸å¤ªå¥½ã\n\næå¥½æ¯åå¨ java ç³»ç»éå°±å®æå³èï¼å°å³èå¥½çæ°æ®ç´æ¥åå¥ es ä¸­ãæç´¢çæ¶åï¼å°±ä¸éè¦å©ç¨ es çæç´¢è¯­æ³æ¥å®æ join ä¹ç±»çå³èæç´¢äºã\n\ndocument æ¨¡åè®¾è®¡æ¯éå¸¸éè¦çï¼å¾å¤æä½ï¼ä¸è¦å¨æç´¢çæ¶åææ³å»æ§è¡åç§å¤æçä¹±ä¸å«ç³çæä½ães è½æ¯æçæä½å°±é£ä¹å¤ï¼ä¸è¦èèç¨ es åä¸äºå®ä¸å¥½æä½çäºæãå¦æççæé£ç§æä½ï¼å°½éå¨ document æ¨¡åè®¾è®¡çæ¶åï¼åå¥çæ¶åå°±å®æãå¦å¤å¯¹äºä¸äºå¤ªå¤æçæä½ï¼æ¯å¦ join/nested/parent-child æç´¢é½è¦å°½éé¿åï¼æ§è½é½å¾å·®çã\n\n\n# åé¡µæ§è½ä¼å\n\nes çåé¡µæ¯è¾åçï¼ä¸ºå¥å¢ï¼ä¸¾ä¸ªä¾å­å§ï¼åå¦ä½ æ¯é¡µæ¯ 10 æ¡æ°æ®ï¼ä½ ç°å¨è¦æ¥è¯¢ç¬¬ 100 é¡µï¼å®éä¸æ¯ä¼ææ¯ä¸ª shard ä¸å­å¨çå 1000 æ¡æ°æ®é½æ¥å°ä¸ä¸ªåè°èç¹ä¸ï¼å¦æä½ æä¸ª 5 ä¸ª shardï¼é£ä¹å°±æ 5000 æ¡æ°æ®ï¼æ¥çåè°èç¹å¯¹è¿ 5000 æ¡æ°æ®è¿è¡ä¸äºåå¹¶ãå¤çï¼åè·åå°æç»ç¬¬ 100 é¡µç 10 æ¡æ°æ®ã\n\nåå¸å¼çï¼ä½ è¦æ¥ç¬¬ 100 é¡µç 10 æ¡æ°æ®ï¼ä¸å¯è½è¯´ä» 5 ä¸ª shardï¼æ¯ä¸ª shard å°±æ¥ 2 æ¡æ°æ®ï¼æåå°åè°èç¹åå¹¶æ 10 æ¡æ°æ®å§ï¼ä½ å¿é¡»å¾ä»æ¯ä¸ª shard é½æ¥ 1000 æ¡æ°æ®è¿æ¥ï¼ç¶åæ ¹æ®ä½ çéæ±è¿è¡æåºãç­éç­ç­æä½ï¼æååæ¬¡åé¡µï¼æ¿å°éé¢ç¬¬ 100 é¡µçæ°æ®ãä½ ç¿»é¡µçæ¶åï¼ç¿»çè¶æ·±ï¼æ¯ä¸ª shard è¿åçæ°æ®å°±è¶å¤ï¼èä¸åè°èç¹å¤ççæ¶é´è¶é¿ï¼éå¸¸åç¹ãæä»¥ç¨ es ååé¡µçæ¶åï¼ä½ ä¼åç°è¶ç¿»å°åé¢ï¼å°±è¶æ¯æ¢ã\n\næä»¬ä¹åä¹æ¯éå°è¿è¿ä¸ªé®é¢ï¼ç¨ es ä½åé¡µï¼åå é¡µå°±å åæ¯«ç§ï¼ç¿»å° 10 é¡µæèå åé¡µçæ¶åï¼åºæ¬ä¸å°±è¦ 5~10 ç§æè½æ¥åºæ¥ä¸é¡µæ°æ®äºã\n\næä»ä¹è§£å³æ¹æ¡åï¼\n\n# ä¸åè®¸æ·±åº¦åé¡µï¼é»è®¤æ·±åº¦åé¡µæ§è½å¾å·®ï¼\n\nè·äº§åç»çè¯´ï¼ä½ ç³»ç»ä¸åè®¸ç¿»é£ä¹æ·±çé¡µï¼é»è®¤ç¿»çè¶æ·±ï¼æ§è½å°±è¶å·®ã\n\n# ç±»ä¼¼äº app éçæ¨èååä¸æ­ä¸æåºæ¥ä¸é¡µä¸é¡µç\n\nç±»ä¼¼äºå¾®åä¸­ï¼ä¸æå·å¾®åï¼å·åºæ¥ä¸é¡µä¸é¡µçï¼ä½ å¯ä»¥ç¨ scroll api ï¼å³äºå¦ä½ä½¿ç¨ï¼èªè¡ä¸ç½æç´¢ã\n\nscroll ä¼ä¸æ¬¡æ§ç»ä½ çææææ°æ®çä¸ä¸ªå¿«ç§ï¼ç¶åæ¯æ¬¡æ»å¨ååç¿»é¡µå°±æ¯éè¿æ¸¸æ  scroll_id ç§»å¨ï¼è·åä¸ä¸é¡µä¸ä¸é¡µè¿æ ·å­ï¼æ§è½ä¼æ¯ä¸é¢è¯´çé£ç§åé¡µæ§è½è¦é«å¾å¤å¾å¤ï¼åºæ¬ä¸é½æ¯æ¯«ç§çº§çã\n\nä½æ¯ï¼å¯ä¸çä¸ç¹å°±æ¯ï¼è¿ä¸ªéåäºé£ç§ç±»ä¼¼å¾®åä¸æç¿»é¡µçï¼ä¸è½éæè·³å°ä»»ä½ä¸é¡µçåºæ¯ãä¹å°±æ¯è¯´ï¼ä½ ä¸è½åè¿å¥ç¬¬ 10 é¡µï¼ç¶åå»ç¬¬ 120 é¡µï¼ç¶åååå°ç¬¬ 58 é¡µï¼ä¸è½éæä¹±è·³é¡µãæä»¥ç°å¨å¾å¤äº§åï¼é½æ¯ä¸åè®¸ä½ éæç¿»é¡µçï¼appï¼ä¹æä¸äºç½ç«ï¼åçå°±æ¯ä½ åªè½å¾ä¸æï¼ä¸é¡µä¸é¡µçç¿»ã\n\nåå§åæ¶å¿é¡»æå® scroll åæ°ï¼åè¯ es è¦ä¿å­æ­¤æ¬¡æç´¢çä¸ä¸æå¤é¿æ¶é´ãä½ éè¦ç¡®ä¿ç¨æ·ä¸ä¼æç»­ä¸æ­ç¿»é¡µç¿»å ä¸ªå°æ¶ï¼å¦åå¯è½å ä¸ºè¶æ¶èå¤±è´¥ã\n\né¤äºç¨ scroll api ï¼ä½ ä¹å¯ä»¥ç¨ search_after æ¥åï¼ search_after çææ³æ¯ä½¿ç¨åä¸é¡µçç»ææ¥å¸®å©æ£ç´¢ä¸ä¸é¡µçæ°æ®ï¼æ¾ç¶ï¼è¿ç§æ¹å¼ä¹ä¸åè®¸ä½ éæç¿»é¡µï¼ä½ åªè½ä¸é¡µé¡µå¾åç¿»ãåå§åæ¶ï¼éè¦ä½¿ç¨ä¸ä¸ªå¯ä¸å¼çå­æ®µä½ä¸º sort å­æ®µã\n\n1.1ãè®¾è®¡é¶æ®µè°ä¼\n\nï¼1ï¼æ ¹æ®ä¸å¡å¢ééæ±ï¼éååºäºæ¥ææ¨¡æ¿åå»ºç´¢å¼ï¼éè¿ roll over api æ»å¨ç´¢å¼ï¼\n\nï¼2ï¼ä½¿ç¨å«åè¿è¡ç´¢å¼ç®¡çï¼\n\nï¼3ï¼æ¯å¤©åæ¨å®æ¶å¯¹ç´¢å¼å force_merge æä½ï¼ä»¥éæ¾ç©ºé´ï¼\n\nï¼4ï¼éåå·ç­åç¦»æºå¶ï¼ç­æ°æ®å­å¨å° ssdï¼æé«æ£ç´¢æçï¼å·æ°æ®å®æè¿è¡ shrink æä½ï¼ä»¥ç¼©åå­å¨ï¼\n\nï¼5ï¼éå curator è¿è¡ç´¢å¼ççå½å¨æç®¡çï¼\n\nï¼6ï¼ä»éå¯¹éè¦åè¯çå­æ®µï¼åççè®¾ç½®åè¯å¨ï¼\n\nï¼7ï¼mapping é¶æ®µååç»ååä¸ªå­æ®µçå±æ§ï¼æ¯å¦éè¦æ£ç´¢ãæ¯å¦éè¦å­å¨ç­ãâ¦â¦..\n\n1.2ãåå¥è°ä¼\n\nï¼1ï¼åå¥åå¯æ¬æ°è®¾ç½®ä¸º 0ï¼\n\nï¼2ï¼åå¥åå³é­ refresh_interval è®¾ç½®ä¸º-1ï¼ç¦ç¨å·æ°æºå¶ï¼\n\nï¼3ï¼åå¥è¿ç¨ä¸­ï¼éå bulk æ¹éåå¥ï¼\n\nï¼4ï¼åå¥åæ¢å¤å¯æ¬æ°åå·æ°é´éï¼\n\nï¼5ï¼å°½éä½¿ç¨èªå¨çæç idã\n\n1.3ãæ¥è¯¢è°ä¼\n\nï¼1ï¼ç¦ç¨ wildcardï¼\n\nï¼2ï¼ç¦ç¨æ¹é termsï¼æç¾ä¸åçåºæ¯ï¼ï¼\n\nï¼3ï¼ååå©ç¨åæç´¢å¼æºå¶ï¼è½ keyword ç±»åå°½é keywordï¼\n\nï¼4ï¼æ°æ®éå¤§æ¶åï¼å¯ä»¥ååºäºæ¶é´æ²å®ç´¢å¼åæ£ç´¢ï¼\n\nï¼5ï¼è®¾ç½®åççè·¯ç±æºå¶ã\n\n1.4ãå¶ä»è°ä¼\n\né¨ç½²è°ä¼ï¼ä¸å¡è°ä¼ç­ã\n\nä¸é¢çæåä¸é¨åï¼é¢è¯èå°±åºæ¬å¯¹ä½ ä¹åçå®è·µæèè¿ç»´ç»éªææè¯ä¼°äºã\n\n\n# å·¥ä½åç\n\n\n# es åæ°æ®è¿ç¨\n\n * å®¢æ·ç«¯éæ©ä¸ä¸ª node åéè¯·æ±è¿å»ï¼è¿ä¸ª node å°±æ¯ coordinating node ï¼åè°èç¹ï¼ã\n * coordinating node å¯¹ document è¿è¡è·¯ç±ï¼å°è¯·æ±è½¬åç»å¯¹åºç nodeï¼æ primary shardï¼ã\n * å®éç node ä¸ç primary shard å¤çè¯·æ±ï¼ç¶åå°æ°æ®åæ­¥å° replica node ã\n * coordinating node å¦æåç° primary node åææ replica node é½æå®ä¹åï¼å°±è¿åååºç»æç»å®¢æ·ç«¯ã\n\n\n\n\n# es è¯»æ°æ®è¿ç¨\n\nå¯ä»¥éè¿ doc id æ¥æ¥è¯¢ï¼ä¼æ ¹æ® doc id è¿è¡ hashï¼å¤æ­åºæ¥å½æ¶æ doc id åéå°äºåªä¸ª shard ä¸é¢å»ï¼ä»é£ä¸ª shard å»æ¥è¯¢ã\n\n * å®¢æ·ç«¯åéè¯·æ±å°ä»»æä¸ä¸ª nodeï¼æä¸º coordinate node ã\n * coordinate node å¯¹ doc id è¿è¡åå¸è·¯ç±ï¼å°è¯·æ±è½¬åå°å¯¹åºç nodeï¼æ­¤æ¶ä¼ä½¿ç¨ round-robin éæºè½®è¯¢ç®æ³ï¼å¨ primary shard ä»¥åå¶ææ replica ä¸­éæºéæ©ä¸ä¸ªï¼è®©è¯»è¯·æ±è´è½½åè¡¡ã\n * æ¥æ¶è¯·æ±ç node è¿å document ç» coordinate node ã\n * coordinate node è¿å document ç»å®¢æ·ç«¯ã\n\n\n# es æç´¢æ°æ®è¿ç¨\n\nes æå¼ºå¤§çæ¯åå¨ææ£ç´¢ï¼å°±æ¯æ¯å¦ä½ æä¸æ¡æ°æ®ï¼\n\njavaçå¥½ç©å¿å\njavaå¥½é¾å­¦å\nj2eeç¹å«ç\n\n\nä½ æ ¹æ® java å³é®è¯æ¥æç´¢ï¼å°åå« java ç document ç»æç´¢åºæ¥ães å°±ä¼ç»ä½ è¿åï¼java çå¥½ç©å¿åï¼java å¥½é¾å­¦åã\n\n * å®¢æ·ç«¯åéè¯·æ±å°ä¸ä¸ª coordinate node ã\n * åè°èç¹å°æç´¢è¯·æ±è½¬åå°ææç shard å¯¹åºç primary shard æ replica shard ï¼é½å¯ä»¥ã\n * query phaseï¼æ¯ä¸ª shard å°èªå·±çæç´¢ç»æï¼å¶å®å°±æ¯ä¸äº doc id ï¼è¿åç»åè°èç¹ï¼ç±åè°èç¹è¿è¡æ°æ®çåå¹¶ãæåºãåé¡µç­æä½ï¼äº§åºæç»ç»æã\n * fetch phaseï¼æ¥çç±åè°èç¹æ ¹æ® doc id å»åä¸ªèç¹ä¸æåå®éç document æ°æ®ï¼æç»è¿åç»å®¢æ·ç«¯ã\n\n> åè¯·æ±æ¯åå¥ primary shardï¼ç¶ååæ­¥ç»ææç replica shardï¼è¯»è¯·æ±å¯ä»¥ä» primary shard æ replica shard è¯»åï¼éç¨çæ¯éæºè½®è¯¢ç®æ³ã\n\n\n# åæ°æ®åºå±åç\n\n\n\nååå¥åå­ bufferï¼å¨ buffer éçæ¶åæ°æ®æ¯æç´¢ä¸å°çï¼åæ¶å°æ°æ®åå¥ translog æ¥å¿æä»¶ã\n\nå¦æ buffer å¿«æ»¡äºï¼æèå°ä¸å®æ¶é´ï¼å°±ä¼å°åå­ buffer æ°æ® refresh å°ä¸ä¸ªæ°ç segment file ä¸­ï¼ä½æ¯æ­¤æ¶æ°æ®ä¸æ¯ç´æ¥è¿å¥ segment file ç£çæä»¶ï¼èæ¯åè¿å¥ os cache ãè¿ä¸ªè¿ç¨å°±æ¯ refresh ã\n\næ¯é 1 ç§éï¼es å° buffer ä¸­çæ°æ®åå¥ä¸ä¸ªæ°ç segment file ï¼æ¯ç§éä¼äº§çä¸ä¸ªæ°çç£çæä»¶ segment file ï¼è¿ä¸ª segment file ä¸­å°±å­å¨æè¿ 1 ç§å buffer ä¸­åå¥çæ°æ®ã\n\nä½æ¯å¦æ buffer éé¢æ­¤æ¶æ²¡ææ°æ®ï¼é£å½ç¶ä¸ä¼æ§è¡ refresh æä½ï¼å¦æ buffer éé¢ææ°æ®ï¼é»è®¤ 1 ç§éæ§è¡ä¸æ¬¡ refresh æä½ï¼å·å¥ä¸ä¸ªæ°ç segment file ä¸­ã\n\næä½ç³»ç»éé¢ï¼ç£çæä»¶å¶å®é½æä¸ä¸ªä¸è¥¿ï¼å«å os cache ï¼å³æä½ç³»ç»ç¼å­ï¼å°±æ¯è¯´æ°æ®åå¥ç£çæä»¶ä¹åï¼ä¼åè¿å¥ os cache ï¼åè¿å¥æä½ç³»ç»çº§å«çä¸ä¸ªåå­ç¼å­ä¸­å»ãåªè¦ buffer ä¸­çæ°æ®è¢« refresh æä½å·å¥ os cache ä¸­ï¼è¿ä¸ªæ°æ®å°±å¯ä»¥è¢«æç´¢å°äºã\n\nä¸ºä»ä¹å« es æ¯åå®æ¶çï¼ nrt ï¼å¨ç§° near real-time ãé»è®¤æ¯æ¯é 1 ç§ refresh ä¸æ¬¡çï¼æä»¥ es æ¯åå®æ¶çï¼å ä¸ºåå¥çæ°æ® 1 ç§ä¹åæè½è¢«çå°ãå¯ä»¥éè¿ es ç restful api æè java api ï¼æå¨æ§è¡ä¸æ¬¡ refresh æä½ï¼å°±æ¯æå¨å° buffer ä¸­çæ°æ®å·å¥ os cache ä¸­ï¼è®©æ°æ®ç«é©¬å°±å¯ä»¥è¢«æç´¢å°ãåªè¦æ°æ®è¢«è¾å¥ os cache ä¸­ï¼buffer å°±ä¼è¢«æ¸ç©ºäºï¼å ä¸ºä¸éè¦ä¿ç buffer äºï¼æ°æ®å¨ translog éé¢å·²ç»æä¹åå°ç£çå»ä¸ä»½äºã\n\néå¤ä¸é¢çæ­¥éª¤ï¼æ°çæ°æ®ä¸æ­è¿å¥ buffer å translogï¼ä¸æ­å° buffer æ°æ®åå¥ä¸ä¸ªåä¸ä¸ªæ°ç segment file ä¸­å»ï¼æ¯æ¬¡ refresh å® buffer æ¸ç©ºï¼translog ä¿çãéçè¿ä¸ªè¿ç¨æ¨è¿ï¼translog ä¼åå¾è¶æ¥è¶å¤§ãå½ translog è¾¾å°ä¸å®é¿åº¦çæ¶åï¼å°±ä¼è§¦å commit æä½ã\n\ncommit æä½åçç¬¬ä¸æ­¥ï¼å°±æ¯å° buffer ä¸­ç°ææ°æ® refresh å° os cache ä¸­å»ï¼æ¸ç©º bufferãç¶åï¼å°ä¸ä¸ª commit point åå¥ç£çæä»¶ï¼éé¢æ è¯çè¿ä¸ª commit point å¯¹åºçææ segment file ï¼åæ¶å¼ºè¡å° os cache ä¸­ç®åææçæ°æ®é½ fsync å°ç£çæä»¶ä¸­å»ãæåæ¸ç©º ç°æ translog æ¥å¿æä»¶ï¼éå¯ä¸ä¸ª translogï¼æ­¤æ¶ commit æä½å®æã\n\nè¿ä¸ª commit æä½å«å flush ãé»è®¤ 30 åéèªå¨æ§è¡ä¸æ¬¡ flush ï¼ä½å¦æ translog è¿å¤§ï¼ä¹ä¼è§¦å flush ãflush æä½å°±å¯¹åºç commit çå¨è¿ç¨ï¼æä»¬å¯ä»¥éè¿ es apiï¼æå¨æ§è¡ flush æä½ï¼æå¨å° os cache ä¸­çæ°æ® fsync å¼ºå·å°ç£çä¸å»ã\n\ntranslog æ¥å¿æä»¶çä½ç¨æ¯ä»ä¹ï¼ä½ æ§è¡ commit æä½ä¹åï¼æ°æ®è¦ä¹æ¯åçå¨ buffer ä¸­ï¼è¦ä¹æ¯åçå¨ os cache ä¸­ï¼æ è®ºæ¯ buffer è¿æ¯ os cache é½æ¯åå­ï¼ä¸æ¦è¿å°æºå¨æ­»äºï¼åå­ä¸­çæ°æ®å°±å¨ä¸¢äºãæä»¥éè¦å°æ°æ®å¯¹åºçæä½åå¥ä¸ä¸ªä¸é¨çæ¥å¿æä»¶ translog ä¸­ï¼ä¸æ¦æ­¤æ¶æºå¨å®æºï¼åæ¬¡éå¯çæ¶åï¼es ä¼èªå¨è¯»å translog æ¥å¿æä»¶ä¸­çæ°æ®ï¼æ¢å¤å°åå­ buffer å os cache ä¸­å»ã\n\ntranslog å¶å®ä¹æ¯ååå¥ os cache çï¼é»è®¤æ¯é 5 ç§å·ä¸æ¬¡å°ç£çä¸­å»ï¼æä»¥é»è®¤æåµä¸ï¼å¯è½æ 5 ç§çæ°æ®ä¼ä»ä»åçå¨ buffer æè translog æä»¶ç os cache ä¸­ï¼å¦ææ­¤æ¶æºå¨æäºï¼ä¼ä¸¢å¤± 5 ç§éçæ°æ®ãä½æ¯è¿æ ·æ§è½æ¯è¾å¥½ï¼æå¤ä¸¢ 5 ç§çæ°æ®ãä¹å¯ä»¥å° translog è®¾ç½®ææ¯æ¬¡åæä½å¿é¡»æ¯ç´æ¥ fsync å°ç£çï¼ä½æ¯æ§è½ä¼å·®å¾å¤ã\n\nå®éä¸ä½ å¨è¿éï¼å¦æé¢è¯å®æ²¡æé®ä½  es ä¸¢æ°æ®çé®é¢ï¼ä½ å¯ä»¥å¨è¿éç»é¢è¯å®ç«ä¸æï¼ä½ è¯´ï¼å¶å® es ç¬¬ä¸æ¯åå®æ¶çï¼æ°æ®åå¥ 1 ç§åå¯ä»¥æç´¢å°ï¼å¯è½ä¼ä¸¢å¤±æ°æ®çãæ 5 ç§çæ°æ®ï¼åçå¨ bufferãtranslog os cacheãsegment file os cache ä¸­ï¼èä¸å¨ç£çä¸ï¼æ­¤æ¶å¦æå®æºï¼ä¼å¯¼è´ 5 ç§çæ°æ®ä¸¢å¤±ã\n\næ»ç»ä¸ä¸ï¼æ°æ®ååå¥åå­ bufferï¼ç¶åæ¯é 1sï¼å°æ°æ® refresh å° os cacheï¼å°äº os cache æ°æ®å°±è½è¢«æç´¢å°ï¼æä»¥æä»¬æè¯´ es ä»åå¥å°è½è¢«æç´¢å°ï¼ä¸­é´æ 1s çå»¶è¿ï¼ãæ¯é 5sï¼å°æ°æ®åå¥ translog æä»¶ï¼è¿æ ·å¦ææºå¨å®æºï¼åå­æ°æ®å¨æ²¡ï¼æå¤ä¼æ 5s çæ°æ®ä¸¢å¤±ï¼ï¼translog å¤§å°ä¸å®ç¨åº¦ï¼æèé»è®¤æ¯é 30minsï¼ä¼è§¦å commit æä½ï¼å°ç¼å²åºçæ°æ®é½ flush å° segment file ç£çæä»¶ä¸­ã\n\n> æ°æ®åå¥ segment file ä¹åï¼åæ¶å°±å»ºç«å¥½äºåæç´¢å¼ã\n\n\n# å é¤/æ´æ°æ°æ®åºå±åç\n\nå¦ææ¯å é¤æä½ï¼commit çæ¶åä¼çæä¸ä¸ª .del æä»¶ï¼éé¢å°æä¸ª doc æ è¯ä¸º deleted ç¶æï¼é£ä¹æç´¢çæ¶åæ ¹æ® .del æä»¶å°±ç¥éè¿ä¸ª doc æ¯å¦è¢«å é¤äºã\n\nå¦ææ¯æ´æ°æä½ï¼å°±æ¯å°åæ¥ç doc æ è¯ä¸º deleted ç¶æï¼ç¶åæ°åå¥ä¸æ¡æ°æ®ã\n\nbuffer æ¯ refresh ä¸æ¬¡ï¼å°±ä¼äº§çä¸ä¸ª segment file ï¼æä»¥é»è®¤æåµä¸æ¯ 1 ç§éä¸ä¸ª segment file ï¼è¿æ ·ä¸æ¥ segment file ä¼è¶æ¥è¶å¤ï¼æ­¤æ¶ä¼å®ææ§è¡ mergeãæ¯æ¬¡ merge çæ¶åï¼ä¼å°å¤ä¸ª segment file åå¹¶æä¸ä¸ªï¼åæ¶è¿éä¼å°æ è¯ä¸º deleted ç doc ç»ç©çå é¤æï¼ç¶åå°æ°ç segment file åå¥ç£çï¼è¿éä¼åä¸ä¸ª commit point ï¼æ è¯æææ°ç segment file ï¼ç¶åæå¼ segment file ä¾æç´¢ä½¿ç¨ï¼åæ¶å é¤æ§ç segment file ã\n\n\n# åºå± lucene\n\nç®åæ¥è¯´ï¼lucene å°±æ¯ä¸ä¸ª jar åï¼éé¢åå«äºå°è£å¥½çåç§å»ºç«åæç´¢å¼çç®æ³ä»£ç ãæä»¬ç¨ java å¼åçæ¶åï¼å¼å¥ lucene jarï¼ç¶ååºäº lucene ç api å»å¼åå°±å¯ä»¥äºã\n\néè¿ luceneï¼æä»¬å¯ä»¥å°å·²æçæ°æ®å»ºç«ç´¢å¼ï¼lucene ä¼å¨æ¬å°ç£çä¸é¢ï¼ç»æä»¬ç»ç»ç´¢å¼çæ°æ®ç»æã\n\n\n# åæç´¢å¼\n\nå¨æç´¢å¼æä¸­ï¼æ¯ä¸ªææ¡£é½æä¸ä¸ªå¯¹åºçææ¡£ idï¼ææ¡£åå®¹è¢«è¡¨ç¤ºä¸ºä¸ç³»åå³é®è¯çéåãä¾å¦ï¼ææ¡£ 1 ç»è¿åè¯ï¼æåäº 20 ä¸ªå³é®è¯ï¼æ¯ä¸ªå³é®è¯é½ä¼è®°å½å®å¨ææ¡£ä¸­åºç°çæ¬¡æ°ååºç°ä½ç½®ã\n\né£ä¹ï¼åæç´¢å¼å°±æ¯å³é®è¯å°ææ¡£ id çæ å°ï¼æ¯ä¸ªå³é®è¯é½å¯¹åºçä¸ç³»åçæä»¶ï¼è¿äºæä»¶ä¸­é½åºç°äºå³é®è¯ã\n\nä¸¾ä¸ªæ å­ã\n\næä»¥ä¸ææ¡£ï¼\n\ndocid   doc\n1       è°·æ­å°å¾ä¹ç¶è·³æ§½ facebook\n2       è°·æ­å°å¾ä¹ç¶å ç facebook\n3       è°·æ­å°å¾åå§äººææ¯ç¦»å¼è°·æ­å ç facebook\n4       è°·æ­å°å¾ä¹ç¶è·³æ§½ facebook ä¸ wave é¡¹ç®åæ¶æå³\n5       è°·æ­å°å¾ä¹ç¶ææ¯å çç¤¾äº¤ç½ç« facebook\n\nå¯¹ææ¡£è¿è¡åè¯ä¹åï¼å¾å°ä»¥ä¸åæç´¢å¼ã\n\nwordid   word       docids\n1        è°·æ­         1, 2, 3, 4, 5\n2        å°å¾         1, 2, 3, 4, 5\n3        ä¹ç¶         1, 2, 4, 5\n4        è·³æ§½         1, 4\n5        facebook   1, 2, 3, 4, 5\n6        å ç         2, 3, 5\n7        åå§äºº        3\n8        ææ¯         3, 5\n9        ç¦»å¼         3\n10       ä¸          4\n..       ..         ..\n\nå¦å¤ï¼å®ç¨çåæç´¢å¼è¿å¯ä»¥è®°å½æ´å¤çä¿¡æ¯ï¼æ¯å¦ææ¡£é¢çä¿¡æ¯ï¼è¡¨ç¤ºå¨ææ¡£éåä¸­æå¤å°ä¸ªææ¡£åå«æä¸ªåè¯ã\n\né£ä¹ï¼æäºåæç´¢å¼ï¼æç´¢å¼æå¯ä»¥å¾æ¹ä¾¿å°ååºç¨æ·çæ¥è¯¢ãæ¯å¦ç¨æ·è¾å¥æ¥è¯¢ facebook ï¼æç´¢ç³»ç»æ¥æ¾åæç´¢å¼ï¼ä»ä¸­è¯»åºåå«è¿ä¸ªåè¯çææ¡£ï¼è¿äºææ¡£å°±æ¯æä¾ç»ç¨æ·çæç´¢ç»æã\n\nè¦æ³¨æåæç´¢å¼çä¸¤ä¸ªéè¦ç»èï¼\n\n * åæç´¢å¼ä¸­çææè¯é¡¹å¯¹åºä¸ä¸ªæå¤ä¸ªææ¡£ï¼\n * åæç´¢å¼ä¸­çè¯é¡¹æ ¹æ®å­å¸é¡ºåºååºæå\n\n> ä¸é¢åªæ¯ä¸ä¸ªç®åçæ å­ï¼å¹¶æ²¡æä¸¥æ ¼æç§å­å¸é¡ºåºååºæåã\n\n\n# elasticsearch çåæç´¢å¼æ¯ä»ä¹\n\né¢è¯å®ï¼æ³äºè§£ä½ å¯¹åºç¡æ¦å¿µçè®¤ç¥ã\n\nè§£ç­ï¼éä¿è§£éä¸ä¸å°±å¯ä»¥ã\n\nä¼ ç»çæä»¬çæ£ç´¢æ¯éè¿æç« ï¼éä¸ªéåæ¾å°å¯¹åºå³é®è¯çä½ç½®ã\n\nèåæç´¢å¼ï¼æ¯éè¿åè¯ç­ç¥ï¼å½¢æäºè¯åæç« çæ å°å³ç³»è¡¨ï¼è¿ç§è¯å¸+æ å°è¡¨å³ä¸ºåæç´¢å¼ãæäºåæç´¢å¼ï¼å°±è½å®ç° oï¼1ï¼æ¶é´å¤æåº¦çæçæ£ç´¢æç« äºï¼æå¤§çæé«äºæ£ç´¢æçã\n\n\n\nå­¦æ¯çè§£ç­æ¹å¼ï¼\n\nåæç´¢å¼ï¼ç¸åäºä¸ç¯æç« åå«äºåªäºè¯ï¼å®ä»è¯åºåï¼è®°è½½äºè¿ä¸ªè¯å¨åªäºææ¡£ä¸­åºç°è¿ï¼ç±ä¸¤é¨åç»æââè¯å¸ååæè¡¨ã\n\nå åé¡¹ï¼åæç´¢å¼çåºå±å®ç°æ¯åºäºï¼fstï¼finite state transducerï¼æ°æ®ç»æã\n\nlucene ä» 4+çæ¬åå¼å§å¤§éä½¿ç¨çæ°æ®ç»ææ¯ fstãfst æä¸¤ä¸ªä¼ç¹ï¼\n\nï¼1ï¼ç©ºé´å ç¨å°ãéè¿å¯¹è¯å¸ä¸­åè¯åç¼ååç¼çéå¤å©ç¨ï¼åç¼©äºå­å¨ç©ºé´ï¼\n\nï¼2ï¼æ¥è¯¢éåº¦å¿«ão(len(str))çæ¥è¯¢æ¶é´å¤æåº¦ã\n\n\n# 3ãelasticsearch ç´¢å¼æ°æ®å¤äºæä¹åï¼å¦ä½è°ä¼ï¼é¨ç½²\n\né¢è¯å®ï¼æ³äºè§£å¤§æ°æ®éçè¿ç»´è½åã\n\nè§£ç­ï¼ç´¢å¼æ°æ®çè§åï¼åºå¨åæåå¥½è§åï¼æ­£æè°âè®¾è®¡åè¡ï¼ç¼ç å¨åâï¼è¿æ ·æè½ææçé¿åçªå¦å¶æ¥çæ°æ®æ¿å¢å¯¼è´éç¾¤å¤çè½åä¸è¶³å¼åççº¿ä¸å®¢æ·æ£ç´¢æèå¶ä»ä¸å¡åå°å½±åã\n\nå¦ä½è°ä¼ï¼æ­£å¦é®é¢ 1 æè¯´ï¼è¿éç»åä¸ä¸ï¼\n\n3.1 å¨æç´¢å¼å±é¢\n\nåºäºæ¨¡æ¿+æ¶é´+rollover api æ»å¨åå»ºç´¢å¼ï¼ä¸¾ä¾ï¼è®¾è®¡é¶æ®µå®ä¹ï¼blog ç´¢å¼çæ¨¡æ¿æ ¼å¼ä¸ºï¼blogindexæ¶é´æ³çå½¢å¼ï¼æ¯å¤©éå¢æ°æ®ãè¿æ ·åçå¥½å¤ï¼ä¸è³äºæ°æ®éæ¿å¢å¯¼è´åä¸ªç´¢å¼æ°æ®ééå¸¸å¤§ï¼æ¥è¿äºä¸çº¿ 2 ç 32 æ¬¡å¹-1ï¼ç´¢å¼å­å¨è¾¾å°äº tb+çè³æ´å¤§ã\n\nä¸æ¦åä¸ªç´¢å¼å¾å¤§ï¼å­å¨ç­åç§é£é©ä¹éä¹èæ¥ï¼æä»¥è¦æåèè+åæ©é¿åã\n\n3.2 å­å¨å±é¢\n\nå·ç­æ°æ®åç¦»å­å¨ï¼ç­æ°æ®ï¼æ¯å¦æè¿ 3 å¤©æèä¸å¨çæ°æ®ï¼ï¼å¶ä½ä¸ºå·æ°æ®ã\n\nå¯¹äºå·æ°æ®ä¸ä¼ååå¥æ°æ°æ®ï¼å¯ä»¥èèå®æ force_merge å  shrink åç¼©æä½ï¼èçå­å¨ç©ºé´åæ£ç´¢æçã\n\n3.3 é¨ç½²å±é¢\n\nä¸æ¦ä¹åæ²¡æè§åï¼è¿éå°±å±äºåºæ¥ç­ç¥ã\n\nç»å es èªèº«çæ¯æå¨ææ©å±çç¹ç¹ï¼å¨ææ°å¢æºå¨çæ¹å¼å¯ä»¥ç¼è§£éç¾¤ååï¼æ³¨æï¼å¦æä¹åä¸»èç¹ç­è§ååçï¼ä¸éè¦éå¯éç¾¤ä¹è½å®æå¨ææ°å¢çã\n\n\n# 4ãelasticsearch æ¯å¦ä½å®ç° master éä¸¾ç\n\né¢è¯å®ï¼æ³äºè§£ es éç¾¤çåºå±åçï¼ä¸ååªå³æ³¨ä¸å¡å±é¢äºã\n\nè§£ç­ï¼\n\nåç½®åæï¼\n\nï¼1ï¼åªæåéä¸»èç¹ï¼masterï¼trueï¼çèç¹æè½æä¸ºä¸»èç¹ã\n\nï¼2ï¼æå°ä¸»èç¹æ°ï¼min_master_nodesï¼çç®çæ¯é²æ­¢èè£ã\n\næ ¸å¯¹äºä¸ä¸ä»£ç ï¼æ ¸å¿å¥å£ä¸º findmasterï¼éæ©ä¸»èç¹æåè¿åå¯¹åº masterï¼å¦åè¿å nullãéä¸¾æµç¨å¤§è´æè¿°å¦ä¸ï¼\n\nç¬¬ä¸æ­¥ï¼ç¡®è®¤åéä¸»èç¹æ°è¾¾æ ï¼elasticsearch.yml è®¾ç½®çå¼\n\ndiscovery.zen.minimum_master_nodesï¼\n\nç¬¬äºæ­¥ï¼æ¯è¾ï¼åå¤å®æ¯å¦å·å¤ master èµæ ¼ï¼å·å¤åéä¸»èç¹èµæ ¼çä¼åè¿åï¼\n\nè¥ä¸¤èç¹é½ä¸ºåéä¸»èç¹ï¼å id å°çå¼ä¼ä¸»èç¹ãæ³¨æè¿éç id ä¸º string ç±»åã\n\né¢å¤è¯ï¼è·åèç¹ id çæ¹æ³ã\n\n1get /_cat/nodes?v&amp;h=ip,port,heappercent,heapmax,id,name\n\n2ip port heappercent heapmax id name\n\n\n\n# è¯¦ç»æè¿°ä¸ä¸ elasticsearch ç´¢å¼ææ¡£çè¿ç¨\n\né¢è¯å®ï¼æ³äºè§£ es çåºå±åçï¼ä¸ååªå³æ³¨ä¸å¡å±é¢äºã\n\nè§£ç­ï¼\n\nè¿éçç´¢å¼ææ¡£åºè¯¥çè§£ä¸ºææ¡£åå¥ esï¼åå»ºç´¢å¼çè¿ç¨ã\n\nææ¡£åå¥åå«ï¼åææ¡£åå¥åæ¹é bulk åå¥ï¼è¿éåªè§£éä¸ä¸ï¼åææ¡£åå¥æµç¨ã\n\nè®°ä½å®æ¹ææ¡£ä¸­çè¿ä¸ªå¾ã\n\n\n\nç¬¬ä¸æ­¥ï¼å®¢æ·åéç¾¤æèç¹åå¥æ°æ®ï¼åéè¯·æ±ãï¼å¦ææ²¡ææå®è·¯ç±/åè°èç¹ï¼è¯·æ±çèç¹æ®æ¼è·¯ç±èç¹çè§è²ãï¼\n\nç¬¬äºæ­¥ï¼èç¹ 1 æ¥åå°è¯·æ±åï¼ä½¿ç¨ææ¡£_id æ¥ç¡®å®ææ¡£å±äºåç 0ãè¯·æ±ä¼è¢«è½¬å°å¦å¤çèç¹ï¼åå®èç¹ 3ãå æ­¤åç 0 çä¸»åçåéå°èç¹ 3 ä¸ã\n\nç¬¬ä¸æ­¥ï¼èç¹ 3 å¨ä¸»åçä¸æ§è¡åæä½ï¼å¦ææåï¼åå°è¯·æ±å¹¶è¡è½¬åå°èç¹ 1 åèç¹ 2 çå¯æ¬åçä¸ï¼ç­å¾ç»æè¿åãææçå¯æ¬åçé½æ¥åæåï¼èç¹ 3 å°ååè°èç¹ï¼èç¹ 1ï¼æ¥åæåï¼èç¹ 1 åè¯·æ±å®¢æ·ç«¯æ¥ååå¥æåã\n\nå¦æé¢è¯å®åé®ï¼ç¬¬äºæ­¥ä¸­çææ¡£è·ååççè¿ç¨ï¼\n\nåç­ï¼åå©è·¯ç±ç®æ³è·åï¼è·¯ç±ç®æ³å°±æ¯æ ¹æ®è·¯ç±åææ¡£ id è®¡ç®ç®æ çåç id çè¿ç¨ã\n\n1shard = hash(_routing) % (num_of_primary_shards)\n\n\n\n# è¯¦ç»æè¿°ä¸ä¸ elasticsearch æç´¢çè¿ç¨ï¼\n\né¢è¯å®ï¼æ³äºè§£ es æç´¢çåºå±åçï¼ä¸ååªå³æ³¨ä¸å¡å±é¢äºã\n\nè§£ç­ï¼\n\næç´¢æè§£ä¸ºâquery then fetchâ ä¸¤ä¸ªé¶æ®µã\n\nquery é¶æ®µçç®çï¼å®ä½å°ä½ç½®ï¼ä½ä¸åã\n\næ­¥éª¤æè§£å¦ä¸ï¼\n\nï¼1ï¼åè®¾ä¸ä¸ªç´¢å¼æ°æ®æ 5 ä¸»+1 å¯æ¬ å± 10 åçï¼ä¸æ¬¡è¯·æ±ä¼å½ä¸­ï¼ä¸»æèå¯æ¬åçä¸­ï¼çä¸ä¸ªã\n\nï¼2ï¼æ¯ä¸ªåçå¨æ¬å°è¿è¡æ¥è¯¢ï¼ç»æè¿åå°æ¬å°æåºçä¼åéåä¸­ã\n\nï¼3ï¼ç¬¬ 2ï¼æ­¥éª¤çç»æåéå°åè°èç¹ï¼åè°èç¹äº§çä¸ä¸ªå¨å±çæåºåè¡¨ã\n\nfetch é¶æ®µçç®çï¼åæ°æ®ã\n\nè·¯ç±èç¹è·åææææ¡£ï¼è¿åç»å®¢æ·ç«¯ã\n\n\n# elasticsearch å¨é¨ç½²æ¶ï¼å¯¹ linux çè®¾ç½®æåªäºä¼åæ¹æ³\n\né¢è¯å®ï¼æ³äºè§£å¯¹ es éç¾¤çè¿ç»´è½åã\n\nè§£ç­ï¼\n\nï¼1ï¼å³é­ç¼å­ swap;\n\nï¼2ï¼å åå­è®¾ç½®ä¸ºï¼minï¼èç¹åå­/2, 32gbï¼;\n\nï¼3ï¼è®¾ç½®æå¤§æä»¶å¥ææ°ï¼\n\nï¼4ï¼çº¿ç¨æ± +éåå¤§å°æ ¹æ®ä¸å¡éè¦åè°æ´ï¼\n\nï¼5ï¼ç£çå­å¨ raid æ¹å¼ââå­å¨ææ¡ä»¶ä½¿ç¨ raid10ï¼å¢å åèç¹æ§è½ä»¥åé¿ååèç¹å­å¨æéã\n\n\n# lucence åé¨ç»ææ¯ä»ä¹ï¼\n\né¢è¯å®ï¼æ³äºè§£ä½ çç¥è¯é¢çå¹¿åº¦åæ·±åº¦ã\n\nè§£ç­ï¼\n\n\n\nlucene æ¯æç´¢å¼åæç´¢çä¸¤ä¸ªè¿ç¨ï¼åå«ç´¢å¼åå»ºï¼ç´¢å¼ï¼æç´¢ä¸ä¸ªè¦ç¹ãå¯ä»¥åºäºè¿ä¸ªèç»å±å¼ä¸äºã\n\n\n# elasticsearch æ¯å¦ä½å®ç° master éä¸¾çï¼\n\nï¼1ï¼elasticsearch çéä¸»æ¯ zendiscovery æ¨¡åè´è´£çï¼ä¸»è¦åå« pingï¼èç¹ä¹é´éè¿è¿ä¸ª rpc æ¥åç°å½¼æ­¤ï¼å unicastï¼åæ­æ¨¡ååå«ä¸ä¸ªä¸»æºåè¡¨ä»¥æ§å¶åªäºèç¹éè¦ ping éï¼è¿ä¸¤é¨åï¼\n\nï¼2ï¼å¯¹ææå¯ä»¥æä¸º master çèç¹ï¼node.master: trueï¼æ ¹æ® nodeid å­å¸æåºï¼æ¯æ¬¡éä¸¾æ¯ä¸ªèç¹é½æèªå·±æç¥éèç¹æä¸æ¬¡åºï¼ç¶åéåºç¬¬ä¸ä¸ªï¼ç¬¬ 0 ä½ï¼èç¹ï¼æä¸è®¤ä¸ºå®æ¯ master èç¹ã\n\nï¼3ï¼å¦æå¯¹æä¸ªèç¹çæç¥¨æ°è¾¾å°ä¸å®çå¼ï¼å¯ä»¥æä¸º master èç¹æ° n/2+1ï¼å¹¶ä¸è¯¥èç¹èªå·±ä¹éä¸¾èªå·±ï¼é£è¿ä¸ªèç¹å°±æ¯ masterãå¦åéæ°éä¸¾ä¸ç´å°æ»¡è¶³ä¸è¿°æ¡ä»¶ã\n\nï¼4ï¼è¡¥åï¼master èç¹çèè´£ä¸»è¦åæ¬éç¾¤ãèç¹åç´¢å¼çç®¡çï¼ä¸è´è´£ææ¡£çº§å«çç®¡çï¼data èç¹å¯ä»¥å³é­ http åè½*ã\n\n\n# 10ãelasticsearch ä¸­çèç¹ï¼æ¯å¦å± 20 ä¸ªï¼ï¼å¶ä¸­ç 10 ä¸ª\n\néäºä¸ä¸ª masterï¼å¦å¤ 10 ä¸ªéäºå¦ä¸ä¸ª masterï¼æä¹åï¼\n\nï¼1ï¼å½éç¾¤ master åéæ°éä¸å°äº 3 ä¸ªæ¶ï¼å¯ä»¥éè¿è®¾ç½®æå°æç¥¨éè¿æ°éï¼discovery.zen.minimum_master_nodesï¼è¶è¿ææåéèç¹ä¸åä»¥ä¸æ¥è§£å³èè£é®é¢ï¼\n\nï¼3ï¼å½åéæ°éä¸ºä¸¤ä¸ªæ¶ï¼åªè½ä¿®æ¹ä¸ºå¯ä¸çä¸ä¸ª master åéï¼å¶ä»ä½ä¸º data èç¹ï¼é¿åèè£é®é¢ã\n\n\n# å®¢æ·ç«¯å¨åéç¾¤è¿æ¥æ¶ï¼å¦ä½éæ©ç¹å®çèç¹æ§è¡è¯·æ±çï¼\n\ntransportclient å©ç¨ transport æ¨¡åè¿ç¨è¿æ¥ä¸ä¸ª elasticsearch éç¾¤ãå®å¹¶ä¸å å¥å°éç¾¤ä¸­ï¼åªæ¯ç®åçè·å¾ä¸ä¸ªæèå¤ä¸ªåå§åç transport å°åï¼å¹¶ä»¥ è½®è¯¢ çæ¹å¼ä¸è¿äºå°åè¿è¡éä¿¡ã\n\n\n# è¯¦ç»æè¿°ä¸ä¸ elasticsearch ç´¢å¼ææ¡£çè¿ç¨ã\n\nåè°èç¹é»è®¤ä½¿ç¨ææ¡£ id åä¸è®¡ç®ï¼ä¹æ¯æéè¿ routingï¼ï¼ä»¥ä¾¿ä¸ºè·¯ç±æä¾åéçåçã\n\nshard = hash(document_id) % (num_of_primary_shards)\n\n\nï¼1ï¼å½åçæå¨çèç¹æ¥æ¶å°æ¥èªåè°èç¹çè¯·æ±åï¼ä¼å°è¯·æ±åå¥å° memorybufferï¼ç¶åå®æ¶ï¼é»è®¤æ¯æ¯é 1 ç§ï¼åå¥å° filesystem cacheï¼è¿ä¸ªä» momerybuffer å° filesystem cache çè¿ç¨å°±å«å refreshï¼\n\nï¼2ï¼å½ç¶å¨æäºæåµä¸ï¼å­å¨ momery buffer å filesystem cache çæ°æ®å¯è½ä¼ä¸¢å¤±ï¼es æ¯éè¿ translog çæºå¶æ¥ä¿è¯æ°æ®çå¯é æ§çãå¶å®ç°æºå¶æ¯æ¥æ¶å°è¯·æ±åï¼åæ¶ä¹ä¼åå¥å° translog ä¸­ ï¼å½ filesystem cache ä¸­çæ°æ®åå¥å°ç£çä¸­æ¶ï¼æä¼æ¸é¤æï¼è¿ä¸ªè¿ç¨å«å flushï¼\n\nï¼3ï¼å¨ flush è¿ç¨ä¸­ï¼åå­ä¸­çç¼å²å°è¢«æ¸é¤ï¼åå®¹è¢«åå¥ä¸ä¸ªæ°æ®µï¼æ®µç fsync å°åå»ºä¸ä¸ªæ°çæäº¤ç¹ï¼å¹¶å°åå®¹å·æ°å°ç£çï¼æ§ç translog å°è¢«å é¤å¹¶å¼å§ä¸ä¸ªæ°ç translogã\n\nï¼4ï¼flush è§¦åçæ¶æºæ¯å®æ¶è§¦åï¼é»è®¤ 30 åéï¼æè translog åå¾å¤ªå¤§ï¼é»è®¤ä¸º 512mï¼æ¶ï¼\n\n\n\nè¡¥åï¼å³äº lucene ç segementï¼\n\nï¼1ï¼lucene ç´¢å¼æ¯ç±å¤ä¸ªæ®µç»æï¼æ®µæ¬èº«æ¯ä¸ä¸ªåè½é½å¨çåæç´¢å¼ã\n\nï¼2ï¼æ®µæ¯ä¸å¯åçï¼åè®¸ lucene å°æ°çææ¡£å¢éå°æ·»å å°ç´¢å¼ä¸­ï¼èä¸ç¨ä»å¤´éå»ºç´¢å¼ã\n\nï¼3ï¼å¯¹äºæ¯ä¸ä¸ªæç´¢è¯·æ±èè¨ï¼ç´¢å¼ä¸­çæææ®µé½ä¼è¢«æç´¢ï¼å¹¶ä¸æ¯ä¸ªæ®µä¼æ¶è cpu çæ¶éå¨ãæä»¶å¥æååå­ãè¿æå³çæ®µçæ°éè¶å¤ï¼æç´¢æ§è½ä¼è¶ä½ã\n\nï¼4ï¼ä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼elasticsearch ä¼åå¹¶å°æ®µå°ä¸ä¸ªè¾å¤§çæ®µï¼æäº¤æ°çåå¹¶æ®µå°ç£çï¼å¹¶å é¤é£äºæ§çå°æ®µã\n\n\n# è¯¦ç»æè¿°ä¸ä¸ elasticsearch æ´æ°åå é¤ææ¡£çè¿ç¨ã\n\nï¼1ï¼å é¤åæ´æ°ä¹é½æ¯åæä½ï¼ä½æ¯ elasticsearch ä¸­çææ¡£æ¯ä¸å¯åçï¼å æ­¤ä¸è½è¢«å é¤æèæ¹å¨ä»¥å±ç¤ºå¶åæ´ï¼\n\nï¼2ï¼ç£çä¸çæ¯ä¸ªæ®µé½æä¸ä¸ªç¸åºç.del æä»¶ãå½å é¤è¯·æ±åéåï¼ææ¡£å¹¶æ²¡æççè¢«å é¤ï¼èæ¯å¨.del æä»¶ä¸­è¢«æ è®°ä¸ºå é¤ãè¯¥ææ¡£ä¾ç¶è½å¹éæ¥è¯¢ï¼ä½æ¯ä¼å¨ç»æä¸­è¢«è¿æ»¤æãå½æ®µåå¹¶æ¶ï¼å¨.del æä»¶ä¸­è¢«æ è®°ä¸ºå é¤çææ¡£å°ä¸ä¼è¢«åå¥æ°æ®µã\n\nï¼3ï¼å¨æ°çææ¡£è¢«åå»ºæ¶ï¼elasticsearch ä¼ä¸ºè¯¥ææ¡£æå®ä¸ä¸ªçæ¬å·ï¼å½æ§è¡æ´æ°æ¶ï¼æ§çæ¬çææ¡£å¨.del æä»¶ä¸­è¢«æ è®°ä¸ºå é¤ï¼æ°çæ¬çææ¡£è¢«ç´¢å¼å°ä¸ä¸ªæ°æ®µãæ§çæ¬çææ¡£ä¾ç¶è½å¹éæ¥è¯¢ï¼ä½æ¯ä¼å¨ç»æä¸­è¢«è¿æ»¤æã\n\n\n# è¯¦ç»æè¿°ä¸ä¸ elasticsearch æç´¢çè¿ç¨ã\n\nï¼1ï¼æç´¢è¢«æ§è¡æä¸ä¸ªä¸¤é¶æ®µè¿ç¨ï¼æä»¬ç§°ä¹ä¸º query then fetchï¼\n\nï¼2ï¼å¨åå§æ¥è¯¢é¶æ®µæ¶ï¼æ¥è¯¢ä¼å¹¿æ­å°ç´¢å¼ä¸­æ¯ä¸ä¸ªåçæ·è´ï¼ä¸»åçæèå¯æ¬åçï¼ã æ¯ä¸ªåçå¨æ¬å°æ§è¡æç´¢å¹¶æå»ºä¸ä¸ªå¹éææ¡£çå¤§å°ä¸º from + size çä¼åéåã\n\npsï¼å¨æç´¢çæ¶åæ¯ä¼æ¥è¯¢ filesystem cache çï¼ä½æ¯æé¨åæ°æ®è¿å¨ memorybufferï¼æä»¥æç´¢æ¯è¿å®æ¶çã\n\nï¼3ï¼æ¯ä¸ªåçè¿ååèªä¼åéåä¸­ ææææ¡£ç id åæåºå¼ ç»åè°èç¹ï¼å®åå¹¶è¿äºå¼å°èªå·±çä¼åéåä¸­æ¥äº§çä¸ä¸ªå¨å±æåºåçç»æåè¡¨ã\n\nï¼4ï¼æ¥ä¸æ¥å°±æ¯ ååé¶æ®µï¼åè°èç¹è¾¨å«åºåªäºææ¡£éè¦è¢«ååå¹¶åç¸å³çåçæäº¤å¤ä¸ª get è¯·æ±ãæ¯ä¸ªåçå è½½å¹¶ ä¸° å¯ ææ¡£ï¼å¦ææéè¦çè¯ï¼æ¥çè¿åææ¡£ç»åè°èç¹ãä¸æ¦ææçææ¡£é½è¢«ååäºï¼åè°èç¹è¿åç»æç»å®¢æ·ç«¯ã\n\nï¼5ï¼è¡¥åï¼query then fetch çæç´¢ç±»åå¨ææ¡£ç¸å³æ§æåçæ¶ååèçæ¯æ¬åççæ°æ®ï¼è¿æ ·å¨ææ¡£æ°éè¾å°çæ¶åå¯è½ä¸å¤åç¡®ï¼dfs query then fetch å¢å äºä¸ä¸ªé¢æ¥è¯¢çå¤çï¼è¯¢é® term å document frequencyï¼è¿ä¸ªè¯åæ´åç¡®ï¼ä½æ¯æ§è½ä¼åå·®ã*\n\n\n\n\n# å¨ elasticsearch ä¸­ï¼æ¯æä¹æ ¹æ®ä¸ä¸ªè¯æ¾å°å¯¹åºçåæç´¢å¼çï¼\n\nï¼1ï¼lucene çç´¢å¼è¿ç¨ï¼å°±æ¯æç§å¨ææ£ç´¢çåºæ¬è¿ç¨ï¼å°åæè¡¨åææ­¤æä»¶æ ¼å¼çè¿ç¨ã\n\nï¼2ï¼lucene çæç´¢è¿ç¨ï¼å°±æ¯æç§æ­¤æä»¶æ ¼å¼å°ç´¢å¼è¿å»çä¿¡æ¯è¯»åºæ¥ï¼ç¶åè®¡ç®æ¯ç¯ææ¡£æå(score)çè¿ç¨ã\n\n\n# elasticsearch å¨é¨ç½²æ¶ï¼å¯¹ linux çè®¾ç½®æåªäºä¼åæ¹æ³ï¼\n\nï¼1ï¼64 gb åå­çæºå¨æ¯éå¸¸çæ³çï¼ ä½æ¯ 32 gb å 16 gb æºå¨ä¹æ¯å¾å¸¸è§çãå°äº 8 gb ä¼éå¾å¶åã\n\nï¼2ï¼å¦æä½ è¦å¨æ´å¿«ç cpus åæ´å¤çæ ¸å¿ä¹é´éæ©ï¼éæ©æ´å¤çæ ¸å¿æ´å¥½ãå¤ä¸ªåæ ¸æä¾çé¢å¤å¹¶åè¿èè¿ç¨å¾®å¿«ä¸ç¹ç¹çæ¶éé¢çã\n\nï¼3ï¼å¦æä½ è´æå¾èµ· ssdï¼å®å°è¿è¿è¶åºä»»ä½æè½¬ä»è´¨ã åºäº ssd çèç¹ï¼æ¥è¯¢åç´¢å¼æ§è½é½ææåãå¦æä½ è´æå¾èµ·ï¼ssd æ¯ä¸ä¸ªå¥½çéæ©ã\n\nï¼4ï¼å³ä½¿æ°æ®ä¸­å¿ä»¬è¿å¨å«å°ºï¼ä¹è¦é¿åéç¾¤è·¨è¶å¤ä¸ªæ°æ®ä¸­å¿ãç»å¯¹è¦é¿åéç¾¤è·¨è¶å¤§çå°çè·ç¦»ã\n\nï¼5ï¼è¯·ç¡®ä¿è¿è¡ä½ åºç¨ç¨åºç jvm åæå¡å¨ç jvm æ¯å®å¨ä¸æ ·çã å¨ elasticsearch çå ä¸ªå°æ¹ï¼ä½¿ç¨ java çæ¬å°åºååã\n\nï¼6ï¼éè¿è®¾ç½® gateway.recover_after_nodesãgateway.expected_nodesãgateway.recover_after_time å¯ä»¥å¨éç¾¤éå¯çæ¶åé¿åè¿å¤çåçäº¤æ¢ï¼è¿å¯è½ä¼è®©æ°æ®æ¢å¤ä»æ°ä¸ªå°æ¶ç¼©ç­ä¸ºå ç§éã\n\nï¼7ï¼elasticsearch é»è®¤è¢«éç½®ä¸ºä½¿ç¨åæ­åç°ï¼ä»¥é²æ­¢èç¹æ æä¸­å å¥éç¾¤ãåªæå¨åä¸å°æºå¨ä¸è¿è¡çèç¹æä¼èªå¨ç»æéç¾¤ãæå¥½ä½¿ç¨åæ­ä»£æ¿ç»æ­ã\n\nï¼8ï¼ä¸è¦éæä¿®æ¹åå¾åæ¶å¨ï¼cmsï¼ååä¸ªçº¿ç¨æ± çå¤§å°ã\n\nï¼9ï¼æä½ çåå­çï¼å°äºï¼ä¸åç» luceneï¼ä½ä¸è¦è¶è¿ 32 gbï¼ï¼ï¼éè¿ es_heap_size ç¯å¢åéè®¾ç½®ã\n\nï¼10ï¼åå­äº¤æ¢å°ç£çå¯¹æå¡å¨æ§è½æ¥è¯´æ¯è´å½çãå¦æåå­äº¤æ¢å°ç£çä¸ï¼ä¸ä¸ª 100 å¾®ç§çæä½å¯è½åæ 10 æ¯«ç§ã åæ³æ³é£ä¹å¤ 10 å¾®ç§çæä½æ¶å»¶ç´¯å èµ·æ¥ã ä¸é¾çåº swapping å¯¹äºæ§è½æ¯å¤ä¹å¯æã\n\nï¼11ï¼lucene ä½¿ç¨äºå¤§ é çæä»¶ãåæ¶ï¼elasticsearch å¨èç¹å http å®¢æ·ç«¯ä¹é´è¿è¡éä¿¡ä¹ä½¿ç¨äºå¤§éçå¥æ¥å­ã ææè¿ä¸åé½éè¦è¶³å¤çæä»¶æè¿°ç¬¦ãä½ åºè¯¥å¢å ä½ çæä»¶æè¿°ç¬¦ï¼è®¾ç½®ä¸ä¸ªå¾å¤§çå¼ï¼å¦ 64,000ã\n\nè¡¥åï¼ç´¢å¼é¶æ®µæ§è½æåæ¹æ³\n\nï¼1ï¼ä½¿ç¨æ¹éè¯·æ±å¹¶è°æ´å¶å¤§å°ï¼æ¯æ¬¡æ¹éæ°æ® 5â15 mb å¤§æ¯ä¸ªä¸éçèµ·å§ç¹ã\n\nï¼2ï¼å­å¨ï¼ä½¿ç¨ ssd\n\nï¼3ï¼æ®µååå¹¶ï¼elasticsearch é»è®¤å¼æ¯ 20 mb/sï¼å¯¹æºæ¢°ç£çåºè¯¥æ¯ä¸ªä¸éçè®¾ç½®ãå¦æä½ ç¨çæ¯ ssdï¼å¯ä»¥èèæé«å° 100â200 mb/sãå¦æä½ å¨åæ¹éå¯¼å¥ï¼å®å¨ä¸å¨ææç´¢ï¼ä½ å¯ä»¥å½»åºå³æåå¹¶éæµãå¦å¤è¿å¯ä»¥å¢å  index.translog.flush_threshold_size è®¾ç½®ï¼ä»é»è®¤ç 512 mb å°æ´å¤§ä¸äºçå¼ï¼æ¯å¦ 1 gbï¼è¿å¯ä»¥å¨ä¸æ¬¡æ¸ç©ºè§¦åçæ¶åå¨äºå¡æ¥å¿éç§¯ç´¯åºæ´å¤§çæ®µã\n\nï¼4ï¼å¦æä½ çæç´¢ç»æä¸éè¦è¿å®æ¶çåç¡®åº¦ï¼èèææ¯ä¸ªç´¢å¼ç index.refresh_interval æ¹å° 30sã\n\nï¼5ï¼å¦æä½ å¨åå¤§æ¹éå¯¼å¥ï¼èèéè¿è®¾ç½® index.number_of_replicas: 0 å³é­å¯æ¬ã\n\n\n# å¯¹äº gc æ¹é¢ï¼å¨ä½¿ç¨ elasticsearch æ¶è¦æ³¨æä»ä¹ï¼\n\nï¼1ï¼åæè¯å¸çç´¢å¼éè¦å¸¸é©»åå­ï¼æ æ³ gcï¼éè¦çæ§ data node ä¸ segmentmemory å¢é¿è¶å¿ã\n\nï¼2ï¼åç±»ç¼å­ï¼field cache, filter cache, indexing cache, bulk queue ç­ç­ï¼è¦è®¾ç½®åççå¤§å°ï¼å¹¶ä¸è¦åºè¯¥æ ¹æ®æåçæåµæ¥ç heap æ¯å¦å¤ç¨ï¼ä¹å°±æ¯åç±»ç¼å­å¨é¨å æ»¡çæ¶åï¼è¿æ heap ç©ºé´å¯ä»¥åéç»å¶ä»ä»»å¡åï¼é¿åéç¨ clear cache ç­âèªæ¬ºæ¬ºäººâçæ¹å¼æ¥éæ¾åå­ã\n\nï¼3ï¼é¿åè¿åå¤§éç»æéçæç´¢ä¸èåãç¡®å®éè¦å¤§éæåæ°æ®çåºæ¯ï¼å¯ä»¥éç¨ scan & scroll api æ¥å®ç°ã\n\nï¼4ï¼cluster stats é©»çåå­å¹¶æ æ³æ°´å¹³æ©å±ï¼è¶å¤§è§æ¨¡éç¾¤å¯ä»¥èèåææå¤ä¸ªéç¾¤éè¿ tribe node è¿æ¥ã\n\nï¼5ï¼æ³ç¥é heap å¤ä¸å¤ï¼å¿é¡»ç»åå®éåºç¨åºæ¯ï¼å¹¶å¯¹éç¾¤ç heap ä½¿ç¨æåµåæç»­ççæ§ã\n\nï¼6ï¼æ ¹æ®çæ§æ°æ®çè§£åå­éæ±ï¼åçéç½®åç±» circuit breakerï¼å°åå­æº¢åºé£é©éä½å°æä½\n\n\n# 18ãelasticsearch å¯¹äºå¤§æ°æ®éï¼ä¸äº¿éçº§ï¼çèåå¦ä½å®ç°ï¼\n\nelasticsearch æä¾çé¦ä¸ªè¿ä¼¼èåæ¯ cardinality åº¦éãå®æä¾ä¸ä¸ªå­æ®µçåºæ°ï¼å³è¯¥å­æ®µç distinct æè unique å¼çæ°ç®ãå®æ¯åºäº hll ç®æ³çãhll ä¼åå¯¹æä»¬çè¾å¥ä½åå¸è¿ç®ï¼ç¶åæ ¹æ®åå¸è¿ç®çç»æä¸­ç bits åæ¦çä¼°ç®ä»èå¾å°åºæ°ãå¶ç¹ç¹æ¯ï¼å¯éç½®çç²¾åº¦ï¼ç¨æ¥æ§å¶åå­çä½¿ç¨ï¼æ´ç²¾ç¡® ï¼ æ´å¤åå­ï¼ï¼å°çæ°æ®éç²¾åº¦æ¯éå¸¸é«çï¼æä»¬å¯ä»¥éè¿éç½®åæ°ï¼æ¥è®¾ç½®å»ééè¦çåºå®åå­ä½¿ç¨éãæ è®ºæ°åè¿æ¯æ°åäº¿çå¯ä¸å¼ï¼åå­ä½¿ç¨éåªä¸ä½ éç½®çç²¾ç¡®åº¦ç¸å³ã\n\n\n# 19ãå¨å¹¶åæåµä¸ï¼elasticsearch å¦æä¿è¯è¯»åä¸è´ï¼\n\nï¼1ï¼å¯ä»¥éè¿çæ¬å·ä½¿ç¨ä¹è§å¹¶åæ§å¶ï¼ä»¥ç¡®ä¿æ°çæ¬ä¸ä¼è¢«æ§çæ¬è¦çï¼ç±åºç¨å±æ¥å¤çå·ä½çå²çªï¼\n\nï¼2ï¼å¦å¤å¯¹äºåæä½ï¼ä¸è´æ§çº§å«æ¯æ quorum/one/allï¼é»è®¤ä¸º quorumï¼å³åªæå½å¤§å¤æ°åçå¯ç¨æ¶æåè®¸åæä½ãä½å³ä½¿å¤§å¤æ°å¯ç¨ï¼ä¹å¯è½å­å¨å ä¸ºç½ç»ç­åå å¯¼è´åå¥å¯æ¬å¤±è´¥ï¼è¿æ ·è¯¥å¯æ¬è¢«è®¤ä¸ºæéï¼åçå°ä¼å¨ä¸ä¸ªä¸åçèç¹ä¸éå»ºã\n\nï¼3ï¼å¯¹äºè¯»æä½ï¼å¯ä»¥è®¾ç½® replication ä¸º sync(é»è®¤)ï¼è¿ä½¿å¾æä½å¨ä¸»åçåå¯æ¬åçé½å®æåæä¼è¿åï¼å¦æè®¾ç½® replication ä¸º async æ¶ï¼ä¹å¯ä»¥éè¿è®¾ç½®æç´¢è¯·æ±åæ°_preference ä¸º primary æ¥æ¥è¯¢ä¸»åçï¼ç¡®ä¿ææ¡£æ¯ææ°çæ¬ã\n\n\n# 20ãå¦ä½çæ§ elasticsearch éç¾¤ç¶æï¼\n\nmarvel è®©ä½ å¯ä»¥å¾ç®åçéè¿ kibana çæ§ elasticsearchãä½ å¯ä»¥å®æ¶æ¥çä½ çéç¾¤å¥åº·ç¶æåæ§è½ï¼ä¹å¯ä»¥åæè¿å»çéç¾¤ãç´¢å¼åèç¹ææ ã\n\n\n# 21ãä»ç»ä¸ä½ ä»¬çµåæç´¢çæ´ä½ææ¯æ¶æã\n\n\n\n\n# ä»ç»ä¸ä¸ä½ ä»¬çä¸ªæ§åæç´¢æ¹æ¡ï¼\n\nåºäº word2vec å elasticsearch å®ç°ä¸ªæ§åæç´¢\n\nï¼1ï¼åºäº word2vecãelasticsearch åèªå®ä¹çèæ¬æä»¶ï¼æä»¬å°±å®ç°äºä¸ä¸ªä¸ªæ§åçæç´¢æå¡ï¼ç¸å¯¹äºåæçå®ç°ï¼æ°ççç¹å»çåè½¬åçé½æå¤§å¹çæåï¼\n\nï¼2ï¼åºäº word2vec çåååéè¿æä¸ä¸ªå¯ç¨ä¹å¤ï¼å°±æ¯å¯ä»¥ç¨æ¥å®ç°ç¸ä¼¼ååçæ¨èï¼\n\nï¼3ï¼ä½¿ç¨ word2vec æ¥å®ç°ä¸ªæ§åæç´¢æä¸ªæ§åæ¨èæ¯æä¸å®å±éæ§çï¼å ä¸ºå®åªè½å¤çç¨æ·ç¹å»åå²è¿æ ·çæ¶åºæ°æ®ï¼èæ æ³å¨é¢çå»èèç¨æ·åå¥½ï¼è¿ä¸ªè¿æ¯æå¾å¤§çæ¹è¿åæåçç©ºé´ï¼\n\n\n# æ¯å¦äºè§£å­å¸æ ï¼\n\nå¸¸ç¨å­å¸æ°æ®ç»æå¦ä¸æç¤ºï¼\n\n\n\ntrie çæ ¸å¿ææ³æ¯ç©ºé´æ¢æ¶é´ï¼å©ç¨å­ç¬¦ä¸²çå¬å±åç¼æ¥éä½æ¥è¯¢æ¶é´çå¼éä»¥è¾¾å°æé«æççç®çãå®æ 3 ä¸ªåºæ¬æ§è´¨ï¼\n\n1ï¼æ ¹èç¹ä¸åå«å­ç¬¦ï¼é¤æ ¹èç¹å¤æ¯ä¸ä¸ªèç¹é½åªåå«ä¸ä¸ªå­ç¬¦ã\n\n2ï¼ä»æ ¹èç¹å°æä¸èç¹ï¼è·¯å¾ä¸ç»è¿çå­ç¬¦è¿æ¥èµ·æ¥ï¼ä¸ºè¯¥èç¹å¯¹åºçå­ç¬¦ä¸²ã\n\n3ï¼æ¯ä¸ªèç¹çææå­èç¹åå«çå­ç¬¦é½ä¸ç¸åã\n\n\n\nï¼1ï¼å¯ä»¥çå°ï¼trie æ æ¯ä¸å±çèç¹æ°æ¯ 26^i çº§å«çãæä»¥ä¸ºäºèçç©ºé´ï¼æä»¬è¿å¯ä»¥ç¨å¨æé¾è¡¨ï¼æèç¨æ°ç»æ¥æ¨¡æå¨æãèç©ºé´çè±è´¹ï¼ä¸ä¼è¶è¿åè¯æ° Ã åè¯é¿åº¦ã\n\nï¼2ï¼å®ç°ï¼å¯¹æ¯ä¸ªç»ç¹å¼ä¸ä¸ªå­æ¯éå¤§å°çæ°ç»ï¼æ¯ä¸ªç»ç¹æä¸ä¸ªé¾è¡¨ï¼ä½¿ç¨å·¦å¿å­å³åå¼è¡¨ç¤ºæ³è®°å½è¿æ£µæ ï¼\n\nï¼3ï¼å¯¹äºä¸­æçå­å¸æ ï¼æ¯ä¸ªèç¹çå­èç¹ç¨ä¸ä¸ªåå¸è¡¨å­å¨ï¼è¿æ ·å°±ä¸ç¨æµªè´¹å¤ªå¤§çç©ºé´ï¼èä¸æ¥è¯¢éåº¦ä¸å¯ä»¥ä¿çåå¸çå¤æåº¦ o(1)ã\n\n\n# æ¼åçº éæ¯å¦ä½å®ç°çï¼\n\nï¼1ï¼æ¼åçº éæ¯åºäºç¼è¾è·ç¦»æ¥å®ç°ï¼ç¼è¾è·ç¦»æ¯ä¸ç§æ åçæ¹æ³ï¼å®ç¨æ¥è¡¨ç¤ºç»è¿æå¥ãå é¤åæ¿æ¢æä½ä»ä¸ä¸ªå­ç¬¦ä¸²è½¬æ¢å°å¦å¤ä¸ä¸ªå­ç¬¦ä¸²çæå°æä½æ­¥æ°ï¼\n\nï¼2ï¼ç¼è¾è·ç¦»çè®¡ç®è¿ç¨ï¼æ¯å¦è¦è®¡ç® batyu å beauty çç¼è¾è·ç¦»ï¼ååå»ºä¸ä¸ª 7Ã8 çè¡¨ï¼batyu é¿åº¦ä¸º 5ï¼coffee é¿åº¦ä¸º 6ï¼åå  2ï¼ï¼æ¥çï¼å¨å¦ä¸ä½ç½®å¡«å¥é»è²æ°å­ãå¶ä»æ ¼çè®¡ç®è¿ç¨æ¯åä»¥ä¸ä¸ä¸ªå¼çæå°å¼ï¼\n\nå¦ææä¸æ¹çå­ç¬¦ç­äºæå·¦æ¹çå­ç¬¦ï¼åä¸ºå·¦ä¸æ¹çæ°å­ãå¦åä¸ºå·¦ä¸æ¹çæ°å­+1ãï¼å¯¹äº 3,3 æ¥è¯´ä¸º 0ï¼\n\nå·¦æ¹æ°å­+1ï¼å¯¹äº 3,3 æ ¼æ¥è¯´ä¸º 2ï¼\n\nä¸æ¹æ°å­+1ï¼å¯¹äº 3,3 æ ¼æ¥è¯´ä¸º 2ï¼\n\næç»åå³ä¸è§çå¼å³ä¸ºç¼è¾è·ç¦»çå¼ 3ã\n\n\n\nå¯¹äºæ¼åçº éï¼æä»¬èèæé ä¸ä¸ªåº¦éç©ºé´ï¼metric spaceï¼ï¼è¯¥ç©ºé´åä»»ä½å³ç³»æ»¡è¶³ä»¥ä¸ä¸æ¡åºæ¬æ¡ä»¶ï¼\n\nd(x,y) = 0 -- åå¦ x ä¸ y çè·ç¦»ä¸º 0ï¼å x=y\n\nd(x,y) = d(y,x) -- x å° y çè·ç¦»ç­åäº y å° x çè·ç¦»\n\nd(x,y) + d(y,z) >= d(x,z) -- ä¸è§ä¸ç­å¼\n\nï¼1ï¼æ ¹æ®ä¸è§ä¸ç­å¼ï¼åæ»¡è¶³ä¸ query è·ç¦»å¨ n èå´åçå¦ä¸ä¸ªå­ç¬¦è½¬ bï¼å¶ä¸ a çè·ç¦»æå¤§ä¸º d+nï¼æå°ä¸º d-nã\n\nï¼2ï¼bk æ çæé å°±è¿ç¨å¦ä¸ï¼æ¯ä¸ªèç¹æä»»æä¸ªå­èç¹ï¼æ¯æ¡è¾¹æä¸ªå¼è¡¨ç¤ºç¼è¾è·ç¦»ãææå­èç¹å°ç¶èç¹çè¾¹ä¸æ æ³¨ n è¡¨ç¤ºç¼è¾è·ç¦»æ°å¥½ä¸º nãæ¯å¦ï¼æä»¬ææ£µæ ç¶èç¹æ¯âbookâåä¸¤ä¸ªå­èç¹âcakeâåâbooksâï¼âbookâå°âbooksâçè¾¹æ å· 1ï¼âbookâå°âcakeâçè¾¹ä¸æ å· 4ãä»å­å¸éæé å¥½æ åï¼æ è®ºä½æ¶ä½ æ³æå¥æ°åè¯æ¶ï¼è®¡ç®è¯¥åè¯ä¸æ ¹èç¹çç¼è¾è·ç¦»ï¼å¹¶ä¸æ¥æ¾æ°å¼ä¸º d(neweord, root)çè¾¹ãéå½å¾ä¸åå­èç¹è¿è¡æ¯è¾ï¼ç´å°æ²¡æå­èç¹ï¼ä½ å°±å¯ä»¥åå»ºæ°çå­èç¹å¹¶å°æ°åè¯ä¿å­å¨é£ãæ¯å¦ï¼æå¥âbooâå°åæä¸è¿°ä¾å­çæ ä¸­ï¼æä»¬åæ£æ¥æ ¹èç¹ï¼æ¥æ¾ d(âbookâ, âbooâ) = 1 çè¾¹ï¼ç¶åæ£æ¥æ å·ä¸º 1 çè¾¹çå­èç¹ï¼å¾å°åè¯âbooksâãæä»¬åè®¡ç®è·ç¦» d(âbooksâ, âbooâ)=2ï¼åå°æ°åè¯æå¨âbooksâä¹åï¼è¾¹æ å·ä¸º 2ã\n\nï¼3ï¼æ¥è¯¢ç¸ä¼¼è¯å¦ä¸ï¼è®¡ç®åè¯ä¸æ ¹èç¹çç¼è¾è·ç¦» dï¼ç¶åéå½æ¥æ¾æ¯ä¸ªå­èç¹æ å·ä¸º d-n å° d+nï¼åå«ï¼çè¾¹ãåå¦è¢«æ£æ¥çèç¹ä¸æç´¢åè¯çè·ç¦» d å°äº nï¼åè¿åè¯¥èç¹å¹¶ç»§ç»­æ¥è¯¢ãæ¯å¦è¾å¥ cape ä¸æå¤§å®¹å¿è·ç¦»ä¸º 1ï¼ååè®¡ç®åæ ¹çç¼è¾è·ç¦» d(âbookâ, âcapeâ)=4ï¼ç¶åæ¥çæ¾åæ ¹èç¹ä¹é´ç¼è¾è·ç¦»ä¸º 3 å° 5 çï¼è¿ä¸ªå°±æ¾å°äº cake è¿ä¸ªèç¹ï¼è®¡ç® d(âcakeâ, âcapeâ)=1ï¼æ»¡è¶³æ¡ä»¶æä»¥è¿å cakeï¼ç¶ååæ¾å cake èç¹ç¼è¾è·ç¦»æ¯ 0 å° 2 çï¼åå«æ¾å° cape å cart èç¹ï¼è¿æ ·å°±å¾å° cape è¿ä¸ªæ»¡è¶³æ¡ä»¶çç»æã\n\n",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Elasticsearch å¿«éå¥é¨",frontmatter:{title:"Elasticsearch å¿«éå¥é¨",date:"2020-06-16T07:10:44.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],permalink:"/pages/98c3a5/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/02.Elasticsearch%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.html",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/02.Elasticsearchå¿«éå¥é¨.md",key:"v-41d7fd45",path:"/pages/98c3a5/",headers:[{level:2,title:"Elasticsearch ç®ä»",slug:"elasticsearch-ç®ä»",normalizedTitle:"elasticsearch ç®ä»",charIndex:267},{level:3,title:"ä»ä¹æ¯ Elasticsearch",slug:"ä»ä¹æ¯-elasticsearch",normalizedTitle:"ä»ä¹æ¯ elasticsearch",charIndex:288},{level:3,title:"æ ¸å¿æ¦å¿µ",slug:"æ ¸å¿æ¦å¿µ",normalizedTitle:"æ ¸å¿æ¦å¿µ",charIndex:669},{level:4,title:"Cluster",slug:"cluster",normalizedTitle:"cluster",charIndex:725},{level:4,title:"Node",slug:"node",normalizedTitle:"node",charIndex:796},{level:4,title:"Index",slug:"index",normalizedTitle:"index",charIndex:940},{level:4,title:"Type",slug:"type",normalizedTitle:"type",charIndex:1103},{level:4,title:"Document",slug:"document",normalizedTitle:"document",charIndex:1369},{level:4,title:"Field",slug:"field",normalizedTitle:"field",charIndex:1618},{level:4,title:"Shard",slug:"shard",normalizedTitle:"shard",charIndex:1708},{level:4,title:"Replica",slug:"replica",normalizedTitle:"replica",charIndex:1882},{level:4,title:"ES æ ¸å¿æ¦å¿µ vs. DB æ ¸å¿æ¦å¿µ",slug:"es-æ ¸å¿æ¦å¿µ-vs-db-æ ¸å¿æ¦å¿µ",normalizedTitle:"es æ ¸å¿æ¦å¿µ vs. db æ ¸å¿æ¦å¿µ",charIndex:2161},{level:2,title:"ElasticSearch åºæ¬åç",slug:"elasticsearch-åºæ¬åç",normalizedTitle:"elasticsearch åºæ¬åç",charIndex:2246},{level:3,title:"ES åæ°æ®è¿ç¨",slug:"es-åæ°æ®è¿ç¨",normalizedTitle:"es åæ°æ®è¿ç¨",charIndex:2269},{level:3,title:"ES è¯»æ°æ®è¿ç¨",slug:"es-è¯»æ°æ®è¿ç¨",normalizedTitle:"es è¯»æ°æ®è¿ç¨",charIndex:2546},{level:3,title:"es æç´¢æ°æ®è¿ç¨",slug:"es-æç´¢æ°æ®è¿ç¨",normalizedTitle:"es æç´¢æ°æ®è¿ç¨",charIndex:2887},{level:3,title:"åæ°æ®åºå±åç",slug:"åæ°æ®åºå±åç",normalizedTitle:"åæ°æ®åºå±åç",charIndex:3381},{level:3,title:"å é¤/æ´æ°æ°æ®åºå±åç",slug:"å é¤-æ´æ°æ°æ®åºå±åç",normalizedTitle:"å é¤/æ´æ°æ°æ®åºå±åç",charIndex:5637},{level:3,title:"åºå± lucene",slug:"åºå±-lucene",normalizedTitle:"åºå± lucene",charIndex:6077},{level:3,title:"åæç´¢å¼",slug:"åæç´¢å¼",normalizedTitle:"åæç´¢å¼",charIndex:5627},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:7161}],headersStr:"Elasticsearch ç®ä» ä»ä¹æ¯ Elasticsearch æ ¸å¿æ¦å¿µ Cluster Node Index Type Document Field Shard Replica ES æ ¸å¿æ¦å¿µ vs. DB æ ¸å¿æ¦å¿µ ElasticSearch åºæ¬åç ES åæ°æ®è¿ç¨ ES è¯»æ°æ®è¿ç¨ es æç´¢æ°æ®è¿ç¨ åæ°æ®åºå±åç å é¤/æ´æ°æ°æ®åºå±åç åºå± lucene åæç´¢å¼ åèèµæ",content:'# Elasticsearch å¿«éå¥é¨\n\n> Elasticsearch æ¯ä¸ä¸ªåå¸å¼ãRESTful é£æ ¼çæç´¢åæ°æ®åæå¼æï¼è½å¤è§£å³ä¸æ­æ¶ç°åºçåç§ç¨ä¾ã ä½ä¸º Elastic Stack çæ ¸å¿ï¼å®éä¸­å­å¨æ¨çæ°æ®ï¼å¸®å©æ¨åç°ææä¹ä¸­ä»¥åææä¹å¤çæåµã\n> \n> Elasticsearch åºäºæç´¢åº Lucene å¼åãElasticSearch éèäº Lucene çå¤ææ§ï¼æä¾äºç®åæç¨ç REST API / Java API æ¥å£ï¼å¦å¤è¿æå¶ä»è¯­è¨ç API æ¥å£ï¼ã\n> \n> ä»¥ä¸ç®ç§° ESã\n\n\n# Elasticsearch ç®ä»\n\n\n# ä»ä¹æ¯ Elasticsearch\n\nElasticsearch æ¯ä¸ä¸ªåå¸å¼ãRESTful é£æ ¼çæç´¢åæ°æ®åæå¼æï¼è½å¤è§£å³ä¸æ­æ¶ç°åºçåç§ç¨ä¾ã ä½ä¸º Elastic Stack çæ ¸å¿ï¼å®éä¸­å­å¨æ¨çæ°æ®ï¼å¸®å©æ¨åç°ææä¹ä¸­ä»¥åææä¹å¤çæåµã\n\nElasticsearch åºäºæç´¢åº Lucene å¼åãElasticSearch éèäº Lucene çå¤ææ§ï¼æä¾äºç®åæç¨ç REST API / Java API æ¥å£ï¼å¦å¤è¿æå¶ä»è¯­è¨ç API æ¥å£ï¼ã\n\nElasticSearch å¯ä»¥è§ä¸ºä¸ä¸ªææ¡£å­å¨ï¼å®å°å¤ææ°æ®ç»æåºååä¸º JSON å­å¨ã\n\nElasticSearch æ¯è¿ä¹äºå®æ¶çå¨ææç´ ï¼è¿æ¯æï¼\n\n * ä»åå¥æ°æ®å°æ°æ®å¯ä»¥è¢«æç´¢ï¼å­å¨è¾å°çå»¶è¿ï¼å¤§æ¦æ¯ 1sï¼\n * åºäº ES æ§è¡æç´¢ååæå¯ä»¥è¾¾å°ç§çº§\n\n\n# æ ¸å¿æ¦å¿µ\n\nindex -> type -> mapping -> document -> field\n\n\n# Cluster\n\néç¾¤åå«å¤ä¸ªèç¹ï¼æ¯ä¸ªèç¹å±äºåªä¸ªéç¾¤é½æ¯éè¿ä¸ä¸ªéç½®æ¥å³å®çï¼å¯¹äºä¸­å°ååºç¨æ¥è¯´ï¼åå¼å§ä¸ä¸ªéç¾¤å°±ä¸ä¸ªèç¹å¾æ­£å¸¸ã\n\n# Node\n\nNode æ¯éç¾¤ä¸­çä¸ä¸ªèç¹ï¼èç¹ä¹æä¸ä¸ªåç§°ï¼é»è®¤æ¯éæºåéçãé»è®¤èç¹ä¼å»å å¥ä¸ä¸ªåç§°ä¸º elasticsearch çéç¾¤ãå¦æç´æ¥å¯å¨ä¸å èç¹ï¼é£ä¹å®ä»¬ä¼èªå¨ç»æä¸ä¸ª elasticsearch éç¾¤ï¼å½ç¶ä¸ä¸ªèç¹ä¹å¯ä»¥ç»æ elasticsearch éç¾¤ã\n\n# Index\n\nå¯ä»¥è®¤ä¸ºæ¯ææ¡£ï¼documentï¼çä¼åéåã\n\nES ä¼ä¸ºææå­æ®µå»ºç«ç´¢å¼ï¼ç»è¿å¤çååå¥ä¸ä¸ªååç´¢å¼ï¼Inverted Indexï¼ãæ¥æ¾æ°æ®çæ¶åï¼ç´æ¥æ¥æ¾è¯¥ç´¢å¼ã\n\næä»¥ï¼ES æ°æ®ç®¡ççé¡¶å±åä½å°±å«å Indexï¼ç´¢å¼ï¼ãå®æ¯åä¸ªæ°æ®åºçåä¹è¯ãæ¯ä¸ª Index ï¼å³æ°æ®åºï¼çåå­å¿é¡»æ¯å°åã\n\n# Type\n\næ¯ä¸ªç´¢å¼éå¯ä»¥æä¸ä¸ªæèå¤ä¸ªç±»åï¼typeï¼ãç±»åï¼typeï¼ æ¯ index çä¸ä¸ªé»è¾åç±»ã\n\nä¸åç Type åºè¯¥æç¸ä¼¼çç»æï¼schemaï¼ï¼ä¸¾ä¾æ¥è¯´ï¼idå­æ®µä¸è½å¨è¿ä¸ªç»æ¯å­ç¬¦ä¸²ï¼å¨å¦ä¸ä¸ªç»æ¯æ°å¼ãè¿æ¯ä¸å³ç³»åæ°æ®åºçè¡¨çä¸ä¸ªåºå«ãæ§è´¨å®å¨ä¸åçæ°æ®ï¼æ¯å¦productsålogsï¼åºè¯¥å­æä¸¤ä¸ª Indexï¼èä¸æ¯ä¸ä¸ª Index éé¢çä¸¤ä¸ª Typeï¼è½ç¶å¯ä»¥åå°ï¼ã\n\n> æ³¨æï¼æ ¹æ®è§åï¼Elastic 6.x çåªåè®¸æ¯ä¸ª Index åå«ä¸ä¸ª Typeï¼7.x çå°ä¼å½»åºç§»é¤ Typeã\n\n# Document\n\nIndex éé¢åæ¡çè®°å½ç§°ä¸º Documentï¼ææ¡£ï¼ãè®¸å¤æ¡ Document ææäºä¸ä¸ª Indexã\n\næ¯ä¸ª ææ¡£ï¼documentï¼ é½æ¯å­æ®µï¼fieldï¼çéåã\n\nDocument ä½¿ç¨ JSON æ ¼å¼è¡¨ç¤ºï¼ä¸é¢æ¯ä¸ä¸ªä¾å­ã\n\n{\n"user": "å¼ ä¸",\n"title": "å·¥ç¨å¸",\n"desc": "æ°æ®åºç®¡ç"\n}\n\n\nåä¸ä¸ª Index éé¢ç Documentï¼ä¸è¦æ±æç¸åçç»æï¼schemeï¼ï¼ä½æ¯æå¥½ä¿æç¸åï¼è¿æ ·æå©äºæé«æç´¢æçã\n\n# Field\n\nå­æ®µï¼fieldï¼ æ¯åå«æ°æ®çé®å¼å¯¹ã\n\né»è®¤æåµä¸ï¼Elasticsearch å¯¹æ¯ä¸ªå­æ®µä¸­çæææ°æ®å»ºç«ç´¢å¼ï¼å¹¶ä¸æ¯ä¸ªç´¢å¼å­æ®µé½å·æä¸ç¨çä¼åæ°æ®ç»æã\n\n# Shard\n\nå½åå°æºå¨ä¸è¶³ä»¥å­å¨å¤§éæ°æ®æ¶ï¼Elasticsearch å¯ä»¥å°ä¸ä¸ªç´¢å¼ä¸­çæ°æ®ååä¸ºå¤ä¸ª åçï¼shardï¼ ã åçï¼shardï¼ åå¸å¨å¤å°æå¡å¨ä¸å­å¨ãæäº shard å°±å¯ä»¥æ¨ªåæ©å±ï¼å­å¨æ´å¤æ°æ®ï¼è®©æç´¢ååæç­æä½åå¸å°å¤å°æå¡å¨ä¸å»æ§è¡ï¼æåååéåæ§è½ãæ¯ä¸ª shard é½æ¯ä¸ä¸ª lucene indexã\n\n# Replica\n\nä»»ä½ä¸ä¸ªæå¡å¨éæ¶å¯è½æéæå®æºï¼æ­¤æ¶ shard å¯è½å°±ä¼ä¸¢å¤±ï¼å æ­¤å¯ä»¥ä¸ºæ¯ä¸ª shard åå»ºå¤ä¸ª å¯æ¬ï¼replicaï¼ãreplica å¯ä»¥å¨ shard æéæ¶æä¾å¤ç¨æå¡ï¼ä¿è¯æ°æ®ä¸ä¸¢å¤±ï¼å¤ä¸ª replica è¿å¯ä»¥æåæç´¢æä½çååéåæ§è½ãprimary shardï¼å»ºç«ç´¢å¼æ¶ä¸æ¬¡è®¾ç½®ï¼ä¸è½ä¿®æ¹ï¼é»è®¤ 5 ä¸ªï¼ï¼replica shardï¼éæ¶ä¿®æ¹æ°éï¼é»è®¤ 1 ä¸ªï¼ï¼é»è®¤æ¯ä¸ªç´¢å¼ 10 ä¸ª shardï¼5 ä¸ª primary shardï¼5 ä¸ª replica shardï¼æå°çé«å¯ç¨éç½®ï¼æ¯ 2 å°æå¡å¨ã\n\n# ES æ ¸å¿æ¦å¿µ vs. DB æ ¸å¿æ¦å¿µ\n\nES         DB\nindex      æ°æ®åº\ntype       æ°æ®è¡¨\ndocuemnt   ä¸è¡æ°æ®\n\n\n# ElasticSearch åºæ¬åç\n\n\n# ES åæ°æ®è¿ç¨\n\n * å®¢æ·ç«¯éæ©ä¸ä¸ª node åéè¯·æ±è¿å»ï¼è¿ä¸ª node å°±æ¯ coordinating nodeï¼åè°èç¹ï¼ã\n * coordinating node å¯¹ document è¿è¡è·¯ç±ï¼å°è¯·æ±è½¬åç»å¯¹åºç nodeï¼æ primary shardï¼ã\n * å®éç node ä¸ç primary shard å¤çè¯·æ±ï¼ç¶åå°æ°æ®åæ­¥å° replica nodeã\n * coordinating node å¦æåç° primary node åææ replica node é½æå®ä¹åï¼å°±è¿åååºç»æç»å®¢æ·ç«¯ã\n\n\n\n\n# ES è¯»æ°æ®è¿ç¨\n\nå¯ä»¥éè¿ doc id æ¥æ¥è¯¢ï¼ä¼æ ¹æ® doc id è¿è¡ hashï¼å¤æ­åºæ¥å½æ¶æ doc id åéå°äºåªä¸ª shard ä¸é¢å»ï¼ä»é£ä¸ª shard å»æ¥è¯¢ã\n\n * å®¢æ·ç«¯åéè¯·æ±å°ä»»æä¸ä¸ª nodeï¼æä¸º coordinate nodeã\n * coordinate node å¯¹ doc id è¿è¡åå¸è·¯ç±ï¼å°è¯·æ±è½¬åå°å¯¹åºç nodeï¼æ­¤æ¶ä¼ä½¿ç¨ round-robin è½®è¯¢ç®æ³ï¼å¨ primary shard ä»¥åå¶ææ replica ä¸­éæºéæ©ä¸ä¸ªï¼è®©è¯»è¯·æ±è´è½½åè¡¡ã\n * æ¥æ¶è¯·æ±ç node è¿å document ç» coordinate nodeã\n * coordinate node è¿å document ç»å®¢æ·ç«¯ã\n\n\n# es æç´¢æ°æ®è¿ç¨\n\nes æå¼ºå¤§çæ¯åå¨ææ£ç´¢ï¼å°±æ¯æ¯å¦ä½ æä¸æ¡æ°æ®ï¼\n\njavaçå¥½ç©å¿å\njavaå¥½é¾å­¦å\nj2eeç¹å«ç\n\n\nä½ æ ¹æ® java å³é®è¯æ¥æç´¢ï¼å°åå« java ç document ç»æç´¢åºæ¥ães å°±ä¼ç»ä½ è¿åï¼java çå¥½ç©å¿åï¼java å¥½é¾å­¦åã\n\n * å®¢æ·ç«¯åéè¯·æ±å°ä¸ä¸ª coordinate node ã\n * åè°èç¹å°æç´¢è¯·æ±è½¬åå°ææç shard å¯¹åºç primary shard æ replica shard ï¼é½å¯ä»¥ã\n * query phaseï¼æ¯ä¸ª shard å°èªå·±çæç´¢ç»æï¼å¶å®å°±æ¯ä¸äº doc id ï¼è¿åç»åè°èç¹ï¼ç±åè°èç¹è¿è¡æ°æ®çåå¹¶ãæåºãåé¡µç­æä½ï¼äº§åºæç»ç»æã\n * fetch phaseï¼æ¥çç±åè°èç¹æ ¹æ® doc id å»åä¸ªèç¹ä¸æåå®éç document æ°æ®ï¼æç»è¿åç»å®¢æ·ç«¯ã\n\n> åè¯·æ±æ¯åå¥ primary shardï¼ç¶ååæ­¥ç»ææç replica shardï¼è¯»è¯·æ±å¯ä»¥ä» primary shard æ replica shard è¯»åï¼éç¨çæ¯éæºè½®è¯¢ç®æ³ã\n\n\n# åæ°æ®åºå±åç\n\n\n\nååå¥åå­ bufferï¼å¨ buffer éçæ¶åæ°æ®æ¯æç´¢ä¸å°çï¼åæ¶å°æ°æ®åå¥ translog æ¥å¿æä»¶ã\n\nå¦æ buffer å¿«æ»¡äºï¼æèå°ä¸å®æ¶é´ï¼å°±ä¼å°åå­ buffer æ°æ® refresh å°ä¸ä¸ªæ°ç segment file ä¸­ï¼ä½æ¯æ­¤æ¶æ°æ®ä¸æ¯ç´æ¥è¿å¥ segment file ç£çæä»¶ï¼èæ¯åè¿å¥ os cache ãè¿ä¸ªè¿ç¨å°±æ¯ refreshã\n\næ¯é 1 ç§éï¼es å° buffer ä¸­çæ°æ®åå¥ä¸ä¸ªæ°ç segment fileï¼æ¯ç§éä¼äº§çä¸ä¸ªæ°çç£çæä»¶ segment fileï¼è¿ä¸ª segment file ä¸­å°±å­å¨æè¿ 1 ç§å buffer ä¸­åå¥çæ°æ®ã\n\nä½æ¯å¦æ buffer éé¢æ­¤æ¶æ²¡ææ°æ®ï¼é£å½ç¶ä¸ä¼æ§è¡ refresh æä½ï¼å¦æ buffer éé¢ææ°æ®ï¼é»è®¤ 1 ç§éæ§è¡ä¸æ¬¡ refresh æä½ï¼å·å¥ä¸ä¸ªæ°ç segment file ä¸­ã\n\næä½ç³»ç»éé¢ï¼ç£çæä»¶å¶å®é½æä¸ä¸ªä¸è¥¿ï¼å«å os cacheï¼å³æä½ç³»ç»ç¼å­ï¼å°±æ¯è¯´æ°æ®åå¥ç£çæä»¶ä¹åï¼ä¼åè¿å¥ os cacheï¼åè¿å¥æä½ç³»ç»çº§å«çä¸ä¸ªåå­ç¼å­ä¸­å»ãåªè¦ buffer ä¸­çæ°æ®è¢« refresh æä½å·å¥ os cacheä¸­ï¼è¿ä¸ªæ°æ®å°±å¯ä»¥è¢«æç´¢å°äºã\n\nä¸ºä»ä¹å« es æ¯åå®æ¶çï¼ NRTï¼å¨ç§° near real-timeãé»è®¤æ¯æ¯é 1 ç§ refresh ä¸æ¬¡çï¼æä»¥ es æ¯åå®æ¶çï¼å ä¸ºåå¥çæ°æ® 1 ç§ä¹åæè½è¢«çå°ãå¯ä»¥éè¿ es ç restful api æè java apiï¼æå¨æ§è¡ä¸æ¬¡ refresh æä½ï¼å°±æ¯æå¨å° buffer ä¸­çæ°æ®å·å¥ os cacheä¸­ï¼è®©æ°æ®ç«é©¬å°±å¯ä»¥è¢«æç´¢å°ãåªè¦æ°æ®è¢«è¾å¥ os cache ä¸­ï¼buffer å°±ä¼è¢«æ¸ç©ºäºï¼å ä¸ºä¸éè¦ä¿ç buffer äºï¼æ°æ®å¨ translog éé¢å·²ç»æä¹åå°ç£çå»ä¸ä»½äºã\n\néå¤ä¸é¢çæ­¥éª¤ï¼æ°çæ°æ®ä¸æ­è¿å¥ buffer å translogï¼ä¸æ­å° buffer æ°æ®åå¥ä¸ä¸ªåä¸ä¸ªæ°ç segment file ä¸­å»ï¼æ¯æ¬¡ refresh å® buffer æ¸ç©ºï¼translog ä¿çãéçè¿ä¸ªè¿ç¨æ¨è¿ï¼translog ä¼åå¾è¶æ¥è¶å¤§ãå½ translog è¾¾å°ä¸å®é¿åº¦çæ¶åï¼å°±ä¼è§¦å commit æä½ã\n\ncommit æä½åçç¬¬ä¸æ­¥ï¼å°±æ¯å° buffer ä¸­ç°ææ°æ® refresh å° os cache ä¸­å»ï¼æ¸ç©º bufferãç¶åï¼å°ä¸ä¸ª commit point åå¥ç£çæä»¶ï¼éé¢æ è¯çè¿ä¸ª commit point å¯¹åºçææ segment fileï¼åæ¶å¼ºè¡å° os cache ä¸­ç®åææçæ°æ®é½ fsync å°ç£çæä»¶ä¸­å»ãæåæ¸ç©º ç°æ translog æ¥å¿æä»¶ï¼éå¯ä¸ä¸ª translogï¼æ­¤æ¶ commit æä½å®æã\n\nè¿ä¸ª commit æä½å«å flushãé»è®¤ 30 åéèªå¨æ§è¡ä¸æ¬¡ flushï¼ä½å¦æ translog è¿å¤§ï¼ä¹ä¼è§¦å flushãflush æä½å°±å¯¹åºç commit çå¨è¿ç¨ï¼æä»¬å¯ä»¥éè¿ es apiï¼æå¨æ§è¡ flush æä½ï¼æå¨å° os cache ä¸­çæ°æ® fsync å¼ºå·å°ç£çä¸å»ã\n\ntranslog æ¥å¿æä»¶çä½ç¨æ¯ä»ä¹ï¼ä½ æ§è¡ commit æä½ä¹åï¼æ°æ®è¦ä¹æ¯åçå¨ buffer ä¸­ï¼è¦ä¹æ¯åçå¨ os cache ä¸­ï¼æ è®ºæ¯ buffer è¿æ¯ os cache é½æ¯åå­ï¼ä¸æ¦è¿å°æºå¨æ­»äºï¼åå­ä¸­çæ°æ®å°±å¨ä¸¢äºãæä»¥éè¦å°æ°æ®å¯¹åºçæä½åå¥ä¸ä¸ªä¸é¨çæ¥å¿æä»¶ translog ä¸­ï¼ä¸æ¦æ­¤æ¶æºå¨å®æºï¼åæ¬¡éå¯çæ¶åï¼es ä¼èªå¨è¯»å translog æ¥å¿æä»¶ä¸­çæ°æ®ï¼æ¢å¤å°åå­ buffer å os cache ä¸­å»ã\n\ntranslog å¶å®ä¹æ¯ååå¥ os cache çï¼é»è®¤æ¯é 5 ç§å·ä¸æ¬¡å°ç£çä¸­å»ï¼æä»¥é»è®¤æåµä¸ï¼å¯è½æ 5 ç§çæ°æ®ä¼ä»ä»åçå¨ buffer æè translog æä»¶ç os cache ä¸­ï¼å¦ææ­¤æ¶æºå¨æäºï¼ä¼ä¸¢å¤± 5 ç§éçæ°æ®ãä½æ¯è¿æ ·æ§è½æ¯è¾å¥½ï¼æå¤ä¸¢ 5 ç§çæ°æ®ãä¹å¯ä»¥å° translog è®¾ç½®ææ¯æ¬¡åæä½å¿é¡»æ¯ç´æ¥ fsync å°ç£çï¼ä½æ¯æ§è½ä¼å·®å¾å¤ã\n\nå®éä¸ä½ å¨è¿éï¼å¦æé¢è¯å®æ²¡æé®ä½  es ä¸¢æ°æ®çé®é¢ï¼ä½ å¯ä»¥å¨è¿éç»é¢è¯å®ç«ä¸æï¼ä½ è¯´ï¼å¶å® es ç¬¬ä¸æ¯åå®æ¶çï¼æ°æ®åå¥ 1 ç§åå¯ä»¥æç´¢å°ï¼å¯è½ä¼ä¸¢å¤±æ°æ®çãæ 5 ç§çæ°æ®ï¼åçå¨ bufferãtranslog os cacheãsegment file os cache ä¸­ï¼èä¸å¨ç£çä¸ï¼æ­¤æ¶å¦æå®æºï¼ä¼å¯¼è´ 5 ç§çæ°æ®ä¸¢å¤±ã\n\næ»ç»ä¸ä¸ï¼æ°æ®ååå¥åå­ bufferï¼ç¶åæ¯é 1sï¼å°æ°æ® refresh å° os cacheï¼å°äº os cache æ°æ®å°±è½è¢«æç´¢å°ï¼æä»¥æä»¬æè¯´ es ä»åå¥å°è½è¢«æç´¢å°ï¼ä¸­é´æ 1s çå»¶è¿ï¼ãæ¯é 5sï¼å°æ°æ®åå¥ translog æä»¶ï¼è¿æ ·å¦ææºå¨å®æºï¼åå­æ°æ®å¨æ²¡ï¼æå¤ä¼æ 5s çæ°æ®ä¸¢å¤±ï¼ï¼translog å¤§å°ä¸å®ç¨åº¦ï¼æèé»è®¤æ¯é 30minsï¼ä¼è§¦å commit æä½ï¼å°ç¼å²åºçæ°æ®é½ flush å° segment file ç£çæä»¶ä¸­ã\n\n> æ°æ®åå¥ segment file ä¹åï¼åæ¶å°±å»ºç«å¥½äºåæç´¢å¼ã\n\n\n# å é¤/æ´æ°æ°æ®åºå±åç\n\nå¦ææ¯å é¤æä½ï¼commit çæ¶åä¼çæä¸ä¸ª .del æä»¶ï¼éé¢å°æä¸ª doc æ è¯ä¸º deleted ç¶æï¼é£ä¹æç´¢çæ¶åæ ¹æ® .del æä»¶å°±ç¥éè¿ä¸ª doc æ¯å¦è¢«å é¤äºã\n\nå¦ææ¯æ´æ°æä½ï¼å°±æ¯å°åæ¥ç doc æ è¯ä¸º deleted ç¶æï¼ç¶åæ°åå¥ä¸æ¡æ°æ®ã\n\nbuffer æ¯ refresh ä¸æ¬¡ï¼å°±ä¼äº§çä¸ä¸ª segment fileï¼æä»¥é»è®¤æåµä¸æ¯ 1 ç§éä¸ä¸ª segment fileï¼è¿æ ·ä¸æ¥ segment file ä¼è¶æ¥è¶å¤ï¼æ­¤æ¶ä¼å®ææ§è¡ mergeãæ¯æ¬¡ merge çæ¶åï¼ä¼å°å¤ä¸ª segment file åå¹¶æä¸ä¸ªï¼åæ¶è¿éä¼å°æ è¯ä¸º deleted ç doc ç»ç©çå é¤æï¼ç¶åå°æ°ç segment file åå¥ç£çï¼è¿éä¼åä¸ä¸ª commit pointï¼æ è¯æææ°ç segment fileï¼ç¶åæå¼ segment file ä¾æç´¢ä½¿ç¨ï¼åæ¶å é¤æ§ç segment fileã\n\n\n# åºå± lucene\n\nç®åæ¥è¯´ï¼lucene å°±æ¯ä¸ä¸ª jar åï¼éé¢åå«äºå°è£å¥½çåç§å»ºç«åæç´¢å¼çç®æ³ä»£ç ãæä»¬ç¨ Java å¼åçæ¶åï¼å¼å¥ lucene jarï¼ç¶ååºäº lucene ç api å»å¼åå°±å¯ä»¥äºã\n\néè¿ luceneï¼æä»¬å¯ä»¥å°å·²æçæ°æ®å»ºç«ç´¢å¼ï¼lucene ä¼å¨æ¬å°ç£çä¸é¢ï¼ç»æä»¬ç»ç»ç´¢å¼çæ°æ®ç»æã\n\n\n# åæç´¢å¼\n\nå¨æç´¢å¼æä¸­ï¼æ¯ä¸ªææ¡£é½æä¸ä¸ªå¯¹åºçææ¡£ IDï¼ææ¡£åå®¹è¢«è¡¨ç¤ºä¸ºä¸ç³»åå³é®è¯çéåãä¾å¦ï¼ææ¡£ 1 ç»è¿åè¯ï¼æåäº 20 ä¸ªå³é®è¯ï¼æ¯ä¸ªå³é®è¯é½ä¼è®°å½å®å¨ææ¡£ä¸­åºç°çæ¬¡æ°ååºç°ä½ç½®ã\n\né£ä¹ï¼åæç´¢å¼å°±æ¯å³é®è¯å°ææ¡£ ID çæ å°ï¼æ¯ä¸ªå³é®è¯é½å¯¹åºçä¸ç³»åçæä»¶ï¼è¿äºæä»¶ä¸­é½åºç°äºå³é®è¯ã\n\nä¸¾ä¸ªæ å­ã\n\næä»¥ä¸ææ¡£ï¼\n\nDOCID   DOC\n1       è°·æ­å°å¾ä¹ç¶è·³æ§½ Facebook\n2       è°·æ­å°å¾ä¹ç¶å ç Facebook\n3       è°·æ­å°å¾åå§äººææ¯ç¦»å¼è°·æ­å ç Facebook\n4       è°·æ­å°å¾ä¹ç¶è·³æ§½ Facebook ä¸ Wave é¡¹ç®åæ¶æå³\n5       è°·æ­å°å¾ä¹ç¶ææ¯å çç¤¾äº¤ç½ç« Facebook\n\nå¯¹ææ¡£è¿è¡åè¯ä¹åï¼å¾å°ä»¥ä¸åæç´¢å¼ã\n\nWORDID   WORD       DOCIDS\n1        è°·æ­         1,2,3,4,5\n2        å°å¾         1,2,3,4,5\n3        ä¹ç¶         1,2,4,5\n4        è·³æ§½         1,4\n5        Facebook   1,2,3,4,5\n6        å ç         2,3,5\n7        åå§äºº        3\n8        ææ¯         3,5\n9        ç¦»å¼         3\n10       ä¸          4\n..       ..         ..\n\nå¦å¤ï¼å®ç¨çåæç´¢å¼è¿å¯ä»¥è®°å½æ´å¤çä¿¡æ¯ï¼æ¯å¦ææ¡£é¢çä¿¡æ¯ï¼è¡¨ç¤ºå¨ææ¡£éåä¸­æå¤å°ä¸ªææ¡£åå«æä¸ªåè¯ã\n\né£ä¹ï¼æäºåæç´¢å¼ï¼æç´¢å¼æå¯ä»¥å¾æ¹ä¾¿å°ååºç¨æ·çæ¥è¯¢ãæ¯å¦ç¨æ·è¾å¥æ¥è¯¢ Facebookï¼æç´¢ç³»ç»æ¥æ¾åæç´¢å¼ï¼ä»ä¸­è¯»åºåå«è¿ä¸ªåè¯çææ¡£ï¼è¿äºææ¡£å°±æ¯æä¾ç»ç¨æ·çæç´¢ç»æã\n\nè¦æ³¨æåæç´¢å¼çä¸¤ä¸ªéè¦ç»èï¼\n\n * åæç´¢å¼ä¸­çææè¯é¡¹å¯¹åºä¸ä¸ªæå¤ä¸ªææ¡£ï¼\n * åæç´¢å¼ä¸­çè¯é¡¹æ ¹æ®å­å¸é¡ºåºååºæå\n\n> ä¸é¢åªæ¯ä¸ä¸ªç®åçæ å­ï¼å¹¶æ²¡æä¸¥æ ¼æç§å­å¸é¡ºåºååºæåã\n\n\n# åèèµæ\n\n * å®æ¹\n   * Elasticsearch å®ç½\n   * Elasticsearch Github\n   * Elasticsearch å®æ¹ææ¡£\n * æç« \n   * Install Elasticsearch with RPM\n   * https://www.ruanyifeng.com/blog/2017/08/elasticsearch.html\n   * es-introduction\n   * es-write-query-search',normalizedContent:'# elasticsearch å¿«éå¥é¨\n\n> elasticsearch æ¯ä¸ä¸ªåå¸å¼ãrestful é£æ ¼çæç´¢åæ°æ®åæå¼æï¼è½å¤è§£å³ä¸æ­æ¶ç°åºçåç§ç¨ä¾ã ä½ä¸º elastic stack çæ ¸å¿ï¼å®éä¸­å­å¨æ¨çæ°æ®ï¼å¸®å©æ¨åç°ææä¹ä¸­ä»¥åææä¹å¤çæåµã\n> \n> elasticsearch åºäºæç´¢åº lucene å¼åãelasticsearch éèäº lucene çå¤ææ§ï¼æä¾äºç®åæç¨ç rest api / java api æ¥å£ï¼å¦å¤è¿æå¶ä»è¯­è¨ç api æ¥å£ï¼ã\n> \n> ä»¥ä¸ç®ç§° esã\n\n\n# elasticsearch ç®ä»\n\n\n# ä»ä¹æ¯ elasticsearch\n\nelasticsearch æ¯ä¸ä¸ªåå¸å¼ãrestful é£æ ¼çæç´¢åæ°æ®åæå¼æï¼è½å¤è§£å³ä¸æ­æ¶ç°åºçåç§ç¨ä¾ã ä½ä¸º elastic stack çæ ¸å¿ï¼å®éä¸­å­å¨æ¨çæ°æ®ï¼å¸®å©æ¨åç°ææä¹ä¸­ä»¥åææä¹å¤çæåµã\n\nelasticsearch åºäºæç´¢åº lucene å¼åãelasticsearch éèäº lucene çå¤ææ§ï¼æä¾äºç®åæç¨ç rest api / java api æ¥å£ï¼å¦å¤è¿æå¶ä»è¯­è¨ç api æ¥å£ï¼ã\n\nelasticsearch å¯ä»¥è§ä¸ºä¸ä¸ªææ¡£å­å¨ï¼å®å°å¤ææ°æ®ç»æåºååä¸º json å­å¨ã\n\nelasticsearch æ¯è¿ä¹äºå®æ¶çå¨ææç´ ï¼è¿æ¯æï¼\n\n * ä»åå¥æ°æ®å°æ°æ®å¯ä»¥è¢«æç´¢ï¼å­å¨è¾å°çå»¶è¿ï¼å¤§æ¦æ¯ 1sï¼\n * åºäº es æ§è¡æç´¢ååæå¯ä»¥è¾¾å°ç§çº§\n\n\n# æ ¸å¿æ¦å¿µ\n\nindex -> type -> mapping -> document -> field\n\n\n# cluster\n\néç¾¤åå«å¤ä¸ªèç¹ï¼æ¯ä¸ªèç¹å±äºåªä¸ªéç¾¤é½æ¯éè¿ä¸ä¸ªéç½®æ¥å³å®çï¼å¯¹äºä¸­å°ååºç¨æ¥è¯´ï¼åå¼å§ä¸ä¸ªéç¾¤å°±ä¸ä¸ªèç¹å¾æ­£å¸¸ã\n\n# node\n\nnode æ¯éç¾¤ä¸­çä¸ä¸ªèç¹ï¼èç¹ä¹æä¸ä¸ªåç§°ï¼é»è®¤æ¯éæºåéçãé»è®¤èç¹ä¼å»å å¥ä¸ä¸ªåç§°ä¸º elasticsearch çéç¾¤ãå¦æç´æ¥å¯å¨ä¸å èç¹ï¼é£ä¹å®ä»¬ä¼èªå¨ç»æä¸ä¸ª elasticsearch éç¾¤ï¼å½ç¶ä¸ä¸ªèç¹ä¹å¯ä»¥ç»æ elasticsearch éç¾¤ã\n\n# index\n\nå¯ä»¥è®¤ä¸ºæ¯ææ¡£ï¼documentï¼çä¼åéåã\n\nes ä¼ä¸ºææå­æ®µå»ºç«ç´¢å¼ï¼ç»è¿å¤çååå¥ä¸ä¸ªååç´¢å¼ï¼inverted indexï¼ãæ¥æ¾æ°æ®çæ¶åï¼ç´æ¥æ¥æ¾è¯¥ç´¢å¼ã\n\næä»¥ï¼es æ°æ®ç®¡ççé¡¶å±åä½å°±å«å indexï¼ç´¢å¼ï¼ãå®æ¯åä¸ªæ°æ®åºçåä¹è¯ãæ¯ä¸ª index ï¼å³æ°æ®åºï¼çåå­å¿é¡»æ¯å°åã\n\n# type\n\næ¯ä¸ªç´¢å¼éå¯ä»¥æä¸ä¸ªæèå¤ä¸ªç±»åï¼typeï¼ãç±»åï¼typeï¼ æ¯ index çä¸ä¸ªé»è¾åç±»ã\n\nä¸åç type åºè¯¥æç¸ä¼¼çç»æï¼schemaï¼ï¼ä¸¾ä¾æ¥è¯´ï¼idå­æ®µä¸è½å¨è¿ä¸ªç»æ¯å­ç¬¦ä¸²ï¼å¨å¦ä¸ä¸ªç»æ¯æ°å¼ãè¿æ¯ä¸å³ç³»åæ°æ®åºçè¡¨çä¸ä¸ªåºå«ãæ§è´¨å®å¨ä¸åçæ°æ®ï¼æ¯å¦productsålogsï¼åºè¯¥å­æä¸¤ä¸ª indexï¼èä¸æ¯ä¸ä¸ª index éé¢çä¸¤ä¸ª typeï¼è½ç¶å¯ä»¥åå°ï¼ã\n\n> æ³¨æï¼æ ¹æ®è§åï¼elastic 6.x çåªåè®¸æ¯ä¸ª index åå«ä¸ä¸ª typeï¼7.x çå°ä¼å½»åºç§»é¤ typeã\n\n# document\n\nindex éé¢åæ¡çè®°å½ç§°ä¸º documentï¼ææ¡£ï¼ãè®¸å¤æ¡ document ææäºä¸ä¸ª indexã\n\næ¯ä¸ª ææ¡£ï¼documentï¼ é½æ¯å­æ®µï¼fieldï¼çéåã\n\ndocument ä½¿ç¨ json æ ¼å¼è¡¨ç¤ºï¼ä¸é¢æ¯ä¸ä¸ªä¾å­ã\n\n{\n"user": "å¼ ä¸",\n"title": "å·¥ç¨å¸",\n"desc": "æ°æ®åºç®¡ç"\n}\n\n\nåä¸ä¸ª index éé¢ç documentï¼ä¸è¦æ±æç¸åçç»æï¼schemeï¼ï¼ä½æ¯æå¥½ä¿æç¸åï¼è¿æ ·æå©äºæé«æç´¢æçã\n\n# field\n\nå­æ®µï¼fieldï¼ æ¯åå«æ°æ®çé®å¼å¯¹ã\n\né»è®¤æåµä¸ï¼elasticsearch å¯¹æ¯ä¸ªå­æ®µä¸­çæææ°æ®å»ºç«ç´¢å¼ï¼å¹¶ä¸æ¯ä¸ªç´¢å¼å­æ®µé½å·æä¸ç¨çä¼åæ°æ®ç»æã\n\n# shard\n\nå½åå°æºå¨ä¸è¶³ä»¥å­å¨å¤§éæ°æ®æ¶ï¼elasticsearch å¯ä»¥å°ä¸ä¸ªç´¢å¼ä¸­çæ°æ®ååä¸ºå¤ä¸ª åçï¼shardï¼ ã åçï¼shardï¼ åå¸å¨å¤å°æå¡å¨ä¸å­å¨ãæäº shard å°±å¯ä»¥æ¨ªåæ©å±ï¼å­å¨æ´å¤æ°æ®ï¼è®©æç´¢ååæç­æä½åå¸å°å¤å°æå¡å¨ä¸å»æ§è¡ï¼æåååéåæ§è½ãæ¯ä¸ª shard é½æ¯ä¸ä¸ª lucene indexã\n\n# replica\n\nä»»ä½ä¸ä¸ªæå¡å¨éæ¶å¯è½æéæå®æºï¼æ­¤æ¶ shard å¯è½å°±ä¼ä¸¢å¤±ï¼å æ­¤å¯ä»¥ä¸ºæ¯ä¸ª shard åå»ºå¤ä¸ª å¯æ¬ï¼replicaï¼ãreplica å¯ä»¥å¨ shard æéæ¶æä¾å¤ç¨æå¡ï¼ä¿è¯æ°æ®ä¸ä¸¢å¤±ï¼å¤ä¸ª replica è¿å¯ä»¥æåæç´¢æä½çååéåæ§è½ãprimary shardï¼å»ºç«ç´¢å¼æ¶ä¸æ¬¡è®¾ç½®ï¼ä¸è½ä¿®æ¹ï¼é»è®¤ 5 ä¸ªï¼ï¼replica shardï¼éæ¶ä¿®æ¹æ°éï¼é»è®¤ 1 ä¸ªï¼ï¼é»è®¤æ¯ä¸ªç´¢å¼ 10 ä¸ª shardï¼5 ä¸ª primary shardï¼5 ä¸ª replica shardï¼æå°çé«å¯ç¨éç½®ï¼æ¯ 2 å°æå¡å¨ã\n\n# es æ ¸å¿æ¦å¿µ vs. db æ ¸å¿æ¦å¿µ\n\nes         db\nindex      æ°æ®åº\ntype       æ°æ®è¡¨\ndocuemnt   ä¸è¡æ°æ®\n\n\n# elasticsearch åºæ¬åç\n\n\n# es åæ°æ®è¿ç¨\n\n * å®¢æ·ç«¯éæ©ä¸ä¸ª node åéè¯·æ±è¿å»ï¼è¿ä¸ª node å°±æ¯ coordinating nodeï¼åè°èç¹ï¼ã\n * coordinating node å¯¹ document è¿è¡è·¯ç±ï¼å°è¯·æ±è½¬åç»å¯¹åºç nodeï¼æ primary shardï¼ã\n * å®éç node ä¸ç primary shard å¤çè¯·æ±ï¼ç¶åå°æ°æ®åæ­¥å° replica nodeã\n * coordinating node å¦æåç° primary node åææ replica node é½æå®ä¹åï¼å°±è¿åååºç»æç»å®¢æ·ç«¯ã\n\n\n\n\n# es è¯»æ°æ®è¿ç¨\n\nå¯ä»¥éè¿ doc id æ¥æ¥è¯¢ï¼ä¼æ ¹æ® doc id è¿è¡ hashï¼å¤æ­åºæ¥å½æ¶æ doc id åéå°äºåªä¸ª shard ä¸é¢å»ï¼ä»é£ä¸ª shard å»æ¥è¯¢ã\n\n * å®¢æ·ç«¯åéè¯·æ±å°ä»»æä¸ä¸ª nodeï¼æä¸º coordinate nodeã\n * coordinate node å¯¹ doc id è¿è¡åå¸è·¯ç±ï¼å°è¯·æ±è½¬åå°å¯¹åºç nodeï¼æ­¤æ¶ä¼ä½¿ç¨ round-robin è½®è¯¢ç®æ³ï¼å¨ primary shard ä»¥åå¶ææ replica ä¸­éæºéæ©ä¸ä¸ªï¼è®©è¯»è¯·æ±è´è½½åè¡¡ã\n * æ¥æ¶è¯·æ±ç node è¿å document ç» coordinate nodeã\n * coordinate node è¿å document ç»å®¢æ·ç«¯ã\n\n\n# es æç´¢æ°æ®è¿ç¨\n\nes æå¼ºå¤§çæ¯åå¨ææ£ç´¢ï¼å°±æ¯æ¯å¦ä½ æä¸æ¡æ°æ®ï¼\n\njavaçå¥½ç©å¿å\njavaå¥½é¾å­¦å\nj2eeç¹å«ç\n\n\nä½ æ ¹æ® java å³é®è¯æ¥æç´¢ï¼å°åå« java ç document ç»æç´¢åºæ¥ães å°±ä¼ç»ä½ è¿åï¼java çå¥½ç©å¿åï¼java å¥½é¾å­¦åã\n\n * å®¢æ·ç«¯åéè¯·æ±å°ä¸ä¸ª coordinate node ã\n * åè°èç¹å°æç´¢è¯·æ±è½¬åå°ææç shard å¯¹åºç primary shard æ replica shard ï¼é½å¯ä»¥ã\n * query phaseï¼æ¯ä¸ª shard å°èªå·±çæç´¢ç»æï¼å¶å®å°±æ¯ä¸äº doc id ï¼è¿åç»åè°èç¹ï¼ç±åè°èç¹è¿è¡æ°æ®çåå¹¶ãæåºãåé¡µç­æä½ï¼äº§åºæç»ç»æã\n * fetch phaseï¼æ¥çç±åè°èç¹æ ¹æ® doc id å»åä¸ªèç¹ä¸æåå®éç document æ°æ®ï¼æç»è¿åç»å®¢æ·ç«¯ã\n\n> åè¯·æ±æ¯åå¥ primary shardï¼ç¶ååæ­¥ç»ææç replica shardï¼è¯»è¯·æ±å¯ä»¥ä» primary shard æ replica shard è¯»åï¼éç¨çæ¯éæºè½®è¯¢ç®æ³ã\n\n\n# åæ°æ®åºå±åç\n\n\n\nååå¥åå­ bufferï¼å¨ buffer éçæ¶åæ°æ®æ¯æç´¢ä¸å°çï¼åæ¶å°æ°æ®åå¥ translog æ¥å¿æä»¶ã\n\nå¦æ buffer å¿«æ»¡äºï¼æèå°ä¸å®æ¶é´ï¼å°±ä¼å°åå­ buffer æ°æ® refresh å°ä¸ä¸ªæ°ç segment file ä¸­ï¼ä½æ¯æ­¤æ¶æ°æ®ä¸æ¯ç´æ¥è¿å¥ segment file ç£çæä»¶ï¼èæ¯åè¿å¥ os cache ãè¿ä¸ªè¿ç¨å°±æ¯ refreshã\n\næ¯é 1 ç§éï¼es å° buffer ä¸­çæ°æ®åå¥ä¸ä¸ªæ°ç segment fileï¼æ¯ç§éä¼äº§çä¸ä¸ªæ°çç£çæä»¶ segment fileï¼è¿ä¸ª segment file ä¸­å°±å­å¨æè¿ 1 ç§å buffer ä¸­åå¥çæ°æ®ã\n\nä½æ¯å¦æ buffer éé¢æ­¤æ¶æ²¡ææ°æ®ï¼é£å½ç¶ä¸ä¼æ§è¡ refresh æä½ï¼å¦æ buffer éé¢ææ°æ®ï¼é»è®¤ 1 ç§éæ§è¡ä¸æ¬¡ refresh æä½ï¼å·å¥ä¸ä¸ªæ°ç segment file ä¸­ã\n\næä½ç³»ç»éé¢ï¼ç£çæä»¶å¶å®é½æä¸ä¸ªä¸è¥¿ï¼å«å os cacheï¼å³æä½ç³»ç»ç¼å­ï¼å°±æ¯è¯´æ°æ®åå¥ç£çæä»¶ä¹åï¼ä¼åè¿å¥ os cacheï¼åè¿å¥æä½ç³»ç»çº§å«çä¸ä¸ªåå­ç¼å­ä¸­å»ãåªè¦ buffer ä¸­çæ°æ®è¢« refresh æä½å·å¥ os cacheä¸­ï¼è¿ä¸ªæ°æ®å°±å¯ä»¥è¢«æç´¢å°äºã\n\nä¸ºä»ä¹å« es æ¯åå®æ¶çï¼ nrtï¼å¨ç§° near real-timeãé»è®¤æ¯æ¯é 1 ç§ refresh ä¸æ¬¡çï¼æä»¥ es æ¯åå®æ¶çï¼å ä¸ºåå¥çæ°æ® 1 ç§ä¹åæè½è¢«çå°ãå¯ä»¥éè¿ es ç restful api æè java apiï¼æå¨æ§è¡ä¸æ¬¡ refresh æä½ï¼å°±æ¯æå¨å° buffer ä¸­çæ°æ®å·å¥ os cacheä¸­ï¼è®©æ°æ®ç«é©¬å°±å¯ä»¥è¢«æç´¢å°ãåªè¦æ°æ®è¢«è¾å¥ os cache ä¸­ï¼buffer å°±ä¼è¢«æ¸ç©ºäºï¼å ä¸ºä¸éè¦ä¿ç buffer äºï¼æ°æ®å¨ translog éé¢å·²ç»æä¹åå°ç£çå»ä¸ä»½äºã\n\néå¤ä¸é¢çæ­¥éª¤ï¼æ°çæ°æ®ä¸æ­è¿å¥ buffer å translogï¼ä¸æ­å° buffer æ°æ®åå¥ä¸ä¸ªåä¸ä¸ªæ°ç segment file ä¸­å»ï¼æ¯æ¬¡ refresh å® buffer æ¸ç©ºï¼translog ä¿çãéçè¿ä¸ªè¿ç¨æ¨è¿ï¼translog ä¼åå¾è¶æ¥è¶å¤§ãå½ translog è¾¾å°ä¸å®é¿åº¦çæ¶åï¼å°±ä¼è§¦å commit æä½ã\n\ncommit æä½åçç¬¬ä¸æ­¥ï¼å°±æ¯å° buffer ä¸­ç°ææ°æ® refresh å° os cache ä¸­å»ï¼æ¸ç©º bufferãç¶åï¼å°ä¸ä¸ª commit point åå¥ç£çæä»¶ï¼éé¢æ è¯çè¿ä¸ª commit point å¯¹åºçææ segment fileï¼åæ¶å¼ºè¡å° os cache ä¸­ç®åææçæ°æ®é½ fsync å°ç£çæä»¶ä¸­å»ãæåæ¸ç©º ç°æ translog æ¥å¿æä»¶ï¼éå¯ä¸ä¸ª translogï¼æ­¤æ¶ commit æä½å®æã\n\nè¿ä¸ª commit æä½å«å flushãé»è®¤ 30 åéèªå¨æ§è¡ä¸æ¬¡ flushï¼ä½å¦æ translog è¿å¤§ï¼ä¹ä¼è§¦å flushãflush æä½å°±å¯¹åºç commit çå¨è¿ç¨ï¼æä»¬å¯ä»¥éè¿ es apiï¼æå¨æ§è¡ flush æä½ï¼æå¨å° os cache ä¸­çæ°æ® fsync å¼ºå·å°ç£çä¸å»ã\n\ntranslog æ¥å¿æä»¶çä½ç¨æ¯ä»ä¹ï¼ä½ æ§è¡ commit æä½ä¹åï¼æ°æ®è¦ä¹æ¯åçå¨ buffer ä¸­ï¼è¦ä¹æ¯åçå¨ os cache ä¸­ï¼æ è®ºæ¯ buffer è¿æ¯ os cache é½æ¯åå­ï¼ä¸æ¦è¿å°æºå¨æ­»äºï¼åå­ä¸­çæ°æ®å°±å¨ä¸¢äºãæä»¥éè¦å°æ°æ®å¯¹åºçæä½åå¥ä¸ä¸ªä¸é¨çæ¥å¿æä»¶ translog ä¸­ï¼ä¸æ¦æ­¤æ¶æºå¨å®æºï¼åæ¬¡éå¯çæ¶åï¼es ä¼èªå¨è¯»å translog æ¥å¿æä»¶ä¸­çæ°æ®ï¼æ¢å¤å°åå­ buffer å os cache ä¸­å»ã\n\ntranslog å¶å®ä¹æ¯ååå¥ os cache çï¼é»è®¤æ¯é 5 ç§å·ä¸æ¬¡å°ç£çä¸­å»ï¼æä»¥é»è®¤æåµä¸ï¼å¯è½æ 5 ç§çæ°æ®ä¼ä»ä»åçå¨ buffer æè translog æä»¶ç os cache ä¸­ï¼å¦ææ­¤æ¶æºå¨æäºï¼ä¼ä¸¢å¤± 5 ç§éçæ°æ®ãä½æ¯è¿æ ·æ§è½æ¯è¾å¥½ï¼æå¤ä¸¢ 5 ç§çæ°æ®ãä¹å¯ä»¥å° translog è®¾ç½®ææ¯æ¬¡åæä½å¿é¡»æ¯ç´æ¥ fsync å°ç£çï¼ä½æ¯æ§è½ä¼å·®å¾å¤ã\n\nå®éä¸ä½ å¨è¿éï¼å¦æé¢è¯å®æ²¡æé®ä½  es ä¸¢æ°æ®çé®é¢ï¼ä½ å¯ä»¥å¨è¿éç»é¢è¯å®ç«ä¸æï¼ä½ è¯´ï¼å¶å® es ç¬¬ä¸æ¯åå®æ¶çï¼æ°æ®åå¥ 1 ç§åå¯ä»¥æç´¢å°ï¼å¯è½ä¼ä¸¢å¤±æ°æ®çãæ 5 ç§çæ°æ®ï¼åçå¨ bufferãtranslog os cacheãsegment file os cache ä¸­ï¼èä¸å¨ç£çä¸ï¼æ­¤æ¶å¦æå®æºï¼ä¼å¯¼è´ 5 ç§çæ°æ®ä¸¢å¤±ã\n\næ»ç»ä¸ä¸ï¼æ°æ®ååå¥åå­ bufferï¼ç¶åæ¯é 1sï¼å°æ°æ® refresh å° os cacheï¼å°äº os cache æ°æ®å°±è½è¢«æç´¢å°ï¼æä»¥æä»¬æè¯´ es ä»åå¥å°è½è¢«æç´¢å°ï¼ä¸­é´æ 1s çå»¶è¿ï¼ãæ¯é 5sï¼å°æ°æ®åå¥ translog æä»¶ï¼è¿æ ·å¦ææºå¨å®æºï¼åå­æ°æ®å¨æ²¡ï¼æå¤ä¼æ 5s çæ°æ®ä¸¢å¤±ï¼ï¼translog å¤§å°ä¸å®ç¨åº¦ï¼æèé»è®¤æ¯é 30minsï¼ä¼è§¦å commit æä½ï¼å°ç¼å²åºçæ°æ®é½ flush å° segment file ç£çæä»¶ä¸­ã\n\n> æ°æ®åå¥ segment file ä¹åï¼åæ¶å°±å»ºç«å¥½äºåæç´¢å¼ã\n\n\n# å é¤/æ´æ°æ°æ®åºå±åç\n\nå¦ææ¯å é¤æä½ï¼commit çæ¶åä¼çæä¸ä¸ª .del æä»¶ï¼éé¢å°æä¸ª doc æ è¯ä¸º deleted ç¶æï¼é£ä¹æç´¢çæ¶åæ ¹æ® .del æä»¶å°±ç¥éè¿ä¸ª doc æ¯å¦è¢«å é¤äºã\n\nå¦ææ¯æ´æ°æä½ï¼å°±æ¯å°åæ¥ç doc æ è¯ä¸º deleted ç¶æï¼ç¶åæ°åå¥ä¸æ¡æ°æ®ã\n\nbuffer æ¯ refresh ä¸æ¬¡ï¼å°±ä¼äº§çä¸ä¸ª segment fileï¼æä»¥é»è®¤æåµä¸æ¯ 1 ç§éä¸ä¸ª segment fileï¼è¿æ ·ä¸æ¥ segment file ä¼è¶æ¥è¶å¤ï¼æ­¤æ¶ä¼å®ææ§è¡ mergeãæ¯æ¬¡ merge çæ¶åï¼ä¼å°å¤ä¸ª segment file åå¹¶æä¸ä¸ªï¼åæ¶è¿éä¼å°æ è¯ä¸º deleted ç doc ç»ç©çå é¤æï¼ç¶åå°æ°ç segment file åå¥ç£çï¼è¿éä¼åä¸ä¸ª commit pointï¼æ è¯æææ°ç segment fileï¼ç¶åæå¼ segment file ä¾æç´¢ä½¿ç¨ï¼åæ¶å é¤æ§ç segment fileã\n\n\n# åºå± lucene\n\nç®åæ¥è¯´ï¼lucene å°±æ¯ä¸ä¸ª jar åï¼éé¢åå«äºå°è£å¥½çåç§å»ºç«åæç´¢å¼çç®æ³ä»£ç ãæä»¬ç¨ java å¼åçæ¶åï¼å¼å¥ lucene jarï¼ç¶ååºäº lucene ç api å»å¼åå°±å¯ä»¥äºã\n\néè¿ luceneï¼æä»¬å¯ä»¥å°å·²æçæ°æ®å»ºç«ç´¢å¼ï¼lucene ä¼å¨æ¬å°ç£çä¸é¢ï¼ç»æä»¬ç»ç»ç´¢å¼çæ°æ®ç»æã\n\n\n# åæç´¢å¼\n\nå¨æç´¢å¼æä¸­ï¼æ¯ä¸ªææ¡£é½æä¸ä¸ªå¯¹åºçææ¡£ idï¼ææ¡£åå®¹è¢«è¡¨ç¤ºä¸ºä¸ç³»åå³é®è¯çéåãä¾å¦ï¼ææ¡£ 1 ç»è¿åè¯ï¼æåäº 20 ä¸ªå³é®è¯ï¼æ¯ä¸ªå³é®è¯é½ä¼è®°å½å®å¨ææ¡£ä¸­åºç°çæ¬¡æ°ååºç°ä½ç½®ã\n\né£ä¹ï¼åæç´¢å¼å°±æ¯å³é®è¯å°ææ¡£ id çæ å°ï¼æ¯ä¸ªå³é®è¯é½å¯¹åºçä¸ç³»åçæä»¶ï¼è¿äºæä»¶ä¸­é½åºç°äºå³é®è¯ã\n\nä¸¾ä¸ªæ å­ã\n\næä»¥ä¸ææ¡£ï¼\n\ndocid   doc\n1       è°·æ­å°å¾ä¹ç¶è·³æ§½ facebook\n2       è°·æ­å°å¾ä¹ç¶å ç facebook\n3       è°·æ­å°å¾åå§äººææ¯ç¦»å¼è°·æ­å ç facebook\n4       è°·æ­å°å¾ä¹ç¶è·³æ§½ facebook ä¸ wave é¡¹ç®åæ¶æå³\n5       è°·æ­å°å¾ä¹ç¶ææ¯å çç¤¾äº¤ç½ç« facebook\n\nå¯¹ææ¡£è¿è¡åè¯ä¹åï¼å¾å°ä»¥ä¸åæç´¢å¼ã\n\nwordid   word       docids\n1        è°·æ­         1,2,3,4,5\n2        å°å¾         1,2,3,4,5\n3        ä¹ç¶         1,2,4,5\n4        è·³æ§½         1,4\n5        facebook   1,2,3,4,5\n6        å ç         2,3,5\n7        åå§äºº        3\n8        ææ¯         3,5\n9        ç¦»å¼         3\n10       ä¸          4\n..       ..         ..\n\nå¦å¤ï¼å®ç¨çåæç´¢å¼è¿å¯ä»¥è®°å½æ´å¤çä¿¡æ¯ï¼æ¯å¦ææ¡£é¢çä¿¡æ¯ï¼è¡¨ç¤ºå¨ææ¡£éåä¸­æå¤å°ä¸ªææ¡£åå«æä¸ªåè¯ã\n\né£ä¹ï¼æäºåæç´¢å¼ï¼æç´¢å¼æå¯ä»¥å¾æ¹ä¾¿å°ååºç¨æ·çæ¥è¯¢ãæ¯å¦ç¨æ·è¾å¥æ¥è¯¢ facebookï¼æç´¢ç³»ç»æ¥æ¾åæç´¢å¼ï¼ä»ä¸­è¯»åºåå«è¿ä¸ªåè¯çææ¡£ï¼è¿äºææ¡£å°±æ¯æä¾ç»ç¨æ·çæç´¢ç»æã\n\nè¦æ³¨æåæç´¢å¼çä¸¤ä¸ªéè¦ç»èï¼\n\n * åæç´¢å¼ä¸­çææè¯é¡¹å¯¹åºä¸ä¸ªæå¤ä¸ªææ¡£ï¼\n * åæç´¢å¼ä¸­çè¯é¡¹æ ¹æ®å­å¸é¡ºåºååºæå\n\n> ä¸é¢åªæ¯ä¸ä¸ªç®åçæ å­ï¼å¹¶æ²¡æä¸¥æ ¼æç§å­å¸é¡ºåºååºæåã\n\n\n# åèèµæ\n\n * å®æ¹\n   * elasticsearch å®ç½\n   * elasticsearch github\n   * elasticsearch å®æ¹ææ¡£\n * æç« \n   * install elasticsearch with rpm\n   * https://www.ruanyifeng.com/blog/2017/08/elasticsearch.html\n   * es-introduction\n   * es-write-query-search',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Elasticsearch ç®ä»",frontmatter:{title:"Elasticsearch ç®ä»",date:"2022-02-22T21:01:01.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],permalink:"/pages/0fb506/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/03.Elasticsearch%E7%AE%80%E4%BB%8B.html",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/03.Elasticsearchç®ä».md",key:"v-83a32830",path:"/pages/0fb506/",headers:[{level:2,title:"Elasticsearch ç¹ç¹",slug:"elasticsearch-ç¹ç¹",normalizedTitle:"elasticsearch ç¹ç¹",charIndex:429},{level:2,title:"Elasticsearch åå±åå²",slug:"elasticsearch-åå±åå²",normalizedTitle:"elasticsearch åå±åå²",charIndex:600},{level:2,title:"Elasticsearch æ¦å¿µ",slug:"elasticsearch-æ¦å¿µ",normalizedTitle:"elasticsearch æ¦å¿µ",charIndex:3168},{level:3,title:"è¿å®æ¶ï¼NRTï¼",slug:"è¿å®æ¶-nrt",normalizedTitle:"è¿å®æ¶ï¼nrtï¼",charIndex:3258},{level:3,title:"ç´¢å¼ï¼Indexï¼",slug:"ç´¢å¼-index",normalizedTitle:"ç´¢å¼ï¼indexï¼",charIndex:3331},{level:4,title:"åæç´¢å¼",slug:"åæç´¢å¼",normalizedTitle:"åæç´¢å¼",charIndex:3574},{level:4,title:"index template",slug:"index-template",normalizedTitle:"index template",charIndex:3930},{level:4,title:"dynamic template",slug:"dynamic-template",normalizedTitle:"dynamic template",charIndex:5130},{level:3,title:"~~ç±»åï¼Typeï¼~~",slug:"ç±»å-type",normalizedTitle:"<s>ç±»åï¼typeï¼</s>",charIndex:null},{level:3,title:"ææ¡£ï¼Documentï¼",slug:"ææ¡£-document",normalizedTitle:"ææ¡£ï¼documentï¼",charIndex:6584},{level:4,title:"ææ¡£çåæ°æ®",slug:"ææ¡£çåæ°æ®",normalizedTitle:"ææ¡£çåæ°æ®",charIndex:6759},{level:3,title:"èç¹ï¼Nodeï¼",slug:"èç¹-node",normalizedTitle:"èç¹ï¼nodeï¼",charIndex:7215},{level:4,title:"èç¹ç®ä»",slug:"èç¹ç®ä»",normalizedTitle:"èç¹ç®ä»",charIndex:7227},{level:4,title:"èç¹ç±»å",slug:"èç¹ç±»å",normalizedTitle:"èç¹ç±»å",charIndex:7447},{level:4,title:"èç¹éç½®",slug:"èç¹éç½®",normalizedTitle:"èç¹éç½®",charIndex:8023},{level:3,title:"éç¾¤ï¼Clusterï¼",slug:"éç¾¤-cluster",normalizedTitle:"éç¾¤ï¼clusterï¼",charIndex:8232},{level:4,title:"éç¾¤ç®ä»",slug:"éç¾¤ç®ä»",normalizedTitle:"éç¾¤ç®ä»",charIndex:8247},{level:4,title:"éç¾¤å¥åº·",slug:"éç¾¤å¥åº·",normalizedTitle:"éç¾¤å¥åº·",charIndex:8704},{level:3,title:"åçï¼Shardsï¼",slug:"åç-shards",normalizedTitle:"åçï¼shardsï¼",charIndex:9438},{level:4,title:"åçç®ä»",slug:"åçç®ä»",normalizedTitle:"åçç®ä»",charIndex:9452},{level:4,title:"ä¸»åçåå¯åç",slug:"ä¸»åçåå¯åç",normalizedTitle:"ä¸»åçåå¯åç",charIndex:9730},{level:3,title:"å¯æ¬ï¼Replicasï¼",slug:"å¯æ¬-replicas",normalizedTitle:"å¯æ¬ï¼replicasï¼",charIndex:10156},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:10505}],headersStr:"Elasticsearch ç¹ç¹ Elasticsearch åå±åå² Elasticsearch æ¦å¿µ è¿å®æ¶ï¼NRTï¼ ç´¢å¼ï¼Indexï¼ åæç´¢å¼ index template dynamic template ~~ç±»åï¼Typeï¼~~ ææ¡£ï¼Documentï¼ ææ¡£çåæ°æ® èç¹ï¼Nodeï¼ èç¹ç®ä» èç¹ç±»å èç¹éç½® éç¾¤ï¼Clusterï¼ éç¾¤ç®ä» éç¾¤å¥åº· åçï¼Shardsï¼ åçç®ä» ä¸»åçåå¯åç å¯æ¬ï¼Replicasï¼ åèèµæ",content:'# Elasticsearch ç®ä»\n\nElasticsearch æ¯ä¸ä¸ªåºäº Lucene çæç´¢åæ°æ®åæå·¥å·ï¼å®æä¾äºä¸ä¸ªåå¸å¼æå¡ãElasticsearch æ¯éµä» Apache å¼æºæ¡æ¬¾çä¸æ¬¾å¼æºäº§åï¼æ¯å½åä¸»æµçä¼ä¸çº§æç´¢å¼æã\n\nå®ç¨äºå¨ææç´¢ãç»æåæç´¢ãåæä»¥åå°è¿ä¸èæ··åä½¿ç¨ï¼\n\n * ç»´åºç¾ç§ä½¿ç¨ Elasticsearch æä¾å¨ææç´¢å¹¶é«äº®å³é®å­ï¼ä»¥å**è¾å¥å®æ¶æç´¢(search-as-you-type)åæç´¢çº é(did-you-mean)**ç­æç´¢å»ºè®®åè½ã\n * è±å½å«æ¥ä½¿ç¨ Elasticsearch ç»åç¨æ·æ¥å¿åç¤¾äº¤ç½ç»æ°æ®æä¾ç»ä»ä»¬çç¼è¾ä»¥å®æ¶çåé¦ï¼ä»¥ä¾¿åæ¶äºè§£å¬ä¼å¯¹æ°åè¡¨çæç« çååºã\n * StackOverflow ç»åå¨ææç´¢ä¸å°çä½ç½®æ¥è¯¢ï¼ä»¥åmore-like-thisåè½æ¥æ¾å°ç¸å³çé®é¢åç­æ¡ã\n * Github ä½¿ç¨ Elasticsearch æ£ç´¢ 1300 äº¿è¡çä»£ç ã\n\n\n# Elasticsearch ç¹ç¹\n\n * åå¸å¼çå®æ¶æä»¶å­å¨ï¼æ¯ä¸ªå­æ®µé½è¢«ç´¢å¼å¹¶å¯è¢«æç´¢ï¼\n * åå¸å¼çå®æ¶åææç´¢å¼æï¼\n * å¯å¼¹æ§æ©å±å°ä¸ç¾å°æå¡å¨è§æ¨¡ï¼å¤ç PB çº§ç»æåæéç»æåæ°æ®ï¼\n * å¼ç®±å³ç¨ï¼å®è£å³å¯ä½¿ç¨ï¼ï¼å®æä¾äºè®¸å¤åççç¼ºçå¼ï¼å¹¶å¯¹åå­¦èéèäºå¤æçæç´¢å¼æçè®ºãåªéå¾å°çå­¦ä¹ æ¢å¯å¨çäº§ç¯å¢ä¸­ä½¿ç¨ã\n\n\n# Elasticsearch åå±åå²\n\n * 2010 å¹´ 2 æ 8 æ¥ï¼Elasticsearch ç¬¬ä¸ä¸ªå¬å¼çæ¬åå¸ã\n\n * 2010 å¹´ 5 æ 14 æ¥ï¼åå¸ç¬¬ä¸ä¸ªå·æéç¨ç¢æä¹çåå§çæ¬ 0.7.0 ï¼å·æå¦ä¸ç¹å¾ï¼\n\n * Zen Discovery èªå¨åç°æ¨¡åï¼\n   \n   * æ¯æ Groovy Clientï¼\n\n * ç®åçæä»¶ç®¡çæºå¶ï¼\n   \n   * æ´å¥½å°æ¯æ icu åè¯å¨ï¼\n\n * æ´å¤çç®¡ç apiã\n\n * 2013 å¹´åï¼GitHub æå¼äº Solrï¼éå ElasticSearch æ¥åå¶ PB çº§çæç´¢ã\n\n * 2014 å¹´ 2 æ 14 æ¥ï¼åå¸ 1.0.0 çæ¬ï¼å¢å å¦ä¸éè¦ç¹æ§ï¼\n\n * æ¯æ Snapshot/Restore API å¤ä»½æ¢å¤ APIï¼\n   \n   * æ¯æèååæ Aggregationsï¼\n\n * æ¯æ cat apiï¼\n   \n   * æ¯ææ­è·¯å¨ï¼\n\n * å¼å¥ Doc valuesã\n\n * 2015 å¹´ 10 æ 28 æ¥ï¼åå¸ 2.0.0 çæ¬ï¼æå¦ä¸éè¦ç¹æ§ï¼\n\n * å¢å äº Pipleline Aggregationsï¼\n   \n   * query/filter æ¥è¯¢åå¹¶ï¼é½åå¹¶å° query ä¸­ï¼æ ¹æ®ä¸åçä¸ä¸ææ§è¡ä¸åçæ¥è¯¢ï¼\n\n * åç¼©å­å¨å¯éç½®ï¼\n   \n   * Rivers æ¨¡åè¢«ç§»é¤ï¼\n\n * Multicast ç»æ­åç°è¢«ç§»é¤ï¼æä¸ºä¸ä¸ªæä»¶ï¼çäº§ç¯å¢å¿é¡»éç½®åæ­å°åã\n\n * 2016 å¹´ 10 æ 26 æ¥ï¼åå¸ 5.0.0 çæ¬ï¼æå¦ä¸éå¤§ç¹æ§ååï¼\n\n * Lucene 6.x çæ¯æï¼ç£çç©ºé´å°ä¸åï¼ç´¢å¼æ¶é´å°ä¸åï¼æ¥è¯¢æ§è½æå 25%ï¼æ¯æ IPV6ï¼\n   \n   * Internal Engine çº§å«ç§»é¤äºç¨äºé¿ååä¸ææ¡£å¹¶åæ´æ°çç«äºéï¼å¸¦æ¥ 15%-20% çæ§è½æåï¼\n\n * Shrink APIï¼å®å¯å°åçæ°è¿è¡æ¶ç¼©æå®çå æ°ï¼å¦ä¹åä½ æ¯ 15 ä¸ªåçï¼ä½ å¯ä»¥æ¶ç¼©æ 5 ä¸ªæè 3 ä¸ªåæè 1 ä¸ªï¼é£ä¹æä»¬å°±å¯ä»¥æ³è±¡æè¿æ ·ä¸ç§åºæ¯ï¼å¨åå¥ååéå¸¸å¤§çæ¶éé¶æ®µï¼è®¾ç½®è¶³å¤å¤çç´¢å¼ï¼ååå©ç¨ shard çå¹¶è¡åè½åï¼ç´¢å¼åå®ä¹åæ¶ç¼©ææ´å°ç shardï¼æé«æ¥è¯¢æ§è½ï¼\n   \n   * æä¾äºç¬¬ä¸ä¸ª Java åçç REST å®¢æ·ç«¯ SDKï¼\n\n * IngestNodeï¼ä¹åå¦æéè¦å¯¹æ°æ®è¿è¡å å·¥ï¼é½æ¯å¨ç´¢å¼ä¹åè¿è¡å¤çï¼æ¯å¦ logstash å¯ä»¥å¯¹æ¥å¿è¿è¡ç»æååè½¬æ¢ï¼ç°å¨ç´æ¥å¨ es å°±å¯ä»¥å¤çäºï¼\n   \n   * æä¾äº Painless èæ¬ï¼ä»£æ¿ Groovy èæ¬ï¼\n   * ç§»é¤ site pluginsï¼å°±æ¯è¯´ headãbigdesk é½ä¸è½ç´æ¥è£ es éé¢äºï¼ä¸è¿å¯ä»¥é¨ç½²ç¬ç«ç«ç¹ï¼åæ­£é½æ¯éææä»¶ï¼æå¼å kibana æä»¶ï¼\n   * æ°å¢ Sliced Scroll ç±»åï¼ç°å¨ Scroll æ¥å£å¯ä»¥å¹¶åæ¥è¿è¡æ°æ®éåäºãæ¯ä¸ª Scroll è¯·æ±ï¼å¯ä»¥åæå¤ä¸ª Slice è¯·æ±ï¼å¯ä»¥çè§£ä¸ºåçï¼å Slice ç¬ç«å¹¶è¡ï¼å©ç¨ Scroll éå»ºæèéåè¦å¿«å¾å¤åï¼\n   * æ°å¢äº Profile APIï¼\n   * æ°å¢äº Rollover APIï¼\n   * æ°å¢ Reindexï¼\n   * å¼å¥æ°çå­æ®µç±»å Text/Keyword æ¥æ¿æ¢ Stringï¼\n   * éå¶ç´¢å¼è¯·æ±å¤§å°ï¼é¿åå¤§éå¹¶åè¯·æ±åå® ESï¼\n   * éå¶åä¸ªè¯·æ±ç shards æ°éï¼é»è®¤ 1000 ä¸ªã\n\n * 2017 å¹´ 8 æ 31 æ¥ï¼åå¸ 6.0.0 çæ¬ï¼å·æå¦ä¸éè¦ç¹æ§ï¼\n\n * ç¨çæ§ Doc Values çæ¯æï¼\n   \n   * Index Sortingï¼å³ç´¢å¼é¶æ®µçæåºï¼\n\n * é¡ºåºå·çæ¯æï¼æ¯ä¸ª es çæä½é½æä¸ä¸ªé¡ºåºç¼å·ï¼ç±»ä¼¼å¢éè®¾è®¡ï¼ï¼\n   \n   * æ ç¼æ»å¨åçº§ï¼\n\n * ä» 6.0 å¼å§ä¸æ¯æä¸ä¸ª index éé¢å­å¨å¤ä¸ª typeï¼\n   \n   * Index-template inheritanceï¼ç´¢å¼çæ¬çç»§æ¿ï¼ç®åç´¢å¼æ¨¡æ¿æ¯ææå¹éçé½ä¼åå¹¶ï¼è¿æ ·ä¼é æç´¢å¼æ¨¡æ¿æä¸äºå²çªé®é¢ï¼ 6.0 å°ä¼åªå¹éä¸ä¸ªï¼ç´¢å¼åå»ºæ¶ä¹ä¼è¿è¡éªè¯ï¼\n   * Load aware shard routingï¼ åºäºè´è½½çè¯·æ±è·¯ç±ï¼ç®åçæç´¢è¯·æ±æ¯å¨èç¹è½®è¯¢ï¼é£ä¹æ§è½ææ¢çèç¹å¾å¾ä¼é ææ´ä½çå»¶è¿å¢å ï¼æ°çå®ç°æ¹å¼å°åºäºéåçèè´¹æ¶é´èªå¨è°èéåé¿åº¦ï¼è´è½½é«çèç¹çéåé¿åº¦å°åå°ï¼è®©å¶ä»èç¹åææ´å¤çååï¼æç´¢åç´¢å¼é½å°åºäºè¿ç§æºå¶ï¼\n   * å·²ç»å³é­çç´¢å¼å°ä¹æ¯æ replica çèªå¨å¤çï¼ç¡®ä¿æ°æ®å¯é ã\n\n * 2019 å¹´ 4 æ 10 æ¥ï¼åå¸ 7.0.0 çæ¬ï¼å·æå¦ä¸éè¦ç¹æ§ï¼\n\n * éç¾¤è¿æ¥ååï¼TransportClient è¢«åºå¼ï¼es7 ç java ä»£ç ï¼åªè½ä½¿ç¨ restclientï¼å¯¹äº java ç¼ç¨ï¼å»ºè®®éç¨ High-level-rest-client çæ¹å¼æä½ ES éç¾¤ï¼\n   \n   * ES ç¨åºåé»è®¤æå jdkï¼7.x çæ¬çç¨åºåå¤§å°åæ 300MB+ï¼å¯¹æ¯ 6.xï¼åå¤§äº 200MB+ï¼è¿æ­£æ¯ JDK çå¤§å°ï¼\n\n * éç¨åºäº Lucene 9.0ï¼\n   \n   * æ­£å¼åºé¤åä¸ªç´¢å¼ä¸å¤ Type çæ¯æï¼es6 æ¶ï¼å®æ¹å°±æå°äº es7 ä¼å é¤ typeï¼å¹¶ä¸ es6 æ¶ï¼å·²ç»è§å®æ¯ä¸ä¸ª index åªè½æä¸ä¸ª typeãå¨ es7 ä¸­ï¼ä½¿ç¨é»è®¤ç _doc ä½ä¸º typeï¼å®æ¹è¯´å¨ 8.x çæ¬ä¼å½»åºç§»é¤ typeãapi è¯·æ±æ¹å¼ä¹åéååï¼å¦è·å¾æç´¢å¼çæ ID çææ¡£ï¼GET index/_doc/id å¶ä¸­ index å id ä¸ºå·ä½çå¼ï¼\n\n * å¼å¥äºçæ­£çåå­æ­è·¯å¨ï¼å®å¯ä»¥æ´ç²¾åå°æ£æµåºæ æ³å¤ççè¯·æ±ï¼å¹¶é²æ­¢å®ä»¬ä½¿åä¸ªèç¹ä¸ç¨³å®ï¼\n   \n   * Zen2 æ¯ Elasticsearch çå¨æ°éç¾¤åè°å±ï¼æé«äºå¯é æ§ãæ§è½åç¨æ·ä½éªï¼åå¾æ´å¿«ãæ´å®å¨ï¼å¹¶æ´æäºä½¿ç¨ã\n\n\n# Elasticsearch æ¦å¿µ\n\nä¸åæä¸äºæ¦å¿µæ¯ Elasticsearch çæ ¸å¿ãä»ä¸å¼å§å°±çè§£è¿äºæ¦å¿µå°æå¤§å°å¸®å©ç®åå­¦ä¹  Elasticsearch çè¿ç¨ã\n\n\n# è¿å®æ¶ï¼NRTï¼\n\nElasticsearch æ¯ä¸ä¸ªè¿ä¹å®æ¶çæç´¢å¹³å°ãè¿æå³çä»ç´¢å¼ææ¡£å°å¯æç´¢ææ¡£çæ¶é´æä¸ç¹å»¶è¿ï¼éå¸¸æ¯ä¸ç§ï¼ã\n\n\n# ç´¢å¼ï¼Indexï¼\n\nç´¢å¼å¨ä¸åè¯­å¢ï¼æçä¸åçå«ä¹\n\n * ç´¢å¼ï¼åè¯ï¼ï¼ä¸ä¸ª ç´¢å¼ ç±»ä¼¼äºä¼ ç»å³ç³»æ°æ®åºä¸­çä¸ä¸ª æ°æ®åº ï¼æ¯ä¸ä¸ªå­å¨å³ç³»åææ¡£çå®¹å¨ã ç´¢å¼ (index) çå¤æ°è¯ä¸º indices æ indexes ãç´¢å¼å®éä¸æ¯æåä¸ä¸ªæèå¤ä¸ªç©çåççé»è¾å½åç©ºé´ ã\n * ç´¢å¼ï¼å¨è¯ï¼ï¼ç´¢å¼ä¸ä¸ªææ¡£ å°±æ¯å­å¨ä¸ä¸ªææ¡£å°ä¸ä¸ª ç´¢å¼ ï¼åè¯ï¼ä¸­ä»¥ä¾¿è¢«æ£ç´¢åæ¥è¯¢ãè¿éå¸¸ç±»ä¼¼äº SQL è¯­å¥ä¸­ç INSERT å³é®è¯ï¼é¤äºææ¡£å·²å­å¨æ¶ï¼æ°ææ¡£ä¼æ¿æ¢æ§ææ¡£æåµä¹å¤ã\n * åæç´¢å¼ï¼å³ç³»åæ°æ®åºéè¿å¢å ä¸ä¸ªç´¢å¼æ¯å¦ä¸ä¸ª B æ ç´¢å¼å°æå®çåä¸ï¼ä»¥ä¾¿æåæ°æ®æ£ç´¢éåº¦ãElasticsearch å Lucene ä½¿ç¨äºä¸ä¸ªå«å åæç´¢å¼ çç»ææ¥è¾¾å°ç¸åçç®çã\n\nç´¢å¼ç Mapping å Setting\n\n * Mapping å®ä¹ææ¡£å­æ®µçç±»å\n * Setting å®ä¹ä¸åçæ°æ®åå¸\n\nç¤ºä¾ï¼\n\n{\n    "settings": { ... any settings ... },\n    "mappings": {\n        "type_one": { ... any mappings ... },\n        "type_two": { ... any mappings ... },\n        ...\n    }\n}\n\n\n# åæç´¢å¼\n\n\n\n# index template\n\nindex templateï¼ç´¢å¼æ¨¡æ¿ï¼å¸®å©ç¨æ·è®¾å® Mapping å Settingï¼å¹¶æç§ä¸å®çè§åï¼èªå¨å¹éå°æ°åå»ºçç´¢å¼ä¹ä¸ã\n\n * æ¨¡æ¿ä»å¨ä¸ä¸ªç´¢å¼è¢«åå»ºæ¶ï¼æä¼äº§çä½ç¨ãä¿®æ¹æ¨¡æ¿ä¸ä¼å½±åå·²åå»ºçç´¢å¼ã\n * ä½ å¯ä»¥è®¾å®å¤ä¸ªç´¢å¼æ¨¡æ¿ï¼è¿äºè®¾ç½®ä¼è¢« merge å¨ä¸èµ·ã\n * ä½ å¯ä»¥æå® order çæ°å¼ï¼æ§å¶ merge çè¿ç¨ã\n\nå½æ°å»ºä¸ä¸ªç´¢å¼æ¶\n\n * åºç¨ ES é»è®¤ç Mapping å Setting\n * åºç¨ order æ°å¼ä½ç index template ä¸­çè®¾å®\n * åºç¨ order æ°å¼é«ç index template ä¸­çè®¾å®ï¼ä¹åçè®¾å®ä¼è¢«è¦ç\n * åºç¨åå»ºç´¢å¼æ¯ï¼ç¨æ·ææå®ç Mapping å Settingï¼å¹¶è¦çä¹åæ¨¡æ¿ä¸­çè®¾å®ã\n\nç¤ºä¾ï¼åå»ºé»è®¤ç´¢å¼æ¨¡æ¿\n\nPUT _template/template_default\n{\n  "index_patterns": ["*"],\n  "order": 0,\n  "version": 1,\n  "settings": {\n    "number_of_shards": 1,\n    "number_of_replicas": 1\n  }\n}\n\nPUT /_template/template_test\n{\n  "index_patterns": ["test*"],\n  "order": 1,\n  "settings": {\n    "number_of_shards": 1,\n    "number_of_replicas": 2\n  },\n  "mappings": {\n    "date_detection": false,\n    "numeric_detection": true\n  }\n}\n\n# æ¥çç´¢å¼æ¨¡æ¿\nGET /_template/template_default\nGET /_template/temp*\n\n#åå¥æ°çæ°æ®ï¼indexä»¥testå¼å¤´\nPUT testtemplate/_doc/1\n{\n  "someNumber": "1",\n  "someDate": "2019/01/01"\n}\nGET testtemplate/_mapping\nGET testtemplate/_settings\n\nPUT testmy\n{\n\t"settings":{\n\t\t"number_of_replicas":5\n\t}\n}\n\nPUT testmy/_doc/1\n{\n  "key": "value"\n}\n\nGET testmy/_settings\nDELETE testmy\nDELETE /_template/template_default\nDELETE /_template/template_test\n\n\n# dynamic template\n\n * æ ¹æ® ES è¯å«çæ°æ®ç±»åï¼ç»åå­æ®µåç§°ï¼æ¥å¨æè®¾å®å­æ®µç±»å\n   * ææçå­ç¬¦ä¸²ç±»åé½è®¾å®æ Keywordï¼æèå³é­ keyword å­æ®µã\n   * is å¼å¤´çå­æ®µé½è®¾ç½®æ boolean\n   * long_ å¼å¤´çé½è®¾ç½®æ long ç±»å\n * dynamic template æ¯å®ä¹å¨æä¸ªç´¢å¼ç Mapping ä¸­\n * template æä¸ä¸ªåç§°\n * å¹éè§åæ¯ä¸ä¸ªæ°ç»\n * ä¸ºå¹éå°å­æ®µè®¾ç½® Mapping\n\nç¤ºä¾ï¼\n\n#Dynaminc Mapping æ ¹æ®ç±»ååå­æ®µå\nDELETE my_index\n\nPUT my_index/_doc/1\n{\n  "firstName": "Ruan",\n  "isVIP": "true"\n}\n\nGET my_index/_mapping\n\nDELETE my_index\nPUT my_index\n{\n  "mappings": {\n    "dynamic_templates": [\n      {\n        "strings_as_boolean": {\n          "match_mapping_type": "string",\n          "match": "is*",\n          "mapping": {\n            "type": "boolean"\n          }\n        }\n      },\n      {\n        "strings_as_keywords": {\n          "match_mapping_type": "string",\n          "mapping": {\n            "type": "keyword"\n          }\n        }\n      }\n    ]\n  }\n}\nGET my_index/_mapping\n\nDELETE my_index\n#ç»åè·¯å¾\nPUT my_index\n{\n  "mappings": {\n    "dynamic_templates": [\n      {\n        "full_name": {\n          "path_match": "name.*",\n          "path_unmatch": "*.middle",\n          "mapping": {\n            "type": "text",\n            "copy_to": "full_name"\n          }\n        }\n      }\n    ]\n  }\n}\nGET my_index/_mapping\n\n\nPUT my_index/_doc/1\n{\n  "name": {\n    "first": "John",\n    "middle": "Winston",\n    "last": "Lennon"\n  }\n}\n\nGET my_index/_search?q=full_name:John\nDELETE my_index\n\n\n\n# ç±»åï¼Typeï¼\n\ntype æ¯ä¸ä¸ªé»è¾æä¹ä¸çåç±»æèå«ååºï¼åè®¸å¨åä¸ç´¢å¼ä¸­å»ºç«å¤ä¸ª typeãæ¬è´¨æ¯ç¸å½äºä¸ä¸ªè¿æ»¤æ¡ä»¶ï¼é«çæ¬å°ä¼åºå¼ type æ¦å¿µã\n\n> 6.0.0 çæ¬åä¹åï¼åºå¼ type\n\n\n# ææ¡£ï¼Documentï¼\n\nElasticsearch æ¯é¢åææ¡£çï¼ææ¡£æ¯ææå¯æç´¢æ°æ®çæå°åä½ã\n\nElasticsearch ä½¿ç¨ JSON ä½ä¸ºææ¡£çåºååæ ¼å¼ã\n\nå¨ç´¢å¼/ç±»åä¸­ï¼å¯ä»¥æ ¹æ®éè¦å­å¨ä»»ææ°éçææ¡£ã\n\næ¯ä¸ªææ¡£é½æä¸ä¸ª Unique ID\n\n * ç¨æ·å¯ä»¥èªå·±æå®\n * æéè¿ Elasticsearch èªå¨çæ\n\n# ææ¡£çåæ°æ®\n\nä¸ä¸ªææ¡£ä¸ä»ä»åå«å®çæ°æ® ï¼ä¹åå«åæ°æ® ââ æå³ææ¡£çä¿¡æ¯ã\n\n * _indexï¼ææ¡£å¨åªå­æ¾\n * _typeï¼ææ¡£è¡¨ç¤ºçå¯¹è±¡ç±»å«\n * _idï¼ææ¡£å¯ä¸æ è¯\n * _sourceï¼ææ¡£çåå§ Json æ°æ®\n * _allï¼æ´åææå­æ®µåå®¹å°è¯¥å­æ®µï¼å·²è¢«åºé¤\n * _versionï¼ææ¡£ççæ¬ä¿¡æ¯\n * _scoreï¼ç¸å³æ§æå\n\nç¤ºä¾ï¼\n\n{\n  "_index": "megacorp",\n  "_type": "employee",\n  "_id": "1",\n  "_version": 1,\n  "found": true,\n  "_source": {\n    "first_name": "John",\n    "last_name": "Smith",\n    "age": 25,\n    "about": "I love to go rock climbing",\n    "interests": ["sports", "music"]\n  }\n}\n\n\n\n# èç¹ï¼Nodeï¼\n\n# èç¹ç®ä»\n\nä¸ä¸ªè¿è¡ä¸­ç Elasticsearch å®ä¾ç§°ä¸ºä¸ä¸ªèç¹ã\n\nElasticsearch å®ä¾æ¬è´¨ä¸æ¯ä¸ä¸ª Java è¿ç¨ãä¸å°æºå¨ä¸å¯ä»¥è¿è¡å¤ä¸ª Elasticsearch è¿ç¨ï¼ä½æ¯çäº§ç¯å¢å»ºè®®ä¸å°æºå¨ä¸åªè¿è¡ä¸ä¸ª Elasticsearch è¿ç¨\n\næ¯ä¸ªèç¹é½æåå­ï¼éè¿éç½®æä»¶éç½®ï¼æå¯å¨æ¶éè¿ -E node.name=node1 æå®ã\n\næ¯ä¸ªèç¹å¨å¯å¨åï¼ä¼åéä¸ä¸ª UIDï¼ä¿å­å¨ data ç®å½ä¸ã\n\n# èç¹ç±»å\n\n * ä¸»èç¹ï¼master nodeï¼ï¼æ¯ä¸ªèç¹é½ä¿å­äºéç¾¤çç¶æï¼åªæ master èç¹æè½ä¿®æ¹éç¾¤çç¶æä¿¡æ¯ï¼ä¿è¯æ°æ®ä¸è´æ§ï¼ãéç¾¤ç¶æï¼ç»´æ¤äºä»¥ä¸ä¿¡æ¯ï¼\n   * ææçèç¹ä¿¡æ¯\n   * ææçç´¢å¼åå¶ç¸å³ç mapping å setting ä¿¡æ¯\n   * åççè·¯ç±ä¿¡æ¯\n * åéèç¹ï¼master eligible nodeï¼ï¼master eligible èç¹å¯ä»¥åå éä¸»æµç¨ãç¬¬ä¸ä¸ªå¯å¨çèç¹ï¼ä¼å°èªå·±éä¸¾ä¸º mater èç¹ã\n   * æ¯ä¸ªèç¹å¯å¨åï¼é»è®¤ä¸º master eligible èç¹ï¼å¯ä»¥éè¿éç½® node.master: false ç¦æ­¢\n * æ°æ®èç¹ï¼data nodeï¼ï¼è´è´£ä¿å­åçæ°æ®ã\n * åè°èç¹ï¼coordinating nodeï¼ï¼è´è´£æ¥æ¶å®¢æ·ç«¯çè¯·æ±ï¼å°è¯·æ±ååå°åéçæ¥å°é£ï¼æç»æç»ææ±éå°ä¸èµ·ãæ¯ä¸ª Elasticsearch èç¹é»è®¤é½æ¯åè°èç¹ï¼coordinating nodeï¼ã\n * å·/ç­èç¹ï¼warm/hot nodeï¼ï¼éå¯¹ä¸åç¡¬ä»¶éç½®çæ°æ®èç¹ï¼data nodeï¼ï¼ç¨æ¥å®ç° Hot & Warm æ¶æï¼éä½éç¾¤é¨ç½²çææ¬ã\n * æºå¨å­¦ä¹ èç¹ï¼machine learning nodeï¼ï¼è´è´£æ§è¡æºå¨å­¦ä¹ ç Jobï¼ç¨æ¥åå¼å¸¸æ£æµã\n\n# èç¹éç½®\n\néç½®åæ°          é»è®¤å¼    è¯´æ\nnode.master   true   æ¯å¦ä¸ºä¸»èç¹\nnode.data     true   æ¯å¦ä¸ºæ°æ®èç¹\nnode.ingest   true   \nnode.ml       true   æ¯å¦ä¸ºæºå¨å­¦ä¹ èç¹ï¼éè¦å¼å¯ x-packï¼\n\n> å»ºè®®\n> \n> å¼åç¯å¢ä¸­ä¸ä¸ªèç¹å¯ä»¥æ¿æå¤ç§è§è²ãä½æ¯ï¼å¨çäº§ç¯å¢ä¸­ï¼èç¹åºè¯¥è®¾ç½®ä¸ºåä¸è§è²ã\n\n\n# éç¾¤ï¼Clusterï¼\n\n# éç¾¤ç®ä»\n\næ¥æç¸å cluster.name éç½®ç Elasticsearch èç¹ç»æä¸ä¸ªéç¾¤ã cluster.name é»è®¤åä¸º elasticsearchï¼å¯ä»¥éè¿éç½®æä»¶ä¿®æ¹ï¼æå¯å¨æ¶éè¿ -E cluster.name=xxx æå®ã\n\nå½æèç¹å å¥éç¾¤ä¸­æèä»éç¾¤ä¸­ç§»é¤èç¹æ¶ï¼éç¾¤å°ä¼éæ°å¹³ååå¸ææçæ°æ®ã\n\nå½ä¸ä¸ªèç¹è¢«éä¸¾æä¸ºä¸»èç¹æ¶ï¼å®å°è´è´£ç®¡çéç¾¤èå´åçææåæ´ï¼ä¾å¦å¢å ãå é¤ç´¢å¼ï¼æèå¢å ãå é¤èç¹ç­ã èä¸»èç¹å¹¶ä¸éè¦æ¶åå°ææ¡£çº§å«çåæ´åæç´¢ç­æä½ï¼æä»¥å½éç¾¤åªæ¥æä¸ä¸ªä¸»èç¹çæåµä¸ï¼å³ä½¿æµéå¢å ï¼å®ä¹ä¸ä¼æä¸ºç¶é¢ã ä»»ä½èç¹é½å¯ä»¥æä¸ºä¸»èç¹ã\n\nä½ä¸ºç¨æ·ï¼æä»¬å¯ä»¥å°è¯·æ±åéå°éç¾¤ä¸­çä»»ä½èç¹ ï¼åæ¬ä¸»èç¹ã æ¯ä¸ªèç¹é½ç¥éä»»æææ¡£æå¤çä½ç½®ï¼å¹¶ä¸è½å¤å°æä»¬çè¯·æ±ç´æ¥è½¬åå°å­å¨æä»¬æéææ¡£çèç¹ã æ è®ºæä»¬å°è¯·æ±åéå°åªä¸ªèç¹ï¼å®é½è½è´è´£ä»åä¸ªåå«æä»¬æéææ¡£çèç¹æ¶éåæ°æ®ï¼å¹¶å°æç»ç»æè¿åçµ¦å®¢æ·ç«¯ã Elasticsearch å¯¹è¿ä¸åçç®¡çé½æ¯éæçã\n\n# éç¾¤å¥åº·\n\nElasticsearch çéç¾¤çæ§ä¿¡æ¯ä¸­åå«äºè®¸å¤çç»è®¡æ°æ®ï¼å¶ä¸­æä¸ºéè¦çä¸é¡¹å°±æ¯ éç¾¤å¥åº· ï¼ å®å¨ status å­æ®µä¸­å±ç¤ºä¸º green ã yellow æè red ã\n\nå¨ä¸ä¸ªä¸åå«ä»»ä½ç´¢å¼çç©ºéç¾¤ä¸­ï¼å®å°ä¼æä¸ä¸ªç±»ä¼¼äºå¦ä¸æç¤ºçè¿ååå®¹ï¼\n\n{\n  "cluster_name" : "elasticsearch",\n  "status" : "green",\n  "timed_out" : false,\n  "number_of_nodes" : 1,\n  "number_of_data_nodes" : 1,\n  "active_primary_shards" : 5,\n  "active_shards" : 5,\n  "relocating_shards" : 0,\n  "initializing_shards" : 0,\n  "unassigned_shards" : 0,\n  "delayed_unassigned_shards" : 0,\n  "number_of_pending_tasks" : 0,\n  "number_of_in_flight_fetch" : 0,\n  "task_max_waiting_in_queue_millis" : 0,\n  "active_shards_percent_as_number" : 100.0\n}\n\n\nstatus å­æ®µæç¤ºçå½åéç¾¤å¨æ»ä½ä¸æ¯å¦å·¥ä½æ­£å¸¸ãå®çä¸ç§é¢è²å«ä¹å¦ä¸ï¼\n\n * greenï¼ææçä¸»åçåå¯æ¬åçé½æ­£å¸¸è¿è¡ã\n * yellowï¼ææçä¸»åçé½æ­£å¸¸è¿è¡ï¼ä½ä¸æ¯ææçå¯æ¬åçé½æ­£å¸¸è¿è¡ã\n * redï¼æä¸»åçæ²¡è½æ­£å¸¸è¿è¡ã\n\n\n# åçï¼Shardsï¼\n\n# åçç®ä»\n\nç´¢å¼å®éä¸æ¯æåä¸ä¸ªæèå¤ä¸ªç©çåççé»è¾å½åç©ºé´ ã\n\nä¸ä¸ªåçæ¯ä¸ä¸ªåºå±çå·¥ä½åå ï¼å®ä»ä¿å­äºå¨é¨æ°æ®ä¸­çä¸é¨åãä¸ä¸ªåçå¯ä»¥è§ä¸ºä¸ä¸ª Lucene çå®ä¾ï¼å¹¶ä¸å®æ¬èº«å°±æ¯ä¸ä¸ªå®æ´çæç´¢å¼æã æä»¬çææ¡£è¢«å­å¨åç´¢å¼å°åçåï¼ä½æ¯åºç¨ç¨åºæ¯ç´æ¥ä¸ç´¢å¼èä¸æ¯ä¸åçè¿è¡äº¤äºã\n\nElasticsearch æ¯å©ç¨åçå°æ°æ®ååå°éç¾¤ååå¤çãåçæ¯æ°æ®çå®¹å¨ï¼ææ¡£ä¿å­å¨åçåï¼åçåè¢«åéå°éç¾¤åçåä¸ªèç¹éã å½ä½ çéç¾¤è§æ¨¡æ©å¤§æèç¼©å°æ¶ï¼ Elasticsearch ä¼èªå¨çå¨åèç¹ä¸­è¿ç§»åçï¼ä½¿å¾æ°æ®ä»ç¶åååå¸å¨éç¾¤éã\n\n# ä¸»åçåå¯åç\n\nåçåä¸ºä¸»åçï¼Primary Shardï¼åå¯åçï¼Replica Shardï¼ã\n\nä¸»åçï¼ç¨äºè§£å³æ°æ®æ°´å¹³æ©å±çé®é¢ãéè¿ä¸»åçï¼å¯ä»¥å°æ°æ®åå¸å°éç¾¤åä¸åèç¹ä¸ã\n\n * ç´¢å¼åä»»æä¸ä¸ªææ¡£é½å½å±äºä¸ä¸ªä¸»åçã\n * ä¸»åçæ°å¨ç´¢å¼åå»ºæ¶æå®ï¼ååºä¸åè®¸ä¿®æ¹ï¼é¤é Reindex\n\nå¯åçï¼Replica Shardï¼ï¼ç¨äºè§£å³æ°æ®é«å¯ç¨çé®é¢ãå¯åçæ¯ä¸»åççæ·è´ãå¯æ¬åçä½ä¸ºç¡¬ä»¶æéæ¶ä¿æ¤æ°æ®ä¸ä¸¢å¤±çåä½å¤ä»½ï¼å¹¶ä¸ºæç´¢åè¿åææ¡£ç­è¯»æä½æä¾æå¡ã\n\n * å¯åçæ°å¯ä»¥å¨æè°æ´\n * å¢å å¯æ¬æ°ï¼è¿å¯ä»¥å¨ä¸å®ç¨åº¦ä¸æé«æå¡çå¯ç¨æ§ï¼è¯»åçååï¼\n\nå¯¹äºçäº§ç¯å¢ä¸­åççè®¾å®ï¼éè¦æååå¥½å®¹éè§å\n\nåçæ°è¿å°\n\n * æ æ³æ°´å¹³æ©å±\n * åä¸ªåççæ°éå¤ªå¤§ï¼å¯¼è´æ°æ®éæ°åéèæ¶\n\nåçæ°è¿å¤§\n\n * å½±åæç´¢ç»æçç¸å³æ§æåï¼å½±åç»è®¡ç»æçåç¡®æ§\n * åèç¹ä¸è¿å¤çåçï¼ä¼å¯¼è´èµæºæµªè´¹ï¼åæ¶ä¹ä¼å½±åæ§è½\n\n\n# å¯æ¬ï¼Replicasï¼\n\nå¯æ¬ä¸»è¦æ¯éå¯¹ä¸»åçï¼Shardsï¼çå¤å¶ï¼Elasticsearch ä¸­ä¸»åçå¯ä»¥æ¥æ 0 ä¸ªæå¤ä¸ªçå¯æ¬ã\n\nå¯æ¬åççä¸»è¦ç®çå°±æ¯ä¸ºäºæéè½¬ç§»ã\n\nåçå¯æ¬å¾éè¦ï¼ä¸»è¦æä¸¤ä¸ªåå ï¼\n\n * å®å¨åçæèç¹åçæéæ¶æä¾é«å¯ç¨æ§ãå æ­¤ï¼å¯æ¬åçæ°¸è¿ä¸ä¼å¨ä¸å¶å¤å¶çä¸»åçç¸åçèç¹ï¼\n * å¯æ¬åçä¹å¯ä»¥æ¥åæç´¢çè¯·æ±ï¼å¯ä»¥å¹¶è¡æç´¢ï¼ä»èæé«ç³»ç»çååéã\n\n> æ¯ä¸ª Elasticsearch åçé½æ¯ Lucene ç´¢å¼ãåä¸ª Lucene ç´¢å¼ä¸­å¯ä»¥åå«æå¤§æ°éçææ¡£ãæªæ­¢ LUCENE-5843ï¼éå¶æ¯ 2,147,483,519ï¼= Integer.MAX_VALUE - 128ï¼ææ¡£ãæ¨å¯ä»¥ä½¿ç¨_cat/shardsAPI çæ§åçå¤§å°ã\n\n\n# åèèµæ\n\n * Elasticsearch å®ç½\n * Elasticsearch ç®ä»',normalizedContent:'# elasticsearch ç®ä»\n\nelasticsearch æ¯ä¸ä¸ªåºäº lucene çæç´¢åæ°æ®åæå·¥å·ï¼å®æä¾äºä¸ä¸ªåå¸å¼æå¡ãelasticsearch æ¯éµä» apache å¼æºæ¡æ¬¾çä¸æ¬¾å¼æºäº§åï¼æ¯å½åä¸»æµçä¼ä¸çº§æç´¢å¼æã\n\nå®ç¨äºå¨ææç´¢ãç»æåæç´¢ãåæä»¥åå°è¿ä¸èæ··åä½¿ç¨ï¼\n\n * ç»´åºç¾ç§ä½¿ç¨ elasticsearch æä¾å¨ææç´¢å¹¶é«äº®å³é®å­ï¼ä»¥å**è¾å¥å®æ¶æç´¢(search-as-you-type)åæç´¢çº é(did-you-mean)**ç­æç´¢å»ºè®®åè½ã\n * è±å½å«æ¥ä½¿ç¨ elasticsearch ç»åç¨æ·æ¥å¿åç¤¾äº¤ç½ç»æ°æ®æä¾ç»ä»ä»¬çç¼è¾ä»¥å®æ¶çåé¦ï¼ä»¥ä¾¿åæ¶äºè§£å¬ä¼å¯¹æ°åè¡¨çæç« çååºã\n * stackoverflow ç»åå¨ææç´¢ä¸å°çä½ç½®æ¥è¯¢ï¼ä»¥åmore-like-thisåè½æ¥æ¾å°ç¸å³çé®é¢åç­æ¡ã\n * github ä½¿ç¨ elasticsearch æ£ç´¢ 1300 äº¿è¡çä»£ç ã\n\n\n# elasticsearch ç¹ç¹\n\n * åå¸å¼çå®æ¶æä»¶å­å¨ï¼æ¯ä¸ªå­æ®µé½è¢«ç´¢å¼å¹¶å¯è¢«æç´¢ï¼\n * åå¸å¼çå®æ¶åææç´¢å¼æï¼\n * å¯å¼¹æ§æ©å±å°ä¸ç¾å°æå¡å¨è§æ¨¡ï¼å¤ç pb çº§ç»æåæéç»æåæ°æ®ï¼\n * å¼ç®±å³ç¨ï¼å®è£å³å¯ä½¿ç¨ï¼ï¼å®æä¾äºè®¸å¤åççç¼ºçå¼ï¼å¹¶å¯¹åå­¦èéèäºå¤æçæç´¢å¼æçè®ºãåªéå¾å°çå­¦ä¹ æ¢å¯å¨çäº§ç¯å¢ä¸­ä½¿ç¨ã\n\n\n# elasticsearch åå±åå²\n\n * 2010 å¹´ 2 æ 8 æ¥ï¼elasticsearch ç¬¬ä¸ä¸ªå¬å¼çæ¬åå¸ã\n\n * 2010 å¹´ 5 æ 14 æ¥ï¼åå¸ç¬¬ä¸ä¸ªå·æéç¨ç¢æä¹çåå§çæ¬ 0.7.0 ï¼å·æå¦ä¸ç¹å¾ï¼\n\n * zen discovery èªå¨åç°æ¨¡åï¼\n   \n   * æ¯æ groovy clientï¼\n\n * ç®åçæä»¶ç®¡çæºå¶ï¼\n   \n   * æ´å¥½å°æ¯æ icu åè¯å¨ï¼\n\n * æ´å¤çç®¡ç apiã\n\n * 2013 å¹´åï¼github æå¼äº solrï¼éå elasticsearch æ¥åå¶ pb çº§çæç´¢ã\n\n * 2014 å¹´ 2 æ 14 æ¥ï¼åå¸ 1.0.0 çæ¬ï¼å¢å å¦ä¸éè¦ç¹æ§ï¼\n\n * æ¯æ snapshot/restore api å¤ä»½æ¢å¤ apiï¼\n   \n   * æ¯æèååæ aggregationsï¼\n\n * æ¯æ cat apiï¼\n   \n   * æ¯ææ­è·¯å¨ï¼\n\n * å¼å¥ doc valuesã\n\n * 2015 å¹´ 10 æ 28 æ¥ï¼åå¸ 2.0.0 çæ¬ï¼æå¦ä¸éè¦ç¹æ§ï¼\n\n * å¢å äº pipleline aggregationsï¼\n   \n   * query/filter æ¥è¯¢åå¹¶ï¼é½åå¹¶å° query ä¸­ï¼æ ¹æ®ä¸åçä¸ä¸ææ§è¡ä¸åçæ¥è¯¢ï¼\n\n * åç¼©å­å¨å¯éç½®ï¼\n   \n   * rivers æ¨¡åè¢«ç§»é¤ï¼\n\n * multicast ç»æ­åç°è¢«ç§»é¤ï¼æä¸ºä¸ä¸ªæä»¶ï¼çäº§ç¯å¢å¿é¡»éç½®åæ­å°åã\n\n * 2016 å¹´ 10 æ 26 æ¥ï¼åå¸ 5.0.0 çæ¬ï¼æå¦ä¸éå¤§ç¹æ§ååï¼\n\n * lucene 6.x çæ¯æï¼ç£çç©ºé´å°ä¸åï¼ç´¢å¼æ¶é´å°ä¸åï¼æ¥è¯¢æ§è½æå 25%ï¼æ¯æ ipv6ï¼\n   \n   * internal engine çº§å«ç§»é¤äºç¨äºé¿ååä¸ææ¡£å¹¶åæ´æ°çç«äºéï¼å¸¦æ¥ 15%-20% çæ§è½æåï¼\n\n * shrink apiï¼å®å¯å°åçæ°è¿è¡æ¶ç¼©æå®çå æ°ï¼å¦ä¹åä½ æ¯ 15 ä¸ªåçï¼ä½ å¯ä»¥æ¶ç¼©æ 5 ä¸ªæè 3 ä¸ªåæè 1 ä¸ªï¼é£ä¹æä»¬å°±å¯ä»¥æ³è±¡æè¿æ ·ä¸ç§åºæ¯ï¼å¨åå¥ååéå¸¸å¤§çæ¶éé¶æ®µï¼è®¾ç½®è¶³å¤å¤çç´¢å¼ï¼ååå©ç¨ shard çå¹¶è¡åè½åï¼ç´¢å¼åå®ä¹åæ¶ç¼©ææ´å°ç shardï¼æé«æ¥è¯¢æ§è½ï¼\n   \n   * æä¾äºç¬¬ä¸ä¸ª java åçç rest å®¢æ·ç«¯ sdkï¼\n\n * ingestnodeï¼ä¹åå¦æéè¦å¯¹æ°æ®è¿è¡å å·¥ï¼é½æ¯å¨ç´¢å¼ä¹åè¿è¡å¤çï¼æ¯å¦ logstash å¯ä»¥å¯¹æ¥å¿è¿è¡ç»æååè½¬æ¢ï¼ç°å¨ç´æ¥å¨ es å°±å¯ä»¥å¤çäºï¼\n   \n   * æä¾äº painless èæ¬ï¼ä»£æ¿ groovy èæ¬ï¼\n   * ç§»é¤ site pluginsï¼å°±æ¯è¯´ headãbigdesk é½ä¸è½ç´æ¥è£ es éé¢äºï¼ä¸è¿å¯ä»¥é¨ç½²ç¬ç«ç«ç¹ï¼åæ­£é½æ¯éææä»¶ï¼æå¼å kibana æä»¶ï¼\n   * æ°å¢ sliced scroll ç±»åï¼ç°å¨ scroll æ¥å£å¯ä»¥å¹¶åæ¥è¿è¡æ°æ®éåäºãæ¯ä¸ª scroll è¯·æ±ï¼å¯ä»¥åæå¤ä¸ª slice è¯·æ±ï¼å¯ä»¥çè§£ä¸ºåçï¼å slice ç¬ç«å¹¶è¡ï¼å©ç¨ scroll éå»ºæèéåè¦å¿«å¾å¤åï¼\n   * æ°å¢äº profile apiï¼\n   * æ°å¢äº rollover apiï¼\n   * æ°å¢ reindexï¼\n   * å¼å¥æ°çå­æ®µç±»å text/keyword æ¥æ¿æ¢ stringï¼\n   * éå¶ç´¢å¼è¯·æ±å¤§å°ï¼é¿åå¤§éå¹¶åè¯·æ±åå® esï¼\n   * éå¶åä¸ªè¯·æ±ç shards æ°éï¼é»è®¤ 1000 ä¸ªã\n\n * 2017 å¹´ 8 æ 31 æ¥ï¼åå¸ 6.0.0 çæ¬ï¼å·æå¦ä¸éè¦ç¹æ§ï¼\n\n * ç¨çæ§ doc values çæ¯æï¼\n   \n   * index sortingï¼å³ç´¢å¼é¶æ®µçæåºï¼\n\n * é¡ºåºå·çæ¯æï¼æ¯ä¸ª es çæä½é½æä¸ä¸ªé¡ºåºç¼å·ï¼ç±»ä¼¼å¢éè®¾è®¡ï¼ï¼\n   \n   * æ ç¼æ»å¨åçº§ï¼\n\n * ä» 6.0 å¼å§ä¸æ¯æä¸ä¸ª index éé¢å­å¨å¤ä¸ª typeï¼\n   \n   * index-template inheritanceï¼ç´¢å¼çæ¬çç»§æ¿ï¼ç®åç´¢å¼æ¨¡æ¿æ¯ææå¹éçé½ä¼åå¹¶ï¼è¿æ ·ä¼é æç´¢å¼æ¨¡æ¿æä¸äºå²çªé®é¢ï¼ 6.0 å°ä¼åªå¹éä¸ä¸ªï¼ç´¢å¼åå»ºæ¶ä¹ä¼è¿è¡éªè¯ï¼\n   * load aware shard routingï¼ åºäºè´è½½çè¯·æ±è·¯ç±ï¼ç®åçæç´¢è¯·æ±æ¯å¨èç¹è½®è¯¢ï¼é£ä¹æ§è½ææ¢çèç¹å¾å¾ä¼é ææ´ä½çå»¶è¿å¢å ï¼æ°çå®ç°æ¹å¼å°åºäºéåçèè´¹æ¶é´èªå¨è°èéåé¿åº¦ï¼è´è½½é«çèç¹çéåé¿åº¦å°åå°ï¼è®©å¶ä»èç¹åææ´å¤çååï¼æç´¢åç´¢å¼é½å°åºäºè¿ç§æºå¶ï¼\n   * å·²ç»å³é­çç´¢å¼å°ä¹æ¯æ replica çèªå¨å¤çï¼ç¡®ä¿æ°æ®å¯é ã\n\n * 2019 å¹´ 4 æ 10 æ¥ï¼åå¸ 7.0.0 çæ¬ï¼å·æå¦ä¸éè¦ç¹æ§ï¼\n\n * éç¾¤è¿æ¥ååï¼transportclient è¢«åºå¼ï¼es7 ç java ä»£ç ï¼åªè½ä½¿ç¨ restclientï¼å¯¹äº java ç¼ç¨ï¼å»ºè®®éç¨ high-level-rest-client çæ¹å¼æä½ es éç¾¤ï¼\n   \n   * es ç¨åºåé»è®¤æå jdkï¼7.x çæ¬çç¨åºåå¤§å°åæ 300mb+ï¼å¯¹æ¯ 6.xï¼åå¤§äº 200mb+ï¼è¿æ­£æ¯ jdk çå¤§å°ï¼\n\n * éç¨åºäº lucene 9.0ï¼\n   \n   * æ­£å¼åºé¤åä¸ªç´¢å¼ä¸å¤ type çæ¯æï¼es6 æ¶ï¼å®æ¹å°±æå°äº es7 ä¼å é¤ typeï¼å¹¶ä¸ es6 æ¶ï¼å·²ç»è§å®æ¯ä¸ä¸ª index åªè½æä¸ä¸ª typeãå¨ es7 ä¸­ï¼ä½¿ç¨é»è®¤ç _doc ä½ä¸º typeï¼å®æ¹è¯´å¨ 8.x çæ¬ä¼å½»åºç§»é¤ typeãapi è¯·æ±æ¹å¼ä¹åéååï¼å¦è·å¾æç´¢å¼çæ id çææ¡£ï¼get index/_doc/id å¶ä¸­ index å id ä¸ºå·ä½çå¼ï¼\n\n * å¼å¥äºçæ­£çåå­æ­è·¯å¨ï¼å®å¯ä»¥æ´ç²¾åå°æ£æµåºæ æ³å¤ççè¯·æ±ï¼å¹¶é²æ­¢å®ä»¬ä½¿åä¸ªèç¹ä¸ç¨³å®ï¼\n   \n   * zen2 æ¯ elasticsearch çå¨æ°éç¾¤åè°å±ï¼æé«äºå¯é æ§ãæ§è½åç¨æ·ä½éªï¼åå¾æ´å¿«ãæ´å®å¨ï¼å¹¶æ´æäºä½¿ç¨ã\n\n\n# elasticsearch æ¦å¿µ\n\nä¸åæä¸äºæ¦å¿µæ¯ elasticsearch çæ ¸å¿ãä»ä¸å¼å§å°±çè§£è¿äºæ¦å¿µå°æå¤§å°å¸®å©ç®åå­¦ä¹  elasticsearch çè¿ç¨ã\n\n\n# è¿å®æ¶ï¼nrtï¼\n\nelasticsearch æ¯ä¸ä¸ªè¿ä¹å®æ¶çæç´¢å¹³å°ãè¿æå³çä»ç´¢å¼ææ¡£å°å¯æç´¢ææ¡£çæ¶é´æä¸ç¹å»¶è¿ï¼éå¸¸æ¯ä¸ç§ï¼ã\n\n\n# ç´¢å¼ï¼indexï¼\n\nç´¢å¼å¨ä¸åè¯­å¢ï¼æçä¸åçå«ä¹\n\n * ç´¢å¼ï¼åè¯ï¼ï¼ä¸ä¸ª ç´¢å¼ ç±»ä¼¼äºä¼ ç»å³ç³»æ°æ®åºä¸­çä¸ä¸ª æ°æ®åº ï¼æ¯ä¸ä¸ªå­å¨å³ç³»åææ¡£çå®¹å¨ã ç´¢å¼ (index) çå¤æ°è¯ä¸º indices æ indexes ãç´¢å¼å®éä¸æ¯æåä¸ä¸ªæèå¤ä¸ªç©çåççé»è¾å½åç©ºé´ ã\n * ç´¢å¼ï¼å¨è¯ï¼ï¼ç´¢å¼ä¸ä¸ªææ¡£ å°±æ¯å­å¨ä¸ä¸ªææ¡£å°ä¸ä¸ª ç´¢å¼ ï¼åè¯ï¼ä¸­ä»¥ä¾¿è¢«æ£ç´¢åæ¥è¯¢ãè¿éå¸¸ç±»ä¼¼äº sql è¯­å¥ä¸­ç insert å³é®è¯ï¼é¤äºææ¡£å·²å­å¨æ¶ï¼æ°ææ¡£ä¼æ¿æ¢æ§ææ¡£æåµä¹å¤ã\n * åæç´¢å¼ï¼å³ç³»åæ°æ®åºéè¿å¢å ä¸ä¸ªç´¢å¼æ¯å¦ä¸ä¸ª b æ ç´¢å¼å°æå®çåä¸ï¼ä»¥ä¾¿æåæ°æ®æ£ç´¢éåº¦ãelasticsearch å lucene ä½¿ç¨äºä¸ä¸ªå«å åæç´¢å¼ çç»ææ¥è¾¾å°ç¸åçç®çã\n\nç´¢å¼ç mapping å setting\n\n * mapping å®ä¹ææ¡£å­æ®µçç±»å\n * setting å®ä¹ä¸åçæ°æ®åå¸\n\nç¤ºä¾ï¼\n\n{\n    "settings": { ... any settings ... },\n    "mappings": {\n        "type_one": { ... any mappings ... },\n        "type_two": { ... any mappings ... },\n        ...\n    }\n}\n\n\n# åæç´¢å¼\n\n\n\n# index template\n\nindex templateï¼ç´¢å¼æ¨¡æ¿ï¼å¸®å©ç¨æ·è®¾å® mapping å settingï¼å¹¶æç§ä¸å®çè§åï¼èªå¨å¹éå°æ°åå»ºçç´¢å¼ä¹ä¸ã\n\n * æ¨¡æ¿ä»å¨ä¸ä¸ªç´¢å¼è¢«åå»ºæ¶ï¼æä¼äº§çä½ç¨ãä¿®æ¹æ¨¡æ¿ä¸ä¼å½±åå·²åå»ºçç´¢å¼ã\n * ä½ å¯ä»¥è®¾å®å¤ä¸ªç´¢å¼æ¨¡æ¿ï¼è¿äºè®¾ç½®ä¼è¢« merge å¨ä¸èµ·ã\n * ä½ å¯ä»¥æå® order çæ°å¼ï¼æ§å¶ merge çè¿ç¨ã\n\nå½æ°å»ºä¸ä¸ªç´¢å¼æ¶\n\n * åºç¨ es é»è®¤ç mapping å setting\n * åºç¨ order æ°å¼ä½ç index template ä¸­çè®¾å®\n * åºç¨ order æ°å¼é«ç index template ä¸­çè®¾å®ï¼ä¹åçè®¾å®ä¼è¢«è¦ç\n * åºç¨åå»ºç´¢å¼æ¯ï¼ç¨æ·ææå®ç mapping å settingï¼å¹¶è¦çä¹åæ¨¡æ¿ä¸­çè®¾å®ã\n\nç¤ºä¾ï¼åå»ºé»è®¤ç´¢å¼æ¨¡æ¿\n\nput _template/template_default\n{\n  "index_patterns": ["*"],\n  "order": 0,\n  "version": 1,\n  "settings": {\n    "number_of_shards": 1,\n    "number_of_replicas": 1\n  }\n}\n\nput /_template/template_test\n{\n  "index_patterns": ["test*"],\n  "order": 1,\n  "settings": {\n    "number_of_shards": 1,\n    "number_of_replicas": 2\n  },\n  "mappings": {\n    "date_detection": false,\n    "numeric_detection": true\n  }\n}\n\n# æ¥çç´¢å¼æ¨¡æ¿\nget /_template/template_default\nget /_template/temp*\n\n#åå¥æ°çæ°æ®ï¼indexä»¥testå¼å¤´\nput testtemplate/_doc/1\n{\n  "somenumber": "1",\n  "somedate": "2019/01/01"\n}\nget testtemplate/_mapping\nget testtemplate/_settings\n\nput testmy\n{\n\t"settings":{\n\t\t"number_of_replicas":5\n\t}\n}\n\nput testmy/_doc/1\n{\n  "key": "value"\n}\n\nget testmy/_settings\ndelete testmy\ndelete /_template/template_default\ndelete /_template/template_test\n\n\n# dynamic template\n\n * æ ¹æ® es è¯å«çæ°æ®ç±»åï¼ç»åå­æ®µåç§°ï¼æ¥å¨æè®¾å®å­æ®µç±»å\n   * ææçå­ç¬¦ä¸²ç±»åé½è®¾å®æ keywordï¼æèå³é­ keyword å­æ®µã\n   * is å¼å¤´çå­æ®µé½è®¾ç½®æ boolean\n   * long_ å¼å¤´çé½è®¾ç½®æ long ç±»å\n * dynamic template æ¯å®ä¹å¨æä¸ªç´¢å¼ç mapping ä¸­\n * template æä¸ä¸ªåç§°\n * å¹éè§åæ¯ä¸ä¸ªæ°ç»\n * ä¸ºå¹éå°å­æ®µè®¾ç½® mapping\n\nç¤ºä¾ï¼\n\n#dynaminc mapping æ ¹æ®ç±»ååå­æ®µå\ndelete my_index\n\nput my_index/_doc/1\n{\n  "firstname": "ruan",\n  "isvip": "true"\n}\n\nget my_index/_mapping\n\ndelete my_index\nput my_index\n{\n  "mappings": {\n    "dynamic_templates": [\n      {\n        "strings_as_boolean": {\n          "match_mapping_type": "string",\n          "match": "is*",\n          "mapping": {\n            "type": "boolean"\n          }\n        }\n      },\n      {\n        "strings_as_keywords": {\n          "match_mapping_type": "string",\n          "mapping": {\n            "type": "keyword"\n          }\n        }\n      }\n    ]\n  }\n}\nget my_index/_mapping\n\ndelete my_index\n#ç»åè·¯å¾\nput my_index\n{\n  "mappings": {\n    "dynamic_templates": [\n      {\n        "full_name": {\n          "path_match": "name.*",\n          "path_unmatch": "*.middle",\n          "mapping": {\n            "type": "text",\n            "copy_to": "full_name"\n          }\n        }\n      }\n    ]\n  }\n}\nget my_index/_mapping\n\n\nput my_index/_doc/1\n{\n  "name": {\n    "first": "john",\n    "middle": "winston",\n    "last": "lennon"\n  }\n}\n\nget my_index/_search?q=full_name:john\ndelete my_index\n\n\n\n# ç±»åï¼typeï¼\n\ntype æ¯ä¸ä¸ªé»è¾æä¹ä¸çåç±»æèå«ååºï¼åè®¸å¨åä¸ç´¢å¼ä¸­å»ºç«å¤ä¸ª typeãæ¬è´¨æ¯ç¸å½äºä¸ä¸ªè¿æ»¤æ¡ä»¶ï¼é«çæ¬å°ä¼åºå¼ type æ¦å¿µã\n\n> 6.0.0 çæ¬åä¹åï¼åºå¼ type\n\n\n# ææ¡£ï¼documentï¼\n\nelasticsearch æ¯é¢åææ¡£çï¼ææ¡£æ¯ææå¯æç´¢æ°æ®çæå°åä½ã\n\nelasticsearch ä½¿ç¨ json ä½ä¸ºææ¡£çåºååæ ¼å¼ã\n\nå¨ç´¢å¼/ç±»åä¸­ï¼å¯ä»¥æ ¹æ®éè¦å­å¨ä»»ææ°éçææ¡£ã\n\næ¯ä¸ªææ¡£é½æä¸ä¸ª unique id\n\n * ç¨æ·å¯ä»¥èªå·±æå®\n * æéè¿ elasticsearch èªå¨çæ\n\n# ææ¡£çåæ°æ®\n\nä¸ä¸ªææ¡£ä¸ä»ä»åå«å®çæ°æ® ï¼ä¹åå«åæ°æ® ââ æå³ææ¡£çä¿¡æ¯ã\n\n * _indexï¼ææ¡£å¨åªå­æ¾\n * _typeï¼ææ¡£è¡¨ç¤ºçå¯¹è±¡ç±»å«\n * _idï¼ææ¡£å¯ä¸æ è¯\n * _sourceï¼ææ¡£çåå§ json æ°æ®\n * _allï¼æ´åææå­æ®µåå®¹å°è¯¥å­æ®µï¼å·²è¢«åºé¤\n * _versionï¼ææ¡£ççæ¬ä¿¡æ¯\n * _scoreï¼ç¸å³æ§æå\n\nç¤ºä¾ï¼\n\n{\n  "_index": "megacorp",\n  "_type": "employee",\n  "_id": "1",\n  "_version": 1,\n  "found": true,\n  "_source": {\n    "first_name": "john",\n    "last_name": "smith",\n    "age": 25,\n    "about": "i love to go rock climbing",\n    "interests": ["sports", "music"]\n  }\n}\n\n\n\n# èç¹ï¼nodeï¼\n\n# èç¹ç®ä»\n\nä¸ä¸ªè¿è¡ä¸­ç elasticsearch å®ä¾ç§°ä¸ºä¸ä¸ªèç¹ã\n\nelasticsearch å®ä¾æ¬è´¨ä¸æ¯ä¸ä¸ª java è¿ç¨ãä¸å°æºå¨ä¸å¯ä»¥è¿è¡å¤ä¸ª elasticsearch è¿ç¨ï¼ä½æ¯çäº§ç¯å¢å»ºè®®ä¸å°æºå¨ä¸åªè¿è¡ä¸ä¸ª elasticsearch è¿ç¨\n\næ¯ä¸ªèç¹é½æåå­ï¼éè¿éç½®æä»¶éç½®ï¼æå¯å¨æ¶éè¿ -e node.name=node1 æå®ã\n\næ¯ä¸ªèç¹å¨å¯å¨åï¼ä¼åéä¸ä¸ª uidï¼ä¿å­å¨ data ç®å½ä¸ã\n\n# èç¹ç±»å\n\n * ä¸»èç¹ï¼master nodeï¼ï¼æ¯ä¸ªèç¹é½ä¿å­äºéç¾¤çç¶æï¼åªæ master èç¹æè½ä¿®æ¹éç¾¤çç¶æä¿¡æ¯ï¼ä¿è¯æ°æ®ä¸è´æ§ï¼ãéç¾¤ç¶æï¼ç»´æ¤äºä»¥ä¸ä¿¡æ¯ï¼\n   * ææçèç¹ä¿¡æ¯\n   * ææçç´¢å¼åå¶ç¸å³ç mapping å setting ä¿¡æ¯\n   * åççè·¯ç±ä¿¡æ¯\n * åéèç¹ï¼master eligible nodeï¼ï¼master eligible èç¹å¯ä»¥åå éä¸»æµç¨ãç¬¬ä¸ä¸ªå¯å¨çèç¹ï¼ä¼å°èªå·±éä¸¾ä¸º mater èç¹ã\n   * æ¯ä¸ªèç¹å¯å¨åï¼é»è®¤ä¸º master eligible èç¹ï¼å¯ä»¥éè¿éç½® node.master: false ç¦æ­¢\n * æ°æ®èç¹ï¼data nodeï¼ï¼è´è´£ä¿å­åçæ°æ®ã\n * åè°èç¹ï¼coordinating nodeï¼ï¼è´è´£æ¥æ¶å®¢æ·ç«¯çè¯·æ±ï¼å°è¯·æ±ååå°åéçæ¥å°é£ï¼æç»æç»ææ±éå°ä¸èµ·ãæ¯ä¸ª elasticsearch èç¹é»è®¤é½æ¯åè°èç¹ï¼coordinating nodeï¼ã\n * å·/ç­èç¹ï¼warm/hot nodeï¼ï¼éå¯¹ä¸åç¡¬ä»¶éç½®çæ°æ®èç¹ï¼data nodeï¼ï¼ç¨æ¥å®ç° hot & warm æ¶æï¼éä½éç¾¤é¨ç½²çææ¬ã\n * æºå¨å­¦ä¹ èç¹ï¼machine learning nodeï¼ï¼è´è´£æ§è¡æºå¨å­¦ä¹ ç jobï¼ç¨æ¥åå¼å¸¸æ£æµã\n\n# èç¹éç½®\n\néç½®åæ°          é»è®¤å¼    è¯´æ\nnode.master   true   æ¯å¦ä¸ºä¸»èç¹\nnode.data     true   æ¯å¦ä¸ºæ°æ®èç¹\nnode.ingest   true   \nnode.ml       true   æ¯å¦ä¸ºæºå¨å­¦ä¹ èç¹ï¼éè¦å¼å¯ x-packï¼\n\n> å»ºè®®\n> \n> å¼åç¯å¢ä¸­ä¸ä¸ªèç¹å¯ä»¥æ¿æå¤ç§è§è²ãä½æ¯ï¼å¨çäº§ç¯å¢ä¸­ï¼èç¹åºè¯¥è®¾ç½®ä¸ºåä¸è§è²ã\n\n\n# éç¾¤ï¼clusterï¼\n\n# éç¾¤ç®ä»\n\næ¥æç¸å cluster.name éç½®ç elasticsearch èç¹ç»æä¸ä¸ªéç¾¤ã cluster.name é»è®¤åä¸º elasticsearchï¼å¯ä»¥éè¿éç½®æä»¶ä¿®æ¹ï¼æå¯å¨æ¶éè¿ -e cluster.name=xxx æå®ã\n\nå½æèç¹å å¥éç¾¤ä¸­æèä»éç¾¤ä¸­ç§»é¤èç¹æ¶ï¼éç¾¤å°ä¼éæ°å¹³ååå¸ææçæ°æ®ã\n\nå½ä¸ä¸ªèç¹è¢«éä¸¾æä¸ºä¸»èç¹æ¶ï¼å®å°è´è´£ç®¡çéç¾¤èå´åçææåæ´ï¼ä¾å¦å¢å ãå é¤ç´¢å¼ï¼æèå¢å ãå é¤èç¹ç­ã èä¸»èç¹å¹¶ä¸éè¦æ¶åå°ææ¡£çº§å«çåæ´åæç´¢ç­æä½ï¼æä»¥å½éç¾¤åªæ¥æä¸ä¸ªä¸»èç¹çæåµä¸ï¼å³ä½¿æµéå¢å ï¼å®ä¹ä¸ä¼æä¸ºç¶é¢ã ä»»ä½èç¹é½å¯ä»¥æä¸ºä¸»èç¹ã\n\nä½ä¸ºç¨æ·ï¼æä»¬å¯ä»¥å°è¯·æ±åéå°éç¾¤ä¸­çä»»ä½èç¹ ï¼åæ¬ä¸»èç¹ã æ¯ä¸ªèç¹é½ç¥éä»»æææ¡£æå¤çä½ç½®ï¼å¹¶ä¸è½å¤å°æä»¬çè¯·æ±ç´æ¥è½¬åå°å­å¨æä»¬æéææ¡£çèç¹ã æ è®ºæä»¬å°è¯·æ±åéå°åªä¸ªèç¹ï¼å®é½è½è´è´£ä»åä¸ªåå«æä»¬æéææ¡£çèç¹æ¶éåæ°æ®ï¼å¹¶å°æç»ç»æè¿åçµ¦å®¢æ·ç«¯ã elasticsearch å¯¹è¿ä¸åçç®¡çé½æ¯éæçã\n\n# éç¾¤å¥åº·\n\nelasticsearch çéç¾¤çæ§ä¿¡æ¯ä¸­åå«äºè®¸å¤çç»è®¡æ°æ®ï¼å¶ä¸­æä¸ºéè¦çä¸é¡¹å°±æ¯ éç¾¤å¥åº· ï¼ å®å¨ status å­æ®µä¸­å±ç¤ºä¸º green ã yellow æè red ã\n\nå¨ä¸ä¸ªä¸åå«ä»»ä½ç´¢å¼çç©ºéç¾¤ä¸­ï¼å®å°ä¼æä¸ä¸ªç±»ä¼¼äºå¦ä¸æç¤ºçè¿ååå®¹ï¼\n\n{\n  "cluster_name" : "elasticsearch",\n  "status" : "green",\n  "timed_out" : false,\n  "number_of_nodes" : 1,\n  "number_of_data_nodes" : 1,\n  "active_primary_shards" : 5,\n  "active_shards" : 5,\n  "relocating_shards" : 0,\n  "initializing_shards" : 0,\n  "unassigned_shards" : 0,\n  "delayed_unassigned_shards" : 0,\n  "number_of_pending_tasks" : 0,\n  "number_of_in_flight_fetch" : 0,\n  "task_max_waiting_in_queue_millis" : 0,\n  "active_shards_percent_as_number" : 100.0\n}\n\n\nstatus å­æ®µæç¤ºçå½åéç¾¤å¨æ»ä½ä¸æ¯å¦å·¥ä½æ­£å¸¸ãå®çä¸ç§é¢è²å«ä¹å¦ä¸ï¼\n\n * greenï¼ææçä¸»åçåå¯æ¬åçé½æ­£å¸¸è¿è¡ã\n * yellowï¼ææçä¸»åçé½æ­£å¸¸è¿è¡ï¼ä½ä¸æ¯ææçå¯æ¬åçé½æ­£å¸¸è¿è¡ã\n * redï¼æä¸»åçæ²¡è½æ­£å¸¸è¿è¡ã\n\n\n# åçï¼shardsï¼\n\n# åçç®ä»\n\nç´¢å¼å®éä¸æ¯æåä¸ä¸ªæèå¤ä¸ªç©çåççé»è¾å½åç©ºé´ ã\n\nä¸ä¸ªåçæ¯ä¸ä¸ªåºå±çå·¥ä½åå ï¼å®ä»ä¿å­äºå¨é¨æ°æ®ä¸­çä¸é¨åãä¸ä¸ªåçå¯ä»¥è§ä¸ºä¸ä¸ª lucene çå®ä¾ï¼å¹¶ä¸å®æ¬èº«å°±æ¯ä¸ä¸ªå®æ´çæç´¢å¼æã æä»¬çææ¡£è¢«å­å¨åç´¢å¼å°åçåï¼ä½æ¯åºç¨ç¨åºæ¯ç´æ¥ä¸ç´¢å¼èä¸æ¯ä¸åçè¿è¡äº¤äºã\n\nelasticsearch æ¯å©ç¨åçå°æ°æ®ååå°éç¾¤ååå¤çãåçæ¯æ°æ®çå®¹å¨ï¼ææ¡£ä¿å­å¨åçåï¼åçåè¢«åéå°éç¾¤åçåä¸ªèç¹éã å½ä½ çéç¾¤è§æ¨¡æ©å¤§æèç¼©å°æ¶ï¼ elasticsearch ä¼èªå¨çå¨åèç¹ä¸­è¿ç§»åçï¼ä½¿å¾æ°æ®ä»ç¶åååå¸å¨éç¾¤éã\n\n# ä¸»åçåå¯åç\n\nåçåä¸ºä¸»åçï¼primary shardï¼åå¯åçï¼replica shardï¼ã\n\nä¸»åçï¼ç¨äºè§£å³æ°æ®æ°´å¹³æ©å±çé®é¢ãéè¿ä¸»åçï¼å¯ä»¥å°æ°æ®åå¸å°éç¾¤åä¸åèç¹ä¸ã\n\n * ç´¢å¼åä»»æä¸ä¸ªææ¡£é½å½å±äºä¸ä¸ªä¸»åçã\n * ä¸»åçæ°å¨ç´¢å¼åå»ºæ¶æå®ï¼ååºä¸åè®¸ä¿®æ¹ï¼é¤é reindex\n\nå¯åçï¼replica shardï¼ï¼ç¨äºè§£å³æ°æ®é«å¯ç¨çé®é¢ãå¯åçæ¯ä¸»åççæ·è´ãå¯æ¬åçä½ä¸ºç¡¬ä»¶æéæ¶ä¿æ¤æ°æ®ä¸ä¸¢å¤±çåä½å¤ä»½ï¼å¹¶ä¸ºæç´¢åè¿åææ¡£ç­è¯»æä½æä¾æå¡ã\n\n * å¯åçæ°å¯ä»¥å¨æè°æ´\n * å¢å å¯æ¬æ°ï¼è¿å¯ä»¥å¨ä¸å®ç¨åº¦ä¸æé«æå¡çå¯ç¨æ§ï¼è¯»åçååï¼\n\nå¯¹äºçäº§ç¯å¢ä¸­åççè®¾å®ï¼éè¦æååå¥½å®¹éè§å\n\nåçæ°è¿å°\n\n * æ æ³æ°´å¹³æ©å±\n * åä¸ªåççæ°éå¤ªå¤§ï¼å¯¼è´æ°æ®éæ°åéèæ¶\n\nåçæ°è¿å¤§\n\n * å½±åæç´¢ç»æçç¸å³æ§æåï¼å½±åç»è®¡ç»æçåç¡®æ§\n * åèç¹ä¸è¿å¤çåçï¼ä¼å¯¼è´èµæºæµªè´¹ï¼åæ¶ä¹ä¼å½±åæ§è½\n\n\n# å¯æ¬ï¼replicasï¼\n\nå¯æ¬ä¸»è¦æ¯éå¯¹ä¸»åçï¼shardsï¼çå¤å¶ï¼elasticsearch ä¸­ä¸»åçå¯ä»¥æ¥æ 0 ä¸ªæå¤ä¸ªçå¯æ¬ã\n\nå¯æ¬åççä¸»è¦ç®çå°±æ¯ä¸ºäºæéè½¬ç§»ã\n\nåçå¯æ¬å¾éè¦ï¼ä¸»è¦æä¸¤ä¸ªåå ï¼\n\n * å®å¨åçæèç¹åçæéæ¶æä¾é«å¯ç¨æ§ãå æ­¤ï¼å¯æ¬åçæ°¸è¿ä¸ä¼å¨ä¸å¶å¤å¶çä¸»åçç¸åçèç¹ï¼\n * å¯æ¬åçä¹å¯ä»¥æ¥åæç´¢çè¯·æ±ï¼å¯ä»¥å¹¶è¡æç´¢ï¼ä»èæé«ç³»ç»çååéã\n\n> æ¯ä¸ª elasticsearch åçé½æ¯ lucene ç´¢å¼ãåä¸ª lucene ç´¢å¼ä¸­å¯ä»¥åå«æå¤§æ°éçææ¡£ãæªæ­¢ lucene-5843ï¼éå¶æ¯ 2,147,483,519ï¼= integer.max_value - 128ï¼ææ¡£ãæ¨å¯ä»¥ä½¿ç¨_cat/shardsapi çæ§åçå¤§å°ã\n\n\n# åèèµæ\n\n * elasticsearch å®ç½\n * elasticsearch ç®ä»',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Elasticsearch æ å°",frontmatter:{title:"Elasticsearch æ å°",date:"2022-05-16T19:54:24.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","ç´¢å¼"],permalink:"/pages/d1bae4/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/05.Elasticsearch%E6%98%A0%E5%B0%84.html",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/05.Elasticsearchæ å°.md",key:"v-a1e79a52",path:"/pages/d1bae4/",headers:[{level:2,title:"æ å°æ¹å¼",slug:"æ å°æ¹å¼",normalizedTitle:"æ å°æ¹å¼",charIndex:433},{level:3,title:"éææ å°",slug:"éææ å°",normalizedTitle:"éææ å°",charIndex:462},{level:3,title:"å¨ææ å°",slug:"å¨ææ å°",normalizedTitle:"å¨ææ å°",charIndex:467},{level:4,title:"å¨æå­æ®µæ å°",slug:"å¨æå­æ®µæ å°",normalizedTitle:"å¨æå­æ®µæ å°",charIndex:1611},{level:4,title:"å¨ææ¨¡æ¿",slug:"å¨ææ¨¡æ¿",normalizedTitle:"å¨ææ¨¡æ¿",charIndex:3687},{level:2,title:"è¿è¡æ¶å­æ®µ",slug:"è¿è¡æ¶å­æ®µ",normalizedTitle:"è¿è¡æ¶å­æ®µ",charIndex:1875},{level:3,title:"è¿è¡æ¶å­æ®µçä¼ç¹",slug:"è¿è¡æ¶å­æ®µçä¼ç¹",normalizedTitle:"è¿è¡æ¶å­æ®µçä¼ç¹",charIndex:4770},{level:2,title:"å­æ®µæ°æ®ç±»å",slug:"å­æ®µæ°æ®ç±»å",normalizedTitle:"å­æ®µæ°æ®ç±»å",charIndex:5126},{level:2,title:"åæ°æ®å­æ®µ",slug:"åæ°æ®å­æ®µ",normalizedTitle:"åæ°æ®å­æ®µ",charIndex:6401},{level:2,title:"æ å°åæ°",slug:"æ å°åæ°",normalizedTitle:"æ å°åæ°",charIndex:6855},{level:2,title:"æ å°éç½®",slug:"æ å°éç½®",normalizedTitle:"æ å°éç½®",charIndex:9217},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:9749}],headersStr:"æ å°æ¹å¼ éææ å° å¨ææ å° å¨æå­æ®µæ å° å¨ææ¨¡æ¿ è¿è¡æ¶å­æ®µ è¿è¡æ¶å­æ®µçä¼ç¹ å­æ®µæ°æ®ç±»å åæ°æ®å­æ®µ æ å°åæ° æ å°éç½® åèèµæ",content:'# Elasticsearch æ å°\n\nå¨ Elasticsearch ä¸­ï¼Mappingï¼æ å°ï¼ï¼ç¨æ¥å®ä¹ä¸ä¸ªææ¡£ä»¥åå¶æåå«çå­æ®µå¦ä½è¢«å­å¨åç´¢å¼ï¼å¯ä»¥å¨æ å°ä¸­äºåå®ä¹å­æ®µçæ°æ®ç±»åãå­æ®µçæéãåè¯å¨ç­å±æ§ï¼å°±å¦åå¨å³ç³»åæ°æ®åºä¸­åå»ºæ°æ®è¡¨æ¶ä¼è®¾ç½®å­æ®µçç±»åã\n\nMapping ä¼æ JSON ææ¡£æ å°æ Lucene æéè¦çæå¹³æ ¼å¼\n\nä¸ä¸ª Mapping å±äºä¸ä¸ªç´¢å¼ç Type\n\n * æ¯ä¸ªææ¡£é½å±äºä¸ä¸ª Type\n * ä¸ä¸ª Type æä¸ä¸ª Mapping å®ä¹\n * 7.0 å¼å§ï¼ä¸éè¦å¨ Mapping å®ä¹ä¸­æå® type ä¿¡æ¯\n\næ¯ä¸ª document é½æ¯ field çéåï¼æ¯ä¸ª field é½æèªå·±çæ°æ®ç±»åãæ å°æ°æ®æ¶ï¼å¯ä»¥åå»ºä¸ä¸ª mappingï¼å¶ä¸­åå«ä¸ document ç¸å³ç field åè¡¨ãæ å°å®ä¹è¿åæ¬åæ°æ® fieldï¼ä¾å¦ _source ï¼å®èªå®ä¹å¦ä½å¤ç document çå³èåæ°æ®ã\n\n\n# æ å°æ¹å¼\n\nå¨ Elasticsearch ä¸­ï¼æ å°å¯åä¸ºéææ å°åå¨ææ å°ãå¨å³ç³»åæ°æ®åºä¸­åå¥æ°æ®ä¹åé¦åè¦å»ºè¡¨ï¼å¨å»ºè¡¨è¯­å¥ä¸­å£°æå­æ®µçå±æ§ï¼å¨ Elasticsearch ä¸­ï¼åä¸å¿å¦æ­¤ï¼Elasticsearch æéè¦çåè½ä¹ä¸å°±æ¯è®©ä½ å°½å¯è½å¿«å°å¼å§æ¢ç´¢æ°æ®ï¼ææ¡£åå¥ Elasticsearch ä¸­ï¼å®ä¼æ ¹æ®å­æ®µçç±»åèªå¨è¯å«ï¼è¿ç§æºå¶ç§°ä¸ºå¨ææ å°ï¼èéææ å°åæ¯åå¥æ°æ®ä¹åå¯¹å­æ®µçå±æ§è¿è¡æå·¥è®¾ç½®ã\n\n\n# éææ å°\n\nES å®æ¹å°éææ å°ç§°ä¸ºæ¾å¼æ å°ï¼Explicit mappingï¼ãéææ å°æ¯å¨åå»ºç´¢å¼æ¶æ¾ç¤ºçæå®ç´¢å¼æ å°ãéææ å°å SQL ä¸­å¨å»ºè¡¨è¯­å¥ä¸­æå®å­æ®µå±æ§ç±»ä¼¼ãç¸æ¯å¨ææ å°ï¼éè¿éææ å°å¯ä»¥æ·»å æ´è¯¦ç»ãæ´ç²¾åçéç½®ä¿¡æ¯ãä¾å¦ï¼\n\n * åªäºå­ç¬¦ä¸²å­æ®µåºè¢«è§ä¸ºå¨æå­æ®µã\n * åªäºå­æ®µåå«æ°å­ãæ¥ææå°çä½ç½®ã\n * æ¥æå¼çæ ¼å¼ã\n * ç¨äºæ§å¶å¨ææ·»å å­æ®µçèªå®ä¹è§åã\n\nãç¤ºä¾ãåå»ºç´¢å¼æ¶ï¼æ¾ç¤ºæå® mapping\n\nPUT /my-index-000001\n{\n  "mappings": {\n    "properties": {\n      "age":    { "type": "integer" },\n      "email":  { "type": "keyword"  },\n      "name":   { "type": "text"  }\n    }\n  }\n}\n\n\nãç¤ºä¾ãå¨å·²å­å¨çç´¢å¼ä¸­ï¼æå®ä¸ä¸ª field çå±æ§\n\nPUT /my-index-000001/_mapping\n{\n  "properties": {\n    "employee-id": {\n      "type": "keyword",\n      "index": false\n    }\n  }\n}\n\n\nãç¤ºä¾ãæ¥ç mapping\n\nGET /my-index-000001/_mapping\n\n\nãç¤ºä¾ãæ¥çæå® field ç mapping\n\nGET /my-index-000001/_mapping/field/employee-id\n\n\n\n# å¨ææ å°\n\nå¨ææ å°æºå¶ï¼åè®¸ç¨æ·ä¸æå¨å®ä¹æ å°ï¼Elasticsearch ä¼èªå¨è¯å«å­æ®µç±»åãå¨å®éé¡¹ç®ä¸­ï¼å¦æéå°çä¸å¡å¨å¯¼å¥æ°æ®ä¹åä¸ç¡®å®æåªäºå­æ®µï¼ä¹ä¸æ¸æ¥å­æ®µçç±»åæ¯ä»ä¹ï¼ä½¿ç¨å¨ææ å°éå¸¸åéãå½ Elasticsearch å¨ææ¡£ä¸­ç¢°å°ä¸ä¸ªä»¥åæ²¡è§è¿çå­æ®µæ¶ï¼å®ä¼å©ç¨å¨ææ å°æ¥å³å®è¯¥å­æ®µçç±»åï¼å¹¶èªå¨æè¯¥å­æ®µæ·»å å°æ å°ä¸­ã\n\nç¤ºä¾ï¼åå»ºä¸ä¸ªåä¸º data çç´¢å¼ãå¶ mapping ç±»åä¸º _docï¼å¹¶ä¸æä¸ä¸ªç±»åä¸º long çå­æ®µ countã\n\nPUT data/_doc/1\n{ "count": 5 }\n\n\n# å¨æå­æ®µæ å°\n\nå¨æå­æ®µæ å°ï¼Dynamic field mappingsï¼æ¯ç¨äºç®¡çå¨æå­æ®µæ£æµçè§åãå½ Elasticsearch å¨ææ¡£ä¸­æ£æµå°æ°å­æ®µæ¶ï¼é»è®¤æåµä¸ä¼å¨æå°è¯¥å­æ®µæ·»å å°ç±»åæ å°ä¸­ã\n\nå¨ mapping ä¸­å¯ä»¥éè¿å° dynamic åæ°è®¾ç½®ä¸º true æ runtime æ¥å¼å¯å¨ææ å°ã\n\ndynamic ä¸åè®¾ç½®çä½ç¨ï¼\n\nå¯éå¼       è¯´æ\ntrue      æ°å­æ®µè¢«æ·»å å° mapping ä¸­ãmapping çé»è®¤è®¾ç½®ã\nruntime   æ°å­æ®µè¢«æ·»å å° mapping ä¸­å¹¶ä½ä¸ºè¿è¡æ¶å­æ®µââè¿äºå­æ®µä¸ä¼è¢«ç´¢å¼ï¼ä½æ¯å¯ä»¥å¨æ¥è¯¢æ¶åºç°å¨ _source ä¸­ã\nfalse     æ°å­æ®µä¸ä¼è¢«ç´¢å¼ææç´¢ï¼ä½ä»ä¼åºç°å¨è¿åå¹éç _source\n          å­æ®µä¸­ãè¿äºå­æ®µä¸ä¼æ·»å å°æ å°ä¸­ï¼å¹¶ä¸å¿é¡»æ¾å¼æ·»å æ°å­æ®µã\nstrict    å¦ææ£æµå°æ°å­æ®µï¼åä¼æåºå¼å¸¸å¹¶æç»ææ¡£ãå¿é¡»å°æ°å­æ®µæ¾å¼æ·»å å°æ å°ä¸­ã\n\n> éè¦æ³¨æçæ¯ï¼å¯¹å·²æå­æ®µï¼ä¸æ¦å·²ç»ææ°æ®åå¥ï¼å°±ä¸åæ¯æä¿®æ¹å­æ®µå®ä¹ãå¦æå¸ææ¹åå­æ®µç±»åï¼å¿é¡»éå»ºç´¢å¼ãè¿æ¯ç±äº Lucene å®ç°çåæç´¢å¼ï¼ä¸æ¦çæåï¼å°±ä¸åè®¸ä¿®æ¹ãå¦æä¿®æ¹äºå­æ®µçæ°æ®ç±»åï¼ä¼å¯¼è´å·²è¢«ç´¢å¼çå­æ®µæ æ³è¢«æç´¢ã\n\nå¯ç¨å¨æå­æ®µæ å°åï¼Elasticsearch ä½¿ç¨åç½®è§åæ¥ç¡®å®å¦ä½æ å°æ¯ä¸ªå­æ®µçæ°æ®ç±»åãè§åå¦ä¸ï¼\n\nJSON æ°æ®ç±»å       "DYNAMIC":"TRUE"                "DYNAMIC":"RUNTIME"\nnull            æ²¡æå­æ®µè¢«æ·»å                          æ²¡æå­æ®µè¢«æ·»å \ntrue or false   boolean ç±»å                      boolean ç±»å\næµ®ç¹åæ°å­           float ç±»å                        double ç±»å\næ°å­              æ°å­å                             long ç±»å\nJSON å¯¹è±¡         object ç±»å                       æ²¡æå­æ®µè¢«æ·»å \næ°ç»              ç±æ°ç»ä¸­ç¬¬ä¸ä¸ªéç©ºå¼å³å®                    ç±æ°ç»ä¸­ç¬¬ä¸ä¸ªéç©ºå¼å³å®\nå¼å¯æ¥ææ£æµçå­ç¬¦ä¸²      date ç±»å                         date ç±»å\nå¼å¯æ°å­æ£æµçå­ç¬¦ä¸²      float ç±»åæ longç±»å                double ç±»åæ long ç±»å\nä»ä¹ä¹æ²¡å¼å¯çå­ç¬¦ä¸²      å¸¦æ .keyword å­ field ç text ç±»å   keyword ç±»å\n\nä¸é¢ä¸¾ä¸ä¸ªä¾å­è®¤è¯å¨æ mappingï¼å¨ Elasticsearch ä¸­åå»ºä¸ä¸ªæ°çç´¢å¼å¹¶æ¥çå®ç mappingï¼å½ä»¤å¦ä¸ï¼\n\nPUT books\nGET books/_mapping\n\n\næ­¤æ¶ books ç´¢å¼ç mapping æ¯ç©ºçï¼è¿åç»æå¦ä¸ï¼\n\n{\n  "books": {\n    "mappings": {}\n  }\n}\n\n\nåå¾ books ç´¢å¼ä¸­åå¥ä¸æ¡ææ¡£ï¼å½ä»¤å¦ä¸ï¼\n\nPUT books/it/1\n{\n\t"id": 1,\n\t"publish_date": "2019-11-10",\n\t"name": "master Elasticsearch"\n}\n\n\nææ¡£åå¥å®æä¹åï¼åæ¬¡æ¥ç mappingï¼è¿åç»æå¦ä¸ï¼\n\n{\n  "books": {\n    "mappings": {\n      "properties": {\n        "id": {\n          "type": "long"\n        },\n        "name": {\n          "type": "text",\n          "fields": {\n            "keyword": {\n              "type": "keyword",\n              "ignore_above": 256\n            }\n          }\n        },\n        "publish_date": {\n          "type": "date"\n        }\n      }\n    }\n  }\n}\n\n\nå¨ææ å°ææ¶å¯è½ä¼éè¯¯çè¯å«å­æ®µç±»åï¼è¿ç§æåµä¸ï¼å¯è½ä¼å¯¼è´ä¸äºåè½æ æ³æ­£å¸¸ä½¿ç¨ï¼å¦ Range æ¥è¯¢ãæä»¥ï¼ä½¿ç¨å¨æ mapping è¦ç»åå®éä¸å¡éæ±æ¥ç»¼åèèï¼å¦æå° Elasticsearch å½ä½ä¸»è¦çæ°æ®å­å¨ä½¿ç¨ï¼å¹¶ä¸å¸æåºç°æªç¥å­æ®µæ¶æåºå¼å¸¸æ¥æéä½ æ³¨æè¿ä¸é®é¢ï¼é£ä¹å¼å¯å¨æ mapping å¹¶ä¸éç¨ã\n\n# å¨ææ¨¡æ¿\n\n**å¨ææ¨¡æ¿ï¼dynamic templatesï¼**æ¯ç¨äºç» mapping å¨ææ·»å å­æ®µçèªå®ä¹è§åã\n\nå¨ææ¨¡æ¿å¯ä»¥è®¾ç½®å¹éæ¡ä»¶ï¼åªæå¹éçæåµä¸æä½¿ç¨å¨ææ¨¡æ¿ï¼\n\n * match_mapping_type å¯¹ Elasticsearch æ£æµå°çæ°æ®ç±»åè¿è¡æä½\n * match å unmatch ä½¿ç¨æ¨¡å¼å¹éå­æ®µåç§°\n * path_match å path_unmatch å¯¹å­æ®µçå®æ´èçº¿è·¯å¾è¿è¡æä½\n * å¦æå¨ææ¨¡æ¿æ²¡æå®ä¹ match_mapping_typeãmatch æ path_matchï¼åä¸ä¼å¹éä»»ä½å­æ®µãæ¨ä»ç¶å¯ä»¥å¨æ¹éè¯·æ±ç dynamic_templates é¨åæåç§°å¼ç¨æ¨¡æ¿ã\n\nãç¤ºä¾ãå½è®¾ç½® \'dynamic\':\'true\' æ¶ï¼Elasticsearch ä¼å°å­ç¬¦ä¸²å­æ®µæ å°ä¸ºå¸¦æå³é®å­å­å­æ®µçææ¬å­æ®µãå¦æåªæ¯ç´¢å¼ç»æååå®¹å¹¶ä¸å¯¹å¨ææç´¢ä¸æå´è¶£ï¼å¯ä»¥è®© Elasticsearch ä»å°å­æ®µæ å°ä¸ºå³é®å­å­æ®µãè¿ç§æåµä¸ï¼åªæå®å¨å¹éæè½æç´¢å°è¿äºå­æ®µã\n\nPUT my-index-000001\n{\n  "mappings": {\n    "dynamic_templates": [\n      {\n        "strings_as_keywords": {\n          "match_mapping_type": "string",\n          "mapping": {\n            "type": "keyword"\n          }\n        }\n      }\n    ]\n  }\n}\n\n\n\n# è¿è¡æ¶å­æ®µ\n\nè¿è¡æ¶å­æ®µæ¯å¨æ¥è¯¢æ¶è¯ä¼°çå­æ®µãè¿è¡æ¶å­æ®µæä»¥ä¸ä½ç¨ï¼\n\n * å¨ä¸éæ°ç´¢å¼æ°æ®çæåµä¸ï¼åç°æææ¡£æ·»å å­æ®µ\n * å¨ä¸äºè§£æ°æ®ç»æçæåµä¸ï¼ä¹å¯ä»¥å¤çæ°æ®\n * å¨æ¥è¯¢æ¶è¦çä»ç´¢å¼å­æ®µè¿åçå¼\n * ä¸ºç¹å®ç¨éå®ä¹å­æ®µèä¸ä¿®æ¹åºå±æ¶æ\n\næ£ç´¢ Elasticsearch æ¶ï¼è¿è¡æ¶å­æ®µåå¶ä»å­æ®µå¹¶æ²¡æä»ä¹ä¸åã\n\néè¦æ³¨æçæ¯ï¼ä½¿ç¨ _search API ä¸ç fields åæ°æ¥æ£ç´¢è¿è¡æ¶å­æ®µçå¼ãè¿è¡æ¶å­æ®µä¸ä¼æ¾ç¤ºå¨ _source ä¸­ï¼ä½ fields API éç¨äºææå­æ®µï¼å³ä½¿æ¯é£äºæªä½ä¸ºåå§ _source çä¸é¨ååéçå­æ®µã\n\nè¿è¡æ¶å­æ®µå¨å¤çæ¥å¿æ°æ®æ¶å¾æç¨ï¼å°¤å¶æ¯å½æ¥å¿æ¯ä¸ç¡®å®çæ°æ®ç»ææ¶ï¼è¿ç§æåµä¸ï¼ä¼éä½æç´¢éåº¦ï¼ä½æ¨çç´¢å¼å¤§å°è¦å°å¾å¤ï¼æ¨å¯ä»¥æ´å¿«å°å¤çæ¥å¿ï¼èæ éä¸ºå®ä»¬è®¾ç½®ç´¢å¼ã\n\n\n# è¿è¡æ¶å­æ®µçä¼ç¹\n\nå ä¸ºè¿è¡æ¶å­æ®µæ²¡æè¢«ç´¢å¼ï¼æä»¥æ·»å è¿è¡æ¶å­æ®µä¸ä¼å¢å ç´¢å¼å¤§å°ãç¨æ·å¯ä»¥ç´æ¥å¨ mapping ä¸­å®ä¹è¿è¡æ¶å­æ®µï¼ä»èèçå­å¨ææ¬å¹¶æé«ééæ°æ®çéåº¦ãå®ä¹äºè¿è¡æ¶å­æ®µåï¼å¯ä»¥ç«å³å¨æç´¢è¯·æ±ãèåãè¿æ»¤åæåºä¸­ä½¿ç¨å®ã\n\nå¦æå°è¿è¡æ¶å­æ®µè®¾ä¸ºç´¢å¼å­æ®µï¼åæ éä¿®æ¹ä»»ä½å¼ç¨è¿è¡æ¶å­æ®µçæ¥è¯¢ãæ´å¥½çæ¯ï¼æ¨å¯ä»¥å¼ç¨å­æ®µæ¯è¿è¡æ¶å­æ®µçä¸äºç´¢å¼ï¼ä»¥åå­æ®µæ¯ç´¢å¼å­æ®µçå¶ä»ç´¢å¼ãæ¨å¯ä»¥çµæ´»å°éæ©è¦ç´¢å¼åªäºå­æ®µä»¥åä¿çåªäºå­æ®µä½ä¸ºè¿è¡æ¶å­æ®µã\n\nå°±å¶æ ¸å¿èè¨ï¼è¿è¡æ¶å­æ®µæéè¦çå¥½å¤æ¯è½å¤å¨æ¨æåå­æ®µåå°å­æ®µæ·»å å°ææ¡£ä¸­ãæ­¤åè½ç®åäºæ å°å³ç­ï¼å ä¸ºæ¨ä¸å¿é¢åå³å®å¦ä½è§£ææ°æ®ï¼å¹¶ä¸å¯ä»¥ä½¿ç¨è¿è¡æ¶å­æ®µéæ¶ä¿®æ¹æ å°ãä½¿ç¨è¿è¡æ¶å­æ®µåè®¸æ´å°çç´¢å¼åæ´å¿«çæåæ¶é´ï¼è¿ç»åä½¿ç¨æ´å°çèµæºå¹¶éä½æ¨çè¿è¥ææ¬ã\n\n\n# å­æ®µæ°æ®ç±»å\n\nå¨ Elasticsearch ä¸­ï¼æ¯ä¸ªå­æ®µé½æä¸ä¸ªå­æ®µæ°æ®ç±»åæå­æ®µç±»åï¼ç¨äºæç¤ºå­æ®µåå«çæ°æ®ç±»åï¼ä¾å¦å­ç¬¦ä¸²æå¸å°å¼ï¼åå¶é¢æç¨éãå­æ®µç±»åæç³»ååç»ãåä¸æä¸­çç±»åå·æå®å¨ç¸åçæç´¢è¡ä¸ºï¼ä½å¯è½å·æä¸åçç©ºé´ä½¿ç¨ææ§è½ç¹å¾ã\n\nElasticsearch æä¾äºéå¸¸ä¸°å¯çæ°æ®ç±»åï¼å®æ¹å°å¶åä¸ºä»¥ä¸å ç±»ï¼\n\n * æ®éç±»å\n   \n   * binaryï¼ç¼ç ä¸º Base64 å­ç¬¦ä¸²çäºè¿å¶å¼ã\n   * booleanï¼å¸å°ç±»åï¼å¼ä¸º true æ falseã\n   * Keywordsï¼keyword æç±»åï¼åæ¬ keywordãconstant_keyword å wildcardã\n   * Numbersï¼æ°å­ç±»åï¼å¦ long å double\n   * Datesï¼æ¥æç±»åï¼åæ¬ date å date_nanosã\n   * aliasï¼ç¨äºå®ä¹å­å¨å­æ®µçå«åã\n\n * å¯¹è±¡ç±»å\n   \n   * objectï¼JSON å¯¹è±¡\n   * flattenedï¼æ´ä¸ª JSON å¯¹è±¡ä½ä¸ºåä¸ªå­æ®µå¼ã\n   * nestedï¼ä¿çå¶å­å­æ®µä¹é´å³ç³»ç JSON å¯¹è±¡ã\n   * joinï¼ä¸ºåä¸ç´¢å¼ä¸­çææ¡£å®ä¹ç¶/å­å³ç³»ã\n\n * ç»æåæ°æ®ç±»å\n   \n   * Rangeï¼èå´ç±»åï¼ä¾å¦ï¼long_rangeãdouble_rangeãdate_range å ip_rangeã\n   * ipï¼IPv4 å IPv6 å°åã\n   * versionï¼çæ¬å·ãæ¯æ Semantic Versioning ä¼åè§åã\n   * murmur3ï¼è®¡ç®å¹¶å­å¨ hash å¼ã\n\n * èåæ°æ®ç±»å\n   \n   * aggregate_metric_doubleï¼é¢åèåçææ å¼\n   * histogramï¼ç´æ¹å¾å¼çé¢èåæ°å¼ã\n\n * ææ¬æç´¢ç±»å\n   \n   * text fieldsï¼text æç±»åï¼åæ¬ text å match_only_textã\n   * annotated-textï¼åå«ç¹æ®æ è®°çææ¬ãç¨äºè¯å«å½åå®ä½ã\n   * completionï¼ç¨äºèªå¨è¡¥å¨ã\n   * search_as_you_typeï¼é®å¥æ¶å®æçç±»ä¼¼ææ¬çç±»åã\n   * token_countï¼ææ¬ä¸­æ è®°çè®¡æ°ã\n\n * ææ¡£æåç±»å\n   \n   * dense_vectorï¼è®°å½æµ®ç¹æ°çå¯éåéã\n   * rank_featureï¼è®°å½ä¸ä¸ªæ°å­ç¹å¾ï¼ä¸ºäºå¨æ¥è¯¢æ¶æé«å½ä¸­çã\n   * rank_featuresï¼è®°å½å¤ä¸ªæ°å­ç¹å¾ï¼ä¸ºäºå¨æ¥è¯¢æ¶æé«å½ä¸­çã\n\n * ç©ºé´æ°æ®ç±»å\n   \n   * geo_pointï¼å°çç»çº¬åº¦\n   * geo_shapeï¼å¤æçå½¢ç¶ï¼ä¾å¦å¤è¾¹å½¢\n   * pointï¼ä»»æç¬å¡å°ç¹\n   * shapeï¼ä»»æç¬å¡å°å ä½å½¢ç¶\n\n * å¶ä»ç±»å\n   \n   * percolatorï¼ä½¿ç¨ Query DSL ç¼åçç´¢å¼æ¥è¯¢\n\n\n# åæ°æ®å­æ®µ\n\nä¸ä¸ªææ¡£ä¸­ï¼ä¸ä»ä»åå«æ°æ® ï¼ä¹åå«åæ°æ®ãåæ°æ®æ¯ç¨äºæè¿°ææ¡£çä¿¡æ¯ã\n\n * æ è¯åæ°æ®å­æ®µ\n   * _indexï¼ææ¡£æå±çç´¢å¼ã\n   * _idï¼ææ¡£ç IDã\n * ææ¡£ source åæ°æ®å­æ®µ\n   * _sourceï¼ææ¡£æ­£æçåå§ JSONã\n   * _sizeï¼_source å­æ®µçå¤§å°ï¼ä»¥å­èä¸ºåä½ï¼ï¼ç± mapper-size æä»¶æä¾ã\n * ææ¡£è®¡æ°åæ°æ®å­æ®µ\n   * _doc_countï¼å½ææ¡£è¡¨ç¤ºé¢èåæ°æ®æ¶ï¼ç¨äºå­å¨ææ¡£è®¡æ°çèªå®ä¹å­æ®µã\n * ç´¢å¼åæ°æ®å­æ®µ\n   * _field_namesï¼ææ¡£ä¸­çææéç©ºå­æ®µã\n   * _ignoredï¼ææ¡£ä¸­ææçç±äº ignore_malformed èå¨ç´¢å¼æ¶è¢«å¿½ç¥çå­æ®µã\n * è·¯ç±åæ°æ®å­æ®µ\n   * _routingï¼å°ææ¡£è·¯ç±å°ç¹å®åççèªå®ä¹è·¯ç±å¼ã\n * å¶ä»åæ°æ®å­æ®µ\n   * _metaï¼åºç¨ç¨åºç¹å®çåæ°æ®ã\n   * _tierï¼ææ¡£æå±ç´¢å¼çå½åæ°æ®å±é¦éé¡¹ã\n\n\n# æ å°åæ°\n\nElasticsearch æä¾äºä»¥ä¸æ å°åæ°ï¼\n\n * analyzerï¼æå®å¨ç´¢å¼ææç´¢ææ¬å­æ®µæ¶ç¨äºææ¬åæçåæå¨ã\n * coerceï¼å¦æå¼å¯ï¼Elasticsearch å°å°è¯æ¸çèæ°æ®ä»¥éåºå­æ®µçæ°æ®ç±»åã\n * copy_toï¼åè®¸å°å¤ä¸ªå­æ®µçå¼å¤å¶å°ä¸ä¸ªç»å­æ®µä¸­ï¼ç¶åå¯ä»¥å°å¶ä½ä¸ºåä¸ªå­æ®µè¿è¡æ¥è¯¢ã\n * doc_valuesï¼é»è®¤æåµä¸ï¼ææå­æ®µé½æ¯è¢«\n * dynamicï¼æ¯å¦å¼å¯å¨ææ å°ã\n * eager_global_ordinalsï¼å½å¨ global ordinals çæ¶åï¼refresh ä»¥åä¸ä¸æ¬¡æ¥è¯¢å­å¸å°±éè¦éæ°æå»ºï¼å¨è¿½æ±æ¥è¯¢çåºæ¯ä¸å¾å½±åæ¥è¯¢æ§è½ãå¯ä»¥ä½¿ç¨ eager_global_ordinalsï¼å³å¨æ¯æ¬¡ refresh ä»¥åå³å¯æ´æ°å­å¸ï¼å­å¸å¸¸é©»åå­ï¼åå°äºæ¥è¯¢çæ¶åæå»ºå­å¸çèæ¶ã\n * enabledï¼åªè½åºç¨äºé¡¶çº§ mapping å®ä¹å object å­æ®µãè®¾ç½®ä¸º false åï¼Elasticsearch è§£ææ¶ï¼ä¼å®å¨è·³è¿è¯¥å­æ®µã\n * fielddataï¼é»è®¤æåµä¸ï¼ text å­æ®µæ¯å¯æç´¢çï¼ä½ä¸å¯ç¨äºèåãæåºæèæ¬ãå¦æä¸ºå­æ®µè®¾ç½® fielddata=trueï¼å°±ä¼éè¿åè½¬åæç´¢å¼å° fielddata å è½½å°åå­ä¸­ãè¯·æ³¨æï¼è¿å¯è½ä¼å ç¨å¤§éåå­ãå¦ææ³å¯¹ text å­æ®µè¿è¡èåãæåºæèæ¬æä½ï¼fielddata æ¯å¯ä¸æ¹æ³ã\n * fieldsï¼ææ¶åï¼åä¸ä¸ªå­æ®µéè¦ä»¥ä¸åç®çè¿è¡ç´¢å¼ï¼æ­¤æ¶å¯ä»¥éè¿ fields è¿è¡éç½®ã\n * formatï¼ç¨äºæ ¼å¼åæ¥æç±»åã\n * ignore_aboveï¼å­ç¬¦ä¸²é¿åº¦å¤§äº ignore_above æè®¾ï¼åä¸ä¼è¢«ç´¢å¼æå­å¨ã\n * ignore_malformedï¼ææ¶åï¼åä¸ä¸ªå­æ®µï¼å¯è½ä¼å­å¨ä¸åçæ°æ®ç±»åãé»è®¤æåµä¸ï¼Elasticsearch è§£æå­æ®µæ°æ®ç±»åå¤±è´¥æ¶ï¼ä¼å¼åå¼å¸¸ï¼å¹¶æç»æ´ä¸ªææ¡£ã å¦æè®¾ç½® ignore_malformed ä¸º trueï¼ååè®¸å¿½ç¥å¼å¸¸ãè¿ç§æåµä¸ï¼æ ¼å¼éè¯¯çå­æ®µä¸ä¼è¢«ç´¢å¼ï¼ä½ææ¡£ä¸­çå¶ä»å­æ®µå¯ä»¥æ­£å¸¸å¤çã\n * index_options ç¨äºæ§å¶å°åªäºä¿¡æ¯æ·»å å°åæç´¢å¼ä»¥è¿è¡æç´¢åçªåºæ¾ç¤ºãåªæ text å keyword ç­åºäºæ¯è¯­ï¼termï¼çå­æ®µç±»åæ¯ææ­¤éç½®ã\n * index_phrasesï¼å¦æå¯ç¨ï¼ä¸¤ä¸ªè¯çç»åï¼shinglesï¼å°è¢«ç´¢å¼å°ä¸ä¸ªåç¬çå­æ®µä¸­ãè¿åè®¸ä»¥æ´å¤§çç´¢å¼ä¸ºä»£ä»·ï¼æ´ææå°è¿è¡ç²¾ç¡®çç­è¯­æ¥è¯¢ï¼æ  slopï¼ãè¯·æ³¨æï¼å½åç¨è¯æªè¢«å é¤æ¶ï¼æ­¤æ¹æ³æææä½³ï¼å ä¸ºåå«åç¨è¯çç­è¯­å°ä¸ä½¿ç¨è¾å©å­æ®µï¼å¹¶å°åéå°æ åç­è¯­æ¥è¯¢ãæ¥åçæåï¼é»è®¤ï¼ã\n * index_prefixesï¼index_prefixes åæ°å¯ç¨ term åç¼ç´¢å¼ä»¥å å¿«åç¼æç´¢ã\n * indexï¼index éé¡¹æ§å¶å­æ®µå¼æ¯å¦è¢«ç´¢å¼ãé»è®¤ä¸º trueã\n * metaï¼éå å°å­æ®µçåæ°æ®ãæ­¤åæ°æ®å¯¹ Elasticsearch æ¯ä¸éæçï¼å®ä»éç¨äºå¤ä¸ªåºç¨å±äº«ç¸åç´¢å¼çåæ°æ®ä¿¡æ¯ï¼ä¾å¦ï¼åä½ã\n * normalizerï¼keyword å­æ®µç normalizer å±æ§ç±»ä¼¼äº analyzer ï¼åªæ¯å®ä¿è¯åæé¾åªäº§çåä¸ªæ è®°ã normalizer å¨ç´¢å¼ keyword ä¹ååºç¨ï¼ä»¥åå¨æç´¢æ¶éè¿æ¥è¯¢è§£æå¨ï¼ä¾å¦å¹éæ¥è¯¢ï¼æéè¿æ¯è¯­çº§å«æ¥è¯¢ï¼ä¾å¦æ¯è¯­æ¥è¯¢ï¼æç´¢å³é®å­å­æ®µæ¶åºç¨ã\n * normsï¼norms å­å¨å¨æ¥è¯¢æ¶ä½¿ç¨çåç§è§èåå å­ï¼ä»¥ä¾¿è®¡ç®ææ¡£çç¸å³æ§è¯åã\n * null_valueï¼null å¼æ æ³è¢«ç´¢å¼åæç´¢ãå½ä¸ä¸ªå­æ®µè¢«è®¾ä¸º nullï¼åè¢«è§ä¸ºæ²¡æå¼ãnull_value åè®¸å°ç©ºå¼æ¿æ¢ä¸ºæå®å¼ï¼ä»¥ä¾¿å¯¹å¶è¿è¡ç´¢å¼åæç´¢ã\n * position_increment_gapï¼åæçææ¬å­æ®µä¼èèæ¯è¯­ä½ç½®ï¼ä»¥ä¾¿è½å¤æ¯æé»è¿æç­è¯­æ¥è¯¢ãå½ç´¢å¼å·æå¤ä¸ªå¼çææ¬å­æ®µæ¶ï¼å¼ä¹é´ä¼æ·»å ä¸ä¸ªâåâé´éï¼ä»¥é²æ­¢å¤§å¤æ°ç­è¯­æ¥è¯¢å¨å¼ä¹é´å¹éãæ­¤é´éçå¤§å°ä½¿ç¨ position_increment_gap éç½®ï¼é»è®¤ä¸º 100ã\n * propertiesï¼ç±»åæ å°ãå¯¹è±¡å­æ®µååµå¥å­æ®µåå«çå­å­æ®µï¼é½ç§°ä¸ºå±æ§ãè¿äºå±æ§å¯ä»¥æ¯ä»»ä½æ°æ®ç±»åï¼åæ¬å¯¹è±¡ååµå¥ã\n * search_analyzerï¼éå¸¸ï¼å¨ç´¢å¼æ¶åæç´¢æ¶åºä½¿ç¨ç¸åçåæå¨ï¼ä»¥ç¡®ä¿æ¥è¯¢ä¸­çæ¯è¯­ä¸åæç´¢å¼ä¸­çæ¯è¯­æ ¼å¼ç¸åãä½æ¯ï¼ææ¶å¨æç´¢æ¶ä½¿ç¨ä¸åçåæå¨å¯è½æ¯ææä¹çï¼ä¾å¦ä½¿ç¨ edge_ngram æ è®°å¨å®ç°èªå¨è¡¥å¨æä½¿ç¨åä¹è¯æç´¢æ¶ã\n * similarityï¼Elasticsearch åè®¸ä¸ºæ¯ä¸ªå­æ®µéç½®ææ¬è¯åç®æ³æç¸ä¼¼åº¦ãç¸ä¼¼åº¦è®¾ç½®æä¾äºä¸ç§éæ©ææ¬ç¸ä¼¼åº¦ç®æ³çç®åæ¹æ³ï¼èä¸æ¯é»è®¤ç BM25ï¼ä¾å¦å¸å°å¼ãåªæ text å keyword ç­åºäºææ¬çå­æ®µç±»åæ¯ææ­¤éç½®ã\n * storeï¼é»è®¤æåµä¸ï¼å¯¹å­æ®µå¼è¿è¡ç´¢å¼ä»¥ä½¿å¶å¯æç´¢ï¼ä½ä¸ä¼å­å¨å®ä»¬ãè¿æå³çå¯ä»¥æ¥è¯¢è¯¥å­æ®µï¼ä½æ æ³æ£ç´¢åå§å­æ®µå¼ãéå¸¸è¿ä¸éè¦ï¼å­æ®µå¼å·²ç»æ¯é»è®¤å­å¨ç _source å­æ®µçä¸é¨åãå¦ææ¨åªæ³æ£ç´¢åä¸ªå­æ®µæå ä¸ªå­æ®µçå¼ï¼èä¸æ¯æ´ä¸ª _sourceï¼åå¯ä»¥éè¿ source filtering æ¥å®ç°ã\n * term_vectorï¼term_vector åå«æå³åæè¿ç¨äº§ççæ¯è¯­çä¿¡æ¯ï¼åæ¬ï¼\n   * æ¯è¯­åè¡¨\n   * æ¯ä¸ª term çä½ç½®ï¼æé¡ºåºï¼\n   * èµ·å§åç»æå­ç¬¦åç§»éï¼ç¨äºå° term ååå§å­ç¬¦ä¸²è¿è¡æ å°\n   * ææè´è½½ï¼å¦æå¯ç¨ï¼ - ç¨æ·å®ä¹çï¼ä¸ term ä½ç½®ç¸å³çäºè¿å¶æ°æ®\n\n\n# æ å°éç½®\n\n * index.mapping.total_fields.limitï¼ç´¢å¼ä¸­çæå¤§å­æ®µæ°ãå­æ®µåå¯¹è±¡æ å°ä»¥åå­æ®µå«åè®¡å¥æ­¤éå¶ãé»è®¤å¼ä¸º 1000ã\n * index.mapping.depth.limitï¼å­æ®µçæå¤§æ·±åº¦ï¼ä»¥åé¨å¯¹è±¡çæ°éæ¥è¡¡éãä¾å¦ï¼å¦æææå­æ®µé½å¨æ ¹å¯¹è±¡çº§å«å®ä¹ï¼åæ·±åº¦ä¸º 1ãå¦ææä¸ä¸ªå¯¹è±¡æ å°ï¼åæ·±åº¦ä¸º 2ï¼ä»¥æ­¤ç±»æ¨ãé»è®¤å¼ä¸º 20ã\n * index.mapping.nested_fields.limitï¼ç´¢å¼ä¸­ä¸å nested æ å°çæå¤§æ°éã nested ç±»ååªåºå¨ç¹æ®æåµä¸ä½¿ç¨ï¼å³éè¦ç¸äºç¬ç«å°æ¥è¯¢å¯¹è±¡æ°ç»ãä¸ºäºé²æ­¢è®¾è®¡ä¸ä½³çæ å°ï¼æ­¤è®¾ç½®éå¶äºæ¯ä¸ªç´¢å¼çå¯ä¸ nested ç±»åçæ°éãé»è®¤å¼ä¸º 50ã\n * index.mapping.nested_objects.limitï¼åä¸ªææ¡£ä¸­ï¼ææ nested ç±»åä¸­åå«çæå¤§åµå¥ JSON å¯¹è±¡æ°ãå½ææ¡£åå«å¤ªå¤ nested å¯¹è±¡æ¶ï¼æ­¤éå¶æå©äºé²æ­¢åºç°åå­æº¢åºãé»è®¤å¼ä¸º 10000ã\n * index.mapping.field_name_length.limitï¼è®¾ç½®å­æ®µåç§°çæå¤§é¿åº¦ãé»è®¤ä¸º Long.MAX_VALUEï¼æ éå¶ï¼ã\n\n\n# åèèµæ\n\n * Elasticsearch å®æ¹ææ¡£ä¹ Mapping',normalizedContent:'# elasticsearch æ å°\n\nå¨ elasticsearch ä¸­ï¼mappingï¼æ å°ï¼ï¼ç¨æ¥å®ä¹ä¸ä¸ªææ¡£ä»¥åå¶æåå«çå­æ®µå¦ä½è¢«å­å¨åç´¢å¼ï¼å¯ä»¥å¨æ å°ä¸­äºåå®ä¹å­æ®µçæ°æ®ç±»åãå­æ®µçæéãåè¯å¨ç­å±æ§ï¼å°±å¦åå¨å³ç³»åæ°æ®åºä¸­åå»ºæ°æ®è¡¨æ¶ä¼è®¾ç½®å­æ®µçç±»åã\n\nmapping ä¼æ json ææ¡£æ å°æ lucene æéè¦çæå¹³æ ¼å¼\n\nä¸ä¸ª mapping å±äºä¸ä¸ªç´¢å¼ç type\n\n * æ¯ä¸ªææ¡£é½å±äºä¸ä¸ª type\n * ä¸ä¸ª type æä¸ä¸ª mapping å®ä¹\n * 7.0 å¼å§ï¼ä¸éè¦å¨ mapping å®ä¹ä¸­æå® type ä¿¡æ¯\n\næ¯ä¸ª document é½æ¯ field çéåï¼æ¯ä¸ª field é½æèªå·±çæ°æ®ç±»åãæ å°æ°æ®æ¶ï¼å¯ä»¥åå»ºä¸ä¸ª mappingï¼å¶ä¸­åå«ä¸ document ç¸å³ç field åè¡¨ãæ å°å®ä¹è¿åæ¬åæ°æ® fieldï¼ä¾å¦ _source ï¼å®èªå®ä¹å¦ä½å¤ç document çå³èåæ°æ®ã\n\n\n# æ å°æ¹å¼\n\nå¨ elasticsearch ä¸­ï¼æ å°å¯åä¸ºéææ å°åå¨ææ å°ãå¨å³ç³»åæ°æ®åºä¸­åå¥æ°æ®ä¹åé¦åè¦å»ºè¡¨ï¼å¨å»ºè¡¨è¯­å¥ä¸­å£°æå­æ®µçå±æ§ï¼å¨ elasticsearch ä¸­ï¼åä¸å¿å¦æ­¤ï¼elasticsearch æéè¦çåè½ä¹ä¸å°±æ¯è®©ä½ å°½å¯è½å¿«å°å¼å§æ¢ç´¢æ°æ®ï¼ææ¡£åå¥ elasticsearch ä¸­ï¼å®ä¼æ ¹æ®å­æ®µçç±»åèªå¨è¯å«ï¼è¿ç§æºå¶ç§°ä¸ºå¨ææ å°ï¼èéææ å°åæ¯åå¥æ°æ®ä¹åå¯¹å­æ®µçå±æ§è¿è¡æå·¥è®¾ç½®ã\n\n\n# éææ å°\n\nes å®æ¹å°éææ å°ç§°ä¸ºæ¾å¼æ å°ï¼explicit mappingï¼ãéææ å°æ¯å¨åå»ºç´¢å¼æ¶æ¾ç¤ºçæå®ç´¢å¼æ å°ãéææ å°å sql ä¸­å¨å»ºè¡¨è¯­å¥ä¸­æå®å­æ®µå±æ§ç±»ä¼¼ãç¸æ¯å¨ææ å°ï¼éè¿éææ å°å¯ä»¥æ·»å æ´è¯¦ç»ãæ´ç²¾åçéç½®ä¿¡æ¯ãä¾å¦ï¼\n\n * åªäºå­ç¬¦ä¸²å­æ®µåºè¢«è§ä¸ºå¨æå­æ®µã\n * åªäºå­æ®µåå«æ°å­ãæ¥ææå°çä½ç½®ã\n * æ¥æå¼çæ ¼å¼ã\n * ç¨äºæ§å¶å¨ææ·»å å­æ®µçèªå®ä¹è§åã\n\nãç¤ºä¾ãåå»ºç´¢å¼æ¶ï¼æ¾ç¤ºæå® mapping\n\nput /my-index-000001\n{\n  "mappings": {\n    "properties": {\n      "age":    { "type": "integer" },\n      "email":  { "type": "keyword"  },\n      "name":   { "type": "text"  }\n    }\n  }\n}\n\n\nãç¤ºä¾ãå¨å·²å­å¨çç´¢å¼ä¸­ï¼æå®ä¸ä¸ª field çå±æ§\n\nput /my-index-000001/_mapping\n{\n  "properties": {\n    "employee-id": {\n      "type": "keyword",\n      "index": false\n    }\n  }\n}\n\n\nãç¤ºä¾ãæ¥ç mapping\n\nget /my-index-000001/_mapping\n\n\nãç¤ºä¾ãæ¥çæå® field ç mapping\n\nget /my-index-000001/_mapping/field/employee-id\n\n\n\n# å¨ææ å°\n\nå¨ææ å°æºå¶ï¼åè®¸ç¨æ·ä¸æå¨å®ä¹æ å°ï¼elasticsearch ä¼èªå¨è¯å«å­æ®µç±»åãå¨å®éé¡¹ç®ä¸­ï¼å¦æéå°çä¸å¡å¨å¯¼å¥æ°æ®ä¹åä¸ç¡®å®æåªäºå­æ®µï¼ä¹ä¸æ¸æ¥å­æ®µçç±»åæ¯ä»ä¹ï¼ä½¿ç¨å¨ææ å°éå¸¸åéãå½ elasticsearch å¨ææ¡£ä¸­ç¢°å°ä¸ä¸ªä»¥åæ²¡è§è¿çå­æ®µæ¶ï¼å®ä¼å©ç¨å¨ææ å°æ¥å³å®è¯¥å­æ®µçç±»åï¼å¹¶èªå¨æè¯¥å­æ®µæ·»å å°æ å°ä¸­ã\n\nç¤ºä¾ï¼åå»ºä¸ä¸ªåä¸º data çç´¢å¼ãå¶ mapping ç±»åä¸º _docï¼å¹¶ä¸æä¸ä¸ªç±»åä¸º long çå­æ®µ countã\n\nput data/_doc/1\n{ "count": 5 }\n\n\n# å¨æå­æ®µæ å°\n\nå¨æå­æ®µæ å°ï¼dynamic field mappingsï¼æ¯ç¨äºç®¡çå¨æå­æ®µæ£æµçè§åãå½ elasticsearch å¨ææ¡£ä¸­æ£æµå°æ°å­æ®µæ¶ï¼é»è®¤æåµä¸ä¼å¨æå°è¯¥å­æ®µæ·»å å°ç±»åæ å°ä¸­ã\n\nå¨ mapping ä¸­å¯ä»¥éè¿å° dynamic åæ°è®¾ç½®ä¸º true æ runtime æ¥å¼å¯å¨ææ å°ã\n\ndynamic ä¸åè®¾ç½®çä½ç¨ï¼\n\nå¯éå¼       è¯´æ\ntrue      æ°å­æ®µè¢«æ·»å å° mapping ä¸­ãmapping çé»è®¤è®¾ç½®ã\nruntime   æ°å­æ®µè¢«æ·»å å° mapping ä¸­å¹¶ä½ä¸ºè¿è¡æ¶å­æ®µââè¿äºå­æ®µä¸ä¼è¢«ç´¢å¼ï¼ä½æ¯å¯ä»¥å¨æ¥è¯¢æ¶åºç°å¨ _source ä¸­ã\nfalse     æ°å­æ®µä¸ä¼è¢«ç´¢å¼ææç´¢ï¼ä½ä»ä¼åºç°å¨è¿åå¹éç _source\n          å­æ®µä¸­ãè¿äºå­æ®µä¸ä¼æ·»å å°æ å°ä¸­ï¼å¹¶ä¸å¿é¡»æ¾å¼æ·»å æ°å­æ®µã\nstrict    å¦ææ£æµå°æ°å­æ®µï¼åä¼æåºå¼å¸¸å¹¶æç»ææ¡£ãå¿é¡»å°æ°å­æ®µæ¾å¼æ·»å å°æ å°ä¸­ã\n\n> éè¦æ³¨æçæ¯ï¼å¯¹å·²æå­æ®µï¼ä¸æ¦å·²ç»ææ°æ®åå¥ï¼å°±ä¸åæ¯æä¿®æ¹å­æ®µå®ä¹ãå¦æå¸ææ¹åå­æ®µç±»åï¼å¿é¡»éå»ºç´¢å¼ãè¿æ¯ç±äº lucene å®ç°çåæç´¢å¼ï¼ä¸æ¦çæåï¼å°±ä¸åè®¸ä¿®æ¹ãå¦æä¿®æ¹äºå­æ®µçæ°æ®ç±»åï¼ä¼å¯¼è´å·²è¢«ç´¢å¼çå­æ®µæ æ³è¢«æç´¢ã\n\nå¯ç¨å¨æå­æ®µæ å°åï¼elasticsearch ä½¿ç¨åç½®è§åæ¥ç¡®å®å¦ä½æ å°æ¯ä¸ªå­æ®µçæ°æ®ç±»åãè§åå¦ä¸ï¼\n\njson æ°æ®ç±»å       "dynamic":"true"                "dynamic":"runtime"\nnull            æ²¡æå­æ®µè¢«æ·»å                          æ²¡æå­æ®µè¢«æ·»å \ntrue or false   boolean ç±»å                      boolean ç±»å\næµ®ç¹åæ°å­           float ç±»å                        double ç±»å\næ°å­              æ°å­å                             long ç±»å\njson å¯¹è±¡         object ç±»å                       æ²¡æå­æ®µè¢«æ·»å \næ°ç»              ç±æ°ç»ä¸­ç¬¬ä¸ä¸ªéç©ºå¼å³å®                    ç±æ°ç»ä¸­ç¬¬ä¸ä¸ªéç©ºå¼å³å®\nå¼å¯æ¥ææ£æµçå­ç¬¦ä¸²      date ç±»å                         date ç±»å\nå¼å¯æ°å­æ£æµçå­ç¬¦ä¸²      float ç±»åæ longç±»å                double ç±»åæ long ç±»å\nä»ä¹ä¹æ²¡å¼å¯çå­ç¬¦ä¸²      å¸¦æ .keyword å­ field ç text ç±»å   keyword ç±»å\n\nä¸é¢ä¸¾ä¸ä¸ªä¾å­è®¤è¯å¨æ mappingï¼å¨ elasticsearch ä¸­åå»ºä¸ä¸ªæ°çç´¢å¼å¹¶æ¥çå®ç mappingï¼å½ä»¤å¦ä¸ï¼\n\nput books\nget books/_mapping\n\n\næ­¤æ¶ books ç´¢å¼ç mapping æ¯ç©ºçï¼è¿åç»æå¦ä¸ï¼\n\n{\n  "books": {\n    "mappings": {}\n  }\n}\n\n\nåå¾ books ç´¢å¼ä¸­åå¥ä¸æ¡ææ¡£ï¼å½ä»¤å¦ä¸ï¼\n\nput books/it/1\n{\n\t"id": 1,\n\t"publish_date": "2019-11-10",\n\t"name": "master elasticsearch"\n}\n\n\nææ¡£åå¥å®æä¹åï¼åæ¬¡æ¥ç mappingï¼è¿åç»æå¦ä¸ï¼\n\n{\n  "books": {\n    "mappings": {\n      "properties": {\n        "id": {\n          "type": "long"\n        },\n        "name": {\n          "type": "text",\n          "fields": {\n            "keyword": {\n              "type": "keyword",\n              "ignore_above": 256\n            }\n          }\n        },\n        "publish_date": {\n          "type": "date"\n        }\n      }\n    }\n  }\n}\n\n\nå¨ææ å°ææ¶å¯è½ä¼éè¯¯çè¯å«å­æ®µç±»åï¼è¿ç§æåµä¸ï¼å¯è½ä¼å¯¼è´ä¸äºåè½æ æ³æ­£å¸¸ä½¿ç¨ï¼å¦ range æ¥è¯¢ãæä»¥ï¼ä½¿ç¨å¨æ mapping è¦ç»åå®éä¸å¡éæ±æ¥ç»¼åèèï¼å¦æå° elasticsearch å½ä½ä¸»è¦çæ°æ®å­å¨ä½¿ç¨ï¼å¹¶ä¸å¸æåºç°æªç¥å­æ®µæ¶æåºå¼å¸¸æ¥æéä½ æ³¨æè¿ä¸é®é¢ï¼é£ä¹å¼å¯å¨æ mapping å¹¶ä¸éç¨ã\n\n# å¨ææ¨¡æ¿\n\n**å¨ææ¨¡æ¿ï¼dynamic templatesï¼**æ¯ç¨äºç» mapping å¨ææ·»å å­æ®µçèªå®ä¹è§åã\n\nå¨ææ¨¡æ¿å¯ä»¥è®¾ç½®å¹éæ¡ä»¶ï¼åªæå¹éçæåµä¸æä½¿ç¨å¨ææ¨¡æ¿ï¼\n\n * match_mapping_type å¯¹ elasticsearch æ£æµå°çæ°æ®ç±»åè¿è¡æä½\n * match å unmatch ä½¿ç¨æ¨¡å¼å¹éå­æ®µåç§°\n * path_match å path_unmatch å¯¹å­æ®µçå®æ´èçº¿è·¯å¾è¿è¡æä½\n * å¦æå¨ææ¨¡æ¿æ²¡æå®ä¹ match_mapping_typeãmatch æ path_matchï¼åä¸ä¼å¹éä»»ä½å­æ®µãæ¨ä»ç¶å¯ä»¥å¨æ¹éè¯·æ±ç dynamic_templates é¨åæåç§°å¼ç¨æ¨¡æ¿ã\n\nãç¤ºä¾ãå½è®¾ç½® \'dynamic\':\'true\' æ¶ï¼elasticsearch ä¼å°å­ç¬¦ä¸²å­æ®µæ å°ä¸ºå¸¦æå³é®å­å­å­æ®µçææ¬å­æ®µãå¦æåªæ¯ç´¢å¼ç»æååå®¹å¹¶ä¸å¯¹å¨ææç´¢ä¸æå´è¶£ï¼å¯ä»¥è®© elasticsearch ä»å°å­æ®µæ å°ä¸ºå³é®å­å­æ®µãè¿ç§æåµä¸ï¼åªæå®å¨å¹éæè½æç´¢å°è¿äºå­æ®µã\n\nput my-index-000001\n{\n  "mappings": {\n    "dynamic_templates": [\n      {\n        "strings_as_keywords": {\n          "match_mapping_type": "string",\n          "mapping": {\n            "type": "keyword"\n          }\n        }\n      }\n    ]\n  }\n}\n\n\n\n# è¿è¡æ¶å­æ®µ\n\nè¿è¡æ¶å­æ®µæ¯å¨æ¥è¯¢æ¶è¯ä¼°çå­æ®µãè¿è¡æ¶å­æ®µæä»¥ä¸ä½ç¨ï¼\n\n * å¨ä¸éæ°ç´¢å¼æ°æ®çæåµä¸ï¼åç°æææ¡£æ·»å å­æ®µ\n * å¨ä¸äºè§£æ°æ®ç»æçæåµä¸ï¼ä¹å¯ä»¥å¤çæ°æ®\n * å¨æ¥è¯¢æ¶è¦çä»ç´¢å¼å­æ®µè¿åçå¼\n * ä¸ºç¹å®ç¨éå®ä¹å­æ®µèä¸ä¿®æ¹åºå±æ¶æ\n\næ£ç´¢ elasticsearch æ¶ï¼è¿è¡æ¶å­æ®µåå¶ä»å­æ®µå¹¶æ²¡æä»ä¹ä¸åã\n\néè¦æ³¨æçæ¯ï¼ä½¿ç¨ _search api ä¸ç fields åæ°æ¥æ£ç´¢è¿è¡æ¶å­æ®µçå¼ãè¿è¡æ¶å­æ®µä¸ä¼æ¾ç¤ºå¨ _source ä¸­ï¼ä½ fields api éç¨äºææå­æ®µï¼å³ä½¿æ¯é£äºæªä½ä¸ºåå§ _source çä¸é¨ååéçå­æ®µã\n\nè¿è¡æ¶å­æ®µå¨å¤çæ¥å¿æ°æ®æ¶å¾æç¨ï¼å°¤å¶æ¯å½æ¥å¿æ¯ä¸ç¡®å®çæ°æ®ç»ææ¶ï¼è¿ç§æåµä¸ï¼ä¼éä½æç´¢éåº¦ï¼ä½æ¨çç´¢å¼å¤§å°è¦å°å¾å¤ï¼æ¨å¯ä»¥æ´å¿«å°å¤çæ¥å¿ï¼èæ éä¸ºå®ä»¬è®¾ç½®ç´¢å¼ã\n\n\n# è¿è¡æ¶å­æ®µçä¼ç¹\n\nå ä¸ºè¿è¡æ¶å­æ®µæ²¡æè¢«ç´¢å¼ï¼æä»¥æ·»å è¿è¡æ¶å­æ®µä¸ä¼å¢å ç´¢å¼å¤§å°ãç¨æ·å¯ä»¥ç´æ¥å¨ mapping ä¸­å®ä¹è¿è¡æ¶å­æ®µï¼ä»èèçå­å¨ææ¬å¹¶æé«ééæ°æ®çéåº¦ãå®ä¹äºè¿è¡æ¶å­æ®µåï¼å¯ä»¥ç«å³å¨æç´¢è¯·æ±ãèåãè¿æ»¤åæåºä¸­ä½¿ç¨å®ã\n\nå¦æå°è¿è¡æ¶å­æ®µè®¾ä¸ºç´¢å¼å­æ®µï¼åæ éä¿®æ¹ä»»ä½å¼ç¨è¿è¡æ¶å­æ®µçæ¥è¯¢ãæ´å¥½çæ¯ï¼æ¨å¯ä»¥å¼ç¨å­æ®µæ¯è¿è¡æ¶å­æ®µçä¸äºç´¢å¼ï¼ä»¥åå­æ®µæ¯ç´¢å¼å­æ®µçå¶ä»ç´¢å¼ãæ¨å¯ä»¥çµæ´»å°éæ©è¦ç´¢å¼åªäºå­æ®µä»¥åä¿çåªäºå­æ®µä½ä¸ºè¿è¡æ¶å­æ®µã\n\nå°±å¶æ ¸å¿èè¨ï¼è¿è¡æ¶å­æ®µæéè¦çå¥½å¤æ¯è½å¤å¨æ¨æåå­æ®µåå°å­æ®µæ·»å å°ææ¡£ä¸­ãæ­¤åè½ç®åäºæ å°å³ç­ï¼å ä¸ºæ¨ä¸å¿é¢åå³å®å¦ä½è§£ææ°æ®ï¼å¹¶ä¸å¯ä»¥ä½¿ç¨è¿è¡æ¶å­æ®µéæ¶ä¿®æ¹æ å°ãä½¿ç¨è¿è¡æ¶å­æ®µåè®¸æ´å°çç´¢å¼åæ´å¿«çæåæ¶é´ï¼è¿ç»åä½¿ç¨æ´å°çèµæºå¹¶éä½æ¨çè¿è¥ææ¬ã\n\n\n# å­æ®µæ°æ®ç±»å\n\nå¨ elasticsearch ä¸­ï¼æ¯ä¸ªå­æ®µé½æä¸ä¸ªå­æ®µæ°æ®ç±»åæå­æ®µç±»åï¼ç¨äºæç¤ºå­æ®µåå«çæ°æ®ç±»åï¼ä¾å¦å­ç¬¦ä¸²æå¸å°å¼ï¼åå¶é¢æç¨éãå­æ®µç±»åæç³»ååç»ãåä¸æä¸­çç±»åå·æå®å¨ç¸åçæç´¢è¡ä¸ºï¼ä½å¯è½å·æä¸åçç©ºé´ä½¿ç¨ææ§è½ç¹å¾ã\n\nelasticsearch æä¾äºéå¸¸ä¸°å¯çæ°æ®ç±»åï¼å®æ¹å°å¶åä¸ºä»¥ä¸å ç±»ï¼\n\n * æ®éç±»å\n   \n   * binaryï¼ç¼ç ä¸º base64 å­ç¬¦ä¸²çäºè¿å¶å¼ã\n   * booleanï¼å¸å°ç±»åï¼å¼ä¸º true æ falseã\n   * keywordsï¼keyword æç±»åï¼åæ¬ keywordãconstant_keyword å wildcardã\n   * numbersï¼æ°å­ç±»åï¼å¦ long å double\n   * datesï¼æ¥æç±»åï¼åæ¬ date å date_nanosã\n   * aliasï¼ç¨äºå®ä¹å­å¨å­æ®µçå«åã\n\n * å¯¹è±¡ç±»å\n   \n   * objectï¼json å¯¹è±¡\n   * flattenedï¼æ´ä¸ª json å¯¹è±¡ä½ä¸ºåä¸ªå­æ®µå¼ã\n   * nestedï¼ä¿çå¶å­å­æ®µä¹é´å³ç³»ç json å¯¹è±¡ã\n   * joinï¼ä¸ºåä¸ç´¢å¼ä¸­çææ¡£å®ä¹ç¶/å­å³ç³»ã\n\n * ç»æåæ°æ®ç±»å\n   \n   * rangeï¼èå´ç±»åï¼ä¾å¦ï¼long_rangeãdouble_rangeãdate_range å ip_rangeã\n   * ipï¼ipv4 å ipv6 å°åã\n   * versionï¼çæ¬å·ãæ¯æ semantic versioning ä¼åè§åã\n   * murmur3ï¼è®¡ç®å¹¶å­å¨ hash å¼ã\n\n * èåæ°æ®ç±»å\n   \n   * aggregate_metric_doubleï¼é¢åèåçææ å¼\n   * histogramï¼ç´æ¹å¾å¼çé¢èåæ°å¼ã\n\n * ææ¬æç´¢ç±»å\n   \n   * text fieldsï¼text æç±»åï¼åæ¬ text å match_only_textã\n   * annotated-textï¼åå«ç¹æ®æ è®°çææ¬ãç¨äºè¯å«å½åå®ä½ã\n   * completionï¼ç¨äºèªå¨è¡¥å¨ã\n   * search_as_you_typeï¼é®å¥æ¶å®æçç±»ä¼¼ææ¬çç±»åã\n   * token_countï¼ææ¬ä¸­æ è®°çè®¡æ°ã\n\n * ææ¡£æåç±»å\n   \n   * dense_vectorï¼è®°å½æµ®ç¹æ°çå¯éåéã\n   * rank_featureï¼è®°å½ä¸ä¸ªæ°å­ç¹å¾ï¼ä¸ºäºå¨æ¥è¯¢æ¶æé«å½ä¸­çã\n   * rank_featuresï¼è®°å½å¤ä¸ªæ°å­ç¹å¾ï¼ä¸ºäºå¨æ¥è¯¢æ¶æé«å½ä¸­çã\n\n * ç©ºé´æ°æ®ç±»å\n   \n   * geo_pointï¼å°çç»çº¬åº¦\n   * geo_shapeï¼å¤æçå½¢ç¶ï¼ä¾å¦å¤è¾¹å½¢\n   * pointï¼ä»»æç¬å¡å°ç¹\n   * shapeï¼ä»»æç¬å¡å°å ä½å½¢ç¶\n\n * å¶ä»ç±»å\n   \n   * percolatorï¼ä½¿ç¨ query dsl ç¼åçç´¢å¼æ¥è¯¢\n\n\n# åæ°æ®å­æ®µ\n\nä¸ä¸ªææ¡£ä¸­ï¼ä¸ä»ä»åå«æ°æ® ï¼ä¹åå«åæ°æ®ãåæ°æ®æ¯ç¨äºæè¿°ææ¡£çä¿¡æ¯ã\n\n * æ è¯åæ°æ®å­æ®µ\n   * _indexï¼ææ¡£æå±çç´¢å¼ã\n   * _idï¼ææ¡£ç idã\n * ææ¡£ source åæ°æ®å­æ®µ\n   * _sourceï¼ææ¡£æ­£æçåå§ jsonã\n   * _sizeï¼_source å­æ®µçå¤§å°ï¼ä»¥å­èä¸ºåä½ï¼ï¼ç± mapper-size æä»¶æä¾ã\n * ææ¡£è®¡æ°åæ°æ®å­æ®µ\n   * _doc_countï¼å½ææ¡£è¡¨ç¤ºé¢èåæ°æ®æ¶ï¼ç¨äºå­å¨ææ¡£è®¡æ°çèªå®ä¹å­æ®µã\n * ç´¢å¼åæ°æ®å­æ®µ\n   * _field_namesï¼ææ¡£ä¸­çææéç©ºå­æ®µã\n   * _ignoredï¼ææ¡£ä¸­ææçç±äº ignore_malformed èå¨ç´¢å¼æ¶è¢«å¿½ç¥çå­æ®µã\n * è·¯ç±åæ°æ®å­æ®µ\n   * _routingï¼å°ææ¡£è·¯ç±å°ç¹å®åççèªå®ä¹è·¯ç±å¼ã\n * å¶ä»åæ°æ®å­æ®µ\n   * _metaï¼åºç¨ç¨åºç¹å®çåæ°æ®ã\n   * _tierï¼ææ¡£æå±ç´¢å¼çå½åæ°æ®å±é¦éé¡¹ã\n\n\n# æ å°åæ°\n\nelasticsearch æä¾äºä»¥ä¸æ å°åæ°ï¼\n\n * analyzerï¼æå®å¨ç´¢å¼ææç´¢ææ¬å­æ®µæ¶ç¨äºææ¬åæçåæå¨ã\n * coerceï¼å¦æå¼å¯ï¼elasticsearch å°å°è¯æ¸çèæ°æ®ä»¥éåºå­æ®µçæ°æ®ç±»åã\n * copy_toï¼åè®¸å°å¤ä¸ªå­æ®µçå¼å¤å¶å°ä¸ä¸ªç»å­æ®µä¸­ï¼ç¶åå¯ä»¥å°å¶ä½ä¸ºåä¸ªå­æ®µè¿è¡æ¥è¯¢ã\n * doc_valuesï¼é»è®¤æåµä¸ï¼ææå­æ®µé½æ¯è¢«\n * dynamicï¼æ¯å¦å¼å¯å¨ææ å°ã\n * eager_global_ordinalsï¼å½å¨ global ordinals çæ¶åï¼refresh ä»¥åä¸ä¸æ¬¡æ¥è¯¢å­å¸å°±éè¦éæ°æå»ºï¼å¨è¿½æ±æ¥è¯¢çåºæ¯ä¸å¾å½±åæ¥è¯¢æ§è½ãå¯ä»¥ä½¿ç¨ eager_global_ordinalsï¼å³å¨æ¯æ¬¡ refresh ä»¥åå³å¯æ´æ°å­å¸ï¼å­å¸å¸¸é©»åå­ï¼åå°äºæ¥è¯¢çæ¶åæå»ºå­å¸çèæ¶ã\n * enabledï¼åªè½åºç¨äºé¡¶çº§ mapping å®ä¹å object å­æ®µãè®¾ç½®ä¸º false åï¼elasticsearch è§£ææ¶ï¼ä¼å®å¨è·³è¿è¯¥å­æ®µã\n * fielddataï¼é»è®¤æåµä¸ï¼ text å­æ®µæ¯å¯æç´¢çï¼ä½ä¸å¯ç¨äºèåãæåºæèæ¬ãå¦æä¸ºå­æ®µè®¾ç½® fielddata=trueï¼å°±ä¼éè¿åè½¬åæç´¢å¼å° fielddata å è½½å°åå­ä¸­ãè¯·æ³¨æï¼è¿å¯è½ä¼å ç¨å¤§éåå­ãå¦ææ³å¯¹ text å­æ®µè¿è¡èåãæåºæèæ¬æä½ï¼fielddata æ¯å¯ä¸æ¹æ³ã\n * fieldsï¼ææ¶åï¼åä¸ä¸ªå­æ®µéè¦ä»¥ä¸åç®çè¿è¡ç´¢å¼ï¼æ­¤æ¶å¯ä»¥éè¿ fields è¿è¡éç½®ã\n * formatï¼ç¨äºæ ¼å¼åæ¥æç±»åã\n * ignore_aboveï¼å­ç¬¦ä¸²é¿åº¦å¤§äº ignore_above æè®¾ï¼åä¸ä¼è¢«ç´¢å¼æå­å¨ã\n * ignore_malformedï¼ææ¶åï¼åä¸ä¸ªå­æ®µï¼å¯è½ä¼å­å¨ä¸åçæ°æ®ç±»åãé»è®¤æåµä¸ï¼elasticsearch è§£æå­æ®µæ°æ®ç±»åå¤±è´¥æ¶ï¼ä¼å¼åå¼å¸¸ï¼å¹¶æç»æ´ä¸ªææ¡£ã å¦æè®¾ç½® ignore_malformed ä¸º trueï¼ååè®¸å¿½ç¥å¼å¸¸ãè¿ç§æåµä¸ï¼æ ¼å¼éè¯¯çå­æ®µä¸ä¼è¢«ç´¢å¼ï¼ä½ææ¡£ä¸­çå¶ä»å­æ®µå¯ä»¥æ­£å¸¸å¤çã\n * index_options ç¨äºæ§å¶å°åªäºä¿¡æ¯æ·»å å°åæç´¢å¼ä»¥è¿è¡æç´¢åçªåºæ¾ç¤ºãåªæ text å keyword ç­åºäºæ¯è¯­ï¼termï¼çå­æ®µç±»åæ¯ææ­¤éç½®ã\n * index_phrasesï¼å¦æå¯ç¨ï¼ä¸¤ä¸ªè¯çç»åï¼shinglesï¼å°è¢«ç´¢å¼å°ä¸ä¸ªåç¬çå­æ®µä¸­ãè¿åè®¸ä»¥æ´å¤§çç´¢å¼ä¸ºä»£ä»·ï¼æ´ææå°è¿è¡ç²¾ç¡®çç­è¯­æ¥è¯¢ï¼æ  slopï¼ãè¯·æ³¨æï¼å½åç¨è¯æªè¢«å é¤æ¶ï¼æ­¤æ¹æ³æææä½³ï¼å ä¸ºåå«åç¨è¯çç­è¯­å°ä¸ä½¿ç¨è¾å©å­æ®µï¼å¹¶å°åéå°æ åç­è¯­æ¥è¯¢ãæ¥åçæåï¼é»è®¤ï¼ã\n * index_prefixesï¼index_prefixes åæ°å¯ç¨ term åç¼ç´¢å¼ä»¥å å¿«åç¼æç´¢ã\n * indexï¼index éé¡¹æ§å¶å­æ®µå¼æ¯å¦è¢«ç´¢å¼ãé»è®¤ä¸º trueã\n * metaï¼éå å°å­æ®µçåæ°æ®ãæ­¤åæ°æ®å¯¹ elasticsearch æ¯ä¸éæçï¼å®ä»éç¨äºå¤ä¸ªåºç¨å±äº«ç¸åç´¢å¼çåæ°æ®ä¿¡æ¯ï¼ä¾å¦ï¼åä½ã\n * normalizerï¼keyword å­æ®µç normalizer å±æ§ç±»ä¼¼äº analyzer ï¼åªæ¯å®ä¿è¯åæé¾åªäº§çåä¸ªæ è®°ã normalizer å¨ç´¢å¼ keyword ä¹ååºç¨ï¼ä»¥åå¨æç´¢æ¶éè¿æ¥è¯¢è§£æå¨ï¼ä¾å¦å¹éæ¥è¯¢ï¼æéè¿æ¯è¯­çº§å«æ¥è¯¢ï¼ä¾å¦æ¯è¯­æ¥è¯¢ï¼æç´¢å³é®å­å­æ®µæ¶åºç¨ã\n * normsï¼norms å­å¨å¨æ¥è¯¢æ¶ä½¿ç¨çåç§è§èåå å­ï¼ä»¥ä¾¿è®¡ç®ææ¡£çç¸å³æ§è¯åã\n * null_valueï¼null å¼æ æ³è¢«ç´¢å¼åæç´¢ãå½ä¸ä¸ªå­æ®µè¢«è®¾ä¸º nullï¼åè¢«è§ä¸ºæ²¡æå¼ãnull_value åè®¸å°ç©ºå¼æ¿æ¢ä¸ºæå®å¼ï¼ä»¥ä¾¿å¯¹å¶è¿è¡ç´¢å¼åæç´¢ã\n * position_increment_gapï¼åæçææ¬å­æ®µä¼èèæ¯è¯­ä½ç½®ï¼ä»¥ä¾¿è½å¤æ¯æé»è¿æç­è¯­æ¥è¯¢ãå½ç´¢å¼å·æå¤ä¸ªå¼çææ¬å­æ®µæ¶ï¼å¼ä¹é´ä¼æ·»å ä¸ä¸ªâåâé´éï¼ä»¥é²æ­¢å¤§å¤æ°ç­è¯­æ¥è¯¢å¨å¼ä¹é´å¹éãæ­¤é´éçå¤§å°ä½¿ç¨ position_increment_gap éç½®ï¼é»è®¤ä¸º 100ã\n * propertiesï¼ç±»åæ å°ãå¯¹è±¡å­æ®µååµå¥å­æ®µåå«çå­å­æ®µï¼é½ç§°ä¸ºå±æ§ãè¿äºå±æ§å¯ä»¥æ¯ä»»ä½æ°æ®ç±»åï¼åæ¬å¯¹è±¡ååµå¥ã\n * search_analyzerï¼éå¸¸ï¼å¨ç´¢å¼æ¶åæç´¢æ¶åºä½¿ç¨ç¸åçåæå¨ï¼ä»¥ç¡®ä¿æ¥è¯¢ä¸­çæ¯è¯­ä¸åæç´¢å¼ä¸­çæ¯è¯­æ ¼å¼ç¸åãä½æ¯ï¼ææ¶å¨æç´¢æ¶ä½¿ç¨ä¸åçåæå¨å¯è½æ¯ææä¹çï¼ä¾å¦ä½¿ç¨ edge_ngram æ è®°å¨å®ç°èªå¨è¡¥å¨æä½¿ç¨åä¹è¯æç´¢æ¶ã\n * similarityï¼elasticsearch åè®¸ä¸ºæ¯ä¸ªå­æ®µéç½®ææ¬è¯åç®æ³æç¸ä¼¼åº¦ãç¸ä¼¼åº¦è®¾ç½®æä¾äºä¸ç§éæ©ææ¬ç¸ä¼¼åº¦ç®æ³çç®åæ¹æ³ï¼èä¸æ¯é»è®¤ç bm25ï¼ä¾å¦å¸å°å¼ãåªæ text å keyword ç­åºäºææ¬çå­æ®µç±»åæ¯ææ­¤éç½®ã\n * storeï¼é»è®¤æåµä¸ï¼å¯¹å­æ®µå¼è¿è¡ç´¢å¼ä»¥ä½¿å¶å¯æç´¢ï¼ä½ä¸ä¼å­å¨å®ä»¬ãè¿æå³çå¯ä»¥æ¥è¯¢è¯¥å­æ®µï¼ä½æ æ³æ£ç´¢åå§å­æ®µå¼ãéå¸¸è¿ä¸éè¦ï¼å­æ®µå¼å·²ç»æ¯é»è®¤å­å¨ç _source å­æ®µçä¸é¨åãå¦ææ¨åªæ³æ£ç´¢åä¸ªå­æ®µæå ä¸ªå­æ®µçå¼ï¼èä¸æ¯æ´ä¸ª _sourceï¼åå¯ä»¥éè¿ source filtering æ¥å®ç°ã\n * term_vectorï¼term_vector åå«æå³åæè¿ç¨äº§ççæ¯è¯­çä¿¡æ¯ï¼åæ¬ï¼\n   * æ¯è¯­åè¡¨\n   * æ¯ä¸ª term çä½ç½®ï¼æé¡ºåºï¼\n   * èµ·å§åç»æå­ç¬¦åç§»éï¼ç¨äºå° term ååå§å­ç¬¦ä¸²è¿è¡æ å°\n   * ææè´è½½ï¼å¦æå¯ç¨ï¼ - ç¨æ·å®ä¹çï¼ä¸ term ä½ç½®ç¸å³çäºè¿å¶æ°æ®\n\n\n# æ å°éç½®\n\n * index.mapping.total_fields.limitï¼ç´¢å¼ä¸­çæå¤§å­æ®µæ°ãå­æ®µåå¯¹è±¡æ å°ä»¥åå­æ®µå«åè®¡å¥æ­¤éå¶ãé»è®¤å¼ä¸º 1000ã\n * index.mapping.depth.limitï¼å­æ®µçæå¤§æ·±åº¦ï¼ä»¥åé¨å¯¹è±¡çæ°éæ¥è¡¡éãä¾å¦ï¼å¦æææå­æ®µé½å¨æ ¹å¯¹è±¡çº§å«å®ä¹ï¼åæ·±åº¦ä¸º 1ãå¦ææä¸ä¸ªå¯¹è±¡æ å°ï¼åæ·±åº¦ä¸º 2ï¼ä»¥æ­¤ç±»æ¨ãé»è®¤å¼ä¸º 20ã\n * index.mapping.nested_fields.limitï¼ç´¢å¼ä¸­ä¸å nested æ å°çæå¤§æ°éã nested ç±»ååªåºå¨ç¹æ®æåµä¸ä½¿ç¨ï¼å³éè¦ç¸äºç¬ç«å°æ¥è¯¢å¯¹è±¡æ°ç»ãä¸ºäºé²æ­¢è®¾è®¡ä¸ä½³çæ å°ï¼æ­¤è®¾ç½®éå¶äºæ¯ä¸ªç´¢å¼çå¯ä¸ nested ç±»åçæ°éãé»è®¤å¼ä¸º 50ã\n * index.mapping.nested_objects.limitï¼åä¸ªææ¡£ä¸­ï¼ææ nested ç±»åä¸­åå«çæå¤§åµå¥ json å¯¹è±¡æ°ãå½ææ¡£åå«å¤ªå¤ nested å¯¹è±¡æ¶ï¼æ­¤éå¶æå©äºé²æ­¢åºç°åå­æº¢åºãé»è®¤å¼ä¸º 10000ã\n * index.mapping.field_name_length.limitï¼è®¾ç½®å­æ®µåç§°çæå¤§é¿åº¦ãé»è®¤ä¸º long.max_valueï¼æ éå¶ï¼ã\n\n\n# åèèµæ\n\n * elasticsearch å®æ¹ææ¡£ä¹ mapping',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Elasticsearch ç´¢å¼",frontmatter:{title:"Elasticsearch ç´¢å¼",date:"2022-02-22T21:01:01.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","ç´¢å¼"],permalink:"/pages/293175/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/04.Elasticsearch%E7%B4%A2%E5%BC%95.html",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/04.Elasticsearchç´¢å¼.md",key:"v-0f15ab6e",path:"/pages/293175/",headers:[{level:2,title:"ç´¢å¼ç®¡çæä½",slug:"ç´¢å¼ç®¡çæä½",normalizedTitle:"ç´¢å¼ç®¡çæä½",charIndex:23},{level:3,title:"ç´¢å¼å é¤",slug:"ç´¢å¼å é¤",normalizedTitle:"ç´¢å¼å é¤",charIndex:99},{level:3,title:"ç´¢å¼å«å",slug:"ç´¢å¼å«å",normalizedTitle:"ç´¢å¼å«å",charIndex:82},{level:2,title:"Settings è¯¦è§£",slug:"settings-è¯¦è§£",normalizedTitle:"settings è¯¦è§£",charIndex:996},{level:3,title:"åºå®å±æ§",slug:"åºå®å±æ§",normalizedTitle:"åºå®å±æ§",charIndex:2731},{level:3,title:"ç´¢å¼éæéç½®",slug:"ç´¢å¼éæéç½®",normalizedTitle:"ç´¢å¼éæéç½®",charIndex:2838},{level:3,title:"ç´¢å¼å¨æéç½®",slug:"ç´¢å¼å¨æéç½®",normalizedTitle:"ç´¢å¼å¨æéç½®",charIndex:3574},{level:2,title:"Mapping è¯¦è§£",slug:"mapping-è¯¦è§£",normalizedTitle:"mapping è¯¦è§£",charIndex:3788},{level:3,title:"æ å°åç±»",slug:"æ å°åç±»",normalizedTitle:"æ å°åç±»",charIndex:4064},{level:4,title:"éææ å°",slug:"éææ å°",normalizedTitle:"éææ å°",charIndex:4093},{level:4,title:"å¨ææ å°",slug:"å¨ææ å°",normalizedTitle:"å¨ææ å°",charIndex:4098},{level:3,title:"åºç¡ç±»å",slug:"åºç¡ç±»å",normalizedTitle:"åºç¡ç±»å",charIndex:5937},{level:3,title:"å¤æç±»å",slug:"å¤æç±»å",normalizedTitle:"å¤æç±»å",charIndex:6114},{level:3,title:"ç¹æ®ç±»å",slug:"ç¹æ®ç±»å",normalizedTitle:"ç¹æ®ç±»å",charIndex:6176},{level:3,title:"Mapping å±æ§",slug:"mapping-å±æ§",normalizedTitle:"mapping å±æ§",charIndex:6330},{level:2,title:"ç´¢å¼æ¥è¯¢",slug:"ç´¢å¼æ¥è¯¢",normalizedTitle:"ç´¢å¼æ¥è¯¢",charIndex:7561},{level:3,title:"å¤ä¸ª indexãå¤ä¸ª type æ¥è¯¢",slug:"å¤ä¸ª-indexãå¤ä¸ª-type-æ¥è¯¢",normalizedTitle:"å¤ä¸ª indexãå¤ä¸ª type æ¥è¯¢",charIndex:7570},{level:3,title:"URI æç´¢",slug:"uri-æç´¢",normalizedTitle:"uri æç´¢",charIndex:8028},{level:3,title:"æ¥è¯¢æµç¨",slug:"æ¥è¯¢æµç¨",normalizedTitle:"æ¥è¯¢æµç¨",charIndex:10336},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:10604}],headersStr:"ç´¢å¼ç®¡çæä½ ç´¢å¼å é¤ ç´¢å¼å«å Settings è¯¦è§£ åºå®å±æ§ ç´¢å¼éæéç½® ç´¢å¼å¨æéç½® Mapping è¯¦è§£ æ å°åç±» éææ å° å¨ææ å° åºç¡ç±»å å¤æç±»å ç¹æ®ç±»å Mapping å±æ§ ç´¢å¼æ¥è¯¢ å¤ä¸ª indexãå¤ä¸ª type æ¥è¯¢ URI æç´¢ æ¥è¯¢æµç¨ åèèµæ",content:'# Elasticsearch ç´¢å¼\n\n\n# ç´¢å¼ç®¡çæä½\n\nElasticsearch ç´¢å¼ç®¡çä¸»è¦åæ¬å¦ä½è¿è¡ç´¢å¼çåå»ºãç´¢å¼çå é¤ãå¯æ¬çæ´æ°ãç´¢å¼è¯»åæéãç´¢å¼å«åçéç½®ç­ç­åå®¹ã\n\n\n# ç´¢å¼å é¤\n\nES ç´¢å¼å é¤æä½å ES éç¾¤ç http æ¥å£åéæå®ç´¢å¼ç delete http è¯·æ±å³å¯ï¼å¯ä»¥éè¿ curl å½ä»¤ï¼å·ä½å¦ä¸ï¼\n\ncurl -X DELETE http://{es_host}:{es_http_port}/{index}\n\n\nå¦æå é¤æåï¼å®ä¼è¿åå¦ä¸ä¿¡æ¯ï¼å·ä½ç¤ºä¾å¦ä¸ï¼\n\ncurl -X DELETE http://10.10.10.66:9200/my_index?pretty\n\n\nä¸ºäºè¿åçä¿¡æ¯ä¾¿äºè¯»åï¼å¢å äº pretty åæ°ï¼\n\n{\n  "acknowledged" : true\n}\n\n\n\n# ç´¢å¼å«å\n\nES çç´¢å¼å«åå°±æ¯ç»ä¸ä¸ªç´¢å¼æèå¤ä¸ªç´¢å¼èµ·çå¦ä¸ä¸ªåå­ï¼å¸åçåºç¨åºæ¯æ¯éå¯¹ç´¢å¼ä½¿ç¨çå¹³æ»åæ¢ã\n\né¦åï¼åå»ºç´¢å¼ my_indexï¼ç¶åå°å«å my_alias æåå®ï¼ç¤ºä¾å¦ä¸ï¼\n\nPUT /my_index\nPUT /my_index/_alias/my_alias\n\n\nä¹å¯ä»¥éè¿å¦ä¸å½¢å¼ï¼\n\nPOST /_aliases\n{\n  "actions": [\n    { "add": { "index": "my_index", "alias": "my_alias" }}\n  ]\n}\n\n\nä¹å¯ä»¥å¨ä¸æ¬¡è¯·æ±ä¸­å¢å å«ååç§»é¤å«åæ··åä½¿ç¨ï¼\n\nPOST /_aliases\n{\n  "actions": [\n    { "remove": { "index": "my_index", "alias": "my_alias" }}\n    { "add": { "index": "my_index_v2", "alias": "my_alias" }}\n  ]\n}\n\n\n> éè¦æ³¨æçæ¯ï¼å¦æå«åä¸ç´¢å¼æ¯ä¸å¯¹ä¸çï¼ä½¿ç¨å«åç´¢å¼ææ¡£æèæ¥è¯¢ææ¡£æ¯å¯ä»¥çï¼ä½æ¯å¦æå«ååç´¢å¼æ¯ä¸å¯¹å¤çï¼ä½¿ç¨å«åä¼åçéè¯¯ï¼å ä¸º ES ä¸ç¥éæææ¡£åå¥åªä¸ªç´¢å¼ä¸­å»æèä»åªä¸ªç´¢å¼ä¸­è¯»åææ¡£ã\n\nES ç´¢å¼å«åæä¸ªå¸åçåºç¨åºæ¯æ¯å¹³æ»åæ¢ï¼æ´å¤ç»èå¯ä»¥æ¥ç Elasticsearchï¼ESï¼ç´¢å¼é¶åæºï¼æ ééå¯ï¼æ ç¼å¹³æ»åæ¢çæ¹æ³ã\n\n\n# Settings è¯¦è§£\n\nElasticsearch ç´¢å¼çéç½®é¡¹ä¸»è¦åä¸ºéæéç½®å±æ§åå¨æéç½®å±æ§ï¼éæéç½®å±æ§æ¯ç´¢å¼åå»ºåä¸è½ä¿®æ¹ï¼èå¨æéç½®å±æ§åå¯ä»¥éæ¶ä¿®æ¹ã\n\nES ç´¢å¼è®¾ç½®ç api ä¸º _settingsï¼å®æ´çç¤ºä¾å¦ä¸ï¼\n\nPUT /my_index\n{\n  "settings": {\n    "index": {\n      "number_of_shards": "1",\n      "number_of_replicas": "1",\n      "refresh_interval": "60s",\n      "analysis": {\n        "filter": {\n          "tsconvert": {\n            "type": "stconvert",\n            "convert_type": "t2s",\n            "delimiter": ","\n          },\n          "synonym": {\n            "type": "synonym",\n            "synonyms_path": "analysis/synonyms.txt"\n          }\n        },\n        "analyzer": {\n          "ik_max_word_synonym": {\n            "filter": [\n              "synonym",\n              "tsconvert",\n              "standard",\n              "lowercase",\n              "stop"\n            ],\n            "tokenizer": "ik_max_word"\n          },\n          "ik_smart_synonym": {\n            "filter": [\n              "synonym",\n              "standard",\n              "lowercase",\n              "stop"\n            ],\n            "tokenizer": "ik_smart"\n          }\n        },\n\t\t\t"mapping": {\n\t\t\t\t"coerce": "false",\n\t\t\t\t"ignore_malformed": "false"\n\t\t\t},\n\t\t\t"indexing": {\n\t\t\t\t"slowlog": {\n\t\t\t\t\t"threshold": {\n\t\t\t\t\t\t"index": {\n\t\t\t\t\t\t\t"warn": "2s",\n\t\t\t\t\t\t\t"info": "1s"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t"provided_name": "hospital_202101070533",\n\t\t\t"query": {\n\t\t\t\t"default_field": "timestamp",\n\t\t\t\t"parse": {\n\t\t\t\t\t"allow_unmapped_fields": "false"\n\t\t\t\t}\n\t\t\t},\n\t\t\t"requests": {\n\t\t\t\t"cache": {\n\t\t\t\t\t"enable": "true"\n\t\t\t\t}\n\t\t\t},\n\t\t\t"search": {\n\t\t\t\t"slowlog": {\n\t\t\t\t\t"threshold": {\n\t\t\t\t\t\t"fetch": {\n\t\t\t\t\t\t\t"warn": "1s",\n\t\t\t\t\t\t\t"info": "200ms"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t"query": {\n\t\t\t\t\t\t\t"warn": "1s",\n\t\t\t\t\t\t\t"info": "500ms"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# åºå®å±æ§\n\n * index.creation_dateï¼é¡¾åæä¹ç´¢å¼çåå»ºæ¶é´æ³ã\n * index.uuidï¼ç´¢å¼ç uuid ä¿¡æ¯ã\n * index.version.createdï¼ç´¢å¼ççæ¬å·ã\n\n\n# ç´¢å¼éæéç½®\n\n * index.number_of_shardsï¼ç´¢å¼çä¸»åçæ°ï¼é»è®¤å¼æ¯ 5ãè¿ä¸ªéç½®å¨ç´¢å¼åå»ºåä¸è½ä¿®æ¹ï¼å¨ es å±é¢ï¼å¯ä»¥éè¿ es.index.max_number_of_shards å±æ§è®¾ç½®ç´¢å¼æå¤§çåçæ°ï¼é»è®¤ä¸º 1024ã\n * index.codecï¼æ°æ®å­å¨çåç¼©ç®æ³ï¼é»è®¤å¼ä¸º LZ4ï¼å¯éæ©å¼è¿æ best_compressionï¼å®æ¯ LZ4 å¯ä»¥è·å¾æ´å¥½çåç¼©æ¯ï¼å³å æ®è¾å°çç£çç©ºé´ï¼ä½å­å¨æ§è½æ¯ LZ4 ä½ï¼ã\n * index.routing_partition_sizeï¼è·¯ç±ååºæ°ï¼å¦æè®¾ç½®äºè¯¥åæ°ï¼å¶è·¯ç±ç®æ³ä¸ºï¼( hash(_routing) + hash(_id) % index.routing_parttion_size ) % number_of_shardsãå¦æè¯¥å¼ä¸è®¾ç½®ï¼åè·¯ç±ç®æ³ä¸º hash(_routing) % number_of_shardingsï¼_routing é»è®¤å¼ä¸º _idã\n\néæéç½®éï¼æéè¦çé¨åæ¯éç½®åæå¨ï¼config analyzersï¼ã\n\n * index.analysis\n   \n   ï¼åæå¨æå¤å±çéç½®é¡¹ï¼åé¨ä¸»è¦åä¸º char_filterãtokenizerãfilter å analyzerã\n   \n   * char_filterï¼å®ä¹æ°çå­ç¬¦è¿æ»¤å¨ä»¶ã\n   * tokenizerï¼å®ä¹æ°çåè¯å¨ã\n   * filterï¼å®ä¹æ°ç token filterï¼å¦åä¹è¯ filterã\n   * analyzerï¼éç½®æ°çåæå¨ï¼ä¸è¬æ¯ char_filterãtokenizer åä¸äº token filter çç»åã\n\n\n# ç´¢å¼å¨æéç½®\n\n * index.number_of_replicasï¼ç´¢å¼ä¸»åççå¯æ¬æ°ï¼é»è®¤å¼æ¯ 1ï¼è¯¥å¼å¿é¡»å¤§äºç­äº 0ï¼è¿ä¸ªéç½®å¯ä»¥éæ¶ä¿®æ¹ã\n * index.refresh_intervalï¼æ§è¡æ°ç´¢å¼æ°æ®çå·æ°æä½é¢çï¼è¯¥æä½ä½¿å¯¹ç´¢å¼çææ°æ´æ¹å¯¹æç´¢å¯è§ï¼é»è®¤ä¸º 1sãä¹å¯ä»¥è®¾ç½®ä¸º -1 ä»¥ç¦ç¨å·æ°ãæ´è¯¦ç»ä¿¡æ¯åè Elasticsearch å¨æä¿®æ¹ refresh_interval å·æ°é´éè®¾ç½®ã\n\n\n# Mapping è¯¦è§£\n\nå¨ Elasticsearch ä¸­ï¼Mappingï¼æ å°ï¼ï¼ç¨æ¥å®ä¹ä¸ä¸ªææ¡£ä»¥åå¶æåå«çå­æ®µå¦ä½è¢«å­å¨åç´¢å¼ï¼å¯ä»¥å¨æ å°ä¸­äºåå®ä¹å­æ®µçæ°æ®ç±»åãå­æ®µçæéãåè¯å¨ç­å±æ§ï¼å°±å¦åå¨å³ç³»åæ°æ®åºä¸­åå»ºæ°æ®è¡¨æ¶ä¼è®¾ç½®å­æ®µçç±»åã\n\nMapping ä¼æ json ææ¡£æ å°æ Lucene æéè¦çæå¹³æ ¼å¼\n\nä¸ä¸ª Mapping å±äºä¸ä¸ªç´¢å¼ç Type\n\n * æ¯ä¸ªææ¡£é½å±äºä¸ä¸ª Type\n * ä¸ä¸ª Type æä¸ä¸ª Mapping å®ä¹\n * 7.0 å¼å§ï¼ä¸éè¦å¨ Mapping å®ä¹ä¸­æå® type ä¿¡æ¯\n\n\n# æ å°åç±»\n\nå¨ Elasticsearch ä¸­ï¼æ å°å¯åä¸ºéææ å°åå¨ææ å°ãå¨å³ç³»åæ°æ®åºä¸­åå¥æ°æ®ä¹åé¦åè¦å»ºè¡¨ï¼å¨å»ºè¡¨è¯­å¥ä¸­å£°æå­æ®µçå±æ§ï¼å¨ Elasticsearch ä¸­ï¼åä¸å¿å¦æ­¤ï¼Elasticsearch æéè¦çåè½ä¹ä¸å°±æ¯è®©ä½ å°½å¯è½å¿«å°å¼å§æ¢ç´¢æ°æ®ï¼ææ¡£åå¥ Elasticsearch ä¸­ï¼å®ä¼æ ¹æ®å­æ®µçç±»åèªå¨è¯å«ï¼è¿ç§æºå¶ç§°ä¸ºå¨ææ å°ï¼èéææ å°åæ¯åå¥æ°æ®ä¹åå¯¹å­æ®µçå±æ§è¿è¡æå·¥è®¾ç½®ã\n\n# éææ å°\n\néææ å°æ¯å¨åå»ºç´¢å¼æ¶æå·¥æå®ç´¢å¼æ å°ãéææ å°å SQL ä¸­å¨å»ºè¡¨è¯­å¥ä¸­æå®å­æ®µå±æ§ç±»ä¼¼ãç¸æ¯å¨ææ å°ï¼éè¿éææ å°å¯ä»¥æ·»å æ´è¯¦ç»ãæ´ç²¾åçéç½®ä¿¡æ¯ã\n\nå¦ä½å®ä¹ä¸ä¸ª Mapping\n\nPUT /books\n{\n    "mappings": {\n        "type_one": { ... any mappings ... },\n        "type_two": { ... any mappings ... },\n        ...\n    }\n}\n\n\n# å¨ææ å°\n\nå¨ææ å°æ¯ä¸ç§å·æçæ¹å¼ï¼å¯ç´æ¥åå»ºç´¢å¼å¹¶åå¥ææ¡£ï¼ææ¡£ä¸­å­æ®µçç±»åæ¯ Elasticsearch èªå¨è¯å«çï¼ä¸éè¦å¨åå»ºç´¢å¼çæ¶åè®¾ç½®å­æ®µçç±»åãå¨å®éé¡¹ç®ä¸­ï¼å¦æéå°çä¸å¡å¨å¯¼å¥æ°æ®ä¹åä¸ç¡®å®æåªäºå­æ®µï¼ä¹ä¸æ¸æ¥å­æ®µçç±»åæ¯ä»ä¹ï¼ä½¿ç¨å¨ææ å°éå¸¸åéãå½ Elasticsearch å¨ææ¡£ä¸­ç¢°å°ä¸ä¸ªä»¥åæ²¡è§è¿çå­æ®µæ¶ï¼å®ä¼å©ç¨å¨ææ å°æ¥å³å®è¯¥å­æ®µçç±»åï¼å¹¶èªå¨æè¯¥å­æ®µæ·»å å°æ å°ä¸­ï¼æ ¹æ®å­æ®µçåå¼èªå¨æ¨æµå­æ®µç±»åçè§åè§ä¸è¡¨ï¼\n\nJSON æ ¼å¼çæ°æ®      èªå¨æ¨æµçå­æ®µç±»å\nnull            æ²¡æå­æ®µè¢«æ·»å \ntrue or false   boolean ç±»å\næµ®ç¹ç±»åæ°å­          float ç±»å\næ°å­              long ç±»å\nJSON å¯¹è±¡         object ç±»å\næ°ç»              ç±æ°ç»ä¸­ç¬¬ä¸ä¸ªéç©ºå¼å³å®\nstring          æå¯è½æ¯ date ç±»åï¼è¥å¼å¯æ¥ææ£æµï¼ãdouble æ long ç±»åãtext ç±»åãkeyword ç±»å\n\nä¸é¢ä¸¾ä¸ä¸ªä¾å­è®¤è¯å¨æ mappingï¼å¨ Elasticsearch ä¸­åå»ºä¸ä¸ªæ°çç´¢å¼å¹¶æ¥çå®ç mappingï¼å½ä»¤å¦ä¸ï¼\n\nPUT books\nGET books/_mapping\n\n\næ­¤æ¶ books ç´¢å¼ç mapping æ¯ç©ºçï¼è¿åç»æå¦ä¸ï¼\n\n{\n  "books": {\n    "mappings": {}\n  }\n}\n\n\nåå¾ books ç´¢å¼ä¸­åå¥ä¸æ¡ææ¡£ï¼å½ä»¤å¦ä¸ï¼\n\nPUT books/it/1\n{\n\t"id": 1,\n\t"publish_date": "2019-11-10",\n\t"name": "master Elasticsearch"\n}\n\n\nææ¡£åå¥å®æä¹åï¼åæ¬¡æ¥ç mappingï¼è¿åç»æå¦ä¸ï¼\n\n{\n  "books": {\n    "mappings": {\n      "properties": {\n        "id": {\n          "type": "long"\n        },\n        "name": {\n          "type": "text",\n          "fields": {\n            "keyword": {\n              "type": "keyword",\n              "ignore_above": 256\n            }\n          }\n        },\n        "publish_date": {\n          "type": "date"\n        }\n      }\n    }\n  }\n}\n\n\nä½¿ç¨å¨æ mapping è¦ç»åå®éä¸å¡éæ±æ¥ç»¼åèèï¼å¦æå° Elasticsearch å½ä½ä¸»è¦çæ°æ®å­å¨ä½¿ç¨ï¼å¹¶ä¸å¸æåºç°æªç¥å­æ®µæ¶æåºå¼å¸¸æ¥æéä½ æ³¨æè¿ä¸é®é¢ï¼é£ä¹å¼å¯å¨æ mapping å¹¶ä¸éç¨ãå¨ mapping ä¸­å¯ä»¥éè¿ dynamic è®¾ç½®æ¥æ§å¶æ¯å¦èªå¨æ°å¢å­æ®µï¼æ¥åä»¥ä¸åæ°ï¼\n\n * trueï¼é»è®¤å¼ä¸º trueï¼èªå¨æ·»å å­æ®µã\n * falseï¼å¿½ç¥æ°çå­æ®µã\n * strictï¼ä¸¥æ ¼æ¨¡å¼ï¼åç°æ°çå­æ®µæåºå¼å¸¸ã\n\n\n# åºç¡ç±»å\n\nç±»å      å³é®å­\nå­ç¬¦ä¸²ç±»å   stringãtextãkeyword\næ°å­ç±»å    longãintegerãshortãbyteãdoubleãfloatãhalf_floatãscaled_float\næ¥æç±»å    date\nå¸å°ç±»å    boolean\näºè¿å¶ç±»å   binary\nèå´ç±»å    range\n\n\n# å¤æç±»å\n\nç±»å     å³é®å­\næ°ç»ç±»å   array\nå¯¹è±¡ç±»å   object\nåµå¥ç±»å   nested\n\n\n# ç¹æ®ç±»å\n\nç±»å       å³é®å­\nå°çç±»å     geo_point\nå°çå¾å½¢ç±»å   geo_shape\nIP ç±»å    ip\nèå´ç±»å     completion\nä»¤çè®¡æ°ç±»å   token_count\néä»¶ç±»å     attachment\næ½åç±»å     percolator\n\n\n# Mapping å±æ§\n\nElasticsearch ç mapping ä¸­çå­æ®µå±æ§éå¸¸å¤ï¼å·ä½å¦ä¸è¡¨æ ¼ï¼\n\n| å±æ§å | æè¿° | | :- | :- | | | type | å­æ®µç±»åï¼å¸¸ç¨çæ textãinteger ç­ç­ã | | index | å½åå­æ®µæ¯å¦è¢«ä½ä¸ºç´¢å¼ãå¯éå¼ä¸º trueï¼é»è®¤ä¸º trueã | | store | æ¯å¦å­å¨æå®å­æ®µï¼å¯éå¼ä¸º true | falseï¼è®¾ç½® true æå³çéè¦å¼è¾åç¬çå­å¨ç©ºé´ä¸ºè¿ä¸ªå­æ®µåå­å¨ï¼èä¸è¿ä¸ªå­å¨æ¯ç¬ç«äº _source çå­å¨çã | | norms | æ¯å¦ä½¿ç¨å½ä¸åå å­ï¼å¯éå¼ä¸º true | falseï¼ä¸éè¦å¯¹æå­æ®µè¿è¡æåæåºæ¶ï¼å¯ç¦ç¨å®ï¼èçç©ºé´ï¼type ä¸º text æ¶ï¼é»è®¤ä¸º trueï¼è type ä¸º keyword æ¶ï¼é»è®¤ä¸º falseã | | index_options | ç´¢å¼éé¡¹æ§å¶æ·»å å°åæç´¢å¼ï¼Inverted Indexï¼çä¿¡æ¯ï¼è¿äºä¿¡æ¯ç¨äºæç´¢ï¼Searchï¼åé«äº®æ¾ç¤ºï¼docsï¼åªç´¢å¼ææ¡£ç¼å·(Doc Number)ï¼freqsï¼ç´¢å¼ææ¡£ç¼å·åè¯é¢çï¼term frequencyï¼ï¼positionsï¼ç´¢å¼ææ¡£ç¼å·ï¼è¯é¢çåè¯ä½ç½®ï¼åºå·ï¼ï¼offsetsï¼ç´¢å¼ææ¡£ç¼å·ï¼è¯é¢çï¼è¯åç§»éï¼å¼å§åç»æä½ç½®ï¼åè¯ä½ç½®ï¼åºå·ï¼ãé»è®¤æåµä¸ï¼è¢«åæçå­ç¬¦ä¸²ï¼analyzed stringï¼å­æ®µä½¿ç¨ positionsï¼å¶ä»å­æ®µé»è®¤ä½¿ç¨ docsãæ­¤å¤ï¼éè¦æ³¨æçæ¯ index_option æ¯ elasticsearch ç¹æçè®¾ç½®å±æ§ï¼ä¸´è¿æç´¢åç­è¯­æ¥è¯¢æ¶ï¼index_option å¿é¡»è®¾ç½®ä¸º offsetsï¼åæ¶é«äº®ä¹å¯ä½¿ç¨ postings highlighterã | | term_vector | ç´¢å¼éé¡¹æ§å¶è¯åéç¸å³ä¿¡æ¯ï¼noï¼é»è®¤å¼ï¼è¡¨ç¤ºä¸å­å¨è¯åéç¸å³ä¿¡æ¯ï¼yesï¼åªå­å¨è¯åéä¿¡æ¯ï¼with_positionsï¼å­å¨è¯é¡¹åè¯é¡¹ä½ç½®ï¼with_offsetsï¼å­å¨è¯é¡¹åå­ç¬¦åç§»ä½ç½®ï¼with_positions_offsetsï¼å­å¨è¯é¡¹ãè¯é¡¹ä½ç½®ãå­ç¬¦åç§»ä½ç½®ãterm_vector æ¯ lucene å±é¢çç´¢å¼è®¾ç½®ã | | similarity | æå®ææ¡£ç¸ä¼¼åº¦ç®æ³ï¼ä¹å¯ä»¥å«è¯åæ¨¡åï¼ï¼BM25ï¼ES 5 ä¹åçé»è®¤è®¾ç½®ã | | copy_to | å¤å¶å°èªå®ä¹ _all å­æ®µï¼å¼æ¯æ°ç»å½¢å¼ï¼å³è¡¨æå¯ä»¥æå®å¤ä¸ªèªå®ä¹çå­æ®µã | | analyzer | æå®ç´¢å¼åæç´¢æ¶çåæå¨ï¼å¦æåæ¶æå® search_analyzer åæç´¢æ¶ä¼ä¼åä½¿ç¨ search_analyzerã | | search_analyzer | æå®æç´¢æ¶çåæå¨ï¼æç´¢æ¶çä¼åçº§æé«ã | | null_value | ç¨äºéè¦å¯¹ Null å¼å®ç°æç´¢çåºæ¯ï¼åªæ Keyword ç±»åæ¯ææ­¤éç½®ã |\n\n\n# ç´¢å¼æ¥è¯¢\n\n\n# å¤ä¸ª indexãå¤ä¸ª type æ¥è¯¢\n\nElasticsearch çæç´¢ api æ¯æä¸ä¸ªç´¢å¼ï¼indexï¼çå¤ä¸ªç±»åï¼typeï¼æ¥è¯¢ä»¥å**å¤ä¸ªç´¢å¼ï¼indexï¼**çæ¥è¯¢ã\n\nä¾å¦ï¼æä»¬å¯ä»¥æç´¢ twitter ç´¢å¼ä¸é¢ææå¹éæ¡ä»¶çææç±»åä¸­ææ¡£ï¼å¦ä¸ï¼\n\nGET /twitter/_search?q=user:shay\n\n\næä»¬ä¹å¯ä»¥æç´¢ä¸ä¸ªç´¢å¼ä¸é¢æå®å¤ä¸ª type ä¸å¹éæ¡ä»¶çææ¡£ï¼å¦ä¸ï¼\n\nGET /twitter/tweet,user/_search?q=user:banon\n\n\næä»¬ä¹å¯ä»¥æç´¢å¤ä¸ªç´¢å¼ä¸å¹éæ¡ä»¶çææ¡£ï¼å¦ä¸ï¼\n\nGET /twitter,elasticsearch/_search?q=tag:wow\n\n\næ­¤å¤æä»¬ä¹å¯ä»¥æç´¢ææç´¢å¼ä¸å¹éæ¡ä»¶çææ¡£ï¼ç¨_all è¡¨ç¤ºææç´¢å¼ï¼å¦ä¸ï¼\n\nGET /_all/_search?q=tag:wow\n\n\nçè³æä»¬å¯ä»¥æç´¢ææç´¢å¼åææ type ä¸å¹éæ¡ä»¶çææ¡£ï¼å¦ä¸ï¼\n\nGET /_search?q=tag:wow\n\n\n\n# URI æç´¢\n\nElasticsearch æ¯æç¨ uri æç´¢ï¼å¯ç¨ get è¯·æ±éé¢æ¼æ¥ç¸å³çåæ°ï¼å¹¶ç¨ curl ç¸å³çå½ä»¤å°±å¯ä»¥è¿è¡æµè¯ã\n\nå¦ä¸æä¸ä¸ªç¤ºä¾ï¼\n\nGET twitter/_search?q=user:kimchy\n\n\nå¦ä¸æ¯ä¸ä¸ä¸ªè¯·æ±çç¸åºå®ä½ï¼\n\n{\n  "timed_out": false,\n  "took": 62,\n  "_shards": {\n    "total": 1,\n    "successful": 1,\n    "skipped": 0,\n    "failed": 0\n  },\n  "hits": {\n    "total": 1,\n    "max_score": 1.3862944,\n    "hits": [\n      {\n        "_index": "twitter",\n        "_type": "_doc",\n        "_id": "0",\n        "_score": 1.3862944,\n        "_source": {\n          "user": "kimchy",\n          "date": "2009-11-15T14:12:12",\n          "message": "trying out Elasticsearch",\n          "likes": 0\n        }\n      }\n    ]\n  }\n}\n\n\nURI ä¸­åè®¸çåæ°ï¼\n\nåç§°                             æè¿°\nq                              æ¥è¯¢å­ç¬¦ä¸²ï¼æ å°å° query_string æ¥è¯¢\ndf                             å¨æ¥è¯¢ä¸­æªå®ä¹å­æ®µåç¼æ¶ä½¿ç¨çé»è®¤å­æ®µ\nanalyzer                       æ¥è¯¢å­ç¬¦ä¸²æ¶æå®çåè¯å¨\nanalyze_wildcard               æ¯å¦åè®¸ééç¬¦ååç¼æ¥è¯¢ï¼é»è®¤è®¾ç½®ä¸º false\nbatched_reduce_size            åºå¨åè°èç¹ä¸ä¸æ¬¡åå°çåçç»ææ°ãå¦æè¯·æ±ä¸­æ½å¨çåçæ°éå¾å¤§ï¼ååºå°æ­¤å¼ç¨ä½ä¿æ¤æºå¶ï¼ä»¥åå°æ¯ä¸ªæç´¢è¯·æ±çåå­å¼é\ndefault_operator               é»è®¤ä½¿ç¨çå¹éè¿ç®ç¬¦ï¼å¯ä»¥æ¯ANDæèORï¼é»è®¤æ¯OR\nlenient                        å¦æè®¾ç½®ä¸º trueï¼å°ä¼å¿½ç¥ç±äºæ ¼å¼åå¼èµ·çé®é¢ï¼å¦åæ°æ®å­æ®µæä¾ææ¬ï¼ï¼é»è®¤ä¸º false\nexplain                        å¯¹äºæ¯ä¸ª hitï¼åå«äºå·ä½å¦ä½è®¡ç®å¾åçè§£é\n_source                        è¯·æ±ææ¡£åå®¹çåæ°ï¼é»è®¤ trueï¼è®¾ç½® false çè¯ï¼ä¸è¿å_source\n                               å­æ®µï¼å¯ä»¥ä½¿ç¨**_source_includeå_source_exclude**åæ°åå«æå®è¿åå­æ®µåä¸è¿åçå­æ®µ\nstored_fields                  æå®æ¯ä¸ªå¹éè¿åçææ¡£ä¸­çå­å¨å­æ®µï¼å¤ä¸ªç¨éå·åéãä¸æå®ä»»ä½å¼å°å¯¼è´æ²¡æå­æ®µè¿å\nsort                           æåºæ¹å¼ï¼å¯ä»¥æ¯fieldNameãfieldName:ascæèfieldName:descçå½¢å¼ãfieldName\n                               å¯ä»¥æ¯ææ¡£ä¸­çå®éå­æ®µï¼ä¹å¯ä»¥æ¯è¯¸å¦_score å­æ®µï¼å¶è¡¨ç¤ºåºäºåæ°çæåºãæ­¤å¤å¯ä»¥æå®å¤ä¸ª sort\n                               åæ°ï¼é¡ºåºå¾éè¦ï¼\ntrack_scores                   å½æåºæ¶ï¼è¥è®¾ç½® trueï¼è¿åæ¯ä¸ªå½ä¸­ææ¡£çåæ°\ntrack_total_hits               æ¯å¦è¿åå¹éæ¡ä»¶å½ä¸­çæ»ææ¡£æ°ï¼é»è®¤ä¸º true\ntimeout                        è®¾ç½®æç´¢çè¶æ¶æ¶é´ï¼é»è®¤æ è¶æ¶æ¶é´\nterminate_after                å¨è¾¾å°æ¥è¯¢ç»æ­¢æ¡ä»¶ä¹åï¼æå®æ¯ä¸ªåçæ¶éçæå¤§ææ¡£æ°ãå¦æè®¾ç½®ï¼åå¨ååºä¸­å¤äºä¸ä¸ª terminated_early\n                               çå¸å°å­æ®µï¼ä»¥æç¤ºæ¥è¯¢æ§è¡æ¯å¦å®éä¸å·²ç»æ­¢ãé»è®¤ä¸º no terminate_after\nfrom                           ä»ç¬¬å æ¡ï¼ç´¢å¼ä»¥ 0 å¼å§ï¼ç»æå¼å§è¿åï¼é»è®¤ä¸º 0\nsize                           è¿åå½ä¸­çææ¡£æ°ï¼é»è®¤ä¸º 10\nsearch_type                    æç´¢çæ¹å¼ï¼å¯ä»¥æ¯dfs_query_then_fetchæquery_then_fetchãé»è®¤ä¸ºquery_then_fetch\nallow_partial_search_results   æ¯å¦å¯ä»¥è¿åé¨åç»æãå¦è®¾ç½®ä¸º falseï¼è¡¨ç¤ºå¦æè¯·æ±äº§çé¨åç»æï¼åè®¾ç½®ä¸ºè¿åæ´ä½æéï¼é»è®¤ä¸º\n                               trueï¼è¡¨ç¤ºåè®¸è¯·æ±å¨è¶æ¶æé¨åå¤±è´¥çæåµä¸è·å¾é¨åç»æ\n\n\n# æ¥è¯¢æµç¨\n\nå¨ Elasticsearch ä¸­ï¼æ¥è¯¢æ¯ä¸ä¸ªæ¯è¾å¤æçæ§è¡æ¨¡å¼ï¼å ä¸ºæä»¬ä¸ç¥éé£äº document ä¼è¢«å¹éå°ï¼ä»»ä½ä¸ä¸ª shard ä¸é½æå¯è½ï¼æä»¥ä¸ä¸ª search è¯·æ±å¿é¡»æ¥è¯¢ä¸ä¸ªç´¢å¼æå¤ä¸ªç´¢å¼éé¢çææ shard æè½å®æ´çæ¥è¯¢å°æä»¬æ³è¦çç»æã\n\næ¾å°ææå¹éçç»ææ¯æ¥è¯¢çç¬¬ä¸æ­¥ï¼æ¥èªå¤ä¸ª shard ä¸çæ°æ®éå¨åé¡µè¿åå°å®¢æ·ç«¯ä¹åä¼è¢«åå¹¶å°ä¸ä¸ªæåºåç list åè¡¨ï¼ç±äºéè¦ç»è¿ä¸æ­¥å top N çæä½ï¼æä»¥ search éè¦è¿è¿ä¸¤ä¸ªé¶æ®µæè½å®æï¼åå«æ¯ query å fetchã\n\n\n# åèèµæ\n\n * Elasticsearch å®ç½\n * Elasticsearch ç´¢å¼æ å°ç±»åå mapping å±æ§è¯¦è§£',normalizedContent:'# elasticsearch ç´¢å¼\n\n\n# ç´¢å¼ç®¡çæä½\n\nelasticsearch ç´¢å¼ç®¡çä¸»è¦åæ¬å¦ä½è¿è¡ç´¢å¼çåå»ºãç´¢å¼çå é¤ãå¯æ¬çæ´æ°ãç´¢å¼è¯»åæéãç´¢å¼å«åçéç½®ç­ç­åå®¹ã\n\n\n# ç´¢å¼å é¤\n\nes ç´¢å¼å é¤æä½å es éç¾¤ç http æ¥å£åéæå®ç´¢å¼ç delete http è¯·æ±å³å¯ï¼å¯ä»¥éè¿ curl å½ä»¤ï¼å·ä½å¦ä¸ï¼\n\ncurl -x delete http://{es_host}:{es_http_port}/{index}\n\n\nå¦æå é¤æåï¼å®ä¼è¿åå¦ä¸ä¿¡æ¯ï¼å·ä½ç¤ºä¾å¦ä¸ï¼\n\ncurl -x delete http://10.10.10.66:9200/my_index?pretty\n\n\nä¸ºäºè¿åçä¿¡æ¯ä¾¿äºè¯»åï¼å¢å äº pretty åæ°ï¼\n\n{\n  "acknowledged" : true\n}\n\n\n\n# ç´¢å¼å«å\n\nes çç´¢å¼å«åå°±æ¯ç»ä¸ä¸ªç´¢å¼æèå¤ä¸ªç´¢å¼èµ·çå¦ä¸ä¸ªåå­ï¼å¸åçåºç¨åºæ¯æ¯éå¯¹ç´¢å¼ä½¿ç¨çå¹³æ»åæ¢ã\n\né¦åï¼åå»ºç´¢å¼ my_indexï¼ç¶åå°å«å my_alias æåå®ï¼ç¤ºä¾å¦ä¸ï¼\n\nput /my_index\nput /my_index/_alias/my_alias\n\n\nä¹å¯ä»¥éè¿å¦ä¸å½¢å¼ï¼\n\npost /_aliases\n{\n  "actions": [\n    { "add": { "index": "my_index", "alias": "my_alias" }}\n  ]\n}\n\n\nä¹å¯ä»¥å¨ä¸æ¬¡è¯·æ±ä¸­å¢å å«ååç§»é¤å«åæ··åä½¿ç¨ï¼\n\npost /_aliases\n{\n  "actions": [\n    { "remove": { "index": "my_index", "alias": "my_alias" }}\n    { "add": { "index": "my_index_v2", "alias": "my_alias" }}\n  ]\n}\n\n\n> éè¦æ³¨æçæ¯ï¼å¦æå«åä¸ç´¢å¼æ¯ä¸å¯¹ä¸çï¼ä½¿ç¨å«åç´¢å¼ææ¡£æèæ¥è¯¢ææ¡£æ¯å¯ä»¥çï¼ä½æ¯å¦æå«ååç´¢å¼æ¯ä¸å¯¹å¤çï¼ä½¿ç¨å«åä¼åçéè¯¯ï¼å ä¸º es ä¸ç¥éæææ¡£åå¥åªä¸ªç´¢å¼ä¸­å»æèä»åªä¸ªç´¢å¼ä¸­è¯»åææ¡£ã\n\nes ç´¢å¼å«åæä¸ªå¸åçåºç¨åºæ¯æ¯å¹³æ»åæ¢ï¼æ´å¤ç»èå¯ä»¥æ¥ç elasticsearchï¼esï¼ç´¢å¼é¶åæºï¼æ ééå¯ï¼æ ç¼å¹³æ»åæ¢çæ¹æ³ã\n\n\n# settings è¯¦è§£\n\nelasticsearch ç´¢å¼çéç½®é¡¹ä¸»è¦åä¸ºéæéç½®å±æ§åå¨æéç½®å±æ§ï¼éæéç½®å±æ§æ¯ç´¢å¼åå»ºåä¸è½ä¿®æ¹ï¼èå¨æéç½®å±æ§åå¯ä»¥éæ¶ä¿®æ¹ã\n\nes ç´¢å¼è®¾ç½®ç api ä¸º _settingsï¼å®æ´çç¤ºä¾å¦ä¸ï¼\n\nput /my_index\n{\n  "settings": {\n    "index": {\n      "number_of_shards": "1",\n      "number_of_replicas": "1",\n      "refresh_interval": "60s",\n      "analysis": {\n        "filter": {\n          "tsconvert": {\n            "type": "stconvert",\n            "convert_type": "t2s",\n            "delimiter": ","\n          },\n          "synonym": {\n            "type": "synonym",\n            "synonyms_path": "analysis/synonyms.txt"\n          }\n        },\n        "analyzer": {\n          "ik_max_word_synonym": {\n            "filter": [\n              "synonym",\n              "tsconvert",\n              "standard",\n              "lowercase",\n              "stop"\n            ],\n            "tokenizer": "ik_max_word"\n          },\n          "ik_smart_synonym": {\n            "filter": [\n              "synonym",\n              "standard",\n              "lowercase",\n              "stop"\n            ],\n            "tokenizer": "ik_smart"\n          }\n        },\n\t\t\t"mapping": {\n\t\t\t\t"coerce": "false",\n\t\t\t\t"ignore_malformed": "false"\n\t\t\t},\n\t\t\t"indexing": {\n\t\t\t\t"slowlog": {\n\t\t\t\t\t"threshold": {\n\t\t\t\t\t\t"index": {\n\t\t\t\t\t\t\t"warn": "2s",\n\t\t\t\t\t\t\t"info": "1s"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t"provided_name": "hospital_202101070533",\n\t\t\t"query": {\n\t\t\t\t"default_field": "timestamp",\n\t\t\t\t"parse": {\n\t\t\t\t\t"allow_unmapped_fields": "false"\n\t\t\t\t}\n\t\t\t},\n\t\t\t"requests": {\n\t\t\t\t"cache": {\n\t\t\t\t\t"enable": "true"\n\t\t\t\t}\n\t\t\t},\n\t\t\t"search": {\n\t\t\t\t"slowlog": {\n\t\t\t\t\t"threshold": {\n\t\t\t\t\t\t"fetch": {\n\t\t\t\t\t\t\t"warn": "1s",\n\t\t\t\t\t\t\t"info": "200ms"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t"query": {\n\t\t\t\t\t\t\t"warn": "1s",\n\t\t\t\t\t\t\t"info": "500ms"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# åºå®å±æ§\n\n * index.creation_dateï¼é¡¾åæä¹ç´¢å¼çåå»ºæ¶é´æ³ã\n * index.uuidï¼ç´¢å¼ç uuid ä¿¡æ¯ã\n * index.version.createdï¼ç´¢å¼ççæ¬å·ã\n\n\n# ç´¢å¼éæéç½®\n\n * index.number_of_shardsï¼ç´¢å¼çä¸»åçæ°ï¼é»è®¤å¼æ¯ 5ãè¿ä¸ªéç½®å¨ç´¢å¼åå»ºåä¸è½ä¿®æ¹ï¼å¨ es å±é¢ï¼å¯ä»¥éè¿ es.index.max_number_of_shards å±æ§è®¾ç½®ç´¢å¼æå¤§çåçæ°ï¼é»è®¤ä¸º 1024ã\n * index.codecï¼æ°æ®å­å¨çåç¼©ç®æ³ï¼é»è®¤å¼ä¸º lz4ï¼å¯éæ©å¼è¿æ best_compressionï¼å®æ¯ lz4 å¯ä»¥è·å¾æ´å¥½çåç¼©æ¯ï¼å³å æ®è¾å°çç£çç©ºé´ï¼ä½å­å¨æ§è½æ¯ lz4 ä½ï¼ã\n * index.routing_partition_sizeï¼è·¯ç±ååºæ°ï¼å¦æè®¾ç½®äºè¯¥åæ°ï¼å¶è·¯ç±ç®æ³ä¸ºï¼( hash(_routing) + hash(_id) % index.routing_parttion_size ) % number_of_shardsãå¦æè¯¥å¼ä¸è®¾ç½®ï¼åè·¯ç±ç®æ³ä¸º hash(_routing) % number_of_shardingsï¼_routing é»è®¤å¼ä¸º _idã\n\néæéç½®éï¼æéè¦çé¨åæ¯éç½®åæå¨ï¼config analyzersï¼ã\n\n * index.analysis\n   \n   ï¼åæå¨æå¤å±çéç½®é¡¹ï¼åé¨ä¸»è¦åä¸º char_filterãtokenizerãfilter å analyzerã\n   \n   * char_filterï¼å®ä¹æ°çå­ç¬¦è¿æ»¤å¨ä»¶ã\n   * tokenizerï¼å®ä¹æ°çåè¯å¨ã\n   * filterï¼å®ä¹æ°ç token filterï¼å¦åä¹è¯ filterã\n   * analyzerï¼éç½®æ°çåæå¨ï¼ä¸è¬æ¯ char_filterãtokenizer åä¸äº token filter çç»åã\n\n\n# ç´¢å¼å¨æéç½®\n\n * index.number_of_replicasï¼ç´¢å¼ä¸»åççå¯æ¬æ°ï¼é»è®¤å¼æ¯ 1ï¼è¯¥å¼å¿é¡»å¤§äºç­äº 0ï¼è¿ä¸ªéç½®å¯ä»¥éæ¶ä¿®æ¹ã\n * index.refresh_intervalï¼æ§è¡æ°ç´¢å¼æ°æ®çå·æ°æä½é¢çï¼è¯¥æä½ä½¿å¯¹ç´¢å¼çææ°æ´æ¹å¯¹æç´¢å¯è§ï¼é»è®¤ä¸º 1sãä¹å¯ä»¥è®¾ç½®ä¸º -1 ä»¥ç¦ç¨å·æ°ãæ´è¯¦ç»ä¿¡æ¯åè elasticsearch å¨æä¿®æ¹ refresh_interval å·æ°é´éè®¾ç½®ã\n\n\n# mapping è¯¦è§£\n\nå¨ elasticsearch ä¸­ï¼mappingï¼æ å°ï¼ï¼ç¨æ¥å®ä¹ä¸ä¸ªææ¡£ä»¥åå¶æåå«çå­æ®µå¦ä½è¢«å­å¨åç´¢å¼ï¼å¯ä»¥å¨æ å°ä¸­äºåå®ä¹å­æ®µçæ°æ®ç±»åãå­æ®µçæéãåè¯å¨ç­å±æ§ï¼å°±å¦åå¨å³ç³»åæ°æ®åºä¸­åå»ºæ°æ®è¡¨æ¶ä¼è®¾ç½®å­æ®µçç±»åã\n\nmapping ä¼æ json ææ¡£æ å°æ lucene æéè¦çæå¹³æ ¼å¼\n\nä¸ä¸ª mapping å±äºä¸ä¸ªç´¢å¼ç type\n\n * æ¯ä¸ªææ¡£é½å±äºä¸ä¸ª type\n * ä¸ä¸ª type æä¸ä¸ª mapping å®ä¹\n * 7.0 å¼å§ï¼ä¸éè¦å¨ mapping å®ä¹ä¸­æå® type ä¿¡æ¯\n\n\n# æ å°åç±»\n\nå¨ elasticsearch ä¸­ï¼æ å°å¯åä¸ºéææ å°åå¨ææ å°ãå¨å³ç³»åæ°æ®åºä¸­åå¥æ°æ®ä¹åé¦åè¦å»ºè¡¨ï¼å¨å»ºè¡¨è¯­å¥ä¸­å£°æå­æ®µçå±æ§ï¼å¨ elasticsearch ä¸­ï¼åä¸å¿å¦æ­¤ï¼elasticsearch æéè¦çåè½ä¹ä¸å°±æ¯è®©ä½ å°½å¯è½å¿«å°å¼å§æ¢ç´¢æ°æ®ï¼ææ¡£åå¥ elasticsearch ä¸­ï¼å®ä¼æ ¹æ®å­æ®µçç±»åèªå¨è¯å«ï¼è¿ç§æºå¶ç§°ä¸ºå¨ææ å°ï¼èéææ å°åæ¯åå¥æ°æ®ä¹åå¯¹å­æ®µçå±æ§è¿è¡æå·¥è®¾ç½®ã\n\n# éææ å°\n\néææ å°æ¯å¨åå»ºç´¢å¼æ¶æå·¥æå®ç´¢å¼æ å°ãéææ å°å sql ä¸­å¨å»ºè¡¨è¯­å¥ä¸­æå®å­æ®µå±æ§ç±»ä¼¼ãç¸æ¯å¨ææ å°ï¼éè¿éææ å°å¯ä»¥æ·»å æ´è¯¦ç»ãæ´ç²¾åçéç½®ä¿¡æ¯ã\n\nå¦ä½å®ä¹ä¸ä¸ª mapping\n\nput /books\n{\n    "mappings": {\n        "type_one": { ... any mappings ... },\n        "type_two": { ... any mappings ... },\n        ...\n    }\n}\n\n\n# å¨ææ å°\n\nå¨ææ å°æ¯ä¸ç§å·æçæ¹å¼ï¼å¯ç´æ¥åå»ºç´¢å¼å¹¶åå¥ææ¡£ï¼ææ¡£ä¸­å­æ®µçç±»åæ¯ elasticsearch èªå¨è¯å«çï¼ä¸éè¦å¨åå»ºç´¢å¼çæ¶åè®¾ç½®å­æ®µçç±»åãå¨å®éé¡¹ç®ä¸­ï¼å¦æéå°çä¸å¡å¨å¯¼å¥æ°æ®ä¹åä¸ç¡®å®æåªäºå­æ®µï¼ä¹ä¸æ¸æ¥å­æ®µçç±»åæ¯ä»ä¹ï¼ä½¿ç¨å¨ææ å°éå¸¸åéãå½ elasticsearch å¨ææ¡£ä¸­ç¢°å°ä¸ä¸ªä»¥åæ²¡è§è¿çå­æ®µæ¶ï¼å®ä¼å©ç¨å¨ææ å°æ¥å³å®è¯¥å­æ®µçç±»åï¼å¹¶èªå¨æè¯¥å­æ®µæ·»å å°æ å°ä¸­ï¼æ ¹æ®å­æ®µçåå¼èªå¨æ¨æµå­æ®µç±»åçè§åè§ä¸è¡¨ï¼\n\njson æ ¼å¼çæ°æ®      èªå¨æ¨æµçå­æ®µç±»å\nnull            æ²¡æå­æ®µè¢«æ·»å \ntrue or false   boolean ç±»å\næµ®ç¹ç±»åæ°å­          float ç±»å\næ°å­              long ç±»å\njson å¯¹è±¡         object ç±»å\næ°ç»              ç±æ°ç»ä¸­ç¬¬ä¸ä¸ªéç©ºå¼å³å®\nstring          æå¯è½æ¯ date ç±»åï¼è¥å¼å¯æ¥ææ£æµï¼ãdouble æ long ç±»åãtext ç±»åãkeyword ç±»å\n\nä¸é¢ä¸¾ä¸ä¸ªä¾å­è®¤è¯å¨æ mappingï¼å¨ elasticsearch ä¸­åå»ºä¸ä¸ªæ°çç´¢å¼å¹¶æ¥çå®ç mappingï¼å½ä»¤å¦ä¸ï¼\n\nput books\nget books/_mapping\n\n\næ­¤æ¶ books ç´¢å¼ç mapping æ¯ç©ºçï¼è¿åç»æå¦ä¸ï¼\n\n{\n  "books": {\n    "mappings": {}\n  }\n}\n\n\nåå¾ books ç´¢å¼ä¸­åå¥ä¸æ¡ææ¡£ï¼å½ä»¤å¦ä¸ï¼\n\nput books/it/1\n{\n\t"id": 1,\n\t"publish_date": "2019-11-10",\n\t"name": "master elasticsearch"\n}\n\n\nææ¡£åå¥å®æä¹åï¼åæ¬¡æ¥ç mappingï¼è¿åç»æå¦ä¸ï¼\n\n{\n  "books": {\n    "mappings": {\n      "properties": {\n        "id": {\n          "type": "long"\n        },\n        "name": {\n          "type": "text",\n          "fields": {\n            "keyword": {\n              "type": "keyword",\n              "ignore_above": 256\n            }\n          }\n        },\n        "publish_date": {\n          "type": "date"\n        }\n      }\n    }\n  }\n}\n\n\nä½¿ç¨å¨æ mapping è¦ç»åå®éä¸å¡éæ±æ¥ç»¼åèèï¼å¦æå° elasticsearch å½ä½ä¸»è¦çæ°æ®å­å¨ä½¿ç¨ï¼å¹¶ä¸å¸æåºç°æªç¥å­æ®µæ¶æåºå¼å¸¸æ¥æéä½ æ³¨æè¿ä¸é®é¢ï¼é£ä¹å¼å¯å¨æ mapping å¹¶ä¸éç¨ãå¨ mapping ä¸­å¯ä»¥éè¿ dynamic è®¾ç½®æ¥æ§å¶æ¯å¦èªå¨æ°å¢å­æ®µï¼æ¥åä»¥ä¸åæ°ï¼\n\n * trueï¼é»è®¤å¼ä¸º trueï¼èªå¨æ·»å å­æ®µã\n * falseï¼å¿½ç¥æ°çå­æ®µã\n * strictï¼ä¸¥æ ¼æ¨¡å¼ï¼åç°æ°çå­æ®µæåºå¼å¸¸ã\n\n\n# åºç¡ç±»å\n\nç±»å      å³é®å­\nå­ç¬¦ä¸²ç±»å   stringãtextãkeyword\næ°å­ç±»å    longãintegerãshortãbyteãdoubleãfloatãhalf_floatãscaled_float\næ¥æç±»å    date\nå¸å°ç±»å    boolean\näºè¿å¶ç±»å   binary\nèå´ç±»å    range\n\n\n# å¤æç±»å\n\nç±»å     å³é®å­\næ°ç»ç±»å   array\nå¯¹è±¡ç±»å   object\nåµå¥ç±»å   nested\n\n\n# ç¹æ®ç±»å\n\nç±»å       å³é®å­\nå°çç±»å     geo_point\nå°çå¾å½¢ç±»å   geo_shape\nip ç±»å    ip\nèå´ç±»å     completion\nä»¤çè®¡æ°ç±»å   token_count\néä»¶ç±»å     attachment\næ½åç±»å     percolator\n\n\n# mapping å±æ§\n\nelasticsearch ç mapping ä¸­çå­æ®µå±æ§éå¸¸å¤ï¼å·ä½å¦ä¸è¡¨æ ¼ï¼\n\n| å±æ§å | æè¿° | | :- | :- | | | type | å­æ®µç±»åï¼å¸¸ç¨çæ textãinteger ç­ç­ã | | index | å½åå­æ®µæ¯å¦è¢«ä½ä¸ºç´¢å¼ãå¯éå¼ä¸º trueï¼é»è®¤ä¸º trueã | | store | æ¯å¦å­å¨æå®å­æ®µï¼å¯éå¼ä¸º true | falseï¼è®¾ç½® true æå³çéè¦å¼è¾åç¬çå­å¨ç©ºé´ä¸ºè¿ä¸ªå­æ®µåå­å¨ï¼èä¸è¿ä¸ªå­å¨æ¯ç¬ç«äº _source çå­å¨çã | | norms | æ¯å¦ä½¿ç¨å½ä¸åå å­ï¼å¯éå¼ä¸º true | falseï¼ä¸éè¦å¯¹æå­æ®µè¿è¡æåæåºæ¶ï¼å¯ç¦ç¨å®ï¼èçç©ºé´ï¼type ä¸º text æ¶ï¼é»è®¤ä¸º trueï¼è type ä¸º keyword æ¶ï¼é»è®¤ä¸º falseã | | index_options | ç´¢å¼éé¡¹æ§å¶æ·»å å°åæç´¢å¼ï¼inverted indexï¼çä¿¡æ¯ï¼è¿äºä¿¡æ¯ç¨äºæç´¢ï¼searchï¼åé«äº®æ¾ç¤ºï¼docsï¼åªç´¢å¼ææ¡£ç¼å·(doc number)ï¼freqsï¼ç´¢å¼ææ¡£ç¼å·åè¯é¢çï¼term frequencyï¼ï¼positionsï¼ç´¢å¼ææ¡£ç¼å·ï¼è¯é¢çåè¯ä½ç½®ï¼åºå·ï¼ï¼offsetsï¼ç´¢å¼ææ¡£ç¼å·ï¼è¯é¢çï¼è¯åç§»éï¼å¼å§åç»æä½ç½®ï¼åè¯ä½ç½®ï¼åºå·ï¼ãé»è®¤æåµä¸ï¼è¢«åæçå­ç¬¦ä¸²ï¼analyzed stringï¼å­æ®µä½¿ç¨ positionsï¼å¶ä»å­æ®µé»è®¤ä½¿ç¨ docsãæ­¤å¤ï¼éè¦æ³¨æçæ¯ index_option æ¯ elasticsearch ç¹æçè®¾ç½®å±æ§ï¼ä¸´è¿æç´¢åç­è¯­æ¥è¯¢æ¶ï¼index_option å¿é¡»è®¾ç½®ä¸º offsetsï¼åæ¶é«äº®ä¹å¯ä½¿ç¨ postings highlighterã | | term_vector | ç´¢å¼éé¡¹æ§å¶è¯åéç¸å³ä¿¡æ¯ï¼noï¼é»è®¤å¼ï¼è¡¨ç¤ºä¸å­å¨è¯åéç¸å³ä¿¡æ¯ï¼yesï¼åªå­å¨è¯åéä¿¡æ¯ï¼with_positionsï¼å­å¨è¯é¡¹åè¯é¡¹ä½ç½®ï¼with_offsetsï¼å­å¨è¯é¡¹åå­ç¬¦åç§»ä½ç½®ï¼with_positions_offsetsï¼å­å¨è¯é¡¹ãè¯é¡¹ä½ç½®ãå­ç¬¦åç§»ä½ç½®ãterm_vector æ¯ lucene å±é¢çç´¢å¼è®¾ç½®ã | | similarity | æå®ææ¡£ç¸ä¼¼åº¦ç®æ³ï¼ä¹å¯ä»¥å«è¯åæ¨¡åï¼ï¼bm25ï¼es 5 ä¹åçé»è®¤è®¾ç½®ã | | copy_to | å¤å¶å°èªå®ä¹ _all å­æ®µï¼å¼æ¯æ°ç»å½¢å¼ï¼å³è¡¨æå¯ä»¥æå®å¤ä¸ªèªå®ä¹çå­æ®µã | | analyzer | æå®ç´¢å¼åæç´¢æ¶çåæå¨ï¼å¦æåæ¶æå® search_analyzer åæç´¢æ¶ä¼ä¼åä½¿ç¨ search_analyzerã | | search_analyzer | æå®æç´¢æ¶çåæå¨ï¼æç´¢æ¶çä¼åçº§æé«ã | | null_value | ç¨äºéè¦å¯¹ null å¼å®ç°æç´¢çåºæ¯ï¼åªæ keyword ç±»åæ¯ææ­¤éç½®ã |\n\n\n# ç´¢å¼æ¥è¯¢\n\n\n# å¤ä¸ª indexãå¤ä¸ª type æ¥è¯¢\n\nelasticsearch çæç´¢ api æ¯æä¸ä¸ªç´¢å¼ï¼indexï¼çå¤ä¸ªç±»åï¼typeï¼æ¥è¯¢ä»¥å**å¤ä¸ªç´¢å¼ï¼indexï¼**çæ¥è¯¢ã\n\nä¾å¦ï¼æä»¬å¯ä»¥æç´¢ twitter ç´¢å¼ä¸é¢ææå¹éæ¡ä»¶çææç±»åä¸­ææ¡£ï¼å¦ä¸ï¼\n\nget /twitter/_search?q=user:shay\n\n\næä»¬ä¹å¯ä»¥æç´¢ä¸ä¸ªç´¢å¼ä¸é¢æå®å¤ä¸ª type ä¸å¹éæ¡ä»¶çææ¡£ï¼å¦ä¸ï¼\n\nget /twitter/tweet,user/_search?q=user:banon\n\n\næä»¬ä¹å¯ä»¥æç´¢å¤ä¸ªç´¢å¼ä¸å¹éæ¡ä»¶çææ¡£ï¼å¦ä¸ï¼\n\nget /twitter,elasticsearch/_search?q=tag:wow\n\n\næ­¤å¤æä»¬ä¹å¯ä»¥æç´¢ææç´¢å¼ä¸å¹éæ¡ä»¶çææ¡£ï¼ç¨_all è¡¨ç¤ºææç´¢å¼ï¼å¦ä¸ï¼\n\nget /_all/_search?q=tag:wow\n\n\nçè³æä»¬å¯ä»¥æç´¢ææç´¢å¼åææ type ä¸å¹éæ¡ä»¶çææ¡£ï¼å¦ä¸ï¼\n\nget /_search?q=tag:wow\n\n\n\n# uri æç´¢\n\nelasticsearch æ¯æç¨ uri æç´¢ï¼å¯ç¨ get è¯·æ±éé¢æ¼æ¥ç¸å³çåæ°ï¼å¹¶ç¨ curl ç¸å³çå½ä»¤å°±å¯ä»¥è¿è¡æµè¯ã\n\nå¦ä¸æä¸ä¸ªç¤ºä¾ï¼\n\nget twitter/_search?q=user:kimchy\n\n\nå¦ä¸æ¯ä¸ä¸ä¸ªè¯·æ±çç¸åºå®ä½ï¼\n\n{\n  "timed_out": false,\n  "took": 62,\n  "_shards": {\n    "total": 1,\n    "successful": 1,\n    "skipped": 0,\n    "failed": 0\n  },\n  "hits": {\n    "total": 1,\n    "max_score": 1.3862944,\n    "hits": [\n      {\n        "_index": "twitter",\n        "_type": "_doc",\n        "_id": "0",\n        "_score": 1.3862944,\n        "_source": {\n          "user": "kimchy",\n          "date": "2009-11-15t14:12:12",\n          "message": "trying out elasticsearch",\n          "likes": 0\n        }\n      }\n    ]\n  }\n}\n\n\nuri ä¸­åè®¸çåæ°ï¼\n\nåç§°                             æè¿°\nq                              æ¥è¯¢å­ç¬¦ä¸²ï¼æ å°å° query_string æ¥è¯¢\ndf                             å¨æ¥è¯¢ä¸­æªå®ä¹å­æ®µåç¼æ¶ä½¿ç¨çé»è®¤å­æ®µ\nanalyzer                       æ¥è¯¢å­ç¬¦ä¸²æ¶æå®çåè¯å¨\nanalyze_wildcard               æ¯å¦åè®¸ééç¬¦ååç¼æ¥è¯¢ï¼é»è®¤è®¾ç½®ä¸º false\nbatched_reduce_size            åºå¨åè°èç¹ä¸ä¸æ¬¡åå°çåçç»ææ°ãå¦æè¯·æ±ä¸­æ½å¨çåçæ°éå¾å¤§ï¼ååºå°æ­¤å¼ç¨ä½ä¿æ¤æºå¶ï¼ä»¥åå°æ¯ä¸ªæç´¢è¯·æ±çåå­å¼é\ndefault_operator               é»è®¤ä½¿ç¨çå¹éè¿ç®ç¬¦ï¼å¯ä»¥æ¯andæèorï¼é»è®¤æ¯or\nlenient                        å¦æè®¾ç½®ä¸º trueï¼å°ä¼å¿½ç¥ç±äºæ ¼å¼åå¼èµ·çé®é¢ï¼å¦åæ°æ®å­æ®µæä¾ææ¬ï¼ï¼é»è®¤ä¸º false\nexplain                        å¯¹äºæ¯ä¸ª hitï¼åå«äºå·ä½å¦ä½è®¡ç®å¾åçè§£é\n_source                        è¯·æ±ææ¡£åå®¹çåæ°ï¼é»è®¤ trueï¼è®¾ç½® false çè¯ï¼ä¸è¿å_source\n                               å­æ®µï¼å¯ä»¥ä½¿ç¨**_source_includeå_source_exclude**åæ°åå«æå®è¿åå­æ®µåä¸è¿åçå­æ®µ\nstored_fields                  æå®æ¯ä¸ªå¹éè¿åçææ¡£ä¸­çå­å¨å­æ®µï¼å¤ä¸ªç¨éå·åéãä¸æå®ä»»ä½å¼å°å¯¼è´æ²¡æå­æ®µè¿å\nsort                           æåºæ¹å¼ï¼å¯ä»¥æ¯fieldnameãfieldname:ascæèfieldname:descçå½¢å¼ãfieldname\n                               å¯ä»¥æ¯ææ¡£ä¸­çå®éå­æ®µï¼ä¹å¯ä»¥æ¯è¯¸å¦_score å­æ®µï¼å¶è¡¨ç¤ºåºäºåæ°çæåºãæ­¤å¤å¯ä»¥æå®å¤ä¸ª sort\n                               åæ°ï¼é¡ºåºå¾éè¦ï¼\ntrack_scores                   å½æåºæ¶ï¼è¥è®¾ç½® trueï¼è¿åæ¯ä¸ªå½ä¸­ææ¡£çåæ°\ntrack_total_hits               æ¯å¦è¿åå¹éæ¡ä»¶å½ä¸­çæ»ææ¡£æ°ï¼é»è®¤ä¸º true\ntimeout                        è®¾ç½®æç´¢çè¶æ¶æ¶é´ï¼é»è®¤æ è¶æ¶æ¶é´\nterminate_after                å¨è¾¾å°æ¥è¯¢ç»æ­¢æ¡ä»¶ä¹åï¼æå®æ¯ä¸ªåçæ¶éçæå¤§ææ¡£æ°ãå¦æè®¾ç½®ï¼åå¨ååºä¸­å¤äºä¸ä¸ª terminated_early\n                               çå¸å°å­æ®µï¼ä»¥æç¤ºæ¥è¯¢æ§è¡æ¯å¦å®éä¸å·²ç»æ­¢ãé»è®¤ä¸º no terminate_after\nfrom                           ä»ç¬¬å æ¡ï¼ç´¢å¼ä»¥ 0 å¼å§ï¼ç»æå¼å§è¿åï¼é»è®¤ä¸º 0\nsize                           è¿åå½ä¸­çææ¡£æ°ï¼é»è®¤ä¸º 10\nsearch_type                    æç´¢çæ¹å¼ï¼å¯ä»¥æ¯dfs_query_then_fetchæquery_then_fetchãé»è®¤ä¸ºquery_then_fetch\nallow_partial_search_results   æ¯å¦å¯ä»¥è¿åé¨åç»æãå¦è®¾ç½®ä¸º falseï¼è¡¨ç¤ºå¦æè¯·æ±äº§çé¨åç»æï¼åè®¾ç½®ä¸ºè¿åæ´ä½æéï¼é»è®¤ä¸º\n                               trueï¼è¡¨ç¤ºåè®¸è¯·æ±å¨è¶æ¶æé¨åå¤±è´¥çæåµä¸è·å¾é¨åç»æ\n\n\n# æ¥è¯¢æµç¨\n\nå¨ elasticsearch ä¸­ï¼æ¥è¯¢æ¯ä¸ä¸ªæ¯è¾å¤æçæ§è¡æ¨¡å¼ï¼å ä¸ºæä»¬ä¸ç¥éé£äº document ä¼è¢«å¹éå°ï¼ä»»ä½ä¸ä¸ª shard ä¸é½æå¯è½ï¼æä»¥ä¸ä¸ª search è¯·æ±å¿é¡»æ¥è¯¢ä¸ä¸ªç´¢å¼æå¤ä¸ªç´¢å¼éé¢çææ shard æè½å®æ´çæ¥è¯¢å°æä»¬æ³è¦çç»æã\n\næ¾å°ææå¹éçç»ææ¯æ¥è¯¢çç¬¬ä¸æ­¥ï¼æ¥èªå¤ä¸ª shard ä¸çæ°æ®éå¨åé¡µè¿åå°å®¢æ·ç«¯ä¹åä¼è¢«åå¹¶å°ä¸ä¸ªæåºåç list åè¡¨ï¼ç±äºéè¦ç»è¿ä¸æ­¥å top n çæä½ï¼æä»¥ search éè¦è¿è¿ä¸¤ä¸ªé¶æ®µæè½å®æï¼åå«æ¯ query å fetchã\n\n\n# åèèµæ\n\n * elasticsearch å®ç½\n * elasticsearch ç´¢å¼æ å°ç±»åå mapping å±æ§è¯¦è§£',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Elasticsearch æ¥è¯¢",frontmatter:{title:"Elasticsearch æ¥è¯¢",date:"2022-01-18T08:01:08.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","æ¥è¯¢"],permalink:"/pages/83bd15/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/05.Elasticsearch%E6%9F%A5%E8%AF%A2.html",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/05.Elasticsearchæ¥è¯¢.md",key:"v-f6b5c434",path:"/pages/83bd15/",headers:[{level:2,title:"å¨ææ¥è¯¢",slug:"å¨ææ¥è¯¢",normalizedTitle:"å¨ææ¥è¯¢",charIndex:107},{level:3,title:"intervals query",slug:"intervals-query",normalizedTitle:"intervals query",charIndex:305},{level:3,title:"match query",slug:"match-query",normalizedTitle:"match query",charIndex:1226},{level:4,title:"match query ç®å",slug:"match-query-ç®å",normalizedTitle:"match query ç®å",charIndex:1748},{level:4,title:"match query å¦ä½å·¥ä½",slug:"match-query-å¦ä½å·¥ä½",normalizedTitle:"match query å¦ä½å·¥ä½",charIndex:1899},{level:4,title:"match query çæ¨¡ç³æ¥è¯¢",slug:"match-query-çæ¨¡ç³æ¥è¯¢",normalizedTitle:"match query çæ¨¡ç³æ¥è¯¢",charIndex:2371},{level:4,title:"zero terms æ¥è¯¢",slug:"zero-terms-æ¥è¯¢",normalizedTitle:"zero terms æ¥è¯¢",charIndex:2802},{level:3,title:"matchboolprefix query",slug:"match-bool-prefix-query",normalizedTitle:"matchboolprefix query",charIndex:null},{level:3,title:"match_phrase query",slug:"match-phrase-query",normalizedTitle:"match_phrase query",charIndex:3828},{level:3,title:"matchphraseprefix query",slug:"match-phrase-prefix-query",normalizedTitle:"matchphraseprefix query",charIndex:null},{level:3,title:"multi_match query",slug:"multi-match-query",normalizedTitle:"multi_match query",charIndex:4644},{level:3,title:"combined_fields query",slug:"combined-fields-query",normalizedTitle:"combined_fields query",charIndex:5436},{level:4,title:"å­æ®µåç¼æé",slug:"å­æ®µåç¼æé",normalizedTitle:"å­æ®µåç¼æé",charIndex:5808},{level:3,title:"common_terms query",slug:"common-terms-query",normalizedTitle:"common_terms query",charIndex:5905},{level:3,title:"query_string query",slug:"query-string-query",normalizedTitle:"query_string query",charIndex:7342},{level:3,title:"simplequerystring query",slug:"simple-query-string-query",normalizedTitle:"simplequerystring query",charIndex:null},{level:4,title:"simplequerystring è¯­ä¹",slug:"simple-query-string-è¯­ä¹",normalizedTitle:"simplequerystring è¯­ä¹",charIndex:null},{level:3,title:"å¨ææ¥è¯¢å®æ´ç¤ºä¾",slug:"å¨ææ¥è¯¢å®æ´ç¤ºä¾",normalizedTitle:"å¨ææ¥è¯¢å®æ´ç¤ºä¾",charIndex:8351},{level:2,title:"è¯é¡¹æ¥è¯¢",slug:"è¯é¡¹æ¥è¯¢",normalizedTitle:"è¯é¡¹æ¥è¯¢",charIndex:112},{level:3,title:"exists query",slug:"exists-query",normalizedTitle:"exists query",charIndex:9114},{level:3,title:"fuzzy query",slug:"fuzzy-query",normalizedTitle:"fuzzy query",charIndex:9130},{level:3,title:"ids query",slug:"ids-query",normalizedTitle:"ids query",charIndex:9145},{level:3,title:"prefix query",slug:"prefix-query",normalizedTitle:"prefix query",charIndex:3131},{level:3,title:"range query",slug:"range-query",normalizedTitle:"range query",charIndex:9174},{level:3,title:"regexp query",slug:"regexp-query",normalizedTitle:"regexp query",charIndex:9189},{level:3,title:"term query",slug:"term-query",normalizedTitle:"term query",charIndex:9205},{level:3,title:"terms query",slug:"terms-query",normalizedTitle:"terms query",charIndex:5912},{level:3,title:"type query",slug:"type-query",normalizedTitle:"type query",charIndex:9234},{level:3,title:"wildcard query",slug:"wildcard-query",normalizedTitle:"wildcard query",charIndex:9248},{level:3,title:"è¯é¡¹æ¥è¯¢å®æ´ç¤ºä¾",slug:"è¯é¡¹æ¥è¯¢å®æ´ç¤ºä¾",normalizedTitle:"è¯é¡¹æ¥è¯¢å®æ´ç¤ºä¾",charIndex:14439},{level:2,title:"å¤åæ¥è¯¢",slug:"å¤åæ¥è¯¢",normalizedTitle:"å¤åæ¥è¯¢",charIndex:117},{level:3,title:"bool query",slug:"bool-query",normalizedTitle:"bool query",charIndex:15645},{level:3,title:"boosting query",slug:"boosting-query",normalizedTitle:"boosting query",charIndex:16644},{level:3,title:"constant_score query",slug:"constant-score-query",normalizedTitle:"constant_score query",charIndex:17275},{level:3,title:"dis_max query",slug:"dis-max-query",normalizedTitle:"dis_max query",charIndex:17690},{level:3,title:"function_score query",slug:"function-score-query",normalizedTitle:"function_score query",charIndex:18073},{level:3,title:"indices query",slug:"indices-query",normalizedTitle:"indices query",charIndex:18879},{level:2,title:"åµå¥æ¥è¯¢",slug:"åµå¥æ¥è¯¢",normalizedTitle:"åµå¥æ¥è¯¢",charIndex:122},{level:3,title:"nested query",slug:"nested-query",normalizedTitle:"nested query",charIndex:19493},{level:3,title:"has_child query",slug:"has-child-query",normalizedTitle:"has_child query",charIndex:19576},{level:3,title:"has_parent query",slug:"has-parent-query",normalizedTitle:"has_parent query",charIndex:19599},{level:2,title:"ä½ç½®æ¥è¯¢",slug:"ä½ç½®æ¥è¯¢",normalizedTitle:"ä½ç½®æ¥è¯¢",charIndex:127},{level:3,title:"geo_distance query",slug:"geo-distance-query",normalizedTitle:"geo_distance query",charIndex:23207},{level:3,title:"geoboundingbox query",slug:"geo-bounding-box-query",normalizedTitle:"geoboundingbox query",charIndex:null},{level:3,title:"geo_polygon query",slug:"geo-polygon-query",normalizedTitle:"geo_polygon query",charIndex:24362},{level:3,title:"geo_shape query",slug:"geo-shape-query",normalizedTitle:"geo_shape query",charIndex:24837},{level:2,title:"ç¹æ®æ¥è¯¢",slug:"ç¹æ®æ¥è¯¢",normalizedTitle:"ç¹æ®æ¥è¯¢",charIndex:132},{level:3,title:"morelikethis query",slug:"more-like-this-query",normalizedTitle:"morelikethis query",charIndex:null},{level:3,title:"script query",slug:"script-query",normalizedTitle:"script query",charIndex:26550},{level:3,title:"percolate query",slug:"percolate-query",normalizedTitle:"percolate query",charIndex:26779}],headersStr:"å¨ææ¥è¯¢ intervals query match query match query ç®å match query å¦ä½å·¥ä½ match query çæ¨¡ç³æ¥è¯¢ zero terms æ¥è¯¢ matchboolprefix query match_phrase query matchphraseprefix query multi_match query combined_fields query å­æ®µåç¼æé common_terms query query_string query simplequerystring query simplequerystring è¯­ä¹ å¨ææ¥è¯¢å®æ´ç¤ºä¾ è¯é¡¹æ¥è¯¢ exists query fuzzy query ids query prefix query range query regexp query term query terms query type query wildcard query è¯é¡¹æ¥è¯¢å®æ´ç¤ºä¾ å¤åæ¥è¯¢ bool query boosting query constant_score query dis_max query function_score query indices query åµå¥æ¥è¯¢ nested query has_child query has_parent query ä½ç½®æ¥è¯¢ geo_distance query geoboundingbox query geo_polygon query geo_shape query ç¹æ®æ¥è¯¢ morelikethis query script query percolate query",content:'# Elasticsearch æ¥è¯¢\n\nElasticsearch æ¥è¯¢è¯­å¥éç¨åºäº RESTful é£æ ¼çæ¥å£å°è£æ JSON æ ¼å¼çå¯¹è±¡ï¼ç§°ä¹ä¸º Query DSLãElasticsearch æ¥è¯¢åç±»å¤§è´åä¸ºå¨ææ¥è¯¢ãè¯é¡¹æ¥è¯¢ãå¤åæ¥è¯¢ãåµå¥æ¥è¯¢ãä½ç½®æ¥è¯¢ãç¹æ®æ¥è¯¢ãElasticsearch æ¥è¯¢ä»æºå¶åä¸ºä¸¤ç§ï¼ä¸ç§æ¯æ ¹æ®ç¨æ·è¾å¥çæ¥è¯¢è¯ï¼éè¿æåºæ¨¡åè®¡ç®ææ¡£ä¸æ¥è¯¢è¯ä¹é´çç¸å³åº¦ï¼å¹¶æ ¹æ®è¯åé«ä½æåºè¿åï¼å¦ä¸ç§æ¯è¿æ»¤æºå¶ï¼åªæ ¹æ®è¿æ»¤æ¡ä»¶å¯¹ææ¡£è¿è¡è¿æ»¤ï¼ä¸è®¡ç®è¯åï¼éåº¦ç¸å¯¹è¾å¿«ã\n\n\n# å¨ææ¥è¯¢\n\nES å¨ææ¥è¯¢ä¸»è¦ç¨äºå¨å¨æå­æ®µä¸ï¼ä¸»è¦èèæ¥è¯¢è¯ä¸ææ¡£çç¸å³æ§ï¼Relevanceï¼ã\n\n\n# intervals query\n\nintervals query æ ¹æ®å¹éè¯çé¡ºåºåè¿ä¼¼åº¦è¿åææ¡£ã\n\nintervals query ä½¿ç¨å¹éè§åï¼è¿äºè§ååºç¨äºæå®å­æ®µä¸­ç termã\n\nç¤ºä¾ï¼ä¸é¢ç¤ºä¾æç´¢ query å­æ®µï¼æç´¢å¼æ¯ my favorite foodï¼æ²¡æä»»ä½é´éï¼ç¶åæ¯ my_text å­æ®µæç´¢å¹é hot waterãcold porridge ç termã\n\nå½ my_text ä¸­çå¼ä¸º my favorite food is cold porridge æ¶ï¼ä¼å¹éæåï¼ä½æ¯ when it\'s cold my favorite food is porridge åå¹éå¤±è´¥\n\nPOST _search\n{\n  "query": {\n    "intervals" : {\n      "my_text" : {\n        "all_of" : {\n          "ordered" : true,\n          "intervals" : [\n            {\n              "match" : {\n                "query" : "my favorite food",\n                "max_gaps" : 0,\n                "ordered" : true\n              }\n            },\n            {\n              "any_of" : {\n                "intervals" : [\n                  { "match" : { "query" : "hot water" } },\n                  { "match" : { "query" : "cold porridge" } }\n                ]\n              }\n            }\n          ]\n        }\n      }\n    }\n  }\n}\n\n\n\n# match query\n\nmatch query ç¨äºæç´¢åä¸ªå­æ®µï¼é¦åä¼éå¯¹æ¥è¯¢è¯­å¥è¿è¡è§£æï¼ç»è¿ analyzerï¼ï¼ä¸»è¦æ¯å¯¹æ¥è¯¢è¯­å¥è¿è¡åè¯ï¼åè¯åæ¥è¯¢è¯­å¥çä»»ä½ä¸ä¸ªè¯é¡¹è¢«å¹éï¼ææ¡£å°±ä¼è¢«æå°ï¼é»è®¤æåµä¸ç¸å½äºå¯¹åè¯åè¯é¡¹è¿è¡ or å¹éæä½ã\n\nmatch query æ¯æ§è¡å¨ææç´¢çæ åæ¥è¯¢ï¼åæ¬æ¨¡ç³å¹ééé¡¹ã\n\nGET kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "match": {\n      "customer_full_name": {\n        "query": "George Hubbard"\n      }\n    }\n  }\n}\n\n\nç­åäº or å¹éæä½ï¼å¦ä¸ï¼\n\nGET kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "match": {\n      "customer_full_name": {\n        "query": "George Hubbard",\n        "operator": "or"\n      }\n    }\n  }\n}\n\n\n# match query ç®å\n\nå¯ä»¥éè¿ç»å <field> å query åæ°æ¥ç®åå¹éæ¥è¯¢è¯­æ³ã\n\nç¤ºä¾ï¼\n\nGET /_search\n{\n  "query": {\n    "match": {\n      "message": "this is a test"\n    }\n  }\n}\n\n\n# match query å¦ä½å·¥ä½\n\nå¹éæ¥è¯¢æ¯å¸å°ç±»åãè¿æå³çä¼å¯¹æä¾çææ¬è¿è¡åæï¼åæè¿ç¨ä»æä¾çææ¬æé ä¸ä¸ªå¸å°æ¥è¯¢ã operator åæ°å¯ä»¥è®¾ç½®ä¸º or æ and æ¥æ§å¶å¸å°å­å¥ï¼é»è®¤ä¸º orï¼ãå¯ä»¥ä½¿ç¨ minimum_should_match åæ°è®¾ç½®è¦å¹éçå¯é should å­å¥çæå°æ°éã\n\nGET kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "match": {\n      "customer_full_name": {\n        "query": "George Hubbard",\n        "operator": "and"\n      }\n    }\n  }\n}\n\n\nå¯ä»¥è®¾ç½® analyzer æ¥æ§å¶åªä¸ªåæå¨å°å¯¹ææ¬æ§è¡åæè¿ç¨ãå®é»è®¤ä¸ºå­æ®µæ¾å¼æ å°å®ä¹æé»è®¤æç´¢åæå¨ã\n\nlenient åæ°å¯ä»¥è®¾ç½®ä¸º true ä»¥å¿½ç¥ç±æ°æ®ç±»åä¸å¹éå¯¼è´çå¼å¸¸ï¼ä¾å¦å°è¯ä½¿ç¨ææ¬æ¥è¯¢å­ç¬¦ä¸²æ¥è¯¢æ°å­å­æ®µãé»è®¤ä¸º falseã\n\n# match query çæ¨¡ç³æ¥è¯¢\n\nfuzziness åè®¸åºäºè¢«æ¥è¯¢å­æ®µçç±»åè¿è¡æ¨¡ç³å¹éãè¯·åé Fuzziness çéç½®ã\n\nå¨è¿ç§æåµä¸å¯ä»¥è®¾ç½® prefix_length å max_expansions æ¥æ§å¶æ¨¡ç³å¹éãå¦æè®¾ç½®äºæ¨¡ç³éé¡¹ï¼æ¥è¯¢å°ä½¿ç¨ top_terms_blended_freqs_${max_expansions} ä½ä¸ºå¶éåæ¹æ³ï¼fuzzy_rewrite åæ°åè®¸æ§å¶æ¥è¯¢å°å¦ä½è¢«éåã\n\né»è®¤æåµä¸åè®¸æ¨¡ç³åè½¬ (ab â ba)ï¼ä½å¯ä»¥éè¿å° fuzzy_transpositions è®¾ç½®ä¸º false æ¥ç¦ç¨ã\n\nGET /_search\n{\n  "query": {\n    "match": {\n      "message": {\n        "query": "this is a testt",\n        "fuzziness": "AUTO"\n      }\n    }\n  }\n}\n\n\n# zero terms æ¥è¯¢\n\nå¦æä½¿ç¨çåæå¨å stop è¿æ»¤å¨ä¸æ ·å é¤æ¥è¯¢ä¸­çæææ è®°ï¼åé»è®¤è¡ä¸ºæ¯ä¸å¹éä»»ä½ææ¡£ãå¯ä»¥ä½¿ç¨ zero_terms_query éé¡¹æ¥æ¹åé»è®¤è¡ä¸ºï¼å®æ¥å noneï¼é»è®¤ï¼å all ï¼ç¸å½äº match_all æ¥è¯¢ï¼ã\n\nGET /_search\n{\n  "query": {\n    "match": {\n      "message": {\n        "query": "to be or not to be",\n        "operator": "and",\n        "zero_terms_query": "all"\n      }\n    }\n  }\n}\n\n\n\n# match_bool_prefix query\n\nmatch_bool_prefix query åæå¶è¾å¥å¹¶æ ¹æ®è¿äºè¯æé ä¸ä¸ªå¸å°æ¥è¯¢ãé¤äºæåä¸ä¸ªæ¯è¯­ä¹å¤çæ¯ä¸ªæ¯è¯­é½ç¨äºæ¯è¯­æ¥è¯¢ãæåä¸ä¸ªè¯ç¨äº prefix queryã\n\nç¤ºä¾ï¼\n\nGET /_search\n{\n  "query": {\n    "match_bool_prefix" : {\n      "message" : "quick brown f"\n    }\n  }\n}\n\n\nç­ä»·äº\n\nGET /_search\n{\n  "query": {\n    "bool" : {\n      "should": [\n        { "term": { "message": "quick" }},\n        { "term": { "message": "brown" }},\n        { "prefix": { "message": "f"}}\n      ]\n    }\n  }\n}\n\n\nmatch_bool_prefix query å match_phrase_prefix query ä¹é´çä¸ä¸ªéè¦åºå«æ¯ï¼match_phrase_prefix query å°å¶ term å¹éä¸ºç­è¯­ï¼ä½ match_bool_prefix query å¯ä»¥å¨ä»»ä½ä½ç½®å¹éå¶ termã\n\nä¸é¢çç¤ºä¾ match_bool_prefix query æ¥è¯¢å¯ä»¥å¹éåå« quick brown fox çå­æ®µï¼ä½å®ä¹å¯ä»¥å¿«éå¹é brown foxãå®è¿å¯ä»¥å¹éåå« quickãbrown åä»¥ f å¼å¤´çå­æ®µï¼åºç°å¨ä»»ä½ä½ç½®ã\n\n\n# match_phrase query\n\nmatch_phrase query å³ç­è¯­å¹éï¼é¦åä¼æ query åå®¹åè¯ï¼åè¯å¨å¯ä»¥èªå®ä¹ï¼åæ¶ææ¡£è¿è¦æ»¡è¶³ä»¥ä¸ä¸¤ä¸ªæ¡ä»¶æä¼è¢«æç´¢å°ï¼\n\n 1. åè¯åææè¯é¡¹é½è¦åºç°å¨è¯¥å­æ®µä¸­ï¼ç¸å½äº and æä½ï¼ã\n 2. å­æ®µä¸­çè¯é¡¹é¡ºåºè¦ä¸è´ã\n\nä¾å¦ï¼æä»¥ä¸ 3 ä¸ªææ¡£ï¼ä½¿ç¨ match_phrase æ¥è¯¢ "How are you"ï¼åªæåä¸¤ä¸ªææ¡£ä¼è¢«å¹éï¼\n\nPUT demo/_create/1\n{ "desc": "How are you" }\n\nPUT demo/_create/2\n{ "desc": "How are you, Jack?"}\n\nPUT demo/_create/3\n{ "desc": "are you"}\n\nGET demo/_search\n{\n  "query": {\n    "match_phrase": {\n      "desc": "How are you"\n    }\n  }\n}\n\n\n> è¯´æï¼\n> \n> ä¸ä¸ªè¢«è®¤å®ä¸ºåç­è¯­ How are you å¹éçææ¡£ï¼å¿é¡»æ»¡è¶³ä»¥ä¸è¿äºè¦æ±ï¼\n> \n>  * Howã are å you éè¦å¨é¨åºç°å¨åä¸­ã\n>  * are çä½ç½®åºè¯¥æ¯ How çä½ç½®å¤§ 1 ã\n>  * you çä½ç½®åºè¯¥æ¯ How çä½ç½®å¤§ 2 ã\n\n\n# match_phrase_prefix query\n\nmatch_phrase_prefix query å match_phrase query ç±»ä¼¼ï¼åªä¸è¿ match_phrase_prefix query æåä¸ä¸ª term ä¼è¢«ä½ä¸ºåç¼å¹éã\n\nGET demo/_search\n{\n  "query": {\n    "match_phrase_prefix": {\n      "desc": "are yo"\n    }\n  }\n}\n\n\n\n# multi_match query\n\nmulti_match query æ¯ match query çåçº§ï¼ç¨äºæç´¢å¤ä¸ªå­æ®µã\n\nç¤ºä¾ï¼\n\nGET kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "multi_match": {\n      "query": 34.98,\n      "fields": [\n        "taxful_total_price",\n        "taxless_total_price"\n      ]\n    }\n  }\n}\n\n\nmulti_match query çæç´¢å­æ®µå¯ä»¥ä½¿ç¨ééç¬¦æå®ï¼ç¤ºä¾å¦ä¸ï¼\n\nGET kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "multi_match": {\n      "query": 34.98,\n      "fields": [\n        "taxful_*",\n        "taxless_total_price"\n      ]\n    }\n  }\n}\n\n\nåæ¶ï¼ä¹å¯ä»¥ç¨ææ°ç¬¦æå®æç´¢å­æ®µçæéã\n\nç¤ºä¾ï¼æå® taxful_total_price å­æ®µçæéæ¯ taxless_total_price å­æ®µç 3 åï¼å½ä»¤å¦ä¸ï¼\n\nGET kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "multi_match": {\n      "query": 34.98,\n      "fields": [\n        "taxful_total_price^3",\n        "taxless_total_price"\n      ]\n    }\n  }\n}\n\n\n\n# combined_fields query\n\ncombined_fields query æ¯ææç´¢å¤ä¸ªææ¬å­æ®µï¼å°±å¥½åå®ä»¬çåå®¹å·²è¢«ç´¢å¼å°ä¸ä¸ªç»åå­æ®µä¸­ä¸æ ·ãè¯¥æ¥è¯¢ä¼çæä»¥ term ä¸ºä¸­å¿çè¾å¥å­ç¬¦ä¸²è§å¾ï¼é¦åå®å°æ¥è¯¢å­ç¬¦ä¸²è§£æä¸ºç¬ç«ç termï¼ç¶åå¨ææå­æ®µä¸­æ¥æ¾æ¯ä¸ª termãå½å¹éç»æå¯è½è·¨è¶å¤ä¸ªææ¬å­æ®µæ¶ï¼æ­¤æ¥è¯¢ç¹å«æç¨ï¼ä¾å¦æç« çæ é¢ãæè¦åæ­£æï¼\n\nGET /_search\n{\n  "query": {\n    "combined_fields" : {\n      "query":      "database systems",\n      "fields":     [ "title", "abstract", "body"],\n      "operator":   "and"\n    }\n  }\n}\n\n\n# å­æ®µåç¼æé\n\nå­æ®µåç¼æéæ ¹æ®ç»åå­æ®µæ¨¡åè¿è¡è®¡ç®ãä¾å¦ï¼å¦æ title å­æ®µçæéä¸º 2ï¼åå¹éåº¦æåæ¶ä¼å° title ä¸­çæ¯ä¸ª term å½¢æçç»åå­æ®µï¼æåºç°ä¸¤æ¬¡è¿è¡æåã\n\n\n# common_terms query\n\n> 7.3.0 åºå¼\n\ncommon_terms query æ¯ä¸ç§å¨ä¸çºç²æ§è½çæåµä¸æ¿ä»£åç¨è¯æé«æç´¢åç¡®çåå¬åççæ¹æ¡ã\n\næ¥è¯¢ä¸­çæ¯ä¸ªè¯é¡¹é½æä¸å®çä»£ä»·ï¼ä»¥æç´¢âThe brown foxâä¸ºä¾ï¼query ä¼è¢«è§£ææä¸ä¸ªè¯é¡¹âtheââbrownâåâfoxâï¼æ¯ä¸ªè¯é¡¹é½ä¼å°ç´¢å¼ä¸­æ§è¡ä¸æ¬¡æ¥è¯¢ãå¾æ¾ç¶åå«âtheâçææ¡£éå¸¸å¤ï¼ç¸æ¯å¶ä»è¯é¡¹ï¼âtheâçéè¦æ§ä¼ä½å¾å¤ãä¼ ç»çè§£å³æ¹æ¡æ¯æâtheâå½ä½åç¨è¯å¤çï¼å»é¤åç¨è¯ä¹åå¯ä»¥åå°ç´¢å¼å¤§å°ï¼åæ¶å¨æç´¢æ¶åå°å¯¹åç¨è¯çæ¶ç¼©ã\n\nè½ç¶åç¨è¯å¯¹ææ¡£è¯åå½±åä¸å¤§ï¼ä½æ¯å½åç¨è¯ä»ç¶æéè¦æä¹çæ¶åï¼å»é¤åç¨è¯å°±ä¸æ¯å®ç¾çè§£å³æ¹æ¡äºãå¦æå»é¤åç¨è¯ï¼å°±æ æ³åºåâhappyâåânot happyâ, âTheââTo be or not to beâå°±ä¸ä¼å¨ç´¢å¼ä¸­å­å¨ï¼æç´¢çåç¡®çåå¬åçå°±ä¼éä½ã\n\ncommon_terms query æä¾äºä¸ç§è§£å³æ¹æ¡ï¼å®æ query åè¯åçè¯é¡¹åæéè¦è¯é¡¹ï¼ä½é¢è¯é¡¹ï¼åä¸éè¦çè¯é¡¹ï¼é«é¢è¯ï¼ä¹å°±æ¯ä¹åçåç¨è¯ï¼ãå¨æç´¢çæ¶åï¼é¦åæç´¢åéè¦è¯é¡¹å¹éçææ¡£ï¼è¿äºææ¡£æ¯è¯é¡¹åºç°è¾å°å¹¶ä¸è¯é¡¹å¯¹å¶è¯åå½±åè¾å¤§çææ¡£ãç¶åæ§è¡ç¬¬äºæ¬¡æ¥è¯¢ï¼æç´¢å¯¹è¯åå½±åè¾å°çé«é¢è¯é¡¹ï¼ä½æ¯ä¸è®¡ç®ææææ¡£çè¯åï¼èæ¯åªè®¡ç®ç¬¬ä¸æ¬¡æ¥è¯¢å·²ç»å¹éçææ¡£å¾åãå¦æä¸ä¸ªæ¥è¯¢ä¸­åªåå«é«é¢è¯ï¼é£ä¹ä¼éè¿ and è¿æ¥ç¬¦æ§è¡ä¸ä¸ªåç¬çæ¥è¯¢ï¼æ¢è¨ä¹ï¼ä¼æç´¢ææçè¯é¡¹ã\n\nè¯é¡¹æ¯é«é¢è¯è¿æ¯ä½é¢è¯æ¯éè¿ cutoff frequency æ¥è®¾ç½®éå¼çï¼åå¼å¯ä»¥æ¯ç»å¯¹é¢çï¼é¢çå¤§äº 1ï¼æèç¸å¯¹é¢çï¼0 ï½ 1ï¼ãcommon_terms query ææè¶£ä¹å¤å¨äºå®è½èªéåºç¹å®é¢åçåç¨è¯ï¼ä¾å¦ï¼å¨è§é¢æç®¡ç½ç«ä¸ï¼è¯¸å¦âclipâæâvideoâä¹ç±»çé«é¢è¯é¡¹å°èªå¨è¡¨ç°ä¸ºåç¨è¯ï¼æ é¡»ä¿çæå¨åè¡¨ã\n\nä¾å¦ï¼ææ¡£é¢çé«äº 0.1% çè¯é¡¹å°ä¼è¢«å½ä½é«é¢è¯é¡¹ï¼è¯é¢ä¹é´å¯ä»¥ç¨ low_freq_operatorãhigh_freq_operator åæ°è¿æ¥ãè®¾ç½®ä½é¢è¯æä½ç¬¦ä¸ºâandâä½¿ææçä½é¢è¯é½æ¯å¿é¡»æç´¢çï¼ç¤ºä¾ä»£ç å¦ä¸ï¼\n\nGET books/_search\n{\n\t"query": {\n\t\t"common": {\n\t\t\t"body": {\n\t\t\t\t"query": "nelly the elephant as a cartoon",\n\t\t\t\t"cutoff_frequency": 0.001,\n\t\t\t\t"low_freq_operator": "and"\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nä¸è¿°æä½ç­ä»·äºï¼\n\nGET books/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": [\n\t\t\t  { "term": { "body": "nelly" } },\n\t\t\t  { "term": { "body": "elephant" } },\n\t\t\t  { "term": { "body": "cartoon" } }\n\t\t\t],\n\t\t\t"should": [\n\t\t\t  { "term": { "body": "the" } },\n\t\t\t  { "term": { "body": "as" } },\n\t\t\t  { "term": { "body": "a" } }\n\t\t\t]\n\t\t}\n\t}\n}\n\n\n\n# query_string query\n\nquery_string query æ¯ä¸ Lucene æ¥è¯¢è¯­å¥çè¯­æ³ç»åéå¸¸ç´§å¯çä¸ç§æ¥è¯¢ï¼åè®¸å¨ä¸ä¸ªæ¥è¯¢è¯­å¥ä¸­ä½¿ç¨å¤ä¸ªç¹æ®æ¡ä»¶å³é®å­ï¼å¦ï¼AND | OR | NOTï¼å¯¹å¤ä¸ªå­æ®µè¿è¡æ¥è¯¢ï¼å»ºè®®çæ Lucene æ¥è¯¢è¯­æ³çç¨æ·å»ä½¿ç¨ã\n\nç¨æ·å¯ä»¥ä½¿ç¨ query_string query æ¥åå»ºåå«ééç¬¦ãè·¨å¤ä¸ªå­æ®µçæç´¢ç­å¤ææç´¢ãè½ç¶éç¨ï¼ä½æ¥è¯¢æ¯ä¸¥æ ¼çï¼å¦ææ¥è¯¢å­ç¬¦ä¸²åå«ä»»ä½æ æè¯­æ³ï¼åä¼è¿åéè¯¯ã\n\nç¤ºä¾ï¼\n\nGET /_search\n{\n  "query": {\n    "query_string": {\n      "query": "(new york city) OR (big apple)",\n      "default_field": "content"\n    }\n  }\n}\n\n\n\n# simple_query_string query\n\nsimple_query_string query æ¯ä¸ç§éåç´æ¥æ´é²ç»ç¨æ·ï¼å¹¶ä¸å·æéå¸¸å®åçæ¥è¯¢è¯­æ³çæ¥è¯¢è¯­å¥ï¼æ¥å Lucene æ¥è¯¢è¯­æ³ï¼è§£æè¿ç¨ä¸­åçéè¯¯ä¸ä¼æåºå¼å¸¸ã\n\nè½ç¶è¯­æ³æ¯ query_string query æ´ä¸¥æ ¼ï¼ä½ simple_query_string query ä¸ä¼è¿åæ æè¯­æ³çéè¯¯ãç¸åï¼å®ä¼å¿½ç¥æ¥è¯¢å­ç¬¦ä¸²çä»»ä½æ æé¨åã\n\nç¤ºä¾ï¼\n\nGET /_search\n{\n  "query": {\n    "simple_query_string" : {\n        "query": "\\"fried eggs\\" +(eggplant | potato) -frittata",\n        "fields": ["title^5", "body"],\n        "default_operator": "and"\n    }\n  }\n}\n\n\n# simple_query_string è¯­ä¹\n\n * +ï¼ç­ä»·äº AND æä½\n * |ï¼ç­ä»·äº OR æä½\n * -ï¼ç¸å½äº NOT æä½\n * "ï¼åè£ä¸äºæ è®°ä»¥è¡¨ç¤ºç¨äºæç´¢çç­è¯­\n * *ï¼è¯å°¾è¡¨ç¤ºåç¼æ¥è¯¢\n * ( and )ï¼è¡¨ç¤ºä¼åçº§\n * ~Nï¼è¯å°¾è¡¨ç¤ºè¡¨ç¤ºç¼è¾è·ç¦»ï¼æ¨¡ç³æ§ï¼\n * ~Nï¼å¨ä¸ä¸ªç­è¯­ä¹åè¡¨ç¤ºæº¢åºé\n\næ³¨æï¼è¦ä½¿ç¨ä¸é¢çå­ç¬¦ï¼è¯·ä½¿ç¨åææ  / å¯¹å¶è¿è¡è½¬ä¹ã\n\n\n# å¨ææ¥è¯¢å®æ´ç¤ºä¾\n\n#è®¾ç½® position_increment_gap\nDELETE groups\nPUT groups\n{\n  "mappings": {\n    "properties": {\n      "names":{\n        "type": "text",\n        "position_increment_gap": 0\n      }\n    }\n  }\n}\n\nGET groups/_mapping\n\nPOST groups/_doc\n{\n  "names": [ "John Water", "Water Smith"]\n}\n\nPOST groups/_search\n{\n  "query": {\n    "match_phrase": {\n      "names": {\n        "query": "Water Water",\n        "slop": 100\n      }\n    }\n  }\n}\n\nPOST groups/_search\n{\n  "query": {\n    "match_phrase": {\n      "names": "Water Smith"\n    }\n  }\n}\n\nDELETE groups\n\n\n\n# è¯é¡¹æ¥è¯¢\n\nTermï¼è¯é¡¹ï¼æ¯è¡¨è¾¾è¯­æçæå°åä½ãæç´¢åå©ç¨ç»è®¡è¯­è¨æ¨¡åè¿è¡èªç¶è¯­è¨å¤çé½éè¦å¤ç Termã\n\nå¨ææ¥è¯¢å¨æ§è¡æ¥è¯¢ä¹åä¼åææ¥è¯¢å­ç¬¦ä¸²ã\n\nä¸å¨ææ¥è¯¢ä¸åï¼è¯é¡¹æ¥è¯¢ä¸ä¼åè¯ï¼èæ¯å°è¾å¥ä½ä¸ºä¸ä¸ªæ´ä½ï¼å¨åæç´¢å¼ä¸­æ¥æ¾åç¡®çè¯é¡¹ãå¹¶ä¸ä½¿ç¨ç¸å³åº¦è®¡ç®å¬å¼ä¸ºæ¯ä¸ªåå«è¯¥è¯é¡¹çææ¡£è¿è¡ç¸å³åº¦è®¡ç®ãä¸è¨ä»¥æ¦ä¹ï¼è¯é¡¹æ¥è¯¢æ¯å¯¹è¯é¡¹è¿è¡ç²¾ç¡®å¹éãè¯é¡¹æ¥è¯¢éå¸¸ç¨äºç»æåæ°æ®ï¼å¦æ°å­ãæ¥æåæä¸¾ç±»åã\n\nè¯é¡¹æ¥è¯¢æä»¥ä¸ç±»åï¼\n\n * exists query\n * fuzzy query\n * ids query\n * prefix query\n * range query\n * regexp query\n * term query\n * terms query\n * type query\n * wildcard query\n\n\n# exists query\n\nexists query ä¼è¿åå­æ®µä¸­è³å°æä¸ä¸ªéç©ºå¼çææ¡£ã\n\nç±äºå¤ç§åå ï¼ææ¡£å­æ®µå¯è½ä¸å­å¨ç´¢å¼å¼ï¼\n\n * JSON ä¸­çå­æ®µä¸º null æ []\n * è¯¥å­æ®µå¨ mapping ä¸­éç½®äº "index" : false\n * å­æ®µå¼çé¿åº¦è¶è¿äº mapping ä¸­ç ignore_above è®¾ç½®\n * å­æ®µå¼æ ¼å¼éè¯¯ï¼å¹¶ä¸å¨ mapping ä¸­å®ä¹äº ignore_malformed\n\nç¤ºä¾ï¼\n\nGET kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "exists": {\n      "field": "email"\n    }\n  }\n}\n\n\nä»¥ä¸ææ¡£ä¼å¹éä¸é¢çæ¥è¯¢ï¼\n\n * { "user" : "jane" } æ user å­æ®µï¼ä¸ä¸ä¸ºç©ºã\n * { "user" : "" } æ user å­æ®µï¼å¼ä¸ºç©ºå­ç¬¦ä¸²ã\n * { "user" : "-" } æ user å­æ®µï¼å¼ä¸ä¸ºç©ºã\n * { "user" : [ "jane" ] } æ user å­æ®µï¼å¼ä¸ä¸ºç©ºã\n * { "user" : [ "jane", null ] } æ user å­æ®µï¼è³å°ä¸ä¸ªå¼ä¸ä¸ºç©ºå³å¯ã\n\nä¸é¢çææ¡£é½ä¸ä¼è¢«å¹éï¼\n\n * { "user" : null } è½ç¶æ user å­æ®µï¼ä½æ¯å¼ä¸ºç©ºã\n * { "user" : [] } è½ç¶æ user å­æ®µï¼ä½æ¯å¼ä¸ºç©ºã\n * { "user" : [null] } è½ç¶æ user å­æ®µï¼ä½æ¯å¼ä¸ºç©ºã\n * { "foo" : "bar" } æ²¡æ user å­æ®µã\n\n\n# fuzzy query\n\nfuzzy queryï¼æ¨¡ç³æ¥è¯¢ï¼è¿ååå«ä¸æç´¢è¯ç¸ä¼¼çè¯çææ¡£ãES ä½¿ç¨ Levenshtein edit distanceï¼Levenshtein ç¼è¾è·ç¦»ï¼æµéç¸ä¼¼åº¦ææ¨¡ç³åº¦ã\n\nç¼è¾è·ç¦»æ¯å°ä¸ä¸ªæ¯è¯­è½¬æ¢ä¸ºå¦ä¸ä¸ªæ¯è¯­æéçåä¸ªå­ç¬¦æ´æ¹çæ°éãè¿äºååå¯è½åæ¬ï¼\n\n * æ¹åä¸ä¸ªå­ç¬¦ï¼ï¼box -> foxï¼\n * å é¤ä¸ä¸ªå­ç¬¦ï¼ï¼black -> lackï¼\n * æå¥ä¸ä¸ªå­ç¬¦ï¼ï¼sic -> sickï¼\n * åè½¬ä¸¤ä¸ªç¸é»å­ç¬¦ï¼ï¼act â catï¼\n\nä¸ºäºæ¾å°ç¸ä¼¼çè¯æ¡ï¼fuzzy query ä¼å¨æå®çç¼è¾è·ç¦»ååå»ºæç´¢è¯æ¡çææå¯è½åä½ææ©å±éãç¶åè¿åå®å¨å¹éä»»ææ©å±çææ¡£ã\n\nGET books/_search\n{\n  "query": {\n    "fuzzy": {\n      "user.id": {\n        "value": "ki",\n        "fuzziness": "AUTO",\n        "max_expansions": 50,\n        "prefix_length": 0,\n        "transpositions": true,\n        "rewrite": "constant_score"\n      }\n    }\n  }\n}\n\n\næ³¨æï¼å¦æéç½®äº search.allow_expensive_queries ï¼å fuzzy query ä¸è½æ§è¡ã\n\n\n# ids query\n\nids query æ ¹æ® ID è¿åææ¡£ã æ­¤æ¥è¯¢ä½¿ç¨å­å¨å¨ _id å­æ®µä¸­çææ¡£ IDã\n\nGET /_search\n{\n  "query": {\n    "ids" : {\n      "values" : ["1", "4", "100"]\n    }\n  }\n}\n\n\n\n# prefix query\n\nprefix query ç¨äºæ¥è¯¢æä¸ªå­æ®µä¸­åå«æå®åç¼çææ¡£ã\n\næ¯å¦æ¥è¯¢ user.id ä¸­å«æä»¥ ki ä¸ºåç¼çå³é®è¯çææ¡£ï¼é£ä¹å«æ kindãkid ç­ææä»¥ ki å¼å¤´å³é®è¯çææ¡£é½ä¼è¢«å¹éã\n\nGET /_search\n{\n  "query": {\n    "prefix": {\n      "user.id": {\n        "value": "ki"\n      }\n    }\n  }\n}\n\n\n\n# range query\n\nrange query å³èå´æ¥è¯¢ï¼ç¨äºå¹éå¨æä¸èå´åçæ°å¼åãæ¥æç±»åæèå­ç¬¦ä¸²åå­æ®µçææ¡£ãæ¯å¦æç´¢åªäºä¹¦ç±çä»·æ ¼å¨ 50 å° 100 ä¹é´ãåªäºä¹¦ç±çåºçæ¶é´å¨ 2015 å¹´å° 2019 å¹´ä¹é´ãä½¿ç¨ range æ¥è¯¢åªè½æ¥è¯¢ä¸ä¸ªå­æ®µï¼ä¸è½ä½ç¨å¨å¤ä¸ªå­æ®µä¸ã\n\nrange æ¥è¯¢æ¯æçåæ°æä»¥ä¸å ç§ï¼\n\n * gtï¼å¤§äº\n\n * gteï¼å¤§äºç­äº\n\n * ltï¼å°äº\n\n * lteï¼å°äºç­äº\n\n * formatï¼å¦æå­æ®µæ¯ Date ç±»åï¼å¯ä»¥è®¾ç½®æ¥ææ ¼å¼å\n\n * time_zoneï¼æ¶åº\n\n * relationï¼æç¤ºèå´æ¥è¯¢å¦ä½å¹éèå´å­æ®µçå¼ã\n   \n   * INTERSECTS (Default)ï¼å¹éä¸æ¥è¯¢å­æ®µå¼èå´ç¸äº¤çææ¡£ã\n   * CONTAINSï¼å¹éå®å¨åå«æ¥è¯¢å­æ®µå¼çææ¡£ã\n   * WITHINï¼å¹éå·æå®å¨å¨æ¥è¯¢èå´åçèå´å­æ®µå¼çææ¡£ã\n\nç¤ºä¾ï¼æ°å¼èå´æ¥è¯¢\n\nGET kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "range": {\n      "taxful_total_price": {\n        "gt": 10,\n        "lte": 50\n      }\n    }\n  }\n}\n\n\nç¤ºä¾ï¼æ¥æèå´æ¥è¯¢\n\nGET kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "range": {\n      "order_date": {\n        "time_zone": "+00:00",\n        "gte": "2018-01-01T00:00:00",\n        "lte": "now"\n      }\n    }\n  }\n}\n\n\n\n# regexp query\n\nregexp query è¿åä¸æ­£åè¡¨è¾¾å¼ç¸å¹éç term æå±çææ¡£ã\n\næ­£åè¡¨è¾¾å¼æ¯ä¸ç§ä½¿ç¨å ä½ç¬¦å­ç¬¦å¹éæ°æ®æ¨¡å¼çæ¹æ³ï¼ç§°ä¸ºè¿ç®ç¬¦ã\n\nç¤ºä¾ï¼ä»¥ä¸æç´¢è¿å user.id å­æ®µåå«ä»»ä½ä»¥ k å¼å¤´å¹¶ä»¥ y ç»å°¾çææ¡£ã .* è¿ç®ç¬¦å¹éä»»ä½é¿åº¦çä»»ä½å­ç¬¦ï¼åæ¬æ å­ç¬¦ãå¹éé¡¹å¯ä»¥åæ¬ kyãkay å kimchyã\n\nGET /_search\n{\n  "query": {\n    "regexp": {\n      "user.id": {\n        "value": "k.*y",\n        "flags": "ALL",\n        "case_insensitive": true,\n        "max_determinized_states": 10000,\n        "rewrite": "constant_score"\n      }\n    }\n  }\n}\n\n\n> æ³¨æï¼å¦æéç½®äºsearch.allow_expensive_queries ï¼å regexp query ä¼è¢«ç¦ç¨ã\n\n\n# term query\n\nterm query ç¨æ¥æ¥æ¾æå®å­æ®µä¸­åå«ç»å®åè¯çææ¡£ï¼term æ¥è¯¢ä¸è¢«è§£æï¼åªææ¥è¯¢è¯åææ¡£ä¸­çè¯ç²¾ç¡®å¹éæä¼è¢«æç´¢å°ï¼åºç¨åºæ¯ä¸ºæ¥è¯¢äººåãå°åç­éè¦ç²¾åå¹éçéæ±ã\n\nç¤ºä¾ï¼\n\n# 1. åå»ºä¸ä¸ªç´¢å¼\nDELETE my-index-000001\nPUT my-index-000001\n{\n  "mappings": {\n    "properties": {\n      "full_text": { "type": "text" }\n    }\n  }\n}\n\n# 2. ä½¿ç¨ "Quick Brown Foxes!" å³é®å­æ¥ "full_text" å­æ®µ\nPUT my-index-000001/_doc/1\n{\n  "full_text": "Quick Brown Foxes!"\n}\n\n# 3. ä½¿ç¨ term æ¥è¯¢\nGET my-index-000001/_search?pretty\n{\n  "query": {\n    "term": {\n      "full_text": "Quick Brown Foxes!"\n    }\n  }\n}\n# å ä¸º full_text å­æ®µä¸ååå«ç¡®åç Term ââ "Quick Brown Foxes!"ï¼æä»¥ term query æç´¢ä¸å°ä»»ä½ç»æ\n\n# 4. ä½¿ç¨ match æ¥è¯¢\nGET my-index-000001/_search?pretty\n{\n  "query": {\n    "match": {\n      "full_text": "Quick Brown Foxes!"\n    }\n  }\n}\n\nDELETE my-index-000001\n\n\n> â ï¸ æ³¨æï¼åºé¿å term æ¥è¯¢å¯¹ text å­æ®µä½¿ç¨æ¥è¯¢ã\n> \n> é»è®¤æåµä¸ï¼Elasticsearch éå¯¹ text å­æ®µçå¼è¿è¡è§£æåè¯ï¼è¿ä¼ä½¿æ¥æ¾ text å­æ®µå¼çç²¾ç¡®å¹éåå¾å°é¾ã\n> \n> è¦æç´¢ text å­æ®µå¼ï¼éæ¹ç¨ match æ¥è¯¢ã\n\n\n# terms query\n\nterms query ä¸ term query ç¸åï¼ä½å¯ä»¥æç´¢å¤ä¸ªå¼ã\n\nterms query æ¥è¯¢åæ°ï¼\n\n * indexï¼ç´¢å¼å\n * idï¼ææ¡£ ID\n * pathï¼è¦ä»ä¸­è·åå­æ®µå¼çå­æ®µçåç§°ï¼å³æç´¢å³é®å­\n * routingï¼éå¡«ï¼ï¼è¦ä»ä¸­è·å term å¼çææ¡£çèªå®ä¹è·¯ç±å¼ãå¦æå¨ç´¢å¼ææ¡£æ¶æä¾äºèªå®ä¹è·¯ç±å¼ï¼åæ­¤åæ°æ¯å¿éçã\n\nç¤ºä¾ï¼\n\n# 1. åå»ºä¸ä¸ªç´¢å¼\nDELETE my-index-000001\nPUT my-index-000001\n{\n  "mappings": {\n    "properties": {\n      "color": { "type": "keyword" }\n    }\n  }\n}\n\n# 2. åå¥ä¸ä¸ªææ¡£\nPUT my-index-000001/_doc/1\n{\n  "color": [\n    "blue",\n    "green"\n  ]\n}\n\n# 3. åå¥å¦ä¸ä¸ªææ¡£\nPUT my-index-000001/_doc/2\n{\n  "color": "blue"\n}\n\n# 3. ä½¿ç¨ terms query\nGET my-index-000001/_search?pretty\n{\n  "query": {\n    "terms": {\n      "color": {\n        "index": "my-index-000001",\n        "id": "2",\n        "path": "color"\n      }\n    }\n  }\n}\n\nDELETE my-index-000001\n\n\n\n# type query\n\n> 7.0.0 ååºå¼\n\ntype query ç¨äºæ¥è¯¢å·ææå®ç±»åçææ¡£ã\n\nç¤ºä¾ï¼\n\nGET /_search\n{\n  "query": {\n    "type": {\n      "value": "_doc"\n    }\n  }\n}\n\n\n\n# wildcard query\n\nwildcard query å³ééç¬¦æ¥è¯¢ï¼è¿åä¸ééç¬¦æ¨¡å¼å¹éçææ¡£ã\n\n? ç¨æ¥å¹éä¸ä¸ªä»»æå­ç¬¦ï¼* ç¨æ¥å¹éé¶ä¸ªæèå¤ä¸ªå­ç¬¦ã\n\nç¤ºä¾ï¼ä»¥ä¸æç´¢è¿å user.id å­æ®µåå«ä»¥ ki å¼å¤´å¹¶ä»¥ y ç»å°¾çæ¯è¯­çææ¡£ãè¿äºå¹éé¡¹å¯ä»¥åæ¬ kiyãkity æ kimchyã\n\nGET /_search\n{\n  "query": {\n    "wildcard": {\n      "user.id": {\n        "value": "ki*y",\n        "boost": 1.0,\n        "rewrite": "constant_score"\n      }\n    }\n  }\n}\n\n\n> æ³¨æï¼å¦æéç½®äºsearch.allow_expensive_queries ï¼åwildcard query ä¼è¢«ç¦ç¨ã\n\n\n# è¯é¡¹æ¥è¯¢å®æ´ç¤ºä¾\n\nDELETE products\nPUT products\n{\n  "settings": {\n    "number_of_shards": 1\n  }\n}\n\nPOST /products/_bulk\n{ "index": { "_id": 1 }}\n{ "productID" : "XHDK-A-1293-#fJ3","desc":"iPhone" }\n{ "index": { "_id": 2 }}\n{ "productID" : "KDKE-B-9947-#kL5","desc":"iPad" }\n{ "index": { "_id": 3 }}\n{ "productID" : "JODL-X-1937-#pV7","desc":"MBP" }\n\nGET /products\n\nPOST /products/_search\n{\n  "query": {\n    "term": {\n      "desc": {\n        //"value": "iPhone"\n        "value":"iphone"\n      }\n    }\n  }\n}\n\nPOST /products/_search\n{\n  "query": {\n    "term": {\n      "desc.keyword": {\n        //"value": "iPhone"\n        //"value":"iphone"\n      }\n    }\n  }\n}\n\nPOST /products/_search\n{\n  "query": {\n    "term": {\n      "productID": {\n        "value": "XHDK-A-1293-#fJ3"\n      }\n    }\n  }\n}\n\nPOST /products/_search\n{\n  //"explain": true,\n  "query": {\n    "term": {\n      "productID.keyword": {\n        "value": "XHDK-A-1293-#fJ3"\n      }\n    }\n  }\n}\n\nPOST /products/_search\n{\n  "explain": true,\n  "query": {\n    "constant_score": {\n      "filter": {\n        "term": {\n          "productID.keyword": "XHDK-A-1293-#fJ3"\n        }\n      }\n\n    }\n  }\n}\n\n\n\n# å¤åæ¥è¯¢\n\nå¤åæ¥è¯¢å°±æ¯æä¸äºç®åæ¥è¯¢ç»åå¨ä¸èµ·å®ç°æ´å¤æçæ¥è¯¢éæ±ï¼é¤æ­¤ä¹å¤ï¼å¤åæ¥è¯¢è¿å¯ä»¥æ§å¶å¦å¤ä¸ä¸ªæ¥è¯¢çè¡ä¸ºã\n\n\n# bool query\n\nbool æ¥è¯¢å¯ä»¥æä»»æå¤ä¸ªç®åæ¥è¯¢ç»åå¨ä¸èµ·ï¼ä½¿ç¨ mustãshouldãmust_notãfilter éé¡¹æ¥è¡¨ç¤ºç®åæ¥è¯¢ä¹é´çé»è¾ï¼æ¯ä¸ªéé¡¹é½å¯ä»¥åºç° 0 æ¬¡å°å¤æ¬¡ï¼å®ä»¬çå«ä¹å¦ä¸ï¼\n\n * must ææ¡£å¿é¡»å¹é must éé¡¹ä¸çæ¥è¯¢æ¡ä»¶ï¼ç¸å½äºé»è¾è¿ç®ç ANDï¼ä¸åä¸ææ¡£ç¸å³åº¦çè¯åã\n * should ææ¡£å¯ä»¥å¹é should éé¡¹ä¸çæ¥è¯¢æ¡ä»¶ä¹å¯ä»¥ä¸å¹éï¼ç¸å½äºé»è¾è¿ç®ç ORï¼ä¸åä¸ææ¡£ç¸å³åº¦çè¯åã\n * must_not ä¸ must ç¸åï¼å¹éè¯¥éé¡¹ä¸çæ¥è¯¢æ¡ä»¶çææ¡£ä¸ä¼è¢«è¿åï¼éè¦æ³¨æçæ¯ï¼must_not è¯­å¥ä¸ä¼å½±åè¯åï¼å®çä½ç¨åªæ¯å°ä¸ç¸å³çææ¡£æé¤ã\n * filter å must ä¸æ ·ï¼å¹é filter éé¡¹ä¸çæ¥è¯¢æ¡ä»¶çææ¡£æä¼è¢«è¿åï¼ä½æ¯ filter ä¸è¯åï¼åªèµ·å°è¿æ»¤åè½ï¼ä¸ must_not ç¸åã\n\nåè®¾è¦æ¥è¯¢ title ä¸­åå«å³é®è¯ javaï¼å¹¶ä¸ price ä¸è½é«äº 70ï¼description å¯ä»¥åå«ä¹å¯ä»¥ä¸åå«èææºçä¹¦ç±ï¼æé  bool æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET books/_search\n{\n  "query": {\n    "bool": {\n      "filter": {\n        "term": {\n          "status": 1\n        }\n      },\n      "must_not": {\n        "range": {\n          "price": {\n            "gte": 70\n          }\n        }\n      },\n      "must": {\n        "match": {\n          "title": "java"\n        }\n      },\n      "should": [\n        {\n          "match": {\n            "description": "èææº"\n          }\n        }\n      ],\n      "minimum_should_match": 1\n    }\n  }\n}\n\n\næå³å¸å°æ¥è¯¢æ´è¯¦ç»çä¿¡æ¯åè bool queryï¼ç»åæ¥è¯¢ï¼è¯¦è§£ã\n\n\n# boosting query\n\nboosting æ¥è¯¢ç¨äºéè¦å¯¹ä¸¤ä¸ªæ¥è¯¢çè¯åè¿è¡è°æ´çåºæ¯ï¼boosting æ¥è¯¢ä¼æä¸¤ä¸ªæ¥è¯¢å°è£å¨ä¸èµ·å¹¶éä½å¶ä¸­ä¸ä¸ªæ¥è¯¢çè¯åã\n\nboosting æ¥è¯¢åæ¬ positiveãnegative å negative_boost ä¸ä¸ªé¨åï¼positive ä¸­çæ¥è¯¢è¯åä¿æä¸åï¼negative ä¸­çæ¥è¯¢ä¼éä½ææ¡£è¯åï¼negative_boost ææ negative ä¸­éä½çæå¼ãå¦ææä»¬æ³å¯¹ 2015 å¹´ä¹ååºççä¹¦éä½è¯åï¼å¯ä»¥æé ä¸ä¸ª boosting æ¥è¯¢ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET books/_search\n{\n\t"query": {\n\t\t"boosting": {\n\t\t\t"positive": {\n\t\t\t\t"match": {\n\t\t\t\t\t"title": "python"\n\t\t\t\t}\n\t\t\t},\n\t\t\t"negative": {\n\t\t\t\t"range": {\n\t\t\t\t\t"publish_time": {\n\t\t\t\t\t\t"lte": "2015-01-01"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t"negative_boost": 0.2\n\t\t}\n\t}\n}\n\n\nboosting æ¥è¯¢ä¸­æå®äºæå¶å å­ä¸º 0.2ï¼publish_time çå¼å¨ 2015-01-01 ä¹åçææ¡£å¾åä¸åï¼publish_time çå¼å¨ 2015-01-01 ä¹åçææ¡£å¾åä¸ºåå¾åç 0.2 åã\n\n\n# constant_score query\n\nconstantscore query åè£ä¸ä¸ª filter queryï¼å¹¶è¿åå¹éè¿æ»¤å¨æ¥è¯¢æ¡ä»¶çææ¡£ï¼ä¸å®ä»¬çç¸å³æ§è¯åé½ç­äº _boost åæ°å¼ï¼å¯ä»¥çè§£ä¸ºåæçåºäº tf-idf æ bm25 çç¸å³ååºå®ä¸º 1.0ï¼æä»¥æç»è¯åä¸º 1.0 * boostï¼å³ç­äº boost åæ°å¼ï¼ãä¸é¢çæ¥è¯¢è¯­å¥ä¼è¿å title å­æ®µä¸­å«æå³é®è¯ elasticsearch çææ¡£ï¼ææææ¡£çè¯åé½æ¯ 1.8ï¼\n\nGET books/_search\n{\n  "query": {\n    "constant_score": {\n      "filter": {\n        "term": {\n          "title": "elasticsearch"\n        }\n      },\n      "boost": 1.8\n    }\n  }\n}\n\n\n\n# dis_max query\n\ndis_max query ä¸ bool query æä¸å®èç³»ä¹æä¸å®åºå«ï¼dis_max query æ¯æå¤å¹¶åæ¥è¯¢ï¼å¯è¿åä¸ä»»ææ¥è¯¢æ¡ä»¶å­å¥å¹éçä»»ä½ææ¡£ç±»åãä¸ bool æ¥è¯¢å¯ä»¥å°ææå¹éæ¥è¯¢çåæ°ç¸ç»åä½¿ç¨çæ¹å¼ä¸åï¼dis_max æ¥è¯¢åªä½¿ç¨æä½³å¹éæ¥è¯¢æ¡ä»¶çåæ°ãè¯·çä¸é¢çä¾å­ï¼\n\nGET books/_search\n{\n\t"query": {\n\t\t"dis_max": {\n\t\t\t"tie_breaker": 0.7,\n\t\t\t"boost": 1.2,\n\t\t\t"queries": [{\n\t\t\t\t\t"term": {\n\t\t\t\t\t\t"age": 34\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t"term": {\n\t\t\t\t\t\t"age": 35\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t}\n}\n\n\n\n# function_score query\n\nfunction_score query å¯ä»¥ä¿®æ¹æ¥è¯¢çææ¡£å¾åï¼è¿ä¸ªæ¥è¯¢å¨æäºæåµä¸éå¸¸æç¨ï¼æ¯å¦éè¿è¯åå½æ°è®¡ç®ææ¡£å¾åä»£ä»·è¾é«ï¼å¯ä»¥æ¹ç¨è¿æ»¤å¨å èªå®ä¹è¯åå½æ°çæ¹å¼æ¥åä»£ä¼ ç»çè¯åæ¹å¼ã\n\nä½¿ç¨ function_score queryï¼ç¨æ·éè¦å®ä¹ä¸ä¸ªæ¥è¯¢åä¸è³å¤ä¸ªè¯åå½æ°ï¼è¯åå½æ°ä¼å¯¹æ¥è¯¢å°çæ¯ä¸ªææ¡£åå«è®¡ç®å¾åã\n\nä¸é¢è¿æ¡æ¥è¯¢è¯­å¥ä¼è¿å books ç´¢å¼ä¸­çææææ¡£ï¼ææ¡£çæå¤§å¾åä¸º 5ï¼æ¯ä¸ªææ¡£çå¾åéæºçæï¼æéçè®¡ç®æ¨¡å¼ä¸ºç¸ä¹æ¨¡å¼ã\n\nGET books/_search\n{\n  "query": {\n    "function_score": {\n      "query": {\n        "match all": {}\n      },\n      "boost": "5",\n      "random_score": {},\n      "boost_mode": "multiply"\n    }\n  }\n}\n\n\nä½¿ç¨èæ¬èªå®ä¹è¯åå¬å¼ï¼è¿éæ price å¼çååä¹ä¸å¼æ¹ä½ä¸ºæ¯ä¸ªææ¡£çå¾åï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET books/_search\n{\n  "query": {\n    "function_score": {\n      "query": {\n        "match": {\n          "title": "java"\n        }\n      },\n      "script_score": {\n        "inline": "Math.sqrt(doc[\'price\'].value/10)"\n      }\n    }\n  }\n}\n\n\nå³äº function_score çæ´å¤è¯¦ç»åå®¹è¯·æ¥ç Elasticsearch function_score æ¥è¯¢æå¼ºè¯¦è§£ã\n\n\n# indices query\n\nindices query éç¨äºéè¦å¨å¤ä¸ªç´¢å¼ä¹é´è¿è¡æ¥è¯¢çåºæ¯ï¼å®åè®¸æå®ä¸ä¸ªç´¢å¼åå­åè¡¨ååé¨æ¥è¯¢ãindices query ä¸­æ query å no_match_query ä¸¤é¨åï¼query ä¸­ç¨äºæç´¢æå®ç´¢å¼åè¡¨ä¸­çææ¡£ï¼no_match_query ä¸­çæ¥è¯¢æ¡ä»¶ç¨äºæç´¢æå®ç´¢å¼åè¡¨ä¹å¤çææ¡£ãä¸é¢çæ¥è¯¢è¯­å¥å®ç°äºæç´¢ç´¢å¼ booksãbooks2 ä¸­ title å­æ®µåå«å³é®å­ javascriptï¼å¶ä»ç´¢å¼ä¸­ title å­æ®µåå« basketball çææ¡£ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET books/_search\n{\n\t"query": {\n\t\t"indices": {\n\t\t\t"indices": ["books", "books2"],\n\t\t\t"query": {\n\t\t\t\t"match": {\n\t\t\t\t\t"title": "javascript"\n\t\t\t\t}\n\t\t\t},\n\t\t\t"no_match_query": {\n\t\t\t\t"term": {\n\t\t\t\t\t"title": "basketball"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# åµå¥æ¥è¯¢\n\nå¨ Elasticsearch è¿æ ·çåå¸å¼ç³»ç»ä¸­æ§è¡å¨ SQL é£æ ¼çè¿æ¥æ¥è¯¢ä»£ä»·æè´µï¼æ¯ä¸å¯è¡çãç¸åºå°ï¼ä¸ºäºå®ç°æ°´å¹³è§æ¨¡å°æ©å±ï¼Elasticsearch æä¾äºä»¥ä¸ä¸¤ç§å½¢å¼ç joinï¼\n\n * nested queryï¼åµå¥æ¥è¯¢ï¼\n   \n   ææ¡£ä¸­å¯è½åå«åµå¥ç±»åçå­æ®µï¼è¿äºå­æ®µç¨æ¥ç´¢å¼ä¸äºæ°ç»å¯¹è±¡ï¼æ¯ä¸ªå¯¹è±¡é½å¯ä»¥ä½ä¸ºä¸æ¡ç¬ç«çææ¡£è¢«æ¥è¯¢åºæ¥ã\n\n * has_child queryï¼æå­æ¥è¯¢ï¼å has_parent queryï¼æç¶æ¥è¯¢ï¼\n   \n   ç¶å­å³ç³»å¯ä»¥å­å¨åä¸ªçç´¢å¼çä¸¤ä¸ªç±»åçææ¡£ä¹é´ãhas_child æ¥è¯¢å°è¿åå¶å­ææ¡£è½æ»¡è¶³ç¹å®æ¥è¯¢çç¶ææ¡£ï¼è has_parent åè¿åå¶ç¶ææ¡£è½æ»¡è¶³ç¹å®æ¥è¯¢çå­ææ¡£ã\n\n\n# nested query\n\nææ¡£ä¸­å¯è½åå«åµå¥ç±»åçå­æ®µï¼è¿äºå­æ®µç¨æ¥ç´¢å¼ä¸äºæ°ç»å¯¹è±¡ï¼æ¯ä¸ªå¯¹è±¡é½å¯ä»¥ä½ä¸ºä¸æ¡ç¬ç«çææ¡£è¢«æ¥è¯¢åºæ¥ï¼ç¨åµå¥æ¥è¯¢ï¼ã\n\nPUT /my_index\n{\n\t"mappings": {\n\t\t"type1": {\n\t\t\t"properties": {\n\t\t\t\t"obj1": {\n\t\t\t\t\t"type": "nested"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# has_child query\n\nææ¡£çç¶å­å³ç³»åå»ºç´¢å¼æ¶å¨æ å°ä¸­å£°æï¼è¿éä»¥åå·¥ï¼employeeï¼åå·¥ä½åå¸ï¼branchï¼ä¸ºä¾ï¼å®ä»¬å±äºä¸åçç±»åï¼ç¸å½äºæ°æ®åºä¸­çä¸¤å¼ è¡¨ï¼å¦ææ³æåå·¥åä»ä»¬å·¥ä½çåå¸å³èèµ·æ¥ï¼éè¦åè¯ Elasticsearch ææ¡£ä¹é´çç¶å­å³ç³»ï¼è¿é employee æ¯ child typeï¼branch æ¯ parent typeï¼å¨æ å°ä¸­å£°æï¼æ§è¡å½ä»¤ï¼\n\nPUT /company\n{\n\t"mappings": {\n\t\t"branch": {},\n\t\t"employee": {\n\t\t\t"parent": { "type": "branch" }\n\t\t}\n\t}\n}\n\n\nä½¿ç¨ bulk api ç´¢å¼ branch ç±»åä¸çææ¡£ï¼å½ä»¤å¦ä¸ï¼\n\nPOST company/branch/_bulk\n{ "index": { "_id": "london" }}\n{ "name": "London Westminster","city": "London","country": "UK" }\n{ "index": { "_id": "liverpool" }}\n{ "name": "Liverpool Central","city": "Liverpool","country": "UK" }\n{ "index": { "_id": "paris" }}\n{ "name": "Champs Elysees","city": "Paris","country": "France" }\n\n\næ·»å åå·¥æ°æ®ï¼\n\nPOST company/employee/_bulk\n{ "index": { "_id": 1,"parent":"london" }}\n{ "name": "Alice Smith","dob": "1970-10-24","hobby": "hiking" }\n{ "index": { "_id": 2,"parent":"london" }}\n{ "name": "Mark Tomas","dob": "1982-05-16","hobby": "diving" }\n{ "index": { "_id": 3,"parent":"liverpool" }}\n{ "name": "Barry Smith","dob": "1979-04-01","hobby": "hiking" }\n{ "index": { "_id": 4,"parent":"paris" }}\n{ "name": "Adrien Grand","dob": "1987-05-11","hobby": "horses" }\n\n\néè¿å­ææ¡£æ¥è¯¢ç¶ææ¡£è¦ä½¿ç¨ has_child æ¥è¯¢ãä¾å¦ï¼æç´¢ 1980 å¹´ä»¥ååºççåå·¥æå¨çåæ¯æºæï¼employee ä¸­ 1980 å¹´ä»¥ååºççæ Mark Thomas å Adrien Grandï¼ä»ä»¬åå«å¨ london å parisï¼æ§è¡ä»¥ä¸æ¥è¯¢å½ä»¤è¿è¡éªè¯ï¼\n\nGET company/branch/_search\n{\n\t"query": {\n\t\t"has_child": {\n\t\t\t"type": "employee",\n\t\t\t"query": {\n\t\t\t\t"range": { "dob": { "gte": "1980-01-01" } }\n\t\t\t}\n\t\t}\n\t}\n}\n\n\næç´¢åªäºæºæä¸­æåä¸º âAlice Smithâ çåå·¥ï¼å ä¸ºä½¿ç¨ match æ¥è¯¢ï¼ä¼è§£æä¸º âAliceâ å âSmithâï¼æä»¥ Alice Smith å Barry Smith æå¨çæºæä¼è¢«å¹éï¼æ§è¡ä»¥ä¸æ¥è¯¢å½ä»¤è¿è¡éªè¯ï¼\n\nGET company/branch/_search\n{\n\t"query": {\n\t\t"has_child": {\n\t\t\t"type": "employee",\n\t\t\t"score_mode": "max",\n\t\t\t"query": {\n\t\t\t\t"match": { "name": "Alice Smith" }\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nå¯ä»¥ä½¿ç¨ min_children æå®å­ææ¡£çæå°ä¸ªæ°ãä¾å¦ï¼æç´¢æå°å«æä¸¤ä¸ª employee çæºæï¼æ¥è¯¢å½ä»¤å¦ä¸ï¼\n\nGET company/branch/_search?pretty\n{\n\t"query": {\n\t\t"has_child": {\n\t\t\t"type": "employee",\n\t\t\t"min_children": 2,\n\t\t\t"query": {\n\t\t\t\t"match_all": {}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# has_parent query\n\néè¿ç¶ææ¡£æ¥è¯¢å­ææ¡£ä½¿ç¨ has_parent æ¥è¯¢ãæ¯å¦ï¼æç´¢åªäº employee å·¥ä½å¨ UKï¼æ¥è¯¢å½ä»¤å¦ä¸ï¼\n\nGET company/employee/_search\n{\n\t"query": {\n\t\t"has_parent": {\n\t\t\t"parent_type": "branch",\n\t\t\t"query": {\n\t\t\t\t"match": { "country": "UK }\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# ä½ç½®æ¥è¯¢\n\nElasticsearch å¯ä»¥å¯¹å°çä½ç½®ç¹ geo_point ç±»ååå°çä½ç½®å½¢ç¶ geo_shape ç±»åçæ°æ®è¿è¡æç´¢ãä¸ºäºå­¦ä¹ æ¹ä¾¿ï¼è¿éåå¤ä¸äºåå¸çå°çåæ ä½ä¸ºæµè¯æ°æ®ï¼æ¯ä¸æ¡ææ¡£é½åå«åå¸åç§°åå°çåæ è¿ä¸¤ä¸ªå­æ®µï¼è¿éçåæ ç¹åçæ¯åä¸ªåå¸ä¸­å¿çä¸ä¸ªä½ç½®ãé¦åæä¸é¢çåå®¹ä¿å­å° geo.json æä»¶ä¸­ï¼\n\n{"index":{ "_index":"geo","_type":"city","_id":"1" }}\n{"name":"åäº¬","location":"39.9088145109,116.3973999023"}\n{"index":{ "_index":"geo","_type":"city","_id": "2" }}\n{"name":"ä¹é²æ¨é½","location":"43.8266300000,87.6168800000"}\n{"index":{ "_index":"geo","_type":"city","_id":"3" }}\n{"name":"è¥¿å®","location":"34.3412700000,108.9398400000"}\n{"index":{ "_index":"geo","_type":"city","_id":"4" }}\n{"name":"éå·","location":"34.7447157466,113.6587142944"}\n{"index":{ "_index":"geo","_type":"city","_id":"5" }}\n{"name":"æ­å·","location":"30.2294080260,120.1492309570"}\n{"index":{ "_index":"geo","_type":"city","_id":"6" }}\n{"name":"æµå","location":"36.6518400000,117.1200900000"}\n\n\nåå»ºä¸ä¸ªç´¢å¼å¹¶è®¾ç½®æ å°ï¼\n\nPUT geo\n{\n\t"mappings": {\n\t\t"city": {\n\t\t\t"properties": {\n\t\t\t\t"name": {\n\t\t\t\t\t"type": "keyword"\n\t\t\t\t},\n\t\t\t\t"location": {\n\t\t\t\t\t"type": "geo_point"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nç¶åæ§è¡æ¹éå¯¼å¥å½ä»¤ï¼\n\ncurl -XPOST "http://localhost:9200/_bulk?pretty" --data-binary @geo.json\n\n\n\n# geo_distance query\n\ngeo_distance query å¯ä»¥æ¥æ¾å¨ä¸ä¸ªä¸­å¿ç¹æå®èå´åçå°çç¹ææ¡£ãä¾å¦ï¼æ¥æ¾è·ç¦»å¤©æ´¥ 200km ä»¥åçåå¸ï¼æç´¢ç»æä¸­ä¼è¿ååäº¬ï¼å½ä»¤å¦ä¸ï¼\n\nGET geo/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": {\n\t\t\t\t"match_all": {}\n\t\t\t},\n\t\t\t"filter": {\n\t\t\t\t"geo_distance": {\n\t\t\t\t\t"distance": "200km",\n\t\t\t\t\t"location": {\n\t\t\t\t\t\t"lat": 39.0851000000,\n\t\t\t\t\t\t"lon": 117.1993700000\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\næååå¸ç¦»åäº¬çè·ç¦»æåºï¼\n\nGET geo/_search\n{\n  "query": {\n    "match_all": {}\n  },\n  "sort": [{\n    "_geo_distance": {\n      "location": "39.9088145109,116.3973999023",\n      "unit": "km",\n      "order": "asc",\n      "distance_type": "plane"\n    }\n  }]\n}\n\n\nå¶ä¸­ location å¯¹åºçç»çº¬åº¦å­æ®µï¼unit ä¸º km è¡¨ç¤ºå°è·ç¦»ä»¥ km ä¸ºåä½åå¥å°æ¯ä¸ªè¿åç»æç sort é®ä¸­ï¼distance_type ä¸º plane è¡¨ç¤ºä½¿ç¨å¿«éä½ç²¾åº¦ç¥å·®ç plane è®¡ç®æ¹å¼ã\n\n\n# geo_bounding_box query\n\ngeo_bounding_box query ç¨äºæ¥æ¾è½å¥æå®çç©å½¢åçå°çåæ ãæ¥è¯¢ä¸­ç±ä¸¤ä¸ªç¹ç¡®å®ä¸ä¸ªç©å½¢ï¼ç¶åå¨ç©å½¢åºååæ¥è¯¢å¹éçææ¡£ã\n\nGET geo/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": {\n\t\t\t\t"match_all": {}\n\t\t\t},\n\t\t\t"filter": {\n\t\t\t\t"geo_bounding_box": {\n\t\t\t\t\t"location": {\n\t\t\t\t\t\t"top_left": {\n\t\t\t\t\t\t\t"lat": 38.4864400000,\n\t\t\t\t\t\t\t"lon": 106.2324800000\n\t\t\t\t\t\t},\n\t\t\t\t\t\t"bottom_right": {\n\t\t\t\t\t\t\t"lat": 28.6820200000,\n\t\t\t\t\t\t\t"lon": 115.8579400000\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# geo_polygon query\n\ngeo_polygon query ç¨äºæ¥æ¾å¨æå®å¤è¾¹å½¢åçå°çç¹ãä¾å¦ï¼å¼åæµ©ç¹ãéåºãä¸æµ·ä¸å°ç»æä¸ä¸ªä¸è§å½¢ï¼æ¥è¯¢ä½ç½®å¨è¯¥ä¸è§å½¢åºååçåå¸ï¼å½ä»¤å¦ä¸ï¼\n\nGET geo/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": {\n\t\t\t\t"match_all": {}\n\t\t\t}\n\t\t},\n\t\t"filter": {\n\t\t\t"geo_polygon": {\n\t\t\t\t"location": {\n\t\t\t\t\t"points": [{\n\t\t\t\t\t\t"lat": 40.8414900000,\n\t\t\t\t\t\t"lon": 111.7519900000\n\t\t\t\t\t}, {\n\t\t\t\t\t\t"lat": 29.5647100000,\n\t\t\t\t\t\t"lon": 106.5507300000\n\t\t\t\t\t}, {\n\t\t\t\t\t\t"lat": 31.2303700000,\n\t\t\t\t\t\t"lon": 121.4737000000\n\t\t\t\t\t}]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# geo_shape query\n\ngeo_shape query ç¨äºæ¥è¯¢ geo_shape ç±»åçå°çæ°æ®ï¼å°çå½¢ç¶ä¹é´çå³ç³»æç¸äº¤ãåå«ãä¸ç¸äº¤ä¸ç§ãåå»ºä¸ä¸ªæ°çç´¢å¼ç¨äºæµè¯ï¼å¶ä¸­ location å­æ®µçç±»åè®¾ä¸º geo_shape ç±»åã\n\nPUT geoshape\n{\n\t"mappings": {\n\t\t"city": {\n\t\t\t"properties": {\n\t\t\t\t"name": {\n\t\t\t\t\t"type": "keyword"\n\t\t\t\t},\n\t\t\t\t"location": {\n\t\t\t\t\t"type": "geo_shape"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nå³äºç»çº¬åº¦çé¡ºåºè¿éåä¸ä¸ªè¯´æï¼geo_point ç±»åçå­æ®µçº¬åº¦å¨åç»åº¦å¨åï¼ä½æ¯å¯¹äº geo_shape ç±»åä¸­çç¹ï¼æ¯ç»åº¦å¨åçº¬åº¦å¨åï¼è¿ä¸ç¹éè¦ç¹å«æ³¨æã\n\næè¥¿å®åéå·è¿æççº¿åå¥ç´¢å¼ï¼\n\nPOST geoshape/city/1\n{\n\t"name": "è¥¿å®-éå·",\n\t"location": {\n\t\t"type": "linestring",\n\t\t"coordinates": [\n\t\t\t[108.9398400000, 34.3412700000],\n\t\t\t[113.6587142944, 34.7447157466]\n\t\t]\n\t}\n}\n\n\næ¥è¯¢åå«å¨ç±é¶å·ååæä½ä¸ºå¯¹è§çº¿ä¸çç¹ç»æçç©å½¢çå°çå½¢ç¶ï¼ç±äºè¥¿å®åéå·ç»æçç´çº¿è½å¨è¯¥ç©å½¢åºååï¼å æ­¤å¯ä»¥è¢«æ¥è¯¢å°ãå½ä»¤å¦ä¸ï¼\n\nGET geoshape/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": {\n\t\t\t\t"match_all": {}\n\t\t\t},\n\t\t\t"filter": {\n\t\t\t\t"geo_shape": {\n\t\t\t\t\t"location": {\n\t\t\t\t\t\t"shape": {\n\t\t\t\t\t\t\t"type": "envelope",\n\t\t\t\t\t\t\t"coordinates": [\n\t\t\t\t\t\t\t\t[106.23248, 38.48644],\n\t\t\t\t\t\t\t\t[115.85794, 28.68202]\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t},\n\t\t\t\t\t\t"relation": "within"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# ç¹æ®æ¥è¯¢\n\n\n# more_like_this query\n\nmore_like_this query å¯ä»¥æ¥è¯¢åæä¾ææ¬ç±»ä¼¼çææ¡£ï¼éå¸¸ç¨äºè¿ä¼¼ææ¬çæ¨èç­åºæ¯ãæ¥è¯¢å½ä»¤å¦ä¸ï¼\n\nGET books/_search\n{\n\t"query": {\n\t\t"more_like_ this": {\n\t\t\t"fields": ["title", "description"],\n\t\t\t"like": "java virtual machine",\n\t\t\t"min_term_freq": 1,\n\t\t\t"max_query_terms": 12\n\t\t}\n\t}\n}\n\n\nå¯éçåæ°ååå¼è¯´æå¦ä¸ï¼\n\n * fields è¦å¹éçå­æ®µï¼é»è®¤æ¯ _all å­æ®µã\n * like è¦å¹éçææ¬ã\n * min_term_freq ææ¡£ä¸­è¯é¡¹çæä½é¢çï¼é»è®¤æ¯ 2ï¼ä½äºæ­¤é¢ççææ¡£ä¼è¢«å¿½ç¥ã\n * max_query_terms query ä¸­è½åå«çæå¤§è¯é¡¹æ°ç®ï¼é»è®¤ä¸º 25ã\n * min_doc_freq æå°çææ¡£é¢çï¼é»è®¤ä¸º 5ã\n * max_doc_freq æå¤§ææ¡£é¢çã\n * min_word length åè¯çæå°é¿åº¦ã\n * max_word length åè¯çæå¤§é¿åº¦ã\n * stop_words åç¨è¯åè¡¨ã\n * analyzer åè¯å¨ã\n * minimum_should_match ææ¡£åºå¹éçæå°è¯é¡¹æ°ï¼é»è®¤ä¸º query åè¯åè¯é¡¹æ°ç 30%ã\n * boost terms è¯é¡¹çæéã\n * include æ¯å¦æè¾å¥ææ¡£ä½ä¸ºç»æè¿åã\n * boost æ´ä¸ª query çæéï¼é»è®¤ä¸º 1.0ã\n\n\n# script query\n\nElasticsearch æ¯æä½¿ç¨èæ¬è¿è¡æ¥è¯¢ãä¾å¦ï¼æ¥è¯¢ä»·æ ¼å¤§äº 180 çææ¡£ï¼å½ä»¤å¦ä¸ï¼\n\nGET books/_search\n{\n  "query": {\n    "script": {\n      "script": {\n        "inline": "doc[\'price\'].value > 180",\n        "lang": "painless"\n      }\n    }\n  }\n}\n\n\n\n# percolate query\n\nä¸è¬æåµä¸ï¼æä»¬æ¯åæææ¡£åå¥å° Elasticsearch ä¸­ï¼éè¿æ¥è¯¢è¯­å¥å¯¹ææ¡£è¿è¡æç´¢ãpercolate query åæ¯åå¶éèè¡ä¹çåæ³ï¼å®ä¼åæ³¨åæ¥è¯¢æ¡ä»¶ï¼æ ¹æ®ææ¡£æ¥æ¥è¯¢ queryãä¾å¦ï¼å¨ my-index ç´¢å¼ä¸­æä¸ä¸ª laptop ç±»åï¼ææ¡£æ price å name ä¸¤ä¸ªå­æ®µï¼å¨æ å°ä¸­å£°æä¸ä¸ª percolator ç±»åç queryï¼å½ä»¤å¦ä¸ï¼\n\nPUT my-index\n{\n\t"mappings": {\n\t\t"laptop": {\n\t\t\t"properties": {\n\t\t\t\t"price": { "type": "long" },\n\t\t\t\t"name": { "type": "text" }\n\t\t\t},\n\t\t\t"queries": {\n\t\t\t\t"properties": {\n\t\t\t\t\t"query": { "type": "percolator" }\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\næ³¨åä¸ä¸ª bool queryï¼bool query ä¸­åå«ä¸ä¸ª range queryï¼è¦æ± price å­æ®µçåå¼å°äºç­äº 10000ï¼å¹¶ä¸ name å­æ®µä¸­å«æå³é®è¯ macbookï¼\n\nPUT /my-index/queries/1?refresh\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": [{\n\t\t\t\t"range": { "price": { "lte": 10000 } }\n\t\t\t}, {\n\t\t\t\t"match": { "name": "macbook" }\n\t\t\t}]\n\t\t}\n\t}\n}\n\n\néè¿ææ¡£æ¥è¯¢ queryï¼\n\nGET /my-index/_search\n{\n\t"query": {\n\t\t"percolate": {\n\t\t\t"field": "query",\n\t\t\t"document_type": "laptop",\n\t\t\t"document": {\n\t\t\t\t"price": 9999,\n\t\t\t\t"name": "macbook pro on sale"\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nææ¡£ç¬¦å query ä¸­çæ¡ä»¶ï¼è¿åç»æä¸­å¯ä»¥æ¥å°ä¸æä¸­æ³¨åç bool queryãpercolate query çè¿ç§ç¹æ§éç¨äºæ°æ®åç±»ãæ°æ®è·¯ç±ãäºä»¶çæ§åé¢è­¦ç­åºæ¯ã',normalizedContent:'# elasticsearch æ¥è¯¢\n\nelasticsearch æ¥è¯¢è¯­å¥éç¨åºäº restful é£æ ¼çæ¥å£å°è£æ json æ ¼å¼çå¯¹è±¡ï¼ç§°ä¹ä¸º query dslãelasticsearch æ¥è¯¢åç±»å¤§è´åä¸ºå¨ææ¥è¯¢ãè¯é¡¹æ¥è¯¢ãå¤åæ¥è¯¢ãåµå¥æ¥è¯¢ãä½ç½®æ¥è¯¢ãç¹æ®æ¥è¯¢ãelasticsearch æ¥è¯¢ä»æºå¶åä¸ºä¸¤ç§ï¼ä¸ç§æ¯æ ¹æ®ç¨æ·è¾å¥çæ¥è¯¢è¯ï¼éè¿æåºæ¨¡åè®¡ç®ææ¡£ä¸æ¥è¯¢è¯ä¹é´çç¸å³åº¦ï¼å¹¶æ ¹æ®è¯åé«ä½æåºè¿åï¼å¦ä¸ç§æ¯è¿æ»¤æºå¶ï¼åªæ ¹æ®è¿æ»¤æ¡ä»¶å¯¹ææ¡£è¿è¡è¿æ»¤ï¼ä¸è®¡ç®è¯åï¼éåº¦ç¸å¯¹è¾å¿«ã\n\n\n# å¨ææ¥è¯¢\n\nes å¨ææ¥è¯¢ä¸»è¦ç¨äºå¨å¨æå­æ®µä¸ï¼ä¸»è¦èèæ¥è¯¢è¯ä¸ææ¡£çç¸å³æ§ï¼relevanceï¼ã\n\n\n# intervals query\n\nintervals query æ ¹æ®å¹éè¯çé¡ºåºåè¿ä¼¼åº¦è¿åææ¡£ã\n\nintervals query ä½¿ç¨å¹éè§åï¼è¿äºè§ååºç¨äºæå®å­æ®µä¸­ç termã\n\nç¤ºä¾ï¼ä¸é¢ç¤ºä¾æç´¢ query å­æ®µï¼æç´¢å¼æ¯ my favorite foodï¼æ²¡æä»»ä½é´éï¼ç¶åæ¯ my_text å­æ®µæç´¢å¹é hot waterãcold porridge ç termã\n\nå½ my_text ä¸­çå¼ä¸º my favorite food is cold porridge æ¶ï¼ä¼å¹éæåï¼ä½æ¯ when it\'s cold my favorite food is porridge åå¹éå¤±è´¥\n\npost _search\n{\n  "query": {\n    "intervals" : {\n      "my_text" : {\n        "all_of" : {\n          "ordered" : true,\n          "intervals" : [\n            {\n              "match" : {\n                "query" : "my favorite food",\n                "max_gaps" : 0,\n                "ordered" : true\n              }\n            },\n            {\n              "any_of" : {\n                "intervals" : [\n                  { "match" : { "query" : "hot water" } },\n                  { "match" : { "query" : "cold porridge" } }\n                ]\n              }\n            }\n          ]\n        }\n      }\n    }\n  }\n}\n\n\n\n# match query\n\nmatch query ç¨äºæç´¢åä¸ªå­æ®µï¼é¦åä¼éå¯¹æ¥è¯¢è¯­å¥è¿è¡è§£æï¼ç»è¿ analyzerï¼ï¼ä¸»è¦æ¯å¯¹æ¥è¯¢è¯­å¥è¿è¡åè¯ï¼åè¯åæ¥è¯¢è¯­å¥çä»»ä½ä¸ä¸ªè¯é¡¹è¢«å¹éï¼ææ¡£å°±ä¼è¢«æå°ï¼é»è®¤æåµä¸ç¸å½äºå¯¹åè¯åè¯é¡¹è¿è¡ or å¹éæä½ã\n\nmatch query æ¯æ§è¡å¨ææç´¢çæ åæ¥è¯¢ï¼åæ¬æ¨¡ç³å¹ééé¡¹ã\n\nget kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "match": {\n      "customer_full_name": {\n        "query": "george hubbard"\n      }\n    }\n  }\n}\n\n\nç­åäº or å¹éæä½ï¼å¦ä¸ï¼\n\nget kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "match": {\n      "customer_full_name": {\n        "query": "george hubbard",\n        "operator": "or"\n      }\n    }\n  }\n}\n\n\n# match query ç®å\n\nå¯ä»¥éè¿ç»å <field> å query åæ°æ¥ç®åå¹éæ¥è¯¢è¯­æ³ã\n\nç¤ºä¾ï¼\n\nget /_search\n{\n  "query": {\n    "match": {\n      "message": "this is a test"\n    }\n  }\n}\n\n\n# match query å¦ä½å·¥ä½\n\nå¹éæ¥è¯¢æ¯å¸å°ç±»åãè¿æå³çä¼å¯¹æä¾çææ¬è¿è¡åæï¼åæè¿ç¨ä»æä¾çææ¬æé ä¸ä¸ªå¸å°æ¥è¯¢ã operator åæ°å¯ä»¥è®¾ç½®ä¸º or æ and æ¥æ§å¶å¸å°å­å¥ï¼é»è®¤ä¸º orï¼ãå¯ä»¥ä½¿ç¨ minimum_should_match åæ°è®¾ç½®è¦å¹éçå¯é should å­å¥çæå°æ°éã\n\nget kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "match": {\n      "customer_full_name": {\n        "query": "george hubbard",\n        "operator": "and"\n      }\n    }\n  }\n}\n\n\nå¯ä»¥è®¾ç½® analyzer æ¥æ§å¶åªä¸ªåæå¨å°å¯¹ææ¬æ§è¡åæè¿ç¨ãå®é»è®¤ä¸ºå­æ®µæ¾å¼æ å°å®ä¹æé»è®¤æç´¢åæå¨ã\n\nlenient åæ°å¯ä»¥è®¾ç½®ä¸º true ä»¥å¿½ç¥ç±æ°æ®ç±»åä¸å¹éå¯¼è´çå¼å¸¸ï¼ä¾å¦å°è¯ä½¿ç¨ææ¬æ¥è¯¢å­ç¬¦ä¸²æ¥è¯¢æ°å­å­æ®µãé»è®¤ä¸º falseã\n\n# match query çæ¨¡ç³æ¥è¯¢\n\nfuzziness åè®¸åºäºè¢«æ¥è¯¢å­æ®µçç±»åè¿è¡æ¨¡ç³å¹éãè¯·åé fuzziness çéç½®ã\n\nå¨è¿ç§æåµä¸å¯ä»¥è®¾ç½® prefix_length å max_expansions æ¥æ§å¶æ¨¡ç³å¹éãå¦æè®¾ç½®äºæ¨¡ç³éé¡¹ï¼æ¥è¯¢å°ä½¿ç¨ top_terms_blended_freqs_${max_expansions} ä½ä¸ºå¶éåæ¹æ³ï¼fuzzy_rewrite åæ°åè®¸æ§å¶æ¥è¯¢å°å¦ä½è¢«éåã\n\né»è®¤æåµä¸åè®¸æ¨¡ç³åè½¬ (ab â ba)ï¼ä½å¯ä»¥éè¿å° fuzzy_transpositions è®¾ç½®ä¸º false æ¥ç¦ç¨ã\n\nget /_search\n{\n  "query": {\n    "match": {\n      "message": {\n        "query": "this is a testt",\n        "fuzziness": "auto"\n      }\n    }\n  }\n}\n\n\n# zero terms æ¥è¯¢\n\nå¦æä½¿ç¨çåæå¨å stop è¿æ»¤å¨ä¸æ ·å é¤æ¥è¯¢ä¸­çæææ è®°ï¼åé»è®¤è¡ä¸ºæ¯ä¸å¹éä»»ä½ææ¡£ãå¯ä»¥ä½¿ç¨ zero_terms_query éé¡¹æ¥æ¹åé»è®¤è¡ä¸ºï¼å®æ¥å noneï¼é»è®¤ï¼å all ï¼ç¸å½äº match_all æ¥è¯¢ï¼ã\n\nget /_search\n{\n  "query": {\n    "match": {\n      "message": {\n        "query": "to be or not to be",\n        "operator": "and",\n        "zero_terms_query": "all"\n      }\n    }\n  }\n}\n\n\n\n# match_bool_prefix query\n\nmatch_bool_prefix query åæå¶è¾å¥å¹¶æ ¹æ®è¿äºè¯æé ä¸ä¸ªå¸å°æ¥è¯¢ãé¤äºæåä¸ä¸ªæ¯è¯­ä¹å¤çæ¯ä¸ªæ¯è¯­é½ç¨äºæ¯è¯­æ¥è¯¢ãæåä¸ä¸ªè¯ç¨äº prefix queryã\n\nç¤ºä¾ï¼\n\nget /_search\n{\n  "query": {\n    "match_bool_prefix" : {\n      "message" : "quick brown f"\n    }\n  }\n}\n\n\nç­ä»·äº\n\nget /_search\n{\n  "query": {\n    "bool" : {\n      "should": [\n        { "term": { "message": "quick" }},\n        { "term": { "message": "brown" }},\n        { "prefix": { "message": "f"}}\n      ]\n    }\n  }\n}\n\n\nmatch_bool_prefix query å match_phrase_prefix query ä¹é´çä¸ä¸ªéè¦åºå«æ¯ï¼match_phrase_prefix query å°å¶ term å¹éä¸ºç­è¯­ï¼ä½ match_bool_prefix query å¯ä»¥å¨ä»»ä½ä½ç½®å¹éå¶ termã\n\nä¸é¢çç¤ºä¾ match_bool_prefix query æ¥è¯¢å¯ä»¥å¹éåå« quick brown fox çå­æ®µï¼ä½å®ä¹å¯ä»¥å¿«éå¹é brown foxãå®è¿å¯ä»¥å¹éåå« quickãbrown åä»¥ f å¼å¤´çå­æ®µï¼åºç°å¨ä»»ä½ä½ç½®ã\n\n\n# match_phrase query\n\nmatch_phrase query å³ç­è¯­å¹éï¼é¦åä¼æ query åå®¹åè¯ï¼åè¯å¨å¯ä»¥èªå®ä¹ï¼åæ¶ææ¡£è¿è¦æ»¡è¶³ä»¥ä¸ä¸¤ä¸ªæ¡ä»¶æä¼è¢«æç´¢å°ï¼\n\n 1. åè¯åææè¯é¡¹é½è¦åºç°å¨è¯¥å­æ®µä¸­ï¼ç¸å½äº and æä½ï¼ã\n 2. å­æ®µä¸­çè¯é¡¹é¡ºåºè¦ä¸è´ã\n\nä¾å¦ï¼æä»¥ä¸ 3 ä¸ªææ¡£ï¼ä½¿ç¨ match_phrase æ¥è¯¢ "how are you"ï¼åªæåä¸¤ä¸ªææ¡£ä¼è¢«å¹éï¼\n\nput demo/_create/1\n{ "desc": "how are you" }\n\nput demo/_create/2\n{ "desc": "how are you, jack?"}\n\nput demo/_create/3\n{ "desc": "are you"}\n\nget demo/_search\n{\n  "query": {\n    "match_phrase": {\n      "desc": "how are you"\n    }\n  }\n}\n\n\n> è¯´æï¼\n> \n> ä¸ä¸ªè¢«è®¤å®ä¸ºåç­è¯­ how are you å¹éçææ¡£ï¼å¿é¡»æ»¡è¶³ä»¥ä¸è¿äºè¦æ±ï¼\n> \n>  * howã are å you éè¦å¨é¨åºç°å¨åä¸­ã\n>  * are çä½ç½®åºè¯¥æ¯ how çä½ç½®å¤§ 1 ã\n>  * you çä½ç½®åºè¯¥æ¯ how çä½ç½®å¤§ 2 ã\n\n\n# match_phrase_prefix query\n\nmatch_phrase_prefix query å match_phrase query ç±»ä¼¼ï¼åªä¸è¿ match_phrase_prefix query æåä¸ä¸ª term ä¼è¢«ä½ä¸ºåç¼å¹éã\n\nget demo/_search\n{\n  "query": {\n    "match_phrase_prefix": {\n      "desc": "are yo"\n    }\n  }\n}\n\n\n\n# multi_match query\n\nmulti_match query æ¯ match query çåçº§ï¼ç¨äºæç´¢å¤ä¸ªå­æ®µã\n\nç¤ºä¾ï¼\n\nget kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "multi_match": {\n      "query": 34.98,\n      "fields": [\n        "taxful_total_price",\n        "taxless_total_price"\n      ]\n    }\n  }\n}\n\n\nmulti_match query çæç´¢å­æ®µå¯ä»¥ä½¿ç¨ééç¬¦æå®ï¼ç¤ºä¾å¦ä¸ï¼\n\nget kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "multi_match": {\n      "query": 34.98,\n      "fields": [\n        "taxful_*",\n        "taxless_total_price"\n      ]\n    }\n  }\n}\n\n\nåæ¶ï¼ä¹å¯ä»¥ç¨ææ°ç¬¦æå®æç´¢å­æ®µçæéã\n\nç¤ºä¾ï¼æå® taxful_total_price å­æ®µçæéæ¯ taxless_total_price å­æ®µç 3 åï¼å½ä»¤å¦ä¸ï¼\n\nget kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "multi_match": {\n      "query": 34.98,\n      "fields": [\n        "taxful_total_price^3",\n        "taxless_total_price"\n      ]\n    }\n  }\n}\n\n\n\n# combined_fields query\n\ncombined_fields query æ¯ææç´¢å¤ä¸ªææ¬å­æ®µï¼å°±å¥½åå®ä»¬çåå®¹å·²è¢«ç´¢å¼å°ä¸ä¸ªç»åå­æ®µä¸­ä¸æ ·ãè¯¥æ¥è¯¢ä¼çæä»¥ term ä¸ºä¸­å¿çè¾å¥å­ç¬¦ä¸²è§å¾ï¼é¦åå®å°æ¥è¯¢å­ç¬¦ä¸²è§£æä¸ºç¬ç«ç termï¼ç¶åå¨ææå­æ®µä¸­æ¥æ¾æ¯ä¸ª termãå½å¹éç»æå¯è½è·¨è¶å¤ä¸ªææ¬å­æ®µæ¶ï¼æ­¤æ¥è¯¢ç¹å«æç¨ï¼ä¾å¦æç« çæ é¢ãæè¦åæ­£æï¼\n\nget /_search\n{\n  "query": {\n    "combined_fields" : {\n      "query":      "database systems",\n      "fields":     [ "title", "abstract", "body"],\n      "operator":   "and"\n    }\n  }\n}\n\n\n# å­æ®µåç¼æé\n\nå­æ®µåç¼æéæ ¹æ®ç»åå­æ®µæ¨¡åè¿è¡è®¡ç®ãä¾å¦ï¼å¦æ title å­æ®µçæéä¸º 2ï¼åå¹éåº¦æåæ¶ä¼å° title ä¸­çæ¯ä¸ª term å½¢æçç»åå­æ®µï¼æåºç°ä¸¤æ¬¡è¿è¡æåã\n\n\n# common_terms query\n\n> 7.3.0 åºå¼\n\ncommon_terms query æ¯ä¸ç§å¨ä¸çºç²æ§è½çæåµä¸æ¿ä»£åç¨è¯æé«æç´¢åç¡®çåå¬åççæ¹æ¡ã\n\næ¥è¯¢ä¸­çæ¯ä¸ªè¯é¡¹é½æä¸å®çä»£ä»·ï¼ä»¥æç´¢âthe brown foxâä¸ºä¾ï¼query ä¼è¢«è§£ææä¸ä¸ªè¯é¡¹âtheââbrownâåâfoxâï¼æ¯ä¸ªè¯é¡¹é½ä¼å°ç´¢å¼ä¸­æ§è¡ä¸æ¬¡æ¥è¯¢ãå¾æ¾ç¶åå«âtheâçææ¡£éå¸¸å¤ï¼ç¸æ¯å¶ä»è¯é¡¹ï¼âtheâçéè¦æ§ä¼ä½å¾å¤ãä¼ ç»çè§£å³æ¹æ¡æ¯æâtheâå½ä½åç¨è¯å¤çï¼å»é¤åç¨è¯ä¹åå¯ä»¥åå°ç´¢å¼å¤§å°ï¼åæ¶å¨æç´¢æ¶åå°å¯¹åç¨è¯çæ¶ç¼©ã\n\nè½ç¶åç¨è¯å¯¹ææ¡£è¯åå½±åä¸å¤§ï¼ä½æ¯å½åç¨è¯ä»ç¶æéè¦æä¹çæ¶åï¼å»é¤åç¨è¯å°±ä¸æ¯å®ç¾çè§£å³æ¹æ¡äºãå¦æå»é¤åç¨è¯ï¼å°±æ æ³åºåâhappyâåânot happyâ, âtheââto be or not to beâå°±ä¸ä¼å¨ç´¢å¼ä¸­å­å¨ï¼æç´¢çåç¡®çåå¬åçå°±ä¼éä½ã\n\ncommon_terms query æä¾äºä¸ç§è§£å³æ¹æ¡ï¼å®æ query åè¯åçè¯é¡¹åæéè¦è¯é¡¹ï¼ä½é¢è¯é¡¹ï¼åä¸éè¦çè¯é¡¹ï¼é«é¢è¯ï¼ä¹å°±æ¯ä¹åçåç¨è¯ï¼ãå¨æç´¢çæ¶åï¼é¦åæç´¢åéè¦è¯é¡¹å¹éçææ¡£ï¼è¿äºææ¡£æ¯è¯é¡¹åºç°è¾å°å¹¶ä¸è¯é¡¹å¯¹å¶è¯åå½±åè¾å¤§çææ¡£ãç¶åæ§è¡ç¬¬äºæ¬¡æ¥è¯¢ï¼æç´¢å¯¹è¯åå½±åè¾å°çé«é¢è¯é¡¹ï¼ä½æ¯ä¸è®¡ç®ææææ¡£çè¯åï¼èæ¯åªè®¡ç®ç¬¬ä¸æ¬¡æ¥è¯¢å·²ç»å¹éçææ¡£å¾åãå¦æä¸ä¸ªæ¥è¯¢ä¸­åªåå«é«é¢è¯ï¼é£ä¹ä¼éè¿ and è¿æ¥ç¬¦æ§è¡ä¸ä¸ªåç¬çæ¥è¯¢ï¼æ¢è¨ä¹ï¼ä¼æç´¢ææçè¯é¡¹ã\n\nè¯é¡¹æ¯é«é¢è¯è¿æ¯ä½é¢è¯æ¯éè¿ cutoff frequency æ¥è®¾ç½®éå¼çï¼åå¼å¯ä»¥æ¯ç»å¯¹é¢çï¼é¢çå¤§äº 1ï¼æèç¸å¯¹é¢çï¼0 ï½ 1ï¼ãcommon_terms query ææè¶£ä¹å¤å¨äºå®è½èªéåºç¹å®é¢åçåç¨è¯ï¼ä¾å¦ï¼å¨è§é¢æç®¡ç½ç«ä¸ï¼è¯¸å¦âclipâæâvideoâä¹ç±»çé«é¢è¯é¡¹å°èªå¨è¡¨ç°ä¸ºåç¨è¯ï¼æ é¡»ä¿çæå¨åè¡¨ã\n\nä¾å¦ï¼ææ¡£é¢çé«äº 0.1% çè¯é¡¹å°ä¼è¢«å½ä½é«é¢è¯é¡¹ï¼è¯é¢ä¹é´å¯ä»¥ç¨ low_freq_operatorãhigh_freq_operator åæ°è¿æ¥ãè®¾ç½®ä½é¢è¯æä½ç¬¦ä¸ºâandâä½¿ææçä½é¢è¯é½æ¯å¿é¡»æç´¢çï¼ç¤ºä¾ä»£ç å¦ä¸ï¼\n\nget books/_search\n{\n\t"query": {\n\t\t"common": {\n\t\t\t"body": {\n\t\t\t\t"query": "nelly the elephant as a cartoon",\n\t\t\t\t"cutoff_frequency": 0.001,\n\t\t\t\t"low_freq_operator": "and"\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nä¸è¿°æä½ç­ä»·äºï¼\n\nget books/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": [\n\t\t\t  { "term": { "body": "nelly" } },\n\t\t\t  { "term": { "body": "elephant" } },\n\t\t\t  { "term": { "body": "cartoon" } }\n\t\t\t],\n\t\t\t"should": [\n\t\t\t  { "term": { "body": "the" } },\n\t\t\t  { "term": { "body": "as" } },\n\t\t\t  { "term": { "body": "a" } }\n\t\t\t]\n\t\t}\n\t}\n}\n\n\n\n# query_string query\n\nquery_string query æ¯ä¸ lucene æ¥è¯¢è¯­å¥çè¯­æ³ç»åéå¸¸ç´§å¯çä¸ç§æ¥è¯¢ï¼åè®¸å¨ä¸ä¸ªæ¥è¯¢è¯­å¥ä¸­ä½¿ç¨å¤ä¸ªç¹æ®æ¡ä»¶å³é®å­ï¼å¦ï¼and | or | notï¼å¯¹å¤ä¸ªå­æ®µè¿è¡æ¥è¯¢ï¼å»ºè®®çæ lucene æ¥è¯¢è¯­æ³çç¨æ·å»ä½¿ç¨ã\n\nç¨æ·å¯ä»¥ä½¿ç¨ query_string query æ¥åå»ºåå«ééç¬¦ãè·¨å¤ä¸ªå­æ®µçæç´¢ç­å¤ææç´¢ãè½ç¶éç¨ï¼ä½æ¥è¯¢æ¯ä¸¥æ ¼çï¼å¦ææ¥è¯¢å­ç¬¦ä¸²åå«ä»»ä½æ æè¯­æ³ï¼åä¼è¿åéè¯¯ã\n\nç¤ºä¾ï¼\n\nget /_search\n{\n  "query": {\n    "query_string": {\n      "query": "(new york city) or (big apple)",\n      "default_field": "content"\n    }\n  }\n}\n\n\n\n# simple_query_string query\n\nsimple_query_string query æ¯ä¸ç§éåç´æ¥æ´é²ç»ç¨æ·ï¼å¹¶ä¸å·æéå¸¸å®åçæ¥è¯¢è¯­æ³çæ¥è¯¢è¯­å¥ï¼æ¥å lucene æ¥è¯¢è¯­æ³ï¼è§£æè¿ç¨ä¸­åçéè¯¯ä¸ä¼æåºå¼å¸¸ã\n\nè½ç¶è¯­æ³æ¯ query_string query æ´ä¸¥æ ¼ï¼ä½ simple_query_string query ä¸ä¼è¿åæ æè¯­æ³çéè¯¯ãç¸åï¼å®ä¼å¿½ç¥æ¥è¯¢å­ç¬¦ä¸²çä»»ä½æ æé¨åã\n\nç¤ºä¾ï¼\n\nget /_search\n{\n  "query": {\n    "simple_query_string" : {\n        "query": "\\"fried eggs\\" +(eggplant | potato) -frittata",\n        "fields": ["title^5", "body"],\n        "default_operator": "and"\n    }\n  }\n}\n\n\n# simple_query_string è¯­ä¹\n\n * +ï¼ç­ä»·äº and æä½\n * |ï¼ç­ä»·äº or æä½\n * -ï¼ç¸å½äº not æä½\n * "ï¼åè£ä¸äºæ è®°ä»¥è¡¨ç¤ºç¨äºæç´¢çç­è¯­\n * *ï¼è¯å°¾è¡¨ç¤ºåç¼æ¥è¯¢\n * ( and )ï¼è¡¨ç¤ºä¼åçº§\n * ~nï¼è¯å°¾è¡¨ç¤ºè¡¨ç¤ºç¼è¾è·ç¦»ï¼æ¨¡ç³æ§ï¼\n * ~nï¼å¨ä¸ä¸ªç­è¯­ä¹åè¡¨ç¤ºæº¢åºé\n\næ³¨æï¼è¦ä½¿ç¨ä¸é¢çå­ç¬¦ï¼è¯·ä½¿ç¨åææ  / å¯¹å¶è¿è¡è½¬ä¹ã\n\n\n# å¨ææ¥è¯¢å®æ´ç¤ºä¾\n\n#è®¾ç½® position_increment_gap\ndelete groups\nput groups\n{\n  "mappings": {\n    "properties": {\n      "names":{\n        "type": "text",\n        "position_increment_gap": 0\n      }\n    }\n  }\n}\n\nget groups/_mapping\n\npost groups/_doc\n{\n  "names": [ "john water", "water smith"]\n}\n\npost groups/_search\n{\n  "query": {\n    "match_phrase": {\n      "names": {\n        "query": "water water",\n        "slop": 100\n      }\n    }\n  }\n}\n\npost groups/_search\n{\n  "query": {\n    "match_phrase": {\n      "names": "water smith"\n    }\n  }\n}\n\ndelete groups\n\n\n\n# è¯é¡¹æ¥è¯¢\n\ntermï¼è¯é¡¹ï¼æ¯è¡¨è¾¾è¯­æçæå°åä½ãæç´¢åå©ç¨ç»è®¡è¯­è¨æ¨¡åè¿è¡èªç¶è¯­è¨å¤çé½éè¦å¤ç termã\n\nå¨ææ¥è¯¢å¨æ§è¡æ¥è¯¢ä¹åä¼åææ¥è¯¢å­ç¬¦ä¸²ã\n\nä¸å¨ææ¥è¯¢ä¸åï¼è¯é¡¹æ¥è¯¢ä¸ä¼åè¯ï¼èæ¯å°è¾å¥ä½ä¸ºä¸ä¸ªæ´ä½ï¼å¨åæç´¢å¼ä¸­æ¥æ¾åç¡®çè¯é¡¹ãå¹¶ä¸ä½¿ç¨ç¸å³åº¦è®¡ç®å¬å¼ä¸ºæ¯ä¸ªåå«è¯¥è¯é¡¹çææ¡£è¿è¡ç¸å³åº¦è®¡ç®ãä¸è¨ä»¥æ¦ä¹ï¼è¯é¡¹æ¥è¯¢æ¯å¯¹è¯é¡¹è¿è¡ç²¾ç¡®å¹éãè¯é¡¹æ¥è¯¢éå¸¸ç¨äºç»æåæ°æ®ï¼å¦æ°å­ãæ¥æåæä¸¾ç±»åã\n\nè¯é¡¹æ¥è¯¢æä»¥ä¸ç±»åï¼\n\n * exists query\n * fuzzy query\n * ids query\n * prefix query\n * range query\n * regexp query\n * term query\n * terms query\n * type query\n * wildcard query\n\n\n# exists query\n\nexists query ä¼è¿åå­æ®µä¸­è³å°æä¸ä¸ªéç©ºå¼çææ¡£ã\n\nç±äºå¤ç§åå ï¼ææ¡£å­æ®µå¯è½ä¸å­å¨ç´¢å¼å¼ï¼\n\n * json ä¸­çå­æ®µä¸º null æ []\n * è¯¥å­æ®µå¨ mapping ä¸­éç½®äº "index" : false\n * å­æ®µå¼çé¿åº¦è¶è¿äº mapping ä¸­ç ignore_above è®¾ç½®\n * å­æ®µå¼æ ¼å¼éè¯¯ï¼å¹¶ä¸å¨ mapping ä¸­å®ä¹äº ignore_malformed\n\nç¤ºä¾ï¼\n\nget kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "exists": {\n      "field": "email"\n    }\n  }\n}\n\n\nä»¥ä¸ææ¡£ä¼å¹éä¸é¢çæ¥è¯¢ï¼\n\n * { "user" : "jane" } æ user å­æ®µï¼ä¸ä¸ä¸ºç©ºã\n * { "user" : "" } æ user å­æ®µï¼å¼ä¸ºç©ºå­ç¬¦ä¸²ã\n * { "user" : "-" } æ user å­æ®µï¼å¼ä¸ä¸ºç©ºã\n * { "user" : [ "jane" ] } æ user å­æ®µï¼å¼ä¸ä¸ºç©ºã\n * { "user" : [ "jane", null ] } æ user å­æ®µï¼è³å°ä¸ä¸ªå¼ä¸ä¸ºç©ºå³å¯ã\n\nä¸é¢çææ¡£é½ä¸ä¼è¢«å¹éï¼\n\n * { "user" : null } è½ç¶æ user å­æ®µï¼ä½æ¯å¼ä¸ºç©ºã\n * { "user" : [] } è½ç¶æ user å­æ®µï¼ä½æ¯å¼ä¸ºç©ºã\n * { "user" : [null] } è½ç¶æ user å­æ®µï¼ä½æ¯å¼ä¸ºç©ºã\n * { "foo" : "bar" } æ²¡æ user å­æ®µã\n\n\n# fuzzy query\n\nfuzzy queryï¼æ¨¡ç³æ¥è¯¢ï¼è¿ååå«ä¸æç´¢è¯ç¸ä¼¼çè¯çææ¡£ães ä½¿ç¨ levenshtein edit distanceï¼levenshtein ç¼è¾è·ç¦»ï¼æµéç¸ä¼¼åº¦ææ¨¡ç³åº¦ã\n\nç¼è¾è·ç¦»æ¯å°ä¸ä¸ªæ¯è¯­è½¬æ¢ä¸ºå¦ä¸ä¸ªæ¯è¯­æéçåä¸ªå­ç¬¦æ´æ¹çæ°éãè¿äºååå¯è½åæ¬ï¼\n\n * æ¹åä¸ä¸ªå­ç¬¦ï¼ï¼box -> foxï¼\n * å é¤ä¸ä¸ªå­ç¬¦ï¼ï¼black -> lackï¼\n * æå¥ä¸ä¸ªå­ç¬¦ï¼ï¼sic -> sickï¼\n * åè½¬ä¸¤ä¸ªç¸é»å­ç¬¦ï¼ï¼act â catï¼\n\nä¸ºäºæ¾å°ç¸ä¼¼çè¯æ¡ï¼fuzzy query ä¼å¨æå®çç¼è¾è·ç¦»ååå»ºæç´¢è¯æ¡çææå¯è½åä½ææ©å±éãç¶åè¿åå®å¨å¹éä»»ææ©å±çææ¡£ã\n\nget books/_search\n{\n  "query": {\n    "fuzzy": {\n      "user.id": {\n        "value": "ki",\n        "fuzziness": "auto",\n        "max_expansions": 50,\n        "prefix_length": 0,\n        "transpositions": true,\n        "rewrite": "constant_score"\n      }\n    }\n  }\n}\n\n\næ³¨æï¼å¦æéç½®äº search.allow_expensive_queries ï¼å fuzzy query ä¸è½æ§è¡ã\n\n\n# ids query\n\nids query æ ¹æ® id è¿åææ¡£ã æ­¤æ¥è¯¢ä½¿ç¨å­å¨å¨ _id å­æ®µä¸­çææ¡£ idã\n\nget /_search\n{\n  "query": {\n    "ids" : {\n      "values" : ["1", "4", "100"]\n    }\n  }\n}\n\n\n\n# prefix query\n\nprefix query ç¨äºæ¥è¯¢æä¸ªå­æ®µä¸­åå«æå®åç¼çææ¡£ã\n\næ¯å¦æ¥è¯¢ user.id ä¸­å«æä»¥ ki ä¸ºåç¼çå³é®è¯çææ¡£ï¼é£ä¹å«æ kindãkid ç­ææä»¥ ki å¼å¤´å³é®è¯çææ¡£é½ä¼è¢«å¹éã\n\nget /_search\n{\n  "query": {\n    "prefix": {\n      "user.id": {\n        "value": "ki"\n      }\n    }\n  }\n}\n\n\n\n# range query\n\nrange query å³èå´æ¥è¯¢ï¼ç¨äºå¹éå¨æä¸èå´åçæ°å¼åãæ¥æç±»åæèå­ç¬¦ä¸²åå­æ®µçææ¡£ãæ¯å¦æç´¢åªäºä¹¦ç±çä»·æ ¼å¨ 50 å° 100 ä¹é´ãåªäºä¹¦ç±çåºçæ¶é´å¨ 2015 å¹´å° 2019 å¹´ä¹é´ãä½¿ç¨ range æ¥è¯¢åªè½æ¥è¯¢ä¸ä¸ªå­æ®µï¼ä¸è½ä½ç¨å¨å¤ä¸ªå­æ®µä¸ã\n\nrange æ¥è¯¢æ¯æçåæ°æä»¥ä¸å ç§ï¼\n\n * gtï¼å¤§äº\n\n * gteï¼å¤§äºç­äº\n\n * ltï¼å°äº\n\n * lteï¼å°äºç­äº\n\n * formatï¼å¦æå­æ®µæ¯ date ç±»åï¼å¯ä»¥è®¾ç½®æ¥ææ ¼å¼å\n\n * time_zoneï¼æ¶åº\n\n * relationï¼æç¤ºèå´æ¥è¯¢å¦ä½å¹éèå´å­æ®µçå¼ã\n   \n   * intersects (default)ï¼å¹éä¸æ¥è¯¢å­æ®µå¼èå´ç¸äº¤çææ¡£ã\n   * containsï¼å¹éå®å¨åå«æ¥è¯¢å­æ®µå¼çææ¡£ã\n   * withinï¼å¹éå·æå®å¨å¨æ¥è¯¢èå´åçèå´å­æ®µå¼çææ¡£ã\n\nç¤ºä¾ï¼æ°å¼èå´æ¥è¯¢\n\nget kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "range": {\n      "taxful_total_price": {\n        "gt": 10,\n        "lte": 50\n      }\n    }\n  }\n}\n\n\nç¤ºä¾ï¼æ¥æèå´æ¥è¯¢\n\nget kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "range": {\n      "order_date": {\n        "time_zone": "+00:00",\n        "gte": "2018-01-01t00:00:00",\n        "lte": "now"\n      }\n    }\n  }\n}\n\n\n\n# regexp query\n\nregexp query è¿åä¸æ­£åè¡¨è¾¾å¼ç¸å¹éç term æå±çææ¡£ã\n\næ­£åè¡¨è¾¾å¼æ¯ä¸ç§ä½¿ç¨å ä½ç¬¦å­ç¬¦å¹éæ°æ®æ¨¡å¼çæ¹æ³ï¼ç§°ä¸ºè¿ç®ç¬¦ã\n\nç¤ºä¾ï¼ä»¥ä¸æç´¢è¿å user.id å­æ®µåå«ä»»ä½ä»¥ k å¼å¤´å¹¶ä»¥ y ç»å°¾çææ¡£ã .* è¿ç®ç¬¦å¹éä»»ä½é¿åº¦çä»»ä½å­ç¬¦ï¼åæ¬æ å­ç¬¦ãå¹éé¡¹å¯ä»¥åæ¬ kyãkay å kimchyã\n\nget /_search\n{\n  "query": {\n    "regexp": {\n      "user.id": {\n        "value": "k.*y",\n        "flags": "all",\n        "case_insensitive": true,\n        "max_determinized_states": 10000,\n        "rewrite": "constant_score"\n      }\n    }\n  }\n}\n\n\n> æ³¨æï¼å¦æéç½®äºsearch.allow_expensive_queries ï¼å regexp query ä¼è¢«ç¦ç¨ã\n\n\n# term query\n\nterm query ç¨æ¥æ¥æ¾æå®å­æ®µä¸­åå«ç»å®åè¯çææ¡£ï¼term æ¥è¯¢ä¸è¢«è§£æï¼åªææ¥è¯¢è¯åææ¡£ä¸­çè¯ç²¾ç¡®å¹éæä¼è¢«æç´¢å°ï¼åºç¨åºæ¯ä¸ºæ¥è¯¢äººåãå°åç­éè¦ç²¾åå¹éçéæ±ã\n\nç¤ºä¾ï¼\n\n# 1. åå»ºä¸ä¸ªç´¢å¼\ndelete my-index-000001\nput my-index-000001\n{\n  "mappings": {\n    "properties": {\n      "full_text": { "type": "text" }\n    }\n  }\n}\n\n# 2. ä½¿ç¨ "quick brown foxes!" å³é®å­æ¥ "full_text" å­æ®µ\nput my-index-000001/_doc/1\n{\n  "full_text": "quick brown foxes!"\n}\n\n# 3. ä½¿ç¨ term æ¥è¯¢\nget my-index-000001/_search?pretty\n{\n  "query": {\n    "term": {\n      "full_text": "quick brown foxes!"\n    }\n  }\n}\n# å ä¸º full_text å­æ®µä¸ååå«ç¡®åç term ââ "quick brown foxes!"ï¼æä»¥ term query æç´¢ä¸å°ä»»ä½ç»æ\n\n# 4. ä½¿ç¨ match æ¥è¯¢\nget my-index-000001/_search?pretty\n{\n  "query": {\n    "match": {\n      "full_text": "quick brown foxes!"\n    }\n  }\n}\n\ndelete my-index-000001\n\n\n> â ï¸ æ³¨æï¼åºé¿å term æ¥è¯¢å¯¹ text å­æ®µä½¿ç¨æ¥è¯¢ã\n> \n> é»è®¤æåµä¸ï¼elasticsearch éå¯¹ text å­æ®µçå¼è¿è¡è§£æåè¯ï¼è¿ä¼ä½¿æ¥æ¾ text å­æ®µå¼çç²¾ç¡®å¹éåå¾å°é¾ã\n> \n> è¦æç´¢ text å­æ®µå¼ï¼éæ¹ç¨ match æ¥è¯¢ã\n\n\n# terms query\n\nterms query ä¸ term query ç¸åï¼ä½å¯ä»¥æç´¢å¤ä¸ªå¼ã\n\nterms query æ¥è¯¢åæ°ï¼\n\n * indexï¼ç´¢å¼å\n * idï¼ææ¡£ id\n * pathï¼è¦ä»ä¸­è·åå­æ®µå¼çå­æ®µçåç§°ï¼å³æç´¢å³é®å­\n * routingï¼éå¡«ï¼ï¼è¦ä»ä¸­è·å term å¼çææ¡£çèªå®ä¹è·¯ç±å¼ãå¦æå¨ç´¢å¼ææ¡£æ¶æä¾äºèªå®ä¹è·¯ç±å¼ï¼åæ­¤åæ°æ¯å¿éçã\n\nç¤ºä¾ï¼\n\n# 1. åå»ºä¸ä¸ªç´¢å¼\ndelete my-index-000001\nput my-index-000001\n{\n  "mappings": {\n    "properties": {\n      "color": { "type": "keyword" }\n    }\n  }\n}\n\n# 2. åå¥ä¸ä¸ªææ¡£\nput my-index-000001/_doc/1\n{\n  "color": [\n    "blue",\n    "green"\n  ]\n}\n\n# 3. åå¥å¦ä¸ä¸ªææ¡£\nput my-index-000001/_doc/2\n{\n  "color": "blue"\n}\n\n# 3. ä½¿ç¨ terms query\nget my-index-000001/_search?pretty\n{\n  "query": {\n    "terms": {\n      "color": {\n        "index": "my-index-000001",\n        "id": "2",\n        "path": "color"\n      }\n    }\n  }\n}\n\ndelete my-index-000001\n\n\n\n# type query\n\n> 7.0.0 ååºå¼\n\ntype query ç¨äºæ¥è¯¢å·ææå®ç±»åçææ¡£ã\n\nç¤ºä¾ï¼\n\nget /_search\n{\n  "query": {\n    "type": {\n      "value": "_doc"\n    }\n  }\n}\n\n\n\n# wildcard query\n\nwildcard query å³ééç¬¦æ¥è¯¢ï¼è¿åä¸ééç¬¦æ¨¡å¼å¹éçææ¡£ã\n\n? ç¨æ¥å¹éä¸ä¸ªä»»æå­ç¬¦ï¼* ç¨æ¥å¹éé¶ä¸ªæèå¤ä¸ªå­ç¬¦ã\n\nç¤ºä¾ï¼ä»¥ä¸æç´¢è¿å user.id å­æ®µåå«ä»¥ ki å¼å¤´å¹¶ä»¥ y ç»å°¾çæ¯è¯­çææ¡£ãè¿äºå¹éé¡¹å¯ä»¥åæ¬ kiyãkity æ kimchyã\n\nget /_search\n{\n  "query": {\n    "wildcard": {\n      "user.id": {\n        "value": "ki*y",\n        "boost": 1.0,\n        "rewrite": "constant_score"\n      }\n    }\n  }\n}\n\n\n> æ³¨æï¼å¦æéç½®äºsearch.allow_expensive_queries ï¼åwildcard query ä¼è¢«ç¦ç¨ã\n\n\n# è¯é¡¹æ¥è¯¢å®æ´ç¤ºä¾\n\ndelete products\nput products\n{\n  "settings": {\n    "number_of_shards": 1\n  }\n}\n\npost /products/_bulk\n{ "index": { "_id": 1 }}\n{ "productid" : "xhdk-a-1293-#fj3","desc":"iphone" }\n{ "index": { "_id": 2 }}\n{ "productid" : "kdke-b-9947-#kl5","desc":"ipad" }\n{ "index": { "_id": 3 }}\n{ "productid" : "jodl-x-1937-#pv7","desc":"mbp" }\n\nget /products\n\npost /products/_search\n{\n  "query": {\n    "term": {\n      "desc": {\n        //"value": "iphone"\n        "value":"iphone"\n      }\n    }\n  }\n}\n\npost /products/_search\n{\n  "query": {\n    "term": {\n      "desc.keyword": {\n        //"value": "iphone"\n        //"value":"iphone"\n      }\n    }\n  }\n}\n\npost /products/_search\n{\n  "query": {\n    "term": {\n      "productid": {\n        "value": "xhdk-a-1293-#fj3"\n      }\n    }\n  }\n}\n\npost /products/_search\n{\n  //"explain": true,\n  "query": {\n    "term": {\n      "productid.keyword": {\n        "value": "xhdk-a-1293-#fj3"\n      }\n    }\n  }\n}\n\npost /products/_search\n{\n  "explain": true,\n  "query": {\n    "constant_score": {\n      "filter": {\n        "term": {\n          "productid.keyword": "xhdk-a-1293-#fj3"\n        }\n      }\n\n    }\n  }\n}\n\n\n\n# å¤åæ¥è¯¢\n\nå¤åæ¥è¯¢å°±æ¯æä¸äºç®åæ¥è¯¢ç»åå¨ä¸èµ·å®ç°æ´å¤æçæ¥è¯¢éæ±ï¼é¤æ­¤ä¹å¤ï¼å¤åæ¥è¯¢è¿å¯ä»¥æ§å¶å¦å¤ä¸ä¸ªæ¥è¯¢çè¡ä¸ºã\n\n\n# bool query\n\nbool æ¥è¯¢å¯ä»¥æä»»æå¤ä¸ªç®åæ¥è¯¢ç»åå¨ä¸èµ·ï¼ä½¿ç¨ mustãshouldãmust_notãfilter éé¡¹æ¥è¡¨ç¤ºç®åæ¥è¯¢ä¹é´çé»è¾ï¼æ¯ä¸ªéé¡¹é½å¯ä»¥åºç° 0 æ¬¡å°å¤æ¬¡ï¼å®ä»¬çå«ä¹å¦ä¸ï¼\n\n * must ææ¡£å¿é¡»å¹é must éé¡¹ä¸çæ¥è¯¢æ¡ä»¶ï¼ç¸å½äºé»è¾è¿ç®ç andï¼ä¸åä¸ææ¡£ç¸å³åº¦çè¯åã\n * should ææ¡£å¯ä»¥å¹é should éé¡¹ä¸çæ¥è¯¢æ¡ä»¶ä¹å¯ä»¥ä¸å¹éï¼ç¸å½äºé»è¾è¿ç®ç orï¼ä¸åä¸ææ¡£ç¸å³åº¦çè¯åã\n * must_not ä¸ must ç¸åï¼å¹éè¯¥éé¡¹ä¸çæ¥è¯¢æ¡ä»¶çææ¡£ä¸ä¼è¢«è¿åï¼éè¦æ³¨æçæ¯ï¼must_not è¯­å¥ä¸ä¼å½±åè¯åï¼å®çä½ç¨åªæ¯å°ä¸ç¸å³çææ¡£æé¤ã\n * filter å must ä¸æ ·ï¼å¹é filter éé¡¹ä¸çæ¥è¯¢æ¡ä»¶çææ¡£æä¼è¢«è¿åï¼ä½æ¯ filter ä¸è¯åï¼åªèµ·å°è¿æ»¤åè½ï¼ä¸ must_not ç¸åã\n\nåè®¾è¦æ¥è¯¢ title ä¸­åå«å³é®è¯ javaï¼å¹¶ä¸ price ä¸è½é«äº 70ï¼description å¯ä»¥åå«ä¹å¯ä»¥ä¸åå«èææºçä¹¦ç±ï¼æé  bool æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget books/_search\n{\n  "query": {\n    "bool": {\n      "filter": {\n        "term": {\n          "status": 1\n        }\n      },\n      "must_not": {\n        "range": {\n          "price": {\n            "gte": 70\n          }\n        }\n      },\n      "must": {\n        "match": {\n          "title": "java"\n        }\n      },\n      "should": [\n        {\n          "match": {\n            "description": "èææº"\n          }\n        }\n      ],\n      "minimum_should_match": 1\n    }\n  }\n}\n\n\næå³å¸å°æ¥è¯¢æ´è¯¦ç»çä¿¡æ¯åè bool queryï¼ç»åæ¥è¯¢ï¼è¯¦è§£ã\n\n\n# boosting query\n\nboosting æ¥è¯¢ç¨äºéè¦å¯¹ä¸¤ä¸ªæ¥è¯¢çè¯åè¿è¡è°æ´çåºæ¯ï¼boosting æ¥è¯¢ä¼æä¸¤ä¸ªæ¥è¯¢å°è£å¨ä¸èµ·å¹¶éä½å¶ä¸­ä¸ä¸ªæ¥è¯¢çè¯åã\n\nboosting æ¥è¯¢åæ¬ positiveãnegative å negative_boost ä¸ä¸ªé¨åï¼positive ä¸­çæ¥è¯¢è¯åä¿æä¸åï¼negative ä¸­çæ¥è¯¢ä¼éä½ææ¡£è¯åï¼negative_boost ææ negative ä¸­éä½çæå¼ãå¦ææä»¬æ³å¯¹ 2015 å¹´ä¹ååºççä¹¦éä½è¯åï¼å¯ä»¥æé ä¸ä¸ª boosting æ¥è¯¢ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget books/_search\n{\n\t"query": {\n\t\t"boosting": {\n\t\t\t"positive": {\n\t\t\t\t"match": {\n\t\t\t\t\t"title": "python"\n\t\t\t\t}\n\t\t\t},\n\t\t\t"negative": {\n\t\t\t\t"range": {\n\t\t\t\t\t"publish_time": {\n\t\t\t\t\t\t"lte": "2015-01-01"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t"negative_boost": 0.2\n\t\t}\n\t}\n}\n\n\nboosting æ¥è¯¢ä¸­æå®äºæå¶å å­ä¸º 0.2ï¼publish_time çå¼å¨ 2015-01-01 ä¹åçææ¡£å¾åä¸åï¼publish_time çå¼å¨ 2015-01-01 ä¹åçææ¡£å¾åä¸ºåå¾åç 0.2 åã\n\n\n# constant_score query\n\nconstantscore query åè£ä¸ä¸ª filter queryï¼å¹¶è¿åå¹éè¿æ»¤å¨æ¥è¯¢æ¡ä»¶çææ¡£ï¼ä¸å®ä»¬çç¸å³æ§è¯åé½ç­äº _boost åæ°å¼ï¼å¯ä»¥çè§£ä¸ºåæçåºäº tf-idf æ bm25 çç¸å³ååºå®ä¸º 1.0ï¼æä»¥æç»è¯åä¸º 1.0 * boostï¼å³ç­äº boost åæ°å¼ï¼ãä¸é¢çæ¥è¯¢è¯­å¥ä¼è¿å title å­æ®µä¸­å«æå³é®è¯ elasticsearch çææ¡£ï¼ææææ¡£çè¯åé½æ¯ 1.8ï¼\n\nget books/_search\n{\n  "query": {\n    "constant_score": {\n      "filter": {\n        "term": {\n          "title": "elasticsearch"\n        }\n      },\n      "boost": 1.8\n    }\n  }\n}\n\n\n\n# dis_max query\n\ndis_max query ä¸ bool query æä¸å®èç³»ä¹æä¸å®åºå«ï¼dis_max query æ¯æå¤å¹¶åæ¥è¯¢ï¼å¯è¿åä¸ä»»ææ¥è¯¢æ¡ä»¶å­å¥å¹éçä»»ä½ææ¡£ç±»åãä¸ bool æ¥è¯¢å¯ä»¥å°ææå¹éæ¥è¯¢çåæ°ç¸ç»åä½¿ç¨çæ¹å¼ä¸åï¼dis_max æ¥è¯¢åªä½¿ç¨æä½³å¹éæ¥è¯¢æ¡ä»¶çåæ°ãè¯·çä¸é¢çä¾å­ï¼\n\nget books/_search\n{\n\t"query": {\n\t\t"dis_max": {\n\t\t\t"tie_breaker": 0.7,\n\t\t\t"boost": 1.2,\n\t\t\t"queries": [{\n\t\t\t\t\t"term": {\n\t\t\t\t\t\t"age": 34\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t"term": {\n\t\t\t\t\t\t"age": 35\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t}\n}\n\n\n\n# function_score query\n\nfunction_score query å¯ä»¥ä¿®æ¹æ¥è¯¢çææ¡£å¾åï¼è¿ä¸ªæ¥è¯¢å¨æäºæåµä¸éå¸¸æç¨ï¼æ¯å¦éè¿è¯åå½æ°è®¡ç®ææ¡£å¾åä»£ä»·è¾é«ï¼å¯ä»¥æ¹ç¨è¿æ»¤å¨å èªå®ä¹è¯åå½æ°çæ¹å¼æ¥åä»£ä¼ ç»çè¯åæ¹å¼ã\n\nä½¿ç¨ function_score queryï¼ç¨æ·éè¦å®ä¹ä¸ä¸ªæ¥è¯¢åä¸è³å¤ä¸ªè¯åå½æ°ï¼è¯åå½æ°ä¼å¯¹æ¥è¯¢å°çæ¯ä¸ªææ¡£åå«è®¡ç®å¾åã\n\nä¸é¢è¿æ¡æ¥è¯¢è¯­å¥ä¼è¿å books ç´¢å¼ä¸­çææææ¡£ï¼ææ¡£çæå¤§å¾åä¸º 5ï¼æ¯ä¸ªææ¡£çå¾åéæºçæï¼æéçè®¡ç®æ¨¡å¼ä¸ºç¸ä¹æ¨¡å¼ã\n\nget books/_search\n{\n  "query": {\n    "function_score": {\n      "query": {\n        "match all": {}\n      },\n      "boost": "5",\n      "random_score": {},\n      "boost_mode": "multiply"\n    }\n  }\n}\n\n\nä½¿ç¨èæ¬èªå®ä¹è¯åå¬å¼ï¼è¿éæ price å¼çååä¹ä¸å¼æ¹ä½ä¸ºæ¯ä¸ªææ¡£çå¾åï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget books/_search\n{\n  "query": {\n    "function_score": {\n      "query": {\n        "match": {\n          "title": "java"\n        }\n      },\n      "script_score": {\n        "inline": "math.sqrt(doc[\'price\'].value/10)"\n      }\n    }\n  }\n}\n\n\nå³äº function_score çæ´å¤è¯¦ç»åå®¹è¯·æ¥ç elasticsearch function_score æ¥è¯¢æå¼ºè¯¦è§£ã\n\n\n# indices query\n\nindices query éç¨äºéè¦å¨å¤ä¸ªç´¢å¼ä¹é´è¿è¡æ¥è¯¢çåºæ¯ï¼å®åè®¸æå®ä¸ä¸ªç´¢å¼åå­åè¡¨ååé¨æ¥è¯¢ãindices query ä¸­æ query å no_match_query ä¸¤é¨åï¼query ä¸­ç¨äºæç´¢æå®ç´¢å¼åè¡¨ä¸­çææ¡£ï¼no_match_query ä¸­çæ¥è¯¢æ¡ä»¶ç¨äºæç´¢æå®ç´¢å¼åè¡¨ä¹å¤çææ¡£ãä¸é¢çæ¥è¯¢è¯­å¥å®ç°äºæç´¢ç´¢å¼ booksãbooks2 ä¸­ title å­æ®µåå«å³é®å­ javascriptï¼å¶ä»ç´¢å¼ä¸­ title å­æ®µåå« basketball çææ¡£ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget books/_search\n{\n\t"query": {\n\t\t"indices": {\n\t\t\t"indices": ["books", "books2"],\n\t\t\t"query": {\n\t\t\t\t"match": {\n\t\t\t\t\t"title": "javascript"\n\t\t\t\t}\n\t\t\t},\n\t\t\t"no_match_query": {\n\t\t\t\t"term": {\n\t\t\t\t\t"title": "basketball"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# åµå¥æ¥è¯¢\n\nå¨ elasticsearch è¿æ ·çåå¸å¼ç³»ç»ä¸­æ§è¡å¨ sql é£æ ¼çè¿æ¥æ¥è¯¢ä»£ä»·æè´µï¼æ¯ä¸å¯è¡çãç¸åºå°ï¼ä¸ºäºå®ç°æ°´å¹³è§æ¨¡å°æ©å±ï¼elasticsearch æä¾äºä»¥ä¸ä¸¤ç§å½¢å¼ç joinï¼\n\n * nested queryï¼åµå¥æ¥è¯¢ï¼\n   \n   ææ¡£ä¸­å¯è½åå«åµå¥ç±»åçå­æ®µï¼è¿äºå­æ®µç¨æ¥ç´¢å¼ä¸äºæ°ç»å¯¹è±¡ï¼æ¯ä¸ªå¯¹è±¡é½å¯ä»¥ä½ä¸ºä¸æ¡ç¬ç«çææ¡£è¢«æ¥è¯¢åºæ¥ã\n\n * has_child queryï¼æå­æ¥è¯¢ï¼å has_parent queryï¼æç¶æ¥è¯¢ï¼\n   \n   ç¶å­å³ç³»å¯ä»¥å­å¨åä¸ªçç´¢å¼çä¸¤ä¸ªç±»åçææ¡£ä¹é´ãhas_child æ¥è¯¢å°è¿åå¶å­ææ¡£è½æ»¡è¶³ç¹å®æ¥è¯¢çç¶ææ¡£ï¼è has_parent åè¿åå¶ç¶ææ¡£è½æ»¡è¶³ç¹å®æ¥è¯¢çå­ææ¡£ã\n\n\n# nested query\n\nææ¡£ä¸­å¯è½åå«åµå¥ç±»åçå­æ®µï¼è¿äºå­æ®µç¨æ¥ç´¢å¼ä¸äºæ°ç»å¯¹è±¡ï¼æ¯ä¸ªå¯¹è±¡é½å¯ä»¥ä½ä¸ºä¸æ¡ç¬ç«çææ¡£è¢«æ¥è¯¢åºæ¥ï¼ç¨åµå¥æ¥è¯¢ï¼ã\n\nput /my_index\n{\n\t"mappings": {\n\t\t"type1": {\n\t\t\t"properties": {\n\t\t\t\t"obj1": {\n\t\t\t\t\t"type": "nested"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# has_child query\n\nææ¡£çç¶å­å³ç³»åå»ºç´¢å¼æ¶å¨æ å°ä¸­å£°æï¼è¿éä»¥åå·¥ï¼employeeï¼åå·¥ä½åå¸ï¼branchï¼ä¸ºä¾ï¼å®ä»¬å±äºä¸åçç±»åï¼ç¸å½äºæ°æ®åºä¸­çä¸¤å¼ è¡¨ï¼å¦ææ³æåå·¥åä»ä»¬å·¥ä½çåå¸å³èèµ·æ¥ï¼éè¦åè¯ elasticsearch ææ¡£ä¹é´çç¶å­å³ç³»ï¼è¿é employee æ¯ child typeï¼branch æ¯ parent typeï¼å¨æ å°ä¸­å£°æï¼æ§è¡å½ä»¤ï¼\n\nput /company\n{\n\t"mappings": {\n\t\t"branch": {},\n\t\t"employee": {\n\t\t\t"parent": { "type": "branch" }\n\t\t}\n\t}\n}\n\n\nä½¿ç¨ bulk api ç´¢å¼ branch ç±»åä¸çææ¡£ï¼å½ä»¤å¦ä¸ï¼\n\npost company/branch/_bulk\n{ "index": { "_id": "london" }}\n{ "name": "london westminster","city": "london","country": "uk" }\n{ "index": { "_id": "liverpool" }}\n{ "name": "liverpool central","city": "liverpool","country": "uk" }\n{ "index": { "_id": "paris" }}\n{ "name": "champs elysees","city": "paris","country": "france" }\n\n\næ·»å åå·¥æ°æ®ï¼\n\npost company/employee/_bulk\n{ "index": { "_id": 1,"parent":"london" }}\n{ "name": "alice smith","dob": "1970-10-24","hobby": "hiking" }\n{ "index": { "_id": 2,"parent":"london" }}\n{ "name": "mark tomas","dob": "1982-05-16","hobby": "diving" }\n{ "index": { "_id": 3,"parent":"liverpool" }}\n{ "name": "barry smith","dob": "1979-04-01","hobby": "hiking" }\n{ "index": { "_id": 4,"parent":"paris" }}\n{ "name": "adrien grand","dob": "1987-05-11","hobby": "horses" }\n\n\néè¿å­ææ¡£æ¥è¯¢ç¶ææ¡£è¦ä½¿ç¨ has_child æ¥è¯¢ãä¾å¦ï¼æç´¢ 1980 å¹´ä»¥ååºççåå·¥æå¨çåæ¯æºæï¼employee ä¸­ 1980 å¹´ä»¥ååºççæ mark thomas å adrien grandï¼ä»ä»¬åå«å¨ london å parisï¼æ§è¡ä»¥ä¸æ¥è¯¢å½ä»¤è¿è¡éªè¯ï¼\n\nget company/branch/_search\n{\n\t"query": {\n\t\t"has_child": {\n\t\t\t"type": "employee",\n\t\t\t"query": {\n\t\t\t\t"range": { "dob": { "gte": "1980-01-01" } }\n\t\t\t}\n\t\t}\n\t}\n}\n\n\næç´¢åªäºæºæä¸­æåä¸º âalice smithâ çåå·¥ï¼å ä¸ºä½¿ç¨ match æ¥è¯¢ï¼ä¼è§£æä¸º âaliceâ å âsmithâï¼æä»¥ alice smith å barry smith æå¨çæºæä¼è¢«å¹éï¼æ§è¡ä»¥ä¸æ¥è¯¢å½ä»¤è¿è¡éªè¯ï¼\n\nget company/branch/_search\n{\n\t"query": {\n\t\t"has_child": {\n\t\t\t"type": "employee",\n\t\t\t"score_mode": "max",\n\t\t\t"query": {\n\t\t\t\t"match": { "name": "alice smith" }\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nå¯ä»¥ä½¿ç¨ min_children æå®å­ææ¡£çæå°ä¸ªæ°ãä¾å¦ï¼æç´¢æå°å«æä¸¤ä¸ª employee çæºæï¼æ¥è¯¢å½ä»¤å¦ä¸ï¼\n\nget company/branch/_search?pretty\n{\n\t"query": {\n\t\t"has_child": {\n\t\t\t"type": "employee",\n\t\t\t"min_children": 2,\n\t\t\t"query": {\n\t\t\t\t"match_all": {}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# has_parent query\n\néè¿ç¶ææ¡£æ¥è¯¢å­ææ¡£ä½¿ç¨ has_parent æ¥è¯¢ãæ¯å¦ï¼æç´¢åªäº employee å·¥ä½å¨ ukï¼æ¥è¯¢å½ä»¤å¦ä¸ï¼\n\nget company/employee/_search\n{\n\t"query": {\n\t\t"has_parent": {\n\t\t\t"parent_type": "branch",\n\t\t\t"query": {\n\t\t\t\t"match": { "country": "uk }\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# ä½ç½®æ¥è¯¢\n\nelasticsearch å¯ä»¥å¯¹å°çä½ç½®ç¹ geo_point ç±»ååå°çä½ç½®å½¢ç¶ geo_shape ç±»åçæ°æ®è¿è¡æç´¢ãä¸ºäºå­¦ä¹ æ¹ä¾¿ï¼è¿éåå¤ä¸äºåå¸çå°çåæ ä½ä¸ºæµè¯æ°æ®ï¼æ¯ä¸æ¡ææ¡£é½åå«åå¸åç§°åå°çåæ è¿ä¸¤ä¸ªå­æ®µï¼è¿éçåæ ç¹åçæ¯åä¸ªåå¸ä¸­å¿çä¸ä¸ªä½ç½®ãé¦åæä¸é¢çåå®¹ä¿å­å° geo.json æä»¶ä¸­ï¼\n\n{"index":{ "_index":"geo","_type":"city","_id":"1" }}\n{"name":"åäº¬","location":"39.9088145109,116.3973999023"}\n{"index":{ "_index":"geo","_type":"city","_id": "2" }}\n{"name":"ä¹é²æ¨é½","location":"43.8266300000,87.6168800000"}\n{"index":{ "_index":"geo","_type":"city","_id":"3" }}\n{"name":"è¥¿å®","location":"34.3412700000,108.9398400000"}\n{"index":{ "_index":"geo","_type":"city","_id":"4" }}\n{"name":"éå·","location":"34.7447157466,113.6587142944"}\n{"index":{ "_index":"geo","_type":"city","_id":"5" }}\n{"name":"æ­å·","location":"30.2294080260,120.1492309570"}\n{"index":{ "_index":"geo","_type":"city","_id":"6" }}\n{"name":"æµå","location":"36.6518400000,117.1200900000"}\n\n\nåå»ºä¸ä¸ªç´¢å¼å¹¶è®¾ç½®æ å°ï¼\n\nput geo\n{\n\t"mappings": {\n\t\t"city": {\n\t\t\t"properties": {\n\t\t\t\t"name": {\n\t\t\t\t\t"type": "keyword"\n\t\t\t\t},\n\t\t\t\t"location": {\n\t\t\t\t\t"type": "geo_point"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nç¶åæ§è¡æ¹éå¯¼å¥å½ä»¤ï¼\n\ncurl -xpost "http://localhost:9200/_bulk?pretty" --data-binary @geo.json\n\n\n\n# geo_distance query\n\ngeo_distance query å¯ä»¥æ¥æ¾å¨ä¸ä¸ªä¸­å¿ç¹æå®èå´åçå°çç¹ææ¡£ãä¾å¦ï¼æ¥æ¾è·ç¦»å¤©æ´¥ 200km ä»¥åçåå¸ï¼æç´¢ç»æä¸­ä¼è¿ååäº¬ï¼å½ä»¤å¦ä¸ï¼\n\nget geo/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": {\n\t\t\t\t"match_all": {}\n\t\t\t},\n\t\t\t"filter": {\n\t\t\t\t"geo_distance": {\n\t\t\t\t\t"distance": "200km",\n\t\t\t\t\t"location": {\n\t\t\t\t\t\t"lat": 39.0851000000,\n\t\t\t\t\t\t"lon": 117.1993700000\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\næååå¸ç¦»åäº¬çè·ç¦»æåºï¼\n\nget geo/_search\n{\n  "query": {\n    "match_all": {}\n  },\n  "sort": [{\n    "_geo_distance": {\n      "location": "39.9088145109,116.3973999023",\n      "unit": "km",\n      "order": "asc",\n      "distance_type": "plane"\n    }\n  }]\n}\n\n\nå¶ä¸­ location å¯¹åºçç»çº¬åº¦å­æ®µï¼unit ä¸º km è¡¨ç¤ºå°è·ç¦»ä»¥ km ä¸ºåä½åå¥å°æ¯ä¸ªè¿åç»æç sort é®ä¸­ï¼distance_type ä¸º plane è¡¨ç¤ºä½¿ç¨å¿«éä½ç²¾åº¦ç¥å·®ç plane è®¡ç®æ¹å¼ã\n\n\n# geo_bounding_box query\n\ngeo_bounding_box query ç¨äºæ¥æ¾è½å¥æå®çç©å½¢åçå°çåæ ãæ¥è¯¢ä¸­ç±ä¸¤ä¸ªç¹ç¡®å®ä¸ä¸ªç©å½¢ï¼ç¶åå¨ç©å½¢åºååæ¥è¯¢å¹éçææ¡£ã\n\nget geo/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": {\n\t\t\t\t"match_all": {}\n\t\t\t},\n\t\t\t"filter": {\n\t\t\t\t"geo_bounding_box": {\n\t\t\t\t\t"location": {\n\t\t\t\t\t\t"top_left": {\n\t\t\t\t\t\t\t"lat": 38.4864400000,\n\t\t\t\t\t\t\t"lon": 106.2324800000\n\t\t\t\t\t\t},\n\t\t\t\t\t\t"bottom_right": {\n\t\t\t\t\t\t\t"lat": 28.6820200000,\n\t\t\t\t\t\t\t"lon": 115.8579400000\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# geo_polygon query\n\ngeo_polygon query ç¨äºæ¥æ¾å¨æå®å¤è¾¹å½¢åçå°çç¹ãä¾å¦ï¼å¼åæµ©ç¹ãéåºãä¸æµ·ä¸å°ç»æä¸ä¸ªä¸è§å½¢ï¼æ¥è¯¢ä½ç½®å¨è¯¥ä¸è§å½¢åºååçåå¸ï¼å½ä»¤å¦ä¸ï¼\n\nget geo/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": {\n\t\t\t\t"match_all": {}\n\t\t\t}\n\t\t},\n\t\t"filter": {\n\t\t\t"geo_polygon": {\n\t\t\t\t"location": {\n\t\t\t\t\t"points": [{\n\t\t\t\t\t\t"lat": 40.8414900000,\n\t\t\t\t\t\t"lon": 111.7519900000\n\t\t\t\t\t}, {\n\t\t\t\t\t\t"lat": 29.5647100000,\n\t\t\t\t\t\t"lon": 106.5507300000\n\t\t\t\t\t}, {\n\t\t\t\t\t\t"lat": 31.2303700000,\n\t\t\t\t\t\t"lon": 121.4737000000\n\t\t\t\t\t}]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# geo_shape query\n\ngeo_shape query ç¨äºæ¥è¯¢ geo_shape ç±»åçå°çæ°æ®ï¼å°çå½¢ç¶ä¹é´çå³ç³»æç¸äº¤ãåå«ãä¸ç¸äº¤ä¸ç§ãåå»ºä¸ä¸ªæ°çç´¢å¼ç¨äºæµè¯ï¼å¶ä¸­ location å­æ®µçç±»åè®¾ä¸º geo_shape ç±»åã\n\nput geoshape\n{\n\t"mappings": {\n\t\t"city": {\n\t\t\t"properties": {\n\t\t\t\t"name": {\n\t\t\t\t\t"type": "keyword"\n\t\t\t\t},\n\t\t\t\t"location": {\n\t\t\t\t\t"type": "geo_shape"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nå³äºç»çº¬åº¦çé¡ºåºè¿éåä¸ä¸ªè¯´æï¼geo_point ç±»åçå­æ®µçº¬åº¦å¨åç»åº¦å¨åï¼ä½æ¯å¯¹äº geo_shape ç±»åä¸­çç¹ï¼æ¯ç»åº¦å¨åçº¬åº¦å¨åï¼è¿ä¸ç¹éè¦ç¹å«æ³¨æã\n\næè¥¿å®åéå·è¿æççº¿åå¥ç´¢å¼ï¼\n\npost geoshape/city/1\n{\n\t"name": "è¥¿å®-éå·",\n\t"location": {\n\t\t"type": "linestring",\n\t\t"coordinates": [\n\t\t\t[108.9398400000, 34.3412700000],\n\t\t\t[113.6587142944, 34.7447157466]\n\t\t]\n\t}\n}\n\n\næ¥è¯¢åå«å¨ç±é¶å·ååæä½ä¸ºå¯¹è§çº¿ä¸çç¹ç»æçç©å½¢çå°çå½¢ç¶ï¼ç±äºè¥¿å®åéå·ç»æçç´çº¿è½å¨è¯¥ç©å½¢åºååï¼å æ­¤å¯ä»¥è¢«æ¥è¯¢å°ãå½ä»¤å¦ä¸ï¼\n\nget geoshape/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": {\n\t\t\t\t"match_all": {}\n\t\t\t},\n\t\t\t"filter": {\n\t\t\t\t"geo_shape": {\n\t\t\t\t\t"location": {\n\t\t\t\t\t\t"shape": {\n\t\t\t\t\t\t\t"type": "envelope",\n\t\t\t\t\t\t\t"coordinates": [\n\t\t\t\t\t\t\t\t[106.23248, 38.48644],\n\t\t\t\t\t\t\t\t[115.85794, 28.68202]\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t},\n\t\t\t\t\t\t"relation": "within"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# ç¹æ®æ¥è¯¢\n\n\n# more_like_this query\n\nmore_like_this query å¯ä»¥æ¥è¯¢åæä¾ææ¬ç±»ä¼¼çææ¡£ï¼éå¸¸ç¨äºè¿ä¼¼ææ¬çæ¨èç­åºæ¯ãæ¥è¯¢å½ä»¤å¦ä¸ï¼\n\nget books/_search\n{\n\t"query": {\n\t\t"more_like_ this": {\n\t\t\t"fields": ["title", "description"],\n\t\t\t"like": "java virtual machine",\n\t\t\t"min_term_freq": 1,\n\t\t\t"max_query_terms": 12\n\t\t}\n\t}\n}\n\n\nå¯éçåæ°ååå¼è¯´æå¦ä¸ï¼\n\n * fields è¦å¹éçå­æ®µï¼é»è®¤æ¯ _all å­æ®µã\n * like è¦å¹éçææ¬ã\n * min_term_freq ææ¡£ä¸­è¯é¡¹çæä½é¢çï¼é»è®¤æ¯ 2ï¼ä½äºæ­¤é¢ççææ¡£ä¼è¢«å¿½ç¥ã\n * max_query_terms query ä¸­è½åå«çæå¤§è¯é¡¹æ°ç®ï¼é»è®¤ä¸º 25ã\n * min_doc_freq æå°çææ¡£é¢çï¼é»è®¤ä¸º 5ã\n * max_doc_freq æå¤§ææ¡£é¢çã\n * min_word length åè¯çæå°é¿åº¦ã\n * max_word length åè¯çæå¤§é¿åº¦ã\n * stop_words åç¨è¯åè¡¨ã\n * analyzer åè¯å¨ã\n * minimum_should_match ææ¡£åºå¹éçæå°è¯é¡¹æ°ï¼é»è®¤ä¸º query åè¯åè¯é¡¹æ°ç 30%ã\n * boost terms è¯é¡¹çæéã\n * include æ¯å¦æè¾å¥ææ¡£ä½ä¸ºç»æè¿åã\n * boost æ´ä¸ª query çæéï¼é»è®¤ä¸º 1.0ã\n\n\n# script query\n\nelasticsearch æ¯æä½¿ç¨èæ¬è¿è¡æ¥è¯¢ãä¾å¦ï¼æ¥è¯¢ä»·æ ¼å¤§äº 180 çææ¡£ï¼å½ä»¤å¦ä¸ï¼\n\nget books/_search\n{\n  "query": {\n    "script": {\n      "script": {\n        "inline": "doc[\'price\'].value > 180",\n        "lang": "painless"\n      }\n    }\n  }\n}\n\n\n\n# percolate query\n\nä¸è¬æåµä¸ï¼æä»¬æ¯åæææ¡£åå¥å° elasticsearch ä¸­ï¼éè¿æ¥è¯¢è¯­å¥å¯¹ææ¡£è¿è¡æç´¢ãpercolate query åæ¯åå¶éèè¡ä¹çåæ³ï¼å®ä¼åæ³¨åæ¥è¯¢æ¡ä»¶ï¼æ ¹æ®ææ¡£æ¥æ¥è¯¢ queryãä¾å¦ï¼å¨ my-index ç´¢å¼ä¸­æä¸ä¸ª laptop ç±»åï¼ææ¡£æ price å name ä¸¤ä¸ªå­æ®µï¼å¨æ å°ä¸­å£°æä¸ä¸ª percolator ç±»åç queryï¼å½ä»¤å¦ä¸ï¼\n\nput my-index\n{\n\t"mappings": {\n\t\t"laptop": {\n\t\t\t"properties": {\n\t\t\t\t"price": { "type": "long" },\n\t\t\t\t"name": { "type": "text" }\n\t\t\t},\n\t\t\t"queries": {\n\t\t\t\t"properties": {\n\t\t\t\t\t"query": { "type": "percolator" }\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\næ³¨åä¸ä¸ª bool queryï¼bool query ä¸­åå«ä¸ä¸ª range queryï¼è¦æ± price å­æ®µçåå¼å°äºç­äº 10000ï¼å¹¶ä¸ name å­æ®µä¸­å«æå³é®è¯ macbookï¼\n\nput /my-index/queries/1?refresh\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": [{\n\t\t\t\t"range": { "price": { "lte": 10000 } }\n\t\t\t}, {\n\t\t\t\t"match": { "name": "macbook" }\n\t\t\t}]\n\t\t}\n\t}\n}\n\n\néè¿ææ¡£æ¥è¯¢ queryï¼\n\nget /my-index/_search\n{\n\t"query": {\n\t\t"percolate": {\n\t\t\t"field": "query",\n\t\t\t"document_type": "laptop",\n\t\t\t"document": {\n\t\t\t\t"price": 9999,\n\t\t\t\t"name": "macbook pro on sale"\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nææ¡£ç¬¦å query ä¸­çæ¡ä»¶ï¼è¿åç»æä¸­å¯ä»¥æ¥å°ä¸æä¸­æ³¨åç bool queryãpercolate query çè¿ç§ç¹æ§éç¨äºæ°æ®åç±»ãæ°æ®è·¯ç±ãäºä»¶çæ§åé¢è­¦ç­åºæ¯ã',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Elasticsearch é«äº®æç´¢åæ¾ç¤º",frontmatter:{title:"Elasticsearch é«äº®æç´¢åæ¾ç¤º",date:"2022-02-22T21:01:01.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","é«äº®"],permalink:"/pages/e1b769/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/06.Elasticsearch%E9%AB%98%E4%BA%AE.html",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/06.Elasticsearché«äº®.md",key:"v-957680f8",path:"/pages/e1b769/",headers:[{level:2,title:"é«äº®åæ°",slug:"é«äº®åæ°",normalizedTitle:"é«äº®åæ°",charIndex:187},{level:2,title:"èªå®ä¹é«äº®çæ®µ",slug:"èªå®ä¹é«äº®çæ®µ",normalizedTitle:"èªå®ä¹é«äº®çæ®µ",charIndex:2379},{level:2,title:"å¤å­æ®µé«äº®",slug:"å¤å­æ®µé«äº®",normalizedTitle:"å¤å­æ®µé«äº®",charIndex:2728},{level:2,title:"é«äº®æ§è½åæ",slug:"é«äº®æ§è½åæ",normalizedTitle:"é«äº®æ§è½åæ",charIndex:3111}],headersStr:"é«äº®åæ° èªå®ä¹é«äº®çæ®µ å¤å­æ®µé«äº® é«äº®æ§è½åæ",content:'# Elasticsearch é«äº®æç´¢åæ¾ç¤º\n\nElasticsearch çé«äº®ï¼highlightï¼å¯ä»¥è®©æ¨ä»æç´¢ç»æä¸­çä¸ä¸ªæå¤ä¸ªå­æ®µä¸­è·åçªåºæ¾ç¤ºçæè¦ï¼ä»¥ä¾¿åç¨æ·æ¾ç¤ºæ¥è¯¢å¹éçä½ç½®ãå½æ¨è¯·æ±çªåºæ¾ç¤ºï¼å³é«äº®ï¼æ¶ï¼ååºç»æç highlight å­æ®µä¸­åæ¬é«äº®çå­æ®µåé«äº®ççæ®µãElasticsearch é»è®¤ä¼ç¨ <em></em> æ ç­¾æ è®°å³é®å­ã\n\n\n# é«äº®åæ°\n\nES æä¾äºå¦ä¸é«äº®åæ°ï¼\n\nåæ°                        è¯´æ\nboundary_chars            åå«æ¯ä¸ªè¾¹çå­ç¬¦çå­ç¬¦ä¸²ãé»è®¤ä¸º,! ?\\ \\ nã\nboundary_max_scan         æ«æè¾¹çå­ç¬¦çè·ç¦»ãé»è®¤ä¸º 20ã\nboundary_scanner          æå®å¦ä½åå²çªåºæ¾ç¤ºççæ®µï¼æ¯æ charsãsentenceãword ä¸ç§æ¹å¼ã\nboundary_scanner_locale   ç¨æ¥è®¾ç½®æç´¢åç¡®å®åè¯è¾¹ççæ¬å°åè®¾ç½®ï¼æ­¤åæ°ä½¿ç¨è¯­è¨æ è®°çå½¢å¼ï¼âen-USâ, âfr-FRâ, âja-JPâï¼\nencoder                   è¡¨ç¤ºä»£ç æ®µåºè¯¥æ¯ HTML ç¼ç ç:é»è®¤(æ ç¼ç )è¿æ¯ HTML (HTML-è½¬ä¹ä»£ç æ®µææ¬ï¼ç¶åæå¥é«äº®æ è®°)\nfields                    æå®æ£ç´¢é«äº®æ¾ç¤ºçå­æ®µãå¯ä»¥ä½¿ç¨ééç¬¦æ¥æå®å­æ®µãä¾å¦ï¼å¯ä»¥æå® comment**æ¥è·åä»¥\n                          comment*å¼å¤´çææææ¬åå³é®å­å­æ®µçé«äº®æ¾ç¤ºã\nforce_source              æ ¹æ®æºé«äº®æ¾ç¤ºãé»è®¤å¼ä¸º falseã\nfragmenter                æå®ææ¬åºå¦ä½å¨çªåºæ¾ç¤ºçæ®µä¸­æå:æ¯æåæ° simple æè spanã\nfragment_offset           æ§å¶è¦å¼å§çªåºæ¾ç¤ºçç©ºç½ãä»å¨ä½¿ç¨ fvh highlighter æ¶ææã\nfragment_size             å­ç¬¦ä¸­çªåºæ¾ç¤ºççæ®µçå¤§å°ãé»è®¤ä¸º 100ã\nhighlight_query           çªåºæ¾ç¤ºæç´¢æ¥è¯¢ä¹å¤çå¶ä»æ¥è¯¢çå¹éé¡¹ãè¿å¨ä½¿ç¨éæåæ¥è¯¢æ¶ç¹å«æç¨ï¼å ä¸ºé»è®¤æåµä¸é«äº®æ¾ç¤ºä¸ä¼èèè¿äºé®é¢ã\nmatched_fields            ç»åå¤ä¸ªå¹éç»æä»¥çªåºæ¾ç¤ºåä¸ªå­æ®µï¼å¯¹äºä½¿ç¨ä¸åæ¹å¼åæåä¸å­ç¬¦ä¸²çå¤å­æ®µãææç matched_fields å¿é¡»å°\n                          term_vector è®¾ç½®ä¸º\n                          with_positions_offsetsï¼ä½æ¯åªæå°å¹éé¡¹ç»åå°çå­æ®µæä¼è¢«å è½½ï¼å æ­¤åªæå° store è®¾ç½®ä¸º\n                          yes æè½ä½¿è¯¥å­æ®µåçãåªéç¨äº fvh highlighterã\nno_match_size             å¦ææ²¡æè¦çªåºæ¾ç¤ºçå¹éçæ®µï¼åå¸æä»å­æ®µå¼å¤´è¿åçææ¬éãé»è®¤ä¸º 0(ä¸è¿åä»»ä½åå®¹)ã\nnumber_of_fragments       è¿åççæ®µçæå¤§æ°éãå¦æçæ®µçæ°éè®¾ç½®ä¸º\n                          0ï¼åä¸ä¼è¿åä»»ä½çæ®µãç¸åï¼çªåºæ¾ç¤ºå¹¶è¿åæ´ä¸ªå­æ®µåå®¹ãå½éè¦çªåºæ¾ç¤ºç­ææ¬(å¦æ é¢æå°å)ï¼ä½ä¸éè¦åæ®µæ¶ï¼ä½¿ç¨æ­¤éç½®éå¸¸æ¹ä¾¿ãå¦æ\n                          number_of_fragments ä¸º 0ï¼åå¿½ç¥ fragment_sizeãé»è®¤ä¸º 5ã\norder                     è®¾ç½®ä¸º score\n                          æ¶ï¼æåæ°å¯¹çªåºæ¾ç¤ºççæ®µè¿è¡æåºãé»è®¤æåµä¸ï¼çæ®µå°æç§å®ä»¬å¨å­æ®µä¸­åºç°çé¡ºåºè¾åº(order:none)ãå°æ­¤éé¡¹è®¾ç½®ä¸º\n                          score å°é¦åè¾åºæç¸å³ççæ®µãæ¯ä¸ªé«äº®åºç¨èªå·±çé»è¾æ¥è®¡ç®ç¸å³æ§å¾åã\nphrase_limit              æ§å¶ææ¡£ä¸­æèèçå¹éç­è¯­çæ°éãé²æ­¢ fvh highlighter\n                          åæå¤ªå¤çç­è¯­åæ¶èå¤ªå¤çåå­ãæé«éå¶ä¼å¢å æ¥è¯¢æ¶é´å¹¶æ¶èæ´å¤åå­ãé»è®¤ä¸º 256ã\npre_tags                  ä¸ post_tags ä¸èµ·ä½¿ç¨ï¼å®ä¹ç¨äºçªåºæ¾ç¤ºææ¬ç HTML\n                          æ è®°ãé»è®¤æåµä¸ï¼çªåºæ¾ç¤ºçææ¬è¢«åè£å¨åæ è®°ä¸­ãæå®ä¸ºå­ç¬¦ä¸²æ°ç»ã\npost_tags                 ä¸ pre_tags ä¸èµ·ä½¿ç¨ï¼å®ä¹ç¨äºçªåºæ¾ç¤ºææ¬ç HTML\n                          æ è®°ãé»è®¤æåµä¸ï¼çªåºæ¾ç¤ºçææ¬è¢«åè£å¨åæ è®°ä¸­ãæå®ä¸ºå­ç¬¦ä¸²æ°ç»ã\nrequire_field_match       é»è®¤æåµä¸ï¼åªçªåºæ¾ç¤ºåå«æ¥è¯¢å¹éçå­æ®µãå° require_field_match è®¾ç½®ä¸º false\n                          ä»¥çªåºæ¾ç¤ºææå­æ®µãé»è®¤å¼ä¸º trueã\ntags_schema               è®¾ç½®ä¸ºä½¿ç¨åç½®æ è®°æ¨¡å¼çæ ·å¼ã\ntype                      ä½¿ç¨çé«äº®æ¨¡å¼ï¼å¯éé¡¹ä¸º**unifiedãplainæfvh**ãé»è®¤ä¸º unifiedã\n\n\n# èªå®ä¹é«äº®çæ®µ\n\nå¦ææä»¬æ³ä½¿ç¨èªå®ä¹æ ç­¾ï¼å¨é«äº®å±æ§ä¸­ç»éè¦é«äº®çå­æ®µå ä¸ pre_tags å post_tags å³å¯ãä¾å¦ï¼æç´¢ title å­æ®µä¸­åå«å³é®è¯ javascript çä¹¦ç±å¹¶ä½¿ç¨èªå®ä¹ HTML æ ç­¾é«äº®å³é®è¯ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET /books/_search\n{\n  "query": {\n    "match": { "title": "javascript" }\n  },\n  "highlight": {\n    "fields": {\n      "title": {\n        "pre_tags": ["<strong>"],\n        "post_tags": ["</strong>"]\n      }\n    }\n  }\n}\n\n\n\n# å¤å­æ®µé«äº®\n\nå³äºæç´¢é«äº®ï¼è¿éè¦ææ¡å¦ä½è®¾ç½®å¤å­æ®µæç´¢é«äº®ãæ¯å¦ï¼æç´¢ title å­æ®µçæ¶åï¼æä»¬ææ description å­æ®µä¸­çå³é®å­ä¹å¯ä»¥é«äº®ï¼è¿æ¶åå°±éè¦æ require_field_match å±æ§çåå¼è®¾ç½®ä¸º fasleãrequire_field_match çé»è®¤å¼ä¸º trueï¼åªä¼é«äº®å¹éçå­æ®µãå¤å­æ®µé«äº®çæ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET /books/_search\n{\n  "query": {\n    "match": { "title": "javascript" }\n  },\n  "highlight": {\n    "require_field_match": false,\n    "fields": {\n      "title": {},\n      "description": {}\n    }\n  }\n}\n\n\n\n# é«äº®æ§è½åæ\n\nElasticsearch æä¾äºä¸ç§é«äº®å¨ï¼åå«æ¯é»è®¤ç highlighter é«äº®å¨ãpostings-highlighter é«äº®å¨å fast-vector-highlighter é«äº®å¨ã\n\né»è®¤ç highlighter æ¯æåºæ¬çé«äº®å¨ãhighlighter é«äº®å¨å®ç°é«äº®åè½éè¦å¯¹ _source ä¸­ä¿å­çåå§ææ¡£è¿è¡äºæ¬¡åæï¼å¶éåº¦å¨ä¸ç§é«äº®å¨éææ¢ï¼ä¼ç¹æ¯ä¸éè¦é¢å¤çå­å¨ç©ºé´ã\n\npostings-highlighter é«äº®å¨å®ç°é«äº®åè½ä¸éè¦äºæ¬¡åæï¼ä½æ¯éè¦å¨å­æ®µçæ å°ä¸­è®¾ç½® index_options åæ°çåå¼ä¸º offsetsï¼å³ä¿å­å³é®è¯çåç§»éï¼éåº¦å¿«äºé»è®¤ç highlighter é«äº®å¨ãä¾å¦ï¼éç½® comment å­æ®µä½¿ç¨ postings-highlighter é«äº®å¨ï¼æ å°å¦ä¸ï¼\n\nPUT /example\n{\n  "mappings": {\n    "doc": {\n      "properties": {\n        "comment": {\n          "type": "text",\n          "index_options": "offsets"\n        }\n      }\n    }\n  }\n}\n\n\nfast-vector-highlighter é«äº®å¨å®ç°é«äº®åè½éåº¦æå¿«ï¼ä½æ¯éè¦å¨å­æ®µçæ å°ä¸­è®¾ç½® term_vector åæ°çåå¼ä¸º with_positions_offsetsï¼å³ä¿å­å³é®è¯çä½ç½®ååç§»ä¿¡æ¯ï¼å ç¨çå­å¨ç©ºé´æå¤§ï¼æ¯å¸åçç©ºé´æ¢æ¶é´çåæ³ãä¾å¦ï¼éç½® comment å­æ®µä½¿ç¨ fast-vector-highlighter é«äº®å¨ï¼æ å°å¦ä¸ï¼\n\nPUT /example\n{\n  "mappings": {\n    "doc": {\n      "properties": {\n        "comment": {\n          "type": "text",\n          "term_vector": "with_positions_offsets"\n        }\n      }\n    }\n  }\n}\n',normalizedContent:'# elasticsearch é«äº®æç´¢åæ¾ç¤º\n\nelasticsearch çé«äº®ï¼highlightï¼å¯ä»¥è®©æ¨ä»æç´¢ç»æä¸­çä¸ä¸ªæå¤ä¸ªå­æ®µä¸­è·åçªåºæ¾ç¤ºçæè¦ï¼ä»¥ä¾¿åç¨æ·æ¾ç¤ºæ¥è¯¢å¹éçä½ç½®ãå½æ¨è¯·æ±çªåºæ¾ç¤ºï¼å³é«äº®ï¼æ¶ï¼ååºç»æç highlight å­æ®µä¸­åæ¬é«äº®çå­æ®µåé«äº®ççæ®µãelasticsearch é»è®¤ä¼ç¨ <em></em> æ ç­¾æ è®°å³é®å­ã\n\n\n# é«äº®åæ°\n\nes æä¾äºå¦ä¸é«äº®åæ°ï¼\n\nåæ°                        è¯´æ\nboundary_chars            åå«æ¯ä¸ªè¾¹çå­ç¬¦çå­ç¬¦ä¸²ãé»è®¤ä¸º,! ?\\ \\ nã\nboundary_max_scan         æ«æè¾¹çå­ç¬¦çè·ç¦»ãé»è®¤ä¸º 20ã\nboundary_scanner          æå®å¦ä½åå²çªåºæ¾ç¤ºççæ®µï¼æ¯æ charsãsentenceãword ä¸ç§æ¹å¼ã\nboundary_scanner_locale   ç¨æ¥è®¾ç½®æç´¢åç¡®å®åè¯è¾¹ççæ¬å°åè®¾ç½®ï¼æ­¤åæ°ä½¿ç¨è¯­è¨æ è®°çå½¢å¼ï¼âen-usâ, âfr-frâ, âja-jpâï¼\nencoder                   è¡¨ç¤ºä»£ç æ®µåºè¯¥æ¯ html ç¼ç ç:é»è®¤(æ ç¼ç )è¿æ¯ html (html-è½¬ä¹ä»£ç æ®µææ¬ï¼ç¶åæå¥é«äº®æ è®°)\nfields                    æå®æ£ç´¢é«äº®æ¾ç¤ºçå­æ®µãå¯ä»¥ä½¿ç¨ééç¬¦æ¥æå®å­æ®µãä¾å¦ï¼å¯ä»¥æå® comment**æ¥è·åä»¥\n                          comment*å¼å¤´çææææ¬åå³é®å­å­æ®µçé«äº®æ¾ç¤ºã\nforce_source              æ ¹æ®æºé«äº®æ¾ç¤ºãé»è®¤å¼ä¸º falseã\nfragmenter                æå®ææ¬åºå¦ä½å¨çªåºæ¾ç¤ºçæ®µä¸­æå:æ¯æåæ° simple æè spanã\nfragment_offset           æ§å¶è¦å¼å§çªåºæ¾ç¤ºçç©ºç½ãä»å¨ä½¿ç¨ fvh highlighter æ¶ææã\nfragment_size             å­ç¬¦ä¸­çªåºæ¾ç¤ºççæ®µçå¤§å°ãé»è®¤ä¸º 100ã\nhighlight_query           çªåºæ¾ç¤ºæç´¢æ¥è¯¢ä¹å¤çå¶ä»æ¥è¯¢çå¹éé¡¹ãè¿å¨ä½¿ç¨éæåæ¥è¯¢æ¶ç¹å«æç¨ï¼å ä¸ºé»è®¤æåµä¸é«äº®æ¾ç¤ºä¸ä¼èèè¿äºé®é¢ã\nmatched_fields            ç»åå¤ä¸ªå¹éç»æä»¥çªåºæ¾ç¤ºåä¸ªå­æ®µï¼å¯¹äºä½¿ç¨ä¸åæ¹å¼åæåä¸å­ç¬¦ä¸²çå¤å­æ®µãææç matched_fields å¿é¡»å°\n                          term_vector è®¾ç½®ä¸º\n                          with_positions_offsetsï¼ä½æ¯åªæå°å¹éé¡¹ç»åå°çå­æ®µæä¼è¢«å è½½ï¼å æ­¤åªæå° store è®¾ç½®ä¸º\n                          yes æè½ä½¿è¯¥å­æ®µåçãåªéç¨äº fvh highlighterã\nno_match_size             å¦ææ²¡æè¦çªåºæ¾ç¤ºçå¹éçæ®µï¼åå¸æä»å­æ®µå¼å¤´è¿åçææ¬éãé»è®¤ä¸º 0(ä¸è¿åä»»ä½åå®¹)ã\nnumber_of_fragments       è¿åççæ®µçæå¤§æ°éãå¦æçæ®µçæ°éè®¾ç½®ä¸º\n                          0ï¼åä¸ä¼è¿åä»»ä½çæ®µãç¸åï¼çªåºæ¾ç¤ºå¹¶è¿åæ´ä¸ªå­æ®µåå®¹ãå½éè¦çªåºæ¾ç¤ºç­ææ¬(å¦æ é¢æå°å)ï¼ä½ä¸éè¦åæ®µæ¶ï¼ä½¿ç¨æ­¤éç½®éå¸¸æ¹ä¾¿ãå¦æ\n                          number_of_fragments ä¸º 0ï¼åå¿½ç¥ fragment_sizeãé»è®¤ä¸º 5ã\norder                     è®¾ç½®ä¸º score\n                          æ¶ï¼æåæ°å¯¹çªåºæ¾ç¤ºççæ®µè¿è¡æåºãé»è®¤æåµä¸ï¼çæ®µå°æç§å®ä»¬å¨å­æ®µä¸­åºç°çé¡ºåºè¾åº(order:none)ãå°æ­¤éé¡¹è®¾ç½®ä¸º\n                          score å°é¦åè¾åºæç¸å³ççæ®µãæ¯ä¸ªé«äº®åºç¨èªå·±çé»è¾æ¥è®¡ç®ç¸å³æ§å¾åã\nphrase_limit              æ§å¶ææ¡£ä¸­æèèçå¹éç­è¯­çæ°éãé²æ­¢ fvh highlighter\n                          åæå¤ªå¤çç­è¯­åæ¶èå¤ªå¤çåå­ãæé«éå¶ä¼å¢å æ¥è¯¢æ¶é´å¹¶æ¶èæ´å¤åå­ãé»è®¤ä¸º 256ã\npre_tags                  ä¸ post_tags ä¸èµ·ä½¿ç¨ï¼å®ä¹ç¨äºçªåºæ¾ç¤ºææ¬ç html\n                          æ è®°ãé»è®¤æåµä¸ï¼çªåºæ¾ç¤ºçææ¬è¢«åè£å¨åæ è®°ä¸­ãæå®ä¸ºå­ç¬¦ä¸²æ°ç»ã\npost_tags                 ä¸ pre_tags ä¸èµ·ä½¿ç¨ï¼å®ä¹ç¨äºçªåºæ¾ç¤ºææ¬ç html\n                          æ è®°ãé»è®¤æåµä¸ï¼çªåºæ¾ç¤ºçææ¬è¢«åè£å¨åæ è®°ä¸­ãæå®ä¸ºå­ç¬¦ä¸²æ°ç»ã\nrequire_field_match       é»è®¤æåµä¸ï¼åªçªåºæ¾ç¤ºåå«æ¥è¯¢å¹éçå­æ®µãå° require_field_match è®¾ç½®ä¸º false\n                          ä»¥çªåºæ¾ç¤ºææå­æ®µãé»è®¤å¼ä¸º trueã\ntags_schema               è®¾ç½®ä¸ºä½¿ç¨åç½®æ è®°æ¨¡å¼çæ ·å¼ã\ntype                      ä½¿ç¨çé«äº®æ¨¡å¼ï¼å¯éé¡¹ä¸º**unifiedãplainæfvh**ãé»è®¤ä¸º unifiedã\n\n\n# èªå®ä¹é«äº®çæ®µ\n\nå¦ææä»¬æ³ä½¿ç¨èªå®ä¹æ ç­¾ï¼å¨é«äº®å±æ§ä¸­ç»éè¦é«äº®çå­æ®µå ä¸ pre_tags å post_tags å³å¯ãä¾å¦ï¼æç´¢ title å­æ®µä¸­åå«å³é®è¯ javascript çä¹¦ç±å¹¶ä½¿ç¨èªå®ä¹ html æ ç­¾é«äº®å³é®è¯ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget /books/_search\n{\n  "query": {\n    "match": { "title": "javascript" }\n  },\n  "highlight": {\n    "fields": {\n      "title": {\n        "pre_tags": ["<strong>"],\n        "post_tags": ["</strong>"]\n      }\n    }\n  }\n}\n\n\n\n# å¤å­æ®µé«äº®\n\nå³äºæç´¢é«äº®ï¼è¿éè¦ææ¡å¦ä½è®¾ç½®å¤å­æ®µæç´¢é«äº®ãæ¯å¦ï¼æç´¢ title å­æ®µçæ¶åï¼æä»¬ææ description å­æ®µä¸­çå³é®å­ä¹å¯ä»¥é«äº®ï¼è¿æ¶åå°±éè¦æ require_field_match å±æ§çåå¼è®¾ç½®ä¸º fasleãrequire_field_match çé»è®¤å¼ä¸º trueï¼åªä¼é«äº®å¹éçå­æ®µãå¤å­æ®µé«äº®çæ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget /books/_search\n{\n  "query": {\n    "match": { "title": "javascript" }\n  },\n  "highlight": {\n    "require_field_match": false,\n    "fields": {\n      "title": {},\n      "description": {}\n    }\n  }\n}\n\n\n\n# é«äº®æ§è½åæ\n\nelasticsearch æä¾äºä¸ç§é«äº®å¨ï¼åå«æ¯é»è®¤ç highlighter é«äº®å¨ãpostings-highlighter é«äº®å¨å fast-vector-highlighter é«äº®å¨ã\n\né»è®¤ç highlighter æ¯æåºæ¬çé«äº®å¨ãhighlighter é«äº®å¨å®ç°é«äº®åè½éè¦å¯¹ _source ä¸­ä¿å­çåå§ææ¡£è¿è¡äºæ¬¡åæï¼å¶éåº¦å¨ä¸ç§é«äº®å¨éææ¢ï¼ä¼ç¹æ¯ä¸éè¦é¢å¤çå­å¨ç©ºé´ã\n\npostings-highlighter é«äº®å¨å®ç°é«äº®åè½ä¸éè¦äºæ¬¡åæï¼ä½æ¯éè¦å¨å­æ®µçæ å°ä¸­è®¾ç½® index_options åæ°çåå¼ä¸º offsetsï¼å³ä¿å­å³é®è¯çåç§»éï¼éåº¦å¿«äºé»è®¤ç highlighter é«äº®å¨ãä¾å¦ï¼éç½® comment å­æ®µä½¿ç¨ postings-highlighter é«äº®å¨ï¼æ å°å¦ä¸ï¼\n\nput /example\n{\n  "mappings": {\n    "doc": {\n      "properties": {\n        "comment": {\n          "type": "text",\n          "index_options": "offsets"\n        }\n      }\n    }\n  }\n}\n\n\nfast-vector-highlighter é«äº®å¨å®ç°é«äº®åè½éåº¦æå¿«ï¼ä½æ¯éè¦å¨å­æ®µçæ å°ä¸­è®¾ç½® term_vector åæ°çåå¼ä¸º with_positions_offsetsï¼å³ä¿å­å³é®è¯çä½ç½®ååç§»ä¿¡æ¯ï¼å ç¨çå­å¨ç©ºé´æå¤§ï¼æ¯å¸åçç©ºé´æ¢æ¶é´çåæ³ãä¾å¦ï¼éç½® comment å­æ®µä½¿ç¨ fast-vector-highlighter é«äº®å¨ï¼æ å°å¦ä¸ï¼\n\nput /example\n{\n  "mappings": {\n    "doc": {\n      "properties": {\n        "comment": {\n          "type": "text",\n          "term_vector": "with_positions_offsets"\n        }\n      }\n    }\n  }\n}\n',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Elasticsearch æåº",frontmatter:{title:"Elasticsearch æåº",date:"2022-01-19T22:49:16.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","æåº"],permalink:"/pages/24baff/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/07.Elasticsearch%E6%8E%92%E5%BA%8F.html",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/07.Elasticsearchæåº.md",key:"v-2ac3b3cb",path:"/pages/24baff/",headers:[{level:2,title:"é»è®¤ç¸å³æ§æåº",slug:"é»è®¤ç¸å³æ§æåº",normalizedTitle:"é»è®¤ç¸å³æ§æåº",charIndex:216},{level:3,title:"TF-IDF æ¨¡å",slug:"tf-idf-æ¨¡å",normalizedTitle:"tf-idf æ¨¡å",charIndex:459},{level:3,title:"BM25 æ¨¡å",slug:"bm25-æ¨¡å",normalizedTitle:"bm25 æ¨¡å",charIndex:1851},{level:2,title:"å­æ®µçå¼æåº",slug:"å­æ®µçå¼æåº",normalizedTitle:"å­æ®µçå¼æåº",charIndex:71},{level:2,title:"å¤å­æ®µæåº",slug:"å¤å­æ®µæåº",normalizedTitle:"å¤å­æ®µæåº",charIndex:2770},{level:2,title:"å¤å¼å­æ®µçæåº",slug:"å¤å¼å­æ®µçæåº",normalizedTitle:"å¤å¼å­æ®µçæåº",charIndex:3296},{level:2,title:"å°çä½ç½®ä¸çè·ç¦»æåº",slug:"å°çä½ç½®ä¸çè·ç¦»æåº",normalizedTitle:"å°çä½ç½®ä¸çè·ç¦»æåº",charIndex:3532},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:4519}],headersStr:"é»è®¤ç¸å³æ§æåº TF-IDF æ¨¡å BM25 æ¨¡å å­æ®µçå¼æåº å¤å­æ®µæåº å¤å¼å­æ®µçæåº å°çä½ç½®ä¸çè·ç¦»æåº åèèµæ",content:'# Elasticsearch æåº\n\nå¨ Elasticsearch ä¸­ï¼é»è®¤æåºæ¯æç§ç¸å³æ§çè¯åï¼_scoreï¼è¿è¡éåºæåºï¼ä¹å¯ä»¥æç§å­æ®µçå¼æåºãå¤çº§æåºãå¤å¼å­æ®µæåºãåºäº geoï¼å°çä½ç½®ï¼æåºä»¥åèªå®ä¹èæ¬æåºï¼é¤æ­¤ä¹å¤ï¼å¯¹äºç¸å³æ§çè¯åä¹å¯ä»¥ç¨ rescore äºæ¬¡ãä¸æ¬¡æåï¼å®å¯ä»¥éå®éæ°æåççªå£å¤§å°ï¼window sizeï¼ï¼å¹¶éå¯¹ä½ç¨èå´åçææ¡£ä¿®æ¹å¶å¾åï¼ä»èè¾¾å°ç²¾ç»åæ§å¶ç»æç¸å³æ§çç®çã\n\n\n# é»è®¤ç¸å³æ§æåº\n\nå¨ Elasticsearch ä¸­ï¼é»è®¤æåµä¸ï¼ææ¡£æ¯æç§ç¸å³æ§å¾åååºæåçï¼å¶å¯¹åºçç¸å³æ§å¾åå­æ®µç¨ _score æ¥è¡¨ç¤ºï¼å®æ¯æµ®ç¹æ°ç±»åï¼_score è¯åè¶é«ï¼ç¸å³æ§è¶é«ãè¯åæ¨¡åçéæ©å¯ä»¥éè¿ similarity åæ°å¨æ å°ä¸­æå®ã\n\nç¸ä¼¼åº¦ç®æ³å¯ä»¥æå­æ®µæå®ï¼åªéå¨æ å°ä¸­ä¸ºä¸åå­æ®µéå®å³å¯ï¼å¦æè¦ä¿®æ¹å·²æå­æ®µçç¸ä¼¼åº¦ç®æ³ï¼åªè½éè¿ä¸ºæ°æ®éæ°å»ºç«ç´¢å¼æ¥è¾¾å°ç®çãå³äºæ´å¤ es ç¸ä¼¼åº¦ç®æ³å¯ä»¥åè æ·±å¥çè§£ es ç¸ä¼¼åº¦ç®æ³ï¼ç¸å³æ§å¾åè®¡ç®ï¼ã\n\n\n# TF-IDF æ¨¡å\n\nElasticsearch å¨ 5.4 çæ¬ä»¥åï¼text ç±»åçå­æ®µï¼é»è®¤éç¨åºäº tf-idf çåéç©ºé´æ¨¡åã\n\nå¨å¼å§è®¡ç®å¾åä¹æ¶ï¼Elasticsearch ä½¿ç¨äºè¢«æç´¢è¯æ¡çé¢çä»¥åå®æå¤å¸¸è§æ¥å½±åå¾åãä¸ä¸ªç®ç­çè§£éæ¯ï¼ä¸ä¸ªè¯æ¡åºç°å¨æä¸ªææ¡£ä¸­çæ¬¡æ°è¶å¤ï¼å®å°±è¶ç¸å³ï¼ä½æ¯ï¼å¦æè¯¥è¯æ¡åºç°å¨ä¸åçææ¡£çæ¬¡æ°è¶å¤ï¼å®å°±è¶ä¸ç¸å³ãè¿ä¸ç¹è¢«ç§°ä¸º TF-IDFï¼TF æ¯è¯é¢ï¼term frequencyï¼ï¼IDF æ¯éææ¡£é¢çï¼inverse document frequencyï¼ã\n\nèèç»ä¸ç¯ææ¡£æåçé¦è¦æ¹å¼ï¼æ¯ç»è®¡ä¸ä¸ªè¯æ¡å¨ææ¬ä¸­åºç°çæ¬¡æ°ãä¸¾ä¸ªä¾å­ï¼å¦æå¨ç¨æ·çåºåæç´¢å³äº Elasticsearch ç get-togetherï¼ç¨æ·å¸æé¢ç¹æå Elasticsearch çåç»è¢«ä¼åå±ç¤ºåºæ¥ã\n\n"We will discuss Elasticsearch at the next Big Data group."\n"Tuesday the Elasticsearch team will gather to answer questions about Elasticsearch."\n\n\nç¬¬ä¸ä¸ªå¥å­æå° Elasticsearch ä¸æ¬¡ï¼èç¬¬äºä¸ªå¥å­æå° Elasticsearch ä¸¤æ¬¡ï¼æä»¥åå«ç¬¬äºå¥è¯çææ¡£åºè¯¥æ¯åå«ç¬¬ä¸å¥è¯çææ¡£æ¥ææ´é«çå¾åãå¦ææä»¬è¦æç§æ°éæ¥è®¨è®ºï¼ç¬¬ä¸å¥è¯çè¯é¢ï¼TFï¼æ¯ 1ï¼èç¬¬äºå¥è¯çè¯é¢å°æ¯ 2ã\n\néææ¡£é¢çæ¯ææ¡£è¯é¢ç¨å¾®å¤æä¸ç¹ãè¿ä¸ªå¬ä¸å»å¾é·ç«çæè¿°æå³çï¼å¦æä¸ä¸ªåè¯ï¼éå¸¸æ¯åè¯ï¼ä½ä¸ä¸å®æ¯ï¼å¨ç´¢å¼çä¸åææ¡£ä¸­åºç°è¶å¤çæ¬¡æ°ï¼é£ä¹å®å°±è¶ä¸éè¦ãä½¿ç¨å¦ä¸ä¾å­æ´å®¹æè§£éè¿ä¸ç¹ã\n\n"We use Elasticsearch to power the search for our website."\n"The developers like Elasticsearch so far."\n"The scoring of documents is calculated by the scoring formula."\n\n\nå¦ä¸è¿°ä¾å­ï¼éè¦çè§£ä»¥ä¸å ç¹ï¼\n\n * è¯æ¡ âElasticsearchâ çææ¡£é¢çæ¯ 2ï¼å ä¸ºå®åºç°å¨ä¸¤ç¯ææ¡£ä¸­ï¼ãææ¡£é¢ççéæºèªå¾åä¹ä»¥ 1/DFï¼è¿é DF æ¯è¯¥è¯æ¡çææ¡£é¢çãè¿å°±æå³çï¼ç±äºè¯æ¡æ¥ææ´é«çææ¡£é¢çï¼å®çæéå°±ä¼éä½ã\n * è¯æ¡ âtheâ çææ¡£é¢çæ¯ 3ï¼å ä¸ºå®åºç°å¨ææçä¸ç¯ææ¡£ä¸­ãè¯·æ³¨æï¼å°½ç®¡ âtheâ å¨æåä¸ç¯ææ¡£ä¸­åºç°äºä¸¤æ¬¡ï¼å®çææ¡£é¢çè¿æ¯ 3ãè¿æ¯å ä¸ºï¼éææ¡£é¢çåªæ£æ¥ä¸ä¸ªè¯æ¡æ¯å¦åºç°å¨æææ¡£ä¸­ï¼èä¸æ£æ¥å®åºç°å¤å°æ¬¡ãé£ä¸ªåºè¯¥æ¯è¯é¢æå³å¿çäºæã\n\néææ¡£é¢çæ¯ä¸ä¸ªéè¦çå ç´ ï¼ç¨äºå¹³è¡¡è¯æ¡çè¯é¢ãä¸¾ä¸ªä¾å­ï¼èèæä¸ä¸ªç¨æ·æç´¢è¯æ¡ âthe scoreâï¼åè¯ the å ä¹åºç°å¨æ¯ä¸ªæ®éçè±è¯­ææ¬ä¸­ï¼å¦æå®ä¸è¢«åè¡¡ä¸ä¸ï¼åè¯ the çé¢çè¦å®å¨æ·¹æ²¡åè¯ score çé¢çãéææ¡£é¢ç IDF åè¡¡äº the è¿ç§å¸¸è§è¯çç¸å³æ§å½±åï¼æä»¥å®éçç¸å³æ§å¾åå°ä¼å¯¹æ¥è¯¢çè¯æ¡æä¸ä¸ªæ´åç¡®çæè¿°ã\n\nä¸æ¦è¯é¢ TF åéææ¡£é¢ç IDF è®¡ç®å®æï¼å°±å¯ä»¥ä½¿ç¨ TF-IDF å¬å¼æ¥è®¡ç®ææ¡£çå¾åã\n\n\n# BM25 æ¨¡å\n\nElasticsearch å¨ 5.4 çæ¬ä¹åï¼éå¯¹ text ç±»åçå­æ®µï¼é»è®¤éç¨çæ¯ BM25 è¯åæ¨¡åï¼èä¸æ¯åºäº tf-idf çåéç©ºé´æ¨¡åï¼è¯åæ¨¡åçéæ©å¯ä»¥éè¿ similarity åæ°å¨æ å°ä¸­æå®ã\n\n\n# å­æ®µçå¼æåº\n\nå¨ Elasticsearch ä¸­æç§å­æ®µçå¼æåºï¼å¯ä»¥å©ç¨ sort åæ°å®ç°ã\n\nGET books/_search\n{\n  "sort": {\n    "price": {\n      "order": "desc"\n    }\n  }\n}\n\n\nè¿åç»æå¦ä¸ï¼\n\n{\n  "took": 132,\n  "timed_out": false,\n  "_shards": {\n    "total": 10,\n    "successful": 10,\n    "skipped": 0,\n    "failed": 0\n  },\n  "hits": {\n    "total": 749244,\n    "max_score": null,\n    "hits": [\n      {\n        "_index": "books",\n        "_type": "book",\n        "_id": "8456479",\n        "_score": null,\n        "_source": {\n          "id": 8456479,\n          "price": 1580.00,\n          ...\n        },\n        "sort": [\n          1580.00\n        ]\n      },\n      ...\n    ]\n  }\n}\n\n\nä»å¦ä¸è¿åç»æï¼å¯ä»¥çåºï¼max_score å _score å­æ®µé½è¿å nullï¼è¿åå­æ®µå¤åº sort å­æ®µï¼åå«æåºå­æ®µçåå¼ãè®¡ç® _score çè±éå·¨å¤§ï¼å¦æä¸æ ¹æ®ç¸å³æ§æåºï¼è®°å½ _score æ¯æ²¡ææä¹çãå¦ææ è®ºå¦ä½é½è¦è®¡ç® _scoreï¼å¯ä»¥å° track_scores åæ°è®¾ç½®ä¸º trueã\n\n\n# å¤å­æ®µæåº\n\nå¦ææä»¬æ³è¦ç»åä½¿ç¨ priceãdate å _score è¿è¡æ¥è¯¢ï¼å¹¶ä¸å¹éçç»æé¦åæç§ä»·æ ¼æåºï¼ç¶åæç§æ¥ææåºï¼æåæç§ç¸å³æ§æåºï¼å·ä½ç¤ºä¾å¦ä¸ï¼\n\nGET books/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": {\n\t\t\t\t"match": { "content": "java" }\n\t\t\t},\n\t\t\t"filter": {\n\t\t\t\t"term": { "user_id": 4868438 }\n\t\t\t}\n\t\t}\n\t},\n\t"sort": [{\n\t\t\t"price": {\n\t\t\t\t"order": "desc"\n\t\t\t}\n\t\t}, {\n\t\t\t"date": {\n\t\t\t\t"order": "desc"\n\t\t\t}\n\t\t}, {\n\t\t\t"_score": {\n\t\t\t\t"order": "desc"\n\t\t\t}\n\t\t}\n\t]\n}\n\n\næåºæ¡ä»¶çé¡ºåºæ¯å¾éè¦çãç»æé¦åæç¬¬ä¸ä¸ªæ¡ä»¶æåºï¼ä»å½ç»æéçç¬¬ä¸ä¸ª sort å¼å®å¨ç¸åæ¶æä¼æç§ç¬¬äºä¸ªæ¡ä»¶è¿è¡æåºï¼ä»¥æ­¤ç±»æ¨ã\n\nå¤çº§æåºå¹¶ä¸ä¸å®åå« _scoreãä½ å¯ä»¥æ ¹æ®ä¸äºä¸åçå­æ®µè¿è¡æåºï¼å¦å°çè·ç¦»ææ¯èæ¬è®¡ç®çç¹å®å¼ã\n\n\n# å¤å¼å­æ®µçæåº\n\nä¸ç§æå½¢æ¯å­æ®µæå¤ä¸ªå¼çæåºï¼éè¦è®°ä½è¿äºå¼å¹¶æ²¡æåºæçé¡ºåºï¼ä¸ä¸ªå¤å¼çå­æ®µä»ä»æ¯å¤ä¸ªå¼çåè£ï¼è¿æ¶åºè¯¥éæ©åªä¸ªè¿è¡æåºå¢ï¼\n\nå¯¹äºæ°å­ææ¥æï¼ä½ å¯ä»¥å°å¤å¼å­æ®µåä¸ºåå¼ï¼è¿å¯ä»¥éè¿ä½¿ç¨ minãmaxãavg ææ¯ sum æåºæ¨¡å¼ãä¾å¦ä½ å¯ä»¥æç§æ¯ä¸ª date å­æ®µä¸­çææ©æ¥æè¿è¡æåºï¼éè¿ä»¥ä¸æ¹æ³ï¼\n\n"sort": {\n  "dates": {\n    "order": "asc",\n    "mode":  "min"\n  }\n}\n\n\n\n# å°çä½ç½®ä¸çè·ç¦»æåº\n\nes çå°çä½ç½®æåºä½¿ç¨ _geo_distance æ¥è¿è¡è·ç¦»æåºï¼å¦ä¸ç¤ºä¾ï¼\n\n{\n  "sort" : [\n    {\n      "_geo_distance" : {\n        "es_location_field" : [116.407526, 39.904030],\n        "order" : "asc",\n        "unit" : "km",\n        "mode" : "min",\n        "distance_type" : "plane"\n      }\n    }\n  ],\n  "query" : {\n    ......\n  }\n}\n\n\n_geo_distance çéé¡¹å·ä½å¦ä¸ï¼\n\n * å¦ä¸ç es_location_field æçæ¯ es å­å¨ç»çº¬åº¦æ°æ®çå­æ®µåã\n * orderï¼æå®æè·ç¦»ååºæéåºï¼åå«å¯¹åº asc å descã\n * unitï¼è®¡ç®è·ç¦»å¼çåä½ï¼é»è®¤æ¯ mï¼è¡¨ç¤ºç±³ï¼metersï¼ï¼å¶å®å¯éé¡¹æ miãcmãmmãNMãkmãftãyd å inã\n * modeï¼éå¯¹æ°ç»æ°æ®ï¼å¤ä¸ªå¼ï¼æ¶ï¼æå®çåå¼æ¨¡å¼ï¼å¯éå¼æ minãmaxãsumãavg å medianï¼å½æåºéç¨ååºæ¶ï¼é»è®¤ä¸º minï¼æåºéç¨éåºæ¶ï¼é»è®¤ä¸º maxã\n * distance_typeï¼ç¨æ¥è®¾ç½®å¦ä½è®¡ç®è·ç¦»ï¼å®çå¯éé¡¹æ sloppy_arcãarc å planeï¼é»è®¤ä¸º sloppy_arcï¼arc å®ç¸å¯¹æ´ç²¾ç¡®äºï¼ä½éåº¦ä¼ææ¾ä¸éï¼plane åæ¯è®¡ç®å¿«ï¼ä½æ¯é¿è·ç¦»è®¡ç®ç¸å¯¹ä¸åç¡®ã\n * ignore_unmappedï¼æªæ å°å­æ®µæ¶ï¼æ¯å¦å¿½ç¥å¤çï¼å¯éé¡¹æ true å falseï¼é»è®¤ä¸º falseï¼è¡¨ç¤ºå¦ææªæ å°å­æ®µï¼æ¥è¯¢å°å¼åå¼å¸¸ï¼è¥è®¾ç½® trueï¼å°å¿½ç¥æªæ å°çå­æ®µï¼å¹¶ä¸ä¸å¹éæ­¤æ¥è¯¢çä»»ä½ææ¡£ã\n * validation_methodï¼æå®æ£éªç»çº¬åº¦æ°æ®çæ¹å¼ï¼å¯éé¡¹æ IGNORE_MALFORMEDãCOERCE å STRICTï¼IGNORE_MALFORMED è¡¨ç¤ºå¯æ¥åçº¬åº¦æç»åº¦æ æçå°çç¹ï¼å³å¿½ç¥æ°æ®ï¼COERCE è¡¨ç¤ºå¦å¤å°è¯å¹¶æ¨æ­æ­£ç¡®çå°çåæ ï¼STRICT ä¸ºé»è®¤å¼ï¼è¡¨ç¤ºéå°ä¸æ­£ç¡®çå°çåæ ç´æ¥æåºå¼å¸¸ã\n\n\n# åèèµæ\n\n * Elasticsearch æç¨',normalizedContent:'# elasticsearch æåº\n\nå¨ elasticsearch ä¸­ï¼é»è®¤æåºæ¯æç§ç¸å³æ§çè¯åï¼_scoreï¼è¿è¡éåºæåºï¼ä¹å¯ä»¥æç§å­æ®µçå¼æåºãå¤çº§æåºãå¤å¼å­æ®µæåºãåºäº geoï¼å°çä½ç½®ï¼æåºä»¥åèªå®ä¹èæ¬æåºï¼é¤æ­¤ä¹å¤ï¼å¯¹äºç¸å³æ§çè¯åä¹å¯ä»¥ç¨ rescore äºæ¬¡ãä¸æ¬¡æåï¼å®å¯ä»¥éå®éæ°æåççªå£å¤§å°ï¼window sizeï¼ï¼å¹¶éå¯¹ä½ç¨èå´åçææ¡£ä¿®æ¹å¶å¾åï¼ä»èè¾¾å°ç²¾ç»åæ§å¶ç»æç¸å³æ§çç®çã\n\n\n# é»è®¤ç¸å³æ§æåº\n\nå¨ elasticsearch ä¸­ï¼é»è®¤æåµä¸ï¼ææ¡£æ¯æç§ç¸å³æ§å¾åååºæåçï¼å¶å¯¹åºçç¸å³æ§å¾åå­æ®µç¨ _score æ¥è¡¨ç¤ºï¼å®æ¯æµ®ç¹æ°ç±»åï¼_score è¯åè¶é«ï¼ç¸å³æ§è¶é«ãè¯åæ¨¡åçéæ©å¯ä»¥éè¿ similarity åæ°å¨æ å°ä¸­æå®ã\n\nç¸ä¼¼åº¦ç®æ³å¯ä»¥æå­æ®µæå®ï¼åªéå¨æ å°ä¸­ä¸ºä¸åå­æ®µéå®å³å¯ï¼å¦æè¦ä¿®æ¹å·²æå­æ®µçç¸ä¼¼åº¦ç®æ³ï¼åªè½éè¿ä¸ºæ°æ®éæ°å»ºç«ç´¢å¼æ¥è¾¾å°ç®çãå³äºæ´å¤ es ç¸ä¼¼åº¦ç®æ³å¯ä»¥åè æ·±å¥çè§£ es ç¸ä¼¼åº¦ç®æ³ï¼ç¸å³æ§å¾åè®¡ç®ï¼ã\n\n\n# tf-idf æ¨¡å\n\nelasticsearch å¨ 5.4 çæ¬ä»¥åï¼text ç±»åçå­æ®µï¼é»è®¤éç¨åºäº tf-idf çåéç©ºé´æ¨¡åã\n\nå¨å¼å§è®¡ç®å¾åä¹æ¶ï¼elasticsearch ä½¿ç¨äºè¢«æç´¢è¯æ¡çé¢çä»¥åå®æå¤å¸¸è§æ¥å½±åå¾åãä¸ä¸ªç®ç­çè§£éæ¯ï¼ä¸ä¸ªè¯æ¡åºç°å¨æä¸ªææ¡£ä¸­çæ¬¡æ°è¶å¤ï¼å®å°±è¶ç¸å³ï¼ä½æ¯ï¼å¦æè¯¥è¯æ¡åºç°å¨ä¸åçææ¡£çæ¬¡æ°è¶å¤ï¼å®å°±è¶ä¸ç¸å³ãè¿ä¸ç¹è¢«ç§°ä¸º tf-idfï¼tf æ¯è¯é¢ï¼term frequencyï¼ï¼idf æ¯éææ¡£é¢çï¼inverse document frequencyï¼ã\n\nèèç»ä¸ç¯ææ¡£æåçé¦è¦æ¹å¼ï¼æ¯ç»è®¡ä¸ä¸ªè¯æ¡å¨ææ¬ä¸­åºç°çæ¬¡æ°ãä¸¾ä¸ªä¾å­ï¼å¦æå¨ç¨æ·çåºåæç´¢å³äº elasticsearch ç get-togetherï¼ç¨æ·å¸æé¢ç¹æå elasticsearch çåç»è¢«ä¼åå±ç¤ºåºæ¥ã\n\n"we will discuss elasticsearch at the next big data group."\n"tuesday the elasticsearch team will gather to answer questions about elasticsearch."\n\n\nç¬¬ä¸ä¸ªå¥å­æå° elasticsearch ä¸æ¬¡ï¼èç¬¬äºä¸ªå¥å­æå° elasticsearch ä¸¤æ¬¡ï¼æä»¥åå«ç¬¬äºå¥è¯çææ¡£åºè¯¥æ¯åå«ç¬¬ä¸å¥è¯çææ¡£æ¥ææ´é«çå¾åãå¦ææä»¬è¦æç§æ°éæ¥è®¨è®ºï¼ç¬¬ä¸å¥è¯çè¯é¢ï¼tfï¼æ¯ 1ï¼èç¬¬äºå¥è¯çè¯é¢å°æ¯ 2ã\n\néææ¡£é¢çæ¯ææ¡£è¯é¢ç¨å¾®å¤æä¸ç¹ãè¿ä¸ªå¬ä¸å»å¾é·ç«çæè¿°æå³çï¼å¦æä¸ä¸ªåè¯ï¼éå¸¸æ¯åè¯ï¼ä½ä¸ä¸å®æ¯ï¼å¨ç´¢å¼çä¸åææ¡£ä¸­åºç°è¶å¤çæ¬¡æ°ï¼é£ä¹å®å°±è¶ä¸éè¦ãä½¿ç¨å¦ä¸ä¾å­æ´å®¹æè§£éè¿ä¸ç¹ã\n\n"we use elasticsearch to power the search for our website."\n"the developers like elasticsearch so far."\n"the scoring of documents is calculated by the scoring formula."\n\n\nå¦ä¸è¿°ä¾å­ï¼éè¦çè§£ä»¥ä¸å ç¹ï¼\n\n * è¯æ¡ âelasticsearchâ çææ¡£é¢çæ¯ 2ï¼å ä¸ºå®åºç°å¨ä¸¤ç¯ææ¡£ä¸­ï¼ãææ¡£é¢ççéæºèªå¾åä¹ä»¥ 1/dfï¼è¿é df æ¯è¯¥è¯æ¡çææ¡£é¢çãè¿å°±æå³çï¼ç±äºè¯æ¡æ¥ææ´é«çææ¡£é¢çï¼å®çæéå°±ä¼éä½ã\n * è¯æ¡ âtheâ çææ¡£é¢çæ¯ 3ï¼å ä¸ºå®åºç°å¨ææçä¸ç¯ææ¡£ä¸­ãè¯·æ³¨æï¼å°½ç®¡ âtheâ å¨æåä¸ç¯ææ¡£ä¸­åºç°äºä¸¤æ¬¡ï¼å®çææ¡£é¢çè¿æ¯ 3ãè¿æ¯å ä¸ºï¼éææ¡£é¢çåªæ£æ¥ä¸ä¸ªè¯æ¡æ¯å¦åºç°å¨æææ¡£ä¸­ï¼èä¸æ£æ¥å®åºç°å¤å°æ¬¡ãé£ä¸ªåºè¯¥æ¯è¯é¢æå³å¿çäºæã\n\néææ¡£é¢çæ¯ä¸ä¸ªéè¦çå ç´ ï¼ç¨äºå¹³è¡¡è¯æ¡çè¯é¢ãä¸¾ä¸ªä¾å­ï¼èèæä¸ä¸ªç¨æ·æç´¢è¯æ¡ âthe scoreâï¼åè¯ the å ä¹åºç°å¨æ¯ä¸ªæ®éçè±è¯­ææ¬ä¸­ï¼å¦æå®ä¸è¢«åè¡¡ä¸ä¸ï¼åè¯ the çé¢çè¦å®å¨æ·¹æ²¡åè¯ score çé¢çãéææ¡£é¢ç idf åè¡¡äº the è¿ç§å¸¸è§è¯çç¸å³æ§å½±åï¼æä»¥å®éçç¸å³æ§å¾åå°ä¼å¯¹æ¥è¯¢çè¯æ¡æä¸ä¸ªæ´åç¡®çæè¿°ã\n\nä¸æ¦è¯é¢ tf åéææ¡£é¢ç idf è®¡ç®å®æï¼å°±å¯ä»¥ä½¿ç¨ tf-idf å¬å¼æ¥è®¡ç®ææ¡£çå¾åã\n\n\n# bm25 æ¨¡å\n\nelasticsearch å¨ 5.4 çæ¬ä¹åï¼éå¯¹ text ç±»åçå­æ®µï¼é»è®¤éç¨çæ¯ bm25 è¯åæ¨¡åï¼èä¸æ¯åºäº tf-idf çåéç©ºé´æ¨¡åï¼è¯åæ¨¡åçéæ©å¯ä»¥éè¿ similarity åæ°å¨æ å°ä¸­æå®ã\n\n\n# å­æ®µçå¼æåº\n\nå¨ elasticsearch ä¸­æç§å­æ®µçå¼æåºï¼å¯ä»¥å©ç¨ sort åæ°å®ç°ã\n\nget books/_search\n{\n  "sort": {\n    "price": {\n      "order": "desc"\n    }\n  }\n}\n\n\nè¿åç»æå¦ä¸ï¼\n\n{\n  "took": 132,\n  "timed_out": false,\n  "_shards": {\n    "total": 10,\n    "successful": 10,\n    "skipped": 0,\n    "failed": 0\n  },\n  "hits": {\n    "total": 749244,\n    "max_score": null,\n    "hits": [\n      {\n        "_index": "books",\n        "_type": "book",\n        "_id": "8456479",\n        "_score": null,\n        "_source": {\n          "id": 8456479,\n          "price": 1580.00,\n          ...\n        },\n        "sort": [\n          1580.00\n        ]\n      },\n      ...\n    ]\n  }\n}\n\n\nä»å¦ä¸è¿åç»æï¼å¯ä»¥çåºï¼max_score å _score å­æ®µé½è¿å nullï¼è¿åå­æ®µå¤åº sort å­æ®µï¼åå«æåºå­æ®µçåå¼ãè®¡ç® _score çè±éå·¨å¤§ï¼å¦æä¸æ ¹æ®ç¸å³æ§æåºï¼è®°å½ _score æ¯æ²¡ææä¹çãå¦ææ è®ºå¦ä½é½è¦è®¡ç® _scoreï¼å¯ä»¥å° track_scores åæ°è®¾ç½®ä¸º trueã\n\n\n# å¤å­æ®µæåº\n\nå¦ææä»¬æ³è¦ç»åä½¿ç¨ priceãdate å _score è¿è¡æ¥è¯¢ï¼å¹¶ä¸å¹éçç»æé¦åæç§ä»·æ ¼æåºï¼ç¶åæç§æ¥ææåºï¼æåæç§ç¸å³æ§æåºï¼å·ä½ç¤ºä¾å¦ä¸ï¼\n\nget books/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": {\n\t\t\t\t"match": { "content": "java" }\n\t\t\t},\n\t\t\t"filter": {\n\t\t\t\t"term": { "user_id": 4868438 }\n\t\t\t}\n\t\t}\n\t},\n\t"sort": [{\n\t\t\t"price": {\n\t\t\t\t"order": "desc"\n\t\t\t}\n\t\t}, {\n\t\t\t"date": {\n\t\t\t\t"order": "desc"\n\t\t\t}\n\t\t}, {\n\t\t\t"_score": {\n\t\t\t\t"order": "desc"\n\t\t\t}\n\t\t}\n\t]\n}\n\n\næåºæ¡ä»¶çé¡ºåºæ¯å¾éè¦çãç»æé¦åæç¬¬ä¸ä¸ªæ¡ä»¶æåºï¼ä»å½ç»æéçç¬¬ä¸ä¸ª sort å¼å®å¨ç¸åæ¶æä¼æç§ç¬¬äºä¸ªæ¡ä»¶è¿è¡æåºï¼ä»¥æ­¤ç±»æ¨ã\n\nå¤çº§æåºå¹¶ä¸ä¸å®åå« _scoreãä½ å¯ä»¥æ ¹æ®ä¸äºä¸åçå­æ®µè¿è¡æåºï¼å¦å°çè·ç¦»ææ¯èæ¬è®¡ç®çç¹å®å¼ã\n\n\n# å¤å¼å­æ®µçæåº\n\nä¸ç§æå½¢æ¯å­æ®µæå¤ä¸ªå¼çæåºï¼éè¦è®°ä½è¿äºå¼å¹¶æ²¡æåºæçé¡ºåºï¼ä¸ä¸ªå¤å¼çå­æ®µä»ä»æ¯å¤ä¸ªå¼çåè£ï¼è¿æ¶åºè¯¥éæ©åªä¸ªè¿è¡æåºå¢ï¼\n\nå¯¹äºæ°å­ææ¥æï¼ä½ å¯ä»¥å°å¤å¼å­æ®µåä¸ºåå¼ï¼è¿å¯ä»¥éè¿ä½¿ç¨ minãmaxãavg ææ¯ sum æåºæ¨¡å¼ãä¾å¦ä½ å¯ä»¥æç§æ¯ä¸ª date å­æ®µä¸­çææ©æ¥æè¿è¡æåºï¼éè¿ä»¥ä¸æ¹æ³ï¼\n\n"sort": {\n  "dates": {\n    "order": "asc",\n    "mode":  "min"\n  }\n}\n\n\n\n# å°çä½ç½®ä¸çè·ç¦»æåº\n\nes çå°çä½ç½®æåºä½¿ç¨ _geo_distance æ¥è¿è¡è·ç¦»æåºï¼å¦ä¸ç¤ºä¾ï¼\n\n{\n  "sort" : [\n    {\n      "_geo_distance" : {\n        "es_location_field" : [116.407526, 39.904030],\n        "order" : "asc",\n        "unit" : "km",\n        "mode" : "min",\n        "distance_type" : "plane"\n      }\n    }\n  ],\n  "query" : {\n    ......\n  }\n}\n\n\n_geo_distance çéé¡¹å·ä½å¦ä¸ï¼\n\n * å¦ä¸ç es_location_field æçæ¯ es å­å¨ç»çº¬åº¦æ°æ®çå­æ®µåã\n * orderï¼æå®æè·ç¦»ååºæéåºï¼åå«å¯¹åº asc å descã\n * unitï¼è®¡ç®è·ç¦»å¼çåä½ï¼é»è®¤æ¯ mï¼è¡¨ç¤ºç±³ï¼metersï¼ï¼å¶å®å¯éé¡¹æ miãcmãmmãnmãkmãftãyd å inã\n * modeï¼éå¯¹æ°ç»æ°æ®ï¼å¤ä¸ªå¼ï¼æ¶ï¼æå®çåå¼æ¨¡å¼ï¼å¯éå¼æ minãmaxãsumãavg å medianï¼å½æåºéç¨ååºæ¶ï¼é»è®¤ä¸º minï¼æåºéç¨éåºæ¶ï¼é»è®¤ä¸º maxã\n * distance_typeï¼ç¨æ¥è®¾ç½®å¦ä½è®¡ç®è·ç¦»ï¼å®çå¯éé¡¹æ sloppy_arcãarc å planeï¼é»è®¤ä¸º sloppy_arcï¼arc å®ç¸å¯¹æ´ç²¾ç¡®äºï¼ä½éåº¦ä¼ææ¾ä¸éï¼plane åæ¯è®¡ç®å¿«ï¼ä½æ¯é¿è·ç¦»è®¡ç®ç¸å¯¹ä¸åç¡®ã\n * ignore_unmappedï¼æªæ å°å­æ®µæ¶ï¼æ¯å¦å¿½ç¥å¤çï¼å¯éé¡¹æ true å falseï¼é»è®¤ä¸º falseï¼è¡¨ç¤ºå¦ææªæ å°å­æ®µï¼æ¥è¯¢å°å¼åå¼å¸¸ï¼è¥è®¾ç½® trueï¼å°å¿½ç¥æªæ å°çå­æ®µï¼å¹¶ä¸ä¸å¹éæ­¤æ¥è¯¢çä»»ä½ææ¡£ã\n * validation_methodï¼æå®æ£éªç»çº¬åº¦æ°æ®çæ¹å¼ï¼å¯éé¡¹æ ignore_malformedãcoerce å strictï¼ignore_malformed è¡¨ç¤ºå¯æ¥åçº¬åº¦æç»åº¦æ æçå°çç¹ï¼å³å¿½ç¥æ°æ®ï¼coerce è¡¨ç¤ºå¦å¤å°è¯å¹¶æ¨æ­æ­£ç¡®çå°çåæ ï¼strict ä¸ºé»è®¤å¼ï¼è¡¨ç¤ºéå°ä¸æ­£ç¡®çå°çåæ ç´æ¥æåºå¼å¸¸ã\n\n\n# åèèµæ\n\n * elasticsearch æç¨',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Elasticsearch åæå¨",frontmatter:{title:"Elasticsearch åæå¨",date:"2022-02-22T21:01:01.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","åè¯"],permalink:"/pages/a5a001/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/09.Elasticsearch%E5%88%86%E6%9E%90%E5%99%A8.html",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/09.Elasticsearchåæå¨.md",key:"v-665de124",path:"/pages/a5a001/",headers:[{level:2,title:"å­ç¬¦è¿æ»¤å¨ï¼Character Filtersï¼",slug:"å­ç¬¦è¿æ»¤å¨-character-filters",normalizedTitle:"å­ç¬¦è¿æ»¤å¨ï¼character filtersï¼",charIndex:164},{level:3,title:"HTML strip character filter",slug:"html-strip-character-filter",normalizedTitle:"html strip character filter",charIndex:661},{level:3,title:"Mapping character filter",slug:"mapping-character-filter",normalizedTitle:"mapping character filter",charIndex:897},{level:3,title:"Pattern Replace character filter",slug:"pattern-replace-character-filter",normalizedTitle:"pattern replace character filter",charIndex:1731},{level:2,title:"åè¯å¨ï¼Tokenizerï¼",slug:"åè¯å¨-tokenizer",normalizedTitle:"åè¯å¨ï¼tokenizerï¼",charIndex:189},{level:3,title:"elasticsearch-plugin ä½¿ç¨",slug:"elasticsearch-plugin-ä½¿ç¨",normalizedTitle:"elasticsearch-plugin ä½¿ç¨",charIndex:2553},{level:3,title:"elasticsearch-analysis-ik å®è£",slug:"elasticsearch-analysis-ik-å®è£",normalizedTitle:"elasticsearch-analysis-ik å®è£",charIndex:3173},{level:3,title:"elasticsearch-analysis-ik ä½¿ç¨",slug:"elasticsearch-analysis-ik-ä½¿ç¨",normalizedTitle:"elasticsearch-analysis-ik ä½¿ç¨",charIndex:3597},{level:4,title:"ç´¢å¼ mapping è®¾ç½®",slug:"ç´¢å¼-mapping-è®¾ç½®",normalizedTitle:"ç´¢å¼ mapping è®¾ç½®",charIndex:3771},{level:4,title:"æ¥ç ik åè¯ç»æ",slug:"æ¥ç-ik-åè¯ç»æ",normalizedTitle:"æ¥ç ik åè¯ç»æ",charIndex:4534},{level:4,title:"elasticsearch-analysis-ik èªå®ä¹è¯å¸",slug:"elasticsearch-analysis-ik-èªå®ä¹è¯å¸",normalizedTitle:"elasticsearch-analysis-ik èªå®ä¹è¯å¸",charIndex:5201},{level:2,title:"è¯åè¿æ»¤å¨ï¼Token Filtersï¼",slug:"è¯åè¿æ»¤å¨-token-filters",normalizedTitle:"è¯åè¿æ»¤å¨ï¼token filtersï¼",charIndex:204},{level:3,title:"åä¹è¯",slug:"åä¹è¯",normalizedTitle:"åä¹è¯",charIndex:6126},{level:4,title:"åä¹è¯ï¼synonymï¼éç½®è¯­æ³",slug:"åä¹è¯-synonym-éç½®è¯­æ³",normalizedTitle:"åä¹è¯ï¼synonymï¼éç½®è¯­æ³",charIndex:6882},{level:4,title:"åä¹è¯ææ¡£æ ¼å¼",slug:"åä¹è¯ææ¡£æ ¼å¼",normalizedTitle:"åä¹è¯ææ¡£æ ¼å¼",charIndex:7382},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:7772}],headersStr:"å­ç¬¦è¿æ»¤å¨ï¼Character Filtersï¼ HTML strip character filter Mapping character filter Pattern Replace character filter åè¯å¨ï¼Tokenizerï¼ elasticsearch-plugin ä½¿ç¨ elasticsearch-analysis-ik å®è£ elasticsearch-analysis-ik ä½¿ç¨ ç´¢å¼ mapping è®¾ç½® æ¥ç ik åè¯ç»æ elasticsearch-analysis-ik èªå®ä¹è¯å¸ è¯åè¿æ»¤å¨ï¼Token Filtersï¼ åä¹è¯ åä¹è¯ï¼synonymï¼éç½®è¯­æ³ åä¹è¯ææ¡£æ ¼å¼ åèèµæ",content:'# Elasticsearch åæå¨\n\nææ¬åææ¯æå¨ææ¬è½¬æ¢ä¸ºä¸ç³»ååè¯ï¼term/tokenï¼çè¿ç¨ï¼ä¹å«åè¯ãå¨ Elasticsearch ä¸­ï¼åè¯æ¯éè¿ analyzerï¼åæå¨ï¼æ¥å®æçï¼ä¸ç®¡æ¯ç´¢å¼è¿æ¯æç´¢ï¼é½éè¦ä½¿ç¨ analyzerï¼åæå¨ï¼ãåæå¨ï¼åä¸ºåç½®åæå¨åèªå®ä¹çåæå¨ã\n\nåæå¨å¯ä»¥è¿ä¸æ­¥ç»åä¸ºå­ç¬¦è¿æ»¤å¨ï¼Character Filtersï¼ãåè¯å¨ï¼Tokenizerï¼åè¯åè¿æ»¤å¨ï¼Token Filtersï¼ä¸é¨åãå®çæ§è¡é¡ºåºå¦ä¸ï¼\n\ncharacter filters -> tokenizer -> token filters\n\n\n# å­ç¬¦è¿æ»¤å¨ï¼Character Filtersï¼\n\ncharacter filter çè¾å¥æ¯åå§çææ¬ textï¼å¦æéç½®äºå¤ä¸ªï¼å®ä¼æç§éç½®çé¡ºåºæ§è¡ï¼ç®å ES èªå¸¦ç character filter ä¸»è¦æå¦ä¸ 3 ç±»ï¼\n\n 1. html strip character filterï¼ä»ææ¬ä¸­å¥ç¦» HTML åç´ ï¼å¹¶ç¨å¶è§£ç å¼æ¿æ¢ HTML å®ä½ï¼å¦ï¼å° ï¼amp; æ¿æ¢ä¸º ï¼ï¼ã\n 2. mapping character filterï¼èªå®ä¹ä¸ä¸ª map æ å°ï¼å¯ä»¥è¿è¡ä¸äºèªå®ä¹çæ¿æ¢ï¼å¦å¸¸ç¨çå¤§ååå°åä¹å¯ä»¥å¨è¯¥ç¯èè®¾ç½®ã\n 3. pattern replace character filterï¼ä½¿ç¨ java æ­£åè¡¨è¾¾å¼æ¥å¹éåºæ¿æ¢ä¸ºæå®æ¿æ¢å­ç¬¦ä¸²çå­ç¬¦ï¼æ­¤å¤ï¼æ¿æ¢å­ç¬¦ä¸²å¯ä»¥å¼ç¨æ­£åè¡¨è¾¾å¼ä¸­çæè·ç»ã\n\n\n# HTML strip character filter\n\nHTML strip å¦ä¸ç¤ºä¾ï¼\n\nGET /_analyze\n{\n  "tokenizer": "keyword",\n  "char_filter": [\n    "html_strip"\n  ],\n  "text": "<p>I&apos;m so <b>happy</b>!</p>"\n}\n\n\nç»è¿ html_strip å­ç¬¦è¿æ»¤å¨å¤çåï¼è¾åºå¦ä¸ï¼\n\n[ \\nI\'m so happy!\\n ]\n\n\n\n# Mapping character filter\n\nMapping character filter æ¥æ¶é®åå¼æ å°ï¼key => valueï¼ä½ä¸ºéç½®åæ°ï¼æ¯å½å¨é¢å¤çè¿ç¨ä¸­éå°ä¸é®å¼æ å°ä¸­çé®ç¸åçå­ç¬¦ä¸²æ¶ï¼å°±ä¼ä½¿ç¨è¯¥é®å¯¹åºçå¼å»æ¿æ¢å®ã\n\nåå§ææ¬ä¸­çå­ç¬¦ä¸²åé®å¼æ å°ä¸­çé®çå¹éæ¯è´ªå¿çï¼å¨å¯¹ç»å®çææ¬è¿è¡é¢å¤çè¿ç¨ä¸­å¦æéç½®çé®å¼æ å°å­å¨åå«å³ç³»ï¼ä¼ä¼åå¹éæé¿é®ãåæ ·ä¹å¯ä»¥ç¨ç©ºå­ç¬¦ä¸²è¿è¡æ¿æ¢ã\n\nmapping char_filter ä¸å html_strip é£æ ·æç®±å³å¯ç¨ï¼å¿é¡»åè¿è¡éç½®æè½ä½¿ç¨ï¼å®æä¸¤ä¸ªå±æ§å¯ä»¥éç½®ï¼\n\nåæ°åç§°            åæ°è¯´æ\nmappings        ä¸ç»æ å°ï¼æ¯ä¸ªåç´ çæ ¼å¼ä¸º key => valueã\nmappings_path   ä¸ä¸ªç¸å¯¹æèç»å¯¹çæä»¶è·¯å¾ï¼æåä¸ä¸ªæ¯è¡åå«ä¸ä¸ª key =>value æ å°ç UTF-8 ç¼ç ææ¬æ å°æä»¶ã\n\nmapping char_filter ç¤ºä¾å¦ä¸ï¼\n\nGET /_analyze\n{\n  "tokenizer": "keyword",\n  "char_filter": [\n    {\n      "type": "mapping",\n      "mappings": [\n        "Ù  => 0",\n        "Ù¡ => 1",\n        "Ù¢ => 2",\n        "Ù£ => 3",\n        "Ù¤ => 4",\n        "Ù¥ => 5",\n        "Ù¦ => 6",\n        "Ù§ => 7",\n        "Ù¨ => 8",\n        "Ù© => 9"\n      ]\n    }\n  ],\n  "text": "My license plate is Ù¢Ù¥Ù Ù¡Ù¥"\n}\n\n\nåæç»æå¦ä¸ï¼\n\n[ My license plate is 25015 ]\n\n\n\n# Pattern Replace character filter\n\nPattern Replace character filter æ¯æå¦ä¸ä¸ä¸ªåæ°ï¼\n\nåæ°åç§°          åæ°è¯´æ\npattern       å¿å¡«åæ°ï¼ä¸ä¸ª java çæ­£åè¡¨è¾¾å¼ã\nreplacement   æ¿æ¢å­ç¬¦ä¸²ï¼å¯ä»¥ä½¿ç¨ $1 ... $9 è¯­æ³æ¥å¼ç¨æè·ç»ã\nflags         Java æ­£åè¡¨è¾¾å¼çæ å¿ï¼å·ä½åè java ç java.util.regex.Pattern ç±»çæ å¿å±æ§ã\n\nå¦å°è¾å¥ç text ä¸­å¤§äºä¸ä¸ªçç©ºæ ¼é½è½¬åä¸ºä¸ä¸ªç©ºæ ¼ï¼å¨ settings æ¶ï¼éç½®ç¤ºä¾å¦ä¸ï¼\n\n"char_filter": {\n  "multi_space_2_one": {\n    "pattern": "[ ]+",\n    "type": "pattern_replace",\n    "replacement": " "\n  },\n  ...\n}\n\n\n\n# åè¯å¨ï¼Tokenizerï¼\n\ntokenizer å³åè¯å¨ï¼ä¹æ¯ analyzer æéè¦çç»ä»¶ï¼å®å¯¹ææ¬è¿è¡åè¯ï¼ä¸ä¸ª analyzer å¿éä¸åªå¯åå«ä¸ä¸ª tokenizerã\n\nES èªå¸¦é»è®¤çåè¯å¨æ¯ standard tokenizerï¼æ ååè¯å¨æä¾åºäºè¯­æ³çåè¯ï¼åºäº Unicode ææ¬åå²ç®æ³ï¼ï¼å¹¶ä¸éç¨äºå¤§å¤æ°è¯­è¨ã\n\næ­¤å¤æå¾å¤ç¬¬ä¸æ¹çåè¯æä»¶ï¼å¦ä¸­æåè¯çæç»å¸ç ik åè¯å¨ï¼å®å¯¹åºç tokenizer åä¸º ik_smart å ik_max_wordï¼ä¸ä¸ªæ¯æºè½åè¯ï¼éå¯¹æç´¢ä¾§ï¼ï¼ä¸ä¸ªæ¯å¨ååè¯ï¼éå¯¹ç´¢å¼ä¾§ï¼ã\n\nES é»è®¤æä¾çåè¯å¨ standard å¯¹ä¸­æåè¯ä¸ä¼åï¼ææå·®ï¼ä¸è¬ä¼å®è£ç¬¬ä¸æ¹ä¸­æåè¯æä»¶ï¼éå¸¸é¦å elasticsearch-analysis-ik æä»¶ï¼å®å¶å®æ¯ ik éå¯¹ç ES çå®å¶çã\n\n\n# elasticsearch-plugin ä½¿ç¨\n\nå¨å®è£ elasticsearch-analysis-ik ç¬¬ä¸æ¹ä¹åï¼æä»¬é¦åè¦äºè§£ es çæä»¶ç®¡çå·¥å· elasticsearch-plugin çä½¿ç¨ã\n\nç°å¨ç elasticsearch å®è£å®åï¼å¨å®è£ç®å½ç bin ç®å½ä¸ä¼å­å¨ elasticsearch-plugin å½ä»¤å·¥å·ï¼ç¨å®æ¥å¯¹ es æä»¶è¿è¡ç®¡çã\n\nbin/elasticsearch-plugin\n\n\nå¶å®è¯¥å½ä»¤çæ¯è½¯è¿æ¥ï¼åå§è·¯å¾æ¯ï¼\n\nlibexec/bin/elasticsearch-plugin\n\n\nåè¿ä¸æ­¥çèæ¬ä»£ç ï¼ä½ ä¼åç°ï¼å®æ¯éè¿ elasticsearch-cli æ§è¡ libexec/lib/tools/plugin-cli/elasticsearch-plugin-cli-x.x.x.jarã\n\nä½ä¸è¬ä½¿ç¨èäºè§£ elasticsearch-plugin å½ä»¤ä½¿ç¨å°±å¯ï¼\n\n#  å®è£æå®çæä»¶å°å½å ES èç¹ä¸­\nelasticsearch-plugin install {plugin_url}\n\n#  æ¾ç¤ºå½å ES èç¹å·²ç»å®è£çæä»¶åè¡¨\nelasticsearch-plugin list\n\n#  å é¤å·²å®è£çæä»¶\nelasticsearch-plugin remove {plugin_name}\n\n\n> å¨å®è£æä»¶æ¶ï¼è¦ä¿è¯å®è£çæä»¶ä¸ ES çæ¬ä¸è´ã\n\n\n# elasticsearch-analysis-ik å®è£\n\nå¨ç¡®å®è¦å®è£ç ik çæ¬ä¹åï¼æ§è¡å¦ä¸å½ä»¤ï¼\n\n./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v{X.X.X}/elasticsearch-analysis-ik-{X.X.X}.zip\n\n\næ§è¡å®å®è£å½ä»¤åï¼æä»¬ä¼åç°å¨ plugins ä¸­å¤äº analysis-ik ç®å½ï¼è¿éé¢ä¸»è¦å­æ¾çæ¯æºç  jar åï¼æ­¤å¤ï¼å¨ config æä»¶éä¹å¤äº analysis-ik ç®å½ï¼éé¢ä¸»è¦æ¯ ik ç¸å³çéç½®ï¼å¦ IKAnalyzer.cfg.xml éç½®ãè¯å¸æä»¶ç­ã\n\n#  ä¸¤ä¸ªæ°å¢ç®å½è·¯å¾\nlibexec/plugins/analysis-ik/\nlibexec/config/analysis-ik/\n\n\n\n# elasticsearch-analysis-ik ä½¿ç¨\n\nES 5.X çæ¬å¼å§å®è£å®ç elasticsearch-analysis-ik æä¾äºä¸¤ä¸ªåè¯å¨ï¼åå«å¯¹åºåç§°æ¯ ik_max_word å ik_smartï¼ik_max_word æ¯ç´¢å¼ä¾§çåè¯å¨ï¼èµ°å¨åæ¨¡å¼ï¼ik_smart æ¯æç´¢ä¾§çåè¯å¨ï¼èµ°æºè½åè¯ï¼å±äºæç´¢æ¨¡å¼ã\n\n# ç´¢å¼ mapping è®¾ç½®\n\nå®è£å® elasticsearch-analysis-ik åï¼æä»¬å¯ä»¥æå®ç´¢å¼åæå®å­æ®µè®¾ç½®å¯ç¨çåæå¨ï¼analyzerï¼ï¼ç¤ºä¾å¦ä¸ï¼\n\n{\n  "qa": {\n    "mappings": {\n      "qa": {\n        "_all": {\n          "enabled": false\n        },\n        "properties": {\n          "question": {\n            "type": "text",\n            "store": true,\n            "similarity": "BM25",\n            "analyzer": "ik_max_word",\n            "search_analyzer": "ik_smart"\n          },\n          "answer": {\n            "type": "text",\n            "store": false,\n            "similarity": "BM25",\n            "analyzer": "ik_max_word",\n            "search_analyzer": "ik_smart"\n          },\n          ...\n        }\n      }\n    }\n  }\n}\n\n\nå¦ä¸ç¤ºä¾ä¸­ï¼analyzer æå® ik_max_wordï¼å³ç´¢å¼ä¾§ä½¿ç¨ ik å¨åæ¨¡å¼ï¼search_analyzer è®¾ç½® ik_smartï¼å³æç´¢ä¾§ä½¿ç¨ ik æºè½åè¯æ¨¡å¼ã\n\n# æ¥ç ik åè¯ç»æ\n\nes æä¾äºæ¥çåè¯ç»æç api analyzeï¼å·ä½ç¤ºä¾å¦ä¸ï¼\n\nGET {index}/_analyze\n{\n  "analyzer" : "ik_smart",\n  "text" : "es ä¸­æåè¯å¨å®è£"\n}\n\n\nè¾åºå¦ä¸ï¼\n\n{\n  "tokens": [\n    {\n      "token": "es",\n      "start_offset": 0,\n      "end_offset": 2,\n      "type": "CN_WORD",\n      "position": 0\n    },\n    {\n      "token": "ä¸­æ",\n      "start_offset": 3,\n      "end_offset": 5,\n      "type": "CN_WORD",\n      "position": 1\n    },\n    {\n      "token": "åè¯å¨",\n      "start_offset": 5,\n      "end_offset": 8,\n      "type": "CN_WORD",\n      "position": 2\n    },\n    {\n      "token": "å®è£",\n      "start_offset": 8,\n      "end_offset": 10,\n      "type": "CN_WORD",\n      "position": 3\n    }\n  ]\n}\n\n\n# elasticsearch-analysis-ik èªå®ä¹è¯å¸\n\nelasticsearch-analysis-ik æ¬è´¨æ¯ ik åè¯å¨ï¼ä½¿ç¨èæ ¹æ®å®ééæ±å¯ä»¥æ©å±èªå®ä¹çè¯å¸ï¼å·ä½ä¸»è¦åä¸ºå¦ä¸ 2 å¤§ç±»ï¼æ¯ç±»ååä¸ºæ¬å°éç½®åè¿ç¨éç½® 2 ç§ï¼\n\n 1. èªå®ä¹æ©å±è¯å¸ï¼\n 2. èªå®ä¹æ©å±åç¨è¯å¸ï¼\n\nelasticsearch-analysis-ik éç½®æä»¶ä¸º IKAnalyzer.cfg.xmlï¼å®ä½äº libexec/config/analysis-ik ç®å½ä¸ï¼å·ä½éç½®ç»æå¦ä¸ï¼\n\n<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">\n<properties>\n\t<comment>IK Analyzer æ©å±éç½®</comment>\n\t\x3c!--ç¨æ·å¯ä»¥å¨è¿ééç½®èªå·±çæ©å±å­å¸ --\x3e\n\t<entry key="ext_dict"></entry>\n\t \x3c!--ç¨æ·å¯ä»¥å¨è¿ééç½®èªå·±çæ©å±åæ­¢è¯å­å¸--\x3e\n\t<entry key="ext_stopwords"></entry>\n\t\x3c!--ç¨æ·å¯ä»¥å¨è¿ééç½®è¿ç¨æ©å±å­å¸ --\x3e\n\t\x3c!-- <entry key="remote_ext_dict">words_location</entry> --\x3e\n\t\x3c!--ç¨æ·å¯ä»¥å¨è¿ééç½®è¿ç¨æ©å±åæ­¢è¯å­å¸--\x3e\n\t\x3c!-- <entry key="remote_ext_stopwords">words_location</entry> --\x3e\n</properties>\n\n\n> å½ç¶ï¼å¦æå¼åèè®¤ä¸º ik é»è®¤çè¯è¡¨æé®é¢ï¼ä¹å¯ä»¥è¿è¡è°æ´ï¼æä»¶é½å¨ libexec/config/analysis-ik ä¸ï¼å¦ main.dic ä¸ºä¸»è¯å¸ï¼stopword.dic ä¸ºåç¨è¯è¡¨ã\n\n\n# è¯åè¿æ»¤å¨ï¼Token Filtersï¼\n\ntoken filters å«è¯åè¿æ»¤å¨ï¼æè¯é¡¹è¿æ»¤å¨ï¼å¯¹ tokenizer ååºçè¯è¿è¡è¿æ»¤å¤çãå¸¸ç¨çæè½¬å°åãåç¨è¯å¤çãåä¹è¯å¤çç­ç­ãä¸ä¸ª analyzer å¯åå« 0 ä¸ªæå¤ä¸ªè¯é¡¹è¿æ»¤å¨ï¼æéç½®é¡ºåºè¿è¡è¿æ»¤ã\n\nä»¥åä¹è¯è¿æ»¤å¨çä½¿ç¨ç¤ºä¾ï¼å·ä½å¦ä¸ï¼\n\nPUT /test_index\n{\n  "settings": {\n    "index": {\n      "analysis": {\n        "analyzer": {\n          "synonym": {\n            "tokenizer": "standard",\n            "filter": [ "my_stop", "synonym" ]\n          }\n        },\n        "filter": {\n          "my_stop": {\n            "type": "stop",\n            "stopwords": [ "bar" ]\n          },\n          "synonym": {\n            "type": "synonym",\n            "lenient": true,\n            "synonyms": [ "foo, bar => baz" ]\n          }\n        }\n      }\n    }\n  }\n}\n\n\n\n# åä¹è¯\n\nElasticsearch åä¹è¯éè¿ä¸æçåä¹è¯è¿æ»¤å¨ï¼synonym token filterï¼æ¥è¿è¡å·¥ä½ï¼å®åè®¸å¨åæï¼analysisï¼è¿ç¨ä¸­æ¹ä¾¿å°å¤çåä¹è¯ï¼ä¸è¬æ¯éè¿éç½®æä»¶éç½®åä¹è¯ãæ­¤å¤ï¼åä¹è¯å¯ä»¥åå»ºç´¢å¼æ¶ï¼index-time synonymsï¼æèæ£ç´¢æ¶ï¼search-time synonymsï¼ä½¿ç¨ã\n\n# åä¹è¯ï¼synonymï¼éç½®è¯­æ³\n\nå¦ä¸ä¾å­æç¤ºï¼es åä¹è¯éç½®ç filter è¯­æ³å·ä½å¦ä¸éé¡¹ï¼\n\n * typeï¼æå® synonymï¼è¡¨ç¤ºåä¹è¯ filterï¼\n\n * synonyms_pathï¼æå®åä¹è¯éç½®æä»¶è·¯å¾ï¼\n\n * expandï¼è¯¥åæ°å³å®æ å°è¡ä¸ºçæ¨¡å¼ï¼é»è®¤ä¸º trueï¼è¡¨ç¤ºæ©å±æ¨¡å¼ï¼å·ä½ç¤ºä¾å¦ä¸ï¼\n   \n   * å½ expand == true æ¶ï¼\n     \n     ipod, i-pod, i pod\n     \n     \n     ç­ä»·äºï¼\n     \n     ipod, i-pod, i pod => ipod, i-pod, i pod\n     \n     \n     å½ expand == false æ¶ï¼\n     \n     ipod, i-pod, i pod\n     \n     \n     ä»æ å°ç¬¬ä¸ä¸ªåè¯ï¼ç­ä»·äºï¼\n     \n     ipod, i-pod, i pod => ipod\n     \n\n * lenientï¼å¦æå¼ä¸º true æ¶ï¼éå°é£äºæ æ³è§£æçåä¹è¯è§åæ¶ï¼å¿½ç¥å¼å¸¸ãé»è®¤ä¸º falseã\n\n# åä¹è¯ææ¡£æ ¼å¼\n\nelasticsearch çåä¹è¯æå¦ä¸ä¸¤ç§å½¢å¼ï¼\n\n * åååä¹è¯ï¼\n   \n   ipod, i-pod, i pod => ipod\n   \n\n * åååä¹è¯ï¼\n   \n   é©¬éè¯, åè±, potato\n   \n\nåååä¹è¯ä¸ç®¡ç´¢å¼è¿æ¯æ£ç´¢æ¶ï¼ç®­å¤´å·¦ä¾§çè¯é½ä¼æ å°æç®­å¤´å³ä¾§çè¯ï¼\n\nåååä¹è¯æ¯ç´¢å¼æ¶ï¼é½å»ºç«åä¹è¯çåæç´¢å¼ï¼æ£ç´¢æ¶ï¼åä¹è¯ä¹é´é½ä¼è¿è¡åæç´¢å¼çå¹éã\n\n> åä¹è¯çææ¡£åæ¶ï¼éè¦æ³¨æçæ¯ï¼åä¸ä¸ªè¯å¨ä¸åçåä¹è¯å³ç³»ä¸­åºç°æ¶ï¼å¶å®åä¹è¯ä¹é´ä¸å·æä¼ éæ§ï¼è¿ç¹éè¦æ³¨æã\n\nåè®¾å¦ä¸ç¤ºä¾ä¸­ï¼å¦æâé©¬éè¯âåå¶å®ä¸¤ä¸ªåä¹è¯åæä¸¤è¡åï¼\n\né©¬éè¯,åè±\né©¬éè¯,potato\n\n\næ­¤æ¶ï¼elasticsearch ä¸­ä¸ä¼å°âåè±âåâpotatoâè§ä¸ºåä¹è¯å³ç³»ï¼æä»¥å¤ä¸ªåä¹è¯è¦åå¨ä¸èµ·ï¼è¿å¾å¾æ¯å¼åä¸­ç»å¸¸å®¹æçå¿½çç¹ã\n\n\n# åèèµæ\n\n * Elasticsearch æç¨',normalizedContent:'# elasticsearch åæå¨\n\nææ¬åææ¯æå¨ææ¬è½¬æ¢ä¸ºä¸ç³»ååè¯ï¼term/tokenï¼çè¿ç¨ï¼ä¹å«åè¯ãå¨ elasticsearch ä¸­ï¼åè¯æ¯éè¿ analyzerï¼åæå¨ï¼æ¥å®æçï¼ä¸ç®¡æ¯ç´¢å¼è¿æ¯æç´¢ï¼é½éè¦ä½¿ç¨ analyzerï¼åæå¨ï¼ãåæå¨ï¼åä¸ºåç½®åæå¨åèªå®ä¹çåæå¨ã\n\nåæå¨å¯ä»¥è¿ä¸æ­¥ç»åä¸ºå­ç¬¦è¿æ»¤å¨ï¼character filtersï¼ãåè¯å¨ï¼tokenizerï¼åè¯åè¿æ»¤å¨ï¼token filtersï¼ä¸é¨åãå®çæ§è¡é¡ºåºå¦ä¸ï¼\n\ncharacter filters -> tokenizer -> token filters\n\n\n# å­ç¬¦è¿æ»¤å¨ï¼character filtersï¼\n\ncharacter filter çè¾å¥æ¯åå§çææ¬ textï¼å¦æéç½®äºå¤ä¸ªï¼å®ä¼æç§éç½®çé¡ºåºæ§è¡ï¼ç®å es èªå¸¦ç character filter ä¸»è¦æå¦ä¸ 3 ç±»ï¼\n\n 1. html strip character filterï¼ä»ææ¬ä¸­å¥ç¦» html åç´ ï¼å¹¶ç¨å¶è§£ç å¼æ¿æ¢ html å®ä½ï¼å¦ï¼å° ï¼amp; æ¿æ¢ä¸º ï¼ï¼ã\n 2. mapping character filterï¼èªå®ä¹ä¸ä¸ª map æ å°ï¼å¯ä»¥è¿è¡ä¸äºèªå®ä¹çæ¿æ¢ï¼å¦å¸¸ç¨çå¤§ååå°åä¹å¯ä»¥å¨è¯¥ç¯èè®¾ç½®ã\n 3. pattern replace character filterï¼ä½¿ç¨ java æ­£åè¡¨è¾¾å¼æ¥å¹éåºæ¿æ¢ä¸ºæå®æ¿æ¢å­ç¬¦ä¸²çå­ç¬¦ï¼æ­¤å¤ï¼æ¿æ¢å­ç¬¦ä¸²å¯ä»¥å¼ç¨æ­£åè¡¨è¾¾å¼ä¸­çæè·ç»ã\n\n\n# html strip character filter\n\nhtml strip å¦ä¸ç¤ºä¾ï¼\n\nget /_analyze\n{\n  "tokenizer": "keyword",\n  "char_filter": [\n    "html_strip"\n  ],\n  "text": "<p>i&apos;m so <b>happy</b>!</p>"\n}\n\n\nç»è¿ html_strip å­ç¬¦è¿æ»¤å¨å¤çåï¼è¾åºå¦ä¸ï¼\n\n[ \\ni\'m so happy!\\n ]\n\n\n\n# mapping character filter\n\nmapping character filter æ¥æ¶é®åå¼æ å°ï¼key => valueï¼ä½ä¸ºéç½®åæ°ï¼æ¯å½å¨é¢å¤çè¿ç¨ä¸­éå°ä¸é®å¼æ å°ä¸­çé®ç¸åçå­ç¬¦ä¸²æ¶ï¼å°±ä¼ä½¿ç¨è¯¥é®å¯¹åºçå¼å»æ¿æ¢å®ã\n\nåå§ææ¬ä¸­çå­ç¬¦ä¸²åé®å¼æ å°ä¸­çé®çå¹éæ¯è´ªå¿çï¼å¨å¯¹ç»å®çææ¬è¿è¡é¢å¤çè¿ç¨ä¸­å¦æéç½®çé®å¼æ å°å­å¨åå«å³ç³»ï¼ä¼ä¼åå¹éæé¿é®ãåæ ·ä¹å¯ä»¥ç¨ç©ºå­ç¬¦ä¸²è¿è¡æ¿æ¢ã\n\nmapping char_filter ä¸å html_strip é£æ ·æç®±å³å¯ç¨ï¼å¿é¡»åè¿è¡éç½®æè½ä½¿ç¨ï¼å®æä¸¤ä¸ªå±æ§å¯ä»¥éç½®ï¼\n\nåæ°åç§°            åæ°è¯´æ\nmappings        ä¸ç»æ å°ï¼æ¯ä¸ªåç´ çæ ¼å¼ä¸º key => valueã\nmappings_path   ä¸ä¸ªç¸å¯¹æèç»å¯¹çæä»¶è·¯å¾ï¼æåä¸ä¸ªæ¯è¡åå«ä¸ä¸ª key =>value æ å°ç utf-8 ç¼ç ææ¬æ å°æä»¶ã\n\nmapping char_filter ç¤ºä¾å¦ä¸ï¼\n\nget /_analyze\n{\n  "tokenizer": "keyword",\n  "char_filter": [\n    {\n      "type": "mapping",\n      "mappings": [\n        "Ù  => 0",\n        "Ù¡ => 1",\n        "Ù¢ => 2",\n        "Ù£ => 3",\n        "Ù¤ => 4",\n        "Ù¥ => 5",\n        "Ù¦ => 6",\n        "Ù§ => 7",\n        "Ù¨ => 8",\n        "Ù© => 9"\n      ]\n    }\n  ],\n  "text": "my license plate is Ù¢Ù¥Ù Ù¡Ù¥"\n}\n\n\nåæç»æå¦ä¸ï¼\n\n[ my license plate is 25015 ]\n\n\n\n# pattern replace character filter\n\npattern replace character filter æ¯æå¦ä¸ä¸ä¸ªåæ°ï¼\n\nåæ°åç§°          åæ°è¯´æ\npattern       å¿å¡«åæ°ï¼ä¸ä¸ª java çæ­£åè¡¨è¾¾å¼ã\nreplacement   æ¿æ¢å­ç¬¦ä¸²ï¼å¯ä»¥ä½¿ç¨ $1 ... $9 è¯­æ³æ¥å¼ç¨æè·ç»ã\nflags         java æ­£åè¡¨è¾¾å¼çæ å¿ï¼å·ä½åè java ç java.util.regex.pattern ç±»çæ å¿å±æ§ã\n\nå¦å°è¾å¥ç text ä¸­å¤§äºä¸ä¸ªçç©ºæ ¼é½è½¬åä¸ºä¸ä¸ªç©ºæ ¼ï¼å¨ settings æ¶ï¼éç½®ç¤ºä¾å¦ä¸ï¼\n\n"char_filter": {\n  "multi_space_2_one": {\n    "pattern": "[ ]+",\n    "type": "pattern_replace",\n    "replacement": " "\n  },\n  ...\n}\n\n\n\n# åè¯å¨ï¼tokenizerï¼\n\ntokenizer å³åè¯å¨ï¼ä¹æ¯ analyzer æéè¦çç»ä»¶ï¼å®å¯¹ææ¬è¿è¡åè¯ï¼ä¸ä¸ª analyzer å¿éä¸åªå¯åå«ä¸ä¸ª tokenizerã\n\nes èªå¸¦é»è®¤çåè¯å¨æ¯ standard tokenizerï¼æ ååè¯å¨æä¾åºäºè¯­æ³çåè¯ï¼åºäº unicode ææ¬åå²ç®æ³ï¼ï¼å¹¶ä¸éç¨äºå¤§å¤æ°è¯­è¨ã\n\næ­¤å¤æå¾å¤ç¬¬ä¸æ¹çåè¯æä»¶ï¼å¦ä¸­æåè¯çæç»å¸ç ik åè¯å¨ï¼å®å¯¹åºç tokenizer åä¸º ik_smart å ik_max_wordï¼ä¸ä¸ªæ¯æºè½åè¯ï¼éå¯¹æç´¢ä¾§ï¼ï¼ä¸ä¸ªæ¯å¨ååè¯ï¼éå¯¹ç´¢å¼ä¾§ï¼ã\n\nes é»è®¤æä¾çåè¯å¨ standard å¯¹ä¸­æåè¯ä¸ä¼åï¼ææå·®ï¼ä¸è¬ä¼å®è£ç¬¬ä¸æ¹ä¸­æåè¯æä»¶ï¼éå¸¸é¦å elasticsearch-analysis-ik æä»¶ï¼å®å¶å®æ¯ ik éå¯¹ç es çå®å¶çã\n\n\n# elasticsearch-plugin ä½¿ç¨\n\nå¨å®è£ elasticsearch-analysis-ik ç¬¬ä¸æ¹ä¹åï¼æä»¬é¦åè¦äºè§£ es çæä»¶ç®¡çå·¥å· elasticsearch-plugin çä½¿ç¨ã\n\nç°å¨ç elasticsearch å®è£å®åï¼å¨å®è£ç®å½ç bin ç®å½ä¸ä¼å­å¨ elasticsearch-plugin å½ä»¤å·¥å·ï¼ç¨å®æ¥å¯¹ es æä»¶è¿è¡ç®¡çã\n\nbin/elasticsearch-plugin\n\n\nå¶å®è¯¥å½ä»¤çæ¯è½¯è¿æ¥ï¼åå§è·¯å¾æ¯ï¼\n\nlibexec/bin/elasticsearch-plugin\n\n\nåè¿ä¸æ­¥çèæ¬ä»£ç ï¼ä½ ä¼åç°ï¼å®æ¯éè¿ elasticsearch-cli æ§è¡ libexec/lib/tools/plugin-cli/elasticsearch-plugin-cli-x.x.x.jarã\n\nä½ä¸è¬ä½¿ç¨èäºè§£ elasticsearch-plugin å½ä»¤ä½¿ç¨å°±å¯ï¼\n\n#  å®è£æå®çæä»¶å°å½å es èç¹ä¸­\nelasticsearch-plugin install {plugin_url}\n\n#  æ¾ç¤ºå½å es èç¹å·²ç»å®è£çæä»¶åè¡¨\nelasticsearch-plugin list\n\n#  å é¤å·²å®è£çæä»¶\nelasticsearch-plugin remove {plugin_name}\n\n\n> å¨å®è£æä»¶æ¶ï¼è¦ä¿è¯å®è£çæä»¶ä¸ es çæ¬ä¸è´ã\n\n\n# elasticsearch-analysis-ik å®è£\n\nå¨ç¡®å®è¦å®è£ç ik çæ¬ä¹åï¼æ§è¡å¦ä¸å½ä»¤ï¼\n\n./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v{x.x.x}/elasticsearch-analysis-ik-{x.x.x}.zip\n\n\næ§è¡å®å®è£å½ä»¤åï¼æä»¬ä¼åç°å¨ plugins ä¸­å¤äº analysis-ik ç®å½ï¼è¿éé¢ä¸»è¦å­æ¾çæ¯æºç  jar åï¼æ­¤å¤ï¼å¨ config æä»¶éä¹å¤äº analysis-ik ç®å½ï¼éé¢ä¸»è¦æ¯ ik ç¸å³çéç½®ï¼å¦ ikanalyzer.cfg.xml éç½®ãè¯å¸æä»¶ç­ã\n\n#  ä¸¤ä¸ªæ°å¢ç®å½è·¯å¾\nlibexec/plugins/analysis-ik/\nlibexec/config/analysis-ik/\n\n\n\n# elasticsearch-analysis-ik ä½¿ç¨\n\nes 5.x çæ¬å¼å§å®è£å®ç elasticsearch-analysis-ik æä¾äºä¸¤ä¸ªåè¯å¨ï¼åå«å¯¹åºåç§°æ¯ ik_max_word å ik_smartï¼ik_max_word æ¯ç´¢å¼ä¾§çåè¯å¨ï¼èµ°å¨åæ¨¡å¼ï¼ik_smart æ¯æç´¢ä¾§çåè¯å¨ï¼èµ°æºè½åè¯ï¼å±äºæç´¢æ¨¡å¼ã\n\n# ç´¢å¼ mapping è®¾ç½®\n\nå®è£å® elasticsearch-analysis-ik åï¼æä»¬å¯ä»¥æå®ç´¢å¼åæå®å­æ®µè®¾ç½®å¯ç¨çåæå¨ï¼analyzerï¼ï¼ç¤ºä¾å¦ä¸ï¼\n\n{\n  "qa": {\n    "mappings": {\n      "qa": {\n        "_all": {\n          "enabled": false\n        },\n        "properties": {\n          "question": {\n            "type": "text",\n            "store": true,\n            "similarity": "bm25",\n            "analyzer": "ik_max_word",\n            "search_analyzer": "ik_smart"\n          },\n          "answer": {\n            "type": "text",\n            "store": false,\n            "similarity": "bm25",\n            "analyzer": "ik_max_word",\n            "search_analyzer": "ik_smart"\n          },\n          ...\n        }\n      }\n    }\n  }\n}\n\n\nå¦ä¸ç¤ºä¾ä¸­ï¼analyzer æå® ik_max_wordï¼å³ç´¢å¼ä¾§ä½¿ç¨ ik å¨åæ¨¡å¼ï¼search_analyzer è®¾ç½® ik_smartï¼å³æç´¢ä¾§ä½¿ç¨ ik æºè½åè¯æ¨¡å¼ã\n\n# æ¥ç ik åè¯ç»æ\n\nes æä¾äºæ¥çåè¯ç»æç api analyzeï¼å·ä½ç¤ºä¾å¦ä¸ï¼\n\nget {index}/_analyze\n{\n  "analyzer" : "ik_smart",\n  "text" : "es ä¸­æåè¯å¨å®è£"\n}\n\n\nè¾åºå¦ä¸ï¼\n\n{\n  "tokens": [\n    {\n      "token": "es",\n      "start_offset": 0,\n      "end_offset": 2,\n      "type": "cn_word",\n      "position": 0\n    },\n    {\n      "token": "ä¸­æ",\n      "start_offset": 3,\n      "end_offset": 5,\n      "type": "cn_word",\n      "position": 1\n    },\n    {\n      "token": "åè¯å¨",\n      "start_offset": 5,\n      "end_offset": 8,\n      "type": "cn_word",\n      "position": 2\n    },\n    {\n      "token": "å®è£",\n      "start_offset": 8,\n      "end_offset": 10,\n      "type": "cn_word",\n      "position": 3\n    }\n  ]\n}\n\n\n# elasticsearch-analysis-ik èªå®ä¹è¯å¸\n\nelasticsearch-analysis-ik æ¬è´¨æ¯ ik åè¯å¨ï¼ä½¿ç¨èæ ¹æ®å®ééæ±å¯ä»¥æ©å±èªå®ä¹çè¯å¸ï¼å·ä½ä¸»è¦åä¸ºå¦ä¸ 2 å¤§ç±»ï¼æ¯ç±»ååä¸ºæ¬å°éç½®åè¿ç¨éç½® 2 ç§ï¼\n\n 1. èªå®ä¹æ©å±è¯å¸ï¼\n 2. èªå®ä¹æ©å±åç¨è¯å¸ï¼\n\nelasticsearch-analysis-ik éç½®æä»¶ä¸º ikanalyzer.cfg.xmlï¼å®ä½äº libexec/config/analysis-ik ç®å½ä¸ï¼å·ä½éç½®ç»æå¦ä¸ï¼\n\n<?xml version="1.0" encoding="utf-8"?>\n<!doctype properties system "http://java.sun.com/dtd/properties.dtd">\n<properties>\n\t<comment>ik analyzer æ©å±éç½®</comment>\n\t\x3c!--ç¨æ·å¯ä»¥å¨è¿ééç½®èªå·±çæ©å±å­å¸ --\x3e\n\t<entry key="ext_dict"></entry>\n\t \x3c!--ç¨æ·å¯ä»¥å¨è¿ééç½®èªå·±çæ©å±åæ­¢è¯å­å¸--\x3e\n\t<entry key="ext_stopwords"></entry>\n\t\x3c!--ç¨æ·å¯ä»¥å¨è¿ééç½®è¿ç¨æ©å±å­å¸ --\x3e\n\t\x3c!-- <entry key="remote_ext_dict">words_location</entry> --\x3e\n\t\x3c!--ç¨æ·å¯ä»¥å¨è¿ééç½®è¿ç¨æ©å±åæ­¢è¯å­å¸--\x3e\n\t\x3c!-- <entry key="remote_ext_stopwords">words_location</entry> --\x3e\n</properties>\n\n\n> å½ç¶ï¼å¦æå¼åèè®¤ä¸º ik é»è®¤çè¯è¡¨æé®é¢ï¼ä¹å¯ä»¥è¿è¡è°æ´ï¼æä»¶é½å¨ libexec/config/analysis-ik ä¸ï¼å¦ main.dic ä¸ºä¸»è¯å¸ï¼stopword.dic ä¸ºåç¨è¯è¡¨ã\n\n\n# è¯åè¿æ»¤å¨ï¼token filtersï¼\n\ntoken filters å«è¯åè¿æ»¤å¨ï¼æè¯é¡¹è¿æ»¤å¨ï¼å¯¹ tokenizer ååºçè¯è¿è¡è¿æ»¤å¤çãå¸¸ç¨çæè½¬å°åãåç¨è¯å¤çãåä¹è¯å¤çç­ç­ãä¸ä¸ª analyzer å¯åå« 0 ä¸ªæå¤ä¸ªè¯é¡¹è¿æ»¤å¨ï¼æéç½®é¡ºåºè¿è¡è¿æ»¤ã\n\nä»¥åä¹è¯è¿æ»¤å¨çä½¿ç¨ç¤ºä¾ï¼å·ä½å¦ä¸ï¼\n\nput /test_index\n{\n  "settings": {\n    "index": {\n      "analysis": {\n        "analyzer": {\n          "synonym": {\n            "tokenizer": "standard",\n            "filter": [ "my_stop", "synonym" ]\n          }\n        },\n        "filter": {\n          "my_stop": {\n            "type": "stop",\n            "stopwords": [ "bar" ]\n          },\n          "synonym": {\n            "type": "synonym",\n            "lenient": true,\n            "synonyms": [ "foo, bar => baz" ]\n          }\n        }\n      }\n    }\n  }\n}\n\n\n\n# åä¹è¯\n\nelasticsearch åä¹è¯éè¿ä¸æçåä¹è¯è¿æ»¤å¨ï¼synonym token filterï¼æ¥è¿è¡å·¥ä½ï¼å®åè®¸å¨åæï¼analysisï¼è¿ç¨ä¸­æ¹ä¾¿å°å¤çåä¹è¯ï¼ä¸è¬æ¯éè¿éç½®æä»¶éç½®åä¹è¯ãæ­¤å¤ï¼åä¹è¯å¯ä»¥åå»ºç´¢å¼æ¶ï¼index-time synonymsï¼æèæ£ç´¢æ¶ï¼search-time synonymsï¼ä½¿ç¨ã\n\n# åä¹è¯ï¼synonymï¼éç½®è¯­æ³\n\nå¦ä¸ä¾å­æç¤ºï¼es åä¹è¯éç½®ç filter è¯­æ³å·ä½å¦ä¸éé¡¹ï¼\n\n * typeï¼æå® synonymï¼è¡¨ç¤ºåä¹è¯ filterï¼\n\n * synonyms_pathï¼æå®åä¹è¯éç½®æä»¶è·¯å¾ï¼\n\n * expandï¼è¯¥åæ°å³å®æ å°è¡ä¸ºçæ¨¡å¼ï¼é»è®¤ä¸º trueï¼è¡¨ç¤ºæ©å±æ¨¡å¼ï¼å·ä½ç¤ºä¾å¦ä¸ï¼\n   \n   * å½ expand == true æ¶ï¼\n     \n     ipod, i-pod, i pod\n     \n     \n     ç­ä»·äºï¼\n     \n     ipod, i-pod, i pod => ipod, i-pod, i pod\n     \n     \n     å½ expand == false æ¶ï¼\n     \n     ipod, i-pod, i pod\n     \n     \n     ä»æ å°ç¬¬ä¸ä¸ªåè¯ï¼ç­ä»·äºï¼\n     \n     ipod, i-pod, i pod => ipod\n     \n\n * lenientï¼å¦æå¼ä¸º true æ¶ï¼éå°é£äºæ æ³è§£æçåä¹è¯è§åæ¶ï¼å¿½ç¥å¼å¸¸ãé»è®¤ä¸º falseã\n\n# åä¹è¯ææ¡£æ ¼å¼\n\nelasticsearch çåä¹è¯æå¦ä¸ä¸¤ç§å½¢å¼ï¼\n\n * åååä¹è¯ï¼\n   \n   ipod, i-pod, i pod => ipod\n   \n\n * åååä¹è¯ï¼\n   \n   é©¬éè¯, åè±, potato\n   \n\nåååä¹è¯ä¸ç®¡ç´¢å¼è¿æ¯æ£ç´¢æ¶ï¼ç®­å¤´å·¦ä¾§çè¯é½ä¼æ å°æç®­å¤´å³ä¾§çè¯ï¼\n\nåååä¹è¯æ¯ç´¢å¼æ¶ï¼é½å»ºç«åä¹è¯çåæç´¢å¼ï¼æ£ç´¢æ¶ï¼åä¹è¯ä¹é´é½ä¼è¿è¡åæç´¢å¼çå¹éã\n\n> åä¹è¯çææ¡£åæ¶ï¼éè¦æ³¨æçæ¯ï¼åä¸ä¸ªè¯å¨ä¸åçåä¹è¯å³ç³»ä¸­åºç°æ¶ï¼å¶å®åä¹è¯ä¹é´ä¸å·æä¼ éæ§ï¼è¿ç¹éè¦æ³¨æã\n\nåè®¾å¦ä¸ç¤ºä¾ä¸­ï¼å¦æâé©¬éè¯âåå¶å®ä¸¤ä¸ªåä¹è¯åæä¸¤è¡åï¼\n\né©¬éè¯,åè±\né©¬éè¯,potato\n\n\næ­¤æ¶ï¼elasticsearch ä¸­ä¸ä¼å°âåè±âåâpotatoâè§ä¸ºåä¹è¯å³ç³»ï¼æä»¥å¤ä¸ªåä¹è¯è¦åå¨ä¸èµ·ï¼è¿å¾å¾æ¯å¼åä¸­ç»å¸¸å®¹æçå¿½çç¹ã\n\n\n# åèèµæ\n\n * elasticsearch æç¨',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Elasticsearch èå",frontmatter:{title:"Elasticsearch èå",date:"2022-01-19T22:49:16.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","èå"],permalink:"/pages/f89f66/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/08.Elasticsearch%E8%81%9A%E5%90%88.html",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/08.Elasticsearchèå.md",key:"v-164e75b2",path:"/pages/f89f66/",headers:[{level:2,title:"èåçå·ä½ç»æ",slug:"èåçå·ä½ç»æ",normalizedTitle:"èåçå·ä½ç»æ",charIndex:327},{level:2,title:"ææ èå",slug:"ææ èå",normalizedTitle:"ææ èå",charIndex:159},{level:3,title:"Max Aggregation",slug:"max-aggregation",normalizedTitle:"max aggregation",charIndex:1837},{level:3,title:"Min Aggregation",slug:"min-aggregation",normalizedTitle:"min aggregation",charIndex:2375},{level:3,title:"Avg Aggregation",slug:"avg-aggregation",normalizedTitle:"avg aggregation",charIndex:2668},{level:3,title:"Sum Aggregation",slug:"sum-aggregation",normalizedTitle:"sum aggregation",charIndex:3150},{level:3,title:"Value Count Aggregation",slug:"value-count-aggregation",normalizedTitle:"value count aggregation",charIndex:3557},{level:3,title:"Cardinality Aggregation",slug:"cardinality-aggregation",normalizedTitle:"cardinality aggregation",charIndex:3869},{level:3,title:"Stats Aggregation",slug:"stats-aggregation",normalizedTitle:"stats aggregation",charIndex:4440},{level:3,title:"Extended Stats Aggregation",slug:"extended-stats-aggregation",normalizedTitle:"extended stats aggregation",charIndex:4854},{level:3,title:"Percentiles Aggregation",slug:"percentiles-aggregation",normalizedTitle:"percentiles aggregation",charIndex:5546},{level:3,title:"Percentiles Ranks Aggregation",slug:"percentiles-ranks-aggregation",normalizedTitle:"percentiles ranks aggregation",charIndex:6434},{level:2,title:"æ¡¶èå",slug:"æ¡¶èå",normalizedTitle:"æ¡¶èå",charIndex:186},{level:3,title:"Terms Aggregation",slug:"terms-aggregation",normalizedTitle:"terms aggregation",charIndex:7707},{level:3,title:"Filter Aggregation",slug:"filter-aggregation",normalizedTitle:"filter aggregation",charIndex:7872},{level:3,title:"Filters Aggregation",slug:"filters-aggregation",normalizedTitle:"filters aggregation",charIndex:7964},{level:3,title:"Range Aggregation",slug:"range-aggregation",normalizedTitle:"range aggregation",charIndex:8029},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:12009}],headersStr:"èåçå·ä½ç»æ ææ èå Max Aggregation Min Aggregation Avg Aggregation Sum Aggregation Value Count Aggregation Cardinality Aggregation Stats Aggregation Extended Stats Aggregation Percentiles Aggregation Percentiles Ranks Aggregation æ¡¶èå Terms Aggregation Filter Aggregation Filters Aggregation Range Aggregation åèèµæ",content:'# Elasticsearch èå\n\nElasticsearch æ¯ä¸ä¸ªåå¸å¼çå¨ææç´¢å¼æï¼ç´¢å¼åæç´¢æ¯ Elasticsearch çåºæ¬åè½ãäºå®ä¸ï¼Elasticsearch çèåï¼Aggregationsï¼åè½ä¹ååå¼ºå¤§ï¼åè®¸å¨æ°æ®ä¸åå¤æçåæç»è®¡ãElasticsearch æä¾çèååæåè½ä¸»è¦æææ èå(metrics aggregations)ãæ¡¶èå(bucket aggregations)ãç®¡éèå(pipeline aggregations) å ç©éµèå(matrix aggregations) åå¤§ç±»ï¼ç®¡éèååç©éµèåå®æ¹è¯´ææ¯å¨è¯éªé¶æ®µï¼åæä¼å®å¨æ´æ¹æèç§»é¤ï¼è¿éä¸åå¯¹ç®¡éèååç©éµèåè¿è¡è®²è§£ã\n\n\n# èåçå·ä½ç»æ\n\nææçèåï¼æ è®ºå®ä»¬æ¯ä»ä¹ç±»åï¼é½éµä»ä»¥ä¸çè§åã\n\n * ä½¿ç¨æ¥è¯¢ä¸­åæ ·ç JSON è¯·æ±æ¥å®ä¹å®ä»¬ï¼èä¸ä½ æ¯ä½¿ç¨é® aggregations æèæ¯ aggs æ¥è¿è¡æ è®°ãéè¦ç»æ¯ä¸ªèåèµ·ä¸ä¸ªåå­ï¼æå®å®çç±»åä»¥ååè¯¥ç±»åç¸å³çéé¡¹ã\n * å®ä»¬è¿è¡å¨æ¥è¯¢çç»æä¹ä¸ãåæ¥è¯¢ä¸å¹éçææ¡£ä¸ä¼è®¡ç®å¨åï¼é¤éä½ ä½¿ç¨ global èéå°ä¸å¹éçææ¡£åæ¬å¶ä¸­ã\n * å¯ä»¥è¿ä¸æ­¥è¿æ»¤æ¥è¯¢çç»æï¼èä¸å½±åèéã\n\nä»¥ä¸æ¯èåçåºæ¬ç»æï¼\n\n"aggregations" : { \x3c!-- æå¤å±çèåé®ï¼ä¹å¯ä»¥ç¼©åä¸º aggs --\x3e\n    "<aggregation_name>" : { \x3c!-- èåçèªå®ä¹åå­ --\x3e\n        "<aggregation_type>" : { \x3c!-- èåçç±»åï¼ææ ç¸å³çï¼å¦ maxãminãavgãsumï¼æ¡¶ç¸å³ç termsãfilter ç­ --\x3e\n            <aggregation_body> \x3c!-- èåä½ï¼å¯¹åªäºå­æ®µè¿è¡èåï¼å¯ä»¥åå­æ®µçå¼ï¼ä¹å¯ä»¥æ¯èæ¬è®¡ç®çç»æ --\x3e\n        }\n        [,"meta" : {  [<meta_data_body>] } ]? \x3c!-- å --\x3e\n        [,"aggregations" : { [<sub_aggregation>]+ } ]? \x3c!-- å¨èåéé¢å¨å®ä¹å­èå --\x3e\n    }\n    [,"<aggregation_name_2>" : { ... } ]* \x3c!-- èåçèªå®ä¹åå­ 2 --\x3e\n}\n\n\n * å¨æä¸å±æä¸ä¸ª aggregations çé®ï¼å¯ä»¥ç¼©åä¸º aggsã\n * å¨ä¸é¢ä¸å±ï¼éè¦ä¸ºèåæå®ä¸ä¸ªåå­ãå¯ä»¥å¨è¯·æ±çè¿åä¸­çå°è¿ä¸ªåå­ãå¨åä¸ä¸ªè¯·æ±ä¸­ä½¿ç¨å¤ä¸ªèåæ¶ï¼è¿ä¸ç¹éå¸¸æç¨ï¼å®è®©ä½ å¯ä»¥å¾å®¹æå°çè§£æ¯ç»ç»æçå«ä¹ã\n * æåï¼å¿é¡»è¦æå®èåçç±»åã\n\n> å³äºèååæçå¼æ¥æºï¼å¯ä»¥åå­æ®µçå¼ï¼ä¹å¯ä»¥æ¯èæ¬è®¡ç®çç»æã\n> \n> ä½æ¯ç¨èæ¬è®¡ç®çç»ææ¶ï¼éè¦æ³¨æèæ¬çæ§è½åå®å¨æ§ï¼å°½ç®¡å¤æ°èéç±»ååè®¸ä½¿ç¨èæ¬ï¼ä½æ¯èæ¬ä½¿å¾èéåå¾ç¼æ¢ï¼å ä¸ºèæ¬å¿é¡»å¨æ¯ç¯ææ¡£ä¸è¿è¡ãä¸ºäºé¿åèæ¬çè¿è¡ï¼å¯ä»¥å¨ç´¢å¼é¶æ®µè¿è¡è®¡ç®ã\n> \n> æ­¤å¤ï¼èæ¬ä¹å¯ä»¥è¢«äººå¯è½å©ç¨è¿è¡æ¶æä»£ç æ»å»ï¼å°½éä½¿ç¨æ²çï¼sandboxï¼åçèæ¬è¯­è¨ã\n\nç¤ºä¾ï¼æ¥è¯¢ææçåçå¹³åå¹´é¾æ¯å¤å°ï¼å¹¶å¯¹çåçå¹³åèªæ°´å  188ï¼ä¹å¯ä»¥çè§£ä¸ºæ¯åçåå  188 åçå¹³åèªæ°´ï¼ã\n\nPOST /player/_search?size=0\n{\n  "aggs": {\n    "avg_age": {\n      "avg": {\n        "field": "age"\n      }\n    },\n    "avg_salary_188": {\n      "avg": {\n        "script": {\n          "source": "doc.salary.value + 188"\n        }\n      }\n    }\n  }\n}\n\n\n\n# ææ èå\n\nææ èåï¼åç§°åº¦éèåï¼ä¸»è¦ä»ä¸åææ¡£çåç»ä¸­æåç»è®¡æ°æ®ï¼æèï¼ä»æ¥èªå¶ä»èåçææ¡£æ¡¶æ¥æåç»è®¡æ°æ®ã\n\nè¿äºç»è®¡æ°æ®éå¸¸æ¥èªæ°å¼åå­æ®µï¼å¦æå°æèå¹³åä»·æ ¼ãç¨æ·å¯ä»¥åç¬è·åæ¯é¡¹ç»è®¡æ°æ®ï¼æèä¹å¯ä»¥ä½¿ç¨ stats èåæ¥åæ¶è·åå®ä»¬ãæ´é«çº§çç»è®¡æ°æ®ï¼å¦å¹³æ¹åæèæ¯æ åå·®ï¼å¯ä»¥éè¿ extended stats èåæ¥è·åã\n\n\n# Max Aggregation\n\nMax Aggregation ç¨äºæå¤§å¼ç»è®¡ãä¾å¦ï¼ç»è®¡ sales ç´¢å¼ä¸­ä»·æ ¼æé«çæ¯åªæ¬ä¹¦ï¼å¹¶ä¸è®¡ç®åºå¯¹åºçä»·æ ¼ç 2 åå¼ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET /sales/_search?size=0\n{\n  "aggs" : {\n    "max_price" : {\n      "max" : {\n        "field" : "price"\n      }\n    },\n    "max_price_2" : {\n      "max" : {\n        "field" : "price",\n        "script": {\n          "source": "_value * 2.0"\n        }\n      }\n    }\n  }\n}\n\n\næå®ç fieldï¼å¨èæ¬ä¸­å¯ä»¥ç¨ _value åå­æ®µçå¼ã\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "max_price": {\n      "value": 188.0\n    },\n    "max_price_2": {\n      "value": 376.0\n    }\n  }\n}\n\n\n\n# Min Aggregation\n\nMin Aggregation ç¨äºæå°å¼ç»è®¡ãä¾å¦ï¼ç»è®¡ sales ç´¢å¼ä¸­ä»·æ ¼æä½çæ¯åªæ¬ä¹¦ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET /sales/_search?size=0\n{\n  "aggs" : {\n    "min_price" : {\n      "min" : {\n        "field" : "price"\n      }\n    }\n  }\n}\n\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "min_price": {\n      "value": 18.0\n    }\n  }\n}\n\n\n\n# Avg Aggregation\n\nAvg Aggregation ç¨äºè®¡ç®å¹³åå¼ãä¾å¦ï¼ç»è®¡ exams ç´¢å¼ä¸­èè¯çå¹³ååæ°ï¼å¦æªå­å¨åæ°ï¼é»è®¤ä¸º 60 åï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET /exams/_search?size=0\n{\n  "aggs" : {\n    "avg_grade" : {\n      "avg" : {\n        "field" : "grade",\n        "missing": 60\n      }\n    }\n  }\n}\n\n\nå¦ææå®å­æ®µæ²¡æå¼ï¼å¯ä»¥éè¿ missing æå®é»è®¤å¼ï¼è¥æªæå®é»è®¤å¼ï¼ç¼ºå¤±è¯¥å­æ®µå¼çææ¡£å°è¢«å¿½ç¥ï¼è®¡ç®ï¼ã\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "avg_grade": {\n      "value": 78.0\n    }\n  }\n}\n\n\né¤äºå¸¸è§çå¹³åå¼èåè®¡ç®å¤ï¼elasticsearch è¿æä¾äºå æå¹³åå¼çèåè®¡ç®ï¼è¯¦æåè§ Elasticsearch ææ èåä¹ Weighted Avg Aggregationã\n\n\n# Sum Aggregation\n\nSum Aggregation ç¨äºè®¡ç®æ»åãä¾å¦ï¼ç»è®¡ sales ç´¢å¼ä¸­ type å­æ®µä¸­å¹é hat çä»·æ ¼æ»åï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET /exams/_search?size=0\n{\n  "query" : {\n    "constant_score" : {\n      "filter" : {\n        "match" : { "type" : "hat" }\n      }\n    }\n  },\n  "aggs" : {\n    "hat_prices" : {\n      "sum" : { "field" : "price" }\n    }\n  }\n}\n\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "hat_prices": {\n      "value": 567.0\n    }\n  }\n}\n\n\n\n# Value Count Aggregation\n\nValue Count Aggregation å¯æå­æ®µç»è®¡ææ¡£æ°éãä¾å¦ï¼ç»è®¡ books ç´¢å¼ä¸­åå« author å­æ®µçææ¡£æ°éï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET /books/_search?size=0\n{\n  "aggs" : {\n    "doc_count" : {\n      "value_count" : { "field" : "author" }\n    }\n  }\n}\n\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "doc_count": {\n      "value": 5\n    }\n  }\n}\n\n\n\n# Cardinality Aggregation\n\nCardinality Aggregation ç¨äºåºæ°ç»è®¡ï¼å¶ä½ç¨æ¯åæ§è¡ç±»ä¼¼ SQL ä¸­ç distinct æä½ï¼å»æéåä¸­çéå¤é¡¹ï¼ç¶åç»è®¡å»éåçéåé¿åº¦ãä¾å¦ï¼å¨ books ç´¢å¼ä¸­å¯¹ language å­æ®µè¿è¡ cardinality æä½å¯ä»¥ç»è®¡åºç¼ç¨è¯­è¨çç§ç±»æ°ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET /books/_search?size=0\n{\n  "aggs" : {\n    "all_lan" : {\n      "cardinality" : { "field" : "language" }\n    },\n    "title_cnt" : {\n      "cardinality" : { "field" : "title.keyword" }\n    }\n  }\n}\n\n\nåè®¾ title å­æ®µä¸ºææ¬ç±»åï¼textï¼ï¼å»éæ¶éè¦æå® keywordï¼è¡¨ç¤ºæ title ä½ä¸ºæ´ä½å»éï¼å³ä¸åè¯ç»è®¡ã\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "all_lan": {\n      "value": 8\n    },\n    "title_cnt": {\n      "value": 18\n    }\n  }\n}\n\n\n\n# Stats Aggregation\n\nStats Aggregation ç¨äºåºæ¬ç»è®¡ï¼ä¼ä¸æ¬¡è¿å countãmaxãminãavg å sum è¿ 5 ä¸ªææ ãä¾å¦ï¼å¨ exams ç´¢å¼ä¸­å¯¹ grade å­æ®µè¿è¡åæ°ç¸å³çåºæ¬ç»è®¡ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET /exams/_search?size=0\n{\n  "aggs" : {\n    "grades_stats" : {\n      "stats" : { "field" : "grade" }\n    }\n  }\n}\n\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "grades_stats": {\n      "count": 2,\n      "min": 50.0,\n      "max": 100.0,\n      "avg": 75.0,\n      "sum": 150.0\n    }\n  }\n}\n\n\n\n# Extended Stats Aggregation\n\nExtended Stats Aggregation ç¨äºé«çº§ç»è®¡ï¼ååºæ¬ç»è®¡åè½ç±»ä¼¼ï¼ä½æ¯ä¼æ¯åºæ¬ç»è®¡å¤åºä»¥ä¸å ä¸ªç»è®¡ç»æï¼sum_of_squaresï¼å¹³æ¹åï¼ãvarianceï¼æ¹å·®ï¼ãstd_deviationï¼æ åå·®ï¼ãstd_deviation_boundsï¼å¹³åå¼å /åä¸¤ä¸ªæ åå·®çåºé´ï¼ãå¨ exams ç´¢å¼ä¸­å¯¹ grade å­æ®µè¿è¡åæ°ç¸å³çé«çº§ç»è®¡ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET /exams/_search?size=0\n{\n  "aggs" : {\n    "grades_stats" : {\n      "extended_stats" : { "field" : "grade" }\n    }\n  }\n}\n\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "grades_stats": {\n      "count": 2,\n      "min": 50.0,\n      "max": 100.0,\n      "avg": 75.0,\n      "sum": 150.0,\n      "sum_of_squares": 12500.0,\n      "variance": 625.0,\n      "std_deviation": 25.0,\n      "std_deviation_bounds": {\n        "upper": 125.0,\n        "lower": 25.0\n      }\n    }\n  }\n}\n\n\n\n# Percentiles Aggregation\n\nPercentiles Aggregation ç¨äºç¾åä½ç»è®¡ãç¾åä½æ°æ¯ä¸ä¸ªç»è®¡å­¦æ¯è¯­ï¼å¦æå°ä¸ç»æ°æ®ä»å¤§å°å°æåºï¼å¹¶è®¡ç®ç¸åºçç´¯è®¡ç¾åä½ï¼æä¸ç¾åä½æå¯¹åºæ°æ®çå¼å°±ç§°ä¸ºè¿ä¸ç¾åä½çç¾åä½æ°ãé»è®¤æåµä¸ï¼ç´¯è®¡ç¾åä½ä¸º [ 1, 5, 25, 50, 75, 95, 99 ]ãä»¥ä¸ä¾å­ç»åºäºå¨ latency ç´¢å¼ä¸­å¯¹ load_time å­æ®µè¿è¡å è½½æ¶é´çç¾åä½ç»è®¡ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET latency/_search\n{\n  "size": 0,\n  "aggs" : {\n    "load_time_outlier" : {\n      "percentiles" : {\n        "field" : "load_time"\n      }\n    }\n  }\n}\n\n\néè¦æ³¨æçæ¯ï¼å¦ä¸ç load_time å­æ®µå¿é¡»æ¯æ°å­ç±»åã\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "load_time_outlier": {\n      "values" : {\n        "1.0": 5.0,\n        "5.0": 25.0,\n        "25.0": 165.0,\n        "50.0": 445.0,\n        "75.0": 725.0,\n        "95.0": 945.0,\n        "99.0": 985.0\n      }\n    }\n  }\n}\n\n\nç¾åä½çç»è®¡ä¹å¯ä»¥æå® percents åæ°æå®ç¾åä½ï¼å¦ä¸ï¼\n\nGET latency/_search\n{\n  "size": 0,\n  "aggs" : {\n    "load_time_outlier" : {\n      "percentiles" : {\n        "field" : "load_time",\n        "percents": [60, 80, 95]\n      }\n    }\n  }\n}\n\n\n\n# Percentiles Ranks Aggregation\n\nPercentiles Ranks Aggregation ä¸ Percentiles Aggregation ç»è®¡æ°æ°ç¸åï¼å°±æ¯æ³çå½åæ°å¼å¤å¨ä»ä¹èå´åï¼ç¾åä½ï¼ï¼ åå¦ä½ æ¥ä¸ä¸å½åå¼ 500 å 600 æå¤çç¾åä½ï¼åç°æ¯ 90.01 å 100ï¼é£ä¹è¯´ææ 90.01 % çæ°å¼é½å¨ 500 ä»¥åï¼100 % çæ°å¼å¨ 600 ä»¥åã\n\nGET latency/_search\n{\n  "size": 0,\n    "aggs" : {\n      "load_time_ranks" : {\n        "percentile_ranks" : {\n          "field" : "load_time",\n          "values" : [500, 600]\n        }\n      }\n  }\n}\n\n\nåæ · load_time å­æ®µå¿é¡»æ¯æ°å­ç±»åã\n\nè¿åç»æå¤§æ¦ç±»ä¼¼å¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "load_time_ranks": {\n      "values" : {\n        "500.0": 90.01,\n        "600.0": 100.0\n      }\n    }\n  }\n}\n\n\nå¯ä»¥è®¾ç½® keyed åæ°ä¸º trueï¼å°å¯¹åºç values ä½ä¸ºæ¡¶ key ä¸èµ·è¿åï¼é»è®¤æ¯ falseã\n\nGET latency/_search\n{\n  "size": 0,\n  "aggs": {\n    "load_time_ranks": {\n      "percentile_ranks": {\n        "field": "load_time",\n        "values": [500, 600],\n        "keyed": true\n      }\n    }\n  }\n}\n\n\nè¿åç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "load_time_ranks": {\n      "values": [\n        {\n          "key": 500.0,\n          "value": 90.01\n        },\n        {\n          "key": 600.0,\n          "value": 100.0\n        }\n      ]\n    }\n  }\n}\n\n\n\n# æ¡¶èå\n\nbucket å¯ä»¥çè§£ä¸ºä¸ä¸ªæ¡¶ï¼å®ä¼éåææ¡£ä¸­çåå®¹ï¼å¡æ¯ç¬¦åæä¸è¦æ±çå°±æ¾å¥ä¸ä¸ªæ¡¶ä¸­ï¼åæ¡¶ç¸å½äº SQL ä¸­ç group byãä»å¦å¤ä¸ä¸ªè§åº¦ï¼å¯ä»¥å°ææ èåçæåæ¡¶èåï¼å³æææææ¡£æ¾å°ä¸ä¸ªæ¡¶ä¸­ï¼èæ¡¶èåæ¯å¤æ¡¶åèåï¼å®æ ¹æ®ç¸åºçæ¡ä»¶è¿è¡åç»ã\n\nç§ç±»                                      æè¿°/åºæ¯\nè¯é¡¹èåï¼Terms Aggregationï¼                 ç¨äºåç»èåï¼è®©ç¨æ·å¾ç¥ææ¡£ä¸­æ¯ä¸ªè¯é¡¹çé¢çï¼å®è¿åæ¯ä¸ªè¯é¡¹åºç°çæ¬¡æ°ã\nå·®å¼è¯é¡¹èåï¼Significant Terms Aggregationï¼   å®ä¼è¿åæä¸ªè¯é¡¹å¨æ´ä¸ªç´¢å¼ä¸­åå¨æ¥è¯¢ç»æä¸­çè¯é¢å·®å¼ï¼è¿æå©äºæä»¬åç°æç´¢åºæ¯ä¸­ææä¹çè¯ã\nè¿æ»¤å¨èåï¼Filter Aggregationï¼               æå®è¿æ»¤å¨å¹éçææææ¡£å°åä¸ªæ¡¶ï¼bucketï¼ï¼éå¸¸è¿å°ç¨äºå°å½åèåä¸ä¸æç¼©å°å°ä¸ç»ç¹å®çææ¡£ã\nå¤è¿æ»¤å¨èåï¼Filters Aggregationï¼             æå®å¤ä¸ªè¿æ»¤å¨å¹éææææ¡£å°å¤ä¸ªæ¡¶ï¼bucketï¼ã\nèå´èåï¼Range Aggregationï¼                 èå´èåï¼ç¨äºåæ æ°æ®çåå¸æåµã\næ¥æèå´èåï¼Date Range Aggregationï¼          ä¸é¨ç¨äºæ¥æç±»åçèå´èåã\nIP èå´èåï¼IP Range Aggregationï¼           ç¨äºå¯¹ IP ç±»åæ°æ®èå´èåã\nç´æ¹å¾èåï¼Histogram Aggregationï¼            å¯è½æ¯æ°å¼ï¼æèæ¥æåï¼åèå´èéç±»ä¼¼ã\næ¶é´ç´æ¹å¾èåï¼Date Histogram Aggregationï¼     æ¶é´ç´æ¹å¾èåï¼å¸¸ç¨äºæç§æ¥æå¯¹ææ¡£è¿è¡ç»è®¡å¹¶ç»å¶æ¡å½¢å¾ã\nç©ºå¼èåï¼Missing Aggregationï¼               ç©ºå¼èåï¼å¯ä»¥æææ¡£éä¸­ææç¼ºå¤±å­æ®µçææ¡£åå°ä¸ä¸ªæ¡¶ä¸­ã\nå°çç¹èå´èåï¼Geo Distance Aggregationï¼       ç¨äºå¯¹å°çç¹ï¼geo pointï¼åèå´ç»è®¡ã\n\n\n# Terms Aggregation\n\nTerms Aggregation ç¨äºè¯é¡¹çåç»èåãæä¸ºç»å¸çç¨ä¾æ¯è·å X ä¸­æé¢ç¹ï¼top frequentï¼çé¡¹ç®ï¼å¶ä¸­ X æ¯ææ¡£ä¸­çæä¸ªå­æ®µï¼å¦ç¨æ·çåç§°ãæ ç­¾æåç±»ãç±äº terms èéç»è®¡çæ¯æ¯ä¸ªè¯æ¡ï¼èä¸æ¯æ´ä¸ªå­æ®µå¼ï¼å æ­¤éå¸¸éè¦å¨ä¸ä¸ªéåæåçå­æ®µä¸è¿è¡è¿ç§èéãåå æ¯, ä½ ææâbig dataâä½ä¸ºè¯ç»ç»è®¡ï¼èä¸æ¯âbigâåç¬ç»è®¡ä¸æ¬¡ï¼âdataâååç¬ç»è®¡ä¸æ¬¡ã\n\nç¨æ·å¯ä»¥ä½¿ç¨ terms èéï¼ä»åæåå­æ®µï¼å¦åå®¹ï¼ä¸­æ½åæä¸ºé¢ç¹çè¯æ¡ãè¿å¯ä»¥ä½¿ç¨è¿ç§ä¿¡æ¯æ¥çæä¸ä¸ªåè¯äºã\n\n{\n  "aggs": {\n    "profit_terms": {\n      "terms": { // terms èå å³é®å­\n        "field": "profit",\n        ......\n      }\n    }\n  }\n}\n\n\nå¨ terms åæ¡¶çåºç¡ä¸ï¼è¿å¯ä»¥å¯¹æ¯ä¸ªæ¡¶è¿è¡ææ ç»è®¡ï¼ä¹å¯ä»¥åºäºä¸äºææ æå­æ®µå¼è¿è¡æåºãç¤ºä¾å¦ä¸ï¼\n\n{\n  "aggs": {\n    "item_terms": {\n      "terms": {\n        "field": "item_id",\n        "size": 1000,\n        "order":[{\n          "gmv_stat": "desc"\n        },{\n          "gmv_180d": "desc"\n        }]\n      },\n      "aggs": {\n        "gmv_stat": {\n          "sum": {\n            "field": "gmv"\n          }\n        },\n        "gmv_180d": {\n          "sum": {\n            "script": "doc[\'gmv_90d\'].value*2"\n          }\n        }\n      }\n    }\n  }\n}\n\n\nè¿åçç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "hospital_id_agg": {\n      "doc_count_error_upper_bound": 0,\n      "sum_other_doc_count": 260,\n      "buckets": [\n        {\n          "key": 23388,\n          "doc_count": 18,\n          "gmv_stat": {\n            "value": 176220\n          },\n          "gmv_180d": {\n            "value": 89732\n          }\n        },\n        {\n          "key": 96117,\n          "doc_count": 16,\n          "gmv_stat": {\n            "value": 129306\n          },\n          "gmv_180d": {\n            "value": 56988\n          }\n        },\n        ...\n      ]\n    }\n  }\n}\n\n\né»è®¤æåµä¸è¿åæææ¡£è®¡æ°ä»é«å°ä½çå 10 ä¸ªåç»ï¼å¯ä»¥éè¿ size åæ°æå®è¿åçåç»æ°ã\n\n\n# Filter Aggregation\n\nFilter Aggregation æ¯è¿æ»¤å¨èåï¼å¯ä»¥æç¬¦åè¿æ»¤å¨ä¸­çæ¡ä»¶çææ¡£åå°ä¸ä¸ªæ¡¶ä¸­ï¼å³æ¯ååç»èåã\n\n{\n  "aggs": {\n    "age_terms": {\n      "filter": {"match":{"gender":"F"}},\n      "aggs": {\n        "avg_age": {\n          "avg": {\n            "field": "age"\n          }\n        }\n      }\n    }\n  }\n}\n\n\n\n# Filters Aggregation\n\nFilters Aggregation æ¯å¤è¿æ»¤å¨èåï¼å¯ä»¥æç¬¦åå¤ä¸ªè¿æ»¤æ¡ä»¶çææ¡£åå°ä¸åçæ¡¶ä¸­ï¼å³æ¯ä¸ªåç»å³èä¸ä¸ªè¿æ»¤æ¡ä»¶ï¼å¹¶æ¶éæææ»¡è¶³èªèº«è¿æ»¤æ¡ä»¶çææ¡£ã\n\n{\n  "size": 0,\n  "aggs": {\n    "messages": {\n      "filters": {\n        "filters": {\n          "errors": { "match": { "body": "error" } },\n          "warnings": { "match": { "body": "warning" } }\n        }\n      }\n    }\n  }\n}\n\n\nå¨è¿ä¸ªä¾å­éï¼æä»¬åææ¥å¿ä¿¡æ¯ãèåä¼åå»ºä¸¤ä¸ªå³äºæ¥å¿æ°æ®çåç»ï¼ä¸ä¸ªæ¶éåå«éè¯¯ä¿¡æ¯çææ¡£ï¼å¦ä¸ä¸ªæ¶éåå«åè­¦ä¿¡æ¯çææ¡£ãèä¸æ¯ä¸ªåç»ä¼ææä»½ååã\n\n{\n  ...\n  "aggregations": {\n    "messages": {\n      "buckets": {\n        "errors": {\n          "doc_count": 1\n        },\n        "warnings": {\n          "doc_count": 2\n        }\n      }\n    }\n  }\n}\n\n\n\n# Range Aggregation\n\nRange Aggregation èå´èåæ¯ä¸ä¸ªåºäºå¤ç»å¼æ¥æºçèåï¼å¯ä»¥è®©ç¨æ·å®ä¹ä¸ç³»åèå´ï¼æ¯ä¸ªèå´ä»£è¡¨ä¸ä¸ªåç»ãå¨èåæ§è¡çè¿ç¨ä¸­ï¼ä»æ¯ä¸ªææ¡£æååºæ¥çå¼é½ä¼æ£æ¥æ¯ä¸ªåç»çèå´ï¼å¹¶ä¸ä½¿ç¸å³çææ¡£è½å¥åç»ä¸­ãæ³¨æï¼èå´èåçæ¯ä¸ªèå´ååå« from å¼ä½æ¯æé¤ to å¼ã\n\n{\n  "aggs": {\n    "age_range": {\n      "range": {\n        "field": "age",\n          "ranges": [{\n            "to": 25\n          },\n          {\n            "from": 25,\n            "to": 35\n          },\n          {\n            "from": 35\n          }]\n        },\n        "aggs": {\n          "bmax": {\n            "max": {\n              "field": "balance"\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\n\nè¿åç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "age_range": {\n      "buckets": [{\n        "key": "*-25.0",\n        "to": 25,\n        "doc_count": 225,\n        "bmax": {\n          "value": 49587\n        }\n      },\n      {\n        "key": "25.0-35.0",\n        "from": 25,\n        "to": 35,\n        "doc_count": 485,\n        "bmax": {\n          "value": 49795\n        }\n      },\n      {\n        "key": "35.0-*",\n        "from": 35,\n        "doc_count": 290,\n        "bmax": {\n          "value": 49989\n        }\n      }]\n    }\n  }\n}\n\n\n\n# åèèµæ\n\n * Elasticsearch æç¨',normalizedContent:'# elasticsearch èå\n\nelasticsearch æ¯ä¸ä¸ªåå¸å¼çå¨ææç´¢å¼æï¼ç´¢å¼åæç´¢æ¯ elasticsearch çåºæ¬åè½ãäºå®ä¸ï¼elasticsearch çèåï¼aggregationsï¼åè½ä¹ååå¼ºå¤§ï¼åè®¸å¨æ°æ®ä¸åå¤æçåæç»è®¡ãelasticsearch æä¾çèååæåè½ä¸»è¦æææ èå(metrics aggregations)ãæ¡¶èå(bucket aggregations)ãç®¡éèå(pipeline aggregations) å ç©éµèå(matrix aggregations) åå¤§ç±»ï¼ç®¡éèååç©éµèåå®æ¹è¯´ææ¯å¨è¯éªé¶æ®µï¼åæä¼å®å¨æ´æ¹æèç§»é¤ï¼è¿éä¸åå¯¹ç®¡éèååç©éµèåè¿è¡è®²è§£ã\n\n\n# èåçå·ä½ç»æ\n\nææçèåï¼æ è®ºå®ä»¬æ¯ä»ä¹ç±»åï¼é½éµä»ä»¥ä¸çè§åã\n\n * ä½¿ç¨æ¥è¯¢ä¸­åæ ·ç json è¯·æ±æ¥å®ä¹å®ä»¬ï¼èä¸ä½ æ¯ä½¿ç¨é® aggregations æèæ¯ aggs æ¥è¿è¡æ è®°ãéè¦ç»æ¯ä¸ªèåèµ·ä¸ä¸ªåå­ï¼æå®å®çç±»åä»¥ååè¯¥ç±»åç¸å³çéé¡¹ã\n * å®ä»¬è¿è¡å¨æ¥è¯¢çç»æä¹ä¸ãåæ¥è¯¢ä¸å¹éçææ¡£ä¸ä¼è®¡ç®å¨åï¼é¤éä½ ä½¿ç¨ global èéå°ä¸å¹éçææ¡£åæ¬å¶ä¸­ã\n * å¯ä»¥è¿ä¸æ­¥è¿æ»¤æ¥è¯¢çç»æï¼èä¸å½±åèéã\n\nä»¥ä¸æ¯èåçåºæ¬ç»æï¼\n\n"aggregations" : { \x3c!-- æå¤å±çèåé®ï¼ä¹å¯ä»¥ç¼©åä¸º aggs --\x3e\n    "<aggregation_name>" : { \x3c!-- èåçèªå®ä¹åå­ --\x3e\n        "<aggregation_type>" : { \x3c!-- èåçç±»åï¼ææ ç¸å³çï¼å¦ maxãminãavgãsumï¼æ¡¶ç¸å³ç termsãfilter ç­ --\x3e\n            <aggregation_body> \x3c!-- èåä½ï¼å¯¹åªäºå­æ®µè¿è¡èåï¼å¯ä»¥åå­æ®µçå¼ï¼ä¹å¯ä»¥æ¯èæ¬è®¡ç®çç»æ --\x3e\n        }\n        [,"meta" : {  [<meta_data_body>] } ]? \x3c!-- å --\x3e\n        [,"aggregations" : { [<sub_aggregation>]+ } ]? \x3c!-- å¨èåéé¢å¨å®ä¹å­èå --\x3e\n    }\n    [,"<aggregation_name_2>" : { ... } ]* \x3c!-- èåçèªå®ä¹åå­ 2 --\x3e\n}\n\n\n * å¨æä¸å±æä¸ä¸ª aggregations çé®ï¼å¯ä»¥ç¼©åä¸º aggsã\n * å¨ä¸é¢ä¸å±ï¼éè¦ä¸ºèåæå®ä¸ä¸ªåå­ãå¯ä»¥å¨è¯·æ±çè¿åä¸­çå°è¿ä¸ªåå­ãå¨åä¸ä¸ªè¯·æ±ä¸­ä½¿ç¨å¤ä¸ªèåæ¶ï¼è¿ä¸ç¹éå¸¸æç¨ï¼å®è®©ä½ å¯ä»¥å¾å®¹æå°çè§£æ¯ç»ç»æçå«ä¹ã\n * æåï¼å¿é¡»è¦æå®èåçç±»åã\n\n> å³äºèååæçå¼æ¥æºï¼å¯ä»¥åå­æ®µçå¼ï¼ä¹å¯ä»¥æ¯èæ¬è®¡ç®çç»æã\n> \n> ä½æ¯ç¨èæ¬è®¡ç®çç»ææ¶ï¼éè¦æ³¨æèæ¬çæ§è½åå®å¨æ§ï¼å°½ç®¡å¤æ°èéç±»ååè®¸ä½¿ç¨èæ¬ï¼ä½æ¯èæ¬ä½¿å¾èéåå¾ç¼æ¢ï¼å ä¸ºèæ¬å¿é¡»å¨æ¯ç¯ææ¡£ä¸è¿è¡ãä¸ºäºé¿åèæ¬çè¿è¡ï¼å¯ä»¥å¨ç´¢å¼é¶æ®µè¿è¡è®¡ç®ã\n> \n> æ­¤å¤ï¼èæ¬ä¹å¯ä»¥è¢«äººå¯è½å©ç¨è¿è¡æ¶æä»£ç æ»å»ï¼å°½éä½¿ç¨æ²çï¼sandboxï¼åçèæ¬è¯­è¨ã\n\nç¤ºä¾ï¼æ¥è¯¢ææçåçå¹³åå¹´é¾æ¯å¤å°ï¼å¹¶å¯¹çåçå¹³åèªæ°´å  188ï¼ä¹å¯ä»¥çè§£ä¸ºæ¯åçåå  188 åçå¹³åèªæ°´ï¼ã\n\npost /player/_search?size=0\n{\n  "aggs": {\n    "avg_age": {\n      "avg": {\n        "field": "age"\n      }\n    },\n    "avg_salary_188": {\n      "avg": {\n        "script": {\n          "source": "doc.salary.value + 188"\n        }\n      }\n    }\n  }\n}\n\n\n\n# ææ èå\n\nææ èåï¼åç§°åº¦éèåï¼ä¸»è¦ä»ä¸åææ¡£çåç»ä¸­æåç»è®¡æ°æ®ï¼æèï¼ä»æ¥èªå¶ä»èåçææ¡£æ¡¶æ¥æåç»è®¡æ°æ®ã\n\nè¿äºç»è®¡æ°æ®éå¸¸æ¥èªæ°å¼åå­æ®µï¼å¦æå°æèå¹³åä»·æ ¼ãç¨æ·å¯ä»¥åç¬è·åæ¯é¡¹ç»è®¡æ°æ®ï¼æèä¹å¯ä»¥ä½¿ç¨ stats èåæ¥åæ¶è·åå®ä»¬ãæ´é«çº§çç»è®¡æ°æ®ï¼å¦å¹³æ¹åæèæ¯æ åå·®ï¼å¯ä»¥éè¿ extended stats èåæ¥è·åã\n\n\n# max aggregation\n\nmax aggregation ç¨äºæå¤§å¼ç»è®¡ãä¾å¦ï¼ç»è®¡ sales ç´¢å¼ä¸­ä»·æ ¼æé«çæ¯åªæ¬ä¹¦ï¼å¹¶ä¸è®¡ç®åºå¯¹åºçä»·æ ¼ç 2 åå¼ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget /sales/_search?size=0\n{\n  "aggs" : {\n    "max_price" : {\n      "max" : {\n        "field" : "price"\n      }\n    },\n    "max_price_2" : {\n      "max" : {\n        "field" : "price",\n        "script": {\n          "source": "_value * 2.0"\n        }\n      }\n    }\n  }\n}\n\n\næå®ç fieldï¼å¨èæ¬ä¸­å¯ä»¥ç¨ _value åå­æ®µçå¼ã\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "max_price": {\n      "value": 188.0\n    },\n    "max_price_2": {\n      "value": 376.0\n    }\n  }\n}\n\n\n\n# min aggregation\n\nmin aggregation ç¨äºæå°å¼ç»è®¡ãä¾å¦ï¼ç»è®¡ sales ç´¢å¼ä¸­ä»·æ ¼æä½çæ¯åªæ¬ä¹¦ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget /sales/_search?size=0\n{\n  "aggs" : {\n    "min_price" : {\n      "min" : {\n        "field" : "price"\n      }\n    }\n  }\n}\n\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "min_price": {\n      "value": 18.0\n    }\n  }\n}\n\n\n\n# avg aggregation\n\navg aggregation ç¨äºè®¡ç®å¹³åå¼ãä¾å¦ï¼ç»è®¡ exams ç´¢å¼ä¸­èè¯çå¹³ååæ°ï¼å¦æªå­å¨åæ°ï¼é»è®¤ä¸º 60 åï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget /exams/_search?size=0\n{\n  "aggs" : {\n    "avg_grade" : {\n      "avg" : {\n        "field" : "grade",\n        "missing": 60\n      }\n    }\n  }\n}\n\n\nå¦ææå®å­æ®µæ²¡æå¼ï¼å¯ä»¥éè¿ missing æå®é»è®¤å¼ï¼è¥æªæå®é»è®¤å¼ï¼ç¼ºå¤±è¯¥å­æ®µå¼çææ¡£å°è¢«å¿½ç¥ï¼è®¡ç®ï¼ã\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "avg_grade": {\n      "value": 78.0\n    }\n  }\n}\n\n\né¤äºå¸¸è§çå¹³åå¼èåè®¡ç®å¤ï¼elasticsearch è¿æä¾äºå æå¹³åå¼çèåè®¡ç®ï¼è¯¦æåè§ elasticsearch ææ èåä¹ weighted avg aggregationã\n\n\n# sum aggregation\n\nsum aggregation ç¨äºè®¡ç®æ»åãä¾å¦ï¼ç»è®¡ sales ç´¢å¼ä¸­ type å­æ®µä¸­å¹é hat çä»·æ ¼æ»åï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget /exams/_search?size=0\n{\n  "query" : {\n    "constant_score" : {\n      "filter" : {\n        "match" : { "type" : "hat" }\n      }\n    }\n  },\n  "aggs" : {\n    "hat_prices" : {\n      "sum" : { "field" : "price" }\n    }\n  }\n}\n\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "hat_prices": {\n      "value": 567.0\n    }\n  }\n}\n\n\n\n# value count aggregation\n\nvalue count aggregation å¯æå­æ®µç»è®¡ææ¡£æ°éãä¾å¦ï¼ç»è®¡ books ç´¢å¼ä¸­åå« author å­æ®µçææ¡£æ°éï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget /books/_search?size=0\n{\n  "aggs" : {\n    "doc_count" : {\n      "value_count" : { "field" : "author" }\n    }\n  }\n}\n\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "doc_count": {\n      "value": 5\n    }\n  }\n}\n\n\n\n# cardinality aggregation\n\ncardinality aggregation ç¨äºåºæ°ç»è®¡ï¼å¶ä½ç¨æ¯åæ§è¡ç±»ä¼¼ sql ä¸­ç distinct æä½ï¼å»æéåä¸­çéå¤é¡¹ï¼ç¶åç»è®¡å»éåçéåé¿åº¦ãä¾å¦ï¼å¨ books ç´¢å¼ä¸­å¯¹ language å­æ®µè¿è¡ cardinality æä½å¯ä»¥ç»è®¡åºç¼ç¨è¯­è¨çç§ç±»æ°ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget /books/_search?size=0\n{\n  "aggs" : {\n    "all_lan" : {\n      "cardinality" : { "field" : "language" }\n    },\n    "title_cnt" : {\n      "cardinality" : { "field" : "title.keyword" }\n    }\n  }\n}\n\n\nåè®¾ title å­æ®µä¸ºææ¬ç±»åï¼textï¼ï¼å»éæ¶éè¦æå® keywordï¼è¡¨ç¤ºæ title ä½ä¸ºæ´ä½å»éï¼å³ä¸åè¯ç»è®¡ã\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "all_lan": {\n      "value": 8\n    },\n    "title_cnt": {\n      "value": 18\n    }\n  }\n}\n\n\n\n# stats aggregation\n\nstats aggregation ç¨äºåºæ¬ç»è®¡ï¼ä¼ä¸æ¬¡è¿å countãmaxãminãavg å sum è¿ 5 ä¸ªææ ãä¾å¦ï¼å¨ exams ç´¢å¼ä¸­å¯¹ grade å­æ®µè¿è¡åæ°ç¸å³çåºæ¬ç»è®¡ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget /exams/_search?size=0\n{\n  "aggs" : {\n    "grades_stats" : {\n      "stats" : { "field" : "grade" }\n    }\n  }\n}\n\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "grades_stats": {\n      "count": 2,\n      "min": 50.0,\n      "max": 100.0,\n      "avg": 75.0,\n      "sum": 150.0\n    }\n  }\n}\n\n\n\n# extended stats aggregation\n\nextended stats aggregation ç¨äºé«çº§ç»è®¡ï¼ååºæ¬ç»è®¡åè½ç±»ä¼¼ï¼ä½æ¯ä¼æ¯åºæ¬ç»è®¡å¤åºä»¥ä¸å ä¸ªç»è®¡ç»æï¼sum_of_squaresï¼å¹³æ¹åï¼ãvarianceï¼æ¹å·®ï¼ãstd_deviationï¼æ åå·®ï¼ãstd_deviation_boundsï¼å¹³åå¼å /åä¸¤ä¸ªæ åå·®çåºé´ï¼ãå¨ exams ç´¢å¼ä¸­å¯¹ grade å­æ®µè¿è¡åæ°ç¸å³çé«çº§ç»è®¡ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget /exams/_search?size=0\n{\n  "aggs" : {\n    "grades_stats" : {\n      "extended_stats" : { "field" : "grade" }\n    }\n  }\n}\n\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "grades_stats": {\n      "count": 2,\n      "min": 50.0,\n      "max": 100.0,\n      "avg": 75.0,\n      "sum": 150.0,\n      "sum_of_squares": 12500.0,\n      "variance": 625.0,\n      "std_deviation": 25.0,\n      "std_deviation_bounds": {\n        "upper": 125.0,\n        "lower": 25.0\n      }\n    }\n  }\n}\n\n\n\n# percentiles aggregation\n\npercentiles aggregation ç¨äºç¾åä½ç»è®¡ãç¾åä½æ°æ¯ä¸ä¸ªç»è®¡å­¦æ¯è¯­ï¼å¦æå°ä¸ç»æ°æ®ä»å¤§å°å°æåºï¼å¹¶è®¡ç®ç¸åºçç´¯è®¡ç¾åä½ï¼æä¸ç¾åä½æå¯¹åºæ°æ®çå¼å°±ç§°ä¸ºè¿ä¸ç¾åä½çç¾åä½æ°ãé»è®¤æåµä¸ï¼ç´¯è®¡ç¾åä½ä¸º [ 1, 5, 25, 50, 75, 95, 99 ]ãä»¥ä¸ä¾å­ç»åºäºå¨ latency ç´¢å¼ä¸­å¯¹ load_time å­æ®µè¿è¡å è½½æ¶é´çç¾åä½ç»è®¡ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget latency/_search\n{\n  "size": 0,\n  "aggs" : {\n    "load_time_outlier" : {\n      "percentiles" : {\n        "field" : "load_time"\n      }\n    }\n  }\n}\n\n\néè¦æ³¨æçæ¯ï¼å¦ä¸ç load_time å­æ®µå¿é¡»æ¯æ°å­ç±»åã\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "load_time_outlier": {\n      "values" : {\n        "1.0": 5.0,\n        "5.0": 25.0,\n        "25.0": 165.0,\n        "50.0": 445.0,\n        "75.0": 725.0,\n        "95.0": 945.0,\n        "99.0": 985.0\n      }\n    }\n  }\n}\n\n\nç¾åä½çç»è®¡ä¹å¯ä»¥æå® percents åæ°æå®ç¾åä½ï¼å¦ä¸ï¼\n\nget latency/_search\n{\n  "size": 0,\n  "aggs" : {\n    "load_time_outlier" : {\n      "percentiles" : {\n        "field" : "load_time",\n        "percents": [60, 80, 95]\n      }\n    }\n  }\n}\n\n\n\n# percentiles ranks aggregation\n\npercentiles ranks aggregation ä¸ percentiles aggregation ç»è®¡æ°æ°ç¸åï¼å°±æ¯æ³çå½åæ°å¼å¤å¨ä»ä¹èå´åï¼ç¾åä½ï¼ï¼ åå¦ä½ æ¥ä¸ä¸å½åå¼ 500 å 600 æå¤çç¾åä½ï¼åç°æ¯ 90.01 å 100ï¼é£ä¹è¯´ææ 90.01 % çæ°å¼é½å¨ 500 ä»¥åï¼100 % çæ°å¼å¨ 600 ä»¥åã\n\nget latency/_search\n{\n  "size": 0,\n    "aggs" : {\n      "load_time_ranks" : {\n        "percentile_ranks" : {\n          "field" : "load_time",\n          "values" : [500, 600]\n        }\n      }\n  }\n}\n\n\nåæ · load_time å­æ®µå¿é¡»æ¯æ°å­ç±»åã\n\nè¿åç»æå¤§æ¦ç±»ä¼¼å¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "load_time_ranks": {\n      "values" : {\n        "500.0": 90.01,\n        "600.0": 100.0\n      }\n    }\n  }\n}\n\n\nå¯ä»¥è®¾ç½® keyed åæ°ä¸º trueï¼å°å¯¹åºç values ä½ä¸ºæ¡¶ key ä¸èµ·è¿åï¼é»è®¤æ¯ falseã\n\nget latency/_search\n{\n  "size": 0,\n  "aggs": {\n    "load_time_ranks": {\n      "percentile_ranks": {\n        "field": "load_time",\n        "values": [500, 600],\n        "keyed": true\n      }\n    }\n  }\n}\n\n\nè¿åç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "load_time_ranks": {\n      "values": [\n        {\n          "key": 500.0,\n          "value": 90.01\n        },\n        {\n          "key": 600.0,\n          "value": 100.0\n        }\n      ]\n    }\n  }\n}\n\n\n\n# æ¡¶èå\n\nbucket å¯ä»¥çè§£ä¸ºä¸ä¸ªæ¡¶ï¼å®ä¼éåææ¡£ä¸­çåå®¹ï¼å¡æ¯ç¬¦åæä¸è¦æ±çå°±æ¾å¥ä¸ä¸ªæ¡¶ä¸­ï¼åæ¡¶ç¸å½äº sql ä¸­ç group byãä»å¦å¤ä¸ä¸ªè§åº¦ï¼å¯ä»¥å°ææ èåçæåæ¡¶èåï¼å³æææææ¡£æ¾å°ä¸ä¸ªæ¡¶ä¸­ï¼èæ¡¶èåæ¯å¤æ¡¶åèåï¼å®æ ¹æ®ç¸åºçæ¡ä»¶è¿è¡åç»ã\n\nç§ç±»                                      æè¿°/åºæ¯\nè¯é¡¹èåï¼terms aggregationï¼                 ç¨äºåç»èåï¼è®©ç¨æ·å¾ç¥ææ¡£ä¸­æ¯ä¸ªè¯é¡¹çé¢çï¼å®è¿åæ¯ä¸ªè¯é¡¹åºç°çæ¬¡æ°ã\nå·®å¼è¯é¡¹èåï¼significant terms aggregationï¼   å®ä¼è¿åæä¸ªè¯é¡¹å¨æ´ä¸ªç´¢å¼ä¸­åå¨æ¥è¯¢ç»æä¸­çè¯é¢å·®å¼ï¼è¿æå©äºæä»¬åç°æç´¢åºæ¯ä¸­ææä¹çè¯ã\nè¿æ»¤å¨èåï¼filter aggregationï¼               æå®è¿æ»¤å¨å¹éçææææ¡£å°åä¸ªæ¡¶ï¼bucketï¼ï¼éå¸¸è¿å°ç¨äºå°å½åèåä¸ä¸æç¼©å°å°ä¸ç»ç¹å®çææ¡£ã\nå¤è¿æ»¤å¨èåï¼filters aggregationï¼             æå®å¤ä¸ªè¿æ»¤å¨å¹éææææ¡£å°å¤ä¸ªæ¡¶ï¼bucketï¼ã\nèå´èåï¼range aggregationï¼                 èå´èåï¼ç¨äºåæ æ°æ®çåå¸æåµã\næ¥æèå´èåï¼date range aggregationï¼          ä¸é¨ç¨äºæ¥æç±»åçèå´èåã\nip èå´èåï¼ip range aggregationï¼           ç¨äºå¯¹ ip ç±»åæ°æ®èå´èåã\nç´æ¹å¾èåï¼histogram aggregationï¼            å¯è½æ¯æ°å¼ï¼æèæ¥æåï¼åèå´èéç±»ä¼¼ã\næ¶é´ç´æ¹å¾èåï¼date histogram aggregationï¼     æ¶é´ç´æ¹å¾èåï¼å¸¸ç¨äºæç§æ¥æå¯¹ææ¡£è¿è¡ç»è®¡å¹¶ç»å¶æ¡å½¢å¾ã\nç©ºå¼èåï¼missing aggregationï¼               ç©ºå¼èåï¼å¯ä»¥æææ¡£éä¸­ææç¼ºå¤±å­æ®µçææ¡£åå°ä¸ä¸ªæ¡¶ä¸­ã\nå°çç¹èå´èåï¼geo distance aggregationï¼       ç¨äºå¯¹å°çç¹ï¼geo pointï¼åèå´ç»è®¡ã\n\n\n# terms aggregation\n\nterms aggregation ç¨äºè¯é¡¹çåç»èåãæä¸ºç»å¸çç¨ä¾æ¯è·å x ä¸­æé¢ç¹ï¼top frequentï¼çé¡¹ç®ï¼å¶ä¸­ x æ¯ææ¡£ä¸­çæä¸ªå­æ®µï¼å¦ç¨æ·çåç§°ãæ ç­¾æåç±»ãç±äº terms èéç»è®¡çæ¯æ¯ä¸ªè¯æ¡ï¼èä¸æ¯æ´ä¸ªå­æ®µå¼ï¼å æ­¤éå¸¸éè¦å¨ä¸ä¸ªéåæåçå­æ®µä¸è¿è¡è¿ç§èéãåå æ¯, ä½ ææâbig dataâä½ä¸ºè¯ç»ç»è®¡ï¼èä¸æ¯âbigâåç¬ç»è®¡ä¸æ¬¡ï¼âdataâååç¬ç»è®¡ä¸æ¬¡ã\n\nç¨æ·å¯ä»¥ä½¿ç¨ terms èéï¼ä»åæåå­æ®µï¼å¦åå®¹ï¼ä¸­æ½åæä¸ºé¢ç¹çè¯æ¡ãè¿å¯ä»¥ä½¿ç¨è¿ç§ä¿¡æ¯æ¥çæä¸ä¸ªåè¯äºã\n\n{\n  "aggs": {\n    "profit_terms": {\n      "terms": { // terms èå å³é®å­\n        "field": "profit",\n        ......\n      }\n    }\n  }\n}\n\n\nå¨ terms åæ¡¶çåºç¡ä¸ï¼è¿å¯ä»¥å¯¹æ¯ä¸ªæ¡¶è¿è¡ææ ç»è®¡ï¼ä¹å¯ä»¥åºäºä¸äºææ æå­æ®µå¼è¿è¡æåºãç¤ºä¾å¦ä¸ï¼\n\n{\n  "aggs": {\n    "item_terms": {\n      "terms": {\n        "field": "item_id",\n        "size": 1000,\n        "order":[{\n          "gmv_stat": "desc"\n        },{\n          "gmv_180d": "desc"\n        }]\n      },\n      "aggs": {\n        "gmv_stat": {\n          "sum": {\n            "field": "gmv"\n          }\n        },\n        "gmv_180d": {\n          "sum": {\n            "script": "doc[\'gmv_90d\'].value*2"\n          }\n        }\n      }\n    }\n  }\n}\n\n\nè¿åçç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "hospital_id_agg": {\n      "doc_count_error_upper_bound": 0,\n      "sum_other_doc_count": 260,\n      "buckets": [\n        {\n          "key": 23388,\n          "doc_count": 18,\n          "gmv_stat": {\n            "value": 176220\n          },\n          "gmv_180d": {\n            "value": 89732\n          }\n        },\n        {\n          "key": 96117,\n          "doc_count": 16,\n          "gmv_stat": {\n            "value": 129306\n          },\n          "gmv_180d": {\n            "value": 56988\n          }\n        },\n        ...\n      ]\n    }\n  }\n}\n\n\né»è®¤æåµä¸è¿åæææ¡£è®¡æ°ä»é«å°ä½çå 10 ä¸ªåç»ï¼å¯ä»¥éè¿ size åæ°æå®è¿åçåç»æ°ã\n\n\n# filter aggregation\n\nfilter aggregation æ¯è¿æ»¤å¨èåï¼å¯ä»¥æç¬¦åè¿æ»¤å¨ä¸­çæ¡ä»¶çææ¡£åå°ä¸ä¸ªæ¡¶ä¸­ï¼å³æ¯ååç»èåã\n\n{\n  "aggs": {\n    "age_terms": {\n      "filter": {"match":{"gender":"f"}},\n      "aggs": {\n        "avg_age": {\n          "avg": {\n            "field": "age"\n          }\n        }\n      }\n    }\n  }\n}\n\n\n\n# filters aggregation\n\nfilters aggregation æ¯å¤è¿æ»¤å¨èåï¼å¯ä»¥æç¬¦åå¤ä¸ªè¿æ»¤æ¡ä»¶çææ¡£åå°ä¸åçæ¡¶ä¸­ï¼å³æ¯ä¸ªåç»å³èä¸ä¸ªè¿æ»¤æ¡ä»¶ï¼å¹¶æ¶éæææ»¡è¶³èªèº«è¿æ»¤æ¡ä»¶çææ¡£ã\n\n{\n  "size": 0,\n  "aggs": {\n    "messages": {\n      "filters": {\n        "filters": {\n          "errors": { "match": { "body": "error" } },\n          "warnings": { "match": { "body": "warning" } }\n        }\n      }\n    }\n  }\n}\n\n\nå¨è¿ä¸ªä¾å­éï¼æä»¬åææ¥å¿ä¿¡æ¯ãèåä¼åå»ºä¸¤ä¸ªå³äºæ¥å¿æ°æ®çåç»ï¼ä¸ä¸ªæ¶éåå«éè¯¯ä¿¡æ¯çææ¡£ï¼å¦ä¸ä¸ªæ¶éåå«åè­¦ä¿¡æ¯çææ¡£ãèä¸æ¯ä¸ªåç»ä¼ææä»½ååã\n\n{\n  ...\n  "aggregations": {\n    "messages": {\n      "buckets": {\n        "errors": {\n          "doc_count": 1\n        },\n        "warnings": {\n          "doc_count": 2\n        }\n      }\n    }\n  }\n}\n\n\n\n# range aggregation\n\nrange aggregation èå´èåæ¯ä¸ä¸ªåºäºå¤ç»å¼æ¥æºçèåï¼å¯ä»¥è®©ç¨æ·å®ä¹ä¸ç³»åèå´ï¼æ¯ä¸ªèå´ä»£è¡¨ä¸ä¸ªåç»ãå¨èåæ§è¡çè¿ç¨ä¸­ï¼ä»æ¯ä¸ªææ¡£æååºæ¥çå¼é½ä¼æ£æ¥æ¯ä¸ªåç»çèå´ï¼å¹¶ä¸ä½¿ç¸å³çææ¡£è½å¥åç»ä¸­ãæ³¨æï¼èå´èåçæ¯ä¸ªèå´ååå« from å¼ä½æ¯æé¤ to å¼ã\n\n{\n  "aggs": {\n    "age_range": {\n      "range": {\n        "field": "age",\n          "ranges": [{\n            "to": 25\n          },\n          {\n            "from": 25,\n            "to": 35\n          },\n          {\n            "from": 35\n          }]\n        },\n        "aggs": {\n          "bmax": {\n            "max": {\n              "field": "balance"\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\n\nè¿åç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "age_range": {\n      "buckets": [{\n        "key": "*-25.0",\n        "to": 25,\n        "doc_count": 225,\n        "bmax": {\n          "value": 49587\n        }\n      },\n      {\n        "key": "25.0-35.0",\n        "from": 25,\n        "to": 35,\n        "doc_count": 485,\n        "bmax": {\n          "value": 49795\n        }\n      },\n      {\n        "key": "35.0-*",\n        "from": 35,\n        "doc_count": 290,\n        "bmax": {\n          "value": 49989\n        }\n      }]\n    }\n  }\n}\n\n\n\n# åèèµæ\n\n * elasticsearch æç¨',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Elasticsearch æ§è½ä¼å",frontmatter:{title:"Elasticsearch æ§è½ä¼å",date:"2022-01-21T19:54:43.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","æ§è½"],permalink:"/pages/2d95ce/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/10.Elasticsearch%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/10.Elasticsearchæ§è½ä¼å.md",key:"v-9a8c12f8",path:"/pages/2d95ce/",headers:[{level:2,title:"ç¡¬ä»¶éç½®ä¼å",slug:"ç¡¬ä»¶éç½®ä¼å",normalizedTitle:"ç¡¬ä»¶éç½®ä¼å",charIndex:189},{level:3,title:"CPU éç½®",slug:"cpu-éç½®",normalizedTitle:"cpu éç½®",charIndex:329},{level:3,title:"åå­éç½®",slug:"åå­éç½®",normalizedTitle:"åå­éç½®",charIndex:587},{level:4,title:"åå­åé",slug:"åå­åé",normalizedTitle:"åå­åé",charIndex:1039},{level:4,title:"ç¦æ­¢ swap",slug:"ç¦æ­¢-swap",normalizedTitle:"ç¦æ­¢ swap",charIndex:1520},{level:4,title:"GC è®¾ç½®",slug:"gc-è®¾ç½®",normalizedTitle:"gc è®¾ç½®",charIndex:1642},{level:3,title:"ç£ç",slug:"ç£ç",normalizedTitle:"ç£ç",charIndex:700},{level:2,title:"ç´¢å¼ä¼åè®¾ç½®",slug:"ç´¢å¼ä¼åè®¾ç½®",normalizedTitle:"ç´¢å¼ä¼åè®¾ç½®",charIndex:196},{level:3,title:"æ¹éæäº¤",slug:"æ¹éæäº¤",normalizedTitle:"æ¹éæäº¤",charIndex:2838},{level:3,title:"å¢å  Refresh æ¶é´é´é",slug:"å¢å -refresh-æ¶é´é´é",normalizedTitle:"å¢å  refresh æ¶é´é´é",charIndex:3208},{level:3,title:"ä¿®æ¹ indexbuffersize çè®¾ç½®",slug:"ä¿®æ¹-index-buffer-size-çè®¾ç½®",normalizedTitle:"ä¿®æ¹ indexbuffersize çè®¾ç½®",charIndex:null},{level:3,title:"ä¿®æ¹ translog ç¸å³çè®¾ç½®",slug:"ä¿®æ¹-translog-ç¸å³çè®¾ç½®",normalizedTitle:"ä¿®æ¹ translog ç¸å³çè®¾ç½®",charIndex:4084},{level:3,title:"æ³¨æ _id å­æ®µçä½¿ç¨",slug:"æ³¨æ-id-å­æ®µçä½¿ç¨",normalizedTitle:"æ³¨æ _id å­æ®µçä½¿ç¨",charIndex:4320},{level:3,title:"æ³¨æ _all å­æ®µå _source å­æ®µçä½¿ç¨",slug:"æ³¨æ-all-å­æ®µå-source-å­æ®µçä½¿ç¨",normalizedTitle:"æ³¨æ _all å­æ®µå _source å­æ®µçä½¿ç¨",charIndex:4413},{level:3,title:"åççéç½®ä½¿ç¨ index å±æ§",slug:"åççéç½®ä½¿ç¨-index-å±æ§",normalizedTitle:"åççéç½®ä½¿ç¨ index å±æ§",charIndex:4607},{level:3,title:"åå°å¯æ¬æ°é",slug:"åå°å¯æ¬æ°é",normalizedTitle:"åå°å¯æ¬æ°é",charIndex:4741},{level:2,title:"æ¥è¯¢æ¹é¢ä¼å",slug:"æ¥è¯¢æ¹é¢ä¼å",normalizedTitle:"æ¥è¯¢æ¹é¢ä¼å",charIndex:203},{level:3,title:"è·¯ç±ä¼å",slug:"è·¯ç±ä¼å",normalizedTitle:"è·¯ç±ä¼å",charIndex:4998},{level:4,title:"ä¸å¸¦ routing æ¥è¯¢",slug:"ä¸å¸¦-routing-æ¥è¯¢",normalizedTitle:"ä¸å¸¦ routing æ¥è¯¢",charIndex:5162},{level:4,title:"å¸¦ routing æ¥è¯¢",slug:"å¸¦-routing-æ¥è¯¢",normalizedTitle:"å¸¦ routing æ¥è¯¢",charIndex:5163},{level:3,title:"Filter VS Query",slug:"filter-vs-query",normalizedTitle:"filter vs query",charIndex:5436},{level:3,title:"æ·±åº¦ç¿»é¡µ",slug:"æ·±åº¦ç¿»é¡µ",normalizedTitle:"æ·±åº¦ç¿»é¡µ",charIndex:5624},{level:3,title:"èæ¬ï¼scriptï¼åçä½¿ç¨",slug:"èæ¬-script-åçä½¿ç¨",normalizedTitle:"èæ¬ï¼scriptï¼åçä½¿ç¨",charIndex:6012},{level:2,title:"æ°æ®ç»æä¼å",slug:"æ°æ®ç»æä¼å",normalizedTitle:"æ°æ®ç»æä¼å",charIndex:210},{level:3,title:"å°½éåå°ä¸éè¦çå­æ®µ",slug:"å°½éåå°ä¸éè¦çå­æ®µ",normalizedTitle:"å°½éåå°ä¸éè¦çå­æ®µ",charIndex:6303},{level:3,title:"Nested Object vs Parent/Child",slug:"nested-object-vs-parent-child",normalizedTitle:"nested object vs parent/child",charIndex:6654},{level:3,title:"éæ©éææ å°ï¼éå¿éæ¶ï¼ç¦æ­¢å¨ææ å°",slug:"éæ©éææ å°-éå¿éæ¶-ç¦æ­¢å¨ææ å°",normalizedTitle:"éæ©éææ å°ï¼éå¿éæ¶ï¼ç¦æ­¢å¨ææ å°",charIndex:7211},{level:2,title:"éç¾¤æ¶æè®¾è®¡",slug:"éç¾¤æ¶æè®¾è®¡",normalizedTitle:"éç¾¤æ¶æè®¾è®¡",charIndex:7441},{level:3,title:"ä¸»èç¹ãæ°æ®èç¹ååè°èç¹åç¦»",slug:"ä¸»èç¹ãæ°æ®èç¹ååè°èç¹åç¦»",normalizedTitle:"ä¸»èç¹ãæ°æ®èç¹ååè°èç¹åç¦»",charIndex:7488},{level:4,title:"ä¸»ï¼masterï¼èç¹",slug:"ä¸»-master-èç¹",normalizedTitle:"ä¸»ï¼masterï¼èç¹",charIndex:7670},{level:4,title:"æ°æ®ï¼dataï¼èç¹",slug:"æ°æ®-data-èç¹",normalizedTitle:"æ°æ®ï¼dataï¼èç¹",charIndex:8056},{level:4,title:"åè°ï¼coordinatingï¼èç¹",slug:"åè°-coordinating-èç¹",normalizedTitle:"åè°ï¼coordinatingï¼èç¹",charIndex:9019},{level:3,title:"å³é­ data èç¹æå¡å¨ä¸­ç http åè½",slug:"å³é­-data-èç¹æå¡å¨ä¸­ç-http-åè½",normalizedTitle:"å³é­ data èç¹æå¡å¨ä¸­ç http åè½",charIndex:9727},{level:3,title:"ä¸å°æå¡å¨ä¸æå¥½åªé¨ç½²ä¸ä¸ª node",slug:"ä¸å°æå¡å¨ä¸æå¥½åªé¨ç½²ä¸ä¸ª-node",normalizedTitle:"ä¸å°æå¡å¨ä¸æå¥½åªé¨ç½²ä¸ä¸ª node",charIndex:10002},{level:3,title:"éç¾¤åçè®¾ç½®",slug:"éç¾¤åçè®¾ç½®",normalizedTitle:"éç¾¤åçè®¾ç½®",charIndex:10126},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:10528}],headersStr:"ç¡¬ä»¶éç½®ä¼å CPU éç½® åå­éç½® åå­åé ç¦æ­¢ swap GC è®¾ç½® ç£ç ç´¢å¼ä¼åè®¾ç½® æ¹éæäº¤ å¢å  Refresh æ¶é´é´é ä¿®æ¹ indexbuffersize çè®¾ç½® ä¿®æ¹ translog ç¸å³çè®¾ç½® æ³¨æ _id å­æ®µçä½¿ç¨ æ³¨æ _all å­æ®µå _source å­æ®µçä½¿ç¨ åççéç½®ä½¿ç¨ index å±æ§ åå°å¯æ¬æ°é æ¥è¯¢æ¹é¢ä¼å è·¯ç±ä¼å ä¸å¸¦ routing æ¥è¯¢ å¸¦ routing æ¥è¯¢ Filter VS Query æ·±åº¦ç¿»é¡µ èæ¬ï¼scriptï¼åçä½¿ç¨ æ°æ®ç»æä¼å å°½éåå°ä¸éè¦çå­æ®µ Nested Object vs Parent/Child éæ©éææ å°ï¼éå¿éæ¶ï¼ç¦æ­¢å¨ææ å° éç¾¤æ¶æè®¾è®¡ ä¸»èç¹ãæ°æ®èç¹ååè°èç¹åç¦» ä¸»ï¼masterï¼èç¹ æ°æ®ï¼dataï¼èç¹ åè°ï¼coordinatingï¼èç¹ å³é­ data èç¹æå¡å¨ä¸­ç http åè½ ä¸å°æå¡å¨ä¸æå¥½åªé¨ç½²ä¸ä¸ª node éç¾¤åçè®¾ç½® åèèµæ",content:"# Elasticsearch æ§è½ä¼å\n\nElasticsearch æ¯å½åæµè¡çä¼ä¸çº§æç´¢å¼æï¼è®¾è®¡ç¨äºäºè®¡ç®ä¸­ï¼è½å¤è¾¾å°å®æ¶æç´¢ï¼ç¨³å®ï¼å¯é ï¼å¿«éï¼å®è£ä½¿ç¨æ¹ä¾¿ãä½ä¸ºä¸ä¸ªå¼ç®±å³ç¨çäº§åï¼å¨çäº§ç¯å¢ä¸çº¿ä¹åï¼æä»¬å¶å®ä¸ä¸å®è½ç¡®ä¿å¶çæ§è½åç¨³å®æ§ãå¦ä½æ ¹æ®å®éæåµæé«æå¡çæ§è½ï¼å¶å®æå¾å¤æå·§ãè¿ç« æä»¬åäº«ä»å®æç»éªä¸­æ»ç»åºæ¥ç elasticsearch æ§è½ä¼åï¼ä¸»è¦ä»ç¡¬ä»¶éç½®ä¼åãç´¢å¼ä¼åè®¾ç½®ãæ¥è¯¢æ¹é¢ä¼åãæ°æ®ç»æä¼åãéç¾¤æ¶æä¼åç­æ¹é¢è®²è§£ã\n\n\n# ç¡¬ä»¶éç½®ä¼å\n\nåçº§ç¡¬ä»¶è®¾å¤éç½®ä¸ç´é½æ¯æé«æå¡è½åæå¿«éææçææ®µï¼å¨ç³»ç»å±é¢è½å¤å½±ååºç¨æ§è½çä¸è¬åæ¬ä¸ä¸ªå ç´ ï¼CPUãåå­å IOï¼å¯ä»¥ä»è¿ä¸æ¹é¢è¿è¡ ES çæ§è½ä¼åå·¥ä½ã\n\n\n# CPU éç½®\n\nä¸è¬è¯´æ¥ï¼CPU ç¹å¿çåå æä»¥ä¸å ä¸ªï¼\n\n 1. çº¿ç¨ä¸­ææ éç©ºå¾ªç¯ãæ é»å¡ãæ­£åå¹éæèåçº¯çè®¡ç®ï¼\n 2. åçäºé¢ç¹ç GCï¼\n 3. å¤çº¿ç¨çä¸ä¸æåæ¢ï¼\n\nå¤§å¤æ° Elasticsearch é¨ç½²å¾å¾å¯¹ CPU è¦æ±ä¸é«ãå æ­¤ï¼ç¸å¯¹å¶å®èµæºï¼å·ä½éç½®å¤å°ä¸ªï¼CPUï¼ä¸æ¯é£ä¹å³é®ãä½ åºè¯¥éæ©å·æå¤ä¸ªåæ ¸çç°ä»£å¤çå¨ï¼å¸¸è§çéç¾¤ä½¿ç¨ 2 å° 8 ä¸ªæ ¸çæºå¨ãå¦æä½ è¦å¨æ´å¿«ç CPUs åæ´å¤çæ ¸æ°ä¹é´éæ©ï¼éæ©æ´å¤çæ ¸æ°æ´å¥½ãå¤ä¸ªåæ ¸æä¾çé¢å¤å¹¶åè¿èè¿ç¨å¾®å¿«ä¸ç¹ç¹çæ¶éé¢çã\n\n\n# åå­éç½®\n\nå¦ææä¸ç§èµæºæ¯æåè¢«èå°½çï¼å®å¯è½æ¯åå­ãæåºåèåé½å¾èåå­ï¼æä»¥æè¶³å¤çå ç©ºé´æ¥åºä»å®ä»¬æ¯å¾éè¦çãå³ä½¿å ç©ºé´æ¯æ¯è¾å°çæ¶åï¼ä¹è½ä¸ºæä½ç³»ç»æä»¶ç¼å­æä¾é¢å¤çåå­ãå ä¸º Lucene ä½¿ç¨çè®¸å¤æ°æ®ç»ææ¯åºäºç£ççæ ¼å¼ï¼Elasticsearch å©ç¨æä½ç³»ç»ç¼å­è½äº§çå¾å¤§ææã\n\n64 GB åå­çæºå¨æ¯éå¸¸çæ³çï¼ä½æ¯ 32 GB å 16 GB æºå¨ä¹æ¯å¾å¸¸è§çãå°äº 8 GB ä¼éå¾å¶åï¼ä½ æç»éè¦å¾å¤å¾å¤çå°æºå¨ï¼ï¼å¤§äº 64 GB çæºå¨ä¹ä¼æé®é¢ã\n\nç±äº ES æå»ºåºäº luceneï¼è lucene è®¾è®¡å¼ºå¤§ä¹å¤å¨äº lucene è½å¤å¾å¥½çå©ç¨æä½ç³»ç»åå­æ¥ç¼å­ç´¢å¼æ°æ®ï¼ä»¥æä¾å¿«éçæ¥è¯¢æ§è½ãlucene çç´¢å¼æä»¶ segements æ¯å­å¨å¨åæä»¶ä¸­çï¼å¹¶ä¸ä¸å¯åï¼å¯¹äº OS æ¥è¯´ï¼è½å¤å¾åå¥½å°å°ç´¢å¼æä»¶ä¿æå¨ cache ä¸­ï¼ä»¥ä¾¿å¿«éè®¿é®ï¼å æ­¤ï¼æä»¬å¾æå¿è¦å°ä¸åçç©çåå­çç» luceneï¼å¦ä¸åçç©çåå­çç» ESï¼JVM heapï¼ã\n\n# åå­åé\n\nå½æºå¨åå­å°äº 64G æ¶ï¼éµå¾ªéç¨çååï¼50% ç» ESï¼50% çç» luceneã\n\nå½æºå¨åå­å¤§äº 64G æ¶ï¼éµå¾ªä»¥ä¸ååï¼\n\n * å¦æä¸»è¦çä½¿ç¨åºæ¯æ¯å¨ææ£ç´¢ï¼é£ä¹å»ºè®®ç» ES Heap åé 4~32G çåå­å³å¯ï¼å¶å®åå­çç»æä½ç³»ç»ï¼ä¾ lucene ä½¿ç¨ï¼segments cacheï¼ï¼ä»¥æä¾æ´å¿«çæ¥è¯¢æ§è½ã\n * å¦æä¸»è¦çä½¿ç¨åºæ¯æ¯èåææåºï¼å¹¶ä¸å¤§å¤æ°æ¯ numericsï¼datesï¼geo_points ä»¥å not_analyzed çå­ç¬¦ç±»åï¼å»ºè®®åéç» ES Heap åé 4~32G çåå­å³å¯ï¼å¶å®åå­çç»æä½ç³»ç»ï¼ä¾ lucene ä½¿ç¨ï¼æä¾å¿«éçåºäºææ¡£çèç±»ãæåºæ§è½ã\n * å¦æä½¿ç¨åºæ¯æ¯èåææåºï¼å¹¶ä¸é½æ¯åºäº analyzed å­ç¬¦æ°æ®ï¼è¿æ¶éè¦æ´å¤ç heap sizeï¼å»ºè®®æºå¨ä¸è¿è¡å¤ ES å®ä¾ï¼æ¯ä¸ªå®ä¾ä¿æä¸è¶è¿ 50% ç ES heap è®¾ç½®ï¼ä½ä¸è¶è¿ 32 Gï¼å åå­è®¾ç½® 32 G ä»¥ä¸æ¶ï¼JVM ä½¿ç¨å¯¹è±¡ææ åç¼©æå·§èçç©ºé´ï¼ï¼50% ä»¥ä¸çç» luceneã\n\n# ç¦æ­¢ swap\n\nç¦æ­¢ swapï¼ä¸æ¦åè®¸åå­ä¸ç£ççäº¤æ¢ï¼ä¼å¼èµ·è´å½çæ§è½é®é¢ãå¯ä»¥éè¿å¨ elasticsearch.yml ä¸­ bootstrap.memory_lock: trueï¼ä»¥ä¿æ JVM éå®åå­ï¼ä¿è¯ ES çæ§è½ã\n\n# GC è®¾ç½®\n\nä¿æ GC çç°æè®¾ç½®ï¼é»è®¤è®¾ç½®ä¸ºï¼Concurrent-Mark and Sweepï¼CMSï¼ï¼å«æ¢æ G1 GCï¼å ä¸ºç®å G1 è¿æå¾å¤ BUGã\n\nä¿æçº¿ç¨æ± çç°æè®¾ç½®ï¼ç®å ES ççº¿ç¨æ± è¾ 1.X æäºè¾å¤ä¼åè®¾ç½®ï¼ä¿æç°ç¶å³å¯ï¼é»è®¤çº¿ç¨æ± å¤§å°ç­äº CPU æ ¸å¿æ°ãå¦æä¸å®è¦æ¹ï¼æå¬å¼ ( ( CPU æ ¸å¿æ° * 3 ) / 2 ) + 1 è®¾ç½®ï¼ä¸è½è¶è¿ CPU æ ¸å¿æ°ç 2 åï¼ä½æ¯ä¸å»ºè®®ä¿®æ¹é»è®¤éç½®ï¼å¦åä¼å¯¹ CPU é æç¡¬ä¼¤ã\n\n\n# ç£ç\n\nç¡¬çå¯¹ææçéç¾¤é½å¾éè¦ï¼å¯¹å¤§éåå¥çéç¾¤æ´æ¯å åéè¦ï¼ä¾å¦é£äºå­å¨æ¥å¿æ°æ®çï¼ãç¡¬çæ¯æå¡å¨ä¸ææ¢çå­ç³»ç»ï¼è¿æå³çé£äºåå¥éå¾å¤§çéç¾¤å¾å®¹æè®©ç¡¬çé¥±åï¼ä½¿å¾å®æä¸ºéç¾¤çç¶é¢ã\n\nå¨ç»æµååè½æ¿åçèå´ä¸ï¼å°½éä½¿ç¨åºæç¡¬çï¼SSDï¼ãåºæç¡¬çç¸æ¯äºä»»ä½æè½¬ä»è´¨ï¼æºæ¢°ç¡¬çï¼ç£å¸¦ç­ï¼ï¼æ è®ºéæºåè¿æ¯é¡ºåºåï¼é½ä¼å¯¹ IO æè¾å¤§çæåã\n\n> å¦æä½ æ­£å¨ä½¿ç¨ SSDsï¼ç¡®ä¿ä½ çç³»ç» I/O è°åº¦ç¨åºæ¯éç½®æ­£ç¡®çãå½ä½ åç¡¬çåæ°æ®ï¼I/O è°åº¦ç¨åºå³å®ä½æ¶ææ°æ®å®éåéå°ç¡¬çãå¤§å¤æ°é»è®¤ *nix åè¡çä¸çè°åº¦ç¨åºé½å«å cfqï¼å®å¨å¬å¹³éåï¼ã\n> \n> è°åº¦ç¨åºåéæ¶é´çå°æ¯ä¸ªè¿ç¨ãå¹¶ä¸ä¼åè¿äºå°ç¡¬ççä¼å¤éåçä¼ éãä½å®æ¯ä¸ºæè½¬ä»è´¨ä¼åçï¼æºæ¢°ç¡¬ççåºæç¹æ§æå³çå®åå¥æ°æ®å°åºäºç©çå¸å±çç¡¬çä¼æ´é«æã\n> \n> è¿å¯¹ SSD æ¥è¯´æ¯ä½æçï¼å°½ç®¡è¿éæ²¡ææ¶åå°æºæ¢°ç¡¬çãä½æ¯ï¼deadline æè noop åºè¯¥è¢«ä½¿ç¨ãdeadline è°åº¦ç¨åºåºäºåå¥ç­å¾æ¶é´è¿è¡ä¼åï¼noop åªæ¯ä¸ä¸ªç®åç FIFO éåã\n> \n> è¿ä¸ªç®åçæ´æ¹å¯ä»¥å¸¦æ¥æ¾èçå½±åãä»ä»æ¯ä½¿ç¨æ­£ç¡®çè°åº¦ç¨åºï¼æä»¬çå°äº 500 åçåå¥è½åæåã\n\nå¦æä½ ä½¿ç¨æè½¬ä»è´¨ï¼å¦æºæ¢°ç¡¬çï¼ï¼å°è¯è·åå°½å¯è½å¿«çç¡¬çï¼é«æ§è½æå¡å¨ç¡¬çï¼15k RPM é©±å¨å¨ï¼ã\n\nä½¿ç¨ RAID0 æ¯æé«ç¡¬çéåº¦çææéå¾ï¼å¯¹æºæ¢°ç¡¬çå SSD æ¥è¯´é½æ¯å¦æ­¤ãæ²¡æå¿è¦ä½¿ç¨éåæå¶å® RAID åä½ï¼å ä¸º Elasticsearch å¨èªèº«å±é¢éè¿å¯æ¬ï¼å·²ç»æä¾äºå¤ä»½çåè½ï¼æä»¥ä¸éè¦å©ç¨ç£ççå¤ä»½åè½ï¼åæ¶å¦æä½¿ç¨ç£çå¤ä»½åè½çè¯ï¼å¯¹åå¥éåº¦æè¾å¤§çå½±åã\n\næåï¼é¿åä½¿ç¨ç½ç»éå å­å¨ï¼NASï¼ãäººä»¬å¸¸å£°ç§°ä»ä»¬ç NAS è§£å³æ¹æ¡æ¯æ¬å°é©±å¨å¨æ´å¿«æ´å¯é ãé¤å´è¿äºå£°ç§°ï¼æä»¬ä»æ²¡çå° NAS è½éå¾ä¸å®çå¤§èå®£ä¼ ãNAS å¸¸å¸¸å¾æ¢ï¼æ¾é²åºæ´å¤§çå»¶æ¶åæ´å®½çå¹³åå»¶æ¶æ¹å·®ï¼èä¸å®æ¯åç¹æéçã\n\n\n# ç´¢å¼ä¼åè®¾ç½®\n\nç´¢å¼ä¼åä¸»è¦æ¯å¨ Elasticsearch çæå¥å±é¢ä¼åï¼Elasticsearch æ¬èº«ç´¢å¼éåº¦å¶å®è¿æ¯è®å¿«çï¼å·ä½æ°æ®ï¼æä»¬å¯ä»¥åèå®æ¹ç benchmark æ°æ®ãæä»¬å¯ä»¥æ ¹æ®ä¸åçéæ±ï¼éå¯¹ç´¢å¼ä¼åã\n\n\n# æ¹éæäº¤\n\nå½æå¤§éæ°æ®æäº¤çæ¶åï¼å»ºè®®éç¨æ¹éæäº¤ï¼Bulk æä½ï¼ï¼æ­¤å¤ä½¿ç¨ bulk è¯·æ±æ¶ï¼æ¯ä¸ªè¯·æ±ä¸è¶è¿å å Mï¼å ä¸ºå¤ªå¤§ä¼å¯¼è´åå­ä½¿ç¨è¿å¤§ã\n\næ¯å¦å¨å ELK è¿ç¨ä¸­ï¼Logstash indexer æäº¤æ°æ®å° Elasticsearch ä¸­ï¼batch size å°±å¯ä»¥ä½ä¸ºä¸ä¸ªä¼ååè½ç¹ãä½æ¯ä¼å size å¤§å°éè¦æ ¹æ®ææ¡£å¤§å°åæå¡å¨æ§è½èå®ã\n\nå Logstash ä¸­æäº¤ææ¡£å¤§å°è¶è¿ 20MBï¼Logstash ä¼å°ä¸ä¸ªæ¹éè¯·æ±ååä¸ºå¤ä¸ªæ¹éè¯·æ±ã\n\nå¦æå¨æäº¤è¿ç¨ä¸­ï¼éå° EsRejectedExecutionException å¼å¸¸çè¯ï¼åè¯´æéç¾¤çç´¢å¼æ§è½å·²ç»è¾¾å°æéäºãè¿ç§æåµï¼è¦ä¹æé«æå¡å¨éç¾¤çèµæºï¼è¦ä¹æ ¹æ®ä¸å¡è§åï¼åå°æ°æ®æ¶ééåº¦ï¼æ¯å¦åªæ¶é WarnãError çº§å«ä»¥ä¸çæ¥å¿ã\n\n\n# å¢å  Refresh æ¶é´é´é\n\nä¸ºäºæé«ç´¢å¼æ§è½ï¼Elasticsearch å¨åå¥æ°æ®çæ¶åï¼éç¨å»¶è¿åå¥çç­ç¥ï¼å³æ°æ®ååå°åå­ä¸­ï¼å½è¶è¿é»è®¤ 1 ç§ï¼index.refresh_intervalï¼ä¼è¿è¡ä¸æ¬¡åå¥æä½ï¼å°±æ¯å°åå­ä¸­ segment æ°æ®å·æ°å°ç£çä¸­ï¼æ­¤æ¶æä»¬æè½å°æ°æ®æç´¢åºæ¥ï¼æä»¥è¿å°±æ¯ä¸ºä»ä¹ Elasticsearch æä¾çæ¯è¿å®æ¶æç´¢åè½ï¼èä¸æ¯å®æ¶æç´¢åè½ã\n\nå¦ææä»¬çç³»ç»å¯¹æ°æ®å»¶è¿è¦æ±ä¸é«çè¯ï¼æä»¬å¯ä»¥éè¿å»¶é¿ refresh æ¶é´é´éï¼å¯ä»¥ææå°åå° segment åå¹¶ååï¼æé«ç´¢å¼éåº¦ãæ¯å¦å¨åå¨é¾è·¯è·è¸ªçè¿ç¨ä¸­ï¼æä»¬å°±å° index.refresh_interval è®¾ç½®ä¸º 30sï¼åå° refresh æ¬¡æ°ãåå¦ï¼å¨è¿è¡å¨éç´¢å¼æ¶ï¼å¯ä»¥å° refresh æ¬¡æ°ä¸´æ¶å³é­ï¼å³ index.refresh_interval è®¾ç½®ä¸º-1ï¼æ°æ®å¯¼å¥æåååæå¼å°æ­£å¸¸æ¨¡å¼ï¼æ¯å¦ 30sã\n\n> å¨å è½½å¤§éæ°æ®æ¶åå¯ä»¥ææ¶ä¸ç¨ refresh å repliccasï¼index.refresh_interval è®¾ç½®ä¸º-1ï¼index.number_of_replicas è®¾ç½®ä¸º 0ã\n\n\n# ä¿®æ¹ index_buffer_size çè®¾ç½®\n\nç´¢å¼ç¼å²çè®¾ç½®å¯ä»¥æ§å¶å¤å°åå­åéç»ç´¢å¼è¿ç¨ãè¿æ¯ä¸ä¸ªå¨å±éç½®ï¼ä¼åºç¨äºä¸ä¸ªèç¹ä¸ææä¸åçåçä¸ã\n\nindices.memory.index_buffer_size: 10%\nindices.memory.min_index_buffer_size: 48mb\n\n\nindices.memory.index_buffer_size æ¥åä¸ä¸ªç¾åæ¯æèä¸ä¸ªè¡¨ç¤ºå­èå¤§å°çå¼ãé»è®¤æ¯ 10%ï¼æå³çåéç»èç¹çæ»åå­ç 10%ç¨æ¥åç´¢å¼ç¼å²çå¤§å°ãè¿ä¸ªæ°å¼è¢«åå°ä¸åçåçï¼shardsï¼ä¸ãå¦æè®¾ç½®çæ¯ç¾åæ¯ï¼è¿å¯ä»¥è®¾ç½® min_index_buffer_size ï¼é»è®¤ 48mbï¼å max_index_buffer_sizeï¼é»è®¤æ²¡æä¸éï¼ã\n\n\n# ä¿®æ¹ translog ç¸å³çè®¾ç½®\n\nä¸æ¯æ§å¶æ°æ®ä»åå­å°ç¡¬ççæä½é¢çï¼ä»¥åå°ç¡¬ç IOãå¯å° sync_interval çæ¶é´è®¾ç½®å¤§ä¸äºãé»è®¤ä¸º 5sã\n\nindex.translog.sync_interval: 5s\n\n\nä¹å¯ä»¥æ§å¶ tranlog æ°æ®åçå¤§å°ï¼è¾¾å° threshold å¤§å°æ¶ï¼æä¼ flush å° lucene ç´¢å¼æä»¶ãé»è®¤ä¸º 512mã\n\nindex.translog.flush_threshold_size: 512mb\n\n\n\n# æ³¨æ _id å­æ®µçä½¿ç¨\n\n_id å­æ®µçä½¿ç¨ï¼åºå°½å¯è½é¿åèªå®ä¹ _idï¼ä»¥é¿åéå¯¹ ID ççæ¬ç®¡çï¼å»ºè®®ä½¿ç¨ ES çé»è®¤ ID çæç­ç¥æä½¿ç¨æ°å­ç±»å ID åä¸ºä¸»é®ã\n\n\n# æ³¨æ _all å­æ®µå _source å­æ®µçä½¿ç¨\n\n**_**all å­æ®µå _source å­æ®µçä½¿ç¨ï¼åºè¯¥æ³¨æåºæ¯åéè¦ï¼_all å­æ®µåå«äºææçç´¢å¼å­æ®µï¼æ¹ä¾¿åå¨ææ£ç´¢ï¼å¦ææ æ­¤éæ±ï¼å¯ä»¥ç¦ç¨ï¼_source å­å¨äºåå§ç document åå®¹ï¼å¦ææ²¡æè·ååå§ææ¡£æ°æ®çéæ±ï¼å¯éè¿è®¾ç½® includesãexcludes å±æ§æ¥å®ä¹æ¾å¥ _source çå­æ®µã\n\n\n# åççéç½®ä½¿ç¨ index å±æ§\n\nåççéç½®ä½¿ç¨ index å±æ§ï¼analyzed å not_analyzedï¼æ ¹æ®ä¸å¡éæ±æ¥æ§å¶å­æ®µæ¯å¦åè¯æä¸åè¯ãåªæ groupby éæ±çå­æ®µï¼éç½®æ¶å°±è®¾ç½®æ not_analyzedï¼ä»¥æé«æ¥è¯¢æèç±»çæçã\n\n\n# åå°å¯æ¬æ°é\n\nElasticsearch é»è®¤å¯æ¬æ°éä¸º 3 ä¸ªï¼è½ç¶è¿æ ·ä¼æé«éç¾¤çå¯ç¨æ§ï¼å¢å æç´¢çå¹¶åæ°ï¼ä½æ¯åæ¶ä¹ä¼å½±ååå¥ç´¢å¼çæçã\n\nå¨ç´¢å¼è¿ç¨ä¸­ï¼éè¦ææ´æ°çææ¡£åå°å¯æ¬èç¹ä¸ï¼ç­å¯æ¬èç¹çæåå¨è¿è¡è¿åç»æãä½¿ç¨ Elasticsearch åä¸å¡æç´¢çæ¶åï¼å»ºè®®å¯æ¬æ°ç®è¿æ¯è®¾ç½®ä¸º 3 ä¸ªï¼ä½æ¯ååé¨ ELK æ¥å¿ç³»ç»ãåå¸å¼è·è¸ªç³»ç»ä¸­ï¼å®å¨å¯ä»¥å°å¯æ¬æ°ç®è®¾ç½®ä¸º 1 ä¸ªã\n\n\n# æ¥è¯¢æ¹é¢ä¼å\n\nElasticsearch ä½ä¸ºä¸å¡æç´¢çè¿å®æ¶æ¥è¯¢æ¶ï¼æ¥è¯¢æççä¼åæ¾å¾å°¤ä¸ºéè¦ã\n\n\n# è·¯ç±ä¼å\n\nå½æä»¬æ¥è¯¢ææ¡£çæ¶åï¼Elasticsearch å¦ä½ç¥éä¸ä¸ªææ¡£åºè¯¥å­æ¾å°åªä¸ªåçä¸­å¢ï¼å®å¶å®æ¯éè¿ä¸é¢è¿ä¸ªå¬å¼æ¥è®¡ç®åºæ¥çã\n\nshard = hash(routing) % number_of_primary_shards\n\n\nrouting é»è®¤å¼æ¯ææ¡£ç idï¼ä¹å¯ä»¥éç¨èªå®ä¹å¼ï¼æ¯å¦ç¨æ· IDã\n\n# ä¸å¸¦ routing æ¥è¯¢\n\nå¨æ¥è¯¢çæ¶åå ä¸ºä¸ç¥éè¦æ¥è¯¢çæ°æ®å·ä½å¨åªä¸ªåçä¸ï¼æä»¥æ´ä¸ªè¿ç¨åä¸º 2 ä¸ªæ­¥éª¤ï¼\n\n 1. ååï¼è¯·æ±å°è¾¾åè°èç¹åï¼åè°èç¹å°æ¥è¯¢è¯·æ±ååå°æ¯ä¸ªåçä¸ã\n 2. èåï¼åè°èç¹æéå°æ¯ä¸ªåçä¸æ¥è¯¢ç»æï¼åå°æ¥è¯¢çç»æè¿è¡æåºï¼ä¹åç»ç¨æ·è¿åç»æã\n\n# å¸¦ routing æ¥è¯¢\n\næ¥è¯¢çæ¶åï¼å¯ä»¥ç´æ¥æ ¹æ® routing ä¿¡æ¯å®ä½å°æä¸ªåéæ¥è¯¢ï¼ä¸éè¦æ¥è¯¢ææçåéï¼ç»è¿åè°èç¹æåºã\n\nåä¸é¢èªå®ä¹çç¨æ·æ¥è¯¢ï¼å¦æ routing è®¾ç½®ä¸º userid çè¯ï¼å°±å¯ä»¥ç´æ¥æ¥è¯¢åºæ°æ®æ¥ï¼æçæåå¾å¤ã\n\n\n# Filter VS Query\n\nå°½å¯è½ä½¿ç¨è¿æ»¤å¨ä¸ä¸æï¼Filterï¼æ¿ä»£æ¥è¯¢ä¸ä¸æï¼Queryï¼\n\n * Queryï¼æ­¤ææ¡£ä¸æ­¤æ¥è¯¢å­å¥çå¹éç¨åº¦å¦ä½ï¼\n * Filterï¼æ­¤ææ¡£åæ¥è¯¢å­å¥å¹éåï¼\n\nElasticsearch éå¯¹ Filter æ¥è¯¢åªéè¦åç­ãæ¯ãæèãå¦ãï¼ä¸éè¦å Query æ¥è¯¢ä¸æ ·è®¡ç®ç¸å³æ§åæ°ï¼åæ¶ Filter ç»æå¯ä»¥ç¼å­ã\n\n\n# æ·±åº¦ç¿»é¡µ\n\nå¨ä½¿ç¨ Elasticsearch è¿ç¨ä¸­ï¼åºå°½éé¿åå¤§ç¿»é¡µçåºç°ã\n\næ­£å¸¸ç¿»é¡µæ¥è¯¢é½æ¯ä» from å¼å§ size æ¡æ°æ®ï¼è¿æ ·å°±éè¦å¨æ¯ä¸ªåçä¸­æ¥è¯¢æåæåå¨åé¢ç from+size æ¡æ°æ®ãååèç¹æ¶éæ¯ä¸ªåéçå from+size æ¡æ°æ®ãååèç¹ä¸å±ä¼åå° N*(from+size) æ¡æ°æ®ï¼ç¶åè¿è¡æåºï¼åå°å¶ä¸­ from å° from+size æ¡æ°æ®è¿ååºå»ãå¦æ from æè size å¾å¤§çè¯ï¼å¯¼è´åå æåºçæ°éä¼åæ­¥æ©å¤§å¾å¤ï¼æç»ä¼å¯¼è´ CPU èµæºæ¶èå¢å¤§ã\n\nå¯ä»¥éè¿ä½¿ç¨ Elasticsearch scroll å scroll-scan é«ææ»å¨çæ¹å¼æ¥è§£å³è¿æ ·çé®é¢ã\n\nä¹å¯ä»¥ç»åå®éä¸å¡ç¹ç¹ï¼ææ¡£ id å¤§å°å¦æåææ¡£åå»ºæ¶é´æ¯ä¸è´æåºçï¼å¯ä»¥ä»¥ææ¡£ id ä½ä¸ºåé¡µçåç§»éï¼å¹¶å°å¶ä½ä¸ºåé¡µæ¥è¯¢çä¸ä¸ªæ¡ä»¶ã\n\n\n# èæ¬ï¼scriptï¼åçä½¿ç¨\n\næä»¬ç¥éèæ¬ä½¿ç¨ä¸»è¦æ 3 ç§å½¢å¼ï¼åèå¨æç¼è¯æ¹å¼ã_script ç´¢å¼åºä¸­å­å¨åæä»¶èæ¬å­å¨çå½¢å¼ï¼ä¸è¬èæ¬çä½¿ç¨åºæ¯æ¯ç²æï¼å°½éç¨ç¬¬äºç§æ¹å¼åå°èæ¬å­å¨å¨ _script ç´¢å¼åºä¸­ï¼èµ·å°æåç¼è¯ï¼ç¶åéè¿å¼ç¨èæ¬ idï¼å¹¶ç»å params åæ°ä½¿ç¨ï¼å³å¯ä»¥è¾¾å°æ¨¡åï¼é»è¾ï¼åæ°æ®è¿è¡äºåç¦»ï¼åæ¶åä¾¿äºèæ¬æ¨¡åçæ©å±ä¸ç»´æ¤ãå·ä½ ES èæ¬çæ·±å¥åå®¹è¯·åè Elasticsearch èæ¬æ¨¡åçè¯¦è§£ã\n\n\n# æ°æ®ç»æä¼å\n\nåºäº Elasticsearch çä½¿ç¨åºæ¯ï¼ææ¡£æ°æ®ç»æå°½éåä½¿ç¨åºæ¯è¿è¡ç»åï¼å»ææ²¡ç¨åä¸åççæ°æ®ã\n\n\n# å°½éåå°ä¸éè¦çå­æ®µ\n\nå¦æ Elasticsearch ç¨äºä¸å¡æç´¢æå¡ï¼ä¸äºä¸éè¦ç¨äºæç´¢çå­æ®µæå¥½ä¸å­å° ES ä¸­ï¼è¿æ ·å³èçç©ºé´ï¼åæ¶å¨ç¸åçæ°æ®éä¸ï¼ä¹è½æé«æç´¢æ§è½ã\n\né¿åä½¿ç¨å¨æå¼ä½å­æ®µï¼å¨æéå¢ç mappingï¼ä¼å¯¼è´éç¾¤å´©æºï¼åæ ·ï¼ä¹éè¦æ§å¶å­æ®µçæ°éï¼ä¸å¡ä¸­ä¸ä½¿ç¨çå­æ®µï¼å°±ä¸è¦ç´¢å¼ãæ§å¶ç´¢å¼çå­æ®µæ°éãmapping æ·±åº¦ãç´¢å¼å­æ®µçç±»åï¼å¯¹äº ES çæ§è½ä¼åæ¯éä¸­ä¹éã\n\nä»¥ä¸æ¯ ES å³äºå­æ®µæ°ãmapping æ·±åº¦çä¸äºé»è®¤è®¾ç½®ï¼\n\nindex.mapping.nested_objects.limit: 10000\nindex.mapping.total_fields.limit: 1000\nindex.mapping.depth.limit: 20\n\n\n\n# Nested Object vs Parent/Child\n\nå°½éé¿åä½¿ç¨ nested æ parent/child çå­æ®µï¼è½ä¸ç¨å°±ä¸ç¨ï¼nested query æ¢ï¼parent/child query æ´æ¢ï¼æ¯ nested query æ¢ä¸ç¾åï¼å æ­¤è½å¨ mapping è®¾è®¡é¶æ®µæå®çï¼å¤§å®½è¡¨è®¾è®¡æéç¨æ¯è¾ smart çæ°æ®ç»æï¼ï¼å°±ä¸è¦ç¨ç¶å­å³ç³»ç mappingã\n\nå¦æä¸å®è¦ä½¿ç¨ nested fieldsï¼ä¿è¯ nested fields å­æ®µä¸è½è¿å¤ï¼ç®å ES é»è®¤éå¶æ¯ 50ãå ä¸ºéå¯¹ 1 ä¸ª documentï¼æ¯ä¸ä¸ª nested fieldï¼é½ä¼çæä¸ä¸ªç¬ç«ç documentï¼è¿å°ä½¿ doc æ°éå§å¢ï¼å½±åæ¥è¯¢æçï¼å°¤å¶æ¯ JOIN çæçã\n\nindex.mapping.nested_fields.limit: 50\n\n\nå¯¹æ¯   NESTED OBJECT        PARENT/CHILD\nä¼ç¹   ææ¡£å­å¨å¨ä¸èµ·ï¼å æ­¤è¯»åæ§é«       ç¶å­ææ¡£å¯ä»¥ç¬ç«æ´æ°ï¼äºä¸å½±å\nç¼ºç¹   æ´æ°ç¶ææ¡£æå­ææ¡£æ¶éè¦æ´æ°æ´ä¸ªææ¡£   ä¸ºäºç»´æ¤ join å³ç³»ï¼éè¦å ç¨é¨ååå­ï¼è¯»åæ§è½è¾å·®\nåºæ¯   å­ææ¡£å¶å°æ´æ°ï¼æ¥è¯¢é¢ç¹         å­ææ¡£æ´æ°é¢ç¹\n\n\n# éæ©éææ å°ï¼éå¿éæ¶ï¼ç¦æ­¢å¨ææ å°\n\nå°½éé¿åä½¿ç¨å¨ææ å°ï¼è¿æ ·æå¯è½ä¼å¯¼è´éç¾¤å´©æºï¼æ­¤å¤ï¼å¨ææ å°æå¯è½ä¼å¸¦æ¥ä¸å¯æ§å¶çæ°æ®ç±»åï¼è¿èæå¯è½å¯¼è´å¨æ¥è¯¢ç«¯åºç°ç¸å³å¼å¸¸ï¼å½±åä¸å¡ã\n\næ­¤å¤ï¼Elasticsearch ä½ä¸ºæç´¢å¼ææ¶ï¼ä¸»è¦æ¿è½½ query çå¹éåæåºçåè½ï¼é£æ°æ®çå­å¨ç±»ååºäºè¿ä¸¤ç§åè½çç¨éåä¸ºä¸¤ç±»ï¼ä¸æ¯éè¦å¹éçå­æ®µï¼ç¨æ¥å»ºç«åæç´¢å¼å¯¹ query å¹éç¨ï¼å¦ä¸ç±»å­æ®µæ¯ç¨åç²æç¨å°çç¹å¾å­æ®µï¼å¦ ctrãç¹å»æ°ãè¯è®ºæ°ç­ç­ã\n\n\n# éç¾¤æ¶æè®¾è®¡\n\nåççé¨ç½² Elasticsearch æå©äºæé«æå¡çæ´ä½å¯ç¨æ§ã\n\n\n# ä¸»èç¹ãæ°æ®èç¹ååè°èç¹åç¦»\n\nElasticsearch éç¾¤å¨æ¶æææ´æ¶ï¼éç¨ä¸»èç¹ãæ°æ®èç¹åè´è½½åè¡¡èç¹åç¦»çæ¶æï¼å¨ 5.x çæ¬ä»¥åï¼åå¯å°æ°æ®èç¹åç»åä¸ºâHot-Warmâçæ¶ææ¨¡å¼ã\n\nElasticsearch çéç½®æä»¶ä¸­æ 2 ä¸ªåæ°ï¼node.master å node.dataãè¿ä¸¤ä¸ªåæ°æ­éä½¿ç¨æ¶ï¼è½å¤å¸®å©æä¾æå¡å¨æ§è½ã\n\n# ä¸»ï¼masterï¼èç¹\n\néç½® node.master:true å node.data:falseï¼è¯¥ node æå¡å¨åªä½ä¸ºä¸ä¸ªä¸»èç¹ï¼ä½ä¸å­å¨ä»»ä½ç´¢å¼æ°æ®ãæä»¬æ¨èæ¯ä¸ªéç¾¤è¿è¡ 3 ä¸ªä¸ç¨ç master èç¹æ¥æä¾æå¥½çå¼¹æ§ãä½¿ç¨æ¶ï¼ä½ è¿éè¦å° discovery.zen.minimum_master_nodes setting åæ°è®¾ç½®ä¸º 2ï¼ä»¥ååºç°èè£ï¼split-brainï¼çæåµãç¨ 3 ä¸ªä¸ç¨ç master èç¹ï¼ä¸é¨è´è´£å¤çéç¾¤çç®¡çä»¥åå å¼ºç¶æçæ´ä½ç¨³å®æ§ãå ä¸ºè¿ 3 ä¸ª master èç¹ä¸åå«æ°æ®ä¹ä¸ä¼å®éåä¸æç´¢ä»¥åç´¢å¼æä½ï¼å¨ JVM ä¸å®ä»¬ä¸ç¨åç¸åçäºï¼ä¾å¦ç¹éçç´¢å¼æèèæ¶ï¼èµæºèè´¹å¾å¤§çæç´¢ãå æ­¤ä¸å¤ªå¯è½ä¼å ä¸ºåå¾åæ¶èå¯¼è´åé¡¿ãå æ­¤ï¼master èç¹ç CPUï¼åå­ä»¥åç£çéç½®å¯ä»¥æ¯ data èç¹å°å¾å¤çã\n\n# æ°æ®ï¼dataï¼èç¹\n\néç½® node.master:false å node.data:trueï¼è¯¥ node æå¡å¨åªä½ä¸ºä¸ä¸ªæ°æ®èç¹ï¼åªç¨äºå­å¨ç´¢å¼æ°æ®ï¼ä½¿è¯¥ node æå¡å¨åè½åä¸ï¼åªç¨äºæ°æ®å­å¨åæ°æ®æ¥è¯¢ï¼éä½å¶èµæºæ¶èçã\n\nå¨ Elasticsearch 5.x çæ¬ä¹åï¼data èç¹åå¯åç»åä¸ºâHot-Warmâæ¶æï¼å³åä¸ºç­èç¹ï¼hot nodeï¼åæèç¹ï¼warm nodeï¼ã\n\nhot èç¹ï¼\n\nhot èç¹ä¸»è¦æ¯ç´¢å¼èç¹ï¼åèç¹ï¼ï¼åæ¶ä¼ä¿å­è¿æçä¸äºé¢ç¹è¢«æ¥è¯¢çç´¢å¼ãç±äºè¿è¡ç´¢å¼éå¸¸èè´¹ CPU å IOï¼å³å±äº IO å CPU å¯éåæä½ï¼å»ºè®®ä½¿ç¨ SSD çç£çç±»åï¼ä¿æè¯å¥½çåæ§è½ï¼æä»¬æ¨èé¨ç½²æå°åç 3 ä¸ª hot èç¹æ¥ä¿è¯é«å¯ç¨æ§ãæ ¹æ®è¿æéè¦æ¶éä»¥åæ¥è¯¢çæ°æ®éï¼å¯ä»¥å¢å æå¡å¨æ°éæ¥è·å¾æ³è¦çæ§è½ã\n\nå°èç¹è®¾ç½®ä¸º hot ç±»åéè¦ elasticsearch.yml å¦ä¸éç½®ï¼\n\nnode.attr.box_type: hot\n\n\nå¦ææ¯éå¯¹æå®ç index æä½ï¼å¯ä»¥éè¿ settings è®¾ç½® index.routing.allocation.require.box_type: hot å°ç´¢å¼åå¥ hot èç¹ã\n\nwarm èç¹ï¼\n\nè¿ç§ç±»åçèç¹æ¯ä¸ºäºå¤çå¤§éçï¼èä¸ä¸ç»å¸¸è®¿é®çåªè¯»ç´¢å¼èè®¾è®¡çãç±äºè¿äºç´¢å¼æ¯åªè¯»çï¼warm èç¹å¾åäºæè½½å¤§éç£çï¼æ®éç£çï¼æ¥æ¿ä»£ SSDãåå­ãCPU çéç½®è· hot èç¹ä¿æä¸è´å³å¯ï¼èç¹æ°éä¸è¬ä¹æ¯å¤§äºç­äº 3 ä¸ªã\n\nå°èç¹è®¾ç½®ä¸º warm ç±»åéè¦ elasticsearch.yml å¦ä¸éç½®ï¼\n\nnode.attr.box_type: warm\n\n\nåæ¶ï¼ä¹å¯ä»¥å¨ elasticsearch.yml ä¸­è®¾ç½® index.codec:best_compression ä¿è¯ warm èç¹çåç¼©éç½®ã\n\nå½ç´¢å¼ä¸åè¢«é¢ç¹æ¥è¯¢æ¶ï¼å¯éè¿ index.routing.allocation.require.box_type:warmï¼å°ç´¢å¼æ è®°ä¸º warmï¼ä»èä¿è¯ç´¢å¼ä¸åå¥ hot èç¹ï¼ä»¥ä¾¿å° SSD ç£çèµæºç¨å¨ååä¸ãä¸æ¦è®¾ç½®è¿ä¸ªå±æ§ï¼ES ä¼èªå¨å°ç´¢å¼åå¹¶å° warm èç¹ã\n\n# åè°ï¼coordinatingï¼èç¹\n\nåè°èç¹ç¨äºååå¸å¼éçåè°ï¼å°ååçæèç¹è¿åçæ°æ®æ´ååè¿åãè¯¥èç¹ä¸ä¼è¢«éä½ä¸»èç¹ï¼ä¹ä¸ä¼å­å¨ä»»ä½ç´¢å¼æ°æ®ãè¯¥æå¡å¨ä¸»è¦ç¨äºæ¥è¯¢è´è½½åè¡¡ãå¨æ¥è¯¢çæ¶åï¼éå¸¸ä¼æ¶åå°ä»å¤ä¸ª node æå¡å¨ä¸æ¥è¯¢æ°æ®ï¼å¹¶å°è¯·æ±ååå°å¤ä¸ªæå®ç node æå¡å¨ï¼å¹¶å¯¹åä¸ª node æå¡å¨è¿åçç»æè¿è¡ä¸ä¸ªæ±æ»å¤çï¼æç»è¿åç»å®¢æ·ç«¯ãå¨ ES éç¾¤ä¸­ï¼ææçèç¹é½æå¯è½æ¯åè°èç¹ï¼ä½æ¯ï¼å¯ä»¥éè¿è®¾ç½® node.masterãnode.dataãnode.ingest é½ä¸º false æ¥è®¾ç½®ä¸é¨çåè°èç¹ãéè¦è¾å¥½ç CPU åè¾é«çåå­ã\n\n * node.master:false å node.data:trueï¼è¯¥ node æå¡å¨åªä½ä¸ºä¸ä¸ªæ°æ®èç¹ï¼åªç¨äºå­å¨ç´¢å¼æ°æ®ï¼ä½¿è¯¥ node æå¡å¨åè½åä¸ï¼åªç¨äºæ°æ®å­å¨åæ°æ®æ¥è¯¢ï¼éä½å¶èµæºæ¶èçã\n * node.master:true å node.data:falseï¼è¯¥ node æå¡å¨åªä½ä¸ºä¸ä¸ªä¸»èç¹ï¼ä½ä¸å­å¨ä»»ä½ç´¢å¼æ°æ®ï¼è¯¥ node æå¡å¨å°ä½¿ç¨èªèº«ç©ºé²çèµæºï¼æ¥åè°åç§åå»ºç´¢å¼è¯·æ±æèæ¥è¯¢è¯·æ±ï¼å¹¶å°è¿äºè¯·æ±åçååå°ç¸å³ç node æå¡å¨ä¸ã\n * node.master:false å node.data:falseï¼è¯¥ node æå¡å¨å³ä¸ä¼è¢«éä½ä¸»èç¹ï¼ä¹ä¸ä¼å­å¨ä»»ä½ç´¢å¼æ°æ®ãè¯¥æå¡å¨ä¸»è¦ç¨äºæ¥è¯¢è´è½½åè¡¡ãå¨æ¥è¯¢çæ¶åï¼éå¸¸ä¼æ¶åå°ä»å¤ä¸ª node æå¡å¨ä¸æ¥è¯¢æ°æ®ï¼å¹¶å°è¯·æ±ååå°å¤ä¸ªæå®ç node æå¡å¨ï¼å¹¶å¯¹åä¸ª node æå¡å¨è¿åçç»æè¿è¡ä¸ä¸ªæ±æ»å¤çï¼æç»è¿åç»å®¢æ·ç«¯ã\n\n\n# å³é­ data èç¹æå¡å¨ä¸­ç http åè½\n\néå¯¹ Elasticsearch éç¾¤ä¸­çæææ°æ®èç¹ï¼ä¸ç¨å¼å¯ http æå¡ãå°å¶ä¸­çéç½®åæ°è¿æ ·è®¾ç½®ï¼http.enabled:falseï¼åæ¶ä¹ä¸è¦å®è£ head, bigdesk, marvel ç­çæ§æä»¶ï¼è¿æ ·ä¿è¯ data èç¹æå¡å¨åªéå¤çåå»º/æ´æ°/å é¤/æ¥è¯¢ç´¢å¼æ°æ®ç­æä½ã\n\nhttp åè½å¯ä»¥å¨éæ°æ®èç¹æå¡å¨ä¸å¼å¯ï¼ä¸è¿°ç¸å³ççæ§æä»¶ä¹å®è£å°è¿äºæå¡å¨ä¸ï¼ç¨äºçæ§ Elasticsearch éç¾¤ç¶æç­æ°æ®ä¿¡æ¯ãè¿æ ·åä¸æ¥åºäºæ°æ®å®å¨èèï¼äºæ¥åºäºæå¡æ§è½èèã\n\n\n# ä¸å°æå¡å¨ä¸æå¥½åªé¨ç½²ä¸ä¸ª node\n\nä¸å°ç©çæå¡å¨ä¸å¯ä»¥å¯å¨å¤ä¸ª node æå¡å¨èç¹ï¼éè¿è®¾ç½®ä¸åçå¯å¨ portï¼ï¼ä½ä¸å°æå¡å¨ä¸ç CPUãåå­ãç¡¬çç­èµæºæ¯ç«æéï¼ä»æå¡å¨æ§è½èèï¼ä¸å»ºè®®ä¸å°æå¡å¨ä¸å¯å¨å¤ä¸ª node èç¹ã\n\n\n# éç¾¤åçè®¾ç½®\n\nES ä¸æ¦åå»ºå¥½ç´¢å¼åï¼å°±æ æ³è°æ´åççè®¾ç½®ï¼èå¨ ES ä¸­ï¼ä¸ä¸ªåçå®éä¸å¯¹åºä¸ä¸ª lucene ç´¢å¼ï¼è lucene ç´¢å¼çè¯»åä¼å ç¨å¾å¤çç³»ç»èµæºï¼å æ­¤ï¼åçæ°ä¸è½è®¾ç½®è¿å¤§ï¼æä»¥ï¼å¨åå»ºç´¢å¼æ¶ï¼åçéç½®åçæ°æ¯éå¸¸éè¦çãä¸è¬æ¥è¯´ï¼æä»¬éµå¾ªä¸äºååï¼\n\n 1. æ§å¶æ¯ä¸ªåçå ç¨çç¡¬çå®¹éä¸è¶è¿ ES çæå¤§ JVM çå ç©ºé´è®¾ç½®ï¼ä¸è¬è®¾ç½®ä¸è¶è¿ 32 Gï¼åèä¸é¢ç JVM åå­è®¾ç½®ååï¼ï¼å æ­¤ï¼å¦æç´¢å¼çæ»å®¹éå¨ 500 G å·¦å³ï¼é£åçå¤§å°å¨ 16 ä¸ªå·¦å³å³å¯ï¼å½ç¶ï¼æå¥½åæ¶èèåå 2ã\n 2. èèä¸ä¸ node æ°éï¼ä¸è¬ä¸ä¸ªèç¹ææ¶åå°±æ¯ä¸å°ç©çæºï¼å¦æåçæ°è¿å¤ï¼å¤§å¤§è¶è¿äºèç¹æ°ï¼å¾å¯è½ä¼å¯¼è´ä¸ä¸ªèç¹ä¸å­å¨å¤ä¸ªåçï¼ä¸æ¦è¯¥èç¹æéï¼å³ä½¿ä¿æäº 1 ä¸ªä»¥ä¸çå¯æ¬ï¼åæ ·æå¯è½ä¼å¯¼è´æ°æ®ä¸¢å¤±ï¼éç¾¤æ æ³æ¢å¤ãæä»¥ï¼ä¸è¬é½è®¾ç½®åçæ°ä¸è¶è¿èç¹æ°ç 3 åã\n\n\n# åèèµæ\n\n * Elasticsearch æç¨",normalizedContent:"# elasticsearch æ§è½ä¼å\n\nelasticsearch æ¯å½åæµè¡çä¼ä¸çº§æç´¢å¼æï¼è®¾è®¡ç¨äºäºè®¡ç®ä¸­ï¼è½å¤è¾¾å°å®æ¶æç´¢ï¼ç¨³å®ï¼å¯é ï¼å¿«éï¼å®è£ä½¿ç¨æ¹ä¾¿ãä½ä¸ºä¸ä¸ªå¼ç®±å³ç¨çäº§åï¼å¨çäº§ç¯å¢ä¸çº¿ä¹åï¼æä»¬å¶å®ä¸ä¸å®è½ç¡®ä¿å¶çæ§è½åç¨³å®æ§ãå¦ä½æ ¹æ®å®éæåµæé«æå¡çæ§è½ï¼å¶å®æå¾å¤æå·§ãè¿ç« æä»¬åäº«ä»å®æç»éªä¸­æ»ç»åºæ¥ç elasticsearch æ§è½ä¼åï¼ä¸»è¦ä»ç¡¬ä»¶éç½®ä¼åãç´¢å¼ä¼åè®¾ç½®ãæ¥è¯¢æ¹é¢ä¼åãæ°æ®ç»æä¼åãéç¾¤æ¶æä¼åç­æ¹é¢è®²è§£ã\n\n\n# ç¡¬ä»¶éç½®ä¼å\n\nåçº§ç¡¬ä»¶è®¾å¤éç½®ä¸ç´é½æ¯æé«æå¡è½åæå¿«éææçææ®µï¼å¨ç³»ç»å±é¢è½å¤å½±ååºç¨æ§è½çä¸è¬åæ¬ä¸ä¸ªå ç´ ï¼cpuãåå­å ioï¼å¯ä»¥ä»è¿ä¸æ¹é¢è¿è¡ es çæ§è½ä¼åå·¥ä½ã\n\n\n# cpu éç½®\n\nä¸è¬è¯´æ¥ï¼cpu ç¹å¿çåå æä»¥ä¸å ä¸ªï¼\n\n 1. çº¿ç¨ä¸­ææ éç©ºå¾ªç¯ãæ é»å¡ãæ­£åå¹éæèåçº¯çè®¡ç®ï¼\n 2. åçäºé¢ç¹ç gcï¼\n 3. å¤çº¿ç¨çä¸ä¸æåæ¢ï¼\n\nå¤§å¤æ° elasticsearch é¨ç½²å¾å¾å¯¹ cpu è¦æ±ä¸é«ãå æ­¤ï¼ç¸å¯¹å¶å®èµæºï¼å·ä½éç½®å¤å°ä¸ªï¼cpuï¼ä¸æ¯é£ä¹å³é®ãä½ åºè¯¥éæ©å·æå¤ä¸ªåæ ¸çç°ä»£å¤çå¨ï¼å¸¸è§çéç¾¤ä½¿ç¨ 2 å° 8 ä¸ªæ ¸çæºå¨ãå¦æä½ è¦å¨æ´å¿«ç cpus åæ´å¤çæ ¸æ°ä¹é´éæ©ï¼éæ©æ´å¤çæ ¸æ°æ´å¥½ãå¤ä¸ªåæ ¸æä¾çé¢å¤å¹¶åè¿èè¿ç¨å¾®å¿«ä¸ç¹ç¹çæ¶éé¢çã\n\n\n# åå­éç½®\n\nå¦ææä¸ç§èµæºæ¯æåè¢«èå°½çï¼å®å¯è½æ¯åå­ãæåºåèåé½å¾èåå­ï¼æä»¥æè¶³å¤çå ç©ºé´æ¥åºä»å®ä»¬æ¯å¾éè¦çãå³ä½¿å ç©ºé´æ¯æ¯è¾å°çæ¶åï¼ä¹è½ä¸ºæä½ç³»ç»æä»¶ç¼å­æä¾é¢å¤çåå­ãå ä¸º lucene ä½¿ç¨çè®¸å¤æ°æ®ç»ææ¯åºäºç£ççæ ¼å¼ï¼elasticsearch å©ç¨æä½ç³»ç»ç¼å­è½äº§çå¾å¤§ææã\n\n64 gb åå­çæºå¨æ¯éå¸¸çæ³çï¼ä½æ¯ 32 gb å 16 gb æºå¨ä¹æ¯å¾å¸¸è§çãå°äº 8 gb ä¼éå¾å¶åï¼ä½ æç»éè¦å¾å¤å¾å¤çå°æºå¨ï¼ï¼å¤§äº 64 gb çæºå¨ä¹ä¼æé®é¢ã\n\nç±äº es æå»ºåºäº luceneï¼è lucene è®¾è®¡å¼ºå¤§ä¹å¤å¨äº lucene è½å¤å¾å¥½çå©ç¨æä½ç³»ç»åå­æ¥ç¼å­ç´¢å¼æ°æ®ï¼ä»¥æä¾å¿«éçæ¥è¯¢æ§è½ãlucene çç´¢å¼æä»¶ segements æ¯å­å¨å¨åæä»¶ä¸­çï¼å¹¶ä¸ä¸å¯åï¼å¯¹äº os æ¥è¯´ï¼è½å¤å¾åå¥½å°å°ç´¢å¼æä»¶ä¿æå¨ cache ä¸­ï¼ä»¥ä¾¿å¿«éè®¿é®ï¼å æ­¤ï¼æä»¬å¾æå¿è¦å°ä¸åçç©çåå­çç» luceneï¼å¦ä¸åçç©çåå­çç» esï¼jvm heapï¼ã\n\n# åå­åé\n\nå½æºå¨åå­å°äº 64g æ¶ï¼éµå¾ªéç¨çååï¼50% ç» esï¼50% çç» luceneã\n\nå½æºå¨åå­å¤§äº 64g æ¶ï¼éµå¾ªä»¥ä¸ååï¼\n\n * å¦æä¸»è¦çä½¿ç¨åºæ¯æ¯å¨ææ£ç´¢ï¼é£ä¹å»ºè®®ç» es heap åé 4~32g çåå­å³å¯ï¼å¶å®åå­çç»æä½ç³»ç»ï¼ä¾ lucene ä½¿ç¨ï¼segments cacheï¼ï¼ä»¥æä¾æ´å¿«çæ¥è¯¢æ§è½ã\n * å¦æä¸»è¦çä½¿ç¨åºæ¯æ¯èåææåºï¼å¹¶ä¸å¤§å¤æ°æ¯ numericsï¼datesï¼geo_points ä»¥å not_analyzed çå­ç¬¦ç±»åï¼å»ºè®®åéç» es heap åé 4~32g çåå­å³å¯ï¼å¶å®åå­çç»æä½ç³»ç»ï¼ä¾ lucene ä½¿ç¨ï¼æä¾å¿«éçåºäºææ¡£çèç±»ãæåºæ§è½ã\n * å¦æä½¿ç¨åºæ¯æ¯èåææåºï¼å¹¶ä¸é½æ¯åºäº analyzed å­ç¬¦æ°æ®ï¼è¿æ¶éè¦æ´å¤ç heap sizeï¼å»ºè®®æºå¨ä¸è¿è¡å¤ es å®ä¾ï¼æ¯ä¸ªå®ä¾ä¿æä¸è¶è¿ 50% ç es heap è®¾ç½®ï¼ä½ä¸è¶è¿ 32 gï¼å åå­è®¾ç½® 32 g ä»¥ä¸æ¶ï¼jvm ä½¿ç¨å¯¹è±¡ææ åç¼©æå·§èçç©ºé´ï¼ï¼50% ä»¥ä¸çç» luceneã\n\n# ç¦æ­¢ swap\n\nç¦æ­¢ swapï¼ä¸æ¦åè®¸åå­ä¸ç£ççäº¤æ¢ï¼ä¼å¼èµ·è´å½çæ§è½é®é¢ãå¯ä»¥éè¿å¨ elasticsearch.yml ä¸­ bootstrap.memory_lock: trueï¼ä»¥ä¿æ jvm éå®åå­ï¼ä¿è¯ es çæ§è½ã\n\n# gc è®¾ç½®\n\nä¿æ gc çç°æè®¾ç½®ï¼é»è®¤è®¾ç½®ä¸ºï¼concurrent-mark and sweepï¼cmsï¼ï¼å«æ¢æ g1 gcï¼å ä¸ºç®å g1 è¿æå¾å¤ bugã\n\nä¿æçº¿ç¨æ± çç°æè®¾ç½®ï¼ç®å es ççº¿ç¨æ± è¾ 1.x æäºè¾å¤ä¼åè®¾ç½®ï¼ä¿æç°ç¶å³å¯ï¼é»è®¤çº¿ç¨æ± å¤§å°ç­äº cpu æ ¸å¿æ°ãå¦æä¸å®è¦æ¹ï¼æå¬å¼ ( ( cpu æ ¸å¿æ° * 3 ) / 2 ) + 1 è®¾ç½®ï¼ä¸è½è¶è¿ cpu æ ¸å¿æ°ç 2 åï¼ä½æ¯ä¸å»ºè®®ä¿®æ¹é»è®¤éç½®ï¼å¦åä¼å¯¹ cpu é æç¡¬ä¼¤ã\n\n\n# ç£ç\n\nç¡¬çå¯¹ææçéç¾¤é½å¾éè¦ï¼å¯¹å¤§éåå¥çéç¾¤æ´æ¯å åéè¦ï¼ä¾å¦é£äºå­å¨æ¥å¿æ°æ®çï¼ãç¡¬çæ¯æå¡å¨ä¸ææ¢çå­ç³»ç»ï¼è¿æå³çé£äºåå¥éå¾å¤§çéç¾¤å¾å®¹æè®©ç¡¬çé¥±åï¼ä½¿å¾å®æä¸ºéç¾¤çç¶é¢ã\n\nå¨ç»æµååè½æ¿åçèå´ä¸ï¼å°½éä½¿ç¨åºæç¡¬çï¼ssdï¼ãåºæç¡¬çç¸æ¯äºä»»ä½æè½¬ä»è´¨ï¼æºæ¢°ç¡¬çï¼ç£å¸¦ç­ï¼ï¼æ è®ºéæºåè¿æ¯é¡ºåºåï¼é½ä¼å¯¹ io æè¾å¤§çæåã\n\n> å¦æä½ æ­£å¨ä½¿ç¨ ssdsï¼ç¡®ä¿ä½ çç³»ç» i/o è°åº¦ç¨åºæ¯éç½®æ­£ç¡®çãå½ä½ åç¡¬çåæ°æ®ï¼i/o è°åº¦ç¨åºå³å®ä½æ¶ææ°æ®å®éåéå°ç¡¬çãå¤§å¤æ°é»è®¤ *nix åè¡çä¸çè°åº¦ç¨åºé½å«å cfqï¼å®å¨å¬å¹³éåï¼ã\n> \n> è°åº¦ç¨åºåéæ¶é´çå°æ¯ä¸ªè¿ç¨ãå¹¶ä¸ä¼åè¿äºå°ç¡¬ççä¼å¤éåçä¼ éãä½å®æ¯ä¸ºæè½¬ä»è´¨ä¼åçï¼æºæ¢°ç¡¬ççåºæç¹æ§æå³çå®åå¥æ°æ®å°åºäºç©çå¸å±çç¡¬çä¼æ´é«æã\n> \n> è¿å¯¹ ssd æ¥è¯´æ¯ä½æçï¼å°½ç®¡è¿éæ²¡ææ¶åå°æºæ¢°ç¡¬çãä½æ¯ï¼deadline æè noop åºè¯¥è¢«ä½¿ç¨ãdeadline è°åº¦ç¨åºåºäºåå¥ç­å¾æ¶é´è¿è¡ä¼åï¼noop åªæ¯ä¸ä¸ªç®åç fifo éåã\n> \n> è¿ä¸ªç®åçæ´æ¹å¯ä»¥å¸¦æ¥æ¾èçå½±åãä»ä»æ¯ä½¿ç¨æ­£ç¡®çè°åº¦ç¨åºï¼æä»¬çå°äº 500 åçåå¥è½åæåã\n\nå¦æä½ ä½¿ç¨æè½¬ä»è´¨ï¼å¦æºæ¢°ç¡¬çï¼ï¼å°è¯è·åå°½å¯è½å¿«çç¡¬çï¼é«æ§è½æå¡å¨ç¡¬çï¼15k rpm é©±å¨å¨ï¼ã\n\nä½¿ç¨ raid0 æ¯æé«ç¡¬çéåº¦çææéå¾ï¼å¯¹æºæ¢°ç¡¬çå ssd æ¥è¯´é½æ¯å¦æ­¤ãæ²¡æå¿è¦ä½¿ç¨éåæå¶å® raid åä½ï¼å ä¸º elasticsearch å¨èªèº«å±é¢éè¿å¯æ¬ï¼å·²ç»æä¾äºå¤ä»½çåè½ï¼æä»¥ä¸éè¦å©ç¨ç£ççå¤ä»½åè½ï¼åæ¶å¦æä½¿ç¨ç£çå¤ä»½åè½çè¯ï¼å¯¹åå¥éåº¦æè¾å¤§çå½±åã\n\næåï¼é¿åä½¿ç¨ç½ç»éå å­å¨ï¼nasï¼ãäººä»¬å¸¸å£°ç§°ä»ä»¬ç nas è§£å³æ¹æ¡æ¯æ¬å°é©±å¨å¨æ´å¿«æ´å¯é ãé¤å´è¿äºå£°ç§°ï¼æä»¬ä»æ²¡çå° nas è½éå¾ä¸å®çå¤§èå®£ä¼ ãnas å¸¸å¸¸å¾æ¢ï¼æ¾é²åºæ´å¤§çå»¶æ¶åæ´å®½çå¹³åå»¶æ¶æ¹å·®ï¼èä¸å®æ¯åç¹æéçã\n\n\n# ç´¢å¼ä¼åè®¾ç½®\n\nç´¢å¼ä¼åä¸»è¦æ¯å¨ elasticsearch çæå¥å±é¢ä¼åï¼elasticsearch æ¬èº«ç´¢å¼éåº¦å¶å®è¿æ¯è®å¿«çï¼å·ä½æ°æ®ï¼æä»¬å¯ä»¥åèå®æ¹ç benchmark æ°æ®ãæä»¬å¯ä»¥æ ¹æ®ä¸åçéæ±ï¼éå¯¹ç´¢å¼ä¼åã\n\n\n# æ¹éæäº¤\n\nå½æå¤§éæ°æ®æäº¤çæ¶åï¼å»ºè®®éç¨æ¹éæäº¤ï¼bulk æä½ï¼ï¼æ­¤å¤ä½¿ç¨ bulk è¯·æ±æ¶ï¼æ¯ä¸ªè¯·æ±ä¸è¶è¿å å mï¼å ä¸ºå¤ªå¤§ä¼å¯¼è´åå­ä½¿ç¨è¿å¤§ã\n\næ¯å¦å¨å elk è¿ç¨ä¸­ï¼logstash indexer æäº¤æ°æ®å° elasticsearch ä¸­ï¼batch size å°±å¯ä»¥ä½ä¸ºä¸ä¸ªä¼ååè½ç¹ãä½æ¯ä¼å size å¤§å°éè¦æ ¹æ®ææ¡£å¤§å°åæå¡å¨æ§è½èå®ã\n\nå logstash ä¸­æäº¤ææ¡£å¤§å°è¶è¿ 20mbï¼logstash ä¼å°ä¸ä¸ªæ¹éè¯·æ±ååä¸ºå¤ä¸ªæ¹éè¯·æ±ã\n\nå¦æå¨æäº¤è¿ç¨ä¸­ï¼éå° esrejectedexecutionexception å¼å¸¸çè¯ï¼åè¯´æéç¾¤çç´¢å¼æ§è½å·²ç»è¾¾å°æéäºãè¿ç§æåµï¼è¦ä¹æé«æå¡å¨éç¾¤çèµæºï¼è¦ä¹æ ¹æ®ä¸å¡è§åï¼åå°æ°æ®æ¶ééåº¦ï¼æ¯å¦åªæ¶é warnãerror çº§å«ä»¥ä¸çæ¥å¿ã\n\n\n# å¢å  refresh æ¶é´é´é\n\nä¸ºäºæé«ç´¢å¼æ§è½ï¼elasticsearch å¨åå¥æ°æ®çæ¶åï¼éç¨å»¶è¿åå¥çç­ç¥ï¼å³æ°æ®ååå°åå­ä¸­ï¼å½è¶è¿é»è®¤ 1 ç§ï¼index.refresh_intervalï¼ä¼è¿è¡ä¸æ¬¡åå¥æä½ï¼å°±æ¯å°åå­ä¸­ segment æ°æ®å·æ°å°ç£çä¸­ï¼æ­¤æ¶æä»¬æè½å°æ°æ®æç´¢åºæ¥ï¼æä»¥è¿å°±æ¯ä¸ºä»ä¹ elasticsearch æä¾çæ¯è¿å®æ¶æç´¢åè½ï¼èä¸æ¯å®æ¶æç´¢åè½ã\n\nå¦ææä»¬çç³»ç»å¯¹æ°æ®å»¶è¿è¦æ±ä¸é«çè¯ï¼æä»¬å¯ä»¥éè¿å»¶é¿ refresh æ¶é´é´éï¼å¯ä»¥ææå°åå° segment åå¹¶ååï¼æé«ç´¢å¼éåº¦ãæ¯å¦å¨åå¨é¾è·¯è·è¸ªçè¿ç¨ä¸­ï¼æä»¬å°±å° index.refresh_interval è®¾ç½®ä¸º 30sï¼åå° refresh æ¬¡æ°ãåå¦ï¼å¨è¿è¡å¨éç´¢å¼æ¶ï¼å¯ä»¥å° refresh æ¬¡æ°ä¸´æ¶å³é­ï¼å³ index.refresh_interval è®¾ç½®ä¸º-1ï¼æ°æ®å¯¼å¥æåååæå¼å°æ­£å¸¸æ¨¡å¼ï¼æ¯å¦ 30sã\n\n> å¨å è½½å¤§éæ°æ®æ¶åå¯ä»¥ææ¶ä¸ç¨ refresh å repliccasï¼index.refresh_interval è®¾ç½®ä¸º-1ï¼index.number_of_replicas è®¾ç½®ä¸º 0ã\n\n\n# ä¿®æ¹ index_buffer_size çè®¾ç½®\n\nç´¢å¼ç¼å²çè®¾ç½®å¯ä»¥æ§å¶å¤å°åå­åéç»ç´¢å¼è¿ç¨ãè¿æ¯ä¸ä¸ªå¨å±éç½®ï¼ä¼åºç¨äºä¸ä¸ªèç¹ä¸ææä¸åçåçä¸ã\n\nindices.memory.index_buffer_size: 10%\nindices.memory.min_index_buffer_size: 48mb\n\n\nindices.memory.index_buffer_size æ¥åä¸ä¸ªç¾åæ¯æèä¸ä¸ªè¡¨ç¤ºå­èå¤§å°çå¼ãé»è®¤æ¯ 10%ï¼æå³çåéç»èç¹çæ»åå­ç 10%ç¨æ¥åç´¢å¼ç¼å²çå¤§å°ãè¿ä¸ªæ°å¼è¢«åå°ä¸åçåçï¼shardsï¼ä¸ãå¦æè®¾ç½®çæ¯ç¾åæ¯ï¼è¿å¯ä»¥è®¾ç½® min_index_buffer_size ï¼é»è®¤ 48mbï¼å max_index_buffer_sizeï¼é»è®¤æ²¡æä¸éï¼ã\n\n\n# ä¿®æ¹ translog ç¸å³çè®¾ç½®\n\nä¸æ¯æ§å¶æ°æ®ä»åå­å°ç¡¬ççæä½é¢çï¼ä»¥åå°ç¡¬ç ioãå¯å° sync_interval çæ¶é´è®¾ç½®å¤§ä¸äºãé»è®¤ä¸º 5sã\n\nindex.translog.sync_interval: 5s\n\n\nä¹å¯ä»¥æ§å¶ tranlog æ°æ®åçå¤§å°ï¼è¾¾å° threshold å¤§å°æ¶ï¼æä¼ flush å° lucene ç´¢å¼æä»¶ãé»è®¤ä¸º 512mã\n\nindex.translog.flush_threshold_size: 512mb\n\n\n\n# æ³¨æ _id å­æ®µçä½¿ç¨\n\n_id å­æ®µçä½¿ç¨ï¼åºå°½å¯è½é¿åèªå®ä¹ _idï¼ä»¥é¿åéå¯¹ id ççæ¬ç®¡çï¼å»ºè®®ä½¿ç¨ es çé»è®¤ id çæç­ç¥æä½¿ç¨æ°å­ç±»å id åä¸ºä¸»é®ã\n\n\n# æ³¨æ _all å­æ®µå _source å­æ®µçä½¿ç¨\n\n**_**all å­æ®µå _source å­æ®µçä½¿ç¨ï¼åºè¯¥æ³¨æåºæ¯åéè¦ï¼_all å­æ®µåå«äºææçç´¢å¼å­æ®µï¼æ¹ä¾¿åå¨ææ£ç´¢ï¼å¦ææ æ­¤éæ±ï¼å¯ä»¥ç¦ç¨ï¼_source å­å¨äºåå§ç document åå®¹ï¼å¦ææ²¡æè·ååå§ææ¡£æ°æ®çéæ±ï¼å¯éè¿è®¾ç½® includesãexcludes å±æ§æ¥å®ä¹æ¾å¥ _source çå­æ®µã\n\n\n# åççéç½®ä½¿ç¨ index å±æ§\n\nåççéç½®ä½¿ç¨ index å±æ§ï¼analyzed å not_analyzedï¼æ ¹æ®ä¸å¡éæ±æ¥æ§å¶å­æ®µæ¯å¦åè¯æä¸åè¯ãåªæ groupby éæ±çå­æ®µï¼éç½®æ¶å°±è®¾ç½®æ not_analyzedï¼ä»¥æé«æ¥è¯¢æèç±»çæçã\n\n\n# åå°å¯æ¬æ°é\n\nelasticsearch é»è®¤å¯æ¬æ°éä¸º 3 ä¸ªï¼è½ç¶è¿æ ·ä¼æé«éç¾¤çå¯ç¨æ§ï¼å¢å æç´¢çå¹¶åæ°ï¼ä½æ¯åæ¶ä¹ä¼å½±ååå¥ç´¢å¼çæçã\n\nå¨ç´¢å¼è¿ç¨ä¸­ï¼éè¦ææ´æ°çææ¡£åå°å¯æ¬èç¹ä¸ï¼ç­å¯æ¬èç¹çæåå¨è¿è¡è¿åç»æãä½¿ç¨ elasticsearch åä¸å¡æç´¢çæ¶åï¼å»ºè®®å¯æ¬æ°ç®è¿æ¯è®¾ç½®ä¸º 3 ä¸ªï¼ä½æ¯ååé¨ elk æ¥å¿ç³»ç»ãåå¸å¼è·è¸ªç³»ç»ä¸­ï¼å®å¨å¯ä»¥å°å¯æ¬æ°ç®è®¾ç½®ä¸º 1 ä¸ªã\n\n\n# æ¥è¯¢æ¹é¢ä¼å\n\nelasticsearch ä½ä¸ºä¸å¡æç´¢çè¿å®æ¶æ¥è¯¢æ¶ï¼æ¥è¯¢æççä¼åæ¾å¾å°¤ä¸ºéè¦ã\n\n\n# è·¯ç±ä¼å\n\nå½æä»¬æ¥è¯¢ææ¡£çæ¶åï¼elasticsearch å¦ä½ç¥éä¸ä¸ªææ¡£åºè¯¥å­æ¾å°åªä¸ªåçä¸­å¢ï¼å®å¶å®æ¯éè¿ä¸é¢è¿ä¸ªå¬å¼æ¥è®¡ç®åºæ¥çã\n\nshard = hash(routing) % number_of_primary_shards\n\n\nrouting é»è®¤å¼æ¯ææ¡£ç idï¼ä¹å¯ä»¥éç¨èªå®ä¹å¼ï¼æ¯å¦ç¨æ· idã\n\n# ä¸å¸¦ routing æ¥è¯¢\n\nå¨æ¥è¯¢çæ¶åå ä¸ºä¸ç¥éè¦æ¥è¯¢çæ°æ®å·ä½å¨åªä¸ªåçä¸ï¼æä»¥æ´ä¸ªè¿ç¨åä¸º 2 ä¸ªæ­¥éª¤ï¼\n\n 1. ååï¼è¯·æ±å°è¾¾åè°èç¹åï¼åè°èç¹å°æ¥è¯¢è¯·æ±ååå°æ¯ä¸ªåçä¸ã\n 2. èåï¼åè°èç¹æéå°æ¯ä¸ªåçä¸æ¥è¯¢ç»æï¼åå°æ¥è¯¢çç»æè¿è¡æåºï¼ä¹åç»ç¨æ·è¿åç»æã\n\n# å¸¦ routing æ¥è¯¢\n\næ¥è¯¢çæ¶åï¼å¯ä»¥ç´æ¥æ ¹æ® routing ä¿¡æ¯å®ä½å°æä¸ªåéæ¥è¯¢ï¼ä¸éè¦æ¥è¯¢ææçåéï¼ç»è¿åè°èç¹æåºã\n\nåä¸é¢èªå®ä¹çç¨æ·æ¥è¯¢ï¼å¦æ routing è®¾ç½®ä¸º userid çè¯ï¼å°±å¯ä»¥ç´æ¥æ¥è¯¢åºæ°æ®æ¥ï¼æçæåå¾å¤ã\n\n\n# filter vs query\n\nå°½å¯è½ä½¿ç¨è¿æ»¤å¨ä¸ä¸æï¼filterï¼æ¿ä»£æ¥è¯¢ä¸ä¸æï¼queryï¼\n\n * queryï¼æ­¤ææ¡£ä¸æ­¤æ¥è¯¢å­å¥çå¹éç¨åº¦å¦ä½ï¼\n * filterï¼æ­¤ææ¡£åæ¥è¯¢å­å¥å¹éåï¼\n\nelasticsearch éå¯¹ filter æ¥è¯¢åªéè¦åç­ãæ¯ãæèãå¦ãï¼ä¸éè¦å query æ¥è¯¢ä¸æ ·è®¡ç®ç¸å³æ§åæ°ï¼åæ¶ filter ç»æå¯ä»¥ç¼å­ã\n\n\n# æ·±åº¦ç¿»é¡µ\n\nå¨ä½¿ç¨ elasticsearch è¿ç¨ä¸­ï¼åºå°½éé¿åå¤§ç¿»é¡µçåºç°ã\n\næ­£å¸¸ç¿»é¡µæ¥è¯¢é½æ¯ä» from å¼å§ size æ¡æ°æ®ï¼è¿æ ·å°±éè¦å¨æ¯ä¸ªåçä¸­æ¥è¯¢æåæåå¨åé¢ç from+size æ¡æ°æ®ãååèç¹æ¶éæ¯ä¸ªåéçå from+size æ¡æ°æ®ãååèç¹ä¸å±ä¼åå° n*(from+size) æ¡æ°æ®ï¼ç¶åè¿è¡æåºï¼åå°å¶ä¸­ from å° from+size æ¡æ°æ®è¿ååºå»ãå¦æ from æè size å¾å¤§çè¯ï¼å¯¼è´åå æåºçæ°éä¼åæ­¥æ©å¤§å¾å¤ï¼æç»ä¼å¯¼è´ cpu èµæºæ¶èå¢å¤§ã\n\nå¯ä»¥éè¿ä½¿ç¨ elasticsearch scroll å scroll-scan é«ææ»å¨çæ¹å¼æ¥è§£å³è¿æ ·çé®é¢ã\n\nä¹å¯ä»¥ç»åå®éä¸å¡ç¹ç¹ï¼ææ¡£ id å¤§å°å¦æåææ¡£åå»ºæ¶é´æ¯ä¸è´æåºçï¼å¯ä»¥ä»¥ææ¡£ id ä½ä¸ºåé¡µçåç§»éï¼å¹¶å°å¶ä½ä¸ºåé¡µæ¥è¯¢çä¸ä¸ªæ¡ä»¶ã\n\n\n# èæ¬ï¼scriptï¼åçä½¿ç¨\n\næä»¬ç¥éèæ¬ä½¿ç¨ä¸»è¦æ 3 ç§å½¢å¼ï¼åèå¨æç¼è¯æ¹å¼ã_script ç´¢å¼åºä¸­å­å¨åæä»¶èæ¬å­å¨çå½¢å¼ï¼ä¸è¬èæ¬çä½¿ç¨åºæ¯æ¯ç²æï¼å°½éç¨ç¬¬äºç§æ¹å¼åå°èæ¬å­å¨å¨ _script ç´¢å¼åºä¸­ï¼èµ·å°æåç¼è¯ï¼ç¶åéè¿å¼ç¨èæ¬ idï¼å¹¶ç»å params åæ°ä½¿ç¨ï¼å³å¯ä»¥è¾¾å°æ¨¡åï¼é»è¾ï¼åæ°æ®è¿è¡äºåç¦»ï¼åæ¶åä¾¿äºèæ¬æ¨¡åçæ©å±ä¸ç»´æ¤ãå·ä½ es èæ¬çæ·±å¥åå®¹è¯·åè elasticsearch èæ¬æ¨¡åçè¯¦è§£ã\n\n\n# æ°æ®ç»æä¼å\n\nåºäº elasticsearch çä½¿ç¨åºæ¯ï¼ææ¡£æ°æ®ç»æå°½éåä½¿ç¨åºæ¯è¿è¡ç»åï¼å»ææ²¡ç¨åä¸åççæ°æ®ã\n\n\n# å°½éåå°ä¸éè¦çå­æ®µ\n\nå¦æ elasticsearch ç¨äºä¸å¡æç´¢æå¡ï¼ä¸äºä¸éè¦ç¨äºæç´¢çå­æ®µæå¥½ä¸å­å° es ä¸­ï¼è¿æ ·å³èçç©ºé´ï¼åæ¶å¨ç¸åçæ°æ®éä¸ï¼ä¹è½æé«æç´¢æ§è½ã\n\né¿åä½¿ç¨å¨æå¼ä½å­æ®µï¼å¨æéå¢ç mappingï¼ä¼å¯¼è´éç¾¤å´©æºï¼åæ ·ï¼ä¹éè¦æ§å¶å­æ®µçæ°éï¼ä¸å¡ä¸­ä¸ä½¿ç¨çå­æ®µï¼å°±ä¸è¦ç´¢å¼ãæ§å¶ç´¢å¼çå­æ®µæ°éãmapping æ·±åº¦ãç´¢å¼å­æ®µçç±»åï¼å¯¹äº es çæ§è½ä¼åæ¯éä¸­ä¹éã\n\nä»¥ä¸æ¯ es å³äºå­æ®µæ°ãmapping æ·±åº¦çä¸äºé»è®¤è®¾ç½®ï¼\n\nindex.mapping.nested_objects.limit: 10000\nindex.mapping.total_fields.limit: 1000\nindex.mapping.depth.limit: 20\n\n\n\n# nested object vs parent/child\n\nå°½éé¿åä½¿ç¨ nested æ parent/child çå­æ®µï¼è½ä¸ç¨å°±ä¸ç¨ï¼nested query æ¢ï¼parent/child query æ´æ¢ï¼æ¯ nested query æ¢ä¸ç¾åï¼å æ­¤è½å¨ mapping è®¾è®¡é¶æ®µæå®çï¼å¤§å®½è¡¨è®¾è®¡æéç¨æ¯è¾ smart çæ°æ®ç»æï¼ï¼å°±ä¸è¦ç¨ç¶å­å³ç³»ç mappingã\n\nå¦æä¸å®è¦ä½¿ç¨ nested fieldsï¼ä¿è¯ nested fields å­æ®µä¸è½è¿å¤ï¼ç®å es é»è®¤éå¶æ¯ 50ãå ä¸ºéå¯¹ 1 ä¸ª documentï¼æ¯ä¸ä¸ª nested fieldï¼é½ä¼çæä¸ä¸ªç¬ç«ç documentï¼è¿å°ä½¿ doc æ°éå§å¢ï¼å½±åæ¥è¯¢æçï¼å°¤å¶æ¯ join çæçã\n\nindex.mapping.nested_fields.limit: 50\n\n\nå¯¹æ¯   nested object        parent/child\nä¼ç¹   ææ¡£å­å¨å¨ä¸èµ·ï¼å æ­¤è¯»åæ§é«       ç¶å­ææ¡£å¯ä»¥ç¬ç«æ´æ°ï¼äºä¸å½±å\nç¼ºç¹   æ´æ°ç¶ææ¡£æå­ææ¡£æ¶éè¦æ´æ°æ´ä¸ªææ¡£   ä¸ºäºç»´æ¤ join å³ç³»ï¼éè¦å ç¨é¨ååå­ï¼è¯»åæ§è½è¾å·®\nåºæ¯   å­ææ¡£å¶å°æ´æ°ï¼æ¥è¯¢é¢ç¹         å­ææ¡£æ´æ°é¢ç¹\n\n\n# éæ©éææ å°ï¼éå¿éæ¶ï¼ç¦æ­¢å¨ææ å°\n\nå°½éé¿åä½¿ç¨å¨ææ å°ï¼è¿æ ·æå¯è½ä¼å¯¼è´éç¾¤å´©æºï¼æ­¤å¤ï¼å¨ææ å°æå¯è½ä¼å¸¦æ¥ä¸å¯æ§å¶çæ°æ®ç±»åï¼è¿èæå¯è½å¯¼è´å¨æ¥è¯¢ç«¯åºç°ç¸å³å¼å¸¸ï¼å½±åä¸å¡ã\n\næ­¤å¤ï¼elasticsearch ä½ä¸ºæç´¢å¼ææ¶ï¼ä¸»è¦æ¿è½½ query çå¹éåæåºçåè½ï¼é£æ°æ®çå­å¨ç±»ååºäºè¿ä¸¤ç§åè½çç¨éåä¸ºä¸¤ç±»ï¼ä¸æ¯éè¦å¹éçå­æ®µï¼ç¨æ¥å»ºç«åæç´¢å¼å¯¹ query å¹éç¨ï¼å¦ä¸ç±»å­æ®µæ¯ç¨åç²æç¨å°çç¹å¾å­æ®µï¼å¦ ctrãç¹å»æ°ãè¯è®ºæ°ç­ç­ã\n\n\n# éç¾¤æ¶æè®¾è®¡\n\nåççé¨ç½² elasticsearch æå©äºæé«æå¡çæ´ä½å¯ç¨æ§ã\n\n\n# ä¸»èç¹ãæ°æ®èç¹ååè°èç¹åç¦»\n\nelasticsearch éç¾¤å¨æ¶æææ´æ¶ï¼éç¨ä¸»èç¹ãæ°æ®èç¹åè´è½½åè¡¡èç¹åç¦»çæ¶æï¼å¨ 5.x çæ¬ä»¥åï¼åå¯å°æ°æ®èç¹åç»åä¸ºâhot-warmâçæ¶ææ¨¡å¼ã\n\nelasticsearch çéç½®æä»¶ä¸­æ 2 ä¸ªåæ°ï¼node.master å node.dataãè¿ä¸¤ä¸ªåæ°æ­éä½¿ç¨æ¶ï¼è½å¤å¸®å©æä¾æå¡å¨æ§è½ã\n\n# ä¸»ï¼masterï¼èç¹\n\néç½® node.master:true å node.data:falseï¼è¯¥ node æå¡å¨åªä½ä¸ºä¸ä¸ªä¸»èç¹ï¼ä½ä¸å­å¨ä»»ä½ç´¢å¼æ°æ®ãæä»¬æ¨èæ¯ä¸ªéç¾¤è¿è¡ 3 ä¸ªä¸ç¨ç master èç¹æ¥æä¾æå¥½çå¼¹æ§ãä½¿ç¨æ¶ï¼ä½ è¿éè¦å° discovery.zen.minimum_master_nodes setting åæ°è®¾ç½®ä¸º 2ï¼ä»¥ååºç°èè£ï¼split-brainï¼çæåµãç¨ 3 ä¸ªä¸ç¨ç master èç¹ï¼ä¸é¨è´è´£å¤çéç¾¤çç®¡çä»¥åå å¼ºç¶æçæ´ä½ç¨³å®æ§ãå ä¸ºè¿ 3 ä¸ª master èç¹ä¸åå«æ°æ®ä¹ä¸ä¼å®éåä¸æç´¢ä»¥åç´¢å¼æä½ï¼å¨ jvm ä¸å®ä»¬ä¸ç¨åç¸åçäºï¼ä¾å¦ç¹éçç´¢å¼æèèæ¶ï¼èµæºèè´¹å¾å¤§çæç´¢ãå æ­¤ä¸å¤ªå¯è½ä¼å ä¸ºåå¾åæ¶èå¯¼è´åé¡¿ãå æ­¤ï¼master èç¹ç cpuï¼åå­ä»¥åç£çéç½®å¯ä»¥æ¯ data èç¹å°å¾å¤çã\n\n# æ°æ®ï¼dataï¼èç¹\n\néç½® node.master:false å node.data:trueï¼è¯¥ node æå¡å¨åªä½ä¸ºä¸ä¸ªæ°æ®èç¹ï¼åªç¨äºå­å¨ç´¢å¼æ°æ®ï¼ä½¿è¯¥ node æå¡å¨åè½åä¸ï¼åªç¨äºæ°æ®å­å¨åæ°æ®æ¥è¯¢ï¼éä½å¶èµæºæ¶èçã\n\nå¨ elasticsearch 5.x çæ¬ä¹åï¼data èç¹åå¯åç»åä¸ºâhot-warmâæ¶æï¼å³åä¸ºç­èç¹ï¼hot nodeï¼åæèç¹ï¼warm nodeï¼ã\n\nhot èç¹ï¼\n\nhot èç¹ä¸»è¦æ¯ç´¢å¼èç¹ï¼åèç¹ï¼ï¼åæ¶ä¼ä¿å­è¿æçä¸äºé¢ç¹è¢«æ¥è¯¢çç´¢å¼ãç±äºè¿è¡ç´¢å¼éå¸¸èè´¹ cpu å ioï¼å³å±äº io å cpu å¯éåæä½ï¼å»ºè®®ä½¿ç¨ ssd çç£çç±»åï¼ä¿æè¯å¥½çåæ§è½ï¼æä»¬æ¨èé¨ç½²æå°åç 3 ä¸ª hot èç¹æ¥ä¿è¯é«å¯ç¨æ§ãæ ¹æ®è¿æéè¦æ¶éä»¥åæ¥è¯¢çæ°æ®éï¼å¯ä»¥å¢å æå¡å¨æ°éæ¥è·å¾æ³è¦çæ§è½ã\n\nå°èç¹è®¾ç½®ä¸º hot ç±»åéè¦ elasticsearch.yml å¦ä¸éç½®ï¼\n\nnode.attr.box_type: hot\n\n\nå¦ææ¯éå¯¹æå®ç index æä½ï¼å¯ä»¥éè¿ settings è®¾ç½® index.routing.allocation.require.box_type: hot å°ç´¢å¼åå¥ hot èç¹ã\n\nwarm èç¹ï¼\n\nè¿ç§ç±»åçèç¹æ¯ä¸ºäºå¤çå¤§éçï¼èä¸ä¸ç»å¸¸è®¿é®çåªè¯»ç´¢å¼èè®¾è®¡çãç±äºè¿äºç´¢å¼æ¯åªè¯»çï¼warm èç¹å¾åäºæè½½å¤§éç£çï¼æ®éç£çï¼æ¥æ¿ä»£ ssdãåå­ãcpu çéç½®è· hot èç¹ä¿æä¸è´å³å¯ï¼èç¹æ°éä¸è¬ä¹æ¯å¤§äºç­äº 3 ä¸ªã\n\nå°èç¹è®¾ç½®ä¸º warm ç±»åéè¦ elasticsearch.yml å¦ä¸éç½®ï¼\n\nnode.attr.box_type: warm\n\n\nåæ¶ï¼ä¹å¯ä»¥å¨ elasticsearch.yml ä¸­è®¾ç½® index.codec:best_compression ä¿è¯ warm èç¹çåç¼©éç½®ã\n\nå½ç´¢å¼ä¸åè¢«é¢ç¹æ¥è¯¢æ¶ï¼å¯éè¿ index.routing.allocation.require.box_type:warmï¼å°ç´¢å¼æ è®°ä¸º warmï¼ä»èä¿è¯ç´¢å¼ä¸åå¥ hot èç¹ï¼ä»¥ä¾¿å° ssd ç£çèµæºç¨å¨ååä¸ãä¸æ¦è®¾ç½®è¿ä¸ªå±æ§ï¼es ä¼èªå¨å°ç´¢å¼åå¹¶å° warm èç¹ã\n\n# åè°ï¼coordinatingï¼èç¹\n\nåè°èç¹ç¨äºååå¸å¼éçåè°ï¼å°ååçæèç¹è¿åçæ°æ®æ´ååè¿åãè¯¥èç¹ä¸ä¼è¢«éä½ä¸»èç¹ï¼ä¹ä¸ä¼å­å¨ä»»ä½ç´¢å¼æ°æ®ãè¯¥æå¡å¨ä¸»è¦ç¨äºæ¥è¯¢è´è½½åè¡¡ãå¨æ¥è¯¢çæ¶åï¼éå¸¸ä¼æ¶åå°ä»å¤ä¸ª node æå¡å¨ä¸æ¥è¯¢æ°æ®ï¼å¹¶å°è¯·æ±ååå°å¤ä¸ªæå®ç node æå¡å¨ï¼å¹¶å¯¹åä¸ª node æå¡å¨è¿åçç»æè¿è¡ä¸ä¸ªæ±æ»å¤çï¼æç»è¿åç»å®¢æ·ç«¯ãå¨ es éç¾¤ä¸­ï¼ææçèç¹é½æå¯è½æ¯åè°èç¹ï¼ä½æ¯ï¼å¯ä»¥éè¿è®¾ç½® node.masterãnode.dataãnode.ingest é½ä¸º false æ¥è®¾ç½®ä¸é¨çåè°èç¹ãéè¦è¾å¥½ç cpu åè¾é«çåå­ã\n\n * node.master:false å node.data:trueï¼è¯¥ node æå¡å¨åªä½ä¸ºä¸ä¸ªæ°æ®èç¹ï¼åªç¨äºå­å¨ç´¢å¼æ°æ®ï¼ä½¿è¯¥ node æå¡å¨åè½åä¸ï¼åªç¨äºæ°æ®å­å¨åæ°æ®æ¥è¯¢ï¼éä½å¶èµæºæ¶èçã\n * node.master:true å node.data:falseï¼è¯¥ node æå¡å¨åªä½ä¸ºä¸ä¸ªä¸»èç¹ï¼ä½ä¸å­å¨ä»»ä½ç´¢å¼æ°æ®ï¼è¯¥ node æå¡å¨å°ä½¿ç¨èªèº«ç©ºé²çèµæºï¼æ¥åè°åç§åå»ºç´¢å¼è¯·æ±æèæ¥è¯¢è¯·æ±ï¼å¹¶å°è¿äºè¯·æ±åçååå°ç¸å³ç node æå¡å¨ä¸ã\n * node.master:false å node.data:falseï¼è¯¥ node æå¡å¨å³ä¸ä¼è¢«éä½ä¸»èç¹ï¼ä¹ä¸ä¼å­å¨ä»»ä½ç´¢å¼æ°æ®ãè¯¥æå¡å¨ä¸»è¦ç¨äºæ¥è¯¢è´è½½åè¡¡ãå¨æ¥è¯¢çæ¶åï¼éå¸¸ä¼æ¶åå°ä»å¤ä¸ª node æå¡å¨ä¸æ¥è¯¢æ°æ®ï¼å¹¶å°è¯·æ±ååå°å¤ä¸ªæå®ç node æå¡å¨ï¼å¹¶å¯¹åä¸ª node æå¡å¨è¿åçç»æè¿è¡ä¸ä¸ªæ±æ»å¤çï¼æç»è¿åç»å®¢æ·ç«¯ã\n\n\n# å³é­ data èç¹æå¡å¨ä¸­ç http åè½\n\néå¯¹ elasticsearch éç¾¤ä¸­çæææ°æ®èç¹ï¼ä¸ç¨å¼å¯ http æå¡ãå°å¶ä¸­çéç½®åæ°è¿æ ·è®¾ç½®ï¼http.enabled:falseï¼åæ¶ä¹ä¸è¦å®è£ head, bigdesk, marvel ç­çæ§æä»¶ï¼è¿æ ·ä¿è¯ data èç¹æå¡å¨åªéå¤çåå»º/æ´æ°/å é¤/æ¥è¯¢ç´¢å¼æ°æ®ç­æä½ã\n\nhttp åè½å¯ä»¥å¨éæ°æ®èç¹æå¡å¨ä¸å¼å¯ï¼ä¸è¿°ç¸å³ççæ§æä»¶ä¹å®è£å°è¿äºæå¡å¨ä¸ï¼ç¨äºçæ§ elasticsearch éç¾¤ç¶æç­æ°æ®ä¿¡æ¯ãè¿æ ·åä¸æ¥åºäºæ°æ®å®å¨èèï¼äºæ¥åºäºæå¡æ§è½èèã\n\n\n# ä¸å°æå¡å¨ä¸æå¥½åªé¨ç½²ä¸ä¸ª node\n\nä¸å°ç©çæå¡å¨ä¸å¯ä»¥å¯å¨å¤ä¸ª node æå¡å¨èç¹ï¼éè¿è®¾ç½®ä¸åçå¯å¨ portï¼ï¼ä½ä¸å°æå¡å¨ä¸ç cpuãåå­ãç¡¬çç­èµæºæ¯ç«æéï¼ä»æå¡å¨æ§è½èèï¼ä¸å»ºè®®ä¸å°æå¡å¨ä¸å¯å¨å¤ä¸ª node èç¹ã\n\n\n# éç¾¤åçè®¾ç½®\n\nes ä¸æ¦åå»ºå¥½ç´¢å¼åï¼å°±æ æ³è°æ´åççè®¾ç½®ï¼èå¨ es ä¸­ï¼ä¸ä¸ªåçå®éä¸å¯¹åºä¸ä¸ª lucene ç´¢å¼ï¼è lucene ç´¢å¼çè¯»åä¼å ç¨å¾å¤çç³»ç»èµæºï¼å æ­¤ï¼åçæ°ä¸è½è®¾ç½®è¿å¤§ï¼æä»¥ï¼å¨åå»ºç´¢å¼æ¶ï¼åçéç½®åçæ°æ¯éå¸¸éè¦çãä¸è¬æ¥è¯´ï¼æä»¬éµå¾ªä¸äºååï¼\n\n 1. æ§å¶æ¯ä¸ªåçå ç¨çç¡¬çå®¹éä¸è¶è¿ es çæå¤§ jvm çå ç©ºé´è®¾ç½®ï¼ä¸è¬è®¾ç½®ä¸è¶è¿ 32 gï¼åèä¸é¢ç jvm åå­è®¾ç½®ååï¼ï¼å æ­¤ï¼å¦æç´¢å¼çæ»å®¹éå¨ 500 g å·¦å³ï¼é£åçå¤§å°å¨ 16 ä¸ªå·¦å³å³å¯ï¼å½ç¶ï¼æå¥½åæ¶èèåå 2ã\n 2. èèä¸ä¸ node æ°éï¼ä¸è¬ä¸ä¸ªèç¹ææ¶åå°±æ¯ä¸å°ç©çæºï¼å¦æåçæ°è¿å¤ï¼å¤§å¤§è¶è¿äºèç¹æ°ï¼å¾å¯è½ä¼å¯¼è´ä¸ä¸ªèç¹ä¸å­å¨å¤ä¸ªåçï¼ä¸æ¦è¯¥èç¹æéï¼å³ä½¿ä¿æäº 1 ä¸ªä»¥ä¸çå¯æ¬ï¼åæ ·æå¯è½ä¼å¯¼è´æ°æ®ä¸¢å¤±ï¼éç¾¤æ æ³æ¢å¤ãæä»¥ï¼ä¸è¬é½è®¾ç½®åçæ°ä¸è¶è¿èç¹æ°ç 3 åã\n\n\n# åèèµæ\n\n * elasticsearch æç¨",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Elasticsearch Rest API",frontmatter:{title:"Elasticsearch Rest API",date:"2020-06-16T07:10:44.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","API"],permalink:"/pages/4b1907/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/11.ElasticsearchRestApi.html",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/11.ElasticsearchRestApi.md",key:"v-3c818a28",path:"/pages/4b1907/",headers:[{level:2,title:"ElasticSearch Rest API è¯­æ³æ ¼å¼",slug:"elasticsearch-rest-api-è¯­æ³æ ¼å¼",normalizedTitle:"elasticsearch rest api è¯­æ³æ ¼å¼",charIndex:311},{level:2,title:"ç´¢å¼ API",slug:"ç´¢å¼-api",normalizedTitle:"ç´¢å¼ api",charIndex:1025},{level:3,title:"åå»ºç´¢å¼",slug:"åå»ºç´¢å¼",normalizedTitle:"åå»ºç´¢å¼",charIndex:1073},{level:3,title:"å é¤ç´¢å¼",slug:"å é¤ç´¢å¼",normalizedTitle:"å é¤ç´¢å¼",charIndex:1637},{level:3,title:"æ¥çç´¢å¼",slug:"æ¥çç´¢å¼",normalizedTitle:"æ¥çç´¢å¼",charIndex:1750},{level:3,title:"ç´¢å¼å«å",slug:"ç´¢å¼å«å",normalizedTitle:"ç´¢å¼å«å",charIndex:2231},{level:3,title:"æå¼/å³é­ç´¢å¼",slug:"æå¼-å³é­ç´¢å¼",normalizedTitle:"æå¼/å³é­ç´¢å¼",charIndex:2852},{level:2,title:"ææ¡£",slug:"ææ¡£",normalizedTitle:"ææ¡£",charIndex:285},{level:3,title:"åå»ºææ¡£",slug:"åå»ºææ¡£",normalizedTitle:"åå»ºææ¡£",charIndex:5603},{level:4,title:"æå® ID",slug:"æå®-id",normalizedTitle:"æå® id",charIndex:3389},{level:4,title:"èªå¨çæ ID",slug:"èªå¨çæ-id",normalizedTitle:"èªå¨çæ id",charIndex:5774},{level:3,title:"å é¤ææ¡£",slug:"å é¤ææ¡£",normalizedTitle:"å é¤ææ¡£",charIndex:3894},{level:3,title:"æ´æ°ææ¡£",slug:"æ´æ°ææ¡£",normalizedTitle:"æ´æ°ææ¡£",charIndex:5996},{level:4,title:"åå é¤ï¼ååå¥",slug:"åå é¤-ååå¥",normalizedTitle:"åå é¤ï¼ååå¥",charIndex:6004},{level:4,title:"å¨åææ¡£ä¸å¢å å­æ®µ",slug:"å¨åææ¡£ä¸å¢å å­æ®µ",normalizedTitle:"å¨åææ¡£ä¸å¢å å­æ®µ",charIndex:3726},{level:3,title:"æ¥è¯¢ææ¡£",slug:"æ¥è¯¢ææ¡£",normalizedTitle:"æ¥è¯¢ææ¡£",charIndex:2709},{level:4,title:"æå® ID æ¥è¯¢",slug:"æå®-id-æ¥è¯¢",normalizedTitle:"æå® id æ¥è¯¢",charIndex:6253},{level:4,title:"æ¥è¯¢ææè®°å½",slug:"æ¥è¯¢ææè®°å½",normalizedTitle:"æ¥è¯¢ææè®°å½",charIndex:6614},{level:3,title:"å¨ææç´¢",slug:"å¨ææç´¢",normalizedTitle:"å¨ææç´¢",charIndex:7610},{level:3,title:"é»è¾è¿ç®",slug:"é»è¾è¿ç®",normalizedTitle:"é»è¾è¿ç®",charIndex:8778},{level:3,title:"æ¹éæ§è¡",slug:"æ¹éæ§è¡",normalizedTitle:"æ¹éæ§è¡",charIndex:9183},{level:3,title:"æ¹éè¯»å",slug:"æ¹éè¯»å",normalizedTitle:"æ¹éè¯»å",charIndex:9631},{level:3,title:"æ¹éæ¥è¯¢",slug:"æ¹éæ¥è¯¢",normalizedTitle:"æ¹éæ¥è¯¢",charIndex:10441},{level:3,title:"URI Search æ¥è¯¢è¯­ä¹",slug:"uri-search-æ¥è¯¢è¯­ä¹",normalizedTitle:"uri search æ¥è¯¢è¯­ä¹",charIndex:10619},{level:4,title:"Term å Phrase",slug:"term-å-phrase",normalizedTitle:"term å phrase",charIndex:10989},{level:4,title:"åç»ä¸å¼å·",slug:"åç»ä¸å¼å·",normalizedTitle:"åç»ä¸å¼å·",charIndex:11247},{level:4,title:"ANDãORãNOT æè &&ã||ã!",slug:"andãorãnot-æè-ã-ã",normalizedTitle:"andãorãnot æè &amp;&amp;ã||ã!",charIndex:null},{level:4,title:"èå´æ¥è¯¢",slug:"èå´æ¥è¯¢",normalizedTitle:"èå´æ¥è¯¢",charIndex:11508},{level:4,title:"ç®æ°ç¬¦å·",slug:"ç®æ°ç¬¦å·",normalizedTitle:"ç®æ°ç¬¦å·",charIndex:11729},{level:4,title:"ééç¬¦æ¥è¯¢",slug:"ééç¬¦æ¥è¯¢",normalizedTitle:"ééç¬¦æ¥è¯¢",charIndex:11983},{level:4,title:"æ­£åè¡¨è¾¾å¼",slug:"æ­£åè¡¨è¾¾å¼",normalizedTitle:"æ­£åè¡¨è¾¾å¼",charIndex:12139},{level:4,title:"æ¨¡ç³å¹éä¸è¿ä¼¼æ¥è¯¢",slug:"æ¨¡ç³å¹éä¸è¿ä¼¼æ¥è¯¢",normalizedTitle:"æ¨¡ç³å¹éä¸è¿ä¼¼æ¥è¯¢",charIndex:12162},{level:3,title:"Request Body & DSL",slug:"request-body-dsl",normalizedTitle:"request body &amp; dsl",charIndex:null},{level:4,title:"åé¡µ",slug:"åé¡µ",normalizedTitle:"åé¡µ",charIndex:10860},{level:4,title:"æåº",slug:"æåº",normalizedTitle:"æåº",charIndex:2055},{level:4,title:"_source è¿æ»¤",slug:"source-è¿æ»¤",normalizedTitle:"_source è¿æ»¤",charIndex:12989},{level:4,title:"èæ¬å­æ®µ",slug:"èæ¬å­æ®µ",normalizedTitle:"èæ¬å­æ®µ",charIndex:13303},{level:4,title:"ä½¿ç¨æ¥è¯¢è¡¨è¾¾å¼ - Match",slug:"ä½¿ç¨æ¥è¯¢è¡¨è¾¾å¼-match",normalizedTitle:"ä½¿ç¨æ¥è¯¢è¡¨è¾¾å¼ - match",charIndex:13626},{level:4,title:"ç­è¯­æç´¢ - Match Phrase",slug:"ç­è¯­æç´¢-match-phrase",normalizedTitle:"ç­è¯­æç´¢ - match phrase",charIndex:13891},{level:2,title:"éç¾¤ API",slug:"éç¾¤-api",normalizedTitle:"éç¾¤ api",charIndex:14045},{level:3,title:"éç¾¤å¥åº· API",slug:"éç¾¤å¥åº·-api",normalizedTitle:"éç¾¤å¥åº· api",charIndex:15339},{level:3,title:"éç¾¤ç¶æ API",slug:"éç¾¤ç¶æ-api",normalizedTitle:"éç¾¤ç¶æ api",charIndex:15547},{level:2,title:"èç¹ API",slug:"èç¹-api",normalizedTitle:"èç¹ api",charIndex:15608},{level:2,title:"åç API",slug:"åç-api",normalizedTitle:"åç api",charIndex:15753},{level:2,title:"çæ§ API",slug:"çæ§-api",normalizedTitle:"çæ§ api",charIndex:16013},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:1035}],headersStr:"ElasticSearch Rest API è¯­æ³æ ¼å¼ ç´¢å¼ API åå»ºç´¢å¼ å é¤ç´¢å¼ æ¥çç´¢å¼ ç´¢å¼å«å æå¼/å³é­ç´¢å¼ ææ¡£ åå»ºææ¡£ æå® ID èªå¨çæ ID å é¤ææ¡£ æ´æ°ææ¡£ åå é¤ï¼ååå¥ å¨åææ¡£ä¸å¢å å­æ®µ æ¥è¯¢ææ¡£ æå® ID æ¥è¯¢ æ¥è¯¢ææè®°å½ å¨ææç´¢ é»è¾è¿ç® æ¹éæ§è¡ æ¹éè¯»å æ¹éæ¥è¯¢ URI Search æ¥è¯¢è¯­ä¹ Term å Phrase åç»ä¸å¼å· ANDãORãNOT æè &&ã||ã! èå´æ¥è¯¢ ç®æ°ç¬¦å· ééç¬¦æ¥è¯¢ æ­£åè¡¨è¾¾å¼ æ¨¡ç³å¹éä¸è¿ä¼¼æ¥è¯¢ Request Body & DSL åé¡µ æåº _source è¿æ»¤ èæ¬å­æ®µ ä½¿ç¨æ¥è¯¢è¡¨è¾¾å¼ - Match ç­è¯­æç´¢ - Match Phrase éç¾¤ API éç¾¤å¥åº· API éç¾¤ç¶æ API èç¹ API åç API çæ§ API åèèµæ",content:'# ElasticSearch Rest API\n\n> Elasticsearch æ¯ä¸ä¸ªåå¸å¼ãRESTful é£æ ¼çæç´¢åæ°æ®åæå¼æï¼è½å¤è§£å³ä¸æ­æ¶ç°åºçåç§ç¨ä¾ã ä½ä¸º Elastic Stack çæ ¸å¿ï¼å®éä¸­å­å¨æ¨çæ°æ®ï¼å¸®å©æ¨åç°ææä¹ä¸­ä»¥åææä¹å¤çæåµã\n> \n> Elasticsearch åºäºæç´¢åº Lucene å¼åãElasticSearch éèäº Lucene çå¤ææ§ï¼æä¾äºç®åæç¨ç REST API / Java API æ¥å£ï¼å¦å¤è¿æå¶ä»è¯­è¨ç API æ¥å£ï¼ã\n> \n> ä»¥ä¸ç®ç§° ESã\n> \n> REST API æè¯¦å°½çææ¡£åºè¯¥åèï¼ES å®æ¹ REST API\n\n\n# ElasticSearch Rest API è¯­æ³æ ¼å¼\n\nå Elasticsearch ååºçè¯·æ±çç»æé¨åä¸å¶å®æ®éç HTTP è¯·æ±æ¯ä¸æ ·çï¼\n\ncurl -X<VERB> \'<PROTOCOL>://<HOST>:<PORT>/<PATH>?<QUERY_STRING>\' -d \'<BODY>\'\n\n\n * VERBï¼HTTP æ¹æ³ï¼æ¯æï¼GET, POST, PUT, HEAD, DELETE\n * PROTOCOLï¼http æè https åè®®ï¼åªæå¨ Elasticsearch åé¢æ https ä»£ççæ¶åå¯ç¨ï¼\n * HOSTï¼Elasticsearch éç¾¤ä¸­çä»»ä½ä¸ä¸ªèç¹çä¸»æºåï¼å¦ææ¯å¨æ¬å°çèç¹ï¼é£ä¹å°±å« localhost\n * PORTï¼Elasticsearch HTTP æå¡æå¨çç«¯å£ï¼é»è®¤ä¸º 9200 PATH API è·¯å¾ï¼ä¾å¦_count å°è¿åéç¾¤ä¸­ææ¡£çæ°éï¼ï¼\n * PATHï¼å¯ä»¥åå«å¤ä¸ªç»ä»¶ï¼ä¾å¦ _cluster/stats æè _nodes/stats/jvm\n * QUERY_STRINGï¼ä¸äºå¯éçæ¥è¯¢è¯·æ±åæ°ï¼ä¾å¦?pretty åæ°å°ä½¿è¯·æ±è¿åæ´å ç¾è§æè¯»ç JSON æ°æ®\n * BODYï¼ä¸ä¸ª JSON æ ¼å¼çè¯·æ±ä¸»ä½ï¼å¦æè¯·æ±éè¦çè¯ï¼\n\nElasticSearch Rest API åä¸ºä¸¤ç§ï¼\n\n * URI Searchï¼å¨ URL ä¸­ä½¿ç¨æ¥è¯¢åæ°\n * Request Body Searchï¼åºäº JSON æ ¼å¼çãæ´å å®å¤ç DSL\n\nURI Search ç¤ºä¾ï¼\n\n\n\nRequest Body Search ç¤ºä¾ï¼\n\n\n\n\n# ç´¢å¼ API\n\n> åèèµæï¼Elasticsearch å®æ¹ä¹ cat ç´¢å¼ API\n\n\n# åå»ºç´¢å¼\n\næ°å»º Indexï¼å¯ä»¥ç´æ¥å ES æå¡å¨ååº PUT è¯·æ±ã\n\nè¯­æ³æ ¼å¼ï¼\n\nPUT /my_index\n{\n    "settings": { ... any settings ... },\n    "mappings": {\n        "type_one": { ... any mappings ... },\n        "type_two": { ... any mappings ... },\n        ...\n    }\n}\n\n\nç¤ºä¾ï¼\n\nPUT /user\n{\n  "settings": {\n    "index": {\n      "number_of_shards": 3,\n      "number_of_replicas": 2\n    }\n  }\n}\n\n\næå¡å¨è¿åä¸ä¸ª JSON å¯¹è±¡ï¼éé¢ç acknowledged å­æ®µè¡¨ç¤ºæä½æåã\n\n{"acknowledged":true,"shards_acknowledged":true,"index":"user"}\n\n\nå¦æä½ æ³ç¦æ­¢èªå¨åå»ºç´¢å¼ï¼å¯ä»¥éè¿å¨ config/elasticsearch.yml çæ¯ä¸ªèç¹ä¸æ·»å ä¸é¢çéç½®ï¼\n\naction.auto_create_index: false\n\n\n\n# å é¤ç´¢å¼\n\nç¶åï¼æä»¬å¯ä»¥éè¿åé DELETE è¯·æ±ï¼å é¤è¿ä¸ª Indexã\n\nDELETE /user\n\n\nå é¤å¤ä¸ªç´¢å¼\n\nDELETE /index_one,index_two\nDELETE /index_*\n\n\n\n# æ¥çç´¢å¼\n\nå¯ä»¥éè¿ GET è¯·æ±æ¥çç´¢å¼ä¿¡æ¯\n\n# æ¥çç´¢å¼ç¸å³ä¿¡æ¯\nGET kibana_sample_data_ecommerce\n\n# æ¥çç´¢å¼çææ¡£æ»æ°\nGET kibana_sample_data_ecommerce/_count\n\n# æ¥çå10æ¡ææ¡£ï¼äºè§£ææ¡£æ ¼å¼\nGET kibana_sample_data_ecommerce/_search\n\n# _cat indices API\n# æ¥çindices\nGET /_cat/indices/kibana*?v&s=index\n\n# æ¥çç¶æä¸ºç»¿çç´¢å¼\nGET /_cat/indices?v&health=green\n\n# æç§ææ¡£ä¸ªæ°æåº\nGET /_cat/indices?v&s=docs.count:desc\n\n# æ¥çå·ä½çå­æ®µ\nGET /_cat/indices/kibana*?pri&v&h=health,index,pri,rep,docs.count,mt\n\n# æ¥çç´¢å¼å ç¨çåå­\nGET /_cat/indices?v&h=i,tm&s=tm:desc\n\n\n\n# ç´¢å¼å«å\n\nES çç´¢å¼å«åå°±æ¯ç»ä¸ä¸ªç´¢å¼æèå¤ä¸ªç´¢å¼èµ·çå¦ä¸ä¸ªåå­ï¼å¸åçåºç¨åºæ¯æ¯éå¯¹ç´¢å¼ä½¿ç¨çå¹³æ»åæ¢ã\n\né¦åï¼åå»ºç´¢å¼ my_indexï¼ç¶åå°å«å my_alias æåå®ï¼ç¤ºä¾å¦ä¸ï¼\n\nPUT /my_index\nPUT /my_index/_alias/my_alias\n\n\nä¹å¯ä»¥éè¿å¦ä¸å½¢å¼ï¼\n\nPOST /_aliases\n{\n  "actions": [\n    { "add": { "index": "my_index", "alias": "my_alias" }}\n  ]\n}\n\n\nä¹å¯ä»¥å¨ä¸æ¬¡è¯·æ±ä¸­å¢å å«ååç§»é¤å«åæ··åä½¿ç¨ï¼\n\nPOST /_aliases\n{\n  "actions": [\n    { "remove": { "index": "my_index", "alias": "my_alias" }}\n    { "add": { "index": "my_index_v2", "alias": "my_alias" }}\n  ]\n}\n\n\n> éè¦æ³¨æçæ¯ï¼å¦æå«åä¸ç´¢å¼æ¯ä¸å¯¹ä¸çï¼ä½¿ç¨å«åç´¢å¼ææ¡£æèæ¥è¯¢ææ¡£æ¯å¯ä»¥çï¼ä½æ¯å¦æå«ååç´¢å¼æ¯ä¸å¯¹å¤çï¼ä½¿ç¨å«åä¼åçéè¯¯ï¼å ä¸º ES ä¸ç¥éæææ¡£åå¥åªä¸ªç´¢å¼ä¸­å»æèä»åªä¸ªç´¢å¼ä¸­è¯»åææ¡£ã\n\nES ç´¢å¼å«åæä¸ªå¸åçåºç¨åºæ¯æ¯å¹³æ»åæ¢ï¼æ´å¤ç»èå¯ä»¥æ¥ç Elasticsearchï¼ESï¼ç´¢å¼é¶åæºï¼æ ééå¯ï¼æ ç¼å¹³æ»åæ¢çæ¹æ³ã\n\n\n# æå¼/å³é­ç´¢å¼\n\néè¿å¨ POST ä¸­æ·»å  _close æ _open å¯ä»¥æå¼ãå³é­ç´¢å¼ã\n\næå¼ç´¢å¼\n\n# æå¼ç´¢å¼\nPOST kibana_sample_data_ecommerce/_open\n# å³é­ç´¢å¼\nPOST kibana_sample_data_ecommerce/_close\n\n\n\n# ææ¡£\n\n############Create Document############\n#create document. èªå¨çæ _id\nPOST users/_doc\n{\n\t"user" : "Mike",\n    "post_date" : "2019-04-15T14:12:12",\n    "message" : "trying out Kibana"\n}\n\n#create document. æå®Idãå¦æidå·²ç»å­å¨ï¼æ¥é\nPUT users/_doc/1?op_type=create\n{\n    "user" : "Jack",\n    "post_date" : "2019-05-15T14:12:12",\n    "message" : "trying out Elasticsearch"\n}\n\n#create document. æå® ID å¦æå·²ç»å­å¨ï¼å°±æ¥é\nPUT users/_create/1\n{\n     "user" : "Jack",\n    "post_date" : "2019-05-15T14:12:12",\n    "message" : "trying out Elasticsearch"\n}\n\n### Get Document by ID\n#Get the document by ID\nGET users/_doc/1\n\n\n###  Index & Update\n#Update æå® ID  (åå é¤ï¼å¨åå¥)\nGET users/_doc/1\n\nPUT users/_doc/1\n{\n\t"user" : "Mike"\n\n}\n\n\n#GET users/_doc/1\n#å¨åææ¡£ä¸å¢å å­æ®µ\nPOST users/_update/1/\n{\n    "doc":{\n        "post_date" : "2019-05-15T14:12:12",\n        "message" : "trying out Elasticsearch"\n    }\n}\n\n\n\n### Delete by Id\n# å é¤ææ¡£\nDELETE users/_doc/1\n\n\n### Bulk æä½\n#æ§è¡ä¸¤æ¬¡ï¼æ¥çæ¯æ¬¡çç»æ\n\n#æ§è¡ç¬¬1æ¬¡\nPOST _bulk\n{ "index" : { "_index" : "test", "_id" : "1" } }\n{ "field1" : "value1" }\n{ "delete" : { "_index" : "test", "_id" : "2" } }\n{ "create" : { "_index" : "test2", "_id" : "3" } }\n{ "field1" : "value3" }\n{ "update" : {"_id" : "1", "_index" : "test"} }\n{ "doc" : {"field2" : "value2"} }\n\n\n#æ§è¡ç¬¬2æ¬¡\nPOST _bulk\n{ "index" : { "_index" : "test", "_id" : "1" } }\n{ "field1" : "value1" }\n{ "delete" : { "_index" : "test", "_id" : "2" } }\n{ "create" : { "_index" : "test2", "_id" : "3" } }\n{ "field1" : "value3" }\n{ "update" : {"_id" : "1", "_index" : "test"} }\n{ "doc" : {"field2" : "value2"} }\n\n### mget æä½\nGET /_mget\n{\n    "docs" : [\n        {\n            "_index" : "test",\n            "_id" : "1"\n        },\n        {\n            "_index" : "test",\n            "_id" : "2"\n        }\n    ]\n}\n\n\n#URIä¸­æå®index\nGET /test/_mget\n{\n    "docs" : [\n        {\n\n            "_id" : "1"\n        },\n        {\n\n            "_id" : "2"\n        }\n    ]\n}\n\n\nGET /_mget\n{\n    "docs" : [\n        {\n            "_index" : "test",\n            "_id" : "1",\n            "_source" : false\n        },\n        {\n            "_index" : "test",\n            "_id" : "2",\n            "_source" : ["field3", "field4"]\n        },\n        {\n            "_index" : "test",\n            "_id" : "3",\n            "_source" : {\n                "include": ["user"],\n                "exclude": ["user.location"]\n            }\n        }\n    ]\n}\n\n### msearch æä½\nPOST kibana_sample_data_ecommerce/_msearch\n{}\n{"query" : {"match_all" : {}},"size":1}\n{"index" : "kibana_sample_data_flights"}\n{"query" : {"match_all" : {}},"size":2}\n\n\n### æ¸é¤æµè¯æ°æ®\n#æ¸é¤æ°æ®\nDELETE users\nDELETE test\nDELETE test2\n\n\n\n# åå»ºææ¡£\n\n# æå® ID\n\nè¯­æ³æ ¼å¼ï¼\n\nPUT /_index/_type/_create/_id\n\n\nç¤ºä¾ï¼\n\nPUT /user/_doc/_create/1\n{\n  "user": "å¼ ä¸",\n  "title": "å·¥ç¨å¸",\n  "desc": "æ°æ®åºç®¡ç"\n}\n\n\n> æ³¨æï¼æå® Idï¼å¦æ id å·²ç»å­å¨ï¼åæ¥é\n\n# èªå¨çæ ID\n\næ°å¢è®°å½çæ¶åï¼ä¹å¯ä»¥ä¸æå® Idï¼è¿æ¶è¦æ¹æ POST è¯·æ±ã\n\nè¯­æ³æ ¼å¼ï¼\n\nPOST /_index/_type\n\n\nç¤ºä¾ï¼\n\nPOST /user/_doc\n{\n  "user": "å¼ ä¸",\n  "title": "å·¥ç¨å¸",\n  "desc": "è¶çº§ç®¡çå"\n}\n\n\n\n# å é¤ææ¡£\n\nè¯­æ³æ ¼å¼ï¼\n\nDELETE /_index/_doc/_id\n\n\nç¤ºä¾ï¼\n\nDELETE /user/_doc/1\n\n\n\n# æ´æ°ææ¡£\n\n# åå é¤ï¼ååå¥\n\nè¯­æ³æ ¼å¼ï¼\n\nPUT /_index/_type/_id\n\n\nç¤ºä¾ï¼\n\nPUT /user/_doc/1\n{\n  "user": "æå",\n  "title": "å·¥ç¨å¸",\n  "desc": "è¶çº§ç®¡çå"\n}\n\n\n# å¨åææ¡£ä¸å¢å å­æ®µ\n\nè¯­æ³æ ¼å¼ï¼\n\nPOST /_index/_update/_id\n\n\nç¤ºä¾ï¼\n\nPOST /user/_update/1\n{\n    "doc":{\n        "age" : "30"\n    }\n}\n\n\n\n# æ¥è¯¢ææ¡£\n\n# æå® ID æ¥è¯¢\n\nè¯­æ³æ ¼å¼ï¼\n\nGET /_index/_type/_id\n\n\nç¤ºä¾ï¼\n\nGET /user/_doc/1\n\n\nç»æï¼\n\n{\n  "_index": "user",\n  "_type": "_doc",\n  "_id": "1",\n  "_version": 1,\n  "_seq_no": 536248,\n  "_primary_term": 2,\n  "found": true,\n  "_source": {\n    "user": "å¼ ä¸",\n    "title": "å·¥ç¨å¸",\n    "desc": "æ°æ®åºç®¡ç"\n  }\n}\n\n\nè¿åçæ°æ®ä¸­ï¼found å­æ®µè¡¨ç¤ºæ¥è¯¢æåï¼_source å­æ®µè¿ååå§è®°å½ã\n\nå¦æ id ä¸æ­£ç¡®ï¼å°±æ¥ä¸å°æ°æ®ï¼found å­æ®µå°±æ¯ false\n\n# æ¥è¯¢ææè®°å½\n\nä½¿ç¨ GET æ¹æ³ï¼ç´æ¥è¯·æ± /index/type/_searchï¼å°±ä¼è¿åææè®°å½ã\n\n$ curl \'localhost:9200/user/admin/_search?pretty\'\n{\n  "took" : 1,\n  "timed_out" : false,\n  "_shards" : {\n    "total" : 3,\n    "successful" : 3,\n    "skipped" : 0,\n    "failed" : 0\n  },\n  "hits" : {\n    "total" : 2,\n    "max_score" : 1.0,\n    "hits" : [\n      {\n        "_index" : "user",\n        "_type" : "admin",\n        "_id" : "WWuoDG8BHwECs7SiYn93",\n        "_score" : 1.0,\n        "_source" : {\n          "user" : "æå",\n          "title" : "å·¥ç¨å¸",\n          "desc" : "ç³»ç»ç®¡ç"\n        }\n      },\n      {\n        "_index" : "user",\n        "_type" : "admin",\n        "_id" : "1",\n        "_score" : 1.0,\n        "_source" : {\n          "user" : "å¼ ä¸",\n          "title" : "å·¥ç¨å¸",\n          "desc" : "è¶çº§ç®¡çå"\n        }\n      }\n    ]\n  }\n}\n\n\nä¸é¢ä»£ç ä¸­ï¼è¿åç»æç tookå­æ®µè¡¨ç¤ºè¯¥æä½çèæ¶ï¼åä½ä¸ºæ¯«ç§ï¼ï¼timed_outå­æ®µè¡¨ç¤ºæ¯å¦è¶æ¶ï¼hitså­æ®µè¡¨ç¤ºå½ä¸­çè®°å½ï¼éé¢å­å­æ®µçå«ä¹å¦ä¸ã\n\n * totalï¼è¿åè®°å½æ°ï¼æ¬ä¾æ¯ 2 æ¡ã\n * max_scoreï¼æé«çå¹éç¨åº¦ï¼æ¬ä¾æ¯1.0ã\n * hitsï¼è¿åçè®°å½ç»æçæ°ç»ã\n\nè¿åçè®°å½ä¸­ï¼æ¯æ¡è®°å½é½æä¸ä¸ª_scoreå­æ®µï¼è¡¨ç¤ºå¹éçç¨åºï¼é»è®¤æ¯æç§è¿ä¸ªå­æ®µéåºæåã\n\n\n# å¨ææç´¢\n\nES çæ¥è¯¢éå¸¸ç¹å«ï¼ä½¿ç¨èªå·±çæ¥è¯¢è¯­æ³ï¼è¦æ± GET è¯·æ±å¸¦ææ°æ®ä½ã\n\n$ curl -H \'Content-Type: application/json\' \'localhost:9200/user/admin/_search?pretty\'  -d \'\n{\n"query" : { "match" : { "desc" : "ç®¡ç" }}\n}\'\n\n\nä¸é¢ä»£ç ä½¿ç¨ Match æ¥è¯¢ï¼æå®çå¹éæ¡ä»¶æ¯descå­æ®µéé¢åå«"è½¯ä»¶"è¿ä¸ªè¯ãè¿åç»æå¦ä¸ã\n\n{\n  "took" : 2,\n  "timed_out" : false,\n  "_shards" : {\n    "total" : 3,\n    "successful" : 3,\n    "skipped" : 0,\n    "failed" : 0\n  },\n  "hits" : {\n    "total" : 2,\n    "max_score" : 0.38200712,\n    "hits" : [\n      {\n        "_index" : "user",\n        "_type" : "admin",\n        "_id" : "WWuoDG8BHwECs7SiYn93",\n        "_score" : 0.38200712,\n        "_source" : {\n          "user" : "æå",\n          "title" : "å·¥ç¨å¸",\n          "desc" : "ç³»ç»ç®¡ç"\n        }\n      },\n      {\n        "_index" : "user",\n        "_type" : "admin",\n        "_id" : "1",\n        "_score" : 0.3487891,\n        "_source" : {\n          "user" : "å¼ ä¸",\n          "title" : "å·¥ç¨å¸",\n          "desc" : "è¶çº§ç®¡çå"\n        }\n      }\n    ]\n  }\n}\n\n\nElastic é»è®¤ä¸æ¬¡è¿å 10 æ¡ç»æï¼å¯ä»¥éè¿sizeå­æ®µæ¹åè¿ä¸ªè®¾ç½®ï¼è¿å¯ä»¥éè¿fromå­æ®µï¼æå®ä½ç§»ã\n\n$ curl \'localhost:9200/user/admin/_search\'  -d \'\n{\n  "query" : { "match" : { "desc" : "ç®¡ç" }},\n  "from": 1,\n  "size": 1\n}\'\n\n\nä¸é¢ä»£ç æå®ï¼ä»ä½ç½® 1 å¼å§ï¼é»è®¤æ¯ä»ä½ç½® 0 å¼å§ï¼ï¼åªè¿åä¸æ¡ç»æã\n\n\n# é»è¾è¿ç®\n\nå¦ææå¤ä¸ªæç´¢å³é®å­ï¼ Elastic è®¤ä¸ºå®ä»¬æ¯orå³ç³»ã\n\n$ curl \'localhost:9200/user/admin/_search\'  -d \'\n{\n"query" : { "match" : { "desc" : "è½¯ä»¶ ç³»ç»" }}\n}\'\n\n\nä¸é¢ä»£ç æç´¢çæ¯è½¯ä»¶ or ç³»ç»ã\n\nå¦æè¦æ§è¡å¤ä¸ªå³é®è¯çandæç´¢ï¼å¿é¡»ä½¿ç¨å¸å°æ¥è¯¢ã\n\n$ curl -H \'Content-Type: application/json\' \'localhost:9200/user/admin/_search?pretty\'  -d \'\n{\n "query": {\n  "bool": {\n   "must": [\n    { "match": { "desc": "ç®¡ç" } },\n    { "match": { "desc": "è¶çº§" } }\n   ]\n  }\n }\n}\'\n\n\n\n# æ¹éæ§è¡\n\næ¯æå¨ä¸æ¬¡ API è°ç¨ä¸­ï¼å¯¹ä¸åçç´¢å¼è¿è¡æä½\n\næ¯æåç§ç±»åæä½\n\n * index\n * create\n * update\n * delete\n\næä½ä¸­åæ¡æä½å¤±è´¥ï¼å¹¶ä¸ä¼å½±åå¶ä»æä½ã\n\nè¿åç»æåæ¬äºæ¯ä¸æ¡æä½æ§è¡çç»æã\n\nPOST _bulk\n{ "index" : { "_index" : "test", "_id" : "1" } }\n{ "field1" : "value1" }\n{ "delete" : { "_index" : "test", "_id" : "2" } }\n{ "create" : { "_index" : "test2", "_id" : "3" } }\n{ "field1" : "value3" }\n{ "update" : {"_id" : "1", "_index" : "test"} }\n{ "doc" : {"field2" : "value2"} }\n\n\n> è¯´æï¼ä¸é¢çç¤ºä¾å¦ææ§è¡å¤æ¬¡ï¼æ§è¡ç»æé½ä¸ä¸æ ·ã\n\n\n# æ¹éè¯»å\n\nè¯»å¤ä¸ªç´¢å¼\n\nGET /_mget\n{\n    "docs" : [\n        {\n            "_index" : "test",\n            "_id" : "1"\n        },\n        {\n            "_index" : "test",\n            "_id" : "2"\n        }\n    ]\n}\n\n\nè¯»ä¸ä¸ªç´¢å¼\n\nGET /test/_mget\n{\n    "docs" : [\n        {\n\n            "_id" : "1"\n        },\n        {\n\n            "_id" : "2"\n        }\n    ]\n}\n\nGET /_mget\n{\n    "docs" : [\n        {\n            "_index" : "test",\n            "_id" : "1",\n            "_source" : false\n        },\n        {\n            "_index" : "test",\n            "_id" : "2",\n            "_source" : ["field3", "field4"]\n        },\n        {\n            "_index" : "test",\n            "_id" : "3",\n            "_source" : {\n                "include": ["user"],\n                "exclude": ["user.location"]\n            }\n        }\n    ]\n}\n\n\n\n# æ¹éæ¥è¯¢\n\nPOST kibana_sample_data_ecommerce/_msearch\n{}\n{"query" : {"match_all" : {}},"size":1}\n{"index" : "kibana_sample_data_flights"}\n{"query" : {"match_all" : {}},"size":2}\n\n\n\n# URI Search æ¥è¯¢è¯­ä¹\n\nElasticsearch URI Search éµå¾ª QueryString æ¥è¯¢è¯­ä¹ï¼å¶å½¢å¼å¦ä¸ï¼\n\nGET /movies/_search?q=2012&df=title&sort=year:desc&from=0&size=10&timeout=1s\n{\n\t"profile": true\n}\n\n\n * q æå®æ¥è¯¢è¯­å¥ï¼ä½¿ç¨ QueryString è¯­ä¹\n * df é»è®¤å­æ®µï¼ä¸æå®æ¶\n * sort æåºï¼from å size ç¨äºåé¡µ\n * profile å¯ä»¥æ¥çæ¥è¯¢æ¶å¦ä½è¢«æ§è¡ç\n\nGET /movies/_search?q=title:2012&sort=year:desc&from=0&size=10&timeout=1s\n{\n\t"profile":"true"\n}\n\n\n# Term å Phrase\n\nBeautiful Mind ç­æäº Beautiful OR Mind\n\n"Beautiful Mind" ç­æäº Beautiful AND Mind\n\n# Term æ¥è¯¢\nGET /movies/_search?q=title:Beautiful Mind\n{\n\t"profile":"true"\n}\n\n# ä½¿ç¨å¼å·ï¼Phrase æ¥è¯¢\nGET /movies/_search?q=title:"Beautiful Mind"\n{\n\t"profile":"true"\n}\n\n\n# åç»ä¸å¼å·\n\ntitle:(Beautiful AND Mind)\n\ntitle="Beautiful Mind"\n\n# ANDãORãNOT æè &&ã||ã!\n\n> æ³¨æï¼ANDãORãNOT å¿é¡»å¤§å\n\n# å¸å°æä½ç¬¦\nGET /movies/_search?q=title:(Beautiful AND Mind)\n{\n\t"profile":"true"\n}\n\nGET /movies/_search?q=title:(Beautiful NOT Mind)\n{\n\t"profile":"true"\n}\n\n\n# èå´æ¥è¯¢\n\n * [] è¡¨ç¤ºé­åºé´\n * {} è¡¨ç¤ºå¼åºé´\n\nç¤ºä¾ï¼\n\n# èå´æ¥è¯¢ ,åºé´åæ³\nGET /movies/_search?q=title:beautiful AND year:{2010 TO 2018%7D\n{\n\t"profile":"true"\n}\n\nGET /movies/_search?q=title:beautiful AND year:[* TO 2018]\n{\n\t"profile":"true"\n}\n\n\n# ç®æ°ç¬¦å·\n\n# 2010 å¹´ä»¥åçè®°å½\nGET /movies/_search?q=year:>2010\n{\n\t"profile":"true"\n}\n\n# 2010 å¹´å° 2018 å¹´çè®°å½\nGET /movies/_search?q=year:(>2010 && <=2018)\n{\n\t"profile":"true"\n}\n\n# 2010 å¹´å° 2018 å¹´çè®°å½\nGET /movies/_search?q=year:(+>2010 +<=2018)\n{\n\t"profile":"true"\n}\n\n\n# ééç¬¦æ¥è¯¢\n\n * ? ä»£è¡¨ 1 ä¸ªå­ç¬¦\n * * ä»£è¡¨ 0 æå¤ä¸ªå­ç¬¦\n\nç¤ºä¾ï¼\n\nGET /movies/_search?q=title:mi?d\n{\n\t"profile":"true"\n}\n\nGET /movies/_search?q=title:b*\n{\n\t"profile":"true"\n}\n\n\n# æ­£åè¡¨è¾¾å¼\n\ntitle:[bt]oy\n\n# æ¨¡ç³å¹éä¸è¿ä¼¼æ¥è¯¢\n\nç¤ºä¾ï¼\n\n# ç¸ä¼¼åº¦å¨ 1 ä¸ªå­ç¬¦ä»¥å\nGET /movies/_search?q=title:beautifl~1\n{\n\t"profile":"true"\n}\n\n# ç¸ä¼¼åº¦å¨ 2 ä¸ªå­ç¬¦ä»¥å\nGET /movies/_search?q=title:"Lord Rings"~2\n{\n\t"profile":"true"\n}\n\n\n\n# Request Body & DSL\n\nElasticsearch é¤äº URI Search æ¥è¯¢æ¹å¼ï¼è¿æ¯æå°æ¥è¯¢è¯­å¥éè¿ Http Request Body åèµ·æ¥è¯¢ã\n\nGET /kibana_sample_data_ecommerce/_search?ignore_unavailable=true\n{\n\t"profile":"true",\n\t"query": {\n\t  "match_all": {}\n\t}\n}\n\n\n# åé¡µ\n\nGET /kibana_sample_data_ecommerce/_search?ignore_unavailable=true\n{\n  "profile": "true",\n  "from": 0,\n  "size": 10,\n  "query": {\n    "match_all": {}\n  }\n}\n\n\n# æåº\n\næå¥½å¨æ°å­åææ¥æåå­æ®µä¸æåº\n\nå ä¸ºå¯¹äºå¤å¼ç±»åæåæè¿çå­æ®µæåºï¼ç³»ç»ä¼éä¸ä¸ªå¼ï¼æ æ³å¾ç¥è¯¥å¼\n\nGET /kibana_sample_data_ecommerce/_search?ignore_unavailable=true\n{\n  "profile": "true",\n  "sort": [\n    {\n      "order_date": "desc"\n    }\n  ],\n  "from": 1,\n  "size": 10,\n  "query": {\n    "match_all": {}\n  }\n}\n\n\n# _source è¿æ»¤\n\nå¦æ _source æ²¡æå­å¨ï¼é£å°±åªè¿åå¹éçææ¡£çåæ°æ®\n\n_source æ¯æä½¿ç¨ééç¬¦ï¼å¦ï¼_source["name*", "desc*"]\n\nç¤ºä¾ï¼\n\nGET /kibana_sample_data_ecommerce/_search?ignore_unavailable=true\n{\n  "profile": "true",\n  "_source": [\n    "order_date",\n    "category.keyword"\n  ],\n  "from": 1,\n  "size": 10,\n  "query": {\n    "match_all": {}\n  }\n}\n\n\n# èæ¬å­æ®µ\n\nGET /kibana_sample_data_ecommerce/_search?ignore_unavailable=true\n{\n  "profile": "true",\n  "script_fields": {\n    "new_field": {\n      "script": {\n        "lang": "painless",\n        "source":"doc[\'order_date\'].value+\' hello\'"\n      }\n    }\n  },\n  "from": 1,\n  "size": 10,\n  "query": {\n    "match_all": {}\n  }\n}\n\n\n\n# ä½¿ç¨æ¥è¯¢è¡¨è¾¾å¼ - Match\n\nPOST movies/_search\n{\n  "query": {\n    "match": {\n      "title": "last christmas"\n    }\n  }\n}\n\nPOST movies/_search\n{\n  "query": {\n    "match": {\n      "title": {\n        "query": "last christmas",\n        "operator": "and"\n      }\n    }\n  }\n}\n\n\n\n# ç­è¯­æç´¢ - Match Phrase\n\nPOST movies/_search\n{\n  "query": {\n    "match_phrase": {\n      "title":{\n        "query": "last christmas"\n\n      }\n    }\n  }\n}\n\n\n\n# éç¾¤ API\n\n> Elasticsearch å®æ¹ä¹ Cluster API\n\nä¸äºéç¾¤çº§å«ç API å¯è½ä¼å¨èç¹çå­éä¸è¿è¡ï¼è¿äºèç¹å¯ä»¥ç¨èç¹è¿æ»¤å¨æå®ãä¾å¦ï¼ä»»å¡ç®¡çãèç¹ç»è®¡åèç¹ä¿¡æ¯ API é½å¯ä»¥æ¥åæ¥èªä¸ç»è¿æ»¤èç¹èä¸æ¯ææèç¹çç»æã\n\nèç¹è¿æ»¤å¨ä»¥éå·åéçåä¸ªè¿æ»¤å¨åè¡¨çå½¢å¼ç¼åï¼æ¯ä¸ªè¿æ»¤å¨ä»æéå­éä¸­æ·»å æå é¤èç¹ãæ¯ä¸ªè¿æ»¤å¨å¯ä»¥æ¯ä»¥ä¸ä¹ä¸ï¼\n\n * _allï¼å°ææèç¹æ·»å å°å­é\n * _localï¼å°æ¬å°èç¹æ·»å å°å­é\n * _masterï¼å°å½åä¸»èç¹æ·»å å°å­é\n * æ ¹æ®èç¹ ID æèç¹åå°å¹éèç¹æ·»å å°å­é\n * æ ¹æ® IP å°åæä¸»æºåå°å¹éèç¹æ·»å å°å­é\n * ä½¿ç¨ééç¬¦ï¼å°èç¹åãå°ååæä¸»æºåå¹éçèç¹æ·»å å°å­é\n * master:true, data:true, ingest:true, voting_only:true, ml:true æ coordinating_only:true, åå«æå³çå°ææä¸»èç¹ãæææ°æ®èç¹ãæææåèç¹ãææä»æç¥¨èç¹ãæææºå¨å­¦ä¹ èç¹åææåè°èç¹æ·»å å°å­éä¸­ã\n * master:false, data:false, ingest:false, voting_only:true, ml:false æ coordinating_only:false, åå«æå³çå°ææä¸»èç¹ãæææ°æ®èç¹ãæææåèç¹ãææä»æç¥¨èç¹ãæææºå¨å­¦ä¹ èç¹åææåè°èç¹æé¤å¨å­éå¤ã\n * éå¯¹æ¨¡å¼ï¼ä½¿ç¨ * ééç¬¦ï¼æ ¼å¼ä¸º attrname:attrvalueï¼å°ææå·æèªå®ä¹èç¹å±æ§çèç¹æ·»å å°å­éä¸­ï¼å¶åç§°åå¼ä¸ç¸åºçæ¨¡å¼å¹éãèªå®ä¹èç¹å±æ§æ¯éè¿ node.attr.attrname: attrvalue å½¢å¼å¨éç½®æä»¶ä¸­è®¾ç½®çã\n\n# å¦ææ²¡æç»åºè¿æ»¤å¨ï¼é»è®¤æ¯æ¥è¯¢ææèç¹\nGET /_nodes\n# æ¥è¯¢ææèç¹\nGET /_nodes/_all\n# æ¥è¯¢æ¬å°èç¹\nGET /_nodes/_local\n# æ¥è¯¢ä¸»èç¹\nGET /_nodes/_master\n# æ ¹æ®åç§°æ¥è¯¢èç¹ï¼æ¯æééç¬¦ï¼\nGET /_nodes/node_name_goes_here\nGET /_nodes/node_name_goes_*\n# æ ¹æ®å°åæ¥è¯¢èç¹ï¼æ¯æééç¬¦ï¼\nGET /_nodes/10.0.0.3,10.0.0.4\nGET /_nodes/10.0.0.*\n# æ ¹æ®è§åæ¥è¯¢èç¹\nGET /_nodes/_all,master:false\nGET /_nodes/data:true,ingest:true\nGET /_nodes/coordinating_only:true\nGET /_nodes/master:true,voting_only:false\n# æ ¹æ®èªå®ä¹å±æ§æ¥è¯¢èç¹ï¼å¦ï¼æ¥è¯¢éç½®æä»¶ä¸­å« node.attr.rack:2 å±æ§çèç¹ï¼\nGET /_nodes/rack:2\nGET /_nodes/ra*:2\nGET /_nodes/ra*:2*\n\n\n\n# éç¾¤å¥åº· API\n\nGET /_cluster/health\nGET /_cluster/health?level=shards\nGET /_cluster/health/kibana_sample_data_ecommerce,kibana_sample_data_flights\nGET /_cluster/health/kibana_sample_data_flights?level=shards\n\n\n\n# éç¾¤ç¶æ API\n\néç¾¤ç¶æ API è¿åè¡¨ç¤ºæ´ä¸ªéç¾¤ç¶æçåæ°æ®ã\n\nGET /_cluster/state\n\n\n\n# èç¹ API\n\n> Elasticsearch å®æ¹ä¹ cat Nodes APIââè¿åæå³éç¾¤èç¹çä¿¡æ¯ã\n\n# æ¥çé»è®¤çå­æ®µ\nGET /_cat/nodes?v=true\n# æ¥çæå®çå­æ®µ\nGET /_cat/nodes?v=true&h=id,ip,port,v,m\n\n\n\n# åç API\n\n> Elasticsearch å®æ¹ä¹ cat Shards APIââshards å½ä»¤æ¯åªäºèç¹åå«åªäºåççè¯¦ç»è§å¾ãå®ä¼åè¯ä½ å®æ¯ä¸»è¿æ¯å¯æ¬ãææ¡£æ°éãå®å¨ç£çä¸å ç¨çå­èæ°ä»¥åå®æå¨çèç¹ã\n\n# æ¥çé»è®¤çå­æ®µ\nGET /_cat/shards\n# æ ¹æ®åç§°æ¥è¯¢åçï¼æ¯æééç¬¦ï¼\nGET /_cat/shards/my-index-*\n# æ¥çæå®çå­æ®µ\nGET /_cat/shards?h=index,shard,prirep,state,unassigned.reason\n\n\n\n# çæ§ API\n\nElasticsearch ä¸­éç¾¤ç¸å³çå¥åº·ãç»è®¡ç­ç¸å³çä¿¡æ¯é½æ¯å´ç»ç cat API è¿è¡çã\n\néè¿ GET è¯·æ±åé catï¼ä¸é¢ååºäºææå¯ç¨ç APIï¼\n\nGET /_cat\n\n=^.^=\n/_cat/allocation\n/_cat/shards\n/_cat/shards/{index}\n/_cat/master\n/_cat/nodes\n/_cat/tasks\n/_cat/indices\n/_cat/indices/{index}\n/_cat/segments\n/_cat/segments/{index}\n/_cat/count\n/_cat/count/{index}\n/_cat/recovery\n/_cat/recovery/{index}\n/_cat/health\n/_cat/pending_tasks\n/_cat/aliases\n/_cat/aliases/{alias}\n/_cat/thread_pool\n/_cat/thread_pool/{thread_pools}\n/_cat/plugins\n/_cat/fielddata\n/_cat/fielddata/{fields}\n/_cat/nodeattrs\n/_cat/repositories\n/_cat/snapshots/{repository}\n/_cat/templates\n\n\n\n# åèèµæ\n\n * å®æ¹\n   * Elasticsearch å®ç½\n   * Elasticsearch Github\n   * Elasticsearch å®æ¹ææ¡£',normalizedContent:'# elasticsearch rest api\n\n> elasticsearch æ¯ä¸ä¸ªåå¸å¼ãrestful é£æ ¼çæç´¢åæ°æ®åæå¼æï¼è½å¤è§£å³ä¸æ­æ¶ç°åºçåç§ç¨ä¾ã ä½ä¸º elastic stack çæ ¸å¿ï¼å®éä¸­å­å¨æ¨çæ°æ®ï¼å¸®å©æ¨åç°ææä¹ä¸­ä»¥åææä¹å¤çæåµã\n> \n> elasticsearch åºäºæç´¢åº lucene å¼åãelasticsearch éèäº lucene çå¤ææ§ï¼æä¾äºç®åæç¨ç rest api / java api æ¥å£ï¼å¦å¤è¿æå¶ä»è¯­è¨ç api æ¥å£ï¼ã\n> \n> ä»¥ä¸ç®ç§° esã\n> \n> rest api æè¯¦å°½çææ¡£åºè¯¥åèï¼es å®æ¹ rest api\n\n\n# elasticsearch rest api è¯­æ³æ ¼å¼\n\nå elasticsearch ååºçè¯·æ±çç»æé¨åä¸å¶å®æ®éç http è¯·æ±æ¯ä¸æ ·çï¼\n\ncurl -x<verb> \'<protocol>://<host>:<port>/<path>?<query_string>\' -d \'<body>\'\n\n\n * verbï¼http æ¹æ³ï¼æ¯æï¼get, post, put, head, delete\n * protocolï¼http æè https åè®®ï¼åªæå¨ elasticsearch åé¢æ https ä»£ççæ¶åå¯ç¨ï¼\n * hostï¼elasticsearch éç¾¤ä¸­çä»»ä½ä¸ä¸ªèç¹çä¸»æºåï¼å¦ææ¯å¨æ¬å°çèç¹ï¼é£ä¹å°±å« localhost\n * portï¼elasticsearch http æå¡æå¨çç«¯å£ï¼é»è®¤ä¸º 9200 path api è·¯å¾ï¼ä¾å¦_count å°è¿åéç¾¤ä¸­ææ¡£çæ°éï¼ï¼\n * pathï¼å¯ä»¥åå«å¤ä¸ªç»ä»¶ï¼ä¾å¦ _cluster/stats æè _nodes/stats/jvm\n * query_stringï¼ä¸äºå¯éçæ¥è¯¢è¯·æ±åæ°ï¼ä¾å¦?pretty åæ°å°ä½¿è¯·æ±è¿åæ´å ç¾è§æè¯»ç json æ°æ®\n * bodyï¼ä¸ä¸ª json æ ¼å¼çè¯·æ±ä¸»ä½ï¼å¦æè¯·æ±éè¦çè¯ï¼\n\nelasticsearch rest api åä¸ºä¸¤ç§ï¼\n\n * uri searchï¼å¨ url ä¸­ä½¿ç¨æ¥è¯¢åæ°\n * request body searchï¼åºäº json æ ¼å¼çãæ´å å®å¤ç dsl\n\nuri search ç¤ºä¾ï¼\n\n\n\nrequest body search ç¤ºä¾ï¼\n\n\n\n\n# ç´¢å¼ api\n\n> åèèµæï¼elasticsearch å®æ¹ä¹ cat ç´¢å¼ api\n\n\n# åå»ºç´¢å¼\n\næ°å»º indexï¼å¯ä»¥ç´æ¥å es æå¡å¨ååº put è¯·æ±ã\n\nè¯­æ³æ ¼å¼ï¼\n\nput /my_index\n{\n    "settings": { ... any settings ... },\n    "mappings": {\n        "type_one": { ... any mappings ... },\n        "type_two": { ... any mappings ... },\n        ...\n    }\n}\n\n\nç¤ºä¾ï¼\n\nput /user\n{\n  "settings": {\n    "index": {\n      "number_of_shards": 3,\n      "number_of_replicas": 2\n    }\n  }\n}\n\n\næå¡å¨è¿åä¸ä¸ª json å¯¹è±¡ï¼éé¢ç acknowledged å­æ®µè¡¨ç¤ºæä½æåã\n\n{"acknowledged":true,"shards_acknowledged":true,"index":"user"}\n\n\nå¦æä½ æ³ç¦æ­¢èªå¨åå»ºç´¢å¼ï¼å¯ä»¥éè¿å¨ config/elasticsearch.yml çæ¯ä¸ªèç¹ä¸æ·»å ä¸é¢çéç½®ï¼\n\naction.auto_create_index: false\n\n\n\n# å é¤ç´¢å¼\n\nç¶åï¼æä»¬å¯ä»¥éè¿åé delete è¯·æ±ï¼å é¤è¿ä¸ª indexã\n\ndelete /user\n\n\nå é¤å¤ä¸ªç´¢å¼\n\ndelete /index_one,index_two\ndelete /index_*\n\n\n\n# æ¥çç´¢å¼\n\nå¯ä»¥éè¿ get è¯·æ±æ¥çç´¢å¼ä¿¡æ¯\n\n# æ¥çç´¢å¼ç¸å³ä¿¡æ¯\nget kibana_sample_data_ecommerce\n\n# æ¥çç´¢å¼çææ¡£æ»æ°\nget kibana_sample_data_ecommerce/_count\n\n# æ¥çå10æ¡ææ¡£ï¼äºè§£ææ¡£æ ¼å¼\nget kibana_sample_data_ecommerce/_search\n\n# _cat indices api\n# æ¥çindices\nget /_cat/indices/kibana*?v&s=index\n\n# æ¥çç¶æä¸ºç»¿çç´¢å¼\nget /_cat/indices?v&health=green\n\n# æç§ææ¡£ä¸ªæ°æåº\nget /_cat/indices?v&s=docs.count:desc\n\n# æ¥çå·ä½çå­æ®µ\nget /_cat/indices/kibana*?pri&v&h=health,index,pri,rep,docs.count,mt\n\n# æ¥çç´¢å¼å ç¨çåå­\nget /_cat/indices?v&h=i,tm&s=tm:desc\n\n\n\n# ç´¢å¼å«å\n\nes çç´¢å¼å«åå°±æ¯ç»ä¸ä¸ªç´¢å¼æèå¤ä¸ªç´¢å¼èµ·çå¦ä¸ä¸ªåå­ï¼å¸åçåºç¨åºæ¯æ¯éå¯¹ç´¢å¼ä½¿ç¨çå¹³æ»åæ¢ã\n\né¦åï¼åå»ºç´¢å¼ my_indexï¼ç¶åå°å«å my_alias æåå®ï¼ç¤ºä¾å¦ä¸ï¼\n\nput /my_index\nput /my_index/_alias/my_alias\n\n\nä¹å¯ä»¥éè¿å¦ä¸å½¢å¼ï¼\n\npost /_aliases\n{\n  "actions": [\n    { "add": { "index": "my_index", "alias": "my_alias" }}\n  ]\n}\n\n\nä¹å¯ä»¥å¨ä¸æ¬¡è¯·æ±ä¸­å¢å å«ååç§»é¤å«åæ··åä½¿ç¨ï¼\n\npost /_aliases\n{\n  "actions": [\n    { "remove": { "index": "my_index", "alias": "my_alias" }}\n    { "add": { "index": "my_index_v2", "alias": "my_alias" }}\n  ]\n}\n\n\n> éè¦æ³¨æçæ¯ï¼å¦æå«åä¸ç´¢å¼æ¯ä¸å¯¹ä¸çï¼ä½¿ç¨å«åç´¢å¼ææ¡£æèæ¥è¯¢ææ¡£æ¯å¯ä»¥çï¼ä½æ¯å¦æå«ååç´¢å¼æ¯ä¸å¯¹å¤çï¼ä½¿ç¨å«åä¼åçéè¯¯ï¼å ä¸º es ä¸ç¥éæææ¡£åå¥åªä¸ªç´¢å¼ä¸­å»æèä»åªä¸ªç´¢å¼ä¸­è¯»åææ¡£ã\n\nes ç´¢å¼å«åæä¸ªå¸åçåºç¨åºæ¯æ¯å¹³æ»åæ¢ï¼æ´å¤ç»èå¯ä»¥æ¥ç elasticsearchï¼esï¼ç´¢å¼é¶åæºï¼æ ééå¯ï¼æ ç¼å¹³æ»åæ¢çæ¹æ³ã\n\n\n# æå¼/å³é­ç´¢å¼\n\néè¿å¨ post ä¸­æ·»å  _close æ _open å¯ä»¥æå¼ãå³é­ç´¢å¼ã\n\næå¼ç´¢å¼\n\n# æå¼ç´¢å¼\npost kibana_sample_data_ecommerce/_open\n# å³é­ç´¢å¼\npost kibana_sample_data_ecommerce/_close\n\n\n\n# ææ¡£\n\n############create document############\n#create document. èªå¨çæ _id\npost users/_doc\n{\n\t"user" : "mike",\n    "post_date" : "2019-04-15t14:12:12",\n    "message" : "trying out kibana"\n}\n\n#create document. æå®idãå¦æidå·²ç»å­å¨ï¼æ¥é\nput users/_doc/1?op_type=create\n{\n    "user" : "jack",\n    "post_date" : "2019-05-15t14:12:12",\n    "message" : "trying out elasticsearch"\n}\n\n#create document. æå® id å¦æå·²ç»å­å¨ï¼å°±æ¥é\nput users/_create/1\n{\n     "user" : "jack",\n    "post_date" : "2019-05-15t14:12:12",\n    "message" : "trying out elasticsearch"\n}\n\n### get document by id\n#get the document by id\nget users/_doc/1\n\n\n###  index & update\n#update æå® id  (åå é¤ï¼å¨åå¥)\nget users/_doc/1\n\nput users/_doc/1\n{\n\t"user" : "mike"\n\n}\n\n\n#get users/_doc/1\n#å¨åææ¡£ä¸å¢å å­æ®µ\npost users/_update/1/\n{\n    "doc":{\n        "post_date" : "2019-05-15t14:12:12",\n        "message" : "trying out elasticsearch"\n    }\n}\n\n\n\n### delete by id\n# å é¤ææ¡£\ndelete users/_doc/1\n\n\n### bulk æä½\n#æ§è¡ä¸¤æ¬¡ï¼æ¥çæ¯æ¬¡çç»æ\n\n#æ§è¡ç¬¬1æ¬¡\npost _bulk\n{ "index" : { "_index" : "test", "_id" : "1" } }\n{ "field1" : "value1" }\n{ "delete" : { "_index" : "test", "_id" : "2" } }\n{ "create" : { "_index" : "test2", "_id" : "3" } }\n{ "field1" : "value3" }\n{ "update" : {"_id" : "1", "_index" : "test"} }\n{ "doc" : {"field2" : "value2"} }\n\n\n#æ§è¡ç¬¬2æ¬¡\npost _bulk\n{ "index" : { "_index" : "test", "_id" : "1" } }\n{ "field1" : "value1" }\n{ "delete" : { "_index" : "test", "_id" : "2" } }\n{ "create" : { "_index" : "test2", "_id" : "3" } }\n{ "field1" : "value3" }\n{ "update" : {"_id" : "1", "_index" : "test"} }\n{ "doc" : {"field2" : "value2"} }\n\n### mget æä½\nget /_mget\n{\n    "docs" : [\n        {\n            "_index" : "test",\n            "_id" : "1"\n        },\n        {\n            "_index" : "test",\n            "_id" : "2"\n        }\n    ]\n}\n\n\n#uriä¸­æå®index\nget /test/_mget\n{\n    "docs" : [\n        {\n\n            "_id" : "1"\n        },\n        {\n\n            "_id" : "2"\n        }\n    ]\n}\n\n\nget /_mget\n{\n    "docs" : [\n        {\n            "_index" : "test",\n            "_id" : "1",\n            "_source" : false\n        },\n        {\n            "_index" : "test",\n            "_id" : "2",\n            "_source" : ["field3", "field4"]\n        },\n        {\n            "_index" : "test",\n            "_id" : "3",\n            "_source" : {\n                "include": ["user"],\n                "exclude": ["user.location"]\n            }\n        }\n    ]\n}\n\n### msearch æä½\npost kibana_sample_data_ecommerce/_msearch\n{}\n{"query" : {"match_all" : {}},"size":1}\n{"index" : "kibana_sample_data_flights"}\n{"query" : {"match_all" : {}},"size":2}\n\n\n### æ¸é¤æµè¯æ°æ®\n#æ¸é¤æ°æ®\ndelete users\ndelete test\ndelete test2\n\n\n\n# åå»ºææ¡£\n\n# æå® id\n\nè¯­æ³æ ¼å¼ï¼\n\nput /_index/_type/_create/_id\n\n\nç¤ºä¾ï¼\n\nput /user/_doc/_create/1\n{\n  "user": "å¼ ä¸",\n  "title": "å·¥ç¨å¸",\n  "desc": "æ°æ®åºç®¡ç"\n}\n\n\n> æ³¨æï¼æå® idï¼å¦æ id å·²ç»å­å¨ï¼åæ¥é\n\n# èªå¨çæ id\n\næ°å¢è®°å½çæ¶åï¼ä¹å¯ä»¥ä¸æå® idï¼è¿æ¶è¦æ¹æ post è¯·æ±ã\n\nè¯­æ³æ ¼å¼ï¼\n\npost /_index/_type\n\n\nç¤ºä¾ï¼\n\npost /user/_doc\n{\n  "user": "å¼ ä¸",\n  "title": "å·¥ç¨å¸",\n  "desc": "è¶çº§ç®¡çå"\n}\n\n\n\n# å é¤ææ¡£\n\nè¯­æ³æ ¼å¼ï¼\n\ndelete /_index/_doc/_id\n\n\nç¤ºä¾ï¼\n\ndelete /user/_doc/1\n\n\n\n# æ´æ°ææ¡£\n\n# åå é¤ï¼ååå¥\n\nè¯­æ³æ ¼å¼ï¼\n\nput /_index/_type/_id\n\n\nç¤ºä¾ï¼\n\nput /user/_doc/1\n{\n  "user": "æå",\n  "title": "å·¥ç¨å¸",\n  "desc": "è¶çº§ç®¡çå"\n}\n\n\n# å¨åææ¡£ä¸å¢å å­æ®µ\n\nè¯­æ³æ ¼å¼ï¼\n\npost /_index/_update/_id\n\n\nç¤ºä¾ï¼\n\npost /user/_update/1\n{\n    "doc":{\n        "age" : "30"\n    }\n}\n\n\n\n# æ¥è¯¢ææ¡£\n\n# æå® id æ¥è¯¢\n\nè¯­æ³æ ¼å¼ï¼\n\nget /_index/_type/_id\n\n\nç¤ºä¾ï¼\n\nget /user/_doc/1\n\n\nç»æï¼\n\n{\n  "_index": "user",\n  "_type": "_doc",\n  "_id": "1",\n  "_version": 1,\n  "_seq_no": 536248,\n  "_primary_term": 2,\n  "found": true,\n  "_source": {\n    "user": "å¼ ä¸",\n    "title": "å·¥ç¨å¸",\n    "desc": "æ°æ®åºç®¡ç"\n  }\n}\n\n\nè¿åçæ°æ®ä¸­ï¼found å­æ®µè¡¨ç¤ºæ¥è¯¢æåï¼_source å­æ®µè¿ååå§è®°å½ã\n\nå¦æ id ä¸æ­£ç¡®ï¼å°±æ¥ä¸å°æ°æ®ï¼found å­æ®µå°±æ¯ false\n\n# æ¥è¯¢ææè®°å½\n\nä½¿ç¨ get æ¹æ³ï¼ç´æ¥è¯·æ± /index/type/_searchï¼å°±ä¼è¿åææè®°å½ã\n\n$ curl \'localhost:9200/user/admin/_search?pretty\'\n{\n  "took" : 1,\n  "timed_out" : false,\n  "_shards" : {\n    "total" : 3,\n    "successful" : 3,\n    "skipped" : 0,\n    "failed" : 0\n  },\n  "hits" : {\n    "total" : 2,\n    "max_score" : 1.0,\n    "hits" : [\n      {\n        "_index" : "user",\n        "_type" : "admin",\n        "_id" : "wwuodg8bhwecs7siyn93",\n        "_score" : 1.0,\n        "_source" : {\n          "user" : "æå",\n          "title" : "å·¥ç¨å¸",\n          "desc" : "ç³»ç»ç®¡ç"\n        }\n      },\n      {\n        "_index" : "user",\n        "_type" : "admin",\n        "_id" : "1",\n        "_score" : 1.0,\n        "_source" : {\n          "user" : "å¼ ä¸",\n          "title" : "å·¥ç¨å¸",\n          "desc" : "è¶çº§ç®¡çå"\n        }\n      }\n    ]\n  }\n}\n\n\nä¸é¢ä»£ç ä¸­ï¼è¿åç»æç tookå­æ®µè¡¨ç¤ºè¯¥æä½çèæ¶ï¼åä½ä¸ºæ¯«ç§ï¼ï¼timed_outå­æ®µè¡¨ç¤ºæ¯å¦è¶æ¶ï¼hitså­æ®µè¡¨ç¤ºå½ä¸­çè®°å½ï¼éé¢å­å­æ®µçå«ä¹å¦ä¸ã\n\n * totalï¼è¿åè®°å½æ°ï¼æ¬ä¾æ¯ 2 æ¡ã\n * max_scoreï¼æé«çå¹éç¨åº¦ï¼æ¬ä¾æ¯1.0ã\n * hitsï¼è¿åçè®°å½ç»æçæ°ç»ã\n\nè¿åçè®°å½ä¸­ï¼æ¯æ¡è®°å½é½æä¸ä¸ª_scoreå­æ®µï¼è¡¨ç¤ºå¹éçç¨åºï¼é»è®¤æ¯æç§è¿ä¸ªå­æ®µéåºæåã\n\n\n# å¨ææç´¢\n\nes çæ¥è¯¢éå¸¸ç¹å«ï¼ä½¿ç¨èªå·±çæ¥è¯¢è¯­æ³ï¼è¦æ± get è¯·æ±å¸¦ææ°æ®ä½ã\n\n$ curl -h \'content-type: application/json\' \'localhost:9200/user/admin/_search?pretty\'  -d \'\n{\n"query" : { "match" : { "desc" : "ç®¡ç" }}\n}\'\n\n\nä¸é¢ä»£ç ä½¿ç¨ match æ¥è¯¢ï¼æå®çå¹éæ¡ä»¶æ¯descå­æ®µéé¢åå«"è½¯ä»¶"è¿ä¸ªè¯ãè¿åç»æå¦ä¸ã\n\n{\n  "took" : 2,\n  "timed_out" : false,\n  "_shards" : {\n    "total" : 3,\n    "successful" : 3,\n    "skipped" : 0,\n    "failed" : 0\n  },\n  "hits" : {\n    "total" : 2,\n    "max_score" : 0.38200712,\n    "hits" : [\n      {\n        "_index" : "user",\n        "_type" : "admin",\n        "_id" : "wwuodg8bhwecs7siyn93",\n        "_score" : 0.38200712,\n        "_source" : {\n          "user" : "æå",\n          "title" : "å·¥ç¨å¸",\n          "desc" : "ç³»ç»ç®¡ç"\n        }\n      },\n      {\n        "_index" : "user",\n        "_type" : "admin",\n        "_id" : "1",\n        "_score" : 0.3487891,\n        "_source" : {\n          "user" : "å¼ ä¸",\n          "title" : "å·¥ç¨å¸",\n          "desc" : "è¶çº§ç®¡çå"\n        }\n      }\n    ]\n  }\n}\n\n\nelastic é»è®¤ä¸æ¬¡è¿å 10 æ¡ç»æï¼å¯ä»¥éè¿sizeå­æ®µæ¹åè¿ä¸ªè®¾ç½®ï¼è¿å¯ä»¥éè¿fromå­æ®µï¼æå®ä½ç§»ã\n\n$ curl \'localhost:9200/user/admin/_search\'  -d \'\n{\n  "query" : { "match" : { "desc" : "ç®¡ç" }},\n  "from": 1,\n  "size": 1\n}\'\n\n\nä¸é¢ä»£ç æå®ï¼ä»ä½ç½® 1 å¼å§ï¼é»è®¤æ¯ä»ä½ç½® 0 å¼å§ï¼ï¼åªè¿åä¸æ¡ç»æã\n\n\n# é»è¾è¿ç®\n\nå¦ææå¤ä¸ªæç´¢å³é®å­ï¼ elastic è®¤ä¸ºå®ä»¬æ¯orå³ç³»ã\n\n$ curl \'localhost:9200/user/admin/_search\'  -d \'\n{\n"query" : { "match" : { "desc" : "è½¯ä»¶ ç³»ç»" }}\n}\'\n\n\nä¸é¢ä»£ç æç´¢çæ¯è½¯ä»¶ or ç³»ç»ã\n\nå¦æè¦æ§è¡å¤ä¸ªå³é®è¯çandæç´¢ï¼å¿é¡»ä½¿ç¨å¸å°æ¥è¯¢ã\n\n$ curl -h \'content-type: application/json\' \'localhost:9200/user/admin/_search?pretty\'  -d \'\n{\n "query": {\n  "bool": {\n   "must": [\n    { "match": { "desc": "ç®¡ç" } },\n    { "match": { "desc": "è¶çº§" } }\n   ]\n  }\n }\n}\'\n\n\n\n# æ¹éæ§è¡\n\næ¯æå¨ä¸æ¬¡ api è°ç¨ä¸­ï¼å¯¹ä¸åçç´¢å¼è¿è¡æä½\n\næ¯æåç§ç±»åæä½\n\n * index\n * create\n * update\n * delete\n\næä½ä¸­åæ¡æä½å¤±è´¥ï¼å¹¶ä¸ä¼å½±åå¶ä»æä½ã\n\nè¿åç»æåæ¬äºæ¯ä¸æ¡æä½æ§è¡çç»æã\n\npost _bulk\n{ "index" : { "_index" : "test", "_id" : "1" } }\n{ "field1" : "value1" }\n{ "delete" : { "_index" : "test", "_id" : "2" } }\n{ "create" : { "_index" : "test2", "_id" : "3" } }\n{ "field1" : "value3" }\n{ "update" : {"_id" : "1", "_index" : "test"} }\n{ "doc" : {"field2" : "value2"} }\n\n\n> è¯´æï¼ä¸é¢çç¤ºä¾å¦ææ§è¡å¤æ¬¡ï¼æ§è¡ç»æé½ä¸ä¸æ ·ã\n\n\n# æ¹éè¯»å\n\nè¯»å¤ä¸ªç´¢å¼\n\nget /_mget\n{\n    "docs" : [\n        {\n            "_index" : "test",\n            "_id" : "1"\n        },\n        {\n            "_index" : "test",\n            "_id" : "2"\n        }\n    ]\n}\n\n\nè¯»ä¸ä¸ªç´¢å¼\n\nget /test/_mget\n{\n    "docs" : [\n        {\n\n            "_id" : "1"\n        },\n        {\n\n            "_id" : "2"\n        }\n    ]\n}\n\nget /_mget\n{\n    "docs" : [\n        {\n            "_index" : "test",\n            "_id" : "1",\n            "_source" : false\n        },\n        {\n            "_index" : "test",\n            "_id" : "2",\n            "_source" : ["field3", "field4"]\n        },\n        {\n            "_index" : "test",\n            "_id" : "3",\n            "_source" : {\n                "include": ["user"],\n                "exclude": ["user.location"]\n            }\n        }\n    ]\n}\n\n\n\n# æ¹éæ¥è¯¢\n\npost kibana_sample_data_ecommerce/_msearch\n{}\n{"query" : {"match_all" : {}},"size":1}\n{"index" : "kibana_sample_data_flights"}\n{"query" : {"match_all" : {}},"size":2}\n\n\n\n# uri search æ¥è¯¢è¯­ä¹\n\nelasticsearch uri search éµå¾ª querystring æ¥è¯¢è¯­ä¹ï¼å¶å½¢å¼å¦ä¸ï¼\n\nget /movies/_search?q=2012&df=title&sort=year:desc&from=0&size=10&timeout=1s\n{\n\t"profile": true\n}\n\n\n * q æå®æ¥è¯¢è¯­å¥ï¼ä½¿ç¨ querystring è¯­ä¹\n * df é»è®¤å­æ®µï¼ä¸æå®æ¶\n * sort æåºï¼from å size ç¨äºåé¡µ\n * profile å¯ä»¥æ¥çæ¥è¯¢æ¶å¦ä½è¢«æ§è¡ç\n\nget /movies/_search?q=title:2012&sort=year:desc&from=0&size=10&timeout=1s\n{\n\t"profile":"true"\n}\n\n\n# term å phrase\n\nbeautiful mind ç­æäº beautiful or mind\n\n"beautiful mind" ç­æäº beautiful and mind\n\n# term æ¥è¯¢\nget /movies/_search?q=title:beautiful mind\n{\n\t"profile":"true"\n}\n\n# ä½¿ç¨å¼å·ï¼phrase æ¥è¯¢\nget /movies/_search?q=title:"beautiful mind"\n{\n\t"profile":"true"\n}\n\n\n# åç»ä¸å¼å·\n\ntitle:(beautiful and mind)\n\ntitle="beautiful mind"\n\n# andãorãnot æè &&ã||ã!\n\n> æ³¨æï¼andãorãnot å¿é¡»å¤§å\n\n# å¸å°æä½ç¬¦\nget /movies/_search?q=title:(beautiful and mind)\n{\n\t"profile":"true"\n}\n\nget /movies/_search?q=title:(beautiful not mind)\n{\n\t"profile":"true"\n}\n\n\n# èå´æ¥è¯¢\n\n * [] è¡¨ç¤ºé­åºé´\n * {} è¡¨ç¤ºå¼åºé´\n\nç¤ºä¾ï¼\n\n# èå´æ¥è¯¢ ,åºé´åæ³\nget /movies/_search?q=title:beautiful and year:{2010 to 2018%7d\n{\n\t"profile":"true"\n}\n\nget /movies/_search?q=title:beautiful and year:[* to 2018]\n{\n\t"profile":"true"\n}\n\n\n# ç®æ°ç¬¦å·\n\n# 2010 å¹´ä»¥åçè®°å½\nget /movies/_search?q=year:>2010\n{\n\t"profile":"true"\n}\n\n# 2010 å¹´å° 2018 å¹´çè®°å½\nget /movies/_search?q=year:(>2010 && <=2018)\n{\n\t"profile":"true"\n}\n\n# 2010 å¹´å° 2018 å¹´çè®°å½\nget /movies/_search?q=year:(+>2010 +<=2018)\n{\n\t"profile":"true"\n}\n\n\n# ééç¬¦æ¥è¯¢\n\n * ? ä»£è¡¨ 1 ä¸ªå­ç¬¦\n * * ä»£è¡¨ 0 æå¤ä¸ªå­ç¬¦\n\nç¤ºä¾ï¼\n\nget /movies/_search?q=title:mi?d\n{\n\t"profile":"true"\n}\n\nget /movies/_search?q=title:b*\n{\n\t"profile":"true"\n}\n\n\n# æ­£åè¡¨è¾¾å¼\n\ntitle:[bt]oy\n\n# æ¨¡ç³å¹éä¸è¿ä¼¼æ¥è¯¢\n\nç¤ºä¾ï¼\n\n# ç¸ä¼¼åº¦å¨ 1 ä¸ªå­ç¬¦ä»¥å\nget /movies/_search?q=title:beautifl~1\n{\n\t"profile":"true"\n}\n\n# ç¸ä¼¼åº¦å¨ 2 ä¸ªå­ç¬¦ä»¥å\nget /movies/_search?q=title:"lord rings"~2\n{\n\t"profile":"true"\n}\n\n\n\n# request body & dsl\n\nelasticsearch é¤äº uri search æ¥è¯¢æ¹å¼ï¼è¿æ¯æå°æ¥è¯¢è¯­å¥éè¿ http request body åèµ·æ¥è¯¢ã\n\nget /kibana_sample_data_ecommerce/_search?ignore_unavailable=true\n{\n\t"profile":"true",\n\t"query": {\n\t  "match_all": {}\n\t}\n}\n\n\n# åé¡µ\n\nget /kibana_sample_data_ecommerce/_search?ignore_unavailable=true\n{\n  "profile": "true",\n  "from": 0,\n  "size": 10,\n  "query": {\n    "match_all": {}\n  }\n}\n\n\n# æåº\n\næå¥½å¨æ°å­åææ¥æåå­æ®µä¸æåº\n\nå ä¸ºå¯¹äºå¤å¼ç±»åæåæè¿çå­æ®µæåºï¼ç³»ç»ä¼éä¸ä¸ªå¼ï¼æ æ³å¾ç¥è¯¥å¼\n\nget /kibana_sample_data_ecommerce/_search?ignore_unavailable=true\n{\n  "profile": "true",\n  "sort": [\n    {\n      "order_date": "desc"\n    }\n  ],\n  "from": 1,\n  "size": 10,\n  "query": {\n    "match_all": {}\n  }\n}\n\n\n# _source è¿æ»¤\n\nå¦æ _source æ²¡æå­å¨ï¼é£å°±åªè¿åå¹éçææ¡£çåæ°æ®\n\n_source æ¯æä½¿ç¨ééç¬¦ï¼å¦ï¼_source["name*", "desc*"]\n\nç¤ºä¾ï¼\n\nget /kibana_sample_data_ecommerce/_search?ignore_unavailable=true\n{\n  "profile": "true",\n  "_source": [\n    "order_date",\n    "category.keyword"\n  ],\n  "from": 1,\n  "size": 10,\n  "query": {\n    "match_all": {}\n  }\n}\n\n\n# èæ¬å­æ®µ\n\nget /kibana_sample_data_ecommerce/_search?ignore_unavailable=true\n{\n  "profile": "true",\n  "script_fields": {\n    "new_field": {\n      "script": {\n        "lang": "painless",\n        "source":"doc[\'order_date\'].value+\' hello\'"\n      }\n    }\n  },\n  "from": 1,\n  "size": 10,\n  "query": {\n    "match_all": {}\n  }\n}\n\n\n\n# ä½¿ç¨æ¥è¯¢è¡¨è¾¾å¼ - match\n\npost movies/_search\n{\n  "query": {\n    "match": {\n      "title": "last christmas"\n    }\n  }\n}\n\npost movies/_search\n{\n  "query": {\n    "match": {\n      "title": {\n        "query": "last christmas",\n        "operator": "and"\n      }\n    }\n  }\n}\n\n\n\n# ç­è¯­æç´¢ - match phrase\n\npost movies/_search\n{\n  "query": {\n    "match_phrase": {\n      "title":{\n        "query": "last christmas"\n\n      }\n    }\n  }\n}\n\n\n\n# éç¾¤ api\n\n> elasticsearch å®æ¹ä¹ cluster api\n\nä¸äºéç¾¤çº§å«ç api å¯è½ä¼å¨èç¹çå­éä¸è¿è¡ï¼è¿äºèç¹å¯ä»¥ç¨èç¹è¿æ»¤å¨æå®ãä¾å¦ï¼ä»»å¡ç®¡çãèç¹ç»è®¡åèç¹ä¿¡æ¯ api é½å¯ä»¥æ¥åæ¥èªä¸ç»è¿æ»¤èç¹èä¸æ¯ææèç¹çç»æã\n\nèç¹è¿æ»¤å¨ä»¥éå·åéçåä¸ªè¿æ»¤å¨åè¡¨çå½¢å¼ç¼åï¼æ¯ä¸ªè¿æ»¤å¨ä»æéå­éä¸­æ·»å æå é¤èç¹ãæ¯ä¸ªè¿æ»¤å¨å¯ä»¥æ¯ä»¥ä¸ä¹ä¸ï¼\n\n * _allï¼å°ææèç¹æ·»å å°å­é\n * _localï¼å°æ¬å°èç¹æ·»å å°å­é\n * _masterï¼å°å½åä¸»èç¹æ·»å å°å­é\n * æ ¹æ®èç¹ id æèç¹åå°å¹éèç¹æ·»å å°å­é\n * æ ¹æ® ip å°åæä¸»æºåå°å¹éèç¹æ·»å å°å­é\n * ä½¿ç¨ééç¬¦ï¼å°èç¹åãå°ååæä¸»æºåå¹éçèç¹æ·»å å°å­é\n * master:true, data:true, ingest:true, voting_only:true, ml:true æ coordinating_only:true, åå«æå³çå°ææä¸»èç¹ãæææ°æ®èç¹ãæææåèç¹ãææä»æç¥¨èç¹ãæææºå¨å­¦ä¹ èç¹åææåè°èç¹æ·»å å°å­éä¸­ã\n * master:false, data:false, ingest:false, voting_only:true, ml:false æ coordinating_only:false, åå«æå³çå°ææä¸»èç¹ãæææ°æ®èç¹ãæææåèç¹ãææä»æç¥¨èç¹ãæææºå¨å­¦ä¹ èç¹åææåè°èç¹æé¤å¨å­éå¤ã\n * éå¯¹æ¨¡å¼ï¼ä½¿ç¨ * ééç¬¦ï¼æ ¼å¼ä¸º attrname:attrvalueï¼å°ææå·æèªå®ä¹èç¹å±æ§çèç¹æ·»å å°å­éä¸­ï¼å¶åç§°åå¼ä¸ç¸åºçæ¨¡å¼å¹éãèªå®ä¹èç¹å±æ§æ¯éè¿ node.attr.attrname: attrvalue å½¢å¼å¨éç½®æä»¶ä¸­è®¾ç½®çã\n\n# å¦ææ²¡æç»åºè¿æ»¤å¨ï¼é»è®¤æ¯æ¥è¯¢ææèç¹\nget /_nodes\n# æ¥è¯¢ææèç¹\nget /_nodes/_all\n# æ¥è¯¢æ¬å°èç¹\nget /_nodes/_local\n# æ¥è¯¢ä¸»èç¹\nget /_nodes/_master\n# æ ¹æ®åç§°æ¥è¯¢èç¹ï¼æ¯æééç¬¦ï¼\nget /_nodes/node_name_goes_here\nget /_nodes/node_name_goes_*\n# æ ¹æ®å°åæ¥è¯¢èç¹ï¼æ¯æééç¬¦ï¼\nget /_nodes/10.0.0.3,10.0.0.4\nget /_nodes/10.0.0.*\n# æ ¹æ®è§åæ¥è¯¢èç¹\nget /_nodes/_all,master:false\nget /_nodes/data:true,ingest:true\nget /_nodes/coordinating_only:true\nget /_nodes/master:true,voting_only:false\n# æ ¹æ®èªå®ä¹å±æ§æ¥è¯¢èç¹ï¼å¦ï¼æ¥è¯¢éç½®æä»¶ä¸­å« node.attr.rack:2 å±æ§çèç¹ï¼\nget /_nodes/rack:2\nget /_nodes/ra*:2\nget /_nodes/ra*:2*\n\n\n\n# éç¾¤å¥åº· api\n\nget /_cluster/health\nget /_cluster/health?level=shards\nget /_cluster/health/kibana_sample_data_ecommerce,kibana_sample_data_flights\nget /_cluster/health/kibana_sample_data_flights?level=shards\n\n\n\n# éç¾¤ç¶æ api\n\néç¾¤ç¶æ api è¿åè¡¨ç¤ºæ´ä¸ªéç¾¤ç¶æçåæ°æ®ã\n\nget /_cluster/state\n\n\n\n# èç¹ api\n\n> elasticsearch å®æ¹ä¹ cat nodes apiââè¿åæå³éç¾¤èç¹çä¿¡æ¯ã\n\n# æ¥çé»è®¤çå­æ®µ\nget /_cat/nodes?v=true\n# æ¥çæå®çå­æ®µ\nget /_cat/nodes?v=true&h=id,ip,port,v,m\n\n\n\n# åç api\n\n> elasticsearch å®æ¹ä¹ cat shards apiââshards å½ä»¤æ¯åªäºèç¹åå«åªäºåççè¯¦ç»è§å¾ãå®ä¼åè¯ä½ å®æ¯ä¸»è¿æ¯å¯æ¬ãææ¡£æ°éãå®å¨ç£çä¸å ç¨çå­èæ°ä»¥åå®æå¨çèç¹ã\n\n# æ¥çé»è®¤çå­æ®µ\nget /_cat/shards\n# æ ¹æ®åç§°æ¥è¯¢åçï¼æ¯æééç¬¦ï¼\nget /_cat/shards/my-index-*\n# æ¥çæå®çå­æ®µ\nget /_cat/shards?h=index,shard,prirep,state,unassigned.reason\n\n\n\n# çæ§ api\n\nelasticsearch ä¸­éç¾¤ç¸å³çå¥åº·ãç»è®¡ç­ç¸å³çä¿¡æ¯é½æ¯å´ç»ç cat api è¿è¡çã\n\néè¿ get è¯·æ±åé catï¼ä¸é¢ååºäºææå¯ç¨ç apiï¼\n\nget /_cat\n\n=^.^=\n/_cat/allocation\n/_cat/shards\n/_cat/shards/{index}\n/_cat/master\n/_cat/nodes\n/_cat/tasks\n/_cat/indices\n/_cat/indices/{index}\n/_cat/segments\n/_cat/segments/{index}\n/_cat/count\n/_cat/count/{index}\n/_cat/recovery\n/_cat/recovery/{index}\n/_cat/health\n/_cat/pending_tasks\n/_cat/aliases\n/_cat/aliases/{alias}\n/_cat/thread_pool\n/_cat/thread_pool/{thread_pools}\n/_cat/plugins\n/_cat/fielddata\n/_cat/fielddata/{fields}\n/_cat/nodeattrs\n/_cat/repositories\n/_cat/snapshots/{repository}\n/_cat/templates\n\n\n\n# åèèµæ\n\n * å®æ¹\n   * elasticsearch å®ç½\n   * elasticsearch github\n   * elasticsearch å®æ¹ææ¡£',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"ElasticSearch Java API ä¹ High Level REST Client",frontmatter:{title:"ElasticSearch Java API ä¹ High Level REST Client",date:"2022-03-01T18:55:46.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","API"],permalink:"/pages/201e43/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/12.ElasticsearchHighLevelRestJavaApi.html",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/12.ElasticsearchHighLevelRestJavaApi.md",key:"v-7c0bbdd0",path:"/pages/201e43/",headers:[{level:2,title:"å¿«éå¼å§",slug:"å¿«éå¼å§",normalizedTitle:"å¿«éå¼å§",charIndex:131},{level:3,title:"å¼å¥ä¾èµ",slug:"å¼å¥ä¾èµ",normalizedTitle:"å¼å¥ä¾èµ",charIndex:140},{level:3,title:"åå»ºè¿æ¥åå³é­",slug:"åå»ºè¿æ¥åå³é­",normalizedTitle:"åå»ºè¿æ¥åå³é­",charIndex:342},{level:2,title:"ç´¢å¼ API",slug:"ç´¢å¼-api",normalizedTitle:"ç´¢å¼ api",charIndex:585},{level:3,title:"æµè¯åå¤",slug:"æµè¯åå¤",normalizedTitle:"æµè¯åå¤",charIndex:596},{level:3,title:"åå»ºç´¢å¼",slug:"åå»ºç´¢å¼",normalizedTitle:"åå»ºç´¢å¼",charIndex:1315},{level:3,title:"å é¤ç´¢å¼",slug:"å é¤ç´¢å¼",normalizedTitle:"å é¤ç´¢å¼",charIndex:1875},{level:3,title:"å¤æ­ç´¢å¼æ¯å¦å­å¨",slug:"å¤æ­ç´¢å¼æ¯å¦å­å¨",normalizedTitle:"å¤æ­ç´¢å¼æ¯å¦å­å¨",charIndex:2132},{level:2,title:"ææ¡£ API",slug:"ææ¡£-api",normalizedTitle:"ææ¡£ api",charIndex:2471},{level:3,title:"ææ¡£æµè¯åå¤",slug:"ææ¡£æµè¯åå¤",normalizedTitle:"ææ¡£æµè¯åå¤",charIndex:2482},{level:3,title:"åå»ºææ¡£",slug:"åå»ºææ¡£",normalizedTitle:"åå»ºææ¡£",charIndex:4414},{level:3,title:"å é¤ææ¡£",slug:"å é¤ææ¡£",normalizedTitle:"å é¤ææ¡£",charIndex:5179},{level:3,title:"æ´æ°ææ¡£",slug:"æ´æ°ææ¡£",normalizedTitle:"æ´æ°ææ¡£",charIndex:5765},{level:3,title:"æ¥çææ¡£",slug:"æ¥çææ¡£",normalizedTitle:"æ¥çææ¡£",charIndex:6591},{level:3,title:"è·åå¹éæ¡ä»¶çè®°å½æ»æ°",slug:"è·åå¹éæ¡ä»¶çè®°å½æ»æ°",normalizedTitle:"è·åå¹éæ¡ä»¶çè®°å½æ»æ°",charIndex:7095},{level:3,title:"åé¡µæ¥è¯¢",slug:"åé¡µæ¥è¯¢",normalizedTitle:"åé¡µæ¥è¯¢",charIndex:7651},{level:3,title:"æ¡ä»¶æ¥è¯¢",slug:"æ¡ä»¶æ¥è¯¢",normalizedTitle:"æ¡ä»¶æ¥è¯¢",charIndex:8602},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:9509}],headersStr:"å¿«éå¼å§ å¼å¥ä¾èµ åå»ºè¿æ¥åå³é­ ç´¢å¼ API æµè¯åå¤ åå»ºç´¢å¼ å é¤ç´¢å¼ å¤æ­ç´¢å¼æ¯å¦å­å¨ ææ¡£ API ææ¡£æµè¯åå¤ åå»ºææ¡£ å é¤ææ¡£ æ´æ°ææ¡£ æ¥çææ¡£ è·åå¹éæ¡ä»¶çè®°å½æ»æ° åé¡µæ¥è¯¢ æ¡ä»¶æ¥è¯¢ åèèµæ",content:'# ElasticSearch Java API ä¹ High Level REST Client\n\n> Elasticsearch å®æ¹ç High Level REST Client å¨ 7.1.5.0 çæ¬åºå¼ãæä»¥æ¬æä¸­ç API ä¸æ¨èä½¿ç¨ã\n\n\n# å¿«éå¼å§\n\n\n# å¼å¥ä¾èµ\n\nå¨ pom.xml ä¸­å¼å¥ä»¥ä¸ä¾èµï¼\n\n<dependency>\n    <groupId>org.elasticsearch.client</groupId>\n    <artifactId>elasticsearch-rest-high-level-client</artifactId>\n    <version>7.17.1</version>\n</dependency>\n\n\n\n# åå»ºè¿æ¥åå³é­\n\n// åå»ºè¿æ¥\nRestHighLevelClient client = new RestHighLevelClient(\n        RestClient.builder(\n                new HttpHost("localhost", 9200, "http"),\n                new HttpHost("localhost", 9201, "http")));\n\n// å³é­\nclient.close();\n\n\n\n# ç´¢å¼ API\n\n\n# æµè¯åå¤\n\npublic static final String INDEX = "mytest";\npublic static final String INDEX_ALIAS = "mytest_alias";\n/**\n * {@link User} ç mapping ç»æï¼jsonå½¢å¼ï¼\n */\npublic static final String MAPPING_JSON =\n  "{\\n" + "  \\"properties\\": {\\n" + "    \\"_class\\": {\\n" + "      \\"type\\": \\"keyword\\",\\n"\n  + "      \\"index\\": false,\\n" + "      \\"doc_values\\": false\\n" + "    },\\n" + "    \\"description\\": {\\n"\n  + "      \\"type\\": \\"text\\",\\n" + "      \\"fielddata\\": true\\n" + "    },\\n" + "    \\"enabled\\": {\\n"\n  + "      \\"type\\": \\"boolean\\"\\n" + "    },\\n" + "    \\"name\\": {\\n" + "      \\"type\\": \\"text\\",\\n"\n  + "      \\"fielddata\\": true\\n" + "    }\\n" + "  }\\n" + "}";\n\n@Autowired\nprivate RestHighLevelClient client;\n\n\n\n# åå»ºç´¢å¼\n\n// åå»ºç´¢å¼\nCreateIndexRequest createIndexRequest = new CreateIndexRequest(INDEX);\n\n  // è®¾ç½®ç´¢å¼ç settings\n  createIndexRequest.settings(\n  Settings.builder().put("index.number_of_shards", 3).put("index.number_of_replicas", 2));\n\n  // è®¾ç½®ç´¢å¼ç mapping\n  createIndexRequest.mapping(MAPPING_JSON, XContentType.JSON);\n\n  // è®¾ç½®ç´¢å¼çå«å\n  createIndexRequest.alias(new Alias(INDEX_ALIAS));\n\n  AcknowledgedResponse createIndexResponse = client.indices().create(createIndexRequest, RequestOptions.DEFAULT);\n  Assertions.assertTrue(createIndexResponse.isAcknowledged());\n\n\n\n# å é¤ç´¢å¼\n\n// å é¤ç´¢å¼\nDeleteIndexRequest deleteIndexRequest = new DeleteIndexRequest(INDEX);\n  AcknowledgedResponse deleteResponse = client.indices().delete(deleteIndexRequest, RequestOptions.DEFAULT);\n  Assertions.assertTrue(deleteResponse.isAcknowledged());\n\n\n\n# å¤æ­ç´¢å¼æ¯å¦å­å¨\n\nGetIndexRequest getIndexRequest = new GetIndexRequest(INDEX);\n  Assertions.assertTrue(client.indices().exists(getIndexRequest, RequestOptions.DEFAULT));\n  GetIndexRequest getIndexAliasRequest = new GetIndexRequest(INDEX_ALIAS);\n  Assertions.assertTrue(client.indices().exists(getIndexAliasRequest, RequestOptions.DEFAULT));\n\n\n\n# ææ¡£ API\n\n\n# ææ¡£æµè¯åå¤\n\npublic static final String INDEX = "mytest";\npublic static final String INDEX_ALIAS = "mytest_alias";\n/**\n * {@link User} ç mapping ç»æï¼jsonå½¢å¼ï¼\n */\npublic static final String MAPPING_JSON =\n  "{\\n" + "  \\"properties\\": {\\n" + "    \\"_class\\": {\\n" + "      \\"type\\": \\"keyword\\",\\n"\n  + "      \\"index\\": false,\\n" + "      \\"doc_values\\": false\\n" + "    },\\n" + "    \\"description\\": {\\n"\n  + "      \\"type\\": \\"text\\",\\n" + "      \\"fielddata\\": true\\n" + "    },\\n" + "    \\"enabled\\": {\\n"\n  + "      \\"type\\": \\"boolean\\"\\n" + "    },\\n" + "    \\"name\\": {\\n" + "      \\"type\\": \\"text\\",\\n"\n  + "      \\"fielddata\\": true\\n" + "    }\\n" + "  }\\n" + "}";\n\n@Autowired\nprivate RestHighLevelClient client;\n\n@BeforeEach\npublic void init() throws IOException {\n\n  // åå»ºç´¢å¼\n  CreateIndexRequest createIndexRequest = new CreateIndexRequest(INDEX);\n\n  // è®¾ç½®ç´¢å¼ç settings\n  createIndexRequest.settings(\n  Settings.builder().put("index.number_of_shards", 3).put("index.number_of_replicas", 2));\n\n  // è®¾ç½®ç´¢å¼ç mapping\n  createIndexRequest.mapping(MAPPING_JSON, XContentType.JSON);\n\n  // è®¾ç½®ç´¢å¼çå«å\n  createIndexRequest.alias(new Alias(INDEX_ALIAS));\n\n  AcknowledgedResponse response = client.indices().create(createIndexRequest, RequestOptions.DEFAULT);\n  Assertions.assertTrue(response.isAcknowledged());\n\n  // å¤æ­ç´¢å¼æ¯å¦å­å¨\n  GetIndexRequest getIndexRequest = new GetIndexRequest(INDEX_ALIAS);\n  Assertions.assertTrue(client.indices().exists(getIndexRequest, RequestOptions.DEFAULT));\n  GetIndexRequest getIndexAliasRequest = new GetIndexRequest(INDEX_ALIAS);\n  Assertions.assertTrue(client.indices().exists(getIndexAliasRequest, RequestOptions.DEFAULT));\n  }\n\n@AfterEach\npublic void destroy() throws IOException {\n  // å é¤ç´¢å¼\n  DeleteIndexRequest request = new DeleteIndexRequest(INDEX);\n  AcknowledgedResponse response = client.indices().delete(request, RequestOptions.DEFAULT);\n  Assertions.assertTrue(response.isAcknowledged());\n  }\n\n\n\n# åå»ºææ¡£\n\nRestHighLevelClient Api ä½¿ç¨ IndexRequest æ¥æå»ºåå»ºææ¡£çè¯·æ±åæ°ã\n\nãç¤ºä¾ãåå»º id ä¸º 1 çææ¡£\n\nIndexRequest request = new IndexRequest("product");\n  request.id("1");\n  Product product = new Product();\n  product.setName("æºå¨äºº");\n  product.setDescription("äººå·¥æºè½æºå¨äºº");\n  product.setEnabled(true);\n  String jsonString = JSONUtil.toJsonStr(product);\n  request.source(jsonString, XContentType.JSON);\n\n\nåæ­¥æ§è¡\n\nIndexResponse indexResponse = client.index(request, RequestOptions.DEFAULT);\n\n\nå¼æ­¥æ§è¡\n\n// å¼æ­¥æ§è¡\nclient.indexAsync(request, RequestOptions.DEFAULT, new ActionListener<IndexResponse>() {\n@Override\npublic void onResponse(IndexResponse indexResponse) {\n  System.out.println(indexResponse);\n  }\n\n@Override\npublic void onFailure(Exception e) {\n  System.out.println("æ§è¡å¤±è´¥");\n  }\n  });\n\n\n\n# å é¤ææ¡£\n\nRestHighLevelClient Api ä½¿ç¨ DeleteRequest æ¥æå»ºå é¤ææ¡£çè¯·æ±åæ°ã\n\nãç¤ºä¾ãå é¤ id ä¸º 1 çææ¡£\n\nDeleteRequest deleteRequest = new DeleteRequest(INDEX_ALIAS, "1");\n\n\nåæ­¥æ§è¡\n\nDeleteResponse deleteResponse = client.delete(deleteRequest, RequestOptions.DEFAULT);\n  System.out.println(deleteResponse);\n\n\nå¼æ­¥æ§è¡\n\nclient.deleteAsync(deleteRequest, RequestOptions.DEFAULT, new ActionListener<DeleteResponse>() {\n@Override\npublic void onResponse(DeleteResponse deleteResponse) {\n  System.out.println(deleteResponse);\n  }\n\n@Override\npublic void onFailure(Exception e) {\n  System.out.println("æ§è¡å¤±è´¥");\n  }\n  });\n\n\n\n# æ´æ°ææ¡£\n\nRestHighLevelClient Api ä½¿ç¨ UpdateRequest æ¥æå»ºæ´æ°ææ¡£çè¯·æ±åæ°ã\n\nãç¤ºä¾ãæ´æ° id ä¸º 1 çææ¡£\n\nUpdateRequest updateRequest = new UpdateRequest(INDEX_ALIAS, "1");\n  Product product3 = new Product();\n  product3.setName("æ«å°æºå¨äºº");\n  product3.setDescription("äººå·¥æºè½æ«å°æºå¨äºº");\n  product3.setEnabled(true);\n  String jsonString2 = JSONUtil.toJsonStr(product3);\n  updateRequest.doc(jsonString2, XContentType.JSON);\n\n\nåæ­¥æ§è¡\n\nUpdateResponse updateResponse = client.update(updateRequest, RequestOptions.DEFAULT);\n  System.out.println(updateResponse);\n\n\nå¼æ­¥æ§è¡\n\nclient.updateAsync(updateRequest, RequestOptions.DEFAULT, new ActionListener<UpdateResponse>() {\n@Override\npublic void onResponse(UpdateResponse updateResponse) {\n  System.out.println(updateResponse);\n  }\n\n@Override\npublic void onFailure(Exception e) {\n  System.out.println("æ§è¡å¤±è´¥");\n  }\n  });\n\n\n\n# æ¥çææ¡£\n\nRestHighLevelClient Api ä½¿ç¨ GetRequest æ¥æå»ºæ¥çææ¡£çè¯·æ±åæ°ã\n\nãç¤ºä¾ãæ¥ç id ä¸º 1 çææ¡£\n\nGetRequest getRequest = new GetRequest(INDEX_ALIAS, "1");\n\n\nåæ­¥æ§è¡\n\nGetResponse getResponse = client.get(getRequest, RequestOptions.DEFAULT);\n\n\nå¼æ­¥æ§è¡\n\nclient.getAsync(getRequest, RequestOptions.DEFAULT, new ActionListener<GetResponse>() {\n@Override\npublic void onResponse(GetResponse getResponse) {\n  System.out.println(getResponse);\n  }\n\n@Override\npublic void onFailure(Exception e) {\n  System.out.println("æ§è¡å¤±è´¥");\n  }\n});\n\n\n\n# è·åå¹éæ¡ä»¶çè®°å½æ»æ°\n\n@Test\n@DisplayName("è·åå¹éæ¡ä»¶çè®°å½æ»æ°")\npublic void count() throws IOException {\n    SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();\n    sourceBuilder.query(QueryBuilders.matchPhraseQuery("customer_gender", "MALE"));\n    sourceBuilder.trackTotalHits(true);\n\n    CountRequest countRequest = new CountRequest(INDEX);\n    countRequest.source(sourceBuilder);\n\n    CountResponse countResponse = client.count(countRequest, RequestOptions.DEFAULT);\n    long count = countResponse.getCount();\n    System.out.println("å½ä¸­è®°å½æ°ï¼" + count);\n}\n\n\n\n# åé¡µæ¥è¯¢\n\n@ParameterizedTest\n@ValueSource(ints = {0, 1, 2, 3})\n@DisplayName("åé¡µæ¥è¯¢æµè¯")\npublic void pageTest(int page) throws IOException {\n\n    int size = 10;\n    int offset = page * size;\n    SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();\n    sourceBuilder.query(QueryBuilders.matchPhraseQuery("customer_gender", "MALE"));\n    sourceBuilder.from(offset);\n    sourceBuilder.size(size);\n    sourceBuilder.trackTotalHits(true);\n\n    SearchRequest searchRequest = new SearchRequest(INDEX);\n    searchRequest.source(sourceBuilder);\n    SearchResponse response = client.search(searchRequest, RequestOptions.DEFAULT);\n    SearchHit[] hits = response.getHits().getHits();\n    for (SearchHit hit : hits) {\n        KibanaSampleDataEcommerceBean bean =\n            BeanUtil.mapToBean(hit.getSourceAsMap(), KibanaSampleDataEcommerceBean.class, true,\n                               CopyOptions.create());\n        System.out.println(bean);\n    }\n}\n\n\n\n# æ¡ä»¶æ¥è¯¢\n\n@Test\n@DisplayName("æ¡ä»¶æ¥è¯¢")\npublic void matchPhraseQuery() throws IOException {\n    SearchRequest searchRequest = new SearchRequest(INDEX);\n    SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();\n\n    BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();\n    boolQueryBuilder.must(QueryBuilders.matchPhraseQuery("customer_last_name", "Jensen"));\n    sourceBuilder.query(boolQueryBuilder);\n    sourceBuilder.trackTotalHits(true);\n    searchRequest.source(sourceBuilder);\n    SearchResponse response = client.search(searchRequest, RequestOptions.DEFAULT);\n    SearchHit[] hits = response.getHits().getHits();\n    for (SearchHit hit : hits) {\n        KibanaSampleDataEcommerceBean bean =\n            BeanUtil.mapToBean(hit.getSourceAsMap(), KibanaSampleDataEcommerceBean.class, true,\n                               CopyOptions.create());\n        System.out.println(bean);\n    }\n}\n\n\n\n# åèèµæ\n\n * å®æ¹\n   * Java High Level REST Client',normalizedContent:'# elasticsearch java api ä¹ high level rest client\n\n> elasticsearch å®æ¹ç high level rest client å¨ 7.1.5.0 çæ¬åºå¼ãæä»¥æ¬æä¸­ç api ä¸æ¨èä½¿ç¨ã\n\n\n# å¿«éå¼å§\n\n\n# å¼å¥ä¾èµ\n\nå¨ pom.xml ä¸­å¼å¥ä»¥ä¸ä¾èµï¼\n\n<dependency>\n    <groupid>org.elasticsearch.client</groupid>\n    <artifactid>elasticsearch-rest-high-level-client</artifactid>\n    <version>7.17.1</version>\n</dependency>\n\n\n\n# åå»ºè¿æ¥åå³é­\n\n// åå»ºè¿æ¥\nresthighlevelclient client = new resthighlevelclient(\n        restclient.builder(\n                new httphost("localhost", 9200, "http"),\n                new httphost("localhost", 9201, "http")));\n\n// å³é­\nclient.close();\n\n\n\n# ç´¢å¼ api\n\n\n# æµè¯åå¤\n\npublic static final string index = "mytest";\npublic static final string index_alias = "mytest_alias";\n/**\n * {@link user} ç mapping ç»æï¼jsonå½¢å¼ï¼\n */\npublic static final string mapping_json =\n  "{\\n" + "  \\"properties\\": {\\n" + "    \\"_class\\": {\\n" + "      \\"type\\": \\"keyword\\",\\n"\n  + "      \\"index\\": false,\\n" + "      \\"doc_values\\": false\\n" + "    },\\n" + "    \\"description\\": {\\n"\n  + "      \\"type\\": \\"text\\",\\n" + "      \\"fielddata\\": true\\n" + "    },\\n" + "    \\"enabled\\": {\\n"\n  + "      \\"type\\": \\"boolean\\"\\n" + "    },\\n" + "    \\"name\\": {\\n" + "      \\"type\\": \\"text\\",\\n"\n  + "      \\"fielddata\\": true\\n" + "    }\\n" + "  }\\n" + "}";\n\n@autowired\nprivate resthighlevelclient client;\n\n\n\n# åå»ºç´¢å¼\n\n// åå»ºç´¢å¼\ncreateindexrequest createindexrequest = new createindexrequest(index);\n\n  // è®¾ç½®ç´¢å¼ç settings\n  createindexrequest.settings(\n  settings.builder().put("index.number_of_shards", 3).put("index.number_of_replicas", 2));\n\n  // è®¾ç½®ç´¢å¼ç mapping\n  createindexrequest.mapping(mapping_json, xcontenttype.json);\n\n  // è®¾ç½®ç´¢å¼çå«å\n  createindexrequest.alias(new alias(index_alias));\n\n  acknowledgedresponse createindexresponse = client.indices().create(createindexrequest, requestoptions.default);\n  assertions.asserttrue(createindexresponse.isacknowledged());\n\n\n\n# å é¤ç´¢å¼\n\n// å é¤ç´¢å¼\ndeleteindexrequest deleteindexrequest = new deleteindexrequest(index);\n  acknowledgedresponse deleteresponse = client.indices().delete(deleteindexrequest, requestoptions.default);\n  assertions.asserttrue(deleteresponse.isacknowledged());\n\n\n\n# å¤æ­ç´¢å¼æ¯å¦å­å¨\n\ngetindexrequest getindexrequest = new getindexrequest(index);\n  assertions.asserttrue(client.indices().exists(getindexrequest, requestoptions.default));\n  getindexrequest getindexaliasrequest = new getindexrequest(index_alias);\n  assertions.asserttrue(client.indices().exists(getindexaliasrequest, requestoptions.default));\n\n\n\n# ææ¡£ api\n\n\n# ææ¡£æµè¯åå¤\n\npublic static final string index = "mytest";\npublic static final string index_alias = "mytest_alias";\n/**\n * {@link user} ç mapping ç»æï¼jsonå½¢å¼ï¼\n */\npublic static final string mapping_json =\n  "{\\n" + "  \\"properties\\": {\\n" + "    \\"_class\\": {\\n" + "      \\"type\\": \\"keyword\\",\\n"\n  + "      \\"index\\": false,\\n" + "      \\"doc_values\\": false\\n" + "    },\\n" + "    \\"description\\": {\\n"\n  + "      \\"type\\": \\"text\\",\\n" + "      \\"fielddata\\": true\\n" + "    },\\n" + "    \\"enabled\\": {\\n"\n  + "      \\"type\\": \\"boolean\\"\\n" + "    },\\n" + "    \\"name\\": {\\n" + "      \\"type\\": \\"text\\",\\n"\n  + "      \\"fielddata\\": true\\n" + "    }\\n" + "  }\\n" + "}";\n\n@autowired\nprivate resthighlevelclient client;\n\n@beforeeach\npublic void init() throws ioexception {\n\n  // åå»ºç´¢å¼\n  createindexrequest createindexrequest = new createindexrequest(index);\n\n  // è®¾ç½®ç´¢å¼ç settings\n  createindexrequest.settings(\n  settings.builder().put("index.number_of_shards", 3).put("index.number_of_replicas", 2));\n\n  // è®¾ç½®ç´¢å¼ç mapping\n  createindexrequest.mapping(mapping_json, xcontenttype.json);\n\n  // è®¾ç½®ç´¢å¼çå«å\n  createindexrequest.alias(new alias(index_alias));\n\n  acknowledgedresponse response = client.indices().create(createindexrequest, requestoptions.default);\n  assertions.asserttrue(response.isacknowledged());\n\n  // å¤æ­ç´¢å¼æ¯å¦å­å¨\n  getindexrequest getindexrequest = new getindexrequest(index_alias);\n  assertions.asserttrue(client.indices().exists(getindexrequest, requestoptions.default));\n  getindexrequest getindexaliasrequest = new getindexrequest(index_alias);\n  assertions.asserttrue(client.indices().exists(getindexaliasrequest, requestoptions.default));\n  }\n\n@aftereach\npublic void destroy() throws ioexception {\n  // å é¤ç´¢å¼\n  deleteindexrequest request = new deleteindexrequest(index);\n  acknowledgedresponse response = client.indices().delete(request, requestoptions.default);\n  assertions.asserttrue(response.isacknowledged());\n  }\n\n\n\n# åå»ºææ¡£\n\nresthighlevelclient api ä½¿ç¨ indexrequest æ¥æå»ºåå»ºææ¡£çè¯·æ±åæ°ã\n\nãç¤ºä¾ãåå»º id ä¸º 1 çææ¡£\n\nindexrequest request = new indexrequest("product");\n  request.id("1");\n  product product = new product();\n  product.setname("æºå¨äºº");\n  product.setdescription("äººå·¥æºè½æºå¨äºº");\n  product.setenabled(true);\n  string jsonstring = jsonutil.tojsonstr(product);\n  request.source(jsonstring, xcontenttype.json);\n\n\nåæ­¥æ§è¡\n\nindexresponse indexresponse = client.index(request, requestoptions.default);\n\n\nå¼æ­¥æ§è¡\n\n// å¼æ­¥æ§è¡\nclient.indexasync(request, requestoptions.default, new actionlistener<indexresponse>() {\n@override\npublic void onresponse(indexresponse indexresponse) {\n  system.out.println(indexresponse);\n  }\n\n@override\npublic void onfailure(exception e) {\n  system.out.println("æ§è¡å¤±è´¥");\n  }\n  });\n\n\n\n# å é¤ææ¡£\n\nresthighlevelclient api ä½¿ç¨ deleterequest æ¥æå»ºå é¤ææ¡£çè¯·æ±åæ°ã\n\nãç¤ºä¾ãå é¤ id ä¸º 1 çææ¡£\n\ndeleterequest deleterequest = new deleterequest(index_alias, "1");\n\n\nåæ­¥æ§è¡\n\ndeleteresponse deleteresponse = client.delete(deleterequest, requestoptions.default);\n  system.out.println(deleteresponse);\n\n\nå¼æ­¥æ§è¡\n\nclient.deleteasync(deleterequest, requestoptions.default, new actionlistener<deleteresponse>() {\n@override\npublic void onresponse(deleteresponse deleteresponse) {\n  system.out.println(deleteresponse);\n  }\n\n@override\npublic void onfailure(exception e) {\n  system.out.println("æ§è¡å¤±è´¥");\n  }\n  });\n\n\n\n# æ´æ°ææ¡£\n\nresthighlevelclient api ä½¿ç¨ updaterequest æ¥æå»ºæ´æ°ææ¡£çè¯·æ±åæ°ã\n\nãç¤ºä¾ãæ´æ° id ä¸º 1 çææ¡£\n\nupdaterequest updaterequest = new updaterequest(index_alias, "1");\n  product product3 = new product();\n  product3.setname("æ«å°æºå¨äºº");\n  product3.setdescription("äººå·¥æºè½æ«å°æºå¨äºº");\n  product3.setenabled(true);\n  string jsonstring2 = jsonutil.tojsonstr(product3);\n  updaterequest.doc(jsonstring2, xcontenttype.json);\n\n\nåæ­¥æ§è¡\n\nupdateresponse updateresponse = client.update(updaterequest, requestoptions.default);\n  system.out.println(updateresponse);\n\n\nå¼æ­¥æ§è¡\n\nclient.updateasync(updaterequest, requestoptions.default, new actionlistener<updateresponse>() {\n@override\npublic void onresponse(updateresponse updateresponse) {\n  system.out.println(updateresponse);\n  }\n\n@override\npublic void onfailure(exception e) {\n  system.out.println("æ§è¡å¤±è´¥");\n  }\n  });\n\n\n\n# æ¥çææ¡£\n\nresthighlevelclient api ä½¿ç¨ getrequest æ¥æå»ºæ¥çææ¡£çè¯·æ±åæ°ã\n\nãç¤ºä¾ãæ¥ç id ä¸º 1 çææ¡£\n\ngetrequest getrequest = new getrequest(index_alias, "1");\n\n\nåæ­¥æ§è¡\n\ngetresponse getresponse = client.get(getrequest, requestoptions.default);\n\n\nå¼æ­¥æ§è¡\n\nclient.getasync(getrequest, requestoptions.default, new actionlistener<getresponse>() {\n@override\npublic void onresponse(getresponse getresponse) {\n  system.out.println(getresponse);\n  }\n\n@override\npublic void onfailure(exception e) {\n  system.out.println("æ§è¡å¤±è´¥");\n  }\n});\n\n\n\n# è·åå¹éæ¡ä»¶çè®°å½æ»æ°\n\n@test\n@displayname("è·åå¹éæ¡ä»¶çè®°å½æ»æ°")\npublic void count() throws ioexception {\n    searchsourcebuilder sourcebuilder = new searchsourcebuilder();\n    sourcebuilder.query(querybuilders.matchphrasequery("customer_gender", "male"));\n    sourcebuilder.tracktotalhits(true);\n\n    countrequest countrequest = new countrequest(index);\n    countrequest.source(sourcebuilder);\n\n    countresponse countresponse = client.count(countrequest, requestoptions.default);\n    long count = countresponse.getcount();\n    system.out.println("å½ä¸­è®°å½æ°ï¼" + count);\n}\n\n\n\n# åé¡µæ¥è¯¢\n\n@parameterizedtest\n@valuesource(ints = {0, 1, 2, 3})\n@displayname("åé¡µæ¥è¯¢æµè¯")\npublic void pagetest(int page) throws ioexception {\n\n    int size = 10;\n    int offset = page * size;\n    searchsourcebuilder sourcebuilder = new searchsourcebuilder();\n    sourcebuilder.query(querybuilders.matchphrasequery("customer_gender", "male"));\n    sourcebuilder.from(offset);\n    sourcebuilder.size(size);\n    sourcebuilder.tracktotalhits(true);\n\n    searchrequest searchrequest = new searchrequest(index);\n    searchrequest.source(sourcebuilder);\n    searchresponse response = client.search(searchrequest, requestoptions.default);\n    searchhit[] hits = response.gethits().gethits();\n    for (searchhit hit : hits) {\n        kibanasampledataecommercebean bean =\n            beanutil.maptobean(hit.getsourceasmap(), kibanasampledataecommercebean.class, true,\n                               copyoptions.create());\n        system.out.println(bean);\n    }\n}\n\n\n\n# æ¡ä»¶æ¥è¯¢\n\n@test\n@displayname("æ¡ä»¶æ¥è¯¢")\npublic void matchphrasequery() throws ioexception {\n    searchrequest searchrequest = new searchrequest(index);\n    searchsourcebuilder sourcebuilder = new searchsourcebuilder();\n\n    boolquerybuilder boolquerybuilder = querybuilders.boolquery();\n    boolquerybuilder.must(querybuilders.matchphrasequery("customer_last_name", "jensen"));\n    sourcebuilder.query(boolquerybuilder);\n    sourcebuilder.tracktotalhits(true);\n    searchrequest.source(sourcebuilder);\n    searchresponse response = client.search(searchrequest, requestoptions.default);\n    searchhit[] hits = response.gethits().gethits();\n    for (searchhit hit : hits) {\n        kibanasampledataecommercebean bean =\n            beanutil.maptobean(hit.getsourceasmap(), kibanasampledataecommercebean.class, true,\n                               copyoptions.create());\n        system.out.println(bean);\n    }\n}\n\n\n\n# åèèµæ\n\n * å®æ¹\n   * java high level rest client',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Elasticsearch éç¾¤ååç",frontmatter:{title:"Elasticsearch éç¾¤ååç",date:"2022-03-01T20:52:25.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","éç¾¤","åç"],permalink:"/pages/9a2546/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/13.Elasticsearch%E9%9B%86%E7%BE%A4%E5%92%8C%E5%88%86%E7%89%87.html",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/13.Elasticsearchéç¾¤ååç.md",key:"v-2a07dc5d",path:"/pages/9a2546/",headers:[{level:2,title:"éç¾¤",slug:"éç¾¤",normalizedTitle:"éç¾¤",charIndex:16},{level:3,title:"ç©ºéç¾¤",slug:"ç©ºéç¾¤",normalizedTitle:"ç©ºéç¾¤",charIndex:33},{level:3,title:"éç¾¤å¥åº·",slug:"éç¾¤å¥åº·",normalizedTitle:"éç¾¤å¥åº·",charIndex:575},{level:3,title:"æ·»å ç´¢å¼",slug:"æ·»å ç´¢å¼",normalizedTitle:"æ·»å ç´¢å¼",charIndex:1132},{level:3,title:"æ·»å æéè½¬ç§»",slug:"æ·»å æéè½¬ç§»",normalizedTitle:"æ·»å æéè½¬ç§»",charIndex:2728},{level:3,title:"æ°´å¹³æ©å®¹",slug:"æ°´å¹³æ©å®¹",normalizedTitle:"æ°´å¹³æ©å®¹",charIndex:3827},{level:3,title:"æ´å¤çæ©å®¹",slug:"æ´å¤çæ©å®¹",normalizedTitle:"æ´å¤çæ©å®¹",charIndex:4183},{level:3,title:"åºå¯¹æé",slug:"åºå¯¹æé",normalizedTitle:"åºå¯¹æé",charIndex:4742},{level:2,title:"åç",slug:"åç",normalizedTitle:"åç",charIndex:19},{level:3,title:"ä½¿ææ¬å¯è¢«æç´¢",slug:"ä½¿ææ¬å¯è¢«æç´¢",normalizedTitle:"ä½¿ææ¬å¯è¢«æç´¢",charIndex:5741},{level:3,title:"ä¸åæ§",slug:"ä¸åæ§",normalizedTitle:"ä¸åæ§",charIndex:6595},{level:3,title:"å¨ææ´æ°ç´¢å¼",slug:"å¨ææ´æ°ç´¢å¼",normalizedTitle:"å¨ææ´æ°ç´¢å¼",charIndex:6997},{level:3,title:"å é¤åæ´æ°",slug:"å é¤åæ´æ°",normalizedTitle:"å é¤åæ´æ°",charIndex:8054},{level:3,title:"è¿å®æ¶æç´¢",slug:"è¿å®æ¶æç´¢",normalizedTitle:"è¿å®æ¶æç´¢",charIndex:8373},{level:3,title:"refresh API",slug:"refresh-api",normalizedTitle:"refresh api",charIndex:9028},{level:3,title:"æä¹ååæ´",slug:"æä¹ååæ´",normalizedTitle:"æä¹ååæ´",charIndex:9952},{level:3,title:"flush API",slug:"flush-api",normalizedTitle:"flush api",charIndex:11275},{level:3,title:"æ®µåå¹¶",slug:"æ®µåå¹¶",normalizedTitle:"æ®µåå¹¶",charIndex:8337},{level:3,title:"optimize API",slug:"optimize-api",normalizedTitle:"optimize api",charIndex:5703},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:13800}],headersStr:"éç¾¤ ç©ºéç¾¤ éç¾¤å¥åº· æ·»å ç´¢å¼ æ·»å æéè½¬ç§» æ°´å¹³æ©å®¹ æ´å¤çæ©å®¹ åºå¯¹æé åç ä½¿ææ¬å¯è¢«æç´¢ ä¸åæ§ å¨ææ´æ°ç´¢å¼ å é¤åæ´æ° è¿å®æ¶æç´¢ refresh API æä¹ååæ´ flush API æ®µåå¹¶ optimize API åèèµæ",content:'# Elasticsearch éç¾¤ååç\n\n\n# éç¾¤\n\n\n# ç©ºéç¾¤\n\nå¦ææä»¬å¯å¨äºä¸ä¸ªåç¬çèç¹ï¼éé¢ä¸åå«ä»»ä½çæ°æ®åç´¢å¼ï¼é£æä»¬çéç¾¤çèµ·æ¥å°±æ¯ä¸ä¸ªåå«ç©ºåå®¹èç¹çéç¾¤ã\n\nFigure 1. åå«ç©ºåå®¹èç¹çéç¾¤\n\n\n\nå¾ 1ï¼åªæä¸ä¸ªç©ºèç¹çéç¾¤\n\nä¸ä¸ªè¿è¡ä¸­ç Elasticsearch å®ä¾ç§°ä¸ºä¸ä¸ªèç¹ï¼èéç¾¤æ¯ç±ä¸ä¸ªæèå¤ä¸ªæ¥æç¸å cluster.name éç½®çèç¹ç»æï¼ å®ä»¬å±åæ¿ææ°æ®åè´è½½çååãå½æèç¹å å¥éç¾¤ä¸­æèä»éç¾¤ä¸­ç§»é¤èç¹æ¶ï¼éç¾¤å°ä¼éæ°å¹³ååå¸ææçæ°æ®ã\n\nå½ä¸ä¸ªèç¹è¢«éä¸¾æä¸ºä¸»èç¹æ¶ï¼ å®å°è´è´£ç®¡çéç¾¤èå´åçææåæ´ï¼ä¾å¦å¢å ãå é¤ç´¢å¼ï¼æèå¢å ãå é¤èç¹ç­ã èä¸»èç¹å¹¶ä¸éè¦æ¶åå°ææ¡£çº§å«çåæ´åæç´¢ç­æä½ï¼æä»¥å½éç¾¤åªæ¥æä¸ä¸ªä¸»èç¹çæåµä¸ï¼å³ä½¿æµéçå¢å å®ä¹ä¸ä¼æä¸ºç¶é¢ã ä»»ä½èç¹é½å¯ä»¥æä¸ºä¸»èç¹ãæä»¬çç¤ºä¾éç¾¤å°±åªæä¸ä¸ªèç¹ï¼æä»¥å®åæ¶ä¹æä¸ºäºä¸»èç¹ã\n\nä½ä¸ºç¨æ·ï¼æä»¬å¯ä»¥å°è¯·æ±åéå°éç¾¤ä¸­çä»»ä½èç¹ï¼åæ¬ä¸»èç¹ã æ¯ä¸ªèç¹é½ç¥éä»»æææ¡£æå¤çä½ç½®ï¼å¹¶ä¸è½å¤å°æä»¬çè¯·æ±ç´æ¥è½¬åå°å­å¨æä»¬æéææ¡£çèç¹ã æ è®ºæä»¬å°è¯·æ±åéå°åªä¸ªèç¹ï¼å®é½è½è´è´£ä»åä¸ªåå«æä»¬æéææ¡£çèç¹æ¶éåæ°æ®ï¼å¹¶å°æç»ç»æè¿åçµ¦å®¢æ·ç«¯ã Elasticsearch å¯¹è¿ä¸åçç®¡çé½æ¯éæçã\n\n\n# éç¾¤å¥åº·\n\nElasticsearch çéç¾¤çæ§ä¿¡æ¯ä¸­åå«äºè®¸å¤çç»è®¡æ°æ®ï¼å¶ä¸­æä¸ºéè¦çä¸é¡¹å°±æ¯ éç¾¤å¥åº· ï¼ å®å¨ status å­æ®µä¸­å±ç¤ºä¸º green ã yellow æè red ã\n\nGET /_cluster/health\n\n\nå¨ä¸ä¸ªä¸åå«ä»»ä½ç´¢å¼çç©ºéç¾¤ä¸­ï¼å®å°ä¼æä¸ä¸ªç±»ä¼¼äºå¦ä¸æç¤ºçè¿ååå®¹ï¼\n\n{\n  "cluster_name": "elasticsearch",\n  "status": "green",\n  "timed_out": false,\n  "number_of_nodes": 1,\n  "number_of_data_nodes": 1,\n  "active_primary_shards": 0,\n  "active_shards": 0,\n  "relocating_shards": 0,\n  "initializing_shards": 0,\n  "unassigned_shards": 0\n}\n\n\nstatus å­æ®µæç¤ºçå½åéç¾¤å¨æ»ä½ä¸æ¯å¦å·¥ä½æ­£å¸¸ãå®çä¸ç§é¢è²å«ä¹å¦ä¸ï¼\n\n * greenï¼ææçä¸»åçåå¯æ¬åçé½æ­£å¸¸è¿è¡ã\n * yellowï¼ææçä¸»åçé½æ­£å¸¸è¿è¡ï¼ä½ä¸æ¯ææçå¯æ¬åçé½æ­£å¸¸è¿è¡ã\n * redï¼æä¸»åçæ²¡è½æ­£å¸¸è¿è¡ã\n\n\n# æ·»å ç´¢å¼\n\næä»¬å¾ Elasticsearch æ·»å æ°æ®æ¶éè¦ç¨å° ç´¢å¼ ââ ä¿å­ç¸å³æ°æ®çå°æ¹ãç´¢å¼å®éä¸æ¯æåä¸ä¸ªæèå¤ä¸ªç©çåççé»è¾å½åç©ºé´ ã\n\nä¸ä¸ª åç æ¯ä¸ä¸ªåºå±ç å·¥ä½åå ï¼å®ä»ä¿å­äºå¨é¨æ°æ®ä¸­çä¸é¨åãç°å¨æä»¬åªéç¥éä¸ä¸ªåçæ¯ä¸ä¸ª Lucene çå®ä¾ï¼ä»¥åå®æ¬èº«å°±æ¯ä¸ä¸ªå®æ´çæç´¢å¼æã æä»¬çææ¡£è¢«å­å¨åç´¢å¼å°åçåï¼ä½æ¯åºç¨ç¨åºæ¯ç´æ¥ä¸ç´¢å¼èä¸æ¯ä¸åçè¿è¡äº¤äºã\n\nElasticsearch æ¯å©ç¨åçå°æ°æ®ååå°éç¾¤ååå¤çãåçæ¯æ°æ®çå®¹å¨ï¼ææ¡£ä¿å­å¨åçåï¼åçåè¢«åéå°éç¾¤åçåä¸ªèç¹éã å½ä½ çéç¾¤è§æ¨¡æ©å¤§æèç¼©å°æ¶ï¼ Elasticsearch ä¼èªå¨çå¨åèç¹ä¸­è¿ç§»åçï¼ä½¿å¾æ°æ®ä»ç¶åååå¸å¨éç¾¤éã\n\nä¸ä¸ªåçå¯ä»¥æ¯ ä¸» åçæè å¯æ¬ åçã ç´¢å¼åä»»æä¸ä¸ªææ¡£é½å½å±äºä¸ä¸ªä¸»åçï¼æä»¥ä¸»åççæ°ç®å³å®çç´¢å¼è½å¤ä¿å­çæå¤§æ°æ®éã\n\n> ææ¯ä¸æ¥è¯´ï¼ä¸ä¸ªä¸»åçæå¤§è½å¤å­å¨ Integer.MAX_VALUE - 128 ä¸ªææ¡£ï¼ä½æ¯å®éæå¤§å¼è¿éè¦åèä½ çä½¿ç¨åºæ¯ï¼åæ¬ä½ ä½¿ç¨çç¡¬ä»¶ï¼ ææ¡£çå¤§å°åå¤æç¨åº¦ï¼ç´¢å¼åæ¥è¯¢ææ¡£çæ¹å¼ä»¥åä½ ææçååºæ¶é¿ã\n\nä¸ä¸ªå¯æ¬åçåªæ¯ä¸ä¸ªä¸»åççæ·è´ãå¯æ¬åçä½ä¸ºç¡¬ä»¶æéæ¶ä¿æ¤æ°æ®ä¸ä¸¢å¤±çåä½å¤ä»½ï¼å¹¶ä¸ºæç´¢åè¿åææ¡£ç­è¯»æä½æä¾æå¡ã\n\nå¨ç´¢å¼å»ºç«çæ¶åå°±å·²ç»ç¡®å®äºä¸»åçæ°ï¼ä½æ¯å¯æ¬åçæ°å¯ä»¥éæ¶ä¿®æ¹ã\n\nè®©æä»¬å¨åå«ä¸ä¸ªç©ºèç¹çéç¾¤ååå»ºåä¸º blogs çç´¢å¼ã ç´¢å¼å¨é»è®¤æåµä¸ä¼è¢«åé 5 ä¸ªä¸»åçï¼ ä½æ¯ä¸ºäºæ¼ç¤ºç®çï¼æä»¬å°åé 3 ä¸ªä¸»åçåä¸ä»½å¯æ¬ï¼æ¯ä¸ªä¸»åçæ¥æä¸ä¸ªå¯æ¬åçï¼ï¼\n\nPUT /blogs\n{\n   "settings" : {\n      "number_of_shards" : 3,\n      "number_of_replicas" : 1\n   }\n}\n\n\næä»¬çéç¾¤ç°å¨æ¯ æ¥æä¸ä¸ªç´¢å¼çåèç¹éç¾¤ãææ 3 ä¸ªä¸»åçé½è¢«åéå¨ Node 1 ã\n\nFigure 2. æ¥æä¸ä¸ªç´¢å¼çåèç¹éç¾¤\n\n\n\nå¦ææä»¬ç°å¨æ¥çéç¾¤å¥åº·ï¼æä»¬å°çå°å¦ä¸åå®¹ï¼\n\n{\n  "cluster_name": "elasticsearch",\n  "status": "yellow",\n  "timed_out": false,\n  "number_of_nodes": 1,\n  "number_of_data_nodes": 1,\n  "active_primary_shards": 3,\n  "active_shards": 3,\n  "relocating_shards": 0,\n  "initializing_shards": 0,\n  "unassigned_shards": 3,\n  "delayed_unassigned_shards": 0,\n  "number_of_pending_tasks": 0,\n  "number_of_in_flight_fetch": 0,\n  "task_max_waiting_in_queue_millis": 0,\n  "active_shards_percent_as_number": 50\n}\n\n\n * éç¾¤ status å¼ä¸º yellow\n * æ²¡æè¢«åéå°ä»»ä½èç¹çå¯æ¬æ°\n\néç¾¤çå¥åº·ç¶åµä¸º yellow åè¡¨ç¤ºå¨é¨ ä¸» åçé½æ­£å¸¸è¿è¡ï¼éç¾¤å¯ä»¥æ­£å¸¸æå¡ææè¯·æ±ï¼ï¼ä½æ¯ å¯æ¬ åçæ²¡æå¨é¨å¤å¨æ­£å¸¸ç¶æã å®éä¸ï¼ææ 3 ä¸ªå¯æ¬åçé½æ¯ unassigned ââ å®ä»¬é½æ²¡æè¢«åéå°ä»»ä½èç¹ã å¨åä¸ä¸ªèç¹ä¸æ¢ä¿å­åå§æ°æ®åä¿å­å¯æ¬æ¯æ²¡ææä¹çï¼å ä¸ºä¸æ¦å¤±å»äºé£ä¸ªèç¹ï¼æä»¬ä¹å°ä¸¢å¤±è¯¥èç¹ä¸çææå¯æ¬æ°æ®ã\n\nå½åæä»¬çéç¾¤æ¯æ­£å¸¸è¿è¡çï¼ä½æ¯å¨ç¡¬ä»¶æéæ¶æä¸¢å¤±æ°æ®çé£é©ã\n\n\n# æ·»å æéè½¬ç§»\n\nå½éç¾¤ä¸­åªæä¸ä¸ªèç¹å¨è¿è¡æ¶ï¼æå³çä¼æä¸ä¸ªåç¹æéé®é¢ââæ²¡æåä½ã å¹¸è¿çæ¯ï¼æä»¬åªéåå¯å¨ä¸ä¸ªèç¹å³å¯é²æ­¢æ°æ®ä¸¢å¤±ã\n\n> ä¸ºäºæµè¯ç¬¬äºä¸ªèç¹å¯å¨åçæåµï¼ä½ å¯ä»¥å¨åä¸ä¸ªç®å½åï¼å®å¨ä¾ç§å¯å¨ç¬¬ä¸ä¸ªèç¹çæ¹å¼æ¥å¯å¨ä¸ä¸ªæ°èç¹ï¼åèå®è£å¹¶è¿è¡ Elasticsearchï¼ãå¤ä¸ªèç¹å¯ä»¥å±äº«åä¸ä¸ªç®å½ã\n> \n> å½ä½ å¨åä¸å°æºå¨ä¸å¯å¨äºç¬¬äºä¸ªèç¹æ¶ï¼åªè¦å®åç¬¬ä¸ä¸ªèç¹æåæ ·ç cluster.name éç½®ï¼å®å°±ä¼èªå¨åç°éç¾¤å¹¶å å¥å°å¶ä¸­ã ä½æ¯å¨ä¸åæºå¨ä¸å¯å¨èç¹çæ¶åï¼ä¸ºäºå å¥å°åä¸éç¾¤ï¼ä½ éè¦éç½®ä¸ä¸ªå¯è¿æ¥å°çåæ­ä¸»æºåè¡¨ã\n\nå¦æå¯å¨äºç¬¬äºä¸ªèç¹ï¼æä»¬çéç¾¤å°ä¼æ¥æä¸¤ä¸ªèç¹çéç¾¤ââææä¸»åçåå¯æ¬åçé½å·²è¢«åéã\n\nFigure 3. æ¥æä¸¤ä¸ªèç¹çéç¾¤ââææä¸»åçåå¯æ¬åçé½å·²è¢«åé\n\n\n\nå½ç¬¬äºä¸ªèç¹å å¥å°éç¾¤åï¼3 ä¸ª å¯æ¬åç å°ä¼åéå°è¿ä¸ªèç¹ä¸ââæ¯ä¸ªä¸»åçå¯¹åºä¸ä¸ªå¯æ¬åçã è¿æå³çå½éç¾¤åä»»ä½ä¸ä¸ªèç¹åºç°é®é¢æ¶ï¼æä»¬çæ°æ®é½å®å¥½æ æã\n\næææ°è¿è¢«ç´¢å¼çææ¡£é½å°ä¼ä¿å­å¨ä¸»åçä¸ï¼ç¶åè¢«å¹¶è¡çå¤å¶å°å¯¹åºçå¯æ¬åçä¸ãè¿å°±ä¿è¯äºæä»¬æ¢å¯ä»¥ä»ä¸»åçåå¯ä»¥ä»å¯æ¬åçä¸è·å¾ææ¡£ã\n\ncluster-health ç°å¨å±ç¤ºçç¶æä¸º green ï¼è¿è¡¨ç¤ºææ 6 ä¸ªåçï¼åæ¬ 3 ä¸ªä¸»åçå 3 ä¸ªå¯æ¬åçï¼é½å¨æ­£å¸¸è¿è¡ã\n\n{\n  "cluster_name": "elasticsearch",\n  "status": "green",\n  "timed_out": false,\n  "number_of_nodes": 2,\n  "number_of_data_nodes": 2,\n  "active_primary_shards": 3,\n  "active_shards": 6,\n  "relocating_shards": 0,\n  "initializing_shards": 0,\n  "unassigned_shards": 0,\n  "delayed_unassigned_shards": 0,\n  "number_of_pending_tasks": 0,\n  "number_of_in_flight_fetch": 0,\n  "task_max_waiting_in_queue_millis": 0,\n  "active_shards_percent_as_number": 100\n}\n\n\n * éç¾¤ status å¼ä¸º green\n\næä»¬çéç¾¤ç°å¨ä¸ä»ä»æ¯æ­£å¸¸è¿è¡çï¼å¹¶ä¸è¿å¤äº å§ç»å¯ç¨ çç¶æã\n\n\n# æ°´å¹³æ©å®¹\n\nææ ·ä¸ºæä»¬çæ­£å¨å¢é¿ä¸­çåºç¨ç¨åºæéæ©å®¹å¢ï¼ å½å¯å¨äºç¬¬ä¸ä¸ªèç¹ï¼æä»¬çéç¾¤å°æ¥æä¸ä¸ªèç¹çéç¾¤ââä¸ºäºåæ£è´è½½èå¯¹åçè¿è¡éæ°åéã\n\nFigure 4. æ¥æä¸ä¸ªèç¹çéç¾¤ââä¸ºäºåæ£è´è½½èå¯¹åçè¿è¡éæ°åé\n\n\n\nNode 1 å Node 2 ä¸åæä¸ä¸ªåçè¢«è¿ç§»å°äºæ°ç Node 3 èç¹ï¼ç°å¨æ¯ä¸ªèç¹ä¸é½æ¥æ 2 ä¸ªåçï¼èä¸æ¯ä¹åç 3 ä¸ªã è¿è¡¨ç¤ºæ¯ä¸ªèç¹çç¡¬ä»¶èµæºï¼CPU, RAM, I/Oï¼å°è¢«æ´å°çåçæå±äº«ï¼æ¯ä¸ªåççæ§è½å°ä¼å¾å°æåã\n\nåçæ¯ä¸ä¸ªåè½å®æ´çæç´¢å¼æï¼å®æ¥æä½¿ç¨ä¸ä¸ªèç¹ä¸çææèµæºçè½åã æä»¬è¿ä¸ªæ¥æ 6 ä¸ªåçï¼3 ä¸ªä¸»åçå 3 ä¸ªå¯æ¬åçï¼çç´¢å¼å¯ä»¥æå¤§æ©å®¹å° 6 ä¸ªèç¹ï¼æ¯ä¸ªèç¹ä¸å­å¨ä¸ä¸ªåçï¼å¹¶ä¸æ¯ä¸ªåçæ¥ææå¨èç¹çå¨é¨èµæºã\n\n\n# æ´å¤çæ©å®¹\n\nä½æ¯å¦ææä»¬æ³è¦æ©å®¹è¶è¿ 6 ä¸ªèç¹æä¹åå¢ï¼\n\nä¸»åççæ°ç®å¨ç´¢å¼åå»ºæ¶å°±å·²ç»ç¡®å®äºä¸æ¥ãå®éä¸ï¼è¿ä¸ªæ°ç®å®ä¹äºè¿ä¸ªç´¢å¼è½å¤ å­å¨ çæå¤§æ°æ®éãï¼å®éå¤§å°åå³äºä½ çæ°æ®ãç¡¬ä»¶åä½¿ç¨åºæ¯ãï¼ ä½æ¯ï¼è¯»æä½ââæç´¢åè¿åæ°æ®ââå¯ä»¥åæ¶è¢«ä¸»åç æ å¯æ¬åçæå¤çï¼æä»¥å½ä½ æ¥æè¶å¤çå¯æ¬åçæ¶ï¼ä¹å°æ¥æè¶é«çååéã\n\nå¨è¿è¡ä¸­çéç¾¤ä¸æ¯å¯ä»¥å¨æè°æ´å¯æ¬åçæ°ç®çï¼æä»¬å¯ä»¥æéä¼¸ç¼©éç¾¤ãè®©æä»¬æå¯æ¬æ°ä»é»è®¤ç 1 å¢å å° 2 ï¼\n\nPUT /blogs/_settings\n{\n   "number_of_replicas" : 2\n}\n\n\nblogs ç´¢å¼ç°å¨æ¥æ 9 ä¸ªåçï¼3 ä¸ªä¸»åçå 6 ä¸ªå¯æ¬åçã è¿æå³çæä»¬å¯ä»¥å°éç¾¤æ©å®¹å° 9 ä¸ªèç¹ï¼æ¯ä¸ªèç¹ä¸ä¸ä¸ªåçãç¸æ¯åæ¥ 3 ä¸ªèç¹æ¶ï¼éç¾¤æç´¢æ§è½å¯ä»¥æå 3 åã\n\nFigure 5. å°åæ° number_of_replicas è°å¤§å° 2\n\n\n\n> å½ç¶ï¼å¦æåªæ¯å¨ç¸åèç¹æ°ç®çéç¾¤ä¸å¢å æ´å¤çå¯æ¬åçå¹¶ä¸è½æé«æ§è½ï¼å ä¸ºæ¯ä¸ªåçä»èç¹ä¸è·å¾çèµæºä¼åå°ã ä½ éè¦å¢å æ´å¤çç¡¬ä»¶èµæºæ¥æåååéã\n> \n> ä½æ¯æ´å¤çå¯æ¬åçæ°æé«äºæ°æ®åä½éï¼æç§ä¸é¢çèç¹éç½®ï¼æä»¬å¯ä»¥å¨å¤±å» 2 ä¸ªèç¹çæåµä¸ä¸ä¸¢å¤±ä»»ä½æ°æ®ã\n\n\n# åºå¯¹æé\n\næä»¬ä¹åè¯´è¿ Elasticsearch å¯ä»¥åºå¯¹èç¹æéï¼æ¥ä¸æ¥è®©æä»¬å°è¯ä¸è¿ä¸ªåè½ã å¦ææä»¬å³é­ç¬¬ä¸ä¸ªèç¹ï¼è¿æ¶éç¾¤çç¶æä¸ºå³é­äºä¸ä¸ªèç¹åçéç¾¤ã\n\nFigure 6. å³é­äºä¸ä¸ªèç¹åçéç¾¤\n\n\n\næä»¬å³é­çèç¹æ¯ä¸ä¸ªä¸»èç¹ãèéç¾¤å¿é¡»æ¥æä¸ä¸ªä¸»èç¹æ¥ä¿è¯æ­£å¸¸å·¥ä½ï¼æä»¥åççç¬¬ä¸ä»¶äºæå°±æ¯éä¸¾ä¸ä¸ªæ°çä¸»èç¹ï¼ Node 2 ã\n\nå¨æä»¬å³é­ Node 1 çåæ¶ä¹å¤±å»äºä¸»åç 1 å 2 ï¼å¹¶ä¸å¨ç¼ºå¤±ä¸»åççæ¶åç´¢å¼ä¹ä¸è½æ­£å¸¸å·¥ä½ã å¦ææ­¤æ¶æ¥æ£æ¥éç¾¤çç¶åµï¼æä»¬çå°çç¶æå°ä¼ä¸º red ï¼ä¸æ¯ææä¸»åçé½å¨æ­£å¸¸å·¥ä½ã\n\nå¹¸è¿çæ¯ï¼å¨å¶å®èç¹ä¸å­å¨çè¿ä¸¤ä¸ªä¸»åççå®æ´å¯æ¬ï¼ æä»¥æ°çä¸»èç¹ç«å³å°è¿äºåçå¨ Node 2 å Node 3 ä¸å¯¹åºçå¯æ¬åçæåä¸ºä¸»åçï¼ æ­¤æ¶éç¾¤çç¶æå°ä¼ä¸º yellow ã è¿ä¸ªæåä¸»åççè¿ç¨æ¯ç¬é´åççï¼å¦åæä¸ä¸ä¸ªå¼å³ä¸è¬ã\n\nä¸ºä»ä¹æä»¬éç¾¤ç¶ææ¯ yellow èä¸æ¯ green å¢ï¼ è½ç¶æä»¬æ¥æææçä¸ä¸ªä¸»åçï¼ä½æ¯åæ¶è®¾ç½®äºæ¯ä¸ªä¸»åçéè¦å¯¹åº 2 ä»½å¯æ¬åçï¼èæ­¤æ¶åªå­å¨ä¸ä»½å¯æ¬åçã æä»¥éç¾¤ä¸è½ä¸º green çç¶æï¼ä¸è¿æä»¬ä¸å¿è¿äºæå¿ï¼å¦ææä»¬åæ ·å³é­äº Node 2 ï¼æä»¬çç¨åº ä¾ç¶ å¯ä»¥ä¿æå¨ä¸ä¸¢ä»»ä½æ°æ®çæåµä¸è¿è¡ï¼å ä¸º Node 3 ä¸ºæ¯ä¸ä¸ªåçé½ä¿ççä¸ä»½å¯æ¬ã\n\nå¦ææä»¬éæ°å¯å¨ Node 1 ï¼éç¾¤å¯ä»¥å°ç¼ºå¤±çå¯æ¬åçåæ¬¡è¿è¡åéï¼é£ä¹éç¾¤çç¶æä¹å°å¦ Figure 5. å°åæ° number_of_replicas è°å¤§å° 2 æç¤ºã å¦æ Node 1 ä¾ç¶æ¥æçä¹åçåçï¼å®å°å°è¯å»éç¨å®ä»¬ï¼åæ¶ä»ä»ä¸»åçå¤å¶åçäºä¿®æ¹çæ°æ®æä»¶ã\n\nå°ç®åä¸ºæ­¢ï¼ä½ åºè¯¥å¯¹åçå¦ä½ä½¿å¾ Elasticsearch è¿è¡æ°´å¹³æ©å®¹ä»¥åæ°æ®ä¿éç­ç¥è¯æäºä¸å®äºè§£ã æ¥ä¸æ¥æä»¬å°è®²è¿°å³äºåççå½å¨æçæ´å¤ç»èã\n\n\n# åç\n\n>  * ä¸ºä»ä¹æç´¢æ¯ è¿ å®æ¶çï¼\n>  * ä¸ºä»ä¹ææ¡£ç CRUD (åå»º-è¯»å-æ´æ°-å é¤) æä½æ¯ å®æ¶ ç?\n>  * Elasticsearch æ¯ææ ·ä¿è¯æ´æ°è¢«æä¹åå¨æ­çµæ¶ä¹ä¸ä¸¢å¤±æ°æ®?\n>  * ä¸ºä»ä¹å é¤ææ¡£ä¸ä¼ç«å»éæ¾ç©ºé´ï¼\n>  * refresh, flush, å optimize API é½åäºä»ä¹, ä½ ä»ä¹æåµä¸åºè¯¥ä½¿ç¨ä»ä»¬ï¼\n\n\n# ä½¿ææ¬å¯è¢«æç´¢\n\nå¿é¡»è§£å³çç¬¬ä¸ä¸ªæææ¯å¦ä½ä½¿ææ¬å¯è¢«æç´¢ã ä¼ ç»çæ°æ®åºæ¯ä¸ªå­æ®µå­å¨åä¸ªå¼ï¼ä½è¿å¯¹å¨ææ£ç´¢å¹¶ä¸å¤ãææ¬å­æ®µä¸­çæ¯ä¸ªåè¯éè¦è¢«æç´¢ï¼å¯¹æ°æ®åºæå³çéè¦åä¸ªå­æ®µæç´¢å¼å¤å¼(è¿éæåè¯)çè½åã\n\næå¥½çæ¯æ ä¸ä¸ªå­æ®µå¤ä¸ªå¼ éæ±çæ°æ®ç»ææ¯æä»¬å¨ åæç´¢å¼ ç« èä¸­ä»ç»è¿ç åæç´¢å¼ ã åæç´¢å¼åå«ä¸ä¸ªæåºåè¡¨ï¼åè¡¨åå«ææææ¡£åºç°è¿çä¸éå¤ä¸ªä½ï¼æç§°ä¸º è¯é¡¹ ï¼å¯¹äºæ¯ä¸ä¸ªè¯é¡¹ï¼åå«äºå®æææ¾åºç°è¿ææ¡£çåè¡¨ã\n\nTerm  | Doc 1 | Doc 2 | Doc 3 | ...\n------------------------------------\nbrown |   X   |       |  X    | ...\nfox   |   X   |   X   |  X    | ...\nquick |   X   |   X   |       | ...\nthe   |   X   |       |  X    | ...\n\n\n> å½è®¨è®ºåæç´¢å¼æ¶ï¼æä»¬ä¼è°å° ææ¡£ æ å¼ï¼å ä¸ºåå²åå ï¼åæç´¢å¼è¢«ç¨æ¥å¯¹æ´ä¸ªéç»æåææ¬ææ¡£è¿è¡æ å¼ã Elasticsearch ä¸­ç ææ¡£ æ¯æå­æ®µåå¼çç»æå JSON ææ¡£ãäºå®ä¸ï¼å¨ JSON ææ¡£ä¸­ï¼ æ¯ä¸ªè¢«ç´¢å¼çå­æ®µé½æèªå·±çåæç´¢å¼ã\n\nè¿ä¸ªåæç´¢å¼ç¸æ¯ç¹å®è¯é¡¹åºç°è¿çææ¡£åè¡¨ï¼ä¼åå«æ´å¤å¶å®ä¿¡æ¯ãå®ä¼ä¿å­æ¯ä¸ä¸ªè¯é¡¹åºç°è¿çææ¡£æ»æ°ï¼ å¨å¯¹åºçææ¡£ä¸­ä¸ä¸ªå·ä½è¯é¡¹åºç°çæ»æ¬¡æ°ï¼è¯é¡¹å¨ææ¡£ä¸­çé¡ºåºï¼æ¯ä¸ªææ¡£çé¿åº¦ï¼ææææ¡£çå¹³åé¿åº¦ï¼ç­ç­ãè¿äºç»è®¡ä¿¡æ¯åè®¸ Elasticsearch å³å®åªäºè¯æ¯å¶å®è¯æ´éè¦ï¼åªäºææ¡£æ¯å¶å®ææ¡£æ´éè¦ï¼è¿äºåå®¹å¨ ä»ä¹æ¯ç¸å³æ§? ä¸­ææè¿°ã\n\nä¸ºäºè½å¤å®ç°é¢æåè½ï¼åæç´¢å¼éè¦ç¥ééåä¸­ç ææ ææ¡£ï¼è¿æ¯éè¦è®¤è¯å°çå³é®é®é¢ã\n\næ©æçå¨ææ£ç´¢ä¼ä¸ºæ´ä¸ªææ¡£éåå»ºç«ä¸ä¸ªå¾å¤§çåæç´¢å¼å¹¶å°å¶åå¥å°ç£çã ä¸æ¦æ°çç´¢å¼å°±ç»ªï¼æ§çå°±ä¼è¢«å¶æ¿æ¢ï¼è¿æ ·æè¿çååä¾¿å¯ä»¥è¢«æ£ç´¢å°ã\n\n\n# ä¸åæ§\n\nåæç´¢å¼è¢«åå¥ç£çåæ¯ ä¸å¯æ¹å ç:å®æ°¸è¿ä¸ä¼ä¿®æ¹ã ä¸åæ§æéè¦çä»·å¼ï¼\n\n * ä¸éè¦éãå¦æä½ ä»æ¥ä¸æ´æ°ç´¢å¼ï¼ä½ å°±ä¸éè¦æå¿å¤è¿ç¨åæ¶ä¿®æ¹æ°æ®çé®é¢ã\n * ä¸æ¦ç´¢å¼è¢«è¯»å¥åæ ¸çæä»¶ç³»ç»ç¼å­ï¼ä¾¿ä¼çå¨åªéï¼ç±äºå¶ä¸åæ§ãåªè¦æä»¶ç³»ç»ç¼å­ä¸­è¿æè¶³å¤çç©ºé´ï¼é£ä¹å¤§é¨åè¯»è¯·æ±ä¼ç´æ¥è¯·æ±åå­ï¼èä¸ä¼å½ä¸­ç£çãè¿æä¾äºå¾å¤§çæ§è½æåã\n * å¶å®ç¼å­(å filter ç¼å­)ï¼å¨ç´¢å¼ççå½å¨æåå§ç»ææãå®ä»¬ä¸éè¦å¨æ¯æ¬¡æ°æ®æ¹åæ¶è¢«éå»ºï¼å ä¸ºæ°æ®ä¸ä¼ååã\n * åå¥åä¸ªå¤§çåæç´¢å¼åè®¸æ°æ®è¢«åç¼©ï¼åå°ç£ç I/O å éè¦è¢«ç¼å­å°åå­çç´¢å¼çä½¿ç¨éã\n\nå½ç¶ï¼ä¸ä¸ªä¸åçç´¢å¼ä¹æä¸å¥½çå°æ¹ãä¸»è¦äºå®æ¯å®æ¯ä¸å¯åç! ä½ ä¸è½ä¿®æ¹å®ãå¦æä½ éè¦è®©ä¸ä¸ªæ°çææ¡£ å¯è¢«æç´¢ï¼ä½ éè¦éå»ºæ´ä¸ªç´¢å¼ãè¿è¦ä¹å¯¹ä¸ä¸ªç´¢å¼æè½åå«çæ°æ®éé æäºå¾å¤§çéå¶ï¼è¦ä¹å¯¹ç´¢å¼å¯è¢«æ´æ°çé¢çé æäºå¾å¤§çéå¶ã\n\n\n# å¨ææ´æ°ç´¢å¼\n\nä¸ä¸ä¸ªéè¦è¢«è§£å³çé®é¢æ¯ææ ·å¨ä¿çä¸åæ§çåæä¸å®ç°åæç´¢å¼çæ´æ°ï¼ç­æ¡æ¯: ç¨æ´å¤çç´¢å¼ã\n\néè¿å¢å æ°çè¡¥åç´¢å¼æ¥åæ æ°è¿çä¿®æ¹ï¼èä¸æ¯ç´æ¥éåæ´ä¸ªåæç´¢å¼ãæ¯ä¸ä¸ªåæç´¢å¼é½ä¼è¢«è½®æµæ¥è¯¢å°âä»ææ©çå¼å§âæ¥è¯¢å®ååå¯¹ç»æè¿è¡åå¹¶ã\n\nElasticsearch åºäº Lucene, è¿ä¸ª java åºå¼å¥äº ææ®µæç´¢ çæ¦å¿µã æ¯ä¸ æ®µ æ¬èº«é½æ¯ä¸ä¸ªåæç´¢å¼ï¼ ä½ ç´¢å¼ å¨ Lucene ä¸­é¤è¡¨ç¤ºææ æ®µ çéåå¤ï¼ è¿å¢å äº æäº¤ç¹ çæ¦å¿µ â ä¸ä¸ªååºäºææå·²ç¥æ®µçæä»¶ï¼å°±åå¨ Figure 16, âä¸ä¸ª Lucene ç´¢å¼åå«ä¸ä¸ªæäº¤ç¹åä¸ä¸ªæ®µâ ä¸­æç»çé£æ ·ã å¦ Figure 17, âä¸ä¸ªå¨åå­ç¼å­ä¸­åå«æ°ææ¡£ç Lucene ç´¢å¼â æç¤ºï¼æ°çææ¡£é¦åè¢«æ·»å å°åå­ç´¢å¼ç¼å­ä¸­ï¼ç¶ååå¥å°ä¸ä¸ªåºäºç£ççæ®µï¼å¦ Figure 18, âå¨ä¸æ¬¡æäº¤åï¼ä¸ä¸ªæ°çæ®µè¢«æ·»å å°æäº¤ç¹èä¸ç¼å­è¢«æ¸ç©ºãâ æç¤ºã\n\nFigure 16. ä¸ä¸ª Lucene ç´¢å¼åå«ä¸ä¸ªæäº¤ç¹åä¸ä¸ªæ®µ\n\n\n\n> è¢«æ··æ·çæ¦å¿µæ¯ï¼ä¸ä¸ª Lucene ç´¢å¼ æä»¬å¨ Elasticsearch ç§°ä½ åç ã ä¸ä¸ª Elasticsearch ç´¢å¼ æ¯åççéåã å½ Elasticsearch å¨ç´¢å¼ä¸­æç´¢çæ¶åï¼ ä»åéæ¥è¯¢å°æ¯ä¸ä¸ªå±äºç´¢å¼çåç(Lucene ç´¢å¼)ï¼ç¶åå æ§è¡åå¸å¼æ£ç´¢ æå°çé£æ ·ï¼åå¹¶æ¯ä¸ªåççç»æå°ä¸ä¸ªå¨å±çç»æéã\n\néæ®µæç´¢ä¼ä»¥å¦ä¸æµç¨è¿è¡å·¥ä½ï¼\n\n 1. æ°ææ¡£è¢«æ¶éå°åå­ç´¢å¼ç¼å­ï¼ è§ Figure 17, âä¸ä¸ªå¨åå­ç¼å­ä¸­åå«æ°ææ¡£ç Lucene ç´¢å¼â ã\n 2. ä¸æ¶å°, ç¼å­è¢« æäº¤ ï¼\n    * ä¸ä¸ªæ°çæ®µâä¸ä¸ªè¿½å çåæç´¢å¼âè¢«åå¥ç£çã\n    * ä¸ä¸ªæ°çåå«æ°æ®µåå­ç æäº¤ç¹ è¢«åå¥ç£çã\n    * ç£çè¿è¡ åæ­¥ â ææå¨æä»¶ç³»ç»ç¼å­ä¸­ç­å¾çåå¥é½å·æ°å°ç£çï¼ä»¥ç¡®ä¿å®ä»¬è¢«åå¥ç©çæä»¶ã\n 3. æ°çæ®µè¢«å¼å¯ï¼è®©å®åå«çææ¡£å¯è§ä»¥è¢«æç´¢ã\n 4. åå­ç¼å­è¢«æ¸ç©ºï¼ç­å¾æ¥æ¶æ°çææ¡£ã\n\nFigure 17. ä¸ä¸ªå¨åå­ç¼å­ä¸­åå«æ°ææ¡£ç Lucene ç´¢å¼\n\n\n\nFigure 18. å¨ä¸æ¬¡æäº¤åï¼ä¸ä¸ªæ°çæ®µè¢«æ·»å å°æäº¤ç¹èä¸ç¼å­è¢«æ¸ç©ºã\n\n\n\nå½ä¸ä¸ªæ¥è¯¢è¢«è§¦åï¼ææå·²ç¥çæ®µæé¡ºåºè¢«æ¥è¯¢ãè¯é¡¹ç»è®¡ä¼å¯¹æææ®µçç»æè¿è¡èåï¼ä»¥ä¿è¯æ¯ä¸ªè¯åæ¯ä¸ªææ¡£çå³èé½è¢«åç¡®è®¡ç®ã è¿ç§æ¹å¼å¯ä»¥ç¨ç¸å¯¹è¾ä½çææ¬å°æ°ææ¡£æ·»å å°ç´¢å¼ã\n\n\n# å é¤åæ´æ°\n\næ®µæ¯ä¸å¯æ¹åçï¼æä»¥æ¢ä¸è½ä»æææ¡£ä»æ§çæ®µä¸­ç§»é¤ï¼ä¹ä¸è½ä¿®æ¹æ§çæ®µæ¥è¿è¡åæ ææ¡£çæ´æ°ã åèä»£ä¹çæ¯ï¼æ¯ä¸ªæäº¤ç¹ä¼åå«ä¸ä¸ª .del æä»¶ï¼æä»¶ä¸­ä¼ååºè¿äºè¢«å é¤ææ¡£çæ®µä¿¡æ¯ã\n\nå½ä¸ä¸ªææ¡£è¢« âå é¤â æ¶ï¼å®å®éä¸åªæ¯å¨ .del æä»¶ä¸­è¢« æ è®° å é¤ãä¸ä¸ªè¢«æ è®°å é¤çææ¡£ä»ç¶å¯ä»¥è¢«æ¥è¯¢å¹éå°ï¼ ä½å®ä¼å¨æç»ç»æè¢«è¿ååä»ç»æéä¸­ç§»é¤ã\n\nææ¡£æ´æ°ä¹æ¯ç±»ä¼¼çæä½æ¹å¼ï¼å½ä¸ä¸ªææ¡£è¢«æ´æ°æ¶ï¼æ§çæ¬ææ¡£è¢«æ è®°å é¤ï¼ææ¡£çæ°çæ¬è¢«ç´¢å¼å°ä¸ä¸ªæ°çæ®µä¸­ã å¯è½ä¸¤ä¸ªçæ¬çææ¡£é½ä¼è¢«ä¸ä¸ªæ¥è¯¢å¹éå°ï¼ä½è¢«å é¤çé£ä¸ªæ§çæ¬ææ¡£å¨ç»æéè¿ååå°±å·²ç»è¢«ç§»é¤ã\n\nå¨ æ®µåå¹¶ , æä»¬å±ç¤ºäºä¸ä¸ªè¢«å é¤çææ¡£æ¯ææ ·è¢«æä»¶ç³»ç»ç§»é¤çã\n\n\n# è¿å®æ¶æç´¢\n\néçææ®µï¼per-segmentï¼æç´¢çåå±ï¼ä¸ä¸ªæ°çææ¡£ä»ç´¢å¼å°å¯è¢«æç´¢çå»¶è¿æ¾èéä½äºãæ°ææ¡£å¨å åéä¹åå³å¯è¢«æ£ç´¢ï¼ä½è¿æ ·è¿æ¯ä¸å¤å¿«ã\n\nç£çå¨è¿éæä¸ºäºç¶é¢ãæäº¤ï¼Commitingï¼ä¸ä¸ªæ°çæ®µå°ç£çéè¦ä¸ä¸ª fsync æ¥ç¡®ä¿æ®µè¢«ç©çæ§å°åå¥ç£çï¼è¿æ ·å¨æ­çµçæ¶åå°±ä¸ä¼ä¸¢å¤±æ°æ®ã ä½æ¯ fsync æä½ä»£ä»·å¾å¤§; å¦ææ¯æ¬¡ç´¢å¼ä¸ä¸ªææ¡£é½å»æ§è¡ä¸æ¬¡çè¯ä¼é æå¾å¤§çæ§è½é®é¢ã\n\næä»¬éè¦çæ¯ä¸ä¸ªæ´è½»éçæ¹å¼æ¥ä½¿ä¸ä¸ªææ¡£å¯è¢«æç´¢ï¼è¿æå³ç fsync è¦ä»æ´ä¸ªè¿ç¨ä¸­è¢«ç§»é¤ã\n\nå¨ Elasticsearch åç£çä¹é´æ¯æä»¶ç³»ç»ç¼å­ã åä¹åæè¿°çä¸æ ·ï¼ å¨åå­ç´¢å¼ç¼å²åºï¼ Figure 19, âå¨åå­ç¼å²åºä¸­åå«äºæ°ææ¡£ç Lucene ç´¢å¼â ï¼ä¸­çææ¡£ä¼è¢«åå¥å°ä¸ä¸ªæ°çæ®µä¸­ï¼ Figure 20, âç¼å²åºçåå®¹å·²ç»è¢«åå¥ä¸ä¸ªå¯è¢«æç´¢çæ®µä¸­ï¼ä½è¿æ²¡æè¿è¡æäº¤â ï¼ã ä½æ¯è¿éæ°æ®µä¼è¢«ååå¥å°æä»¶ç³»ç»ç¼å­âè¿ä¸æ­¥ä»£ä»·ä¼æ¯è¾ä½ï¼ç¨ååè¢«å·æ°å°ç£çâè¿ä¸æ­¥ä»£ä»·æ¯è¾é«ãä¸è¿åªè¦æä»¶å·²ç»å¨ç¼å­ä¸­ï¼ å°±å¯ä»¥åå¶å®æä»¶ä¸æ ·è¢«æå¼åè¯»åäºã\n\nFigure 19. å¨åå­ç¼å²åºä¸­åå«äºæ°ææ¡£ç Lucene ç´¢å¼\n\n\n\nLucene åè®¸æ°æ®µè¢«åå¥åæå¼âä½¿å¶åå«çææ¡£å¨æªè¿è¡ä¸æ¬¡å®æ´æäº¤æ¶ä¾¿å¯¹æç´¢å¯è§ã è¿ç§æ¹å¼æ¯è¿è¡ä¸æ¬¡æäº¤ä»£ä»·è¦å°å¾å¤ï¼å¹¶ä¸å¨ä¸å½±åæ§è½çåæä¸å¯ä»¥è¢«é¢ç¹å°æ§è¡ã\n\nFigure 20. ç¼å²åºçåå®¹å·²ç»è¢«åå¥ä¸ä¸ªå¯è¢«æç´¢çæ®µä¸­ï¼ä½è¿æ²¡æè¿è¡æäº¤\n\n\n\n\n# refresh API\n\nå¨ Elasticsearch ä¸­ï¼åå¥åæå¼ä¸ä¸ªæ°æ®µçè½»éçè¿ç¨å«å refresh ã é»è®¤æåµä¸æ¯ä¸ªåçä¼æ¯ç§èªå¨å·æ°ä¸æ¬¡ãè¿å°±æ¯ä¸ºä»ä¹æä»¬è¯´ Elasticsearch æ¯ è¿ å®æ¶æç´¢: ææ¡£çååå¹¶ä¸æ¯ç«å³å¯¹æç´¢å¯è§ï¼ä½ä¼å¨ä¸ç§ä¹ååä¸ºå¯è§ã\n\nè¿äºè¡ä¸ºå¯è½ä¼å¯¹æ°ç¨æ·é æå°æ: ä»ä»¬ç´¢å¼äºä¸ä¸ªææ¡£ç¶åå°è¯æç´¢å®ï¼ä½å´æ²¡ææå°ãè¿ä¸ªé®é¢çè§£å³åæ³æ¯ç¨ refresh API æ§è¡ä¸æ¬¡æå¨å·æ°:\n\nPOST /_refresh\nPOST /blogs/_refresh\n\n\nå·æ°ï¼Refreshï¼ææçç´¢å¼\n\nåªå·æ°ï¼Refreshï¼ blogs ç´¢å¼\n\n> å°½ç®¡å·æ°æ¯æ¯æäº¤è½»éå¾å¤çæä½ï¼å®è¿æ¯ä¼ææ§è½å¼éãå½åæµè¯çæ¶åï¼ æå¨å·æ°å¾æç¨ï¼ä½æ¯ä¸è¦å¨çäº§ç¯å¢ä¸æ¯æ¬¡ç´¢å¼ä¸ä¸ªææ¡£é½å»æå¨å·æ°ã ç¸åï¼ä½ çåºç¨éè¦æè¯å° Elasticsearch çè¿å®æ¶çæ§è´¨ï¼å¹¶æ¥åå®çä¸è¶³ã\n\nå¹¶ä¸æ¯ææçæåµé½éè¦æ¯ç§å·æ°ãå¯è½ä½ æ­£å¨ä½¿ç¨ Elasticsearch ç´¢å¼å¤§éçæ¥å¿æä»¶ï¼ ä½ å¯è½æ³ä¼åç´¢å¼éåº¦èä¸æ¯è¿å®æ¶æç´¢ï¼ å¯ä»¥éè¿è®¾ç½® refresh_interval ï¼ éä½æ¯ä¸ªç´¢å¼çå·æ°é¢çï¼\n\nPUT /my_logs\n{\n  "settings": {\n    "refresh_interval": "30s"\n  }\n}\n\n\n> æ¯ 30 ç§å·æ° my_logs ç´¢å¼ã\n\nrefresh_interval å¯ä»¥å¨æ¢å­ç´¢å¼ä¸è¿è¡å¨ææ´æ°ã å¨çäº§ç¯å¢ä¸­ï¼å½ä½ æ­£å¨å»ºç«ä¸ä¸ªå¤§çæ°ç´¢å¼æ¶ï¼å¯ä»¥åå³é­èªå¨å·æ°ï¼å¾å¼å§ä½¿ç¨è¯¥ç´¢å¼æ¶ï¼åæå®ä»¬è°åæ¥ï¼\n\nPUT /my_logs/_settings\n{ "refresh_interval": -1 }\n\nPUT /my_logs/_settings\n{ "refresh_interval": "1s" }\n\n\n * å³é­èªå¨å·æ°ã\n\n * æ¯ç§èªå¨å·æ°ã\n\n> refresh_interval éè¦ä¸ä¸ª æç»­æ¶é´ å¼ï¼ ä¾å¦ 1s ï¼1 ç§ï¼ æ 2m ï¼2 åéï¼ã ä¸ä¸ªç»å¯¹å¼ 1 è¡¨ç¤ºçæ¯ 1 æ¯«ç§ --æ çä¼ä½¿ä½ çéç¾¤é·å¥ç«çªã\n\n\n# æä¹ååæ´\n\nå¦ææ²¡æç¨ fsync ææ°æ®ä»æä»¶ç³»ç»ç¼å­å·ï¼flushï¼å°ç¡¬çï¼æä»¬ä¸è½ä¿è¯æ°æ®å¨æ­çµçè³æ¯ç¨åºæ­£å¸¸éåºä¹åä¾ç¶å­å¨ãä¸ºäºä¿è¯ Elasticsearch çå¯é æ§ï¼éè¦ç¡®ä¿æ°æ®ååè¢«æä¹åå°ç£çã\n\nå¨ å¨ææ´æ°ç´¢å¼ï¼æä»¬è¯´ä¸æ¬¡å®æ´çæäº¤ä¼å°æ®µå·å°ç£çï¼å¹¶åå¥ä¸ä¸ªåå«æææ®µåè¡¨çæäº¤ç¹ãElasticsearch å¨å¯å¨æéæ°æå¼ä¸ä¸ªç´¢å¼çè¿ç¨ä¸­ä½¿ç¨è¿ä¸ªæäº¤ç¹æ¥å¤æ­åªäºæ®µé¶å±äºå½ååçã\n\nå³ä½¿éè¿æ¯ç§å·æ°ï¼refreshï¼å®ç°äºè¿å®æ¶æç´¢ï¼æä»¬ä»ç¶éè¦ç»å¸¸è¿è¡å®æ´æäº¤æ¥ç¡®ä¿è½ä»å¤±è´¥ä¸­æ¢å¤ãä½å¨ä¸¤æ¬¡æäº¤ä¹é´åçååçææ¡£æä¹åï¼æä»¬ä¹ä¸å¸æä¸¢å¤±æè¿äºæ°æ®ã\n\nElasticsearch å¢å äºä¸ä¸ª translog ï¼æèå«äºå¡æ¥å¿ï¼å¨æ¯ä¸æ¬¡å¯¹ Elasticsearch è¿è¡æä½æ¶åè¿è¡äºæ¥å¿è®°å½ãéè¿ translog ï¼æ´ä¸ªæµç¨çèµ·æ¥æ¯ä¸é¢è¿æ ·ï¼\n\nä¸ä¸ªææ¡£è¢«ç´¢å¼ä¹åï¼å°±ä¼è¢«æ·»å å°åå­ç¼å²åºï¼å¹¶ä¸ è¿½å å°äº translog ï¼æ­£å¦ Figure 21, âæ°çææ¡£è¢«æ·»å å°åå­ç¼å²åºå¹¶ä¸è¢«è¿½å å°äºäºå¡æ¥å¿â æè¿°çä¸æ ·ã\n\nFigure 21. æ°çææ¡£è¢«æ·»å å°åå­ç¼å²åºå¹¶ä¸è¢«è¿½å å°äºäºå¡æ¥å¿\n\n\n\nå·æ°ï¼refreshï¼ä½¿åçå¤äº Figure 22, âå·æ°ï¼refreshï¼å®æå, ç¼å­è¢«æ¸ç©ºä½æ¯äºå¡æ¥å¿ä¸ä¼â æè¿°çç¶æï¼åçæ¯ç§è¢«å·æ°ï¼refreshï¼ä¸æ¬¡ï¼\n\n * è¿äºå¨åå­ç¼å²åºçææ¡£è¢«åå¥å°ä¸ä¸ªæ°çæ®µä¸­ï¼ä¸æ²¡æè¿è¡ fsync æä½ã\n * è¿ä¸ªæ®µè¢«æå¼ï¼ä½¿å¶å¯è¢«æç´¢ã\n * åå­ç¼å²åºè¢«æ¸ç©ºã\n\nFigure 22. å·æ°ï¼refreshï¼å®æå, ç¼å­è¢«æ¸ç©ºä½æ¯äºå¡æ¥å¿ä¸ä¼\n\n\n\nè¿ä¸ªè¿ç¨ç»§ç»­å·¥ä½ï¼æ´å¤çææ¡£è¢«æ·»å å°åå­ç¼å²åºåè¿½å å°äºå¡æ¥å¿ï¼è§ Figure 23, âäºå¡æ¥å¿ä¸æ­ç§¯ç´¯ææ¡£â ï¼ã\n\nFigure 23. äºå¡æ¥å¿ä¸æ­ç§¯ç´¯ææ¡£\n\n\n\n 1. æ¯éä¸æ®µæ¶é´âä¾å¦ translog åå¾è¶æ¥è¶å¤§âç´¢å¼è¢«å·æ°ï¼flushï¼ï¼ä¸ä¸ªæ°ç translog è¢«åå»ºï¼å¹¶ä¸ä¸ä¸ªå¨éæäº¤è¢«æ§è¡ï¼è§ Figure 24, âå¨å·æ°ï¼flushï¼ä¹åï¼æ®µè¢«å¨éæäº¤ï¼å¹¶ä¸äºå¡æ¥å¿è¢«æ¸ç©ºâ ï¼ï¼\n    * ææå¨åå­ç¼å²åºçææ¡£é½è¢«åå¥ä¸ä¸ªæ°çæ®µã\n    * ç¼å²åºè¢«æ¸ç©ºã\n    * ä¸ä¸ªæäº¤ç¹è¢«åå¥ç¡¬çã\n    * æä»¶ç³»ç»ç¼å­éè¿ fsync è¢«å·æ°ï¼flushï¼ã\n    * èç translog è¢«å é¤ã\n\ntranslog æä¾ææè¿æ²¡æè¢«å·å°ç£ççæä½çä¸ä¸ªæä¹åçºªå½ãå½ Elasticsearch å¯å¨çæ¶åï¼ å®ä¼ä»ç£çä¸­ä½¿ç¨æåä¸ä¸ªæäº¤ç¹å»æ¢å¤å·²ç¥çæ®µï¼å¹¶ä¸ä¼éæ¾ translog ä¸­ææå¨æåä¸æ¬¡æäº¤ååççåæ´æä½ã\n\ntranslog ä¹è¢«ç¨æ¥æä¾å®æ¶ CRUD ãå½ä½ è¯çéè¿ ID æ¥è¯¢ãæ´æ°ãå é¤ä¸ä¸ªææ¡£ï¼å®ä¼å¨å°è¯ä»ç¸åºçæ®µä¸­æ£ç´¢ä¹åï¼ é¦åæ£æ¥ translog ä»»ä½æè¿çåæ´ãè¿æå³çå®æ»æ¯è½å¤å®æ¶å°è·åå°ææ¡£çææ°çæ¬ã\n\nFigure 24. å¨å·æ°ï¼flushï¼ä¹åï¼æ®µè¢«å¨éæäº¤ï¼å¹¶ä¸äºå¡æ¥å¿è¢«æ¸ç©º\n\n\n\n\n# flush API\n\nè¿ä¸ªæ§è¡ä¸ä¸ªæäº¤å¹¶ä¸æªæ­ translog çè¡ä¸ºå¨ Elasticsearch è¢«ç§°ä½ä¸æ¬¡ flush ã åçæ¯ 30 åéè¢«èªå¨å·æ°ï¼flushï¼ï¼æèå¨ translog å¤ªå¤§çæ¶åä¹ä¼å·æ°ãè¯·æ¥ç translog ææ¡£ æ¥è®¾ç½®ï¼å®å¯ä»¥ç¨æ¥ æ§å¶è¿äºéå¼ï¼\n\nflush API å¯ä»¥è¢«ç¨æ¥æ§è¡ä¸ä¸ªæå·¥çå·æ°ï¼flushï¼:\n\nPOST /blogs/_flush\nPOST /_flush?wait_for_ongoing\n\n\n * å·æ°ï¼flushï¼ blogs ç´¢å¼ã\n * å·æ°ï¼flushï¼ææçç´¢å¼å¹¶ä¸å¹¶ä¸ç­å¾ææå·æ°å¨è¿ååå®æã\n\nä½ å¾å°éè¦èªå·±æå¨æ§è¡ flush æä½ï¼éå¸¸æåµä¸ï¼èªå¨å·æ°å°±è¶³å¤äºã\n\nè¿å°±æ¯è¯´ï¼å¨éå¯èç¹æå³é­ç´¢å¼ä¹åæ§è¡ flush æçäºä½ çç´¢å¼ãå½ Elasticsearch å°è¯æ¢å¤æéæ°æå¼ä¸ä¸ªç´¢å¼ï¼ å®éè¦éæ¾ translog ä¸­ææçæä½ï¼æä»¥å¦ææ¥å¿è¶ç­ï¼æ¢å¤è¶å¿«ã\n\n> translog çç®çæ¯ä¿è¯æä½ä¸ä¼ä¸¢å¤±ãè¿å¼åºäºè¿ä¸ªé®é¢ï¼ Translog æå¤å®å¨ï¼\n> \n> å¨æä»¶è¢« fsync å°ç£çåï¼è¢«åå¥çæä»¶å¨éå¯ä¹åå°±ä¼ä¸¢å¤±ãé»è®¤ translog æ¯æ¯ 5 ç§è¢« fsync å·æ°å°ç¡¬çï¼ æèå¨æ¯æ¬¡åè¯·æ±å®æä¹åæ§è¡(e.g. index, delete, update, bulk)ãè¿ä¸ªè¿ç¨å¨ä¸»åçåå¤å¶åçé½ä¼åçãæç»ï¼ åºæ¬ä¸ï¼è¿æå³çå¨æ´ä¸ªè¯·æ±è¢« fsync å°ä¸»åçåå¤å¶åçç translog ä¹åï¼ä½ çå®¢æ·ç«¯ä¸ä¼å¾å°ä¸ä¸ª 200 OK ååºã\n> \n> å¨æ¯æ¬¡è¯·æ±åé½æ§è¡ä¸ä¸ª fsync ä¼å¸¦æ¥ä¸äºæ§è½æå¤±ï¼å°½ç®¡å®è·µè¡¨æè¿ç§æå¤±ç¸å¯¹è¾å°ï¼ç¹å«æ¯ bulk å¯¼å¥ï¼å®å¨ä¸æ¬¡è¯·æ±ä¸­å¹³æäºå¤§éææ¡£çå¼éï¼ã\n> \n> ä½æ¯å¯¹äºä¸äºå¤§å®¹éçå¶å°ä¸¢å¤±å ç§æ°æ®é®é¢ä¹å¹¶ä¸ä¸¥éçéç¾¤ï¼ä½¿ç¨å¼æ­¥ç fsync è¿æ¯æ¯è¾æççãæ¯å¦ï¼åå¥çæ°æ®è¢«ç¼å­å°åå­ä¸­ï¼åæ¯ 5 ç§æ§è¡ä¸æ¬¡ fsync ã\n> \n> è¿ä¸ªè¡ä¸ºå¯ä»¥éè¿è®¾ç½® durability åæ°ä¸º async æ¥å¯ç¨ï¼\n> \n> PUT /my_index/_settings\n> {\n>     "index.translog.durability": "async",\n>     "index.translog.sync_interval": "5s"\n> }\n> \n> \n> è¿ä¸ªéé¡¹å¯ä»¥éå¯¹ç´¢å¼åç¬è®¾ç½®ï¼å¹¶ä¸å¯ä»¥å¨æè¿è¡ä¿®æ¹ãå¦æä½ å³å®ä½¿ç¨å¼æ­¥ translog çè¯ï¼ä½ éè¦ ä¿è¯ å¨åç crash æ¶ï¼ä¸¢å¤±æ sync_interval æ¶é´æ®µçæ°æ®ä¹æ æè°ãè¯·å¨å³å®åç¥æè¿ä¸ªç¹æ§ã\n> \n> å¦æä½ ä¸ç¡®å®è¿ä¸ªè¡ä¸ºçåæï¼æå¥½æ¯ä½¿ç¨é»è®¤çåæ°ï¼ "index.translog.durability": "request" ï¼æ¥é¿åæ°æ®ä¸¢å¤±ã\n\n\n# æ®µåå¹¶\n\nç±äºèªå¨å·æ°æµç¨æ¯ç§ä¼åå»ºä¸ä¸ªæ°çæ®µ ï¼è¿æ ·ä¼å¯¼è´ç­æ¶é´åçæ®µæ°éæ´å¢ãèæ®µæ°ç®å¤ªå¤ä¼å¸¦æ¥è¾å¤§çéº»ç¦ã æ¯ä¸ä¸ªæ®µé½ä¼æ¶èæä»¶å¥æãåå­å cpu è¿è¡å¨æãæ´éè¦çæ¯ï¼æ¯ä¸ªæç´¢è¯·æ±é½å¿é¡»è½®æµæ£æ¥æ¯ä¸ªæ®µï¼æä»¥æ®µè¶å¤ï¼æç´¢ä¹å°±è¶æ¢ã\n\nElasticsearch éè¿å¨åå°è¿è¡æ®µåå¹¶æ¥è§£å³è¿ä¸ªé®é¢ãå°çæ®µè¢«åå¹¶å°å¤§çæ®µï¼ç¶åè¿äºå¤§çæ®µåè¢«åå¹¶å°æ´å¤§çæ®µã\n\næ®µåå¹¶çæ¶åä¼å°é£äºæ§çå·²å é¤ææ¡£ä»æä»¶ç³»ç»ä¸­æ¸é¤ãè¢«å é¤çææ¡£ï¼æè¢«æ´æ°ææ¡£çæ§çæ¬ï¼ä¸ä¼è¢«æ·è´å°æ°çå¤§æ®µä¸­ã\n\nå¯å¨æ®µåå¹¶ä¸éè¦ä½ åä»»ä½äºãè¿è¡ç´¢å¼åæç´¢æ¶ä¼èªå¨è¿è¡ãè¿ä¸ªæµç¨åå¨ Figure 25, âä¸¤ä¸ªæäº¤äºçæ®µåä¸ä¸ªæªæäº¤çæ®µæ­£å¨è¢«åå¹¶å°ä¸ä¸ªæ´å¤§çæ®µâ ä¸­æå°çä¸æ ·å·¥ä½ï¼\n\n1ã å½ç´¢å¼çæ¶åï¼å·æ°ï¼refreshï¼æä½ä¼åå»ºæ°çæ®µå¹¶å°æ®µæå¼ä»¥ä¾æç´¢ä½¿ç¨ã\n\n2ã åå¹¶è¿ç¨éæ©ä¸å°é¨åå¤§å°ç¸ä¼¼çæ®µï¼å¹¶ä¸å¨åå°å°å®ä»¬åå¹¶å°æ´å¤§çæ®µä¸­ãè¿å¹¶ä¸ä¼ä¸­æ­ç´¢å¼åæç´¢ã\n\nFigure 25. ä¸¤ä¸ªæäº¤äºçæ®µåä¸ä¸ªæªæäº¤çæ®µæ­£å¨è¢«åå¹¶å°ä¸ä¸ªæ´å¤§çæ®µ\n\n\n\nFigure 26, âä¸æ¦åå¹¶ç»æï¼èçæ®µè¢«å é¤â è¯´æåå¹¶å®ææ¶çæ´»å¨ï¼\n\n * æ°çæ®µè¢«å·æ°ï¼flushï¼å°äºç£çã ** åå¥ä¸ä¸ªåå«æ°æ®µä¸æé¤æ§çåè¾å°çæ®µçæ°æäº¤ç¹ã\n * æ°çæ®µè¢«æå¼ç¨æ¥æç´¢ã\n * èçæ®µè¢«å é¤ã\n\nFigure 26. ä¸æ¦åå¹¶ç»æï¼èçæ®µè¢«å é¤\n\n\n\nåå¹¶å¤§çæ®µéè¦æ¶èå¤§éç I/O å CPU èµæºï¼å¦æä»»å¶åå±ä¼å½±åæç´¢æ§è½ãElasticsearch å¨é»è®¤æåµä¸ä¼å¯¹åå¹¶æµç¨è¿è¡èµæºéå¶ï¼æä»¥æç´¢ä»ç¶ æè¶³å¤çèµæºå¾å¥½å°æ§è¡ã\n\n\n# optimize API\n\noptimize API å¤§å¯çåæ¯ å¼ºå¶åå¹¶ APIãå®ä¼å°ä¸ä¸ªåçå¼ºå¶åå¹¶å° max_num_segments åæ°æå®å¤§å°çæ®µæ°ç®ã è¿æ ·åçæå¾æ¯åå°æ®µçæ°éï¼éå¸¸åå°å°ä¸ä¸ªï¼ï¼æ¥æåæç´¢æ§è½ã\n\n> optimize API ä¸åºè¯¥ è¢«ç¨å¨ä¸ä¸ªæ´»è·çç´¢å¼ââââä¸ä¸ªæ­£ç§¯ææ´æ°çç´¢å¼ãåå°åå¹¶æµç¨å·²ç»å¯ä»¥å¾å¥½å°å®æå·¥ä½ã optimizing ä¼é»ç¢è¿ä¸ªè¿ç¨ãä¸è¦å¹²æ°å®ï¼\n\nå¨ç¹å®æåµä¸ï¼ä½¿ç¨ optimize API é¢æçå¤ãä¾å¦å¨æ¥å¿è¿ç§ç¨ä¾ä¸ï¼æ¯å¤©ãæ¯å¨ãæ¯æçæ¥å¿è¢«å­å¨å¨ä¸ä¸ªç´¢å¼ä¸­ã èçç´¢å¼å®è´¨ä¸æ¯åªè¯»çï¼å®ä»¬ä¹å¹¶ä¸å¤ªå¯è½ä¼åçååã\n\nå¨è¿ç§æåµä¸ï¼ä½¿ç¨ optimize ä¼åèçç´¢å¼ï¼å°æ¯ä¸ä¸ªåçåå¹¶ä¸ºä¸ä¸ªåç¬çæ®µå°±å¾æç¨äºï¼è¿æ ·æ¢å¯ä»¥èçèµæºï¼ä¹å¯ä»¥ä½¿æç´¢æ´å å¿«éï¼\n\nPOST /logstash-2014-10/_optimize?max_num_segments=1\n\n\nåå¹¶ç´¢å¼ä¸­çæ¯ä¸ªåçä¸ºä¸ä¸ªåç¬çæ®µ\n\n> è¯·æ³¨æï¼ä½¿ç¨ optimize API è§¦åæ®µåå¹¶çæä½ä¸ä¼åå°ä»»ä½èµæºä¸çéå¶ãè¿å¯è½ä¼æ¶èæä½ èç¹ä¸å¨é¨ç I/O èµæº, ä½¿å¶æ²¡æä½è£æ¥å¤çæç´¢è¯·æ±ï¼ä»èæå¯è½ä½¿éç¾¤å¤±å»ååºã å¦æä½ æ³è¦å¯¹ç´¢å¼æ§è¡ optimizeï¼ä½ éè¦åä½¿ç¨åçåéï¼æ¥ç è¿ç§»æ§ç´¢å¼ï¼æç´¢å¼ç§»å°ä¸ä¸ªå®å¨çèç¹ï¼åæ§è¡ã\n\n\n# åèèµæ\n\n * Elasticsearch å®æ¹ææ¡£ä¹ éç¾¤åçåç',normalizedContent:'# elasticsearch éç¾¤ååç\n\n\n# éç¾¤\n\n\n# ç©ºéç¾¤\n\nå¦ææä»¬å¯å¨äºä¸ä¸ªåç¬çèç¹ï¼éé¢ä¸åå«ä»»ä½çæ°æ®åç´¢å¼ï¼é£æä»¬çéç¾¤çèµ·æ¥å°±æ¯ä¸ä¸ªåå«ç©ºåå®¹èç¹çéç¾¤ã\n\nfigure 1. åå«ç©ºåå®¹èç¹çéç¾¤\n\n\n\nå¾ 1ï¼åªæä¸ä¸ªç©ºèç¹çéç¾¤\n\nä¸ä¸ªè¿è¡ä¸­ç elasticsearch å®ä¾ç§°ä¸ºä¸ä¸ªèç¹ï¼èéç¾¤æ¯ç±ä¸ä¸ªæèå¤ä¸ªæ¥æç¸å cluster.name éç½®çèç¹ç»æï¼ å®ä»¬å±åæ¿ææ°æ®åè´è½½çååãå½æèç¹å å¥éç¾¤ä¸­æèä»éç¾¤ä¸­ç§»é¤èç¹æ¶ï¼éç¾¤å°ä¼éæ°å¹³ååå¸ææçæ°æ®ã\n\nå½ä¸ä¸ªèç¹è¢«éä¸¾æä¸ºä¸»èç¹æ¶ï¼ å®å°è´è´£ç®¡çéç¾¤èå´åçææåæ´ï¼ä¾å¦å¢å ãå é¤ç´¢å¼ï¼æèå¢å ãå é¤èç¹ç­ã èä¸»èç¹å¹¶ä¸éè¦æ¶åå°ææ¡£çº§å«çåæ´åæç´¢ç­æä½ï¼æä»¥å½éç¾¤åªæ¥æä¸ä¸ªä¸»èç¹çæåµä¸ï¼å³ä½¿æµéçå¢å å®ä¹ä¸ä¼æä¸ºç¶é¢ã ä»»ä½èç¹é½å¯ä»¥æä¸ºä¸»èç¹ãæä»¬çç¤ºä¾éç¾¤å°±åªæä¸ä¸ªèç¹ï¼æä»¥å®åæ¶ä¹æä¸ºäºä¸»èç¹ã\n\nä½ä¸ºç¨æ·ï¼æä»¬å¯ä»¥å°è¯·æ±åéå°éç¾¤ä¸­çä»»ä½èç¹ï¼åæ¬ä¸»èç¹ã æ¯ä¸ªèç¹é½ç¥éä»»æææ¡£æå¤çä½ç½®ï¼å¹¶ä¸è½å¤å°æä»¬çè¯·æ±ç´æ¥è½¬åå°å­å¨æä»¬æéææ¡£çèç¹ã æ è®ºæä»¬å°è¯·æ±åéå°åªä¸ªèç¹ï¼å®é½è½è´è´£ä»åä¸ªåå«æä»¬æéææ¡£çèç¹æ¶éåæ°æ®ï¼å¹¶å°æç»ç»æè¿åçµ¦å®¢æ·ç«¯ã elasticsearch å¯¹è¿ä¸åçç®¡çé½æ¯éæçã\n\n\n# éç¾¤å¥åº·\n\nelasticsearch çéç¾¤çæ§ä¿¡æ¯ä¸­åå«äºè®¸å¤çç»è®¡æ°æ®ï¼å¶ä¸­æä¸ºéè¦çä¸é¡¹å°±æ¯ éç¾¤å¥åº· ï¼ å®å¨ status å­æ®µä¸­å±ç¤ºä¸º green ã yellow æè red ã\n\nget /_cluster/health\n\n\nå¨ä¸ä¸ªä¸åå«ä»»ä½ç´¢å¼çç©ºéç¾¤ä¸­ï¼å®å°ä¼æä¸ä¸ªç±»ä¼¼äºå¦ä¸æç¤ºçè¿ååå®¹ï¼\n\n{\n  "cluster_name": "elasticsearch",\n  "status": "green",\n  "timed_out": false,\n  "number_of_nodes": 1,\n  "number_of_data_nodes": 1,\n  "active_primary_shards": 0,\n  "active_shards": 0,\n  "relocating_shards": 0,\n  "initializing_shards": 0,\n  "unassigned_shards": 0\n}\n\n\nstatus å­æ®µæç¤ºçå½åéç¾¤å¨æ»ä½ä¸æ¯å¦å·¥ä½æ­£å¸¸ãå®çä¸ç§é¢è²å«ä¹å¦ä¸ï¼\n\n * greenï¼ææçä¸»åçåå¯æ¬åçé½æ­£å¸¸è¿è¡ã\n * yellowï¼ææçä¸»åçé½æ­£å¸¸è¿è¡ï¼ä½ä¸æ¯ææçå¯æ¬åçé½æ­£å¸¸è¿è¡ã\n * redï¼æä¸»åçæ²¡è½æ­£å¸¸è¿è¡ã\n\n\n# æ·»å ç´¢å¼\n\næä»¬å¾ elasticsearch æ·»å æ°æ®æ¶éè¦ç¨å° ç´¢å¼ ââ ä¿å­ç¸å³æ°æ®çå°æ¹ãç´¢å¼å®éä¸æ¯æåä¸ä¸ªæèå¤ä¸ªç©çåççé»è¾å½åç©ºé´ ã\n\nä¸ä¸ª åç æ¯ä¸ä¸ªåºå±ç å·¥ä½åå ï¼å®ä»ä¿å­äºå¨é¨æ°æ®ä¸­çä¸é¨åãç°å¨æä»¬åªéç¥éä¸ä¸ªåçæ¯ä¸ä¸ª lucene çå®ä¾ï¼ä»¥åå®æ¬èº«å°±æ¯ä¸ä¸ªå®æ´çæç´¢å¼æã æä»¬çææ¡£è¢«å­å¨åç´¢å¼å°åçåï¼ä½æ¯åºç¨ç¨åºæ¯ç´æ¥ä¸ç´¢å¼èä¸æ¯ä¸åçè¿è¡äº¤äºã\n\nelasticsearch æ¯å©ç¨åçå°æ°æ®ååå°éç¾¤ååå¤çãåçæ¯æ°æ®çå®¹å¨ï¼ææ¡£ä¿å­å¨åçåï¼åçåè¢«åéå°éç¾¤åçåä¸ªèç¹éã å½ä½ çéç¾¤è§æ¨¡æ©å¤§æèç¼©å°æ¶ï¼ elasticsearch ä¼èªå¨çå¨åèç¹ä¸­è¿ç§»åçï¼ä½¿å¾æ°æ®ä»ç¶åååå¸å¨éç¾¤éã\n\nä¸ä¸ªåçå¯ä»¥æ¯ ä¸» åçæè å¯æ¬ åçã ç´¢å¼åä»»æä¸ä¸ªææ¡£é½å½å±äºä¸ä¸ªä¸»åçï¼æä»¥ä¸»åççæ°ç®å³å®çç´¢å¼è½å¤ä¿å­çæå¤§æ°æ®éã\n\n> ææ¯ä¸æ¥è¯´ï¼ä¸ä¸ªä¸»åçæå¤§è½å¤å­å¨ integer.max_value - 128 ä¸ªææ¡£ï¼ä½æ¯å®éæå¤§å¼è¿éè¦åèä½ çä½¿ç¨åºæ¯ï¼åæ¬ä½ ä½¿ç¨çç¡¬ä»¶ï¼ ææ¡£çå¤§å°åå¤æç¨åº¦ï¼ç´¢å¼åæ¥è¯¢ææ¡£çæ¹å¼ä»¥åä½ ææçååºæ¶é¿ã\n\nä¸ä¸ªå¯æ¬åçåªæ¯ä¸ä¸ªä¸»åççæ·è´ãå¯æ¬åçä½ä¸ºç¡¬ä»¶æéæ¶ä¿æ¤æ°æ®ä¸ä¸¢å¤±çåä½å¤ä»½ï¼å¹¶ä¸ºæç´¢åè¿åææ¡£ç­è¯»æä½æä¾æå¡ã\n\nå¨ç´¢å¼å»ºç«çæ¶åå°±å·²ç»ç¡®å®äºä¸»åçæ°ï¼ä½æ¯å¯æ¬åçæ°å¯ä»¥éæ¶ä¿®æ¹ã\n\nè®©æä»¬å¨åå«ä¸ä¸ªç©ºèç¹çéç¾¤ååå»ºåä¸º blogs çç´¢å¼ã ç´¢å¼å¨é»è®¤æåµä¸ä¼è¢«åé 5 ä¸ªä¸»åçï¼ ä½æ¯ä¸ºäºæ¼ç¤ºç®çï¼æä»¬å°åé 3 ä¸ªä¸»åçåä¸ä»½å¯æ¬ï¼æ¯ä¸ªä¸»åçæ¥æä¸ä¸ªå¯æ¬åçï¼ï¼\n\nput /blogs\n{\n   "settings" : {\n      "number_of_shards" : 3,\n      "number_of_replicas" : 1\n   }\n}\n\n\næä»¬çéç¾¤ç°å¨æ¯ æ¥æä¸ä¸ªç´¢å¼çåèç¹éç¾¤ãææ 3 ä¸ªä¸»åçé½è¢«åéå¨ node 1 ã\n\nfigure 2. æ¥æä¸ä¸ªç´¢å¼çåèç¹éç¾¤\n\n\n\nå¦ææä»¬ç°å¨æ¥çéç¾¤å¥åº·ï¼æä»¬å°çå°å¦ä¸åå®¹ï¼\n\n{\n  "cluster_name": "elasticsearch",\n  "status": "yellow",\n  "timed_out": false,\n  "number_of_nodes": 1,\n  "number_of_data_nodes": 1,\n  "active_primary_shards": 3,\n  "active_shards": 3,\n  "relocating_shards": 0,\n  "initializing_shards": 0,\n  "unassigned_shards": 3,\n  "delayed_unassigned_shards": 0,\n  "number_of_pending_tasks": 0,\n  "number_of_in_flight_fetch": 0,\n  "task_max_waiting_in_queue_millis": 0,\n  "active_shards_percent_as_number": 50\n}\n\n\n * éç¾¤ status å¼ä¸º yellow\n * æ²¡æè¢«åéå°ä»»ä½èç¹çå¯æ¬æ°\n\néç¾¤çå¥åº·ç¶åµä¸º yellow åè¡¨ç¤ºå¨é¨ ä¸» åçé½æ­£å¸¸è¿è¡ï¼éç¾¤å¯ä»¥æ­£å¸¸æå¡ææè¯·æ±ï¼ï¼ä½æ¯ å¯æ¬ åçæ²¡æå¨é¨å¤å¨æ­£å¸¸ç¶æã å®éä¸ï¼ææ 3 ä¸ªå¯æ¬åçé½æ¯ unassigned ââ å®ä»¬é½æ²¡æè¢«åéå°ä»»ä½èç¹ã å¨åä¸ä¸ªèç¹ä¸æ¢ä¿å­åå§æ°æ®åä¿å­å¯æ¬æ¯æ²¡ææä¹çï¼å ä¸ºä¸æ¦å¤±å»äºé£ä¸ªèç¹ï¼æä»¬ä¹å°ä¸¢å¤±è¯¥èç¹ä¸çææå¯æ¬æ°æ®ã\n\nå½åæä»¬çéç¾¤æ¯æ­£å¸¸è¿è¡çï¼ä½æ¯å¨ç¡¬ä»¶æéæ¶æä¸¢å¤±æ°æ®çé£é©ã\n\n\n# æ·»å æéè½¬ç§»\n\nå½éç¾¤ä¸­åªæä¸ä¸ªèç¹å¨è¿è¡æ¶ï¼æå³çä¼æä¸ä¸ªåç¹æéé®é¢ââæ²¡æåä½ã å¹¸è¿çæ¯ï¼æä»¬åªéåå¯å¨ä¸ä¸ªèç¹å³å¯é²æ­¢æ°æ®ä¸¢å¤±ã\n\n> ä¸ºäºæµè¯ç¬¬äºä¸ªèç¹å¯å¨åçæåµï¼ä½ å¯ä»¥å¨åä¸ä¸ªç®å½åï¼å®å¨ä¾ç§å¯å¨ç¬¬ä¸ä¸ªèç¹çæ¹å¼æ¥å¯å¨ä¸ä¸ªæ°èç¹ï¼åèå®è£å¹¶è¿è¡ elasticsearchï¼ãå¤ä¸ªèç¹å¯ä»¥å±äº«åä¸ä¸ªç®å½ã\n> \n> å½ä½ å¨åä¸å°æºå¨ä¸å¯å¨äºç¬¬äºä¸ªèç¹æ¶ï¼åªè¦å®åç¬¬ä¸ä¸ªèç¹æåæ ·ç cluster.name éç½®ï¼å®å°±ä¼èªå¨åç°éç¾¤å¹¶å å¥å°å¶ä¸­ã ä½æ¯å¨ä¸åæºå¨ä¸å¯å¨èç¹çæ¶åï¼ä¸ºäºå å¥å°åä¸éç¾¤ï¼ä½ éè¦éç½®ä¸ä¸ªå¯è¿æ¥å°çåæ­ä¸»æºåè¡¨ã\n\nå¦æå¯å¨äºç¬¬äºä¸ªèç¹ï¼æä»¬çéç¾¤å°ä¼æ¥æä¸¤ä¸ªèç¹çéç¾¤ââææä¸»åçåå¯æ¬åçé½å·²è¢«åéã\n\nfigure 3. æ¥æä¸¤ä¸ªèç¹çéç¾¤ââææä¸»åçåå¯æ¬åçé½å·²è¢«åé\n\n\n\nå½ç¬¬äºä¸ªèç¹å å¥å°éç¾¤åï¼3 ä¸ª å¯æ¬åç å°ä¼åéå°è¿ä¸ªèç¹ä¸ââæ¯ä¸ªä¸»åçå¯¹åºä¸ä¸ªå¯æ¬åçã è¿æå³çå½éç¾¤åä»»ä½ä¸ä¸ªèç¹åºç°é®é¢æ¶ï¼æä»¬çæ°æ®é½å®å¥½æ æã\n\næææ°è¿è¢«ç´¢å¼çææ¡£é½å°ä¼ä¿å­å¨ä¸»åçä¸ï¼ç¶åè¢«å¹¶è¡çå¤å¶å°å¯¹åºçå¯æ¬åçä¸ãè¿å°±ä¿è¯äºæä»¬æ¢å¯ä»¥ä»ä¸»åçåå¯ä»¥ä»å¯æ¬åçä¸è·å¾ææ¡£ã\n\ncluster-health ç°å¨å±ç¤ºçç¶æä¸º green ï¼è¿è¡¨ç¤ºææ 6 ä¸ªåçï¼åæ¬ 3 ä¸ªä¸»åçå 3 ä¸ªå¯æ¬åçï¼é½å¨æ­£å¸¸è¿è¡ã\n\n{\n  "cluster_name": "elasticsearch",\n  "status": "green",\n  "timed_out": false,\n  "number_of_nodes": 2,\n  "number_of_data_nodes": 2,\n  "active_primary_shards": 3,\n  "active_shards": 6,\n  "relocating_shards": 0,\n  "initializing_shards": 0,\n  "unassigned_shards": 0,\n  "delayed_unassigned_shards": 0,\n  "number_of_pending_tasks": 0,\n  "number_of_in_flight_fetch": 0,\n  "task_max_waiting_in_queue_millis": 0,\n  "active_shards_percent_as_number": 100\n}\n\n\n * éç¾¤ status å¼ä¸º green\n\næä»¬çéç¾¤ç°å¨ä¸ä»ä»æ¯æ­£å¸¸è¿è¡çï¼å¹¶ä¸è¿å¤äº å§ç»å¯ç¨ çç¶æã\n\n\n# æ°´å¹³æ©å®¹\n\nææ ·ä¸ºæä»¬çæ­£å¨å¢é¿ä¸­çåºç¨ç¨åºæéæ©å®¹å¢ï¼ å½å¯å¨äºç¬¬ä¸ä¸ªèç¹ï¼æä»¬çéç¾¤å°æ¥æä¸ä¸ªèç¹çéç¾¤ââä¸ºäºåæ£è´è½½èå¯¹åçè¿è¡éæ°åéã\n\nfigure 4. æ¥æä¸ä¸ªèç¹çéç¾¤ââä¸ºäºåæ£è´è½½èå¯¹åçè¿è¡éæ°åé\n\n\n\nnode 1 å node 2 ä¸åæä¸ä¸ªåçè¢«è¿ç§»å°äºæ°ç node 3 èç¹ï¼ç°å¨æ¯ä¸ªèç¹ä¸é½æ¥æ 2 ä¸ªåçï¼èä¸æ¯ä¹åç 3 ä¸ªã è¿è¡¨ç¤ºæ¯ä¸ªèç¹çç¡¬ä»¶èµæºï¼cpu, ram, i/oï¼å°è¢«æ´å°çåçæå±äº«ï¼æ¯ä¸ªåççæ§è½å°ä¼å¾å°æåã\n\nåçæ¯ä¸ä¸ªåè½å®æ´çæç´¢å¼æï¼å®æ¥æä½¿ç¨ä¸ä¸ªèç¹ä¸çææèµæºçè½åã æä»¬è¿ä¸ªæ¥æ 6 ä¸ªåçï¼3 ä¸ªä¸»åçå 3 ä¸ªå¯æ¬åçï¼çç´¢å¼å¯ä»¥æå¤§æ©å®¹å° 6 ä¸ªèç¹ï¼æ¯ä¸ªèç¹ä¸å­å¨ä¸ä¸ªåçï¼å¹¶ä¸æ¯ä¸ªåçæ¥ææå¨èç¹çå¨é¨èµæºã\n\n\n# æ´å¤çæ©å®¹\n\nä½æ¯å¦ææä»¬æ³è¦æ©å®¹è¶è¿ 6 ä¸ªèç¹æä¹åå¢ï¼\n\nä¸»åççæ°ç®å¨ç´¢å¼åå»ºæ¶å°±å·²ç»ç¡®å®äºä¸æ¥ãå®éä¸ï¼è¿ä¸ªæ°ç®å®ä¹äºè¿ä¸ªç´¢å¼è½å¤ å­å¨ çæå¤§æ°æ®éãï¼å®éå¤§å°åå³äºä½ çæ°æ®ãç¡¬ä»¶åä½¿ç¨åºæ¯ãï¼ ä½æ¯ï¼è¯»æä½ââæç´¢åè¿åæ°æ®ââå¯ä»¥åæ¶è¢«ä¸»åç æ å¯æ¬åçæå¤çï¼æä»¥å½ä½ æ¥æè¶å¤çå¯æ¬åçæ¶ï¼ä¹å°æ¥æè¶é«çååéã\n\nå¨è¿è¡ä¸­çéç¾¤ä¸æ¯å¯ä»¥å¨æè°æ´å¯æ¬åçæ°ç®çï¼æä»¬å¯ä»¥æéä¼¸ç¼©éç¾¤ãè®©æä»¬æå¯æ¬æ°ä»é»è®¤ç 1 å¢å å° 2 ï¼\n\nput /blogs/_settings\n{\n   "number_of_replicas" : 2\n}\n\n\nblogs ç´¢å¼ç°å¨æ¥æ 9 ä¸ªåçï¼3 ä¸ªä¸»åçå 6 ä¸ªå¯æ¬åçã è¿æå³çæä»¬å¯ä»¥å°éç¾¤æ©å®¹å° 9 ä¸ªèç¹ï¼æ¯ä¸ªèç¹ä¸ä¸ä¸ªåçãç¸æ¯åæ¥ 3 ä¸ªèç¹æ¶ï¼éç¾¤æç´¢æ§è½å¯ä»¥æå 3 åã\n\nfigure 5. å°åæ° number_of_replicas è°å¤§å° 2\n\n\n\n> å½ç¶ï¼å¦æåªæ¯å¨ç¸åèç¹æ°ç®çéç¾¤ä¸å¢å æ´å¤çå¯æ¬åçå¹¶ä¸è½æé«æ§è½ï¼å ä¸ºæ¯ä¸ªåçä»èç¹ä¸è·å¾çèµæºä¼åå°ã ä½ éè¦å¢å æ´å¤çç¡¬ä»¶èµæºæ¥æåååéã\n> \n> ä½æ¯æ´å¤çå¯æ¬åçæ°æé«äºæ°æ®åä½éï¼æç§ä¸é¢çèç¹éç½®ï¼æä»¬å¯ä»¥å¨å¤±å» 2 ä¸ªèç¹çæåµä¸ä¸ä¸¢å¤±ä»»ä½æ°æ®ã\n\n\n# åºå¯¹æé\n\næä»¬ä¹åè¯´è¿ elasticsearch å¯ä»¥åºå¯¹èç¹æéï¼æ¥ä¸æ¥è®©æä»¬å°è¯ä¸è¿ä¸ªåè½ã å¦ææä»¬å³é­ç¬¬ä¸ä¸ªèç¹ï¼è¿æ¶éç¾¤çç¶æä¸ºå³é­äºä¸ä¸ªèç¹åçéç¾¤ã\n\nfigure 6. å³é­äºä¸ä¸ªèç¹åçéç¾¤\n\n\n\næä»¬å³é­çèç¹æ¯ä¸ä¸ªä¸»èç¹ãèéç¾¤å¿é¡»æ¥æä¸ä¸ªä¸»èç¹æ¥ä¿è¯æ­£å¸¸å·¥ä½ï¼æä»¥åççç¬¬ä¸ä»¶äºæå°±æ¯éä¸¾ä¸ä¸ªæ°çä¸»èç¹ï¼ node 2 ã\n\nå¨æä»¬å³é­ node 1 çåæ¶ä¹å¤±å»äºä¸»åç 1 å 2 ï¼å¹¶ä¸å¨ç¼ºå¤±ä¸»åççæ¶åç´¢å¼ä¹ä¸è½æ­£å¸¸å·¥ä½ã å¦ææ­¤æ¶æ¥æ£æ¥éç¾¤çç¶åµï¼æä»¬çå°çç¶æå°ä¼ä¸º red ï¼ä¸æ¯ææä¸»åçé½å¨æ­£å¸¸å·¥ä½ã\n\nå¹¸è¿çæ¯ï¼å¨å¶å®èç¹ä¸å­å¨çè¿ä¸¤ä¸ªä¸»åççå®æ´å¯æ¬ï¼ æä»¥æ°çä¸»èç¹ç«å³å°è¿äºåçå¨ node 2 å node 3 ä¸å¯¹åºçå¯æ¬åçæåä¸ºä¸»åçï¼ æ­¤æ¶éç¾¤çç¶æå°ä¼ä¸º yellow ã è¿ä¸ªæåä¸»åççè¿ç¨æ¯ç¬é´åççï¼å¦åæä¸ä¸ä¸ªå¼å³ä¸è¬ã\n\nä¸ºä»ä¹æä»¬éç¾¤ç¶ææ¯ yellow èä¸æ¯ green å¢ï¼ è½ç¶æä»¬æ¥æææçä¸ä¸ªä¸»åçï¼ä½æ¯åæ¶è®¾ç½®äºæ¯ä¸ªä¸»åçéè¦å¯¹åº 2 ä»½å¯æ¬åçï¼èæ­¤æ¶åªå­å¨ä¸ä»½å¯æ¬åçã æä»¥éç¾¤ä¸è½ä¸º green çç¶æï¼ä¸è¿æä»¬ä¸å¿è¿äºæå¿ï¼å¦ææä»¬åæ ·å³é­äº node 2 ï¼æä»¬çç¨åº ä¾ç¶ å¯ä»¥ä¿æå¨ä¸ä¸¢ä»»ä½æ°æ®çæåµä¸è¿è¡ï¼å ä¸º node 3 ä¸ºæ¯ä¸ä¸ªåçé½ä¿ççä¸ä»½å¯æ¬ã\n\nå¦ææä»¬éæ°å¯å¨ node 1 ï¼éç¾¤å¯ä»¥å°ç¼ºå¤±çå¯æ¬åçåæ¬¡è¿è¡åéï¼é£ä¹éç¾¤çç¶æä¹å°å¦ figure 5. å°åæ° number_of_replicas è°å¤§å° 2 æç¤ºã å¦æ node 1 ä¾ç¶æ¥æçä¹åçåçï¼å®å°å°è¯å»éç¨å®ä»¬ï¼åæ¶ä»ä»ä¸»åçå¤å¶åçäºä¿®æ¹çæ°æ®æä»¶ã\n\nå°ç®åä¸ºæ­¢ï¼ä½ åºè¯¥å¯¹åçå¦ä½ä½¿å¾ elasticsearch è¿è¡æ°´å¹³æ©å®¹ä»¥åæ°æ®ä¿éç­ç¥è¯æäºä¸å®äºè§£ã æ¥ä¸æ¥æä»¬å°è®²è¿°å³äºåççå½å¨æçæ´å¤ç»èã\n\n\n# åç\n\n>  * ä¸ºä»ä¹æç´¢æ¯ è¿ å®æ¶çï¼\n>  * ä¸ºä»ä¹ææ¡£ç crud (åå»º-è¯»å-æ´æ°-å é¤) æä½æ¯ å®æ¶ ç?\n>  * elasticsearch æ¯ææ ·ä¿è¯æ´æ°è¢«æä¹åå¨æ­çµæ¶ä¹ä¸ä¸¢å¤±æ°æ®?\n>  * ä¸ºä»ä¹å é¤ææ¡£ä¸ä¼ç«å»éæ¾ç©ºé´ï¼\n>  * refresh, flush, å optimize api é½åäºä»ä¹, ä½ ä»ä¹æåµä¸åºè¯¥ä½¿ç¨ä»ä»¬ï¼\n\n\n# ä½¿ææ¬å¯è¢«æç´¢\n\nå¿é¡»è§£å³çç¬¬ä¸ä¸ªæææ¯å¦ä½ä½¿ææ¬å¯è¢«æç´¢ã ä¼ ç»çæ°æ®åºæ¯ä¸ªå­æ®µå­å¨åä¸ªå¼ï¼ä½è¿å¯¹å¨ææ£ç´¢å¹¶ä¸å¤ãææ¬å­æ®µä¸­çæ¯ä¸ªåè¯éè¦è¢«æç´¢ï¼å¯¹æ°æ®åºæå³çéè¦åä¸ªå­æ®µæç´¢å¼å¤å¼(è¿éæåè¯)çè½åã\n\næå¥½çæ¯æ ä¸ä¸ªå­æ®µå¤ä¸ªå¼ éæ±çæ°æ®ç»ææ¯æä»¬å¨ åæç´¢å¼ ç« èä¸­ä»ç»è¿ç åæç´¢å¼ ã åæç´¢å¼åå«ä¸ä¸ªæåºåè¡¨ï¼åè¡¨åå«ææææ¡£åºç°è¿çä¸éå¤ä¸ªä½ï¼æç§°ä¸º è¯é¡¹ ï¼å¯¹äºæ¯ä¸ä¸ªè¯é¡¹ï¼åå«äºå®æææ¾åºç°è¿ææ¡£çåè¡¨ã\n\nterm  | doc 1 | doc 2 | doc 3 | ...\n------------------------------------\nbrown |   x   |       |  x    | ...\nfox   |   x   |   x   |  x    | ...\nquick |   x   |   x   |       | ...\nthe   |   x   |       |  x    | ...\n\n\n> å½è®¨è®ºåæç´¢å¼æ¶ï¼æä»¬ä¼è°å° ææ¡£ æ å¼ï¼å ä¸ºåå²åå ï¼åæç´¢å¼è¢«ç¨æ¥å¯¹æ´ä¸ªéç»æåææ¬ææ¡£è¿è¡æ å¼ã elasticsearch ä¸­ç ææ¡£ æ¯æå­æ®µåå¼çç»æå json ææ¡£ãäºå®ä¸ï¼å¨ json ææ¡£ä¸­ï¼ æ¯ä¸ªè¢«ç´¢å¼çå­æ®µé½æèªå·±çåæç´¢å¼ã\n\nè¿ä¸ªåæç´¢å¼ç¸æ¯ç¹å®è¯é¡¹åºç°è¿çææ¡£åè¡¨ï¼ä¼åå«æ´å¤å¶å®ä¿¡æ¯ãå®ä¼ä¿å­æ¯ä¸ä¸ªè¯é¡¹åºç°è¿çææ¡£æ»æ°ï¼ å¨å¯¹åºçææ¡£ä¸­ä¸ä¸ªå·ä½è¯é¡¹åºç°çæ»æ¬¡æ°ï¼è¯é¡¹å¨ææ¡£ä¸­çé¡ºåºï¼æ¯ä¸ªææ¡£çé¿åº¦ï¼ææææ¡£çå¹³åé¿åº¦ï¼ç­ç­ãè¿äºç»è®¡ä¿¡æ¯åè®¸ elasticsearch å³å®åªäºè¯æ¯å¶å®è¯æ´éè¦ï¼åªäºææ¡£æ¯å¶å®ææ¡£æ´éè¦ï¼è¿äºåå®¹å¨ ä»ä¹æ¯ç¸å³æ§? ä¸­ææè¿°ã\n\nä¸ºäºè½å¤å®ç°é¢æåè½ï¼åæç´¢å¼éè¦ç¥ééåä¸­ç ææ ææ¡£ï¼è¿æ¯éè¦è®¤è¯å°çå³é®é®é¢ã\n\næ©æçå¨ææ£ç´¢ä¼ä¸ºæ´ä¸ªææ¡£éåå»ºç«ä¸ä¸ªå¾å¤§çåæç´¢å¼å¹¶å°å¶åå¥å°ç£çã ä¸æ¦æ°çç´¢å¼å°±ç»ªï¼æ§çå°±ä¼è¢«å¶æ¿æ¢ï¼è¿æ ·æè¿çååä¾¿å¯ä»¥è¢«æ£ç´¢å°ã\n\n\n# ä¸åæ§\n\nåæç´¢å¼è¢«åå¥ç£çåæ¯ ä¸å¯æ¹å ç:å®æ°¸è¿ä¸ä¼ä¿®æ¹ã ä¸åæ§æéè¦çä»·å¼ï¼\n\n * ä¸éè¦éãå¦æä½ ä»æ¥ä¸æ´æ°ç´¢å¼ï¼ä½ å°±ä¸éè¦æå¿å¤è¿ç¨åæ¶ä¿®æ¹æ°æ®çé®é¢ã\n * ä¸æ¦ç´¢å¼è¢«è¯»å¥åæ ¸çæä»¶ç³»ç»ç¼å­ï¼ä¾¿ä¼çå¨åªéï¼ç±äºå¶ä¸åæ§ãåªè¦æä»¶ç³»ç»ç¼å­ä¸­è¿æè¶³å¤çç©ºé´ï¼é£ä¹å¤§é¨åè¯»è¯·æ±ä¼ç´æ¥è¯·æ±åå­ï¼èä¸ä¼å½ä¸­ç£çãè¿æä¾äºå¾å¤§çæ§è½æåã\n * å¶å®ç¼å­(å filter ç¼å­)ï¼å¨ç´¢å¼ççå½å¨æåå§ç»ææãå®ä»¬ä¸éè¦å¨æ¯æ¬¡æ°æ®æ¹åæ¶è¢«éå»ºï¼å ä¸ºæ°æ®ä¸ä¼ååã\n * åå¥åä¸ªå¤§çåæç´¢å¼åè®¸æ°æ®è¢«åç¼©ï¼åå°ç£ç i/o å éè¦è¢«ç¼å­å°åå­çç´¢å¼çä½¿ç¨éã\n\nå½ç¶ï¼ä¸ä¸ªä¸åçç´¢å¼ä¹æä¸å¥½çå°æ¹ãä¸»è¦äºå®æ¯å®æ¯ä¸å¯åç! ä½ ä¸è½ä¿®æ¹å®ãå¦æä½ éè¦è®©ä¸ä¸ªæ°çææ¡£ å¯è¢«æç´¢ï¼ä½ éè¦éå»ºæ´ä¸ªç´¢å¼ãè¿è¦ä¹å¯¹ä¸ä¸ªç´¢å¼æè½åå«çæ°æ®éé æäºå¾å¤§çéå¶ï¼è¦ä¹å¯¹ç´¢å¼å¯è¢«æ´æ°çé¢çé æäºå¾å¤§çéå¶ã\n\n\n# å¨ææ´æ°ç´¢å¼\n\nä¸ä¸ä¸ªéè¦è¢«è§£å³çé®é¢æ¯ææ ·å¨ä¿çä¸åæ§çåæä¸å®ç°åæç´¢å¼çæ´æ°ï¼ç­æ¡æ¯: ç¨æ´å¤çç´¢å¼ã\n\néè¿å¢å æ°çè¡¥åç´¢å¼æ¥åæ æ°è¿çä¿®æ¹ï¼èä¸æ¯ç´æ¥éåæ´ä¸ªåæç´¢å¼ãæ¯ä¸ä¸ªåæç´¢å¼é½ä¼è¢«è½®æµæ¥è¯¢å°âä»ææ©çå¼å§âæ¥è¯¢å®ååå¯¹ç»æè¿è¡åå¹¶ã\n\nelasticsearch åºäº lucene, è¿ä¸ª java åºå¼å¥äº ææ®µæç´¢ çæ¦å¿µã æ¯ä¸ æ®µ æ¬èº«é½æ¯ä¸ä¸ªåæç´¢å¼ï¼ ä½ ç´¢å¼ å¨ lucene ä¸­é¤è¡¨ç¤ºææ æ®µ çéåå¤ï¼ è¿å¢å äº æäº¤ç¹ çæ¦å¿µ â ä¸ä¸ªååºäºææå·²ç¥æ®µçæä»¶ï¼å°±åå¨ figure 16, âä¸ä¸ª lucene ç´¢å¼åå«ä¸ä¸ªæäº¤ç¹åä¸ä¸ªæ®µâ ä¸­æç»çé£æ ·ã å¦ figure 17, âä¸ä¸ªå¨åå­ç¼å­ä¸­åå«æ°ææ¡£ç lucene ç´¢å¼â æç¤ºï¼æ°çææ¡£é¦åè¢«æ·»å å°åå­ç´¢å¼ç¼å­ä¸­ï¼ç¶ååå¥å°ä¸ä¸ªåºäºç£ççæ®µï¼å¦ figure 18, âå¨ä¸æ¬¡æäº¤åï¼ä¸ä¸ªæ°çæ®µè¢«æ·»å å°æäº¤ç¹èä¸ç¼å­è¢«æ¸ç©ºãâ æç¤ºã\n\nfigure 16. ä¸ä¸ª lucene ç´¢å¼åå«ä¸ä¸ªæäº¤ç¹åä¸ä¸ªæ®µ\n\n\n\n> è¢«æ··æ·çæ¦å¿µæ¯ï¼ä¸ä¸ª lucene ç´¢å¼ æä»¬å¨ elasticsearch ç§°ä½ åç ã ä¸ä¸ª elasticsearch ç´¢å¼ æ¯åççéåã å½ elasticsearch å¨ç´¢å¼ä¸­æç´¢çæ¶åï¼ ä»åéæ¥è¯¢å°æ¯ä¸ä¸ªå±äºç´¢å¼çåç(lucene ç´¢å¼)ï¼ç¶åå æ§è¡åå¸å¼æ£ç´¢ æå°çé£æ ·ï¼åå¹¶æ¯ä¸ªåççç»æå°ä¸ä¸ªå¨å±çç»æéã\n\néæ®µæç´¢ä¼ä»¥å¦ä¸æµç¨è¿è¡å·¥ä½ï¼\n\n 1. æ°ææ¡£è¢«æ¶éå°åå­ç´¢å¼ç¼å­ï¼ è§ figure 17, âä¸ä¸ªå¨åå­ç¼å­ä¸­åå«æ°ææ¡£ç lucene ç´¢å¼â ã\n 2. ä¸æ¶å°, ç¼å­è¢« æäº¤ ï¼\n    * ä¸ä¸ªæ°çæ®µâä¸ä¸ªè¿½å çåæç´¢å¼âè¢«åå¥ç£çã\n    * ä¸ä¸ªæ°çåå«æ°æ®µåå­ç æäº¤ç¹ è¢«åå¥ç£çã\n    * ç£çè¿è¡ åæ­¥ â ææå¨æä»¶ç³»ç»ç¼å­ä¸­ç­å¾çåå¥é½å·æ°å°ç£çï¼ä»¥ç¡®ä¿å®ä»¬è¢«åå¥ç©çæä»¶ã\n 3. æ°çæ®µè¢«å¼å¯ï¼è®©å®åå«çææ¡£å¯è§ä»¥è¢«æç´¢ã\n 4. åå­ç¼å­è¢«æ¸ç©ºï¼ç­å¾æ¥æ¶æ°çææ¡£ã\n\nfigure 17. ä¸ä¸ªå¨åå­ç¼å­ä¸­åå«æ°ææ¡£ç lucene ç´¢å¼\n\n\n\nfigure 18. å¨ä¸æ¬¡æäº¤åï¼ä¸ä¸ªæ°çæ®µè¢«æ·»å å°æäº¤ç¹èä¸ç¼å­è¢«æ¸ç©ºã\n\n\n\nå½ä¸ä¸ªæ¥è¯¢è¢«è§¦åï¼ææå·²ç¥çæ®µæé¡ºåºè¢«æ¥è¯¢ãè¯é¡¹ç»è®¡ä¼å¯¹æææ®µçç»æè¿è¡èåï¼ä»¥ä¿è¯æ¯ä¸ªè¯åæ¯ä¸ªææ¡£çå³èé½è¢«åç¡®è®¡ç®ã è¿ç§æ¹å¼å¯ä»¥ç¨ç¸å¯¹è¾ä½çææ¬å°æ°ææ¡£æ·»å å°ç´¢å¼ã\n\n\n# å é¤åæ´æ°\n\næ®µæ¯ä¸å¯æ¹åçï¼æä»¥æ¢ä¸è½ä»æææ¡£ä»æ§çæ®µä¸­ç§»é¤ï¼ä¹ä¸è½ä¿®æ¹æ§çæ®µæ¥è¿è¡åæ ææ¡£çæ´æ°ã åèä»£ä¹çæ¯ï¼æ¯ä¸ªæäº¤ç¹ä¼åå«ä¸ä¸ª .del æä»¶ï¼æä»¶ä¸­ä¼ååºè¿äºè¢«å é¤ææ¡£çæ®µä¿¡æ¯ã\n\nå½ä¸ä¸ªææ¡£è¢« âå é¤â æ¶ï¼å®å®éä¸åªæ¯å¨ .del æä»¶ä¸­è¢« æ è®° å é¤ãä¸ä¸ªè¢«æ è®°å é¤çææ¡£ä»ç¶å¯ä»¥è¢«æ¥è¯¢å¹éå°ï¼ ä½å®ä¼å¨æç»ç»æè¢«è¿ååä»ç»æéä¸­ç§»é¤ã\n\nææ¡£æ´æ°ä¹æ¯ç±»ä¼¼çæä½æ¹å¼ï¼å½ä¸ä¸ªææ¡£è¢«æ´æ°æ¶ï¼æ§çæ¬ææ¡£è¢«æ è®°å é¤ï¼ææ¡£çæ°çæ¬è¢«ç´¢å¼å°ä¸ä¸ªæ°çæ®µä¸­ã å¯è½ä¸¤ä¸ªçæ¬çææ¡£é½ä¼è¢«ä¸ä¸ªæ¥è¯¢å¹éå°ï¼ä½è¢«å é¤çé£ä¸ªæ§çæ¬ææ¡£å¨ç»æéè¿ååå°±å·²ç»è¢«ç§»é¤ã\n\nå¨ æ®µåå¹¶ , æä»¬å±ç¤ºäºä¸ä¸ªè¢«å é¤çææ¡£æ¯ææ ·è¢«æä»¶ç³»ç»ç§»é¤çã\n\n\n# è¿å®æ¶æç´¢\n\néçææ®µï¼per-segmentï¼æç´¢çåå±ï¼ä¸ä¸ªæ°çææ¡£ä»ç´¢å¼å°å¯è¢«æç´¢çå»¶è¿æ¾èéä½äºãæ°ææ¡£å¨å åéä¹åå³å¯è¢«æ£ç´¢ï¼ä½è¿æ ·è¿æ¯ä¸å¤å¿«ã\n\nç£çå¨è¿éæä¸ºäºç¶é¢ãæäº¤ï¼commitingï¼ä¸ä¸ªæ°çæ®µå°ç£çéè¦ä¸ä¸ª fsync æ¥ç¡®ä¿æ®µè¢«ç©çæ§å°åå¥ç£çï¼è¿æ ·å¨æ­çµçæ¶åå°±ä¸ä¼ä¸¢å¤±æ°æ®ã ä½æ¯ fsync æä½ä»£ä»·å¾å¤§; å¦ææ¯æ¬¡ç´¢å¼ä¸ä¸ªææ¡£é½å»æ§è¡ä¸æ¬¡çè¯ä¼é æå¾å¤§çæ§è½é®é¢ã\n\næä»¬éè¦çæ¯ä¸ä¸ªæ´è½»éçæ¹å¼æ¥ä½¿ä¸ä¸ªææ¡£å¯è¢«æç´¢ï¼è¿æå³ç fsync è¦ä»æ´ä¸ªè¿ç¨ä¸­è¢«ç§»é¤ã\n\nå¨ elasticsearch åç£çä¹é´æ¯æä»¶ç³»ç»ç¼å­ã åä¹åæè¿°çä¸æ ·ï¼ å¨åå­ç´¢å¼ç¼å²åºï¼ figure 19, âå¨åå­ç¼å²åºä¸­åå«äºæ°ææ¡£ç lucene ç´¢å¼â ï¼ä¸­çææ¡£ä¼è¢«åå¥å°ä¸ä¸ªæ°çæ®µä¸­ï¼ figure 20, âç¼å²åºçåå®¹å·²ç»è¢«åå¥ä¸ä¸ªå¯è¢«æç´¢çæ®µä¸­ï¼ä½è¿æ²¡æè¿è¡æäº¤â ï¼ã ä½æ¯è¿éæ°æ®µä¼è¢«ååå¥å°æä»¶ç³»ç»ç¼å­âè¿ä¸æ­¥ä»£ä»·ä¼æ¯è¾ä½ï¼ç¨ååè¢«å·æ°å°ç£çâè¿ä¸æ­¥ä»£ä»·æ¯è¾é«ãä¸è¿åªè¦æä»¶å·²ç»å¨ç¼å­ä¸­ï¼ å°±å¯ä»¥åå¶å®æä»¶ä¸æ ·è¢«æå¼åè¯»åäºã\n\nfigure 19. å¨åå­ç¼å²åºä¸­åå«äºæ°ææ¡£ç lucene ç´¢å¼\n\n\n\nlucene åè®¸æ°æ®µè¢«åå¥åæå¼âä½¿å¶åå«çææ¡£å¨æªè¿è¡ä¸æ¬¡å®æ´æäº¤æ¶ä¾¿å¯¹æç´¢å¯è§ã è¿ç§æ¹å¼æ¯è¿è¡ä¸æ¬¡æäº¤ä»£ä»·è¦å°å¾å¤ï¼å¹¶ä¸å¨ä¸å½±åæ§è½çåæä¸å¯ä»¥è¢«é¢ç¹å°æ§è¡ã\n\nfigure 20. ç¼å²åºçåå®¹å·²ç»è¢«åå¥ä¸ä¸ªå¯è¢«æç´¢çæ®µä¸­ï¼ä½è¿æ²¡æè¿è¡æäº¤\n\n\n\n\n# refresh api\n\nå¨ elasticsearch ä¸­ï¼åå¥åæå¼ä¸ä¸ªæ°æ®µçè½»éçè¿ç¨å«å refresh ã é»è®¤æåµä¸æ¯ä¸ªåçä¼æ¯ç§èªå¨å·æ°ä¸æ¬¡ãè¿å°±æ¯ä¸ºä»ä¹æä»¬è¯´ elasticsearch æ¯ è¿ å®æ¶æç´¢: ææ¡£çååå¹¶ä¸æ¯ç«å³å¯¹æç´¢å¯è§ï¼ä½ä¼å¨ä¸ç§ä¹ååä¸ºå¯è§ã\n\nè¿äºè¡ä¸ºå¯è½ä¼å¯¹æ°ç¨æ·é æå°æ: ä»ä»¬ç´¢å¼äºä¸ä¸ªææ¡£ç¶åå°è¯æç´¢å®ï¼ä½å´æ²¡ææå°ãè¿ä¸ªé®é¢çè§£å³åæ³æ¯ç¨ refresh api æ§è¡ä¸æ¬¡æå¨å·æ°:\n\npost /_refresh\npost /blogs/_refresh\n\n\nå·æ°ï¼refreshï¼ææçç´¢å¼\n\nåªå·æ°ï¼refreshï¼ blogs ç´¢å¼\n\n> å°½ç®¡å·æ°æ¯æ¯æäº¤è½»éå¾å¤çæä½ï¼å®è¿æ¯ä¼ææ§è½å¼éãå½åæµè¯çæ¶åï¼ æå¨å·æ°å¾æç¨ï¼ä½æ¯ä¸è¦å¨çäº§ç¯å¢ä¸æ¯æ¬¡ç´¢å¼ä¸ä¸ªææ¡£é½å»æå¨å·æ°ã ç¸åï¼ä½ çåºç¨éè¦æè¯å° elasticsearch çè¿å®æ¶çæ§è´¨ï¼å¹¶æ¥åå®çä¸è¶³ã\n\nå¹¶ä¸æ¯ææçæåµé½éè¦æ¯ç§å·æ°ãå¯è½ä½ æ­£å¨ä½¿ç¨ elasticsearch ç´¢å¼å¤§éçæ¥å¿æä»¶ï¼ ä½ å¯è½æ³ä¼åç´¢å¼éåº¦èä¸æ¯è¿å®æ¶æç´¢ï¼ å¯ä»¥éè¿è®¾ç½® refresh_interval ï¼ éä½æ¯ä¸ªç´¢å¼çå·æ°é¢çï¼\n\nput /my_logs\n{\n  "settings": {\n    "refresh_interval": "30s"\n  }\n}\n\n\n> æ¯ 30 ç§å·æ° my_logs ç´¢å¼ã\n\nrefresh_interval å¯ä»¥å¨æ¢å­ç´¢å¼ä¸è¿è¡å¨ææ´æ°ã å¨çäº§ç¯å¢ä¸­ï¼å½ä½ æ­£å¨å»ºç«ä¸ä¸ªå¤§çæ°ç´¢å¼æ¶ï¼å¯ä»¥åå³é­èªå¨å·æ°ï¼å¾å¼å§ä½¿ç¨è¯¥ç´¢å¼æ¶ï¼åæå®ä»¬è°åæ¥ï¼\n\nput /my_logs/_settings\n{ "refresh_interval": -1 }\n\nput /my_logs/_settings\n{ "refresh_interval": "1s" }\n\n\n * å³é­èªå¨å·æ°ã\n\n * æ¯ç§èªå¨å·æ°ã\n\n> refresh_interval éè¦ä¸ä¸ª æç»­æ¶é´ å¼ï¼ ä¾å¦ 1s ï¼1 ç§ï¼ æ 2m ï¼2 åéï¼ã ä¸ä¸ªç»å¯¹å¼ 1 è¡¨ç¤ºçæ¯ 1 æ¯«ç§ --æ çä¼ä½¿ä½ çéç¾¤é·å¥ç«çªã\n\n\n# æä¹ååæ´\n\nå¦ææ²¡æç¨ fsync ææ°æ®ä»æä»¶ç³»ç»ç¼å­å·ï¼flushï¼å°ç¡¬çï¼æä»¬ä¸è½ä¿è¯æ°æ®å¨æ­çµçè³æ¯ç¨åºæ­£å¸¸éåºä¹åä¾ç¶å­å¨ãä¸ºäºä¿è¯ elasticsearch çå¯é æ§ï¼éè¦ç¡®ä¿æ°æ®ååè¢«æä¹åå°ç£çã\n\nå¨ å¨ææ´æ°ç´¢å¼ï¼æä»¬è¯´ä¸æ¬¡å®æ´çæäº¤ä¼å°æ®µå·å°ç£çï¼å¹¶åå¥ä¸ä¸ªåå«æææ®µåè¡¨çæäº¤ç¹ãelasticsearch å¨å¯å¨æéæ°æå¼ä¸ä¸ªç´¢å¼çè¿ç¨ä¸­ä½¿ç¨è¿ä¸ªæäº¤ç¹æ¥å¤æ­åªäºæ®µé¶å±äºå½ååçã\n\nå³ä½¿éè¿æ¯ç§å·æ°ï¼refreshï¼å®ç°äºè¿å®æ¶æç´¢ï¼æä»¬ä»ç¶éè¦ç»å¸¸è¿è¡å®æ´æäº¤æ¥ç¡®ä¿è½ä»å¤±è´¥ä¸­æ¢å¤ãä½å¨ä¸¤æ¬¡æäº¤ä¹é´åçååçææ¡£æä¹åï¼æä»¬ä¹ä¸å¸æä¸¢å¤±æè¿äºæ°æ®ã\n\nelasticsearch å¢å äºä¸ä¸ª translog ï¼æèå«äºå¡æ¥å¿ï¼å¨æ¯ä¸æ¬¡å¯¹ elasticsearch è¿è¡æä½æ¶åè¿è¡äºæ¥å¿è®°å½ãéè¿ translog ï¼æ´ä¸ªæµç¨çèµ·æ¥æ¯ä¸é¢è¿æ ·ï¼\n\nä¸ä¸ªææ¡£è¢«ç´¢å¼ä¹åï¼å°±ä¼è¢«æ·»å å°åå­ç¼å²åºï¼å¹¶ä¸ è¿½å å°äº translog ï¼æ­£å¦ figure 21, âæ°çææ¡£è¢«æ·»å å°åå­ç¼å²åºå¹¶ä¸è¢«è¿½å å°äºäºå¡æ¥å¿â æè¿°çä¸æ ·ã\n\nfigure 21. æ°çææ¡£è¢«æ·»å å°åå­ç¼å²åºå¹¶ä¸è¢«è¿½å å°äºäºå¡æ¥å¿\n\n\n\nå·æ°ï¼refreshï¼ä½¿åçå¤äº figure 22, âå·æ°ï¼refreshï¼å®æå, ç¼å­è¢«æ¸ç©ºä½æ¯äºå¡æ¥å¿ä¸ä¼â æè¿°çç¶æï¼åçæ¯ç§è¢«å·æ°ï¼refreshï¼ä¸æ¬¡ï¼\n\n * è¿äºå¨åå­ç¼å²åºçææ¡£è¢«åå¥å°ä¸ä¸ªæ°çæ®µä¸­ï¼ä¸æ²¡æè¿è¡ fsync æä½ã\n * è¿ä¸ªæ®µè¢«æå¼ï¼ä½¿å¶å¯è¢«æç´¢ã\n * åå­ç¼å²åºè¢«æ¸ç©ºã\n\nfigure 22. å·æ°ï¼refreshï¼å®æå, ç¼å­è¢«æ¸ç©ºä½æ¯äºå¡æ¥å¿ä¸ä¼\n\n\n\nè¿ä¸ªè¿ç¨ç»§ç»­å·¥ä½ï¼æ´å¤çææ¡£è¢«æ·»å å°åå­ç¼å²åºåè¿½å å°äºå¡æ¥å¿ï¼è§ figure 23, âäºå¡æ¥å¿ä¸æ­ç§¯ç´¯ææ¡£â ï¼ã\n\nfigure 23. äºå¡æ¥å¿ä¸æ­ç§¯ç´¯ææ¡£\n\n\n\n 1. æ¯éä¸æ®µæ¶é´âä¾å¦ translog åå¾è¶æ¥è¶å¤§âç´¢å¼è¢«å·æ°ï¼flushï¼ï¼ä¸ä¸ªæ°ç translog è¢«åå»ºï¼å¹¶ä¸ä¸ä¸ªå¨éæäº¤è¢«æ§è¡ï¼è§ figure 24, âå¨å·æ°ï¼flushï¼ä¹åï¼æ®µè¢«å¨éæäº¤ï¼å¹¶ä¸äºå¡æ¥å¿è¢«æ¸ç©ºâ ï¼ï¼\n    * ææå¨åå­ç¼å²åºçææ¡£é½è¢«åå¥ä¸ä¸ªæ°çæ®µã\n    * ç¼å²åºè¢«æ¸ç©ºã\n    * ä¸ä¸ªæäº¤ç¹è¢«åå¥ç¡¬çã\n    * æä»¶ç³»ç»ç¼å­éè¿ fsync è¢«å·æ°ï¼flushï¼ã\n    * èç translog è¢«å é¤ã\n\ntranslog æä¾ææè¿æ²¡æè¢«å·å°ç£ççæä½çä¸ä¸ªæä¹åçºªå½ãå½ elasticsearch å¯å¨çæ¶åï¼ å®ä¼ä»ç£çä¸­ä½¿ç¨æåä¸ä¸ªæäº¤ç¹å»æ¢å¤å·²ç¥çæ®µï¼å¹¶ä¸ä¼éæ¾ translog ä¸­ææå¨æåä¸æ¬¡æäº¤ååççåæ´æä½ã\n\ntranslog ä¹è¢«ç¨æ¥æä¾å®æ¶ crud ãå½ä½ è¯çéè¿ id æ¥è¯¢ãæ´æ°ãå é¤ä¸ä¸ªææ¡£ï¼å®ä¼å¨å°è¯ä»ç¸åºçæ®µä¸­æ£ç´¢ä¹åï¼ é¦åæ£æ¥ translog ä»»ä½æè¿çåæ´ãè¿æå³çå®æ»æ¯è½å¤å®æ¶å°è·åå°ææ¡£çææ°çæ¬ã\n\nfigure 24. å¨å·æ°ï¼flushï¼ä¹åï¼æ®µè¢«å¨éæäº¤ï¼å¹¶ä¸äºå¡æ¥å¿è¢«æ¸ç©º\n\n\n\n\n# flush api\n\nè¿ä¸ªæ§è¡ä¸ä¸ªæäº¤å¹¶ä¸æªæ­ translog çè¡ä¸ºå¨ elasticsearch è¢«ç§°ä½ä¸æ¬¡ flush ã åçæ¯ 30 åéè¢«èªå¨å·æ°ï¼flushï¼ï¼æèå¨ translog å¤ªå¤§çæ¶åä¹ä¼å·æ°ãè¯·æ¥ç translog ææ¡£ æ¥è®¾ç½®ï¼å®å¯ä»¥ç¨æ¥ æ§å¶è¿äºéå¼ï¼\n\nflush api å¯ä»¥è¢«ç¨æ¥æ§è¡ä¸ä¸ªæå·¥çå·æ°ï¼flushï¼:\n\npost /blogs/_flush\npost /_flush?wait_for_ongoing\n\n\n * å·æ°ï¼flushï¼ blogs ç´¢å¼ã\n * å·æ°ï¼flushï¼ææçç´¢å¼å¹¶ä¸å¹¶ä¸ç­å¾ææå·æ°å¨è¿ååå®æã\n\nä½ å¾å°éè¦èªå·±æå¨æ§è¡ flush æä½ï¼éå¸¸æåµä¸ï¼èªå¨å·æ°å°±è¶³å¤äºã\n\nè¿å°±æ¯è¯´ï¼å¨éå¯èç¹æå³é­ç´¢å¼ä¹åæ§è¡ flush æçäºä½ çç´¢å¼ãå½ elasticsearch å°è¯æ¢å¤æéæ°æå¼ä¸ä¸ªç´¢å¼ï¼ å®éè¦éæ¾ translog ä¸­ææçæä½ï¼æä»¥å¦ææ¥å¿è¶ç­ï¼æ¢å¤è¶å¿«ã\n\n> translog çç®çæ¯ä¿è¯æä½ä¸ä¼ä¸¢å¤±ãè¿å¼åºäºè¿ä¸ªé®é¢ï¼ translog æå¤å®å¨ï¼\n> \n> å¨æä»¶è¢« fsync å°ç£çåï¼è¢«åå¥çæä»¶å¨éå¯ä¹åå°±ä¼ä¸¢å¤±ãé»è®¤ translog æ¯æ¯ 5 ç§è¢« fsync å·æ°å°ç¡¬çï¼ æèå¨æ¯æ¬¡åè¯·æ±å®æä¹åæ§è¡(e.g. index, delete, update, bulk)ãè¿ä¸ªè¿ç¨å¨ä¸»åçåå¤å¶åçé½ä¼åçãæç»ï¼ åºæ¬ä¸ï¼è¿æå³çå¨æ´ä¸ªè¯·æ±è¢« fsync å°ä¸»åçåå¤å¶åçç translog ä¹åï¼ä½ çå®¢æ·ç«¯ä¸ä¼å¾å°ä¸ä¸ª 200 ok ååºã\n> \n> å¨æ¯æ¬¡è¯·æ±åé½æ§è¡ä¸ä¸ª fsync ä¼å¸¦æ¥ä¸äºæ§è½æå¤±ï¼å°½ç®¡å®è·µè¡¨æè¿ç§æå¤±ç¸å¯¹è¾å°ï¼ç¹å«æ¯ bulk å¯¼å¥ï¼å®å¨ä¸æ¬¡è¯·æ±ä¸­å¹³æäºå¤§éææ¡£çå¼éï¼ã\n> \n> ä½æ¯å¯¹äºä¸äºå¤§å®¹éçå¶å°ä¸¢å¤±å ç§æ°æ®é®é¢ä¹å¹¶ä¸ä¸¥éçéç¾¤ï¼ä½¿ç¨å¼æ­¥ç fsync è¿æ¯æ¯è¾æççãæ¯å¦ï¼åå¥çæ°æ®è¢«ç¼å­å°åå­ä¸­ï¼åæ¯ 5 ç§æ§è¡ä¸æ¬¡ fsync ã\n> \n> è¿ä¸ªè¡ä¸ºå¯ä»¥éè¿è®¾ç½® durability åæ°ä¸º async æ¥å¯ç¨ï¼\n> \n> put /my_index/_settings\n> {\n>     "index.translog.durability": "async",\n>     "index.translog.sync_interval": "5s"\n> }\n> \n> \n> è¿ä¸ªéé¡¹å¯ä»¥éå¯¹ç´¢å¼åç¬è®¾ç½®ï¼å¹¶ä¸å¯ä»¥å¨æè¿è¡ä¿®æ¹ãå¦æä½ å³å®ä½¿ç¨å¼æ­¥ translog çè¯ï¼ä½ éè¦ ä¿è¯ å¨åç crash æ¶ï¼ä¸¢å¤±æ sync_interval æ¶é´æ®µçæ°æ®ä¹æ æè°ãè¯·å¨å³å®åç¥æè¿ä¸ªç¹æ§ã\n> \n> å¦æä½ ä¸ç¡®å®è¿ä¸ªè¡ä¸ºçåæï¼æå¥½æ¯ä½¿ç¨é»è®¤çåæ°ï¼ "index.translog.durability": "request" ï¼æ¥é¿åæ°æ®ä¸¢å¤±ã\n\n\n# æ®µåå¹¶\n\nç±äºèªå¨å·æ°æµç¨æ¯ç§ä¼åå»ºä¸ä¸ªæ°çæ®µ ï¼è¿æ ·ä¼å¯¼è´ç­æ¶é´åçæ®µæ°éæ´å¢ãèæ®µæ°ç®å¤ªå¤ä¼å¸¦æ¥è¾å¤§çéº»ç¦ã æ¯ä¸ä¸ªæ®µé½ä¼æ¶èæä»¶å¥æãåå­å cpu è¿è¡å¨æãæ´éè¦çæ¯ï¼æ¯ä¸ªæç´¢è¯·æ±é½å¿é¡»è½®æµæ£æ¥æ¯ä¸ªæ®µï¼æä»¥æ®µè¶å¤ï¼æç´¢ä¹å°±è¶æ¢ã\n\nelasticsearch éè¿å¨åå°è¿è¡æ®µåå¹¶æ¥è§£å³è¿ä¸ªé®é¢ãå°çæ®µè¢«åå¹¶å°å¤§çæ®µï¼ç¶åè¿äºå¤§çæ®µåè¢«åå¹¶å°æ´å¤§çæ®µã\n\næ®µåå¹¶çæ¶åä¼å°é£äºæ§çå·²å é¤ææ¡£ä»æä»¶ç³»ç»ä¸­æ¸é¤ãè¢«å é¤çææ¡£ï¼æè¢«æ´æ°ææ¡£çæ§çæ¬ï¼ä¸ä¼è¢«æ·è´å°æ°çå¤§æ®µä¸­ã\n\nå¯å¨æ®µåå¹¶ä¸éè¦ä½ åä»»ä½äºãè¿è¡ç´¢å¼åæç´¢æ¶ä¼èªå¨è¿è¡ãè¿ä¸ªæµç¨åå¨ figure 25, âä¸¤ä¸ªæäº¤äºçæ®µåä¸ä¸ªæªæäº¤çæ®µæ­£å¨è¢«åå¹¶å°ä¸ä¸ªæ´å¤§çæ®µâ ä¸­æå°çä¸æ ·å·¥ä½ï¼\n\n1ã å½ç´¢å¼çæ¶åï¼å·æ°ï¼refreshï¼æä½ä¼åå»ºæ°çæ®µå¹¶å°æ®µæå¼ä»¥ä¾æç´¢ä½¿ç¨ã\n\n2ã åå¹¶è¿ç¨éæ©ä¸å°é¨åå¤§å°ç¸ä¼¼çæ®µï¼å¹¶ä¸å¨åå°å°å®ä»¬åå¹¶å°æ´å¤§çæ®µä¸­ãè¿å¹¶ä¸ä¼ä¸­æ­ç´¢å¼åæç´¢ã\n\nfigure 25. ä¸¤ä¸ªæäº¤äºçæ®µåä¸ä¸ªæªæäº¤çæ®µæ­£å¨è¢«åå¹¶å°ä¸ä¸ªæ´å¤§çæ®µ\n\n\n\nfigure 26, âä¸æ¦åå¹¶ç»æï¼èçæ®µè¢«å é¤â è¯´æåå¹¶å®ææ¶çæ´»å¨ï¼\n\n * æ°çæ®µè¢«å·æ°ï¼flushï¼å°äºç£çã ** åå¥ä¸ä¸ªåå«æ°æ®µä¸æé¤æ§çåè¾å°çæ®µçæ°æäº¤ç¹ã\n * æ°çæ®µè¢«æå¼ç¨æ¥æç´¢ã\n * èçæ®µè¢«å é¤ã\n\nfigure 26. ä¸æ¦åå¹¶ç»æï¼èçæ®µè¢«å é¤\n\n\n\nåå¹¶å¤§çæ®µéè¦æ¶èå¤§éç i/o å cpu èµæºï¼å¦æä»»å¶åå±ä¼å½±åæç´¢æ§è½ãelasticsearch å¨é»è®¤æåµä¸ä¼å¯¹åå¹¶æµç¨è¿è¡èµæºéå¶ï¼æä»¥æç´¢ä»ç¶ æè¶³å¤çèµæºå¾å¥½å°æ§è¡ã\n\n\n# optimize api\n\noptimize api å¤§å¯çåæ¯ å¼ºå¶åå¹¶ apiãå®ä¼å°ä¸ä¸ªåçå¼ºå¶åå¹¶å° max_num_segments åæ°æå®å¤§å°çæ®µæ°ç®ã è¿æ ·åçæå¾æ¯åå°æ®µçæ°éï¼éå¸¸åå°å°ä¸ä¸ªï¼ï¼æ¥æåæç´¢æ§è½ã\n\n> optimize api ä¸åºè¯¥ è¢«ç¨å¨ä¸ä¸ªæ´»è·çç´¢å¼ââââä¸ä¸ªæ­£ç§¯ææ´æ°çç´¢å¼ãåå°åå¹¶æµç¨å·²ç»å¯ä»¥å¾å¥½å°å®æå·¥ä½ã optimizing ä¼é»ç¢è¿ä¸ªè¿ç¨ãä¸è¦å¹²æ°å®ï¼\n\nå¨ç¹å®æåµä¸ï¼ä½¿ç¨ optimize api é¢æçå¤ãä¾å¦å¨æ¥å¿è¿ç§ç¨ä¾ä¸ï¼æ¯å¤©ãæ¯å¨ãæ¯æçæ¥å¿è¢«å­å¨å¨ä¸ä¸ªç´¢å¼ä¸­ã èçç´¢å¼å®è´¨ä¸æ¯åªè¯»çï¼å®ä»¬ä¹å¹¶ä¸å¤ªå¯è½ä¼åçååã\n\nå¨è¿ç§æåµä¸ï¼ä½¿ç¨ optimize ä¼åèçç´¢å¼ï¼å°æ¯ä¸ä¸ªåçåå¹¶ä¸ºä¸ä¸ªåç¬çæ®µå°±å¾æç¨äºï¼è¿æ ·æ¢å¯ä»¥èçèµæºï¼ä¹å¯ä»¥ä½¿æç´¢æ´å å¿«éï¼\n\npost /logstash-2014-10/_optimize?max_num_segments=1\n\n\nåå¹¶ç´¢å¼ä¸­çæ¯ä¸ªåçä¸ºä¸ä¸ªåç¬çæ®µ\n\n> è¯·æ³¨æï¼ä½¿ç¨ optimize api è§¦åæ®µåå¹¶çæä½ä¸ä¼åå°ä»»ä½èµæºä¸çéå¶ãè¿å¯è½ä¼æ¶èæä½ èç¹ä¸å¨é¨ç i/o èµæº, ä½¿å¶æ²¡æä½è£æ¥å¤çæç´¢è¯·æ±ï¼ä»èæå¯è½ä½¿éç¾¤å¤±å»ååºã å¦æä½ æ³è¦å¯¹ç´¢å¼æ§è¡ optimizeï¼ä½ éè¦åä½¿ç¨åçåéï¼æ¥ç è¿ç§»æ§ç´¢å¼ï¼æç´¢å¼ç§»å°ä¸ä¸ªå®å¨çèç¹ï¼åæ§è¡ã\n\n\n# åèèµæ\n\n * elasticsearch å®æ¹ææ¡£ä¹ éç¾¤åçåç',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Elasticsearch è¿ç»´",frontmatter:{title:"Elasticsearch è¿ç»´",date:"2020-06-16T07:10:44.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","è¿ç»´"],permalink:"/pages/fdaf15/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/20.Elasticsearch%E8%BF%90%E7%BB%B4.html",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/20.Elasticsearchè¿ç»´.md",key:"v-717638d6",path:"/pages/fdaf15/",headers:[{level:2,title:"Elasticsearch å®è£",slug:"elasticsearch-å®è£",normalizedTitle:"elasticsearch å®è£",charIndex:135},{level:2,title:"Elasticsearch éç¾¤è§å",slug:"elasticsearch-éç¾¤è§å",normalizedTitle:"elasticsearch éç¾¤è§å",charIndex:336},{level:2,title:"Elasticsearch éç½®",slug:"elasticsearch-éç½®",normalizedTitle:"elasticsearch éç½®",charIndex:720},{level:2,title:"Elasticsearch FAQ",slug:"elasticsearch-faq",normalizedTitle:"elasticsearch faq",charIndex:3240},{level:3,title:"elasticsearch ä¸åè®¸ä»¥ root æéæ¥è¿è¡",slug:"elasticsearch-ä¸åè®¸ä»¥-root-æéæ¥è¿è¡",normalizedTitle:"elasticsearch ä¸åè®¸ä»¥ root æéæ¥è¿è¡",charIndex:3262},{level:3,title:"vm.maxmapcount ä¸ä½äº 262144",slug:"vm-max-map-count-ä¸ä½äº-262144",normalizedTitle:"vm.maxmapcount ä¸ä½äº 262144",charIndex:null},{level:3,title:"nofile ä¸ä½äº 65536",slug:"nofile-ä¸ä½äº-65536",normalizedTitle:"nofile ä¸ä½äº 65536",charIndex:4161},{level:3,title:"nproc ä¸ä½äº 2048",slug:"nproc-ä¸ä½äº-2048",normalizedTitle:"nproc ä¸ä½äº 2048",charIndex:4511},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:4827}],headersStr:"Elasticsearch å®è£ Elasticsearch éç¾¤è§å Elasticsearch éç½® Elasticsearch FAQ elasticsearch ä¸åè®¸ä»¥ root æéæ¥è¿è¡ vm.maxmapcount ä¸ä½äº 262144 nofile ä¸ä½äº 65536 nproc ä¸ä½äº 2048 åèèµæ",content:'# Elasticsearch è¿ç»´\n\n> Elasticsearch æ¯ä¸ä¸ªåå¸å¼ãRESTful é£æ ¼çæç´¢åæ°æ®åæå¼æï¼è½å¤è§£å³ä¸æ­æ¶ç°åºçåç§ç¨ä¾ã ä½ä¸º Elastic Stack çæ ¸å¿ï¼å®éä¸­å­å¨æ¨çæ°æ®ï¼å¸®å©æ¨åç°ææä¹ä¸­ä»¥åææä¹å¤çæåµã\n\n\n# Elasticsearch å®è£\n\n> Elasticsearch å®æ¹ä¸è½½å®è£è¯´æ\n\nï¼1ï¼ä¸è½½è§£å\n\nè®¿é® å®æ¹ä¸è½½å°å ï¼éæ©éè¦ççæ¬ï¼ä¸è½½è§£åå°æ¬å°ã\n\nï¼2ï¼è¿è¡\n\nè¿è¡ bin/elasticsearch (Windows ç³»ç»ä¸è¿è¡ bin\\elasticsearch.bat )\n\nï¼3ï¼è®¿é®\n\næ§è¡ curl http://localhost:9200/ æµè¯æå¡æ¯å¦å¯å¨\n\n\n# Elasticsearch éç¾¤è§å\n\nElasticSearch éç¾¤éè¦æ ¹æ®ä¸å¡å®éæåµå»åçè§åã\n\néè¦èèçé®é¢ç¹ï¼\n\n * éç¾¤é¨ç½²å ä¸ªèç¹ï¼\n * æå¤å°ä¸ªç´¢å¼ï¼\n * æ¯ä¸ªç´¢å¼æå¤å¤§æ°æ®éï¼\n * æ¯ä¸ªç´¢å¼æå¤å°ä¸ªåçï¼\n\nä¸ä¸ªåèè§åï¼\n\n * 3 å°æºå¨ï¼æ¯å°æºå¨æ¯ 6 æ ¸ 64G çã\n * æä»¬ es éç¾¤çæ¥å¢éæ°æ®å¤§æ¦æ¯ 2000 ä¸æ¡ï¼æ¯å¤©æ¥å¢éæ°æ®å¤§æ¦æ¯ 500MBï¼æ¯æå¢éæ°æ®å¤§æ¦æ¯ 6 äº¿ï¼15Gãç®åç³»ç»å·²ç»è¿è¡äºå ä¸ªæï¼ç°å¨ es éç¾¤éæ°æ®æ»éå¤§æ¦æ¯ 100G å·¦å³ã\n * ç®åçº¿ä¸æ 5 ä¸ªç´¢å¼ï¼è¿ä¸ªç»åä½ ä»¬èªå·±ä¸å¡æ¥ï¼ççèªå·±æåªäºæ°æ®å¯ä»¥æ¾ es çï¼ï¼æ¯ä¸ªç´¢å¼çæ°æ®éå¤§æ¦æ¯ 20Gï¼æä»¥è¿ä¸ªæ°æ®éä¹åï¼æä»¬æ¯ä¸ªç´¢å¼åéçæ¯ 8 ä¸ª shardï¼æ¯é»è®¤ç 5 ä¸ª shard å¤äº 3 ä¸ª shardã\n\n\n# Elasticsearch éç½®\n\nES çé»è®¤éç½®æä»¶ä¸º config/elasticsearch.yml\n\nåºæ¬éç½®è¯´æå¦ä¸ï¼\n\ncluster.name: elasticsearch\n#éç½®esçéç¾¤åç§°ï¼é»è®¤æ¯elasticsearchï¼esä¼èªå¨åç°å¨åä¸ç½æ®µä¸çesï¼å¦æå¨åä¸ç½æ®µä¸æå¤ä¸ªéç¾¤ï¼å°±å¯ä»¥ç¨è¿ä¸ªå±æ§æ¥åºåä¸åçéç¾¤ã\nnode.name: \'Franz Kafka\'\n#èç¹åï¼é»è®¤éæºæå®ä¸ä¸ªnameåè¡¨ä¸­åå­ï¼è¯¥åè¡¨å¨esçjaråä¸­configæä»¶å¤¹éname.txtæä»¶ä¸­ï¼å¶ä¸­æå¾å¤ä½èæ·»å çæè¶£åå­ã\nnode.master: true\n#æå®è¯¥èç¹æ¯å¦æèµæ ¼è¢«éä¸¾æä¸ºnodeï¼é»è®¤æ¯trueï¼esæ¯é»è®¤éç¾¤ä¸­çç¬¬ä¸å°æºå¨ä¸ºmasterï¼å¦æè¿å°æºæäºå°±ä¼éæ°éä¸¾masterã\nnode.data: true\n#æå®è¯¥èç¹æ¯å¦å­å¨ç´¢å¼æ°æ®ï¼é»è®¤ä¸ºtrueã\nindex.number_of_shards: 5\n#è®¾ç½®é»è®¤ç´¢å¼åçä¸ªæ°ï¼é»è®¤ä¸º5çã\nindex.number_of_replicas: 1\n#è®¾ç½®é»è®¤ç´¢å¼å¯æ¬ä¸ªæ°ï¼é»è®¤ä¸º1ä¸ªå¯æ¬ã\npath.conf: /path/to/conf\n#è®¾ç½®éç½®æä»¶çå­å¨è·¯å¾ï¼é»è®¤æ¯esæ ¹ç®å½ä¸çconfigæä»¶å¤¹ã\npath.data: /path/to/data\n#è®¾ç½®ç´¢å¼æ°æ®çå­å¨è·¯å¾ï¼é»è®¤æ¯esæ ¹ç®å½ä¸çdataæä»¶å¤¹ï¼å¯ä»¥è®¾ç½®å¤ä¸ªå­å¨è·¯å¾ï¼ç¨éå·éå¼ï¼ä¾ï¼\n#path.data: /path/to/data1,/path/to/data2\npath.work: /path/to/work\n#è®¾ç½®ä¸´æ¶æä»¶çå­å¨è·¯å¾ï¼é»è®¤æ¯esæ ¹ç®å½ä¸çworkæä»¶å¤¹ã\npath.logs: /path/to/logs\n#è®¾ç½®æ¥å¿æä»¶çå­å¨è·¯å¾ï¼é»è®¤æ¯esæ ¹ç®å½ä¸çlogsæä»¶å¤¹\npath.plugins: /path/to/plugins\n#è®¾ç½®æä»¶çå­æ¾è·¯å¾ï¼é»è®¤æ¯esæ ¹ç®å½ä¸çpluginsæä»¶å¤¹\nbootstrap.mlockall: true\n#è®¾ç½®ä¸ºtrueæ¥éä½åå­ãå ä¸ºå½jvmå¼å§swappingæ¶esçæçä¼éä½ï¼æä»¥è¦ä¿è¯å®ä¸swapï¼å¯ä»¥æ#ES_MIN_MEMåES_MAX_MEMä¸¤ä¸ªç¯å¢åéè®¾ç½®æåä¸ä¸ªå¼ï¼å¹¶ä¸ä¿è¯æºå¨æè¶³å¤çåå­åéç»esãåæ¶ä¹è¦#åè®¸elasticsearchçè¿ç¨å¯ä»¥éä½åå­ï¼linuxä¸å¯ä»¥éè¿`ulimit -l unlimited`å½ä»¤ã\nnetwork.bind_host: 192.168.0.1\n#è®¾ç½®ç»å®çipå°åï¼å¯ä»¥æ¯ipv4æipv6çï¼é»è®¤ä¸º0.0.0.0ã\nnetwork.publish_host: 192.168.0.1\n#è®¾ç½®å¶å®èç¹åè¯¥èç¹äº¤äºçipå°åï¼å¦æä¸è®¾ç½®å®ä¼èªå¨å¤æ­ï¼å¼å¿é¡»æ¯ä¸ªçå®çipå°åã\nnetwork.host: 192.168.0.1\n#è¿ä¸ªåæ°æ¯ç¨æ¥åæ¶è®¾ç½®bind_hoståpublish_hostä¸é¢ä¸¤ä¸ªåæ°ã\ntransport.tcp.port: 9300\n#è®¾ç½®èç¹é´äº¤äºçtcpç«¯å£ï¼é»è®¤æ¯9300ã\ntransport.tcp.compress: true\n#è®¾ç½®æ¯å¦åç¼©tcpä¼ è¾æ¶çæ°æ®ï¼é»è®¤ä¸ºfalseï¼ä¸åç¼©ã\nhttp.port: 9200\n#è®¾ç½®å¯¹å¤æå¡çhttpç«¯å£ï¼é»è®¤ä¸º9200ã\nhttp.max_content_length: 100mb\n#è®¾ç½®åå®¹çæå¤§å®¹éï¼é»è®¤100mb\nhttp.enabled: false\n#æ¯å¦ä½¿ç¨httpåè®®å¯¹å¤æä¾æå¡ï¼é»è®¤ä¸ºtrueï¼å¼å¯ã\ngateway.type: local\n#gatewayçç±»åï¼é»è®¤ä¸ºlocalå³ä¸ºæ¬å°æä»¶ç³»ç»ï¼å¯ä»¥è®¾ç½®ä¸ºæ¬å°æä»¶ç³»ç»ï¼åå¸å¼æä»¶ç³»ç»ï¼hadoopç#HDFSï¼åamazonçs3æå¡å¨ï¼å¶å®æä»¶ç³»ç»çè®¾ç½®æ¹æ³ä¸æ¬¡åè¯¦ç»è¯´ã\ngateway.recover_after_nodes: 1\n#è®¾ç½®éç¾¤ä¸­Nä¸ªèç¹å¯å¨æ¶è¿è¡æ°æ®æ¢å¤ï¼é»è®¤ä¸º1ã\ngateway.recover_after_time: 5m\n#è®¾ç½®åå§åæ°æ®æ¢å¤è¿ç¨çè¶æ¶æ¶é´ï¼é»è®¤æ¯5åéã\ngateway.expected_nodes: 2\n#è®¾ç½®è¿ä¸ªéç¾¤ä¸­èç¹çæ°éï¼é»è®¤ä¸º2ï¼ä¸æ¦è¿Nä¸ªèç¹å¯å¨ï¼å°±ä¼ç«å³è¿è¡æ°æ®æ¢å¤ã\ncluster.routing.allocation.node_initial_primaries_recoveries: 4\n#åå§åæ°æ®æ¢å¤æ¶ï¼å¹¶åæ¢å¤çº¿ç¨çä¸ªæ°ï¼é»è®¤ä¸º4ã\ncluster.routing.allocation.node_concurrent_recoveries: 2\n#æ·»å å é¤èç¹æè´è½½åè¡¡æ¶å¹¶åæ¢å¤çº¿ç¨çä¸ªæ°ï¼é»è®¤ä¸º4ã\nindices.recovery.max_size_per_sec: 0\n#è®¾ç½®æ°æ®æ¢å¤æ¶éå¶çå¸¦å®½ï¼å¦å¥100mbï¼é»è®¤ä¸º0ï¼å³æ éå¶ã\nindices.recovery.concurrent_streams: 5\n#è®¾ç½®è¿ä¸ªåæ°æ¥éå¶ä»å¶å®åçæ¢å¤æ°æ®æ¶æå¤§åæ¶æå¼å¹¶åæµçä¸ªæ°ï¼é»è®¤ä¸º5ã\ndiscovery.zen.minimum_master_nodes: 1\n#è®¾ç½®è¿ä¸ªåæ°æ¥ä¿è¯éç¾¤ä¸­çèç¹å¯ä»¥ç¥éå¶å®Nä¸ªæmasterèµæ ¼çèç¹ãé»è®¤ä¸º1ï¼å¯¹äºå¤§çéç¾¤æ¥è¯´ï¼å¯ä»¥è®¾ç½®å¤§ä¸ç¹çå¼ï¼2-4ï¼\ndiscovery.zen.ping.timeout: 3s\n#è®¾ç½®éç¾¤ä¸­èªå¨åç°å¶å®èç¹æ¶pingè¿æ¥è¶æ¶æ¶é´ï¼é»è®¤ä¸º3ç§ï¼å¯¹äºæ¯è¾å·®çç½ç»ç¯å¢å¯ä»¥é«ç¹çå¼æ¥é²æ­¢èªå¨åç°æ¶åºéã\ndiscovery.zen.ping.multicast.enabled: false\n#è®¾ç½®æ¯å¦æå¼å¤æ­åç°èç¹ï¼é»è®¤æ¯trueã\ndiscovery.zen.ping.unicast.hosts: [\'host1\', \'host2:port\', \'host3[portX-portY]\']\n#è®¾ç½®éç¾¤ä¸­masterèç¹çåå§åè¡¨ï¼å¯ä»¥éè¿è¿äºèç¹æ¥èªå¨åç°æ°å å¥éç¾¤çèç¹ã\n\n\n\n# Elasticsearch FAQ\n\n\n# elasticsearch ä¸åè®¸ä»¥ root æéæ¥è¿è¡\n\n**é®é¢ï¼**å¨ Linux ç¯å¢ä¸­ï¼elasticsearch ä¸åè®¸ä»¥ root æéæ¥è¿è¡ã\n\nå¦æä»¥ root èº«ä»½è¿è¡ elasticsearchï¼ä¼æç¤ºè¿æ ·çéè¯¯ï¼\n\ncan not run elasticsearch as root\n\n\n**è§£å³æ¹æ³ï¼**ä½¿ç¨é root æéè´¦å·è¿è¡ elasticsearch\n\n# åå»ºç¨æ·ç»\ngroupadd elk\n# åå»ºæ°ç¨æ·ï¼-g elk è®¾ç½®å¶ç¨æ·ç»ä¸º elkï¼-p elk è®¾ç½®å¶å¯ç ä¸º elk\nuseradd elk -g elk -p elk\n# æ´æ¹ /opt æä»¶å¤¹ååé¨æä»¶çæå±ç¨æ·åç»ä¸º elk:elk\nchown -R elk:elk /opt # åè®¾ä½ ç elasticsearch å®è£å¨ opt ç®å½ä¸\n# åæ¢è´¦å·\nsu elk\n\n\n\n# vm.max_map_count ä¸ä½äº 262144\n\né®é¢ï¼vm.max_map_count è¡¨ç¤ºèæåå­å¤§å°ï¼å®æ¯ä¸ä¸ªåæ ¸åæ°ãelasticsearch é»è®¤è¦æ± vm.max_map_count ä¸ä½äº 262144ã\n\nmax virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]\n\n\nè§£å³æ¹æ³ï¼\n\nä½ å¯ä»¥æ§è¡ä»¥ä¸å½ä»¤ï¼è®¾ç½® vm.max_map_count ï¼ä½æ¯éå¯ååä¼æ¢å¤ä¸ºåå¼ã\n\nsysctl -w vm.max_map_count=262144\n\n\næä¹æ§çåæ³æ¯å¨ /etc/sysctl.conf æä»¶ä¸­ä¿®æ¹ vm.max_map_count åæ°ï¼\n\necho "vm.max_map_count=262144" > /etc/sysctl.conf\nsysctl -p\n\n\n> æ³¨æ\n> \n> å¦æè¿è¡ç¯å¢ä¸º docker å®¹å¨ï¼å¯è½ä¼éå¶æ§è¡ sysctl æ¥ä¿®æ¹åæ ¸åæ°ã\n> \n> è¿ç§æåµä¸ï¼ä½ åªè½éæ©ç´æ¥ä¿®æ¹å®¿ä¸»æºä¸çåæ°äºã\n\n\n# nofile ä¸ä½äº 65536\n\né®é¢ï¼ nofile è¡¨ç¤ºè¿ç¨åè®¸æå¼çæå¤§æä»¶æ°ãelasticsearch è¿ç¨è¦æ±å¯ä»¥æå¼çæå¤§æä»¶æ°ä¸ä½äº 65536ã\n\nmax file descriptors [4096] for elasticsearch process is too low, increase to at least [65536]\n\n\nè§£å³æ¹æ³ï¼\n\nå¨ /etc/security/limits.conf æä»¶ä¸­ä¿®æ¹ nofile åæ°ï¼\n\necho "* soft nofile 65536" > /etc/security/limits.conf\necho "* hard nofile 131072" > /etc/security/limits.conf\n\n\n\n# nproc ä¸ä½äº 2048\n\né®é¢ï¼ nproc è¡¨ç¤ºæå¤§çº¿ç¨æ°ãelasticsearch è¦æ±æå¤§çº¿ç¨æ°ä¸ä½äº 2048ã\n\nmax number of threads [1024] for user [user] is too low, increase to at least [2048]\n\n\nè§£å³æ¹æ³ï¼\n\nå¨ /etc/security/limits.conf æä»¶ä¸­ä¿®æ¹ nproc åæ°ï¼\n\necho "* soft nproc 2048" > /etc/security/limits.conf\necho "* hard nproc 4096" > /etc/security/limits.conf\n\n\n\n# åèèµæ\n\n * Elasticsearch å®æ¹ä¸è½½å®è£è¯´æ\n * Install Elasticsearch with RPM\n * Elasticsearch ä½¿ç¨ç§¯ç´¯',normalizedContent:'# elasticsearch è¿ç»´\n\n> elasticsearch æ¯ä¸ä¸ªåå¸å¼ãrestful é£æ ¼çæç´¢åæ°æ®åæå¼æï¼è½å¤è§£å³ä¸æ­æ¶ç°åºçåç§ç¨ä¾ã ä½ä¸º elastic stack çæ ¸å¿ï¼å®éä¸­å­å¨æ¨çæ°æ®ï¼å¸®å©æ¨åç°ææä¹ä¸­ä»¥åææä¹å¤çæåµã\n\n\n# elasticsearch å®è£\n\n> elasticsearch å®æ¹ä¸è½½å®è£è¯´æ\n\nï¼1ï¼ä¸è½½è§£å\n\nè®¿é® å®æ¹ä¸è½½å°å ï¼éæ©éè¦ççæ¬ï¼ä¸è½½è§£åå°æ¬å°ã\n\nï¼2ï¼è¿è¡\n\nè¿è¡ bin/elasticsearch (windows ç³»ç»ä¸è¿è¡ bin\\elasticsearch.bat )\n\nï¼3ï¼è®¿é®\n\næ§è¡ curl http://localhost:9200/ æµè¯æå¡æ¯å¦å¯å¨\n\n\n# elasticsearch éç¾¤è§å\n\nelasticsearch éç¾¤éè¦æ ¹æ®ä¸å¡å®éæåµå»åçè§åã\n\néè¦èèçé®é¢ç¹ï¼\n\n * éç¾¤é¨ç½²å ä¸ªèç¹ï¼\n * æå¤å°ä¸ªç´¢å¼ï¼\n * æ¯ä¸ªç´¢å¼æå¤å¤§æ°æ®éï¼\n * æ¯ä¸ªç´¢å¼æå¤å°ä¸ªåçï¼\n\nä¸ä¸ªåèè§åï¼\n\n * 3 å°æºå¨ï¼æ¯å°æºå¨æ¯ 6 æ ¸ 64g çã\n * æä»¬ es éç¾¤çæ¥å¢éæ°æ®å¤§æ¦æ¯ 2000 ä¸æ¡ï¼æ¯å¤©æ¥å¢éæ°æ®å¤§æ¦æ¯ 500mbï¼æ¯æå¢éæ°æ®å¤§æ¦æ¯ 6 äº¿ï¼15gãç®åç³»ç»å·²ç»è¿è¡äºå ä¸ªæï¼ç°å¨ es éç¾¤éæ°æ®æ»éå¤§æ¦æ¯ 100g å·¦å³ã\n * ç®åçº¿ä¸æ 5 ä¸ªç´¢å¼ï¼è¿ä¸ªç»åä½ ä»¬èªå·±ä¸å¡æ¥ï¼ççèªå·±æåªäºæ°æ®å¯ä»¥æ¾ es çï¼ï¼æ¯ä¸ªç´¢å¼çæ°æ®éå¤§æ¦æ¯ 20gï¼æä»¥è¿ä¸ªæ°æ®éä¹åï¼æä»¬æ¯ä¸ªç´¢å¼åéçæ¯ 8 ä¸ª shardï¼æ¯é»è®¤ç 5 ä¸ª shard å¤äº 3 ä¸ª shardã\n\n\n# elasticsearch éç½®\n\nes çé»è®¤éç½®æä»¶ä¸º config/elasticsearch.yml\n\nåºæ¬éç½®è¯´æå¦ä¸ï¼\n\ncluster.name: elasticsearch\n#éç½®esçéç¾¤åç§°ï¼é»è®¤æ¯elasticsearchï¼esä¼èªå¨åç°å¨åä¸ç½æ®µä¸çesï¼å¦æå¨åä¸ç½æ®µä¸æå¤ä¸ªéç¾¤ï¼å°±å¯ä»¥ç¨è¿ä¸ªå±æ§æ¥åºåä¸åçéç¾¤ã\nnode.name: \'franz kafka\'\n#èç¹åï¼é»è®¤éæºæå®ä¸ä¸ªnameåè¡¨ä¸­åå­ï¼è¯¥åè¡¨å¨esçjaråä¸­configæä»¶å¤¹éname.txtæä»¶ä¸­ï¼å¶ä¸­æå¾å¤ä½èæ·»å çæè¶£åå­ã\nnode.master: true\n#æå®è¯¥èç¹æ¯å¦æèµæ ¼è¢«éä¸¾æä¸ºnodeï¼é»è®¤æ¯trueï¼esæ¯é»è®¤éç¾¤ä¸­çç¬¬ä¸å°æºå¨ä¸ºmasterï¼å¦æè¿å°æºæäºå°±ä¼éæ°éä¸¾masterã\nnode.data: true\n#æå®è¯¥èç¹æ¯å¦å­å¨ç´¢å¼æ°æ®ï¼é»è®¤ä¸ºtrueã\nindex.number_of_shards: 5\n#è®¾ç½®é»è®¤ç´¢å¼åçä¸ªæ°ï¼é»è®¤ä¸º5çã\nindex.number_of_replicas: 1\n#è®¾ç½®é»è®¤ç´¢å¼å¯æ¬ä¸ªæ°ï¼é»è®¤ä¸º1ä¸ªå¯æ¬ã\npath.conf: /path/to/conf\n#è®¾ç½®éç½®æä»¶çå­å¨è·¯å¾ï¼é»è®¤æ¯esæ ¹ç®å½ä¸çconfigæä»¶å¤¹ã\npath.data: /path/to/data\n#è®¾ç½®ç´¢å¼æ°æ®çå­å¨è·¯å¾ï¼é»è®¤æ¯esæ ¹ç®å½ä¸çdataæä»¶å¤¹ï¼å¯ä»¥è®¾ç½®å¤ä¸ªå­å¨è·¯å¾ï¼ç¨éå·éå¼ï¼ä¾ï¼\n#path.data: /path/to/data1,/path/to/data2\npath.work: /path/to/work\n#è®¾ç½®ä¸´æ¶æä»¶çå­å¨è·¯å¾ï¼é»è®¤æ¯esæ ¹ç®å½ä¸çworkæä»¶å¤¹ã\npath.logs: /path/to/logs\n#è®¾ç½®æ¥å¿æä»¶çå­å¨è·¯å¾ï¼é»è®¤æ¯esæ ¹ç®å½ä¸çlogsæä»¶å¤¹\npath.plugins: /path/to/plugins\n#è®¾ç½®æä»¶çå­æ¾è·¯å¾ï¼é»è®¤æ¯esæ ¹ç®å½ä¸çpluginsæä»¶å¤¹\nbootstrap.mlockall: true\n#è®¾ç½®ä¸ºtrueæ¥éä½åå­ãå ä¸ºå½jvmå¼å§swappingæ¶esçæçä¼éä½ï¼æä»¥è¦ä¿è¯å®ä¸swapï¼å¯ä»¥æ#es_min_memåes_max_memä¸¤ä¸ªç¯å¢åéè®¾ç½®æåä¸ä¸ªå¼ï¼å¹¶ä¸ä¿è¯æºå¨æè¶³å¤çåå­åéç»esãåæ¶ä¹è¦#åè®¸elasticsearchçè¿ç¨å¯ä»¥éä½åå­ï¼linuxä¸å¯ä»¥éè¿`ulimit -l unlimited`å½ä»¤ã\nnetwork.bind_host: 192.168.0.1\n#è®¾ç½®ç»å®çipå°åï¼å¯ä»¥æ¯ipv4æipv6çï¼é»è®¤ä¸º0.0.0.0ã\nnetwork.publish_host: 192.168.0.1\n#è®¾ç½®å¶å®èç¹åè¯¥èç¹äº¤äºçipå°åï¼å¦æä¸è®¾ç½®å®ä¼èªå¨å¤æ­ï¼å¼å¿é¡»æ¯ä¸ªçå®çipå°åã\nnetwork.host: 192.168.0.1\n#è¿ä¸ªåæ°æ¯ç¨æ¥åæ¶è®¾ç½®bind_hoståpublish_hostä¸é¢ä¸¤ä¸ªåæ°ã\ntransport.tcp.port: 9300\n#è®¾ç½®èç¹é´äº¤äºçtcpç«¯å£ï¼é»è®¤æ¯9300ã\ntransport.tcp.compress: true\n#è®¾ç½®æ¯å¦åç¼©tcpä¼ è¾æ¶çæ°æ®ï¼é»è®¤ä¸ºfalseï¼ä¸åç¼©ã\nhttp.port: 9200\n#è®¾ç½®å¯¹å¤æå¡çhttpç«¯å£ï¼é»è®¤ä¸º9200ã\nhttp.max_content_length: 100mb\n#è®¾ç½®åå®¹çæå¤§å®¹éï¼é»è®¤100mb\nhttp.enabled: false\n#æ¯å¦ä½¿ç¨httpåè®®å¯¹å¤æä¾æå¡ï¼é»è®¤ä¸ºtrueï¼å¼å¯ã\ngateway.type: local\n#gatewayçç±»åï¼é»è®¤ä¸ºlocalå³ä¸ºæ¬å°æä»¶ç³»ç»ï¼å¯ä»¥è®¾ç½®ä¸ºæ¬å°æä»¶ç³»ç»ï¼åå¸å¼æä»¶ç³»ç»ï¼hadoopç#hdfsï¼åamazonçs3æå¡å¨ï¼å¶å®æä»¶ç³»ç»çè®¾ç½®æ¹æ³ä¸æ¬¡åè¯¦ç»è¯´ã\ngateway.recover_after_nodes: 1\n#è®¾ç½®éç¾¤ä¸­nä¸ªèç¹å¯å¨æ¶è¿è¡æ°æ®æ¢å¤ï¼é»è®¤ä¸º1ã\ngateway.recover_after_time: 5m\n#è®¾ç½®åå§åæ°æ®æ¢å¤è¿ç¨çè¶æ¶æ¶é´ï¼é»è®¤æ¯5åéã\ngateway.expected_nodes: 2\n#è®¾ç½®è¿ä¸ªéç¾¤ä¸­èç¹çæ°éï¼é»è®¤ä¸º2ï¼ä¸æ¦è¿nä¸ªèç¹å¯å¨ï¼å°±ä¼ç«å³è¿è¡æ°æ®æ¢å¤ã\ncluster.routing.allocation.node_initial_primaries_recoveries: 4\n#åå§åæ°æ®æ¢å¤æ¶ï¼å¹¶åæ¢å¤çº¿ç¨çä¸ªæ°ï¼é»è®¤ä¸º4ã\ncluster.routing.allocation.node_concurrent_recoveries: 2\n#æ·»å å é¤èç¹æè´è½½åè¡¡æ¶å¹¶åæ¢å¤çº¿ç¨çä¸ªæ°ï¼é»è®¤ä¸º4ã\nindices.recovery.max_size_per_sec: 0\n#è®¾ç½®æ°æ®æ¢å¤æ¶éå¶çå¸¦å®½ï¼å¦å¥100mbï¼é»è®¤ä¸º0ï¼å³æ éå¶ã\nindices.recovery.concurrent_streams: 5\n#è®¾ç½®è¿ä¸ªåæ°æ¥éå¶ä»å¶å®åçæ¢å¤æ°æ®æ¶æå¤§åæ¶æå¼å¹¶åæµçä¸ªæ°ï¼é»è®¤ä¸º5ã\ndiscovery.zen.minimum_master_nodes: 1\n#è®¾ç½®è¿ä¸ªåæ°æ¥ä¿è¯éç¾¤ä¸­çèç¹å¯ä»¥ç¥éå¶å®nä¸ªæmasterèµæ ¼çèç¹ãé»è®¤ä¸º1ï¼å¯¹äºå¤§çéç¾¤æ¥è¯´ï¼å¯ä»¥è®¾ç½®å¤§ä¸ç¹çå¼ï¼2-4ï¼\ndiscovery.zen.ping.timeout: 3s\n#è®¾ç½®éç¾¤ä¸­èªå¨åç°å¶å®èç¹æ¶pingè¿æ¥è¶æ¶æ¶é´ï¼é»è®¤ä¸º3ç§ï¼å¯¹äºæ¯è¾å·®çç½ç»ç¯å¢å¯ä»¥é«ç¹çå¼æ¥é²æ­¢èªå¨åç°æ¶åºéã\ndiscovery.zen.ping.multicast.enabled: false\n#è®¾ç½®æ¯å¦æå¼å¤æ­åç°èç¹ï¼é»è®¤æ¯trueã\ndiscovery.zen.ping.unicast.hosts: [\'host1\', \'host2:port\', \'host3[portx-porty]\']\n#è®¾ç½®éç¾¤ä¸­masterèç¹çåå§åè¡¨ï¼å¯ä»¥éè¿è¿äºèç¹æ¥èªå¨åç°æ°å å¥éç¾¤çèç¹ã\n\n\n\n# elasticsearch faq\n\n\n# elasticsearch ä¸åè®¸ä»¥ root æéæ¥è¿è¡\n\n**é®é¢ï¼**å¨ linux ç¯å¢ä¸­ï¼elasticsearch ä¸åè®¸ä»¥ root æéæ¥è¿è¡ã\n\nå¦æä»¥ root èº«ä»½è¿è¡ elasticsearchï¼ä¼æç¤ºè¿æ ·çéè¯¯ï¼\n\ncan not run elasticsearch as root\n\n\n**è§£å³æ¹æ³ï¼**ä½¿ç¨é root æéè´¦å·è¿è¡ elasticsearch\n\n# åå»ºç¨æ·ç»\ngroupadd elk\n# åå»ºæ°ç¨æ·ï¼-g elk è®¾ç½®å¶ç¨æ·ç»ä¸º elkï¼-p elk è®¾ç½®å¶å¯ç ä¸º elk\nuseradd elk -g elk -p elk\n# æ´æ¹ /opt æä»¶å¤¹ååé¨æä»¶çæå±ç¨æ·åç»ä¸º elk:elk\nchown -r elk:elk /opt # åè®¾ä½ ç elasticsearch å®è£å¨ opt ç®å½ä¸\n# åæ¢è´¦å·\nsu elk\n\n\n\n# vm.max_map_count ä¸ä½äº 262144\n\né®é¢ï¼vm.max_map_count è¡¨ç¤ºèæåå­å¤§å°ï¼å®æ¯ä¸ä¸ªåæ ¸åæ°ãelasticsearch é»è®¤è¦æ± vm.max_map_count ä¸ä½äº 262144ã\n\nmax virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]\n\n\nè§£å³æ¹æ³ï¼\n\nä½ å¯ä»¥æ§è¡ä»¥ä¸å½ä»¤ï¼è®¾ç½® vm.max_map_count ï¼ä½æ¯éå¯ååä¼æ¢å¤ä¸ºåå¼ã\n\nsysctl -w vm.max_map_count=262144\n\n\næä¹æ§çåæ³æ¯å¨ /etc/sysctl.conf æä»¶ä¸­ä¿®æ¹ vm.max_map_count åæ°ï¼\n\necho "vm.max_map_count=262144" > /etc/sysctl.conf\nsysctl -p\n\n\n> æ³¨æ\n> \n> å¦æè¿è¡ç¯å¢ä¸º docker å®¹å¨ï¼å¯è½ä¼éå¶æ§è¡ sysctl æ¥ä¿®æ¹åæ ¸åæ°ã\n> \n> è¿ç§æåµä¸ï¼ä½ åªè½éæ©ç´æ¥ä¿®æ¹å®¿ä¸»æºä¸çåæ°äºã\n\n\n# nofile ä¸ä½äº 65536\n\né®é¢ï¼ nofile è¡¨ç¤ºè¿ç¨åè®¸æå¼çæå¤§æä»¶æ°ãelasticsearch è¿ç¨è¦æ±å¯ä»¥æå¼çæå¤§æä»¶æ°ä¸ä½äº 65536ã\n\nmax file descriptors [4096] for elasticsearch process is too low, increase to at least [65536]\n\n\nè§£å³æ¹æ³ï¼\n\nå¨ /etc/security/limits.conf æä»¶ä¸­ä¿®æ¹ nofile åæ°ï¼\n\necho "* soft nofile 65536" > /etc/security/limits.conf\necho "* hard nofile 131072" > /etc/security/limits.conf\n\n\n\n# nproc ä¸ä½äº 2048\n\né®é¢ï¼ nproc è¡¨ç¤ºæå¤§çº¿ç¨æ°ãelasticsearch è¦æ±æå¤§çº¿ç¨æ°ä¸ä½äº 2048ã\n\nmax number of threads [1024] for user [user] is too low, increase to at least [2048]\n\n\nè§£å³æ¹æ³ï¼\n\nå¨ /etc/security/limits.conf æä»¶ä¸­ä¿®æ¹ nproc åæ°ï¼\n\necho "* soft nproc 2048" > /etc/security/limits.conf\necho "* hard nproc 4096" > /etc/security/limits.conf\n\n\n\n# åèèµæ\n\n * elasticsearch å®æ¹ä¸è½½å®è£è¯´æ\n * install elasticsearch with rpm\n * elasticsearch ä½¿ç¨ç§¯ç´¯',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Elasticsearch æç¨",frontmatter:{title:"Elasticsearch æç¨",date:"2022-04-11T16:52:35.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],permalink:"/pages/74675e/",hidden:!0},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/README.md",key:"v-2c1e440a",path:"/pages/74675e/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:128},{level:3,title:"Elasticsearch é¢è¯æ»ç» ð¯",slug:"elasticsearch-é¢è¯æ»ç»-ð¯",normalizedTitle:"elasticsearch é¢è¯æ»ç» ð¯",charIndex:138},{level:3,title:"Elasticsearch å¿«éå¥é¨",slug:"elasticsearch-å¿«éå¥é¨",normalizedTitle:"elasticsearch å¿«éå¥é¨",charIndex:164},{level:3,title:"Elasticsearch ç®ä»",slug:"elasticsearch-ç®ä»",normalizedTitle:"elasticsearch ç®ä»",charIndex:187},{level:3,title:"Elasticsearch ç´¢å¼ç®¡ç",slug:"elasticsearch-ç´¢å¼ç®¡ç",normalizedTitle:"elasticsearch ç´¢å¼ç®¡ç",charIndex:208},{level:3,title:"Elasticsearch æ å°",slug:"elasticsearch-æ å°",normalizedTitle:"elasticsearch æ å°",charIndex:231},{level:3,title:"Elasticsearch æ¥è¯¢",slug:"elasticsearch-æ¥è¯¢",normalizedTitle:"elasticsearch æ¥è¯¢",charIndex:252},{level:3,title:"Elasticsearch é«äº®",slug:"elasticsearch-é«äº®",normalizedTitle:"elasticsearch é«äº®",charIndex:273},{level:3,title:"Elasticsearch æåº",slug:"elasticsearch-æåº",normalizedTitle:"elasticsearch æåº",charIndex:294},{level:3,title:"Elasticsearch èå",slug:"elasticsearch-èå",normalizedTitle:"elasticsearch èå",charIndex:315},{level:3,title:"Elasticsearch åæå¨",slug:"elasticsearch-åæå¨",normalizedTitle:"elasticsearch åæå¨",charIndex:336},{level:3,title:"Elasticsearch æ§è½ä¼å",slug:"elasticsearch-æ§è½ä¼å",normalizedTitle:"elasticsearch æ§è½ä¼å",charIndex:358},{level:3,title:"Elasticsearch Rest API",slug:"elasticsearch-rest-api",normalizedTitle:"elasticsearch rest api",charIndex:381},{level:3,title:"ElasticSearch Java API ä¹ High Level REST Client",slug:"elasticsearch-java-api-ä¹-high-level-rest-client",normalizedTitle:"elasticsearch java api ä¹ high level rest client",charIndex:408},{level:3,title:"Elasticsearch éç¾¤ååç",slug:"elasticsearch-éç¾¤ååç",normalizedTitle:"elasticsearch éç¾¤ååç",charIndex:460},{level:3,title:"Elasticsearch è¿ç»´",slug:"elasticsearch-è¿ç»´",normalizedTitle:"elasticsearch è¿ç»´",charIndex:484},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:505},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:1107}],headersStr:"ð åå®¹ Elasticsearch é¢è¯æ»ç» ð¯ Elasticsearch å¿«éå¥é¨ Elasticsearch ç®ä» Elasticsearch ç´¢å¼ç®¡ç Elasticsearch æ å° Elasticsearch æ¥è¯¢ Elasticsearch é«äº® Elasticsearch æåº Elasticsearch èå Elasticsearch åæå¨ Elasticsearch æ§è½ä¼å Elasticsearch Rest API ElasticSearch Java API ä¹ High Level REST Client Elasticsearch éç¾¤ååç Elasticsearch è¿ç»´ ð èµæ ðª ä¼ é",content:"# Elasticsearch æç¨\n\n> Elasticsearch æ¯ä¸ä¸ªåºäº Lucene çæç´¢åæ°æ®åæå·¥å·ï¼å®æä¾äºä¸ä¸ªåå¸å¼æå¡ãElasticsearch æ¯éµä» Apache å¼æºæ¡æ¬¾çä¸æ¬¾å¼æºäº§åï¼æ¯å½åä¸»æµçä¼ä¸çº§æç´¢å¼æã\n\n\n# ð åå®¹\n\n\n# Elasticsearch é¢è¯æ»ç» ð¯\n\n\n# Elasticsearch å¿«éå¥é¨\n\n\n# Elasticsearch ç®ä»\n\n\n# Elasticsearch ç´¢å¼ç®¡ç\n\n\n# Elasticsearch æ å°\n\n\n# Elasticsearch æ¥è¯¢\n\n\n# Elasticsearch é«äº®\n\n\n# Elasticsearch æåº\n\n\n# Elasticsearch èå\n\n\n# Elasticsearch åæå¨\n\n\n# Elasticsearch æ§è½ä¼å\n\n\n# Elasticsearch Rest API\n\n\n# ElasticSearch Java API ä¹ High Level REST Client\n\n\n# Elasticsearch éç¾¤ååç\n\n\n# Elasticsearch è¿ç»´\n\n\n# ð èµæ\n\n * å®æ¹\n   * Elasticsearch å®ç½\n   * Elasticsearch Github\n   * Elasticsearch å®æ¹ææ¡£\n   * Elasticsearch: The Definitive Guide - ElasticSearch å®æ¹å­¦ä¹ èµæ\n * ä¹¦ç±\n   * ãElasticsearch å®æã\n * æç¨\n   * ELK Stack æå¨æå\n   * Elasticsearch æç¨\n * æç« \n   * Elasticsearch+Logstash+Kibana æç¨\n   * ELKï¼ElasticsearchãLogstashãKibanaï¼å®è£åéç½®\n   * æ§è½è°ä¼ç¸å³çå·¥ç¨å®è·µ\n     * Elasticsearch Performance Tuning Practice at eBay\n     * Elasticsearch at Kickstarter\n     * 9 tips on ElasticSearch configuration for high performance\n     * Elasticsearch In Productionâ-âDeployment Best Practices\n * æ´å¤èµæº\n   * GitHub: Awesome ElasticSearch\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç IT ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",normalizedContent:"# elasticsearch æç¨\n\n> elasticsearch æ¯ä¸ä¸ªåºäº lucene çæç´¢åæ°æ®åæå·¥å·ï¼å®æä¾äºä¸ä¸ªåå¸å¼æå¡ãelasticsearch æ¯éµä» apache å¼æºæ¡æ¬¾çä¸æ¬¾å¼æºäº§åï¼æ¯å½åä¸»æµçä¼ä¸çº§æç´¢å¼æã\n\n\n# ð åå®¹\n\n\n# elasticsearch é¢è¯æ»ç» ð¯\n\n\n# elasticsearch å¿«éå¥é¨\n\n\n# elasticsearch ç®ä»\n\n\n# elasticsearch ç´¢å¼ç®¡ç\n\n\n# elasticsearch æ å°\n\n\n# elasticsearch æ¥è¯¢\n\n\n# elasticsearch é«äº®\n\n\n# elasticsearch æåº\n\n\n# elasticsearch èå\n\n\n# elasticsearch åæå¨\n\n\n# elasticsearch æ§è½ä¼å\n\n\n# elasticsearch rest api\n\n\n# elasticsearch java api ä¹ high level rest client\n\n\n# elasticsearch éç¾¤ååç\n\n\n# elasticsearch è¿ç»´\n\n\n# ð èµæ\n\n * å®æ¹\n   * elasticsearch å®ç½\n   * elasticsearch github\n   * elasticsearch å®æ¹ææ¡£\n   * elasticsearch: the definitive guide - elasticsearch å®æ¹å­¦ä¹ èµæ\n * ä¹¦ç±\n   * ãelasticsearch å®æã\n * æç¨\n   * elk stack æå¨æå\n   * elasticsearch æç¨\n * æç« \n   * elasticsearch+logstash+kibana æç¨\n   * elkï¼elasticsearchãlogstashãkibanaï¼å®è£åéç½®\n   * æ§è½è°ä¼ç¸å³çå·¥ç¨å®è·µ\n     * elasticsearch performance tuning practice at ebay\n     * elasticsearch at kickstarter\n     * 9 tips on elasticsearch configuration for high performance\n     * elasticsearch in productionâ-âdeployment best practices\n * æ´å¤èµæº\n   * github: awesome elasticsearch\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç it ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Elastic ææ¯æ ä¹ Filebeat",frontmatter:{title:"Elastic ææ¯æ ä¹ Filebeat",date:"2020-06-16T07:10:44.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic","Filebeat"],permalink:"/pages/b7f079/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/02.Elastic/02.Elastic%E6%8A%80%E6%9C%AF%E6%A0%88%E4%B9%8BFilebeat.html",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/02.Elastic/02.Elasticææ¯æ ä¹Filebeat.md",key:"v-ec0e4a94",path:"/pages/b7f079/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:28},{level:3,title:"FileBeat çä½ç¨",slug:"filebeat-çä½ç¨",normalizedTitle:"filebeat çä½ç¨",charIndex:421},{level:2,title:"å®è£",slug:"å®è£",normalizedTitle:"å®è£",charIndex:39},{level:2,title:"éç½®",slug:"éç½®",normalizedTitle:"éç½®",charIndex:963},{level:3,title:"éç½®æä»¶",slug:"éç½®æä»¶",normalizedTitle:"éç½®æä»¶",charIndex:970},{level:3,title:"éè¦éç½®é¡¹",slug:"éè¦éç½®é¡¹",normalizedTitle:"éè¦éç½®é¡¹",charIndex:1346},{level:4,title:"filebeat.prospectors",slug:"filebeat-prospectors",normalizedTitle:"filebeat.prospectors",charIndex:1355},{level:4,title:"output.elasticsearch",slug:"output-elasticsearch",normalizedTitle:"output.elasticsearch",charIndex:1494},{level:4,title:"output.logstash",slug:"output-logstash",normalizedTitle:"output.logstash",charIndex:1646},{level:4,title:"setup.kibana",slug:"setup-kibana",normalizedTitle:"setup.kibana",charIndex:2432},{level:4,title:"setup.template.settings",slug:"setup-template-settings",normalizedTitle:"setup.template.settings",charIndex:2545},{level:4,title:"setup.dashboards",slug:"setup-dashboards",normalizedTitle:"setup.dashboards",charIndex:2925},{level:2,title:"å½ä»¤",slug:"å½ä»¤",normalizedTitle:"å½ä»¤",charIndex:589},{level:2,title:"æ¨¡å",slug:"æ¨¡å",normalizedTitle:"æ¨¡å",charIndex:543},{level:3,title:"è¿è¡æ¨¡åçæ­¥éª¤",slug:"è¿è¡æ¨¡åçæ­¥éª¤",normalizedTitle:"è¿è¡æ¨¡åçæ­¥éª¤",charIndex:3647},{level:2,title:"åç",slug:"åç",normalizedTitle:"åç",charIndex:4094},{level:2,title:"èµæ",slug:"èµæ",normalizedTitle:"èµæ",charIndex:4482}],headersStr:"ç®ä» FileBeat çä½ç¨ å®è£ éç½® éç½®æä»¶ éè¦éç½®é¡¹ filebeat.prospectors output.elasticsearch output.logstash setup.kibana setup.template.settings setup.dashboards å½ä»¤ æ¨¡å è¿è¡æ¨¡åçæ­¥éª¤ åç èµæ",content:'# Elastic ææ¯æ ä¹ Filebeat\n\n\n# ç®ä»\n\nBeats æ¯å®è£å¨æå¡å¨ä¸çæ°æ®ä¸­è½¬ä»£çã\n\nBeats å¯ä»¥å°æ°æ®ç´æ¥ä¼ è¾å° Elasticsearch æä¼ è¾å° Logstash ã\n\n\n\nBeats æå¤ç§ç±»åï¼å¯ä»¥æ ¹æ®å®éåºç¨éè¦éæ©åéçç±»åã\n\nå¸¸ç¨çç±»åæï¼\n\n * **Packetbeatï¼**ç½ç»æ°æ®ååæå¨ï¼æä¾æå³æ¨çåºç¨ç¨åºæå¡å¨ä¹é´äº¤æ¢çäºå¡çä¿¡æ¯ã\n * **Filebeatï¼**ä»æ¨çæå¡å¨åéæ¥å¿æä»¶ã\n * **Metricbeatï¼**æ¯ä¸ä¸ªæå¡å¨çè§ä»£çç¨åºï¼å®å®æä»æå¡å¨ä¸è¿è¡çæä½ç³»ç»åæå¡æ¶éææ ã\n * **Winlogbeatï¼**æä¾ Windows äºä»¶æ¥å¿ã\n\n> åè\n> \n> æ´å¤ Beats ç±»åå¯ä»¥åèï¼community-beats\n> \n> è¯´æ\n> \n> ç±äºæ¬äººå·¥ä½ä¸­åªåºç¨äº FileBeatï¼æä»¥åé¢åå®¹ä»ä»ç» FileBeat ã\n\n\n# FileBeat çä½ç¨\n\nç¸æ¯ Logstashï¼FileBeat æ´å è½»éåã\n\nå¨ä»»ä½ç¯å¢ä¸ï¼åºç¨ç¨åºé½æåæºçå¯è½æ§ã Filebeat è¯»åå¹¶è½¬åæ¥å¿è¡ï¼å¦æä¸­æ­ï¼åä¼è®°ä½ææäºä»¶æ¢å¤èæºç¶ææ¶æå¨ä½ç½®ã\n\nFilebeat å¸¦æåé¨æ¨¡åï¼auditdï¼Apacheï¼Nginxï¼System å MySQLï¼ï¼å¯éè¿ä¸ä¸ªæå®å½ä»¤æ¥ç®åéç¨æ¥å¿æ ¼å¼çæ¶éï¼è§£æåå¯è§åã\n\nFileBeat ä¸ä¼è®©ä½ çç®¡éè¶è´è·ãFileBeat å¦ææ¯å Logstash ä¼ è¾æ°æ®ï¼å½ Logstash å¿äºå¤çæ°æ®ï¼ä¼éç¥ FileBeat æ¾æ¢è¯»åéåº¦ãä¸æ¦æ¥å¡å¾å°è§£å³ï¼FileBeat å°æ¢å¤å°åæ¥çéåº¦å¹¶ç»§ç»­ä¼ æ­ã\n\n\n\n\n# å®è£\n\nUnix / Linux ç³»ç»å»ºè®®ä½¿ç¨ä¸é¢æ¹å¼å®è£ï¼å ä¸ºæ¯è¾éç¨ã\n\nwget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.1.1-linux-x86_64.tar.gz\ntar -zxf filebeat-6.1.1-linux-x86_64.tar.gz\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼filebeat-installation\n\n\n# éç½®\n\n\n# éç½®æä»¶\n\né¦åï¼éè¦ç¥éçæ¯ï¼filebeat.yml æ¯ filebeat çéç½®æä»¶ãéç½®æä»¶çè·¯å¾ä¼å ä¸ºä½ å®è£æ¹å¼çä¸åèååã\n\nBeat ææç³»åäº§åçéç½®æä»¶é½åºäº YAML æ ¼å¼ï¼FileBeat å½ç¶ä¹ä¸ä¾å¤ã\n\nfilebeat.yml é¨åéç½®ç¤ºä¾ï¼\n\nfilebeat:\n  prospectors:\n    - type: log\n      paths:\n        - /var/log/*.log\n      multiline:\n        pattern: \'^[\'\n        match: after\n\n\n> åè\n> \n> æ´å¤ filebeat éç½®åå®¹å¯ä»¥åèï¼éç½® filebeat\n> \n> æ´å¤ filebeat.yml æä»¶æ ¼å¼åå®¹å¯ä»¥åèï¼filebeat.yml æä»¶æ ¼å¼\n\n\n# éè¦éç½®é¡¹\n\n# filebeat.prospectors\n\nï¼æä»¶çè§å¨ï¼ç¨äºæå®éè¦å³æ³¨çæä»¶ã\n\nç¤ºä¾\n\nfilebeat.prospectors:\n  - type: log\n    enabled: true\n    paths:\n      - /var/log/*.log\n\n\n# output.elasticsearch\n\nå¦æä½ å¸æä½¿ç¨ filebeat ç´æ¥å elasticsearch è¾åºæ°æ®ï¼éè¦éç½® output.elasticsearch ã\n\nç¤ºä¾\n\noutput.elasticsearch:\n  hosts: [\'192.168.1.42:9200\']\n\n\n# output.logstash\n\nå¦æä½ å¸æä½¿ç¨ filebeat å logstash è¾åºæ°æ®ï¼ç¶åç± logstash åå elasticsearch è¾åºæ°æ®ï¼éè¦éç½® output.logstashã\n\n> æ³¨æ\n> \n> ç¸æ¯äºå elasticsearch è¾åºæ°æ®ï¼ä¸ªäººæ´æ¨èå logstash è¾åºæ°æ®ã\n> \n> å ä¸º logstash å filebeat ä¸èµ·å·¥ä½æ¶ï¼å¦æ logstash å¿äºå¤çæ°æ®ï¼ä¼éç¥ FileBeat æ¾æ¢è¯»åéåº¦ãä¸æ¦æ¥å¡å¾å°è§£å³ï¼FileBeat å°æ¢å¤å°åæ¥çéåº¦å¹¶ç»§ç»­ä¼ æ­ãè¿æ ·ï¼å¯ä»¥åå°ç®¡éè¶è´è·çæåµã\n\nç¤ºä¾\n\noutput.logstash:\n  hosts: [\'127.0.0.1:5044\']\n\n\næ­¤å¤ï¼è¿éè¦å¨ logstash çéç½®æä»¶ï¼å¦ logstash.confï¼ä¸­æå® beats input æä»¶ï¼\n\ninput {\n  beats {\n    port => 5044 # æ­¤ç«¯å£éè¦ä¸ filebeat.yml ä¸­çç«¯å£ç¸å\n  }\n}\n\n# The filter part of this file is commented out to indicate that it is\n# optional.\n# filter {\n#\n# }\n\noutput {\n  elasticsearch {\n    hosts => "localhost:9200"\n    manage_template => false\n    index => "%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}"\n    document_type => "%{[@metadata][type]}"\n  }\n}\n\n\n# setup.kibana\n\nå¦ææç®ä½¿ç¨ Filebeat æä¾ç Kibana ä»ªè¡¨æ¿ï¼éè¦éç½® setup.kibana ã\n\nç¤ºä¾\n\nsetup.kibana:\n  host: \'localhost:5601\'\n\n\n# setup.template.settings\n\nå¨ Elasticsearch ä¸­ï¼ç´¢å¼æ¨¡æ¿ç¨äºå®ä¹è®¾ç½®åæ å°ï¼ä»¥ç¡®å®å¦ä½åæå­æ®µã\n\nå¨ Filebeat ä¸­ï¼setup.template.settings ç¨äºéç½®ç´¢å¼æ¨¡æ¿ã\n\nFilebeat æ¨èçç´¢å¼æ¨¡æ¿æä»¶ç± Filebeat è½¯ä»¶åå®è£ãå¦ææ¨æ¥å filebeat.yml éç½®æä»¶ä¸­çé»è®¤éç½®ï¼Filebeat å¨æåè¿æ¥å° Elasticsearch åèªå¨å è½½æ¨¡æ¿ã\n\næ¨å¯ä»¥éè¿å¨ Filebeat éç½®æä»¶ä¸­éç½®æ¨¡æ¿å è½½éé¡¹æ¥ç¦ç¨èªå¨æ¨¡æ¿å è½½ï¼æå è½½èªå·±çæ¨¡æ¿ãæ¨è¿å¯ä»¥è®¾ç½®éé¡¹æ¥æ´æ¹ç´¢å¼åç´¢å¼æ¨¡æ¿çåç§°ã\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼filebeat-template\n> \n> è¯´æ\n> \n> å¦æ å¿è¦ï¼ä½¿ç¨ Filebeat éç½®æä»¶ä¸­çé»è®¤ç´¢å¼æ¨¡æ¿å³å¯ã\n\n# setup.dashboards\n\nFilebeat éå¸¦äºç¤ºä¾ Kibana ä»ªè¡¨æ¿ãå¨ä½¿ç¨ä»ªè¡¨æ¿ä¹åï¼æ¨éè¦åå»ºç´¢å¼æ¨¡å¼ filebeat- *ï¼å¹¶å°ä»ªè¡¨æ¿å è½½å° Kibana ä¸­ãä¸ºæ­¤ï¼æ¨å¯ä»¥è¿è¡ setup å½ä»¤æå¨ filebeat.yml éç½®æä»¶ä¸­éç½®ä»ªè¡¨æ¿å è½½ã\n\nä¸ºäºå¨ Kibana ä¸­å è½½ Filebeat çä»ªè¡¨çï¼éè¦å¨ filebeat.yml éç½®ä¸­å¯å¨å¼å³ï¼\n\nsetup.dashboards.enabled: true\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼configuration-dashboards\n\n\n# å½ä»¤\n\nfilebeat æä¾äºä¸ç³»åå½ä»¤æ¥å®æåç§åè½ã\n\næ§è¡å½ä»¤æ¹å¼ï¼\n\n./filebeat COMMAND\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼command-line-options\n> \n> è¯´æ\n> \n> ä¸ªäººè®¤ä¸ºå½ä»¤è¡æ²¡æå¿è¦ä¸ä¸ææ¡ï¼å ä¸ºç»å¤§é¨ååè½é½å¯ä»¥éè¿éç½®æ¥å®æãä¸éè¿å½ä»¤è¡æå®åè½è¿ç§æ¹å¼è¦æ±æ¯æ¬¡è¾å¥åæ ·åæ°ï¼ä¸å©äºåºåå¯å¨æ¹å¼ã\n> \n> æéè¦çå½ç¶æ¯å¯å¨å½ä»¤ run äºã\n> \n> ç¤ºä¾ æå®éç½®æä»¶å¯å¨\n> \n> ./filebeat run -e -c filebeat.yml -d "publish"\n> ./filebeat -e -c filebeat.yml -d "publish" # run å¯ä»¥çç¥\n\n\n# æ¨¡å\n\nFilebeat æä¾äºä¸å¥é¢æå»ºçæ¨¡åï¼è®©æ¨å¯ä»¥å¿«éå®æ½åé¨ç½²æ¥å¿çè§è§£å³æ¹æ¡ï¼å¹¶éå¸¦ç¤ºä¾ä»ªè¡¨æ¿åæ°æ®å¯è§åãè¿äºæ¨¡åæ¯æå¸¸è§çæ¥å¿æ ¼å¼ï¼ä¾å¦ Nginxï¼Apache2 å MySQL ç­ã\n\n\n# è¿è¡æ¨¡åçæ­¥éª¤\n\n * éç½® elasticsearch å kibana\n\noutput.elasticsearch:\n  hosts: ["myEShost:9200"]\n  username: "elastic"\n  password: "elastic"\nsetup.kibana:\n  host: "mykibanahost:5601"\n  username: "elastic"\n  password: "elastic\n\n\n> username å password æ¯å¯éçï¼å¦æä¸éè¦è®¤è¯åä¸å¡«ã\n\n * åå§åç¯å¢\n\næ§è¡ä¸é¢å½ä»¤ï¼filebeat ä¼å è½½æ¨èç´¢å¼æ¨¡æ¿ã\n\n./filebeat setup -e\n\n\n * æå®æ¨¡å\n\næ§è¡ä¸é¢å½ä»¤ï¼æå®å¸æå è½½çæ¨¡åã\n\n./filebeat -e --modules system,nginx,mysql\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼ éç½® filebeat æ¨¡å | filebeat æ¯ææ¨¡å\n\n\n# åç\n\nFilebeat æä¸¤ä¸ªä¸»è¦ç»ä»¶ï¼\n\nharvesterï¼è´è´£è¯»åä¸ä¸ªæä»¶çåå®¹ãå®ä¼éè¡è¯»åæä»¶åå®¹ï¼å¹¶å°åå®¹åéå°è¾åºç®çå°ã\n\nprospectorï¼è´è´£ç®¡ç harvester å¹¶æ¾å°ææéè¦è¯»åçæä»¶æºãæ¯å¦ç±»åæ¯æ¥å¿ï¼prospector å°±ä¼éåå¶å®è·¯å¾ä¸çææå¹éè¦æ±çæä»¶ã\n\nfilebeat.prospectors:\n  - type: log\n    paths:\n      - /var/log/*.log\n      - /var/path2/*.log\n\n\nFilebeat ä¿ææ¯ä¸ªæä»¶çç¶æï¼å¹¶ç»å¸¸å·æ°æ³¨åè¡¨æä»¶ä¸­çç£çç¶æãç¶æç¨äºè®°ä½ harvester æ­£å¨è¯»åçæååç§»éï¼å¹¶ç¡®ä¿åéæææ¥å¿è¡ã\n\nFilebeat å°æ¯ä¸ªäºä»¶çä¼ éç¶æå­å¨å¨æ³¨åè¡¨æä»¶ä¸­ãæä»¥å®è½ä¿è¯äºä»¶è³å°ä¼ éä¸æ¬¡å°éç½®çè¾åºï¼æ²¡ææ°æ®ä¸¢å¤±ã\n\n\n# èµæ\n\nBeats å®æ¹ææ¡£',normalizedContent:'# elastic ææ¯æ ä¹ filebeat\n\n\n# ç®ä»\n\nbeats æ¯å®è£å¨æå¡å¨ä¸çæ°æ®ä¸­è½¬ä»£çã\n\nbeats å¯ä»¥å°æ°æ®ç´æ¥ä¼ è¾å° elasticsearch æä¼ è¾å° logstash ã\n\n\n\nbeats æå¤ç§ç±»åï¼å¯ä»¥æ ¹æ®å®éåºç¨éè¦éæ©åéçç±»åã\n\nå¸¸ç¨çç±»åæï¼\n\n * **packetbeatï¼**ç½ç»æ°æ®ååæå¨ï¼æä¾æå³æ¨çåºç¨ç¨åºæå¡å¨ä¹é´äº¤æ¢çäºå¡çä¿¡æ¯ã\n * **filebeatï¼**ä»æ¨çæå¡å¨åéæ¥å¿æä»¶ã\n * **metricbeatï¼**æ¯ä¸ä¸ªæå¡å¨çè§ä»£çç¨åºï¼å®å®æä»æå¡å¨ä¸è¿è¡çæä½ç³»ç»åæå¡æ¶éææ ã\n * **winlogbeatï¼**æä¾ windows äºä»¶æ¥å¿ã\n\n> åè\n> \n> æ´å¤ beats ç±»åå¯ä»¥åèï¼community-beats\n> \n> è¯´æ\n> \n> ç±äºæ¬äººå·¥ä½ä¸­åªåºç¨äº filebeatï¼æä»¥åé¢åå®¹ä»ä»ç» filebeat ã\n\n\n# filebeat çä½ç¨\n\nç¸æ¯ logstashï¼filebeat æ´å è½»éåã\n\nå¨ä»»ä½ç¯å¢ä¸ï¼åºç¨ç¨åºé½æåæºçå¯è½æ§ã filebeat è¯»åå¹¶è½¬åæ¥å¿è¡ï¼å¦æä¸­æ­ï¼åä¼è®°ä½ææäºä»¶æ¢å¤èæºç¶ææ¶æå¨ä½ç½®ã\n\nfilebeat å¸¦æåé¨æ¨¡åï¼auditdï¼apacheï¼nginxï¼system å mysqlï¼ï¼å¯éè¿ä¸ä¸ªæå®å½ä»¤æ¥ç®åéç¨æ¥å¿æ ¼å¼çæ¶éï¼è§£æåå¯è§åã\n\nfilebeat ä¸ä¼è®©ä½ çç®¡éè¶è´è·ãfilebeat å¦ææ¯å logstash ä¼ è¾æ°æ®ï¼å½ logstash å¿äºå¤çæ°æ®ï¼ä¼éç¥ filebeat æ¾æ¢è¯»åéåº¦ãä¸æ¦æ¥å¡å¾å°è§£å³ï¼filebeat å°æ¢å¤å°åæ¥çéåº¦å¹¶ç»§ç»­ä¼ æ­ã\n\n\n\n\n# å®è£\n\nunix / linux ç³»ç»å»ºè®®ä½¿ç¨ä¸é¢æ¹å¼å®è£ï¼å ä¸ºæ¯è¾éç¨ã\n\nwget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.1.1-linux-x86_64.tar.gz\ntar -zxf filebeat-6.1.1-linux-x86_64.tar.gz\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼filebeat-installation\n\n\n# éç½®\n\n\n# éç½®æä»¶\n\né¦åï¼éè¦ç¥éçæ¯ï¼filebeat.yml æ¯ filebeat çéç½®æä»¶ãéç½®æä»¶çè·¯å¾ä¼å ä¸ºä½ å®è£æ¹å¼çä¸åèååã\n\nbeat ææç³»åäº§åçéç½®æä»¶é½åºäº yaml æ ¼å¼ï¼filebeat å½ç¶ä¹ä¸ä¾å¤ã\n\nfilebeat.yml é¨åéç½®ç¤ºä¾ï¼\n\nfilebeat:\n  prospectors:\n    - type: log\n      paths:\n        - /var/log/*.log\n      multiline:\n        pattern: \'^[\'\n        match: after\n\n\n> åè\n> \n> æ´å¤ filebeat éç½®åå®¹å¯ä»¥åèï¼éç½® filebeat\n> \n> æ´å¤ filebeat.yml æä»¶æ ¼å¼åå®¹å¯ä»¥åèï¼filebeat.yml æä»¶æ ¼å¼\n\n\n# éè¦éç½®é¡¹\n\n# filebeat.prospectors\n\nï¼æä»¶çè§å¨ï¼ç¨äºæå®éè¦å³æ³¨çæä»¶ã\n\nç¤ºä¾\n\nfilebeat.prospectors:\n  - type: log\n    enabled: true\n    paths:\n      - /var/log/*.log\n\n\n# output.elasticsearch\n\nå¦æä½ å¸æä½¿ç¨ filebeat ç´æ¥å elasticsearch è¾åºæ°æ®ï¼éè¦éç½® output.elasticsearch ã\n\nç¤ºä¾\n\noutput.elasticsearch:\n  hosts: [\'192.168.1.42:9200\']\n\n\n# output.logstash\n\nå¦æä½ å¸æä½¿ç¨ filebeat å logstash è¾åºæ°æ®ï¼ç¶åç± logstash åå elasticsearch è¾åºæ°æ®ï¼éè¦éç½® output.logstashã\n\n> æ³¨æ\n> \n> ç¸æ¯äºå elasticsearch è¾åºæ°æ®ï¼ä¸ªäººæ´æ¨èå logstash è¾åºæ°æ®ã\n> \n> å ä¸º logstash å filebeat ä¸èµ·å·¥ä½æ¶ï¼å¦æ logstash å¿äºå¤çæ°æ®ï¼ä¼éç¥ filebeat æ¾æ¢è¯»åéåº¦ãä¸æ¦æ¥å¡å¾å°è§£å³ï¼filebeat å°æ¢å¤å°åæ¥çéåº¦å¹¶ç»§ç»­ä¼ æ­ãè¿æ ·ï¼å¯ä»¥åå°ç®¡éè¶è´è·çæåµã\n\nç¤ºä¾\n\noutput.logstash:\n  hosts: [\'127.0.0.1:5044\']\n\n\næ­¤å¤ï¼è¿éè¦å¨ logstash çéç½®æä»¶ï¼å¦ logstash.confï¼ä¸­æå® beats input æä»¶ï¼\n\ninput {\n  beats {\n    port => 5044 # æ­¤ç«¯å£éè¦ä¸ filebeat.yml ä¸­çç«¯å£ç¸å\n  }\n}\n\n# the filter part of this file is commented out to indicate that it is\n# optional.\n# filter {\n#\n# }\n\noutput {\n  elasticsearch {\n    hosts => "localhost:9200"\n    manage_template => false\n    index => "%{[@metadata][beat]}-%{[@metadata][version]}-%{+yyyy.mm.dd}"\n    document_type => "%{[@metadata][type]}"\n  }\n}\n\n\n# setup.kibana\n\nå¦ææç®ä½¿ç¨ filebeat æä¾ç kibana ä»ªè¡¨æ¿ï¼éè¦éç½® setup.kibana ã\n\nç¤ºä¾\n\nsetup.kibana:\n  host: \'localhost:5601\'\n\n\n# setup.template.settings\n\nå¨ elasticsearch ä¸­ï¼ç´¢å¼æ¨¡æ¿ç¨äºå®ä¹è®¾ç½®åæ å°ï¼ä»¥ç¡®å®å¦ä½åæå­æ®µã\n\nå¨ filebeat ä¸­ï¼setup.template.settings ç¨äºéç½®ç´¢å¼æ¨¡æ¿ã\n\nfilebeat æ¨èçç´¢å¼æ¨¡æ¿æä»¶ç± filebeat è½¯ä»¶åå®è£ãå¦ææ¨æ¥å filebeat.yml éç½®æä»¶ä¸­çé»è®¤éç½®ï¼filebeat å¨æåè¿æ¥å° elasticsearch åèªå¨å è½½æ¨¡æ¿ã\n\næ¨å¯ä»¥éè¿å¨ filebeat éç½®æä»¶ä¸­éç½®æ¨¡æ¿å è½½éé¡¹æ¥ç¦ç¨èªå¨æ¨¡æ¿å è½½ï¼æå è½½èªå·±çæ¨¡æ¿ãæ¨è¿å¯ä»¥è®¾ç½®éé¡¹æ¥æ´æ¹ç´¢å¼åç´¢å¼æ¨¡æ¿çåç§°ã\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼filebeat-template\n> \n> è¯´æ\n> \n> å¦æ å¿è¦ï¼ä½¿ç¨ filebeat éç½®æä»¶ä¸­çé»è®¤ç´¢å¼æ¨¡æ¿å³å¯ã\n\n# setup.dashboards\n\nfilebeat éå¸¦äºç¤ºä¾ kibana ä»ªè¡¨æ¿ãå¨ä½¿ç¨ä»ªè¡¨æ¿ä¹åï¼æ¨éè¦åå»ºç´¢å¼æ¨¡å¼ filebeat- *ï¼å¹¶å°ä»ªè¡¨æ¿å è½½å° kibana ä¸­ãä¸ºæ­¤ï¼æ¨å¯ä»¥è¿è¡ setup å½ä»¤æå¨ filebeat.yml éç½®æä»¶ä¸­éç½®ä»ªè¡¨æ¿å è½½ã\n\nä¸ºäºå¨ kibana ä¸­å è½½ filebeat çä»ªè¡¨çï¼éè¦å¨ filebeat.yml éç½®ä¸­å¯å¨å¼å³ï¼\n\nsetup.dashboards.enabled: true\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼configuration-dashboards\n\n\n# å½ä»¤\n\nfilebeat æä¾äºä¸ç³»åå½ä»¤æ¥å®æåç§åè½ã\n\næ§è¡å½ä»¤æ¹å¼ï¼\n\n./filebeat command\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼command-line-options\n> \n> è¯´æ\n> \n> ä¸ªäººè®¤ä¸ºå½ä»¤è¡æ²¡æå¿è¦ä¸ä¸ææ¡ï¼å ä¸ºç»å¤§é¨ååè½é½å¯ä»¥éè¿éç½®æ¥å®æãä¸éè¿å½ä»¤è¡æå®åè½è¿ç§æ¹å¼è¦æ±æ¯æ¬¡è¾å¥åæ ·åæ°ï¼ä¸å©äºåºåå¯å¨æ¹å¼ã\n> \n> æéè¦çå½ç¶æ¯å¯å¨å½ä»¤ run äºã\n> \n> ç¤ºä¾ æå®éç½®æä»¶å¯å¨\n> \n> ./filebeat run -e -c filebeat.yml -d "publish"\n> ./filebeat -e -c filebeat.yml -d "publish" # run å¯ä»¥çç¥\n\n\n# æ¨¡å\n\nfilebeat æä¾äºä¸å¥é¢æå»ºçæ¨¡åï¼è®©æ¨å¯ä»¥å¿«éå®æ½åé¨ç½²æ¥å¿çè§è§£å³æ¹æ¡ï¼å¹¶éå¸¦ç¤ºä¾ä»ªè¡¨æ¿åæ°æ®å¯è§åãè¿äºæ¨¡åæ¯æå¸¸è§çæ¥å¿æ ¼å¼ï¼ä¾å¦ nginxï¼apache2 å mysql ç­ã\n\n\n# è¿è¡æ¨¡åçæ­¥éª¤\n\n * éç½® elasticsearch å kibana\n\noutput.elasticsearch:\n  hosts: ["myeshost:9200"]\n  username: "elastic"\n  password: "elastic"\nsetup.kibana:\n  host: "mykibanahost:5601"\n  username: "elastic"\n  password: "elastic\n\n\n> username å password æ¯å¯éçï¼å¦æä¸éè¦è®¤è¯åä¸å¡«ã\n\n * åå§åç¯å¢\n\næ§è¡ä¸é¢å½ä»¤ï¼filebeat ä¼å è½½æ¨èç´¢å¼æ¨¡æ¿ã\n\n./filebeat setup -e\n\n\n * æå®æ¨¡å\n\næ§è¡ä¸é¢å½ä»¤ï¼æå®å¸æå è½½çæ¨¡åã\n\n./filebeat -e --modules system,nginx,mysql\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼ éç½® filebeat æ¨¡å | filebeat æ¯ææ¨¡å\n\n\n# åç\n\nfilebeat æä¸¤ä¸ªä¸»è¦ç»ä»¶ï¼\n\nharvesterï¼è´è´£è¯»åä¸ä¸ªæä»¶çåå®¹ãå®ä¼éè¡è¯»åæä»¶åå®¹ï¼å¹¶å°åå®¹åéå°è¾åºç®çå°ã\n\nprospectorï¼è´è´£ç®¡ç harvester å¹¶æ¾å°ææéè¦è¯»åçæä»¶æºãæ¯å¦ç±»åæ¯æ¥å¿ï¼prospector å°±ä¼éåå¶å®è·¯å¾ä¸çææå¹éè¦æ±çæä»¶ã\n\nfilebeat.prospectors:\n  - type: log\n    paths:\n      - /var/log/*.log\n      - /var/path2/*.log\n\n\nfilebeat ä¿ææ¯ä¸ªæä»¶çç¶æï¼å¹¶ç»å¸¸å·æ°æ³¨åè¡¨æä»¶ä¸­çç£çç¶æãç¶æç¨äºè®°ä½ harvester æ­£å¨è¯»åçæååç§»éï¼å¹¶ç¡®ä¿åéæææ¥å¿è¡ã\n\nfilebeat å°æ¯ä¸ªäºä»¶çä¼ éç¶æå­å¨å¨æ³¨åè¡¨æä»¶ä¸­ãæä»¥å®è½ä¿è¯äºä»¶è³å°ä¼ éä¸æ¬¡å°éç½®çè¾åºï¼æ²¡ææ°æ®ä¸¢å¤±ã\n\n\n# èµæ\n\nbeats å®æ¹ææ¡£',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Filebeat è¿ç»´",frontmatter:{title:"Filebeat è¿ç»´",date:"2020-06-16T07:10:44.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic","Filebeat"],permalink:"/pages/7c067f/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/02.Elastic/03.Filebeat%E8%BF%90%E7%BB%B4.html",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/02.Elastic/03.Filebeatè¿ç»´.md",key:"v-15d3f40c",path:"/pages/7c067f/",headers:[{level:2,title:"1. Filebeat å®è£",slug:"_1-filebeat-å®è£",normalizedTitle:"1. filebeat å®è£",charIndex:141},{level:3,title:"1.1. ç¯å¢è¦æ±",slug:"_1-1-ç¯å¢è¦æ±",normalizedTitle:"1.1. ç¯å¢è¦æ±",charIndex:160},{level:3,title:"1.2. å®è£æ­¥éª¤",slug:"_1-2-å®è£æ­¥éª¤",normalizedTitle:"1.2. å®è£æ­¥éª¤",charIndex:198},{level:2,title:"2. Filebeat éç½®",slug:"_2-filebeat-éç½®",normalizedTitle:"2. filebeat éç½®",charIndex:421},{level:3,title:"2.1. éè¦éç½®é¡¹",slug:"_2-1-éè¦éç½®é¡¹",normalizedTitle:"2.1. éè¦éç½®é¡¹",charIndex:803},{level:4,title:"2.1.1. filebeat.prospectors",slug:"_2-1-1-filebeat-prospectors",normalizedTitle:"2.1.1. filebeat.prospectors",charIndex:958},{level:4,title:"2.1.2. output.elasticsearch",slug:"_2-1-2-output-elasticsearch",normalizedTitle:"2.1.2. output.elasticsearch",charIndex:1104},{level:4,title:"2.1.3. output.logstash",slug:"_2-1-3-output-logstash",normalizedTitle:"2.1.3. output.logstash",charIndex:1263},{level:4,title:"2.1.4. setup.kibana",slug:"_2-1-4-setup-kibana",normalizedTitle:"2.1.4. setup.kibana",charIndex:2056},{level:4,title:"2.1.5. setup.template.settings",slug:"_2-1-5-setup-template-settings",normalizedTitle:"2.1.5. setup.template.settings",charIndex:2176},{level:4,title:"2.1.6. setup.dashboards",slug:"_2-1-6-setup-dashboards",normalizedTitle:"2.1.6. setup.dashboards",charIndex:2563},{level:2,title:"3. Filebeat å½ä»¤",slug:"_3-filebeat-å½ä»¤",normalizedTitle:"3. filebeat å½ä»¤",charIndex:2848},{level:2,title:"4. Filebeat æ¨¡å",slug:"_4-filebeat-æ¨¡å",normalizedTitle:"4. filebeat æ¨¡å",charIndex:3198},{level:2,title:"5. åèèµæ",slug:"_5-åèèµæ",normalizedTitle:"5. åèèµæ",charIndex:3757}],headersStr:"1. Filebeat å®è£ 1.1. ç¯å¢è¦æ± 1.2. å®è£æ­¥éª¤ 2. Filebeat éç½® 2.1. éè¦éç½®é¡¹ 2.1.1. filebeat.prospectors 2.1.2. output.elasticsearch 2.1.3. output.logstash 2.1.4. setup.kibana 2.1.5. setup.template.settings 2.1.6. setup.dashboards 3. Filebeat å½ä»¤ 4. Filebeat æ¨¡å 5. åèèµæ",content:'# Filebeat è¿ç»´\n\n> Beats å¹³å°éåäºå¤ç§åä¸ç¨éæ°æ®ééå¨ãå®ä»¬ä»æç¾ä¸åææåä¸ä¸å°æºå¨åç³»ç»å Logstash æ Elasticsearch åéæ°æ®ã\n> \n> å ä¸ºæåªæ¥è§¦è¿ Filebeatï¼æææ¬æä»ä»ç» Filebeat çæ¥å¸¸è¿ç»´ã\n\n\n# 1. Filebeat å®è£\n\n\n# 1.1. ç¯å¢è¦æ±\n\n> çæ¬ï¼Elastic Stack 7.4\n\n\n# 1.2. å®è£æ­¥éª¤\n\nUnix / Linux ç³»ç»å»ºè®®ä½¿ç¨ä¸é¢æ¹å¼å®è£ï¼å ä¸ºæ¯è¾éç¨ã\n\nwget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.1.1-linux-x86_64.tar.gz\ntar -zxf filebeat-6.1.1-linux-x86_64.tar.gz\n\n\n> æ´å¤åå®¹å¯ä»¥åèï¼filebeat-installation\n\n\n# 2. Filebeat éç½®\n\n> é¦åï¼å¿é¡»è¦ç¥éçæ¯ï¼filebeat.yml æ¯ filebeat çéç½®æä»¶ãå¶è·¯å¾ä¼å ä¸ºä½ å®è£æ¹å¼èææä¸åã\n> \n> Beat ææç³»åäº§åçéç½®æä»¶é½åºäº YAML æ ¼å¼ï¼FileBeat å½ç¶ä¹ä¸ä¾å¤ã\n> \n> æ´å¤ filebeat éç½®åå®¹å¯ä»¥åèï¼éç½® filebeat\n> \n> æ´å¤ filebeat.yml æä»¶æ ¼å¼åå®¹å¯ä»¥åèï¼filebeat.yml æä»¶æ ¼å¼\n\nfilebeat.yml é¨åéç½®ç¤ºä¾ï¼\n\nfilebeat:\n  prospectors:\n    - type: log\n      paths:\n        - /var/log/*.log\n      multiline:\n        pattern: \'^[\'\n        match: after\n\n\n\n# 2.1. éè¦éç½®é¡¹\n\n> ä¸é¢æå°åä¸¾ Filebeat çè¾ä¸ºéè¦çéç½®é¡¹ã\n> \n> å¦ææ³äºè§£æ´å¤éç½®ä¿¡æ¯ï¼å¯ä»¥åèï¼\n> \n> æ´å¤ filebeat éç½®åå®¹å¯ä»¥åèï¼éç½® filebeat\n> \n> æ´å¤ filebeat.yml æä»¶æ ¼å¼åå®¹å¯ä»¥åèï¼filebeat.yml æä»¶æ ¼å¼\n\n# 2.1.1. filebeat.prospectors\n\nï¼æä»¶çè§å¨ï¼ç¨äºæå®éè¦å³æ³¨çæä»¶ã\n\nç¤ºä¾\n\nfilebeat.prospectors:\n  - type: log\n    enabled: true\n    paths:\n      - /var/log/*.log\n\n\n# 2.1.2. output.elasticsearch\n\nå¦æä½ å¸æä½¿ç¨ filebeat ç´æ¥å elasticsearch è¾åºæ°æ®ï¼éè¦éç½® output.elasticsearch ã\n\nç¤ºä¾\n\noutput.elasticsearch:\n  hosts: [\'192.168.1.42:9200\']\n\n\n# 2.1.3. output.logstash\n\nå¦æä½ å¸æä½¿ç¨ filebeat å logstash è¾åºæ°æ®ï¼ç¶åç± logstash åå elasticsearch è¾åºæ°æ®ï¼éè¦éç½® output.logstashã\n\n> æ³¨æ\n> \n> ç¸æ¯äºå elasticsearch è¾åºæ°æ®ï¼ä¸ªäººæ´æ¨èå logstash è¾åºæ°æ®ã\n> \n> å ä¸º logstash å filebeat ä¸èµ·å·¥ä½æ¶ï¼å¦æ logstash å¿äºå¤çæ°æ®ï¼ä¼éç¥ FileBeat æ¾æ¢è¯»åéåº¦ãä¸æ¦æ¥å¡å¾å°è§£å³ï¼FileBeat å°æ¢å¤å°åæ¥çéåº¦å¹¶ç»§ç»­ä¼ æ­ãè¿æ ·ï¼å¯ä»¥åå°ç®¡éè¶è´è·çæåµã\n\nç¤ºä¾\n\noutput.logstash:\n  hosts: [\'127.0.0.1:5044\']\n\n\næ­¤å¤ï¼è¿éè¦å¨ logstash çéç½®æä»¶ï¼å¦ logstash.confï¼ä¸­æå® beats input æä»¶ï¼\n\ninput {\n  beats {\n    port => 5044 # æ­¤ç«¯å£éè¦ä¸ filebeat.yml ä¸­çç«¯å£ç¸å\n  }\n}\n\n# The filter part of this file is commented out to indicate that it is\n# optional.\n# filter {\n#\n# }\n\noutput {\n  elasticsearch {\n    hosts => "localhost:9200"\n    manage_template => false\n    index => "%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}"\n    document_type => "%{[@metadata][type]}"\n  }\n}\n\n\n# 2.1.4. setup.kibana\n\nå¦ææç®ä½¿ç¨ Filebeat æä¾ç Kibana ä»ªè¡¨æ¿ï¼éè¦éç½® setup.kibana ã\n\nç¤ºä¾\n\nsetup.kibana:\n  host: \'localhost:5601\'\n\n\n# 2.1.5. setup.template.settings\n\nå¨ Elasticsearch ä¸­ï¼ç´¢å¼æ¨¡æ¿ç¨äºå®ä¹è®¾ç½®åæ å°ï¼ä»¥ç¡®å®å¦ä½åæå­æ®µã\n\nå¨ Filebeat ä¸­ï¼setup.template.settings ç¨äºéç½®ç´¢å¼æ¨¡æ¿ã\n\nFilebeat æ¨èçç´¢å¼æ¨¡æ¿æä»¶ç± Filebeat è½¯ä»¶åå®è£ãå¦ææ¨æ¥å filebeat.yml éç½®æä»¶ä¸­çé»è®¤éç½®ï¼Filebeat å¨æåè¿æ¥å° Elasticsearch åèªå¨å è½½æ¨¡æ¿ã\n\næ¨å¯ä»¥éè¿å¨ Filebeat éç½®æä»¶ä¸­éç½®æ¨¡æ¿å è½½éé¡¹æ¥ç¦ç¨èªå¨æ¨¡æ¿å è½½ï¼æå è½½èªå·±çæ¨¡æ¿ãæ¨è¿å¯ä»¥è®¾ç½®éé¡¹æ¥æ´æ¹ç´¢å¼åç´¢å¼æ¨¡æ¿çåç§°ã\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼filebeat-template\n> \n> è¯´æ\n> \n> å¦æ å¿è¦ï¼ä½¿ç¨ Filebeat éç½®æä»¶ä¸­çé»è®¤ç´¢å¼æ¨¡æ¿å³å¯ã\n\n# 2.1.6. setup.dashboards\n\nFilebeat éå¸¦äºç¤ºä¾ Kibana ä»ªè¡¨æ¿ãå¨ä½¿ç¨ä»ªè¡¨æ¿ä¹åï¼æ¨éè¦åå»ºç´¢å¼æ¨¡å¼ filebeat- *ï¼å¹¶å°ä»ªè¡¨æ¿å è½½å° Kibana ä¸­ãä¸ºæ­¤ï¼æ¨å¯ä»¥è¿è¡ setup å½ä»¤æå¨ filebeat.yml éç½®æä»¶ä¸­éç½®ä»ªè¡¨æ¿å è½½ã\n\nä¸ºäºå¨ Kibana ä¸­å è½½ Filebeat çä»ªè¡¨çï¼éè¦å¨ filebeat.yml éç½®ä¸­å¯å¨å¼å³ï¼\n\nsetup.dashboards.enabled: true\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼configuration-dashboards\n\n\n# 3. Filebeat å½ä»¤\n\nfilebeat æä¾äºä¸ç³»åå½ä»¤æ¥å®æåç§åè½ã\n\næ§è¡å½ä»¤æ¹å¼ï¼\n\n./filebeat COMMAND\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼command-line-options\n> \n> è¯´æ\n> \n> ä¸ªäººè®¤ä¸ºå½ä»¤è¡æ²¡æå¿è¦ä¸ä¸ææ¡ï¼å ä¸ºç»å¤§é¨ååè½é½å¯ä»¥éè¿éç½®æ¥å®æãä¸éè¿å½ä»¤è¡æå®åè½è¿ç§æ¹å¼è¦æ±æ¯æ¬¡è¾å¥åæ ·åæ°ï¼ä¸å©äºåºåå¯å¨æ¹å¼ã\n> \n> æéè¦çå½ç¶æ¯å¯å¨å½ä»¤ run äºã\n> \n> ç¤ºä¾ æå®éç½®æä»¶å¯å¨\n> \n> ./filebeat run -e -c filebeat.yml -d "publish"\n> ./filebeat -e -c filebeat.yml -d "publish" # run å¯ä»¥çç¥\n\n\n# 4. Filebeat æ¨¡å\n\n> Filebeat å Metricbeat åé¨éæäºä¸ç³»åæ¨¡åï¼ç¨ä»¥ç®åå¸¸è§æ¥å¿æ ¼å¼ï¼ä¾å¦ NGINXãApache æè¯¸å¦ Redis æ Docker ç­ç³»ç»ææ ï¼çæ¶éãè§£æåå¯è§åè¿ç¨ã\n\n * éç½® elasticsearch å kibana\n\noutput.elasticsearch:\n  hosts: ["myEShost:9200"]\n  username: "elastic"\n  password: "elastic"\nsetup.kibana:\n  host: "mykibanahost:5601"\n  username: "elastic"\n  password: "elastic\n\n\n> username å password æ¯å¯éçï¼å¦æä¸éè¦è®¤è¯åä¸å¡«ã\n\n * åå§åç¯å¢\n\næ§è¡ä¸é¢å½ä»¤ï¼filebeat ä¼å è½½æ¨èç´¢å¼æ¨¡æ¿ã\n\n./filebeat setup -e\n\n\n * æå®æ¨¡å\n\næ§è¡ä¸é¢å½ä»¤ï¼æå®å¸æå è½½çæ¨¡åã\n\n./filebeat -e --modules system,nginx,mysql\n\n\n> æ´å¤åå®¹å¯ä»¥åèï¼\n> \n>  * éç½® filebeat æ¨¡å\n>  * filebeat æ¯ææ¨¡å\n\n\n# 5. åèèµæ\n\n * Beats å®ç½\n * Beats Github\n * Beats å®æ¹ææ¡£',normalizedContent:'# filebeat è¿ç»´\n\n> beats å¹³å°éåäºå¤ç§åä¸ç¨éæ°æ®ééå¨ãå®ä»¬ä»æç¾ä¸åææåä¸ä¸å°æºå¨åç³»ç»å logstash æ elasticsearch åéæ°æ®ã\n> \n> å ä¸ºæåªæ¥è§¦è¿ filebeatï¼æææ¬æä»ä»ç» filebeat çæ¥å¸¸è¿ç»´ã\n\n\n# 1. filebeat å®è£\n\n\n# 1.1. ç¯å¢è¦æ±\n\n> çæ¬ï¼elastic stack 7.4\n\n\n# 1.2. å®è£æ­¥éª¤\n\nunix / linux ç³»ç»å»ºè®®ä½¿ç¨ä¸é¢æ¹å¼å®è£ï¼å ä¸ºæ¯è¾éç¨ã\n\nwget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.1.1-linux-x86_64.tar.gz\ntar -zxf filebeat-6.1.1-linux-x86_64.tar.gz\n\n\n> æ´å¤åå®¹å¯ä»¥åèï¼filebeat-installation\n\n\n# 2. filebeat éç½®\n\n> é¦åï¼å¿é¡»è¦ç¥éçæ¯ï¼filebeat.yml æ¯ filebeat çéç½®æä»¶ãå¶è·¯å¾ä¼å ä¸ºä½ å®è£æ¹å¼èææä¸åã\n> \n> beat ææç³»åäº§åçéç½®æä»¶é½åºäº yaml æ ¼å¼ï¼filebeat å½ç¶ä¹ä¸ä¾å¤ã\n> \n> æ´å¤ filebeat éç½®åå®¹å¯ä»¥åèï¼éç½® filebeat\n> \n> æ´å¤ filebeat.yml æä»¶æ ¼å¼åå®¹å¯ä»¥åèï¼filebeat.yml æä»¶æ ¼å¼\n\nfilebeat.yml é¨åéç½®ç¤ºä¾ï¼\n\nfilebeat:\n  prospectors:\n    - type: log\n      paths:\n        - /var/log/*.log\n      multiline:\n        pattern: \'^[\'\n        match: after\n\n\n\n# 2.1. éè¦éç½®é¡¹\n\n> ä¸é¢æå°åä¸¾ filebeat çè¾ä¸ºéè¦çéç½®é¡¹ã\n> \n> å¦ææ³äºè§£æ´å¤éç½®ä¿¡æ¯ï¼å¯ä»¥åèï¼\n> \n> æ´å¤ filebeat éç½®åå®¹å¯ä»¥åèï¼éç½® filebeat\n> \n> æ´å¤ filebeat.yml æä»¶æ ¼å¼åå®¹å¯ä»¥åèï¼filebeat.yml æä»¶æ ¼å¼\n\n# 2.1.1. filebeat.prospectors\n\nï¼æä»¶çè§å¨ï¼ç¨äºæå®éè¦å³æ³¨çæä»¶ã\n\nç¤ºä¾\n\nfilebeat.prospectors:\n  - type: log\n    enabled: true\n    paths:\n      - /var/log/*.log\n\n\n# 2.1.2. output.elasticsearch\n\nå¦æä½ å¸æä½¿ç¨ filebeat ç´æ¥å elasticsearch è¾åºæ°æ®ï¼éè¦éç½® output.elasticsearch ã\n\nç¤ºä¾\n\noutput.elasticsearch:\n  hosts: [\'192.168.1.42:9200\']\n\n\n# 2.1.3. output.logstash\n\nå¦æä½ å¸æä½¿ç¨ filebeat å logstash è¾åºæ°æ®ï¼ç¶åç± logstash åå elasticsearch è¾åºæ°æ®ï¼éè¦éç½® output.logstashã\n\n> æ³¨æ\n> \n> ç¸æ¯äºå elasticsearch è¾åºæ°æ®ï¼ä¸ªäººæ´æ¨èå logstash è¾åºæ°æ®ã\n> \n> å ä¸º logstash å filebeat ä¸èµ·å·¥ä½æ¶ï¼å¦æ logstash å¿äºå¤çæ°æ®ï¼ä¼éç¥ filebeat æ¾æ¢è¯»åéåº¦ãä¸æ¦æ¥å¡å¾å°è§£å³ï¼filebeat å°æ¢å¤å°åæ¥çéåº¦å¹¶ç»§ç»­ä¼ æ­ãè¿æ ·ï¼å¯ä»¥åå°ç®¡éè¶è´è·çæåµã\n\nç¤ºä¾\n\noutput.logstash:\n  hosts: [\'127.0.0.1:5044\']\n\n\næ­¤å¤ï¼è¿éè¦å¨ logstash çéç½®æä»¶ï¼å¦ logstash.confï¼ä¸­æå® beats input æä»¶ï¼\n\ninput {\n  beats {\n    port => 5044 # æ­¤ç«¯å£éè¦ä¸ filebeat.yml ä¸­çç«¯å£ç¸å\n  }\n}\n\n# the filter part of this file is commented out to indicate that it is\n# optional.\n# filter {\n#\n# }\n\noutput {\n  elasticsearch {\n    hosts => "localhost:9200"\n    manage_template => false\n    index => "%{[@metadata][beat]}-%{[@metadata][version]}-%{+yyyy.mm.dd}"\n    document_type => "%{[@metadata][type]}"\n  }\n}\n\n\n# 2.1.4. setup.kibana\n\nå¦ææç®ä½¿ç¨ filebeat æä¾ç kibana ä»ªè¡¨æ¿ï¼éè¦éç½® setup.kibana ã\n\nç¤ºä¾\n\nsetup.kibana:\n  host: \'localhost:5601\'\n\n\n# 2.1.5. setup.template.settings\n\nå¨ elasticsearch ä¸­ï¼ç´¢å¼æ¨¡æ¿ç¨äºå®ä¹è®¾ç½®åæ å°ï¼ä»¥ç¡®å®å¦ä½åæå­æ®µã\n\nå¨ filebeat ä¸­ï¼setup.template.settings ç¨äºéç½®ç´¢å¼æ¨¡æ¿ã\n\nfilebeat æ¨èçç´¢å¼æ¨¡æ¿æä»¶ç± filebeat è½¯ä»¶åå®è£ãå¦ææ¨æ¥å filebeat.yml éç½®æä»¶ä¸­çé»è®¤éç½®ï¼filebeat å¨æåè¿æ¥å° elasticsearch åèªå¨å è½½æ¨¡æ¿ã\n\næ¨å¯ä»¥éè¿å¨ filebeat éç½®æä»¶ä¸­éç½®æ¨¡æ¿å è½½éé¡¹æ¥ç¦ç¨èªå¨æ¨¡æ¿å è½½ï¼æå è½½èªå·±çæ¨¡æ¿ãæ¨è¿å¯ä»¥è®¾ç½®éé¡¹æ¥æ´æ¹ç´¢å¼åç´¢å¼æ¨¡æ¿çåç§°ã\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼filebeat-template\n> \n> è¯´æ\n> \n> å¦æ å¿è¦ï¼ä½¿ç¨ filebeat éç½®æä»¶ä¸­çé»è®¤ç´¢å¼æ¨¡æ¿å³å¯ã\n\n# 2.1.6. setup.dashboards\n\nfilebeat éå¸¦äºç¤ºä¾ kibana ä»ªè¡¨æ¿ãå¨ä½¿ç¨ä»ªè¡¨æ¿ä¹åï¼æ¨éè¦åå»ºç´¢å¼æ¨¡å¼ filebeat- *ï¼å¹¶å°ä»ªè¡¨æ¿å è½½å° kibana ä¸­ãä¸ºæ­¤ï¼æ¨å¯ä»¥è¿è¡ setup å½ä»¤æå¨ filebeat.yml éç½®æä»¶ä¸­éç½®ä»ªè¡¨æ¿å è½½ã\n\nä¸ºäºå¨ kibana ä¸­å è½½ filebeat çä»ªè¡¨çï¼éè¦å¨ filebeat.yml éç½®ä¸­å¯å¨å¼å³ï¼\n\nsetup.dashboards.enabled: true\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼configuration-dashboards\n\n\n# 3. filebeat å½ä»¤\n\nfilebeat æä¾äºä¸ç³»åå½ä»¤æ¥å®æåç§åè½ã\n\næ§è¡å½ä»¤æ¹å¼ï¼\n\n./filebeat command\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼command-line-options\n> \n> è¯´æ\n> \n> ä¸ªäººè®¤ä¸ºå½ä»¤è¡æ²¡æå¿è¦ä¸ä¸ææ¡ï¼å ä¸ºç»å¤§é¨ååè½é½å¯ä»¥éè¿éç½®æ¥å®æãä¸éè¿å½ä»¤è¡æå®åè½è¿ç§æ¹å¼è¦æ±æ¯æ¬¡è¾å¥åæ ·åæ°ï¼ä¸å©äºåºåå¯å¨æ¹å¼ã\n> \n> æéè¦çå½ç¶æ¯å¯å¨å½ä»¤ run äºã\n> \n> ç¤ºä¾ æå®éç½®æä»¶å¯å¨\n> \n> ./filebeat run -e -c filebeat.yml -d "publish"\n> ./filebeat -e -c filebeat.yml -d "publish" # run å¯ä»¥çç¥\n\n\n# 4. filebeat æ¨¡å\n\n> filebeat å metricbeat åé¨éæäºä¸ç³»åæ¨¡åï¼ç¨ä»¥ç®åå¸¸è§æ¥å¿æ ¼å¼ï¼ä¾å¦ nginxãapache æè¯¸å¦ redis æ docker ç­ç³»ç»ææ ï¼çæ¶éãè§£æåå¯è§åè¿ç¨ã\n\n * éç½® elasticsearch å kibana\n\noutput.elasticsearch:\n  hosts: ["myeshost:9200"]\n  username: "elastic"\n  password: "elastic"\nsetup.kibana:\n  host: "mykibanahost:5601"\n  username: "elastic"\n  password: "elastic\n\n\n> username å password æ¯å¯éçï¼å¦æä¸éè¦è®¤è¯åä¸å¡«ã\n\n * åå§åç¯å¢\n\næ§è¡ä¸é¢å½ä»¤ï¼filebeat ä¼å è½½æ¨èç´¢å¼æ¨¡æ¿ã\n\n./filebeat setup -e\n\n\n * æå®æ¨¡å\n\næ§è¡ä¸é¢å½ä»¤ï¼æå®å¸æå è½½çæ¨¡åã\n\n./filebeat -e --modules system,nginx,mysql\n\n\n> æ´å¤åå®¹å¯ä»¥åèï¼\n> \n>  * éç½® filebeat æ¨¡å\n>  * filebeat æ¯ææ¨¡å\n\n\n# 5. åèèµæ\n\n * beats å®ç½\n * beats github\n * beats å®æ¹ææ¡£',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Elastic å¿«éå¥é¨",frontmatter:{title:"Elastic å¿«éå¥é¨",date:"2020-06-16T07:10:44.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic"],permalink:"/pages/553160/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/02.Elastic/01.Elastic%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.html",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/02.Elastic/01.Elasticå¿«éå¥é¨.md",key:"v-778f3185",path:"/pages/553160/",headers:[{level:2,title:"1. ç®ä»",slug:"_1-ç®ä»",normalizedTitle:"1. ç®ä»",charIndex:38},{level:3,title:"1.1. Elastic Stack æ¯ä»ä¹",slug:"_1-1-elastic-stack-æ¯ä»ä¹",normalizedTitle:"1.1. elastic stack æ¯ä»ä¹",charIndex:48},{level:3,title:"1.2. ä¸ºä»ä¹ä½¿ç¨ Elastic Stack",slug:"_1-2-ä¸ºä»ä¹ä½¿ç¨-elastic-stack",normalizedTitle:"1.2. ä¸ºä»ä¹ä½¿ç¨ elastic stack",charIndex:397},{level:3,title:"1.3. Elastic Stack æ¶æ",slug:"_1-3-elastic-stack-æ¶æ",normalizedTitle:"1.3. elastic stack æ¶æ",charIndex:563},{level:2,title:"2. ElasticSearch",slug:"_2-elasticsearch",normalizedTitle:"2. elasticsearch",charIndex:972},{level:3,title:"2.1. ElasticSearch ç®ä»",slug:"_2-1-elasticsearch-ç®ä»",normalizedTitle:"2.1. elasticsearch ç®ä»",charIndex:1105},{level:4,title:"2.1.1. æ ¸å¿æ¦å¿µ",slug:"_2-1-1-æ ¸å¿æ¦å¿µ",normalizedTitle:"2.1.1. æ ¸å¿æ¦å¿µ",charIndex:1379},{level:3,title:"2.2. ElasticSearch åç",slug:"_2-2-elasticsearch-åç",normalizedTitle:"2.2. elasticsearch åç",charIndex:2042},{level:4,title:"2.2.1. ES åæ°æ®è¿ç¨",slug:"_2-2-1-es-åæ°æ®è¿ç¨",normalizedTitle:"2.2.1. es åæ°æ®è¿ç¨",charIndex:2067},{level:4,title:"2.2.2. es è¯»æ°æ®è¿ç¨",slug:"_2-2-2-es-è¯»æ°æ®è¿ç¨",normalizedTitle:"2.2.2. es è¯»æ°æ®è¿ç¨",charIndex:2350},{level:4,title:"2.2.3. åæ°æ®åºå±åç",slug:"_2-2-3-åæ°æ®åºå±åç",normalizedTitle:"2.2.3. åæ°æ®åºå±åç",charIndex:2699},{level:4,title:"2.2.4. å é¤/æ´æ°æ°æ®åºå±åç",slug:"_2-2-4-å é¤-æ´æ°æ°æ®åºå±åç",normalizedTitle:"2.2.4. å é¤/æ´æ°æ°æ®åºå±åç",charIndex:4961},{level:4,title:"2.2.5. åºå± lucene",slug:"_2-2-5-åºå±-lucene",normalizedTitle:"2.2.5. åºå± lucene",charIndex:5407},{level:4,title:"2.2.6. åæç´¢å¼",slug:"_2-2-6-åæç´¢å¼",normalizedTitle:"2.2.6. åæç´¢å¼",charIndex:5586},{level:2,title:"3. Logstash",slug:"_3-logstash",normalizedTitle:"3. logstash",charIndex:6504},{level:3,title:"3.1. Logstash ç®ä»",slug:"_3-1-logstash-ç®ä»",normalizedTitle:"3.1. logstash ç®ä»",charIndex:6587},{level:3,title:"3.2. Logstash åç",slug:"_3-2-logstash-åç",normalizedTitle:"3.2. logstash åç",charIndex:6747},{level:2,title:"4. Beats",slug:"_4-beats",normalizedTitle:"4. beats",charIndex:7025},{level:3,title:"4.1. Filebeat ç®ä»",slug:"_4-1-filebeat-ç®ä»",normalizedTitle:"4.1. filebeat ç®ä»",charIndex:7332},{level:3,title:"4.2. Filebeat åç",slug:"_4-2-filebeat-åç",normalizedTitle:"4.2. filebeat åç",charIndex:7704},{level:2,title:"5. è¿ç»´",slug:"_5-è¿ç»´",normalizedTitle:"5. è¿ç»´",charIndex:8111},{level:2,title:"6. åèèµæ",slug:"_6-åèèµæ",normalizedTitle:"6. åèèµæ",charIndex:8182}],headersStr:"1. ç®ä» 1.1. Elastic Stack æ¯ä»ä¹ 1.2. ä¸ºä»ä¹ä½¿ç¨ Elastic Stack 1.3. Elastic Stack æ¶æ 2. ElasticSearch 2.1. ElasticSearch ç®ä» 2.1.1. æ ¸å¿æ¦å¿µ 2.2. ElasticSearch åç 2.2.1. ES åæ°æ®è¿ç¨ 2.2.2. es è¯»æ°æ®è¿ç¨ 2.2.3. åæ°æ®åºå±åç 2.2.4. å é¤/æ´æ°æ°æ®åºå±åç 2.2.5. åºå± lucene 2.2.6. åæç´¢å¼ 3. Logstash 3.1. Logstash ç®ä» 3.2. Logstash åç 4. Beats 4.1. Filebeat ç®ä» 4.2. Filebeat åç 5. è¿ç»´ 6. åèèµæ",content:"# Elastic å¿«éå¥é¨\n\n> å¼æºåè®®ï¼Apache 2.0\n\n\n# 1. ç®ä»\n\n\n# 1.1. Elastic Stack æ¯ä»ä¹\n\nElastic Stack å³ ELK Stackã\n\nELK æ¯æ Elastic å¬å¸æä¸ä¸æ¬¾äº§å ElasticSearch ãLogstash ãKibana çé¦å­æ¯ç»åã\n\n * Elasticsearch æ¯ä¸ä¸ªæç´¢ååæå¼æã\n * Logstash æ¯æå¡å¨ç«¯æ°æ®å¤çç®¡éï¼è½å¤åæ¶ä»å¤ä¸ªæ¥æºééæ°æ®ï¼è½¬æ¢æ°æ®ï¼ç¶åå°æ°æ®åéå°è¯¸å¦ Elasticsearch ç­âå­å¨åºâä¸­ã\n * Kibana åå¯ä»¥è®©ç¨æ·å¨ Elasticsearch ä¸­ä½¿ç¨å¾å½¢åå¾è¡¨å¯¹æ°æ®è¿è¡å¯è§åã\n\nè Elastic Stack æ¯ ELK Stack çæ´æ°æ¢ä»£äº§åï¼ææ°äº§åå¼å¥äºè½»éåçåä¸åè½æ°æ®ééå¨ï¼å¹¶æå®ä»¬å«å Beatsã\n\n\n# 1.2. ä¸ºä»ä¹ä½¿ç¨ Elastic Stack\n\nå¯¹äºæä¸å®è§æ¨¡çå¬å¸æ¥è¯´ï¼éå¸¸ä¼å¾å¤ä¸ªåºç¨ï¼å¹¶é¨ç½²å¨å¤§éçæå¡å¨ä¸ãè¿ç»´åå¼åäººåå¸¸å¸¸éè¦éè¿æ¥çæ¥å¿æ¥å®ä½é®é¢ãå¦æåºç¨æ¯éç¾¤åé¨ç½²ï¼è¯æ³å¦æç»å½ä¸å°å°æå¡å¨å»æ¥çæ¥å¿ï¼æ¯å¤ä¹è´¹æ¶è´¹åã\n\nèéè¿ ELK è¿å¥è§£å³æ¹æ¡ï¼å¯ä»¥åæ¶å®ç°æ¥å¿æ¶éãæ¥å¿æç´¢åæ¥å¿åæçåè½ã\n\n\n# 1.3. Elastic Stack æ¶æ\n\n\n\n> è¯´æ\n> \n> ä»¥ä¸æ¯ Elastic Stack çä¸ä¸ªæ¶æå¾ãä»å¾ä¸­å¯ä»¥æ¸æ¥ççå°æ°æ®æµåã\n> \n>  * Beats æ¯åä¸ç¨éçæ°æ®ä¼ è¾å¹³å°ï¼å®å¯ä»¥å°å¤å°æºå¨çæ°æ®åéå° Logstash æ ElasticSearchãä½ Beats å¹¶ä¸æ¯ä¸å¯æç¼ºçä¸ç¯ï¼æä»¥æ¬æä¸­æä¸ä»ç»ã\n> \n>  * Logstash æ¯ä¸ä¸ªå¨ææ°æ®æ¶éç®¡éãæ¯æä»¥ TCP/UDP/HTTP å¤ç§æ¹å¼æ¶éæ°æ®ï¼ä¹å¯ä»¥æ¥å Beats ä¼ è¾æ¥çæ°æ®ï¼ï¼å¹¶å¯¹æ°æ®åè¿ä¸æ­¥ä¸°å¯ææåå­æ®µå¤çã\n> \n>  * ElasticSearch æ¯ä¸ä¸ªåºäº JSON çåå¸å¼çæç´¢ååæå¼æãä½ä¸º ELK çæ ¸å¿ï¼å®éä¸­å­å¨æ°æ®ã\n> \n>  * Kibana æ¯ ELK çç¨æ·çé¢ãå®å°æ¶éçæ°æ®è¿è¡å¯è§åå±ç¤ºï¼åç§æ¥è¡¨ãå¾å½¢åæ°æ®ï¼ï¼å¹¶æä¾éç½®ãç®¡ç ELK ççé¢ã\n\n\n# 2. ElasticSearch\n\n> Elasticsearch æ¯ä¸ä¸ªåå¸å¼ãRESTful é£æ ¼çæç´¢åæ°æ®åæå¼æï¼è½å¤è§£å³ä¸æ­æ¶ç°åºçåç§ç¨ä¾ã ä½ä¸º Elastic Stack çæ ¸å¿ï¼å®éä¸­å­å¨æ¨çæ°æ®ï¼å¸®å©æ¨åç°ææä¹ä¸­ä»¥åææä¹å¤çæåµã\n\n\n# 2.1. ElasticSearch ç®ä»\n\nElasticsearch åºäºæç´¢åº Lucene å¼åãElasticSearch éèäº Lucene çå¤ææ§ï¼æä¾äºç®åæç¨ç REST API / Java API æ¥å£ï¼å¦å¤è¿æå¶ä»è¯­è¨ç API æ¥å£ï¼ã\n\nElasticSearch å¯ä»¥è§ä¸ºä¸ä¸ªææ¡£å­å¨ï¼å®å°å¤ææ°æ®ç»æåºååä¸º JSON å­å¨ã\n\nElasticSearch æ¯è¿ä¹äºå®æ¶çå¨ææç´ ï¼è¿æ¯æï¼\n\n * ä»åå¥æ°æ®å°æ°æ®å¯ä»¥è¢«æç´¢ï¼å­å¨è¾å°çå»¶è¿ï¼å¤§æ¦æ¯ 1sï¼\n * åºäº ES æ§è¡æç´¢ååæå¯ä»¥è¾¾å°ç§çº§\n\n# 2.1.1. æ ¸å¿æ¦å¿µ\n\n * ç´¢å¼ï¼Indexï¼ å¯ä»¥è®¤ä¸ºæ¯ææ¡£ï¼documentï¼çä¼åéåã\n * æ¯ä¸ª ææ¡£ï¼documentï¼ é½æ¯å­æ®µï¼fieldï¼çéåã\n * å­æ®µï¼fieldï¼ æ¯åå«æ°æ®çé®å¼å¯¹ã\n * é»è®¤æåµä¸ï¼Elasticsearch å¯¹æ¯ä¸ªå­æ®µä¸­çæææ°æ®å»ºç«ç´¢å¼ï¼å¹¶ä¸æ¯ä¸ªç´¢å¼å­æ®µé½å·æä¸ç¨çä¼åæ°æ®ç»æã\n * æ¯ä¸ªç´¢å¼éå¯ä»¥æä¸ä¸ªæèå¤ä¸ªç±»åï¼typeï¼ãç±»åï¼typeï¼ æ¯ index çä¸ä¸ªé»è¾åç±»ï¼\n * å½åå°æºå¨ä¸è¶³ä»¥å­å¨å¤§éæ°æ®æ¶ï¼Elasticsearch å¯ä»¥å°ä¸ä¸ªç´¢å¼ä¸­çæ°æ®ååä¸ºå¤ä¸ª åçï¼shardï¼ ã åçï¼shardï¼ åå¸å¨å¤å°æå¡å¨ä¸å­å¨ãæäº shard å°±å¯ä»¥æ¨ªåæ©å±ï¼å­å¨æ´å¤æ°æ®ï¼è®©æç´¢ååæç­æä½åå¸å°å¤å°æå¡å¨ä¸å»æ§è¡ï¼æåååéåæ§è½ãæ¯ä¸ª shard é½æ¯ä¸ä¸ª lucene indexã\n * ä»»ä½ä¸ä¸ªæå¡å¨éæ¶å¯è½æéæå®æºï¼æ­¤æ¶ shard å¯è½å°±ä¼ä¸¢å¤±ï¼å æ­¤å¯ä»¥ä¸ºæ¯ä¸ª shard åå»ºå¤ä¸ª å¯æ¬ï¼replicaï¼ãreplica å¯ä»¥å¨ shard æéæ¶æä¾å¤ç¨æå¡ï¼ä¿è¯æ°æ®ä¸ä¸¢å¤±ï¼å¤ä¸ª replica è¿å¯ä»¥æåæç´¢æä½çååéåæ§è½ãprimary shardï¼å»ºç«ç´¢å¼æ¶ä¸æ¬¡è®¾ç½®ï¼ä¸è½ä¿®æ¹ï¼é»è®¤ 5 ä¸ªï¼ï¼replica shardï¼éæ¶ä¿®æ¹æ°éï¼é»è®¤ 1 ä¸ªï¼ï¼é»è®¤æ¯ä¸ªç´¢å¼ 10 ä¸ª shardï¼5 ä¸ª primary shardï¼5 ä¸ª replica shardï¼æå°çé«å¯ç¨éç½®ï¼æ¯ 2 å°æå¡å¨ã\n\n\n# 2.2. ElasticSearch åç\n\n# 2.2.1. ES åæ°æ®è¿ç¨\n\n * å®¢æ·ç«¯éæ©ä¸ä¸ª node åéè¯·æ±è¿å»ï¼è¿ä¸ª node å°±æ¯ coordinating nodeï¼åè°èç¹ï¼ã\n * coordinating node å¯¹ document è¿è¡è·¯ç±ï¼å°è¯·æ±è½¬åç»å¯¹åºç nodeï¼æ primary shardï¼ã\n * å®éç node ä¸ç primary shard å¤çè¯·æ±ï¼ç¶åå°æ°æ®åæ­¥å° replica nodeã\n * coordinating node å¦æåç° primary node åææ replica node é½æå®ä¹åï¼å°±è¿åååºç»æç»å®¢æ·ç«¯ã\n\n\n\n# 2.2.2. es è¯»æ°æ®è¿ç¨\n\nå¯ä»¥éè¿ doc id æ¥æ¥è¯¢ï¼ä¼æ ¹æ® doc id è¿è¡ hashï¼å¤æ­åºæ¥å½æ¶æ doc id åéå°äºåªä¸ª shard ä¸é¢å»ï¼ä»é£ä¸ª shard å»æ¥è¯¢ã\n\n * å®¢æ·ç«¯åéè¯·æ±å°ä»»æä¸ä¸ª nodeï¼æä¸º coordinate nodeã\n * coordinate node å¯¹ doc id è¿è¡åå¸è·¯ç±ï¼å°è¯·æ±è½¬åå°å¯¹åºç nodeï¼æ­¤æ¶ä¼ä½¿ç¨ round-robin éæºè½®è¯¢ç®æ³ï¼å¨ primary shard ä»¥åå¶ææ replica ä¸­éæºéæ©ä¸ä¸ªï¼è®©è¯»è¯·æ±è´è½½åè¡¡ã\n * æ¥æ¶è¯·æ±ç node è¿å document ç» coordinate nodeã\n * coordinate node è¿å document ç»å®¢æ·ç«¯ã\n\n# 2.2.3. åæ°æ®åºå±åç\n\n\n\nååå¥åå­ bufferï¼å¨ buffer éçæ¶åæ°æ®æ¯æç´¢ä¸å°çï¼åæ¶å°æ°æ®åå¥ translog æ¥å¿æä»¶ã\n\nå¦æ buffer å¿«æ»¡äºï¼æèå°ä¸å®æ¶é´ï¼å°±ä¼å°åå­ buffer æ°æ® refresh å°ä¸ä¸ªæ°ç segment file ä¸­ï¼ä½æ¯æ­¤æ¶æ°æ®ä¸æ¯ç´æ¥è¿å¥ segment file ç£çæä»¶ï¼èæ¯åè¿å¥ os cache ãè¿ä¸ªè¿ç¨å°±æ¯ refreshã\n\næ¯é 1 ç§éï¼es å° buffer ä¸­çæ°æ®åå¥ä¸ä¸ªæ°ç segment fileï¼æ¯ç§éä¼äº§çä¸ä¸ªæ°çç£çæä»¶ segment fileï¼è¿ä¸ª segment file ä¸­å°±å­å¨æè¿ 1 ç§å buffer ä¸­åå¥çæ°æ®ã\n\nä½æ¯å¦æ buffer éé¢æ­¤æ¶æ²¡ææ°æ®ï¼é£å½ç¶ä¸ä¼æ§è¡ refresh æä½ï¼å¦æ buffer éé¢ææ°æ®ï¼é»è®¤ 1 ç§éæ§è¡ä¸æ¬¡ refresh æä½ï¼å·å¥ä¸ä¸ªæ°ç segment file ä¸­ã\n\næä½ç³»ç»éé¢ï¼ç£çæä»¶å¶å®é½æä¸ä¸ªä¸è¥¿ï¼å«å os cacheï¼å³æä½ç³»ç»ç¼å­ï¼å°±æ¯è¯´æ°æ®åå¥ç£çæä»¶ä¹åï¼ä¼åè¿å¥ os cacheï¼åè¿å¥æä½ç³»ç»çº§å«çä¸ä¸ªåå­ç¼å­ä¸­å»ãåªè¦ buffer ä¸­çæ°æ®è¢« refresh æä½å·å¥ os cacheä¸­ï¼è¿ä¸ªæ°æ®å°±å¯ä»¥è¢«æç´¢å°äºã\n\nä¸ºä»ä¹å« es æ¯åå®æ¶çï¼ NRTï¼å¨ç§° near real-timeãé»è®¤æ¯æ¯é 1 ç§ refresh ä¸æ¬¡çï¼æä»¥ es æ¯åå®æ¶çï¼å ä¸ºåå¥çæ°æ® 1 ç§ä¹åæè½è¢«çå°ãå¯ä»¥éè¿ es ç restful api æè java apiï¼æå¨æ§è¡ä¸æ¬¡ refresh æä½ï¼å°±æ¯æå¨å° buffer ä¸­çæ°æ®å·å¥ os cacheä¸­ï¼è®©æ°æ®ç«é©¬å°±å¯ä»¥è¢«æç´¢å°ãåªè¦æ°æ®è¢«è¾å¥ os cache ä¸­ï¼buffer å°±ä¼è¢«æ¸ç©ºäºï¼å ä¸ºä¸éè¦ä¿ç buffer äºï¼æ°æ®å¨ translog éé¢å·²ç»æä¹åå°ç£çå»ä¸ä»½äºã\n\néå¤ä¸é¢çæ­¥éª¤ï¼æ°çæ°æ®ä¸æ­è¿å¥ buffer å translogï¼ä¸æ­å° buffer æ°æ®åå¥ä¸ä¸ªåä¸ä¸ªæ°ç segment file ä¸­å»ï¼æ¯æ¬¡ refresh å® buffer æ¸ç©ºï¼translog ä¿çãéçè¿ä¸ªè¿ç¨æ¨è¿ï¼translog ä¼åå¾è¶æ¥è¶å¤§ãå½ translog è¾¾å°ä¸å®é¿åº¦çæ¶åï¼å°±ä¼è§¦å commit æä½ã\n\ncommit æä½åçç¬¬ä¸æ­¥ï¼å°±æ¯å° buffer ä¸­ç°ææ°æ® refresh å° os cache ä¸­å»ï¼æ¸ç©º bufferãç¶åï¼å°ä¸ä¸ª commit point åå¥ç£çæä»¶ï¼éé¢æ è¯çè¿ä¸ª commit point å¯¹åºçææ segment fileï¼åæ¶å¼ºè¡å° os cache ä¸­ç®åææçæ°æ®é½ fsync å°ç£çæä»¶ä¸­å»ãæåæ¸ç©º ç°æ translog æ¥å¿æä»¶ï¼éå¯ä¸ä¸ª translogï¼æ­¤æ¶ commit æä½å®æã\n\nè¿ä¸ª commit æä½å«å flushãé»è®¤ 30 åéèªå¨æ§è¡ä¸æ¬¡ flushï¼ä½å¦æ translog è¿å¤§ï¼ä¹ä¼è§¦å flushãflush æä½å°±å¯¹åºç commit çå¨è¿ç¨ï¼æä»¬å¯ä»¥éè¿ es apiï¼æå¨æ§è¡ flush æä½ï¼æå¨å° os cache ä¸­çæ°æ® fsync å¼ºå·å°ç£çä¸å»ã\n\ntranslog æ¥å¿æä»¶çä½ç¨æ¯ä»ä¹ï¼ä½ æ§è¡ commit æä½ä¹åï¼æ°æ®è¦ä¹æ¯åçå¨ buffer ä¸­ï¼è¦ä¹æ¯åçå¨ os cache ä¸­ï¼æ è®ºæ¯ buffer è¿æ¯ os cache é½æ¯åå­ï¼ä¸æ¦è¿å°æºå¨æ­»äºï¼åå­ä¸­çæ°æ®å°±å¨ä¸¢äºãæä»¥éè¦å°æ°æ®å¯¹åºçæä½åå¥ä¸ä¸ªä¸é¨çæ¥å¿æä»¶ translog ä¸­ï¼ä¸æ¦æ­¤æ¶æºå¨å®æºï¼åæ¬¡éå¯çæ¶åï¼es ä¼èªå¨è¯»å translog æ¥å¿æä»¶ä¸­çæ°æ®ï¼æ¢å¤å°åå­ buffer å os cache ä¸­å»ã\n\ntranslog å¶å®ä¹æ¯ååå¥ os cache çï¼é»è®¤æ¯é 5 ç§å·ä¸æ¬¡å°ç£çä¸­å»ï¼æä»¥é»è®¤æåµä¸ï¼å¯è½æ 5 ç§çæ°æ®ä¼ä»ä»åçå¨ buffer æè translog æä»¶ç os cache ä¸­ï¼å¦ææ­¤æ¶æºå¨æäºï¼ä¼ä¸¢å¤± 5 ç§éçæ°æ®ãä½æ¯è¿æ ·æ§è½æ¯è¾å¥½ï¼æå¤ä¸¢ 5 ç§çæ°æ®ãä¹å¯ä»¥å° translog è®¾ç½®ææ¯æ¬¡åæä½å¿é¡»æ¯ç´æ¥ fsync å°ç£çï¼ä½æ¯æ§è½ä¼å·®å¾å¤ã\n\nå®éä¸ä½ å¨è¿éï¼å¦æé¢è¯å®æ²¡æé®ä½  es ä¸¢æ°æ®çé®é¢ï¼ä½ å¯ä»¥å¨è¿éç»é¢è¯å®ç«ä¸æï¼ä½ è¯´ï¼å¶å® es ç¬¬ä¸æ¯åå®æ¶çï¼æ°æ®åå¥ 1 ç§åå¯ä»¥æç´¢å°ï¼å¯è½ä¼ä¸¢å¤±æ°æ®çãæ 5 ç§çæ°æ®ï¼åçå¨ bufferãtranslog os cacheãsegment file os cache ä¸­ï¼èä¸å¨ç£çä¸ï¼æ­¤æ¶å¦æå®æºï¼ä¼å¯¼è´ 5 ç§çæ°æ®ä¸¢å¤±ã\n\næ»ç»ä¸ä¸ï¼æ°æ®ååå¥åå­ bufferï¼ç¶åæ¯é 1sï¼å°æ°æ® refresh å° os cacheï¼å°äº os cache æ°æ®å°±è½è¢«æç´¢å°ï¼æä»¥æä»¬æè¯´ es ä»åå¥å°è½è¢«æç´¢å°ï¼ä¸­é´æ 1s çå»¶è¿ï¼ãæ¯é 5sï¼å°æ°æ®åå¥ translog æä»¶ï¼è¿æ ·å¦ææºå¨å®æºï¼åå­æ°æ®å¨æ²¡ï¼æå¤ä¼æ 5s çæ°æ®ä¸¢å¤±ï¼ï¼translog å¤§å°ä¸å®ç¨åº¦ï¼æèé»è®¤æ¯é 30minsï¼ä¼è§¦å commit æä½ï¼å°ç¼å²åºçæ°æ®é½ flush å° segment file ç£çæä»¶ä¸­ã\n\n> æ°æ®åå¥ segment file ä¹åï¼åæ¶å°±å»ºç«å¥½äºåæç´¢å¼ã\n\n# 2.2.4. å é¤/æ´æ°æ°æ®åºå±åç\n\nå¦ææ¯å é¤æä½ï¼commit çæ¶åä¼çæä¸ä¸ª .del æä»¶ï¼éé¢å°æä¸ª doc æ è¯ä¸º deleted ç¶æï¼é£ä¹æç´¢çæ¶åæ ¹æ® .del æä»¶å°±ç¥éè¿ä¸ª doc æ¯å¦è¢«å é¤äºã\n\nå¦ææ¯æ´æ°æä½ï¼å°±æ¯å°åæ¥ç doc æ è¯ä¸º deleted ç¶æï¼ç¶åæ°åå¥ä¸æ¡æ°æ®ã\n\nbuffer æ¯ refresh ä¸æ¬¡ï¼å°±ä¼äº§çä¸ä¸ª segment fileï¼æä»¥é»è®¤æåµä¸æ¯ 1 ç§éä¸ä¸ª segment fileï¼è¿æ ·ä¸æ¥ segment file ä¼è¶æ¥è¶å¤ï¼æ­¤æ¶ä¼å®ææ§è¡ mergeãæ¯æ¬¡ merge çæ¶åï¼ä¼å°å¤ä¸ª segment file åå¹¶æä¸ä¸ªï¼åæ¶è¿éä¼å°æ è¯ä¸º deleted ç doc ç»ç©çå é¤æï¼ç¶åå°æ°ç segment file åå¥ç£çï¼è¿éä¼åä¸ä¸ª commit pointï¼æ è¯æææ°ç segment fileï¼ç¶åæå¼ segment file ä¾æç´¢ä½¿ç¨ï¼åæ¶å é¤æ§ç segment fileã\n\n# 2.2.5. åºå± lucene\n\nç®åæ¥è¯´ï¼lucene å°±æ¯ä¸ä¸ª jar åï¼éé¢åå«äºå°è£å¥½çåç§å»ºç«åæç´¢å¼çç®æ³ä»£ç ãæä»¬ç¨ Java å¼åçæ¶åï¼å¼å¥ lucene jarï¼ç¶ååºäº lucene ç api å»å¼åå°±å¯ä»¥äºã\n\néè¿ luceneï¼æä»¬å¯ä»¥å°å·²æçæ°æ®å»ºç«ç´¢å¼ï¼lucene ä¼å¨æ¬å°ç£çä¸é¢ï¼ç»æä»¬ç»ç»ç´¢å¼çæ°æ®ç»æã\n\n# 2.2.6. åæç´¢å¼\n\nå¨æç´¢å¼æä¸­ï¼æ¯ä¸ªææ¡£é½æä¸ä¸ªå¯¹åºçææ¡£ IDï¼ææ¡£åå®¹è¢«è¡¨ç¤ºä¸ºä¸ç³»åå³é®è¯çéåãä¾å¦ï¼ææ¡£ 1 ç»è¿åè¯ï¼æåäº 20 ä¸ªå³é®è¯ï¼æ¯ä¸ªå³é®è¯é½ä¼è®°å½å®å¨ææ¡£ä¸­åºç°çæ¬¡æ°ååºç°ä½ç½®ã\n\né£ä¹ï¼åæç´¢å¼å°±æ¯å³é®è¯å°ææ¡£ ID çæ å°ï¼æ¯ä¸ªå³é®è¯é½å¯¹åºçä¸ç³»åçæä»¶ï¼è¿äºæä»¶ä¸­é½åºç°äºå³é®è¯ã\n\nä¸¾ä¸ªæ å­ã\n\næä»¥ä¸ææ¡£ï¼\n\nDOCID   DOC\n1       è°·æ­å°å¾ä¹ç¶è·³æ§½ Facebook\n2       è°·æ­å°å¾ä¹ç¶å ç Facebook\n3       è°·æ­å°å¾åå§äººææ¯ç¦»å¼è°·æ­å ç Facebook\n4       è°·æ­å°å¾ä¹ç¶è·³æ§½ Facebook ä¸ Wave é¡¹ç®åæ¶æå³\n5       è°·æ­å°å¾ä¹ç¶ææ¯å çç¤¾äº¤ç½ç« Facebook\n\nå¯¹ææ¡£è¿è¡åè¯ä¹åï¼å¾å°ä»¥ä¸åæç´¢å¼ã\n\nWORDID   WORD       DOCIDS\n1        è°·æ­         1,2,3,4,5\n2        å°å¾         1,2,3,4,5\n3        ä¹ç¶         1,2,4,5\n4        è·³æ§½         1,4\n5        Facebook   1,2,3,4,5\n6        å ç         2,3,5\n7        åå§äºº        3\n8        ææ¯         3,5\n9        ç¦»å¼         3\n10       ä¸          4\n..       ..         ..\n\nå¦å¤ï¼å®ç¨çåæç´¢å¼è¿å¯ä»¥è®°å½æ´å¤çä¿¡æ¯ï¼æ¯å¦ææ¡£é¢çä¿¡æ¯ï¼è¡¨ç¤ºå¨ææ¡£éåä¸­æå¤å°ä¸ªææ¡£åå«æä¸ªåè¯ã\n\né£ä¹ï¼æäºåæç´¢å¼ï¼æç´¢å¼æå¯ä»¥å¾æ¹ä¾¿å°ååºç¨æ·çæ¥è¯¢ãæ¯å¦ç¨æ·è¾å¥æ¥è¯¢ Facebookï¼æç´¢ç³»ç»æ¥æ¾åæç´¢å¼ï¼ä»ä¸­è¯»åºåå«è¿ä¸ªåè¯çææ¡£ï¼è¿äºææ¡£å°±æ¯æä¾ç»ç¨æ·çæç´¢ç»æã\n\nè¦æ³¨æåæç´¢å¼çä¸¤ä¸ªéè¦ç»èï¼\n\n * åæç´¢å¼ä¸­çææè¯é¡¹å¯¹åºä¸ä¸ªæå¤ä¸ªææ¡£ï¼\n * åæç´¢å¼ä¸­çè¯é¡¹æ ¹æ®å­å¸é¡ºåºååºæå\n\n> ä¸é¢åªæ¯ä¸ä¸ªç®åçæ å­ï¼å¹¶æ²¡æä¸¥æ ¼æç§å­å¸é¡ºåºååºæåã\n\n\n# 3. Logstash\n\n> Logstash æ¯å¼æºçæå¡å¨ç«¯æ°æ®å¤çç®¡éï¼è½å¤åæ¶ä»å¤ä¸ªæ¥æºééæ°æ®ï¼è½¬æ¢æ°æ®ï¼ç¶åå°æ°æ®åéå°æ¨æåæ¬¢çâå­å¨åºâä¸­ã\n\n\n# 3.1. Logstash ç®ä»\n\nLogstash å¯ä»¥ä¼ è¾åå¤çä½ çæ¥å¿ãäºå¡æå¶ä»æ°æ®ã\n\nLogstash æ¯ Elasticsearch çæä½³æ°æ®ç®¡éã\n\nLogstash æ¯æä»¶å¼ç®¡çæ¨¡å¼ï¼å¨è¾å¥ãè¿æ»¤ãè¾åºä»¥åç¼ç è¿ç¨ä¸­é½å¯ä»¥ä½¿ç¨æä»¶è¿è¡å®å¶ãLogstash ç¤¾åºæè¶è¿ 200 ç§å¯ç¨æä»¶ã\n\n\n# 3.2. Logstash åç\n\nLogstash æä¸¤ä¸ªå¿è¦åç´ ï¼input å output ï¼ä¸ä¸ªå¯éåç´ ï¼filterã\n\nè¿ä¸ä¸ªåç´ ï¼åå«ä»£è¡¨ Logstash äºä»¶å¤ççä¸ä¸ªé¶æ®µï¼è¾å¥ > è¿æ»¤å¨ > è¾åºã\n\n\n\n * input - è´è´£ä»æ°æ®æºééæ°æ®ã\n * filter - å°æ°æ®ä¿®æ¹ä¸ºä½ æå®çæ ¼å¼æåå®¹ã\n * output - å°æ°æ®ä¼ è¾å°ç®çå°ã\n\nå¨å®éåºç¨åºæ¯ä¸­ï¼éå¸¸è¾å¥ãè¾åºãè¿æ»¤å¨ä¸æ­¢ä¸ä¸ªãLogstash çè¿ä¸ä¸ªåç´ é½ä½¿ç¨æä»¶å¼ç®¡çæ¹å¼ï¼ç¨æ·å¯ä»¥æ ¹æ®åºç¨éè¦ï¼çµæ´»çéç¨åé¶æ®µéè¦çæä»¶ï¼å¹¶ç»åä½¿ç¨ã\n\n\n# 4. Beats\n\n> Beats æ¯å®è£å¨æå¡å¨ä¸çæ°æ®ä¸­è½¬ä»£çã\n> \n> Beats å¯ä»¥å°æ°æ®ç´æ¥ä¼ è¾å° Elasticsearch æä¼ è¾å° Logstash ã\n\n\n\nBeats æå¤ç§ç±»åï¼å¯ä»¥æ ¹æ®å®éåºç¨éè¦éæ©åéçç±»åã\n\nå¸¸ç¨çç±»åæï¼\n\n * **Packetbeatï¼**ç½ç»æ°æ®ååæå¨ï¼æä¾æå³æ¨çåºç¨ç¨åºæå¡å¨ä¹é´äº¤æ¢çäºå¡çä¿¡æ¯ã\n * **Filebeatï¼**ä»æ¨çæå¡å¨åéæ¥å¿æä»¶ã\n * **Metricbeatï¼**æ¯ä¸ä¸ªæå¡å¨çè§ä»£çç¨åºï¼å®å®æä»æå¡å¨ä¸è¿è¡çæä½ç³»ç»åæå¡æ¶éææ ã\n * **Winlogbeatï¼**æä¾ Windows äºä»¶æ¥å¿ã\n\n\n# 4.1. Filebeat ç®ä»\n\n> ç±äºæ¬äººä»æ¥è§¦è¿ Filebeatï¼æä»¥æ¬æåªä»ç» Beats ç»ä»¶ä¸­ç Filebeatã\n\nç¸æ¯ Logstashï¼FileBeat æ´å è½»éåã\n\nå¨ä»»ä½ç¯å¢ä¸ï¼åºç¨ç¨åºé½æåæºçå¯è½æ§ã Filebeat è¯»åå¹¶è½¬åæ¥å¿è¡ï¼å¦æä¸­æ­ï¼åä¼è®°ä½ææäºä»¶æ¢å¤èæºç¶ææ¶æå¨ä½ç½®ã\n\nFilebeat å¸¦æåé¨æ¨¡åï¼auditdï¼Apacheï¼Nginxï¼System å MySQLï¼ï¼å¯éè¿ä¸ä¸ªæå®å½ä»¤æ¥ç®åéç¨æ¥å¿æ ¼å¼çæ¶éï¼è§£æåå¯è§åã\n\nFileBeat ä¸ä¼è®©ä½ çç®¡éè¶è´è·ãFileBeat å¦ææ¯å Logstash ä¼ è¾æ°æ®ï¼å½ Logstash å¿äºå¤çæ°æ®ï¼ä¼éç¥ FileBeat æ¾æ¢è¯»åéåº¦ãä¸æ¦æ¥å¡å¾å°è§£å³ï¼FileBeat å°æ¢å¤å°åæ¥çéåº¦å¹¶ç»§ç»­ä¼ æ­ã\n\n\n\n\n# 4.2. Filebeat åç\n\nFilebeat æä¸¤ä¸ªä¸»è¦ç»ä»¶ï¼\n\n * harvesterï¼è´è´£è¯»åä¸ä¸ªæä»¶çåå®¹ãå®ä¼éè¡è¯»åæä»¶åå®¹ï¼å¹¶å°åå®¹åéå°è¾åºç®çå°ã\n * prospectorï¼è´è´£ç®¡ç harvester å¹¶æ¾å°ææéè¦è¯»åçæä»¶æºãæ¯å¦ç±»åæ¯æ¥å¿ï¼prospector å°±ä¼éåå¶å®è·¯å¾ä¸çææå¹éè¦æ±çæä»¶ã\n\nfilebeat.prospectors:\n  - type: log\n    paths:\n      - /var/log/*.log\n      - /var/path2/*.log\n\n\nFilebeat ä¿ææ¯ä¸ªæä»¶çç¶æï¼å¹¶ç»å¸¸å·æ°æ³¨åè¡¨æä»¶ä¸­çç£çç¶æãç¶æç¨äºè®°ä½ harvester æ­£å¨è¯»åçæååç§»éï¼å¹¶ç¡®ä¿åéæææ¥å¿è¡ã\n\nFilebeat å°æ¯ä¸ªäºä»¶çä¼ éç¶æå­å¨å¨æ³¨åè¡¨æä»¶ä¸­ãæä»¥å®è½ä¿è¯äºä»¶è³å°ä¼ éä¸æ¬¡å°éç½®çè¾åºï¼æ²¡ææ°æ®ä¸¢å¤±ã\n\n\n# 5. è¿ç»´\n\n * ElasticSearch è¿ç»´\n * Logstash è¿ç»´\n * Kibana è¿ç»´\n * Beats è¿ç»´\n\n\n# 6. åèèµæ\n\n * å®æ¹èµæº\n   * Elasticsearch å®ç½\n   * Elasticsearch Github\n   * Elasticsearch å®æ¹ææ¡£\n   * Logstash å®ç½\n   * Logstash Github\n   * Logstash å®æ¹ææ¡£\n   * Kibana å®ç½\n   * Kibana Github\n   * Kibana å®æ¹ææ¡£\n   * Beats å®ç½\n   * Beats Github\n   * Beats å®æ¹ææ¡£\n * æç« \n   * ä»ä¹æ¯ ELK Stackï¼\n   * https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/es-introduction.md\n   * es-write-query-search",normalizedContent:"# elastic å¿«éå¥é¨\n\n> å¼æºåè®®ï¼apache 2.0\n\n\n# 1. ç®ä»\n\n\n# 1.1. elastic stack æ¯ä»ä¹\n\nelastic stack å³ elk stackã\n\nelk æ¯æ elastic å¬å¸æä¸ä¸æ¬¾äº§å elasticsearch ãlogstash ãkibana çé¦å­æ¯ç»åã\n\n * elasticsearch æ¯ä¸ä¸ªæç´¢ååæå¼æã\n * logstash æ¯æå¡å¨ç«¯æ°æ®å¤çç®¡éï¼è½å¤åæ¶ä»å¤ä¸ªæ¥æºééæ°æ®ï¼è½¬æ¢æ°æ®ï¼ç¶åå°æ°æ®åéå°è¯¸å¦ elasticsearch ç­âå­å¨åºâä¸­ã\n * kibana åå¯ä»¥è®©ç¨æ·å¨ elasticsearch ä¸­ä½¿ç¨å¾å½¢åå¾è¡¨å¯¹æ°æ®è¿è¡å¯è§åã\n\nè elastic stack æ¯ elk stack çæ´æ°æ¢ä»£äº§åï¼ææ°äº§åå¼å¥äºè½»éåçåä¸åè½æ°æ®ééå¨ï¼å¹¶æå®ä»¬å«å beatsã\n\n\n# 1.2. ä¸ºä»ä¹ä½¿ç¨ elastic stack\n\nå¯¹äºæä¸å®è§æ¨¡çå¬å¸æ¥è¯´ï¼éå¸¸ä¼å¾å¤ä¸ªåºç¨ï¼å¹¶é¨ç½²å¨å¤§éçæå¡å¨ä¸ãè¿ç»´åå¼åäººåå¸¸å¸¸éè¦éè¿æ¥çæ¥å¿æ¥å®ä½é®é¢ãå¦æåºç¨æ¯éç¾¤åé¨ç½²ï¼è¯æ³å¦æç»å½ä¸å°å°æå¡å¨å»æ¥çæ¥å¿ï¼æ¯å¤ä¹è´¹æ¶è´¹åã\n\nèéè¿ elk è¿å¥è§£å³æ¹æ¡ï¼å¯ä»¥åæ¶å®ç°æ¥å¿æ¶éãæ¥å¿æç´¢åæ¥å¿åæçåè½ã\n\n\n# 1.3. elastic stack æ¶æ\n\n\n\n> è¯´æ\n> \n> ä»¥ä¸æ¯ elastic stack çä¸ä¸ªæ¶æå¾ãä»å¾ä¸­å¯ä»¥æ¸æ¥ççå°æ°æ®æµåã\n> \n>  * beats æ¯åä¸ç¨éçæ°æ®ä¼ è¾å¹³å°ï¼å®å¯ä»¥å°å¤å°æºå¨çæ°æ®åéå° logstash æ elasticsearchãä½ beats å¹¶ä¸æ¯ä¸å¯æç¼ºçä¸ç¯ï¼æä»¥æ¬æä¸­æä¸ä»ç»ã\n> \n>  * logstash æ¯ä¸ä¸ªå¨ææ°æ®æ¶éç®¡éãæ¯æä»¥ tcp/udp/http å¤ç§æ¹å¼æ¶éæ°æ®ï¼ä¹å¯ä»¥æ¥å beats ä¼ è¾æ¥çæ°æ®ï¼ï¼å¹¶å¯¹æ°æ®åè¿ä¸æ­¥ä¸°å¯ææåå­æ®µå¤çã\n> \n>  * elasticsearch æ¯ä¸ä¸ªåºäº json çåå¸å¼çæç´¢ååæå¼æãä½ä¸º elk çæ ¸å¿ï¼å®éä¸­å­å¨æ°æ®ã\n> \n>  * kibana æ¯ elk çç¨æ·çé¢ãå®å°æ¶éçæ°æ®è¿è¡å¯è§åå±ç¤ºï¼åç§æ¥è¡¨ãå¾å½¢åæ°æ®ï¼ï¼å¹¶æä¾éç½®ãç®¡ç elk ççé¢ã\n\n\n# 2. elasticsearch\n\n> elasticsearch æ¯ä¸ä¸ªåå¸å¼ãrestful é£æ ¼çæç´¢åæ°æ®åæå¼æï¼è½å¤è§£å³ä¸æ­æ¶ç°åºçåç§ç¨ä¾ã ä½ä¸º elastic stack çæ ¸å¿ï¼å®éä¸­å­å¨æ¨çæ°æ®ï¼å¸®å©æ¨åç°ææä¹ä¸­ä»¥åææä¹å¤çæåµã\n\n\n# 2.1. elasticsearch ç®ä»\n\nelasticsearch åºäºæç´¢åº lucene å¼åãelasticsearch éèäº lucene çå¤ææ§ï¼æä¾äºç®åæç¨ç rest api / java api æ¥å£ï¼å¦å¤è¿æå¶ä»è¯­è¨ç api æ¥å£ï¼ã\n\nelasticsearch å¯ä»¥è§ä¸ºä¸ä¸ªææ¡£å­å¨ï¼å®å°å¤ææ°æ®ç»æåºååä¸º json å­å¨ã\n\nelasticsearch æ¯è¿ä¹äºå®æ¶çå¨ææç´ ï¼è¿æ¯æï¼\n\n * ä»åå¥æ°æ®å°æ°æ®å¯ä»¥è¢«æç´¢ï¼å­å¨è¾å°çå»¶è¿ï¼å¤§æ¦æ¯ 1sï¼\n * åºäº es æ§è¡æç´¢ååæå¯ä»¥è¾¾å°ç§çº§\n\n# 2.1.1. æ ¸å¿æ¦å¿µ\n\n * ç´¢å¼ï¼indexï¼ å¯ä»¥è®¤ä¸ºæ¯ææ¡£ï¼documentï¼çä¼åéåã\n * æ¯ä¸ª ææ¡£ï¼documentï¼ é½æ¯å­æ®µï¼fieldï¼çéåã\n * å­æ®µï¼fieldï¼ æ¯åå«æ°æ®çé®å¼å¯¹ã\n * é»è®¤æåµä¸ï¼elasticsearch å¯¹æ¯ä¸ªå­æ®µä¸­çæææ°æ®å»ºç«ç´¢å¼ï¼å¹¶ä¸æ¯ä¸ªç´¢å¼å­æ®µé½å·æä¸ç¨çä¼åæ°æ®ç»æã\n * æ¯ä¸ªç´¢å¼éå¯ä»¥æä¸ä¸ªæèå¤ä¸ªç±»åï¼typeï¼ãç±»åï¼typeï¼ æ¯ index çä¸ä¸ªé»è¾åç±»ï¼\n * å½åå°æºå¨ä¸è¶³ä»¥å­å¨å¤§éæ°æ®æ¶ï¼elasticsearch å¯ä»¥å°ä¸ä¸ªç´¢å¼ä¸­çæ°æ®ååä¸ºå¤ä¸ª åçï¼shardï¼ ã åçï¼shardï¼ åå¸å¨å¤å°æå¡å¨ä¸å­å¨ãæäº shard å°±å¯ä»¥æ¨ªåæ©å±ï¼å­å¨æ´å¤æ°æ®ï¼è®©æç´¢ååæç­æä½åå¸å°å¤å°æå¡å¨ä¸å»æ§è¡ï¼æåååéåæ§è½ãæ¯ä¸ª shard é½æ¯ä¸ä¸ª lucene indexã\n * ä»»ä½ä¸ä¸ªæå¡å¨éæ¶å¯è½æéæå®æºï¼æ­¤æ¶ shard å¯è½å°±ä¼ä¸¢å¤±ï¼å æ­¤å¯ä»¥ä¸ºæ¯ä¸ª shard åå»ºå¤ä¸ª å¯æ¬ï¼replicaï¼ãreplica å¯ä»¥å¨ shard æéæ¶æä¾å¤ç¨æå¡ï¼ä¿è¯æ°æ®ä¸ä¸¢å¤±ï¼å¤ä¸ª replica è¿å¯ä»¥æåæç´¢æä½çååéåæ§è½ãprimary shardï¼å»ºç«ç´¢å¼æ¶ä¸æ¬¡è®¾ç½®ï¼ä¸è½ä¿®æ¹ï¼é»è®¤ 5 ä¸ªï¼ï¼replica shardï¼éæ¶ä¿®æ¹æ°éï¼é»è®¤ 1 ä¸ªï¼ï¼é»è®¤æ¯ä¸ªç´¢å¼ 10 ä¸ª shardï¼5 ä¸ª primary shardï¼5 ä¸ª replica shardï¼æå°çé«å¯ç¨éç½®ï¼æ¯ 2 å°æå¡å¨ã\n\n\n# 2.2. elasticsearch åç\n\n# 2.2.1. es åæ°æ®è¿ç¨\n\n * å®¢æ·ç«¯éæ©ä¸ä¸ª node åéè¯·æ±è¿å»ï¼è¿ä¸ª node å°±æ¯ coordinating nodeï¼åè°èç¹ï¼ã\n * coordinating node å¯¹ document è¿è¡è·¯ç±ï¼å°è¯·æ±è½¬åç»å¯¹åºç nodeï¼æ primary shardï¼ã\n * å®éç node ä¸ç primary shard å¤çè¯·æ±ï¼ç¶åå°æ°æ®åæ­¥å° replica nodeã\n * coordinating node å¦æåç° primary node åææ replica node é½æå®ä¹åï¼å°±è¿åååºç»æç»å®¢æ·ç«¯ã\n\n\n\n# 2.2.2. es è¯»æ°æ®è¿ç¨\n\nå¯ä»¥éè¿ doc id æ¥æ¥è¯¢ï¼ä¼æ ¹æ® doc id è¿è¡ hashï¼å¤æ­åºæ¥å½æ¶æ doc id åéå°äºåªä¸ª shard ä¸é¢å»ï¼ä»é£ä¸ª shard å»æ¥è¯¢ã\n\n * å®¢æ·ç«¯åéè¯·æ±å°ä»»æä¸ä¸ª nodeï¼æä¸º coordinate nodeã\n * coordinate node å¯¹ doc id è¿è¡åå¸è·¯ç±ï¼å°è¯·æ±è½¬åå°å¯¹åºç nodeï¼æ­¤æ¶ä¼ä½¿ç¨ round-robin éæºè½®è¯¢ç®æ³ï¼å¨ primary shard ä»¥åå¶ææ replica ä¸­éæºéæ©ä¸ä¸ªï¼è®©è¯»è¯·æ±è´è½½åè¡¡ã\n * æ¥æ¶è¯·æ±ç node è¿å document ç» coordinate nodeã\n * coordinate node è¿å document ç»å®¢æ·ç«¯ã\n\n# 2.2.3. åæ°æ®åºå±åç\n\n\n\nååå¥åå­ bufferï¼å¨ buffer éçæ¶åæ°æ®æ¯æç´¢ä¸å°çï¼åæ¶å°æ°æ®åå¥ translog æ¥å¿æä»¶ã\n\nå¦æ buffer å¿«æ»¡äºï¼æèå°ä¸å®æ¶é´ï¼å°±ä¼å°åå­ buffer æ°æ® refresh å°ä¸ä¸ªæ°ç segment file ä¸­ï¼ä½æ¯æ­¤æ¶æ°æ®ä¸æ¯ç´æ¥è¿å¥ segment file ç£çæä»¶ï¼èæ¯åè¿å¥ os cache ãè¿ä¸ªè¿ç¨å°±æ¯ refreshã\n\næ¯é 1 ç§éï¼es å° buffer ä¸­çæ°æ®åå¥ä¸ä¸ªæ°ç segment fileï¼æ¯ç§éä¼äº§çä¸ä¸ªæ°çç£çæä»¶ segment fileï¼è¿ä¸ª segment file ä¸­å°±å­å¨æè¿ 1 ç§å buffer ä¸­åå¥çæ°æ®ã\n\nä½æ¯å¦æ buffer éé¢æ­¤æ¶æ²¡ææ°æ®ï¼é£å½ç¶ä¸ä¼æ§è¡ refresh æä½ï¼å¦æ buffer éé¢ææ°æ®ï¼é»è®¤ 1 ç§éæ§è¡ä¸æ¬¡ refresh æä½ï¼å·å¥ä¸ä¸ªæ°ç segment file ä¸­ã\n\næä½ç³»ç»éé¢ï¼ç£çæä»¶å¶å®é½æä¸ä¸ªä¸è¥¿ï¼å«å os cacheï¼å³æä½ç³»ç»ç¼å­ï¼å°±æ¯è¯´æ°æ®åå¥ç£çæä»¶ä¹åï¼ä¼åè¿å¥ os cacheï¼åè¿å¥æä½ç³»ç»çº§å«çä¸ä¸ªåå­ç¼å­ä¸­å»ãåªè¦ buffer ä¸­çæ°æ®è¢« refresh æä½å·å¥ os cacheä¸­ï¼è¿ä¸ªæ°æ®å°±å¯ä»¥è¢«æç´¢å°äºã\n\nä¸ºä»ä¹å« es æ¯åå®æ¶çï¼ nrtï¼å¨ç§° near real-timeãé»è®¤æ¯æ¯é 1 ç§ refresh ä¸æ¬¡çï¼æä»¥ es æ¯åå®æ¶çï¼å ä¸ºåå¥çæ°æ® 1 ç§ä¹åæè½è¢«çå°ãå¯ä»¥éè¿ es ç restful api æè java apiï¼æå¨æ§è¡ä¸æ¬¡ refresh æä½ï¼å°±æ¯æå¨å° buffer ä¸­çæ°æ®å·å¥ os cacheä¸­ï¼è®©æ°æ®ç«é©¬å°±å¯ä»¥è¢«æç´¢å°ãåªè¦æ°æ®è¢«è¾å¥ os cache ä¸­ï¼buffer å°±ä¼è¢«æ¸ç©ºäºï¼å ä¸ºä¸éè¦ä¿ç buffer äºï¼æ°æ®å¨ translog éé¢å·²ç»æä¹åå°ç£çå»ä¸ä»½äºã\n\néå¤ä¸é¢çæ­¥éª¤ï¼æ°çæ°æ®ä¸æ­è¿å¥ buffer å translogï¼ä¸æ­å° buffer æ°æ®åå¥ä¸ä¸ªåä¸ä¸ªæ°ç segment file ä¸­å»ï¼æ¯æ¬¡ refresh å® buffer æ¸ç©ºï¼translog ä¿çãéçè¿ä¸ªè¿ç¨æ¨è¿ï¼translog ä¼åå¾è¶æ¥è¶å¤§ãå½ translog è¾¾å°ä¸å®é¿åº¦çæ¶åï¼å°±ä¼è§¦å commit æä½ã\n\ncommit æä½åçç¬¬ä¸æ­¥ï¼å°±æ¯å° buffer ä¸­ç°ææ°æ® refresh å° os cache ä¸­å»ï¼æ¸ç©º bufferãç¶åï¼å°ä¸ä¸ª commit point åå¥ç£çæä»¶ï¼éé¢æ è¯çè¿ä¸ª commit point å¯¹åºçææ segment fileï¼åæ¶å¼ºè¡å° os cache ä¸­ç®åææçæ°æ®é½ fsync å°ç£çæä»¶ä¸­å»ãæåæ¸ç©º ç°æ translog æ¥å¿æä»¶ï¼éå¯ä¸ä¸ª translogï¼æ­¤æ¶ commit æä½å®æã\n\nè¿ä¸ª commit æä½å«å flushãé»è®¤ 30 åéèªå¨æ§è¡ä¸æ¬¡ flushï¼ä½å¦æ translog è¿å¤§ï¼ä¹ä¼è§¦å flushãflush æä½å°±å¯¹åºç commit çå¨è¿ç¨ï¼æä»¬å¯ä»¥éè¿ es apiï¼æå¨æ§è¡ flush æä½ï¼æå¨å° os cache ä¸­çæ°æ® fsync å¼ºå·å°ç£çä¸å»ã\n\ntranslog æ¥å¿æä»¶çä½ç¨æ¯ä»ä¹ï¼ä½ æ§è¡ commit æä½ä¹åï¼æ°æ®è¦ä¹æ¯åçå¨ buffer ä¸­ï¼è¦ä¹æ¯åçå¨ os cache ä¸­ï¼æ è®ºæ¯ buffer è¿æ¯ os cache é½æ¯åå­ï¼ä¸æ¦è¿å°æºå¨æ­»äºï¼åå­ä¸­çæ°æ®å°±å¨ä¸¢äºãæä»¥éè¦å°æ°æ®å¯¹åºçæä½åå¥ä¸ä¸ªä¸é¨çæ¥å¿æä»¶ translog ä¸­ï¼ä¸æ¦æ­¤æ¶æºå¨å®æºï¼åæ¬¡éå¯çæ¶åï¼es ä¼èªå¨è¯»å translog æ¥å¿æä»¶ä¸­çæ°æ®ï¼æ¢å¤å°åå­ buffer å os cache ä¸­å»ã\n\ntranslog å¶å®ä¹æ¯ååå¥ os cache çï¼é»è®¤æ¯é 5 ç§å·ä¸æ¬¡å°ç£çä¸­å»ï¼æä»¥é»è®¤æåµä¸ï¼å¯è½æ 5 ç§çæ°æ®ä¼ä»ä»åçå¨ buffer æè translog æä»¶ç os cache ä¸­ï¼å¦ææ­¤æ¶æºå¨æäºï¼ä¼ä¸¢å¤± 5 ç§éçæ°æ®ãä½æ¯è¿æ ·æ§è½æ¯è¾å¥½ï¼æå¤ä¸¢ 5 ç§çæ°æ®ãä¹å¯ä»¥å° translog è®¾ç½®ææ¯æ¬¡åæä½å¿é¡»æ¯ç´æ¥ fsync å°ç£çï¼ä½æ¯æ§è½ä¼å·®å¾å¤ã\n\nå®éä¸ä½ å¨è¿éï¼å¦æé¢è¯å®æ²¡æé®ä½  es ä¸¢æ°æ®çé®é¢ï¼ä½ å¯ä»¥å¨è¿éç»é¢è¯å®ç«ä¸æï¼ä½ è¯´ï¼å¶å® es ç¬¬ä¸æ¯åå®æ¶çï¼æ°æ®åå¥ 1 ç§åå¯ä»¥æç´¢å°ï¼å¯è½ä¼ä¸¢å¤±æ°æ®çãæ 5 ç§çæ°æ®ï¼åçå¨ bufferãtranslog os cacheãsegment file os cache ä¸­ï¼èä¸å¨ç£çä¸ï¼æ­¤æ¶å¦æå®æºï¼ä¼å¯¼è´ 5 ç§çæ°æ®ä¸¢å¤±ã\n\næ»ç»ä¸ä¸ï¼æ°æ®ååå¥åå­ bufferï¼ç¶åæ¯é 1sï¼å°æ°æ® refresh å° os cacheï¼å°äº os cache æ°æ®å°±è½è¢«æç´¢å°ï¼æä»¥æä»¬æè¯´ es ä»åå¥å°è½è¢«æç´¢å°ï¼ä¸­é´æ 1s çå»¶è¿ï¼ãæ¯é 5sï¼å°æ°æ®åå¥ translog æä»¶ï¼è¿æ ·å¦ææºå¨å®æºï¼åå­æ°æ®å¨æ²¡ï¼æå¤ä¼æ 5s çæ°æ®ä¸¢å¤±ï¼ï¼translog å¤§å°ä¸å®ç¨åº¦ï¼æèé»è®¤æ¯é 30minsï¼ä¼è§¦å commit æä½ï¼å°ç¼å²åºçæ°æ®é½ flush å° segment file ç£çæä»¶ä¸­ã\n\n> æ°æ®åå¥ segment file ä¹åï¼åæ¶å°±å»ºç«å¥½äºåæç´¢å¼ã\n\n# 2.2.4. å é¤/æ´æ°æ°æ®åºå±åç\n\nå¦ææ¯å é¤æä½ï¼commit çæ¶åä¼çæä¸ä¸ª .del æä»¶ï¼éé¢å°æä¸ª doc æ è¯ä¸º deleted ç¶æï¼é£ä¹æç´¢çæ¶åæ ¹æ® .del æä»¶å°±ç¥éè¿ä¸ª doc æ¯å¦è¢«å é¤äºã\n\nå¦ææ¯æ´æ°æä½ï¼å°±æ¯å°åæ¥ç doc æ è¯ä¸º deleted ç¶æï¼ç¶åæ°åå¥ä¸æ¡æ°æ®ã\n\nbuffer æ¯ refresh ä¸æ¬¡ï¼å°±ä¼äº§çä¸ä¸ª segment fileï¼æä»¥é»è®¤æåµä¸æ¯ 1 ç§éä¸ä¸ª segment fileï¼è¿æ ·ä¸æ¥ segment file ä¼è¶æ¥è¶å¤ï¼æ­¤æ¶ä¼å®ææ§è¡ mergeãæ¯æ¬¡ merge çæ¶åï¼ä¼å°å¤ä¸ª segment file åå¹¶æä¸ä¸ªï¼åæ¶è¿éä¼å°æ è¯ä¸º deleted ç doc ç»ç©çå é¤æï¼ç¶åå°æ°ç segment file åå¥ç£çï¼è¿éä¼åä¸ä¸ª commit pointï¼æ è¯æææ°ç segment fileï¼ç¶åæå¼ segment file ä¾æç´¢ä½¿ç¨ï¼åæ¶å é¤æ§ç segment fileã\n\n# 2.2.5. åºå± lucene\n\nç®åæ¥è¯´ï¼lucene å°±æ¯ä¸ä¸ª jar åï¼éé¢åå«äºå°è£å¥½çåç§å»ºç«åæç´¢å¼çç®æ³ä»£ç ãæä»¬ç¨ java å¼åçæ¶åï¼å¼å¥ lucene jarï¼ç¶ååºäº lucene ç api å»å¼åå°±å¯ä»¥äºã\n\néè¿ luceneï¼æä»¬å¯ä»¥å°å·²æçæ°æ®å»ºç«ç´¢å¼ï¼lucene ä¼å¨æ¬å°ç£çä¸é¢ï¼ç»æä»¬ç»ç»ç´¢å¼çæ°æ®ç»æã\n\n# 2.2.6. åæç´¢å¼\n\nå¨æç´¢å¼æä¸­ï¼æ¯ä¸ªææ¡£é½æä¸ä¸ªå¯¹åºçææ¡£ idï¼ææ¡£åå®¹è¢«è¡¨ç¤ºä¸ºä¸ç³»åå³é®è¯çéåãä¾å¦ï¼ææ¡£ 1 ç»è¿åè¯ï¼æåäº 20 ä¸ªå³é®è¯ï¼æ¯ä¸ªå³é®è¯é½ä¼è®°å½å®å¨ææ¡£ä¸­åºç°çæ¬¡æ°ååºç°ä½ç½®ã\n\né£ä¹ï¼åæç´¢å¼å°±æ¯å³é®è¯å°ææ¡£ id çæ å°ï¼æ¯ä¸ªå³é®è¯é½å¯¹åºçä¸ç³»åçæä»¶ï¼è¿äºæä»¶ä¸­é½åºç°äºå³é®è¯ã\n\nä¸¾ä¸ªæ å­ã\n\næä»¥ä¸ææ¡£ï¼\n\ndocid   doc\n1       è°·æ­å°å¾ä¹ç¶è·³æ§½ facebook\n2       è°·æ­å°å¾ä¹ç¶å ç facebook\n3       è°·æ­å°å¾åå§äººææ¯ç¦»å¼è°·æ­å ç facebook\n4       è°·æ­å°å¾ä¹ç¶è·³æ§½ facebook ä¸ wave é¡¹ç®åæ¶æå³\n5       è°·æ­å°å¾ä¹ç¶ææ¯å çç¤¾äº¤ç½ç« facebook\n\nå¯¹ææ¡£è¿è¡åè¯ä¹åï¼å¾å°ä»¥ä¸åæç´¢å¼ã\n\nwordid   word       docids\n1        è°·æ­         1,2,3,4,5\n2        å°å¾         1,2,3,4,5\n3        ä¹ç¶         1,2,4,5\n4        è·³æ§½         1,4\n5        facebook   1,2,3,4,5\n6        å ç         2,3,5\n7        åå§äºº        3\n8        ææ¯         3,5\n9        ç¦»å¼         3\n10       ä¸          4\n..       ..         ..\n\nå¦å¤ï¼å®ç¨çåæç´¢å¼è¿å¯ä»¥è®°å½æ´å¤çä¿¡æ¯ï¼æ¯å¦ææ¡£é¢çä¿¡æ¯ï¼è¡¨ç¤ºå¨ææ¡£éåä¸­æå¤å°ä¸ªææ¡£åå«æä¸ªåè¯ã\n\né£ä¹ï¼æäºåæç´¢å¼ï¼æç´¢å¼æå¯ä»¥å¾æ¹ä¾¿å°ååºç¨æ·çæ¥è¯¢ãæ¯å¦ç¨æ·è¾å¥æ¥è¯¢ facebookï¼æç´¢ç³»ç»æ¥æ¾åæç´¢å¼ï¼ä»ä¸­è¯»åºåå«è¿ä¸ªåè¯çææ¡£ï¼è¿äºææ¡£å°±æ¯æä¾ç»ç¨æ·çæç´¢ç»æã\n\nè¦æ³¨æåæç´¢å¼çä¸¤ä¸ªéè¦ç»èï¼\n\n * åæç´¢å¼ä¸­çææè¯é¡¹å¯¹åºä¸ä¸ªæå¤ä¸ªææ¡£ï¼\n * åæç´¢å¼ä¸­çè¯é¡¹æ ¹æ®å­å¸é¡ºåºååºæå\n\n> ä¸é¢åªæ¯ä¸ä¸ªç®åçæ å­ï¼å¹¶æ²¡æä¸¥æ ¼æç§å­å¸é¡ºåºååºæåã\n\n\n# 3. logstash\n\n> logstash æ¯å¼æºçæå¡å¨ç«¯æ°æ®å¤çç®¡éï¼è½å¤åæ¶ä»å¤ä¸ªæ¥æºééæ°æ®ï¼è½¬æ¢æ°æ®ï¼ç¶åå°æ°æ®åéå°æ¨æåæ¬¢çâå­å¨åºâä¸­ã\n\n\n# 3.1. logstash ç®ä»\n\nlogstash å¯ä»¥ä¼ è¾åå¤çä½ çæ¥å¿ãäºå¡æå¶ä»æ°æ®ã\n\nlogstash æ¯ elasticsearch çæä½³æ°æ®ç®¡éã\n\nlogstash æ¯æä»¶å¼ç®¡çæ¨¡å¼ï¼å¨è¾å¥ãè¿æ»¤ãè¾åºä»¥åç¼ç è¿ç¨ä¸­é½å¯ä»¥ä½¿ç¨æä»¶è¿è¡å®å¶ãlogstash ç¤¾åºæè¶è¿ 200 ç§å¯ç¨æä»¶ã\n\n\n# 3.2. logstash åç\n\nlogstash æä¸¤ä¸ªå¿è¦åç´ ï¼input å output ï¼ä¸ä¸ªå¯éåç´ ï¼filterã\n\nè¿ä¸ä¸ªåç´ ï¼åå«ä»£è¡¨ logstash äºä»¶å¤ççä¸ä¸ªé¶æ®µï¼è¾å¥ > è¿æ»¤å¨ > è¾åºã\n\n\n\n * input - è´è´£ä»æ°æ®æºééæ°æ®ã\n * filter - å°æ°æ®ä¿®æ¹ä¸ºä½ æå®çæ ¼å¼æåå®¹ã\n * output - å°æ°æ®ä¼ è¾å°ç®çå°ã\n\nå¨å®éåºç¨åºæ¯ä¸­ï¼éå¸¸è¾å¥ãè¾åºãè¿æ»¤å¨ä¸æ­¢ä¸ä¸ªãlogstash çè¿ä¸ä¸ªåç´ é½ä½¿ç¨æä»¶å¼ç®¡çæ¹å¼ï¼ç¨æ·å¯ä»¥æ ¹æ®åºç¨éè¦ï¼çµæ´»çéç¨åé¶æ®µéè¦çæä»¶ï¼å¹¶ç»åä½¿ç¨ã\n\n\n# 4. beats\n\n> beats æ¯å®è£å¨æå¡å¨ä¸çæ°æ®ä¸­è½¬ä»£çã\n> \n> beats å¯ä»¥å°æ°æ®ç´æ¥ä¼ è¾å° elasticsearch æä¼ è¾å° logstash ã\n\n\n\nbeats æå¤ç§ç±»åï¼å¯ä»¥æ ¹æ®å®éåºç¨éè¦éæ©åéçç±»åã\n\nå¸¸ç¨çç±»åæï¼\n\n * **packetbeatï¼**ç½ç»æ°æ®ååæå¨ï¼æä¾æå³æ¨çåºç¨ç¨åºæå¡å¨ä¹é´äº¤æ¢çäºå¡çä¿¡æ¯ã\n * **filebeatï¼**ä»æ¨çæå¡å¨åéæ¥å¿æä»¶ã\n * **metricbeatï¼**æ¯ä¸ä¸ªæå¡å¨çè§ä»£çç¨åºï¼å®å®æä»æå¡å¨ä¸è¿è¡çæä½ç³»ç»åæå¡æ¶éææ ã\n * **winlogbeatï¼**æä¾ windows äºä»¶æ¥å¿ã\n\n\n# 4.1. filebeat ç®ä»\n\n> ç±äºæ¬äººä»æ¥è§¦è¿ filebeatï¼æä»¥æ¬æåªä»ç» beats ç»ä»¶ä¸­ç filebeatã\n\nç¸æ¯ logstashï¼filebeat æ´å è½»éåã\n\nå¨ä»»ä½ç¯å¢ä¸ï¼åºç¨ç¨åºé½æåæºçå¯è½æ§ã filebeat è¯»åå¹¶è½¬åæ¥å¿è¡ï¼å¦æä¸­æ­ï¼åä¼è®°ä½ææäºä»¶æ¢å¤èæºç¶ææ¶æå¨ä½ç½®ã\n\nfilebeat å¸¦æåé¨æ¨¡åï¼auditdï¼apacheï¼nginxï¼system å mysqlï¼ï¼å¯éè¿ä¸ä¸ªæå®å½ä»¤æ¥ç®åéç¨æ¥å¿æ ¼å¼çæ¶éï¼è§£æåå¯è§åã\n\nfilebeat ä¸ä¼è®©ä½ çç®¡éè¶è´è·ãfilebeat å¦ææ¯å logstash ä¼ è¾æ°æ®ï¼å½ logstash å¿äºå¤çæ°æ®ï¼ä¼éç¥ filebeat æ¾æ¢è¯»åéåº¦ãä¸æ¦æ¥å¡å¾å°è§£å³ï¼filebeat å°æ¢å¤å°åæ¥çéåº¦å¹¶ç»§ç»­ä¼ æ­ã\n\n\n\n\n# 4.2. filebeat åç\n\nfilebeat æä¸¤ä¸ªä¸»è¦ç»ä»¶ï¼\n\n * harvesterï¼è´è´£è¯»åä¸ä¸ªæä»¶çåå®¹ãå®ä¼éè¡è¯»åæä»¶åå®¹ï¼å¹¶å°åå®¹åéå°è¾åºç®çå°ã\n * prospectorï¼è´è´£ç®¡ç harvester å¹¶æ¾å°ææéè¦è¯»åçæä»¶æºãæ¯å¦ç±»åæ¯æ¥å¿ï¼prospector å°±ä¼éåå¶å®è·¯å¾ä¸çææå¹éè¦æ±çæä»¶ã\n\nfilebeat.prospectors:\n  - type: log\n    paths:\n      - /var/log/*.log\n      - /var/path2/*.log\n\n\nfilebeat ä¿ææ¯ä¸ªæä»¶çç¶æï¼å¹¶ç»å¸¸å·æ°æ³¨åè¡¨æä»¶ä¸­çç£çç¶æãç¶æç¨äºè®°ä½ harvester æ­£å¨è¯»åçæååç§»éï¼å¹¶ç¡®ä¿åéæææ¥å¿è¡ã\n\nfilebeat å°æ¯ä¸ªäºä»¶çä¼ éç¶æå­å¨å¨æ³¨åè¡¨æä»¶ä¸­ãæä»¥å®è½ä¿è¯äºä»¶è³å°ä¼ éä¸æ¬¡å°éç½®çè¾åºï¼æ²¡ææ°æ®ä¸¢å¤±ã\n\n\n# 5. è¿ç»´\n\n * elasticsearch è¿ç»´\n * logstash è¿ç»´\n * kibana è¿ç»´\n * beats è¿ç»´\n\n\n# 6. åèèµæ\n\n * å®æ¹èµæº\n   * elasticsearch å®ç½\n   * elasticsearch github\n   * elasticsearch å®æ¹ææ¡£\n   * logstash å®ç½\n   * logstash github\n   * logstash å®æ¹ææ¡£\n   * kibana å®ç½\n   * kibana github\n   * kibana å®æ¹ææ¡£\n   * beats å®ç½\n   * beats github\n   * beats å®æ¹ææ¡£\n * æç« \n   * ä»ä¹æ¯ elk stackï¼\n   * https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/es-introduction.md\n   * es-write-query-search",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Elastic ææ¯æ ä¹ Kibana",frontmatter:{title:"Elastic ææ¯æ ä¹ Kibana",date:"2020-06-16T07:10:44.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic","Kibana"],permalink:"/pages/002159/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/02.Elastic/04.Elastic%E6%8A%80%E6%9C%AF%E6%A0%88%E4%B9%8BKibana.html",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/02.Elastic/04.Elasticææ¯æ ä¹Kibana.md",key:"v-6550ec14",path:"/pages/002159/",headers:[{level:2,title:"Discover",slug:"discover",normalizedTitle:"discover",charIndex:26},{level:3,title:"æ¥è¯¢è¯­ä¹",slug:"æ¥è¯¢è¯­ä¹",normalizedTitle:"æ¥è¯¢è¯­ä¹",charIndex:520},{level:4,title:"å­æ®µåç§°",slug:"å­æ®µåç§°",normalizedTitle:"å­æ®µåç§°",charIndex:311},{level:4,title:"ééç¬¦",slug:"ééç¬¦",normalizedTitle:"ééç¬¦",charIndex:1052},{level:4,title:"æ­£åè¡¨è¾¾å¼",slug:"æ­£åè¡¨è¾¾å¼",normalizedTitle:"æ­£åè¡¨è¾¾å¼",charIndex:1463},{level:4,title:"æ¨¡ç³æ¥è¯¢",slug:"æ¨¡ç³æ¥è¯¢",normalizedTitle:"æ¨¡ç³æ¥è¯¢",charIndex:1571},{level:4,title:"è¿ä¼¼æ£ç´¢",slug:"è¿ä¼¼æ£ç´¢",normalizedTitle:"è¿ä¼¼æ£ç´¢",charIndex:1840},{level:4,title:"èå´",slug:"èå´",normalizedTitle:"èå´",charIndex:2083},{level:4,title:"Boosting",slug:"boosting",normalizedTitle:"boosting",charIndex:2575},{level:4,title:"å¸å°æä½",slug:"å¸å°æä½",normalizedTitle:"å¸å°æä½",charIndex:2745},{level:4,title:"åç»",slug:"åç»",normalizedTitle:"åç»",charIndex:3162},{level:4,title:"ä¿çå­",slug:"ä¿çå­",normalizedTitle:"ä¿çå­",charIndex:3304},{level:4,title:"ç©ºæ¥è¯¢",slug:"ç©ºæ¥è¯¢",normalizedTitle:"ç©ºæ¥è¯¢",charIndex:3492},{level:2,title:"Visualize",slug:"visualize",normalizedTitle:"visualize",charIndex:144},{level:3,title:"Pie",slug:"pie",normalizedTitle:"pie",charIndex:3712},{level:3,title:"Vertical Bar",slug:"vertical-bar",normalizedTitle:"vertical bar",charIndex:4083},{level:2,title:"Dashboard",slug:"dashboard",normalizedTitle:"dashboard",charIndex:4324}],headersStr:"Discover æ¥è¯¢è¯­ä¹ å­æ®µåç§° ééç¬¦ æ­£åè¡¨è¾¾å¼ æ¨¡ç³æ¥è¯¢ è¿ä¼¼æ£ç´¢ èå´ Boosting å¸å°æä½ åç» ä¿çå­ ç©ºæ¥è¯¢ Visualize Pie Vertical Bar Dashboard",content:'# Elastic ææ¯æ ä¹ Kibana\n\n\n# Discover\n\nåå»ä¾§é¢å¯¼èªæ ä¸­ç Discover ï¼å¯ä»¥æ¾ç¤º Kibana çæ°æ®æ¥è¯¢åè½åè½ã\n\n\n\nå¨æç´¢æ ä¸­ï¼æ¨å¯ä»¥è¾å¥ Elasticsearch æ¥è¯¢æ¡ä»¶æ¥æç´¢æ¨çæ°æ®ãæ¨å¯ä»¥å¨ Discover é¡µé¢ä¸­æµè§ç»æå¹¶å¨ Visualize é¡µé¢ä¸­åå»ºå·²ä¿å­æç´¢æ¡ä»¶çå¯è§åã\n\nå½åç´¢å¼æ¨¡å¼æ¾ç¤ºå¨æ¥è¯¢æ ä¸æ¹ãç´¢å¼æ¨¡å¼ç¡®å®æäº¤æ¥è¯¢æ¶æç´¢åªäºç´¢å¼ãè¦æç´¢ä¸ç»ä¸åçç´¢å¼ï¼è¯·ä»ä¸æèåä¸­éæ©ä¸åçæ¨¡å¼ãè¦æ·»å ç´¢å¼æ¨¡å¼ï¼index patternï¼ï¼è¯·è½¬è³ Management/Kibana/Index Patterns å¹¶åå» Add Newã\n\næ¨å¯ä»¥ä½¿ç¨å­æ®µåç§°åæ¨æå´è¶£çå¼æå»ºæç´¢ãå¯¹äºæ°å­å­æ®µï¼å¯ä»¥ä½¿ç¨æ¯è¾è¿ç®ç¬¦ï¼å¦å¤§äºï¼>ï¼ï¼å°äºï¼<ï¼æç­äºï¼=ï¼ãæ¨å¯ä»¥å°åç´ ä¸é»è¾è¿ç®ç¬¦ ANDï¼OR å NOT é¾æ¥ï¼å¨é¨ä½¿ç¨å¤§åã\n\né»è®¤æåµä¸ï¼æ¯ä¸ªå¹éææ¡£é½æ¾ç¤ºææå­æ®µãè¦éæ©è¦æ¾ç¤ºçææ¡£å­æ®µï¼è¯·å°é¼ æ æ¬åå¨âå¯ç¨å­æ®µâåè¡¨ä¸ï¼ç¶ååå»è¦åå«çæ¯ä¸ªå­æ®µæè¾¹çæ·»å æé®ãä¾å¦ï¼å¦æåªæ·»å  account_numberï¼åæ¾ç¤ºå°æ´æ¹ä¸ºåå«äºä¸ªå¸å·çç®ååè¡¨ï¼\n\n\n\n\n# æ¥è¯¢è¯­ä¹\n\nkibana çæç´¢æ éµå¾ª query-string-syntax ææ¡£ä¸­æè¯´æçæ¥è¯¢è¯­ä¹ã\n\nè¿éè¯´æä¸äºæåºæ¬çæ¥è¯¢è¯­ä¹ã\n\næ¥è¯¢å­ç¬¦ä¸²ä¼è¢«è§£æä¸ºä¸ç³»åçæ¯è¯­åè¿ç®ç¬¦ãä¸ä¸ªæ¯è¯­å¯ä»¥æ¯ä¸ä¸ªåè¯ï¼å¦ï¼quickãbrownï¼æç¨åå¼å·åå´çç­è¯­ï¼å¦"quick brown"ï¼ã\n\næ¥è¯¢æä½åè®¸æ¨èªå®ä¹æç´¢ - ä¸é¢ä»ç»äºå¯ç¨çéé¡¹ã\n\n# å­æ®µåç§°\n\næ­£å¦æ¥è¯¢å­ç¬¦ä¸²æ¥è¯¢ä¸­æè¿°ï¼å°å¨æç´¢æ¡ä»¶ä¸­æç´¢ default_fieldï¼ä½å¯ä»¥å¨æ¥è¯¢è¯­æ³ä¸­æå®å¶ä»å­æ®µï¼\n\nä¾å¦ï¼\n\n * æ¥è¯¢ status å­æ®µä¸­åå« active å³é®å­\n\nstatus:active\n\n\n * title å­æ®µåå« quick æ brown å³é®å­ãå¦ææ¨çç¥ OR è¿ç®ç¬¦ï¼åå°ä½¿ç¨é»è®¤è¿ç®ç¬¦\n\ntitle:(quick OR brown)\ntitle:(quick brown)\n\n\n * author å­æ®µæ¥æ¾ç²¾ç¡®çç­è¯­ "john smith"ï¼å³ç²¾ç¡®æ¥æ¾ã\n\nauthor:"John Smith"\n\n\n * ä»»æå­æ®µ book.titleï¼book.content æ book.date é½åå« quick æ brownï¼æ³¨ææä»¬éè¦å¦ä½ä½¿ç¨ \\* è¡¨ç¤ºééç¬¦ï¼\n\nbook.\\*:(quick brown)\n\n\n * title å­æ®µåå«ä»»æé null å¼\n\n_exists_:title\n\n\n# ééç¬¦\n\nELK æä¾äº ? å * ä¸¤ä¸ªééç¬¦ã\n\n * ? è¡¨ç¤ºä»»æåä¸ªå­ç¬¦ï¼\n * * è¡¨ç¤ºä»»æé¶ä¸ªæå¤ä¸ªå­ç¬¦ã\n\nqu?ck bro*\n\n\n> æ³¨æï¼ééç¬¦æ¥è¯¢ä¼ä½¿ç¨å¤§éçåå­å¹¶ä¸æ§è¡æ§è½è¾ä¸ºç³ç³ï¼æä»¥è¯·æç¨ã > æç¤ºï¼çº¯ééç¬¦ * è¢«åå¥ exsits æ¥è¯¢ï¼ä»èæé«äºæ¥è¯¢æçãå æ­¤ï¼ééç¬¦ fieldï¼* å°å¹éåå«ç©ºå¼çææ¡£ï¼å¦ï¼{âfieldâï¼ââ}ï¼ä½æ¯å¦æå­æ®µä¸¢å¤±ææ¾ç¤ºå°å¼ç½®ä¸º null åä¸å¹éï¼å¦ï¼âfieldâï¼null} > æç¤ºï¼å¨ä¸ä¸ªåè¯çå¼å¤´ï¼ä¾å¦ï¼*ingï¼ä½¿ç¨ééç¬¦è¿ç§æ¹å¼çæ¥è¯¢éç¹å«å¤§ï¼å ä¸ºç´¢å¼ä¸­çæææ¯è¯­é½éè¦æ£æ¥ï¼ä»¥é²ä¸ä¸å¹éãéè¿å° allow_leading_wildcard è®¾ç½®ä¸º falseï¼å¯ä»¥ç¦ç¨ã\n\n# æ­£åè¡¨è¾¾å¼\n\nå¯ä»¥éè¿ / å°æ­£åè¡¨è¾¾å¼åè£¹å¨æ¥è¯¢å­ç¬¦ä¸²ä¸­è¿è¡æ¥è¯¢\n\nä¾ï¼\n\nname:/joh?n(ath[oa]n)/\n\n\næ¯æçæ­£åè¡¨è¾¾å¼è¯­ä¹å¯ä»¥åèï¼Regular expression syntax\n\n# æ¨¡ç³æ¥è¯¢\n\næä»¬å¯ä»¥ä½¿ç¨ ~ è¿ç®ç¬¦æ¥è¿è¡æ¨¡ç³æ¥è¯¢ã\n\nä¾ï¼\n\nåè®¾æä»¬å®éæ³æ¥è¯¢\n\nquick brown forks\n\n\nä½æ¯ï¼ç±äºæ¼åéè¯¯ï¼æä»¬çæ¥è¯¢å³é®å­åæå¦ä¸æåµï¼ä¾ç¶å¯ä»¥æ¥å°æ³è¦çç»æã\n\nquikc\\~ brwn\\~ foks\\~\n\n\nè¿ç§æ¨¡ç³æ¥è¯¢ä½¿ç¨ Damerau-Levenshtein è·ç¦»æ¥æ¥æ¾ææå¹éæå¤ä¸¤ä¸ªæ´æ¹çé¡¹ãæè°çæ´æ¹æ¯æåä¸ªå­ç¬¦çæå¥ï¼å é¤ææ¿æ¢ï¼æèä¸¤ä¸ªç¸é»å­ç¬¦çæ¢ä½ã\n\né»è®¤ç¼è¾è·ç¦»ä¸º 2ï¼ä½ç¼è¾è·ç¦»ä¸º 1 åºè¶³ä»¥ææææäººç±»æ¼åéè¯¯ç 80ï¼ãå®å¯ä»¥è¢«æå®ä¸ºï¼\n\nquikc\\~1\n\n\n# è¿ä¼¼æ£ç´¢\n\nå°½ç®¡ç­è¯­æ¥è¯¢ï¼ä¾å¦ï¼john smithï¼ææææçè¯æ¡é½æ¯å®å¨ç¸åçé¡ºåºï¼ä½æ¯è¿ä¼¼æ¥è¯¢åè®¸æå®çåè¯è¿ä¸æ­¥åå¼æä»¥ä¸åçé¡ºåºæåãä¸æ¨¡ç³æ¥è¯¢å¯ä»¥ä¸ºåè¯ä¸­çå­ç¬¦æå®æå¤§ç¼è¾è·ç¦»ä¸æ ·ï¼è¿ä¼¼æç´¢ä¹åè®¸æä»¬æå®ç­è¯­ä¸­åè¯çæå¤§ç¼è¾è·ç¦»ï¼\n\nä¾\n\n"fox quick"\\~5\n\n\nå­æ®µä¸­çææ¬è¶æ¥è¿æ¥è¯¢å­ç¬¦ä¸²ä¸­æå®çåå§é¡ºåºï¼è¯¥ææ¡£å°±è¶è¢«è®¤ä¸ºæ¯ç¸å³çãå½ä¸ä¸é¢çç¤ºä¾æ¥è¯¢ç¸æ¯æ¶ï¼ç­è¯­ "quick fox" å°è¢«è®¤ä¸ºæ¯ "quick brown fox" æ´è¿ä¼¼æ¥è¯¢æ¡ä»¶ã\n\n# èå´\n\nå¯ä»¥ä¸ºæ¥æï¼æ°å­æå­ç¬¦ä¸²å­æ®µæå®èå´ãé­åºé´èå´ç¨æ¹æ¬å· [min TO max] åå¼åºé´èå´ç¨è±æ¬å· {min TO max} æ¥æå®ã\n\næä»¬ä¸å¦¨æ¥çä¸äºç¤ºä¾ã\n\n * 2012 å¹´çæææ¥å­\n\ndate:[2012-01-01 TO 2012-12-31]\n\n\n * æ°å­ 1 å° 5\n\ncount:[1 TO 5]\n\n\n * å¨ alpha å omega ä¹é´çæ ç­¾ï¼ä¸åæ¬ alpha å omega\n\ntag:{alpha TO omega}\n\n\n * 10 ä»¥ä¸çæ°å­\n\ncount:[10 TO *]\n\n\n * 2012 å¹´ä»¥åçæææ¥æ\n\ndate:{* TO 2012-01-01}\n\n\næ­¤å¤ï¼å¼åºé´åé­åºé´ä¹å¯ä»¥ç»åä½¿ç¨\n\n * æ°ç» 1 å° 5ï¼ä½ä¸åæ¬ 5\n\ncount:[1 TO 5}\n\n\nä¸è¾¹æ ççèå´ä¹å¯ä»¥ä½¿ç¨ä»¥ä¸è¯­æ³ï¼\n\nage:>10\nage:>=10\nage:<10\nage:<=10\n\n\nå½ç¶ï¼ä½ ä¹å¯ä»¥ä½¿ç¨ AND è¿ç®ç¬¦æ¥å¾å°è¿ä¸ªæ¥è¯¢ç»æçäº¤é\n\nage:(>=10 AND <20)\nage:(+>=10 +<20)\n\n\n# Boosting\n\nä½¿ç¨æä½ç¬¦ ^ ä½¿ä¸ä¸ªæ¯è¯­æ¯å¦ä¸ä¸ªæ¯è¯­æ´ç¸å³ãä¾å¦ï¼å¦ææä»¬æ³æ¥æ¾æææå³çç¸çææ¡£ï¼ä½æä»¬å¯¹çç¸ç¹å«æå´è¶£ï¼\n\nquick^2 fox\n\n\né»è®¤æåå¼æ¯ 1ï¼ä½å¯ä»¥æ¯ä»»ä½æ­£æµ®ç¹æ°ã 0 å° 1 ä¹é´çæååå°äºç¸å³æ§ã\n\nå¢å¼ºä¹å¯ä»¥åºç¨äºç­è¯­æç»ï¼\n\n"john smith"^2   (foo bar)^4\n\n\n# å¸å°æä½\n\né»è®¤æåµä¸ï¼åªè¦ä¸ä¸ªè¯å¹éï¼ææè¯é½æ¯å¯éçãæç´¢ foo bar baz å°æ¥æ¾åå« foo æ bar æ baz ä¸­çä¸ä¸ªæå¤ä¸ªçä»»ä½ææ¡£ãæä»¬å·²ç»è®¨è®ºäºä¸é¢çdefault_operatorï¼å®åè®¸ä½ å¼ºå¶è¦æ±ææçé¡¹ï¼ä½ä¹æå¸å°è¿ç®ç¬¦å¯ä»¥å¨æ¥è¯¢å­ç¬¦ä¸²æ¬èº«ä¸­ä½¿ç¨ï¼ä»¥æä¾æ´å¤çæ§å¶ã\n\né¦éçæä½ç¬¦æ¯ +ï¼æ­¤æ¯è¯­å¿é¡»å­å¨ï¼å - ï¼æ­¤æ¯è¯­ä¸å¾å­å¨ï¼ãææå¶ä»æ¡æ¬¾æ¯å¯éçãä¾å¦ï¼è¿ä¸ªæ¥è¯¢ï¼\n\nquick brown +fox -news\n\n\nè¿æ¡æ¥è¯¢æå³çï¼\n\n * fox å¿é¡»å­å¨\n * news å¿é¡»ä¸å­å¨\n * quick å brown æ¯å¯æå¯æ ç\n\nçæçè¿ç®ç¬¦ ANDï¼OR å NOTï¼ä¹åæ &&ï¼|| å !ï¼ä¹è¢«æ¯æãç¶èï¼è¿äºæä½ç¬¦æä¸å®çä¼åçº§ï¼NOT ä¼åäº ANDï¼AND ä¼åäº ORãè½ç¶ + å - ä»å½±åè¿ç®ç¬¦å³ä¾§çæ¯è¯­ï¼ä½ AND å OR ä¼å½±åå·¦ä¾§åå³ä¾§çæ¯è¯­ã\n\n# åç»\n\nå¤ä¸ªæ¯è¯­æå­å¥å¯ä»¥ç¨åæ¬å·ç»åå¨ä¸èµ·ï¼å½¢æå­æ¥è¯¢\n\n(quick OR brown) AND fox\n\n\nå¯ä»¥ä½¿ç¨ç»æ¥å®ä½ç¹å®çå­æ®µï¼æèå¢å¼ºå­æ¥è¯¢çç»æï¼\n\nstatus:(active OR pending) title:(full text search)^2\n\n\n# ä¿çå­\n\nå¦æä½ éè¦ä½¿ç¨ä»»ä½å¨ä½ çæ¥è¯¢æ¬èº«ä¸­ä½ä¸ºæä½ç¬¦çå­ç¬¦ï¼èä¸æ¯ä½ä¸ºæä½ç¬¦ï¼ï¼é£ä¹ä½ åºè¯¥ç¨ä¸ä¸ªåææ æ¥è½¬ä¹å®ä»¬ãä¾å¦ï¼è¦æç´¢ï¼1 + 1ï¼= 2ï¼æ¨éè¦å°æ¥è¯¢åä¸º \\(1\\+1\\)\\=2\n\nä¿çå­ç¬¦æ¯ï¼+ - = && || > < ! ( ) { } [ ] ^ " ~ * ? : \\ /\n\næ æ³æ­£ç¡®å°è½¬ä¹è¿äºç¹æ®å­ç¬¦å¯è½ä¼å¯¼è´è¯­æ³éè¯¯ï¼ä»èé»æ­¢æ¨çæ¥è¯¢è¿è¡ã\n\n# ç©ºæ¥è¯¢\n\nå¦ææ¥è¯¢å­ç¬¦ä¸²ä¸ºç©ºæä»åå«ç©ºæ ¼ï¼åæ¥è¯¢å°çæä¸ä¸ªç©ºçç»æéã\n\n\n# Visualize\n\nè¦æ³ä½¿ç¨å¯è§åçæ¹å¼å±ç¤ºæ¨çæ°æ®ï¼è¯·åå»ä¾§é¢å¯¼èªæ ä¸­ç Visualizeã\n\nVisualize å·¥å·ä½¿æ¨è½å¤ä»¥å¤ç§æ¹å¼ï¼å¦é¥¼å¾ãæ±ç¶å¾ãæ²çº¿å¾ãåå¸å¾ç­ï¼æ¥çæ°æ®ãè¦å¼å§ä½¿ç¨ï¼è¯·ç¹å»èè²ç Create a visualization æ + æé®ã\n\n\n\næè®¸å¤å¯è§åç±»åå¯ä¾éæ©ã\n\n\n\nä¸é¢ï¼æä»¬æ¥çåå»ºå ä¸ªå¾æ ç¤ºä¾ï¼\n\n\n# Pie\n\næ¨å¯ä»¥ä»ä¿å­çæç´¢ä¸­æå»ºå¯è§åæä»¶ï¼ä¹å¯ä»¥è¾å¥æ°çæç´¢æ¡ä»¶ãè¦è¾å¥æ°çæç´¢æ¡ä»¶ï¼é¦åéè¦éæ©ä¸ä¸ªç´¢å¼æ¨¡å¼æ¥æå®è¦æç´¢çç´¢å¼ã\n\né»è®¤æç´¢å¹éææææ¡£ãæåï¼ä¸ä¸ªâåçâåå«æ´ä¸ªé¥¼å¾ï¼\n\n\n\nè¦æå®å¨å¾è¡¨ä¸­å±ç¤ºåªäºæ°æ®ï¼è¯·ä½¿ç¨ Elasticsearch å­å¨æ¡¶èåãåç»æ±æ»åªæ¯å°ä¸æ¨çæç´¢æ¡ä»¶ç¸å¹éçææ¡£åç±»å°ä¸åçåç±»ä¸­ï¼ä¹ç§°ä¸ºåç»ã\n\nä¸ºæ¯ä¸ªèå´å®ä¹ä¸ä¸ªå­å¨æ¡¶ï¼\n\n 1. åå» Split Slicesã\n 2. å¨ Aggregation åè¡¨ä¸­éæ© Termsãæ³¨æï¼è¿éç Terms æ¯ Elk ééæ°æ®æ¶å®ä¹å¥½çå­æ®µææ ç­¾ã\n 3. å¨ Field åè¡¨ä¸­éæ© level.keywordã\n 4. ç¹å» æé®æ¥æ´æ°å¾è¡¨ã\n\n\n\nå®æåï¼å¦ææ³è¦ä¿å­è¿ä¸ªå¾è¡¨ï¼å¯ä»¥ç¹å»é¡µé¢æä¸æ¹ä¸æ ä¸­ç Save æé®ã\n\n\n# Vertical Bar\n\næä»¬å¨å±ç¤ºä¸ä¸å¦ä½åå»ºæ±ç¶å¾ã\n\n 1. ç¹å»èè²ç Create a visualization æ + æé®ãéæ© Vertical Bar\n 2. éæ©ç´¢å¼æ¨¡å¼ãç±äºæ¨å°æªå®ä¹ä»»ä½ bucket ï¼å æ­¤æ¨ä¼çå°ä¸ä¸ªå¤§æ ï¼æ¾ç¤ºä¸é»è®¤ééç¬¦æ¥è¯¢å¹éçææ¡£æ»æ°ã\n 3. æå® Y è½´æä»£è¡¨çå­æ®µ\n 4. æå® X è½´æä»£è¡¨çå­æ®µ\n 5. ç¹å» æé®æ¥æ´æ°å¾è¡¨ã\n\n\n\nå®æåï¼å¦ææ³è¦ä¿å­è¿ä¸ªå¾è¡¨ï¼å¯ä»¥ç¹å»é¡µé¢æä¸æ¹ä¸æ ä¸­ç Save æé®ã\n\n\n# Dashboard\n\nDashboard å¯ä»¥æ´ååå±äº« Visualize éåã\n\n 1. ç¹å»ä¾§é¢å¯¼èªæ ä¸­ç Dashboardã\n 2. ç¹å»æ·»å æ¾ç¤ºä¿å­çå¯è§ååè¡¨ã\n 3. ç¹å»ä¹åä¿å­ç Visualizeï¼ç¶åç¹å»åè¡¨åºé¨çå°åä¸ç®­å¤´å³é­å¯è§ååè¡¨ã\n 4. å°é¼ æ æ¬åå¨å¯è§åå¯¹è±¡ä¸ä¼æ¾ç¤ºåè®¸æ¨ç¼è¾ï¼ç§»å¨ï¼å é¤åè°æ´å¯è§åå¯¹è±¡å¤§å°çå®¹å¨æ§ä»¶ã',normalizedContent:'# elastic ææ¯æ ä¹ kibana\n\n\n# discover\n\nåå»ä¾§é¢å¯¼èªæ ä¸­ç discover ï¼å¯ä»¥æ¾ç¤º kibana çæ°æ®æ¥è¯¢åè½åè½ã\n\n\n\nå¨æç´¢æ ä¸­ï¼æ¨å¯ä»¥è¾å¥ elasticsearch æ¥è¯¢æ¡ä»¶æ¥æç´¢æ¨çæ°æ®ãæ¨å¯ä»¥å¨ discover é¡µé¢ä¸­æµè§ç»æå¹¶å¨ visualize é¡µé¢ä¸­åå»ºå·²ä¿å­æç´¢æ¡ä»¶çå¯è§åã\n\nå½åç´¢å¼æ¨¡å¼æ¾ç¤ºå¨æ¥è¯¢æ ä¸æ¹ãç´¢å¼æ¨¡å¼ç¡®å®æäº¤æ¥è¯¢æ¶æç´¢åªäºç´¢å¼ãè¦æç´¢ä¸ç»ä¸åçç´¢å¼ï¼è¯·ä»ä¸æèåä¸­éæ©ä¸åçæ¨¡å¼ãè¦æ·»å ç´¢å¼æ¨¡å¼ï¼index patternï¼ï¼è¯·è½¬è³ management/kibana/index patterns å¹¶åå» add newã\n\næ¨å¯ä»¥ä½¿ç¨å­æ®µåç§°åæ¨æå´è¶£çå¼æå»ºæç´¢ãå¯¹äºæ°å­å­æ®µï¼å¯ä»¥ä½¿ç¨æ¯è¾è¿ç®ç¬¦ï¼å¦å¤§äºï¼>ï¼ï¼å°äºï¼<ï¼æç­äºï¼=ï¼ãæ¨å¯ä»¥å°åç´ ä¸é»è¾è¿ç®ç¬¦ andï¼or å not é¾æ¥ï¼å¨é¨ä½¿ç¨å¤§åã\n\né»è®¤æåµä¸ï¼æ¯ä¸ªå¹éææ¡£é½æ¾ç¤ºææå­æ®µãè¦éæ©è¦æ¾ç¤ºçææ¡£å­æ®µï¼è¯·å°é¼ æ æ¬åå¨âå¯ç¨å­æ®µâåè¡¨ä¸ï¼ç¶ååå»è¦åå«çæ¯ä¸ªå­æ®µæè¾¹çæ·»å æé®ãä¾å¦ï¼å¦æåªæ·»å  account_numberï¼åæ¾ç¤ºå°æ´æ¹ä¸ºåå«äºä¸ªå¸å·çç®ååè¡¨ï¼\n\n\n\n\n# æ¥è¯¢è¯­ä¹\n\nkibana çæç´¢æ éµå¾ª query-string-syntax ææ¡£ä¸­æè¯´æçæ¥è¯¢è¯­ä¹ã\n\nè¿éè¯´æä¸äºæåºæ¬çæ¥è¯¢è¯­ä¹ã\n\næ¥è¯¢å­ç¬¦ä¸²ä¼è¢«è§£æä¸ºä¸ç³»åçæ¯è¯­åè¿ç®ç¬¦ãä¸ä¸ªæ¯è¯­å¯ä»¥æ¯ä¸ä¸ªåè¯ï¼å¦ï¼quickãbrownï¼æç¨åå¼å·åå´çç­è¯­ï¼å¦"quick brown"ï¼ã\n\næ¥è¯¢æä½åè®¸æ¨èªå®ä¹æç´¢ - ä¸é¢ä»ç»äºå¯ç¨çéé¡¹ã\n\n# å­æ®µåç§°\n\næ­£å¦æ¥è¯¢å­ç¬¦ä¸²æ¥è¯¢ä¸­æè¿°ï¼å°å¨æç´¢æ¡ä»¶ä¸­æç´¢ default_fieldï¼ä½å¯ä»¥å¨æ¥è¯¢è¯­æ³ä¸­æå®å¶ä»å­æ®µï¼\n\nä¾å¦ï¼\n\n * æ¥è¯¢ status å­æ®µä¸­åå« active å³é®å­\n\nstatus:active\n\n\n * title å­æ®µåå« quick æ brown å³é®å­ãå¦ææ¨çç¥ or è¿ç®ç¬¦ï¼åå°ä½¿ç¨é»è®¤è¿ç®ç¬¦\n\ntitle:(quick or brown)\ntitle:(quick brown)\n\n\n * author å­æ®µæ¥æ¾ç²¾ç¡®çç­è¯­ "john smith"ï¼å³ç²¾ç¡®æ¥æ¾ã\n\nauthor:"john smith"\n\n\n * ä»»æå­æ®µ book.titleï¼book.content æ book.date é½åå« quick æ brownï¼æ³¨ææä»¬éè¦å¦ä½ä½¿ç¨ \\* è¡¨ç¤ºééç¬¦ï¼\n\nbook.\\*:(quick brown)\n\n\n * title å­æ®µåå«ä»»æé null å¼\n\n_exists_:title\n\n\n# ééç¬¦\n\nelk æä¾äº ? å * ä¸¤ä¸ªééç¬¦ã\n\n * ? è¡¨ç¤ºä»»æåä¸ªå­ç¬¦ï¼\n * * è¡¨ç¤ºä»»æé¶ä¸ªæå¤ä¸ªå­ç¬¦ã\n\nqu?ck bro*\n\n\n> æ³¨æï¼ééç¬¦æ¥è¯¢ä¼ä½¿ç¨å¤§éçåå­å¹¶ä¸æ§è¡æ§è½è¾ä¸ºç³ç³ï¼æä»¥è¯·æç¨ã > æç¤ºï¼çº¯ééç¬¦ * è¢«åå¥ exsits æ¥è¯¢ï¼ä»èæé«äºæ¥è¯¢æçãå æ­¤ï¼ééç¬¦ fieldï¼* å°å¹éåå«ç©ºå¼çææ¡£ï¼å¦ï¼{âfieldâï¼ââ}ï¼ä½æ¯å¦æå­æ®µä¸¢å¤±ææ¾ç¤ºå°å¼ç½®ä¸º null åä¸å¹éï¼å¦ï¼âfieldâï¼null} > æç¤ºï¼å¨ä¸ä¸ªåè¯çå¼å¤´ï¼ä¾å¦ï¼*ingï¼ä½¿ç¨ééç¬¦è¿ç§æ¹å¼çæ¥è¯¢éç¹å«å¤§ï¼å ä¸ºç´¢å¼ä¸­çæææ¯è¯­é½éè¦æ£æ¥ï¼ä»¥é²ä¸ä¸å¹éãéè¿å° allow_leading_wildcard è®¾ç½®ä¸º falseï¼å¯ä»¥ç¦ç¨ã\n\n# æ­£åè¡¨è¾¾å¼\n\nå¯ä»¥éè¿ / å°æ­£åè¡¨è¾¾å¼åè£¹å¨æ¥è¯¢å­ç¬¦ä¸²ä¸­è¿è¡æ¥è¯¢\n\nä¾ï¼\n\nname:/joh?n(ath[oa]n)/\n\n\næ¯æçæ­£åè¡¨è¾¾å¼è¯­ä¹å¯ä»¥åèï¼regular expression syntax\n\n# æ¨¡ç³æ¥è¯¢\n\næä»¬å¯ä»¥ä½¿ç¨ ~ è¿ç®ç¬¦æ¥è¿è¡æ¨¡ç³æ¥è¯¢ã\n\nä¾ï¼\n\nåè®¾æä»¬å®éæ³æ¥è¯¢\n\nquick brown forks\n\n\nä½æ¯ï¼ç±äºæ¼åéè¯¯ï¼æä»¬çæ¥è¯¢å³é®å­åæå¦ä¸æåµï¼ä¾ç¶å¯ä»¥æ¥å°æ³è¦çç»æã\n\nquikc\\~ brwn\\~ foks\\~\n\n\nè¿ç§æ¨¡ç³æ¥è¯¢ä½¿ç¨ damerau-levenshtein è·ç¦»æ¥æ¥æ¾ææå¹éæå¤ä¸¤ä¸ªæ´æ¹çé¡¹ãæè°çæ´æ¹æ¯æåä¸ªå­ç¬¦çæå¥ï¼å é¤ææ¿æ¢ï¼æèä¸¤ä¸ªç¸é»å­ç¬¦çæ¢ä½ã\n\né»è®¤ç¼è¾è·ç¦»ä¸º 2ï¼ä½ç¼è¾è·ç¦»ä¸º 1 åºè¶³ä»¥ææææäººç±»æ¼åéè¯¯ç 80ï¼ãå®å¯ä»¥è¢«æå®ä¸ºï¼\n\nquikc\\~1\n\n\n# è¿ä¼¼æ£ç´¢\n\nå°½ç®¡ç­è¯­æ¥è¯¢ï¼ä¾å¦ï¼john smithï¼ææææçè¯æ¡é½æ¯å®å¨ç¸åçé¡ºåºï¼ä½æ¯è¿ä¼¼æ¥è¯¢åè®¸æå®çåè¯è¿ä¸æ­¥åå¼æä»¥ä¸åçé¡ºåºæåãä¸æ¨¡ç³æ¥è¯¢å¯ä»¥ä¸ºåè¯ä¸­çå­ç¬¦æå®æå¤§ç¼è¾è·ç¦»ä¸æ ·ï¼è¿ä¼¼æç´¢ä¹åè®¸æä»¬æå®ç­è¯­ä¸­åè¯çæå¤§ç¼è¾è·ç¦»ï¼\n\nä¾\n\n"fox quick"\\~5\n\n\nå­æ®µä¸­çææ¬è¶æ¥è¿æ¥è¯¢å­ç¬¦ä¸²ä¸­æå®çåå§é¡ºåºï¼è¯¥ææ¡£å°±è¶è¢«è®¤ä¸ºæ¯ç¸å³çãå½ä¸ä¸é¢çç¤ºä¾æ¥è¯¢ç¸æ¯æ¶ï¼ç­è¯­ "quick fox" å°è¢«è®¤ä¸ºæ¯ "quick brown fox" æ´è¿ä¼¼æ¥è¯¢æ¡ä»¶ã\n\n# èå´\n\nå¯ä»¥ä¸ºæ¥æï¼æ°å­æå­ç¬¦ä¸²å­æ®µæå®èå´ãé­åºé´èå´ç¨æ¹æ¬å· [min to max] åå¼åºé´èå´ç¨è±æ¬å· {min to max} æ¥æå®ã\n\næä»¬ä¸å¦¨æ¥çä¸äºç¤ºä¾ã\n\n * 2012 å¹´çæææ¥å­\n\ndate:[2012-01-01 to 2012-12-31]\n\n\n * æ°å­ 1 å° 5\n\ncount:[1 to 5]\n\n\n * å¨ alpha å omega ä¹é´çæ ç­¾ï¼ä¸åæ¬ alpha å omega\n\ntag:{alpha to omega}\n\n\n * 10 ä»¥ä¸çæ°å­\n\ncount:[10 to *]\n\n\n * 2012 å¹´ä»¥åçæææ¥æ\n\ndate:{* to 2012-01-01}\n\n\næ­¤å¤ï¼å¼åºé´åé­åºé´ä¹å¯ä»¥ç»åä½¿ç¨\n\n * æ°ç» 1 å° 5ï¼ä½ä¸åæ¬ 5\n\ncount:[1 to 5}\n\n\nä¸è¾¹æ ççèå´ä¹å¯ä»¥ä½¿ç¨ä»¥ä¸è¯­æ³ï¼\n\nage:>10\nage:>=10\nage:<10\nage:<=10\n\n\nå½ç¶ï¼ä½ ä¹å¯ä»¥ä½¿ç¨ and è¿ç®ç¬¦æ¥å¾å°è¿ä¸ªæ¥è¯¢ç»æçäº¤é\n\nage:(>=10 and <20)\nage:(+>=10 +<20)\n\n\n# boosting\n\nä½¿ç¨æä½ç¬¦ ^ ä½¿ä¸ä¸ªæ¯è¯­æ¯å¦ä¸ä¸ªæ¯è¯­æ´ç¸å³ãä¾å¦ï¼å¦ææä»¬æ³æ¥æ¾æææå³çç¸çææ¡£ï¼ä½æä»¬å¯¹çç¸ç¹å«æå´è¶£ï¼\n\nquick^2 fox\n\n\né»è®¤æåå¼æ¯ 1ï¼ä½å¯ä»¥æ¯ä»»ä½æ­£æµ®ç¹æ°ã 0 å° 1 ä¹é´çæååå°äºç¸å³æ§ã\n\nå¢å¼ºä¹å¯ä»¥åºç¨äºç­è¯­æç»ï¼\n\n"john smith"^2   (foo bar)^4\n\n\n# å¸å°æä½\n\né»è®¤æåµä¸ï¼åªè¦ä¸ä¸ªè¯å¹éï¼ææè¯é½æ¯å¯éçãæç´¢ foo bar baz å°æ¥æ¾åå« foo æ bar æ baz ä¸­çä¸ä¸ªæå¤ä¸ªçä»»ä½ææ¡£ãæä»¬å·²ç»è®¨è®ºäºä¸é¢çdefault_operatorï¼å®åè®¸ä½ å¼ºå¶è¦æ±ææçé¡¹ï¼ä½ä¹æå¸å°è¿ç®ç¬¦å¯ä»¥å¨æ¥è¯¢å­ç¬¦ä¸²æ¬èº«ä¸­ä½¿ç¨ï¼ä»¥æä¾æ´å¤çæ§å¶ã\n\né¦éçæä½ç¬¦æ¯ +ï¼æ­¤æ¯è¯­å¿é¡»å­å¨ï¼å - ï¼æ­¤æ¯è¯­ä¸å¾å­å¨ï¼ãææå¶ä»æ¡æ¬¾æ¯å¯éçãä¾å¦ï¼è¿ä¸ªæ¥è¯¢ï¼\n\nquick brown +fox -news\n\n\nè¿æ¡æ¥è¯¢æå³çï¼\n\n * fox å¿é¡»å­å¨\n * news å¿é¡»ä¸å­å¨\n * quick å brown æ¯å¯æå¯æ ç\n\nçæçè¿ç®ç¬¦ andï¼or å notï¼ä¹åæ &&ï¼|| å !ï¼ä¹è¢«æ¯æãç¶èï¼è¿äºæä½ç¬¦æä¸å®çä¼åçº§ï¼not ä¼åäº andï¼and ä¼åäº orãè½ç¶ + å - ä»å½±åè¿ç®ç¬¦å³ä¾§çæ¯è¯­ï¼ä½ and å or ä¼å½±åå·¦ä¾§åå³ä¾§çæ¯è¯­ã\n\n# åç»\n\nå¤ä¸ªæ¯è¯­æå­å¥å¯ä»¥ç¨åæ¬å·ç»åå¨ä¸èµ·ï¼å½¢æå­æ¥è¯¢\n\n(quick or brown) and fox\n\n\nå¯ä»¥ä½¿ç¨ç»æ¥å®ä½ç¹å®çå­æ®µï¼æèå¢å¼ºå­æ¥è¯¢çç»æï¼\n\nstatus:(active or pending) title:(full text search)^2\n\n\n# ä¿çå­\n\nå¦æä½ éè¦ä½¿ç¨ä»»ä½å¨ä½ çæ¥è¯¢æ¬èº«ä¸­ä½ä¸ºæä½ç¬¦çå­ç¬¦ï¼èä¸æ¯ä½ä¸ºæä½ç¬¦ï¼ï¼é£ä¹ä½ åºè¯¥ç¨ä¸ä¸ªåææ æ¥è½¬ä¹å®ä»¬ãä¾å¦ï¼è¦æç´¢ï¼1 + 1ï¼= 2ï¼æ¨éè¦å°æ¥è¯¢åä¸º \\(1\\+1\\)\\=2\n\nä¿çå­ç¬¦æ¯ï¼+ - = && || > < ! ( ) { } [ ] ^ " ~ * ? : \\ /\n\næ æ³æ­£ç¡®å°è½¬ä¹è¿äºç¹æ®å­ç¬¦å¯è½ä¼å¯¼è´è¯­æ³éè¯¯ï¼ä»èé»æ­¢æ¨çæ¥è¯¢è¿è¡ã\n\n# ç©ºæ¥è¯¢\n\nå¦ææ¥è¯¢å­ç¬¦ä¸²ä¸ºç©ºæä»åå«ç©ºæ ¼ï¼åæ¥è¯¢å°çæä¸ä¸ªç©ºçç»æéã\n\n\n# visualize\n\nè¦æ³ä½¿ç¨å¯è§åçæ¹å¼å±ç¤ºæ¨çæ°æ®ï¼è¯·åå»ä¾§é¢å¯¼èªæ ä¸­ç visualizeã\n\nvisualize å·¥å·ä½¿æ¨è½å¤ä»¥å¤ç§æ¹å¼ï¼å¦é¥¼å¾ãæ±ç¶å¾ãæ²çº¿å¾ãåå¸å¾ç­ï¼æ¥çæ°æ®ãè¦å¼å§ä½¿ç¨ï¼è¯·ç¹å»èè²ç create a visualization æ + æé®ã\n\n\n\næè®¸å¤å¯è§åç±»åå¯ä¾éæ©ã\n\n\n\nä¸é¢ï¼æä»¬æ¥çåå»ºå ä¸ªå¾æ ç¤ºä¾ï¼\n\n\n# pie\n\næ¨å¯ä»¥ä»ä¿å­çæç´¢ä¸­æå»ºå¯è§åæä»¶ï¼ä¹å¯ä»¥è¾å¥æ°çæç´¢æ¡ä»¶ãè¦è¾å¥æ°çæç´¢æ¡ä»¶ï¼é¦åéè¦éæ©ä¸ä¸ªç´¢å¼æ¨¡å¼æ¥æå®è¦æç´¢çç´¢å¼ã\n\né»è®¤æç´¢å¹éææææ¡£ãæåï¼ä¸ä¸ªâåçâåå«æ´ä¸ªé¥¼å¾ï¼\n\n\n\nè¦æå®å¨å¾è¡¨ä¸­å±ç¤ºåªäºæ°æ®ï¼è¯·ä½¿ç¨ elasticsearch å­å¨æ¡¶èåãåç»æ±æ»åªæ¯å°ä¸æ¨çæç´¢æ¡ä»¶ç¸å¹éçææ¡£åç±»å°ä¸åçåç±»ä¸­ï¼ä¹ç§°ä¸ºåç»ã\n\nä¸ºæ¯ä¸ªèå´å®ä¹ä¸ä¸ªå­å¨æ¡¶ï¼\n\n 1. åå» split slicesã\n 2. å¨ aggregation åè¡¨ä¸­éæ© termsãæ³¨æï¼è¿éç terms æ¯ elk ééæ°æ®æ¶å®ä¹å¥½çå­æ®µææ ç­¾ã\n 3. å¨ field åè¡¨ä¸­éæ© level.keywordã\n 4. ç¹å» æé®æ¥æ´æ°å¾è¡¨ã\n\n\n\nå®æåï¼å¦ææ³è¦ä¿å­è¿ä¸ªå¾è¡¨ï¼å¯ä»¥ç¹å»é¡µé¢æä¸æ¹ä¸æ ä¸­ç save æé®ã\n\n\n# vertical bar\n\næä»¬å¨å±ç¤ºä¸ä¸å¦ä½åå»ºæ±ç¶å¾ã\n\n 1. ç¹å»èè²ç create a visualization æ + æé®ãéæ© vertical bar\n 2. éæ©ç´¢å¼æ¨¡å¼ãç±äºæ¨å°æªå®ä¹ä»»ä½ bucket ï¼å æ­¤æ¨ä¼çå°ä¸ä¸ªå¤§æ ï¼æ¾ç¤ºä¸é»è®¤ééç¬¦æ¥è¯¢å¹éçææ¡£æ»æ°ã\n 3. æå® y è½´æä»£è¡¨çå­æ®µ\n 4. æå® x è½´æä»£è¡¨çå­æ®µ\n 5. ç¹å» æé®æ¥æ´æ°å¾è¡¨ã\n\n\n\nå®æåï¼å¦ææ³è¦ä¿å­è¿ä¸ªå¾è¡¨ï¼å¯ä»¥ç¹å»é¡µé¢æä¸æ¹ä¸æ ä¸­ç save æé®ã\n\n\n# dashboard\n\ndashboard å¯ä»¥æ´ååå±äº« visualize éåã\n\n 1. ç¹å»ä¾§é¢å¯¼èªæ ä¸­ç dashboardã\n 2. ç¹å»æ·»å æ¾ç¤ºä¿å­çå¯è§ååè¡¨ã\n 3. ç¹å»ä¹åä¿å­ç visualizeï¼ç¶åç¹å»åè¡¨åºé¨çå°åä¸ç®­å¤´å³é­å¯è§ååè¡¨ã\n 4. å°é¼ æ æ¬åå¨å¯è§åå¯¹è±¡ä¸ä¼æ¾ç¤ºåè®¸æ¨ç¼è¾ï¼ç§»å¨ï¼å é¤åè°æ´å¯è§åå¯¹è±¡å¤§å°çå®¹å¨æ§ä»¶ã',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Elastic ææ¯æ ä¹ Logstash",frontmatter:{title:"Elastic ææ¯æ ä¹ Logstash",date:"2020-06-16T07:10:44.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic","Logstash"],permalink:"/pages/55ce99/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/02.Elastic/06.Elastic%E6%8A%80%E6%9C%AF%E6%A0%88%E4%B9%8BLogstash.html",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/02.Elastic/06.Elasticææ¯æ ä¹Logstash.md",key:"v-8ad847d4",path:"/pages/55ce99/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:117},{level:3,title:"åè½",slug:"åè½",normalizedTitle:"åè½",charIndex:155},{level:3,title:"å·¥ä½åç",slug:"å·¥ä½åç",normalizedTitle:"å·¥ä½åç",charIndex:270},{level:2,title:"è®¾ç½®",slug:"è®¾ç½®",normalizedTitle:"è®¾ç½®",charIndex:548},{level:3,title:"è®¾ç½®æä»¶",slug:"è®¾ç½®æä»¶",normalizedTitle:"è®¾ç½®æä»¶",charIndex:555},{level:3,title:"logstash.yml è®¾ç½®é¡¹",slug:"logstash-yml-è®¾ç½®é¡¹",normalizedTitle:"logstash.yml è®¾ç½®é¡¹",charIndex:801},{level:2,title:"å¯å¨",slug:"å¯å¨",normalizedTitle:"å¯å¨",charIndex:589},{level:3,title:"å½ä»¤è¡",slug:"å½ä»¤è¡",normalizedTitle:"å½ä»¤è¡",charIndex:4126},{level:3,title:"éç½®æä»¶",slug:"éç½®æä»¶",normalizedTitle:"éç½®æä»¶",charIndex:591},{level:4,title:"éç½®æä»¶ç»æ",slug:"éç½®æä»¶ç»æ",normalizedTitle:"éç½®æä»¶ç»æ",charIndex:4665},{level:4,title:"æä»¶éç½®",slug:"æä»¶éç½®",normalizedTitle:"æä»¶éç½®",charIndex:3062},{level:4,title:"å¼ç±»å",slug:"å¼ç±»å",normalizedTitle:"å¼ç±»å",charIndex:5145},{level:2,title:"æä»¶",slug:"æä»¶",normalizedTitle:"æä»¶",charIndex:204},{level:3,title:"input",slug:"input",normalizedTitle:"input",charIndex:293},{level:4,title:"å¸¸ç¨ input æä»¶",slug:"å¸¸ç¨-input-æä»¶",normalizedTitle:"å¸¸ç¨ input æä»¶",charIndex:5971},{level:3,title:"filter",slug:"filter",normalizedTitle:"filter",charIndex:316},{level:4,title:"å¸¸ç¨ filter æä»¶",slug:"å¸¸ç¨-filter-æä»¶",normalizedTitle:"å¸¸ç¨ filter æä»¶",charIndex:6332},{level:3,title:"output",slug:"output",normalizedTitle:"output",charIndex:301},{level:4,title:"å¸¸ç¨ output æä»¶",slug:"å¸¸ç¨-output-æä»¶",normalizedTitle:"å¸¸ç¨ output æä»¶",charIndex:6679},{level:3,title:"codec",slug:"codec",normalizedTitle:"codec",charIndex:5592},{level:4,title:"å¸¸ç¨ codec æä»¶",slug:"å¸¸ç¨-codec-æä»¶",normalizedTitle:"å¸¸ç¨ codec æä»¶",charIndex:7002},{level:2,title:"å®æ",slug:"å®æ",normalizedTitle:"å®æ",charIndex:7125},{level:3,title:"ä¼ è¾æ§å¶å°æ°æ®",slug:"ä¼ è¾æ§å¶å°æ°æ®",normalizedTitle:"ä¼ è¾æ§å¶å°æ°æ®",charIndex:7180},{level:3,title:"ä¼ è¾ logback æ¥å¿",slug:"ä¼ è¾-logback-æ¥å¿",normalizedTitle:"ä¼ è¾ logback æ¥å¿",charIndex:7560},{level:4,title:"TCP åºç¨",slug:"tcp-åºç¨",normalizedTitle:"tcp åºç¨",charIndex:7867},{level:4,title:"UDP åºç¨",slug:"udp-åºç¨",normalizedTitle:"udp åºç¨",charIndex:9396},{level:3,title:"ä¼ è¾æä»¶",slug:"ä¼ è¾æä»¶",normalizedTitle:"ä¼ è¾æä»¶",charIndex:10224},{level:2,title:"å°æå·§",slug:"å°æå·§",normalizedTitle:"å°æå·§",charIndex:10926},{level:3,title:"å¯å¨ãç»æ­¢åºç¨",slug:"å¯å¨ãç»æ­¢åºç¨",normalizedTitle:"å¯å¨ãç»æ­¢åºç¨",charIndex:10934},{level:2,title:"èµæ",slug:"èµæ",normalizedTitle:"èµæ",charIndex:11385},{level:2,title:"æ¨èéè¯»",slug:"æ¨èéè¯»",normalizedTitle:"æ¨èéè¯»",charIndex:11499}],headersStr:"ç®ä» åè½ å·¥ä½åç è®¾ç½® è®¾ç½®æä»¶ logstash.yml è®¾ç½®é¡¹ å¯å¨ å½ä»¤è¡ éç½®æä»¶ éç½®æä»¶ç»æ æä»¶éç½® å¼ç±»å æä»¶ input å¸¸ç¨ input æä»¶ filter å¸¸ç¨ filter æä»¶ output å¸¸ç¨ output æä»¶ codec å¸¸ç¨ codec æä»¶ å®æ ä¼ è¾æ§å¶å°æ°æ® ä¼ è¾ logback æ¥å¿ TCP åºç¨ UDP åºç¨ ä¼ è¾æä»¶ å°æå·§ å¯å¨ãç»æ­¢åºç¨ èµæ æ¨èéè¯»",content:'# Elastic ææ¯æ ä¹ Logstash\n\n> æ¬ææ¯ Elastic ææ¯æ ï¼ELKï¼ç Logstash åºç¨ã\n> \n> å¦æä¸äºè§£ Elastic çå®è£ãéç½®ãé¨ç½²ï¼å¯ä»¥åèï¼Elastic ææ¯æ ä¹å¿«éå¥é¨\n\n\n# ç®ä»\n\nLogstash å¯ä»¥ä¼ è¾åå¤çä½ çæ¥å¿ãäºå¡æå¶ä»æ°æ®ã\n\n\n# åè½\n\nLogstash æ¯ Elasticsearch çæä½³æ°æ®ç®¡éã\n\nLogstash æ¯æä»¶å¼ç®¡çæ¨¡å¼ï¼å¨è¾å¥ãè¿æ»¤ãè¾åºä»¥åç¼ç è¿ç¨ä¸­é½å¯ä»¥ä½¿ç¨æä»¶è¿è¡å®å¶ãLogstash ç¤¾åºæè¶è¿ 200 ç§å¯ç¨æä»¶ã\n\n\n# å·¥ä½åç\n\nLogstash æä¸¤ä¸ªå¿è¦åç´ ï¼input å output ï¼ä¸ä¸ªå¯éåç´ ï¼filterã\n\nè¿ä¸ä¸ªåç´ ï¼åå«ä»£è¡¨ Logstash äºä»¶å¤ççä¸ä¸ªé¶æ®µï¼è¾å¥ > è¿æ»¤å¨ > è¾åºã\n\n\n\n * input è´è´£ä»æ°æ®æºééæ°æ®ã\n * filter å°æ°æ®ä¿®æ¹ä¸ºä½ æå®çæ ¼å¼æåå®¹ã\n * output å°æ°æ®ä¼ è¾å°ç®çå°ã\n\nå¨å®éåºç¨åºæ¯ä¸­ï¼éå¸¸è¾å¥ãè¾åºãè¿æ»¤å¨ä¸æ­¢ä¸ä¸ªãLogstash çè¿ä¸ä¸ªåç´ é½ä½¿ç¨æä»¶å¼ç®¡çæ¹å¼ï¼ç¨æ·å¯ä»¥æ ¹æ®åºç¨éè¦ï¼çµæ´»çéç¨åé¶æ®µéè¦çæä»¶ï¼å¹¶ç»åä½¿ç¨ã\n\nåé¢å°å¯¹æä»¶å±å¼è®²è§£ï¼æä¸ä¸è¡¨ã\n\n\n# è®¾ç½®\n\n\n# è®¾ç½®æä»¶\n\n * logstash.ymlï¼logstash çé»è®¤å¯å¨éç½®æä»¶\n * jvm.optionsï¼logstash ç JVM éç½®æä»¶ã\n * startup.options (Linux)ï¼åå«ç³»ç»å®è£èæ¬å¨ /usr/share/logstash/bin ä¸­ä½¿ç¨çéé¡¹ä¸ºæ¨çç³»ç»æå»ºéå½çå¯å¨èæ¬ãå®è£ Logstash è½¯ä»¶åæ¶ï¼ç³»ç»å®è£èæ¬å°å¨å®è£è¿ç¨ç»ææ¶æ§è¡ï¼å¹¶ä½¿ç¨ startup.options ä¸­æå®çè®¾ç½®æ¥è®¾ç½®ç¨æ·ï¼ç»ï¼æå¡åç§°åæå¡æè¿°ç­éé¡¹ã\n\n\n# logstash.yml è®¾ç½®é¡¹\n\nèéé¨åè®¾ç½®é¡¹ï¼æ´å¤é¡¹è¯·åèï¼https://www.elastic.co/guide/en/logstash/current/logstash-settings-file.html\n\nåæ°                         æè¿°                                                                                           é»è®¤å¼\nnode.name                  èç¹å                                                                                          æºå¨çä¸»æºå\npath.data                  Logstash åå¶æä»¶ç¨äºä»»ä½æä¹æ§éæ±çç®å½ã                                                                   LOGSTASH_HOME/data\npipeline.workers           åæ¶æ§è¡ç®¡éçè¿æ»¤å¨åè¾åºé¶æ®µçå·¥ä½ä»»å¡æ°éãå¦æåç°äºä»¶æ­£å¨å¤ä»½ï¼æ CPU                                                      Number of the hostâs CPU cores\n                           æªé¥±åï¼è¯·èèå¢å æ­¤æ°å­ä»¥æ´å¥½å°å©ç¨æºå¨å¤çè½åã\npipeline.batch.size        å°è¯æ§è¡è¿æ»¤å¨åè¾åºä¹åï¼åä¸ªå·¥ä½çº¿ç¨ä»è¾å¥æ¶éçæå¤§äºä»¶æ°éãè¾å¤§çæ¹éå¤çå¤§å°ä¸è¬æ¥è¯´æçæ´é«ï¼ä½æ¯ä»¥å¢å çåå­å¼éä¸ºä»£ä»·ãæ¨å¯è½å¿é¡»éè¿è®¾ç½®                    125\n                           LS_HEAP_SIZE åéæ¥ææä½¿ç¨è¯¥éé¡¹æ¥å¢å  JVM å å¤§å°ã\npipeline.batch.delay       åå»ºç®¡éäºä»¶æ¹å¤çæ¶ï¼å¨å°ä¸ä¸ªå°ºå¯¸è¿å°çæ¹æ¬¡åéç»ç®¡éå·¥ä½ä»»å¡ä¹åï¼ç­å¾æ¯ä¸ªäºä»¶éè¦å¤é¿æ¶é´ï¼æ¯«ç§ï¼ã                                          5\npipeline.unsafe_shutdown   å¦æè®¾ç½®ä¸º trueï¼åå³ä½¿å¨åå­ä¸­ä»å­å¨ inflight äºä»¶æ¶ï¼ä¹ä¼å¼ºå¶ Logstash                                             false\n                           å¨å³é­æé´éåºãé»è®¤æåµä¸ï¼Logstash\n                           å°æç»éåºï¼ç´å°æææ¥æ¶å°çäºä»¶é½è¢«æ¨éå°è¾åºãå¯ç¨æ­¤éé¡¹å¯è½ä¼å¯¼è´å³æºæé´æ°æ®ä¸¢å¤±ã\npath.config                ä¸»ç®¡éç Logstash éç½®è·¯å¾ãå¦ææ¨æå®ä¸ä¸ªç®å½æééç¬¦ï¼éç½®æä»¶å°æå­æ¯é¡ºåºä»ç®å½ä¸­è¯»åã                                           Platform-specific. See [dir-layout].\nconfig.string              åå«ç¨äºä¸»ç®¡éçç®¡ééç½®çå­ç¬¦ä¸²ãä½¿ç¨ä¸éç½®æä»¶ç¸åçè¯­æ³ã                                                               None\nconfig.test_and_exit       è®¾ç½®ä¸º true æ¶ï¼æ£æ¥éç½®æ¯å¦ææï¼ç¶åéåºãè¯·æ³¨æï¼ä½¿ç¨æ­¤è®¾ç½®ä¸ä¼æ£æ¥ grok æ¨¡å¼çæ­£ç¡®æ§ã Logstash                                 false\n                           å¯ä»¥ä»ç®å½ä¸­è¯»åå¤ä¸ªéç½®æä»¶ãå¦æå°æ­¤è®¾ç½®ä¸ log.levelï¼debug ç»åä½¿ç¨ï¼å Logstash\n                           å°è®°å½ç»åçéç½®æä»¶ï¼å¹¶æ³¨æå¶æºæä»¶çéç½®åã\nconfig.reload.automatic    è®¾ç½®ä¸º true æ¶ï¼å®ææ£æ¥éç½®æ¯å¦å·²æ´æ¹ï¼å¹¶å¨éç½®æ´æ¹æ¶éæ°å è½½éç½®ãè¿ä¹å¯ä»¥éè¿ SIGHUP ä¿¡å·æå¨è§¦åã                                   false\nconfig.reload.interval     Logstash æ£æ¥éç½®æä»¶æ´æ¹çæ¶é´é´éã                                                                      3s\nconfig.debug               è®¾ç½®ä¸º true                                                                                     false\n                           æ¶ï¼å°å®å¨ç¼è¯çéç½®æ¾ç¤ºä¸ºè°è¯æ¥å¿æ¶æ¯ãæ¨è¿å¿é¡»è®¾ç½®log.levelï¼debugãè­¦åï¼æ¥å¿æ¶æ¯å°åæ¬ä»»ä½ä¼ éç»æä»¶éç½®ä½ä¸ºææçâå¯ç âéé¡¹ï¼å¹¶å¯è½å¯¼è´ææå¯ç åºç°å¨æ¨çæ¥å¿ï¼\nconfig.support_escapes     å½è®¾ç½®ä¸º true æ¶ï¼å¸¦å¼å·çå­ç¬¦ä¸²å°å¤çè½¬ä¹å­ç¬¦ã                                                                  false\nmodules                    éç½®æ¶ï¼æ¨¡åå¿é¡»å¤äºä¸è¡¨æè¿°çåµå¥ YAML ç»æä¸­ã                                                                  None\nhttp.host                  ç»å®å°å                                                                                         "127.0.0.1"\nhttp.port                  ç»å®ç«¯å£                                                                                         9600\nlog.level                  æ¥å¿çº§å«ãææéé¡¹ï¼fatal > error > warn > info > debug > trace                                        info\nlog.format                 æ¥å¿æ ¼å¼ãjson ï¼JSON æ ¼å¼ï¼æ plain ï¼åå¯¹è±¡ï¼                                                             plain\npath.logs                  Logstash èªèº«æ¥å¿çå­å¨è·¯å¾                                                                           LOGSTASH_HOME/logs\npath.plugins               å¨åªéå¯ä»¥æ¾å°èªå®ä¹çæä»¶ãæ¨å¯ä»¥å¤æ¬¡æå®æ­¤è®¾ç½®ä»¥åå«å¤ä¸ªè·¯å¾ã                                                             \n\n\n# å¯å¨\n\n\n# å½ä»¤è¡\n\néè¿å½ä»¤è¡å¯å¨ logstash çæ¹å¼å¦ä¸ï¼\n\nbin/logstash [options]\n\n\nå¶ä¸­ options æ¯æ¨å¯ä»¥æå®ç¨äºæ§å¶ Logstash æ§è¡çå½ä»¤è¡æ å¿ã\n\nå¨å½ä»¤è¡ä¸è®¾ç½®çä»»ä½æ å¿é½ä¼è¦ç Logstash è®¾ç½®æä»¶ï¼logstash.ymlï¼ä¸­çç¸åºè®¾ç½®ï¼ä½è®¾ç½®æä»¶æ¬èº«ä¸ä¼æ´æ¹ã\n\n> æ³¨\n> \n> è½ç¶å¯ä»¥éè¿æå®å½ä»¤è¡åæ°çæ¹å¼ï¼æ¥æ§å¶ logstash çè¿è¡æ¹å¼ï¼ä½æ¾ç¶è¿ä¹åå¾éº»ç¦ã\n> \n> å»ºè®®éè¿æå®éç½®æä»¶çæ¹å¼ï¼æ¥æ§å¶ logstash è¿è¡ï¼å¯å¨å½ä»¤å¦ä¸ï¼\n> \n> bin/logstash -f logstash.conf\n> \n> \n> è¥æ³äºè§£æ´å¤çå½ä»¤è¡åæ°ç»èï¼è¯·åèï¼https://www.elastic.co/guide/en/logstash/current/running-logstash-command-line.html\n\n\n# éç½®æä»¶\n\nä¸èï¼æä»¬äºè§£å°ï¼logstash å¯ä»¥æ§è¡ bin/logstash -f logstash.conf ï¼æç§éç½®æä»¶ä¸­çåæ°å»è¦çé»è®¤è®¾ç½®æä»¶ï¼logstash.ymlï¼ä¸­çè®¾ç½®ã\n\nè¿èï¼æä»¬å°±æ¥å­¦ä¹ ä¸ä¸è¿ä¸ªéç½®æä»¶å¦ä½éç½®åæ°ã\n\n# éç½®æä»¶ç»æ\n\nå¨å·¥ä½åçä¸èä¸­ï¼æä»¬å·²ç»ç¥éäº Logstash ä¸»è¦æä¸ä¸ªå·¥ä½é¶æ®µ input ãfilterãoutputãè logstash éç½®æä»¶æä»¶ç»æä¹ä¸ä¹ç¸å¯¹åºï¼\n\ninput {}\n\nfilter {}\n\noutput {}\n\n\n> æ¯ä¸ªé¨åé½åå«ä¸ä¸ªæå¤ä¸ªæä»¶çéç½®éé¡¹ãå¦ææå®äºå¤ä¸ªè¿æ»¤å¨ï¼åä¼æç§å®ä»¬å¨éç½®æä»¶ä¸­çæ¾ç¤ºé¡ºåºåºç¨å®ä»¬ã\n\n# æä»¶éç½®\n\næä»¶çéç½®ç±æä»¶åç§°åæä»¶çä¸ä¸ªè®¾ç½®åç»æã\n\nä¸é¢çä¾å­ä¸­éç½®äºä¸¤ä¸ªè¾å¥æä»¶éç½®ï¼\n\ninput {\n  file {\n    path => "/var/log/messages"\n    type => "syslog"\n  }\n\n  file {\n    path => "/var/log/apache/access.log"\n    type => "apache"\n  }\n}\n\n\næ¨å¯ä»¥éç½®çè®¾ç½®å æä»¶ç±»åèå¼ãä½ å¯ä»¥åèï¼ Input Plugins, Output Plugins, Filter Plugins, å Codec Plugins ã\n\n# å¼ç±»å\n\nä¸ä¸ªæä»¶å¯ä»¥è¦æ±è®¾ç½®çå¼æ¯ä¸ä¸ªç¹å®çç±»åï¼æ¯å¦å¸å°å¼ï¼åè¡¨æåå¸å¼ãä»¥ä¸å¼ç±»ååæ¯æã\n\n * Array\n\n  users => [ {id => 1, name => bob}, {id => 2, name => jane} ]\n\n\n * Lists\n\npath => [\'/var/log/messages\', \'/var/log/*.log\']\nuris => [\'http://elastic.co\', \'http://example.net\']\n\n\n * Boolean\n\nssl_enable => true\n\n\n * Bytes\n\n  my_bytes => "1113"   # 1113 bytes\n  my_bytes => "10MiB"  # 10485760 bytes\n  my_bytes => "100kib" # 102400 bytes\n  my_bytes => "180 mb" # 180000000 bytes\n\n\n * Codec\n\ncodec => \'json\'\n\n\n * Hash\n\nmatch => {\n  "field1" => "value1"\n  "field2" => "value2"\n  ...\n}\n\n\n * Number\n\nport => 33\n\n\n * Password\n\nmy_password => \'password\'\n\n\n * URI\n\nmy_uri => \'http://foo:bar@example.net\'\n\n\n * Path\n\nmy_path => \'/tmp/logstash\'\n\n\n * String\n\n * è½¬ä¹å­ç¬¦\n\n\n# æä»¶\n\n\n# input\n\n> Logstash æ¯æåç§è¾å¥éæ© ï¼å¯ä»¥å¨åä¸æ¶é´ä»ä¼å¤å¸¸ç¨æ¥æºææäºä»¶ãè½å¤ä»¥è¿ç»­çæµå¼ä¼ è¾æ¹å¼ï¼è½»æ¾å°ä»æ¨çæ¥å¿ãææ ãWeb åºç¨ãæ°æ®å­å¨ä»¥ååç§ AWS æå¡ééæ°æ®ã\n\n# å¸¸ç¨ input æä»¶\n\n * fileï¼ä»æä»¶ç³»ç»ä¸çæä»¶è¯»åï¼å°±å UNIX å½ä»¤ tail -0F ä¸æ ·\n * **syslogï¼**å¨ä¼æå¨ç¥çç«¯å£ 514 ä¸ä¾¦å¬ç³»ç»æ¥å¿æ¶æ¯ï¼å¹¶æ ¹æ® RFC3164 æ ¼å¼è¿è¡è§£æ\n * **redisï¼**ä» redis æå¡å¨è¯»åï¼ä½¿ç¨ redis ééå redis åè¡¨ã Redis ç»å¸¸ç¨ä½éä¸­å¼ Logstash å®è£ä¸­çâä»£çâï¼å®å°æ¥èªè¿ç¨ Logstashâæè¿äººâç Logstash äºä»¶æéã\n * **beatsï¼**å¤çç± Filebeat åéçäºä»¶ã\n\næ´å¤è¯¦æè¯·è§ï¼Input Plugins\n\n\n# filter\n\n> è¿æ»¤å¨æ¯ Logstash ç®¡éä¸­çä¸­é´å¤çè®¾å¤ãå¦æç¬¦åç¹å®æ¡ä»¶ï¼æ¨å¯ä»¥å°æ¡ä»¶è¿æ»¤å¨ç»åå¨ä¸èµ·ï¼å¯¹äºä»¶æ§è¡æä½ã\n\n# å¸¸ç¨ filter æä»¶\n\n * **grokï¼**è§£æåç»æä»»æææ¬ã Grok ç®åæ¯ Logstash ä¸­å°éç»æåæ¥å¿æ°æ®è§£æä¸ºç»æååå¯æ¥è¯¢çæä½³æ¹æ³ã\n * **mutateï¼**å¯¹äºä»¶å­æ®µæ§è¡ä¸è¬è½¬æ¢ãæ¨å¯ä»¥éå½åï¼å é¤ï¼æ¿æ¢åä¿®æ¹äºä»¶ä¸­çå­æ®µã\n * **dropï¼**å®å¨æ¾å¼ä¸ä¸ªäºä»¶ï¼ä¾å¦è°è¯äºä»¶ã\n * **cloneï¼**å¶ä½ä¸ä¸ªäºä»¶çå¯æ¬ï¼å¯è½ä¼æ·»å æå é¤å­æ®µã\n * **geoipï¼**æ·»å æå³ IP å°åçå°çä½ç½®çä¿¡æ¯ï¼ä¹å¯ä»¥å¨ Kibana ä¸­æ¾ç¤ºæäººçå¾è¡¨ï¼ï¼\n\næ´å¤è¯¦æè¯·è§ï¼Filter Plugins\n\n\n# output\n\n> è¾åºæ¯ Logstash ç®¡éçæåé¶æ®µãä¸ä¸ªäºä»¶å¯ä»¥éè¿å¤ä¸ªè¾åºï¼ä½æ¯ä¸æ¦ææè¾åºå¤çå®æï¼äºä»¶å°±å®æäºæ§è¡ã\n\n# å¸¸ç¨ output æä»¶\n\n * **elasticsearchï¼**å°äºä»¶æ°æ®åéç» Elasticsearchï¼æ¨èæ¨¡å¼ï¼ã\n * **fileï¼**å°äºä»¶æ°æ®åå¥æä»¶æç£çã\n * **graphiteï¼**å°äºä»¶æ°æ®åéç» graphiteï¼ä¸ä¸ªæµè¡çå¼æºå·¥å·ï¼å­å¨åç»å¶ææ ã http://graphite.readthedocs.io/en/latest/ï¼ã\n * **statsdï¼**å°äºä»¶æ°æ®åéå° statsd ï¼è¿æ¯ä¸ç§ä¾¦å¬ç»è®¡æ°æ®çæå¡ï¼å¦è®¡æ°å¨åå®æ¶å¨ï¼éè¿ UDP åéå¹¶å°èååéå°ä¸ä¸ªæå¤ä¸ªå¯æå¥çåç«¯æå¡ï¼ã\n\næ´å¤è¯¦æè¯·è§ï¼Output Plugins\n\n\n# codec\n\nç¨äºæ ¼å¼åå¯¹åºçåå®¹ã\n\n# å¸¸ç¨ codec æä»¶\n\n * **jsonï¼**ä»¥ JSON æ ¼å¼å¯¹æ°æ®è¿è¡ç¼ç æè§£ç ã\n * **multilineï¼**å°å¤è¡ææ¬äºä»¶ï¼å¦ java å¼å¸¸åå æ è·è¸ªæ¶æ¯ï¼åå¹¶ä¸ºåä¸ªäºä»¶ã\n\næ´å¤æä»¶è¯·è§ï¼Codec Plugins\n\n\n# å®æ\n\nåé¢çåå®¹é½æ¯å¯¹ Logstash çä»ç»ååçè¯´æãæ¥ä¸æ¥ï¼æä»¬æ¥å®æä¸äºå¸¸è§çåºç¨åºæ¯ã\n\n\n# ä¼ è¾æ§å¶å°æ°æ®\n\n> stdin input æä»¶ä»æ åè¾å¥è¯»åäºä»¶ãè¿æ¯æç®åç input æä»¶ï¼ä¸è¬ç¨äºæµè¯åºæ¯ã\n\nåºç¨\n\nï¼1ï¼åå»º logstash-input-stdin.conf ï¼\n\ninput { stdin { } }\noutput {\n  elasticsearch { hosts => ["localhost:9200"] }\n  stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-stdin.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼\n\nbin/logstash -f logstash-input-stdin.conf\n\n\n\n# ä¼ è¾ logback æ¥å¿\n\n> elk é»è®¤ä½¿ç¨ç Java æ¥å¿å·¥å·æ¯ log4j2 ï¼å¹¶ä¸æ¯æ logback å log4jã\n> \n> æ³ä½¿ç¨ logback + logstash ï¼å¯ä»¥ä½¿ç¨ logstash-logback-encoder ãlogstash-logback-encoder æä¾äº UDP / TCP / å¼æ­¥æ¹å¼æ¥ä¼ è¾æ¥å¿æ°æ®å° logstashã\n> \n> å¦æä½ ä½¿ç¨çæ¯ log4j ï¼ä¹ä¸æ¯ä¸å¯ä»¥ç¨è¿ç§æ¹å¼ï¼åªè¦å¼å¥æ¡¥æ¥ jar åå³å¯ãå¦æä½ å¯¹ log4j ãlogback ï¼ææ¯æ¡¥æ¥ jar åä¸å¤ªäºè§£ï¼å¯ä»¥åèæçè¿ç¯åæï¼ç»è¯´ Java ä¸»æµæ¥å¿å·¥å·åº ã\n\n# TCP åºç¨\n\nlogstash éç½®\n\nï¼1ï¼åå»º logstash-input-tcp.conf ï¼\n\ninput {\ntcp {\n  port => 9251\n  codec => json_lines\n  mode => server\n}\n}\noutput {\n elasticsearch { hosts => ["localhost:9200"] }\n stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-tcp.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-udp.conf\n\njava åºç¨éç½®\n\nï¼1ï¼å¨ Java åºç¨ç pom.xml ä¸­å¼å¥ jar åï¼\n\n<dependency>\n <groupId>net.logstash.logback</groupId>\n <artifactId>logstash-logback-encoder</artifactId>\n <version>4.11</version>\n</dependency>\n\n\x3c!-- logback ä¾èµå --\x3e\n<dependency>\n <groupId>ch.qos.logback</groupId>\n <artifactId>logback-core</artifactId>\n <version>1.2.3</version>\n</dependency>\n<dependency>\n <groupId>ch.qos.logback</groupId>\n <artifactId>logback-classic</artifactId>\n <version>1.2.3</version>\n</dependency>\n<dependency>\n <groupId>ch.qos.logback</groupId>\n <artifactId>logback-access</artifactId>\n <version>1.2.3</version>\n</dependency>\n\n\nï¼2ï¼æ¥çï¼å¨ logback.xml ä¸­æ·»å  appender\n\n<appender name="ELK-TCP" class="net.logstash.logback.appender.LogstashTcpSocketAppender">\n \x3c!--\n destination æ¯ logstash æå¡ç host:portï¼\n ç¸å½äºå logstash å»ºç«äºç®¡éï¼å°æ¥å¿æ°æ®å®åä¼ è¾å° logstash\n --\x3e\n <destination>192.168.28.32:9251</destination>\n <encoder charset="UTF-8" class="net.logstash.logback.encoder.LogstashEncoder"/>\n</appender>\n<logger name="io.github.dunwu.spring" level="TRACE" additivity="false">\n <appender-ref ref="ELK-TCP" />\n</logger>\n\n\nï¼3ï¼æ¥ä¸æ¥ï¼å°±æ¯ logback çå·ä½ä½¿ç¨ ï¼å¦æå¯¹æ­¤ä¸äºè§£ï¼ä¸å¦¨åèä¸ä¸æçè¿ç¯åæï¼ç»è¯´ Java ä¸»æµæ¥å¿å·¥å·åº ã\n\nå®ä¾ï¼æç logback.xml\n\n# UDP åºç¨\n\nUDP å TCP çä½¿ç¨æ¹å¼å¤§åå°å¼ã\n\nlogstash éç½®\n\nï¼1ï¼åå»º logstash-input-udp.conf ï¼\n\ninput {\nudp {\n  port => 9250\n  codec => json\n}\n}\noutput {\n elasticsearch { hosts => ["localhost:9200"] }\n stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-udp.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-udp.conf\n\njava åºç¨éç½®\n\nï¼1ï¼å¨ Java åºç¨ç pom.xml ä¸­å¼å¥ jar åï¼\n\nä¸ TCP åºç¨ ä¸èä¸­çå¼å¥ä¾èµåå®å¨ç¸åã\n\nï¼2ï¼æ¥çï¼å¨ logback.xml ä¸­æ·»å  appender\n\n<appender name="ELK-UDP" class="net.logstash.logback.appender.LogstashSocketAppender">\n  <host>192.168.28.32</host>\n  <port>9250</port>\n</appender>\n<logger name="io.github.dunwu.spring" level="TRACE" additivity="false">\n  <appender-ref ref="ELK-UDP" />\n</logger>\n\n\nï¼3ï¼æ¥ä¸æ¥ï¼å°±æ¯ logback çå·ä½ä½¿ç¨ ï¼å¦æå¯¹æ­¤ä¸äºè§£ï¼ä¸å¦¨åèä¸ä¸æçè¿ç¯åæï¼ç»è¯´ Java ä¸»æµæ¥å¿å·¥å·åº ã\n\nå®ä¾ï¼æç logback.xml\n\n\n# ä¼ è¾æä»¶\n\n> å¨ Java Web é¢åï¼éè¦ç¨å°ä¸äºéè¦çå·¥å·ï¼ä¾å¦ Tomcat ãNginx ãMysql ç­ãè¿äºä¸å±äºä¸å¡åºç¨ï¼ä½æ¯å®ä»¬çæ¥å¿æ°æ®å¯¹äºå®ä½é®é¢ãåæç»è®¡åæ ·å¾éè¦ãè¿æ¶æ æ³ä½¿ç¨ logback æ¹å¼å°å®ä»¬çæ¥å¿ä¼ è¾å° logstashã\n> \n> å¦ä½ééè¿äºæ¥å¿æä»¶å¢ï¼å«æ¥ï¼ä½ å¯ä»¥ä½¿ç¨ logstash ç file input æä»¶ã\n> \n> éè¦æ³¨æçæ¯ï¼ä¼ è¾æä»¶è¿ç§æ¹å¼ï¼å¿é¡»å¨æ¥å¿æå¨çæºå¨ä¸é¨ç½² logstash ã\n\nåºç¨\n\nlogstash éç½®\n\nï¼1ï¼åå»º logstash-input-file.conf ï¼\n\ninput {\n file {\n  path => ["/var/log/nginx/access.log"]\n  type => "nginx-access-log"\n  start_position => "beginning"\n }\n}\n\noutput {\n if [type] == "nginx-access-log" {\n  elasticsearch {\n   hosts => ["localhost:9200"]\n   index => "nginx-access-log"\n  }\n }\n}\n\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-file.conf\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-file.html\n\n\n# å°æå·§\n\n\n# å¯å¨ãç»æ­¢åºç¨\n\nå¦æä½ ç logstash æ¯æ¬¡é½æ¯éè¿æå®éç½®æä»¶æ¹å¼å¯å¨ãä¸å¦¨å»ºç«ä¸ä¸ªå¯å¨èæ¬ã\n\n# cd xxx è¿å¥ logstash å®è£ç®å½ä¸ç bin ç®å½\nlogstash -f logstash.conf\n\n\nå¦æä½ ç logstash è¿è¡å¨ linux ç³»ç»ä¸ï¼ä¸å¦¨ä½¿ç¨ nohup æ¥å¯å¨ä¸ä¸ªå®æ¤è¿ç¨ãè¿æ ·åçå¥½å¤å¨äºï¼å³ä½¿å³é­ç»ç«¯ï¼åºç¨ä»ä¼è¿è¡ã\n\nåå»º startup.sh\n\nnohup ./logstash -f logstash.conf >> nohup.out 2>&1 &\n\n\nç»æ­¢åºç¨æ²¡æä»ä¹å¥½æ¹æ³ï¼ä½ åªè½ä½¿ç¨ ps -ef | grep logstash ï¼æ¥åºè¿ç¨ï¼å°å¶ kill ãä¸è¿ï¼æä»¬å¯ä»¥åä¸ä¸ªèæ¬æ¥å¹²è¿ä»¶äºï¼\n\nåå»º shutdown.sh\n\nèæ¬ä¸å¤è§£éï¼è¯·èªè¡é¢ä¼ä½ç¨ã\n\nPID=`ps -ef | grep logstash | awk \'{ print $2}\' | head -n 1`\nkill -9 ${PID}\n\n\n\n# èµæ\n\n * Logstash å®æ¹ææ¡£\n * logstash-logback-encoder\n * ELK Stack æå¨æå\n * ELKï¼ElasticsearchãLogstashãKibanaï¼å®è£åéç½®\n\n\n# æ¨èéè¯»\n\n * Elastic ææ¯æ \n * JavaStack',normalizedContent:'# elastic ææ¯æ ä¹ logstash\n\n> æ¬ææ¯ elastic ææ¯æ ï¼elkï¼ç logstash åºç¨ã\n> \n> å¦æä¸äºè§£ elastic çå®è£ãéç½®ãé¨ç½²ï¼å¯ä»¥åèï¼elastic ææ¯æ ä¹å¿«éå¥é¨\n\n\n# ç®ä»\n\nlogstash å¯ä»¥ä¼ è¾åå¤çä½ çæ¥å¿ãäºå¡æå¶ä»æ°æ®ã\n\n\n# åè½\n\nlogstash æ¯ elasticsearch çæä½³æ°æ®ç®¡éã\n\nlogstash æ¯æä»¶å¼ç®¡çæ¨¡å¼ï¼å¨è¾å¥ãè¿æ»¤ãè¾åºä»¥åç¼ç è¿ç¨ä¸­é½å¯ä»¥ä½¿ç¨æä»¶è¿è¡å®å¶ãlogstash ç¤¾åºæè¶è¿ 200 ç§å¯ç¨æä»¶ã\n\n\n# å·¥ä½åç\n\nlogstash æä¸¤ä¸ªå¿è¦åç´ ï¼input å output ï¼ä¸ä¸ªå¯éåç´ ï¼filterã\n\nè¿ä¸ä¸ªåç´ ï¼åå«ä»£è¡¨ logstash äºä»¶å¤ççä¸ä¸ªé¶æ®µï¼è¾å¥ > è¿æ»¤å¨ > è¾åºã\n\n\n\n * input è´è´£ä»æ°æ®æºééæ°æ®ã\n * filter å°æ°æ®ä¿®æ¹ä¸ºä½ æå®çæ ¼å¼æåå®¹ã\n * output å°æ°æ®ä¼ è¾å°ç®çå°ã\n\nå¨å®éåºç¨åºæ¯ä¸­ï¼éå¸¸è¾å¥ãè¾åºãè¿æ»¤å¨ä¸æ­¢ä¸ä¸ªãlogstash çè¿ä¸ä¸ªåç´ é½ä½¿ç¨æä»¶å¼ç®¡çæ¹å¼ï¼ç¨æ·å¯ä»¥æ ¹æ®åºç¨éè¦ï¼çµæ´»çéç¨åé¶æ®µéè¦çæä»¶ï¼å¹¶ç»åä½¿ç¨ã\n\nåé¢å°å¯¹æä»¶å±å¼è®²è§£ï¼æä¸ä¸è¡¨ã\n\n\n# è®¾ç½®\n\n\n# è®¾ç½®æä»¶\n\n * logstash.ymlï¼logstash çé»è®¤å¯å¨éç½®æä»¶\n * jvm.optionsï¼logstash ç jvm éç½®æä»¶ã\n * startup.options (linux)ï¼åå«ç³»ç»å®è£èæ¬å¨ /usr/share/logstash/bin ä¸­ä½¿ç¨çéé¡¹ä¸ºæ¨çç³»ç»æå»ºéå½çå¯å¨èæ¬ãå®è£ logstash è½¯ä»¶åæ¶ï¼ç³»ç»å®è£èæ¬å°å¨å®è£è¿ç¨ç»ææ¶æ§è¡ï¼å¹¶ä½¿ç¨ startup.options ä¸­æå®çè®¾ç½®æ¥è®¾ç½®ç¨æ·ï¼ç»ï¼æå¡åç§°åæå¡æè¿°ç­éé¡¹ã\n\n\n# logstash.yml è®¾ç½®é¡¹\n\nèéé¨åè®¾ç½®é¡¹ï¼æ´å¤é¡¹è¯·åèï¼https://www.elastic.co/guide/en/logstash/current/logstash-settings-file.html\n\nåæ°                         æè¿°                                                                                           é»è®¤å¼\nnode.name                  èç¹å                                                                                          æºå¨çä¸»æºå\npath.data                  logstash åå¶æä»¶ç¨äºä»»ä½æä¹æ§éæ±çç®å½ã                                                                   logstash_home/data\npipeline.workers           åæ¶æ§è¡ç®¡éçè¿æ»¤å¨åè¾åºé¶æ®µçå·¥ä½ä»»å¡æ°éãå¦æåç°äºä»¶æ­£å¨å¤ä»½ï¼æ cpu                                                      number of the hostâs cpu cores\n                           æªé¥±åï¼è¯·èèå¢å æ­¤æ°å­ä»¥æ´å¥½å°å©ç¨æºå¨å¤çè½åã\npipeline.batch.size        å°è¯æ§è¡è¿æ»¤å¨åè¾åºä¹åï¼åä¸ªå·¥ä½çº¿ç¨ä»è¾å¥æ¶éçæå¤§äºä»¶æ°éãè¾å¤§çæ¹éå¤çå¤§å°ä¸è¬æ¥è¯´æçæ´é«ï¼ä½æ¯ä»¥å¢å çåå­å¼éä¸ºä»£ä»·ãæ¨å¯è½å¿é¡»éè¿è®¾ç½®                    125\n                           ls_heap_size åéæ¥ææä½¿ç¨è¯¥éé¡¹æ¥å¢å  jvm å å¤§å°ã\npipeline.batch.delay       åå»ºç®¡éäºä»¶æ¹å¤çæ¶ï¼å¨å°ä¸ä¸ªå°ºå¯¸è¿å°çæ¹æ¬¡åéç»ç®¡éå·¥ä½ä»»å¡ä¹åï¼ç­å¾æ¯ä¸ªäºä»¶éè¦å¤é¿æ¶é´ï¼æ¯«ç§ï¼ã                                          5\npipeline.unsafe_shutdown   å¦æè®¾ç½®ä¸º trueï¼åå³ä½¿å¨åå­ä¸­ä»å­å¨ inflight äºä»¶æ¶ï¼ä¹ä¼å¼ºå¶ logstash                                             false\n                           å¨å³é­æé´éåºãé»è®¤æåµä¸ï¼logstash\n                           å°æç»éåºï¼ç´å°æææ¥æ¶å°çäºä»¶é½è¢«æ¨éå°è¾åºãå¯ç¨æ­¤éé¡¹å¯è½ä¼å¯¼è´å³æºæé´æ°æ®ä¸¢å¤±ã\npath.config                ä¸»ç®¡éç logstash éç½®è·¯å¾ãå¦ææ¨æå®ä¸ä¸ªç®å½æééç¬¦ï¼éç½®æä»¶å°æå­æ¯é¡ºåºä»ç®å½ä¸­è¯»åã                                           platform-specific. see [dir-layout].\nconfig.string              åå«ç¨äºä¸»ç®¡éçç®¡ééç½®çå­ç¬¦ä¸²ãä½¿ç¨ä¸éç½®æä»¶ç¸åçè¯­æ³ã                                                               none\nconfig.test_and_exit       è®¾ç½®ä¸º true æ¶ï¼æ£æ¥éç½®æ¯å¦ææï¼ç¶åéåºãè¯·æ³¨æï¼ä½¿ç¨æ­¤è®¾ç½®ä¸ä¼æ£æ¥ grok æ¨¡å¼çæ­£ç¡®æ§ã logstash                                 false\n                           å¯ä»¥ä»ç®å½ä¸­è¯»åå¤ä¸ªéç½®æä»¶ãå¦æå°æ­¤è®¾ç½®ä¸ log.levelï¼debug ç»åä½¿ç¨ï¼å logstash\n                           å°è®°å½ç»åçéç½®æä»¶ï¼å¹¶æ³¨æå¶æºæä»¶çéç½®åã\nconfig.reload.automatic    è®¾ç½®ä¸º true æ¶ï¼å®ææ£æ¥éç½®æ¯å¦å·²æ´æ¹ï¼å¹¶å¨éç½®æ´æ¹æ¶éæ°å è½½éç½®ãè¿ä¹å¯ä»¥éè¿ sighup ä¿¡å·æå¨è§¦åã                                   false\nconfig.reload.interval     logstash æ£æ¥éç½®æä»¶æ´æ¹çæ¶é´é´éã                                                                      3s\nconfig.debug               è®¾ç½®ä¸º true                                                                                     false\n                           æ¶ï¼å°å®å¨ç¼è¯çéç½®æ¾ç¤ºä¸ºè°è¯æ¥å¿æ¶æ¯ãæ¨è¿å¿é¡»è®¾ç½®log.levelï¼debugãè­¦åï¼æ¥å¿æ¶æ¯å°åæ¬ä»»ä½ä¼ éç»æä»¶éç½®ä½ä¸ºææçâå¯ç âéé¡¹ï¼å¹¶å¯è½å¯¼è´ææå¯ç åºç°å¨æ¨çæ¥å¿ï¼\nconfig.support_escapes     å½è®¾ç½®ä¸º true æ¶ï¼å¸¦å¼å·çå­ç¬¦ä¸²å°å¤çè½¬ä¹å­ç¬¦ã                                                                  false\nmodules                    éç½®æ¶ï¼æ¨¡åå¿é¡»å¤äºä¸è¡¨æè¿°çåµå¥ yaml ç»æä¸­ã                                                                  none\nhttp.host                  ç»å®å°å                                                                                         "127.0.0.1"\nhttp.port                  ç»å®ç«¯å£                                                                                         9600\nlog.level                  æ¥å¿çº§å«ãææéé¡¹ï¼fatal > error > warn > info > debug > trace                                        info\nlog.format                 æ¥å¿æ ¼å¼ãjson ï¼json æ ¼å¼ï¼æ plain ï¼åå¯¹è±¡ï¼                                                             plain\npath.logs                  logstash èªèº«æ¥å¿çå­å¨è·¯å¾                                                                           logstash_home/logs\npath.plugins               å¨åªéå¯ä»¥æ¾å°èªå®ä¹çæä»¶ãæ¨å¯ä»¥å¤æ¬¡æå®æ­¤è®¾ç½®ä»¥åå«å¤ä¸ªè·¯å¾ã                                                             \n\n\n# å¯å¨\n\n\n# å½ä»¤è¡\n\néè¿å½ä»¤è¡å¯å¨ logstash çæ¹å¼å¦ä¸ï¼\n\nbin/logstash [options]\n\n\nå¶ä¸­ options æ¯æ¨å¯ä»¥æå®ç¨äºæ§å¶ logstash æ§è¡çå½ä»¤è¡æ å¿ã\n\nå¨å½ä»¤è¡ä¸è®¾ç½®çä»»ä½æ å¿é½ä¼è¦ç logstash è®¾ç½®æä»¶ï¼logstash.ymlï¼ä¸­çç¸åºè®¾ç½®ï¼ä½è®¾ç½®æä»¶æ¬èº«ä¸ä¼æ´æ¹ã\n\n> æ³¨\n> \n> è½ç¶å¯ä»¥éè¿æå®å½ä»¤è¡åæ°çæ¹å¼ï¼æ¥æ§å¶ logstash çè¿è¡æ¹å¼ï¼ä½æ¾ç¶è¿ä¹åå¾éº»ç¦ã\n> \n> å»ºè®®éè¿æå®éç½®æä»¶çæ¹å¼ï¼æ¥æ§å¶ logstash è¿è¡ï¼å¯å¨å½ä»¤å¦ä¸ï¼\n> \n> bin/logstash -f logstash.conf\n> \n> \n> è¥æ³äºè§£æ´å¤çå½ä»¤è¡åæ°ç»èï¼è¯·åèï¼https://www.elastic.co/guide/en/logstash/current/running-logstash-command-line.html\n\n\n# éç½®æä»¶\n\nä¸èï¼æä»¬äºè§£å°ï¼logstash å¯ä»¥æ§è¡ bin/logstash -f logstash.conf ï¼æç§éç½®æä»¶ä¸­çåæ°å»è¦çé»è®¤è®¾ç½®æä»¶ï¼logstash.ymlï¼ä¸­çè®¾ç½®ã\n\nè¿èï¼æä»¬å°±æ¥å­¦ä¹ ä¸ä¸è¿ä¸ªéç½®æä»¶å¦ä½éç½®åæ°ã\n\n# éç½®æä»¶ç»æ\n\nå¨å·¥ä½åçä¸èä¸­ï¼æä»¬å·²ç»ç¥éäº logstash ä¸»è¦æä¸ä¸ªå·¥ä½é¶æ®µ input ãfilterãoutputãè logstash éç½®æä»¶æä»¶ç»æä¹ä¸ä¹ç¸å¯¹åºï¼\n\ninput {}\n\nfilter {}\n\noutput {}\n\n\n> æ¯ä¸ªé¨åé½åå«ä¸ä¸ªæå¤ä¸ªæä»¶çéç½®éé¡¹ãå¦ææå®äºå¤ä¸ªè¿æ»¤å¨ï¼åä¼æç§å®ä»¬å¨éç½®æä»¶ä¸­çæ¾ç¤ºé¡ºåºåºç¨å®ä»¬ã\n\n# æä»¶éç½®\n\næä»¶çéç½®ç±æä»¶åç§°åæä»¶çä¸ä¸ªè®¾ç½®åç»æã\n\nä¸é¢çä¾å­ä¸­éç½®äºä¸¤ä¸ªè¾å¥æä»¶éç½®ï¼\n\ninput {\n  file {\n    path => "/var/log/messages"\n    type => "syslog"\n  }\n\n  file {\n    path => "/var/log/apache/access.log"\n    type => "apache"\n  }\n}\n\n\næ¨å¯ä»¥éç½®çè®¾ç½®å æä»¶ç±»åèå¼ãä½ å¯ä»¥åèï¼ input plugins, output plugins, filter plugins, å codec plugins ã\n\n# å¼ç±»å\n\nä¸ä¸ªæä»¶å¯ä»¥è¦æ±è®¾ç½®çå¼æ¯ä¸ä¸ªç¹å®çç±»åï¼æ¯å¦å¸å°å¼ï¼åè¡¨æåå¸å¼ãä»¥ä¸å¼ç±»ååæ¯æã\n\n * array\n\n  users => [ {id => 1, name => bob}, {id => 2, name => jane} ]\n\n\n * lists\n\npath => [\'/var/log/messages\', \'/var/log/*.log\']\nuris => [\'http://elastic.co\', \'http://example.net\']\n\n\n * boolean\n\nssl_enable => true\n\n\n * bytes\n\n  my_bytes => "1113"   # 1113 bytes\n  my_bytes => "10mib"  # 10485760 bytes\n  my_bytes => "100kib" # 102400 bytes\n  my_bytes => "180 mb" # 180000000 bytes\n\n\n * codec\n\ncodec => \'json\'\n\n\n * hash\n\nmatch => {\n  "field1" => "value1"\n  "field2" => "value2"\n  ...\n}\n\n\n * number\n\nport => 33\n\n\n * password\n\nmy_password => \'password\'\n\n\n * uri\n\nmy_uri => \'http://foo:bar@example.net\'\n\n\n * path\n\nmy_path => \'/tmp/logstash\'\n\n\n * string\n\n * è½¬ä¹å­ç¬¦\n\n\n# æä»¶\n\n\n# input\n\n> logstash æ¯æåç§è¾å¥éæ© ï¼å¯ä»¥å¨åä¸æ¶é´ä»ä¼å¤å¸¸ç¨æ¥æºææäºä»¶ãè½å¤ä»¥è¿ç»­çæµå¼ä¼ è¾æ¹å¼ï¼è½»æ¾å°ä»æ¨çæ¥å¿ãææ ãweb åºç¨ãæ°æ®å­å¨ä»¥ååç§ aws æå¡ééæ°æ®ã\n\n# å¸¸ç¨ input æä»¶\n\n * fileï¼ä»æä»¶ç³»ç»ä¸çæä»¶è¯»åï¼å°±å unix å½ä»¤ tail -0f ä¸æ ·\n * **syslogï¼**å¨ä¼æå¨ç¥çç«¯å£ 514 ä¸ä¾¦å¬ç³»ç»æ¥å¿æ¶æ¯ï¼å¹¶æ ¹æ® rfc3164 æ ¼å¼è¿è¡è§£æ\n * **redisï¼**ä» redis æå¡å¨è¯»åï¼ä½¿ç¨ redis ééå redis åè¡¨ã redis ç»å¸¸ç¨ä½éä¸­å¼ logstash å®è£ä¸­çâä»£çâï¼å®å°æ¥èªè¿ç¨ logstashâæè¿äººâç logstash äºä»¶æéã\n * **beatsï¼**å¤çç± filebeat åéçäºä»¶ã\n\næ´å¤è¯¦æè¯·è§ï¼input plugins\n\n\n# filter\n\n> è¿æ»¤å¨æ¯ logstash ç®¡éä¸­çä¸­é´å¤çè®¾å¤ãå¦æç¬¦åç¹å®æ¡ä»¶ï¼æ¨å¯ä»¥å°æ¡ä»¶è¿æ»¤å¨ç»åå¨ä¸èµ·ï¼å¯¹äºä»¶æ§è¡æä½ã\n\n# å¸¸ç¨ filter æä»¶\n\n * **grokï¼**è§£æåç»æä»»æææ¬ã grok ç®åæ¯ logstash ä¸­å°éç»æåæ¥å¿æ°æ®è§£æä¸ºç»æååå¯æ¥è¯¢çæä½³æ¹æ³ã\n * **mutateï¼**å¯¹äºä»¶å­æ®µæ§è¡ä¸è¬è½¬æ¢ãæ¨å¯ä»¥éå½åï¼å é¤ï¼æ¿æ¢åä¿®æ¹äºä»¶ä¸­çå­æ®µã\n * **dropï¼**å®å¨æ¾å¼ä¸ä¸ªäºä»¶ï¼ä¾å¦è°è¯äºä»¶ã\n * **cloneï¼**å¶ä½ä¸ä¸ªäºä»¶çå¯æ¬ï¼å¯è½ä¼æ·»å æå é¤å­æ®µã\n * **geoipï¼**æ·»å æå³ ip å°åçå°çä½ç½®çä¿¡æ¯ï¼ä¹å¯ä»¥å¨ kibana ä¸­æ¾ç¤ºæäººçå¾è¡¨ï¼ï¼\n\næ´å¤è¯¦æè¯·è§ï¼filter plugins\n\n\n# output\n\n> è¾åºæ¯ logstash ç®¡éçæåé¶æ®µãä¸ä¸ªäºä»¶å¯ä»¥éè¿å¤ä¸ªè¾åºï¼ä½æ¯ä¸æ¦ææè¾åºå¤çå®æï¼äºä»¶å°±å®æäºæ§è¡ã\n\n# å¸¸ç¨ output æä»¶\n\n * **elasticsearchï¼**å°äºä»¶æ°æ®åéç» elasticsearchï¼æ¨èæ¨¡å¼ï¼ã\n * **fileï¼**å°äºä»¶æ°æ®åå¥æä»¶æç£çã\n * **graphiteï¼**å°äºä»¶æ°æ®åéç» graphiteï¼ä¸ä¸ªæµè¡çå¼æºå·¥å·ï¼å­å¨åç»å¶ææ ã http://graphite.readthedocs.io/en/latest/ï¼ã\n * **statsdï¼**å°äºä»¶æ°æ®åéå° statsd ï¼è¿æ¯ä¸ç§ä¾¦å¬ç»è®¡æ°æ®çæå¡ï¼å¦è®¡æ°å¨åå®æ¶å¨ï¼éè¿ udp åéå¹¶å°èååéå°ä¸ä¸ªæå¤ä¸ªå¯æå¥çåç«¯æå¡ï¼ã\n\næ´å¤è¯¦æè¯·è§ï¼output plugins\n\n\n# codec\n\nç¨äºæ ¼å¼åå¯¹åºçåå®¹ã\n\n# å¸¸ç¨ codec æä»¶\n\n * **jsonï¼**ä»¥ json æ ¼å¼å¯¹æ°æ®è¿è¡ç¼ç æè§£ç ã\n * **multilineï¼**å°å¤è¡ææ¬äºä»¶ï¼å¦ java å¼å¸¸åå æ è·è¸ªæ¶æ¯ï¼åå¹¶ä¸ºåä¸ªäºä»¶ã\n\næ´å¤æä»¶è¯·è§ï¼codec plugins\n\n\n# å®æ\n\nåé¢çåå®¹é½æ¯å¯¹ logstash çä»ç»ååçè¯´æãæ¥ä¸æ¥ï¼æä»¬æ¥å®æä¸äºå¸¸è§çåºç¨åºæ¯ã\n\n\n# ä¼ è¾æ§å¶å°æ°æ®\n\n> stdin input æä»¶ä»æ åè¾å¥è¯»åäºä»¶ãè¿æ¯æç®åç input æä»¶ï¼ä¸è¬ç¨äºæµè¯åºæ¯ã\n\nåºç¨\n\nï¼1ï¼åå»º logstash-input-stdin.conf ï¼\n\ninput { stdin { } }\noutput {\n  elasticsearch { hosts => ["localhost:9200"] }\n  stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-stdin.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼\n\nbin/logstash -f logstash-input-stdin.conf\n\n\n\n# ä¼ è¾ logback æ¥å¿\n\n> elk é»è®¤ä½¿ç¨ç java æ¥å¿å·¥å·æ¯ log4j2 ï¼å¹¶ä¸æ¯æ logback å log4jã\n> \n> æ³ä½¿ç¨ logback + logstash ï¼å¯ä»¥ä½¿ç¨ logstash-logback-encoder ãlogstash-logback-encoder æä¾äº udp / tcp / å¼æ­¥æ¹å¼æ¥ä¼ è¾æ¥å¿æ°æ®å° logstashã\n> \n> å¦æä½ ä½¿ç¨çæ¯ log4j ï¼ä¹ä¸æ¯ä¸å¯ä»¥ç¨è¿ç§æ¹å¼ï¼åªè¦å¼å¥æ¡¥æ¥ jar åå³å¯ãå¦æä½ å¯¹ log4j ãlogback ï¼ææ¯æ¡¥æ¥ jar åä¸å¤ªäºè§£ï¼å¯ä»¥åèæçè¿ç¯åæï¼ç»è¯´ java ä¸»æµæ¥å¿å·¥å·åº ã\n\n# tcp åºç¨\n\nlogstash éç½®\n\nï¼1ï¼åå»º logstash-input-tcp.conf ï¼\n\ninput {\ntcp {\n  port => 9251\n  codec => json_lines\n  mode => server\n}\n}\noutput {\n elasticsearch { hosts => ["localhost:9200"] }\n stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-tcp.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-udp.conf\n\njava åºç¨éç½®\n\nï¼1ï¼å¨ java åºç¨ç pom.xml ä¸­å¼å¥ jar åï¼\n\n<dependency>\n <groupid>net.logstash.logback</groupid>\n <artifactid>logstash-logback-encoder</artifactid>\n <version>4.11</version>\n</dependency>\n\n\x3c!-- logback ä¾èµå --\x3e\n<dependency>\n <groupid>ch.qos.logback</groupid>\n <artifactid>logback-core</artifactid>\n <version>1.2.3</version>\n</dependency>\n<dependency>\n <groupid>ch.qos.logback</groupid>\n <artifactid>logback-classic</artifactid>\n <version>1.2.3</version>\n</dependency>\n<dependency>\n <groupid>ch.qos.logback</groupid>\n <artifactid>logback-access</artifactid>\n <version>1.2.3</version>\n</dependency>\n\n\nï¼2ï¼æ¥çï¼å¨ logback.xml ä¸­æ·»å  appender\n\n<appender name="elk-tcp" class="net.logstash.logback.appender.logstashtcpsocketappender">\n \x3c!--\n destination æ¯ logstash æå¡ç host:portï¼\n ç¸å½äºå logstash å»ºç«äºç®¡éï¼å°æ¥å¿æ°æ®å®åä¼ è¾å° logstash\n --\x3e\n <destination>192.168.28.32:9251</destination>\n <encoder charset="utf-8" class="net.logstash.logback.encoder.logstashencoder"/>\n</appender>\n<logger name="io.github.dunwu.spring" level="trace" additivity="false">\n <appender-ref ref="elk-tcp" />\n</logger>\n\n\nï¼3ï¼æ¥ä¸æ¥ï¼å°±æ¯ logback çå·ä½ä½¿ç¨ ï¼å¦æå¯¹æ­¤ä¸äºè§£ï¼ä¸å¦¨åèä¸ä¸æçè¿ç¯åæï¼ç»è¯´ java ä¸»æµæ¥å¿å·¥å·åº ã\n\nå®ä¾ï¼æç logback.xml\n\n# udp åºç¨\n\nudp å tcp çä½¿ç¨æ¹å¼å¤§åå°å¼ã\n\nlogstash éç½®\n\nï¼1ï¼åå»º logstash-input-udp.conf ï¼\n\ninput {\nudp {\n  port => 9250\n  codec => json\n}\n}\noutput {\n elasticsearch { hosts => ["localhost:9200"] }\n stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-udp.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-udp.conf\n\njava åºç¨éç½®\n\nï¼1ï¼å¨ java åºç¨ç pom.xml ä¸­å¼å¥ jar åï¼\n\nä¸ tcp åºç¨ ä¸èä¸­çå¼å¥ä¾èµåå®å¨ç¸åã\n\nï¼2ï¼æ¥çï¼å¨ logback.xml ä¸­æ·»å  appender\n\n<appender name="elk-udp" class="net.logstash.logback.appender.logstashsocketappender">\n  <host>192.168.28.32</host>\n  <port>9250</port>\n</appender>\n<logger name="io.github.dunwu.spring" level="trace" additivity="false">\n  <appender-ref ref="elk-udp" />\n</logger>\n\n\nï¼3ï¼æ¥ä¸æ¥ï¼å°±æ¯ logback çå·ä½ä½¿ç¨ ï¼å¦æå¯¹æ­¤ä¸äºè§£ï¼ä¸å¦¨åèä¸ä¸æçè¿ç¯åæï¼ç»è¯´ java ä¸»æµæ¥å¿å·¥å·åº ã\n\nå®ä¾ï¼æç logback.xml\n\n\n# ä¼ è¾æä»¶\n\n> å¨ java web é¢åï¼éè¦ç¨å°ä¸äºéè¦çå·¥å·ï¼ä¾å¦ tomcat ãnginx ãmysql ç­ãè¿äºä¸å±äºä¸å¡åºç¨ï¼ä½æ¯å®ä»¬çæ¥å¿æ°æ®å¯¹äºå®ä½é®é¢ãåæç»è®¡åæ ·å¾éè¦ãè¿æ¶æ æ³ä½¿ç¨ logback æ¹å¼å°å®ä»¬çæ¥å¿ä¼ è¾å° logstashã\n> \n> å¦ä½ééè¿äºæ¥å¿æä»¶å¢ï¼å«æ¥ï¼ä½ å¯ä»¥ä½¿ç¨ logstash ç file input æä»¶ã\n> \n> éè¦æ³¨æçæ¯ï¼ä¼ è¾æä»¶è¿ç§æ¹å¼ï¼å¿é¡»å¨æ¥å¿æå¨çæºå¨ä¸é¨ç½² logstash ã\n\nåºç¨\n\nlogstash éç½®\n\nï¼1ï¼åå»º logstash-input-file.conf ï¼\n\ninput {\n file {\n  path => ["/var/log/nginx/access.log"]\n  type => "nginx-access-log"\n  start_position => "beginning"\n }\n}\n\noutput {\n if [type] == "nginx-access-log" {\n  elasticsearch {\n   hosts => ["localhost:9200"]\n   index => "nginx-access-log"\n  }\n }\n}\n\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-file.conf\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-file.html\n\n\n# å°æå·§\n\n\n# å¯å¨ãç»æ­¢åºç¨\n\nå¦æä½ ç logstash æ¯æ¬¡é½æ¯éè¿æå®éç½®æä»¶æ¹å¼å¯å¨ãä¸å¦¨å»ºç«ä¸ä¸ªå¯å¨èæ¬ã\n\n# cd xxx è¿å¥ logstash å®è£ç®å½ä¸ç bin ç®å½\nlogstash -f logstash.conf\n\n\nå¦æä½ ç logstash è¿è¡å¨ linux ç³»ç»ä¸ï¼ä¸å¦¨ä½¿ç¨ nohup æ¥å¯å¨ä¸ä¸ªå®æ¤è¿ç¨ãè¿æ ·åçå¥½å¤å¨äºï¼å³ä½¿å³é­ç»ç«¯ï¼åºç¨ä»ä¼è¿è¡ã\n\nåå»º startup.sh\n\nnohup ./logstash -f logstash.conf >> nohup.out 2>&1 &\n\n\nç»æ­¢åºç¨æ²¡æä»ä¹å¥½æ¹æ³ï¼ä½ åªè½ä½¿ç¨ ps -ef | grep logstash ï¼æ¥åºè¿ç¨ï¼å°å¶ kill ãä¸è¿ï¼æä»¬å¯ä»¥åä¸ä¸ªèæ¬æ¥å¹²è¿ä»¶äºï¼\n\nåå»º shutdown.sh\n\nèæ¬ä¸å¤è§£éï¼è¯·èªè¡é¢ä¼ä½ç¨ã\n\npid=`ps -ef | grep logstash | awk \'{ print $2}\' | head -n 1`\nkill -9 ${pid}\n\n\n\n# èµæ\n\n * logstash å®æ¹ææ¡£\n * logstash-logback-encoder\n * elk stack æå¨æå\n * elkï¼elasticsearchãlogstashãkibanaï¼å®è£åéç½®\n\n\n# æ¨èéè¯»\n\n * elastic ææ¯æ \n * javastack',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Kibana è¿ç»´",frontmatter:{title:"Kibana è¿ç»´",date:"2020-06-16T07:10:44.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic","Kibana"],permalink:"/pages/fc47af/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/02.Elastic/05.Kibana%E8%BF%90%E7%BB%B4.html",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/02.Elastic/05.Kibanaè¿ç»´.md",key:"v-db66b0d8",path:"/pages/fc47af/",headers:[{level:2,title:"1. å®è£",slug:"_1-å®è£",normalizedTitle:"1. å®è£",charIndex:128},{level:3,title:"1.1. ç¯å¢è¦æ±",slug:"_1-1-ç¯å¢è¦æ±",normalizedTitle:"1.1. ç¯å¢è¦æ±",charIndex:138},{level:3,title:"1.2. å®è£æ­¥éª¤",slug:"_1-2-å®è£æ­¥éª¤",normalizedTitle:"1.2. å®è£æ­¥éª¤",charIndex:176},{level:2,title:"2. ä½¿ç¨",slug:"_2-ä½¿ç¨",normalizedTitle:"2. ä½¿ç¨",charIndex:387},{level:3,title:"2.1. æ£ç´¢",slug:"_2-1-æ£ç´¢",normalizedTitle:"2.1. æ£ç´¢",charIndex:397},{level:4,title:"2.1.1. å­æ®µåç§°",slug:"_2-1-1-å­æ®µåç§°",normalizedTitle:"2.1.1. å­æ®µåç§°",charIndex:1062},{level:4,title:"2.1.2. ééç¬¦",slug:"_2-1-2-ééç¬¦",normalizedTitle:"2.1.2. ééç¬¦",charIndex:1498},{level:4,title:"2.1.3. æ­£åè¡¨è¾¾å¼",slug:"_2-1-3-æ­£åè¡¨è¾¾å¼",normalizedTitle:"2.1.3. æ­£åè¡¨è¾¾å¼",charIndex:1842},{level:4,title:"2.1.4. æ¨¡ç³æ¥è¯¢",slug:"_2-1-4-æ¨¡ç³æ¥è¯¢",normalizedTitle:"2.1.4. æ¨¡ç³æ¥è¯¢",charIndex:1957},{level:4,title:"2.1.5. è¿ä¼¼æ£ç´¢",slug:"_2-1-5-è¿ä¼¼æ£ç´¢",normalizedTitle:"2.1.5. è¿ä¼¼æ£ç´¢",charIndex:2233},{level:4,title:"2.1.6. èå´",slug:"_2-1-6-èå´",normalizedTitle:"2.1.6. èå´",charIndex:2483},{level:4,title:"2.1.7. Boosting",slug:"_2-1-7-boosting",normalizedTitle:"2.1.7. boosting",charIndex:2982},{level:4,title:"2.1.8. å¸å°æä½",slug:"_2-1-8-å¸å°æä½",normalizedTitle:"2.1.8. å¸å°æä½",charIndex:3159},{level:4,title:"2.1.9. åç»",slug:"_2-1-9-åç»",normalizedTitle:"2.1.9. åç»",charIndex:3583},{level:4,title:"2.1.10. ä¿çå­",slug:"_2-1-10-ä¿çå­",normalizedTitle:"2.1.10. ä¿çå­",charIndex:3732},{level:4,title:"2.1.11. ç©ºæ¥è¯¢",slug:"_2-1-11-ç©ºæ¥è¯¢",normalizedTitle:"2.1.11. ç©ºæ¥è¯¢",charIndex:3928},{level:3,title:"2.2. å¯è§å",slug:"_2-2-å¯è§å",normalizedTitle:"2.2. å¯è§å",charIndex:3976},{level:4,title:"2.2.1. Pie",slug:"_2-2-1-pie",normalizedTitle:"2.2.1. pie",charIndex:4159},{level:4,title:"2.2.2. Vertical Bar",slug:"_2-2-2-vertical-bar",normalizedTitle:"2.2.2. vertical bar",charIndex:4536},{level:3,title:"2.3. æ¥è¡¨",slug:"_2-3-æ¥è¡¨",normalizedTitle:"2.3. æ¥è¡¨",charIndex:4784},{level:2,title:"3. FAQ",slug:"_3-faq",normalizedTitle:"3. faq",charIndex:4971},{level:3,title:"3.1. Kibana No Default Index Pattern Warning",slug:"_3-1-kibana-no-default-index-pattern-warning",normalizedTitle:"3.1. kibana no default index pattern warning",charIndex:4982},{level:2,title:"4. åèèµæ",slug:"_4-åèèµæ",normalizedTitle:"4. åèèµæ",charIndex:5318}],headersStr:"1. å®è£ 1.1. ç¯å¢è¦æ± 1.2. å®è£æ­¥éª¤ 2. ä½¿ç¨ 2.1. æ£ç´¢ 2.1.1. å­æ®µåç§° 2.1.2. ééç¬¦ 2.1.3. æ­£åè¡¨è¾¾å¼ 2.1.4. æ¨¡ç³æ¥è¯¢ 2.1.5. è¿ä¼¼æ£ç´¢ 2.1.6. èå´ 2.1.7. Boosting 2.1.8. å¸å°æä½ 2.1.9. åç» 2.1.10. ä¿çå­ 2.1.11. ç©ºæ¥è¯¢ 2.2. å¯è§å 2.2.1. Pie 2.2.2. Vertical Bar 2.3. æ¥è¡¨ 3. FAQ 3.1. Kibana No Default Index Pattern Warning 4. åèèµæ",content:'# Kibana è¿ç»´\n\n> éè¿ Kibanaï¼æ¨å¯ä»¥å¯¹èªå·±ç Elasticsearch è¿è¡å¯è§åï¼è¿å¯ä»¥å¨ Elastic Stack ä¸­è¿è¡å¯¼èªï¼è¿æ ·æ¨ä¾¿å¯ä»¥è¿è¡åç§æä½äºï¼ä»è·è¸ªæ¥è¯¢è´è½½ï¼å°çè§£è¯·æ±å¦ä½æµç»æ¨çæ´ä¸ªåºç¨ï¼é½è½è½»æ¾å®æã\n\n\n# 1. å®è£\n\n\n# 1.1. ç¯å¢è¦æ±\n\n> çæ¬ï¼Elastic Stack 7.4\n\n\n# 1.2. å®è£æ­¥éª¤\n\nå®è£æ­¥éª¤å¦ä¸ï¼\n\n 1. å¨ kibana å®æ¹ä¸è½½å°åä¸è½½æéçæ¬åå¹¶è§£åå°æ¬å°ã\n 2. ä¿®æ¹ config/kibana.yml éç½®æä»¶ï¼è®¾ç½® elasticsearch.url æå Elasticsearch å®ä¾ã\n 3. è¿è¡ bin/kibana ï¼Windows ä¸è¿è¡ bin\\kibana.batï¼\n 4. å¨æµè§å¨ä¸è®¿é® http://localhost:5601\n\n\n# 2. ä½¿ç¨\n\n\n# 2.1. æ£ç´¢\n\nåå»ä¾§é¢å¯¼èªæ ä¸­ç æ£ç´¢ï¼Discoverï¼ ï¼å¯ä»¥æ¾ç¤º Kibana çæ°æ®æ¥è¯¢åè½åè½ã\n\n\n\nå¨æç´¢æ ä¸­ï¼æ¨å¯ä»¥è¾å¥ Elasticsearch æ¥è¯¢æ¡ä»¶æ¥æç´¢æ¨çæ°æ®ãæ¨å¯ä»¥å¨ Discover é¡µé¢ä¸­æµè§ç»æå¹¶å¨ Visualize é¡µé¢ä¸­åå»ºå·²ä¿å­æç´¢æ¡ä»¶çå¯è§åã\n\nå½åç´¢å¼æ¨¡å¼æ¾ç¤ºå¨æ¥è¯¢æ ä¸æ¹ãç´¢å¼æ¨¡å¼ç¡®å®æäº¤æ¥è¯¢æ¶æç´¢åªäºç´¢å¼ãè¦æç´¢ä¸ç»ä¸åçç´¢å¼ï¼è¯·ä»ä¸æèåä¸­éæ©ä¸åçæ¨¡å¼ãè¦æ·»å ç´¢å¼æ¨¡å¼ï¼index patternï¼ï¼è¯·è½¬è³ Management/Kibana/Index Patterns å¹¶åå» Add Newã\n\næ¨å¯ä»¥ä½¿ç¨å­æ®µåç§°åæ¨æå´è¶£çå¼æå»ºæç´¢ãå¯¹äºæ°å­å­æ®µï¼å¯ä»¥ä½¿ç¨æ¯è¾è¿ç®ç¬¦ï¼å¦å¤§äºï¼>ï¼ï¼å°äºï¼<ï¼æç­äºï¼=ï¼ãæ¨å¯ä»¥å°åç´ ä¸é»è¾è¿ç®ç¬¦ ANDï¼OR å NOT é¾æ¥ï¼å¨é¨ä½¿ç¨å¤§åã\n\né»è®¤æåµä¸ï¼æ¯ä¸ªå¹éææ¡£é½æ¾ç¤ºææå­æ®µãè¦éæ©è¦æ¾ç¤ºçææ¡£å­æ®µï¼è¯·å°é¼ æ æ¬åå¨âå¯ç¨å­æ®µâåè¡¨ä¸ï¼ç¶ååå»è¦åå«çæ¯ä¸ªå­æ®µæè¾¹çæ·»å æé®ãä¾å¦ï¼å¦æåªæ·»å  account_numberï¼åæ¾ç¤ºå°æ´æ¹ä¸ºåå«äºä¸ªå¸å·çç®ååè¡¨ï¼\n\n\n\nkibana çæç´¢æ éµå¾ª query-string-syntax ææ¡£ä¸­æè¯´æçæ¥è¯¢è¯­ä¹ã\n\nè¿éè¯´æä¸äºæåºæ¬çæ¥è¯¢è¯­ä¹ã\n\næ¥è¯¢å­ç¬¦ä¸²ä¼è¢«è§£æä¸ºä¸ç³»åçæ¯è¯­åè¿ç®ç¬¦ãä¸ä¸ªæ¯è¯­å¯ä»¥æ¯ä¸ä¸ªåè¯ï¼å¦ï¼quickãbrownï¼æç¨åå¼å·åå´çç­è¯­ï¼å¦"quick brown"ï¼ã\n\næ¥è¯¢æä½åè®¸æ¨èªå®ä¹æç´¢ - ä¸é¢ä»ç»äºå¯ç¨çéé¡¹ã\n\n# 2.1.1. å­æ®µåç§°\n\næ­£å¦æ¥è¯¢å­ç¬¦ä¸²æ¥è¯¢ä¸­æè¿°ï¼å°å¨æç´¢æ¡ä»¶ä¸­æç´¢ default_fieldï¼ä½å¯ä»¥å¨æ¥è¯¢è¯­æ³ä¸­æå®å¶ä»å­æ®µï¼\n\nä¾å¦ï¼\n\n * æ¥è¯¢ status å­æ®µä¸­åå« active å³é®å­\n\nstatus:active\n\n\n * title å­æ®µåå« quick æ brown å³é®å­ãå¦ææ¨çç¥ OR è¿ç®ç¬¦ï¼åå°ä½¿ç¨é»è®¤è¿ç®ç¬¦\n\ntitle:(quick OR brown)\ntitle:(quick brown)\n\n\n * author å­æ®µæ¥æ¾ç²¾ç¡®çç­è¯­ "john smith"ï¼å³ç²¾ç¡®æ¥æ¾ã\n\nauthor:"John Smith"\n\n\n * ä»»æå­æ®µ book.titleï¼book.content æ book.date é½åå« quick æ brownï¼æ³¨ææä»¬éè¦å¦ä½ä½¿ç¨ \\* è¡¨ç¤ºééç¬¦ï¼\n\nbook.\\*:(quick brown)\n\n\n * title å­æ®µåå«ä»»æé null å¼\n\n_exists_:title\n\n\n# 2.1.2. ééç¬¦\n\nELK æä¾äº ? å * ä¸¤ä¸ªééç¬¦ã\n\n * ? è¡¨ç¤ºä»»æåä¸ªå­ç¬¦ï¼\n * * è¡¨ç¤ºä»»æé¶ä¸ªæå¤ä¸ªå­ç¬¦ã\n\nqu?ck bro*\n\n\n> æ³¨æï¼ééç¬¦æ¥è¯¢ä¼ä½¿ç¨å¤§éçåå­å¹¶ä¸æ§è¡æ§è½è¾ä¸ºç³ç³ï¼æä»¥è¯·æç¨ã > æç¤ºï¼çº¯ééç¬¦ * è¢«åå¥ exsits æ¥è¯¢ï¼ä»èæé«äºæ¥è¯¢æçãå æ­¤ï¼ééç¬¦ fieldï¼* å°å¹éåå«ç©ºå¼çææ¡£ï¼å¦ï¼{âfieldâï¼ââ}ï¼ä½æ¯å¦æå­æ®µä¸¢å¤±ææ¾ç¤ºå°å¼ç½®ä¸º null åä¸å¹éï¼å¦ï¼âfieldâï¼null} > æç¤ºï¼å¨ä¸ä¸ªåè¯çå¼å¤´ï¼ä¾å¦ï¼*ingï¼ä½¿ç¨ééç¬¦è¿ç§æ¹å¼çæ¥è¯¢éç¹å«å¤§ï¼å ä¸ºç´¢å¼ä¸­çæææ¯è¯­é½éè¦æ£æ¥ï¼ä»¥é²ä¸ä¸å¹éãéè¿å° allow_leading_wildcard è®¾ç½®ä¸º falseï¼å¯ä»¥ç¦ç¨ã\n\n# 2.1.3. æ­£åè¡¨è¾¾å¼\n\nå¯ä»¥éè¿ / å°æ­£åè¡¨è¾¾å¼åè£¹å¨æ¥è¯¢å­ç¬¦ä¸²ä¸­è¿è¡æ¥è¯¢\n\nä¾ï¼\n\nname:/joh?n(ath[oa]n)/\n\n\næ¯æçæ­£åè¡¨è¾¾å¼è¯­ä¹å¯ä»¥åèï¼Regular expression syntax\n\n# 2.1.4. æ¨¡ç³æ¥è¯¢\n\næä»¬å¯ä»¥ä½¿ç¨ ~ è¿ç®ç¬¦æ¥è¿è¡æ¨¡ç³æ¥è¯¢ã\n\nä¾ï¼\n\nåè®¾æä»¬å®éæ³æ¥è¯¢\n\nquick brown forks\n\n\nä½æ¯ï¼ç±äºæ¼åéè¯¯ï¼æä»¬çæ¥è¯¢å³é®å­åæå¦ä¸æåµï¼ä¾ç¶å¯ä»¥æ¥å°æ³è¦çç»æã\n\nquikc\\~ brwn\\~ foks\\~\n\n\nè¿ç§æ¨¡ç³æ¥è¯¢ä½¿ç¨ Damerau-Levenshtein è·ç¦»æ¥æ¥æ¾ææå¹éæå¤ä¸¤ä¸ªæ´æ¹çé¡¹ãæè°çæ´æ¹æ¯æåä¸ªå­ç¬¦çæå¥ï¼å é¤ææ¿æ¢ï¼æèä¸¤ä¸ªç¸é»å­ç¬¦çæ¢ä½ã\n\né»è®¤ç¼è¾è·ç¦»ä¸º 2ï¼ä½ç¼è¾è·ç¦»ä¸º 1 åºè¶³ä»¥ææææäººç±»æ¼åéè¯¯ç 80ï¼ãå®å¯ä»¥è¢«æå®ä¸ºï¼\n\nquikc\\~1\n\n\n# 2.1.5. è¿ä¼¼æ£ç´¢\n\nå°½ç®¡ç­è¯­æ¥è¯¢ï¼ä¾å¦ï¼john smithï¼ææææçè¯æ¡é½æ¯å®å¨ç¸åçé¡ºåºï¼ä½æ¯è¿ä¼¼æ¥è¯¢åè®¸æå®çåè¯è¿ä¸æ­¥åå¼æä»¥ä¸åçé¡ºåºæåãä¸æ¨¡ç³æ¥è¯¢å¯ä»¥ä¸ºåè¯ä¸­çå­ç¬¦æå®æå¤§ç¼è¾è·ç¦»ä¸æ ·ï¼è¿ä¼¼æç´¢ä¹åè®¸æä»¬æå®ç­è¯­ä¸­åè¯çæå¤§ç¼è¾è·ç¦»ï¼\n\nä¾\n\n"fox quick"\\~5\n\n\nå­æ®µä¸­çææ¬è¶æ¥è¿æ¥è¯¢å­ç¬¦ä¸²ä¸­æå®çåå§é¡ºåºï¼è¯¥ææ¡£å°±è¶è¢«è®¤ä¸ºæ¯ç¸å³çãå½ä¸ä¸é¢çç¤ºä¾æ¥è¯¢ç¸æ¯æ¶ï¼ç­è¯­ "quick fox" å°è¢«è®¤ä¸ºæ¯ "quick brown fox" æ´è¿ä¼¼æ¥è¯¢æ¡ä»¶ã\n\n# 2.1.6. èå´\n\nå¯ä»¥ä¸ºæ¥æï¼æ°å­æå­ç¬¦ä¸²å­æ®µæå®èå´ãé­åºé´èå´ç¨æ¹æ¬å· [min TO max] åå¼åºé´èå´ç¨è±æ¬å· {min TO max} æ¥æå®ã\n\næä»¬ä¸å¦¨æ¥çä¸äºç¤ºä¾ã\n\n * 2012 å¹´çæææ¥å­\n\ndate:[2012-01-01 TO 2012-12-31]\n\n\n * æ°å­ 1 å° 5\n\ncount:[1 TO 5]\n\n\n * å¨ alpha å omega ä¹é´çæ ç­¾ï¼ä¸åæ¬ alpha å omega\n\ntag:{alpha TO omega}\n\n\n * 10 ä»¥ä¸çæ°å­\n\ncount:[10 TO *]\n\n\n * 2012 å¹´ä»¥åçæææ¥æ\n\ndate:{* TO 2012-01-01}\n\n\næ­¤å¤ï¼å¼åºé´åé­åºé´ä¹å¯ä»¥ç»åä½¿ç¨\n\n * æ°ç» 1 å° 5ï¼ä½ä¸åæ¬ 5\n\ncount:[1 TO 5}\n\n\nä¸è¾¹æ ççèå´ä¹å¯ä»¥ä½¿ç¨ä»¥ä¸è¯­æ³ï¼\n\nage:>10\nage:>=10\nage:<10\nage:<=10\n\n\nå½ç¶ï¼ä½ ä¹å¯ä»¥ä½¿ç¨ AND è¿ç®ç¬¦æ¥å¾å°è¿ä¸ªæ¥è¯¢ç»æçäº¤é\n\nage:(>=10 AND <20)\nage:(+>=10 +<20)\n\n\n# 2.1.7. Boosting\n\nä½¿ç¨æä½ç¬¦ ^ ä½¿ä¸ä¸ªæ¯è¯­æ¯å¦ä¸ä¸ªæ¯è¯­æ´ç¸å³ãä¾å¦ï¼å¦ææä»¬æ³æ¥æ¾æææå³çç¸çææ¡£ï¼ä½æä»¬å¯¹çç¸ç¹å«æå´è¶£ï¼\n\nquick^2 fox\n\n\né»è®¤æåå¼æ¯ 1ï¼ä½å¯ä»¥æ¯ä»»ä½æ­£æµ®ç¹æ°ã 0 å° 1 ä¹é´çæååå°äºç¸å³æ§ã\n\nå¢å¼ºä¹å¯ä»¥åºç¨äºç­è¯­æç»ï¼\n\n"john smith"^2   (foo bar)^4\n\n\n# 2.1.8. å¸å°æä½\n\né»è®¤æåµä¸ï¼åªè¦ä¸ä¸ªè¯å¹éï¼ææè¯é½æ¯å¯éçãæç´¢ foo bar baz å°æ¥æ¾åå« foo æ bar æ baz ä¸­çä¸ä¸ªæå¤ä¸ªçä»»ä½ææ¡£ãæä»¬å·²ç»è®¨è®ºäºä¸é¢çdefault_operatorï¼å®åè®¸ä½ å¼ºå¶è¦æ±ææçé¡¹ï¼ä½ä¹æå¸å°è¿ç®ç¬¦å¯ä»¥å¨æ¥è¯¢å­ç¬¦ä¸²æ¬èº«ä¸­ä½¿ç¨ï¼ä»¥æä¾æ´å¤çæ§å¶ã\n\né¦éçæä½ç¬¦æ¯ +ï¼æ­¤æ¯è¯­å¿é¡»å­å¨ï¼å - ï¼æ­¤æ¯è¯­ä¸å¾å­å¨ï¼ãææå¶ä»æ¡æ¬¾æ¯å¯éçãä¾å¦ï¼è¿ä¸ªæ¥è¯¢ï¼\n\nquick brown +fox -news\n\n\nè¿æ¡æ¥è¯¢æå³çï¼\n\n * fox å¿é¡»å­å¨\n * news å¿é¡»ä¸å­å¨\n * quick å brown æ¯å¯æå¯æ ç\n\nçæçè¿ç®ç¬¦ ANDï¼OR å NOTï¼ä¹åæ &&ï¼|| å !ï¼ä¹è¢«æ¯æãç¶èï¼è¿äºæä½ç¬¦æä¸å®çä¼åçº§ï¼NOT ä¼åäº ANDï¼AND ä¼åäº ORãè½ç¶ + å - ä»å½±åè¿ç®ç¬¦å³ä¾§çæ¯è¯­ï¼ä½ AND å OR ä¼å½±åå·¦ä¾§åå³ä¾§çæ¯è¯­ã\n\n# 2.1.9. åç»\n\nå¤ä¸ªæ¯è¯­æå­å¥å¯ä»¥ç¨åæ¬å·ç»åå¨ä¸èµ·ï¼å½¢æå­æ¥è¯¢\n\n(quick OR brown) AND fox\n\n\nå¯ä»¥ä½¿ç¨ç»æ¥å®ä½ç¹å®çå­æ®µï¼æèå¢å¼ºå­æ¥è¯¢çç»æï¼\n\nstatus:(active OR pending) title:(full text search)^2\n\n\n# 2.1.10. ä¿çå­\n\nå¦æä½ éè¦ä½¿ç¨ä»»ä½å¨ä½ çæ¥è¯¢æ¬èº«ä¸­ä½ä¸ºæä½ç¬¦çå­ç¬¦ï¼èä¸æ¯ä½ä¸ºæä½ç¬¦ï¼ï¼é£ä¹ä½ åºè¯¥ç¨ä¸ä¸ªåææ æ¥è½¬ä¹å®ä»¬ãä¾å¦ï¼è¦æç´¢ï¼1 + 1ï¼= 2ï¼æ¨éè¦å°æ¥è¯¢åä¸º \\(1\\+1\\)\\=2\n\nä¿çå­ç¬¦æ¯ï¼+ - = && || > < ! ( ) { } [ ] ^ " ~ * ? : \\ /\n\næ æ³æ­£ç¡®å°è½¬ä¹è¿äºç¹æ®å­ç¬¦å¯è½ä¼å¯¼è´è¯­æ³éè¯¯ï¼ä»èé»æ­¢æ¨çæ¥è¯¢è¿è¡ã\n\n# 2.1.11. ç©ºæ¥è¯¢\n\nå¦ææ¥è¯¢å­ç¬¦ä¸²ä¸ºç©ºæä»åå«ç©ºæ ¼ï¼åæ¥è¯¢å°çæä¸ä¸ªç©ºçç»æéã\n\n\n# 2.2. å¯è§å\n\nè¦æ³ä½¿ç¨å¯è§åçæ¹å¼å±ç¤ºæ¨çæ°æ®ï¼è¯·åå»ä¾§é¢å¯¼èªæ ä¸­ç å¯è§åï¼Visualizeï¼ã\n\nVisualize å·¥å·ä½¿æ¨è½å¤ä»¥å¤ç§æ¹å¼ï¼å¦é¥¼å¾ãæ±ç¶å¾ãæ²çº¿å¾ãåå¸å¾ç­ï¼æ¥çæ°æ®ãè¦å¼å§ä½¿ç¨ï¼è¯·ç¹å»èè²ç Create a visualization æ + æé®ã\n\n\n\næè®¸å¤å¯è§åç±»åå¯ä¾éæ©ã\n\n\n\nä¸é¢ï¼æä»¬æ¥çåå»ºå ä¸ªå¾æ ç¤ºä¾ï¼\n\n# 2.2.1. Pie\n\næ¨å¯ä»¥ä»ä¿å­çæç´¢ä¸­æå»ºå¯è§åæä»¶ï¼ä¹å¯ä»¥è¾å¥æ°çæç´¢æ¡ä»¶ãè¦è¾å¥æ°çæç´¢æ¡ä»¶ï¼é¦åéè¦éæ©ä¸ä¸ªç´¢å¼æ¨¡å¼æ¥æå®è¦æç´¢çç´¢å¼ã\n\né»è®¤æç´¢å¹éææææ¡£ãæåï¼ä¸ä¸ªâåçâåå«æ´ä¸ªé¥¼å¾ï¼\n\n\n\nè¦æå®å¨å¾è¡¨ä¸­å±ç¤ºåªäºæ°æ®ï¼è¯·ä½¿ç¨ Elasticsearch å­å¨æ¡¶èåãåç»æ±æ»åªæ¯å°ä¸æ¨çæç´¢æ¡ä»¶ç¸å¹éçææ¡£åç±»å°ä¸åçåç±»ä¸­ï¼ä¹ç§°ä¸ºåç»ã\n\nä¸ºæ¯ä¸ªèå´å®ä¹ä¸ä¸ªå­å¨æ¡¶ï¼\n\n 1. åå» Split Slicesã\n 2. å¨ Aggregation åè¡¨ä¸­éæ© Termsãæ³¨æï¼è¿éç Terms æ¯ Elk ééæ°æ®æ¶å®ä¹å¥½çå­æ®µææ ç­¾ã\n 3. å¨ Field åè¡¨ä¸­éæ© level.keywordã\n 4. ç¹å» æé®æ¥æ´æ°å¾è¡¨ã\n\n\n\nå®æåï¼å¦ææ³è¦ä¿å­è¿ä¸ªå¾è¡¨ï¼å¯ä»¥ç¹å»é¡µé¢æä¸æ¹ä¸æ ä¸­ç Save æé®ã\n\n# 2.2.2. Vertical Bar\n\næä»¬å¨å±ç¤ºä¸ä¸å¦ä½åå»ºæ±ç¶å¾ã\n\n 1. ç¹å»èè²ç Create a visualization æ + æé®ãéæ© Vertical Bar\n 2. éæ©ç´¢å¼æ¨¡å¼ãç±äºæ¨å°æªå®ä¹ä»»ä½ bucket ï¼å æ­¤æ¨ä¼çå°ä¸ä¸ªå¤§æ ï¼æ¾ç¤ºä¸é»è®¤ééç¬¦æ¥è¯¢å¹éçææ¡£æ»æ°ã\n 3. æå® Y è½´æä»£è¡¨çå­æ®µ\n 4. æå® X è½´æä»£è¡¨çå­æ®µ\n 5. ç¹å» æé®æ¥æ´æ°å¾è¡¨ã\n\n\n\nå®æåï¼å¦ææ³è¦ä¿å­è¿ä¸ªå¾è¡¨ï¼å¯ä»¥ç¹å»é¡µé¢æä¸æ¹ä¸æ ä¸­ç Save æé®ã\n\n\n# 2.3. æ¥è¡¨\n\næ¥è¡¨ï¼Dashboardï¼ å¯ä»¥æ´ååå±äº« Visualize éåã\n\n 1. ç¹å»ä¾§é¢å¯¼èªæ ä¸­ç Dashboardã\n 2. ç¹å»æ·»å æ¾ç¤ºä¿å­çå¯è§ååè¡¨ã\n 3. ç¹å»ä¹åä¿å­ç Visualizeï¼ç¶åç¹å»åè¡¨åºé¨çå°åä¸ç®­å¤´å³é­å¯è§ååè¡¨ã\n 4. å°é¼ æ æ¬åå¨å¯è§åå¯¹è±¡ä¸ä¼æ¾ç¤ºåè®¸æ¨ç¼è¾ï¼ç§»å¨ï¼å é¤åè°æ´å¯è§åå¯¹è±¡å¤§å°çå®¹å¨æ§ä»¶ã\n\n\n# 3. FAQ\n\n\n# 3.1. Kibana No Default Index Pattern Warning\n\n**é®é¢ï¼**å®è£ ELK åï¼è®¿é® kibana é¡µé¢æ¶ï¼æç¤ºä»¥ä¸éè¯¯ä¿¡æ¯ï¼\n\nWarning No default index pattern. You must select or create one to continue.\n...\nUnable to fetch mapping. Do you have indices matching the pattern?\n\n\nè¿å°±è¯´æ logstash æ²¡æææ¥å¿åå¥å° elasticsearchã\n\nè§£å³æ¹æ³ï¼\n\næ£æ¥ logstash ä¸ elasticsearch ä¹é´çéè®¯æ¯å¦æé®é¢ï¼ä¸è¬é®é¢å°±åºå¨è¿ã\n\n\n# 4. åèèµæ\n\n * Kibana å®ç½\n * Kibana Github\n * Kibana å®æ¹ææ¡£',normalizedContent:'# kibana è¿ç»´\n\n> éè¿ kibanaï¼æ¨å¯ä»¥å¯¹èªå·±ç elasticsearch è¿è¡å¯è§åï¼è¿å¯ä»¥å¨ elastic stack ä¸­è¿è¡å¯¼èªï¼è¿æ ·æ¨ä¾¿å¯ä»¥è¿è¡åç§æä½äºï¼ä»è·è¸ªæ¥è¯¢è´è½½ï¼å°çè§£è¯·æ±å¦ä½æµç»æ¨çæ´ä¸ªåºç¨ï¼é½è½è½»æ¾å®æã\n\n\n# 1. å®è£\n\n\n# 1.1. ç¯å¢è¦æ±\n\n> çæ¬ï¼elastic stack 7.4\n\n\n# 1.2. å®è£æ­¥éª¤\n\nå®è£æ­¥éª¤å¦ä¸ï¼\n\n 1. å¨ kibana å®æ¹ä¸è½½å°åä¸è½½æéçæ¬åå¹¶è§£åå°æ¬å°ã\n 2. ä¿®æ¹ config/kibana.yml éç½®æä»¶ï¼è®¾ç½® elasticsearch.url æå elasticsearch å®ä¾ã\n 3. è¿è¡ bin/kibana ï¼windows ä¸è¿è¡ bin\\kibana.batï¼\n 4. å¨æµè§å¨ä¸è®¿é® http://localhost:5601\n\n\n# 2. ä½¿ç¨\n\n\n# 2.1. æ£ç´¢\n\nåå»ä¾§é¢å¯¼èªæ ä¸­ç æ£ç´¢ï¼discoverï¼ ï¼å¯ä»¥æ¾ç¤º kibana çæ°æ®æ¥è¯¢åè½åè½ã\n\n\n\nå¨æç´¢æ ä¸­ï¼æ¨å¯ä»¥è¾å¥ elasticsearch æ¥è¯¢æ¡ä»¶æ¥æç´¢æ¨çæ°æ®ãæ¨å¯ä»¥å¨ discover é¡µé¢ä¸­æµè§ç»æå¹¶å¨ visualize é¡µé¢ä¸­åå»ºå·²ä¿å­æç´¢æ¡ä»¶çå¯è§åã\n\nå½åç´¢å¼æ¨¡å¼æ¾ç¤ºå¨æ¥è¯¢æ ä¸æ¹ãç´¢å¼æ¨¡å¼ç¡®å®æäº¤æ¥è¯¢æ¶æç´¢åªäºç´¢å¼ãè¦æç´¢ä¸ç»ä¸åçç´¢å¼ï¼è¯·ä»ä¸æèåä¸­éæ©ä¸åçæ¨¡å¼ãè¦æ·»å ç´¢å¼æ¨¡å¼ï¼index patternï¼ï¼è¯·è½¬è³ management/kibana/index patterns å¹¶åå» add newã\n\næ¨å¯ä»¥ä½¿ç¨å­æ®µåç§°åæ¨æå´è¶£çå¼æå»ºæç´¢ãå¯¹äºæ°å­å­æ®µï¼å¯ä»¥ä½¿ç¨æ¯è¾è¿ç®ç¬¦ï¼å¦å¤§äºï¼>ï¼ï¼å°äºï¼<ï¼æç­äºï¼=ï¼ãæ¨å¯ä»¥å°åç´ ä¸é»è¾è¿ç®ç¬¦ andï¼or å not é¾æ¥ï¼å¨é¨ä½¿ç¨å¤§åã\n\né»è®¤æåµä¸ï¼æ¯ä¸ªå¹éææ¡£é½æ¾ç¤ºææå­æ®µãè¦éæ©è¦æ¾ç¤ºçææ¡£å­æ®µï¼è¯·å°é¼ æ æ¬åå¨âå¯ç¨å­æ®µâåè¡¨ä¸ï¼ç¶ååå»è¦åå«çæ¯ä¸ªå­æ®µæè¾¹çæ·»å æé®ãä¾å¦ï¼å¦æåªæ·»å  account_numberï¼åæ¾ç¤ºå°æ´æ¹ä¸ºåå«äºä¸ªå¸å·çç®ååè¡¨ï¼\n\n\n\nkibana çæç´¢æ éµå¾ª query-string-syntax ææ¡£ä¸­æè¯´æçæ¥è¯¢è¯­ä¹ã\n\nè¿éè¯´æä¸äºæåºæ¬çæ¥è¯¢è¯­ä¹ã\n\næ¥è¯¢å­ç¬¦ä¸²ä¼è¢«è§£æä¸ºä¸ç³»åçæ¯è¯­åè¿ç®ç¬¦ãä¸ä¸ªæ¯è¯­å¯ä»¥æ¯ä¸ä¸ªåè¯ï¼å¦ï¼quickãbrownï¼æç¨åå¼å·åå´çç­è¯­ï¼å¦"quick brown"ï¼ã\n\næ¥è¯¢æä½åè®¸æ¨èªå®ä¹æç´¢ - ä¸é¢ä»ç»äºå¯ç¨çéé¡¹ã\n\n# 2.1.1. å­æ®µåç§°\n\næ­£å¦æ¥è¯¢å­ç¬¦ä¸²æ¥è¯¢ä¸­æè¿°ï¼å°å¨æç´¢æ¡ä»¶ä¸­æç´¢ default_fieldï¼ä½å¯ä»¥å¨æ¥è¯¢è¯­æ³ä¸­æå®å¶ä»å­æ®µï¼\n\nä¾å¦ï¼\n\n * æ¥è¯¢ status å­æ®µä¸­åå« active å³é®å­\n\nstatus:active\n\n\n * title å­æ®µåå« quick æ brown å³é®å­ãå¦ææ¨çç¥ or è¿ç®ç¬¦ï¼åå°ä½¿ç¨é»è®¤è¿ç®ç¬¦\n\ntitle:(quick or brown)\ntitle:(quick brown)\n\n\n * author å­æ®µæ¥æ¾ç²¾ç¡®çç­è¯­ "john smith"ï¼å³ç²¾ç¡®æ¥æ¾ã\n\nauthor:"john smith"\n\n\n * ä»»æå­æ®µ book.titleï¼book.content æ book.date é½åå« quick æ brownï¼æ³¨ææä»¬éè¦å¦ä½ä½¿ç¨ \\* è¡¨ç¤ºééç¬¦ï¼\n\nbook.\\*:(quick brown)\n\n\n * title å­æ®µåå«ä»»æé null å¼\n\n_exists_:title\n\n\n# 2.1.2. ééç¬¦\n\nelk æä¾äº ? å * ä¸¤ä¸ªééç¬¦ã\n\n * ? è¡¨ç¤ºä»»æåä¸ªå­ç¬¦ï¼\n * * è¡¨ç¤ºä»»æé¶ä¸ªæå¤ä¸ªå­ç¬¦ã\n\nqu?ck bro*\n\n\n> æ³¨æï¼ééç¬¦æ¥è¯¢ä¼ä½¿ç¨å¤§éçåå­å¹¶ä¸æ§è¡æ§è½è¾ä¸ºç³ç³ï¼æä»¥è¯·æç¨ã > æç¤ºï¼çº¯ééç¬¦ * è¢«åå¥ exsits æ¥è¯¢ï¼ä»èæé«äºæ¥è¯¢æçãå æ­¤ï¼ééç¬¦ fieldï¼* å°å¹éåå«ç©ºå¼çææ¡£ï¼å¦ï¼{âfieldâï¼ââ}ï¼ä½æ¯å¦æå­æ®µä¸¢å¤±ææ¾ç¤ºå°å¼ç½®ä¸º null åä¸å¹éï¼å¦ï¼âfieldâï¼null} > æç¤ºï¼å¨ä¸ä¸ªåè¯çå¼å¤´ï¼ä¾å¦ï¼*ingï¼ä½¿ç¨ééç¬¦è¿ç§æ¹å¼çæ¥è¯¢éç¹å«å¤§ï¼å ä¸ºç´¢å¼ä¸­çæææ¯è¯­é½éè¦æ£æ¥ï¼ä»¥é²ä¸ä¸å¹éãéè¿å° allow_leading_wildcard è®¾ç½®ä¸º falseï¼å¯ä»¥ç¦ç¨ã\n\n# 2.1.3. æ­£åè¡¨è¾¾å¼\n\nå¯ä»¥éè¿ / å°æ­£åè¡¨è¾¾å¼åè£¹å¨æ¥è¯¢å­ç¬¦ä¸²ä¸­è¿è¡æ¥è¯¢\n\nä¾ï¼\n\nname:/joh?n(ath[oa]n)/\n\n\næ¯æçæ­£åè¡¨è¾¾å¼è¯­ä¹å¯ä»¥åèï¼regular expression syntax\n\n# 2.1.4. æ¨¡ç³æ¥è¯¢\n\næä»¬å¯ä»¥ä½¿ç¨ ~ è¿ç®ç¬¦æ¥è¿è¡æ¨¡ç³æ¥è¯¢ã\n\nä¾ï¼\n\nåè®¾æä»¬å®éæ³æ¥è¯¢\n\nquick brown forks\n\n\nä½æ¯ï¼ç±äºæ¼åéè¯¯ï¼æä»¬çæ¥è¯¢å³é®å­åæå¦ä¸æåµï¼ä¾ç¶å¯ä»¥æ¥å°æ³è¦çç»æã\n\nquikc\\~ brwn\\~ foks\\~\n\n\nè¿ç§æ¨¡ç³æ¥è¯¢ä½¿ç¨ damerau-levenshtein è·ç¦»æ¥æ¥æ¾ææå¹éæå¤ä¸¤ä¸ªæ´æ¹çé¡¹ãæè°çæ´æ¹æ¯æåä¸ªå­ç¬¦çæå¥ï¼å é¤ææ¿æ¢ï¼æèä¸¤ä¸ªç¸é»å­ç¬¦çæ¢ä½ã\n\né»è®¤ç¼è¾è·ç¦»ä¸º 2ï¼ä½ç¼è¾è·ç¦»ä¸º 1 åºè¶³ä»¥ææææäººç±»æ¼åéè¯¯ç 80ï¼ãå®å¯ä»¥è¢«æå®ä¸ºï¼\n\nquikc\\~1\n\n\n# 2.1.5. è¿ä¼¼æ£ç´¢\n\nå°½ç®¡ç­è¯­æ¥è¯¢ï¼ä¾å¦ï¼john smithï¼ææææçè¯æ¡é½æ¯å®å¨ç¸åçé¡ºåºï¼ä½æ¯è¿ä¼¼æ¥è¯¢åè®¸æå®çåè¯è¿ä¸æ­¥åå¼æä»¥ä¸åçé¡ºåºæåãä¸æ¨¡ç³æ¥è¯¢å¯ä»¥ä¸ºåè¯ä¸­çå­ç¬¦æå®æå¤§ç¼è¾è·ç¦»ä¸æ ·ï¼è¿ä¼¼æç´¢ä¹åè®¸æä»¬æå®ç­è¯­ä¸­åè¯çæå¤§ç¼è¾è·ç¦»ï¼\n\nä¾\n\n"fox quick"\\~5\n\n\nå­æ®µä¸­çææ¬è¶æ¥è¿æ¥è¯¢å­ç¬¦ä¸²ä¸­æå®çåå§é¡ºåºï¼è¯¥ææ¡£å°±è¶è¢«è®¤ä¸ºæ¯ç¸å³çãå½ä¸ä¸é¢çç¤ºä¾æ¥è¯¢ç¸æ¯æ¶ï¼ç­è¯­ "quick fox" å°è¢«è®¤ä¸ºæ¯ "quick brown fox" æ´è¿ä¼¼æ¥è¯¢æ¡ä»¶ã\n\n# 2.1.6. èå´\n\nå¯ä»¥ä¸ºæ¥æï¼æ°å­æå­ç¬¦ä¸²å­æ®µæå®èå´ãé­åºé´èå´ç¨æ¹æ¬å· [min to max] åå¼åºé´èå´ç¨è±æ¬å· {min to max} æ¥æå®ã\n\næä»¬ä¸å¦¨æ¥çä¸äºç¤ºä¾ã\n\n * 2012 å¹´çæææ¥å­\n\ndate:[2012-01-01 to 2012-12-31]\n\n\n * æ°å­ 1 å° 5\n\ncount:[1 to 5]\n\n\n * å¨ alpha å omega ä¹é´çæ ç­¾ï¼ä¸åæ¬ alpha å omega\n\ntag:{alpha to omega}\n\n\n * 10 ä»¥ä¸çæ°å­\n\ncount:[10 to *]\n\n\n * 2012 å¹´ä»¥åçæææ¥æ\n\ndate:{* to 2012-01-01}\n\n\næ­¤å¤ï¼å¼åºé´åé­åºé´ä¹å¯ä»¥ç»åä½¿ç¨\n\n * æ°ç» 1 å° 5ï¼ä½ä¸åæ¬ 5\n\ncount:[1 to 5}\n\n\nä¸è¾¹æ ççèå´ä¹å¯ä»¥ä½¿ç¨ä»¥ä¸è¯­æ³ï¼\n\nage:>10\nage:>=10\nage:<10\nage:<=10\n\n\nå½ç¶ï¼ä½ ä¹å¯ä»¥ä½¿ç¨ and è¿ç®ç¬¦æ¥å¾å°è¿ä¸ªæ¥è¯¢ç»æçäº¤é\n\nage:(>=10 and <20)\nage:(+>=10 +<20)\n\n\n# 2.1.7. boosting\n\nä½¿ç¨æä½ç¬¦ ^ ä½¿ä¸ä¸ªæ¯è¯­æ¯å¦ä¸ä¸ªæ¯è¯­æ´ç¸å³ãä¾å¦ï¼å¦ææä»¬æ³æ¥æ¾æææå³çç¸çææ¡£ï¼ä½æä»¬å¯¹çç¸ç¹å«æå´è¶£ï¼\n\nquick^2 fox\n\n\né»è®¤æåå¼æ¯ 1ï¼ä½å¯ä»¥æ¯ä»»ä½æ­£æµ®ç¹æ°ã 0 å° 1 ä¹é´çæååå°äºç¸å³æ§ã\n\nå¢å¼ºä¹å¯ä»¥åºç¨äºç­è¯­æç»ï¼\n\n"john smith"^2   (foo bar)^4\n\n\n# 2.1.8. å¸å°æä½\n\né»è®¤æåµä¸ï¼åªè¦ä¸ä¸ªè¯å¹éï¼ææè¯é½æ¯å¯éçãæç´¢ foo bar baz å°æ¥æ¾åå« foo æ bar æ baz ä¸­çä¸ä¸ªæå¤ä¸ªçä»»ä½ææ¡£ãæä»¬å·²ç»è®¨è®ºäºä¸é¢çdefault_operatorï¼å®åè®¸ä½ å¼ºå¶è¦æ±ææçé¡¹ï¼ä½ä¹æå¸å°è¿ç®ç¬¦å¯ä»¥å¨æ¥è¯¢å­ç¬¦ä¸²æ¬èº«ä¸­ä½¿ç¨ï¼ä»¥æä¾æ´å¤çæ§å¶ã\n\né¦éçæä½ç¬¦æ¯ +ï¼æ­¤æ¯è¯­å¿é¡»å­å¨ï¼å - ï¼æ­¤æ¯è¯­ä¸å¾å­å¨ï¼ãææå¶ä»æ¡æ¬¾æ¯å¯éçãä¾å¦ï¼è¿ä¸ªæ¥è¯¢ï¼\n\nquick brown +fox -news\n\n\nè¿æ¡æ¥è¯¢æå³çï¼\n\n * fox å¿é¡»å­å¨\n * news å¿é¡»ä¸å­å¨\n * quick å brown æ¯å¯æå¯æ ç\n\nçæçè¿ç®ç¬¦ andï¼or å notï¼ä¹åæ &&ï¼|| å !ï¼ä¹è¢«æ¯æãç¶èï¼è¿äºæä½ç¬¦æä¸å®çä¼åçº§ï¼not ä¼åäº andï¼and ä¼åäº orãè½ç¶ + å - ä»å½±åè¿ç®ç¬¦å³ä¾§çæ¯è¯­ï¼ä½ and å or ä¼å½±åå·¦ä¾§åå³ä¾§çæ¯è¯­ã\n\n# 2.1.9. åç»\n\nå¤ä¸ªæ¯è¯­æå­å¥å¯ä»¥ç¨åæ¬å·ç»åå¨ä¸èµ·ï¼å½¢æå­æ¥è¯¢\n\n(quick or brown) and fox\n\n\nå¯ä»¥ä½¿ç¨ç»æ¥å®ä½ç¹å®çå­æ®µï¼æèå¢å¼ºå­æ¥è¯¢çç»æï¼\n\nstatus:(active or pending) title:(full text search)^2\n\n\n# 2.1.10. ä¿çå­\n\nå¦æä½ éè¦ä½¿ç¨ä»»ä½å¨ä½ çæ¥è¯¢æ¬èº«ä¸­ä½ä¸ºæä½ç¬¦çå­ç¬¦ï¼èä¸æ¯ä½ä¸ºæä½ç¬¦ï¼ï¼é£ä¹ä½ åºè¯¥ç¨ä¸ä¸ªåææ æ¥è½¬ä¹å®ä»¬ãä¾å¦ï¼è¦æç´¢ï¼1 + 1ï¼= 2ï¼æ¨éè¦å°æ¥è¯¢åä¸º \\(1\\+1\\)\\=2\n\nä¿çå­ç¬¦æ¯ï¼+ - = && || > < ! ( ) { } [ ] ^ " ~ * ? : \\ /\n\næ æ³æ­£ç¡®å°è½¬ä¹è¿äºç¹æ®å­ç¬¦å¯è½ä¼å¯¼è´è¯­æ³éè¯¯ï¼ä»èé»æ­¢æ¨çæ¥è¯¢è¿è¡ã\n\n# 2.1.11. ç©ºæ¥è¯¢\n\nå¦ææ¥è¯¢å­ç¬¦ä¸²ä¸ºç©ºæä»åå«ç©ºæ ¼ï¼åæ¥è¯¢å°çæä¸ä¸ªç©ºçç»æéã\n\n\n# 2.2. å¯è§å\n\nè¦æ³ä½¿ç¨å¯è§åçæ¹å¼å±ç¤ºæ¨çæ°æ®ï¼è¯·åå»ä¾§é¢å¯¼èªæ ä¸­ç å¯è§åï¼visualizeï¼ã\n\nvisualize å·¥å·ä½¿æ¨è½å¤ä»¥å¤ç§æ¹å¼ï¼å¦é¥¼å¾ãæ±ç¶å¾ãæ²çº¿å¾ãåå¸å¾ç­ï¼æ¥çæ°æ®ãè¦å¼å§ä½¿ç¨ï¼è¯·ç¹å»èè²ç create a visualization æ + æé®ã\n\n\n\næè®¸å¤å¯è§åç±»åå¯ä¾éæ©ã\n\n\n\nä¸é¢ï¼æä»¬æ¥çåå»ºå ä¸ªå¾æ ç¤ºä¾ï¼\n\n# 2.2.1. pie\n\næ¨å¯ä»¥ä»ä¿å­çæç´¢ä¸­æå»ºå¯è§åæä»¶ï¼ä¹å¯ä»¥è¾å¥æ°çæç´¢æ¡ä»¶ãè¦è¾å¥æ°çæç´¢æ¡ä»¶ï¼é¦åéè¦éæ©ä¸ä¸ªç´¢å¼æ¨¡å¼æ¥æå®è¦æç´¢çç´¢å¼ã\n\né»è®¤æç´¢å¹éææææ¡£ãæåï¼ä¸ä¸ªâåçâåå«æ´ä¸ªé¥¼å¾ï¼\n\n\n\nè¦æå®å¨å¾è¡¨ä¸­å±ç¤ºåªäºæ°æ®ï¼è¯·ä½¿ç¨ elasticsearch å­å¨æ¡¶èåãåç»æ±æ»åªæ¯å°ä¸æ¨çæç´¢æ¡ä»¶ç¸å¹éçææ¡£åç±»å°ä¸åçåç±»ä¸­ï¼ä¹ç§°ä¸ºåç»ã\n\nä¸ºæ¯ä¸ªèå´å®ä¹ä¸ä¸ªå­å¨æ¡¶ï¼\n\n 1. åå» split slicesã\n 2. å¨ aggregation åè¡¨ä¸­éæ© termsãæ³¨æï¼è¿éç terms æ¯ elk ééæ°æ®æ¶å®ä¹å¥½çå­æ®µææ ç­¾ã\n 3. å¨ field åè¡¨ä¸­éæ© level.keywordã\n 4. ç¹å» æé®æ¥æ´æ°å¾è¡¨ã\n\n\n\nå®æåï¼å¦ææ³è¦ä¿å­è¿ä¸ªå¾è¡¨ï¼å¯ä»¥ç¹å»é¡µé¢æä¸æ¹ä¸æ ä¸­ç save æé®ã\n\n# 2.2.2. vertical bar\n\næä»¬å¨å±ç¤ºä¸ä¸å¦ä½åå»ºæ±ç¶å¾ã\n\n 1. ç¹å»èè²ç create a visualization æ + æé®ãéæ© vertical bar\n 2. éæ©ç´¢å¼æ¨¡å¼ãç±äºæ¨å°æªå®ä¹ä»»ä½ bucket ï¼å æ­¤æ¨ä¼çå°ä¸ä¸ªå¤§æ ï¼æ¾ç¤ºä¸é»è®¤ééç¬¦æ¥è¯¢å¹éçææ¡£æ»æ°ã\n 3. æå® y è½´æä»£è¡¨çå­æ®µ\n 4. æå® x è½´æä»£è¡¨çå­æ®µ\n 5. ç¹å» æé®æ¥æ´æ°å¾è¡¨ã\n\n\n\nå®æåï¼å¦ææ³è¦ä¿å­è¿ä¸ªå¾è¡¨ï¼å¯ä»¥ç¹å»é¡µé¢æä¸æ¹ä¸æ ä¸­ç save æé®ã\n\n\n# 2.3. æ¥è¡¨\n\næ¥è¡¨ï¼dashboardï¼ å¯ä»¥æ´ååå±äº« visualize éåã\n\n 1. ç¹å»ä¾§é¢å¯¼èªæ ä¸­ç dashboardã\n 2. ç¹å»æ·»å æ¾ç¤ºä¿å­çå¯è§ååè¡¨ã\n 3. ç¹å»ä¹åä¿å­ç visualizeï¼ç¶åç¹å»åè¡¨åºé¨çå°åä¸ç®­å¤´å³é­å¯è§ååè¡¨ã\n 4. å°é¼ æ æ¬åå¨å¯è§åå¯¹è±¡ä¸ä¼æ¾ç¤ºåè®¸æ¨ç¼è¾ï¼ç§»å¨ï¼å é¤åè°æ´å¯è§åå¯¹è±¡å¤§å°çå®¹å¨æ§ä»¶ã\n\n\n# 3. faq\n\n\n# 3.1. kibana no default index pattern warning\n\n**é®é¢ï¼**å®è£ elk åï¼è®¿é® kibana é¡µé¢æ¶ï¼æç¤ºä»¥ä¸éè¯¯ä¿¡æ¯ï¼\n\nwarning no default index pattern. you must select or create one to continue.\n...\nunable to fetch mapping. do you have indices matching the pattern?\n\n\nè¿å°±è¯´æ logstash æ²¡æææ¥å¿åå¥å° elasticsearchã\n\nè§£å³æ¹æ³ï¼\n\næ£æ¥ logstash ä¸ elasticsearch ä¹é´çéè®¯æ¯å¦æé®é¢ï¼ä¸è¬é®é¢å°±åºå¨è¿ã\n\n\n# 4. åèèµæ\n\n * kibana å®ç½\n * kibana github\n * kibana å®æ¹ææ¡£',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Elastic ææ¯æ ",frontmatter:{title:"Elastic ææ¯æ ",date:"2022-04-11T16:52:35.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic"],permalink:"/pages/7bf7f7/",hidden:!0},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/02.Elastic/",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/02.Elastic/README.md",key:"v-0d48f15b",path:"/pages/7bf7f7/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:258},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:401},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:702}],headersStr:"ð åå®¹ ð èµæ ðª ä¼ é",content:"# Elastic ææ¯æ \n\n> Elastic ææ¯æ éå¸¸è¢«ç¨æ¥ä½ä¸ºæ¥å¿ééãæ£ç´¢ãå¯è§åçè§£å³æ¹æ¡ã\n> \n> ELK æ¯ elastic å¬å¸æä¸ä¸æ¬¾äº§å Elasticsearch ãLogstash ãKibana çé¦å­æ¯ç»åã\n> \n> Logstash ä¼ è¾åå¤çä½ çæ¥å¿ãäºå¡æå¶ä»æ°æ®ã\n> \n> Kibana å° Elasticsearch çæ°æ®åæå¹¶æ¸²æä¸ºå¯è§åçæ¥è¡¨ã\n> \n> Elastic ææ¯æ ï¼å¨ ELK çåºç¡ä¸æ©å±äºä¸äºæ°çäº§åï¼å¦ï¼Beats ãX-Pack ã\n\n\n# ð åå®¹\n\n * Elastic å¿«éå¥é¨\n * Elastic ææ¯æ ä¹ Filebeat\n * Filebeat è¿ç»´\n * Elastic ææ¯æ ä¹ Kibana\n * Kibana è¿ç»´\n * Elastic ææ¯æ ä¹ Logstash\n * Logstash è¿ç»´\n\n\n# ð èµæ\n\n * å®æ¹\n   * Logstash å®ç½\n   * Logstash Github\n   * Logstash å®æ¹ææ¡£\n   * Kibana å®ç½\n   * Kibana Github\n   * Kibana å®æ¹ææ¡£\n   * Beats å®ç½\n   * Beats Github\n   * Beats å®æ¹ææ¡£\n * ç¬¬ä¸æ¹å·¥å·\n   * logstash-logback-encoder\n * æç« \n   * Elasticsearch+Logstash+Kibana æç¨\n   * ELKï¼ElasticsearchãLogstashãKibanaï¼å®è£åéç½®\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç IT ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",normalizedContent:"# elastic ææ¯æ \n\n> elastic ææ¯æ éå¸¸è¢«ç¨æ¥ä½ä¸ºæ¥å¿ééãæ£ç´¢ãå¯è§åçè§£å³æ¹æ¡ã\n> \n> elk æ¯ elastic å¬å¸æä¸ä¸æ¬¾äº§å elasticsearch ãlogstash ãkibana çé¦å­æ¯ç»åã\n> \n> logstash ä¼ è¾åå¤çä½ çæ¥å¿ãäºå¡æå¶ä»æ°æ®ã\n> \n> kibana å° elasticsearch çæ°æ®åæå¹¶æ¸²æä¸ºå¯è§åçæ¥è¡¨ã\n> \n> elastic ææ¯æ ï¼å¨ elk çåºç¡ä¸æ©å±äºä¸äºæ°çäº§åï¼å¦ï¼beats ãx-pack ã\n\n\n# ð åå®¹\n\n * elastic å¿«éå¥é¨\n * elastic ææ¯æ ä¹ filebeat\n * filebeat è¿ç»´\n * elastic ææ¯æ ä¹ kibana\n * kibana è¿ç»´\n * elastic ææ¯æ ä¹ logstash\n * logstash è¿ç»´\n\n\n# ð èµæ\n\n * å®æ¹\n   * logstash å®ç½\n   * logstash github\n   * logstash å®æ¹ææ¡£\n   * kibana å®ç½\n   * kibana github\n   * kibana å®æ¹ææ¡£\n   * beats å®ç½\n   * beats github\n   * beats å®æ¹ææ¡£\n * ç¬¬ä¸æ¹å·¥å·\n   * logstash-logback-encoder\n * æç« \n   * elasticsearch+logstash+kibana æç¨\n   * elkï¼elasticsearchãlogstashãkibanaï¼å®è£åéç½®\n\n\n# ðª ä¼ é\n\nâ¾ ð§ éæç it ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"æ°æ®åº",frontmatter:{title:"æ°æ®åº",date:"2022-02-22T21:01:01.000Z",categories:["æ°æ®åº"],tags:["æ°æ®åº"],permalink:"/pages/012488/",hidden:!0},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/",relativePath:"12.æ°æ®åº/README.md",key:"v-72683126",path:"/pages/012488/",headers:[{level:2,title:"æ°æ®åºç»¼å",slug:"æ°æ®åºç»¼å",normalizedTitle:"æ°æ®åºç»¼å",charIndex:118},{level:3,title:"åå¸å¼å­å¨åç",slug:"åå¸å¼å­å¨åç",normalizedTitle:"åå¸å¼å­å¨åç",charIndex:128},{level:4,title:"åå¸å¼çè®º",slug:"åå¸å¼çè®º",normalizedTitle:"åå¸å¼çè®º",charIndex:139},{level:4,title:"åå¸å¼å³é®ææ¯",slug:"åå¸å¼å³é®ææ¯",normalizedTitle:"åå¸å¼å³é®ææ¯",charIndex:212},{level:5,title:"æµéè°åº¦",slug:"æµéè°åº¦",normalizedTitle:"æµéè°åº¦",charIndex:223},{level:5,title:"æ°æ®è°åº¦",slug:"æ°æ®è°åº¦",normalizedTitle:"æ°æ®è°åº¦",charIndex:269},{level:3,title:"å¶ä»",slug:"å¶ä»",normalizedTitle:"å¶ä»",charIndex:353},{level:2,title:"æ°æ®åºä¸­é´ä»¶",slug:"æ°æ®åºä¸­é´ä»¶",normalizedTitle:"æ°æ®åºä¸­é´ä»¶",charIndex:389},{level:2,title:"å³ç³»åæ°æ®åº",slug:"å³ç³»åæ°æ®åº",normalizedTitle:"å³ç³»åæ°æ®åº",charIndex:463},{level:3,title:"å³ç³»åæ°æ®åºç»¼å",slug:"å³ç³»åæ°æ®åºç»¼å",normalizedTitle:"å³ç³»åæ°æ®åºç»¼å",charIndex:499},{level:3,title:"Mysql",slug:"mysql",normalizedTitle:"mysql",charIndex:587},{level:3,title:"å¶ä»",slug:"å¶ä»-2",normalizedTitle:"å¶ä»",charIndex:353},{level:2,title:"ææ¡£æ°æ®åº",slug:"ææ¡£æ°æ®åº",normalizedTitle:"ææ¡£æ°æ®åº",charIndex:920},{level:3,title:"MongoDB",slug:"mongodb",normalizedTitle:"mongodb",charIndex:930},{level:2,title:"KV æ°æ®åº",slug:"kv-æ°æ®åº",normalizedTitle:"kv æ°æ®åº",charIndex:1363},{level:3,title:"Redis",slug:"redis",normalizedTitle:"redis",charIndex:1374},{level:2,title:"åå¼æ°æ®åº",slug:"åå¼æ°æ®åº",normalizedTitle:"åå¼æ°æ®åº",charIndex:1804},{level:3,title:"HBase",slug:"hbase",normalizedTitle:"hbase",charIndex:1814},{level:2,title:"æç´¢å¼ææ°æ®åº",slug:"æç´¢å¼ææ°æ®åº",normalizedTitle:"æç´¢å¼ææ°æ®åº",charIndex:2011},{level:3,title:"Elasticsearch",slug:"elasticsearch",normalizedTitle:"elasticsearch",charIndex:2023},{level:3,title:"Elastic",slug:"elastic",normalizedTitle:"elastic",charIndex:2023},{level:2,title:"èµæ ð",slug:"èµæ-ð",normalizedTitle:"èµæ ð",charIndex:2622},{level:3,title:"æ°æ®åºç»¼åèµæ",slug:"æ°æ®åºç»¼åèµæ",normalizedTitle:"æ°æ®åºç»¼åèµæ",charIndex:2632},{level:3,title:"å³ç³»åæ°æ®åºèµæ",slug:"å³ç³»åæ°æ®åºèµæ",normalizedTitle:"å³ç³»åæ°æ®åºèµæ",charIndex:3090},{level:4,title:"Mysql èµæ",slug:"mysql-èµæ",normalizedTitle:"mysql èµæ",charIndex:3217},{level:3,title:"Nosql æ°æ®åºç»¼å",slug:"nosql-æ°æ®åºç»¼å",normalizedTitle:"nosql æ°æ®åºç»¼å",charIndex:5543},{level:3,title:"åå¼æ°æ®åºèµæ",slug:"åå¼æ°æ®åºèµæ",normalizedTitle:"åå¼æ°æ®åºèµæ",charIndex:6548},{level:4,title:"Cassandra èµæ",slug:"cassandra-èµæ",normalizedTitle:"cassandra èµæ",charIndex:6559},{level:4,title:"HBase èµæ",slug:"hbase-èµæ",normalizedTitle:"hbase èµæ",charIndex:7087},{level:3,title:"KV æ°æ®åºèµæ",slug:"kv-æ°æ®åºèµæ",normalizedTitle:"kv æ°æ®åºèµæ",charIndex:7665},{level:4,title:"Redis èµæ",slug:"redis-èµæ",normalizedTitle:"redis èµæ",charIndex:7677},{level:3,title:"ææ¡£æ°æ®åºèµæ",slug:"ææ¡£æ°æ®åºèµæ",normalizedTitle:"ææ¡£æ°æ®åºèµæ",charIndex:8628},{level:4,title:"MongoDB èµæ",slug:"mongodb-èµæ",normalizedTitle:"mongodb èµæ",charIndex:8753},{level:3,title:"æç´¢å¼ææ°æ®åºèµæ",slug:"æç´¢å¼ææ°æ®åºèµæ",normalizedTitle:"æç´¢å¼ææ°æ®åºèµæ",charIndex:9158},{level:4,title:"ElasticSearch",slug:"elasticsearch-2",normalizedTitle:"elasticsearch",charIndex:2382},{level:3,title:"å¾æ°æ®åº",slug:"å¾æ°æ®åº",normalizedTitle:"å¾æ°æ®åº",charIndex:9781},{level:3,title:"æ¶åºæ°æ®åº",slug:"æ¶åºæ°æ®åº",normalizedTitle:"æ¶åºæ°æ®åº",charIndex:10348},{level:2,title:"ä¼ é ðª",slug:"ä¼ é-ðª",normalizedTitle:"ä¼ é ðª",charIndex:10851}],headersStr:"æ°æ®åºç»¼å åå¸å¼å­å¨åç åå¸å¼çè®º åå¸å¼å³é®ææ¯ æµéè°åº¦ æ°æ®è°åº¦ å¶ä» æ°æ®åºä¸­é´ä»¶ å³ç³»åæ°æ®åº å³ç³»åæ°æ®åºç»¼å Mysql å¶ä» ææ¡£æ°æ®åº MongoDB KV æ°æ®åº Redis åå¼æ°æ®åº HBase æç´¢å¼ææ°æ®åº Elasticsearch Elastic èµæ ð æ°æ®åºç»¼åèµæ å³ç³»åæ°æ®åºèµæ Mysql èµæ Nosql æ°æ®åºç»¼å åå¼æ°æ®åºèµæ Cassandra èµæ HBase èµæ KV æ°æ®åºèµæ Redis èµæ ææ¡£æ°æ®åºèµæ MongoDB èµæ æç´¢å¼ææ°æ®åºèµæ ElasticSearch å¾æ°æ®åº æ¶åºæ°æ®åº ä¼ é ðª",content:"DB-TUTORIAL\n\n> ð¾ db-tutorial æ¯ä¸ä¸ªæ°æ®åºæç¨ã\n> \n>  * ð é¡¹ç®åæ­¥ç»´æ¤ï¼Github | Gitee\n>  * ð çµå­ä¹¦éè¯»ï¼Github Pages | Gitee Pages\n\n\n# æ°æ®åºç»¼å\n\n\n# åå¸å¼å­å¨åç\n\n# åå¸å¼çè®º\n\n * åå¸å¼ä¸è´æ§\n * æ·±å¥åæå±è¯æ§ç®æ³ Paxos\n * æ·±å¥åæå±è¯æ§ç®æ³ Raft\n * åå¸å¼ç®æ³ Gossip\n\n# åå¸å¼å³é®ææ¯\n\n# æµéè°åº¦\n\n * æµéæ§å¶\n * è´è½½åè¡¡\n * æå¡è·¯ç±\n * åå¸å¼ä¼è¯åºæ¬åç\n\n# æ°æ®è°åº¦\n\n * ç¼å­åºæ¬åç\n * è¯»ååç¦»åºæ¬åç\n * ååºåè¡¨åºæ¬åç\n * åå¸å¼ ID åºæ¬åç\n * åå¸å¼äºå¡åºæ¬åç\n * åå¸å¼éåºæ¬åç\n\n\n# å¶ä»\n\n * Nosql ææ¯éå\n * æ°æ®ç»æä¸æ°æ®åºç´¢å¼\n\n\n# æ°æ®åºä¸­é´ä»¶\n\n * ShardingSphere ç®ä»\n * ShardingSphere Jdbc\n * çæ¬ç®¡çä¸­é´ä»¶ Flyway\n\n\n# å³ç³»åæ°æ®åº\n\n> å³ç³»åæ°æ®åº æ´çä¸»æµå³ç³»åæ°æ®åºç¥è¯ç¹ã\n\n\n# å³ç³»åæ°æ®åºç»¼å\n\n * å³ç³»åæ°æ®åºé¢è¯æ»ç» ð¯\n * SQL è¯­æ³åºç¡ç¹æ§\n * SQL è¯­æ³é«çº§ç¹æ§\n * æ©å± SQL\n * SQL Cheat Sheet\n\n\n# Mysql\n\n\n\n * Mysql åºç¨æå â¡\n * Mysql å·¥ä½æµ - å³é®è¯ï¼è¿æ¥ãç¼å­ãè¯­æ³åæãä¼åãæ§è¡å¼æãredo logãbin logãä¸¤é¶æ®µæäº¤\n * Mysql äºå¡ - å³é®è¯ï¼ACIDãAUTOCOMMITãäºå¡éç¦»çº§å«ãæ­»éãåå¸å¼äºå¡\n * Mysql é - å³é®è¯ï¼ä¹è§éãè¡¨çº§éãè¡çº§éãæåéãMVCCãNext-key é\n * Mysql ç´¢å¼ - å³é®è¯ï¼HashãB æ ãèç°ç´¢å¼ãåè¡¨\n * Mysql æ§è½ä¼å\n * Mysql è¿ç»´ ð¨\n * Mysql éç½® ð¨\n * Mysql é®é¢\n\n\n# å¶ä»\n\n * PostgreSQL åºç¨æå\n * H2 åºç¨æå\n * SqLite åºç¨æå\n\n\n# ææ¡£æ°æ®åº\n\n\n# MongoDB\n\n> MongoDB æ¯ä¸ä¸ªåºäºææ¡£çåå¸å¼æ°æ®åºï¼ç± C++ è¯­è¨ç¼åãæ¨å¨ä¸º WEB åºç¨æä¾å¯æ©å±çé«æ§è½æ°æ®å­å¨è§£å³æ¹æ¡ã\n> \n> MongoDB æ¯ä¸ä¸ªä»äºå³ç³»åæ°æ®åºåéå³ç³»åæ°æ®åºä¹é´çäº§åãå®æ¯éå³ç³»æ°æ®åºå½ä¸­åè½æä¸°å¯ï¼æåå³ç³»æ°æ®åºçãå®æ¯æçæ°æ®ç»æéå¸¸æ¾æ£ï¼æ¯ç±»ä¼¼ json ç bson æ ¼å¼ï¼å æ­¤å¯ä»¥å­å¨æ¯è¾å¤æçæ°æ®ç±»åã\n> \n> MongoDB æå¤§çç¹ç¹æ¯å®æ¯æçæ¥è¯¢è¯­è¨éå¸¸å¼ºå¤§ï¼å¶è¯­æ³æç¹ç±»ä¼¼äºé¢åå¯¹è±¡çæ¥è¯¢è¯­è¨ï¼å ä¹å¯ä»¥å®ç°ç±»ä¼¼å³ç³»æ°æ®åºåè¡¨æ¥è¯¢çç»å¤§é¨ååè½ï¼èä¸è¿æ¯æå¯¹æ°æ®å»ºç«ç´¢å¼ã\n\n * MongoDB åºç¨æå\n * MongoDB ç CRUD æä½\n * MongoDB èåæä½\n * MongoDB äºå¡\n * MongoDB å»ºæ¨¡\n * MongoDB å»ºæ¨¡ç¤ºä¾\n * MongoDB ç´¢å¼\n * MongoDB å¤å¶\n * MongoDB åç\n * MongoDB è¿ç»´\n\n\n# KV æ°æ®åº\n\n\n# Redis\n\n\n\n * Redis é¢è¯æ»ç» ð¯\n * Redis åºç¨æå â¡ - å³é®è¯ï¼åå­æ·æ±°ãäºä»¶ãäºå¡ãç®¡éãåå¸ä¸è®¢é\n * Redis æ°æ®ç±»åååºç¨ - å³é®è¯ï¼STRINGãHASHãLISTãSETãZSETãBitMapãHyperLogLogãGeo\n * Redis æä¹å - å³é®è¯ï¼RDBãAOFãSAVEãBGSAVEãappendfsync\n * Redis å¤å¶ - å³é®è¯ï¼SLAVEOFãSYNCãPSYNCãREPLCONF ACK\n * Redis å¨åµ - å³é®è¯ï¼SentinelãPINGãINFOãRaft\n * Redis éç¾¤ - å³é®è¯ï¼CLUSTER MEETãHash slotãMOVEDãASKãSLAVEOF no oneãredis-trib\n * Redis å®æ - å³é®è¯ï¼ç¼å­ãåå¸å¼éãå¸éè¿æ»¤å¨\n * Redis è¿ç»´ ð¨ - å³é®è¯ï¼å®è£ãå½ä»¤ãéç¾¤ãå®¢æ·ç«¯\n\n\n# åå¼æ°æ®åº\n\n\n# HBase\n\n * HBase å¿«éå¥é¨\n * HBase æ°æ®æ¨¡å\n * HBase Schema è®¾è®¡\n * HBase æ¶æ\n * HBase Java API åºç¡ç¹æ§\n * HBase Java API é«çº§ç¹æ§ä¹è¿æ»¤å¨\n * HBase Java API é«çº§ç¹æ§ä¹åå¤çå¨\n * HBase Java API å¶ä»é«çº§ç¹æ§\n * HBase è¿ç»´\n * HBase å½ä»¤\n\n\n# æç´¢å¼ææ°æ®åº\n\n\n# Elasticsearch\n\n> Elasticsearch æ¯ä¸ä¸ªåºäº Lucene çæç´¢åæ°æ®åæå·¥å·ï¼å®æä¾äºä¸ä¸ªåå¸å¼æå¡ãElasticsearch æ¯éµä» Apache å¼æºæ¡æ¬¾çä¸æ¬¾å¼æºäº§åï¼æ¯å½åä¸»æµçä¼ä¸çº§æç´¢å¼æã\n\n * Elasticsearch é¢è¯æ»ç» ð¯\n * Elasticsearch å¿«éå¥é¨\n * Elasticsearch ç®ä»\n * Elasticsearch ç´¢å¼\n * Elasticsearch æ¥è¯¢\n * Elasticsearch é«äº®\n * Elasticsearch æåº\n * Elasticsearch èå\n * Elasticsearch åæå¨\n * Elasticsearch æ§è½ä¼å\n * Elasticsearch Rest API\n * ElasticSearch Java API ä¹ High Level REST Client\n * Elasticsearch éç¾¤ååç\n * Elasticsearch è¿ç»´\n\n\n# Elastic\n\n * Elastic å¿«éå¥é¨\n * Elastic ææ¯æ ä¹ Filebeat\n * Filebeat è¿ç»´\n * Elastic ææ¯æ ä¹ Kibana\n * Kibana è¿ç»´\n * Elastic ææ¯æ ä¹ Logstash\n * Logstash è¿ç»´\n\n\n# èµæ ð\n\n\n# æ°æ®åºç»¼åèµæ\n\n * DB-Engines - æ°æ®åºæµè¡åº¦æå\n * ä¹¦ç±\n   * ãæ°æ®å¯éååºç¨ç³»ç»è®¾è®¡ã - è¿å¯è½æ¯ç®åæå¥½çåå¸å¼å­å¨ä¹¦ç±ï¼å¼ºåæ¨èãè¿é¶ã\n * æç¨\n   * CMU 15445 æ°æ®åºåºç¡è¯¾ç¨\n   * CMU 15721 æ°æ®åºé«çº§è¯¾ç¨\n   * æ£ç´¢ææ¯æ ¸å¿ 20 è®² - æå®¢æç¨ãè¿é¶ã\n   * åç«¯å­å¨å®æè¯¾ - æå®¢æç¨ãå¥é¨ãï¼è®²è§£å­å¨å¨çµåé¢åçç§ç§åºç¨åä¸äºåºæ¬ç¹æ§\n * è®ºæ\n   * Efficiency in the Columbia Database Query Optimizer\n   * How Good Are Query Optimizers, Really?\n   * Architecture of a Database System\n   * Data Structures for Databases\n * æç« \n   * Data Structures and Algorithms for Big Databases\n\n\n# å³ç³»åæ°æ®åºèµæ\n\n * ç»¼åèµæ\n   * ãæ°æ®åºçç´¢å¼è®¾è®¡ä¸ä¼åã\n   * ãSQL å¿ç¥å¿ä¼ã - SQL çåºæ¬æ¦å¿µåè¯­æ³ãå¥é¨ã\n * Oracle èµæ\n   * ãOracle Database 9i/10g/11g ç¼ç¨èºæ¯ã\n\n# Mysql èµæ\n\n * å®æ¹\n   * Mysql å®ç½\n   * Mysql å®æ¹ææ¡£\n   * å®æ¹ PPT\n     * How to Analyze and Tune MySQL Queries for Better Performance\n     * MySQL Performance Tuning 101\n     * MySQL Performance Schema & Sys Schema\n     * MySQL Performance: Demystified Tuning & Best Practices\n     * MySQL Security Best Practices\n     * MySQL Cluster Deployment Best Practices\n     * MySQL High Availability with InnoDB Cluster\n * ä¹¦ç±\n   * ãé«æ§è½ MySQLã - ç»å¸ï¼éå DBA æä½ä¸ºå¼åèçåèæåãè¿é¶ã\n   * ãMySQL ææ¯åå¹ï¼InnoDB å­å¨å¼æã\n   * ãMySQL å¿ç¥å¿ä¼ã - Mysql çåºæ¬æ¦å¿µåè¯­æ³ãå¥é¨ã\n * æç¨\n   * runoob.com MySQL æç¨ - å¥é¨çº§ SQL æç¨\n   * mysql-tutorial\n * æç« \n   * MySQL ç´¢å¼èåçæ°æ®ç»æåç®æ³åç\n   * Some study on database storage internals\n   * Sharding Pinterest: How we scaled our MySQL fleet\n   * Guide to MySQL High Availability\n   * Choosing MySQL High Availability Solutions\n   * High availability with MariaDB TX: The definitive guide\n   * Mysql ç¸å³ç»éª\n     * Booking.com: Evolution of MySQL System Design ï¼Booking.com ç MySQL æ°æ®åºä½¿ç¨çæ¼åï¼å¶ä¸­æå¾å¤ä¸éçç»éªåäº«ï¼æç¸ä¿¡ä¹æ¯å¾å¤å¬å¸ä¼éå°ççé®é¢ã\n     * Tracking the Moneyâ-âScaling Financial Reporting at Airbnb ï¼Airbnb çæ°æ®åºæ©å±çç»éªåäº«ã\n     * Why Uber Engineering Switched from Postgres to MySQL ï¼æ ææ¯è¾ä¸¤ä¸ªæ°æ®åºè°å¥½è°ä¸å¥½ï¼æ¨èè¿ç¯ Uber çé¿æï¼ä¸»è¦æ¯æ³è®©ä½ ä»ä¸­å­¦ä¹ å°ä¸äºç»éªåææ¯ç»èï¼è¿æ¯ä¸ç¯å¾ä¸éçæç« ã\n   * Mysql éç¾¤å¤å¶\n     * Monitoring Delayed Replication, With A Focus On MySQL\n     * Mitigating replication lag and reducing read load with freno\n     * Better Parallel Replication for MySQL\n     * Evaluating MySQL Parallel Replication Part 2: Slave Group Commit\n     * Evaluating MySQL Parallel Replication Part 3: Benchmarks in Production\n     * Evaluating MySQL Parallel Replication Part 4: More Benchmarks in Production\n     * Evaluating MySQL Parallel Replication Part 4, Annex: Under the Hood\n   * Mysql æ°æ®ååº\n     * StackOverflow: MySQL sharding approaches?\n     * Why you donât want to shard\n     * [How to Scale Big Data Applications](https://www.percona.com/sites/default/files/presentations/How to Scale Big Data Applications.pdf)\n     * MySQL Sharding with ProxySQL\n   * åå¬å¸ç Mysql æ°æ®ååºç»éªåäº«\n     * MailChimp: Using Shards to Accommodate Millions of Users\n     * Uber: Code Migration in Production: Rewriting the Sharding Layer of Uberâs Schemaless Datastore\n     * Sharding & IDs at Instagram\n     * Airbnb: How We Partitioned Airbnbâs Main Database in Two Weeks\n * æ´å¤èµæº\n   * awesome-mysql - MySQL çèµæºåè¡¨\n\n\n# Nosql æ°æ®åºç»¼å\n\n * Martin Fowler å¨ YouTube ä¸åäº«ç NoSQL ä»ç» Introduction To NoSQLï¼ ä»¥åä»åä¸ç¼åç NoSQL Distilled - NoSQL ç²¾ç²¹ï¼è¿æ¬ä¹¦æ 100 å¤é¡µï¼æ¯æ¬é¾å¾çå³äº NoSQL çä¹¦ï¼å¾ä¸éï¼éå¸¸æè¯»ã\n * NoSQL Databases: a Survey and Decision Guidanceï¼è¿ç¯æç« å¯ä»¥å¸¦ä½ èªä¸èä¸å°ä» CAP åçå°å¼å§äºè§£ NoSQL çç§ç§ææ¯ï¼æ¯ä¸ç¯éå¸¸ä¸éçæç« ã\n * Distribution, Data, Deployment: Software Architecture Convergence in Big Data Systemsï¼è¿æ¯å¡ååºÂ·æ¢éå¤§å­¦çä¸ç¯è®²åå¸å¼å¤§æ°æ®ç³»ç»çè®ºæãå¶ä¸­ä¸»è¦è®¨è®ºäºå¨å¤§æ°æ®æ¶ä»£ä¸çè½¯ä»¶å·¥ç¨ä¸­çä¸äºå³é®ç¹ï¼ä¹è¯´å°äº NoSQL æ°æ®åºã\n * No Relation: The Mixed Blessings of Non-Relational Databasesï¼è¿ç¯è®ºæè½ç¶æç¹å¹´ä»£ä¹è¿ãä½è¿ç¯è®ºææ¯ HBase çåºç¡ï¼ä½ è±ä¸ä¸ç¹æ¶é´æ¥è¯»è¯»ï¼å°±å¯ä»¥äºè§£å°ï¼å¯¹åç§éå³ç³»åæ°æ®å­å¨ä¼ç¼ºç¹çä¸ä¸ªå¾å¥½çæ¯è¾ã\n * NoSQL Data Modeling Techniques ï¼NoSQL å»ºæ¨¡ææ¯ãè¿ç¯æç« ææ¾ç»ç¿»è¯å¨äº CoolShell ä¸ï¼æ é¢ä¸º NoSQL æ°æ®å»ºæ¨¡ææ¯ï¼ä¾ä½ åèã\n   * MongoDB - Data Modeling Introduction ï¼è½ç¶è¿æ¯ MongoDB çæ°æ®å»ºæ¨¡ä»ç»ï¼ä½æ¯å¶å¾å¤è§ç¹å¯ä»¥ç¨äºå¶å®ç NoSQL æ°æ®åºã\n   * Firebase - Structure Your Database ï¼Google ç Firebase æ°æ®åºä½¿ç¨ JSON å»ºæ¨¡çä¸äºæä½³å®è·µã\n * å ä¸º CAP åçï¼æä»¥å½ä½ éè¦éæ©ä¸ä¸ª NoSQL æ°æ®åºçæ¶åï¼ä½ åºè¯¥ççè¿ç¯ææ¡£ Visual Guide to NoSQL Systemsã\n\né SQL è¿æ¯ NoSQLï¼è¿éæä¸¤ç¯æç« ï¼å¼å¾ä½ ççã\n\n * SQL vs. NoSQL Databases: Whatâs the Difference?\n * Salesforce: SQL or NoSQL\n\n\n# åå¼æ°æ®åºèµæ\n\n# Cassandra èµæ\n\n * æ²å°çå®éªå®¤æä¸¤ç¯æç« å¼å¾ä¸è¯»ã\n   * Avoid Pitfalls in Scaling Cassandra Cluster at Walmart\n   * Storing Images in Cassandra at Walmart\n * Yelp: How We Scaled Our Ad Analytics with Apache Cassandra ï¼Yelp çè¿ç¯åå®¢ä¹æä¸äºç¸å³çç»éªåæè®­ã\n * Discord: How Discord Stores Billions of Messages ï¼Discord å¬å¸åäº«çä¸ä¸ªå¦ä½å­å¨åäº¿çº§æ¶æ¯çææ¯æç« ã\n * Cassandra at Instagram ï¼Instagram çä¸ä¸ª PPTï¼å¶ä¸­ä»ç»äº Instagram ä¸­æ¯æä¹ä½¿ç¨ Cassandra çã\n * Netflix: Benchmarking Cassandra Scalability on AWSâ-âOver a million writes per second ï¼Netflix å¬å¸å¨ AWS ä¸ç» Cassandra åçä¸ä¸ª Benchmarkã\n\n# HBase èµæ\n\n * Imgur Notification: From MySQL to HBASE\n * Pinterest: Improving HBase Backup Efficiency\n * IBM : Tuning HBase performance\n * HBase File Locality in HDFS\n * Apache Hadoop Goes Realtime at Facebook\n * Storage Infrastructure Behind Facebook Messages: Using HBase at Scale\n * GitHub: Awesome HBase\n\néå¯¹äº HBase æä¸¤æ¬ä¹¦ä½ å¯ä»¥èèä¸ä¸ã\n\n * é¦åï¼åæ¨èä¸¤æ¬ä¹¦ï¼ä¸æ¬æ¯åå®è·µçãHBase å®æãï¼å¦ä¸æ¬æ¯åå¤§èå¨çæååçãHBase æå¨æåãã\n * å½ç¶ï¼ä½ ä¹å¯ä»¥ççå®æ¹ç The Apache HBaseâ¢ Reference Guide\n * å¦å¤ä¸¤ä¸ªåæ°æ®åºï¼\n   * ClickHouse - Open Source Distributed Column Database at Yandex\n   * Scaling Redshift without Scaling Costs at GIPHY\n\n\n# KV æ°æ®åºèµæ\n\n# Redis èµæ\n\n * å®ç½\n   * Redis å®ç½\n   * Redis github\n   * Redis å®æ¹ææ¡£ä¸­æç\n   * Redis å½ä»¤åè\n * ä¹¦ç±\n   * ãRedis å®æã\n   * ãRedis è®¾è®¡ä¸å®ç°ã\n * æºç \n   * ãRedis å®æãéå¥ Python æºç \n * èµæºæ±æ»\n   * awesome-redis\n * Redis Client\n   * spring-data-redis å®æ¹ææ¡£\n   * redisson å®æ¹ææ¡£(ä¸­æ,ç¥ææ»å)\n   * redisson å®æ¹ææ¡£(è±æ)\n   * CRUG | Redisson PRO vs. Jedis: Which Is Faster? ç¿»è¯\n   * redis åå¸é Redisson æ§è½æµè¯\n * æç« \n   * Learn Redis the hard way (in production) at Trivago\n   * Twitter: How Twitter Uses Redis To Scale - 105TB RAM, 39MM QPS, 10,000+ Instances\n   * Slack: Scaling Slackâs Job Queue - Robustly Handling Billions of Tasks in Milliseconds Using Kafka and Redis\n   * GitHub: Moving persistent data out of Redis at GitHub\n   * Instagram: Storing Hundreds of Millions of Simple Key-Value Pairs in Redis\n   * Redis in Chat Architecture of Twitch (from 27:22)\n   * Deliveroo: Optimizing Session Key Storage in Redis\n   * Deliveroo: Optimizing Redis Storage\n   * GitHub: Awesome Redis\n\n\n# ææ¡£æ°æ®åºèµæ\n\n * Couchbase Ecosystem at LinkedIn\n * SimpleDB at Zendesk\n * Data Points - What the Heck Are Document Databases?\n\n# MongoDB èµæ\n\n * å®æ¹\n   * MongoDB å®ç½\n   * MongoDB Github\n   * MongoDB å®æ¹åè´¹æç¨\n * æç¨\n   * MongoDB æç¨\n   * MongoDB é«æè¯¾\n * æ°æ®\n   * mongodb-json-files\n * æç« \n   * Introduction to MongoDB\n   * eBay: Building Mission-Critical Multi-Data Center Applications with MongoDB\n   * The AWS and MongoDB Infrastructure of Parse: Lessons Learned\n   * Migrating Mountains of Mongo Data\n * æ´å¤èµæº\n   * Github: Awesome MongoDB\n\n\n# æç´¢å¼ææ°æ®åºèµæ\n\n# ElasticSearch\n\n * å®æ¹\n   * Elasticsearch å®ç½\n   * Elasticsearch Github\n   * Elasticsearch å®æ¹ææ¡£\n   * Elasticsearch: The Definitive Guide - ElasticSearch å®æ¹å­¦ä¹ èµæ\n * ä¹¦ç±\n   * ãElasticsearch å®æã\n * æç¨\n   * ELK Stack æå¨æå\n   * Elasticsearch æç¨\n * æç« \n   * Elasticsearch+Logstash+Kibana æç¨\n   * ELKï¼ElasticsearchãLogstashãKibanaï¼å®è£åéç½®\n   * æ§è½è°ä¼ç¸å³çå·¥ç¨å®è·µ\n     * Elasticsearch Performance Tuning Practice at eBay\n     * Elasticsearch at Kickstarter\n     * 9 tips on ElasticSearch configuration for high performance\n     * Elasticsearch In Productionâ-âDeployment Best Practices\n * æ´å¤èµæº\n   * GitHub: Awesome ElasticSearch\n\n\n# å¾æ°æ®åº\n\n * é¦åæ¯ IBM Devloperworks ä¸çä¸¤ä¸ªç®ä»æ§ç PPTã\n   * Intro to graph databases, Part 1, Graph databases and the CRUD operations\n   * Intro to graph databases, Part 2, Building a recommendation engine with a graph database\n * ç¶åæ¯ä¸æ¬åè´¹ççµå­ä¹¦ãGraph Databaseãã\n * æ¥ä¸æ¥æ¯ä¸äºå¾æ°æ®åºçä»ç»æç« ã\n   * Handling Billions of Edges in a Graph Database\n   * Neo4j case studies with Walmart, eBay, AirBnB, NASA, etc\n   * FlockDB: Distributed Graph Database for Storing Adjacency Lists at Twitter\n   * JanusGraph: Scalable Graph Database backed by Google, IBM and Hortonworks\n   * Amazon Neptune\n\n\n# æ¶åºæ°æ®åº\n\n * What is Time-Series Data & Why We Need a Time-Series Database\n * Time Series Data: Why and How to Use a Relational Database instead of NoSQL\n * Beringei: High-performance Time Series Storage Engine @Facebook\n * Introducing Atlas: Netflixâs Primary Telemetry Platform @Netflix\n * Building a Scalable Time Series Database on PostgreSQL\n * Scaling Time Series Data Storage - Part I @Netflix\n * Design of a Cost Efficient Time Series Store for Big Data\n * GitHub: Awesome Time-Series Database\n\n\n# ä¼ é ðª\n\nâ¾ ð§ éæç IT ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",normalizedContent:"db-tutorial\n\n> ð¾ db-tutorial æ¯ä¸ä¸ªæ°æ®åºæç¨ã\n> \n>  * ð é¡¹ç®åæ­¥ç»´æ¤ï¼github | gitee\n>  * ð çµå­ä¹¦éè¯»ï¼github pages | gitee pages\n\n\n# æ°æ®åºç»¼å\n\n\n# åå¸å¼å­å¨åç\n\n# åå¸å¼çè®º\n\n * åå¸å¼ä¸è´æ§\n * æ·±å¥åæå±è¯æ§ç®æ³ paxos\n * æ·±å¥åæå±è¯æ§ç®æ³ raft\n * åå¸å¼ç®æ³ gossip\n\n# åå¸å¼å³é®ææ¯\n\n# æµéè°åº¦\n\n * æµéæ§å¶\n * è´è½½åè¡¡\n * æå¡è·¯ç±\n * åå¸å¼ä¼è¯åºæ¬åç\n\n# æ°æ®è°åº¦\n\n * ç¼å­åºæ¬åç\n * è¯»ååç¦»åºæ¬åç\n * ååºåè¡¨åºæ¬åç\n * åå¸å¼ id åºæ¬åç\n * åå¸å¼äºå¡åºæ¬åç\n * åå¸å¼éåºæ¬åç\n\n\n# å¶ä»\n\n * nosql ææ¯éå\n * æ°æ®ç»æä¸æ°æ®åºç´¢å¼\n\n\n# æ°æ®åºä¸­é´ä»¶\n\n * shardingsphere ç®ä»\n * shardingsphere jdbc\n * çæ¬ç®¡çä¸­é´ä»¶ flyway\n\n\n# å³ç³»åæ°æ®åº\n\n> å³ç³»åæ°æ®åº æ´çä¸»æµå³ç³»åæ°æ®åºç¥è¯ç¹ã\n\n\n# å³ç³»åæ°æ®åºç»¼å\n\n * å³ç³»åæ°æ®åºé¢è¯æ»ç» ð¯\n * sql è¯­æ³åºç¡ç¹æ§\n * sql è¯­æ³é«çº§ç¹æ§\n * æ©å± sql\n * sql cheat sheet\n\n\n# mysql\n\n\n\n * mysql åºç¨æå â¡\n * mysql å·¥ä½æµ - å³é®è¯ï¼è¿æ¥ãç¼å­ãè¯­æ³åæãä¼åãæ§è¡å¼æãredo logãbin logãä¸¤é¶æ®µæäº¤\n * mysql äºå¡ - å³é®è¯ï¼acidãautocommitãäºå¡éç¦»çº§å«ãæ­»éãåå¸å¼äºå¡\n * mysql é - å³é®è¯ï¼ä¹è§éãè¡¨çº§éãè¡çº§éãæåéãmvccãnext-key é\n * mysql ç´¢å¼ - å³é®è¯ï¼hashãb æ ãèç°ç´¢å¼ãåè¡¨\n * mysql æ§è½ä¼å\n * mysql è¿ç»´ ð¨\n * mysql éç½® ð¨\n * mysql é®é¢\n\n\n# å¶ä»\n\n * postgresql åºç¨æå\n * h2 åºç¨æå\n * sqlite åºç¨æå\n\n\n# ææ¡£æ°æ®åº\n\n\n# mongodb\n\n> mongodb æ¯ä¸ä¸ªåºäºææ¡£çåå¸å¼æ°æ®åºï¼ç± c++ è¯­è¨ç¼åãæ¨å¨ä¸º web åºç¨æä¾å¯æ©å±çé«æ§è½æ°æ®å­å¨è§£å³æ¹æ¡ã\n> \n> mongodb æ¯ä¸ä¸ªä»äºå³ç³»åæ°æ®åºåéå³ç³»åæ°æ®åºä¹é´çäº§åãå®æ¯éå³ç³»æ°æ®åºå½ä¸­åè½æä¸°å¯ï¼æåå³ç³»æ°æ®åºçãå®æ¯æçæ°æ®ç»æéå¸¸æ¾æ£ï¼æ¯ç±»ä¼¼ json ç bson æ ¼å¼ï¼å æ­¤å¯ä»¥å­å¨æ¯è¾å¤æçæ°æ®ç±»åã\n> \n> mongodb æå¤§çç¹ç¹æ¯å®æ¯æçæ¥è¯¢è¯­è¨éå¸¸å¼ºå¤§ï¼å¶è¯­æ³æç¹ç±»ä¼¼äºé¢åå¯¹è±¡çæ¥è¯¢è¯­è¨ï¼å ä¹å¯ä»¥å®ç°ç±»ä¼¼å³ç³»æ°æ®åºåè¡¨æ¥è¯¢çç»å¤§é¨ååè½ï¼èä¸è¿æ¯æå¯¹æ°æ®å»ºç«ç´¢å¼ã\n\n * mongodb åºç¨æå\n * mongodb ç crud æä½\n * mongodb èåæä½\n * mongodb äºå¡\n * mongodb å»ºæ¨¡\n * mongodb å»ºæ¨¡ç¤ºä¾\n * mongodb ç´¢å¼\n * mongodb å¤å¶\n * mongodb åç\n * mongodb è¿ç»´\n\n\n# kv æ°æ®åº\n\n\n# redis\n\n\n\n * redis é¢è¯æ»ç» ð¯\n * redis åºç¨æå â¡ - å³é®è¯ï¼åå­æ·æ±°ãäºä»¶ãäºå¡ãç®¡éãåå¸ä¸è®¢é\n * redis æ°æ®ç±»åååºç¨ - å³é®è¯ï¼stringãhashãlistãsetãzsetãbitmapãhyperloglogãgeo\n * redis æä¹å - å³é®è¯ï¼rdbãaofãsaveãbgsaveãappendfsync\n * redis å¤å¶ - å³é®è¯ï¼slaveofãsyncãpsyncãreplconf ack\n * redis å¨åµ - å³é®è¯ï¼sentinelãpingãinfoãraft\n * redis éç¾¤ - å³é®è¯ï¼cluster meetãhash slotãmovedãaskãslaveof no oneãredis-trib\n * redis å®æ - å³é®è¯ï¼ç¼å­ãåå¸å¼éãå¸éè¿æ»¤å¨\n * redis è¿ç»´ ð¨ - å³é®è¯ï¼å®è£ãå½ä»¤ãéç¾¤ãå®¢æ·ç«¯\n\n\n# åå¼æ°æ®åº\n\n\n# hbase\n\n * hbase å¿«éå¥é¨\n * hbase æ°æ®æ¨¡å\n * hbase schema è®¾è®¡\n * hbase æ¶æ\n * hbase java api åºç¡ç¹æ§\n * hbase java api é«çº§ç¹æ§ä¹è¿æ»¤å¨\n * hbase java api é«çº§ç¹æ§ä¹åå¤çå¨\n * hbase java api å¶ä»é«çº§ç¹æ§\n * hbase è¿ç»´\n * hbase å½ä»¤\n\n\n# æç´¢å¼ææ°æ®åº\n\n\n# elasticsearch\n\n> elasticsearch æ¯ä¸ä¸ªåºäº lucene çæç´¢åæ°æ®åæå·¥å·ï¼å®æä¾äºä¸ä¸ªåå¸å¼æå¡ãelasticsearch æ¯éµä» apache å¼æºæ¡æ¬¾çä¸æ¬¾å¼æºäº§åï¼æ¯å½åä¸»æµçä¼ä¸çº§æç´¢å¼æã\n\n * elasticsearch é¢è¯æ»ç» ð¯\n * elasticsearch å¿«éå¥é¨\n * elasticsearch ç®ä»\n * elasticsearch ç´¢å¼\n * elasticsearch æ¥è¯¢\n * elasticsearch é«äº®\n * elasticsearch æåº\n * elasticsearch èå\n * elasticsearch åæå¨\n * elasticsearch æ§è½ä¼å\n * elasticsearch rest api\n * elasticsearch java api ä¹ high level rest client\n * elasticsearch éç¾¤ååç\n * elasticsearch è¿ç»´\n\n\n# elastic\n\n * elastic å¿«éå¥é¨\n * elastic ææ¯æ ä¹ filebeat\n * filebeat è¿ç»´\n * elastic ææ¯æ ä¹ kibana\n * kibana è¿ç»´\n * elastic ææ¯æ ä¹ logstash\n * logstash è¿ç»´\n\n\n# èµæ ð\n\n\n# æ°æ®åºç»¼åèµæ\n\n * db-engines - æ°æ®åºæµè¡åº¦æå\n * ä¹¦ç±\n   * ãæ°æ®å¯éååºç¨ç³»ç»è®¾è®¡ã - è¿å¯è½æ¯ç®åæå¥½çåå¸å¼å­å¨ä¹¦ç±ï¼å¼ºåæ¨èãè¿é¶ã\n * æç¨\n   * cmu 15445 æ°æ®åºåºç¡è¯¾ç¨\n   * cmu 15721 æ°æ®åºé«çº§è¯¾ç¨\n   * æ£ç´¢ææ¯æ ¸å¿ 20 è®² - æå®¢æç¨ãè¿é¶ã\n   * åç«¯å­å¨å®æè¯¾ - æå®¢æç¨ãå¥é¨ãï¼è®²è§£å­å¨å¨çµåé¢åçç§ç§åºç¨åä¸äºåºæ¬ç¹æ§\n * è®ºæ\n   * efficiency in the columbia database query optimizer\n   * how good are query optimizers, really?\n   * architecture of a database system\n   * data structures for databases\n * æç« \n   * data structures and algorithms for big databases\n\n\n# å³ç³»åæ°æ®åºèµæ\n\n * ç»¼åèµæ\n   * ãæ°æ®åºçç´¢å¼è®¾è®¡ä¸ä¼åã\n   * ãsql å¿ç¥å¿ä¼ã - sql çåºæ¬æ¦å¿µåè¯­æ³ãå¥é¨ã\n * oracle èµæ\n   * ãoracle database 9i/10g/11g ç¼ç¨èºæ¯ã\n\n# mysql èµæ\n\n * å®æ¹\n   * mysql å®ç½\n   * mysql å®æ¹ææ¡£\n   * å®æ¹ ppt\n     * how to analyze and tune mysql queries for better performance\n     * mysql performance tuning 101\n     * mysql performance schema & sys schema\n     * mysql performance: demystified tuning & best practices\n     * mysql security best practices\n     * mysql cluster deployment best practices\n     * mysql high availability with innodb cluster\n * ä¹¦ç±\n   * ãé«æ§è½ mysqlã - ç»å¸ï¼éå dba æä½ä¸ºå¼åèçåèæåãè¿é¶ã\n   * ãmysql ææ¯åå¹ï¼innodb å­å¨å¼æã\n   * ãmysql å¿ç¥å¿ä¼ã - mysql çåºæ¬æ¦å¿µåè¯­æ³ãå¥é¨ã\n * æç¨\n   * runoob.com mysql æç¨ - å¥é¨çº§ sql æç¨\n   * mysql-tutorial\n * æç« \n   * mysql ç´¢å¼èåçæ°æ®ç»æåç®æ³åç\n   * some study on database storage internals\n   * sharding pinterest: how we scaled our mysql fleet\n   * guide to mysql high availability\n   * choosing mysql high availability solutions\n   * high availability with mariadb tx: the definitive guide\n   * mysql ç¸å³ç»éª\n     * booking.com: evolution of mysql system design ï¼booking.com ç mysql æ°æ®åºä½¿ç¨çæ¼åï¼å¶ä¸­æå¾å¤ä¸éçç»éªåäº«ï¼æç¸ä¿¡ä¹æ¯å¾å¤å¬å¸ä¼éå°ççé®é¢ã\n     * tracking the moneyâ-âscaling financial reporting at airbnb ï¼airbnb çæ°æ®åºæ©å±çç»éªåäº«ã\n     * why uber engineering switched from postgres to mysql ï¼æ ææ¯è¾ä¸¤ä¸ªæ°æ®åºè°å¥½è°ä¸å¥½ï¼æ¨èè¿ç¯ uber çé¿æï¼ä¸»è¦æ¯æ³è®©ä½ ä»ä¸­å­¦ä¹ å°ä¸äºç»éªåææ¯ç»èï¼è¿æ¯ä¸ç¯å¾ä¸éçæç« ã\n   * mysql éç¾¤å¤å¶\n     * monitoring delayed replication, with a focus on mysql\n     * mitigating replication lag and reducing read load with freno\n     * better parallel replication for mysql\n     * evaluating mysql parallel replication part 2: slave group commit\n     * evaluating mysql parallel replication part 3: benchmarks in production\n     * evaluating mysql parallel replication part 4: more benchmarks in production\n     * evaluating mysql parallel replication part 4, annex: under the hood\n   * mysql æ°æ®ååº\n     * stackoverflow: mysql sharding approaches?\n     * why you donât want to shard\n     * [how to scale big data applications](https://www.percona.com/sites/default/files/presentations/how to scale big data applications.pdf)\n     * mysql sharding with proxysql\n   * åå¬å¸ç mysql æ°æ®ååºç»éªåäº«\n     * mailchimp: using shards to accommodate millions of users\n     * uber: code migration in production: rewriting the sharding layer of uberâs schemaless datastore\n     * sharding & ids at instagram\n     * airbnb: how we partitioned airbnbâs main database in two weeks\n * æ´å¤èµæº\n   * awesome-mysql - mysql çèµæºåè¡¨\n\n\n# nosql æ°æ®åºç»¼å\n\n * martin fowler å¨ youtube ä¸åäº«ç nosql ä»ç» introduction to nosqlï¼ ä»¥åä»åä¸ç¼åç nosql distilled - nosql ç²¾ç²¹ï¼è¿æ¬ä¹¦æ 100 å¤é¡µï¼æ¯æ¬é¾å¾çå³äº nosql çä¹¦ï¼å¾ä¸éï¼éå¸¸æè¯»ã\n * nosql databases: a survey and decision guidanceï¼è¿ç¯æç« å¯ä»¥å¸¦ä½ èªä¸èä¸å°ä» cap åçå°å¼å§äºè§£ nosql çç§ç§ææ¯ï¼æ¯ä¸ç¯éå¸¸ä¸éçæç« ã\n * distribution, data, deployment: software architecture convergence in big data systemsï¼è¿æ¯å¡ååºÂ·æ¢éå¤§å­¦çä¸ç¯è®²åå¸å¼å¤§æ°æ®ç³»ç»çè®ºæãå¶ä¸­ä¸»è¦è®¨è®ºäºå¨å¤§æ°æ®æ¶ä»£ä¸çè½¯ä»¶å·¥ç¨ä¸­çä¸äºå³é®ç¹ï¼ä¹è¯´å°äº nosql æ°æ®åºã\n * no relation: the mixed blessings of non-relational databasesï¼è¿ç¯è®ºæè½ç¶æç¹å¹´ä»£ä¹è¿ãä½è¿ç¯è®ºææ¯ hbase çåºç¡ï¼ä½ è±ä¸ä¸ç¹æ¶é´æ¥è¯»è¯»ï¼å°±å¯ä»¥äºè§£å°ï¼å¯¹åç§éå³ç³»åæ°æ®å­å¨ä¼ç¼ºç¹çä¸ä¸ªå¾å¥½çæ¯è¾ã\n * nosql data modeling techniques ï¼nosql å»ºæ¨¡ææ¯ãè¿ç¯æç« ææ¾ç»ç¿»è¯å¨äº coolshell ä¸ï¼æ é¢ä¸º nosql æ°æ®å»ºæ¨¡ææ¯ï¼ä¾ä½ åèã\n   * mongodb - data modeling introduction ï¼è½ç¶è¿æ¯ mongodb çæ°æ®å»ºæ¨¡ä»ç»ï¼ä½æ¯å¶å¾å¤è§ç¹å¯ä»¥ç¨äºå¶å®ç nosql æ°æ®åºã\n   * firebase - structure your database ï¼google ç firebase æ°æ®åºä½¿ç¨ json å»ºæ¨¡çä¸äºæä½³å®è·µã\n * å ä¸º cap åçï¼æä»¥å½ä½ éè¦éæ©ä¸ä¸ª nosql æ°æ®åºçæ¶åï¼ä½ åºè¯¥ççè¿ç¯ææ¡£ visual guide to nosql systemsã\n\né sql è¿æ¯ nosqlï¼è¿éæä¸¤ç¯æç« ï¼å¼å¾ä½ ççã\n\n * sql vs. nosql databases: whatâs the difference?\n * salesforce: sql or nosql\n\n\n# åå¼æ°æ®åºèµæ\n\n# cassandra èµæ\n\n * æ²å°çå®éªå®¤æä¸¤ç¯æç« å¼å¾ä¸è¯»ã\n   * avoid pitfalls in scaling cassandra cluster at walmart\n   * storing images in cassandra at walmart\n * yelp: how we scaled our ad analytics with apache cassandra ï¼yelp çè¿ç¯åå®¢ä¹æä¸äºç¸å³çç»éªåæè®­ã\n * discord: how discord stores billions of messages ï¼discord å¬å¸åäº«çä¸ä¸ªå¦ä½å­å¨åäº¿çº§æ¶æ¯çææ¯æç« ã\n * cassandra at instagram ï¼instagram çä¸ä¸ª pptï¼å¶ä¸­ä»ç»äº instagram ä¸­æ¯æä¹ä½¿ç¨ cassandra çã\n * netflix: benchmarking cassandra scalability on awsâ-âover a million writes per second ï¼netflix å¬å¸å¨ aws ä¸ç» cassandra åçä¸ä¸ª benchmarkã\n\n# hbase èµæ\n\n * imgur notification: from mysql to hbase\n * pinterest: improving hbase backup efficiency\n * ibm : tuning hbase performance\n * hbase file locality in hdfs\n * apache hadoop goes realtime at facebook\n * storage infrastructure behind facebook messages: using hbase at scale\n * github: awesome hbase\n\néå¯¹äº hbase æä¸¤æ¬ä¹¦ä½ å¯ä»¥èèä¸ä¸ã\n\n * é¦åï¼åæ¨èä¸¤æ¬ä¹¦ï¼ä¸æ¬æ¯åå®è·µçãhbase å®æãï¼å¦ä¸æ¬æ¯åå¤§èå¨çæååçãhbase æå¨æåãã\n * å½ç¶ï¼ä½ ä¹å¯ä»¥ççå®æ¹ç the apache hbaseâ¢ reference guide\n * å¦å¤ä¸¤ä¸ªåæ°æ®åºï¼\n   * clickhouse - open source distributed column database at yandex\n   * scaling redshift without scaling costs at giphy\n\n\n# kv æ°æ®åºèµæ\n\n# redis èµæ\n\n * å®ç½\n   * redis å®ç½\n   * redis github\n   * redis å®æ¹ææ¡£ä¸­æç\n   * redis å½ä»¤åè\n * ä¹¦ç±\n   * ãredis å®æã\n   * ãredis è®¾è®¡ä¸å®ç°ã\n * æºç \n   * ãredis å®æãéå¥ python æºç \n * èµæºæ±æ»\n   * awesome-redis\n * redis client\n   * spring-data-redis å®æ¹ææ¡£\n   * redisson å®æ¹ææ¡£(ä¸­æ,ç¥ææ»å)\n   * redisson å®æ¹ææ¡£(è±æ)\n   * crug | redisson pro vs. jedis: which is faster? ç¿»è¯\n   * redis åå¸é redisson æ§è½æµè¯\n * æç« \n   * learn redis the hard way (in production) at trivago\n   * twitter: how twitter uses redis to scale - 105tb ram, 39mm qps, 10,000+ instances\n   * slack: scaling slackâs job queue - robustly handling billions of tasks in milliseconds using kafka and redis\n   * github: moving persistent data out of redis at github\n   * instagram: storing hundreds of millions of simple key-value pairs in redis\n   * redis in chat architecture of twitch (from 27:22)\n   * deliveroo: optimizing session key storage in redis\n   * deliveroo: optimizing redis storage\n   * github: awesome redis\n\n\n# ææ¡£æ°æ®åºèµæ\n\n * couchbase ecosystem at linkedin\n * simpledb at zendesk\n * data points - what the heck are document databases?\n\n# mongodb èµæ\n\n * å®æ¹\n   * mongodb å®ç½\n   * mongodb github\n   * mongodb å®æ¹åè´¹æç¨\n * æç¨\n   * mongodb æç¨\n   * mongodb é«æè¯¾\n * æ°æ®\n   * mongodb-json-files\n * æç« \n   * introduction to mongodb\n   * ebay: building mission-critical multi-data center applications with mongodb\n   * the aws and mongodb infrastructure of parse: lessons learned\n   * migrating mountains of mongo data\n * æ´å¤èµæº\n   * github: awesome mongodb\n\n\n# æç´¢å¼ææ°æ®åºèµæ\n\n# elasticsearch\n\n * å®æ¹\n   * elasticsearch å®ç½\n   * elasticsearch github\n   * elasticsearch å®æ¹ææ¡£\n   * elasticsearch: the definitive guide - elasticsearch å®æ¹å­¦ä¹ èµæ\n * ä¹¦ç±\n   * ãelasticsearch å®æã\n * æç¨\n   * elk stack æå¨æå\n   * elasticsearch æç¨\n * æç« \n   * elasticsearch+logstash+kibana æç¨\n   * elkï¼elasticsearchãlogstashãkibanaï¼å®è£åéç½®\n   * æ§è½è°ä¼ç¸å³çå·¥ç¨å®è·µ\n     * elasticsearch performance tuning practice at ebay\n     * elasticsearch at kickstarter\n     * 9 tips on elasticsearch configuration for high performance\n     * elasticsearch in productionâ-âdeployment best practices\n * æ´å¤èµæº\n   * github: awesome elasticsearch\n\n\n# å¾æ°æ®åº\n\n * é¦åæ¯ ibm devloperworks ä¸çä¸¤ä¸ªç®ä»æ§ç pptã\n   * intro to graph databases, part 1, graph databases and the crud operations\n   * intro to graph databases, part 2, building a recommendation engine with a graph database\n * ç¶åæ¯ä¸æ¬åè´¹ççµå­ä¹¦ãgraph databaseãã\n * æ¥ä¸æ¥æ¯ä¸äºå¾æ°æ®åºçä»ç»æç« ã\n   * handling billions of edges in a graph database\n   * neo4j case studies with walmart, ebay, airbnb, nasa, etc\n   * flockdb: distributed graph database for storing adjacency lists at twitter\n   * janusgraph: scalable graph database backed by google, ibm and hortonworks\n   * amazon neptune\n\n\n# æ¶åºæ°æ®åº\n\n * what is time-series data & why we need a time-series database\n * time series data: why and how to use a relational database instead of nosql\n * beringei: high-performance time series storage engine @facebook\n * introducing atlas: netflixâs primary telemetry platform @netflix\n * building a scalable time series database on postgresql\n * scaling time series data storage - part i @netflix\n * design of a cost efficient time series store for big data\n * github: awesome time-series database\n\n\n# ä¼ é ðª\n\nâ¾ ð§ éæç it ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Logstash è¿ç»´",frontmatter:{title:"Logstash è¿ç»´",date:"2020-06-16T07:10:44.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic","Logstash"],permalink:"/pages/92df30/"},regularPath:"/12.%E6%95%B0%E6%8D%AE%E5%BA%93/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/02.Elastic/07.Logstash%E8%BF%90%E7%BB%B4.html",relativePath:"12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/02.Elastic/07.Logstashè¿ç»´.md",key:"v-2afcea96",path:"/pages/92df30/",headers:[{level:2,title:"1. å®è£",slug:"_1-å®è£",normalizedTitle:"1. å®è£",charIndex:85},{level:3,title:"1.1. å®è£æ­¥éª¤",slug:"_1-1-å®è£æ­¥éª¤",normalizedTitle:"1.1. å®è£æ­¥éª¤",charIndex:95},{level:2,title:"2. éç½®",slug:"_2-éç½®",normalizedTitle:"2. éç½®",charIndex:404},{level:3,title:"2.1. è®¾ç½®æä»¶",slug:"_2-1-è®¾ç½®æä»¶",normalizedTitle:"2.1. è®¾ç½®æä»¶",charIndex:414},{level:3,title:"2.2. logstash.yml è®¾ç½®é¡¹",slug:"_2-2-logstash-yml-è®¾ç½®é¡¹",normalizedTitle:"2.2. logstash.yml è®¾ç½®é¡¹",charIndex:665},{level:2,title:"3. å¯å¨",slug:"_3-å¯å¨",normalizedTitle:"3. å¯å¨",charIndex:3988},{level:3,title:"3.1. å½ä»¤è¡",slug:"_3-1-å½ä»¤è¡",normalizedTitle:"3.1. å½ä»¤è¡",charIndex:3998},{level:3,title:"3.2. éç½®æä»¶",slug:"_3-2-éç½®æä»¶",normalizedTitle:"3.2. éç½®æä»¶",charIndex:4414},{level:4,title:"3.2.1. éç½®æä»¶ç»æ",slug:"_3-2-1-éç½®æä»¶ç»æ",normalizedTitle:"3.2.1. éç½®æä»¶ç»æ",charIndex:4547},{level:4,title:"3.2.2. æä»¶éç½®",slug:"_3-2-2-æä»¶éç½®",normalizedTitle:"3.2.2. æä»¶éç½®",charIndex:4739},{level:4,title:"3.2.3. å¼ç±»å",slug:"_3-2-3-å¼ç±»å",normalizedTitle:"3.2.3. å¼ç±»å",charIndex:5041},{level:2,title:"4. æä»¶",slug:"_4-æä»¶",normalizedTitle:"4. æä»¶",charIndex:5784},{level:3,title:"4.1. input",slug:"_4-1-input",normalizedTitle:"4.1. input",charIndex:5794},{level:4,title:"4.1.1. å¸¸ç¨ input æä»¶",slug:"_4-1-1-å¸¸ç¨-input-æä»¶",normalizedTitle:"4.1.1. å¸¸ç¨ input æä»¶",charIndex:5902},{level:3,title:"4.2. filter",slug:"_4-2-filter",normalizedTitle:"4.2. filter",charIndex:6199},{level:4,title:"4.2.1. å¸¸ç¨ filter æä»¶",slug:"_4-2-1-å¸¸ç¨-filter-æä»¶",normalizedTitle:"4.2.1. å¸¸ç¨ filter æä»¶",charIndex:6275},{level:3,title:"4.3. output",slug:"_4-3-output",normalizedTitle:"4.3. output",charIndex:6563},{level:4,title:"4.3.1. å¸¸ç¨ output æä»¶",slug:"_4-3-1-å¸¸ç¨-output-æä»¶",normalizedTitle:"4.3.1. å¸¸ç¨ output æä»¶",charIndex:6638},{level:3,title:"4.4. codec",slug:"_4-4-codec",normalizedTitle:"4.4. codec",charIndex:6946},{level:4,title:"4.4.1. å¸¸ç¨ codec æä»¶",slug:"_4-4-1-å¸¸ç¨-codec-æä»¶",normalizedTitle:"4.4.1. å¸¸ç¨ codec æä»¶",charIndex:6973},{level:2,title:"5. å®æ",slug:"_5-å®æ",normalizedTitle:"5. å®æ",charIndex:7103},{level:3,title:"5.1. ä¼ è¾æ§å¶å°æ°æ®",slug:"_5-1-ä¼ è¾æ§å¶å°æ°æ®",normalizedTitle:"5.1. ä¼ è¾æ§å¶å°æ°æ®",charIndex:7161},{level:3,title:"5.2. ä¼ è¾ logback æ¥å¿",slug:"_5-2-ä¼ è¾-logback-æ¥å¿",normalizedTitle:"5.2. ä¼ è¾ logback æ¥å¿",charIndex:7546},{level:4,title:"5.2.1. TCP åºç¨",slug:"_5-2-1-tcp-åºç¨",normalizedTitle:"5.2.1. tcp åºç¨",charIndex:7858},{level:4,title:"5.2.2. UDP åºç¨",slug:"_5-2-2-udp-åºç¨",normalizedTitle:"5.2.2. udp åºç¨",charIndex:9613},{level:3,title:"5.3. ä¼ è¾æä»¶",slug:"_5-3-ä¼ è¾æä»¶",normalizedTitle:"5.3. ä¼ è¾æä»¶",charIndex:10450},{level:2,title:"6. å°æå·§",slug:"_6-å°æå·§",normalizedTitle:"6. å°æå·§",charIndex:11157},{level:3,title:"6.1. å¯å¨ãç»æ­¢åºç¨",slug:"_6-1-å¯å¨ãç»æ­¢åºç¨",normalizedTitle:"6.1. å¯å¨ãç»æ­¢åºç¨",charIndex:11168},{level:2,title:"7. åèèµæ",slug:"_7-åèèµæ",normalizedTitle:"7. åèèµæ",charIndex:11626}],headersStr:"1. å®è£ 1.1. å®è£æ­¥éª¤ 2. éç½® 2.1. è®¾ç½®æä»¶ 2.2. logstash.yml è®¾ç½®é¡¹ 3. å¯å¨ 3.1. å½ä»¤è¡ 3.2. éç½®æä»¶ 3.2.1. éç½®æä»¶ç»æ 3.2.2. æä»¶éç½® 3.2.3. å¼ç±»å 4. æä»¶ 4.1. input 4.1.1. å¸¸ç¨ input æä»¶ 4.2. filter 4.2.1. å¸¸ç¨ filter æä»¶ 4.3. output 4.3.1. å¸¸ç¨ output æä»¶ 4.4. codec 4.4.1. å¸¸ç¨ codec æä»¶ 5. å®æ 5.1. ä¼ è¾æ§å¶å°æ°æ® 5.2. ä¼ è¾ logback æ¥å¿ 5.2.1. TCP åºç¨ 5.2.2. UDP åºç¨ 5.3. ä¼ è¾æä»¶ 6. å°æå·§ 6.1. å¯å¨ãç»æ­¢åºç¨ 7. åèèµæ",content:'# Logstash è¿ç»´\n\n> Logstash æ¯å¼æºçæå¡å¨ç«¯æ°æ®å¤çç®¡éï¼è½å¤åæ¶ä»å¤ä¸ªæ¥æºééæ°æ®ï¼è½¬æ¢æ°æ®ï¼ç¶åå°æ°æ®åéå°æ¨æåæ¬¢çâå­å¨åºâä¸­ã\n\n\n# 1. å®è£\n\n\n# 1.1. å®è£æ­¥éª¤\n\nå®è£æ­¥éª¤å¦ä¸ï¼\n\nï¼1ï¼å¨ logstash å®æ¹ä¸è½½å°åä¸è½½æéçæ¬åå¹¶è§£åå°æ¬å°ã\n\nï¼2ï¼æ·»å ä¸ä¸ª logstash.conf æä»¶ï¼æå®è¦ä½¿ç¨çæä»¶ä»¥åæ¯ä¸ªæä»¶çè®¾ç½®ãä¸¾ä¸ªç®åçä¾å­ï¼\n\ninput { stdin { } }\noutput {\n  elasticsearch { hosts => ["localhost:9200"] }\n  stdout { codec => rubydebug }\n}\n\n\nï¼3ï¼è¿è¡ bin/logstash -f logstash.conf ï¼Windows ä¸è¿è¡bin/logstash.bat -f logstash.confï¼\n\n\n# 2. éç½®\n\n\n# 2.1. è®¾ç½®æä»¶\n\n * logstash.ymlï¼logstash çé»è®¤å¯å¨éç½®æä»¶\n * jvm.optionsï¼logstash ç JVM éç½®æä»¶ã\n * startup.options (Linux)ï¼åå«ç³»ç»å®è£èæ¬å¨ /usr/share/logstash/bin ä¸­ä½¿ç¨çéé¡¹ä¸ºæ¨çç³»ç»æå»ºéå½çå¯å¨èæ¬ãå®è£ Logstash è½¯ä»¶åæ¶ï¼ç³»ç»å®è£èæ¬å°å¨å®è£è¿ç¨ç»ææ¶æ§è¡ï¼å¹¶ä½¿ç¨ startup.options ä¸­æå®çè®¾ç½®æ¥è®¾ç½®ç¨æ·ï¼ç»ï¼æå¡åç§°åæå¡æè¿°ç­éé¡¹ã\n\n\n# 2.2. logstash.yml è®¾ç½®é¡¹\n\nèéé¨åè®¾ç½®é¡¹ï¼æ´å¤é¡¹è¯·åèï¼https://www.elastic.co/guide/en/logstash/current/logstash-settings-file.html\n\nåæ°                         æè¿°                                                                                           é»è®¤å¼\nnode.name                  èç¹å                                                                                          æºå¨çä¸»æºå\npath.data                  Logstash åå¶æä»¶ç¨äºä»»ä½æä¹æ§éæ±çç®å½ã                                                                   LOGSTASH_HOME/data\npipeline.workers           åæ¶æ§è¡ç®¡éçè¿æ»¤å¨åè¾åºé¶æ®µçå·¥ä½ä»»å¡æ°éãå¦æåç°äºä»¶æ­£å¨å¤ä»½ï¼æ CPU                                                      Number of the hostâs CPU cores\n                           æªé¥±åï¼è¯·èèå¢å æ­¤æ°å­ä»¥æ´å¥½å°å©ç¨æºå¨å¤çè½åã\npipeline.batch.size        å°è¯æ§è¡è¿æ»¤å¨åè¾åºä¹åï¼åä¸ªå·¥ä½çº¿ç¨ä»è¾å¥æ¶éçæå¤§äºä»¶æ°éãè¾å¤§çæ¹éå¤çå¤§å°ä¸è¬æ¥è¯´æçæ´é«ï¼ä½æ¯ä»¥å¢å çåå­å¼éä¸ºä»£ä»·ãæ¨å¯è½å¿é¡»éè¿è®¾ç½®                    125\n                           LS_HEAP_SIZE åéæ¥ææä½¿ç¨è¯¥éé¡¹æ¥å¢å  JVM å å¤§å°ã\npipeline.batch.delay       åå»ºç®¡éäºä»¶æ¹å¤çæ¶ï¼å¨å°ä¸ä¸ªå°ºå¯¸è¿å°çæ¹æ¬¡åéç»ç®¡éå·¥ä½ä»»å¡ä¹åï¼ç­å¾æ¯ä¸ªäºä»¶éè¦å¤é¿æ¶é´ï¼æ¯«ç§ï¼ã                                          5\npipeline.unsafe_shutdown   å¦æè®¾ç½®ä¸º trueï¼åå³ä½¿å¨åå­ä¸­ä»å­å¨ inflight äºä»¶æ¶ï¼ä¹ä¼å¼ºå¶ Logstash                                             false\n                           å¨å³é­æé´éåºãé»è®¤æåµä¸ï¼Logstash\n                           å°æç»éåºï¼ç´å°æææ¥æ¶å°çäºä»¶é½è¢«æ¨éå°è¾åºãå¯ç¨æ­¤éé¡¹å¯è½ä¼å¯¼è´å³æºæé´æ°æ®ä¸¢å¤±ã\npath.config                ä¸»ç®¡éç Logstash éç½®è·¯å¾ãå¦ææ¨æå®ä¸ä¸ªç®å½æééç¬¦ï¼éç½®æä»¶å°æå­æ¯é¡ºåºä»ç®å½ä¸­è¯»åã                                           Platform-specific. See [dir-layout].\nconfig.string              åå«ç¨äºä¸»ç®¡éçç®¡ééç½®çå­ç¬¦ä¸²ãä½¿ç¨ä¸éç½®æä»¶ç¸åçè¯­æ³ã                                                               None\nconfig.test_and_exit       è®¾ç½®ä¸º true æ¶ï¼æ£æ¥éç½®æ¯å¦ææï¼ç¶åéåºãè¯·æ³¨æï¼ä½¿ç¨æ­¤è®¾ç½®ä¸ä¼æ£æ¥ grok æ¨¡å¼çæ­£ç¡®æ§ã Logstash                                 false\n                           å¯ä»¥ä»ç®å½ä¸­è¯»åå¤ä¸ªéç½®æä»¶ãå¦æå°æ­¤è®¾ç½®ä¸ log.levelï¼debug ç»åä½¿ç¨ï¼å Logstash\n                           å°è®°å½ç»åçéç½®æä»¶ï¼å¹¶æ³¨æå¶æºæä»¶çéç½®åã\nconfig.reload.automatic    è®¾ç½®ä¸º true æ¶ï¼å®ææ£æ¥éç½®æ¯å¦å·²æ´æ¹ï¼å¹¶å¨éç½®æ´æ¹æ¶éæ°å è½½éç½®ãè¿ä¹å¯ä»¥éè¿ SIGHUP ä¿¡å·æå¨è§¦åã                                   false\nconfig.reload.interval     Logstash æ£æ¥éç½®æä»¶æ´æ¹çæ¶é´é´éã                                                                      3s\nconfig.debug               è®¾ç½®ä¸º true                                                                                     false\n                           æ¶ï¼å°å®å¨ç¼è¯çéç½®æ¾ç¤ºä¸ºè°è¯æ¥å¿æ¶æ¯ãæ¨è¿å¿é¡»è®¾ç½®log.levelï¼debugãè­¦åï¼æ¥å¿æ¶æ¯å°åæ¬ä»»ä½ä¼ éç»æä»¶éç½®ä½ä¸ºææçâå¯ç âéé¡¹ï¼å¹¶å¯è½å¯¼è´ææå¯ç åºç°å¨æ¨çæ¥å¿ï¼\nconfig.support_escapes     å½è®¾ç½®ä¸º true æ¶ï¼å¸¦å¼å·çå­ç¬¦ä¸²å°å¤çè½¬ä¹å­ç¬¦ã                                                                  false\nmodules                    éç½®æ¶ï¼æ¨¡åå¿é¡»å¤äºä¸è¡¨æè¿°çåµå¥ YAML ç»æä¸­ã                                                                  None\nhttp.host                  ç»å®å°å                                                                                         "127.0.0.1"\nhttp.port                  ç»å®ç«¯å£                                                                                         9600\nlog.level                  æ¥å¿çº§å«ãææéé¡¹ï¼fatal > error > warn > info > debug > trace                                        info\nlog.format                 æ¥å¿æ ¼å¼ãjson ï¼JSON æ ¼å¼ï¼æ plain ï¼åå¯¹è±¡ï¼                                                             plain\npath.logs                  Logstash èªèº«æ¥å¿çå­å¨è·¯å¾                                                                           LOGSTASH_HOME/logs\npath.plugins               å¨åªéå¯ä»¥æ¾å°èªå®ä¹çæä»¶ãæ¨å¯ä»¥å¤æ¬¡æå®æ­¤è®¾ç½®ä»¥åå«å¤ä¸ªè·¯å¾ã                                                             \n\n\n# 3. å¯å¨\n\n\n# 3.1. å½ä»¤è¡\n\néè¿å½ä»¤è¡å¯å¨ logstash çæ¹å¼å¦ä¸ï¼\n\nbin/logstash [options]\n\n\nå¶ä¸­ options æ¯æ¨å¯ä»¥æå®ç¨äºæ§å¶ Logstash æ§è¡çå½ä»¤è¡æ å¿ã\n\nå¨å½ä»¤è¡ä¸è®¾ç½®çä»»ä½æ å¿é½ä¼è¦ç Logstash è®¾ç½®æä»¶ï¼logstash.ymlï¼ä¸­çç¸åºè®¾ç½®ï¼ä½è®¾ç½®æä»¶æ¬èº«ä¸ä¼æ´æ¹ã\n\n> æ³¨\n> \n> è½ç¶å¯ä»¥éè¿æå®å½ä»¤è¡åæ°çæ¹å¼ï¼æ¥æ§å¶ logstash çè¿è¡æ¹å¼ï¼ä½æ¾ç¶è¿ä¹åå¾éº»ç¦ã\n> \n> å»ºè®®éè¿æå®éç½®æä»¶çæ¹å¼ï¼æ¥æ§å¶ logstash è¿è¡ï¼å¯å¨å½ä»¤å¦ä¸ï¼\n> \n> bin/logstash -f logstash.conf\n> \n> \n> è¥æ³äºè§£æ´å¤çå½ä»¤è¡åæ°ç»èï¼è¯·åèï¼https://www.elastic.co/guide/en/logstash/current/running-logstash-command-line.html\n\n\n# 3.2. éç½®æä»¶\n\nä¸èï¼æä»¬äºè§£å°ï¼logstash å¯ä»¥æ§è¡ bin/logstash -f logstash.conf ï¼æç§éç½®æä»¶ä¸­çåæ°å»è¦çé»è®¤è®¾ç½®æä»¶ï¼logstash.ymlï¼ä¸­çè®¾ç½®ã\n\nè¿èï¼æä»¬å°±æ¥å­¦ä¹ ä¸ä¸è¿ä¸ªéç½®æä»¶å¦ä½éç½®åæ°ã\n\n# 3.2.1. éç½®æä»¶ç»æ\n\nå¨å·¥ä½åçä¸èä¸­ï¼æä»¬å·²ç»ç¥éäº Logstash ä¸»è¦æä¸ä¸ªå·¥ä½é¶æ®µ input ãfilterãoutputãè logstash éç½®æä»¶æä»¶ç»æä¹ä¸ä¹ç¸å¯¹åºï¼\n\ninput {}\n\nfilter {}\n\noutput {}\n\n\n> æ¯ä¸ªé¨åé½åå«ä¸ä¸ªæå¤ä¸ªæä»¶çéç½®éé¡¹ãå¦ææå®äºå¤ä¸ªè¿æ»¤å¨ï¼åä¼æç§å®ä»¬å¨éç½®æä»¶ä¸­çæ¾ç¤ºé¡ºåºåºç¨å®ä»¬ã\n\n# 3.2.2. æä»¶éç½®\n\næä»¶çéç½®ç±æä»¶åç§°åæä»¶çä¸ä¸ªè®¾ç½®åç»æã\n\nä¸é¢çä¾å­ä¸­éç½®äºä¸¤ä¸ªè¾å¥æä»¶éç½®ï¼\n\ninput {\n  file {\n    path => "/var/log/messages"\n    type => "syslog"\n  }\n\n  file {\n    path => "/var/log/apache/access.log"\n    type => "apache"\n  }\n}\n\n\næ¨å¯ä»¥éç½®çè®¾ç½®å æä»¶ç±»åèå¼ãä½ å¯ä»¥åèï¼ Input Plugins, Output Plugins, Filter Plugins, å Codec Plugins ã\n\n# 3.2.3. å¼ç±»å\n\nä¸ä¸ªæä»¶å¯ä»¥è¦æ±è®¾ç½®çå¼æ¯ä¸ä¸ªç¹å®çç±»åï¼æ¯å¦å¸å°å¼ï¼åè¡¨æåå¸å¼ãä»¥ä¸å¼ç±»ååæ¯æã\n\n * Array\n\n  users => [ {id => 1, name => bob}, {id => 2, name => jane} ]\n\n\n * Lists\n\n  path => [ "/var/log/messages", "/var/log/*.log" ]\n  uris => [ "http://elastic.co", "http://example.net" ]\n\n\n * Boolean\n\n  ssl_enable => true\n\n\n * Bytes\n\n  my_bytes => "1113"   # 1113 bytes\n  my_bytes => "10MiB"  # 10485760 bytes\n  my_bytes => "100kib" # 102400 bytes\n  my_bytes => "180 mb" # 180000000 bytes\n\n\n * Codec\n\n  codec => "json"\n\n\n * Hash\n\nmatch => {\n  "field1" => "value1"\n  "field2" => "value2"\n  ...\n}\n\n\n * Number\n\n  port => 33\n\n\n * Password\n\n  my_password => "password"\n\n\n * URI\n\n  my_uri => "http://foo:bar@example.net"\n\n\n * Path\n\n  my_path => "/tmp/logstash"\n\n\n * String\n\n * è½¬ä¹å­ç¬¦\n\n\n# 4. æä»¶\n\n\n# 4.1. input\n\n> Logstash æ¯æåç§è¾å¥éæ© ï¼å¯ä»¥å¨åä¸æ¶é´ä»ä¼å¤å¸¸ç¨æ¥æºææäºä»¶ãè½å¤ä»¥è¿ç»­çæµå¼ä¼ è¾æ¹å¼ï¼è½»æ¾å°ä»æ¨çæ¥å¿ãææ ãWeb åºç¨ãæ°æ®å­å¨ä»¥ååç§ AWS æå¡ééæ°æ®ã\n\n# 4.1.1. å¸¸ç¨ input æä»¶\n\n * fileï¼ä»æä»¶ç³»ç»ä¸çæä»¶è¯»åï¼å°±å UNIX å½ä»¤ tail -0F ä¸æ ·\n * **syslogï¼**å¨ä¼æå¨ç¥çç«¯å£ 514 ä¸ä¾¦å¬ç³»ç»æ¥å¿æ¶æ¯ï¼å¹¶æ ¹æ® RFC3164 æ ¼å¼è¿è¡è§£æ\n * **redisï¼**ä» redis æå¡å¨è¯»åï¼ä½¿ç¨ redis ééå redis åè¡¨ã Redis ç»å¸¸ç¨ä½éä¸­å¼ Logstash å®è£ä¸­çâä»£çâï¼å®å°æ¥èªè¿ç¨ Logstashâæè¿äººâç Logstash äºä»¶æéã\n * **beatsï¼**å¤çç± Filebeat åéçäºä»¶ã\n\næ´å¤è¯¦æè¯·è§ï¼Input Plugins\n\n\n# 4.2. filter\n\n> è¿æ»¤å¨æ¯ Logstash ç®¡éä¸­çä¸­é´å¤çè®¾å¤ãå¦æç¬¦åç¹å®æ¡ä»¶ï¼æ¨å¯ä»¥å°æ¡ä»¶è¿æ»¤å¨ç»åå¨ä¸èµ·ï¼å¯¹äºä»¶æ§è¡æä½ã\n\n# 4.2.1. å¸¸ç¨ filter æä»¶\n\n * **grokï¼**è§£æåç»æä»»æææ¬ã Grok ç®åæ¯ Logstash ä¸­å°éç»æåæ¥å¿æ°æ®è§£æä¸ºç»æååå¯æ¥è¯¢çæä½³æ¹æ³ã\n\n * **mutateï¼**å¯¹äºä»¶å­æ®µæ§è¡ä¸è¬è½¬æ¢ãæ¨å¯ä»¥éå½åï¼å é¤ï¼æ¿æ¢åä¿®æ¹äºä»¶ä¸­çå­æ®µã\n\n * **dropï¼**å®å¨æ¾å¼ä¸ä¸ªäºä»¶ï¼ä¾å¦è°è¯äºä»¶ã\n\n * **cloneï¼**å¶ä½ä¸ä¸ªäºä»¶çå¯æ¬ï¼å¯è½ä¼æ·»å æå é¤å­æ®µã\n\n * **geoipï¼**æ·»å æå³ IP å°åçå°çä½ç½®çä¿¡æ¯ï¼ä¹å¯ä»¥å¨ Kibana ä¸­æ¾ç¤ºæäººçå¾è¡¨ï¼ï¼\n\næ´å¤è¯¦æè¯·è§ï¼Filter Plugins\n\n\n# 4.3. output\n\n> è¾åºæ¯ Logstash ç®¡éçæåé¶æ®µãä¸ä¸ªäºä»¶å¯ä»¥éè¿å¤ä¸ªè¾åºï¼ä½æ¯ä¸æ¦ææè¾åºå¤çå®æï¼äºä»¶å°±å®æäºæ§è¡ã\n\n# 4.3.1. å¸¸ç¨ output æä»¶\n\n * **elasticsearchï¼**å°äºä»¶æ°æ®åéç» Elasticsearchï¼æ¨èæ¨¡å¼ï¼ã\n * **fileï¼**å°äºä»¶æ°æ®åå¥æä»¶æç£çã\n * **graphiteï¼**å°äºä»¶æ°æ®åéç» graphiteï¼ä¸ä¸ªæµè¡çå¼æºå·¥å·ï¼å­å¨åç»å¶ææ ã http://graphite.readthedocs.io/en/latest/ï¼ã\n * **statsdï¼**å°äºä»¶æ°æ®åéå° statsd ï¼è¿æ¯ä¸ç§ä¾¦å¬ç»è®¡æ°æ®çæå¡ï¼å¦è®¡æ°å¨åå®æ¶å¨ï¼éè¿ UDP åéå¹¶å°èååéå°ä¸ä¸ªæå¤ä¸ªå¯æå¥çåç«¯æå¡ï¼ã\n\næ´å¤è¯¦æè¯·è§ï¼Output Plugins\n\n\n# 4.4. codec\n\nç¨äºæ ¼å¼åå¯¹åºçåå®¹ã\n\n# 4.4.1. å¸¸ç¨ codec æä»¶\n\n * **jsonï¼**ä»¥ JSON æ ¼å¼å¯¹æ°æ®è¿è¡ç¼ç æè§£ç ã\n * **multilineï¼**å°å¤è¡ææ¬äºä»¶ï¼å¦ java å¼å¸¸åå æ è·è¸ªæ¶æ¯ï¼åå¹¶ä¸ºåä¸ªäºä»¶ã\n\næ´å¤æä»¶è¯·è§ï¼Codec Plugins\n\n\n# 5. å®æ\n\nåé¢çåå®¹é½æ¯å¯¹ Logstash çä»ç»ååçè¯´æãæ¥ä¸æ¥ï¼æä»¬æ¥å®æä¸äºå¸¸è§çåºç¨åºæ¯ã\n\n\n# 5.1. ä¼ è¾æ§å¶å°æ°æ®\n\n> stdin input æä»¶ä»æ åè¾å¥è¯»åäºä»¶ãè¿æ¯æç®åç input æä»¶ï¼ä¸è¬ç¨äºæµè¯åºæ¯ã\n\nåºç¨\n\nï¼1ï¼åå»º logstash-input-stdin.conf ï¼\n\ninput { stdin { } }\noutput {\n  elasticsearch { hosts => ["localhost:9200"] }\n  stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-stdin.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼\n\nbin/logstash -f logstash-input-stdin.conf\n\n\n\n# 5.2. ä¼ è¾ logback æ¥å¿\n\n> elk é»è®¤ä½¿ç¨ç Java æ¥å¿å·¥å·æ¯ log4j2 ï¼å¹¶ä¸æ¯æ logback å log4jã\n> \n> æ³ä½¿ç¨ logback + logstash ï¼å¯ä»¥ä½¿ç¨ logstash-logback-encoder ãlogstash-logback-encoder æä¾äº UDP / TCP / å¼æ­¥æ¹å¼æ¥ä¼ è¾æ¥å¿æ°æ®å° logstashã\n> \n> å¦æä½ ä½¿ç¨çæ¯ log4j ï¼ä¹ä¸æ¯ä¸å¯ä»¥ç¨è¿ç§æ¹å¼ï¼åªè¦å¼å¥æ¡¥æ¥ jar åå³å¯ãå¦æä½ å¯¹ log4j ãlogback ï¼ææ¯æ¡¥æ¥ jar åä¸å¤ªäºè§£ï¼å¯ä»¥åèæçè¿ç¯åæï¼ç»è¯´ Java ä¸»æµæ¥å¿å·¥å·åº ã\n\n# 5.2.1. TCP åºç¨\n\nlogstash éç½®ï¼\n\nï¼1ï¼åå»º logstash-input-tcp.conf ï¼\n\ninput {\n  # stdin { }\n  tcp {\n    # host:portå°±æ¯ä¸é¢appenderä¸­ç destinationï¼\n # è¿éå¶å®ælogstashä½ä¸ºæå¡ï¼å¼å¯9250ç«¯å£æ¥æ¶logbackååºçæ¶æ¯\n    host => "127.0.0.1" port => 9250 mode => "server" tags => ["tags"] codec => json_lines\n  }\n}\noutput {\n  elasticsearch { hosts => ["localhost:9200"] }\n  stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-tcp.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-udp.conf\n\njava åºç¨éç½®ï¼\n\nï¼1ï¼å¨ Java åºç¨ç pom.xml ä¸­å¼å¥ jar åï¼\n\n<dependency>\n <groupId>net.logstash.logback</groupId>\n <artifactId>logstash-logback-encoder</artifactId>\n <version>4.11</version>\n</dependency>\n\n\x3c!-- logback ä¾èµå --\x3e\n<dependency>\n <groupId>ch.qos.logback</groupId>\n <artifactId>logback-core</artifactId>\n <version>1.2.3</version>\n</dependency>\n<dependency>\n <groupId>ch.qos.logback</groupId>\n <artifactId>logback-classic</artifactId>\n <version>1.2.3</version>\n</dependency>\n<dependency>\n <groupId>ch.qos.logback</groupId>\n <artifactId>logback-access</artifactId>\n <version>1.2.3</version>\n</dependency>\n\n\nï¼2ï¼æ¥çï¼å¨ logback.xml ä¸­æ·»å  appender\n\n<appender name="ELK-TCP" class="net.logstash.logback.appender.LogstashTcpSocketAppender">\n \x3c!--\n destination æ¯ logstash æå¡ç host:portï¼\n ç¸å½äºå logstash å»ºç«äºç®¡éï¼å°æ¥å¿æ°æ®å®åä¼ è¾å° logstash\n --\x3e\n <destination>192.168.28.32:9251</destination>\n <encoder charset="UTF-8" class="net.logstash.logback.encoder.LogstashEncoder"/>\n</appender>\n<logger name="io.github.dunwu.spring" level="TRACE" additivity="false">\n <appender-ref ref="ELK-TCP" />\n</logger>\n\n\nå¤§ååæï¼æ­¤åï¼io.github.dunwu.spring åä¸­ç TRACE åä»¥ä¸çº§å«çæ¥å¿ä¿¡æ¯é½ä¼è¢«å®åè¾åºå° logstash æå¡ã\n\n\n\næ¥ä¸æ¥ï¼å°±æ¯ logback çå·ä½ä½¿ç¨ ï¼å¦æå¯¹æ­¤ä¸äºè§£ï¼ä¸å¦¨åèä¸ä¸æçè¿ç¯åæï¼ç»è¯´ Java ä¸»æµæ¥å¿å·¥å·åº ã\n\nå®ä¾ï¼æç logback.xml\n\n# 5.2.2. UDP åºç¨\n\nUDP å TCP çä½¿ç¨æ¹å¼å¤§åå°å¼ã\n\nlogstash éç½®ï¼\n\nï¼1ï¼åå»º logstash-input-udp.conf ï¼\n\ninput {\nudp {\n  port => 9250\n  codec => json\n}\n}\noutput {\n elasticsearch { hosts => ["localhost:9200"] }\n stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-udp.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-udp.conf\n\njava åºç¨éç½®ï¼\n\nï¼1ï¼å¨ Java åºç¨ç pom.xml ä¸­å¼å¥ jar åï¼\n\nä¸ TCP åºç¨ ä¸èä¸­çå¼å¥ä¾èµåå®å¨ç¸åã\n\nï¼2ï¼æ¥çï¼å¨ logback.xml ä¸­æ·»å  appender\n\n<appender name="ELK-UDP" class="net.logstash.logback.appender.LogstashSocketAppender">\n  <host>192.168.28.32</host>\n  <port>9250</port>\n</appender>\n<logger name="io.github.dunwu.spring" level="TRACE" additivity="false">\n  <appender-ref ref="ELK-UDP" />\n</logger>\n\n\nï¼3ï¼æ¥ä¸æ¥ï¼å°±æ¯ logback çå·ä½ä½¿ç¨ ï¼å¦æå¯¹æ­¤ä¸äºè§£ï¼ä¸å¦¨åèä¸ä¸æçè¿ç¯åæï¼ç»è¯´ Java ä¸»æµæ¥å¿å·¥å·åº ã\n\nå®ä¾ï¼æç logback.xml\n\n\n# 5.3. ä¼ è¾æä»¶\n\n> å¨ Java Web é¢åï¼éè¦ç¨å°ä¸äºéè¦çå·¥å·ï¼ä¾å¦ Tomcat ãNginx ãMysql ç­ãè¿äºä¸å±äºä¸å¡åºç¨ï¼ä½æ¯å®ä»¬çæ¥å¿æ°æ®å¯¹äºå®ä½é®é¢ãåæç»è®¡åæ ·å¾éè¦ãè¿æ¶æ æ³ä½¿ç¨ logback æ¹å¼å°å®ä»¬çæ¥å¿ä¼ è¾å° logstashã\n> \n> å¦ä½ééè¿äºæ¥å¿æä»¶å¢ï¼å«æ¥ï¼ä½ å¯ä»¥ä½¿ç¨ logstash ç file input æä»¶ã\n> \n> éè¦æ³¨æçæ¯ï¼ä¼ è¾æä»¶è¿ç§æ¹å¼ï¼å¿é¡»å¨æ¥å¿æå¨çæºå¨ä¸é¨ç½² logstash ã\n\nåºç¨\n\nlogstash éç½®\n\nï¼1ï¼åå»º logstash-input-file.conf ï¼\n\ninput {\n file {\n  path => ["/var/log/nginx/access.log"]\n  type => "nginx-access-log"\n  start_position => "beginning"\n }\n}\n\noutput {\n if [type] == "nginx-access-log" {\n  elasticsearch {\n   hosts => ["localhost:9200"]\n   index => "nginx-access-log"\n  }\n }\n}\n\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-file.conf\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-file.html\n\n\n# 6. å°æå·§\n\n\n# 6.1. å¯å¨ãç»æ­¢åºç¨\n\nå¦æä½ ç logstash æ¯æ¬¡é½æ¯éè¿æå®éç½®æä»¶æ¹å¼å¯å¨ãä¸å¦¨å»ºç«ä¸ä¸ªå¯å¨èæ¬ã\n\n# cd xxx è¿å¥ logstash å®è£ç®å½ä¸ç bin ç®å½\nlogstash -f logstash.conf\n\n\nå¦æä½ ç logstash è¿è¡å¨ linux ç³»ç»ä¸ï¼ä¸å¦¨ä½¿ç¨ nohup æ¥å¯å¨ä¸ä¸ªå®æ¤è¿ç¨ãè¿æ ·åçå¥½å¤å¨äºï¼å³ä½¿å³é­ç»ç«¯ï¼åºç¨ä»ä¼è¿è¡ã\n\nåå»º startup.shï¼\n\nnohup ./logstash -f logstash.conf >> nohup.out 2>&1 &\n\n\nç»æ­¢åºç¨æ²¡æä»ä¹å¥½æ¹æ³ï¼ä½ åªè½ä½¿ç¨ ps -ef | grep logstash ï¼æ¥åºè¿ç¨ï¼å°å¶ kill ãä¸è¿ï¼æä»¬å¯ä»¥åä¸ä¸ªèæ¬æ¥å¹²è¿ä»¶äºï¼\n\nåå»º shutdown.shï¼\n\nèæ¬ä¸å¤è§£éï¼è¯·èªè¡é¢ä¼ä½ç¨ã\n\nPID=`ps -ef | grep logstash | awk \'{ print $2}\' | head -n 1`\nkill -9 ${PID}\n\n\n\n# 7. åèèµæ\n\n * Logstash å®ç½\n * Logstash Github\n * Logstash å®æ¹ææ¡£\n * logstash-logback-encoder\n * ELK Stack æå¨æå\n * ELKï¼ElasticsearchãLogstashãKibanaï¼å®è£åéç½®',normalizedContent:'# logstash è¿ç»´\n\n> logstash æ¯å¼æºçæå¡å¨ç«¯æ°æ®å¤çç®¡éï¼è½å¤åæ¶ä»å¤ä¸ªæ¥æºééæ°æ®ï¼è½¬æ¢æ°æ®ï¼ç¶åå°æ°æ®åéå°æ¨æåæ¬¢çâå­å¨åºâä¸­ã\n\n\n# 1. å®è£\n\n\n# 1.1. å®è£æ­¥éª¤\n\nå®è£æ­¥éª¤å¦ä¸ï¼\n\nï¼1ï¼å¨ logstash å®æ¹ä¸è½½å°åä¸è½½æéçæ¬åå¹¶è§£åå°æ¬å°ã\n\nï¼2ï¼æ·»å ä¸ä¸ª logstash.conf æä»¶ï¼æå®è¦ä½¿ç¨çæä»¶ä»¥åæ¯ä¸ªæä»¶çè®¾ç½®ãä¸¾ä¸ªç®åçä¾å­ï¼\n\ninput { stdin { } }\noutput {\n  elasticsearch { hosts => ["localhost:9200"] }\n  stdout { codec => rubydebug }\n}\n\n\nï¼3ï¼è¿è¡ bin/logstash -f logstash.conf ï¼windows ä¸è¿è¡bin/logstash.bat -f logstash.confï¼\n\n\n# 2. éç½®\n\n\n# 2.1. è®¾ç½®æä»¶\n\n * logstash.ymlï¼logstash çé»è®¤å¯å¨éç½®æä»¶\n * jvm.optionsï¼logstash ç jvm éç½®æä»¶ã\n * startup.options (linux)ï¼åå«ç³»ç»å®è£èæ¬å¨ /usr/share/logstash/bin ä¸­ä½¿ç¨çéé¡¹ä¸ºæ¨çç³»ç»æå»ºéå½çå¯å¨èæ¬ãå®è£ logstash è½¯ä»¶åæ¶ï¼ç³»ç»å®è£èæ¬å°å¨å®è£è¿ç¨ç»ææ¶æ§è¡ï¼å¹¶ä½¿ç¨ startup.options ä¸­æå®çè®¾ç½®æ¥è®¾ç½®ç¨æ·ï¼ç»ï¼æå¡åç§°åæå¡æè¿°ç­éé¡¹ã\n\n\n# 2.2. logstash.yml è®¾ç½®é¡¹\n\nèéé¨åè®¾ç½®é¡¹ï¼æ´å¤é¡¹è¯·åèï¼https://www.elastic.co/guide/en/logstash/current/logstash-settings-file.html\n\nåæ°                         æè¿°                                                                                           é»è®¤å¼\nnode.name                  èç¹å                                                                                          æºå¨çä¸»æºå\npath.data                  logstash åå¶æä»¶ç¨äºä»»ä½æä¹æ§éæ±çç®å½ã                                                                   logstash_home/data\npipeline.workers           åæ¶æ§è¡ç®¡éçè¿æ»¤å¨åè¾åºé¶æ®µçå·¥ä½ä»»å¡æ°éãå¦æåç°äºä»¶æ­£å¨å¤ä»½ï¼æ cpu                                                      number of the hostâs cpu cores\n                           æªé¥±åï¼è¯·èèå¢å æ­¤æ°å­ä»¥æ´å¥½å°å©ç¨æºå¨å¤çè½åã\npipeline.batch.size        å°è¯æ§è¡è¿æ»¤å¨åè¾åºä¹åï¼åä¸ªå·¥ä½çº¿ç¨ä»è¾å¥æ¶éçæå¤§äºä»¶æ°éãè¾å¤§çæ¹éå¤çå¤§å°ä¸è¬æ¥è¯´æçæ´é«ï¼ä½æ¯ä»¥å¢å çåå­å¼éä¸ºä»£ä»·ãæ¨å¯è½å¿é¡»éè¿è®¾ç½®                    125\n                           ls_heap_size åéæ¥ææä½¿ç¨è¯¥éé¡¹æ¥å¢å  jvm å å¤§å°ã\npipeline.batch.delay       åå»ºç®¡éäºä»¶æ¹å¤çæ¶ï¼å¨å°ä¸ä¸ªå°ºå¯¸è¿å°çæ¹æ¬¡åéç»ç®¡éå·¥ä½ä»»å¡ä¹åï¼ç­å¾æ¯ä¸ªäºä»¶éè¦å¤é¿æ¶é´ï¼æ¯«ç§ï¼ã                                          5\npipeline.unsafe_shutdown   å¦æè®¾ç½®ä¸º trueï¼åå³ä½¿å¨åå­ä¸­ä»å­å¨ inflight äºä»¶æ¶ï¼ä¹ä¼å¼ºå¶ logstash                                             false\n                           å¨å³é­æé´éåºãé»è®¤æåµä¸ï¼logstash\n                           å°æç»éåºï¼ç´å°æææ¥æ¶å°çäºä»¶é½è¢«æ¨éå°è¾åºãå¯ç¨æ­¤éé¡¹å¯è½ä¼å¯¼è´å³æºæé´æ°æ®ä¸¢å¤±ã\npath.config                ä¸»ç®¡éç logstash éç½®è·¯å¾ãå¦ææ¨æå®ä¸ä¸ªç®å½æééç¬¦ï¼éç½®æä»¶å°æå­æ¯é¡ºåºä»ç®å½ä¸­è¯»åã                                           platform-specific. see [dir-layout].\nconfig.string              åå«ç¨äºä¸»ç®¡éçç®¡ééç½®çå­ç¬¦ä¸²ãä½¿ç¨ä¸éç½®æä»¶ç¸åçè¯­æ³ã                                                               none\nconfig.test_and_exit       è®¾ç½®ä¸º true æ¶ï¼æ£æ¥éç½®æ¯å¦ææï¼ç¶åéåºãè¯·æ³¨æï¼ä½¿ç¨æ­¤è®¾ç½®ä¸ä¼æ£æ¥ grok æ¨¡å¼çæ­£ç¡®æ§ã logstash                                 false\n                           å¯ä»¥ä»ç®å½ä¸­è¯»åå¤ä¸ªéç½®æä»¶ãå¦æå°æ­¤è®¾ç½®ä¸ log.levelï¼debug ç»åä½¿ç¨ï¼å logstash\n                           å°è®°å½ç»åçéç½®æä»¶ï¼å¹¶æ³¨æå¶æºæä»¶çéç½®åã\nconfig.reload.automatic    è®¾ç½®ä¸º true æ¶ï¼å®ææ£æ¥éç½®æ¯å¦å·²æ´æ¹ï¼å¹¶å¨éç½®æ´æ¹æ¶éæ°å è½½éç½®ãè¿ä¹å¯ä»¥éè¿ sighup ä¿¡å·æå¨è§¦åã                                   false\nconfig.reload.interval     logstash æ£æ¥éç½®æä»¶æ´æ¹çæ¶é´é´éã                                                                      3s\nconfig.debug               è®¾ç½®ä¸º true                                                                                     false\n                           æ¶ï¼å°å®å¨ç¼è¯çéç½®æ¾ç¤ºä¸ºè°è¯æ¥å¿æ¶æ¯ãæ¨è¿å¿é¡»è®¾ç½®log.levelï¼debugãè­¦åï¼æ¥å¿æ¶æ¯å°åæ¬ä»»ä½ä¼ éç»æä»¶éç½®ä½ä¸ºææçâå¯ç âéé¡¹ï¼å¹¶å¯è½å¯¼è´ææå¯ç åºç°å¨æ¨çæ¥å¿ï¼\nconfig.support_escapes     å½è®¾ç½®ä¸º true æ¶ï¼å¸¦å¼å·çå­ç¬¦ä¸²å°å¤çè½¬ä¹å­ç¬¦ã                                                                  false\nmodules                    éç½®æ¶ï¼æ¨¡åå¿é¡»å¤äºä¸è¡¨æè¿°çåµå¥ yaml ç»æä¸­ã                                                                  none\nhttp.host                  ç»å®å°å                                                                                         "127.0.0.1"\nhttp.port                  ç»å®ç«¯å£                                                                                         9600\nlog.level                  æ¥å¿çº§å«ãææéé¡¹ï¼fatal > error > warn > info > debug > trace                                        info\nlog.format                 æ¥å¿æ ¼å¼ãjson ï¼json æ ¼å¼ï¼æ plain ï¼åå¯¹è±¡ï¼                                                             plain\npath.logs                  logstash èªèº«æ¥å¿çå­å¨è·¯å¾                                                                           logstash_home/logs\npath.plugins               å¨åªéå¯ä»¥æ¾å°èªå®ä¹çæä»¶ãæ¨å¯ä»¥å¤æ¬¡æå®æ­¤è®¾ç½®ä»¥åå«å¤ä¸ªè·¯å¾ã                                                             \n\n\n# 3. å¯å¨\n\n\n# 3.1. å½ä»¤è¡\n\néè¿å½ä»¤è¡å¯å¨ logstash çæ¹å¼å¦ä¸ï¼\n\nbin/logstash [options]\n\n\nå¶ä¸­ options æ¯æ¨å¯ä»¥æå®ç¨äºæ§å¶ logstash æ§è¡çå½ä»¤è¡æ å¿ã\n\nå¨å½ä»¤è¡ä¸è®¾ç½®çä»»ä½æ å¿é½ä¼è¦ç logstash è®¾ç½®æä»¶ï¼logstash.ymlï¼ä¸­çç¸åºè®¾ç½®ï¼ä½è®¾ç½®æä»¶æ¬èº«ä¸ä¼æ´æ¹ã\n\n> æ³¨\n> \n> è½ç¶å¯ä»¥éè¿æå®å½ä»¤è¡åæ°çæ¹å¼ï¼æ¥æ§å¶ logstash çè¿è¡æ¹å¼ï¼ä½æ¾ç¶è¿ä¹åå¾éº»ç¦ã\n> \n> å»ºè®®éè¿æå®éç½®æä»¶çæ¹å¼ï¼æ¥æ§å¶ logstash è¿è¡ï¼å¯å¨å½ä»¤å¦ä¸ï¼\n> \n> bin/logstash -f logstash.conf\n> \n> \n> è¥æ³äºè§£æ´å¤çå½ä»¤è¡åæ°ç»èï¼è¯·åèï¼https://www.elastic.co/guide/en/logstash/current/running-logstash-command-line.html\n\n\n# 3.2. éç½®æä»¶\n\nä¸èï¼æä»¬äºè§£å°ï¼logstash å¯ä»¥æ§è¡ bin/logstash -f logstash.conf ï¼æç§éç½®æä»¶ä¸­çåæ°å»è¦çé»è®¤è®¾ç½®æä»¶ï¼logstash.ymlï¼ä¸­çè®¾ç½®ã\n\nè¿èï¼æä»¬å°±æ¥å­¦ä¹ ä¸ä¸è¿ä¸ªéç½®æä»¶å¦ä½éç½®åæ°ã\n\n# 3.2.1. éç½®æä»¶ç»æ\n\nå¨å·¥ä½åçä¸èä¸­ï¼æä»¬å·²ç»ç¥éäº logstash ä¸»è¦æä¸ä¸ªå·¥ä½é¶æ®µ input ãfilterãoutputãè logstash éç½®æä»¶æä»¶ç»æä¹ä¸ä¹ç¸å¯¹åºï¼\n\ninput {}\n\nfilter {}\n\noutput {}\n\n\n> æ¯ä¸ªé¨åé½åå«ä¸ä¸ªæå¤ä¸ªæä»¶çéç½®éé¡¹ãå¦ææå®äºå¤ä¸ªè¿æ»¤å¨ï¼åä¼æç§å®ä»¬å¨éç½®æä»¶ä¸­çæ¾ç¤ºé¡ºåºåºç¨å®ä»¬ã\n\n# 3.2.2. æä»¶éç½®\n\næä»¶çéç½®ç±æä»¶åç§°åæä»¶çä¸ä¸ªè®¾ç½®åç»æã\n\nä¸é¢çä¾å­ä¸­éç½®äºä¸¤ä¸ªè¾å¥æä»¶éç½®ï¼\n\ninput {\n  file {\n    path => "/var/log/messages"\n    type => "syslog"\n  }\n\n  file {\n    path => "/var/log/apache/access.log"\n    type => "apache"\n  }\n}\n\n\næ¨å¯ä»¥éç½®çè®¾ç½®å æä»¶ç±»åèå¼ãä½ å¯ä»¥åèï¼ input plugins, output plugins, filter plugins, å codec plugins ã\n\n# 3.2.3. å¼ç±»å\n\nä¸ä¸ªæä»¶å¯ä»¥è¦æ±è®¾ç½®çå¼æ¯ä¸ä¸ªç¹å®çç±»åï¼æ¯å¦å¸å°å¼ï¼åè¡¨æåå¸å¼ãä»¥ä¸å¼ç±»ååæ¯æã\n\n * array\n\n  users => [ {id => 1, name => bob}, {id => 2, name => jane} ]\n\n\n * lists\n\n  path => [ "/var/log/messages", "/var/log/*.log" ]\n  uris => [ "http://elastic.co", "http://example.net" ]\n\n\n * boolean\n\n  ssl_enable => true\n\n\n * bytes\n\n  my_bytes => "1113"   # 1113 bytes\n  my_bytes => "10mib"  # 10485760 bytes\n  my_bytes => "100kib" # 102400 bytes\n  my_bytes => "180 mb" # 180000000 bytes\n\n\n * codec\n\n  codec => "json"\n\n\n * hash\n\nmatch => {\n  "field1" => "value1"\n  "field2" => "value2"\n  ...\n}\n\n\n * number\n\n  port => 33\n\n\n * password\n\n  my_password => "password"\n\n\n * uri\n\n  my_uri => "http://foo:bar@example.net"\n\n\n * path\n\n  my_path => "/tmp/logstash"\n\n\n * string\n\n * è½¬ä¹å­ç¬¦\n\n\n# 4. æä»¶\n\n\n# 4.1. input\n\n> logstash æ¯æåç§è¾å¥éæ© ï¼å¯ä»¥å¨åä¸æ¶é´ä»ä¼å¤å¸¸ç¨æ¥æºææäºä»¶ãè½å¤ä»¥è¿ç»­çæµå¼ä¼ è¾æ¹å¼ï¼è½»æ¾å°ä»æ¨çæ¥å¿ãææ ãweb åºç¨ãæ°æ®å­å¨ä»¥ååç§ aws æå¡ééæ°æ®ã\n\n# 4.1.1. å¸¸ç¨ input æä»¶\n\n * fileï¼ä»æä»¶ç³»ç»ä¸çæä»¶è¯»åï¼å°±å unix å½ä»¤ tail -0f ä¸æ ·\n * **syslogï¼**å¨ä¼æå¨ç¥çç«¯å£ 514 ä¸ä¾¦å¬ç³»ç»æ¥å¿æ¶æ¯ï¼å¹¶æ ¹æ® rfc3164 æ ¼å¼è¿è¡è§£æ\n * **redisï¼**ä» redis æå¡å¨è¯»åï¼ä½¿ç¨ redis ééå redis åè¡¨ã redis ç»å¸¸ç¨ä½éä¸­å¼ logstash å®è£ä¸­çâä»£çâï¼å®å°æ¥èªè¿ç¨ logstashâæè¿äººâç logstash äºä»¶æéã\n * **beatsï¼**å¤çç± filebeat åéçäºä»¶ã\n\næ´å¤è¯¦æè¯·è§ï¼input plugins\n\n\n# 4.2. filter\n\n> è¿æ»¤å¨æ¯ logstash ç®¡éä¸­çä¸­é´å¤çè®¾å¤ãå¦æç¬¦åç¹å®æ¡ä»¶ï¼æ¨å¯ä»¥å°æ¡ä»¶è¿æ»¤å¨ç»åå¨ä¸èµ·ï¼å¯¹äºä»¶æ§è¡æä½ã\n\n# 4.2.1. å¸¸ç¨ filter æä»¶\n\n * **grokï¼**è§£æåç»æä»»æææ¬ã grok ç®åæ¯ logstash ä¸­å°éç»æåæ¥å¿æ°æ®è§£æä¸ºç»æååå¯æ¥è¯¢çæä½³æ¹æ³ã\n\n * **mutateï¼**å¯¹äºä»¶å­æ®µæ§è¡ä¸è¬è½¬æ¢ãæ¨å¯ä»¥éå½åï¼å é¤ï¼æ¿æ¢åä¿®æ¹äºä»¶ä¸­çå­æ®µã\n\n * **dropï¼**å®å¨æ¾å¼ä¸ä¸ªäºä»¶ï¼ä¾å¦è°è¯äºä»¶ã\n\n * **cloneï¼**å¶ä½ä¸ä¸ªäºä»¶çå¯æ¬ï¼å¯è½ä¼æ·»å æå é¤å­æ®µã\n\n * **geoipï¼**æ·»å æå³ ip å°åçå°çä½ç½®çä¿¡æ¯ï¼ä¹å¯ä»¥å¨ kibana ä¸­æ¾ç¤ºæäººçå¾è¡¨ï¼ï¼\n\næ´å¤è¯¦æè¯·è§ï¼filter plugins\n\n\n# 4.3. output\n\n> è¾åºæ¯ logstash ç®¡éçæåé¶æ®µãä¸ä¸ªäºä»¶å¯ä»¥éè¿å¤ä¸ªè¾åºï¼ä½æ¯ä¸æ¦ææè¾åºå¤çå®æï¼äºä»¶å°±å®æäºæ§è¡ã\n\n# 4.3.1. å¸¸ç¨ output æä»¶\n\n * **elasticsearchï¼**å°äºä»¶æ°æ®åéç» elasticsearchï¼æ¨èæ¨¡å¼ï¼ã\n * **fileï¼**å°äºä»¶æ°æ®åå¥æä»¶æç£çã\n * **graphiteï¼**å°äºä»¶æ°æ®åéç» graphiteï¼ä¸ä¸ªæµè¡çå¼æºå·¥å·ï¼å­å¨åç»å¶ææ ã http://graphite.readthedocs.io/en/latest/ï¼ã\n * **statsdï¼**å°äºä»¶æ°æ®åéå° statsd ï¼è¿æ¯ä¸ç§ä¾¦å¬ç»è®¡æ°æ®çæå¡ï¼å¦è®¡æ°å¨åå®æ¶å¨ï¼éè¿ udp åéå¹¶å°èååéå°ä¸ä¸ªæå¤ä¸ªå¯æå¥çåç«¯æå¡ï¼ã\n\næ´å¤è¯¦æè¯·è§ï¼output plugins\n\n\n# 4.4. codec\n\nç¨äºæ ¼å¼åå¯¹åºçåå®¹ã\n\n# 4.4.1. å¸¸ç¨ codec æä»¶\n\n * **jsonï¼**ä»¥ json æ ¼å¼å¯¹æ°æ®è¿è¡ç¼ç æè§£ç ã\n * **multilineï¼**å°å¤è¡ææ¬äºä»¶ï¼å¦ java å¼å¸¸åå æ è·è¸ªæ¶æ¯ï¼åå¹¶ä¸ºåä¸ªäºä»¶ã\n\næ´å¤æä»¶è¯·è§ï¼codec plugins\n\n\n# 5. å®æ\n\nåé¢çåå®¹é½æ¯å¯¹ logstash çä»ç»ååçè¯´æãæ¥ä¸æ¥ï¼æä»¬æ¥å®æä¸äºå¸¸è§çåºç¨åºæ¯ã\n\n\n# 5.1. ä¼ è¾æ§å¶å°æ°æ®\n\n> stdin input æä»¶ä»æ åè¾å¥è¯»åäºä»¶ãè¿æ¯æç®åç input æä»¶ï¼ä¸è¬ç¨äºæµè¯åºæ¯ã\n\nåºç¨\n\nï¼1ï¼åå»º logstash-input-stdin.conf ï¼\n\ninput { stdin { } }\noutput {\n  elasticsearch { hosts => ["localhost:9200"] }\n  stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-stdin.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼\n\nbin/logstash -f logstash-input-stdin.conf\n\n\n\n# 5.2. ä¼ è¾ logback æ¥å¿\n\n> elk é»è®¤ä½¿ç¨ç java æ¥å¿å·¥å·æ¯ log4j2 ï¼å¹¶ä¸æ¯æ logback å log4jã\n> \n> æ³ä½¿ç¨ logback + logstash ï¼å¯ä»¥ä½¿ç¨ logstash-logback-encoder ãlogstash-logback-encoder æä¾äº udp / tcp / å¼æ­¥æ¹å¼æ¥ä¼ è¾æ¥å¿æ°æ®å° logstashã\n> \n> å¦æä½ ä½¿ç¨çæ¯ log4j ï¼ä¹ä¸æ¯ä¸å¯ä»¥ç¨è¿ç§æ¹å¼ï¼åªè¦å¼å¥æ¡¥æ¥ jar åå³å¯ãå¦æä½ å¯¹ log4j ãlogback ï¼ææ¯æ¡¥æ¥ jar åä¸å¤ªäºè§£ï¼å¯ä»¥åèæçè¿ç¯åæï¼ç»è¯´ java ä¸»æµæ¥å¿å·¥å·åº ã\n\n# 5.2.1. tcp åºç¨\n\nlogstash éç½®ï¼\n\nï¼1ï¼åå»º logstash-input-tcp.conf ï¼\n\ninput {\n  # stdin { }\n  tcp {\n    # host:portå°±æ¯ä¸é¢appenderä¸­ç destinationï¼\n # è¿éå¶å®ælogstashä½ä¸ºæå¡ï¼å¼å¯9250ç«¯å£æ¥æ¶logbackååºçæ¶æ¯\n    host => "127.0.0.1" port => 9250 mode => "server" tags => ["tags"] codec => json_lines\n  }\n}\noutput {\n  elasticsearch { hosts => ["localhost:9200"] }\n  stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-tcp.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-udp.conf\n\njava åºç¨éç½®ï¼\n\nï¼1ï¼å¨ java åºç¨ç pom.xml ä¸­å¼å¥ jar åï¼\n\n<dependency>\n <groupid>net.logstash.logback</groupid>\n <artifactid>logstash-logback-encoder</artifactid>\n <version>4.11</version>\n</dependency>\n\n\x3c!-- logback ä¾èµå --\x3e\n<dependency>\n <groupid>ch.qos.logback</groupid>\n <artifactid>logback-core</artifactid>\n <version>1.2.3</version>\n</dependency>\n<dependency>\n <groupid>ch.qos.logback</groupid>\n <artifactid>logback-classic</artifactid>\n <version>1.2.3</version>\n</dependency>\n<dependency>\n <groupid>ch.qos.logback</groupid>\n <artifactid>logback-access</artifactid>\n <version>1.2.3</version>\n</dependency>\n\n\nï¼2ï¼æ¥çï¼å¨ logback.xml ä¸­æ·»å  appender\n\n<appender name="elk-tcp" class="net.logstash.logback.appender.logstashtcpsocketappender">\n \x3c!--\n destination æ¯ logstash æå¡ç host:portï¼\n ç¸å½äºå logstash å»ºç«äºç®¡éï¼å°æ¥å¿æ°æ®å®åä¼ è¾å° logstash\n --\x3e\n <destination>192.168.28.32:9251</destination>\n <encoder charset="utf-8" class="net.logstash.logback.encoder.logstashencoder"/>\n</appender>\n<logger name="io.github.dunwu.spring" level="trace" additivity="false">\n <appender-ref ref="elk-tcp" />\n</logger>\n\n\nå¤§ååæï¼æ­¤åï¼io.github.dunwu.spring åä¸­ç trace åä»¥ä¸çº§å«çæ¥å¿ä¿¡æ¯é½ä¼è¢«å®åè¾åºå° logstash æå¡ã\n\n\n\næ¥ä¸æ¥ï¼å°±æ¯ logback çå·ä½ä½¿ç¨ ï¼å¦æå¯¹æ­¤ä¸äºè§£ï¼ä¸å¦¨åèä¸ä¸æçè¿ç¯åæï¼ç»è¯´ java ä¸»æµæ¥å¿å·¥å·åº ã\n\nå®ä¾ï¼æç logback.xml\n\n# 5.2.2. udp åºç¨\n\nudp å tcp çä½¿ç¨æ¹å¼å¤§åå°å¼ã\n\nlogstash éç½®ï¼\n\nï¼1ï¼åå»º logstash-input-udp.conf ï¼\n\ninput {\nudp {\n  port => 9250\n  codec => json\n}\n}\noutput {\n elasticsearch { hosts => ["localhost:9200"] }\n stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-udp.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-udp.conf\n\njava åºç¨éç½®ï¼\n\nï¼1ï¼å¨ java åºç¨ç pom.xml ä¸­å¼å¥ jar åï¼\n\nä¸ tcp åºç¨ ä¸èä¸­çå¼å¥ä¾èµåå®å¨ç¸åã\n\nï¼2ï¼æ¥çï¼å¨ logback.xml ä¸­æ·»å  appender\n\n<appender name="elk-udp" class="net.logstash.logback.appender.logstashsocketappender">\n  <host>192.168.28.32</host>\n  <port>9250</port>\n</appender>\n<logger name="io.github.dunwu.spring" level="trace" additivity="false">\n  <appender-ref ref="elk-udp" />\n</logger>\n\n\nï¼3ï¼æ¥ä¸æ¥ï¼å°±æ¯ logback çå·ä½ä½¿ç¨ ï¼å¦æå¯¹æ­¤ä¸äºè§£ï¼ä¸å¦¨åèä¸ä¸æçè¿ç¯åæï¼ç»è¯´ java ä¸»æµæ¥å¿å·¥å·åº ã\n\nå®ä¾ï¼æç logback.xml\n\n\n# 5.3. ä¼ è¾æä»¶\n\n> å¨ java web é¢åï¼éè¦ç¨å°ä¸äºéè¦çå·¥å·ï¼ä¾å¦ tomcat ãnginx ãmysql ç­ãè¿äºä¸å±äºä¸å¡åºç¨ï¼ä½æ¯å®ä»¬çæ¥å¿æ°æ®å¯¹äºå®ä½é®é¢ãåæç»è®¡åæ ·å¾éè¦ãè¿æ¶æ æ³ä½¿ç¨ logback æ¹å¼å°å®ä»¬çæ¥å¿ä¼ è¾å° logstashã\n> \n> å¦ä½ééè¿äºæ¥å¿æä»¶å¢ï¼å«æ¥ï¼ä½ å¯ä»¥ä½¿ç¨ logstash ç file input æä»¶ã\n> \n> éè¦æ³¨æçæ¯ï¼ä¼ è¾æä»¶è¿ç§æ¹å¼ï¼å¿é¡»å¨æ¥å¿æå¨çæºå¨ä¸é¨ç½² logstash ã\n\nåºç¨\n\nlogstash éç½®\n\nï¼1ï¼åå»º logstash-input-file.conf ï¼\n\ninput {\n file {\n  path => ["/var/log/nginx/access.log"]\n  type => "nginx-access-log"\n  start_position => "beginning"\n }\n}\n\noutput {\n if [type] == "nginx-access-log" {\n  elasticsearch {\n   hosts => ["localhost:9200"]\n   index => "nginx-access-log"\n  }\n }\n}\n\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-file.conf\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-file.html\n\n\n# 6. å°æå·§\n\n\n# 6.1. å¯å¨ãç»æ­¢åºç¨\n\nå¦æä½ ç logstash æ¯æ¬¡é½æ¯éè¿æå®éç½®æä»¶æ¹å¼å¯å¨ãä¸å¦¨å»ºç«ä¸ä¸ªå¯å¨èæ¬ã\n\n# cd xxx è¿å¥ logstash å®è£ç®å½ä¸ç bin ç®å½\nlogstash -f logstash.conf\n\n\nå¦æä½ ç logstash è¿è¡å¨ linux ç³»ç»ä¸ï¼ä¸å¦¨ä½¿ç¨ nohup æ¥å¯å¨ä¸ä¸ªå®æ¤è¿ç¨ãè¿æ ·åçå¥½å¤å¨äºï¼å³ä½¿å³é­ç»ç«¯ï¼åºç¨ä»ä¼è¿è¡ã\n\nåå»º startup.shï¼\n\nnohup ./logstash -f logstash.conf >> nohup.out 2>&1 &\n\n\nç»æ­¢åºç¨æ²¡æä»ä¹å¥½æ¹æ³ï¼ä½ åªè½ä½¿ç¨ ps -ef | grep logstash ï¼æ¥åºè¿ç¨ï¼å°å¶ kill ãä¸è¿ï¼æä»¬å¯ä»¥åä¸ä¸ªèæ¬æ¥å¹²è¿ä»¶äºï¼\n\nåå»º shutdown.shï¼\n\nèæ¬ä¸å¤è§£éï¼è¯·èªè¡é¢ä¼ä½ç¨ã\n\npid=`ps -ef | grep logstash | awk \'{ print $2}\' | head -n 1`\nkill -9 ${pid}\n\n\n\n# 7. åèèµæ\n\n * logstash å®ç½\n * logstash github\n * logstash å®æ¹ææ¡£\n * logstash-logback-encoder\n * elk stack æå¨æå\n * elkï¼elasticsearchãlogstashãkibanaï¼å®è£åéç½®',charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"åç±»",frontmatter:{categoriesPage:!0,title:"åç±»",permalink:"/categories/",article:!1},regularPath:"/@pages/categoriesPage.html",relativePath:"@pages/categoriesPage.md",key:"v-03067a49",path:"/categories/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"æ ç­¾",frontmatter:{tagsPage:!0,title:"æ ç­¾",permalink:"/tags/",article:!1},regularPath:"/@pages/tagsPage.html",relativePath:"@pages/tagsPage.md",key:"v-be824b2e",path:"/tags/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"å½æ¡£",frontmatter:{archivesPage:!0,title:"å½æ¡£",permalink:"/archives/",article:!1},regularPath:"/@pages/archivesPage.html",relativePath:"@pages/archivesPage.md",key:"v-c7c85e2e",path:"/archives/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3},{title:"Home",frontmatter:{home:!0,heroImage:"img/bg.gif",heroText:"DB-TUTORIAL",tagline:"â db-tutorial æ¯ä¸ä¸ªæ°æ®åºæç¨ã",bannerBg:"none",postList:"none",footer:"CC-BY-SA-4.0 Licensed | Copyright Â© 2018-Now Dunwu"},regularPath:"/",relativePath:"README.md",key:"v-91a7d35c",path:"/",headers:[{level:2,title:"æ°æ®åºç»¼å",slug:"æ°æ®åºç»¼å",normalizedTitle:"æ°æ®åºç»¼å",charIndex:105},{level:3,title:"åå¸å¼å­å¨åç",slug:"åå¸å¼å­å¨åç",normalizedTitle:"åå¸å¼å­å¨åç",charIndex:115},{level:4,title:"åå¸å¼çè®º",slug:"åå¸å¼çè®º",normalizedTitle:"åå¸å¼çè®º",charIndex:126},{level:4,title:"åå¸å¼å³é®ææ¯",slug:"åå¸å¼å³é®ææ¯",normalizedTitle:"åå¸å¼å³é®ææ¯",charIndex:199},{level:5,title:"æµéè°åº¦",slug:"æµéè°åº¦",normalizedTitle:"æµéè°åº¦",charIndex:210},{level:5,title:"æ°æ®è°åº¦",slug:"æ°æ®è°åº¦",normalizedTitle:"æ°æ®è°åº¦",charIndex:256},{level:3,title:"å¶ä»",slug:"å¶ä»",normalizedTitle:"å¶ä»",charIndex:340},{level:2,title:"æ°æ®åºä¸­é´ä»¶",slug:"æ°æ®åºä¸­é´ä»¶",normalizedTitle:"æ°æ®åºä¸­é´ä»¶",charIndex:376},{level:2,title:"å³ç³»åæ°æ®åº",slug:"å³ç³»åæ°æ®åº",normalizedTitle:"å³ç³»åæ°æ®åº",charIndex:450},{level:3,title:"å³ç³»åæ°æ®åºç»¼å",slug:"å³ç³»åæ°æ®åºç»¼å",normalizedTitle:"å³ç³»åæ°æ®åºç»¼å",charIndex:486},{level:3,title:"Mysql",slug:"mysql",normalizedTitle:"mysql",charIndex:574},{level:3,title:"å¶ä»",slug:"å¶ä»-2",normalizedTitle:"å¶ä»",charIndex:340},{level:2,title:"ææ¡£æ°æ®åº",slug:"ææ¡£æ°æ®åº",normalizedTitle:"ææ¡£æ°æ®åº",charIndex:907},{level:3,title:"MongoDB",slug:"mongodb",normalizedTitle:"mongodb",charIndex:917},{level:2,title:"KV æ°æ®åº",slug:"kv-æ°æ®åº",normalizedTitle:"kv æ°æ®åº",charIndex:1350},{level:3,title:"Redis",slug:"redis",normalizedTitle:"redis",charIndex:1361},{level:2,title:"åå¼æ°æ®åº",slug:"åå¼æ°æ®åº",normalizedTitle:"åå¼æ°æ®åº",charIndex:1791},{level:3,title:"HBase",slug:"hbase",normalizedTitle:"hbase",charIndex:1801},{level:2,title:"æç´¢å¼ææ°æ®åº",slug:"æç´¢å¼ææ°æ®åº",normalizedTitle:"æç´¢å¼ææ°æ®åº",charIndex:1998},{level:3,title:"Elasticsearch",slug:"elasticsearch",normalizedTitle:"elasticsearch",charIndex:2010},{level:3,title:"Elastic",slug:"elastic",normalizedTitle:"elastic",charIndex:2010},{level:2,title:"èµæ ð",slug:"èµæ-ð",normalizedTitle:"èµæ ð",charIndex:2609},{level:3,title:"æ°æ®åºç»¼åèµæ",slug:"æ°æ®åºç»¼åèµæ",normalizedTitle:"æ°æ®åºç»¼åèµæ",charIndex:2619},{level:3,title:"å³ç³»åæ°æ®åºèµæ",slug:"å³ç³»åæ°æ®åºèµæ",normalizedTitle:"å³ç³»åæ°æ®åºèµæ",charIndex:3077},{level:4,title:"Mysql èµæ",slug:"mysql-èµæ",normalizedTitle:"mysql èµæ",charIndex:3204},{level:3,title:"Nosql æ°æ®åºç»¼å",slug:"nosql-æ°æ®åºç»¼å",normalizedTitle:"nosql æ°æ®åºç»¼å",charIndex:5530},{level:3,title:"åå¼æ°æ®åºèµæ",slug:"åå¼æ°æ®åºèµæ",normalizedTitle:"åå¼æ°æ®åºèµæ",charIndex:6535},{level:4,title:"Cassandra èµæ",slug:"cassandra-èµæ",normalizedTitle:"cassandra èµæ",charIndex:6546},{level:4,title:"HBase èµæ",slug:"hbase-èµæ",normalizedTitle:"hbase èµæ",charIndex:7074},{level:3,title:"KV æ°æ®åºèµæ",slug:"kv-æ°æ®åºèµæ",normalizedTitle:"kv æ°æ®åºèµæ",charIndex:7652},{level:4,title:"Redis èµæ",slug:"redis-èµæ",normalizedTitle:"redis èµæ",charIndex:7664},{level:3,title:"ææ¡£æ°æ®åºèµæ",slug:"ææ¡£æ°æ®åºèµæ",normalizedTitle:"ææ¡£æ°æ®åºèµæ",charIndex:8615},{level:4,title:"MongoDB èµæ",slug:"mongodb-èµæ",normalizedTitle:"mongodb èµæ",charIndex:8740},{level:3,title:"æç´¢å¼ææ°æ®åºèµæ",slug:"æç´¢å¼ææ°æ®åºèµæ",normalizedTitle:"æç´¢å¼ææ°æ®åºèµæ",charIndex:9145},{level:4,title:"ElasticSearch",slug:"elasticsearch-2",normalizedTitle:"elasticsearch",charIndex:2369},{level:3,title:"å¾æ°æ®åº",slug:"å¾æ°æ®åº",normalizedTitle:"å¾æ°æ®åº",charIndex:9768},{level:3,title:"æ¶åºæ°æ®åº",slug:"æ¶åºæ°æ®åº",normalizedTitle:"æ¶åºæ°æ®åº",charIndex:10335},{level:2,title:"ä¼ é ðª",slug:"ä¼ é-ðª",normalizedTitle:"ä¼ é ðª",charIndex:10838}],headersStr:"æ°æ®åºç»¼å åå¸å¼å­å¨åç åå¸å¼çè®º åå¸å¼å³é®ææ¯ æµéè°åº¦ æ°æ®è°åº¦ å¶ä» æ°æ®åºä¸­é´ä»¶ å³ç³»åæ°æ®åº å³ç³»åæ°æ®åºç»¼å Mysql å¶ä» ææ¡£æ°æ®åº MongoDB KV æ°æ®åº Redis åå¼æ°æ®åº HBase æç´¢å¼ææ°æ®åº Elasticsearch Elastic èµæ ð æ°æ®åºç»¼åèµæ å³ç³»åæ°æ®åºèµæ Mysql èµæ Nosql æ°æ®åºç»¼å åå¼æ°æ®åºèµæ Cassandra èµæ HBase èµæ KV æ°æ®åºèµæ Redis èµæ ææ¡£æ°æ®åºèµæ MongoDB èµæ æç´¢å¼ææ°æ®åºèµæ ElasticSearch å¾æ°æ®åº æ¶åºæ°æ®åº ä¼ é ðª",content:"> ð¾ db-tutorial æ¯ä¸ä¸ªæ°æ®åºæç¨ã\n> \n>  * ð é¡¹ç®åæ­¥ç»´æ¤ï¼Github | Gitee\n>  * ð çµå­ä¹¦éè¯»ï¼Github Pages | Gitee Pages\n\n\n# æ°æ®åºç»¼å\n\n\n# åå¸å¼å­å¨åç\n\n# åå¸å¼çè®º\n\n * åå¸å¼ä¸è´æ§\n * æ·±å¥åæå±è¯æ§ç®æ³ Paxos\n * æ·±å¥åæå±è¯æ§ç®æ³ Raft\n * åå¸å¼ç®æ³ Gossip\n\n# åå¸å¼å³é®ææ¯\n\n# æµéè°åº¦\n\n * æµéæ§å¶\n * è´è½½åè¡¡\n * æå¡è·¯ç±\n * åå¸å¼ä¼è¯åºæ¬åç\n\n# æ°æ®è°åº¦\n\n * ç¼å­åºæ¬åç\n * è¯»ååç¦»åºæ¬åç\n * ååºåè¡¨åºæ¬åç\n * åå¸å¼ ID åºæ¬åç\n * åå¸å¼äºå¡åºæ¬åç\n * åå¸å¼éåºæ¬åç\n\n\n# å¶ä»\n\n * Nosql ææ¯éå\n * æ°æ®ç»æä¸æ°æ®åºç´¢å¼\n\n\n# æ°æ®åºä¸­é´ä»¶\n\n * ShardingSphere ç®ä»\n * ShardingSphere Jdbc\n * çæ¬ç®¡çä¸­é´ä»¶ Flyway\n\n\n# å³ç³»åæ°æ®åº\n\n> å³ç³»åæ°æ®åº æ´çä¸»æµå³ç³»åæ°æ®åºç¥è¯ç¹ã\n\n\n# å³ç³»åæ°æ®åºç»¼å\n\n * å³ç³»åæ°æ®åºé¢è¯æ»ç» ð¯\n * SQL è¯­æ³åºç¡ç¹æ§\n * SQL è¯­æ³é«çº§ç¹æ§\n * æ©å± SQL\n * SQL Cheat Sheet\n\n\n# Mysql\n\n\n\n * Mysql åºç¨æå â¡\n * Mysql å·¥ä½æµ - å³é®è¯ï¼è¿æ¥ãç¼å­ãè¯­æ³åæãä¼åãæ§è¡å¼æãredo logãbin logãä¸¤é¶æ®µæäº¤\n * Mysql äºå¡ - å³é®è¯ï¼ACIDãAUTOCOMMITãäºå¡éç¦»çº§å«ãæ­»éãåå¸å¼äºå¡\n * Mysql é - å³é®è¯ï¼ä¹è§éãè¡¨çº§éãè¡çº§éãæåéãMVCCãNext-key é\n * Mysql ç´¢å¼ - å³é®è¯ï¼HashãB æ ãèç°ç´¢å¼ãåè¡¨\n * Mysql æ§è½ä¼å\n * Mysql è¿ç»´ ð¨\n * Mysql éç½® ð¨\n * Mysql é®é¢\n\n\n# å¶ä»\n\n * PostgreSQL åºç¨æå\n * H2 åºç¨æå\n * SqLite åºç¨æå\n\n\n# ææ¡£æ°æ®åº\n\n\n# MongoDB\n\n> MongoDB æ¯ä¸ä¸ªåºäºææ¡£çåå¸å¼æ°æ®åºï¼ç± C++ è¯­è¨ç¼åãæ¨å¨ä¸º WEB åºç¨æä¾å¯æ©å±çé«æ§è½æ°æ®å­å¨è§£å³æ¹æ¡ã\n> \n> MongoDB æ¯ä¸ä¸ªä»äºå³ç³»åæ°æ®åºåéå³ç³»åæ°æ®åºä¹é´çäº§åãå®æ¯éå³ç³»æ°æ®åºå½ä¸­åè½æä¸°å¯ï¼æåå³ç³»æ°æ®åºçãå®æ¯æçæ°æ®ç»æéå¸¸æ¾æ£ï¼æ¯ç±»ä¼¼ json ç bson æ ¼å¼ï¼å æ­¤å¯ä»¥å­å¨æ¯è¾å¤æçæ°æ®ç±»åã\n> \n> MongoDB æå¤§çç¹ç¹æ¯å®æ¯æçæ¥è¯¢è¯­è¨éå¸¸å¼ºå¤§ï¼å¶è¯­æ³æç¹ç±»ä¼¼äºé¢åå¯¹è±¡çæ¥è¯¢è¯­è¨ï¼å ä¹å¯ä»¥å®ç°ç±»ä¼¼å³ç³»æ°æ®åºåè¡¨æ¥è¯¢çç»å¤§é¨ååè½ï¼èä¸è¿æ¯æå¯¹æ°æ®å»ºç«ç´¢å¼ã\n\n * MongoDB åºç¨æå\n * MongoDB ç CRUD æä½\n * MongoDB èåæä½\n * MongoDB äºå¡\n * MongoDB å»ºæ¨¡\n * MongoDB å»ºæ¨¡ç¤ºä¾\n * MongoDB ç´¢å¼\n * MongoDB å¤å¶\n * MongoDB åç\n * MongoDB è¿ç»´\n\n\n# KV æ°æ®åº\n\n\n# Redis\n\n\n\n * Redis é¢è¯æ»ç» ð¯\n * Redis åºç¨æå â¡ - å³é®è¯ï¼åå­æ·æ±°ãäºä»¶ãäºå¡ãç®¡éãåå¸ä¸è®¢é\n * Redis æ°æ®ç±»åååºç¨ - å³é®è¯ï¼STRINGãHASHãLISTãSETãZSETãBitMapãHyperLogLogãGeo\n * Redis æä¹å - å³é®è¯ï¼RDBãAOFãSAVEãBGSAVEãappendfsync\n * Redis å¤å¶ - å³é®è¯ï¼SLAVEOFãSYNCãPSYNCãREPLCONF ACK\n * Redis å¨åµ - å³é®è¯ï¼SentinelãPINGãINFOãRaft\n * Redis éç¾¤ - å³é®è¯ï¼CLUSTER MEETãHash slotãMOVEDãASKãSLAVEOF no oneãredis-trib\n * Redis å®æ - å³é®è¯ï¼ç¼å­ãåå¸å¼éãå¸éè¿æ»¤å¨\n * Redis è¿ç»´ ð¨ - å³é®è¯ï¼å®è£ãå½ä»¤ãéç¾¤ãå®¢æ·ç«¯\n\n\n# åå¼æ°æ®åº\n\n\n# HBase\n\n * HBase å¿«éå¥é¨\n * HBase æ°æ®æ¨¡å\n * HBase Schema è®¾è®¡\n * HBase æ¶æ\n * HBase Java API åºç¡ç¹æ§\n * HBase Java API é«çº§ç¹æ§ä¹è¿æ»¤å¨\n * HBase Java API é«çº§ç¹æ§ä¹åå¤çå¨\n * HBase Java API å¶ä»é«çº§ç¹æ§\n * HBase è¿ç»´\n * HBase å½ä»¤\n\n\n# æç´¢å¼ææ°æ®åº\n\n\n# Elasticsearch\n\n> Elasticsearch æ¯ä¸ä¸ªåºäº Lucene çæç´¢åæ°æ®åæå·¥å·ï¼å®æä¾äºä¸ä¸ªåå¸å¼æå¡ãElasticsearch æ¯éµä» Apache å¼æºæ¡æ¬¾çä¸æ¬¾å¼æºäº§åï¼æ¯å½åä¸»æµçä¼ä¸çº§æç´¢å¼æã\n\n * Elasticsearch é¢è¯æ»ç» ð¯\n * Elasticsearch å¿«éå¥é¨\n * Elasticsearch ç®ä»\n * Elasticsearch ç´¢å¼\n * Elasticsearch æ¥è¯¢\n * Elasticsearch é«äº®\n * Elasticsearch æåº\n * Elasticsearch èå\n * Elasticsearch åæå¨\n * Elasticsearch æ§è½ä¼å\n * Elasticsearch Rest API\n * ElasticSearch Java API ä¹ High Level REST Client\n * Elasticsearch éç¾¤ååç\n * Elasticsearch è¿ç»´\n\n\n# Elastic\n\n * Elastic å¿«éå¥é¨\n * Elastic ææ¯æ ä¹ Filebeat\n * Filebeat è¿ç»´\n * Elastic ææ¯æ ä¹ Kibana\n * Kibana è¿ç»´\n * Elastic ææ¯æ ä¹ Logstash\n * Logstash è¿ç»´\n\n\n# èµæ ð\n\n\n# æ°æ®åºç»¼åèµæ\n\n * DB-Engines - æ°æ®åºæµè¡åº¦æå\n * ä¹¦ç±\n   * ãæ°æ®å¯éååºç¨ç³»ç»è®¾è®¡ã - è¿å¯è½æ¯ç®åæå¥½çåå¸å¼å­å¨ä¹¦ç±ï¼å¼ºåæ¨èãè¿é¶ã\n * æç¨\n   * CMU 15445 æ°æ®åºåºç¡è¯¾ç¨\n   * CMU 15721 æ°æ®åºé«çº§è¯¾ç¨\n   * æ£ç´¢ææ¯æ ¸å¿ 20 è®² - æå®¢æç¨ãè¿é¶ã\n   * åç«¯å­å¨å®æè¯¾ - æå®¢æç¨ãå¥é¨ãï¼è®²è§£å­å¨å¨çµåé¢åçç§ç§åºç¨åä¸äºåºæ¬ç¹æ§\n * è®ºæ\n   * Efficiency in the Columbia Database Query Optimizer\n   * How Good Are Query Optimizers, Really?\n   * Architecture of a Database System\n   * Data Structures for Databases\n * æç« \n   * Data Structures and Algorithms for Big Databases\n\n\n# å³ç³»åæ°æ®åºèµæ\n\n * ç»¼åèµæ\n   * ãæ°æ®åºçç´¢å¼è®¾è®¡ä¸ä¼åã\n   * ãSQL å¿ç¥å¿ä¼ã - SQL çåºæ¬æ¦å¿µåè¯­æ³ãå¥é¨ã\n * Oracle èµæ\n   * ãOracle Database 9i/10g/11g ç¼ç¨èºæ¯ã\n\n# Mysql èµæ\n\n * å®æ¹\n   * Mysql å®ç½\n   * Mysql å®æ¹ææ¡£\n   * å®æ¹ PPT\n     * How to Analyze and Tune MySQL Queries for Better Performance\n     * MySQL Performance Tuning 101\n     * MySQL Performance Schema & Sys Schema\n     * MySQL Performance: Demystified Tuning & Best Practices\n     * MySQL Security Best Practices\n     * MySQL Cluster Deployment Best Practices\n     * MySQL High Availability with InnoDB Cluster\n * ä¹¦ç±\n   * ãé«æ§è½ MySQLã - ç»å¸ï¼éå DBA æä½ä¸ºå¼åèçåèæåãè¿é¶ã\n   * ãMySQL ææ¯åå¹ï¼InnoDB å­å¨å¼æã\n   * ãMySQL å¿ç¥å¿ä¼ã - Mysql çåºæ¬æ¦å¿µåè¯­æ³ãå¥é¨ã\n * æç¨\n   * runoob.com MySQL æç¨ - å¥é¨çº§ SQL æç¨\n   * mysql-tutorial\n * æç« \n   * MySQL ç´¢å¼èåçæ°æ®ç»æåç®æ³åç\n   * Some study on database storage internals\n   * Sharding Pinterest: How we scaled our MySQL fleet\n   * Guide to MySQL High Availability\n   * Choosing MySQL High Availability Solutions\n   * High availability with MariaDB TX: The definitive guide\n   * Mysql ç¸å³ç»éª\n     * Booking.com: Evolution of MySQL System Design ï¼Booking.com ç MySQL æ°æ®åºä½¿ç¨çæ¼åï¼å¶ä¸­æå¾å¤ä¸éçç»éªåäº«ï¼æç¸ä¿¡ä¹æ¯å¾å¤å¬å¸ä¼éå°ççé®é¢ã\n     * Tracking the Moneyâ-âScaling Financial Reporting at Airbnb ï¼Airbnb çæ°æ®åºæ©å±çç»éªåäº«ã\n     * Why Uber Engineering Switched from Postgres to MySQL ï¼æ ææ¯è¾ä¸¤ä¸ªæ°æ®åºè°å¥½è°ä¸å¥½ï¼æ¨èè¿ç¯ Uber çé¿æï¼ä¸»è¦æ¯æ³è®©ä½ ä»ä¸­å­¦ä¹ å°ä¸äºç»éªåææ¯ç»èï¼è¿æ¯ä¸ç¯å¾ä¸éçæç« ã\n   * Mysql éç¾¤å¤å¶\n     * Monitoring Delayed Replication, With A Focus On MySQL\n     * Mitigating replication lag and reducing read load with freno\n     * Better Parallel Replication for MySQL\n     * Evaluating MySQL Parallel Replication Part 2: Slave Group Commit\n     * Evaluating MySQL Parallel Replication Part 3: Benchmarks in Production\n     * Evaluating MySQL Parallel Replication Part 4: More Benchmarks in Production\n     * Evaluating MySQL Parallel Replication Part 4, Annex: Under the Hood\n   * Mysql æ°æ®ååº\n     * StackOverflow: MySQL sharding approaches?\n     * Why you donât want to shard\n     * [How to Scale Big Data Applications](https://www.percona.com/sites/default/files/presentations/How to Scale Big Data Applications.pdf)\n     * MySQL Sharding with ProxySQL\n   * åå¬å¸ç Mysql æ°æ®ååºç»éªåäº«\n     * MailChimp: Using Shards to Accommodate Millions of Users\n     * Uber: Code Migration in Production: Rewriting the Sharding Layer of Uberâs Schemaless Datastore\n     * Sharding & IDs at Instagram\n     * Airbnb: How We Partitioned Airbnbâs Main Database in Two Weeks\n * æ´å¤èµæº\n   * awesome-mysql - MySQL çèµæºåè¡¨\n\n\n# Nosql æ°æ®åºç»¼å\n\n * Martin Fowler å¨ YouTube ä¸åäº«ç NoSQL ä»ç» Introduction To NoSQLï¼ ä»¥åä»åä¸ç¼åç NoSQL Distilled - NoSQL ç²¾ç²¹ï¼è¿æ¬ä¹¦æ 100 å¤é¡µï¼æ¯æ¬é¾å¾çå³äº NoSQL çä¹¦ï¼å¾ä¸éï¼éå¸¸æè¯»ã\n * NoSQL Databases: a Survey and Decision Guidanceï¼è¿ç¯æç« å¯ä»¥å¸¦ä½ èªä¸èä¸å°ä» CAP åçå°å¼å§äºè§£ NoSQL çç§ç§ææ¯ï¼æ¯ä¸ç¯éå¸¸ä¸éçæç« ã\n * Distribution, Data, Deployment: Software Architecture Convergence in Big Data Systemsï¼è¿æ¯å¡ååºÂ·æ¢éå¤§å­¦çä¸ç¯è®²åå¸å¼å¤§æ°æ®ç³»ç»çè®ºæãå¶ä¸­ä¸»è¦è®¨è®ºäºå¨å¤§æ°æ®æ¶ä»£ä¸çè½¯ä»¶å·¥ç¨ä¸­çä¸äºå³é®ç¹ï¼ä¹è¯´å°äº NoSQL æ°æ®åºã\n * No Relation: The Mixed Blessings of Non-Relational Databasesï¼è¿ç¯è®ºæè½ç¶æç¹å¹´ä»£ä¹è¿ãä½è¿ç¯è®ºææ¯ HBase çåºç¡ï¼ä½ è±ä¸ä¸ç¹æ¶é´æ¥è¯»è¯»ï¼å°±å¯ä»¥äºè§£å°ï¼å¯¹åç§éå³ç³»åæ°æ®å­å¨ä¼ç¼ºç¹çä¸ä¸ªå¾å¥½çæ¯è¾ã\n * NoSQL Data Modeling Techniques ï¼NoSQL å»ºæ¨¡ææ¯ãè¿ç¯æç« ææ¾ç»ç¿»è¯å¨äº CoolShell ä¸ï¼æ é¢ä¸º NoSQL æ°æ®å»ºæ¨¡ææ¯ï¼ä¾ä½ åèã\n   * MongoDB - Data Modeling Introduction ï¼è½ç¶è¿æ¯ MongoDB çæ°æ®å»ºæ¨¡ä»ç»ï¼ä½æ¯å¶å¾å¤è§ç¹å¯ä»¥ç¨äºå¶å®ç NoSQL æ°æ®åºã\n   * Firebase - Structure Your Database ï¼Google ç Firebase æ°æ®åºä½¿ç¨ JSON å»ºæ¨¡çä¸äºæä½³å®è·µã\n * å ä¸º CAP åçï¼æä»¥å½ä½ éè¦éæ©ä¸ä¸ª NoSQL æ°æ®åºçæ¶åï¼ä½ åºè¯¥ççè¿ç¯ææ¡£ Visual Guide to NoSQL Systemsã\n\né SQL è¿æ¯ NoSQLï¼è¿éæä¸¤ç¯æç« ï¼å¼å¾ä½ ççã\n\n * SQL vs. NoSQL Databases: Whatâs the Difference?\n * Salesforce: SQL or NoSQL\n\n\n# åå¼æ°æ®åºèµæ\n\n# Cassandra èµæ\n\n * æ²å°çå®éªå®¤æä¸¤ç¯æç« å¼å¾ä¸è¯»ã\n   * Avoid Pitfalls in Scaling Cassandra Cluster at Walmart\n   * Storing Images in Cassandra at Walmart\n * Yelp: How We Scaled Our Ad Analytics with Apache Cassandra ï¼Yelp çè¿ç¯åå®¢ä¹æä¸äºç¸å³çç»éªåæè®­ã\n * Discord: How Discord Stores Billions of Messages ï¼Discord å¬å¸åäº«çä¸ä¸ªå¦ä½å­å¨åäº¿çº§æ¶æ¯çææ¯æç« ã\n * Cassandra at Instagram ï¼Instagram çä¸ä¸ª PPTï¼å¶ä¸­ä»ç»äº Instagram ä¸­æ¯æä¹ä½¿ç¨ Cassandra çã\n * Netflix: Benchmarking Cassandra Scalability on AWSâ-âOver a million writes per second ï¼Netflix å¬å¸å¨ AWS ä¸ç» Cassandra åçä¸ä¸ª Benchmarkã\n\n# HBase èµæ\n\n * Imgur Notification: From MySQL to HBASE\n * Pinterest: Improving HBase Backup Efficiency\n * IBM : Tuning HBase performance\n * HBase File Locality in HDFS\n * Apache Hadoop Goes Realtime at Facebook\n * Storage Infrastructure Behind Facebook Messages: Using HBase at Scale\n * GitHub: Awesome HBase\n\néå¯¹äº HBase æä¸¤æ¬ä¹¦ä½ å¯ä»¥èèä¸ä¸ã\n\n * é¦åï¼åæ¨èä¸¤æ¬ä¹¦ï¼ä¸æ¬æ¯åå®è·µçãHBase å®æãï¼å¦ä¸æ¬æ¯åå¤§èå¨çæååçãHBase æå¨æåãã\n * å½ç¶ï¼ä½ ä¹å¯ä»¥ççå®æ¹ç The Apache HBaseâ¢ Reference Guide\n * å¦å¤ä¸¤ä¸ªåæ°æ®åºï¼\n   * ClickHouse - Open Source Distributed Column Database at Yandex\n   * Scaling Redshift without Scaling Costs at GIPHY\n\n\n# KV æ°æ®åºèµæ\n\n# Redis èµæ\n\n * å®ç½\n   * Redis å®ç½\n   * Redis github\n   * Redis å®æ¹ææ¡£ä¸­æç\n   * Redis å½ä»¤åè\n * ä¹¦ç±\n   * ãRedis å®æã\n   * ãRedis è®¾è®¡ä¸å®ç°ã\n * æºç \n   * ãRedis å®æãéå¥ Python æºç \n * èµæºæ±æ»\n   * awesome-redis\n * Redis Client\n   * spring-data-redis å®æ¹ææ¡£\n   * redisson å®æ¹ææ¡£(ä¸­æ,ç¥ææ»å)\n   * redisson å®æ¹ææ¡£(è±æ)\n   * CRUG | Redisson PRO vs. Jedis: Which Is Faster? ç¿»è¯\n   * redis åå¸é Redisson æ§è½æµè¯\n * æç« \n   * Learn Redis the hard way (in production) at Trivago\n   * Twitter: How Twitter Uses Redis To Scale - 105TB RAM, 39MM QPS, 10,000+ Instances\n   * Slack: Scaling Slackâs Job Queue - Robustly Handling Billions of Tasks in Milliseconds Using Kafka and Redis\n   * GitHub: Moving persistent data out of Redis at GitHub\n   * Instagram: Storing Hundreds of Millions of Simple Key-Value Pairs in Redis\n   * Redis in Chat Architecture of Twitch (from 27:22)\n   * Deliveroo: Optimizing Session Key Storage in Redis\n   * Deliveroo: Optimizing Redis Storage\n   * GitHub: Awesome Redis\n\n\n# ææ¡£æ°æ®åºèµæ\n\n * Couchbase Ecosystem at LinkedIn\n * SimpleDB at Zendesk\n * Data Points - What the Heck Are Document Databases?\n\n# MongoDB èµæ\n\n * å®æ¹\n   * MongoDB å®ç½\n   * MongoDB Github\n   * MongoDB å®æ¹åè´¹æç¨\n * æç¨\n   * MongoDB æç¨\n   * MongoDB é«æè¯¾\n * æ°æ®\n   * mongodb-json-files\n * æç« \n   * Introduction to MongoDB\n   * eBay: Building Mission-Critical Multi-Data Center Applications with MongoDB\n   * The AWS and MongoDB Infrastructure of Parse: Lessons Learned\n   * Migrating Mountains of Mongo Data\n * æ´å¤èµæº\n   * Github: Awesome MongoDB\n\n\n# æç´¢å¼ææ°æ®åºèµæ\n\n# ElasticSearch\n\n * å®æ¹\n   * Elasticsearch å®ç½\n   * Elasticsearch Github\n   * Elasticsearch å®æ¹ææ¡£\n   * Elasticsearch: The Definitive Guide - ElasticSearch å®æ¹å­¦ä¹ èµæ\n * ä¹¦ç±\n   * ãElasticsearch å®æã\n * æç¨\n   * ELK Stack æå¨æå\n   * Elasticsearch æç¨\n * æç« \n   * Elasticsearch+Logstash+Kibana æç¨\n   * ELKï¼ElasticsearchãLogstashãKibanaï¼å®è£åéç½®\n   * æ§è½è°ä¼ç¸å³çå·¥ç¨å®è·µ\n     * Elasticsearch Performance Tuning Practice at eBay\n     * Elasticsearch at Kickstarter\n     * 9 tips on ElasticSearch configuration for high performance\n     * Elasticsearch In Productionâ-âDeployment Best Practices\n * æ´å¤èµæº\n   * GitHub: Awesome ElasticSearch\n\n\n# å¾æ°æ®åº\n\n * é¦åæ¯ IBM Devloperworks ä¸çä¸¤ä¸ªç®ä»æ§ç PPTã\n   * Intro to graph databases, Part 1, Graph databases and the CRUD operations\n   * Intro to graph databases, Part 2, Building a recommendation engine with a graph database\n * ç¶åæ¯ä¸æ¬åè´¹ççµå­ä¹¦ãGraph Databaseãã\n * æ¥ä¸æ¥æ¯ä¸äºå¾æ°æ®åºçä»ç»æç« ã\n   * Handling Billions of Edges in a Graph Database\n   * Neo4j case studies with Walmart, eBay, AirBnB, NASA, etc\n   * FlockDB: Distributed Graph Database for Storing Adjacency Lists at Twitter\n   * JanusGraph: Scalable Graph Database backed by Google, IBM and Hortonworks\n   * Amazon Neptune\n\n\n# æ¶åºæ°æ®åº\n\n * What is Time-Series Data & Why We Need a Time-Series Database\n * Time Series Data: Why and How to Use a Relational Database instead of NoSQL\n * Beringei: High-performance Time Series Storage Engine @Facebook\n * Introducing Atlas: Netflixâs Primary Telemetry Platform @Netflix\n * Building a Scalable Time Series Database on PostgreSQL\n * Scaling Time Series Data Storage - Part I @Netflix\n * Design of a Cost Efficient Time Series Store for Big Data\n * GitHub: Awesome Time-Series Database\n\n\n# ä¼ é ðª\n\nâ¾ ð§ éæç IT ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",normalizedContent:"> ð¾ db-tutorial æ¯ä¸ä¸ªæ°æ®åºæç¨ã\n> \n>  * ð é¡¹ç®åæ­¥ç»´æ¤ï¼github | gitee\n>  * ð çµå­ä¹¦éè¯»ï¼github pages | gitee pages\n\n\n# æ°æ®åºç»¼å\n\n\n# åå¸å¼å­å¨åç\n\n# åå¸å¼çè®º\n\n * åå¸å¼ä¸è´æ§\n * æ·±å¥åæå±è¯æ§ç®æ³ paxos\n * æ·±å¥åæå±è¯æ§ç®æ³ raft\n * åå¸å¼ç®æ³ gossip\n\n# åå¸å¼å³é®ææ¯\n\n# æµéè°åº¦\n\n * æµéæ§å¶\n * è´è½½åè¡¡\n * æå¡è·¯ç±\n * åå¸å¼ä¼è¯åºæ¬åç\n\n# æ°æ®è°åº¦\n\n * ç¼å­åºæ¬åç\n * è¯»ååç¦»åºæ¬åç\n * ååºåè¡¨åºæ¬åç\n * åå¸å¼ id åºæ¬åç\n * åå¸å¼äºå¡åºæ¬åç\n * åå¸å¼éåºæ¬åç\n\n\n# å¶ä»\n\n * nosql ææ¯éå\n * æ°æ®ç»æä¸æ°æ®åºç´¢å¼\n\n\n# æ°æ®åºä¸­é´ä»¶\n\n * shardingsphere ç®ä»\n * shardingsphere jdbc\n * çæ¬ç®¡çä¸­é´ä»¶ flyway\n\n\n# å³ç³»åæ°æ®åº\n\n> å³ç³»åæ°æ®åº æ´çä¸»æµå³ç³»åæ°æ®åºç¥è¯ç¹ã\n\n\n# å³ç³»åæ°æ®åºç»¼å\n\n * å³ç³»åæ°æ®åºé¢è¯æ»ç» ð¯\n * sql è¯­æ³åºç¡ç¹æ§\n * sql è¯­æ³é«çº§ç¹æ§\n * æ©å± sql\n * sql cheat sheet\n\n\n# mysql\n\n\n\n * mysql åºç¨æå â¡\n * mysql å·¥ä½æµ - å³é®è¯ï¼è¿æ¥ãç¼å­ãè¯­æ³åæãä¼åãæ§è¡å¼æãredo logãbin logãä¸¤é¶æ®µæäº¤\n * mysql äºå¡ - å³é®è¯ï¼acidãautocommitãäºå¡éç¦»çº§å«ãæ­»éãåå¸å¼äºå¡\n * mysql é - å³é®è¯ï¼ä¹è§éãè¡¨çº§éãè¡çº§éãæåéãmvccãnext-key é\n * mysql ç´¢å¼ - å³é®è¯ï¼hashãb æ ãèç°ç´¢å¼ãåè¡¨\n * mysql æ§è½ä¼å\n * mysql è¿ç»´ ð¨\n * mysql éç½® ð¨\n * mysql é®é¢\n\n\n# å¶ä»\n\n * postgresql åºç¨æå\n * h2 åºç¨æå\n * sqlite åºç¨æå\n\n\n# ææ¡£æ°æ®åº\n\n\n# mongodb\n\n> mongodb æ¯ä¸ä¸ªåºäºææ¡£çåå¸å¼æ°æ®åºï¼ç± c++ è¯­è¨ç¼åãæ¨å¨ä¸º web åºç¨æä¾å¯æ©å±çé«æ§è½æ°æ®å­å¨è§£å³æ¹æ¡ã\n> \n> mongodb æ¯ä¸ä¸ªä»äºå³ç³»åæ°æ®åºåéå³ç³»åæ°æ®åºä¹é´çäº§åãå®æ¯éå³ç³»æ°æ®åºå½ä¸­åè½æä¸°å¯ï¼æåå³ç³»æ°æ®åºçãå®æ¯æçæ°æ®ç»æéå¸¸æ¾æ£ï¼æ¯ç±»ä¼¼ json ç bson æ ¼å¼ï¼å æ­¤å¯ä»¥å­å¨æ¯è¾å¤æçæ°æ®ç±»åã\n> \n> mongodb æå¤§çç¹ç¹æ¯å®æ¯æçæ¥è¯¢è¯­è¨éå¸¸å¼ºå¤§ï¼å¶è¯­æ³æç¹ç±»ä¼¼äºé¢åå¯¹è±¡çæ¥è¯¢è¯­è¨ï¼å ä¹å¯ä»¥å®ç°ç±»ä¼¼å³ç³»æ°æ®åºåè¡¨æ¥è¯¢çç»å¤§é¨ååè½ï¼èä¸è¿æ¯æå¯¹æ°æ®å»ºç«ç´¢å¼ã\n\n * mongodb åºç¨æå\n * mongodb ç crud æä½\n * mongodb èåæä½\n * mongodb äºå¡\n * mongodb å»ºæ¨¡\n * mongodb å»ºæ¨¡ç¤ºä¾\n * mongodb ç´¢å¼\n * mongodb å¤å¶\n * mongodb åç\n * mongodb è¿ç»´\n\n\n# kv æ°æ®åº\n\n\n# redis\n\n\n\n * redis é¢è¯æ»ç» ð¯\n * redis åºç¨æå â¡ - å³é®è¯ï¼åå­æ·æ±°ãäºä»¶ãäºå¡ãç®¡éãåå¸ä¸è®¢é\n * redis æ°æ®ç±»åååºç¨ - å³é®è¯ï¼stringãhashãlistãsetãzsetãbitmapãhyperloglogãgeo\n * redis æä¹å - å³é®è¯ï¼rdbãaofãsaveãbgsaveãappendfsync\n * redis å¤å¶ - å³é®è¯ï¼slaveofãsyncãpsyncãreplconf ack\n * redis å¨åµ - å³é®è¯ï¼sentinelãpingãinfoãraft\n * redis éç¾¤ - å³é®è¯ï¼cluster meetãhash slotãmovedãaskãslaveof no oneãredis-trib\n * redis å®æ - å³é®è¯ï¼ç¼å­ãåå¸å¼éãå¸éè¿æ»¤å¨\n * redis è¿ç»´ ð¨ - å³é®è¯ï¼å®è£ãå½ä»¤ãéç¾¤ãå®¢æ·ç«¯\n\n\n# åå¼æ°æ®åº\n\n\n# hbase\n\n * hbase å¿«éå¥é¨\n * hbase æ°æ®æ¨¡å\n * hbase schema è®¾è®¡\n * hbase æ¶æ\n * hbase java api åºç¡ç¹æ§\n * hbase java api é«çº§ç¹æ§ä¹è¿æ»¤å¨\n * hbase java api é«çº§ç¹æ§ä¹åå¤çå¨\n * hbase java api å¶ä»é«çº§ç¹æ§\n * hbase è¿ç»´\n * hbase å½ä»¤\n\n\n# æç´¢å¼ææ°æ®åº\n\n\n# elasticsearch\n\n> elasticsearch æ¯ä¸ä¸ªåºäº lucene çæç´¢åæ°æ®åæå·¥å·ï¼å®æä¾äºä¸ä¸ªåå¸å¼æå¡ãelasticsearch æ¯éµä» apache å¼æºæ¡æ¬¾çä¸æ¬¾å¼æºäº§åï¼æ¯å½åä¸»æµçä¼ä¸çº§æç´¢å¼æã\n\n * elasticsearch é¢è¯æ»ç» ð¯\n * elasticsearch å¿«éå¥é¨\n * elasticsearch ç®ä»\n * elasticsearch ç´¢å¼\n * elasticsearch æ¥è¯¢\n * elasticsearch é«äº®\n * elasticsearch æåº\n * elasticsearch èå\n * elasticsearch åæå¨\n * elasticsearch æ§è½ä¼å\n * elasticsearch rest api\n * elasticsearch java api ä¹ high level rest client\n * elasticsearch éç¾¤ååç\n * elasticsearch è¿ç»´\n\n\n# elastic\n\n * elastic å¿«éå¥é¨\n * elastic ææ¯æ ä¹ filebeat\n * filebeat è¿ç»´\n * elastic ææ¯æ ä¹ kibana\n * kibana è¿ç»´\n * elastic ææ¯æ ä¹ logstash\n * logstash è¿ç»´\n\n\n# èµæ ð\n\n\n# æ°æ®åºç»¼åèµæ\n\n * db-engines - æ°æ®åºæµè¡åº¦æå\n * ä¹¦ç±\n   * ãæ°æ®å¯éååºç¨ç³»ç»è®¾è®¡ã - è¿å¯è½æ¯ç®åæå¥½çåå¸å¼å­å¨ä¹¦ç±ï¼å¼ºåæ¨èãè¿é¶ã\n * æç¨\n   * cmu 15445 æ°æ®åºåºç¡è¯¾ç¨\n   * cmu 15721 æ°æ®åºé«çº§è¯¾ç¨\n   * æ£ç´¢ææ¯æ ¸å¿ 20 è®² - æå®¢æç¨ãè¿é¶ã\n   * åç«¯å­å¨å®æè¯¾ - æå®¢æç¨ãå¥é¨ãï¼è®²è§£å­å¨å¨çµåé¢åçç§ç§åºç¨åä¸äºåºæ¬ç¹æ§\n * è®ºæ\n   * efficiency in the columbia database query optimizer\n   * how good are query optimizers, really?\n   * architecture of a database system\n   * data structures for databases\n * æç« \n   * data structures and algorithms for big databases\n\n\n# å³ç³»åæ°æ®åºèµæ\n\n * ç»¼åèµæ\n   * ãæ°æ®åºçç´¢å¼è®¾è®¡ä¸ä¼åã\n   * ãsql å¿ç¥å¿ä¼ã - sql çåºæ¬æ¦å¿µåè¯­æ³ãå¥é¨ã\n * oracle èµæ\n   * ãoracle database 9i/10g/11g ç¼ç¨èºæ¯ã\n\n# mysql èµæ\n\n * å®æ¹\n   * mysql å®ç½\n   * mysql å®æ¹ææ¡£\n   * å®æ¹ ppt\n     * how to analyze and tune mysql queries for better performance\n     * mysql performance tuning 101\n     * mysql performance schema & sys schema\n     * mysql performance: demystified tuning & best practices\n     * mysql security best practices\n     * mysql cluster deployment best practices\n     * mysql high availability with innodb cluster\n * ä¹¦ç±\n   * ãé«æ§è½ mysqlã - ç»å¸ï¼éå dba æä½ä¸ºå¼åèçåèæåãè¿é¶ã\n   * ãmysql ææ¯åå¹ï¼innodb å­å¨å¼æã\n   * ãmysql å¿ç¥å¿ä¼ã - mysql çåºæ¬æ¦å¿µåè¯­æ³ãå¥é¨ã\n * æç¨\n   * runoob.com mysql æç¨ - å¥é¨çº§ sql æç¨\n   * mysql-tutorial\n * æç« \n   * mysql ç´¢å¼èåçæ°æ®ç»æåç®æ³åç\n   * some study on database storage internals\n   * sharding pinterest: how we scaled our mysql fleet\n   * guide to mysql high availability\n   * choosing mysql high availability solutions\n   * high availability with mariadb tx: the definitive guide\n   * mysql ç¸å³ç»éª\n     * booking.com: evolution of mysql system design ï¼booking.com ç mysql æ°æ®åºä½¿ç¨çæ¼åï¼å¶ä¸­æå¾å¤ä¸éçç»éªåäº«ï¼æç¸ä¿¡ä¹æ¯å¾å¤å¬å¸ä¼éå°ççé®é¢ã\n     * tracking the moneyâ-âscaling financial reporting at airbnb ï¼airbnb çæ°æ®åºæ©å±çç»éªåäº«ã\n     * why uber engineering switched from postgres to mysql ï¼æ ææ¯è¾ä¸¤ä¸ªæ°æ®åºè°å¥½è°ä¸å¥½ï¼æ¨èè¿ç¯ uber çé¿æï¼ä¸»è¦æ¯æ³è®©ä½ ä»ä¸­å­¦ä¹ å°ä¸äºç»éªåææ¯ç»èï¼è¿æ¯ä¸ç¯å¾ä¸éçæç« ã\n   * mysql éç¾¤å¤å¶\n     * monitoring delayed replication, with a focus on mysql\n     * mitigating replication lag and reducing read load with freno\n     * better parallel replication for mysql\n     * evaluating mysql parallel replication part 2: slave group commit\n     * evaluating mysql parallel replication part 3: benchmarks in production\n     * evaluating mysql parallel replication part 4: more benchmarks in production\n     * evaluating mysql parallel replication part 4, annex: under the hood\n   * mysql æ°æ®ååº\n     * stackoverflow: mysql sharding approaches?\n     * why you donât want to shard\n     * [how to scale big data applications](https://www.percona.com/sites/default/files/presentations/how to scale big data applications.pdf)\n     * mysql sharding with proxysql\n   * åå¬å¸ç mysql æ°æ®ååºç»éªåäº«\n     * mailchimp: using shards to accommodate millions of users\n     * uber: code migration in production: rewriting the sharding layer of uberâs schemaless datastore\n     * sharding & ids at instagram\n     * airbnb: how we partitioned airbnbâs main database in two weeks\n * æ´å¤èµæº\n   * awesome-mysql - mysql çèµæºåè¡¨\n\n\n# nosql æ°æ®åºç»¼å\n\n * martin fowler å¨ youtube ä¸åäº«ç nosql ä»ç» introduction to nosqlï¼ ä»¥åä»åä¸ç¼åç nosql distilled - nosql ç²¾ç²¹ï¼è¿æ¬ä¹¦æ 100 å¤é¡µï¼æ¯æ¬é¾å¾çå³äº nosql çä¹¦ï¼å¾ä¸éï¼éå¸¸æè¯»ã\n * nosql databases: a survey and decision guidanceï¼è¿ç¯æç« å¯ä»¥å¸¦ä½ èªä¸èä¸å°ä» cap åçå°å¼å§äºè§£ nosql çç§ç§ææ¯ï¼æ¯ä¸ç¯éå¸¸ä¸éçæç« ã\n * distribution, data, deployment: software architecture convergence in big data systemsï¼è¿æ¯å¡ååºÂ·æ¢éå¤§å­¦çä¸ç¯è®²åå¸å¼å¤§æ°æ®ç³»ç»çè®ºæãå¶ä¸­ä¸»è¦è®¨è®ºäºå¨å¤§æ°æ®æ¶ä»£ä¸çè½¯ä»¶å·¥ç¨ä¸­çä¸äºå³é®ç¹ï¼ä¹è¯´å°äº nosql æ°æ®åºã\n * no relation: the mixed blessings of non-relational databasesï¼è¿ç¯è®ºæè½ç¶æç¹å¹´ä»£ä¹è¿ãä½è¿ç¯è®ºææ¯ hbase çåºç¡ï¼ä½ è±ä¸ä¸ç¹æ¶é´æ¥è¯»è¯»ï¼å°±å¯ä»¥äºè§£å°ï¼å¯¹åç§éå³ç³»åæ°æ®å­å¨ä¼ç¼ºç¹çä¸ä¸ªå¾å¥½çæ¯è¾ã\n * nosql data modeling techniques ï¼nosql å»ºæ¨¡ææ¯ãè¿ç¯æç« ææ¾ç»ç¿»è¯å¨äº coolshell ä¸ï¼æ é¢ä¸º nosql æ°æ®å»ºæ¨¡ææ¯ï¼ä¾ä½ åèã\n   * mongodb - data modeling introduction ï¼è½ç¶è¿æ¯ mongodb çæ°æ®å»ºæ¨¡ä»ç»ï¼ä½æ¯å¶å¾å¤è§ç¹å¯ä»¥ç¨äºå¶å®ç nosql æ°æ®åºã\n   * firebase - structure your database ï¼google ç firebase æ°æ®åºä½¿ç¨ json å»ºæ¨¡çä¸äºæä½³å®è·µã\n * å ä¸º cap åçï¼æä»¥å½ä½ éè¦éæ©ä¸ä¸ª nosql æ°æ®åºçæ¶åï¼ä½ åºè¯¥ççè¿ç¯ææ¡£ visual guide to nosql systemsã\n\né sql è¿æ¯ nosqlï¼è¿éæä¸¤ç¯æç« ï¼å¼å¾ä½ ççã\n\n * sql vs. nosql databases: whatâs the difference?\n * salesforce: sql or nosql\n\n\n# åå¼æ°æ®åºèµæ\n\n# cassandra èµæ\n\n * æ²å°çå®éªå®¤æä¸¤ç¯æç« å¼å¾ä¸è¯»ã\n   * avoid pitfalls in scaling cassandra cluster at walmart\n   * storing images in cassandra at walmart\n * yelp: how we scaled our ad analytics with apache cassandra ï¼yelp çè¿ç¯åå®¢ä¹æä¸äºç¸å³çç»éªåæè®­ã\n * discord: how discord stores billions of messages ï¼discord å¬å¸åäº«çä¸ä¸ªå¦ä½å­å¨åäº¿çº§æ¶æ¯çææ¯æç« ã\n * cassandra at instagram ï¼instagram çä¸ä¸ª pptï¼å¶ä¸­ä»ç»äº instagram ä¸­æ¯æä¹ä½¿ç¨ cassandra çã\n * netflix: benchmarking cassandra scalability on awsâ-âover a million writes per second ï¼netflix å¬å¸å¨ aws ä¸ç» cassandra åçä¸ä¸ª benchmarkã\n\n# hbase èµæ\n\n * imgur notification: from mysql to hbase\n * pinterest: improving hbase backup efficiency\n * ibm : tuning hbase performance\n * hbase file locality in hdfs\n * apache hadoop goes realtime at facebook\n * storage infrastructure behind facebook messages: using hbase at scale\n * github: awesome hbase\n\néå¯¹äº hbase æä¸¤æ¬ä¹¦ä½ å¯ä»¥èèä¸ä¸ã\n\n * é¦åï¼åæ¨èä¸¤æ¬ä¹¦ï¼ä¸æ¬æ¯åå®è·µçãhbase å®æãï¼å¦ä¸æ¬æ¯åå¤§èå¨çæååçãhbase æå¨æåãã\n * å½ç¶ï¼ä½ ä¹å¯ä»¥ççå®æ¹ç the apache hbaseâ¢ reference guide\n * å¦å¤ä¸¤ä¸ªåæ°æ®åºï¼\n   * clickhouse - open source distributed column database at yandex\n   * scaling redshift without scaling costs at giphy\n\n\n# kv æ°æ®åºèµæ\n\n# redis èµæ\n\n * å®ç½\n   * redis å®ç½\n   * redis github\n   * redis å®æ¹ææ¡£ä¸­æç\n   * redis å½ä»¤åè\n * ä¹¦ç±\n   * ãredis å®æã\n   * ãredis è®¾è®¡ä¸å®ç°ã\n * æºç \n   * ãredis å®æãéå¥ python æºç \n * èµæºæ±æ»\n   * awesome-redis\n * redis client\n   * spring-data-redis å®æ¹ææ¡£\n   * redisson å®æ¹ææ¡£(ä¸­æ,ç¥ææ»å)\n   * redisson å®æ¹ææ¡£(è±æ)\n   * crug | redisson pro vs. jedis: which is faster? ç¿»è¯\n   * redis åå¸é redisson æ§è½æµè¯\n * æç« \n   * learn redis the hard way (in production) at trivago\n   * twitter: how twitter uses redis to scale - 105tb ram, 39mm qps, 10,000+ instances\n   * slack: scaling slackâs job queue - robustly handling billions of tasks in milliseconds using kafka and redis\n   * github: moving persistent data out of redis at github\n   * instagram: storing hundreds of millions of simple key-value pairs in redis\n   * redis in chat architecture of twitch (from 27:22)\n   * deliveroo: optimizing session key storage in redis\n   * deliveroo: optimizing redis storage\n   * github: awesome redis\n\n\n# ææ¡£æ°æ®åºèµæ\n\n * couchbase ecosystem at linkedin\n * simpledb at zendesk\n * data points - what the heck are document databases?\n\n# mongodb èµæ\n\n * å®æ¹\n   * mongodb å®ç½\n   * mongodb github\n   * mongodb å®æ¹åè´¹æç¨\n * æç¨\n   * mongodb æç¨\n   * mongodb é«æè¯¾\n * æ°æ®\n   * mongodb-json-files\n * æç« \n   * introduction to mongodb\n   * ebay: building mission-critical multi-data center applications with mongodb\n   * the aws and mongodb infrastructure of parse: lessons learned\n   * migrating mountains of mongo data\n * æ´å¤èµæº\n   * github: awesome mongodb\n\n\n# æç´¢å¼ææ°æ®åºèµæ\n\n# elasticsearch\n\n * å®æ¹\n   * elasticsearch å®ç½\n   * elasticsearch github\n   * elasticsearch å®æ¹ææ¡£\n   * elasticsearch: the definitive guide - elasticsearch å®æ¹å­¦ä¹ èµæ\n * ä¹¦ç±\n   * ãelasticsearch å®æã\n * æç¨\n   * elk stack æå¨æå\n   * elasticsearch æç¨\n * æç« \n   * elasticsearch+logstash+kibana æç¨\n   * elkï¼elasticsearchãlogstashãkibanaï¼å®è£åéç½®\n   * æ§è½è°ä¼ç¸å³çå·¥ç¨å®è·µ\n     * elasticsearch performance tuning practice at ebay\n     * elasticsearch at kickstarter\n     * 9 tips on elasticsearch configuration for high performance\n     * elasticsearch in productionâ-âdeployment best practices\n * æ´å¤èµæº\n   * github: awesome elasticsearch\n\n\n# å¾æ°æ®åº\n\n * é¦åæ¯ ibm devloperworks ä¸çä¸¤ä¸ªç®ä»æ§ç pptã\n   * intro to graph databases, part 1, graph databases and the crud operations\n   * intro to graph databases, part 2, building a recommendation engine with a graph database\n * ç¶åæ¯ä¸æ¬åè´¹ççµå­ä¹¦ãgraph databaseãã\n * æ¥ä¸æ¥æ¯ä¸äºå¾æ°æ®åºçä»ç»æç« ã\n   * handling billions of edges in a graph database\n   * neo4j case studies with walmart, ebay, airbnb, nasa, etc\n   * flockdb: distributed graph database for storing adjacency lists at twitter\n   * janusgraph: scalable graph database backed by google, ibm and hortonworks\n   * amazon neptune\n\n\n# æ¶åºæ°æ®åº\n\n * what is time-series data & why we need a time-series database\n * time series data: why and how to use a relational database instead of nosql\n * beringei: high-performance time series storage engine @facebook\n * introducing atlas: netflixâs primary telemetry platform @netflix\n * building a scalable time series database on postgresql\n * scaling time series data storage - part i @netflix\n * design of a cost efficient time series store for big data\n * github: awesome time-series database\n\n\n# ä¼ é ðª\n\nâ¾ ð§ éæç it ç¥è¯å¾è°± â¾ ð¯ éæçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2024/10/09, 07:16:02",lastUpdatedTimestamp:1728429362e3}],themeConfig:{nav:[{text:"æ°æ®åºç»¼å",link:"/12.æ°æ®åº/01.æ°æ®åºç»¼å/"},{text:"æ°æ®åºä¸­é´ä»¶",link:"/12.æ°æ®åº/02.æ°æ®åºä¸­é´ä»¶/"},{text:"å³ç³»åæ°æ®åº",link:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/",items:[{text:"ç»¼å",link:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/01.ç»¼å/"},{text:"Mysql",link:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/02.Mysql/"},{text:"å¶ä»",link:"/12.æ°æ®åº/03.å³ç³»åæ°æ®åº/99.å¶ä»/"}]},{text:"ææ¡£æ°æ®åº",items:[{text:"MongoDB",link:"/12.æ°æ®åº/04.ææ¡£æ°æ®åº/01.MongoDB/"}]},{text:"KVæ°æ®åº",items:[{text:"Redis",link:"/12.æ°æ®åº/05.KVæ°æ®åº/01.Redis/"}]},{text:"æç´¢å¼ææ°æ®åº",items:[{text:"Elasticsearch",link:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/"},{text:"Elasticææ¯æ ",link:"/12.æ°æ®åº/07.æç´¢å¼ææ°æ®åº/02.Elastic/"}]}],sidebarDepth:2,logo:"https://raw.githubusercontent.com/dunwu/images/master/common/dunwu-logo.png",repo:"dunwu/db-tutorial",searchMaxSuggestions:10,lastUpdated:"ä¸æ¬¡æ´æ°",docsDir:"docs",editLinks:!0,editLinkText:"ð å¸®å©æ¹åæ­¤é¡µé¢ï¼",sidebar:{"/12.æ°æ®åº/":[{title:"æ°æ®åºç»¼å",collapsable:!0,children:[["01.æ°æ®åºç»¼å/01.Nosqlææ¯éå.md","Nosqlææ¯éå","/pages/0e1012/"],["01.æ°æ®åºç»¼å/02.æ°æ®ç»æä¸æ°æ®åºç´¢å¼.md","æ°æ®ç»æä¸æ°æ®åºç´¢å¼","/pages/d7cd88/"]]},{title:"æ°æ®åºä¸­é´ä»¶",collapsable:!0,children:[{title:"Shardingsphere",collapsable:!0,children:[["02.æ°æ®åºä¸­é´ä»¶/01.Shardingsphere/01.ShardingSphereç®ä».md","ShardingSphere ç®ä»","/pages/5ed2a2/"],["02.æ°æ®åºä¸­é´ä»¶/01.Shardingsphere/02.ShardingSphereJdbc.md","ShardingSphere Jdbc","/pages/8448de/"]]},["02.æ°æ®åºä¸­é´ä»¶/02.Flyway.md","çæ¬ç®¡çä¸­é´ä»¶ Flyway","/pages/e2648c/"]]},{title:"å³ç³»åæ°æ®åº",collapsable:!0,children:[{title:"ç»¼å",collapsable:!0,children:[["03.å³ç³»åæ°æ®åº/01.ç»¼å/01.å³ç³»åæ°æ®åºé¢è¯.md","å³ç³»åæ°æ®åºé¢è¯","/pages/9bb28f/"],["03.å³ç³»åæ°æ®åº/01.ç»¼å/02.SQLè¯­æ³åºç¡ç¹æ§.md","SQL è¯­æ³åºç¡ç¹æ§","/pages/b71c9e/"],["03.å³ç³»åæ°æ®åº/01.ç»¼å/03.æ©å±SQL.md","æ©å± SQL","/pages/55e9a7/"],["03.å³ç³»åæ°æ®åº/01.ç»¼å/99.SqlCheatSheet.md","SQL Cheat Sheet","/pages/e438a7/"]]},{title:"Mysql",collapsable:!0,children:[["03.å³ç³»åæ°æ®åº/02.Mysql/01.Mysqlåºç¨æå.md","Mysql åºç¨æå","/pages/5fe0f3/"],["03.å³ç³»åæ°æ®åº/02.Mysql/02.MySQLå·¥ä½æµ.md","MySQL å·¥ä½æµ","/pages/8262aa/"],["03.å³ç³»åæ°æ®åº/02.Mysql/03.Mysqläºå¡.md","Mysql äºå¡","/pages/00b04d/"],["03.å³ç³»åæ°æ®åº/02.Mysql/04.Mysqlé.md","Mysql é","/pages/f1f151/"],["03.å³ç³»åæ°æ®åº/02.Mysql/05.Mysqlç´¢å¼.md","Mysql ç´¢å¼","/pages/fcb19c/"],["03.å³ç³»åæ°æ®åº/02.Mysql/06.Mysqlæ§è½ä¼å.md","Mysql æ§è½ä¼å","/pages/396816/"],["03.å³ç³»åæ°æ®åº/02.Mysql/20.Mysqlè¿ç»´.md","Mysql è¿ç»´","/pages/e33b92/"],["03.å³ç³»åæ°æ®åº/02.Mysql/21.Mysqléç½®.md","Mysql éç½®","/pages/5da42d/"],["03.å³ç³»åæ°æ®åº/02.Mysql/99.Mysqlå¸¸è§é®é¢.md","Mysql å¸¸è§é®é¢","/pages/7b0caf/"]]},{title:"å¶ä»",collapsable:!0,children:[["03.å³ç³»åæ°æ®åº/99.å¶ä»/01.PostgreSQL.md","PostgreSQL åºç¨æå","/pages/52609d/"],["03.å³ç³»åæ°æ®åº/99.å¶ä»/02.H2.md","H2 åºç¨æå","/pages/f27c0c/"],["03.å³ç³»åæ°æ®åº/99.å¶ä»/03.Sqlite.md","sqlite","/pages/bdcd7e/"]]}]},{title:"ææ¡£æ°æ®åº",collapsable:!0,children:[{title:"MongoDB",collapsable:!0,children:[["04.ææ¡£æ°æ®åº/01.MongoDB/01.MongoDBåºç¨æå.md","MongoDB åºç¨æå","/pages/3288f3/"],["04.ææ¡£æ°æ®åº/01.MongoDB/02.MongoDBçCRUDæä½.md","MongoDB ç CRUD æä½","/pages/7efbac/"],["04.ææ¡£æ°æ®åº/01.MongoDB/03.MongoDBçèåæä½.md","MongoDB çèåæä½","/pages/75daa5/"],["04.ææ¡£æ°æ®åº/01.MongoDB/04.MongoDBäºå¡.md","MongoDB äºå¡","/pages/4574fe/"],["04.ææ¡£æ°æ®åº/01.MongoDB/05.MongoDBå»ºæ¨¡.md","MongoDB å»ºæ¨¡","/pages/562f99/"],["04.ææ¡£æ°æ®åº/01.MongoDB/06.MongoDBå»ºæ¨¡ç¤ºä¾.md","MongoDB å»ºæ¨¡ç¤ºä¾","/pages/88c7d3/"],["04.ææ¡£æ°æ®åº/01.MongoDB/07.MongoDBç´¢å¼.md","MongoDB ç´¢å¼","/pages/10c674/"],["04.ææ¡£æ°æ®åº/01.MongoDB/08.MongoDBå¤å¶.md","MongoDB å¤å¶","/pages/505407/"],["04.ææ¡£æ°æ®åº/01.MongoDB/09.MongoDBåç.md","MongoDB åç","/pages/ad08f5/"],["04.ææ¡£æ°æ®åº/01.MongoDB/20.MongoDBè¿ç»´.md","MongoDB è¿ç»´","/pages/5e3c30/"]]}]},{title:"KVæ°æ®åº",collapsable:!0,children:[{title:"Redis",collapsable:!0,children:[["05.KVæ°æ®åº/01.Redis/01.Redisé¢è¯æ»ç».md","Redis é¢è¯æ»ç»","/pages/451b73/"],["05.KVæ°æ®åº/01.Redis/02.Redisåºç¨æå.md","Redis åºç¨æå","/pages/94e9d6/"],["05.KVæ°æ®åº/01.Redis/03.Redisæ°æ®ç±»åååºç¨.md","Redis æ°æ®ç±»åååºç¨","/pages/ed757c/"],["05.KVæ°æ®åº/01.Redis/04.Redisæä¹å.md","Redis æä¹å","/pages/4de901/"],["05.KVæ°æ®åº/01.Redis/05.Rediså¤å¶.md","Redis å¤å¶","/pages/379cd8/"],["05.KVæ°æ®åº/01.Redis/06.Rediså¨åµ.md","Redis å¨åµ","/pages/615afe/"],["05.KVæ°æ®åº/01.Redis/07.Rediséç¾¤.md","Redis éç¾¤","/pages/77dfbe/"],["05.KVæ°æ®åº/01.Redis/08.Rediså®æ.md","Redis å®æ","/pages/1fc9c4/"],["05.KVæ°æ®åº/01.Redis/20.Redisè¿ç»´.md","Redis è¿ç»´","/pages/537098/"]]}]},{title:"åå¼æ°æ®åº",collapsable:!0,children:[{title:"HBase",collapsable:!0,children:[["06.åå¼æ°æ®åº/01.HBase/01.HBaseå¿«éå¥é¨.md","HBase å¿«éå¥é¨","/pages/7ab03c/"],["06.åå¼æ°æ®åº/01.HBase/02.HBaseæ°æ®æ¨¡å.md","HBase æ°æ®æ¨¡å","/pages/c8cfeb/"],["06.åå¼æ°æ®åº/01.HBase/03.HBaseSchemaè®¾è®¡.md","HBase Schema è®¾è®¡","/pages/a69528/"],["06.åå¼æ°æ®åº/01.HBase/04.HBaseæ¶æ.md","HBase æ¶æ","/pages/62f8d9/"],["06.åå¼æ°æ®åº/01.HBase/10.HBaseJavaApiåºç¡ç¹æ§.md","HBase Java API åºç¡ç¹æ§","/pages/a8cad3/"],["06.åå¼æ°æ®åº/01.HBase/11.HBaseJavaApié«çº§ç¹æ§ä¹è¿æ»¤å¨.md","HBase Java API é«çº§ç¹æ§ä¹è¿æ»¤å¨","/pages/a3347e/"],["06.åå¼æ°æ®åº/01.HBase/12.HBaseJavaApié«çº§ç¹æ§ä¹åå¤çå¨.md","HBase Java API é«çº§ç¹æ§ä¹åå¤çå¨","/pages/5f1bc3/"],["06.åå¼æ°æ®åº/01.HBase/13.HBaseJavaApiå¶ä»é«çº§ç¹æ§.md","HBase Java API å¶ä»é«çº§ç¹æ§","/pages/ce5ca0/"],["06.åå¼æ°æ®åº/01.HBase/14.HBaseJavaApiç®¡çåè½.md","HBase Java API ç®¡çåè½","/pages/b59ba2/"],["06.åå¼æ°æ®åº/01.HBase/21.HBaseè¿ç»´.md","HBase è¿ç»´","/pages/f808fc/"],["06.åå¼æ°æ®åº/01.HBase/22.HBaseå½ä»¤.md","HBase å½ä»¤","/pages/263c40/"]]},["06.åå¼æ°æ®åº/02.Cassandra.md","Cassandra","/pages/ca3ca5/"]]},{title:"æç´¢å¼ææ°æ®åº",collapsable:!0,children:[{title:"Elasticsearch",collapsable:!0,children:[["07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/01.Elasticsearché¢è¯æ»ç».md","Elasticsearch é¢è¯æ»ç»","/pages/0cb563/"],["07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/02.Elasticsearchå¿«éå¥é¨.md","Elasticsearch å¿«éå¥é¨","/pages/98c3a5/"],["07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/03.Elasticsearchç®ä».md","Elasticsearch ç®ä»","/pages/0fb506/"],["07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/04.Elasticsearchç´¢å¼.md","Elasticsearch ç´¢å¼","/pages/293175/"],["07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/05.Elasticsearchæ¥è¯¢.md","Elasticsearch æ¥è¯¢","/pages/83bd15/"],["07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/06.Elasticsearché«äº®.md","Elasticsearch é«äº®æç´¢åæ¾ç¤º","/pages/e1b769/"],["07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/07.Elasticsearchæåº.md","Elasticsearch æåº","/pages/24baff/"],["07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/08.Elasticsearchèå.md","Elasticsearch èå","/pages/f89f66/"],["07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/09.Elasticsearchåæå¨.md","Elasticsearch åæå¨","/pages/a5a001/"],["07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/10.Elasticsearchæ§è½ä¼å.md","Elasticsearch æ§è½ä¼å","/pages/2d95ce/"],["07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/11.ElasticsearchRestApi.md","Elasticsearch Rest API","/pages/4b1907/"],["07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/12.ElasticsearchHighLevelRestJavaApi.md","ElasticSearch Java API ä¹ High Level REST Client","/pages/201e43/"],["07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/13.Elasticsearchéç¾¤ååç.md","Elasticsearch éç¾¤ååç","/pages/9a2546/"],["07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/20.Elasticsearchè¿ç»´.md","Elasticsearch è¿ç»´","/pages/fdaf15/"]]},{title:"Elastic",collapsable:!0,children:[["07.æç´¢å¼ææ°æ®åº/02.Elastic/01.Elasticå¿«éå¥é¨.md","Elastic å¿«éå¥é¨","/pages/553160/"],["07.æç´¢å¼ææ°æ®åº/02.Elastic/02.Elasticææ¯æ ä¹Filebeat.md","Elastic ææ¯æ ä¹ Filebeat","/pages/b7f079/"],["07.æç´¢å¼ææ°æ®åº/02.Elastic/03.Filebeatè¿ç»´.md","Filebeat è¿ç»´","/pages/7c067f/"],["07.æç´¢å¼ææ°æ®åº/02.Elastic/04.Elasticææ¯æ ä¹Kibana.md","Elastic ææ¯æ ä¹ Kibana","/pages/002159/"],["07.æç´¢å¼ææ°æ®åº/02.Elastic/05.Kibanaè¿ç»´.md","Kibana è¿ç»´","/pages/fc47af/"],["07.æç´¢å¼ææ°æ®åº/02.Elastic/06.Elasticææ¯æ ä¹Logstash.md","Elastic ææ¯æ ä¹ Logstash","/pages/55ce99/"],["07.æç´¢å¼ææ°æ®åº/02.Elastic/07.Logstashè¿ç»´.md","Logstash è¿ç»´","/pages/92df30/"]]}]}],catalogue:{}},sidebarOpen:!0,updateBar:{showToArticle:!0},category:!0,tag:!0,archive:!0,author:{name:"dunwu",href:"https://github.com/dunwu"},social:{icons:[{iconClass:"icon-youjian",title:"åé®ä»¶",link:"mailto:forbreak@163.com"},{iconClass:"icon-github",title:"GitHub",link:"https://github.com/dunwu"}]},footer:{createYear:2019,copyrightInfo:"éæï¼dunwuï¼ | CC-BY-SA-4.0"},htmlModules:{windowRB:'\n    <div class="wwads-cn wwads-vertical windowRB" data-id="261" style="max-width:160px;\n    min-width: auto;min-height:auto;"></div>\n    <style>\n      .windowRB{ padding: 0;}\n      .windowRB .wwads-img{margin-top: 10px;}\n      .windowRB .wwads-content{margin: 0 10px 40px 10px;}\n      .custom-html-window-rb .close-but{\n        display: none;\n      }\n    </style>\n  '}}};var xo=t(96),To=t(97),wo=t(11);var ko={computed:{$filterPosts(){return this.$site.pages.filter(n=>{const{frontmatter:{pageComponent:e,article:t,home:a}}=n;return!(e||!1===t||!0===a)})},$sortPosts(){return(n=this.$filterPosts).sort((n,e)=>{const t=n.frontmatter.sticky,a=e.frontmatter.sticky;return t&&a?t==a?Object(wo.a)(n,e):t-a:t&&!a?-1:!t&&a?1:Object(wo.a)(n,e)}),n;var n},$sortPostsByDate(){return(n=this.$filterPosts).sort((n,e)=>Object(wo.a)(n,e)),n;var n},$groupPosts(){return function(n){const e={},t={};for(let a=0,s=n.length;a<s;a++){const{frontmatter:{categories:s,tags:i}}=n[a];"array"===Object(wo.n)(s)&&s.forEach(t=>{t&&(e[t]||(e[t]=[]),e[t].push(n[a]))}),"array"===Object(wo.n)(i)&&i.forEach(e=>{e&&(t[e]||(t[e]=[]),t[e].push(n[a]))})}return{categories:e,tags:t}}(this.$sortPosts)},$categoriesAndTags(){return function(n){const e=[],t=[];for(let t in n.categories)e.push({key:t,length:n.categories[t].length});for(let e in n.tags)t.push({key:e,length:n.tags[e].length});return{categories:e,tags:t}}(this.$groupPosts)}}};Kt.component(xo.default),Kt.component(To.default);function Io(n){return n.toString().padStart(2,"0")}t(246);Kt.component("Badge",()=>Promise.all([t.e(0),t.e(3)]).then(t.bind(null,435))),Kt.component("CodeBlock",()=>Promise.resolve().then(t.bind(null,96))),Kt.component("CodeGroup",()=>Promise.resolve().then(t.bind(null,97)));t(247);var So=t(95),qo=t.n(So),Ro=t(25);let Ao,Bo;var Lo;"valine"===(Lo="gitalk")?t.e(98).then(t.t.bind(null,339,7)).then(n=>Bo=n.default):"gitalk"===Lo&&Promise.all([t.e(0),t.e(97)]).then(t.t.bind(null,340,7)).then(()=>t.e(96).then(t.t.bind(null,341,7))).then(n=>Ao=n.default);function zo(n,e){const t={};return Reflect.ownKeys(n).forEach(a=>{if("string"==typeof n[a])try{t[a]=qo.a.render(n[a],e)}catch(e){console.warn(`Comment config option error at key named "${a}"`),console.warn("More info: "+e.message),t[a]=n[a]}else t[a]=n[a]}),t}console.log(`How to use "gitalk" in ${Ro.name}@v${Ro.version}:`,Ro.homepage);const Do={gitalk:{render(n,e){const t=document.createElement("div");t.id=e;document.querySelector("main.page").appendChild(t);new Ao(zo({clientID:"7dd8c87a20cff437d2ed",clientSecret:"4e28d81a9a0280796b2b45ce2944424c6f2c1531",repo:"db-tutorial",owner:"dunwu",admin:["dunwu"],pagerDirection:"last",id:"<%- (frontmatter.permalink || frontmatter.to.path).slice(-16) %>",title:"ãè¯è®ºã<%- frontmatter.title %>",labels:["Gitalk","Comment"],body:"é¡µé¢ï¼<%- window.location.origin + (frontmatter.to.path || window.location.pathname) %>"},{frontmatter:n})).render(e)},clear(n){const e=document.querySelector("#"+n);return e&&e.remove(),!0}},valine:{render(n,e){const t=document.createElement("div");t.id=e;document.querySelector("main.page").appendChild(t),new Bo({...zo({clientID:"7dd8c87a20cff437d2ed",clientSecret:"4e28d81a9a0280796b2b45ce2944424c6f2c1531",repo:"db-tutorial",owner:"dunwu",admin:["dunwu"],pagerDirection:"last",id:"<%- (frontmatter.permalink || frontmatter.to.path).slice(-16) %>",title:"ãè¯è®ºã<%- frontmatter.title %>",labels:["Gitalk","Comment"],body:"é¡µé¢ï¼<%- window.location.origin + (frontmatter.to.path || window.location.pathname) %>"},{frontmatter:n}),el:"#"+e})},clear(n){const e=document.querySelector("#"+n);return e&&e.remove(),!0}}},Mo="vuepress-plugin-comment";let Co=null;function Oo(n){return Do.gitalk.clear(Mo)}function No(n){return!1!==n.comment&&!1!==n.comments}function Po(n){clearTimeout(Co);if(document.querySelector("main.page"))return Do.gitalk.render(n,Mo);Co=setTimeout(()=>Po(n),200)}var jo={mounted(){Co=setTimeout(()=>{const n={to:{},from:{},...this.$frontmatter};Oo()&&No(n)&&Po(n)},1e3),this.$router.afterEach((n,e)=>{if(n&&e&&n.path===e.path)return;const t={to:n,from:e,...this.$frontmatter};Oo()&&No(t)&&Po(t)})}},Fo=Object(yo.a)(jo,(function(){return(0,this._self._c)("div")}),[],!1,null,null,null).exports,Ho=[({Vue:n,options:e,router:t,siteData:a,isServer:s})=>{s||t.afterEach(()=>{var n;n=function(){setTimeout((function(){void 0===window._AdBlockInit&&function(){const n=document.getElementsByClassName("wwads-cn"),e=document.querySelector(".wwads-content");n[0]&&!e&&(n[0].innerHTML="<style>.wwads-horizontal,.wwads-vertical{background-color:#f4f8fa;padding:5px;min-height:120px;margin-top:20px;box-sizing:border-box;border-radius:3px;font-family:sans-serif;display:flex;min-width:150px;position:relative;overflow:hidden;}.wwads-horizontal{flex-wrap:wrap;justify-content:center}.wwads-vertical{flex-direction:column;align-items:center;padding-bottom:32px}.wwads-horizontal a,.wwads-vertical a{text-decoration:none}.wwads-horizontal .wwads-img,.wwads-vertical .wwads-img{margin:5px}.wwads-horizontal .wwads-content,.wwads-vertical .wwads-content{margin:5px}.wwads-horizontal .wwads-content{flex:130px}.wwads-vertical .wwads-content{margin-top:10px}.wwads-horizontal .wwads-text,.wwads-content .wwads-text{font-size:14px;line-height:1.4;color:#0e1011;-webkit-font-smoothing:antialiased}.wwads-horizontal .wwads-poweredby,.wwads-vertical .wwads-poweredby{display:block;font-size:11px;color:#a6b7bf;margin-top:1em}.wwads-vertical .wwads-poweredby{position:absolute;left:10px;bottom:10px}.wwads-horizontal .wwads-poweredby span,.wwads-vertical .wwads-poweredby span{transition:all 0.2s ease-in-out;margin-left:-1em}.wwads-horizontal .wwads-poweredby span:first-child,.wwads-vertical .wwads-poweredby span:first-child{opacity:0}.wwads-horizontal:hover .wwads-poweredby span,.wwads-vertical:hover .wwads-poweredby span{opacity:1;margin-left:0}.wwads-horizontal .wwads-hide,.wwads-vertical .wwads-hide{position:absolute;right:-23px;bottom:-23px;width:46px;height:46px;border-radius:23px;transition:all 0.3s ease-in-out;cursor:pointer;}.wwads-horizontal .wwads-hide:hover,.wwads-vertical .wwads-hide:hover{background:rgb(0 0 0 /0.05)}.wwads-horizontal .wwads-hide svg,.wwads-vertical .wwads-hide svg{position:absolute;left:10px;top:10px;fill:#a6b7bf}.wwads-horizontal .wwads-hide:hover svg,.wwads-vertical .wwads-hide:hover svg{fill:#3E4546}</style><a href='https://wwads.cn/page/whitelist-wwads' class='wwads-img' target='_blank' rel='nofollow'><img src='https://fastly.jsdelivr.net/gh/xugaoyi/image_store@master/blog/wwads.2a3pidhlh4ys.webp' width='130'></a><div class='wwads-content'><a href='https://wwads.cn/page/whitelist-wwads' class='wwads-text' target='_blank' rel='nofollow'>ä¸ºäºæ¬ç«çé¿æè¿è¥ï¼è¯·å°æä»¬çç½ç«å å¥å¹¿åæ¦æªå¨çç½ååï¼æè°¢æ¨çæ¯æï¼<span style='color: #11a8cd'>å¦ä½æ·»å ç½åå?</span></a><a href='https://wwads.cn/page/end-user-privacy' class='wwads-poweredby' title='ä¸ç»´å¹¿å ï½ è®©å¹¿åæ´ä¼éï¼ä¸æç¨' target='_blank'><span>å¹¿å</span></a></div><a class='wwads-hide' onclick='parentNode.remove()' title='éèå¹¿å'><svg xmlns='http://www.w3.org/2000/svg' width='6' height='7'><path d='M.879.672L3 2.793 5.121.672a.5.5 0 11.707.707L3.708 3.5l2.12 2.121a.5.5 0 11-.707.707l-2.12-2.12-2.122 2.12a.5.5 0 11-.707-.707l2.121-2.12L.172 1.378A.5.5 0 01.879.672z'></path></svg></a>")}()}),3e3)},"complete"===document.readyState||"interactive"===document.readyState?setTimeout(n,1):document.addEventListener("DOMContentLoaded",n),setTimeout(()=>{const n=document.querySelector(".page-wwads");if(!n)return;const e=n.querySelector(".wwads-hide");e&&(e.onclick=()=>{n.style.display="none"}),"none"===n.style.display&&(n.style.display="flex")},900)})},({Vue:n,options:e,router:t,siteData:a})=>{a.pages.map(n=>{const{frontmatter:{date:e,author:t}}=n;"string"==typeof e&&"Z"===e.charAt(e.length-1)&&(n.frontmatter.date=function(n){n instanceof Date||(n=new Date(n));return`${n.getUTCFullYear()}-${Io(n.getUTCMonth()+1)}-${Io(n.getUTCDate())} ${Io(n.getUTCHours())}:${Io(n.getUTCMinutes())}:${Io(n.getUTCSeconds())}`}(e)),t?n.author=t:a.themeConfig.author&&(n.author=a.themeConfig.author)}),n.mixin(ko)},{},({Vue:n})=>{n.mixin({computed:{$dataBlock(){return this.$options.__data__block__}}})},{},{},()=>{"undefined"!=typeof window&&function(n,e,t){function a(n){var t=e.createElement("div");t.className="heart",s.push({el:t,x:n.clientX-5,y:n.clientY-5,scale:1,alpha:1,color:"#11a8cd"}),e.body.appendChild(t)}var s=[];n.requestAnimationFrame=n.requestAnimationFrame||n.webkitRequestAnimationFrame||n.mozRequestAnimationFrame||n.oRequestAnimationFrame||n.msRequestAnimationFrame||function(n){setTimeout(n,1e3/60)},function(n){var t=e.createElement("style");t.type="text/css";try{t.appendChild(e.createTextNode(n))}catch(e){t.styleSheet.cssText=n}e.getElementsByTagName("head")[0].appendChild(t)}(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"),function(){var e="function"==typeof n.onclick&&n.onclick;n.onclick=function(n){let t=!0;n.path&&n.path.forEach(n=>{1===n.nodeType&&"string"==typeof n.className&&n.className.indexOf("theme-vdoing-content")>-1&&(t=!1)}),t&&(e&&e(),a(n))}}(),function n(){for(var t=0;t<s.length;t++)s[t].alpha<=0?(e.body.removeChild(s[t].el),s.splice(t,1)):(s[t].y--,s[t].scale+=.004,s[t].alpha-=.013,s[t].el.style.cssText="left:"+s[t].x+"px;top:"+s[t].y+"px;opacity:"+s[t].alpha+";transform:scale("+s[t].scale+","+s[t].scale+") rotate(45deg);background:"+s[t].color+";z-index:99999");requestAnimationFrame(n)}()}(window,document)},({Vue:n})=>{n.component("Comment",Fo)}],Uo=["Comment"];class $o extends class{constructor(){this.store=new Kt({data:{state:{}}})}$get(n){return this.store.state[n]}$set(n,e){Kt.set(this.store.state,n,e)}$emit(...n){this.store.$emit(...n)}$on(...n){this.store.$on(...n)}}{}Object.assign($o.prototype,{getPageAsyncComponent:rl,getLayoutAsyncComponent:ll,getAsyncComponent:ol,getVueComponent:cl});var Qo={install(n){const e=new $o;n.$vuepress=e,n.prototype.$vuepress=e}};function Go(n,e){const t=e.toLowerCase();return n.options.routes.some(n=>n.path.toLowerCase()===t)}var Ko={props:{pageKey:String,slotKey:{type:String,default:"default"}},render(n){const e=this.pageKey||this.$parent.$page.key;return ul("pageKey",e),Kt.component(e)||Kt.component(e,rl(e)),Kt.component(e)?n(e):n("")}},Vo={functional:!0,props:{slotKey:String,required:!0},render:(n,{props:e,slots:t})=>n("div",{class:["content__"+e.slotKey]},t()[e.slotKey])},Wo={computed:{openInNewWindowTitle(){return this.$themeLocaleConfig.openNewWindowText||"(opens new window)"}}},Jo=(t(252),t(253),Object(yo.a)(Wo,(function(){var n=this._self._c;return n("span",[n("svg",{staticClass:"icon outbound",attrs:{xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",x:"0px",y:"0px",viewBox:"0 0 100 100",width:"15",height:"15"}},[n("path",{attrs:{fill:"currentColor",d:"M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"}}),this._v(" "),n("polygon",{attrs:{fill:"currentColor",points:"45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"}})]),this._v(" "),n("span",{staticClass:"sr-only"},[this._v(this._s(this.openInNewWindowTitle))])])}),[],!1,null,null,null).exports),Xo={functional:!0,render(n,{parent:e,children:t}){if(e._isMounted)return t;e.$once("hook:mounted",()=>{e.$forceUpdate()})}};Kt.config.productionTip=!1,Kt.use($r),Kt.use(Qo),Kt.mixin(function(n,e,t=Kt){!function(n){n.locales&&Object.keys(n.locales).forEach(e=>{n.locales[e].path=e});Object.freeze(n)}(e),t.$vuepress.$set("siteData",e);const a=new(n(t.$vuepress.$get("siteData"))),s=Object.getOwnPropertyDescriptors(Object.getPrototypeOf(a)),i={};return Object.keys(s).reduce((n,e)=>(e.startsWith("$")&&(n[e]=s[e].get),n),i),{computed:i}}(n=>class{setPage(n){this.__page=n}get $site(){return n}get $themeConfig(){return this.$site.themeConfig}get $frontmatter(){return this.$page.frontmatter}get $localeConfig(){const{locales:n={}}=this.$site;let e,t;for(const a in n)"/"===a?t=n[a]:0===this.$page.path.indexOf(a)&&(e=n[a]);return e||t||{}}get $siteTitle(){return this.$localeConfig.title||this.$site.title||""}get $canonicalUrl(){const{canonicalUrl:n}=this.$page.frontmatter;return"string"==typeof n&&n}get $title(){const n=this.$page,{metaTitle:e}=this.$page.frontmatter;if("string"==typeof e)return e;const t=this.$siteTitle,a=n.frontmatter.home?null:n.frontmatter.title||n.title;return t?a?a+" | "+t:t:a||"VuePress"}get $description(){const n=function(n){if(n){const e=n.filter(n=>"description"===n.name)[0];if(e)return e.content}}(this.$page.frontmatter.meta);return n||(this.$page.frontmatter.description||this.$localeConfig.description||this.$site.description||"")}get $lang(){return this.$page.frontmatter.lang||this.$localeConfig.lang||"en-US"}get $localePath(){return this.$localeConfig.path||"/"}get $themeLocaleConfig(){return(this.$site.themeConfig.locales||{})[this.$localePath]||{}}get $page(){return this.__page?this.__page:function(n,e){for(let t=0;t<n.length;t++){const a=n[t];if(a.path.toLowerCase()===e.toLowerCase())return a}return{path:"",frontmatter:{}}}(this.$site.pages,this.$route.path)}},Eo)),Kt.component("Content",Ko),Kt.component("ContentSlotsDistributor",Vo),Kt.component("OutboundLink",Jo),Kt.component("ClientOnly",Xo),Kt.component("Layout",ll("Layout")),Kt.component("NotFound",ll("NotFound")),Kt.prototype.$withBase=function(n){const e=this.$site.base;return"/"===n.charAt(0)?e+n.slice(1):n},window.__VUEPRESS__={version:"1.9.9",hash:"47d7d15"},async function(n){const e="undefined"!=typeof window&&window.__VUEPRESS_ROUTER_BASE__?window.__VUEPRESS_ROUTER_BASE__:Eo.routerBase||Eo.base,t=new $r({base:e,mode:"history",fallback:!1,routes:_o,scrollBehavior:(n,e,t)=>t||(n.hash?!Kt.$vuepress.$get("disableScrollBehavior")&&{selector:decodeURIComponent(n.hash)}:{x:0,y:0})});!function(n){n.beforeEach((e,t,a)=>{if(Go(n,e.path))a();else if(/(\/|\.html)$/.test(e.path))if(/\/$/.test(e.path)){const t=e.path.replace(/\/$/,"")+".html";Go(n,t)?a(t):a()}else a();else{const t=e.path+"/",s=e.path+".html";Go(n,s)?a(s):Go(n,t)?a(t):a()}})}(t);const a={};try{await Promise.all(Ho.filter(n=>"function"==typeof n).map(e=>e({Vue:Kt,options:a,router:t,siteData:Eo,isServer:n})))}catch(n){console.error(n)}return{app:new Kt(Object.assign(a,{router:t,render:n=>n("div",{attrs:{id:"app"}},[n("RouterView",{ref:"layout"}),n("div",{class:"global-ui"},Uo.map(e=>n(e)))])})),router:t}}(!1).then(({app:n,router:e})=>{e.onReady(()=>{n.$mount("#app")})})}]);